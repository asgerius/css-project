[{"tags": ["go", "methods", "struct", "reflection", "interface"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1520462859, "creation_date": 1520462859, "answer_id": 49162493, "question_id": 49162418, "link": "https://stackoverflow.com/questions/49162418/using-reflection-to-iterate-over-structs-struct-members-and-calling-a-method-on/49162493#49162493", "title": "Using reflection to iterate over struct&#39;s struct members and calling a method on it", "body": "<p>None of your values are addressable, so you can't call any methods on them with pointer receivers.</p>\n\n<p>If the <code>S1</code> and <code>S2</code> fields can't be pointers, you can still address them if you have a pointer to the <code>Top</code> struct:</p>\n\n<pre><code>r := reflect.ValueOf(&amp;t).Elem()\nfor i := 0; i &lt; r.NumField(); i++ {\n    f := r.Field(i)\n    if f.Kind() == reflect.Struct {\n        validator := f.Addr().Interface().(Validator)\n        validator.Validate()\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6511, "user_id": 99089, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/ge49Z.jpg?s=128&g=1", "display_name": "Paul J. Lucas", "link": "https://stackoverflow.com/users/99089/paul-j-lucas"}, "edited": false, "score": 0, "creation_date": 1520523759, "post_id": 49169215, "comment_id": 85359270, "body": "JimB&#39;s answer requires no changes to the data structures."}], "tags": [], "owner": {"reputation": 153, "user_id": 8522152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e4d2890561489533101b153f549c752?s=128&d=identicon&r=PG&f=1", "display_name": "dchiba", "link": "https://stackoverflow.com/users/8522152/dchiba"}, "is_accepted": false, "score": 1, "last_activity_date": 1520499904, "creation_date": 1520499904, "answer_id": 49169215, "question_id": 49162418, "link": "https://stackoverflow.com/questions/49162418/using-reflection-to-iterate-over-structs-struct-members-and-calling-a-method-on/49169215#49169215", "title": "Using reflection to iterate over struct&#39;s struct members and calling a method on it", "body": "<p>\"Top.S1\" is of type \"T1\" and is different from \"*T1\" type defined \"Validate()\".</p>\n\n<p>If you change \"Top.S1\" to \"*T1\" type and modify the field type checking, your code will work properly.</p>\n\n<pre><code>type Top struct {\n    S1 *T1\n    S2 *T2\n}\n\nfunc main() {\n    t := Top{&amp;T1{}, &amp;T2{}}\n\n    r := reflect.ValueOf(t)\n    for i := 0; i &lt; r.NumField(); i++ {\n        f := r.Field(i)\n        if f.Kind() == reflect.Ptr &amp;&amp; f.Elem().Kind() == reflect.Struct {\n            validator, ok := f.Interface().(Validator)\n            if ok {\n                validator.Validate()\n            } else {\n                fmt.Println(\"not ok\")\n            }\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/hHqP6WdMYqT\" rel=\"nofollow noreferrer\">https://play.golang.org/p/hHqP6WdMYqT</a></p>\n"}], "owner": {"reputation": 6511, "user_id": 99089, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/ge49Z.jpg?s=128&g=1", "display_name": "Paul J. Lucas", "link": "https://stackoverflow.com/users/99089/paul-j-lucas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3280, "favorite_count": 0, "accepted_answer_id": 49162493, "answer_count": 2, "score": 0, "last_activity_date": 1520499904, "creation_date": 1520462434, "question_id": 49162418, "link": "https://stackoverflow.com/questions/49162418/using-reflection-to-iterate-over-structs-struct-members-and-calling-a-method-on", "title": "Using reflection to iterate over struct&#39;s struct members and calling a method on it", "body": "<p>I have a <code>struct</code> that has one or more <code>struct</code> members. Each member is expected to implement a <code>Validator</code> interface.</p>\n\n<p>I want to use reflection to iterate over all <code>struct</code> members and call the interface's <code>Validate()</code> method.  For example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"reflect\"\n\ntype Validator interface {\n    Validate()\n}\n\ntype T1 struct {\n    S string\n}\n\nfunc (p *T1) Validate() {\n    fmt.Println(\"HERE 1\")\n}\n\ntype T2 struct {\n    S string\n}\n\nfunc (p *T2) Validate() {\n    fmt.Println(\"HERE 2\")\n}\n\ntype Top struct {\n    S1 T1\n    S2 T2\n}\n\nfunc main() {\n    var t Top\n\n    r := reflect.ValueOf(t)\n    for i := 0; i &lt; r.NumField(); i++ {\n        f := r.Field(i)\n        if f.Kind() == reflect.Struct {\n            validator := f.Interface().(Validator)\n            validator.Validate()\n        }\n    }\n}\n</code></pre>\n\n<p>When run, it outputs:</p>\n\n<blockquote>\n  <p>panic: interface conversion: main.T1 is not main.Validator: missing method Validate</p>\n</blockquote>\n\n<p>If I change the <code>Validate()</code> methods to accept value (rather than pointer) receivers, then it works. However, I <em>want</em> to use pointer receivers since the <code>struct</code>s may grow to be large.</p>\n\n<p>How can I change the reflection code to work where the methods are defined taking pointer receivers?</p>\n\n<p>I also tried using this line:</p>\n\n<pre><code>            validator := f.Addr().Interface().(Validator)\n</code></pre>\n\n<p>to get a pointer, but it then outputs:</p>\n\n<blockquote>\n  <p>panic: reflect.Value.Addr of unaddressable value</p>\n</blockquote>\n"}, {"tags": ["go", "orm", "go-gorm"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1520461558, "post_id": 49161285, "comment_id": 85330170, "body": "I don&#39;t think gorm has anything like this, but you can probably fake it with <a href=\"http://gorm.io/docs/many_to_many.html\" rel=\"nofollow noreferrer\">many to many</a>."}], "owner": {"reputation": 461, "user_id": 7359470, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3d7fb653bc3eb067f9dd9b2019e653bd?s=128&d=identicon&r=PG&f=1", "display_name": "mofury", "link": "https://stackoverflow.com/users/7359470/mofury"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 408, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1520457187, "creation_date": 1520457187, "question_id": 49161285, "link": "https://stackoverflow.com/questions/49161285/how-to-create-through-association-in-golang-gorm", "title": "How to create through association in Golang GORM?", "body": "<p>For example, I have the following models</p>\n\n<pre><code>type Company struct {\n    ID uint `gorm:\"PRIMARY_KEY\"`\n    Name string\n    Departments []*Department `gorm:\"FOREIGNKEY:CompanyID\"`\n    Managers []*Manager\n}\n\ntype Department struct {\n    ID uint `gorm:\"PRIMARY_KEY\"`\n    Name string\n    Managers []*Manager `gorm:\"FOREIGNKEY:DepartmentID\"`\n    CompanyID uint\n}\n\ntype Manager struct {\n    ID uint `gorm:\"PRIMARY_KEY\"`\n    Name string\n    DepartmentID uint\n}\n</code></pre>\n\n<p>That is, company has many departments, and department has many managers. How can I create an association between company and manager such that I can say company has many managers through departments? </p>\n\n<p>Is this feature even possible in Go GORM? I am used to seeing this in Rails ActiveRecord</p>\n\n<pre><code>class Company &lt; ApplicationRecord\n    has_many :departments\n    has_many :managers, through: :departments\nend\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "tfs"], "comments": [{"owner": {"reputation": 23, "user_id": 8207853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f90b3dbd3dbf9296c0c37753db54cf6b?s=128&d=identicon&r=PG&f=1", "display_name": "Haoyuan Yue", "link": "https://stackoverflow.com/users/8207853/haoyuan-yue"}, "reply_to_user": {"reputation": 25359, "user_id": 5425825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cb2be754626c633f6062ef8b9b0952f?s=128&d=identicon&r=PG&f=1", "display_name": "Cece Dong - MSFT", "link": "https://stackoverflow.com/users/5425825/cece-dong-msft"}, "edited": false, "score": 0, "creation_date": 1522445786, "post_id": 49160698, "comment_id": 86171548, "body": "Yes, it is helpful."}], "answers": [{"tags": [], "owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "is_accepted": true, "score": 2, "last_activity_date": 1520457705, "last_edit_date": 1520457705, "creation_date": 1520456013, "answer_id": 49160999, "question_id": 49160698, "link": "https://stackoverflow.com/questions/49160698/how-to-extract-the-code-coverage-value-from-go-test-coverprofile-cover-out/49160999#49160999", "title": "How to extract the code coverage value from go test -coverprofile=cover.out?", "body": "<p>Dumb and straightforward way I can guess right ahead: </p>\n\n<ul>\n<li>try <code>go test -cover -json</code>, </li>\n<li>unmarshal the result </li>\n<li>and look for the \"coverage:\" string in \"Action\": \"output\".</li>\n</ul>\n\n<p>The other way:</p>\n\n<p>using <code>go tool cover -func=cover.out</code> you get nice and clean lines of text like that:</p>\n\n<pre><code>fmt/format.go: init              100.0%\nfmt/format.go: clearflags        100.0%\nfmt/format.go: init              100.0%\nfmt/format.go: computePadding     84.6%\nfmt/format.go: writePadding      100.0%\nfmt/format.go: pad               100.0%\n...\nfmt/scan.go:   advance            96.2%\nfmt/scan.go:   doScanf            96.8%\ntotal:         (statements)       91.7%\n</code></pre>\n\n<p>it is straightforward to parse it, for example: <a href=\"https://play.golang.org/p/bgYW7NZKu_S\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bgYW7NZKu_S</a>.</p>\n"}], "owner": {"reputation": 23, "user_id": 8207853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f90b3dbd3dbf9296c0c37753db54cf6b?s=128&d=identicon&r=PG&f=1", "display_name": "Haoyuan Yue", "link": "https://stackoverflow.com/users/8207853/haoyuan-yue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 477, "favorite_count": 0, "accepted_answer_id": 49160999, "answer_count": 1, "score": 2, "last_activity_date": 1520457705, "creation_date": 1520454676, "question_id": 49160698, "link": "https://stackoverflow.com/questions/49160698/how-to-extract-the-code-coverage-value-from-go-test-coverprofile-cover-out", "title": "How to extract the code coverage value from go test -coverprofile=cover.out?", "body": "<p>I am working on a CI(TFS2015) for our go application and I want to ensure the code quality. For example, when the code coverage of go application is low(less than 60%), the CI will fail the building process. Now I can use the \"go test -coverprofile=cover.out\" command to get the code coverage value successfully, but I don't know how to extract this value so it can be used in other places, such as a PowerShell script. I tried to read the cover.out file but it didn't have the coverage result. </p>\n"}, {"tags": ["go", "struct", "aws-sdk-go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520453206, "post_id": 49160305, "comment_id": 85326100, "body": "Also see related: <a href=\"https://stackoverflow.com/questions/30716354/how-do-i-do-a-literal-int64-in-go/30716481#30716481\">How do I do a literal *int64 in Go?</a> (the same applies to <code>*string</code>, <code>*int</code> and to almost all other builtin types)."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 21, "last_activity_date": 1520453106, "creation_date": 1520453106, "answer_id": 49160348, "question_id": 49160305, "link": "https://stackoverflow.com/questions/49160305/cannot-use-latest-type-string-as-type-string-in-field-value/49160348#49160348", "title": "Cannot use &quot;LATEST&quot; (type string) as type *string in field value", "body": "<p>As the error message indicates, the type required is <code>*string</code> (pointer to <code>string</code>), but you just passed a <code>string</code> value. These are not interchangeable. The AWS SDK uses string pointers for most of its inputs due to the vagueries of the AWS API. It does include a helper function, <code>aws.String</code>, for this purpose:</p>\n\n<pre><code>PlatformVersion: aws.String(\"LATEST\"),\n</code></pre>\n\n<p>Which will return a pointer to the provided string. Likewise for your <code>*int64</code>, there is <code>aws.Int64</code>:</p>\n\n<pre><code>Count:                aws.Int64(1),\n</code></pre>\n\n<p>These helpers are <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/aws/\" rel=\"noreferrer\">documented at the very top of the SDK documentation</a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8497169"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16061, "favorite_count": 1, "accepted_answer_id": 49160348, "answer_count": 1, "score": 7, "last_activity_date": 1520453106, "creation_date": 1520452929, "question_id": 49160305, "link": "https://stackoverflow.com/questions/49160305/cannot-use-latest-type-string-as-type-string-in-field-value", "title": "Cannot use &quot;LATEST&quot; (type string) as type *string in field value", "body": "<p>I'm trying to run a ECS task using the new aws-sdk-go (v2). And I'm having some trouble to initialize the <code>&amp;ecs.RunTaskInput{}</code> struct.</p>\n\n<p>According to the file, this is the struct definition:</p>\n\n<pre><code>type RunTaskInput struct {\n    _ struct{} `type:\"structure\"`\n\n    // The short name or full Amazon Resource Name (ARN) of the cluster on which\n    // to run your task. If you do not specify a cluster, the default cluster is\n    // assumed.\n    Cluster *string `locationName:\"cluster\" type:\"string\"`\n\n    // The number of instantiations of the specified task to place on your cluster.\n    // You can specify up to 10 tasks per call.\n    Count *int64 `locationName:\"count\" type:\"integer\"`\n\n    // The name of the task group to associate with the task. The default value\n    // is the family name of the task definition (for example, family:my-family-name).\n    Group *string `locationName:\"group\" type:\"string\"`\n\n    // The launch type on which to run your task.\n    LaunchType LaunchType `locationName:\"launchType\" type:\"string\" enum:\"true\"`\n\n    // The network configuration for the task. This parameter is required for task\n    // definitions that use the awsvpc network mode to receive their own Elastic\n    // Network Interface, and it is not supported for other network modes. For more\n    // information, see Task Networking (http://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-networking.html)\n    // in the Amazon Elastic Container Service Developer Guide.\n    NetworkConfiguration *NetworkConfiguration `locationName:\"networkConfiguration\" type:\"structure\"`\n\n    // A list of container overrides in JSON format that specify the name of a container\n    // in the specified task definition and the overrides it should receive. You\n    // can override the default command for a container (that is specified in the\n    // task definition or Docker image) with a command override. You can also override\n    // existing environment variables (that are specified in the task definition\n    // or Docker image) on a container or add new environment variables to it with\n    // an environment override.\n    //\n    // A total of 8192 characters are allowed for overrides. This limit includes\n    // the JSON formatting characters of the override structure.\n    Overrides *TaskOverride `locationName:\"overrides\" type:\"structure\"`\n\n    // An array of placement constraint objects to use for the task. You can specify\n    // up to 10 constraints per task (including constraints in the task definition\n    // and those specified at run time).\n    PlacementConstraints []PlacementConstraint `locationName:\"placementConstraints\" type:\"list\"`\n\n    // The placement strategy objects to use for the task. You can specify a maximum\n    // of five strategy rules per task.\n    PlacementStrategy []PlacementStrategy `locationName:\"placementStrategy\" type:\"list\"`\n\n    // The platform version on which to run your task. If one is not specified,\n    // the latest version is used by default.\n    PlatformVersion *string `locationName:\"platformVersion\" type:\"string\"`\n\n    // An optional tag specified when a task is started. For example if you automatically\n    // trigger a task to run a batch process job, you could apply a unique identifier\n    // for that job to your task with the startedBy parameter. You can then identify\n    // which tasks belong to that job by filtering the results of a ListTasks call\n    // with the startedBy value. Up to 36 letters (uppercase and lowercase), numbers,\n    // hyphens, and underscores are allowed.\n    //\n    // If a task is started by an Amazon ECS service, then the startedBy parameter\n    // contains the deployment ID of the service that starts it.\n    StartedBy *string `locationName:\"startedBy\" type:\"string\"`\n\n    // The family and revision (family:revision) or full ARN of the task definition\n    // to run. If a revision is not specified, the latest ACTIVE revision is used.\n    //\n    // TaskDefinition is a required field\n    TaskDefinition *string `locationName:\"taskDefinition\" type:\"string\" required:\"true\"`\n}\n</code></pre>\n\n<p>I'm hanging on the value of <code>PlatformVersion</code> with the error:</p>\n\n<p><code>cannot use \"LATEST\" (type string) as type *string in field value</code></p>\n\n<p>For me, is not obvious what is happening. My code:</p>\n\n<pre><code>  _ := svc.RunTaskRequest(&amp;ecs.RunTaskInput{\n    LaunchType: \"FARGATE\",\n    // Count:                1,\n    PlatformVersion: \"LATEST\",\n    // NetworkConfiguration: ecs.NetworkConfiguration{\n    // AwsvpcConfiguration: ecs.AwsvpcConfiguration{\n    //  Subnets:        []string{},\n    //  AssignPublicIp: \"ENABLED\",\n    // },\n    // },\n  })\n</code></pre>\n\n<p>The <code>LaunchType</code> and <code>PlatformVersion</code> has the same types, but one will work, and other won't.</p>\n\n<p>To be honest, the same thing is happening with <code>Count</code>:</p>\n\n<pre><code>cannot use 1 (type int) as type *int64 in field value\n</code></pre>\n\n<p>What should I do to fix the problems? Thank you.</p>\n"}, {"tags": ["performance", "go", "parameter-passing"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1520442359, "post_id": 49157176, "comment_id": 85319818, "body": "See related question: <a href=\"https://stackoverflow.com/questions/36077566/how-can-a-slice-contain-itself/36078970#36078970\">How can a slice contain itself?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 156951, "user_id": 4668, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e5abe1d27b286199c319b0cbe75596c3?s=128&d=identicon&r=PG", "display_name": "Alan Storm", "link": "https://stackoverflow.com/users/4668/alan-storm"}, "edited": false, "score": 0, "creation_date": 1520442373, "post_id": 49157472, "comment_id": 85319826, "body": "Re: generalizations -- I&#39;ve edited the post to say &quot;often more memory efficient&quot;.  Thank you for the reminder, and for the answer"}, {"owner": {"reputation": 156951, "user_id": 4668, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e5abe1d27b286199c319b0cbe75596c3?s=128&d=identicon&r=PG", "display_name": "Alan Storm", "link": "https://stackoverflow.com/users/4668/alan-storm"}, "edited": false, "score": 0, "creation_date": 1520442688, "post_id": 49157472, "comment_id": 85320017, "body": "Thank you for this excellent answer.  One caveat/quibble -- I can&#39;t seem to pass a *Message in as a parameter.  This <code>sayHelloThree(&amp;Messages{&quot;hello world&quot;});</code> . ends up producing a <code>panic: interface conversion: interface {} is *main.Messages, not main.Messages</code> error."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 156951, "user_id": 4668, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e5abe1d27b286199c319b0cbe75596c3?s=128&d=identicon&r=PG", "display_name": "Alan Storm", "link": "https://stackoverflow.com/users/4668/alan-storm"}, "edited": false, "score": 0, "creation_date": 1520442748, "post_id": 49157472, "comment_id": 85320058, "body": "Right, because you&#39;re asserting the type to <code>Messages</code>. The code inside the function is making an assumption about the underlying type of the interface value. That means if you change the type you pass in, you have to change the assertion."}, {"owner": {"reputation": 156951, "user_id": 4668, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e5abe1d27b286199c319b0cbe75596c3?s=128&d=identicon&r=PG", "display_name": "Alan Storm", "link": "https://stackoverflow.com/users/4668/alan-storm"}, "edited": false, "score": 0, "creation_date": 1520442901, "post_id": 49157472, "comment_id": 85320149, "body": "<i>palmsface</i>. Right.  Thank you again."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 156951, "user_id": 4668, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e5abe1d27b286199c319b0cbe75596c3?s=128&d=identicon&r=PG", "display_name": "Alan Storm", "link": "https://stackoverflow.com/users/4668/alan-storm"}, "edited": false, "score": 0, "creation_date": 1520442942, "post_id": 49157472, "comment_id": 85320174, "body": "I&#39;m not sure I&#39;d even say it&#39;s &quot;often&quot; more memory efficient - updated my answer with more details w/r/t to this line of thinking. It&#39;s <i>sometimes</i> more memory efficient, certainly, but I think &quot;it&#39;s complicated&quot; is the best generalization that can be made there :)"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 1, "creation_date": 1520443497, "post_id": 49157472, "comment_id": 85320518, "body": "At some version of Go, a long while back (1.4?) pointers and GC use escape analysis, and pointers that don&#39;t escape function scope (after inlining, so function scope can be bigger than you think) go on the stack, not the heap."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1520443848, "post_id": 49157472, "comment_id": 85320728, "body": "True, escape analysis is applied to pointers... but that&#39;s getting deep into the weeds. If it&#39;s that performance-sensitive you should be poring over the detailed escape analysis of your builds anyway, so general advice no longer matters."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1520443897, "last_edit_date": 1520443897, "creation_date": 1520442150, "answer_id": 49157472, "question_id": 49157176, "link": "https://stackoverflow.com/questions/49157176/what-is-copied-when-a-function-parameter-is-an-interface/49157472#49157472", "title": "What is Copied when a Function Parameter is an Interface", "body": "<p>The interface value is copied. The interface value includes an underlying type descriptor and the underlying value, which may be any type (pointer or otherwise) which satisfies the interface. Being \"wrapped\" in an interface has no impact on these semantics. You can see this in your own quoted code: you have to assert the type to a <code>Messages</code> <em>value</em>, not a <code>*Messages</code> <em>pointer</em>. If, on the other hand, you passed a <code>*Messages</code> in as the parameter, that's what you'd get inside the function.</p>\n\n<p>This is easily demonstrated experimentally:</p>\n\n<pre><code>m := Messages{\"hello world\"}\nvar mi interface{}\nmi = m\nm.hello = \"wait what?\"\nfmt.Println(mi.(Messages).hello)\n// hello world\n</code></pre>\n\n<p>Working playground example: <a href=\"https://play.golang.org/p/lnVzr79eUZF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/lnVzr79eUZF</a></p>\n\n<p>Also, be careful with generalizations like \"making a copy of a pointer which is much more memory efficient than making a copy of the actual parameter\" - this is not universally true, and the change in semantics is often more important than the change in resource usage patterns. For example, a pointer is obviously less efficient when the value is smaller than an address on the operating architecture. A pointer can also force the value onto the heap rather than the stack, which - regardless of its impact on memory usage - increases GC pressure, because the GC gets to ignore values on the stack.</p>\n"}], "owner": {"reputation": 156951, "user_id": 4668, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e5abe1d27b286199c319b0cbe75596c3?s=128&d=identicon&r=PG", "display_name": "Alan Storm", "link": "https://stackoverflow.com/users/4668/alan-storm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 2, "accepted_answer_id": 49157472, "answer_count": 1, "score": 3, "last_activity_date": 1520495791, "creation_date": 1520441251, "last_edit_date": 1520495791, "question_id": 49157176, "link": "https://stackoverflow.com/questions/49157176/what-is-copied-when-a-function-parameter-is-an-interface", "title": "What is Copied when a Function Parameter is an Interface", "body": "<p>Assumptions: In go, all function arguments are passed by value.  To get pass-by-reference semantics/performance, go programmers pass values by pointer.  Go will still make a copy of these arguments, but its making a copy of a pointer which is sometimes more memory efficient than making a copy of the actual parameter.</p>\n\n<p>Question: What is going on when you pass an interface?  i.e., in a program like this</p>\n\n<pre><code>package main\nimport \"fmt\"\n\ntype Messages struct {\n    hello string\n}\n\nfunc main() {\n  sayHelloOne(Messages{\"hello world\"});\n  sayHelloTwo(&amp;Messages{\"hello world\"});\n  sayHelloThree(Messages{\"hello world\"});\n}\n\n\n//go makes a copy of the struct\nfunc sayHelloOne(messages Messages) {\n  fmt.Println(messages.hello)\n}\n\n//go makes a *pointer* to the struct\nfunc sayHelloTwo(messages *Messages) {\n  fmt.Println(messages.hello)\n}\n\n//go --- ???\nfunc sayHelloThree(messages interface{}) {\n  fmt.Println(messages.(Messages).hello)\n}\n</code></pre>\n\n<p>What happens with the argument when a programmer calls the <code>sayHelloThree</code> function?  Is <code>messages</code> being copied?  Or is it a pointer to <code>messages</code> that's copied?  Or is there some weird-to-me deferring going on until <code>messages</code> is cast?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 0, "creation_date": 1520439813, "post_id": 49156702, "comment_id": 85318121, "body": "what does <code>SubexpNames</code> return instead?"}], "answers": [{"comments": [{"owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "edited": false, "score": 0, "creation_date": 1520440204, "post_id": 49156744, "comment_id": 85318365, "body": "may be I use wrong function, but I would like to get group values."}, {"owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "edited": false, "score": 0, "creation_date": 1520440229, "post_id": 49156744, "comment_id": 85318389, "body": "like <code>1</code> and <code>5</code> from <code>[1,5]</code>"}], "tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": true, "score": 2, "last_activity_date": 1520440288, "last_edit_date": 1592644375, "creation_date": 1520439894, "answer_id": 49156744, "question_id": 49156702, "link": "https://stackoverflow.com/questions/49156702/regexp-find-groups-in-expression/49156744#49156744", "title": "Regexp find groups in expression", "body": "<p>Docs says that the element of this array is always an empty string.</p>\n<blockquote>\n<p><code>func (*Regexp) SubexpNames</code></p>\n<p><code>func (re *Regexp) SubexpNames() []string</code></p>\n<p>SubexpNames returns the names of the parenthesized subexpressions in this Regexp. The name for the first sub-expression is names[1], so that if m is a match slice, the name for m[i] is SubexpNames()[i]. <strong>Since the Regexp as a whole cannot be named, names[0] is always the empty string.</strong> The slice should not be modified.</p>\n</blockquote>\n<p>Take a look at the example from the docs:</p>\n<pre><code>func main() {\n    re := regexp.MustCompile(&quot;(?P&lt;first&gt;[a-zA-Z]+) (?P&lt;last&gt;[a-zA-Z]+)&quot;)\n    fmt.Println(re.MatchString(&quot;Alan Turing&quot;))\n    fmt.Printf(&quot;%q\\n&quot;, re.SubexpNames())\n    reversed := fmt.Sprintf(&quot;${%s} ${%s}&quot;, re.SubexpNames()[2], re.SubexpNames()[1])\n    fmt.Println(reversed)\n    fmt.Println(re.ReplaceAllString(&quot;Alan Turing&quot;, reversed))\n}\n</code></pre>\n<p>They use <code>re.SubexpNames()[2]</code> and <code>re.SubexpNames()[1]</code> as well (not <code>re.SubexpNames()[0]</code>).</p>\n<p>Also: <code>SubexpNames</code> returns names of the groups, not matched values. To get the values, use <code>FindStringSubmatch</code>, see in <a href=\"https://stackoverflow.com/questions/30483652/how-to-get-capturing-group-functionality-in-golang-regular-expressions\">this answer</a> and in its <a href=\"https://play.golang.org/p/8LtH7lj1S7S\" rel=\"nofollow noreferrer\">demo</a>.</p>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 49156744, "answer_count": 1, "score": -2, "last_activity_date": 1520440288, "creation_date": 1520439753, "last_edit_date": 1520439948, "question_id": 49156702, "link": "https://stackoverflow.com/questions/49156702/regexp-find-groups-in-expression", "title": "Regexp find groups in expression", "body": "<p>I have a code sample, </p>\n\n<pre><code>sliceArgument := args[1] // should look like e.g. `[1:5]` or `[:5]` or `[1:]`\nexpression := \"^\\\\[(?P&lt;first&gt;\\\\d*?):(?P&lt;last&gt;\\\\d*?)\\\\]$\"\nr := regexp.MustCompile(expression)\nr.FindStringSubmatch(sliceArgument)\nstartEndArgumentList := r.SubexpNames()\nif len(startEndArgumentList)  &gt;= 2 {\n    argMap[`first`] = startEndArgumentList[0]\n    argMap[`last`] = startEndArgumentList[1]\n}\n</code></pre>\n\n<p>When I pass <code>[1:5]</code> as <code>args[1]</code> - I assume that <a href=\"https://golang.org/pkg/regexp/#Regexp.SubexpNames\" rel=\"nofollow noreferrer\">SubexpNames</a> will give me values of two groups. Instead <code>SubexpNames</code> returns: <code>'', 'first', 'last'</code>.\nWhat is wrong here?</p>\n"}, {"tags": ["go", "process"], "comments": [{"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1520436225, "post_id": 49155385, "comment_id": 85315470, "body": "&quot;How could i manage to do it step by step?&quot;  <a href=\"https://github.com/derekparker/delve\" rel=\"nofollow noreferrer\">Delve</a> is a good debugger for Go.  You can use it to step through your program."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1520436308, "post_id": 49155385, "comment_id": 85315538, "body": "What do you mean that the code &quot;is canceling&quot;? This example is quite small, it&#39;s probably faster to print some debug output in the code than to step through with a debugger if you want to know what&#39;s going on. Also, don&#39;t use the syscall package directly for executing commands, there is an <code>os&#47;exec</code> package that will do it correctly for you."}, {"owner": {"reputation": 19, "user_id": 7843843, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c88bec6e82ec2a35b1de92c973dd08b7?s=128&d=identicon&r=PG&f=1", "display_name": "n1ghty", "link": "https://stackoverflow.com/users/7843843/n1ghty"}, "edited": false, "score": 0, "creation_date": 1520436666, "post_id": 49155385, "comment_id": 85315839, "body": "Thats the whole code for now^^ just doing some go learning. Its only doing the apt update after that its not doing the apt upgrade -y. It should do the update and after that it should do apt upgrade -y. And yeah i know about the os/exec functions but there its not working at all. Its just giving me an error code 1."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1520436871, "post_id": 49155385, "comment_id": 85315997, "body": "@n1ghty: ignoring the error and trying to bypass it isn&#39;t going to help, it&#39;s just making things more complicated. Figure out why you&#39;re getting an error with <code>os&#47;exec</code>, as that is very likely the whole problem here."}, {"owner": {"reputation": 19, "user_id": 7843843, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c88bec6e82ec2a35b1de92c973dd08b7?s=128&d=identicon&r=PG&f=1", "display_name": "n1ghty", "link": "https://stackoverflow.com/users/7843843/n1ghty"}, "edited": false, "score": 0, "creation_date": 1520438724, "post_id": 49155385, "comment_id": 85317361, "body": "<code>package main  import ( \t&quot;log&quot; \t&quot;os&#47;exec&quot; )  func update() { \tpath, err := exec.LookPath(&quot;pacman&quot;) \tif err != nil { \t\tlog.Fatal(&quot;pacman not found&quot;) \t}  \tpathArgs := &quot;-Syu&quot; \tcmd := exec.Command(path, pathArgs) \tupdateErr := cmd.Start() \tif err != nil { \t\tlog.Fatal(updateErr) \t} \tlog.Printf(&quot;Waiting for Update to finish&quot;) \tupdateErr = cmd.Wait() \tlog.Printf(&quot;Update failed: %v&quot;, updateErr)  }  func main() { \tupdate() } </code> exit status 1 is the problem. What does that mean?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1520438914, "post_id": 49155385, "comment_id": 85317493, "body": "@n1ghty: please don&#39;t put code in the comments, it&#39;s not really readable. If you want to know what failed for a command, look at the command&#39;s output."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1520443078, "post_id": 49155385, "comment_id": 85320245, "body": "You need to collect what the program writes to its standard error stream."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1520438182, "creation_date": 1520438182, "answer_id": 49156172, "question_id": 49155385, "link": "https://stackoverflow.com/questions/49155385/program-is-canceling-after-first-function/49156172#49156172", "title": "Program is canceling after first function", "body": "<p>To cite <a href=\"https://manpages.debian.org/exec\" rel=\"nofollow noreferrer\">the manual</a>:</p>\n\n<blockquote>\n  <p>The <code>exec()</code> family of functions <em>replaces the current process image</em> with a new process image.</p>\n</blockquote>\n\n<p>(Emphasis mine).</p>\n\n<p>To solve this, use the functions from <code>os/exec</code> and handle all the errors.</p>\n"}], "owner": {"reputation": 19, "user_id": 7843843, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c88bec6e82ec2a35b1de92c973dd08b7?s=128&d=identicon&r=PG&f=1", "display_name": "n1ghty", "link": "https://stackoverflow.com/users/7843843/n1ghty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "closed_date": 1520463730, "answer_count": 1, "score": -3, "last_activity_date": 1520438182, "creation_date": 1520435951, "last_edit_date": 1520438090, "question_id": 49155385, "link": "https://stackoverflow.com/questions/49155385/program-is-canceling-after-first-function", "closed_reason": "Needs details or clarity", "title": "Program is canceling after first function", "body": "<p>i've got a problem with my go code. I'll try to build a script to automate my update and installing with syscall.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n    \"syscall\"\n)\n\nfunc update() {\n    binary, lookErr := exec.LookPath(\"apt\")\n    if lookErr != nil {\n        panic(lookErr)\n    }\n\n    args := []string{\"apt\", \"update\"}\n\n    env := os.Environ()\n\n    execErr := syscall.Exec(binary, args, env)\n    if execErr != nil {\n        panic(execErr)\n    }\n\n}\n\nfunc upgrade() {\n    binary, lookErr := exec.LookPath(\"apt\")\n    if lookErr != nil {\n        panic(lookErr)\n    }\n\n    args := []string{\"apt\", \"upgrade\", \"-y\"}\n\n    env := os.Environ()\n\n    execErr := syscall.Exec(binary, args, env)\n    if execErr != nil {\n        panic(execErr)\n    }\n}\n\nfunc main() {\n    update()\n    upgrade()\n}\n</code></pre>\n\n<p>The code is only doing the first update() function. After that is canceling. No errors or anything. How could i manage to do it step by step?</p>\n"}, {"tags": ["go", "graphql"], "answers": [{"tags": [], "owner": {"reputation": 447, "user_id": 1857902, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LQu1E.jpg?s=128&g=1", "display_name": "Vinicius Souza", "link": "https://stackoverflow.com/users/1857902/vinicius-souza"}, "is_accepted": false, "score": 2, "last_activity_date": 1520451563, "creation_date": 1520451563, "answer_id": 49159973, "question_id": 49154799, "link": "https://stackoverflow.com/questions/49154799/consume-graphql-service-from-a-golang-app/49159973#49159973", "title": "Consume GraphQL service from a Golang app", "body": "<p>You should check this project: <a href=\"https://github.com/machinebox/graphql\" rel=\"nofollow noreferrer\">https://github.com/machinebox/graphql</a> .</p>\n\n<p>If you don't want to use an external library inside in your project, you could look the code and see how can you implement a simple client.</p>\n"}, {"tags": [], "owner": {"reputation": 2326, "user_id": 3342866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4883c189c00b8c4e9594be17581409e9?s=128&d=identicon&r=PG&f=1", "display_name": "Chids", "link": "https://stackoverflow.com/users/3342866/chids"}, "is_accepted": false, "score": 1, "last_activity_date": 1586070191, "creation_date": 1586070191, "answer_id": 61039132, "question_id": 49154799, "link": "https://stackoverflow.com/questions/49154799/consume-graphql-service-from-a-golang-app/61039132#61039132", "title": "Consume GraphQL service from a Golang app", "body": "<p>One of the module that I would recommend is <a href=\"https://github.com/shurcooL/graphql\" rel=\"nofollow noreferrer\">shurcool</a></p>\n\n<pre><code>client = graphql.NewClient(\"http://&lt;&lt;graphqlEndpoint&gt;&gt;\", nil)\n\nerr := client.Query(context.Background(), &amp;query, nil)\nif err != nil {\n    // Handle error.\n}\nfmt.Println(query.Me.Name)\n</code></pre>\n"}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 811, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1586070191, "creation_date": 1520434373, "question_id": 49154799, "link": "https://stackoverflow.com/questions/49154799/consume-graphql-service-from-a-golang-app", "title": "Consume GraphQL service from a Golang app", "body": "<p>I have a Go Application that needs to consume a GraphQL service, now the documentation of graphQL is more oriented to the GraphQL server and not as a client. How can I do that? </p>\n\n<p>I checked <a href=\"https://github.com/graphql-go/graphql/blob/master/examples/hello-world/main.go\" rel=\"nofollow noreferrer\">this example</a> but some things are not clear to me: </p>\n\n<ul>\n<li>Should I have a Resolve function to each field that I am going to retrieve?</li>\n<li>Should I  have defined the variable 'fields' with the data structure that I am expecting?</li>\n<li>Where can I find a very simple example of a GraphQL client in Golang?</li>\n</ul>\n"}, {"tags": ["go", "web-crawler"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 6, "creation_date": 1520427420, "post_id": 49152461, "comment_id": 85309250, "body": "You are &quot;endlessly&quot; spawning goroutines (sleep is only 0.1 seconds). You are also using <code>in</code> concurrently without synchronization, and all your <code>readLine()</code> functions read from the same file, unsynchronized. And you don&#39;t check the error opening the file. Nothing good can come out of this."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 6, "creation_date": 1520427441, "post_id": 49152461, "comment_id": 85309268, "body": "Your code is full of bugs. The most disasterous one is the effective forkbomb. You&#39;re starting an infinite number of goroutines that read in your domains."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1520427715, "post_id": 49152461, "comment_id": 85309469, "body": "If you want to reuse connections, you need to read the response bodies. If you don\u2019t need to reuse connections, you should close them to free up resources sooner."}, {"owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "edited": false, "score": 0, "creation_date": 1520429244, "post_id": 49152461, "comment_id": 85310523, "body": "I can spawn goroutines slower, and the only thing that changes is that memory usage grows slower. It&#39;s still growing. Where is the leak?"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 1, "creation_date": 1520429975, "post_id": 49152461, "comment_id": 85311013, "body": "you need to manage the number of goroutines you spawn - see here <a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow noreferrer\">gobyexample.com/worker-pools</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1520430336, "post_id": 49152461, "comment_id": 85311244, "body": "For ideas, check <a href=\"https://stackoverflow.com/questions/38170852/is-this-an-idiomatic-worker-thread-pool-in-go/38172204#38172204\">Is this an idiomatic worker thread pool in Go?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "edited": false, "score": 0, "creation_date": 1520429672, "post_id": 49153165, "comment_id": 85310817, "body": "I&#39;m complaining about memory usage, you haven&#39;t addressed that one problem I seem to have. Like I said, even if I spawn slow, memory usage will grow a bit slower, but there&#39;s still a leak somewhere."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "edited": false, "score": 3, "creation_date": 1520429858, "post_id": 49153165, "comment_id": 85310940, "body": "@geraldog, this <i>is</i> your memory leak! Goroutines are not free, and you\u2019re runnng an ever increasing number of them."}, {"owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "edited": false, "score": 0, "creation_date": 1520430286, "post_id": 49153165, "comment_id": 85311209, "body": "But they should exit, shouldn&#39;t they? Unless the goroutines aren&#39;t exiting for some reason? The point is that code shouldn&#39;t load in memory if I&#39;m spawning slowly, but it does load in memory, so what gives? Why aren&#39;t the goroutines exiting?"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520430588, "post_id": 49153165, "comment_id": 85311425, "body": "I assume all of the above is not exactly as intended - how can you have expectations of memory usage if your program is behaving unpredictably - when you understand what your program is doing (and it makes sense) you can begin to make assumptions about memory consumption"}, {"owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "edited": false, "score": 0, "creation_date": 1520430749, "post_id": 49153165, "comment_id": 85311537, "body": "It&#39;s not behaving unpredictably, it works as intended despite @Flimzy good notes. It just loads in memory terribly."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "edited": false, "score": 0, "creation_date": 1520430778, "post_id": 49153165, "comment_id": 85311558, "body": "@geraldog: what do you mean by &quot;that code shouldn&#39;t load in memory&quot;? Each goroutine has a 2k stack, and your spawning 5000 per second. Even if the code worked correctly, there&#39;s no way you&#39;re crawling websites that quickly."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520430907, "post_id": 49153165, "comment_id": 85311624, "body": "spawning goroutines faster than closing them will consume all your memory - this is expected behaviour - this should not be your intended behaviour"}, {"owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520430938, "post_id": 49153165, "comment_id": 85311645, "body": "@JimB read that again: shouldn&#39;t load in memory IF I&#39;M SPAWNING SLOWLY, but it does load in memory etc."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520430999, "post_id": 49153165, "comment_id": 85311687, "body": "spawn 1 a month and report back after 5 iterations, i suspect memory usage will stabilise"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "edited": false, "score": 0, "creation_date": 1520431000, "post_id": 49153165, "comment_id": 85311688, "body": "@geraldog: I&#39;m not sure if you understand what the stack is, but each call to &quot;spawn&quot; a goroutine requires an additional 2k. Spawning slower means it grows slower of course, but that still requires more memory."}, {"owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "reply_to_user": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520431011, "post_id": 49153165, "comment_id": 85311695, "body": "@WebweaverD the problem persists if I spawn slowly, it just grows slowly."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520431100, "post_id": 49153165, "comment_id": 85311752, "body": "i was joking - the point is i would address some of the issues highlighted and retest, there is too much going on right now to properly evaluate, properly managed this process wont eat memory"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "edited": false, "score": 0, "creation_date": 1520431281, "post_id": 49153165, "comment_id": 85311895, "body": "@geraldog: If you want to see where the stack memory is being used, and where the goroutines are waiting, look at a stack trace. The fundamental issue here is that your concurrency model doesn&#39;t make sense. Instead of claiming that it should work, take a look at more reasonable patterns, like those suggested here: <a href=\"https://stackoverflow.com/questions/38170852/is-this-an-idiomatic-worker-thread-pool-in-go/38172204#38172204\" title=\"is this an idiomatic worker thread pool in go\">stackoverflow.com/questions/38170852/&hellip;</a>"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520431482, "post_id": 49153165, "comment_id": 85312032, "body": "it doesnt make sense to spawn worker processes at a fixed interval if you have no idea how long they will take to run - thats the fundamental flaw in your approach, you need to limit the number of process that are crawling - once you have that you can look at other sources of memory use"}, {"owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "reply_to_user": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520432053, "post_id": 49153165, "comment_id": 85312436, "body": "@WebweaverD That sounds reasonable,"}, {"owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "edited": false, "score": 0, "creation_date": 1520432471, "post_id": 49153165, "comment_id": 85312727, "body": "The problem was the lack of timeout in net Dial however. It wouldn&#39;t let the goroutines die."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1520433755, "post_id": 49153165, "comment_id": 85313584, "body": "I have updated my explanation to spell out the exact nature of the memory consumption problem."}, {"owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "edited": false, "score": 0, "creation_date": 1520435268, "post_id": 49153165, "comment_id": 85314687, "body": "@Flimzy that&#39;s not what was happening, but thanks for the help."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "edited": false, "score": 0, "creation_date": 1520435357, "post_id": 49153165, "comment_id": 85314752, "body": "@geraldog: Well, that&#39;s what the code you pasted will do. If that&#39;s not what&#39;s happening, then you&#39;re executing different code. If your list of URLs is long enough, it&#39;s possible that your program is crashing (or being killed) for other reasons, before it reaches that state."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 3, "last_activity_date": 1520434093, "last_edit_date": 1520434093, "creation_date": 1520429378, "answer_id": 49153165, "question_id": 49152461, "link": "https://stackoverflow.com/questions/49152461/crawling-in-golang-without-loading-in-memory/49153165#49153165", "title": "Crawling in Golang without loading in memory", "body": "<p>Let's consider what's wrong with your code, focusing on your <code>main()</code> function.</p>\n\n<pre><code>func main() {\n    domains := make(chan string, 500)\n</code></pre>\n\n<p>This is good. You create a buffered channel to handle the domain list input. No problem.</p>\n\n<pre><code>    inFile, _ := os.Open(\"F:\\\\PATH\\\\TO\\\\LIST_OF_URLS_SEPARATED_BY_NEWLINE.txt\")\n</code></pre>\n\n<p>You open the input file. You should never ignore errors, but we'll ignore that for now.</p>\n\n<pre><code>    in := bufio.NewReader(inFile)\n\n    for {\n</code></pre>\n\n<p>Here you start an infinite loop. Why?</p>\n\n<pre><code>        go readLine(in, domains)\n</code></pre>\n\n<p>Here you read up to the next 500 lines from the <code>in</code> file, passing them to the <code>domains</code> channel, but you do it in the background, which means the next line will execute before <code>readLine</code> has a chance to finish.</p>\n\n<pre><code>        for i := 0; i &lt; 500; i++ { go get(domains) }\n</code></pre>\n\n<p>Here you call <code>get(domains)</code> 500 times, in parallel. But as explained above, you do this before <code>readLine</code> has completed, so (at least on the first time through the outer loop), most calls to <code>get()</code> will fail, because the <code>domains</code> channel is likely empty.  The <code>get()</code> function doesn't handle this case properly, but I'll leave that for you to consider.</p>\n\n<pre><code>        time.Sleep(100000000)\n</code></pre>\n\n<p>Then you sleep for 0.1 seconds before starting the infinite loop again.</p>\n\n<pre><code>    }\n}\n</code></pre>\n\n<p>The infinite loop will then attempt, again, to read the next 500 items from your file, again, in the background.  If the first call to <code>readLine</code> takes more than 0.1 seconds to complete, then you'll have two copies of <code>readLine</code> simultaneously trying to read the file, which will probably cause a panic.</p>\n\n<p>Assuming this is behaving as you expect (although it most certainly and obviously is not), after reading in all the URLs in the file, <strong>the program will continue, forever, to spawn an additional 501 go routines every 0.1 seconds.</strong>  One go routine attempts to read more lines from the file, finds that there are no more, and exits immediately. The other 500 go routines will end up waiting, forever, to read a non-existant result from the <code>domains</code> channel. This is your memory \"leak\".</p>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520433526, "post_id": 49154381, "comment_id": 85313430, "body": "I doubt that is really the problem, as the <a href=\"https://golang.org/pkg/net/http/#DefaultTransport\" rel=\"nofollow noreferrer\"><code>DefaultTransport</code></a> already has Dial timeouts set. This also hints that this code is in your <code>get</code> goroutine, but you should <i>never</i> discard an http.Transport, as that is also going to cause memory leaks."}, {"owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520433835, "post_id": 49154381, "comment_id": 85313638, "body": "<a href=\"https://medium.com/@nate510/don-t-use-go-s-default-http-client-4804cb19f779\" rel=\"nofollow noreferrer\">medium.com/@nate510/&hellip;</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1520434161, "post_id": 49154381, "comment_id": 85313863, "body": "Yes, I&#39;ve read that too, except the point of the article was to set the <code>Client.Timeout</code>, which you&#39;re not doing. <code>ResponseHeaderTimeout</code> partially covers the situation, but still doesn&#39;t abort slow/stalled responses. Setting the client timeout or using requests with a cancellation context will prevent any request situation from hanging indefinitely."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1520434253, "post_id": 49154381, "comment_id": 85313920, "body": "Setting a timeout won&#39;t fix the problem of your goroutines waiting forever for more input on the <code>domains</code> channel after the file has been completely read. <code>url := &lt;-domains</code> is where your program will be hung, for all of eternity."}, {"owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "edited": false, "score": 0, "creation_date": 1520434424, "post_id": 49154381, "comment_id": 85314031, "body": "Right, but see <a href=\"https://stackoverflow.com/questions/19696448/default-http-dial-timeout-value-in-golang\" title=\"default http dial timeout value in golang\">stackoverflow.com/questions/19696448/&hellip;</a>"}, {"owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1520434495, "post_id": 49154381, "comment_id": 85314081, "body": "@Flimzy that was a quick and dirty example just to demonstrate the problem, but thanks. I have pretty big files though..."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1520434667, "post_id": 49154381, "comment_id": 85314210, "body": "@geraldog: The HTTP timeout may well be a bug, and adjusting it may help, but it won&#39;t solve your biggest problem."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520434765, "post_id": 49154381, "comment_id": 85314291, "body": "@geraldog: I&#39;m not sure why you&#39;re referencing that old SO question, but I did link to the current <code>DefaultTransport</code> documentation, which shows exactly what timeouts are set and used by default."}, {"owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520435408, "post_id": 49154381, "comment_id": 85314799, "body": "Right, @JimB. Not sure why this works, then..."}], "tags": [], "owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "is_accepted": false, "score": -3, "last_activity_date": 1520433107, "creation_date": 1520433107, "answer_id": 49154381, "question_id": 49152461, "link": "https://stackoverflow.com/questions/49152461/crawling-in-golang-without-loading-in-memory/49154381#49154381", "title": "Crawling in Golang without loading in memory", "body": "<p>The problem was the lack of a default timeout in golang net Dial. It would hog resources by not letting goroutines die. The following Works:</p>\n\n<pre><code>c := &amp;http.Client{\n Transport: &amp;http.Transport{\n     DisableKeepAlives: true,\n     Dial: (&amp;net.Dialer{\n             Timeout:   30 * time.Second,\n             KeepAlive: 30 * time.Second,\n     }).Dial,\n     TLSHandshakeTimeout:   10 * time.Second,\n     ResponseHeaderTimeout: 10 * time.Second,\n     ExpectContinueTimeout: 1 * time.Second,}}\n\nURLresp, err := c.Get(url)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9445477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4efb719e50a0dfd8eeeac2e46976ff1e?s=128&d=identicon&r=PG&f=1", "display_name": "geraldog", "link": "https://stackoverflow.com/users/9445477/geraldog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "closed_date": 1520481663, "answer_count": 2, "score": -7, "last_activity_date": 1520434093, "creation_date": 1520427175, "last_edit_date": 1520428369, "question_id": 49152461, "link": "https://stackoverflow.com/questions/49152461/crawling-in-golang-without-loading-in-memory", "closed_reason": "Needs details or clarity", "title": "Crawling in Golang without loading in memory", "body": "<p>I'm trying to rewrite a web crawler in go (originally written in python with gevent). But I've hit a wall, no matter what I do I get fast high memory consumption. For example, the following simple code:</p>\n\n<pre><code>package main\n\nimport (\n     \"bufio\"\n     \"fmt\"\n     \"os\"\n     \"net/http\"\n     \"io\"\n     \"strings\"\n     \"time\"\n)\n\nfunc readLine(in *bufio.Reader, domains chan&lt;- string) {\n    for conc := 0; conc &lt; 500; conc++ {\n        input, err := in.ReadString('\\n')\n        if err == io.EOF {\n            break\n        }\n        if err != nil {\n            fmt.Fprintf(os.Stderr, \"read(stdin): %s\\n\", err)\n            os.Exit(1)\n        }\n\n        input = strings.TrimSpace(input)\n        if input == \"\" {\n            continue\n        }\n\n        domain := input\n        domains &lt;- domain\n    }\n}\n\nfunc get(domains &lt;-chan string) {\n   url := &lt;-domains\n   URLresp, err := http.Get(url)\n   if err != nil {\n       fmt.Println(err)\n   }\n   if err == nil {\n       fmt.Println(url,\" OK\")\n       URLresp.Body.Close()\n   }\n}\n\nfunc main() {\n    domains := make(chan string, 500)\n\n    inFile, _ := os.Open(\"F:\\\\PATH\\\\TO\\\\LIST_OF_URLS_SEPARATED_BY_NEWLINE.txt\")\n    in := bufio.NewReader(inFile)\n\n    for {\n        go readLine(in, domains)\n        for i := 0; i &lt; 500; i++ { go get(domains) }\n        time.Sleep(100000000)\n    }\n}\n</code></pre>\n\n<p>I've tried pprof but it seems to say I'm using 50mb of heap space only, while memory consumption by resource monitoring is skyrocketing.</p>\n\n<p>I also tried creating a custom http Transport without Keep Alive since I found out net/http saves connections for reuse but no luck with that.</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1520426248, "post_id": 49151893, "comment_id": 85308437, "body": "all you want is to create zero value item of a struct is it ?"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1520426520, "post_id": 49151893, "comment_id": 85308599, "body": "not quite, if you look at the code I have that bit, its reassigning it to that interface as well - title edited to clarify"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1520426811, "post_id": 49151893, "comment_id": 85308799, "body": "Please chkeck the answer"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1520426950, "post_id": 49151893, "comment_id": 85308904, "body": "Thanks Sarath, comment on asnswer"}], "answers": [{"comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520426830, "post_id": 49152286, "comment_id": 85308813, "body": "Thanks, This is really close but it doesnt work when the interface is a pointer to a struct (that is my case), it just nils the pointer"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520427332, "post_id": 49152286, "comment_id": 85309175, "body": "closer but still not quite right - that returns an interface to a value, i need an interface to a pointer to that value - I hope that makes sense - thanks for all your help..."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520428676, "post_id": 49152286, "comment_id": 85310139, "body": "I dont see how - I cant call Addr on a non pointer (newly created value) and I I dont see how to reassign it to the new zeroed value - gold star for you sir if you can provide an example - perhaps I can reassign the pointer through the unsafe package?"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520429543, "post_id": 49152286, "comment_id": 85310736, "body": "Superstar - is seems reflect.New was what I was missing to instantiate that value and get a pointer - thank you so much"}], "tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": true, "score": 3, "last_activity_date": 1520428915, "last_edit_date": 1520428915, "creation_date": 1520426681, "answer_id": 49152286, "question_id": 49151893, "link": "https://stackoverflow.com/questions/49151893/zero-a-struct-via-reflection-dont-know-underlying-type-and-reassign-pointer-t/49152286#49152286", "title": "zero a *struct via reflection (dont know underlying type) and reassign pointer to interface", "body": "<p>You may use <code>reflect.Zero</code> or <code>reflect.New</code> please check the code snippet below for clarity</p>\n\n<p>Here is how you may use it</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype A struct {\n    B int\n}\n\nfunc reset(p interface{}) interface{} {\n    var isPtr bool\n    v := reflect.ValueOf(p)\n    for v.Kind() == reflect.Ptr {\n        isPtr = true\n        v = v.Elem()\n    }\n    if isPtr {\n        return reflect.New(v.Type()).Interface()\n\n    }\n\n    return reflect.Zero(v.Type()).Interface()\n\n}\n\nfunc main() {\n    p := A{1}\n    fmt.Printf(\"Original : %+v,Pointer : %+v,Value : %+v\", p, reset(&amp;p), reset(p))\n}\n</code></pre>\n\n<p>Play : <a href=\"https://play.golang.com/p/8CJHHBL6c2p\" rel=\"nofollow noreferrer\">https://play.golang.com/p/8CJHHBL6c2p</a></p>\n"}], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 435, "favorite_count": 2, "accepted_answer_id": 49152286, "answer_count": 1, "score": 1, "last_activity_date": 1520428915, "creation_date": 1520425424, "last_edit_date": 1520427702, "question_id": 49151893, "link": "https://stackoverflow.com/questions/49151893/zero-a-struct-via-reflection-dont-know-underlying-type-and-reassign-pointer-t", "title": "zero a *struct via reflection (dont know underlying type) and reassign pointer to interface", "body": "<p><strong>Background</strong></p>\n\n<p>I'm building a wrapper package which combines defined commands and allows them to be executed in either a cli or interactive shell context. Commands are defined in a struct something like this (relevant fields shown):</p>\n\n<pre><code>type Handler func(c *Command) error\n\ntype Command struct {\n    RequestHandler     Handler\n    ResponseHandler    Handler\n    Request            interface{} //pointer to struct\n    Response           interface{} //pointer to struct\n}\n</code></pre>\n\n<p>The underlying Request/Response objects are always pointers to structs so I make use of reflection quite heavily to recursively iterate through the underlying structs fields to present their fields as either flags or prompts based on the calling context (shell/cli). I then populate the request object using reflection based on the users input.</p>\n\n<p>So far, so good...</p>\n\n<p><strong>Issue</strong></p>\n\n<p>When I am in an interactive shell context a command may be called and I populate the request struct and its values - all good. However, if the command is called again the request is still populated (and the response may be too) so I am looking to implement a 'reset' method on the command which can be called internally when a command is called from the shell.</p>\n\n<p>Now as I say i can guarantee the request and response are both pointers to structs. but how can I set them back to their respective initialised nil values when all I have is an interface and no advanced knowledge of the underlying type ((and internal fields may be struct values).</p>\n\n<p><strong>Possible Approaches</strong></p>\n\n<ol>\n<li><p>add a second copy of the underlying request/response object at command registration (prior to population) and then copy it across on reset</p></li>\n<li><p>just create a generic reset struct function that acts on any interface to an underlying struct pointer</p></li>\n<li><p>some method Im unaware of which does this for me</p></li>\n</ol>\n\n<p>I've tried both and I'm struggling to implement either</p>\n\n<p><strong>approach 1:</strong></p>\n\n<pre><code>type Command struct {\n    RequestHandler     Handler\n    ResponseHandler    Handler\n    zeroRequest        interface{}\n    zeroResponse       interface{}\n    Request            interface{} //pointer to struct\n    Response           interface{} //pointer to struct\n}\n\nfunc (c *Command) register() error {\n    // validate is pointer\n    reqPtrVal := reflect.ValueOf(c.Request)\n    if reqPtrVal.Kind() != reflect.Ptr {\n        return ErrStructPtrExpected\n    }\n\n    // reflect the underlying value and validate is struct\n    reqVal := reflect.Indirect(reqPtrVal)\n    if reqVal.Kind() != reflect.Struct {\n        return ErrStructPtrExpected\n    }\n\n    c.zeroRequest = reqVal.Interface()\n\n    // other logic... \n}\n\nfunc (c *Command) handleShell(sc *ishell.Context) {\n    // reset request / response objects\n\n    // reflect the underlying zero value and validate is struct\n    reqVal := reflect.ValueOf(c.zeroRequest)\n    if reqVal.Kind() != reflect.Struct {\n        c.Commander.HandleError(ErrStructPtrExpected)\n    }\n\n    newRequest := reflect.New(reqVal.Type())\n\n    // unfortunately below doesn't work as newRequest.CanAddr() == false\n    c.zeroRequest = newRequest.Addr().Interface()\n\n    // other logic\n}\n</code></pre>\n\n<p><strong>approach 2:</strong>\nThis feels a little cleaner (no zero value copies/ less code), but I can't even get this approach to compile:</p>\n\n<pre><code>func (c *Command) resetStruct(structPtr interface{}) error {\n    // validate is pointer\n    ptrVal := reflect.ValueOf(structPtr)\n    if ptrVal.Kind() != reflect.Ptr {\n        return ErrStructPtrExpected\n    }\n\n    // reflect the underlying value and validate is struct\n    val := reflect.Indirect(ptrVal)\n    if val.Kind() != reflect.Struct {\n        return ErrStructPtrExpected\n    }\n\n    // create a new val from the underlying type and reassign the pointer\n    newVal := reflect.New(val.Type())\n    ptrVal.SetPointer(newVal.Addr())\n    return nil\n}\n</code></pre>\n\n<p><strong>Summary</strong></p>\n\n<p>The ultimate goal is to zero this struct of unknown type via reflection and reassign the pointer back to the request interface. preferred order of approach is 3,2,1 - but anything that works would be just dandy.</p>\n\n<p>It seems that I could solve this is if I could create a concrete type from a reflect.Type, but perhaps there is another approach here</p>\n"}, {"tags": ["mongodb", "go", "event-handling", "mgo", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 2, "creation_date": 1520425072, "post_id": 49151612, "comment_id": 85307691, "body": "Great answer, notable suggestion. Thanks!"}, {"owner": {"reputation": 2153, "user_id": 2667212, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/rKmdj.jpg?s=128&g=1", "display_name": "Hoang Trinh", "link": "https://stackoverflow.com/users/2667212/hoang-trinh"}, "edited": false, "score": 0, "creation_date": 1552992644, "post_id": 49151612, "comment_id": 97211141, "body": "@icza: This might be a noob question but I came from Node.js, how to obtain collection?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2153, "user_id": 2667212, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/rKmdj.jpg?s=128&g=1", "display_name": "Hoang Trinh", "link": "https://stackoverflow.com/users/2667212/hoang-trinh"}, "edited": false, "score": 1, "creation_date": 1552993523, "post_id": 49151612, "comment_id": 97211663, "body": "@piavgh It depends on the driver. In <code>mgo</code>, use <a href=\"https://godoc.org/github.com/globalsign/mgo#Database.C\" rel=\"nofollow noreferrer\"><code>Database.C()</code></a>. In <code>mongo-go</code>, use <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo#Database.Collection\" rel=\"nofollow noreferrer\"><code>Database.Collection()</code></a>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 17, "last_activity_date": 1520426148, "last_edit_date": 1520426148, "creation_date": 1520424584, "answer_id": 49151612, "question_id": 49151104, "link": "https://stackoverflow.com/questions/49151104/watch-for-mongodb-change-streams/49151612#49151612", "title": "Watch for MongoDB Change Streams", "body": "<p>The popular <code>mgo</code> driver (<a href=\"https://github.com/go-mgo/mgo\" rel=\"noreferrer\"><code>github.com/go-mgo/mgo</code></a>) developed by Gustavo Niemeyer has gone dark (unmaintained). And it has no support for change streams.</p>\n\n<p>The community supported fork <a href=\"https://github.com/globalsign/mgo\" rel=\"noreferrer\"><code>github.com/globalsign/mgo</code></a> is in much better shape, and has already added support for change streams (see <a href=\"https://github.com/globalsign/mgo/pull/97\" rel=\"noreferrer\">details here</a>).</p>\n\n<p>To watch changes of a collection, simply use the <a href=\"https://godoc.org/github.com/globalsign/mgo#Collection.Watch\" rel=\"noreferrer\"><code>Collection.Watch()</code></a> method which returns you a value of <a href=\"https://godoc.org/github.com/globalsign/mgo#ChangeStream\" rel=\"noreferrer\"><code>mgo.ChangeStream</code></a>. Here's a simple example using it:</p>\n\n<pre><code>coll := ... // Obtain collection\n\npipeline := []bson.M{}\n\nchangeStream := coll.Watch(pipeline, mgo.ChangeStreamOptions{})\nvar changeDoc bson.M\nfor changeStream.Next(&amp;changeDoc) {\n    fmt.Printf(\"Change: %v\\n\", changeDoc)\n}\n\nif err := changeStream.Close(); err != nil {\n    return err\n}\n</code></pre>\n\n<hr>\n\n<p>Also note that there is an <strong>official</strong> MongoDB Go driver under development, it was announced here: <a href=\"https://engineering.mongodb.com/post/considering-the-community-effects-of-introducing-an-official-golang-mongodb-driver\" rel=\"noreferrer\">Considering the Community Effects of Introducing an Official MongoDB Go Driver</a></p>\n\n<p>It is currently in <strong>alpha (!!)</strong> phase, so take this into consideration. It is available here: <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"noreferrer\"><code>github.com/mongodb/mongo-go-driver</code></a>. It also already has support for change streams, similarly via the <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo#Collection.Watch\" rel=\"noreferrer\"><code>Collection.Watch()</code></a> method (this is a different <code>mongo.Collection</code> type, it has nothing to do with <code>mgo.Collection</code>). It returns a <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo#Cursor\" rel=\"noreferrer\"><code>mongo.Cursor</code></a> which you may use like this:</p>\n\n<pre><code>var coll mongo.Collection = ... // Obtain collection\n\nctx := context.Background()\n\nvar pipeline interface{} // set up pipeline\n\ncur, err := coll.Watch(ctx, pipeline)\nif err != nil {\n    // Handle err\n    return\n}\ndefer cur.Close(ctx)\n\nfor cur.Next(ctx) {\n    elem := bson.NewDocument()\n    if err := cur.Decode(elem); err != nil {\n        log.Fatal(err)\n    }\n\n    // do something with elem....\n}\n\nif err := cur.Err(); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user12207064"}, "edited": false, "score": 0, "creation_date": 1589595943, "post_id": 58834937, "comment_id": 109364436, "body": "Are you using context.TODO() for documentation purposes?"}], "tags": [], "owner": {"reputation": 41, "user_id": 2889312, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R6y3U.jpg?s=128&g=1", "display_name": "Arsen", "link": "https://stackoverflow.com/users/2889312/arsen"}, "is_accepted": false, "score": 1, "last_activity_date": 1573640603, "creation_date": 1573640603, "answer_id": 58834937, "question_id": 49151104, "link": "https://stackoverflow.com/questions/49151104/watch-for-mongodb-change-streams/58834937#58834937", "title": "Watch for MongoDB Change Streams", "body": "<p>This example uses the <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">The MongoDB supported driver for Go</a> with stream pipeline (filtering only documents having field1=1 and field2=false):</p>\n\n<pre><code>    ctx := context.TODO()\n    clientOptions := options.Client().ApplyURI(mongoURI)\n    client, err := mongo.Connect(ctx, clientOptions)\n    if err != nil {\n        log.Fatal(err)\n    }\n    err = client.Ping(ctx, nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(\"Connected!\")\n\n    collection := client.Database(\"test\").Collection(\"test\")\n\n    pipeline := mongo.Pipeline{bson.D{\n        {\"$match\",\n            bson.D{\n                {\"fullDocument.field1\", 1},\n                {\"fullDocument.field2\", false},\n            },\n        },\n    }}\n    streamOptions := options.ChangeStream().SetFullDocument(options.UpdateLookup)\n\n    stream, err := collection.Watch(ctx, pipeline, streamOptions)\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Print(\"waiting for changes\")\n    var changeDoc map[string]interface{}\n    for stream.Next(ctx) {\n        if e := stream.Decode(&amp;changeDoc); e != nil {\n            log.Printf(\"error decoding: %s\", e)\n        }\n        log.Printf(\"change: %+v\", changeDoc)\n    }\n</code></pre>\n"}], "owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6099, "favorite_count": 1, "accepted_answer_id": 49151612, "answer_count": 2, "score": 3, "last_activity_date": 1573640603, "creation_date": 1520423018, "last_edit_date": 1522923510, "question_id": 49151104, "link": "https://stackoverflow.com/questions/49151104/watch-for-mongodb-change-streams", "title": "Watch for MongoDB Change Streams", "body": "<p>We want our Go application to listen to the data changes on a collection. So, googling in search for a solution, we came across MongoDB's <a href=\"https://docs.mongodb.com/v3.6/changeStreams/\" rel=\"nofollow noreferrer\">Change Streams</a>. That link also exhibits some implementation snippets for a bunch of languages such as Python, Java, Nodejs etc. Yet, there is no piece of code for Go. </p>\n\n<p>We are using <a href=\"https://godoc.org/labix.org/v2/mgo\" rel=\"nofollow noreferrer\">Mgo</a> as a driver but could not find explicit statements on <em>change streams</em>.</p>\n\n<p>Does anyone have any idea on how to watch on Change Streams using that Mgo or any other Mongo driver for Go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 2, "creation_date": 1520420640, "post_id": 49150316, "comment_id": 85304891, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/20895552/how-to-read-input-from-console-line\">How to read input from console line?</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1520420712, "post_id": 49150316, "comment_id": 85304938, "body": "If you need to detect incomplete lines (aka chars or keypresses), you need a 3rd party lib like <a href=\"https://github.com/nsf/termbox-go\" rel=\"nofollow noreferrer\">termbox-go</a>."}, {"owner": {"reputation": 21, "user_id": 8677110, "user_type": "registered", "profile_image": "https://graph.facebook.com/10212467030222192/picture?type=large", "display_name": "Blanco Verde", "link": "https://stackoverflow.com/users/8677110/blanco-verde"}, "reply_to_user": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 1, "creation_date": 1520421136, "post_id": 49150316, "comment_id": 85305205, "body": "@Vardius I don&#39;t want to read stdin and wait the user press &quot;enter&quot;. I want to print text in while loop and pause the process when a user start to write some text"}, {"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1520424063, "post_id": 49150316, "comment_id": 85306983, "body": "@BlancoVerde what is stoping you from using <a href=\"https://stackoverflow.com/a/28311177/2160958\">this answer</a> ? Just implement a missing part, half job done already"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1520432191, "post_id": 49150316, "comment_id": 85312525, "body": "I&#39;m with @icza on this; to expand on his answer, on Unix-like systems, one should have the terminal&#39;s <i>line discipline</i> set to the so-called &quot;raw&quot; mode to have all keypressed be passed to the application ASAP and (almost) uninterpreted (read <a href=\"http://www.linusakesson.net/programming/tty/\" rel=\"nofollow noreferrer\">this classic gem</a> for more info). Using appropriate terminal-abstraction library is a way to go here. On Windows, things are different but <code>termbox-go</code> abstracts them away presenting the same interface ascross all supported platforms; hence, recommended."}], "answers": [{"tags": [], "owner": {"reputation": 496, "user_id": 8367711, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9Hu81.png?s=128&g=1", "display_name": "KEINOS", "link": "https://stackoverflow.com/users/8367711/keinos"}, "is_accepted": false, "score": 0, "last_activity_date": 1615808762, "creation_date": 1615808762, "answer_id": 66637378, "question_id": 49150316, "link": "https://stackoverflow.com/questions/49150316/how-to-detect-key-press-event/66637378#66637378", "title": "How to detect key press event", "body": "<p>Don't know if it will answer your question but <strong>for those who want to determine a single keypress, without the <code>enter</code> key</strong>, like below:</p>\n<pre><code>$ go run . &lt;enter&gt;\nKey press =&gt; a\nKey press =&gt; b\nKey press =&gt; c\nKey press =&gt; d\nKey press =&gt; e\n... (ctrl+c)\nsignal: interrupt\n</code></pre>\n<p>The module <code>github.com/mattn/go-tty</code> by <a href=\"https://github.com/mattn/\" rel=\"nofollow noreferrer\">mattn</a> might help.</p>\n<ul>\n<li><a href=\"https://github.com/mattn/go-tty\" rel=\"nofollow noreferrer\">https://github.com/mattn/go-tty</a> by mattn @ GitHub</li>\n</ul>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;log&quot;\n\n    &quot;github.com/mattn/go-tty&quot;\n)\n\nfunc main() {\n    tty, err := tty.Open()\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer tty.Close()\n\n    for {\n        r, err := tty.ReadRune()\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Println(&quot;Key press =&gt; &quot; + string(r))\n    }\n}\n</code></pre>\n<pre class=\"lang-golang prettyprint-override\"><code>// go.mod\nmodule sample/tty\n\ngo 1.16\n\nrequire github.com/mattn/go-tty v0.0.3 // indirect\n</code></pre>\n<ul>\n<li>Tested on:\n<ul>\n<li>Intel Core i5, 2.7 GHz Dual-Core</li>\n<li>macOS Catalina 10.15.7, Debian GNU/Linux 10 (buster), Alpine Linux v3.13</li>\n</ul>\n</li>\n</ul>\n"}], "owner": {"reputation": 21, "user_id": 8677110, "user_type": "registered", "profile_image": "https://graph.facebook.com/10212467030222192/picture?type=large", "display_name": "Blanco Verde", "link": "https://stackoverflow.com/users/8677110/blanco-verde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 6890, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1615808762, "creation_date": 1520420518, "last_edit_date": 1613393455, "question_id": 49150316, "link": "https://stackoverflow.com/questions/49150316/how-to-detect-key-press-event", "title": "How to detect key press event", "body": "<p>My purpose is to print string sequentially and when the user enter some character, we pause the process and read stdin content. I know it's possible to catch os.Interrupt signal but I don't how to catch event in stdin.\nI don't want to scan and wait user to enter text. The process is stopped when there is a keypress event.</p>\n<p>My question: How detect event on stdin?</p>\n<p>Here is current solution with your advice. Go routines not constitue an optimal solution because you can't manage them as threads. I currently continue working on this and keep you udpated.</p>\n<pre><code>func main() {\n    quit := make(chan bool)\n\n    scanner := bufio.NewScanner(os.Stdin)\n    for scanner.Scan() {\n        fmt.Println(scanner.Text())\n        fmt.Println(&quot;-----------------&quot;)\n        fmt.Println(&quot;Go routine running :&quot;, runtime.NumGoroutine())\n        go func() {\n             select {\n                case &lt;-quit:\n                return\n             default:\n                fmt.Println(&quot;Text received and changed&quot;)\n                fmt.Println(&quot;-----------------&quot;)\n                for {\n                    timer := time.NewTimer(time.Second * 1)\n                    &lt;-timer.C\n                    fmt.Println(scanner.Text())\n                }\n            }\n\n            fmt.Println(&quot;Routine closed&quot;)\n        }()\n\n    }\n    if scanner.Err() != nil {\n        quit &lt;- false\n    }\n}\n</code></pre>\n<p>Otherwise if I follow your solution @varius :</p>\n<pre><code>func main() {\nscanner := bufio.NewScanner(os.Stdin)\nfor scanner.Scan() {\n    for {\n        timer := time.NewTimer(time.Second * 1)\n        &lt;-timer.C\n        fmt.Println(scanner.Text())\n    }\n}\nif scanner.Err() != nil {\n /*handle error*/\n}\n}\n</code></pre>\n<p>But I can't change the scan content while program running.</p>\n"}, {"tags": ["go", "go-cobra", "cobra"], "answers": [{"tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": true, "score": 24, "last_activity_date": 1520431228, "creation_date": 1520431228, "answer_id": 49153754, "question_id": 49148992, "link": "https://stackoverflow.com/questions/49148992/cobra-subcommand-invoke-help-by-default/49153754#49153754", "title": "Cobra Subcommand Invoke Help By Default", "body": "<p>It is possible to do with checking of amount of passed arguments to your program. If there is more then <code>0</code> args you will do actual work, but if it less then you will just show the \"help\" for the command. </p>\n\n<pre><code>var addonCmd = &amp;cobra.Command{\n    Use:   \"addon\",\n    Short: \"Install addon packages\",\n    Long: `Install additional packages`,\n    Run: func(cmd *cobra.Command, args []string) {\n        if len(args) == 0 {\n            cmd.Help()\n            os.Exit(0)\n        }\n        // do actual work\n    },\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 91, "user_id": 6513756, "user_type": "registered", "profile_image": "https://graph.facebook.com/1234625596547746/picture?type=large", "display_name": "Hyun Seok Jeong", "link": "https://stackoverflow.com/users/6513756/hyun-seok-jeong"}, "edited": false, "score": 0, "creation_date": 1606470854, "post_id": 63856623, "comment_id": 114976472, "body": "This is not working. even it shows the cmd.Help(), after then Run: func() will start."}], "tags": [], "owner": {"reputation": 131, "user_id": 6582535, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/745f058165a82eb7ea8ba2b5bc73edcc?s=128&d=identicon&r=PG&f=1", "display_name": "Gulok", "link": "https://stackoverflow.com/users/6582535/gulok"}, "is_accepted": false, "score": 2, "last_activity_date": 1607060125, "last_edit_date": 1607060125, "creation_date": 1599882405, "answer_id": 63856623, "question_id": 49148992, "link": "https://stackoverflow.com/questions/49148992/cobra-subcommand-invoke-help-by-default/63856623#63856623", "title": "Cobra Subcommand Invoke Help By Default", "body": "<p>I think it is better to handle that on PreRunE.</p>\n<pre><code>var addonCmd = &amp;cobra.Command{\n    Use:   &quot;addon&quot;,\n    Short: &quot;Install addon packages&quot;,\n    Long: `Install additional packages`,\n    PreRunE: func(cmd *cobra.Command, args []string) error {\n        if len(args) == 0 {\n            cmd.Help()\n            os.Exit(0)\n        }\n        return nil\n    },\n    Run: func(cmd *cobra.Command, args []string) {\n        // do actual work\n    },\n}\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 8263829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2740fa423b15b7e479490165207b5a4e?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher", "link": "https://stackoverflow.com/users/8263829/christopher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4073, "favorite_count": 2, "accepted_answer_id": 49153754, "answer_count": 2, "score": 14, "last_activity_date": 1607060125, "creation_date": 1520416799, "last_edit_date": 1520497285, "question_id": 49148992, "link": "https://stackoverflow.com/questions/49148992/cobra-subcommand-invoke-help-by-default", "title": "Cobra Subcommand Invoke Help By Default", "body": "<p>I want sub command to print out the Help menu if no argument or flags is passed (The main command does this by default).</p>\n\n<p>For example, the main command without any arguments or flags:</p>\n\n<pre><code>chris@pop-os:~$ ./tk\nCommand line application to deploy\n\nUsage:\n  tk [command]\n\nAvailable Commands:\n  addon       Install packages\n  cluster     Used to create cloud infrastructures\n  help        Help about any command\n\nFlags:\n      --config string   config file (default is $HOME/.tk8.yaml)\n  -h, --help            help for tk\n  -t, --toggle          Help message for toggle\n\nUse \"tk [command] --help\" for more information about a command.\n</code></pre>\n\n<p>I want subcommand like \"tk addon\" to also return it's own help menu if no arguments or flags is entered, currently it only gives a blank line.</p>\n\n<p>addon code :</p>\n\n<pre><code>var addonCmd = &amp;cobra.Command{\n    Use:   \"addon\",\nShort: \"Install addon packages\",\nLong: `Install additional packages`,\nRun: func(cmd *cobra.Command, args []string) {\n\n        }\n    },\n}\n</code></pre>\n"}, {"tags": ["go", "tensorflow"], "comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 1, "creation_date": 1520432712, "post_id": 49148831, "comment_id": 85312871, "body": "yeh, i cant see any way of doing that - the workaround would be to store in go-bindata and write them to a temp directory either as need or on app init, then load the models from there - you could also try serialising the SavedModel structs themselves and reconstructing but it depends whats done as part of the load"}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 2563659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0472377cd49e17f26e964f9a3bbc56b?s=128&d=identicon&r=PG", "display_name": "JJChickpeaboy", "link": "https://stackoverflow.com/users/2563659/jjchickpeaboy"}, "edited": false, "score": 1, "creation_date": 1520589126, "post_id": 49149419, "comment_id": 85386830, "body": "You pointed me out in the right direction. I found this package that basically does what I want (<a href=\"https://github.com/glycerine/libzipfs\" rel=\"nofollow noreferrer\">github.com/glycerine/libzipfs</a>)."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 45, "user_id": 2563659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0472377cd49e17f26e964f9a3bbc56b?s=128&d=identicon&r=PG", "display_name": "JJChickpeaboy", "link": "https://stackoverflow.com/users/2563659/jjchickpeaboy"}, "edited": false, "score": 0, "creation_date": 1520590325, "post_id": 49149419, "comment_id": 85387611, "body": "Thanks for sharing!"}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 2, "last_activity_date": 1520417989, "creation_date": 1520417989, "answer_id": 49149419, "question_id": 49148831, "link": "https://stackoverflow.com/questions/49148831/include-full-directory-structure-not-individual-files-in-go-executable/49149419#49149419", "title": "Include full directory structure, not individual files, in Go executable", "body": "<p>Take a look at <a href=\"https://godoc.org/golang.org/x/tools/godoc/vfs\" rel=\"nofollow noreferrer\"><code>golang.org/x/tools/godoc/vfs</code></a> or, say,\n<a href=\"https://github.com/spf13/afero\" rel=\"nofollow noreferrer\"><code>github.com/spf13/afero</code></a>.</p>\n\n<p>Combined with <code>go-bindata</code> or any other package providing\nfor embedding of file <em>contents,</em> it could be used to abstract away\nfilesystem-like trees (directory hierarchies).</p>\n\n<hr>\n\n<p>Note that this approach presumes that \"tensorflow\" thing is able to\nuse such virtualization. If, instead, it insists on using a path\non a real filesystem, you'll need to work around this somehow.</p>\n\n<p>One approach is to embed an archive file into your executable,\nand then unpack it under a temporary directory during the program initialization phase.\nRead up on <a href=\"https://golang.org/pkg/io/ioutil/#TempDir\" rel=\"nofollow noreferrer\"><code>io/ioutil.TempDir</code></a>.</p>\n"}], "owner": {"reputation": 45, "user_id": 2563659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0472377cd49e17f26e964f9a3bbc56b?s=128&d=identicon&r=PG", "display_name": "JJChickpeaboy", "link": "https://stackoverflow.com/users/2563659/jjchickpeaboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 49149419, "answer_count": 1, "score": -1, "last_activity_date": 1520417989, "creation_date": 1520416341, "last_edit_date": 1520417695, "question_id": 49148831, "link": "https://stackoverflow.com/questions/49148831/include-full-directory-structure-not-individual-files-in-go-executable", "title": "Include full directory structure, not individual files, in Go executable", "body": "<p>I am trying to create an executable program with a trained tensorflow model. However, I have realised that the compiled Go script will need the model directory path as an argument. To avoid this I would like to include the model in the Go executable and compile them together. I have been looking at <code>go-bindata</code> but that doesn't work in this case because the function <code>tf.LoadSavedModel</code> takes a directory path to load the model, not the actual model files.</p>\n\n<p>Do you know how this could be done?</p>\n\n<p>EDIT:</p>\n\n<p><code>tf.LoadSavedModel</code> function (<a href=\"https://godoc.org/github.com/tensorflow/tensorflow/tensorflow/go#LoadSavedModel\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/tensorflow/tensorflow/tensorflow/go#LoadSavedModel</a>) needs the path of a directory to load a model. It is not able to process individual files, so thats why go-bindata (which is the solution of that question) doesn't work in this case. <code>tf.LoadSavedModel</code> uses a function in <code>C</code> to load files in a directory, so the files cannot be provided directly to Go. I hope that I explained it correctly</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1520417024, "post_id": 49148521, "comment_id": 85302492, "body": "What you want to do is <i>impossible</i> in Go: You have to redesign."}, {"owner": {"reputation": 1562, "user_id": 4303758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/nbL0i.jpg?s=128&g=1", "display_name": "Manjeet Thakur", "link": "https://stackoverflow.com/users/4303758/manjeet-thakur"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1520417080, "post_id": 49148521, "comment_id": 85302526, "body": "@Volker Can you please help me in that how to design?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520417518, "post_id": 49148521, "comment_id": 85302794, "body": "All you can do is use variadic function to take any number of arguments.@Volker is correct"}, {"owner": {"reputation": 1562, "user_id": 4303758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/nbL0i.jpg?s=128&g=1", "display_name": "Manjeet Thakur", "link": "https://stackoverflow.com/users/4303758/manjeet-thakur"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520417576, "post_id": 49148521, "comment_id": 85302825, "body": "Thank you @Himanshu I am trying this also"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1520418238, "post_id": 49148521, "comment_id": 85303252, "body": "You must come up with a single function type which allows all the use cases. Variadic functions are one solution. Functions taking an interface argument might be an other."}, {"owner": {"reputation": 1562, "user_id": 4303758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/nbL0i.jpg?s=128&g=1", "display_name": "Manjeet Thakur", "link": "https://stackoverflow.com/users/4303758/manjeet-thakur"}, "edited": false, "score": 0, "creation_date": 1520418293, "post_id": 49148521, "comment_id": 85303296, "body": "I am trying to do this with <code>interface{}</code> this is right approach"}], "answers": [{"comments": [{"owner": {"reputation": 1562, "user_id": 4303758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/nbL0i.jpg?s=128&g=1", "display_name": "Manjeet Thakur", "link": "https://stackoverflow.com/users/4303758/manjeet-thakur"}, "edited": false, "score": 0, "creation_date": 1520416146, "post_id": 49148643, "comment_id": 85301909, "body": "No I can&#39;t do this because then i need to check inside foo function that how many arguments are coming"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 1562, "user_id": 4303758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/nbL0i.jpg?s=128&g=1", "display_name": "Manjeet Thakur", "link": "https://stackoverflow.com/users/4303758/manjeet-thakur"}, "edited": false, "score": 0, "creation_date": 1520416378, "post_id": 49148643, "comment_id": 85302054, "body": "you can do that by checking on struct rather than on every function"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 4, "last_activity_date": 1520529100, "last_edit_date": 1520529100, "creation_date": 1520415776, "answer_id": 49148643, "question_id": 49148521, "link": "https://stackoverflow.com/questions/49148521/how-to-pass-dynamic-argument-in-function/49148643#49148643", "title": "how to pass dynamic argument in function", "body": "<p>Create a variadic function which will take any number of arguments as parameters on passing it to function. </p>\n\n<pre><code> func foo(nums ...string) {}\n\n m:= map[string]fn{\n     \"a\": \"foo\",\n     \"b\": \"bar\"\n }\n</code></pre>\n\n<p>For more on variadic functions check this <a href=\"https://stackoverflow.com/questions/48849493/go-variadic-function-argument-passing/48849643#48849643\">Answer</a></p>\n"}, {"tags": [], "owner": {"reputation": 1562, "user_id": 4303758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/nbL0i.jpg?s=128&g=1", "display_name": "Manjeet Thakur", "link": "https://stackoverflow.com/users/4303758/manjeet-thakur"}, "is_accepted": true, "score": 1, "last_activity_date": 1520454992, "last_edit_date": 1520454992, "creation_date": 1520427805, "answer_id": 49152671, "question_id": 49148521, "link": "https://stackoverflow.com/questions/49148521/how-to-pass-dynamic-argument-in-function/49152671#49152671", "title": "how to pass dynamic argument in function", "body": "<p>Solve using interface</p>\n\n<pre><code>m: = map[string]interface{} {\n     \"a\": \"foo\",\n     \"b\": \"bar\"\n }\n</code></pre>\n"}], "owner": {"reputation": 1562, "user_id": 4303758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/nbL0i.jpg?s=128&g=1", "display_name": "Manjeet Thakur", "link": "https://stackoverflow.com/users/4303758/manjeet-thakur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 519, "favorite_count": 0, "accepted_answer_id": 49152671, "answer_count": 2, "score": -2, "last_activity_date": 1520529100, "creation_date": 1520415396, "last_edit_date": 1520415879, "question_id": 49148521, "link": "https://stackoverflow.com/questions/49148521/how-to-pass-dynamic-argument-in-function", "title": "how to pass dynamic argument in function", "body": "<h1>What I am doing</h1>\n\n<pre><code> func foo(a string) {}\n\n func bar(b, c string)\n\n type fn func(string)\n\n m: = map[string] fn {\n     \"a\": \"foo\",\n     \"b\": \"bar\"\n }\n</code></pre>\n\n<h1>What is output</h1>\n\n<p>when I call function like this</p>\n\n<pre><code>  m[\"a\"](\"Hello\")\n  m[\"b\"](\"Hello\", \"World\")\n</code></pre>\n\n<p>I got an error because <code>type fn func(string)</code> here fn have single parameter but I pass double parameter in <code>m[\"b\"](\"Hello\", \"World\")</code> </p>\n\n<blockquote>\n  <p>Error : [ cannot use (type func(string, string)) as type fn in map\n  value ]</p>\n</blockquote>\n\n<h1>What I am looking for</h1>\n\n<p>I want to make dynamic <code>type fn func(string)</code> so that I can pass number of parameter so that I can call like this  </p>\n\n<pre><code>  m[\"a\"](\"Hello\")\n  m[\"b\"](\"Hello\", \"World\")\n</code></pre>\n"}, {"tags": ["arrays", "json", "go", "httpresponse"], "answers": [{"comments": [{"owner": {"reputation": 3745, "user_id": 5647272, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pHwEW.jpg?s=128&g=1", "display_name": "Umair Mohammad", "link": "https://stackoverflow.com/users/5647272/umair-mohammad"}, "reply_to_user": {"reputation": 115, "user_id": 5934641, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh4.googleusercontent.com/-bgyruX0W0b0/AAAAAAAAAAI/AAAAAAAAAKg/T8xvy_s57X0/photo.jpg?sz=128", "display_name": "siri", "link": "https://stackoverflow.com/users/5934641/siri"}, "edited": false, "score": 1, "creation_date": 1520416488, "post_id": 49148207, "comment_id": 85302139, "body": "You can accept this as solution/upvote <a href=\"https://stackoverflow.com/help/someone-answers\">stackoverflow.com/help/someone-answers</a>"}, {"owner": {"reputation": 115, "user_id": 5934641, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh4.googleusercontent.com/-bgyruX0W0b0/AAAAAAAAAAI/AAAAAAAAAKg/T8xvy_s57X0/photo.jpg?sz=128", "display_name": "siri", "link": "https://stackoverflow.com/users/5934641/siri"}, "edited": false, "score": 0, "creation_date": 1520416488, "post_id": 49148207, "comment_id": 85302141, "body": "Result := make(map[string]interface{}) i cant use this in the condition because the output struct is local to the above block, and it should be inside it , if not the value gets initiated and when i send another request to the same function and the query fails,  it shows the previous output @Umair"}, {"owner": {"reputation": 3745, "user_id": 5647272, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pHwEW.jpg?s=128&g=1", "display_name": "Umair Mohammad", "link": "https://stackoverflow.com/users/5647272/umair-mohammad"}, "reply_to_user": {"reputation": 115, "user_id": 5934641, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh4.googleusercontent.com/-bgyruX0W0b0/AAAAAAAAAAI/AAAAAAAAAKg/T8xvy_s57X0/photo.jpg?sz=128", "display_name": "siri", "link": "https://stackoverflow.com/users/5934641/siri"}, "edited": false, "score": 0, "creation_date": 1520416671, "post_id": 49148207, "comment_id": 85302268, "body": "Ok then try only putting append statement in if condition and without altering initialization statement"}], "tags": [], "owner": {"reputation": 3745, "user_id": 5647272, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pHwEW.jpg?s=128&g=1", "display_name": "Umair Mohammad", "link": "https://stackoverflow.com/users/5647272/umair-mohammad"}, "is_accepted": false, "score": 2, "last_activity_date": 1520414534, "creation_date": 1520414534, "answer_id": 49148207, "question_id": 49148138, "link": "https://stackoverflow.com/questions/49148138/empty-json-array-is-returned-when-the-row-doesnt-exists-in-db/49148207#49148207", "title": "empty json array is returned when the row doesn&#39;t exists in DB", "body": "<p>Trying checking the length of the <code>Result</code> array before appending it to output</p>\n\n<p>Something like this</p>\n\n<pre><code>if (len(Result) != 0) {\n    Response.Result = append(Response.Result, Result)\n}\n</code></pre>\n\n<p>Maybe you also need to write this also <code>Result := make(map[string]interface{})</code> inside the if condition, before the append statement</p>\n"}], "owner": {"reputation": 115, "user_id": 5934641, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh4.googleusercontent.com/-bgyruX0W0b0/AAAAAAAAAAI/AAAAAAAAAKg/T8xvy_s57X0/photo.jpg?sz=128", "display_name": "siri", "link": "https://stackoverflow.com/users/5934641/siri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1520419266, "creation_date": 1520414342, "last_edit_date": 1520419266, "question_id": 49148138, "link": "https://stackoverflow.com/questions/49148138/empty-json-array-is-returned-when-the-row-doesnt-exists-in-db", "title": "empty json array is returned when the row doesn&#39;t exists in DB", "body": "<p>my function receives a http request and sends back json string as http response. \nThis is my Code:</p>\n\n<pre><code>func homePage(res http.ResponseWriter, req *http.Request) {\n    type Resp struct {\n        Result []map[string]interface{} `json:\"result,omitempty\"`\n        Status string                   `json:\"status\"`\n    }\n    type Inputs struct {\n        ShopID   string `json:\"ShopID\"`\n        DeviceID string `json:\"DeviceID\"`\n        EmpID    string `json:\"EmpID\"`\n        Token    string `json:\"Token\"`\n        Version  string `json:\"Version\"`\n    }\n\n    var Response Resp\n    Response.Status = \"failed\"\n\n    db, err := sql.Open(\"mysql\", \"root:password@tcp(127.0.0.1:3306)/b2b\")\n\n    if err != nil {\n        panic(err.Error())\n    }\n    defer db.Close()\n\n    rnd := render.New()\n    b, err := ioutil.ReadAll(req.Body)\n    defer req.Body.Close()\n\n    if err != nil {\n        panic(err.Error())\n    }\n    // Unmarshal the request body\n    var msg Inputs\n    err = json.Unmarshal(b, &amp;msg)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    bookingrows, bookingerr := db.Query(\"SELECT DISTINCT b2b_booking_id,b2b_check_in_report,b2b_vehicle_at_garage,b2b_service_under_progress,b2b_vehicle_ready,b2b_vehicle_delivered FROM b2b_booking_tbl WHERE b2b_flag=0 and b2b_shop_id=?\", msg.ShopID)\n    if bookingerr != nil {\n        panic(bookingerr.Error())\n    } else {\n\n        Result := make(map[string]interface{})\n        for bookingrows.Next() {\n            var bookingid, checkinreported, vehicleingarage, serviceinprogress, vehicleready, vehicledelivered string\n            err = bookingrows.Scan(&amp;bookingid, &amp;checkinreported, &amp;vehicleingarage, &amp;serviceinprogress, &amp;vehicleready, &amp;vehicledelivered)\n            type Output struct {\n                checkins   int `json:\"checkins\"`\n                inprogress int `json:\"inprogress\"`\n                ready      int `json:\"ready\"`\n                completed  int `json:\"completed\"`\n            }\n            var output Output\n            if err != nil {\n                panic(err.Error())\n                Response.Status = \"failed\"\n            }\n            if vehicledelivered == \"1\" {\n                output.completed = output.completed + 1\n            }\n            if vehicledelivered == \"0\" &amp;&amp; vehicleready == \"1\" {\n                output.ready = output.ready + 1\n            }\n            if vehicledelivered == \"0\" &amp;&amp; vehicleready == \"0\" &amp;&amp; serviceinprogress == \"1\" {\n                output.inprogress = output.inprogress + 1\n            }\n            if vehicledelivered == \"0\" &amp;&amp; vehicleready == \"0\" &amp;&amp; serviceinprogress == \"0\" &amp;&amp; (checkinreported == \"1\" || vehicleingarage == \"1\") {\n                output.checkins = output.checkins + 1\n            }\n\n            values := make([]string, 4)\n            val := reflect.ValueOf(output)\n            for i := range values {\n                //Result[usercolumns[i]] = fmt.Sprintf(\"%s\", v)\n                Result[val.Type().Field(i).Tag.Get(\"json\")] = fmt.Sprintf(\"%v\", i)\n            }\n        }\n\n        Response.Result = append(Response.Result, Result)\n        Response.Status = \"success\"\n\n    }\n\n    res.Header().Set(\"Content-Type\", \"application/json\")\n    rnd.JSON(res, http.StatusOK, Response)\n}\n</code></pre>\n\n<p>Im getting the desired output when the input values are correct and the corresponding row exists in Db. but when the input is wrong or the query fails, i should return only the status as \"failed\" but my output contains the result [] which is empty like this.</p>\n\n<pre><code>{\n    \"result\": [\n        {}\n    ],\n    \"status\": \"success\"\n} \n</code></pre>\n\n<p>I tried checking Result == nil and add the array only on true. but this doesn't help me. it might be because the struct is not nill.\nI need some help to to find the issue and solve it.</p>\n"}, {"tags": ["dictionary", "go", "reflection", "slice"], "answers": [{"comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520414251, "post_id": 49147910, "comment_id": 85300700, "body": "Go says Map types are reference types, like pointers or slices. So why is it so that we can not Set the value of Maps Since it is also a reference type"}, {"owner": {"reputation": 51, "user_id": 9455524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc28321813d15a4689401383fd11ba7?s=128&d=identicon&r=PG&f=1", "display_name": "B. Delor", "link": "https://stackoverflow.com/users/9455524/b-delor"}, "edited": false, "score": 0, "creation_date": 1520414348, "post_id": 49147910, "comment_id": 85300752, "body": "Thank you for you answer, unfortunately I need to modify the content of the Value retrieved with MapIndex later in the code, this is why I need this Value settable. Is there a way to make a settable copy of a unsettable value?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 51, "user_id": 9455524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc28321813d15a4689401383fd11ba7?s=128&d=identicon&r=PG&f=1", "display_name": "B. Delor", "link": "https://stackoverflow.com/users/9455524/b-delor"}, "edited": false, "score": 0, "creation_date": 1520414443, "post_id": 49147910, "comment_id": 85300809, "body": "@B.Delor No, there is not. As explained, a settable <code>reflect.Value</code> would prevent the runtime to operate the map normally, it could not change its internal structure, or the <code>reflect.Value</code> would become invalid / corrupt."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520414467, "post_id": 49147910, "comment_id": 85300827, "body": "Thanks @icza for explanation. So slice index will not going to change like maps since they are not making a copy of their values when you are looping over it."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520414514, "post_id": 49147910, "comment_id": 85300852, "body": "@Himanshu Elements in a slice are not moved around &quot;arbitrarily&quot; by the runtime, while map values may be."}, {"owner": {"reputation": 51, "user_id": 9455524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc28321813d15a4689401383fd11ba7?s=128&d=identicon&r=PG&f=1", "display_name": "B. Delor", "link": "https://stackoverflow.com/users/9455524/b-delor"}, "edited": false, "score": 0, "creation_date": 1520414558, "post_id": 49147910, "comment_id": 85300884, "body": "This is why I was asking for a copy, it would be disconnected from the map, live on it&#39;s own and sporting a copy of the content of the map&#39;s accessed Value. Then I&#39;ll modify this copy and finally push it back in the map with SetMapIndex"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520414561, "post_id": 49147910, "comment_id": 85300886, "body": "Is there any go reference supporting this."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 51, "user_id": 9455524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc28321813d15a4689401383fd11ba7?s=128&d=identicon&r=PG&f=1", "display_name": "B. Delor", "link": "https://stackoverflow.com/users/9455524/b-delor"}, "edited": false, "score": 0, "creation_date": 1520414619, "post_id": 49147910, "comment_id": 85300928, "body": "@B.Delor You can do that, but ultimately you have to call <code>Value.SetMapIndex()</code>."}, {"owner": {"reputation": 51, "user_id": 9455524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc28321813d15a4689401383fd11ba7?s=128&d=identicon&r=PG&f=1", "display_name": "B. Delor", "link": "https://stackoverflow.com/users/9455524/b-delor"}, "edited": false, "score": 0, "creation_date": 1520414690, "post_id": 49147910, "comment_id": 85300975, "body": "I&#39;m wondering how to do that, I might be googling wrong but I&#39;m gaving a hard time finding how to copy the the content of an unsettable value to a new, settable value ^^"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 51, "user_id": 9455524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc28321813d15a4689401383fd11ba7?s=128&d=identicon&r=PG&f=1", "display_name": "B. Delor", "link": "https://stackoverflow.com/users/9455524/b-delor"}, "edited": false, "score": 0, "creation_date": 1520414746, "post_id": 49147910, "comment_id": 85301013, "body": "@B.Delor Read this answer: <a href=\"https://stackoverflow.com/questions/37851500/how-to-copy-an-interface-value-in-go/37851764#37851764\">How to copy an interface value in Go?</a> You may use <code>reflect.New()</code> to obtain a pointer to a newly allocated value of some type, wrapped in a <code>reflect.Value</code>, which will be settable."}, {"owner": {"reputation": 51, "user_id": 9455524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc28321813d15a4689401383fd11ba7?s=128&d=identicon&r=PG&f=1", "display_name": "B. Delor", "link": "https://stackoverflow.com/users/9455524/b-delor"}, "edited": false, "score": 0, "creation_date": 1520415137, "post_id": 49147910, "comment_id": 85301260, "body": "Thanks you a lot for your help"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1520420536, "last_edit_date": 1520420536, "creation_date": 1520413615, "answer_id": 49147910, "question_id": 49147706, "link": "https://stackoverflow.com/questions/49147706/reflect-accessed-map-does-not-provide-a-modifiable-value/49147910#49147910", "title": "Reflect accessed map does not provide a modifiable value", "body": "<p>This is not a limitation of the <code>reflect</code> package. Slice index expressions are addressable (e.g. <code>&amp;s[0]</code> is valid for example), so slice elements obtained via reflection will be settable. Map index expressions are <strong>not</strong> addressable (e.g. <code>&amp;m[\"a\"]</code> is invalid), so values of keys obtained via reflection will not be settable. See related <a href=\"https://stackoverflow.com/questions/42716852/how-to-update-map-values-in-go/42716918#42716918\">How to update map values in Go</a></p>\n\n<p>Only addressable values are settable, attempting to \"set\" a non-addressable value could only modify a copy (and not the original value), so it's not allowed in the first place. Quoting from <a href=\"https://golang.org/pkg/reflect/#Value.CanSet\" rel=\"nofollow noreferrer\"><code>Value.CanSet()</code></a>:</p>\n\n<blockquote>\n  <p>CanSet reports whether the value of v can be changed. A Value can be changed only <strong>if it is addressable</strong> and was not obtained by the use of unexported struct fields.</p>\n</blockquote>\n\n<p>If you want to change the value assigned to a key in a map using reflection, use the <a href=\"https://golang.org/pkg/reflect/#Value.SetMapIndex\" rel=\"nofollow noreferrer\"><code>Value.SetMapIndex()</code></a> method:</p>\n\n<pre><code>mv.SetMapIndex(reflect.ValueOf(\"a\"), reflect.ValueOf(\"11\"))\nfmt.Println(m)\n</code></pre>\n\n<p>Output will be (try it on the <a href=\"https://play.golang.org/p/AFRDohn3Lb2\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>map[b:2 c:3 a:11]\n</code></pre>\n\n<p>Note: taking the address of a map index expression (and allowing to change a value using reflection) is not allowed because the internals of a map may change at any time (e.g. if new key-values are added to the map, the implementation may have to re-structure the way it stores the key-value pairs internally), so a possible pointer you would obtain by <code>&amp;m[\"a\"]</code> may not exist (or may point to another value) by the time you end up using it. To avoid such confusions and run-time panics, this is not allowed in the first place.</p>\n"}], "owner": {"reputation": 51, "user_id": 9455524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc28321813d15a4689401383fd11ba7?s=128&d=identicon&r=PG&f=1", "display_name": "B. Delor", "link": "https://stackoverflow.com/users/9455524/b-delor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1440, "favorite_count": 2, "accepted_answer_id": 49147910, "answer_count": 1, "score": 4, "last_activity_date": 1520420536, "creation_date": 1520412986, "last_edit_date": 1592644375, "question_id": 49147706, "link": "https://stackoverflow.com/questions/49147706/reflect-accessed-map-does-not-provide-a-modifiable-value", "title": "Reflect accessed map does not provide a modifiable value", "body": "<h2>Context</h2>\n<p>In the process of writing a generic diff and patch algorithm I faced a problem with reflection in go.</p>\n<p>When I'm trying to patch in a slice I have no problem, <code>reflect.ValueOf(&amp;slice).Elem().Index(0).CanSet()</code> returns true. This allows me to patch anything inside the slice element, be it a slice of primitive or of structs.</p>\n<h2>Problem</h2>\n<p>However when I attempt this with a map <code>reflect.ValueOf(&amp;map).Elem().MapIndex(reflect.ValueOf(&quot;key&quot;)).CanSet()</code> returns false. This prevents me from attempting to do anythnin with the content of my map.</p>\n<h3>Examples</h3>\n<p><strong>Slice</strong></p>\n<pre><code>s := []string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;}\n\nv := reflect.ValueOf(&amp;s).Elem()\n\ne := v.Index(1)\n\nprintln(e.String())\nprintln(e.CanSet())\ne.Set(reflect.ValueOf(&quot;d&quot;))\n\nfor _, v := range s {\n    print(v, &quot; &quot;)\n}\n\noutput :\nb\ntrue\na d c\n</code></pre>\n<p><strong>Map</strong></p>\n<pre><code>m := map[string]string{\n    &quot;a&quot;: &quot;1&quot;,\n    &quot;b&quot;: &quot;2&quot;,\n    &quot;c&quot;: &quot;3&quot;}\n\nmv := reflect.ValueOf(&amp;m).Elem()\nprintln(mv.MapIndex(reflect.ValueOf(&quot;a&quot;)).CanSet())\n\noutput:\nfalse\n</code></pre>\n<p>How could I get a modifiable value out of a map through reflection?</p>\n<p>Thanks for your time.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1520403124, "post_id": 49145133, "comment_id": 85295370, "body": "A descriptive sample would help others understand your question better. Is the struct itself is used somewhere else? Or is the interface of the struct the only thing that matters? You can provide a working example at <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">play.golang.org</a>"}, {"owner": {"reputation": 326, "user_id": 1174539, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4869d9a3d6cf9c4730291c39f85b5948?s=128&d=identicon&r=PG&f=1", "display_name": "Mani Muridi", "link": "https://stackoverflow.com/users/1174539/mani-muridi"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1520403674, "post_id": 49145133, "comment_id": 85295596, "body": "I&#39;ve updated the question with an example of what I&#39;m trying to do."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1520425743, "post_id": 49145133, "comment_id": 85308103, "body": "You have already written the code in your question, commented out. What&#39;s the problem?"}, {"owner": {"reputation": 326, "user_id": 1174539, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4869d9a3d6cf9c4730291c39f85b5948?s=128&d=identicon&r=PG&f=1", "display_name": "Mani Muridi", "link": "https://stackoverflow.com/users/1174539/mani-muridi"}, "edited": false, "score": 1, "creation_date": 1520499035, "post_id": 49145133, "comment_id": 85342885, "body": "The problem is I want some way to automatically call those functions without having to write beforeSave() and afterSave() in every struct."}], "answers": [{"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 2, "last_activity_date": 1520404803, "creation_date": 1520404803, "answer_id": 49145691, "question_id": 49145133, "link": "https://stackoverflow.com/questions/49145133/is-there-a-way-to-create-method-hooks-for-structs-in-go/49145691#49145691", "title": "Is there a way to create method hooks for structs in Go?", "body": "<p>Packages like <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">gorm</a> use callback hooks heavily. But if you are writing your own engine (for some specific logic) using interfaces can help greatly (<a href=\"https://play.golang.org/p/Eq_EBz8PtPf\" rel=\"nofollow noreferrer\">sample</a>). </p>\n"}, {"tags": [], "owner": {"reputation": 76, "user_id": 7461738, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-D0yKjXEU0zI/AAAAAAAAAAI/AAAAAAAAACE/2YFhu24oiB0/photo.jpg?sz=128", "display_name": "Louki Sumirniy", "link": "https://stackoverflow.com/users/7461738/louki-sumirniy"}, "is_accepted": false, "score": 0, "last_activity_date": 1545300353, "creation_date": 1545300353, "answer_id": 53866416, "question_id": 49145133, "link": "https://stackoverflow.com/questions/49145133/is-there-a-way-to-create-method-hooks-for-structs-in-go/53866416#53866416", "title": "Is there a way to create method hooks for structs in Go?", "body": "<p><a href=\"https://medium.com/@matryer/the-http-handler-wrapper-technique-in-golang-updated-bc7fbcffa702\" rel=\"nofollow noreferrer\">https://medium.com/@matryer/the-http-handler-wrapper-technique-in-golang-updated-bc7fbcffa702</a></p>\n\n<p>I would only add to that article above, which I think well answers your question, that you can go further using pipelines (methods that return the associated variable they are bound to). It's particularly interesting as in the above article, as relates to being able to interpose anything between two processes, and you can use this to create tees and journalling/logging systems, and it can go a long way towards compensating for the kinda primitive error handling in Go. </p>\n\n<p>I designed a number of related byte slice processing libraries that were able to be easily chained without needing to break a a line, although obviously more than about 3-4 in a line can get confusing and you can find yourself wanting to pass things in a DAG style pattern, at which point I think channels would make sense.</p>\n"}], "owner": {"reputation": 326, "user_id": 1174539, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4869d9a3d6cf9c4730291c39f85b5948?s=128&d=identicon&r=PG&f=1", "display_name": "Mani Muridi", "link": "https://stackoverflow.com/users/1174539/mani-muridi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2254, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1545300353, "creation_date": 1520402502, "last_edit_date": 1520403652, "question_id": 49145133, "link": "https://stackoverflow.com/questions/49145133/is-there-a-way-to-create-method-hooks-for-structs-in-go", "title": "Is there a way to create method hooks for structs in Go?", "body": "<p>I want to create before save and after save method hooks for my Go structs how can I achieve this?</p>\n\n<pre><code>    type Person struct {\n        FirstName string\n        LastName string\n    }\n\n    func (p *Person) Save() {\n        // call beforeSave()\n        // Save person data\n        // call afterSave()\n    }\n\n    func (p *Person) Update() {\n        // call beforeUpdate()\n        // Update person data\n        // call afterUpdate()\n    }\n\n    type Order struct {\n        Number bson.ObjectId\n        Items []Item\n    }\n\n    func (o *Order) Save() {\n        // call beforeSave()\n        // Save order data\n        // call afterSave()\n    }\n\n    func (o *Order) Update() {\n        // call beforeUpdate()\n        // Update order data\n        // call afterUpdate()\n    }\n</code></pre>\n\n<p>For any struct I create as a model I want it to have a beforeSave() and afterSave() hook called automatically and be able to further override if necessary.</p>\n"}, {"tags": ["nginx", "go", "grafana"], "comments": [{"owner": {"reputation": 3973, "user_id": 1908612, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/CEW5l.jpg?s=128&g=1", "display_name": "Maxim.K", "link": "https://stackoverflow.com/users/1908612/maxim-k"}, "edited": false, "score": 0, "creation_date": 1549718086, "post_id": 49143489, "comment_id": 96008287, "body": "Were you finally able to resolve the question?"}], "answers": [{"tags": [], "owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "is_accepted": false, "score": 1, "last_activity_date": 1520392936, "creation_date": 1520392936, "answer_id": 49143580, "question_id": 49143489, "link": "https://stackoverflow.com/questions/49143489/how-to-setup-nginx-with-auth0/49143580#49143580", "title": "How to setup Nginx with Auth0?", "body": "<p>The application has to know what domain name to use on the URLs it issues. nginx may also need to do some rewriting. </p>\n\n<p>Add an X-Forwarded-Host header, and potentially a proxy_redirect directive, as per instructions here</p>\n\n<p><a href=\"https://www.nginx.com/resources/wiki/start/topics/examples/likeapache/\" rel=\"nofollow noreferrer\">https://www.nginx.com/resources/wiki/start/topics/examples/likeapache/</a></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 14484207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/268423a184049a059175748417896c0b?s=128&d=identicon&r=PG&f=1", "display_name": "sudo8.com", "link": "https://stackoverflow.com/users/14484207/sudo8-com"}, "is_accepted": false, "score": 0, "last_activity_date": 1613559808, "last_edit_date": 1613559808, "creation_date": 1613549187, "answer_id": 66237924, "question_id": 49143489, "link": "https://stackoverflow.com/questions/49143489/how-to-setup-nginx-with-auth0/66237924#66237924", "title": "How to setup Nginx with Auth0?", "body": "<p><code>127.0.0.1</code> is the loopback address (also known as localhost).<br />\n<code>0.0.0.0</code> is a non-routable meta-address used to designate an invalid, unknown, or non-applicable target (a 'no particular address' place holder).</p>\n"}], "owner": {"reputation": 467, "user_id": 7136955, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d629f7144acd331a77aa71267c181fae?s=128&d=identicon&r=PG&f=1", "display_name": "User100696", "link": "https://stackoverflow.com/users/7136955/user100696"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2256, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1613559808, "creation_date": 1520392253, "question_id": 49143489, "link": "https://stackoverflow.com/questions/49143489/how-to-setup-nginx-with-auth0", "title": "How to setup Nginx with Auth0?", "body": "<p>I got an app running in port 3000. </p>\n\n<p>this app is working behind a reverse proxy such as:</p>\n\n<pre><code>server {\n    listen 80;\n    server_name myapp;\n\n    location / {\n        proxy_pass http://127.0.0.1:3000;\n    }\n}\n</code></pre>\n\n<p>so, everytime I access to my site, it will serve to localhost the content from port 3000, and it's working ok. </p>\n\n<p>The problem is after the auth0 authentication, when the user is authenticated it keeps redirecting to localhost:3000/#, how can I make it work to localhost?</p>\n\n<p>this is my Nginx config file:</p>\n\n<pre><code>server {\n    listen 80;\n    server_name myapp;\n\n    location / {\n        proxy_pass http://127.0.0.1:3000;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header X-NginX-Proxy true;\n    }\n\n    location /generic_oauth/ {\n        proxy_pass http://127.0.0.1:3000;\n    }\n}\n</code></pre>\n\n<p>callback is <code>localhost/login/generic_oauth</code></p>\n\n<p>my auth0 settings callback is: <code>http://localhost:3000/login/generic_oauth</code></p>\n\n<p>if I change my auth0 callback to <code>http://localhost/login/generic_oauth</code></p>\n\n<p>got the error:</p>\n\n<blockquote>\n  <p>the callback must be <a href=\"http://localhost:3000/login/generic_oauth\" rel=\"nofollow noreferrer\">http://localhost:3000/login/generic_oauth</a></p>\n</blockquote>\n\n<p>sorry for my bad english </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1520403274, "post_id": 49143280, "comment_id": 85295426, "body": "In this context (closing the <code>done</code> channel) it makes perfect sense. But if there is a need for checking the end of data, the <code>val,ok := &lt;-ch</code> should be used and the <code>ok</code> flag be checked."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1520406499, "post_id": 49143280, "comment_id": 85296796, "body": "&quot;Why is that so?&quot; Because the language spec says it must be so. Are you asking what you can do with that language feature?"}], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1520391231, "post_id": 49143343, "comment_id": 85292137, "body": "Also <code>yields an additional untyped boolean result reporting whether the communication succeeded. The value of ok is true if the value received was delivered by a successful send operation to the channel, or false if it is a zero value generated because the channel is closed and empty.</code>"}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 5, "last_activity_date": 1520391195, "creation_date": 1520391195, "answer_id": 49143343, "question_id": 49143280, "link": "https://stackoverflow.com/questions/49143280/why-does-closing-channel-in-go-routine-causes-receiving-channel-to-receive-value/49143343#49143343", "title": "Why does closing channel in go routine causes receiving channel to receive value?", "body": "<p>From the spec:</p>\n\n<blockquote>\n  <p>A receive operation on a closed channel can always proceed\n  immediately, yielding the element type's zero value after any\n  previously sent values have been received.</p>\n</blockquote>\n\n<p>See <a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"noreferrer\">https://golang.org/ref/spec#Receive_operator</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 4, "last_activity_date": 1520407070, "creation_date": 1520407070, "answer_id": 49146203, "question_id": 49143280, "link": "https://stackoverflow.com/questions/49143280/why-does-closing-channel-in-go-routine-causes-receiving-channel-to-receive-value/49146203#49146203", "title": "Why does closing channel in go routine causes receiving channel to receive value?", "body": "<p>Because it can't finish without returning values. So it has to return some \"stub\", according to spec zero value was chosen. \nAlso you may use two-value form to check whether real value was returned or a stub.</p>\n\n<pre><code>val, ok := &lt;- someChannel\nif ok {\n   // value was got from the channel\n}\nif !ok {\n   // channel was closed\n}\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 8383667, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-hfZySuOHdGg/AAAAAAAAAAI/AAAAAAAAAFY/Ksu3_YA3V_4/photo.jpg?sz=128", "display_name": "p-ray", "link": "https://stackoverflow.com/users/8383667/p-ray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 49143343, "answer_count": 2, "score": -1, "last_activity_date": 1520407070, "creation_date": 1520390677, "question_id": 49143280, "link": "https://stackoverflow.com/questions/49143280/why-does-closing-channel-in-go-routine-causes-receiving-channel-to-receive-value", "title": "Why does closing channel in go routine causes receiving channel to receive value?", "body": "<p>I have a go routine that periodically polls every interval and does a action. It also checks for done channel, as a end signal, to stop the polling.     </p>\n\n<pre><code>  go func(){\n       for {\n          select{\n              case &lt;-myticker.C:\n                 do_something()\n              case &lt;-done:\n                 fmt.Println(\"I am done\")\n                 return\n         } \n       }\n\n    }\n</code></pre>\n\n<p>I realized that if I close the channel, It also runs as if the value is passed to done channel, It prints out \"I am done\" Why is that so? </p>\n"}, {"tags": ["html", "xml", "go", "xhtml"], "answers": [{"tags": [], "owner": {"reputation": 59, "user_id": 7635416, "user_type": "registered", "profile_image": "https://graph.facebook.com/10212091165383793/picture?type=large", "display_name": "Honza", "link": "https://stackoverflow.com/users/7635416/honza"}, "is_accepted": true, "score": 0, "last_activity_date": 1520387515, "creation_date": 1520387515, "answer_id": 49142886, "question_id": 49142798, "link": "https://stackoverflow.com/questions/49142798/manipulate-html-using-marshal-like-encoder/49142886#49142886", "title": "Manipulate HTML using Marshal-like encoder", "body": "<p>XSLT transform XML data with template and generates text or xhtml output. This might work for your use case <a href=\"https://www.w3schools.com/xml/xsl_client.asp\" rel=\"nofollow noreferrer\">https://www.w3schools.com/xml/xsl_client.asp</a></p>\n"}], "owner": {"reputation": 449, "user_id": 7623709, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3b869731c724b20a6dd447a3f87121e6?s=128&d=identicon&r=PG&f=1", "display_name": "mike", "link": "https://stackoverflow.com/users/7623709/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 26, "favorite_count": 0, "accepted_answer_id": 49142886, "answer_count": 1, "score": 0, "last_activity_date": 1520387515, "creation_date": 1520386866, "question_id": 49142798, "link": "https://stackoverflow.com/questions/49142798/manipulate-html-using-marshal-like-encoder", "title": "Manipulate HTML using Marshal-like encoder", "body": "<p>I have several html templates that I populate using a combination of css selectors(<a href=\"http://github.com/andybalholm/cascadia\" rel=\"nofollow noreferrer\">cascadia</a>) and manually manipulating the html Nodes (using <a href=\"https://godoc.org/golang.org/x/net/html\" rel=\"nofollow noreferrer\">x/html</a>). Is there any better way to do this ? Something like the <a href=\"https://golang.org/pkg/encoding/xml/\" rel=\"nofollow noreferrer\">xml</a>.Marshaller ? </p>\n\n<p>I've tried using xhtml and along with the xml package(Decoder.AutoClose = H TMLAutoClose) but the issue is that on Decoding a lot of information/structure is lost (i.e. extra divs that are used for styling only and not included in the Data struct).</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "is_accepted": true, "score": 7, "last_activity_date": 1520379054, "creation_date": 1520379054, "answer_id": 49141736, "question_id": 49141513, "link": "https://stackoverflow.com/questions/49141513/why-does-go-net-ipv4-create-a-16-byte-address-internally/49141736#49141736", "title": "Why does Go net.IPv4 create a 16 byte address internally", "body": "<p>It looks like they're using a representation that allows them to easily handle both IPv4 and IPv6 addresses with the same code.  They're using a single 16-byte representation for either type of IP.</p>\n\n<p>The comments at the top of the code (that you linked to) explain in pretty clearly:</p>\n\n<pre><code>// IPv4 addresses are 4 bytes; IPv6 addresses are 16 bytes.\n// An IPv4 address can be converted to an IPv6 address by\n// adding a canonical prefix (10 zeros, 2 0xFFs).\n// This library accepts either size of byte slice but always\n// returns 16-byte addresses.\n</code></pre>\n\n<p>You can pass in either 4-byte or 16-byte representations of IPv4 addresses, but the library will internally use 16-byte ones and always return those.</p>\n"}], "owner": {"reputation": 1789, "user_id": 55800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0d8c4410c01f7efc6cd2684528e7e481?s=128&d=identicon&r=PG", "display_name": "HaBaLeS", "link": "https://stackoverflow.com/users/55800/habales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 49141736, "answer_count": 1, "score": 3, "last_activity_date": 1520379116, "creation_date": 1520377664, "last_edit_date": 1520379116, "question_id": 49141513, "link": "https://stackoverflow.com/questions/49141513/why-does-go-net-ipv4-create-a-16-byte-address-internally", "title": "Why does Go net.IPv4 create a 16 byte address internally", "body": "<p>I noticed Go creates a 16 byte internal representation of a 4 byte IPv4 Address when using:</p>\n\n<pre><code>// IPv4 returns the IP address (in 16-byte form) of the\n// IPv4 address a.b.c.d.\nfunc IPv4(a, b, c, d byte) IP {\n    p := make(IP, IPv6len)\n    copy(p, v4InV6Prefix)\n    p[12] = a\n    p[13] = b\n    p[14] = c\n    p[15] = d\n    return p\n}\n</code></pre>\n\n<p><a href=\"https://golang.org/src/net/ip.go\" rel=\"nofollow noreferrer\">https://golang.org/src/net/ip.go</a></p>\n\n<p>Is there a reason that IPv4 is initially created with 16 bytes? I was doing some calculations for Broadcast and Networkaddress where I accessed the internal byte[] directly and got confused that I had to call <code>To4()</code> to do something like</p>\n\n<pre><code>start := binary.BigEndian.Uint32([]byte(ip))\n</code></pre>\n\n<p>and actually get the IPv4 Address as uint32.</p>\n"}, {"tags": ["go", "sed"], "answers": [{"comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 2, "creation_date": 1520379126, "post_id": 49141362, "comment_id": 85288946, "body": "In particular, Go calls the command directly, not through a shell, so it is not necessary to escape or quote characters that a shell might treat specially."}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1520380139, "post_id": 49141362, "comment_id": 85289282, "body": "Thanks that&#39;s what I discovered by trial and error.  It actually pulls the command from a toml file which had the single quotes."}, {"owner": {"reputation": 95956, "user_id": 5866580, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/1de2cd722d865edac1575102a48ecc0a?s=128&d=identicon&r=PG&f=1", "display_name": "RavinderSingh13", "link": "https://stackoverflow.com/users/5866580/ravindersingh13"}, "edited": false, "score": 0, "creation_date": 1520391131, "post_id": 49141362, "comment_id": 85292119, "body": "++ve for nice answer sir :)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1520415093, "post_id": 49141362, "comment_id": 85301226, "body": "Oh, I hope you get those TOML files from a trusted source\u2026"}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 1, "creation_date": 1520453494, "post_id": 49141362, "comment_id": 85326259, "body": "It&#39;s a configuration file.  Not user editable.  Written by me."}, {"owner": {"reputation": 341, "user_id": 5644356, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rAuEX.jpg?s=128&g=1", "display_name": "Brad Pitt", "link": "https://stackoverflow.com/users/5644356/brad-pitt"}, "edited": false, "score": 0, "creation_date": 1595294101, "post_id": 49141362, "comment_id": 111418432, "body": "What if the regex pattern contains whitespaces in it, how should we use exec.Command to execute sed command at all?"}], "tags": [], "owner": {"reputation": 142005, "user_id": 465183, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3b518a0ea4c992cfe9965671d0139ba4?s=128&d=identicon&r=PG", "display_name": "Gilles Quenot", "link": "https://stackoverflow.com/users/465183/gilles-quenot"}, "is_accepted": true, "score": 6, "last_activity_date": 1520413580, "last_edit_date": 1520413580, "creation_date": 1520376765, "answer_id": 49141362, "question_id": 49141332, "link": "https://stackoverflow.com/questions/49141332/how-is-exec-command-breaking-this-call-to-sed/49141362#49141362", "title": "How is exec.Command breaking this call to sed?", "body": "<p>Try this : </p>\n\n<pre><code>cmd := exec.Command(\"sed\", \"-i\", \"s|/octane/data||g\", \"./results.json\")\n</code></pre>\n\n<p>wrong quoting issue.</p>\n\n<p>The single quotes are necessary for shell but not for the exec.Command call.</p>\n"}], "owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 455, "favorite_count": 0, "accepted_answer_id": 49141362, "answer_count": 1, "score": 1, "last_activity_date": 1520413580, "creation_date": 1520376530, "question_id": 49141332, "link": "https://stackoverflow.com/questions/49141332/how-is-exec-command-breaking-this-call-to-sed", "title": "How is exec.Command breaking this call to sed?", "body": "<p>I'm trying to run the following command from go.</p>\n\n<p>sed -i 's|/home/output||g' /tmp/results.json</p>\n\n<p>Which blats out /home/output from the file /tmp/result.json.</p>\n\n<p>If I run this from a terminal it works perfectly.  However, I can't figure out why it's not liking being run from go exec.  </p>\n\n<p>Here is my code.</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"log\"\n        \"os\"\n        \"os/exec\"\n)\n\nfunc main() {\n        cmd := exec.Command(\"sed\", \"-i\", \"'s|/octane/data||g'\", \"./results.json\")\n        cmd.Stdout = os.Stdout\n        cmd.Stderr = os.Stderr\n\n        if err := cmd.Start(); err != nil {\n                log.Fatal(err)\n        }\n\n        if err := cmd.Wait(); err != nil {\n                log.Fatal(err)\n        }\n}\n</code></pre>\n\n<p>The specific error is:</p>\n\n<pre><code>sed: -e expression #1, char 1: unknown command: `''\n2018/03/07 11:48:01 exit status 1\n</code></pre>\n\n<p>What is causing this unexpected behavior?</p>\n"}, {"tags": ["go", "boolean", "go-gorm"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520368677, "post_id": 49139532, "comment_id": 85284355, "body": "Where is this coming from? You say &quot;If you send a user_account object&quot; - sent from where? How? In what format?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1520368716, "post_id": 49139532, "comment_id": 85284377, "body": "<code>false</code> is <code>false</code>, you can&#39;t differentiate between the two. Are you sure you can&#39;t use a <code>*bool</code>?"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 1, "creation_date": 1520369330, "post_id": 49139532, "comment_id": 85284656, "body": "Either avoid making that decision based on the value of a bool in the struct, or use a pointer and check whether it&#39;s nil."}, {"owner": {"reputation": 11, "user_id": 9084824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37ee7a12250d8a37df9ae98ade5d1b4c?s=128&d=identicon&r=PG&f=1", "display_name": "Leonardo Andrigo", "link": "https://stackoverflow.com/users/9084824/leonardo-andrigo"}, "edited": false, "score": 0, "creation_date": 1520369663, "post_id": 49139532, "comment_id": 85284844, "body": "This is a REST API. user_account will be handled by an endpoint. I&#39;m struggling with how to detect if, for example, I received a &quot;{name: &#39;username&#39;, &#39;show: false}&quot; through POST. Go will convert it to a  user_account struct with show = false. But if I receive a &quot;{name: &#39;username&#39;}&quot;, the user_account struct will also have a show = false. Do you guys get it?"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9084824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37ee7a12250d8a37df9ae98ade5d1b4c?s=128&d=identicon&r=PG&f=1", "display_name": "Leonardo Andrigo", "link": "https://stackoverflow.com/users/9084824/leonardo-andrigo"}, "edited": false, "score": 0, "creation_date": 1520371616, "post_id": 49139808, "comment_id": 85285713, "body": "thas a great idea but if i try to store a value in the sleep field , it wont work it sayst Cannot use true (type bool) as type *boo"}, {"owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "reply_to_user": {"reputation": 11, "user_id": 9084824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37ee7a12250d8a37df9ae98ade5d1b4c?s=128&d=identicon&r=PG&f=1", "display_name": "Leonardo Andrigo", "link": "https://stackoverflow.com/users/9084824/leonardo-andrigo"}, "edited": false, "score": 0, "creation_date": 1520372711, "post_id": 49139808, "comment_id": 85286242, "body": "@LeonardoAndrigo please, look at the playground link, I&#39;ve updated it to show you different ways of setting the *bool field, you should <b>point</b> to some variable"}, {"owner": {"reputation": 11, "user_id": 9084824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37ee7a12250d8a37df9ae98ade5d1b4c?s=128&d=identicon&r=PG&f=1", "display_name": "Leonardo Andrigo", "link": "https://stackoverflow.com/users/9084824/leonardo-andrigo"}, "edited": false, "score": 0, "creation_date": 1520388314, "post_id": 49139808, "comment_id": 85291482, "body": "@hsrv thaks it helped  a lot"}], "tags": [], "owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "is_accepted": true, "score": 6, "last_activity_date": 1520372607, "last_edit_date": 1520372607, "creation_date": 1520369804, "answer_id": 49139808, "question_id": 49139532, "link": "https://stackoverflow.com/questions/49139532/how-to-check-if-a-bool-from-a-struct-has-been-altered-to-false-or-if-it-was-alre/49139808#49139808", "title": "How to check if a bool from a struct has been altered to false or if it was already false", "body": "<p>For the <code>Sleep</code> field you can use a pointer which can be also a nil:</p>\n\n<pre><code>type userAccount struct {\n    Sleep *bool\n}\n</code></pre>\n\n<p>Now you can check it:</p>\n\n<pre><code>func check(u userAccount) {\n    if u.Sleep == nil {\n        // not set\n    } else if !(*u.Sleep) {\n        // set to false\n    } else {\n        // set to true\n    }\n}\n</code></pre>\n\n<p>Check it in the Playground: <a href=\"https://play.golang.org/p/8EIs_yIC0mw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/8EIs_yIC0mw</a>.</p>\n"}], "owner": {"reputation": 11, "user_id": 9084824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37ee7a12250d8a37df9ae98ade5d1b4c?s=128&d=identicon&r=PG&f=1", "display_name": "Leonardo Andrigo", "link": "https://stackoverflow.com/users/9084824/leonardo-andrigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2377, "favorite_count": 0, "accepted_answer_id": 49139808, "answer_count": 1, "score": 0, "last_activity_date": 1527756612, "creation_date": 1520368583, "last_edit_date": 1527756612, "question_id": 49139532, "link": "https://stackoverflow.com/questions/49139532/how-to-check-if-a-bool-from-a-struct-has-been-altered-to-false-or-if-it-was-alre", "title": "How to check if a bool from a struct has been altered to false or if it was already false", "body": "<pre><code>type user_account struct {\nID                 string `sql:\"type:uuid;default:uuid_generate_v4()\"`\nGender_Identity_id string `sql:\"type:uuid;default:uuid_generate_v4()\"`\nEmail              string\nName               string\nLastName           string\nPassword           string\nBirthDate          string `sql:\"type:date;default:current_time\"`\nAssignedSex        bool\nShow               bool\nSleep              bool\nDisabled           bool\n}\n</code></pre>\n\n<p><strong>If you send a user_account object without setting the sleep value to true , the value will be false automatically i need to know if the value was actualy set as false or if its false Because it hasn't been set</strong>   </p>\n\n<pre><code>func UpdateUser(userUpdate user_account) {\n\ndb, err := gorm.Open(\"postgres\", \"user=postgres password=06maneco dbname=HookTest sslmode=disable\")\nvar user user_account\n\nif err != nil {\n    fmt.Println(err)\n} else {\n\n    db.Where(\"id = ?\", userUpdate.ID).First(&amp;user)\n    if userUpdate.Name != user.Name {\n        user.Name = userUpdate.Name\n    } else if userUpdate.Password != \"\" {\n        user.Password = userUpdate.Password\n    } else if userUpdate.Gender_Identity_id != \"\" {\n        user.Gender_Identity_id = userUpdate.Gender_Identity_id\n    } else if userUpdate.Email != \"\" {\n        user.Email = userUpdate.Email\n    } else if userUpdate.Show != user.Show {\n        user.Show = userUpdate.Show\n    }\n    db.Save(&amp;user)\n\n}\n</code></pre>\n"}, {"tags": ["go", "raspberry-pi", "raspbian", "framebuffer"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1520361824, "post_id": 49137849, "comment_id": 85280801, "body": "You forgot to separate the <code>&quot;-T 1&quot;</code> and <code>&quot;-t 8&quot;</code> arguments"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520364754, "post_id": 49137849, "comment_id": 85282290, "body": "To reiterate on @JimB&#39;s response, the <code>fbi</code> program, as called, would receive\u2014among the others\u2014the arguments <code>-T 1</code> and <code>-t 8</code>, literally, which supposedly is not what was intended. Based on the observation that <a href=\"https://manpages.debian.org/fbi\" rel=\"nofollow noreferrer\">the <code>-T</code> option selects the TTY  to open</a>, that&#39;s likely the culprit."}, {"owner": {"reputation": 346, "user_id": 6038766, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-aVX5TDCQORQ/AAAAAAAAAAI/AAAAAAAAABk/Jf2JvrfG6SA/photo.jpg?sz=128", "display_name": "f0rsman", "link": "https://stackoverflow.com/users/6038766/f0rsman"}, "edited": false, "score": 0, "creation_date": 1520433693, "post_id": 49137849, "comment_id": 85313544, "body": "Well spotted, thank you. Fbi now starts but fails to load the image..."}], "owner": {"reputation": 346, "user_id": 6038766, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-aVX5TDCQORQ/AAAAAAAAAAI/AAAAAAAAABk/Jf2JvrfG6SA/photo.jpg?sz=128", "display_name": "f0rsman", "link": "https://stackoverflow.com/users/6038766/f0rsman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2163, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1520433585, "creation_date": 1520361633, "last_edit_date": 1520433585, "question_id": 49137849, "link": "https://stackoverflow.com/questions/49137849/displaying-images-using-fbi", "title": "Displaying images using fbi", "body": "<p>I've been trying to display images from a simple Go app using the following code:</p>\n\n<pre><code>output, err := exec.Command(\"fbi\", \"-a\", \"-noverbose\", \"-norandom\", \"-T 1\", \"-t 8\", files).CombinedOutput()\nif err != nil {\n    log.Fatalf(\"Unable to start fbi: %v\", string(output))\n}\n</code></pre>\n\n<p>Where <code>files</code> is just a file name string. Running <code>fbi -a -noverbose -norandom -T 1 -t 8 /path/to/file</code> on the command line works fine, but when running the go executable I get the following error:</p>\n\n<pre><code>ioctl VT_GETSTATE: Inappropriate ioctl for device (not a linux console?)\n</code></pre>\n\n<p>I'm guessing the issue is that fbi is unable to access the correct tty even though I've specified which one to use. Does anyone know why this is? What's the difference between me running the command on the command line and it running in an executable?</p>\n\n<p>I'm running this on Rasbian Stretch (not ssh). Tried both as root and not. Tried adding -d /dev/fb0.</p>\n"}, {"tags": ["dictionary", "go", "assert"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1520363143, "post_id": 49137828, "comment_id": 85281473, "body": "<a href=\"https://stackoverflow.com/questions/12753805/type-converting-slices-of-interfaces-in-go\" title=\"type converting slices of interfaces in go\">stackoverflow.com/questions/12753805/&hellip;</a> read the answers there, although it&#39;s about converting the elements of a slice, same constraints apply to maps."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1520412586, "post_id": 49137828, "comment_id": 85299746, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/12753805/type-converting-slices-of-interfaces-in-go\">Type converting slices of interfaces in go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 93, "user_id": 3774838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fed1875a71a16474748146f20f2f5865?s=128&d=identicon&r=PG&f=1", "display_name": "JonPen", "link": "https://stackoverflow.com/users/3774838/jonpen"}, "edited": false, "score": 0, "creation_date": 1520362743, "post_id": 49137968, "comment_id": 85281281, "body": "Sure that&#39;s an acceptable work around but why cant i assert / cast the map of concrete types to a map of interface the type implements. Or in other words whats the special magic way go can tell the difference between map[string] MyInterface and map[string] *MyStruct."}, {"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "reply_to_user": {"reputation": 93, "user_id": 3774838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fed1875a71a16474748146f20f2f5865?s=128&d=identicon&r=PG&f=1", "display_name": "JonPen", "link": "https://stackoverflow.com/users/3774838/jonpen"}, "edited": false, "score": 0, "creation_date": 1520362954, "post_id": 49137968, "comment_id": 85281379, "body": "I&#39;m actually doing the same in the for loop. Concrete type to an interface."}, {"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "reply_to_user": {"reputation": 93, "user_id": 3774838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fed1875a71a16474748146f20f2f5865?s=128&d=identicon&r=PG&f=1", "display_name": "JonPen", "link": "https://stackoverflow.com/users/3774838/jonpen"}, "edited": false, "score": 0, "creation_date": 1520363082, "post_id": 49137968, "comment_id": 85281441, "body": "take a look at the interface section in here - <a href=\"https://divan.github.io/posts/avoid_gotchas/\" rel=\"nofollow noreferrer\">divan.github.io/posts/avoid_gotchas</a>"}, {"owner": {"reputation": 93, "user_id": 3774838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fed1875a71a16474748146f20f2f5865?s=128&d=identicon&r=PG&f=1", "display_name": "JonPen", "link": "https://stackoverflow.com/users/3774838/jonpen"}, "edited": false, "score": 0, "creation_date": 1520364238, "post_id": 49137968, "comment_id": 85282014, "body": "that gotch link doesn&#39;t explain much &quot;We\u2019re not going to learn the logic of how interface type assertion works&quot;. The fact is it should work you work-around proves they are equivalent you should just be able to assert, providing that the map is a map to pointers to a struct."}], "tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": true, "score": 1, "last_activity_date": 1520362075, "creation_date": 1520362075, "answer_id": 49137968, "question_id": 49137828, "link": "https://stackoverflow.com/questions/49137828/how-do-i-convert-from-mapstring-mystruct-to-mapstring-myinterface/49137968#49137968", "title": "How do i convert from map[string] MyStruct to map[string] MyInterface", "body": "<p>Once unmarshalled, copy the map to <code>MyInterfaceMap</code> like below</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"reflect\"\n)\n\ntype MyInterface interface {\n    Say() string\n}\n\nvar MyInterfaceMap map[string]MyInterface\n\ntype MyStruct struct {\n    Message string\n}\n\nfunc (myStruct *MyStruct) Say() string {\n    return myStruct.Message\n}\n\nfunc main() {\n    data := []byte(`{\"greet\":{\"Message\":\"Hello\"}}`)\n    myStructMap := make(map[string]MyStruct)\n    err := json.Unmarshal(data, &amp;myStructMap)\n    if err != nil {\n        panic(err)\n    }\n\n    MyInterfaceMap = make(map[string]MyInterface)\n    for k, v := range myStructMap {\n        MyInterfaceMap[k] = &amp;v\n    }\n    fmt.Println(reflect.TypeOf(MyInterfaceMap))\n    fmt.Println(MyInterfaceMap)\n}\n</code></pre>\n\n<p>And the result would be</p>\n\n<pre><code>map[string]main.MyInterface\nmap[greet:0x1050c1a0]\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 3774838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fed1875a71a16474748146f20f2f5865?s=128&d=identicon&r=PG&f=1", "display_name": "JonPen", "link": "https://stackoverflow.com/users/3774838/jonpen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 49137968, "answer_count": 1, "score": -2, "last_activity_date": 1521471662, "creation_date": 1520361545, "last_edit_date": 1521471662, "question_id": 49137828, "link": "https://stackoverflow.com/questions/49137828/how-do-i-convert-from-mapstring-mystruct-to-mapstring-myinterface", "title": "How do i convert from map[string] MyStruct to map[string] MyInterface", "body": "<p>How do i convert from map[string] MyStruct to map[string] MyInterface, when MyStruct implements MyInterface.</p>\n\n<pre><code>type MyInterface interface {\n    Say() string\n}\n\nvar MyInterfaceMap map[string] MyInterface\n\ntype MyStruct struct{\n    Message string\n}\n\nfunc (myStruct *MyStruct) Say() string{\n    return myStruct.Message\n}\n\nfunc Init() {\n    data := []byte(`{\"greet\":{\"Message\":\"Hello\"}}`)\n    myStructMap := make(map[string] MyStruct )\n    _ = json.Unmarshal( data, &amp;myStructMap)\n    MyInterfaceMap = myStructMap \n}\n</code></pre>\n"}, {"tags": ["go", "udp", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1520357592, "post_id": 49136669, "comment_id": 85278448, "body": "Did you try closing the connection?"}, {"owner": {"reputation": 5548, "user_id": 4625526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6378aa788195a771461c5043057e2ed5?s=128&d=identicon&r=PG&f=1", "display_name": "Norbert van Nobelen", "link": "https://stackoverflow.com/users/4625526/norbert-van-nobelen"}, "edited": false, "score": 0, "creation_date": 1520359307, "post_id": 49136669, "comment_id": 85279483, "body": "It is advisable to close channels where you open them. The <code>defer</code> statement is made to promote that behavior (have open and close together so you do not forget to close). That might also be the influencing factor here for the behavior you are observing"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 5548, "user_id": 4625526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6378aa788195a771461c5043057e2ed5?s=128&d=identicon&r=PG&f=1", "display_name": "Norbert van Nobelen", "link": "https://stackoverflow.com/users/4625526/norbert-van-nobelen"}, "edited": false, "score": 2, "creation_date": 1520359369, "post_id": 49136669, "comment_id": 85279514, "body": "@NorbertvanNobelen: no, closing channels is not a cleanup action, you are not required to close them, and it is often incorrect to close them."}, {"owner": {"reputation": 5548, "user_id": 4625526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6378aa788195a771461c5043057e2ed5?s=128&d=identicon&r=PG&f=1", "display_name": "Norbert van Nobelen", "link": "https://stackoverflow.com/users/4625526/norbert-van-nobelen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520365620, "post_id": 49136669, "comment_id": 85282700, "body": "@JimB My remark is about opening and closing at the same location, not in two different functions. The code as presented could be confusing to read since the deferred close is not at the creation of the channel."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 7040886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b79f0e519e6045c3bffe6e3cae5f647?s=128&d=identicon&r=PG&f=1", "display_name": "Andrews", "link": "https://stackoverflow.com/users/7040886/andrews"}, "edited": false, "score": 0, "creation_date": 1520418743, "post_id": 49137615, "comment_id": 85303597, "body": "Thank you! That helped me."}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 3, "last_activity_date": 1520365578, "last_edit_date": 1520365578, "creation_date": 1520360723, "answer_id": 49137615, "question_id": 49136669, "link": "https://stackoverflow.com/questions/49136669/how-can-i-stop-a-goroutine-that-is-reading-from-udp/49137615#49137615", "title": "How can I stop a goroutine that is reading from UDP?", "body": "<p>Your program is likely stopped at this line when you close the channel:</p>\n\n<pre><code>n, _, err := conn.ReadFromUDP(buf)\n</code></pre>\n\n<p>Because execution is blocked at a <code>ReadFrom</code> method, the <code>select</code> statement is not being evaluated, therefore the close on channel <code>q</code> is not immediately detected.  When you do another send on the UDP connection, <code>ReadFrom</code> unblocks and (once that loop iteration finishes) control moves to the <code>select</code> statement: at that point the close on <code>q</code> is detected.</p>\n\n<p>You can <a href=\"https://golang.org/pkg/net/#UDPConn.Close\" rel=\"nofollow noreferrer\">close the connection</a> to unblock <code>ReadFrom</code>, as was suggested in a comment.  See the <a href=\"https://golang.org/pkg/net/#PacketConn\" rel=\"nofollow noreferrer\">PacketConn documentation in the <code>net</code> package</a>, especially <strong>\"Any blocked ReadFrom or WriteTo operations will be unblocked and return errors\"</strong>:</p>\n\n<pre><code>// Close closes the connection.\n// Any blocked ReadFrom or WriteTo operations will be unblocked and return errors.\nClose() error\n</code></pre>\n\n<p>Depending on your needs a timeout might be an option as well, see again <a href=\"https://golang.org/pkg/net/#PacketConn\" rel=\"nofollow noreferrer\">PacketConn documentation in the <code>net</code> package</a>:</p>\n\n<pre><code> // ReadFrom reads a packet from the connection,\n // copying the payload into b. It returns the number of\n // bytes copied into b and the return address that\n // was on the packet.\n // ReadFrom can be made to time out and return\n // an Error with Timeout() == true after a fixed time limit;\n // see SetDeadline and SetReadDeadline.\n ReadFrom(b []byte) (n int, addr Addr, err error)\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 7040886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b79f0e519e6045c3bffe6e3cae5f647?s=128&d=identicon&r=PG&f=1", "display_name": "Andrews", "link": "https://stackoverflow.com/users/7040886/andrews"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1545, "favorite_count": 0, "accepted_answer_id": 49137615, "answer_count": 1, "score": 1, "last_activity_date": 1520365578, "creation_date": 1520357162, "question_id": 49136669, "link": "https://stackoverflow.com/questions/49136669/how-can-i-stop-a-goroutine-that-is-reading-from-udp", "title": "How can I stop a goroutine that is reading from UDP?", "body": "<p>I have a go program that uses a goroutine to read UDP packets.\nI wanted to use a select clause and a \"stopping\" channel to close the goroutine to shut down as soon as it is not needed anymore.</p>\n\n<p>Here is a simple code example for the goroutine:</p>\n\n<pre><code>func Run(c chan string, q chan bool, conn *net.UDPConn) {\n\n    defer close(c)\n\n    buf := make([]byte, 1024)\n\n    for {\n        select {\n            case &lt;- q:\n                return\n            default:\n                n, _, err := conn.ReadFromUDP(buf)\n                c &lt;- string(buf[0:n])\n                fmt.Println(\"Received \", string(buf[0:n]))\n\n                if err != nil {\n                    fmt.Println(\"Error: \", err)\n                }\n        }\n    }\n}\n</code></pre>\n\n<p>The connection is created as:</p>\n\n<pre><code>    conn, err := net.ListenUDP(\"udp\",addr.Addr)\n</code></pre>\n\n<p>And the goroutine is supposed to terminate using:</p>\n\n<pre><code>    close(q)\n</code></pre>\n\n<p>After closing the \"stopping\" channel (\"q\") the goroutine does not immediately stop. I need to send one more string via the UDP connection. When doing so the goroutine stops.\nI simply do not understand this behaviour and I would be grateful if somebody could enlighten me.</p>\n\n<p>Thank you in advance!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520353625, "post_id": 49135533, "comment_id": 85275899, "body": "Are you also doing lookups by alarm name from the same map?"}, {"owner": {"reputation": 2653, "user_id": 433296, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/710872018/picture?type=large", "display_name": "Travis", "link": "https://stackoverflow.com/users/433296/travis"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520353778, "post_id": 49135533, "comment_id": 85276002, "body": "No the last section is where I am building my results []string I am only deleting items from the map by alarm name. I have to use the alarm name in another function to perform operations."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520353827, "post_id": 49135533, "comment_id": 85276029, "body": "If you&#39;re only doing lookups from this map by its values and not its keys, then its backwards. The key should be what you&#39;re looking up with, that&#39;s the purpose of a map."}, {"owner": {"reputation": 2653, "user_id": 433296, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/710872018/picture?type=large", "display_name": "Travis", "link": "https://stackoverflow.com/users/433296/travis"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520353946, "post_id": 49135533, "comment_id": 85276118, "body": "I might have five alarm names that all have the same instanceid in the values section. I could not use the instanceid as the key. Maybe I needed a different data structure."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1520354023, "post_id": 49135533, "comment_id": 85276169, "body": "I would say so. Perhaps a map of instance IDs to a slice of alarms for each."}, {"owner": {"reputation": 2653, "user_id": 433296, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/710872018/picture?type=large", "display_name": "Travis", "link": "https://stackoverflow.com/users/433296/travis"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520354120, "post_id": 49135533, "comment_id": 85276233, "body": "Ok that sounds interesting. I will have to look into that. Thanks"}], "owner": {"reputation": 2653, "user_id": 433296, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/710872018/picture?type=large", "display_name": "Travis", "link": "https://stackoverflow.com/users/433296/travis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1520355799, "creation_date": 1520353368, "last_edit_date": 1520355799, "question_id": 49135533, "link": "https://stackoverflow.com/questions/49135533/finding-map-items-that-have-a-value-that-matches-an-array-of-string", "title": "Finding map items that have a value that matches an array of string?", "body": "<p>I have my code working but I am sure that it is not optimal. </p>\n\n<p>I am building a Map[string]string that contains my alarm names as keys and instanceids as values. I have an array that has just instanceids in it. I need to remove any keys from the map that have values that match the instanceids in the array. Then return a []string of alarm names. My code is working but thought that it would be good to see if I did this remotely correct. The []string in the return is optional I could probably just use the map.</p>\n\n<p>Thanks for the input.  </p>\n\n<pre><code>func CheckAlarms(alarmMap map[string]string, instances []string) (result []string)  {\n\n    var AlarmList []string\n\n    for _, inst := range instances{\n\n        for k, v := range alarmMap{\n\n            if v == inst{\n                log.Printf(\"**** Match Found add alarm to delete list %s\\n\", k)\n                delete(alarmMap, k)\n            }\n        }\n\n    }\n\n    for k, v := range alarmMap{\n        var inst []string\n\n\n        AlarmList = append(AlarmList, k)\n        inst = append(inst, v)\n\n    }\n\n    log.Printf(\"end of function list length %d\", len(AlarmList))\nreturn AlarmList\n}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "base64"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520353027, "post_id": 49135097, "comment_id": 85275508, "body": "You may be able to do what you want by implementing the <a href=\"https://godoc.org/golang.org/x/text/transform\" rel=\"nofollow noreferrer\">Transformer</a> interface with a wrapper around <code>base64.Encoding</code> and the calling <a href=\"https://godoc.org/golang.org/x/text/transform#NewReader\" rel=\"nofollow noreferrer\">NewReader</a>... but I haven&#39;t tried this myself so I don&#39;t really know if it&#39;s doable."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1520353273, "post_id": 49135097, "comment_id": 85275681, "body": "Seems you are looking for <a href=\"https://golang.org/pkg/io/#Pipe\" rel=\"nofollow noreferrer\">golang.org/pkg/io/#Pipe</a>?"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 8, "last_activity_date": 1520367962, "last_edit_date": 1520367962, "creation_date": 1520353268, "answer_id": 49135506, "question_id": 49135097, "link": "https://stackoverflow.com/questions/49135097/base64-encode-io-reader/49135506#49135506", "title": "base64 encode io.Reader", "body": "<p>The concept of a Pipe is used to change Readers into Writers and vice-versa.</p>\n\n<p>Using an <a href=\"https://golang.org/pkg/io/#Pipe\" rel=\"nofollow noreferrer\"><code>io.Pipe</code></a>, you can copy the source <code>io.Reader</code> into the encoder, and pass the <a href=\"https://golang.org/pkg/io/#PipeReader\" rel=\"nofollow noreferrer\"><code>io.PipeReader</code></a> as the body to be uploaded.</p>\n\n<p>The error handling is a little unusual if you want to pass it through, but it's possible using the <a href=\"https://golang.org/pkg/io/#PipeWriter.CloseWithError\" rel=\"nofollow noreferrer\"><code>CloseWithError</code></a> method. Make sure you also note the correct order to close the pipe and encoder.</p>\n\n<pre><code>source := strings.NewReader(\"Hello, World!\")\n\npr, pw := io.Pipe()\nencoder := base64.NewEncoder(base64.StdEncoding, pw)\n\ngo func() {\n    _, err := io.Copy(encoder, source)\n    encoder.Close()\n\n    if err != nil {\n        pw.CloseWithError(err)\n    } else {\n        pw.Close()\n    }\n}()\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/qvc1f7kyTeP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qvc1f7kyTeP</a></p>\n"}], "owner": {"reputation": 825, "user_id": 193539, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d2d22153d8fdaf387f0e5ca3b4e25f63?s=128&d=identicon&r=PG", "display_name": "AC.", "link": "https://stackoverflow.com/users/193539/ac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1564, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1582160153, "creation_date": 1520351897, "last_edit_date": 1520352826, "question_id": 49135097, "link": "https://stackoverflow.com/questions/49135097/base64-encode-io-reader", "title": "base64 encode io.Reader", "body": "<p>Is there a way to take an io.Reader that contains binary data, and read it out base64 encoded. </p>\n\n<p>I see in encoding/base64 there is</p>\n\n<pre><code>func NewDecoder(enc *Encoding, r io.Reader) io.Reader\n</code></pre>\n\n<p>but that assumes the io.Reader data is base64 and returns an io.Reader to decode it to binary.</p>\n\n<p>and </p>\n\n<pre><code>func NewEncoder(enc *Encoding, w io.Writer) io.WriteCloser\n</code></pre>\n\n<p>which returns a io.Writer to encode binary to base64 but I'm need to use the go-aws-sdk s3manage Uploader, which takes an io.Reader interface. </p>\n\n<pre><code>uploader := s3manager.NewUploaderWithClient(svc)\n_, err := uploader.Upload(&amp;s3manager.UploadInput{\n   Bucket: aws.String(bucket),\n  Key:    aws.String(key),\n  Body:   input,\n})\n</code></pre>\n\n<p>input needs implement the io.Reader interface</p>\n\n<p>The data is large, so I don't want to read the input fully into memory before doing the encoding </p>\n"}, {"tags": ["go", "reflection", "deepequals"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1520351835, "post_id": 49133156, "comment_id": 85274678, "body": "You may find these interesting. <a href=\"https://github.com/google/go-cmp\" rel=\"nofollow noreferrer\">Package for equality of Go values: google/go-cmp</a>. <a href=\"https://medium.com/@zombiezen/life-of-a-go-infrastructure-maintainer-cb1419308eb5\" rel=\"nofollow noreferrer\">Life of a Go Infrastructure Maintainer</a>."}], "answers": [{"comments": [{"owner": {"reputation": 43895, "user_id": 25645, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b02cab91fb3c5604163c116c494de2a5?s=128&d=identicon&r=PG", "display_name": "Nathan H", "link": "https://stackoverflow.com/users/25645/nathan-h"}, "edited": false, "score": 0, "creation_date": 1520347294, "post_id": 49133353, "comment_id": 85271466, "body": "Understood. I assumed they would both be interfaces, or both []string. I guess this would fall under &quot;Values of distinct types are never deeply equal.&quot;. What can I do to make them of the same type to I can compare?"}, {"owner": {"reputation": 43895, "user_id": 25645, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b02cab91fb3c5604163c116c494de2a5?s=128&d=identicon&r=PG", "display_name": "Nathan H", "link": "https://stackoverflow.com/users/25645/nathan-h"}, "edited": false, "score": 0, "creation_date": 1520347907, "post_id": 49133353, "comment_id": 85271915, "body": "Got it! Instead of declaring my targetValue with literal values, I use <code>append()</code>. Doing this preserves the <code>[]interface{}</code> type."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 43895, "user_id": 25645, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b02cab91fb3c5604163c116c494de2a5?s=128&d=identicon&r=PG", "display_name": "Nathan H", "link": "https://stackoverflow.com/users/25645/nathan-h"}, "edited": false, "score": 2, "creation_date": 1520347948, "post_id": 49133353, "comment_id": 85271945, "body": "The easy way in your specific case would be: <code>var targetValue interface{} = []interface{}{&quot;a&quot;, &quot;b&quot;}</code>"}, {"owner": {"reputation": 43895, "user_id": 25645, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b02cab91fb3c5604163c116c494de2a5?s=128&d=identicon&r=PG", "display_name": "Nathan H", "link": "https://stackoverflow.com/users/25645/nathan-h"}, "edited": false, "score": 0, "creation_date": 1520348041, "post_id": 49133353, "comment_id": 85272015, "body": "Indeed that&#39;s even better. Can you update your answer?"}, {"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1520348118, "post_id": 49133353, "comment_id": 85272075, "body": "yeap, as @Flimzy mentioned, if you declare it as []interface{}, then the types would be same and hence, reflect would deep equal should give out true - <a href=\"https://play.golang.org/p/iN3STrExW64\" rel=\"nofollow noreferrer\">play.golang.org/p/iN3STrExW64</a>"}, {"owner": {"reputation": 43895, "user_id": 25645, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b02cab91fb3c5604163c116c494de2a5?s=128&d=identicon&r=PG", "display_name": "Nathan H", "link": "https://stackoverflow.com/users/25645/nathan-h"}, "edited": false, "score": 0, "creation_date": 1520407847, "post_id": 49133353, "comment_id": 85297390, "body": "@Flimzy can you update your answer with your suggestion, so the answer will be complete?"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 4, "last_activity_date": 1520347009, "creation_date": 1520347009, "answer_id": 49133353, "question_id": 49133156, "link": "https://stackoverflow.com/questions/49133156/deepequal-interface/49133353#49133353", "title": "DeepEqual []interface{}", "body": "<p>You're comparing a <code>[]interface{}</code> against <code>[]string</code>, which should never be equal.</p>\n\n<pre><code>if reflect.DeepEqual(value.([]interface{}), targetValue) {\n</code></pre>\n\n<p>compared against <code>targetValue</code> which is of type <code>[]string</code>:</p>\n\n<pre><code>var targetValue interface{} = []string{\"a\", \"c\"}\n</code></pre>\n"}], "owner": {"reputation": 43895, "user_id": 25645, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b02cab91fb3c5604163c116c494de2a5?s=128&d=identicon&r=PG", "display_name": "Nathan H", "link": "https://stackoverflow.com/users/25645/nathan-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 705, "favorite_count": 2, "answer_count": 1, "score": 0, "last_activity_date": 1520347163, "creation_date": 1520346481, "last_edit_date": 1520347163, "question_id": 49133156, "link": "https://stackoverflow.com/questions/49133156/deepequal-interface", "title": "DeepEqual []interface{}", "body": "<p>Looking at the following golang code:</p>\n\n<pre><code>b := []byte(`[\"a\", \"b\"]`)\nvar value interface{}\njson.Unmarshal(b, &amp;value)\nfmt.Println(value)                 // Print [a b]\nfmt.Println(reflect.TypeOf(value)) //Print []interface {}\nvar targetValue interface{} = []string{\"a\", \"b\"}\nif reflect.DeepEqual(value.([]interface{}), targetValue) {\n    t.Error(\"please be equal\")\n}\n</code></pre>\n\n<p>Am I expecting too much of <code>DeepEqual</code>? Reading the documentation, the following statements reinforce my assumption that it should work:</p>\n\n<ul>\n<li>Array values are deeply equal when their corresponding elements are deeply equal.</li>\n<li>Interface values are deeply equal if they hold deeply equal concrete values.</li>\n<li>Slice values are deeply equal when (...) or their corresponding elements (up to length) are deeply equal.</li>\n</ul>\n\n<p>What am I missing here?</p>\n"}, {"tags": ["postgresql", "go", "wal"], "comments": [{"owner": {"reputation": 197, "user_id": 6213176, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5524a528bd15219e53c4ad75e1408bcd?s=128&d=identicon&r=PG&f=1", "display_name": "Noobie", "link": "https://stackoverflow.com/users/6213176/noobie"}, "edited": false, "score": 0, "creation_date": 1552483334, "post_id": 49132523, "comment_id": 97026092, "body": "I don&#39;t have an answer for this but just wanted to know where you receiving Heartbeat message. I&#39;m ain&#39;t getting any?"}, {"owner": {"reputation": 53, "user_id": 1388749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a72fde5e568193de203c41d27c7e1207?s=128&d=identicon&r=PG", "display_name": "Siddhant", "link": "https://stackoverflow.com/users/1388749/siddhant"}, "reply_to_user": {"reputation": 197, "user_id": 6213176, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5524a528bd15219e53c4ad75e1408bcd?s=128&d=identicon&r=PG&f=1", "display_name": "Noobie", "link": "https://stackoverflow.com/users/6213176/noobie"}, "edited": false, "score": 0, "creation_date": 1552590600, "post_id": 49132523, "comment_id": 97079805, "body": "@Noobie: Here <a href=\"https://github.com/sidmutha/pgdeltastream/blob/master/db/lr.go#L61\" rel=\"nofollow noreferrer\">github.com/sidmutha/pgdeltastream/blob/master/db/lr.go#L61</a>   you&#39;ll have to explore the code a bit to understand but this is how I was doing it"}], "owner": {"reputation": 53, "user_id": 1388749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a72fde5e568193de203c41d27c7e1207?s=128&d=identicon&r=PG", "display_name": "Siddhant", "link": "https://stackoverflow.com/users/1388749/siddhant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 871, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1520344519, "creation_date": 1520344519, "question_id": 49132523, "link": "https://stackoverflow.com/questions/49132523/using-postgresql-logical-replication-in-go", "title": "Using PostgreSQL Logical Replication in Go", "body": "<p>I'm working on using Postgres logical replication in Go using the <a href=\"https://github.com/jackc/pgx\" rel=\"nofollow noreferrer\">pgx</a> library to get database changes via a logical replication slot using wal2json as the output plugin. The Postgres version being used is <code>v10.1</code>.</p>\n\n<p>When in the <code>WaitForReplicationMessage</code> loop, I receive a message, and if that message is a <a href=\"https://godoc.org/github.com/jackc/pgx#ServerHeartbeat\" rel=\"nofollow noreferrer\"><code>ServerHeartbeat</code></a>, I <a href=\"https://godoc.org/github.com/jackc/pgx#ReplicationConn.SendStandbyStatus\" rel=\"nofollow noreferrer\">send a standby status</a> message to update the server of my consumed position in  the WAL.  This <a href=\"https://godoc.org/github.com/jackc/pgx#StandbyStatus\" rel=\"nofollow noreferrer\"><code>StandbyStatus</code></a> message has a field called <code>ReplyRequested</code> which, if equals <code>1</code> tells the server to send a <code>ServerHeartbeat</code>; and if the value is <code>0</code> it's not supposed to do anything. </p>\n\n<p>Now I'm sending a <code>StandbyStatus</code> message with the <code>ReplyRequested</code> value to <code>0</code> (which is the default value when the object is created). On sending this, the server sends a heartbeat message despite me telling it not to. I'm unable to see the cause of this issue. </p>\n\n<p>Here's my code:</p>\n\n<pre><code>    for {\n    log.Info(\"Waiting for message\")\n\n    message, err := session.ReplConn.WaitForReplicationMessage(context.TODO())\n    if err != nil {\n        log.WithError(err).Errorf(\"%s\", reflect.TypeOf(err))\n        continue\n    }\n\n    if message.WalMessage != nil {\n        log.Info(string(message.WalMessage.WalData))\n    } else if message.ServerHeartbeat != nil {\n        log.Info(\"Heartbeat requested\")\n        // set the flushed LSN (and other LSN values) in the standby status and send to PG\n        log.Info(message.ServerHeartbeat)\n\n        // send Standby Status with the LSN position            \n        err = session.sendStandbyStatus()\n        if err != nil {\n            log.WithError(err).Error(\"Unable to send standby status\")\n        }\n\n    }\n}\n</code></pre>\n\n<p>The <code>sendStandbyStatus</code> function above is:</p>\n\n<pre><code>func (session *Session) sendStandbyStatus() error {\n  standbyStatus, err := pgx.NewStandbyStatus(session.RestartLSN)\n  if err != nil {\n      return err\n  }\n  log.Info(standbyStatus) // the output of this confirms ReplyRequested is indeed 0\n  standbyStatus.ReplyRequested = 0 // still set it\n  err = session.ReplConn.SendStandbyStatus(standbyStatus)\n  if err != nil {\n      return err\n  }\n  return nil\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 0, "creation_date": 1520343325, "post_id": 49132065, "comment_id": 85268899, "body": "If the absence of the dependency makes your application useless and implies an unrecoverable error, you may well panic the app. Panic ends the applciation, so do it when you need to fix something and re-launch the app."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1520343605, "post_id": 49132065, "comment_id": 85269059, "body": "That depends on your needs. In some cases, a panic is ideal. In other cases, a panic is absolutely the worst answer, and a better answer is a retry-loop, a cache fallback, a &quot;service unavailable&quot; message, or any countless number of other fault-tolerance strategies."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1520344955, "post_id": 49132065, "comment_id": 85269939, "body": "This is 100% situational and no one can answer this question for you. I would generally say though that a literal <code>panic</code> is probably unnecessary, as in the case of something like this you probably don&#39;t need the stack trace. Just log and exit."}, {"owner": {"reputation": 3250, "user_id": 4801289, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/I0puU.jpg?s=128&g=1", "display_name": "Ismail H", "link": "https://stackoverflow.com/users/4801289/ismail-h"}, "edited": false, "score": 0, "creation_date": 1520360747, "post_id": 49132065, "comment_id": 85280263, "body": "Adrian, exiting the app is a better solution for you rather than looping around a log or doing a &quot;pool retry&quot; ?"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1520352260, "creation_date": 1520352260, "answer_id": 49135209, "question_id": 49132065, "link": "https://stackoverflow.com/questions/49132065/should-a-go-app-panic-if-it-doesnt-find-external-dependencies-services/49135209#49135209", "title": "Should a Go app panic if it doesn&#39;t find external dependencies/services", "body": "<p>Here's an example from the Go standard library.</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/crypto/\" rel=\"nofollow noreferrer\">Package crypto</a></p>\n\n<pre><code>import \"crypto\" \n</code></pre>\n  \n  <p><a href=\"https://golang.org/pkg/crypto/#Hash.New\" rel=\"nofollow noreferrer\">func (Hash) New</a></p>\n\n<pre><code>func (h Hash) New() hash.Hash\n</code></pre>\n  \n  <p>New returns a new hash.Hash calculating the given hash function. New\n  panics if the hash function is not linked into the binary.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 1, "last_activity_date": 1520377558, "creation_date": 1520377558, "answer_id": 49141494, "question_id": 49132065, "link": "https://stackoverflow.com/questions/49132065/should-a-go-app-panic-if-it-doesnt-find-external-dependencies-services/49141494#49141494", "title": "Should a Go app panic if it doesn&#39;t find external dependencies/services", "body": "<p>An application that has no access to the <strong>external</strong> network service <strong>should not panic</strong>. This should be expected as networks tend to fail. I would wrap the error and pass it further.</p>\n\n<p>Consider the following scenario. You have multiple application servers connected to two database servers. You are upgrading the database servers one at a time. When one is turned off half of your application servers panicked and crashed. You upgrade the second database server and every application server is gone now. Instead, when the database is not available just report an error for instance by sending HTTP status 500. If you have a load balancer it will pass the request to the working applications servers. When the database server is back, the application servers reconnect and continue to work.</p>\n\n<p>Another scenario, you are running an interactive application that processes a database to create a report. The connection is not available. The application panicked and crashed. From the user perspective, it looks like a bug. I would expect a message that connection cannot be established.</p>\n\n<p>In the standard library it is accepted to panic when an <strong>internal</strong> resource is not available. See <a href=\"https://golang.org/pkg/text/template/#Must\" rel=\"nofollow noreferrer\">template.Must</a>. This means something is wrong with the application itself.</p>\n"}], "owner": {"reputation": 3250, "user_id": 4801289, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/I0puU.jpg?s=128&g=1", "display_name": "Ismail H", "link": "https://stackoverflow.com/users/4801289/ismail-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 1, "closed_date": 1520375772, "accepted_answer_id": 49141494, "answer_count": 2, "score": -1, "last_activity_date": 1520377558, "creation_date": 1520343118, "last_edit_date": 1520360616, "question_id": 49132065, "link": "https://stackoverflow.com/questions/49132065/should-a-go-app-panic-if-it-doesnt-find-external-dependencies-services", "closed_reason": "Opinion-based", "title": "Should a Go app panic if it doesn&#39;t find external dependencies/services", "body": "<p>How should a Golang app handle missing external dependencies ? \nWhen a app starts and it doesn't find the database it is supposed to persist the data on, knowing the app is useless in that state, should I panic the app ?</p>\n\n<p>I can otherwise log infinitely something, print to stderr, or use another method to notify, but I'm not sure when to choose each method.</p>\n"}, {"tags": ["json", "go", "types"], "comments": [{"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1520340023, "post_id": 49131035, "comment_id": 85266658, "body": "instead of holding types in the map, why dont you have func. like <code>map[string]func(b []byte) (interface{}, error)</code>"}, {"owner": {"reputation": 113, "user_id": 1831606, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/49b2850e110762063f19c7d0fe5772d4?s=128&d=identicon&r=PG", "display_name": "Soma", "link": "https://stackoverflow.com/users/1831606/soma"}, "reply_to_user": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1520340489, "post_id": 49131035, "comment_id": 85266997, "body": "@vedhavyas But how would I tell the Unmarshal functions in which type to unmarshal the json data into? I dont want the normal <code>map[string]interface{}</code> data to be passed to the callback function and then need to test for every key and every type in the callback itself."}, {"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1520340592, "post_id": 49131035, "comment_id": 85267061, "body": "Ahh okay. Let me think and get back"}, {"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1520340793, "post_id": 49131035, "comment_id": 85267210, "body": "one way i could think of is to make all the types implement an interface type and your funcs can return that interface instead."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1552892789, "post_id": 49131035, "comment_id": 97167277, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/50092462/how-to-unmarshal-an-inconsistent-json-field-that-can-be-a-string-or-an-array-o\">How to Unmarshal an inconsistent JSON field that can be a string *or* an array of string?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 113, "user_id": 1831606, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/49b2850e110762063f19c7d0fe5772d4?s=128&d=identicon&r=PG", "display_name": "Soma", "link": "https://stackoverflow.com/users/1831606/soma"}, "is_accepted": false, "score": 1, "last_activity_date": 1520349946, "creation_date": 1520349946, "answer_id": 49134367, "question_id": 49131035, "link": "https://stackoverflow.com/questions/49131035/dynamic-type-in-unmarshal/49134367#49134367", "title": "Dynamic Type in Unmarshal", "body": "<p>Ok, after reasearching, I think what I wanted to achive is not possible, because the type needs to be know at compile time, as it has been mentioned here:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/27971895/golang-cast-an-interface-to-a-typed-variable-dynamically\">Golang: cast an interface to a typed variable dynamically</a></p>\n\n<p>But I think I can just pass the raw JSON string to the listener callback and Unmarshal the data in that function where the type of the data is known.</p>\n\n<p>Thanks for all contributions!</p>\n"}], "owner": {"reputation": 113, "user_id": 1831606, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/49b2850e110762063f19c7d0fe5772d4?s=128&d=identicon&r=PG", "display_name": "Soma", "link": "https://stackoverflow.com/users/1831606/soma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 381, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1520349946, "creation_date": 1520339836, "last_edit_date": 1520340501, "question_id": 49131035, "link": "https://stackoverflow.com/questions/49131035/dynamic-type-in-unmarshal", "title": "Dynamic Type in Unmarshal", "body": "<p>I currently having the following problem:</p>\n\n<p>I get a []byte / string via websocket which looks like</p>\n\n<pre><code>eventname {\"JSON\": \"data\", \"In\": \"different formats\"}\n</code></pre>\n\n<p>I split the string by the whitespace between the eventname and the JSON data and, <strong>depending on the eventname</strong>, I want to json.Unmarshal() the JSON data into a specific type or a var of a specific type, to make sure its all type safe.</p>\n\n<p>So I would probably have a map which holds all the possible eventnames and the corresponding type for the JSON data, but im not sure how I would save a type, maybe by reference or by the stringified name?</p>\n\n<pre><code>type EventTypeList map[string]*interface{}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>type EventTypeList map[string]string\n</code></pre>\n\n<p>So I can lookup if the event is in the EventTypeList and then let the Unmarshal func parse the data into the type from the map.</p>\n\n<p>So basicly instead of the specific type \"SpecificData\":</p>\n\n<pre><code>type SpecificData struct {\n    JSON string\n    In   string\n}\n\nsocketData := SpecificData{}\nerr := json.Unmarshal(jsonData, &amp;socketData)\n</code></pre>\n\n<p>I want to dynamically create the socketData var by the type from the EventTypeList</p>\n\n<pre><code>socketData := [dynamically determine this Type from EventTypeList]{}\n</code></pre>\n\n<p>After I parsed the data into that type, I want to call all listeners for that event and give them the socketData with the right type, so they can work with the expected data.</p>\n\n<p>But im really not sure how I would accomplish this, if this is even possible or if this is even the right way...</p>\n\n<p>Thanks for any help!</p>\n"}, {"tags": ["go", "grpc"], "comments": [{"owner": {"reputation": 4770, "user_id": 437456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4f94c406a23f583b2bde99f8554db54d?s=128&d=identicon&r=PG", "display_name": "DMac the Destroyer", "link": "https://stackoverflow.com/users/437456/dmac-the-destroyer"}, "edited": false, "score": 1, "creation_date": 1520553604, "post_id": 49130970, "comment_id": 85374850, "body": "could you post your server implementation code as well?"}, {"owner": {"reputation": 845, "user_id": 440219, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/8b658c73309d8f1024913817cb1021cf?s=128&d=identicon&r=PG", "display_name": "Jamie", "link": "https://stackoverflow.com/users/440219/jamie"}, "reply_to_user": {"reputation": 4770, "user_id": 437456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4f94c406a23f583b2bde99f8554db54d?s=128&d=identicon&r=PG", "display_name": "DMac the Destroyer", "link": "https://stackoverflow.com/users/437456/dmac-the-destroyer"}, "edited": false, "score": 0, "creation_date": 1520586468, "post_id": 49130970, "comment_id": 85385297, "body": "I have provided some sever code"}, {"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1521088646, "post_id": 49130970, "comment_id": 85586005, "body": "Can you provide a minimal git repo for debugging? It might get you the solution faster"}, {"owner": {"reputation": 9117, "user_id": 909199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8df8811a42e909801c22fcfa01f4c36d?s=128&d=identicon&r=PG", "display_name": "Peter Wishart", "link": "https://stackoverflow.com/users/909199/peter-wishart"}, "edited": false, "score": 0, "creation_date": 1523526729, "post_id": 49130970, "comment_id": 86601086, "body": "Out of interest, is there a reason my answer didn&#39;t work for you?"}], "answers": [{"comments": [{"owner": {"reputation": 845, "user_id": 440219, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/8b658c73309d8f1024913817cb1021cf?s=128&d=identicon&r=PG", "display_name": "Jamie", "link": "https://stackoverflow.com/users/440219/jamie"}, "edited": false, "score": 0, "creation_date": 1520888266, "post_id": 49212165, "comment_id": 85492478, "body": "when I do this the trailers are always empty"}, {"owner": {"reputation": 996, "user_id": 4909445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ded7e867ff7001048e511974d4c19137?s=128&d=identicon&r=PG&f=1", "display_name": "Shettyh", "link": "https://stackoverflow.com/users/4909445/shettyh"}, "reply_to_user": {"reputation": 845, "user_id": 440219, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/8b658c73309d8f1024913817cb1021cf?s=128&d=identicon&r=PG", "display_name": "Jamie", "link": "https://stackoverflow.com/users/440219/jamie"}, "edited": false, "score": 0, "creation_date": 1520931665, "post_id": 49212165, "comment_id": 85507255, "body": "@Jamie can you share the code how you are adding the trailer in interceptor ?"}], "tags": [], "owner": {"reputation": 996, "user_id": 4909445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ded7e867ff7001048e511974d4c19137?s=128&d=identicon&r=PG&f=1", "display_name": "Shettyh", "link": "https://stackoverflow.com/users/4909445/shettyh"}, "is_accepted": false, "score": 0, "last_activity_date": 1520704099, "creation_date": 1520704099, "answer_id": 49212165, "question_id": 49130970, "link": "https://stackoverflow.com/questions/49130970/graceful-shutdown-of-grpc-downstream/49212165#49212165", "title": "Graceful shutdown of gRPC downstream", "body": "<p>According to the grpc go documentation</p>\n\n<blockquote>\n  <p>Trailer returns the trailer metadata from the server, if there is any.\n  <em>It must only be called after stream.CloseAndRecv has returned, or\n   stream.Recv has returned a non-nil error (including io.EOF)</em>.</p>\n</blockquote>\n\n<p>So if you want to read the trailer in client try something like this</p>\n\n<pre><code>ctxDownstream, cancel := context.WithCancel(ctx)\ndefer cancel()\nfor {\n  ...\n  // on error or EOF\n  break;\n}\nprintln(fmt.Sprintf(\"%v\", downstream.Trailer()))\n</code></pre>\n\n<p>Break from the infinate loop when there is a error and print the trailer. <code>cancel</code> will be called at the end of the function as it is deferred.</p>\n"}, {"tags": [], "owner": {"reputation": 9117, "user_id": 909199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8df8811a42e909801c22fcfa01f4c36d?s=128&d=identicon&r=PG", "display_name": "Peter Wishart", "link": "https://stackoverflow.com/users/909199/peter-wishart"}, "is_accepted": false, "score": 0, "last_activity_date": 1521454637, "last_edit_date": 1521454637, "creation_date": 1521152437, "answer_id": 49310161, "question_id": 49130970, "link": "https://stackoverflow.com/questions/49130970/graceful-shutdown-of-grpc-downstream/49310161#49310161", "title": "Graceful shutdown of gRPC downstream", "body": "<p>I can't find a reference that explains it clearly, but this doesn't appear to be possible.</p>\n\n<p>On the wire, <code>grpc-status</code> is followed by the trailer metadata when the call completes normally (i.e. the server exits the call).\nWhen the client cancels the call, neither of these are sent.</p>\n\n<p>Seems that gRPC treats call cancellation as a quick abort of the rpc, not much different than the socket being dropped.</p>\n\n<p>Adding a \"cancel message\" via request streaming works; the server can pick this up and cancel the stream from its end and trailers will still get sent:</p>\n\n<pre><code>message SimpleRequest {\n    oneof RequestType {\n        int64 number = 1;\n        bool cancel = 2;\n    }\n}\n....\nrpc Downstream(stream SimpleRequest) returns (stream SimpleResponse);\n</code></pre>\n\n<p>Although this does add a bit of complication to the code.</p>\n"}], "owner": {"reputation": 845, "user_id": 440219, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/8b658c73309d8f1024913817cb1021cf?s=128&d=identicon&r=PG", "display_name": "Jamie", "link": "https://stackoverflow.com/users/440219/jamie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2866, "favorite_count": 6, "answer_count": 2, "score": 4, "last_activity_date": 1521454637, "creation_date": 1520339621, "last_edit_date": 1520586299, "question_id": 49130970, "link": "https://stackoverflow.com/questions/49130970/graceful-shutdown-of-grpc-downstream", "title": "Graceful shutdown of gRPC downstream", "body": "<p>Using the following proto buffer code :</p>\n\n<pre><code>syntax = \"proto3\";\n\npackage pb;\n\nmessage SimpleRequest {\n    int64 number = 1;\n}\n\nmessage SimpleResponse {\n    int64 doubled = 1;\n}\n\n// All the calls in this serivce preform the action of doubling a number.\n// The streams will continuously send the next double, eg. 1, 2, 4, 8, 16.\nservice Test {\n    // This RPC streams from the server only.\n    rpc Downstream(SimpleRequest) returns (stream SimpleResponse);\n}\n</code></pre>\n\n<p>I'm able to successfully open a stream, and continuously get the next doubled number from the server.</p>\n\n<p>My go code for running this looks like :</p>\n\n<pre><code>ctxDownstream, cancel := context.WithCancel(ctx)\ndownstream, err := testClient.Downstream(ctxDownstream, &amp;pb.SimpleRequest{Number: 1})\nfor {\n    responseDownstream, err := downstream.Recv()\n    if err != io.EOF {\n        println(fmt.Sprintf(\"downstream response: %d, error: %v\", responseDownstream.Doubled, err))\n\n        if responseDownstream.Doubled &gt;= 32 {\n            break\n        }\n    }\n}\ncancel() // !!This is not a graceful shutdown\nprintln(fmt.Sprintf(\"%v\", downstream.Trailer()))\n</code></pre>\n\n<p>The problem I'm having is using a context cancellation means my downstream.Trailer() response is empty. Is there a way to gracefully close this connection from the client side and receive downstream.Trailer().</p>\n\n<p>Note: if I close the downstream connection from the server side, my trailers are populated. But I have no way of instructing my server side to close this particular stream. So there must be a way to gracefully close a stream client side.</p>\n\n<p>Thanks.</p>\n\n<p>As requested some server code : </p>\n\n<pre><code>func (b *binding) Downstream(req *pb.SimpleRequest, stream pb.Test_DownstreamServer) error {\n    request := req\n\n    r := make(chan *pb.SimpleResponse)\n    e := make(chan error)\n    ticker := time.NewTicker(200 * time.Millisecond)\n    defer func() { ticker.Stop(); close(r); close(e) }()\n\n    go func() {\n        defer func() { recover() }()\n        for {\n            select {\n            case &lt;-ticker.C:\n                response, err := b.Endpoint(stream.Context(), request)\n                if err != nil {\n                    e &lt;- err\n                }\n                r &lt;- response\n            }\n        }\n    }()\n\n    for {\n        select {\n        case err := &lt;-e:\n            return err\n        case response := &lt;-r:\n            if err := stream.Send(response); err != nil {\n                return err\n            }\n            request.Number = response.Doubled\n        case &lt;-stream.Context().Done():\n            return nil\n        }\n    }\n}\n</code></pre>\n\n<p>You will still need to populate the trailer with some information. I use the grpc.StreamServerInterceptor to do this.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 3, "creation_date": 1520337120, "post_id": 49130153, "comment_id": 85264760, "body": "Define \u2018<i>necessary</i>\u2019."}], "answers": [{"comments": [{"owner": {"reputation": 194, "user_id": 3917195, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b8ad0b585812c3df7d5fbbf751c1926d?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhi Agarwal", "link": "https://stackoverflow.com/users/3917195/nidhi-agarwal"}, "edited": false, "score": 0, "creation_date": 1520338007, "post_id": 49130238, "comment_id": 85265300, "body": "So for example i am executing a function of some other package. The output can be of any type. If i directly assign value to a variable i am making it loosely coupled. By restricting the type of value things will be more predictable. Isn&#39;t is so ?"}, {"owner": {"reputation": 34006, "user_id": 20601, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z9vyi.png?s=128&g=1", "display_name": "Lucas Gabriel S&#225;nchez", "link": "https://stackoverflow.com/users/20601/lucas-gabriel-s%c3%a1nchez"}, "reply_to_user": {"reputation": 194, "user_id": 3917195, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b8ad0b585812c3df7d5fbbf751c1926d?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhi Agarwal", "link": "https://stackoverflow.com/users/3917195/nidhi-agarwal"}, "edited": false, "score": 0, "creation_date": 1520355716, "post_id": 49130238, "comment_id": 85277370, "body": "What&#39;s exactly &quot;any type&quot;? <code>interface{}</code>?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 194, "user_id": 3917195, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b8ad0b585812c3df7d5fbbf751c1926d?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhi Agarwal", "link": "https://stackoverflow.com/users/3917195/nidhi-agarwal"}, "edited": false, "score": 0, "creation_date": 1520356290, "post_id": 49130238, "comment_id": 85277698, "body": "@Nidhi Agarwal, the return value of a function is always of the type declared in the function signature. The fact that you don&#39;t repeat that type on the caller site does not reduce coupling at all."}, {"owner": {"reputation": 194, "user_id": 3917195, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b8ad0b585812c3df7d5fbbf751c1926d?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhi Agarwal", "link": "https://stackoverflow.com/users/3917195/nidhi-agarwal"}, "edited": false, "score": 0, "creation_date": 1520400372, "post_id": 49130238, "comment_id": 85294465, "body": "Makes sense. Thanks Peter."}], "tags": [], "owner": {"reputation": 34006, "user_id": 20601, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z9vyi.png?s=128&g=1", "display_name": "Lucas Gabriel S&#225;nchez", "link": "https://stackoverflow.com/users/20601/lucas-gabriel-s%c3%a1nchez"}, "is_accepted": true, "score": 2, "last_activity_date": 1520337294, "creation_date": 1520337294, "answer_id": 49130238, "question_id": 49130153, "link": "https://stackoverflow.com/questions/49130153/is-it-necessary-to-explicitly-mention-the-type-of-a-variable/49130238#49130238", "title": "Is it necessary to explicitly mention the type of a variable?", "body": "<p>Is not necessary to always write the type of a variable. Go has type inference with the <code>:=</code> operator, but sometimes you have to declare it.</p>\n\n<p>You can declare a variable in 2 ways:</p>\n\n<ul>\n<li><code>var age int</code></li>\n<li><code>age := 12</code></li>\n</ul>\n\n<p>On the first one you declare a variable called <code>age</code> of type <code>int</code> but no value. You can set the value later or assign it right there as <code>var age int = 12</code></p>\n\n<p>On the second one you declare a variable called <code>age</code> of type <code>int</code> (because 12 is <code>int</code>)</p>\n\n<p>Local variables usually get assigned and declared with <code>:=</code> where package variables is good to declare with <code>var x Type</code></p>\n"}], "owner": {"reputation": 194, "user_id": 3917195, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b8ad0b585812c3df7d5fbbf751c1926d?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhi Agarwal", "link": "https://stackoverflow.com/users/3917195/nidhi-agarwal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "closed_date": 1520341724, "accepted_answer_id": 49130238, "answer_count": 1, "score": -5, "last_activity_date": 1520339457, "creation_date": 1520336982, "last_edit_date": 1520337105, "question_id": 49130153, "link": "https://stackoverflow.com/questions/49130153/is-it-necessary-to-explicitly-mention-the-type-of-a-variable", "closed_reason": "Opinion-based", "title": "Is it necessary to explicitly mention the type of a variable?", "body": "<p>I have heard that it is always good to define variable type when you declare a variable but wherever I see Go code, be it any package or library or blog, I find the short way to define variables without mentioning the type.</p>\n"}, {"tags": ["json", "go", "io"], "comments": [{"owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1520344347, "post_id": 49130026, "comment_id": 85269547, "body": "@Volker Maybe there are some <code>go</code> libraries which can handle such cases?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1520349846, "post_id": 49130026, "comment_id": 85273233, "body": "Then SO is the wrong place to look for such. But honestly: writing a , to a file doesn&#39;t require a dedicated package. The overhead to import something like this is bigger than just writing the ,."}], "answers": [{"comments": [{"owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "edited": false, "score": 0, "creation_date": 1520336883, "post_id": 49130078, "comment_id": 85264623, "body": "it breaks a workflow, because I want to get an <code>json</code> object and then store it to file in a loop."}, {"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1520336990, "post_id": 49130078, "comment_id": 85264686, "body": "if that is the case, you would need to write each one in different file"}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1520337004, "post_id": 49130078, "comment_id": 85264694, "body": "This is the correct way of using the Go&#39;s JSON library. If you want, you can add the brackets and commas yourself to the stream but you do it at your own risk. It is not hard to do it but it will not stand a code review."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "reply_to_user": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "edited": false, "score": 0, "creation_date": 1520339919, "post_id": 49130078, "comment_id": 85266584, "body": "@RomaKarageorgievich I added a not on JSON Streaming, you may find it useful."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 3, "last_activity_date": 1520339895, "last_edit_date": 1520339895, "creation_date": 1520336761, "answer_id": 49130078, "question_id": 49130026, "link": "https://stackoverflow.com/questions/49130026/writing-json-objects-to-file/49130078#49130078", "title": "Writing json objects to file", "body": "<p>Just make a slice of the structures and save it. This will create the JSON array.</p>\n\n<pre><code>f, _ := os.Create(\"output.json\")\ndefer f.Close()\nas := []A{\n    {Name:\"John\", Surname:\"Black\"},\n    {Name:\"Mary\", Surname:\"Brown\"},\n}\nas_json, _ := json.MarshalIndent(as, \"\", \"\\t\")\nf.Write(as_json)\n</code></pre>\n\n<p>If you really want you can separate the elements manually.</p>\n\n<pre><code>f, _ := os.Create(\"output.json\")\ndefer f.Close()\na1 := A{Name:\"John\", Surname:\"Black\"}\na2 := A{Name:\"Mary\", Surname:\"Brown\"}\n\nf.Write([]byte(\"[\\n\"))\na1_json, _ := json.MarshalIndent(a1, \"\", \"\\t\")\nf.Write([]byte(\",\\n\"))\na2_json, _ := json.MarshalIndent(a2, \"\", \"\\t\")\nf.Write([]byte(\"]\\n\"))\n\nf.Write(a1_json)\nf.Write(a2_json)\n</code></pre>\n\n<p>You can also consider using <a href=\"https://en.wikipedia.org/wiki/JSON_streaming\" rel=\"nofollow noreferrer\">JSON Streaming</a> which can achieve your goals but the syntax is slightly different.</p>\n"}, {"tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": false, "score": 1, "last_activity_date": 1520336855, "creation_date": 1520336855, "answer_id": 49130111, "question_id": 49130026, "link": "https://stackoverflow.com/questions/49130026/writing-json-objects-to-file/49130111#49130111", "title": "Writing json objects to file", "body": "<p>Put those structs into a slice and marshall the slice instead</p>\n\n<pre><code>f, err := os.Create(\"output.json\")\nif err != nil{\n   panic(err)\n}\ndefer f.Close()\na1 := A{Name:\"John\", Surname:\"Black\"}\na2 := A{Name:\"Mary\", Surname:\"Brown\"}\n\na := []A{a1, a2}\na_json, err := json.MarshalIndent(a, \"\", \"\\t\")\nif err != nil{\n   panic(err)\n}\nf.Write(a_json)\n</code></pre>\n\n<p>Also, always check for <code>err</code> wherever possible</p>\n"}], "owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1520339895, "creation_date": 1520336607, "question_id": 49130026, "link": "https://stackoverflow.com/questions/49130026/writing-json-objects-to-file", "title": "Writing json objects to file", "body": "<p>There is such workflow of writing <code>json</code> objects to file :</p>\n\n<pre><code>for {\n    Step 1. create json object\n    Step 2. Save object to file\n}\n</code></pre>\n\n<p>So I wrote such code</p>\n\n<pre><code>f, _ := os.Create(\"output.json\")\ndefer f.Close()\na1 := A{Name:\"John\", Surname:\"Black\"}\na2 := A{Name:\"Mary\", Surname:\"Brown\"}\n\na1_json, _ := json.MarshalIndent(a1, \"\", \"\\t\")\na2_json, _ := json.MarshalIndent(a2, \"\", \"\\t\")\nf.Write(a1_json)\nf.Write(a2_json)\n</code></pre>\n\n<p>As a result I have:</p>\n\n<pre><code>{\n    \"Name\": \"John\",\n    \"Surname\": \"Black\"\n}{\n    \"Name\": \"Mary\",\n    \"Surname\": \"Brown\"\n}\n</code></pre>\n\n<p>Which is not correct <code>json</code> file, because it doesn't have opening and closing braces and comma like this:</p>\n\n<pre><code>[\n  {\n    \"Name\": \"John\",\n    \"Surname\": \"Black\"\n  },\n  {\n    \"Name\": \"Mary\",\n    \"Surname\": \"Brown\"\n  }\n]\n</code></pre>\n\n<p>How can I write to file in an appropriate way?</p>\n"}, {"tags": ["go", "concurrency", "channel"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1520335993, "post_id": 49129631, "comment_id": 85263998, "body": "because it panics."}], "answers": [{"comments": [{"owner": {"reputation": 4842, "user_id": 1493868, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7a84611ec325ce3125ec56149b2cfcb6?s=128&d=identicon&r=PG", "display_name": "Tr\u1ea7n Kim D\u1ef1", "link": "https://stackoverflow.com/users/1493868/tr%e1%ba%a7n-kim-d%e1%bb%b1"}, "edited": false, "score": 0, "creation_date": 1520335782, "post_id": 49129733, "comment_id": 85263863, "body": "even in this case. I don&#39;t see the log printed out."}, {"owner": {"reputation": 4842, "user_id": 1493868, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7a84611ec325ce3125ec56149b2cfcb6?s=128&d=identicon&r=PG", "display_name": "Tr\u1ea7n Kim D\u1ef1", "link": "https://stackoverflow.com/users/1493868/tr%e1%ba%a7n-kim-d%e1%bb%b1"}, "edited": false, "score": 0, "creation_date": 1520338197, "post_id": 49129733, "comment_id": 85265411, "body": "so that means if we panic at main program. there is no way I can run defer in coroutine ?"}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "reply_to_user": {"reputation": 4842, "user_id": 1493868, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7a84611ec325ce3125ec56149b2cfcb6?s=128&d=identicon&r=PG", "display_name": "Tr\u1ea7n Kim D\u1ef1", "link": "https://stackoverflow.com/users/1493868/tr%e1%ba%a7n-kim-d%e1%bb%b1"}, "edited": false, "score": 0, "creation_date": 1520339341, "post_id": 49129733, "comment_id": 85266197, "body": "When the main function ends for whatever reason, the whole program ends. Goroutines have no chance to do anything at all. They are instantly killed."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "reply_to_user": {"reputation": 4842, "user_id": 1493868, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7a84611ec325ce3125ec56149b2cfcb6?s=128&d=identicon&r=PG", "display_name": "Tr\u1ea7n Kim D\u1ef1", "link": "https://stackoverflow.com/users/1493868/tr%e1%ba%a7n-kim-d%e1%bb%b1"}, "edited": false, "score": 0, "creation_date": 1520339462, "post_id": 49129733, "comment_id": 85266283, "body": "There is a way to wait for goroutines <a href=\"https://stackoverflow.com/a/26928625/450989\">stackoverflow.com/a/26928625/450989</a>"}, {"owner": {"reputation": 4842, "user_id": 1493868, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7a84611ec325ce3125ec56149b2cfcb6?s=128&d=identicon&r=PG", "display_name": "Tr\u1ea7n Kim D\u1ef1", "link": "https://stackoverflow.com/users/1493868/tr%e1%ba%a7n-kim-d%e1%bb%b1"}, "edited": false, "score": 0, "creation_date": 1520340303, "post_id": 49129733, "comment_id": 85266870, "body": "so I think in this case. we don&#39;t leak stream channel. right ?"}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 0, "last_activity_date": 1520336567, "last_edit_date": 1520336567, "creation_date": 1520335559, "answer_id": 49129733, "question_id": 49129631, "link": "https://stackoverflow.com/questions/49129631/implement-done-pattern-for-concurrency-running-but-does-not-work/49129733#49129733", "title": "Implement &quot;done&quot; pattern for concurrency running but does not work", "body": "<p>The main function should look like this:</p>\n\n<pre><code>done := make(chan interface{})\ndata := []string{\"this\", \"is\", \"a\", \"test\"}\nstream := parse(done, data)\nclose(done)\ncnt := run(stream)\nfmt.Printf(\"total: %d messages\\n\", cnt)\ntime.Sleep(time.Second)\n</code></pre>\n\n<p>The parse function sends all data before having chance to read from done channel.</p>\n\n<p>This answers your question but this does not fix all the problems in the program.</p>\n"}, {"tags": [], "owner": {"reputation": 819, "user_id": 701268, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L1UoP.jpg?s=128&g=1", "display_name": "zouying", "link": "https://stackoverflow.com/users/701268/zouying"}, "is_accepted": false, "score": 1, "last_activity_date": 1520399747, "last_edit_date": 1520399747, "creation_date": 1520398985, "answer_id": 49144484, "question_id": 49129631, "link": "https://stackoverflow.com/questions/49129631/implement-done-pattern-for-concurrency-running-but-does-not-work/49144484#49144484", "title": "Implement &quot;done&quot; pattern for concurrency running but does not work", "body": "<p>If you run code enough, you could see <code>stream closed</code>.</p>\n\n<p>Run code like the following and check the log file: </p>\n\n<pre><code>for I in `seq 1 10`; do go run main.go &gt;&gt; ./res.log 2&gt;&amp;1 ; done\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/QyROb.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QyROb.png\" alt=\"enter image description here\"></a></p>\n\n<p>I try to explain, what happened in code.</p>\n\n<ol>\n<li>First of all, defer will work even panic.</li>\n<li>Why we can't see \"stream closed\" every time? It depends on which goroutine is running, <code>main goroutine</code> or <code>the second(new) goroutine</code>.</li>\n</ol>\n\n<p>I think the statement <code>defer fmt.Println(\"stream closed\")</code> <strong>in the other goroutine</strong> cause that. When <code>panic</code> happened in <strong>main goroutine</strong>, there have two situation, the main goroutine still running or switch to the second goroutine.</p>\n\n<p>2.1, if still main goroutine running, the process will exiting because main goroutine end, and no running time for the second goroutine to run defer statement. </p>\n\n<p>2.2 if process switch to the second goroutine, the defer statement will work and \"stream closed\" will print out.</p>\n"}], "owner": {"reputation": 4842, "user_id": 1493868, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7a84611ec325ce3125ec56149b2cfcb6?s=128&d=identicon&r=PG", "display_name": "Tr\u1ea7n Kim D\u1ef1", "link": "https://stackoverflow.com/users/1493868/tr%e1%ba%a7n-kim-d%e1%bb%b1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1520399747, "creation_date": 1520335233, "last_edit_date": 1520340306, "question_id": 49129631, "link": "https://stackoverflow.com/questions/49129631/implement-done-pattern-for-concurrency-running-but-does-not-work", "title": "Implement &quot;done&quot; pattern for concurrency running but does not work", "body": "<p>I try to implement in Go \"Done\" pattern for notify error to other channel:\nHere is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc parse(done &lt;-chan interface{}, data []string) &lt;-chan string {\n    stream := make(chan string)\n    go func() {\n        defer close(stream)\n        defer fmt.Println(\"stream closed\")\n\n        for _, d := range data {\n            m := fmt.Sprintf(\"[%s]\", d)\n            select {\n            case &lt;-done:\n                fmt.Println(\"&gt;&gt;done&lt;&lt;\")\n                return\n            case stream &lt;- m:\n                fmt.Printf(\"sent %s to stream\\n\", m)\n            }\n        }\n    }()\n    return stream\n}\n\nfunc run(migrations &lt;-chan string) int {\n    cnt := 0\n    for m := range migrations {\n        if m == \"[a]\" {\n            panic(\"unexpected error\")\n        }\n        fmt.Println(m)\n        cnt++\n    }\n    return cnt\n}\n\nfunc main() {\n    done := make(chan interface{})\n    defer close(done)\n    data := []string{\"this\", \"is\", \"a\", \"test\"}\n    stream := parse(done, data)\n    cnt := run(stream)\n    fmt.Printf(\"total: %d messages\\n\", cnt)\n    time.Sleep(3 * time.Second)\n}\n</code></pre>\n\n<p>Here is my executable link: <a href=\"https://play.golang.org/p/bvQpVBLG_Qp\" rel=\"nofollow noreferrer\">Play Golang URL</a></p>\n\n<p>But when I run, I don't see the line: \"stream closed\". Please explain for me why.</p>\n"}, {"tags": ["go", "aws-lambda", "amazon-dynamodb", "aws-sdk-go"], "answers": [{"tags": [], "owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "is_accepted": false, "score": 0, "last_activity_date": 1524058518, "creation_date": 1524058518, "answer_id": 49901157, "question_id": 49129534, "link": "https://stackoverflow.com/questions/49129534/unmarshal-mapstringdynamodbattributevalue-into-a-struct/49901157#49901157", "title": "Unmarshal map[string]DynamoDBAttributeValue into a struct", "body": "<p>For the moment I managed to solve this issue by implementing the function I mentioned in the question.</p>\n\n<pre><code>// May take either `map[string]DynamoDBAttributeValue` \n// or `DynamoDBAttributeValue` as input.\nfunc EventStreamToMap(attribute interface{}) map[string]*dynamodb.AttributeValue {\n\n    // Map to be returned\n    m := make(map[string]*dynamodb.AttributeValue)\n\n    tmp := make(map[string]events.DynamoDBAttributeValue)\n\n    switch t := attribute.(type) {\n    case map[string]events.DynamoDBAttributeValue:\n        tmp = t\n    case events.DynamoDBAttributeValue:\n        tmp = t.Map()\n    }\n\n    for k, v := range tmp {\n        switch v.DataType() {\n        case events.DataTypeString:\n            s := v.String()\n            m[k] = &amp;dynamodb.AttributeValue{\n                S : &amp;s,\n            }\n        case events.DataTypeBoolean:\n            b := v.Boolean()\n            m[k] = &amp;dynamodb.AttributeValue{\n                BOOL : &amp;b,\n            }\n        // case events.SomeOtherType:\n        //     ...\n        case events.DataTypeMap:\n            m[k] = &amp;dynamodb.AttributeValue{\n                M : EventStreamToMap(v),\n            }\n        }\n    }\n    return m\n}\n</code></pre>\n\n<p>But I'm still open to other implementations.</p>\n"}, {"comments": [{"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1524647342, "post_id": 50017398, "comment_id": 87052620, "body": "Thanks for your answer. Tomorrow I&#39;ll try it. About lists you are right, in the example I did not cover them but It&#39;s possible to extend my function to handle them. Anyway your solution is by far better than mine."}, {"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1524754082, "post_id": 50017398, "comment_id": 87108162, "body": "I tried your function and it works perfectly. I made small fixes to it since <code>dbAttrMap</code> was badly declared and you made no error handling for <code>marshalErr</code>. As soon as you accept the edit I&#39;ll accept the answer."}, {"owner": {"reputation": 359, "user_id": 5121690, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RFLwM.jpg?s=128&g=1", "display_name": "Sky.Li", "link": "https://stackoverflow.com/users/5121690/sky-li"}, "reply_to_user": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 1, "creation_date": 1524823375, "post_id": 50017398, "comment_id": 87136262, "body": "It&#39;s better now, approve it."}], "tags": [], "owner": {"reputation": 359, "user_id": 5121690, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RFLwM.jpg?s=128&g=1", "display_name": "Sky.Li", "link": "https://stackoverflow.com/users/5121690/sky-li"}, "is_accepted": true, "score": 11, "last_activity_date": 1524813971, "last_edit_date": 1524813971, "creation_date": 1524644676, "answer_id": 50017398, "question_id": 49129534, "link": "https://stackoverflow.com/questions/49129534/unmarshal-mapstringdynamodbattributevalue-into-a-struct/50017398#50017398", "title": "Unmarshal map[string]DynamoDBAttributeValue into a struct", "body": "<p>I tried the function you provided, and I met some problems with <code>events.DataTypeList</code>, so I managed to write the following function that does the trick:</p>\n\n<pre><code>// UnmarshalStreamImage converts events.DynamoDBAttributeValue to struct\nfunc UnmarshalStreamImage(attribute map[string]events.DynamoDBAttributeValue, out interface{}) error {\n\n    dbAttrMap := make(map[string]*dynamodb.AttributeValue)\n\n    for k, v := range attribute {\n\n        var dbAttr dynamodb.AttributeValue\n\n        bytes, marshalErr := v.MarshalJSON(); if marshalErr != nil {\n            return marshalErr\n        }\n\n        json.Unmarshal(bytes, &amp;dbAttr)\n        dbAttrMap[k] = &amp;dbAttr\n    }\n\n    return dynamodbattribute.UnmarshalMap(dbAttrMap, out)\n\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3883, "user_id": 92694, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3e0b5461e0e5c733af00292ec2d15c83?s=128&d=identicon&r=PG", "display_name": "DragonFax", "link": "https://stackoverflow.com/users/92694/dragonfax"}, "edited": false, "score": 0, "creation_date": 1582752159, "post_id": 50164289, "comment_id": 106889831, "body": "This is an elegant solution. I like this."}], "tags": [], "owner": {"reputation": 113, "user_id": 4983850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/335c31c147fda4ac47da954f8ce11b14?s=128&d=identicon&r=PG&f=1", "display_name": "noIdeaAtAll", "link": "https://stackoverflow.com/users/4983850/noideaatall"}, "is_accepted": false, "score": 7, "last_activity_date": 1525383991, "creation_date": 1525383991, "answer_id": 50164289, "question_id": 49129534, "link": "https://stackoverflow.com/questions/49129534/unmarshal-mapstringdynamodbattributevalue-into-a-struct/50164289#50164289", "title": "Unmarshal map[string]DynamoDBAttributeValue into a struct", "body": "<p>I was frustrated that the type of NewImage from the record wasn't map[string]*dynamodb.AttributeValue so I could use the dynamodbattribute package.</p>\n\n<p>The JSON representation of events.DynamoDBAttributeValue seems to be the same as the JSON represenation of dynamodb.AttributeValue.</p>\n\n<p>So I tried creating my own DynamoDBEvent type and changed the type of OldImage and NewImage, so it would be marshalled into map[string]*dynamodb.AttributeValue instead of map[string]events.DynamoDBAttributeValue</p>\n\n<p>It is a little bit ugly but it works for me.</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/aws/aws-lambda-go/events\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n    \"github.com/aws/aws-sdk-go/service/dynamodb\"\n    \"github.com/aws/aws-sdk-go/service/dynamodb/dynamodbattribute\"\n    \"fmt\"\n)\n\nfunc main() {\n\n    lambda.Start(lambdaHandler)\n}\n\n// changed type of event from: events.DynamoDBEvent to DynamoDBEvent (see below)\nfunc lambdaHandler(event DynamoDBEvent) error {\n\n    for _, record := range event.Records {\n\n        change := record.Change\n        newImage := change.NewImage // now of type: map[string]*dynamodb.AttributeValue\n\n        var item IdOnly\n        err := dynamodbattribute.UnmarshalMap(newImage, &amp;item)\n        if err != nil {\n            return err\n        }\n\n        fmt.Println(item.Id)\n    }\n\n    return nil\n}\n\ntype IdOnly struct {\n    Id string `json:\"id\"`\n}\n\ntype DynamoDBEvent struct {\n    Records []DynamoDBEventRecord `json:\"Records\"`\n}\n\ntype DynamoDBEventRecord struct {\n    AWSRegion      string                       `json:\"awsRegion\"`\n    Change         DynamoDBStreamRecord         `json:\"dynamodb\"`\n    EventID        string                       `json:\"eventID\"`\n    EventName      string                       `json:\"eventName\"`\n    EventSource    string                       `json:\"eventSource\"`\n    EventVersion   string                       `json:\"eventVersion\"`\n    EventSourceArn string                       `json:\"eventSourceARN\"`\n    UserIdentity   *events.DynamoDBUserIdentity `json:\"userIdentity,omitempty\"`\n}\n\ntype DynamoDBStreamRecord struct {\n    ApproximateCreationDateTime events.SecondsEpochTime             `json:\"ApproximateCreationDateTime,omitempty\"`\n    // changed to map[string]*dynamodb.AttributeValue\n    Keys                        map[string]*dynamodb.AttributeValue `json:\"Keys,omitempty\"`\n    // changed to map[string]*dynamodb.AttributeValue\n    NewImage                    map[string]*dynamodb.AttributeValue `json:\"NewImage,omitempty\"`\n    // changed to map[string]*dynamodb.AttributeValue\n    OldImage                    map[string]*dynamodb.AttributeValue `json:\"OldImage,omitempty\"`\n    SequenceNumber              string                              `json:\"SequenceNumber\"`\n    SizeBytes                   int64                               `json:\"SizeBytes\"`\n    StreamViewType              string                              `json:\"StreamViewType\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7379, "favorite_count": 3, "accepted_answer_id": 50017398, "answer_count": 3, "score": 20, "last_activity_date": 1525383991, "creation_date": 1520334972, "last_edit_date": 1524823769, "question_id": 49129534, "link": "https://stackoverflow.com/questions/49129534/unmarshal-mapstringdynamodbattributevalue-into-a-struct", "title": "Unmarshal map[string]DynamoDBAttributeValue into a struct", "body": "<p>I'm trying to set-up an AWS-lambda using <a href=\"https://github.com/aws/aws-sdk-go\" rel=\"noreferrer\">aws-sdk-go</a> that is triggered whenever a new <code>user</code> is added to a certain <a href=\"https://aws.amazon.com/dynamodb\" rel=\"noreferrer\">dynamodb</a> table.</p>\n\n<p>Everything is working just fine but I can't find a way to unmarshal a map <code>map[string]DynamoDBAttributeValue</code> like:</p>\n\n<pre><code>{\n    \"name\": {\n        \"S\" : \"John\"\n    },\n    \"residence_address\": {\n        \"M\": {\n            \"address\": {\n                \"S\": \"some place\"\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>To a given struct, for instance, a <code>User</code> struct. <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/dynamodbattribute/#example_Unmarshal\" rel=\"noreferrer\">Here</a> is shown an example of unsmarhaling a <code>map[string]*dynamodb.AttributeValue</code> into a given interface, but I can't find a way to do the same thing with <code>map[string]DynamoDBAttributeValue</code> even though these types seem to fit the same purposes.</p>\n\n<p><code>map[string]DynamoDBAttributeValue</code> is returned by a <code>events.DynamoDBEvents</code> from package <code>github.com/aws/aws-lambda-go/events</code>. This is my code:</p>\n\n<pre><code>package handler\n\nimport (\n    \"context\"\n    \"github.com/aws/aws-lambda-go/events\"\n    \"github.com/aws/aws-sdk-go/service/dynamodb/dynamodbattribute\"\n    \"github.com/aws/aws-sdk-go/service/dynamodb\"\n)\n\nfunc HandleDynamoDBRequest(ctx context.Context, e events.DynamoDBEvent) {\n\n    for _, record := range e.Records {\n\n        if record.EventName == \"INSERT\" {\n\n            // User Struct\n            var dynamoUser model.DynamoDBUser\n\n            // Of course this can't be done for incompatible types\n            _ := dynamodbattribute.UnmarshalMap(record.Change.NewImage, &amp;dynamoUser)\n        }\n\n    }\n\n}\n</code></pre>\n\n<p>Of course, I can marshal <code>record.Change.NewImage</code> to JSON and unmarshal it back to a given struct, but then, I would have to manually initialize <code>dynamoUser</code> attributes starting from the latter ones.</p>\n\n<p>Or I could even write a function that parses <code>map[string]DynamoDBAttributeValue</code> to <code>map[string]*dynamodb.AttributeValue</code> like:</p>\n\n<pre><code>func getAttributeValueMapFromDynamoDBStreamRecord(e events.DynamoDBStreamRecord) map[string]*dynamodb.AttributeValue {\n    image := e.NewImage\n    m := make(map[string]*dynamodb.AttributeValue)\n    for k, v := range image {\n        if v.DataType() == events.DataTypeString {\n            s := v.String()\n            m[k] = &amp;dynamodb.AttributeValue{\n                S : &amp;s,\n            }\n        }\n        if v.DataType() == events.DataTypeBoolean {\n            b := v.Boolean()\n            m[k] = &amp;dynamodb.AttributeValue{\n                BOOL : &amp;b,\n            }\n        }\n        // . . .\n        if v.DataType() == events.DataTypeMap {\n            // ?\n        }\n    }\n    return m\n}\n</code></pre>\n\n<p>And then simply use <code>dynamodbattribute.UnmarshalMap</code>, but on <code>events.DataTypeMap</code> it would be quite a tricky process.</p>\n\n<p><strong>Is there a way through which I can unmarshal a DynamoDB record coming from a <code>events.DynamoDBEvent</code> into a struct with a similar method shown for <code>map[string]*dynamodb.AttributeValue</code>?</strong></p>\n"}, {"tags": ["go", "couchbase", "gocb"], "answers": [{"comments": [{"owner": {"reputation": 2193, "user_id": 5512095, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/58e730dd5510436d080bb145d452a2e6?s=128&d=identicon&r=PG&f=1", "display_name": "Denis Sheremet", "link": "https://stackoverflow.com/users/5512095/denis-sheremet"}, "edited": false, "score": 0, "creation_date": 1520831880, "post_id": 49202088, "comment_id": 85460522, "body": "It seems there should be <code>ErrSubDocPathNotFound</code> error, but I&#39;m getting <code>ErrSubDocBadMulti</code> instead, which does not make sence."}], "tags": [], "owner": {"reputation": 114, "user_id": 1267736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7d7c9c704693cb552c9dc9d9e4a27d1?s=128&d=identicon&r=PG", "display_name": "Brett L", "link": "https://stackoverflow.com/users/1267736/brett-l"}, "is_accepted": false, "score": 0, "last_activity_date": 1520629335, "creation_date": 1520629335, "answer_id": 49202088, "question_id": 49129193, "link": "https://stackoverflow.com/questions/49129193/distinguish-subdoc-operation-errors-from-missing-data-on-certain-path/49202088#49202088", "title": "Distinguish subdoc operation errors from missing data on certain path", "body": "<p>You should be able to compare the error values you get back against the list of known error types you can find here:\n<a href=\"https://godoc.org/github.com/couchbase/gocb#pkg-variables\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/couchbase/gocb#pkg-variables</a></p>\n"}], "owner": {"reputation": 2193, "user_id": 5512095, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/58e730dd5510436d080bb145d452a2e6?s=128&d=identicon&r=PG&f=1", "display_name": "Denis Sheremet", "link": "https://stackoverflow.com/users/5512095/denis-sheremet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1520629335, "creation_date": 1520333938, "last_edit_date": 1520340210, "question_id": 49129193, "link": "https://stackoverflow.com/questions/49129193/distinguish-subdoc-operation-errors-from-missing-data-on-certain-path", "title": "Distinguish subdoc operation errors from missing data on certain path", "body": "<p>I've got this code</p>\n\n<pre><code>frag, err := bucket.LookupIn(req.Key).Get(req.Path).Execute()\nif err != nil {\n    res.Code = 1\n    res.What = err.Error()\n} else {\n    frag.Content(req.Path, &amp;res.Data)\n}\n</code></pre>\n\n<p>If I'm trying to request some path which does not exist in the document, I'm getting the error message <code>\"could not execute one or more multi lookups or mutations\"</code>, which also seems to occur on certain different circumstances. How can I distinguish missing data on path from all other kinds of subdoc errors? I'd like to have something like this:</p>\n\n<pre><code>frag, err := bucket.LookupIn(req.Key).Get(req.Path).Execute()\nif err != nil {\n    if &lt;no data&gt; {\n        res.Code = 2\n        res.What = \"No data on specified path\"\n    } else {\n        res.Code = 1\n        res.What = err.Error()\n    }\n} else {\n    frag.Content(req.Path, &amp;res.Data)\n}\n</code></pre>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1520326688, "post_id": 49126784, "comment_id": 85258238, "body": "yes there is a method the struct fields that you don&#39;t want to be used by other packages don&#39;t export them."}, {"owner": {"reputation": 43, "user_id": 9450085, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "rhumbaJi", "link": "https://stackoverflow.com/users/9450085/rhumbaji"}, "reply_to_user": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1520327145, "post_id": 49126784, "comment_id": 85258498, "body": "@Grzegorz\u017bur I wish that other packages work on the User Struct, for instance calling User.GetName() instead of directly calling User.Name."}, {"owner": {"reputation": 43, "user_id": 9450085, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "rhumbaJi", "link": "https://stackoverflow.com/users/9450085/rhumbaji"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520327265, "post_id": 49126784, "comment_id": 85258579, "body": "@Himanshu True, but think of this use case where every member of the struct User comes in the JSON and hence, json.Unmarshal would require all struct fields to be exported. Now, who stops something like User.Name = &quot;some_other_name&quot; ?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520327725, "post_id": 49126784, "comment_id": 85258853, "body": "create a package assign the struct in that unmarshal your data and do not import that package in the main so that no other user can modify the struct except the package. Encapsulate your struct inside a package"}], "answers": [{"comments": [{"owner": {"reputation": 6530, "user_id": 459413, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71b8bc1cd0984e69568fda7ea5e5cf4d?s=128&d=identicon&r=PG", "display_name": "vasart", "link": "https://stackoverflow.com/users/459413/vasart"}, "edited": false, "score": 0, "creation_date": 1520329546, "post_id": 49127227, "comment_id": 85260019, "body": "Why didn&#39;t you just suggest an edit for @Thomas&#39; answer? The difference of both solutions is very subtle."}, {"owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "edited": false, "score": 0, "creation_date": 1520330675, "post_id": 49127227, "comment_id": 85260737, "body": "subtle differences sometimes make a crucial difference"}, {"owner": {"reputation": 167, "user_id": 9316126, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-NNuPzpCOcug/AAAAAAAAAAI/AAAAAAAAADo/XPDyVPMo1y8/photo.jpg?sz=128", "display_name": "Milan Vlach", "link": "https://stackoverflow.com/users/9316126/milan-vlach"}, "edited": false, "score": 0, "creation_date": 1520351763, "post_id": 49127227, "comment_id": 85274616, "body": "Love this! One thing which bothers me a bit is the fact, that the getter <code>GetName()</code> should be called <code>Name()</code>. But in this case, you cannot because you need a public field inside <code>user</code> struct because of the tag."}, {"owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "reply_to_user": {"reputation": 167, "user_id": 9316126, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-NNuPzpCOcug/AAAAAAAAAAI/AAAAAAAAADo/XPDyVPMo1y8/photo.jpg?sz=128", "display_name": "Milan Vlach", "link": "https://stackoverflow.com/users/9316126/milan-vlach"}, "edited": false, "score": 1, "creation_date": 1520355704, "post_id": 49127227, "comment_id": 85277359, "body": "@MilanVlach That is not quite that dramatic, changed the code to accommodate this requirement as well (see the note)"}], "tags": [], "owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "is_accepted": true, "score": 10, "last_activity_date": 1520355667, "last_edit_date": 1520355667, "creation_date": 1520327852, "answer_id": 49127227, "question_id": 49126784, "link": "https://stackoverflow.com/questions/49126784/encapsulating-struct-in-go/49127227#49127227", "title": "Encapsulating struct in Go", "body": "<p>You can use a <strong>package local struct</strong> with a <strong>public</strong> field so that this struct will not be visible outside the package. Then you can make this struct satisfy some public interface and you have your perfect decoupling:</p>\n\n<pre><code>package user\n\nimport \"encoding/json\"\n\ntype User interface {\n    Name() string\n}\n\ntype user struct {\n    Username string `json:\"name\"`\n}\n\nfunc (u *user) Name() string {\n    return \"Mr. \" + u.Username\n}\n\nfunc ParseUserData(data []byte) (User, error) {\n    user := &amp;user{}\n    if err := json.Unmarshal(data, user); err != nil {\n        return nil, err\n    }\n    return user, nil\n}\n</code></pre>\n\n<p>And the corresponding test:</p>\n\n<pre><code>package user_test\n\nimport (\n    \"testing\"\n\n    \"github.com/teris-io/user\"\n)\n\nfunc TestParseUserData(t *testing.T) {\n    data := []byte(\"{\\\"name\\\": \\\"Uncle Sam\\\"}\")\n    expected := \"Mr. Uncle Sam\"\n    if usr, err := user.ParseUserData(data); err != nil {\n        t.Fatal(err.Error())\n    } else if usr.Name() != expected {\n        t.Fatalf(\"expected %s, found %s\", expected, usr.Name())\n    }\n}\n</code></pre>\n\n<blockquote>\n  <p>\u279c  user git:(master) \u2717 go test github.com/teris-io/user</p>\n  \n  <p>ok      github.com/teris-io/user  0.001s</p>\n</blockquote>\n\n<p>You can also convert your package local object to some public object after unmarshaling.</p>\n\n<p><strong>Note</strong>: one of the comments mentions how pity it is that due to name clashes (field <code>user.Name</code> on the struct, and method <code>User.Name</code> on the interface) the interface needs to have a different method name. This is not necessary and the code above has been amended correspondingly: the field on the internal structure can have a <em>different name</em> from that in JSON, the corresponding annotation defines the mapping.</p>\n"}], "owner": {"reputation": 43, "user_id": 9450085, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "rhumbaJi", "link": "https://stackoverflow.com/users/9450085/rhumbaji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1628, "favorite_count": 2, "accepted_answer_id": 49127227, "answer_count": 1, "score": 4, "last_activity_date": 1520355667, "creation_date": 1520326455, "question_id": 49126784, "link": "https://stackoverflow.com/questions/49126784/encapsulating-struct-in-go", "title": "Encapsulating struct in Go", "body": "<p>I am new to Go. I have read that encapsulation in Go is on the package level. I have a simple web controller use case. I have a <strong>struct</strong> which comes in as a JSON object and is Unmarshaled into the struct type.</p>\n\n<pre><code>type User struct{\n    Name String `json:\"name\"`\n    //Other Variables\n}\n</code></pre>\n\n<p>Now a json can be unmarshaled into type User Struct by json.Unmarshal([]byte). However, this User struct is available to other packages too. How do I make sure that only methods related to User are accessible by other packages.</p>\n\n<p>One solution I could think of : </p>\n\n<pre><code>type User struct{\n    name String\n}\n\ntype UserJSON struct{\n    Name String `json:\"name\"`\n}\n\nfunc DecodeJSONToUser(rawJSON []byte) (User,error) {\n    var userJSON UserJSON\n    err := json.Unmarshal(rawJSON,&amp;userJSON)\n    //Do error handling\n    return User{name:userJSON.Name},nil\n}\n</code></pre>\n\n<p>Is there a GOish way to achieve this ?</p>\n"}, {"tags": ["windows", "go", "systray"], "comments": [{"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 2, "creation_date": 1524848428, "post_id": 49126294, "comment_id": 87150632, "body": "So you have two options, either create the window yourself <code>CreateWindow</code> and pass the hwnd of the same, as shown <a href=\"https://github.com/getlantern/systray/blob/9ddd647aedba71f782bef029a90964301de03480/systray/systray/systray.cpp#L104\" rel=\"nofollow noreferrer\">here</a>. Or you can see if passing the desktop hwnd works or not. For the same you can use <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms633504(v=vs.85).aspx\" rel=\"nofollow noreferrer\">GetDesktopWindow</a>"}, {"owner": {"reputation": 1193, "user_id": 2182996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57a529bc8861d5f54c464466a2aacb27?s=128&d=identicon&r=PG", "display_name": "Baptiste Donaux", "link": "https://stackoverflow.com/users/2182996/baptiste-donaux"}, "reply_to_user": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1525953926, "post_id": 49126294, "comment_id": 87561928, "body": "Nice ! I have tested the GetDesktopWindow way but I see an error. In the second option, unfortunately I can not do it. Do you have an example of implementation on dedicated Gist or other. Thanks for your help."}, {"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1525954594, "post_id": 49126294, "comment_id": 87562305, "body": "I don&#39;t have a handy gist but I would say search on github and you should get something that you can experiment with"}, {"owner": {"reputation": 4311, "user_id": 98528, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/835b9fab8784c5dca07b2165ac8b3df4?s=128&d=identicon&r=PG", "display_name": "akavel", "link": "https://stackoverflow.com/users/98528/akavel"}, "edited": false, "score": 0, "creation_date": 1529059808, "post_id": 49126294, "comment_id": 88749505, "body": "Please store and print the <code>lastErr</code> from <code>Call</code> in your <code>Println</code>, and tell us what you got. The output may be super laconic, but it will be <i>some</i> extra info, and when debugging WinAPI usage, you need all the help you can get."}, {"owner": {"reputation": 1487, "user_id": 276311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2badde067ffa52cab3d6b1dfbebb4bc5?s=128&d=identicon&r=PG", "display_name": "Adriano P", "link": "https://stackoverflow.com/users/276311/adriano-p"}, "edited": false, "score": 2, "creation_date": 1539871218, "post_id": 49126294, "comment_id": 92664981, "body": "You can check how it was done on github.com/lxn/walk, as shown in this <a href=\"https://github.com/lxn/walk/blob/master/examples/notifyicon/notifyicon.go\" rel=\"nofollow noreferrer\">example</a>."}, {"owner": {"reputation": 1193, "user_id": 2182996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57a529bc8861d5f54c464466a2aacb27?s=128&d=identicon&r=PG", "display_name": "Baptiste Donaux", "link": "https://stackoverflow.com/users/2182996/baptiste-donaux"}, "edited": false, "score": 0, "creation_date": 1548352348, "post_id": 49126294, "comment_id": 95520592, "body": "Thanks Adriano for your example, perfect !"}], "answers": [{"tags": [], "owner": {"reputation": 515, "user_id": 7804714, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9e70292d73d503d0ef63de4cda71b1ac?s=128&d=identicon&r=PG", "display_name": "hallazzang", "link": "https://stackoverflow.com/users/7804714/hallazzang"}, "is_accepted": false, "score": 2, "last_activity_date": 1571370061, "creation_date": 1571370061, "answer_id": 58443629, "question_id": 49126294, "link": "https://stackoverflow.com/questions/49126294/add-icon-tray-on-windows-using-native-golang-api/58443629#58443629", "title": "Add icon tray on Windows using native Golang API", "body": "<h2>Fields of <code>NOTIFYICONDATA</code></h2>\n\n<h3>hWnd</h3>\n\n<p><code>hWnd</code> field of <code>NOTIFYICONDATA</code> holds a window handle that is associated with notifyicon itself, as mentioned in MSDN:</p>\n\n<blockquote>\n  <p>hWnd</p>\n  \n  <p>A handle to the window that receives notifications associated with an icon in the notification area.</p>\n</blockquote>\n\n<p>I found that it's necessary to associate a window handle, even if the window is not visible.</p>\n\n<p><code>uFlags</code> tells which fields of <code>NOTIFYICONDATA</code> are valid in single command.\nAs you see there are lots of fields in <code>NOTIFYICONDATA</code>, and if you are going to change just the icon of the notifyicon, you can leave other fields unchanged and set only <code>hIcon</code> field then pass the whole <code>NOTIFYICONDATA</code> to <code>Shell_NotifyIcon</code>.\nIf you want to change both icon and message, just set it to <code>NIF_MESSAGE|NIF_ICON</code>.</p>\n\n<h3>dwState</h3>\n\n<p><code>dwState</code> can be used to control icon's visibility. If you specify <code>NIF_STATE</code> for <code>uFlags</code>, and <code>NIS_HIDDEN</code> for <code>dwState</code> and <code>dwStateMask</code>, it'll make notifyicon hidden.</p>\n\n<h3>dwStateMask</h3>\n\n<p>And in most case, just set <code>dwStateMask</code> as same as <code>dwState</code>. It just tells which bit of <code>dwState</code> is valid for the command:</p>\n\n<blockquote>\n  <p>The possible values are the same as those for dwState.</p>\n</blockquote>\n\n<h2>Example</h2>\n\n<p>You can find full example I've wrote at here: <a href=\"https://github.com/hallazzang/go-windows-programming/tree/master/example/gui/notifyicon\" rel=\"nofollow noreferrer\">https://github.com/hallazzang/go-windows-programming/tree/master/example/gui/notifyicon</a></p>\n"}], "owner": {"reputation": 1193, "user_id": 2182996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57a529bc8861d5f54c464466a2aacb27?s=128&d=identicon&r=PG", "display_name": "Baptiste Donaux", "link": "https://stackoverflow.com/users/2182996/baptiste-donaux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4226, "favorite_count": 10, "answer_count": 1, "score": 14, "last_activity_date": 1571370061, "creation_date": 1520324734, "last_edit_date": 1531259368, "question_id": 49126294, "link": "https://stackoverflow.com/questions/49126294/add-icon-tray-on-windows-using-native-golang-api", "title": "Add icon tray on Windows using native Golang API", "body": "<p>I'm developing a daemon with no UI apart from a simple icon in the Windows systray. </p>\n\n<p>I would like to have no dependencies on any other package(s), so I'm trying to use the <code>syscall</code> package and implement the necessary call(s) by myself.</p>\n\n<h1>Documentation</h1>\n\n<ul>\n<li>After some research, I think that I must use the <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/bb762159(v=vs.85).aspx\" rel=\"noreferrer\"><code>Shell_NotifyIcon</code></a> function in <code>shell32.dll</code>.</li>\n<li><a href=\"https://github.com/golang/go/wiki/WindowsDLLs\" rel=\"noreferrer\">The Golang WIKI gives three ways to call a Windows DLL</a>. The third solution is to be excluded. For many reasons, I want to build sources with the Golang compiler only.</li>\n<li>I found <a href=\"https://techblog.steelseries.com/2014/04/08/multi-platform-development-go.html\" rel=\"noreferrer\">an interesting article on \"Developing for Multiple Platforms With Go\"</a> which explained how to use <code>Shell_NotifyIconW</code> (Unicode declination), but the implementation is partial.</li>\n<li>I have found a few Golang libraries which implement Windows System Tray. They are useful to help understand the structure and calls involved in dealing with it.</li>\n</ul>\n\n<h2>Libraries</h2>\n\n<ul>\n<li><a href=\"https://github.com/getlantern/systray\" rel=\"noreferrer\">getlantern/systray</a></li>\n<li><a href=\"https://github.com/cratonica/trayhost\" rel=\"noreferrer\">cratonica/trayhost</a></li>\n<li><a href=\"https://github.com/xilp/systray\" rel=\"noreferrer\">xilp/systray</a></li>\n<li><a href=\"https://github.com/lxn/walk\" rel=\"noreferrer\">lxn/walk</a></li>\n</ul>\n\n<h1>Implementation</h1>\n\n<h2>Structures</h2>\n\n<p>Built with <a href=\"https://gowalker.org/github.com/xilp/systray\" rel=\"noreferrer\">xilp/systray documentation</a>.</p>\n\n<pre><code>type HANDLE uintptr\n\ntype HICON HANDLE\n    type HWND HANDLE\n\ntype GUID struct {\n    Data1 uint32\n    Data2 uint16\n    Data3 uint16\n    Data4 [8]byte\n}\n\ntype NOTIFYICONDATA struct {\n    CbSize           uint32\n    HWnd             HWND\n    UID              uint32\n    UFlags           uint32\n    UCallbackMessage uint32\n    HIcon            HICON\n    SzTip            [128]uint16\n    DwState          uint32\n    DwStateMask      uint32\n    SzInfo           [256]uint16\n    UVersion         uint32\n    SzInfoTitle      [64]uint16\n    DwInfoFlags      uint32\n    GuidItem         GUID\n}\n</code></pre>\n\n<h2>Variables</h2>\n\n<pre><code>const (\n    NIM_ADD = 0x00000000\n    NIM_MODIFY = 0x00000001\n    NIM_DELETE = 0x00000002\n    NIM_SETVERSION = 0x00000004\n\n    NIF_MESSAGE = 0x00000001\n    NIF_ICON = 0x00000002\n    NIF_TIP = 0x00000004\n    NIF_STATE = 0x00000008\n\n    NIF_HIDDEN = 0x00000001\n)\n</code></pre>\n\n<h2>Source</h2>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"syscall\"\n    \"unsafe\"\n)\n\nfunc main() {\n    shell32 := syscall.MustLoadDLL(\"shell32.dll\")\n    Shell_NotifyIcon := shell32.MustFindProc(\"Shell_NotifyIconW\")\n\n    iconData := NOTIFYICONDATA{\n        HWnd: 0,\n        UFlags: NIF_MESSAGE | NIF_STATE,\n        DwState: NIF_HIDDEN,\n        DwStateMask: NIS_HIDDEN,\n    }\n    iconData.CbSize = uint32(unsafe.Sizeof(iconData))\n\n    ret, _, _ := Shell_NotifyIcon.Call(\n        NIM_ADD,\n        uintptr(unsafe.Pointer(&amp;iconData)),\n    )\n\n    if ret == 0 {\n        log.Println(\"Failed\")\n        return\n    }\n\n    // Do anything, like open a HTTP server to keep the program running\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<h2>Details</h2>\n\n<ul>\n<li>I have no idea what information to give in <code>HWnd</code>, but without it, the executable crashes.</li>\n<li><code>UFlags</code>, <code>DwState</code> and <code>DwStateMask</code> have values that I have found in different projects.</li>\n</ul>\n\n<p>I know that it is possible; the <a href=\"https://github.com/golang/go/wiki/WindowsDLLs#calling-a-windows-dll\" rel=\"noreferrer\">Golang WIKI</a> gives an implementation to call a message box.</p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 0, "creation_date": 1520324104, "post_id": 49125791, "comment_id": 85256948, "body": "Why using Values map is overhead for you, in case when you have already had them? Could you provide more details?"}, {"owner": {"reputation": 459, "user_id": 4413286, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/zyADZ.jpg?s=128&g=1", "display_name": "Cris", "link": "https://stackoverflow.com/users/4413286/cris"}, "reply_to_user": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 0, "creation_date": 1520324678, "post_id": 49125791, "comment_id": 85257207, "body": "Normally <code>session, err := store.Get(httpRequest, &quot;name&quot;)</code> is used to get the user session. What I thought is that in this case I could save the http requests of the users in a global variable (a map or a slice). If I&#39;m not mistaken this is needed internally to get the cookie session id. I think this is an ugly workaround, I hope there is a better way..."}, {"owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 0, "creation_date": 1520334297, "post_id": 49125791, "comment_id": 85262914, "body": "Ok then. But if you&#39;re working with sessions, you have to collect them in some storage. If the answer is &quot;no&quot;, why do you need them? Probably the best solution is getting sessions from such storage. If you don&#39;t have it, you should implement it based on map or on something else."}, {"owner": {"reputation": 459, "user_id": 4413286, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/zyADZ.jpg?s=128&g=1", "display_name": "Cris", "link": "https://stackoverflow.com/users/4413286/cris"}, "reply_to_user": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 0, "creation_date": 1520334717, "post_id": 49125791, "comment_id": 85263179, "body": "Yes. The question is if there&#39;s a way to simply access that storage, if not, then I&#39;m going to use a database so that I can query it easily, this would be a lot of work tough, I need a very simple thing."}, {"owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 1, "creation_date": 1520336579, "post_id": 49125791, "comment_id": 85264428, "body": "Got it. As I know, <code>gorilla&#47;sessions</code> can&#39;t do what you want."}], "owner": {"reputation": 459, "user_id": 4413286, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/zyADZ.jpg?s=128&g=1", "display_name": "Cris", "link": "https://stackoverflow.com/users/4413286/cris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1520322569, "creation_date": 1520322569, "question_id": 49125791, "link": "https://stackoverflow.com/questions/49125791/retrieving-gorilla-registry-of-all-currently-saved-sessions", "title": "Retrieving gorilla registry of all currently saved sessions", "body": "<p>I created my backend using <code>gorilla/sessions</code> to store some informations about active users. Now I want to create some code monitoring the active users, so I need to retrieve all the saved session, thus retrieving their <code>Session.Values</code> map. Is there an easy way to do that without saving redundant data? Thanks.</p>\n"}, {"tags": ["go", "heap"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1520323281, "post_id": 49125779, "comment_id": 85256538, "body": "My take is that this case is covered by the &quot;Flow through fields&quot; case in the document you referred to: a value of type <code>interface{}</code> is a struct of two pointer fields. Still, note that the document is pretty old (2015) so I&#39;d ask this question on the mailing list to possibly solicit a refresher on these matters."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1520323925, "post_id": 49125779, "comment_id": 85256848, "body": "This is an implementation detail to be asked on golang-nuts."}, {"owner": {"reputation": 232, "user_id": 7596362, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NjI5T.jpg?s=128&g=1", "display_name": "lorneli", "link": "https://stackoverflow.com/users/7596362/lorneli"}, "edited": false, "score": 0, "creation_date": 1520324300, "post_id": 49125779, "comment_id": 85257047, "body": "Thanks for your suggestion. I&#39;ll ask on mailing list later."}], "answers": [{"comments": [{"owner": {"reputation": 232, "user_id": 7596362, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NjI5T.jpg?s=128&g=1", "display_name": "lorneli", "link": "https://stackoverflow.com/users/7596362/lorneli"}, "edited": false, "score": 0, "creation_date": 1520338220, "post_id": 49127518, "comment_id": 85265425, "body": "@perter Thanks. I change code to:\t <code>s := make([]*int, 1)   s[1] = &amp;v</code>. The variable still escapes. Is that because analysis thinks pointers in slice may escape out of function."}, {"owner": {"reputation": 232, "user_id": 7596362, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NjI5T.jpg?s=128&g=1", "display_name": "lorneli", "link": "https://stackoverflow.com/users/7596362/lorneli"}, "edited": false, "score": 0, "creation_date": 1520343571, "post_id": 49127518, "comment_id": 85269040, "body": "I find a blog <a href=\"http://www.agardner.me/golang/garbage/collection/gc/escape/analysis/2015/10/18/go-escape-analysis.html\" rel=\"nofollow noreferrer\">go-escape-analysis</a>. From its penultimate paragraph, &quot; Remember that slices and maps are actually just Go structs with pointers to heap-allocated memory&quot;. I think this may explain why the variable still escapes."}, {"owner": {"reputation": 232, "user_id": 7596362, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NjI5T.jpg?s=128&g=1", "display_name": "lorneli", "link": "https://stackoverflow.com/users/7596362/lorneli"}, "edited": false, "score": 0, "creation_date": 1520386641, "post_id": 49127518, "comment_id": 85291095, "body": "Thanks for your patience!"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 10, "last_activity_date": 1520350856, "last_edit_date": 1520350856, "creation_date": 1520328815, "answer_id": 49127518, "question_id": 49125779, "link": "https://stackoverflow.com/questions/49125779/why-does-a-pointer-to-a-local-variable-escape-to-the-heap/49127518#49127518", "title": "Why does a pointer to a local variable escape to the heap?", "body": "<p>Simplify your example. Analyze with <code>-gcflags='-m -m'</code>. </p>\n\n<p><strong>Example 1</strong>:</p>\n\n<pre><code>package main\n\nfunc main() {\n    var v int\n    s := make([]*int, 0)\n    s = append(s, &amp;v) // &amp;v escapes to heap\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go version\ngo version devel +df8c2b905b Tue Mar 6 06:13:17 2018 +0000 linux/amd64\n$ go run -gcflags='-m -m' esc.go\n# command-line-arguments\n./esc.go:3:6: can inline main as: func() { var v int; v = &lt;N&gt;; s := make([]*int, 0); s = append(s, &amp;v) }\n./esc.go:6:16: &amp;v escapes to heap\n./esc.go:6:16:  from append(s, &amp;v) (appended to slice) at ./esc.go:6:12\n./esc.go:4:6: moved to heap: v\n./esc.go:5:11: main make([]*int, 0) does not escape\n$ \n</code></pre>\n\n<hr>\n\n<p>Escape analysis determines whether any references to a value escape the function in which the value is declared. A reference to the variable <code>v</code>, declared in function <code>main</code>, escapes as an argument to function <code>append</code>: <code>&amp;v escapes to heap from append(s, &amp;v)</code>, <code>moved to heap: v</code>.</p>\n\n<hr>\n\n<p><strong>Example 2</strong>:</p>\n\n<pre><code>package main\n\nfunc main() {\n    var v int\n    lc := 1\n    s := make([]*int, lc)\n    s[0] = &amp;v\n}\n\n$ go run -gcflags='-m -m' esc2.go\n./esc2.go:3:6: can inline main as: func() { var v int; v = &lt;N&gt;; lc := 1; s := make([]*int, lc); s[0] = &amp;v }\n./esc2.go:6:11: make([]*int, lc) escapes to heap\n./esc2.go:6:11:     from make([]*int, lc) (too large for stack) at ./esc2.go:6:11\n./esc2.go:7:9: &amp;v escapes to heap\n./esc2.go:7:9:  from s[0] (slice-element-equals) at ./esc2.go:7:7\n./esc2.go:4:6: moved to heap: v\n$ \n</code></pre>\n\n<hr>\n\n<pre><code>type slice struct {\n    array unsafe.Pointer\n    len   int\n    cap   int\n}\n</code></pre>\n\n<p><code>make</code> for a slice returns a slice descriptor <code>struct</code> (pointer to underlying array, length, and capacity) and allocates an underlying slice element array. The underlying array is generally allocated on the heap: <code>make([]*int, lc) escapes to heap from make([]*int, lc)</code>. </p>\n\n<p><code>s[0] = &amp;v</code> stores a reference to the variable <code>v</code> (<code>&amp;v</code>) in the underlying array on the heap: <code>&amp;v escapes to heap from s[0] (slice-element-equals)</code>, <code>moved to heap: v</code>. The reference remains on the heap, after the function ends and its stack is reclaimed, until the underlying array is garbage collected.</p>\n\n<p>If the <code>make</code> slice capacity is a small (compile time) constant, <code>make([]*int, 1)</code> in your example, the underlying array may be allocated on the stack. However, escape analysis does not take this into account.</p>\n"}], "owner": {"reputation": 232, "user_id": 7596362, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NjI5T.jpg?s=128&g=1", "display_name": "lorneli", "link": "https://stackoverflow.com/users/7596362/lorneli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1847, "favorite_count": 4, "accepted_answer_id": 49127518, "answer_count": 1, "score": 12, "last_activity_date": 1520350856, "creation_date": 1520322515, "last_edit_date": 1520330357, "question_id": 49125779, "link": "https://stackoverflow.com/questions/49125779/why-does-a-pointer-to-a-local-variable-escape-to-the-heap", "title": "Why does a pointer to a local variable escape to the heap?", "body": "<p>Here is my go environment:</p>\n\n<pre><code>[lorneli@localhost GoTest]$ go version\ngo version go1.9 linux/amd64\n</code></pre>\n\n<p>Here is my program:</p>\n\n<pre><code>package main\n\ntype request struct {\n    ID string\n    size uint32\n    off uint64\n}\n\nfunc main() {\n    r := request{}\n    iter := interface{}(&amp;r) // &amp;r escapes to heap\n    iters := make([]interface{}, 0)\n    iters = append(iters, iter)\n}\n</code></pre>\n\n<p>I allocate a <code>request</code> instance and convert the pointer of it to <code>interface{}</code>.\nBut when analysing with flag <code>-gcflags \"-m\"</code> , I found out the instance escapes \nto heap when converting. Why this happens?</p>\n\n<p>Here is analysing result:</p>\n\n<pre><code>[lorneli@localhost GoTest]$ go build -gcflags \"-m\"\n# _/mnt/hgfs/vmfolder/workspace/GoTest\n./main.go:9:6: can inline main\n./main.go:11:21: (interface {})(&amp;r) escapes to heap\n./main.go:11:22: &amp;r escapes to heap\n./main.go:10:15: moved to heap: r\n./main.go:12:15: main make([]interface {}, 0) does not escape\n</code></pre>\n\n<p>I think this case doesn't match any cases listed on <a href=\"https://docs.google.com/document/d/1CxgUBPlx9iJzkz9JWkb6tIpTe5q32QDmz8l0BouG0Cw/preview#heading=h.jf07ptqo2xbk\" rel=\"noreferrer\">\"Go Escape Analysis Flaws\"</a>.</p>\n"}, {"tags": ["arrays", "go", "httpresponse"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520319119, "post_id": 49124775, "comment_id": 85254640, "body": "You&#39;re allocating <code>Result</code>s only once at the start of your loops, then in each iteration of loop you fill that one value and append it to the result slice, each iteration overwrites the contents of the <code>Result</code> values and therefore every appended value will hold the contents from the last iteration. You should allocate each <code>Result := make(map[...</code> in their respective loops so that every append appends its own unique value."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520319196, "post_id": 49124775, "comment_id": 85254674, "body": ".. something like this <a href=\"https://play.golang.org/p/CNYnx6t6-8B\" rel=\"nofollow noreferrer\">play.golang.org/p/CNYnx6t6-8B</a>"}, {"owner": {"reputation": 115, "user_id": 5934641, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh4.googleusercontent.com/-bgyruX0W0b0/AAAAAAAAAAI/AAAAAAAAAKg/T8xvy_s57X0/photo.jpg?sz=128", "display_name": "siri", "link": "https://stackoverflow.com/users/5934641/siri"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520332817, "post_id": 49124775, "comment_id": 85262042, "body": "yuhoo... IT WORKS! Thank you @mkopriva"}], "owner": {"reputation": 115, "user_id": 5934641, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh4.googleusercontent.com/-bgyruX0W0b0/AAAAAAAAAAI/AAAAAAAAAKg/T8xvy_s57X0/photo.jpg?sz=128", "display_name": "siri", "link": "https://stackoverflow.com/users/5934641/siri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1520318608, "creation_date": 1520318291, "last_edit_date": 1520318608, "question_id": 49124775, "link": "https://stackoverflow.com/questions/49124775/only-last-row-is-printing", "title": "Only last row is printing", "body": "<p>this is my go function</p>\n\n<pre><code>func logInFirst(res http.ResponseWriter, req *http.Request) {\n    type Resp struct {\n        Result  []map[string]interface{} `json:\"Result,omitempty\"`\n        Result1 []map[string]interface{} `json:\"Result1,omitempty\"`\n        Result2 []map[string]interface{} `json:\"Result2,omitempty\"`\n        Status  string                   `json:\"Status\"`\n    }\n    type AxleUser struct {\n        ShopID      string `json:\"ShopID\"`\n        VehicleType string `json:\"VehicleType\"`\n    }\n\n    var Response Resp\n    Response.Status = \"failed\"\n    Result := make(map[string]interface{})\n    Result1 := make(map[string]interface{})\n    Result2 := make(map[string]interface{})\n    //db, err := sql.Open(\"mysql\", \"root:chikkIbuddI57@tcp(127.0.0.1:3306)/b2b\")\n    db, err := sql.Open(\"mysql\", \"awsgobumpr:gobumpr123@tcp(briaxpgbmpr.cx4twoxoumct.ap-southeast-1.rds.amazonaws.com)/b2b_optimization\")\n    if err != nil {\n        panic(err.Error())\n    }\n    defer db.Close()\n\n    rnd := render.New()\n    b, err := ioutil.ReadAll(req.Body)\n    defer req.Body.Close()\n\n    if err != nil {\n        panic(err.Error())\n    }\n    // Unmarshal the request body\n    var msg AxleUser\n    err = json.Unmarshal(b, &amp;msg)\n    if err != nil {\n        panic(err.Error())\n    }\n    //fmt.Println(msg)\n    // get shop id from emp table using mobile number and password\n    brandrows, branderr := db.Query(\"SELECT DISTINCT brand,model FROM admin_vehicle_table_new WHERE type=?\", msg.VehicleType)\n    if branderr != nil {\n        panic(branderr.Error())\n    }\n    brandcolumns, branderr := brandrows.Columns()\n    if branderr != nil {\n        panic(branderr.Error())\n    }\n\n    brandcount := len(brandcolumns)\n    brandValues := make([]string, brandcount)\n    brandScanArgs := make([]interface{}, brandcount)\n    for i := range brandValues {\n        brandScanArgs[i] = &amp;brandValues[i]\n    }\n    for brandrows.Next() {\n        branderr := brandrows.Scan(brandScanArgs...)\n        //fmt.Println(branderr)\n        if branderr != nil {\n            panic(branderr.Error())\n        }\n        for i, v := range brandValues {\n            Result[brandcolumns[i]] = v\n        }\n        Response.Result = append(Response.Result, Result)\n    }\n    servicerows, serviceerr := db.Query(\"SELECT DISTINCT b2b_service_type FROM b2b_service_type WHERE b2b_vehicle_type=? and b2b_flag=0 and b2b_shop_id=0 UNION SELECT b2b_service_type FROM b2b_service_type WHERE b2b_vehicle_type=? and b2b_flag=0 and b2b_shop_id=?\", msg.VehicleType, msg.VehicleType, msg.ShopID)\n    if serviceerr != nil {\n        panic(serviceerr.Error())\n    }\n    servicecolumns, serviceerr := servicerows.Columns()\n    if serviceerr != nil {\n        panic(serviceerr.Error())\n    }\n\n    servicecount := len(servicecolumns)\n    serviceValues := make([]string, servicecount)\n    serviceScanArgs := make([]interface{}, servicecount)\n    for i := range serviceValues {\n        serviceScanArgs[i] = &amp;serviceValues[i]\n    }\n    for servicerows.Next() {\n        serviceerr := servicerows.Scan(serviceScanArgs...)\n        if serviceerr != nil {\n            panic(serviceerr.Error())\n        }\n        for i, v := range serviceValues {\n            Result1[servicecolumns[i]] = v\n        }\n        Response.Result1 = append(Response.Result1, Result1)\n    }\n\n    repairrows, repairerr := db.Query(\"SELECT DISTINCT b2b_repair_decription FROM b2b_repair_decription WHERE b2b_vehicle_type=? and b2b_shop_id=0 UNION SELECT b2b_repair_decription FROM b2b_repair_decription WHERE b2b_vehicle_type=? and b2b_shop_id=?\", msg.VehicleType, msg.VehicleType, msg.ShopID)\n    if repairerr != nil {\n        panic(repairerr.Error())\n    }\n    repaircolumns, repairerr := repairrows.Columns()\n    if repairerr != nil {\n        panic(repairerr.Error())\n    }\n\n    repaircount := len(repaircolumns)\n    repairValues := make([]string, repaircount)\n    repairScanArgs := make([]interface{}, repaircount)\n    for i := range repairValues {\n        repairScanArgs[i] = &amp;repairValues[i]\n    }\n    for repairrows.Next() {\n        repairerr := repairrows.Scan(repairScanArgs...)\n        if repairerr != nil {\n            panic(repairerr.Error())\n        }\n        for i, v := range repairValues {\n            Result2[repaircolumns[i]] = v\n        }\n        Response.Result2 = append(Response.Result2, Result2)\n    }\n\n    Response.Status = \"success\"\n    res.Header().Set(\"Content-Type\", \"application/json\")\n    rnd.JSON(res, http.StatusOK, Response)\n}\n</code></pre>\n\n<p>My Desrired output is a json string like this </p>\n\n<pre><code>{\n  \"Result\": [\n      {\n         \"brand\": \"Hero Honda\",\n         \"model\": \"Passion Pro\"\n      },\n      {\n         \"brand\": \"Yamaha\",\n         \"model\": \"120\"\n      },...\n  ]\n\"Result1\":[\n     { \n       \"service_type\" : \"repairs\",\n     },\n     { \n       \"service_type\" : \"general service\",\n     },...\n  ]\n  \"Result2\":[\n     {\n       \"b2b_repair_decription\": \"Tire Replacement\"\n     },\n     {\n       \"b2b_repair_decription\": \"Electric work\"\n     },...\n  ]\n}\n</code></pre>\n\n<p>but the output which i got contains the same row instead of all the rows like \nthis,</p>\n\n<pre><code>{\n  \"Result\": [\n      {\n         \"brand\": \"Yamaha\",\n         \"model\": \"120\"\n      },\n      {\n         \"brand\": \"Yamaha\",\n         \"model\": \"120\"\n      },...\n  ]\n\"Result1\":[\n     { \n       \"service_type\" : \"general service\",\n     },\n     { \n       \"service_type\" : \"general service\",\n     },...\n  ]\n  \"Result2\":[\n     {\n       \"b2b_repair_decription\": \"Electric work\"\n     },\n     {\n       \"b2b_repair_decription\": \"Electric work\"\n     },...\n  ]\n}\n</code></pre>\n\n<p>i tried appending in the loop , but it dint work. i even tried defining the Result, Result1, Result2 as array of interfaces</p>\n\n<p>can someone help me with this issue?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9449140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "qzvrwxce", "link": "https://stackoverflow.com/users/9449140/qzvrwxce"}, "edited": false, "score": 0, "creation_date": 1520311977, "post_id": 49123522, "comment_id": 85252321, "body": "But then I can&#39;t iterate over p. I was hoping that I could do something like <code>for _, i := range p {...}</code> rather than <code>for _, i := range p.Individual {...}</code>"}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "reply_to_user": {"reputation": 11, "user_id": 9449140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "qzvrwxce", "link": "https://stackoverflow.com/users/9449140/qzvrwxce"}, "edited": false, "score": 0, "creation_date": 1520312373, "post_id": 49123522, "comment_id": 85252430, "body": "@qzvrwxce <code>range</code> only supports <code>slices</code>, <code>arrays</code>, <code>channels</code> and <code>maps</code>, you can&#39;t <code>range</code> over struct fields, so <code>range p.Individual</code> the only option."}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 1, "last_activity_date": 1520311361, "creation_date": 1520311361, "answer_id": 49123522, "question_id": 49123396, "link": "https://stackoverflow.com/questions/49123396/extending-unnamed-types-in-go/49123522#49123522", "title": "Extending Unnamed Types in Go", "body": "<p>You should declare a name for the field of your struct:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Individual [][]int\n\ntype Population struct {\n    Individual []*Individual // &lt;- A name for field\n    Name       string\n}\n\nfunc main() {\n    var p Population\n    p.Name = \"human\"\n    fmt.Printf(\"%+v\", p)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/bNTd36DrWMW\" rel=\"nofollow noreferrer\"><code>playground</code></a></p>\n\n<pre><code>=&gt; {Individual:[] Name:human}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9449140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "qzvrwxce", "link": "https://stackoverflow.com/users/9449140/qzvrwxce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 49123522, "answer_count": 1, "score": 0, "last_activity_date": 1520311361, "creation_date": 1520310519, "question_id": 49123396, "link": "https://stackoverflow.com/questions/49123396/extending-unnamed-types-in-go", "title": "Extending Unnamed Types in Go", "body": "<p>So the following works:</p>\n\n<pre><code>type Individual [][]int\ntype Population []*Individual\n</code></pre>\n\n<p>What I'm trying to do is add a field to Population so I do the following</p>\n\n<pre><code>var p Population\np.Name = \"human\"\n</code></pre>\n\n<p>So I tried this:</p>\n\n<pre><code>type Individual [][]int\ntype Population struct {\n     []*Individual\n     Name string\n}\n</code></pre>\n\n<p>But it doesn't work for me. How do I do this?</p>\n"}, {"tags": ["pointers", "go", "reference"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1520314480, "last_edit_date": 1520314480, "creation_date": 1520313925, "answer_id": 49123907, "question_id": 49123156, "link": "https://stackoverflow.com/questions/49123156/difference-between-storing-reference-to-pointer-beforehand-vs-referencing-pointe/49123907#49123907", "title": "Difference between storing reference to pointer beforehand vs referencing pointer on-the-go", "body": "<p>If <code>Errors</code> is in <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">the method set</a> for <code>*thing</code> then you can use <code>for err := range thing.Errors() { ... }</code>.  </p>\n\n<p>Because the <a href=\"https://golang.org/ref/spec#For_range\" rel=\"nofollow noreferrer\">range expression is evaluated once at the beginning of the loop</a>, there should be no difference in performance between the two snippets in the question and my suggestion in this answer.</p>\n"}], "owner": {"reputation": 1834, "user_id": 4948426, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a4c7c93127bab92a9a9d2fdf129aa811?s=128&d=identicon&r=PG&f=1", "display_name": "Jaskaranbir Singh", "link": "https://stackoverflow.com/users/4948426/jaskaranbir-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 49123907, "answer_count": 1, "score": -1, "last_activity_date": 1520322800, "creation_date": 1520308790, "last_edit_date": 1520322800, "question_id": 49123156, "link": "https://stackoverflow.com/questions/49123156/difference-between-storing-reference-to-pointer-beforehand-vs-referencing-pointe", "title": "Difference between storing reference to pointer beforehand vs referencing pointer on-the-go", "body": "<p>First, hopefully, the question's title makes sense (feel free to suggest edits). I have never dealt with pointers manually before, just learning Go.</p>\n\n<p>So, is doing the following:</p>\n\n<pre><code>func something() {\n  something := *thing\n  go func() {\n    for err := range something.Errors() {\n      fmt.Println(err)\n    }\n  }()\n}\n</code></pre>\n\n<p>...have any advantage over:</p>\n\n<pre><code>func something() {\n  go func() {\n    for err := range (*thing).Errors() {\n      fmt.Println(err)\n    }\n  }()\n}\n</code></pre>\n\n<p>Note that I have tried doing <code>*thing.Errors()</code> in second case, but it gives me error unless I put braces around it (which is understandable since <code>Errors()</code> method doesn't return any pointers, I guess?).</p>\n\n<hr>\n\n<p>Although this is micro-optimization that I would normally not care about, but for learning and curiosity purposes, won't the second case have more performance overhead (since its referencing pointer on every iteration)?</p>\n\n<p>What is <code>thing</code>, you ask? Most likely a struct, or could be an interface or could be anything (I know that certain components such as maps, strings, functions, structs etc. are passed by reference by default. But I would still like to know for those components that are not).</p>\n"}, {"tags": ["pointers", "go", "goroutine", "channels"], "answers": [{"comments": [{"owner": {"reputation": 235, "user_id": 327493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/219e130bca557d81a6a48365af00506f?s=128&d=identicon&r=PG", "display_name": "Omer Akhter", "link": "https://stackoverflow.com/users/327493/omer-akhter"}, "edited": false, "score": 0, "creation_date": 1520319149, "post_id": 49123401, "comment_id": 85254652, "body": "did that. it works for int. in my case, i am sending a pointer to struct which I create in the loop. so it should have avoided the problem but doesn&#39;t work."}, {"owner": {"reputation": 235, "user_id": 327493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/219e130bca557d81a6a48365af00506f?s=128&d=identicon&r=PG", "display_name": "Omer Akhter", "link": "https://stackoverflow.com/users/327493/omer-akhter"}, "edited": false, "score": 0, "creation_date": 1520319652, "post_id": 49123401, "comment_id": 85254867, "body": "<a href=\"https://play.golang.org/p/eXM1by-_lAF\" rel=\"nofollow noreferrer\">play.golang.org/p/eXM1by-_lAF</a> seems to be working in simple case. wonder what was wrong with my usecase. I will look into it. thanks @andy-schweig"}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 6, "last_activity_date": 1520310550, "creation_date": 1520310550, "answer_id": 49123401, "question_id": 49123133, "link": "https://stackoverflow.com/questions/49123133/sending-pointers-over-a-channel/49123401#49123401", "title": "Sending pointers over a channel", "body": "<p>The value that the received pointer points to is not what you expect because you're sending it a pointer to the same variable every time, so the worker sees whatever value that variable has at the time it dereferences the pointer. A typical way around this sort of problem is to make a copy of the variable inside the <code>for</code> loop and send a pointer to that. That way, you're sending a pointer to a different object every time. Try this:</p>\n\n<pre><code>for i := 0; i &lt; 10; i++ {\n    fmt.Printf(\"sending: %v\\n\", i)\n    iCopy := i\n    q2 &lt;- &amp;iCopy\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 235, "user_id": 327493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/219e130bca557d81a6a48365af00506f?s=128&d=identicon&r=PG", "display_name": "Omer Akhter", "link": "https://stackoverflow.com/users/327493/omer-akhter"}, "edited": false, "score": 0, "creation_date": 1520342298, "post_id": 49125045, "comment_id": 85268191, "body": "thanks @jrefior. the answer is kind of same as Andy Schweig&#39;s, I guess."}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 6, "last_activity_date": 1520322034, "last_edit_date": 1520322034, "creation_date": 1520319542, "answer_id": 49125045, "question_id": 49123133, "link": "https://stackoverflow.com/questions/49123133/sending-pointers-over-a-channel/49125045#49125045", "title": "Sending pointers over a channel", "body": "<p>This problem is covered in <a href=\"https://golang.org/doc/effective_go.html#channels\" rel=\"noreferrer\">the Channels section of Effective Go</a>.  Here's a short excerpt, with the variable name changed to match your code:</p>\n\n<blockquote>\n  <p><strong>The bug is that in a Go <code>for</code> loop, the loop variable is reused for each iteration</strong>, so the <code>i</code> variable is shared across all goroutines. That's not what we want. We need to make sure that <code>i</code> is unique for each goroutine.</p>\n</blockquote>\n\n<p>It goes on to describe two solutions:</p>\n\n<ol>\n<li>Pass the value of <code>i</code> as an argument to the function in the goroutine</li>\n<li>Create a new variable in the loop and use that instead</li>\n</ol>\n\n<p>Since your goroutine is started outside your loop, only #2 applies to your code.</p>\n"}], "owner": {"reputation": 235, "user_id": 327493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/219e130bca557d81a6a48365af00506f?s=128&d=identicon&r=PG", "display_name": "Omer Akhter", "link": "https://stackoverflow.com/users/327493/omer-akhter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1667, "favorite_count": 0, "accepted_answer_id": 49123401, "answer_count": 2, "score": 4, "last_activity_date": 1520322834, "creation_date": 1520308657, "last_edit_date": 1520322834, "question_id": 49123133, "link": "https://stackoverflow.com/questions/49123133/sending-pointers-over-a-channel", "title": "Sending pointers over a channel", "body": "<p>I am trying to use channels to implement a kind of a worker pool. Please take a look at the code below</p>\n\n<p><a href=\"https://play.golang.org/p/g7aKxDoP9lf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/g7aKxDoP9lf</a> (The Go Playground)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    q1 := make(chan int)\n\n    fmt.Printf(\"worker 1\\n\")\n    go worker1(q1)\n    for i := 0; i &lt; 10; i++ {\n        fmt.Printf(\"sending: %v\\n\", i)\n        q1 &lt;- i\n    }\n\n    time.Sleep(time.Second)\n\n    fmt.Printf(\"\\n\\nworker 2\\n\")\n    q2 := make(chan *int)\n    go worker2(q2)\n    for i := 0; i &lt; 10; i++ {\n        fmt.Printf(\"sending: %v\\n\", i)\n        q2 &lt;- &amp;i\n    }\n    time.Sleep(time.Second)\n}\n\nfunc worker1(qTodo &lt;-chan int) {\n    var curr int\n    for {\n        select {\n        case curr = &lt;-qTodo:\n            fmt.Printf(\"got: %v\\n\", curr)\n        }\n    }\n}\n\nfunc worker2(qTodo &lt;-chan *int) {\n    var curr *int\n    for {\n        select {\n        case curr = &lt;-qTodo:\n            fmt.Printf(\"got: %v\\n\", *curr)\n        }\n    }\n}\n</code></pre>\n\n<p>Here is a sample output</p>\n\n<pre><code>worker 1\nsending: 0\ngot: 0\nsending: 1\nsending: 2\ngot: 1\ngot: 2\nsending: 3\nsending: 4\ngot: 3\ngot: 4\nsending: 5\nsending: 6\ngot: 5\ngot: 6\nsending: 7\nsending: 8\ngot: 7\ngot: 8\nsending: 9\ngot: 9\n\n\nworker 2\nsending: 0\ngot: 0\nsending: 1\nsending: 2\ngot: 2\ngot: 2\nsending: 3\nsending: 4\ngot: 4\ngot: 4\nsending: 5\nsending: 6\ngot: 6\ngot: 6\nsending: 7\nsending: 8\ngot: 8\ngot: 8\nsending: 9\ngot: 10\n</code></pre>\n\n<p>It seems that at the time when the pointer is recieved by worker2, the value has already changed in the original variable which is reflected in the value printed.</p>\n\n<p>The question is how can this be avoided? How can this be worked around?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1520310096, "post_id": 49122780, "comment_id": 85251913, "body": "<code>B</code> is <b>NOT</b> aliasing <code>A</code> in your code, those are two independent types."}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1520311299, "post_id": 49122780, "comment_id": 85252155, "body": "what is better word than aliasing,  clearly you can easily assign b to a variable of type A, and reverse"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1520311419, "post_id": 49122780, "comment_id": 85252178, "body": "You <b>cannot</b> assign a value of type <code>A</code> to type <code>B</code>: <a href=\"https://play.golang.org/p/bUSM8J-nvDe\" rel=\"nofollow noreferrer\">play.golang.org/p/bUSM8J-nvDe</a>  <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Assignability</a>"}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1520312676, "post_id": 49122780, "comment_id": 85252510, "body": "Yes, you can: <a href=\"https://play.golang.org/p/rG5JfSlpIxS\" rel=\"nofollow noreferrer\">play.golang.org/p/rG5JfSlpIxS</a>"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1520313016, "post_id": 49122780, "comment_id": 85252601, "body": "In your code you do not assign different types, you convert it first. <code>A(*b)</code> &lt;- here you create a new value, and only after it you assign it. It&#39;s really not clear what your question is about, since it&#39;s not about type aliases and not about assignments."}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1520313974, "post_id": 49122780, "comment_id": 85252915, "body": "sure I do convert either way since A B have the same form, <a href=\"https://play.golang.org/p/xUz95Yob9c7\" rel=\"nofollow noreferrer\">play.golang.org/p/xUz95Yob9c7</a>, I am looking for reflection way of finding that  B comes from A"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1520314077, "post_id": 49122780, "comment_id": 85252942, "body": "I believe it makes very little sense. Check <a href=\"https://play.golang.org/p/FIdxC7oQiNg\" rel=\"nofollow noreferrer\">play.golang.org/p/FIdxC7oQiNg</a> You can convert a value as soon as their underlying structures are assignable, not necessary it &quot;comes from A&quot;."}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1520314432, "post_id": 49122780, "comment_id": 85253069, "body": "Not necessary when you expanding the functionality of the type that is defined in 3rd party package, a good example is duration or  &#39;type Bins map[string]interface&#39;,  you need to know that Bins comes from map[string]interface{}, especially when dynamically create an object with reflection."}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1520314598, "post_id": 49122780, "comment_id": 85253122, "body": "I like term assignable/convertible better than aliasing"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1520314646, "post_id": 49122780, "comment_id": 85253140, "body": "Yep, and being assignable does not necessarily mean &quot;comes from&quot;. That&#39;s why your question is unclear. There is <code>AssignableTo</code> but it&#39;s not what you were asking."}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1520315349, "post_id": 49122780, "comment_id": 85253321, "body": "All I found and used in the past was ConvertibleTo, AssignableTo, but in these cases two data types need to be provided ahead, I was hoping to find with a reflection that B was defined based on A,"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520321141, "post_id": 49122780, "comment_id": 85255512, "body": "It&#39;s not possible to do what you want with reflection. You might want to think of <code>type B A</code> as syntactic sugar that allows you to not have to retype the whole type definition, but just don&#39;t think this gives <code>B</code> some knowledge of <code>A</code> because that&#39;s just not the case. All <code>B</code> and <code>A</code> have in common is the underlying structure, nothing else, there is no inheritance-like mechanism in Go that tells you what type &quot;came from&quot; where."}], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1520315712, "creation_date": 1520305684, "last_edit_date": 1520315712, "question_id": 49122780, "link": "https://stackoverflow.com/questions/49122780/finding-out-assignable-type-using-reflection", "title": "Finding out assignable type using reflection", "body": "<p>Given the following code: how to find using reflection that B is defined based on A</p>\n\n<pre><code>type A struct {\n  Id int\n}\n\ntype B A\n\n\nfunc main() {\n    var b = &amp;B{Id:1}\n    fmt.Printf(\"%T\", b)\n}\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 71, "user_id": 2581977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D7RSt.jpg?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/2581977/hao"}, "is_accepted": false, "score": 0, "last_activity_date": 1520302459, "creation_date": 1520302459, "answer_id": 49122405, "question_id": 49122145, "link": "https://stackoverflow.com/questions/49122145/what-if-next-record-depens-on-previous-record-can-i-use-gorouting-and-if-yes-h/49122405#49122405", "title": "What if next record depens on previous record, can i use gorouting? and if yes how?", "body": "<p>I don't think this is suitable for goroutines, since all the 2000 elements are not independently, it could not happen concurrently.</p>\n\n<p>Maybe you could run a loop for this json file and fill a map where k-v you can retrieve from id and data.</p>\n\n<p>After that, you can run dataParser to get the data into database.</p>\n"}], "owner": {"reputation": 627, "user_id": 1341596, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e0f8ecbbb481983a24c07e65ef42332c?s=128&d=identicon&r=PG", "display_name": "Vlad", "link": "https://stackoverflow.com/users/1341596/vlad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1525173759, "creation_date": 1520300302, "last_edit_date": 1525173759, "question_id": 49122145, "link": "https://stackoverflow.com/questions/49122145/what-if-next-record-depens-on-previous-record-can-i-use-gorouting-and-if-yes-h", "title": "What if next record depens on previous record, can i use gorouting? and if yes how?", "body": "<p>I'm learning golang coroutines and I decide to create a small data parser. </p>\n\n<p>First, lets say we have a data similar to json <code>[{id: 1, data: \"text\"}, {id: 2, data: \"text\"}, ...{id: 2000, data: \"text\"}]</code></p>\n\n<p>and let's say we have a function which parses our data and insert it into database</p>\n\n<p><code>dataParser(string) error</code></p>\n\n<p>So by running </p>\n\n<pre><code>for n = 0; n &lt; 2000; n++ {\n  go dataParser(f[i])\n}\n</code></pre>\n\n<p>we can see that data inserted into database in random order. That's basic nature of gorouting.</p>\n\n<p>But let's say we have different type of data where each future record may depend on the previous record \n<code>[{id: 1, data: \"text\"}, {id: 2, data: @1}, ...{id: 2000, data: @1950}]</code>\nwhere <code>@&lt;id&gt;</code> means we need to take value from data with the <code>#id</code> record.</p>\n\n<p>if I run just do the same: </p>\n\n<pre><code>for n = 0; n &lt; 2000; n++ {\n  go dataParser(f[i])\n}\n</code></pre>\n\n<p>I'm getting in the situation where golang trying to insert data which have a reference on the previous record but that record is not parsed yet, i.e. golang choose record 2 but first record hasn't been parsed yet and I got empty data </p>\n\n<p>I tried to use sync.WaitGroup:</p>\n\n<pre><code>for n = 0; n &lt; 2000; n++ {\n   wg.Add(1)\n   go func() {\n      dataParser(f[i])\n      wg.Wait()\n      wg.Done() \n   }()\n}\n</code></pre>\n\n<p>First of all - it feels strange like i don't need to use goroutines here\n<code>wg.Wait</code> helped - before golang may insert record #100 before #1 but still, i'm get into a situation where golang works with record #3 when i need to know data from record #1.</p>\n\n<p>So, I get confused. </p>\n\n<ul>\n<li>Is it a good idea to use goroutines here? </li>\n<li>Even if not - is there any solution for a situation like this?</li>\n</ul>\n\n<p>Thank you for help!</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1520283674, "post_id": 49119362, "comment_id": 85244254, "body": "<code>Plus</code> and <code>Term</code> are never referenced. It&#39;s not clear to me what you&#39;re trying to accomplish. Some code to show how you want this to work would help."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1520283807, "post_id": 49119362, "comment_id": 85244311, "body": "Are you reimplementing <a href=\"https://golang.org/pkg/math/big/\" rel=\"nofollow noreferrer\"><code>Rat</code> from the big package</a> as an exercise?"}, {"owner": {"reputation": 143, "user_id": 2966323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19c9df30930a871685eb902482e7e6b5?s=128&d=identicon&r=PG&f=1", "display_name": "a h", "link": "https://stackoverflow.com/users/2966323/a-h"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1520284102, "post_id": 49119362, "comment_id": 85244439, "body": "I should have written more information in the original post. I tried to create a minimal example that showcases my problem. The structs themselves could&#39;ve been anything.  With Frac64 I tried to create a minimal example of an immutable struct with an Add function.  In the client I&#39;m trying to implement the Num interface for Frac which is a typedef Frac64 that also has an Add function that doesn&#39;t match with Num&#39;s Add."}, {"owner": {"reputation": 143, "user_id": 2966323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19c9df30930a871685eb902482e7e6b5?s=128&d=identicon&r=PG&f=1", "display_name": "a h", "link": "https://stackoverflow.com/users/2966323/a-h"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1520284265, "post_id": 49119362, "comment_id": 85244509, "body": "I basically want the people who use my package with the <code>Term</code> struct to be able to use any struct they see fit to be used as a coefficient as long as it implements Num."}, {"owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "edited": false, "score": 0, "creation_date": 1520286003, "post_id": 49119362, "comment_id": 85245375, "body": "An interface is incomplete, IMHO. How does catch a case if a parameter of Add method isn&#39;t Frac64? How you convert it? Or return an error? You should add a method to get both parts of a number or converting it for ex."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1520286099, "creation_date": 1520286099, "answer_id": 49119950, "question_id": 49119362, "link": "https://stackoverflow.com/questions/49119362/interface-with-methods-that-return-itself/49119950#49119950", "title": "Interface with methods that return itself", "body": "<p>You implement it so that it has an identical signature to that of the interface; so it has to be named <code>Add</code>, it has to take a single parameter of type <code>Num</code>, and it has to return a single value of type <code>Num</code>. Note that that doesn't mean it can take or return a value of <em>a type that implements <code>Num</code></em> - the signatures must be <em>identical</em>:</p>\n\n<pre><code>func (a Frac64) Add(b Num) Num {\n    // Pretend this is implemented\n    // It can return anything that implements Num\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 143, "user_id": 2966323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19c9df30930a871685eb902482e7e6b5?s=128&d=identicon&r=PG&f=1", "display_name": "a h", "link": "https://stackoverflow.com/users/2966323/a-h"}, "edited": false, "score": 0, "creation_date": 1520339942, "post_id": 49119975, "comment_id": 85266598, "body": "Thanks for this thorough answer. I have added some additional information in my post. Both of your suggestions change <code>Frac64</code>&#39;s <code>Add</code> function though, which I cannot do as it is in an external package."}, {"owner": {"reputation": 143, "user_id": 2966323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19c9df30930a871685eb902482e7e6b5?s=128&d=identicon&r=PG&f=1", "display_name": "a h", "link": "https://stackoverflow.com/users/2966323/a-h"}, "edited": false, "score": 0, "creation_date": 1520340454, "post_id": 49119975, "comment_id": 85266968, "body": "I came over this though which seems to explain my problem quite clearly:  <a href=\"https://stackoverflow.com/a/43507669/2966323\">stackoverflow.com/a/43507669/2966323</a>  I guess I need to use embedding as you say instead of an alias in order to access the methods"}], "tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": false, "score": 2, "last_activity_date": 1520286922, "last_edit_date": 1520286922, "creation_date": 1520286215, "answer_id": 49119975, "question_id": 49119362, "link": "https://stackoverflow.com/questions/49119362/interface-with-methods-that-return-itself/49119975#49119975", "title": "Interface with methods that return itself", "body": "<p>You can solve this with <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">embedding</a>...</p>\n\n<pre><code>type Frac struct {\n    *Frac64\n}\n</code></pre>\n\n<p>Now <code>Frac</code> can use <code>Frac64</code>'s methods, no need to rewrite them.</p>\n\n<pre><code>// `Frac.New(numer, denom, bool)` would remove this implementation leak.\nfoo := Frac{\n    &amp;Frac64 {\n        Numer: 45,\n        Denom: 99,\n        Neg: false,\n    },\n}\nfmt.Println(foo.IsNeg())\n</code></pre>\n\n<p>But there's a snag when we try to use <code>Add</code>.</p>\n\n<pre><code>// cannot use foo (type Frac) as type Frac64 in argument to foo.Frac64.Add\nfmt.Println(foo.Add(foo))\n</code></pre>\n\n<p>Embedding only works for inheriting methods. When used as an argument it won't use the embedded reference for you, you'd have to do that explicitly.</p>\n\n<p>The real problem is <code>func (a Frac64) Add(b Frac64) Frac64</code> does not satisfy the Num interface. If we fix that it works fine because <code>Frac</code> implements <code>Num</code>.</p>\n\n<pre><code>func (a Frac64) Add(b Num) Num {\n    return Frac64{\n        Numer: 12,\n        Denom: 23,\n        Neg: false,\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>That works, but it's awkward to build a less specific type, <code>Frac</code>, from a more specific type, <code>Frac64</code>.</p>\n\n<p>From here it becomes a bit more obvious that <code>Frac</code> is a <code>Num</code> with some extensions. <code>Frac</code> should be an interface extending <code>Num</code> and adding a numerator and denominator. <code>Frac64</code> becomes a type implementing <code>Frac</code>.</p>\n\n<pre><code>type Num interface {\n    IsNeg()  bool\n    Add(Num) Num\n}\n\ntype Frac interface {\n    Numer() uint\n    Denom() uint\n    Num\n}\n\ntype Frac64 struct {\n    numer uint64\n    denom uint64\n    neg bool\n}\n\nfunc (f Frac64) IsNeg() bool {\n    return f.neg\n}\n\nfunc (f Frac64) Numer() uint {\n    return uint(f.numer)\n}\n\nfunc (f Frac64) Denom() uint {\n    return uint(f.denom)\n}\n\nfunc (a Frac64) Add(b Num) Num {\n    // Just a placeholder to show it compiles.\n    return Frac64{\n        numer: 12,\n        denom: 34,\n        neg: false,\n    }\n}\n</code></pre>\n\n<p>This is fine for an exercise. In production, consider using <a href=\"https://golang.org/pkg/math/big/#Rat\" rel=\"nofollow noreferrer\"><code>big.Rat</code></a>.</p>\n"}], "owner": {"reputation": 143, "user_id": 2966323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19c9df30930a871685eb902482e7e6b5?s=128&d=identicon&r=PG&f=1", "display_name": "a h", "link": "https://stackoverflow.com/users/2966323/a-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 703, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1520339752, "creation_date": 1520283533, "last_edit_date": 1520339752, "question_id": 49119362, "link": "https://stackoverflow.com/questions/49119362/interface-with-methods-that-return-itself", "title": "Interface with methods that return itself", "body": "<p>Package <code>term</code>:</p>\n\n<pre><code>type Num interface {\n    IsNeg()  bool\n    Add(Num) Num\n}\n\ntype Term struct {\n    Coeff Num\n    Var   string\n}\n</code></pre>\n\n<p>External package <code>frac64</code></p>\n\n<pre><code>type Frac64 struct {\n    Numer uint64\n    Denom uint64\n    Neg   bool\n}\n\nfunc (a Frac64) Add(b Frac64) Frac64 { // Pretend this is implemented }\n</code></pre>\n\n<p>Package <code>client</code></p>\n\n<pre><code>type Frac Frac64\n\nfunc (f Frac) IsNeg()  bool   { return f.Neg }\nfunc (f Frac) Add(v Num) Num  { // Call Frac64's Add here? }\n</code></pre>\n\n<p>How would I go about implementing <code>Add</code> for <code>Frac</code> so that it implements the <code>Num</code> interface?</p>\n\n<h2>EDIT: Additional info</h2>\n\n<p>The external package <code>frac64</code> was just an example. I do not intend to use it.</p>\n\n<p>The goal here (and I should have been clearer) is for my package to expose the struct <code>Term</code> that uses <code>Num</code> as one of its two properties. Now, I want users of my package to be able to use <code>big.Rat</code> or <code>Frac64</code> or <code>int64</code> or <code>rune</code> or whatever they want, as long as they implement the <code>Num</code> interface.</p>\n\n<p>The problem I have is trying to implement the <code>Num</code> interface for a struct that already has functions with the same name as the functions in <code>Num</code>. This is where <code>Frac64</code> comes in. I could've also used <code>big.Rat</code> as an example, as it also has a function called <code>Add</code>.</p>\n\n<p>I can't change the implementation of <code>Frac64</code> (or <code>big.Rat</code> for that matter), and I also can't extend it with an <code>Add</code> function as it already exists. That's why I tried to use <code>type Frac Frac64</code> (or <code>type Frac big.Rat</code>) and then trying to extend <code>Frac</code>.</p>\n\n<p>I fail to implement <code>Num</code> for <code>Frac</code> though, because I'm not able to call <code>Frac64</code>'s <code>Add</code> from the <code>Frac</code>'s <code>Add</code> function.</p>\n"}, {"tags": ["go", "synchronization", "locking", "wait"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1520284053, "post_id": 49119312, "comment_id": 85244413, "body": "Can you give an example of how you use this, and what the question about its usage is? This just seems like a simplified conditional, as the channel could be replaced with a mutex and accomplish the same."}, {"owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "edited": false, "score": 0, "creation_date": 1520284691, "post_id": 49119312, "comment_id": 85244722, "body": "The very same discussion: <a href=\"https://stackoverflow.com/questions/36417199/how-to-broadcast-message-using-channel\" title=\"how to broadcast message using channel\">stackoverflow.com/questions/36417199/&hellip;</a>"}, {"owner": {"reputation": 258, "user_id": 4752660, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh5.googleusercontent.com/-B9wRLbylbsM/AAAAAAAAAAI/AAAAAAAAAII/t_EcxZvmgps/photo.jpg?sz=128", "display_name": "Jose Javier Gonzalez Ortiz", "link": "https://stackoverflow.com/users/4752660/jose-javier-gonzalez-ortiz"}, "edited": false, "score": 0, "creation_date": 1520284771, "post_id": 49119312, "comment_id": 85244757, "body": "It is part of a consensus algorithm. Several clients can be waiting for the same index position to be committed. Once the algorithm decides they all need to continue. Could you elaborate on the mutex solution?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1520286462, "post_id": 49119312, "comment_id": 85245569, "body": "It sounds like what you want may be a <a href=\"https://golang.org/pkg/sync/#Cond\" rel=\"nofollow noreferrer\"><code>sync.Cond</code></a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520289676, "post_id": 49119312, "comment_id": 85246802, "body": "@JoseJavierGonzalezOrtiz:  I only mean that here you&#39;re using a channel as a mutex, with the only difference of not being able to re-lock it (which may be fine, since if it&#39;s invalid to broadcast again, this will conveniently panic). Though if you were going to want to make this re-entrant, you probably would end up using a <code>sync.Cond</code> anyway. Without the full context we can&#39;t really say if there is a simpler pattern, this is pretty simple as it is."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1520294708, "post_id": 49119312, "comment_id": 85248326, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/16930251/go-one-producer-many-consumers\">Go: One producer many consumers</a>"}, {"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1520304959, "post_id": 49119312, "comment_id": 85250783, "body": "I implemented one day something similar <a href=\"https://github.com/vardius/message-bus\" rel=\"nofollow noreferrer\">here</a> maybe help you solve your thoughts"}], "owner": {"reputation": 258, "user_id": 4752660, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh5.googleusercontent.com/-B9wRLbylbsM/AAAAAAAAAAI/AAAAAAAAAII/t_EcxZvmgps/photo.jpg?sz=128", "display_name": "Jose Javier Gonzalez Ortiz", "link": "https://stackoverflow.com/users/4752660/jose-javier-gonzalez-ortiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 287, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1520283327, "creation_date": 1520283327, "question_id": 49119312, "link": "https://stackoverflow.com/questions/49119312/closing-channel-to-signal-broadcast-in-go", "title": "Closing channel to signal broadcast in go", "body": "<p>I have an application where one goroutine will eventually compute a value and at that point any number of routines waiting for that value need to continue execution. This a one-to-many communication problem so I struggled with channels and condition variables by keeping track of how many routines were waiting. Moreover, I wanted the broadcast to be non-blocking and future waits to return immediately since the value is known.</p>\n\n<p>I ended up with the following implementation where closing the channel effectively broadcasts the group, since the write happens before any of the reads there should not be any races. Although works great so far seems a bit hackish to me. Is there a more idiomatic yet simple solution to this problem?</p>\n\n<pre><code>type BroadcastGroup struct {\n    ch      chan interface{}\n    msg     interface{}\n}\n\nfunc (bg *BroadcastGroup) Broadcast(msg interface{}) {\n    bg.msg = msg\n    close(bg.ch)\n}\n\nfunc (bg *BroadcastGroup) Wait() interface{} {\n    &lt;-bg.ch\n    return bg.msg\n}\n\nfunc NewBroadcastGroup() *BroadcastGroup {\n    bg := &amp;BroadcastGroup{}\n    bg.ch = make(chan interface{}, 0)\n    return bg\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "gridfs"], "answers": [{"tags": [], "owner": {"reputation": 42, "user_id": 4671615, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FUIXO851_Kw/AAAAAAAAAAI/AAAAAAAAAF8/WnnZJuU3wx4/photo.jpg?sz=128", "display_name": "Plawan Rath", "link": "https://stackoverflow.com/users/4671615/plawan-rath"}, "is_accepted": false, "score": 1, "last_activity_date": 1520286765, "creation_date": 1520286765, "answer_id": 49120101, "question_id": 49118889, "link": "https://stackoverflow.com/questions/49118889/how-to-download-a-file-from-mongo-gridfs-using-golang/49120101#49120101", "title": "How to download a file from Mongo GridFS using Golang?", "body": "<p>UPDATE: I think I figured out how to do it. I am curious if any one has any other suggestions:</p>\n\n<p>Here is how it looks for me right now:</p>\n\n<pre><code>func DownloadRecord(w http.ResponseWriter, filename string) error {\n    if !fileExists(filename) {\n      return errors.New(\"File doesn't exist. Nothing to download\")\n    }\n    session := sqlconnecter.GetMongoDBConnection()\n    fileDb := session.DB(\"mydatabase\")\n    file, err := fileDb.GridFS(\"fs\").Open(filename)\n    defer file.Close()\n    if err != nil {\n      return err\n    }\n    fileHeader := make([]byte, 512)\n    file.Read(fileHeader)\n    fileContentType := http.DetectContentType(fileHeader)\n    fileSize := file.Size()\n\n    w.Header().Set(\"Content-Disposition\", \"attachment; filename=\"+filename)\n    w.Header().Set(\"Content-Type\", fileContentType)\n    w.Header().Set(\"Content-Length\", strconv.FormatInt(fileSize, 10))\n\n    file.Seek(0, 0)\n    io.Copy(w, file)\n    return err\n}\n</code></pre>\n"}], "owner": {"reputation": 42, "user_id": 4671615, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FUIXO851_Kw/AAAAAAAAAAI/AAAAAAAAAF8/WnnZJuU3wx4/photo.jpg?sz=128", "display_name": "Plawan Rath", "link": "https://stackoverflow.com/users/4671615/plawan-rath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 880, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1520286765, "creation_date": 1520281630, "question_id": 49118889, "link": "https://stackoverflow.com/questions/49118889/how-to-download-a-file-from-mongo-gridfs-using-golang", "title": "How to download a file from Mongo GridFS using Golang?", "body": "<p>I am trying to write a Rest API which has a basic file upload, download. I am able to do the upload part just fine but I am having a hard time downloading file from gridfs. ANy suggestions ?</p>\n"}, {"tags": ["go", "dependency-management", "godeps", "vendoring"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520277734, "post_id": 49117073, "comment_id": 85241164, "body": "That&#39;s not what <a href=\"https://golang.github.io/dep/docs/Gopkg.toml.html#ignored\" rel=\"nofollow noreferrer\"><code>ignored</code></a> is for. This isn&#39;t a situation that <code>dep</code> is meant to handle."}], "owner": {"reputation": 2008, "user_id": 710618, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/779233af08fd9f187990a44146f1778c?s=128&d=identicon&r=PG", "display_name": "Alexandre Thenorio", "link": "https://stackoverflow.com/users/710618/alexandre-thenorio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 331, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1520280818, "creation_date": 1520274242, "last_edit_date": 1520280818, "question_id": 49117073, "link": "https://stackoverflow.com/questions/49117073/ignore-and-prevent-vendored-package-from-being-delete-with-go-dep", "title": "Ignore and prevent vendored package from being delete with go dep?", "body": "<p>I have a bit of an issue, I have a Go project that I depend on (DPkg) and this project has some small dependency on another package (TPkg).</p>\n\n<p>For some reasons which is irrelevant to the question I am not able to build TPkg at the moment however I know that I do not ever use the parts of DPkg that call TPkg so I went ahead and recreated a fake DPkg in my vendor folder.</p>\n\n<p>The issue is that whenever I run <code>dep ensure</code>, dep will attempt to handle this package. I have attempted setting an <code>ignored</code> constraint on it in my Gopkg.toml but then dep just deletes my code in the vendor folder. I have also tried further adding a <code>prune.project</code> constraint to mark TPkg as <code>unused-packages = false</code> but that does not prevent dep from deleting the package.</p>\n\n<p>Is there any way that I can tell dep to <em>ignore TPkg completely</em> and by that I mean, don't attempt to change it or delete it?</p>\n\n<p>I <strong>know</strong> what this means and how bad it is in terms of issues and maintainability but that is not the question at hand here.  </p>\n"}, {"tags": ["oop", "go", "dynamic-dispatch"], "comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1599619650, "post_id": 49114057, "comment_id": 112826138, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/a/57017661/12817546\">stackoverflow.com/a/57017661/12817546</a>"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 8, "last_activity_date": 1520267146, "last_edit_date": 1520267146, "creation_date": 1520264604, "answer_id": 49114165, "question_id": 49114057, "link": "https://stackoverflow.com/questions/49114057/idiomatic-way-to-mimic-proper-dynamic-dispatch-in-go/49114165#49114165", "title": "Idiomatic way to mimic proper dynamic dispatch in Go", "body": "<p>Your question is too abstract to answer well, but I hope this helps.</p>\n\n<p>Re-think the design starting with the real problem (business need etc) you're trying to solve, and don't try to solve it in Go using a Java design. Go has no inheritance and interfaces are its only form of polymorphism; you cannot \"mimic dynamic dispatch\" in Go in any reasonable way.</p>\n\n<p>Specifically, in regards to this:</p>\n\n<blockquote>\n  <p>I have two implementations of the same interface that differs only a\n  little. How can I maximize code reusage in this case? I can't believe\n  that in order to customize a bit logic in one implementation I have to\n  copy-paste everything and just fix a little part in my code.</p>\n</blockquote>\n\n<p>Re-think your design in terms of <em>code re-use</em> rather than class hierarchy, because there is none. If you have two implementations of the same interface, that's fine! Go has interfaces and they work great. If you have a bunch of code repeated in both implementations, either a) abstract the shared code into functions that both implementations can call, or b) if the differences really are that small, maybe it should be a single implementation with some simple switching logic.</p>\n"}, {"tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": false, "score": 9, "last_activity_date": 1520265061, "last_edit_date": 1520265061, "creation_date": 1520264679, "answer_id": 49114195, "question_id": 49114057, "link": "https://stackoverflow.com/questions/49114057/idiomatic-way-to-mimic-proper-dynamic-dispatch-in-go/49114195#49114195", "title": "Idiomatic way to mimic proper dynamic dispatch in Go", "body": "<p>Go does not have subclassing or extension of \"classes\".  Methods of embedded types use their <em>original type receiver</em>.   In this case, the method <code>MegaDo</code> is promoted within <code>B</code>, but when called, it's called on the <code>A</code> field.  <code>B.MegaDo()</code> is simply syntactical sugar for <code>B.A.MegaDo()</code>.  Thus when it calls <code>Do()</code> on its receiver, it's calling the <code>A</code> version, not the <code>B</code> version.</p>\n\n<p>The easier method of handling this is by embedding an interface.  For example:</p>\n\n<p><a href=\"https://play.golang.org/p/ZPdK8zsy5_w\" rel=\"noreferrer\">https://play.golang.org/p/ZPdK8zsy5_w</a></p>\n\n<pre><code>type Mega struct {\n    I\n}\n\nfunc (m Mega) MegaDo() {\n    m.Do()\n} \n\nfunc main() {\n    var a A\n    var b B\n    m := Mega{I: A}\n    m.MegaDo()\n    m.I = B\n    m.MegaDo()\n}\n</code></pre>\n\n<p>Note: embedding the interface isn't actually required in this case, as <code>MegaDo()</code> could simply call <code>m.i.Do()</code> if it were a named field.  However, embedding it allows other code to directly call <code>Do()</code> on <code>m</code>, without knowing what type is actually embedded in that field.  Also note that a practical upshot of embedding an interface is that the structure embedding the interface by definition fulfills that same interface as well.</p>\n\n<p>Practical example of this pattern: a DB handle type that embeds the joint methods of a sql.DB and sql.Tx type (QueryRow, Query, Exec, etc).  Users of that handle can call those methods without having to know whether they are being called within the context of a transaction or not.</p>\n"}], "owner": {"reputation": 596, "user_id": 527590, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/8abe91e91291d53bdc60c172cbbc874f?s=128&d=identicon&r=PG", "display_name": "JohnGray", "link": "https://stackoverflow.com/users/527590/johngray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2494, "favorite_count": 2, "accepted_answer_id": 49114165, "answer_count": 2, "score": 5, "last_activity_date": 1520267146, "creation_date": 1520264269, "question_id": 49114057, "link": "https://stackoverflow.com/questions/49114057/idiomatic-way-to-mimic-proper-dynamic-dispatch-in-go", "title": "Idiomatic way to mimic proper dynamic dispatch in Go", "body": "<p>I am coming to Go from Java and some things confuses me.</p>\n\n<p>For example, let's consider the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype I interface {\n    Do()\n    MegaDo()\n}\n\ntype A struct {\n}\n\nfunc (a *A) Do() {\n    fmt.Println(\"A\")\n}\n\nfunc (a *A) MegaDo() {\n    a.Do()\n}\n\ntype B struct {\n    A\n}\n\nfunc (a *B) Do() {\n    fmt.Println(\"B\")\n}\n\nvar i I\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n\n    var i I = &amp;B{}\n\n    i.MegaDo()\n}\n</code></pre>\n\n<p>Here we have an interface <code>I</code> with methods <code>Do()</code> and <code>MegaDo()</code> . Struct <code>A</code> implements both methods and <code>MegaDo</code> calls <code>Do</code> internally. And <code>B</code> is composed over <code>A</code> and overrides only <code>Do()</code></p>\n\n<p>If I'll mimic the same code in Java I would expect it to print \"B\". But in Go it prints \"A\".</p>\n\n<p>While I, kind of, understand why it happens (because it's embedding and not inheritance) I wonder how I can mimic the same thing in Go. \nFor example I have two implementations of the same interface that differs only a little. How can I maximize code reusage in this case? I can't believe that in order to customize a bit logic in one implementation I have to copy-paste everything and just fix a little part in my code.\nMaybe there is some idiomatic way to do this in Go?</p>\n"}, {"tags": ["http", "go", "get", "content-length"], "answers": [{"comments": [{"owner": {"reputation": 644, "user_id": 2386745, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61387019fb6b26f69632b01f43211eb6?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/2386745/jordan"}, "edited": false, "score": 0, "creation_date": 1520259645, "post_id": 49112531, "comment_id": 85229984, "body": "That would make sense! Although I was under the impression that the server should return a &#39;chunked&#39; header in the response if that is the case."}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "reply_to_user": {"reputation": 644, "user_id": 2386745, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61387019fb6b26f69632b01f43211eb6?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/2386745/jordan"}, "edited": false, "score": 1, "creation_date": 1520260024, "post_id": 49112531, "comment_id": 85230260, "body": "You can find more in the source <a href=\"https://golang.org/src/net/http/response.go\" rel=\"nofollow noreferrer\">golang.org/src/net/http/response.go</a>"}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 8, "last_activity_date": 1520259600, "creation_date": 1520259600, "answer_id": 49112531, "question_id": 49112440, "link": "https://stackoverflow.com/questions/49112440/unexpected-http-net-response-content-length-in-golang/49112531#49112531", "title": "Unexpected http/net response content length in Golang", "body": "<p>The value -1 indicates that the length is unknown. (in most cases this indicates\nchunked encoding).</p>\n"}, {"comments": [{"owner": {"reputation": 53, "user_id": 5803537, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LRsM8Rrho5g/AAAAAAAAAAI/AAAAAAAAADw/nGkxwlGVlV8/photo.jpg?sz=128", "display_name": "Syed Qasim Rizvi", "link": "https://stackoverflow.com/users/5803537/syed-qasim-rizvi"}, "edited": false, "score": 0, "creation_date": 1601925287, "post_id": 62497088, "comment_id": 113552130, "body": "I set the <code>DisableCompression</code> to <code>true</code>, still getting the content-length as 0."}], "tags": [], "owner": {"reputation": 688, "user_id": 8754171, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c603e8404fd51b3c8a0d807da6a7c2e0?s=128&d=identicon&r=PG&f=1", "display_name": "thks173", "link": "https://stackoverflow.com/users/8754171/thks173"}, "is_accepted": false, "score": 1, "last_activity_date": 1592734092, "creation_date": 1592734092, "answer_id": 62497088, "question_id": 49112440, "link": "https://stackoverflow.com/questions/49112440/unexpected-http-net-response-content-length-in-golang/62497088#62497088", "title": "Unexpected http/net response content length in Golang", "body": "<p>Just want to share my research.</p>\n<p>There's a <code>DisableCompression</code> option in the <code>http.Transport</code> struct, which default to <code>false</code> (<code>http.Get</code> use this default option). With that option, go's internal package will forcing gzip compression by adding the <code>Accept-Encoding: gzip</code> header in the request. After receiving the response, go's internal package will do the decompression job for us, so that we don't have to deal with the <code>gzip</code> chunk. They also delete the original <code>Content-Length</code> header because it's not correct anymore.</p>\n<p>All of that &quot;magic under the hood&quot; behaviors give us what we see here, missing the <code>Content-Length</code> header.</p>\n<p>Ref: <a href=\"https://github.com/golang/go/blob/master/src/net/http/transport.go#L182\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/net/http/transport.go#L182</a></p>\n"}], "owner": {"reputation": 644, "user_id": 2386745, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61387019fb6b26f69632b01f43211eb6?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/2386745/jordan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2101, "favorite_count": 0, "accepted_answer_id": 49112531, "answer_count": 2, "score": 2, "last_activity_date": 1592734092, "creation_date": 1520259342, "question_id": 49112440, "link": "https://stackoverflow.com/questions/49112440/unexpected-http-net-response-content-length-in-golang", "title": "Unexpected http/net response content length in Golang", "body": "<p>I am making a HTTP Get request using the code below. I proxy it through Fiddler to analyse the request. The request seems to be being made correctly, with the expected response. However, the <code>resp.ContentLength</code> property of the response in GO is <code>-1</code> \nevery time despite the fact that the response in Fiddler shows a positive integer value of <code>Content-Length: 1830</code>.</p>\n\n<p>Why is the ContentLength not being picked up in GO?</p>\n\n<p><strong>Go Code</strong></p>\n\n<pre><code>package main\n\nimport \"net/http\"\nimport \"os\"\nimport \"fmt\"\n\nfunc main() {\n    os.Setenv(\"HTTP_PROXY\", \"http://127.0.0.1:8888\") // For Fiddler debugging\n    resp,err := http.Get(\"http://www.google.com/robots.txt\")\n    if (err == nil) {\n        if (resp.StatusCode == 200) {\n            fmt.Println(resp.ContentLength) // Prints -1\n        }\n    }\n}\n</code></pre>\n\n<p><strong>Resulting Request in Fiddler</strong></p>\n\n<pre><code>GET /robots.txt HTTP/1.1\nHost: www.google.com\nUser-Agent: Go-http-client/1.1\nAccept-Encoding: gzip\n</code></pre>\n\n<p><strong>Response Received in Fiddler</strong></p>\n\n<pre><code>HTTP/1.1 200 OK\nAccept-Ranges: bytes\nVary: Accept-Encoding\nContent-Type: text/plain\nContent-Length: 6907\nDate: Mon, 05 Mar 2018 13:53:00 GMT\nExpires: Mon, 05 Mar 2018 13:53:00 GMT\nCache-Control: private, max-age=0\nLast-Modified: Thu, 01 Mar 2018 18:00:00 GMT\nX-Content-Type-Options: nosniff\nServer: sffe\nX-XSS-Protection: 1; mode=block\n</code></pre>\n"}, {"tags": ["go", "interface", "abstraction"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1520257590, "post_id": 49111863, "comment_id": 85228746, "body": "There&#39;s no way to answer this question. The proper solution depends on countless variables. How are you using these interfaces? Why do they need to be the same interface in the first place? How are they used? Should <code>Set</code> even be part of the interface? Etc etc. Without an intimate understanding of your application, there&#39;s no way to answer this."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520257591, "post_id": 49111863, "comment_id": 85228749, "body": "Do you want to keep both methods? Or you want a single, merged <code>Set()</code> method?"}, {"owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520257737, "post_id": 49111863, "comment_id": 85228829, "body": "@icza, I want single but flexible method"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520257843, "post_id": 49111863, "comment_id": 85228900, "body": "@Rudzianko\u016d Then that comes down to <a href=\"https://stackoverflow.com/questions/2032149/optional-parameters\">Optional Parameters?</a>"}, {"owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "edited": false, "score": 0, "creation_date": 1520258933, "post_id": 49111863, "comment_id": 85229546, "body": "Answered my own question, could you please review?"}], "answers": [{"tags": [], "owner": {"reputation": 314, "user_id": 4889150, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/42690a42dbab4128f423d2677b6c9d45?s=128&d=identicon&r=PG", "display_name": "Ivan Rubanau", "link": "https://stackoverflow.com/users/4889150/ivan-rubanau"}, "is_accepted": true, "score": 3, "last_activity_date": 1520258585, "last_edit_date": 1520258585, "creation_date": 1520257887, "answer_id": 49111981, "question_id": 49111863, "link": "https://stackoverflow.com/questions/49111863/abstraction-patterns-in-go/49111981#49111981", "title": "Abstraction patterns in go", "body": "<p>I guess, you should care of interface segregation principle while merging those methods.</p>\n\n<p>Technically, you are able to merge them by wrapping all arguments to <code>SetRequest</code> or something.\nInterface will be sort of</p>\n\n<pre><code>type Cache interface {\n    Set(request SetRequest) bool\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "is_accepted": false, "score": 0, "last_activity_date": 1520258889, "creation_date": 1520258889, "answer_id": 49112296, "question_id": 49111863, "link": "https://stackoverflow.com/questions/49111863/abstraction-patterns-in-go/49112296#49112296", "title": "Abstraction patterns in go", "body": "<p>Another opportunity just came in mind is unite interfaces into one:</p>\n\n<pre><code>type Cache interface {\n    Set(key, value interface{}, ttl time.Duration) bool\n}\n</code></pre>\n\n<p>And ignore redundant argument in method signature if necessary:</p>\n\n<pre><code>func (c *cache) Set(key, value interface{}, _ time.Duration) bool {\n</code></pre>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 1, "accepted_answer_id": 49111981, "answer_count": 2, "score": -3, "last_activity_date": 1520258889, "creation_date": 1520257465, "last_edit_date": 1520257506, "question_id": 49111863, "link": "https://stackoverflow.com/questions/49111863/abstraction-patterns-in-go", "title": "Abstraction patterns in go", "body": "<p>I have two interfaces. They are almost the same, the only difference is the <code>Set</code> method: </p>\n\n<pre><code>type Cache1 interface {\n    Set(key, value interface{}, ttl time.Duration) bool\n}\n\ntype Cache2 interface {\n    Set(key, value interface{}) bool\n}\n</code></pre>\n\n<p>Any idea how to unite them into one abstraction? Surely I can add <code>ttl time.Duration</code> to the second interface, but it will useless there and will worsen code readability. Could you please suggest sophisticated pattern if such exist?   </p>\n"}, {"tags": ["go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1520256051, "creation_date": 1520256051, "answer_id": 49111422, "question_id": 49111108, "link": "https://stackoverflow.com/questions/49111108/golang-mgo-modelling-issue/49111422#49111422", "title": "golang mgo modelling issue", "body": "<p>The problem is that for the <code>Nos.Reviews</code> field you did not specify any <code>bson</code> tag, which means the default mapping will be applied, which means the field name will be used with lowercase letter: <code>\"reviews\"</code>. But your MongoDB contains the document with a capital letter: <code>\"Reviews\"</code>, so the mapping will fail (unmarshaling will not match the MongoDB <code>\"Reviews\"</code> to the <code>Nos.Reviews</code> field).</p>\n\n<p>Specify the missing tag:</p>\n\n<pre><code>Reviews struct {\n    ReviewCommentsHistory []reviewCommentsHistory `json:\"reviewCommentsHistory\" bson:\"reviewCommentsHistory\"`\n} `json:\"Reviews\" bson:\"Reviews\"`\n</code></pre>\n\n<p>And it will work.</p>\n"}], "owner": {"reputation": 1170, "user_id": 4732633, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh6.googleusercontent.com/-3EqkwkKBaTo/AAAAAAAAAAI/AAAAAAAAAAA/hhuYb3A-0qo/photo.jpg?sz=128", "display_name": "Rahul Ganguly", "link": "https://stackoverflow.com/users/4732633/rahul-ganguly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 1, "accepted_answer_id": 49111422, "answer_count": 1, "score": 1, "last_activity_date": 1520256051, "creation_date": 1520254899, "last_edit_date": 1520254960, "question_id": 49111108, "link": "https://stackoverflow.com/questions/49111108/golang-mgo-modelling-issue", "title": "golang mgo modelling issue", "body": "<p>I have this model data which I use to save data to the database </p>\n\n<pre><code>type Nos struct {\n  UnitCode       string    `json:\"unitCode\" bson:\"unitCode\"`    \n  Version        string    `json:\"version\" bson:\"version\"`\n\n  Reviews struct {\n    ReviewCommentsHistory []reviewCommentsHistory `json:\"reviewCommentsHistory\" bson:\"reviewCommentsHistory\"`\n}\n  ID        bson.ObjectId `bson:\"_id\"`\n  CreatedAt time.Time     `bson:\"created_at\"`\n  UpdatedAt time.Time     `bson:\"updated_at\"`\n}\n\ntype reviewCommentsHistory struct {\n    ReviewHistoryDate time.Time `json:\"reviewHistoryDate\" bson:\"reviewHistoryDate,omitempty\"`   \n}\n</code></pre>\n\n<p>My mongodb data is as follows</p>\n\n<pre><code>{\n\"_id\" : ObjectId(\"5a992d5975885e236c8dc723\"),\n\"unitCode\" : \"G&amp;J/N3601\",\n\"version\" : \"3\",    \n\"Reviews\" : {\n    \"reviewCommentsHistory\" : [ \n        {\n            \"reviewHistoryDate\" : ISODate(\"2018-04-28T18:30:00.000Z\")              \n        }\n    ]\n}\n}\n</code></pre>\n\n<p>Using golang package mgo I have written the following piece of code to get the document</p>\n\n<pre><code>func (nosDal NosDal) FindNos(unitCode string, version string) ([]model.Nos, error) {\n    var result []model.Nos\n    var err error\n    col := repository.DB.C(\"nos\")   \n    err = col.Find(bson.M{\"unitCode\": strings.ToUpper(unitCode), \"version\": version}).All(&amp;result)\n    fmt.Println(result[0])\n    return result, err\n}\n</code></pre>\n\n<p>My response returns the value of null for Reviews.reviewCommentsHistory. Is there an issue with my model? Any pointers would be useful on how to check if the response is mapping to my model </p>\n\n<p>This is my output</p>\n\n<pre><code>{\n\"unitCode\": \"G&amp;J/N3601\",    \n\"version\": \"3\",    \n\"Reviews\": {\n    \"reviewCommentsHistory\": null\n},\n\"ID\": \"5a992d5975885e236c8dc723\",\n\"CreatedAt\": \"2018-03-02T16:24:17.19+05:30\",\n\"UpdatedAt\": \"2018-03-05T18:04:28.478+05:30\"\n}\n</code></pre>\n"}, {"tags": ["go", "reflection", "types", "slice"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1520255119, "last_edit_date": 1520255119, "creation_date": 1520252333, "answer_id": 49110370, "question_id": 49110256, "link": "https://stackoverflow.com/questions/49110256/checking-reflect-kind-on-interface-return-invalid-result/49110370#49110370", "title": "Checking reflect.Kind on interface{} return invalid result", "body": "<p><code>src</code> is a slice whose element type is <code>interface{}</code>. So each element you obtain is of static type <code>interface{}</code>, so their \"kind\" will be <code>reflect.Interface</code>. Adding a new <code>reflect.Interface</code> case will reveal that:</p>\n\n<pre><code>case reflect.Interface:\n    fmt.Println(\"value\", each.Interface(), \"is interface\")\n</code></pre>\n\n<p>Output will be (try it on the <a href=\"https://play.golang.org/p/TY0l0KrWrIO\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>value noval is interface\nvalue 0 is interface\nvalue &lt;nil&gt; is nil\n</code></pre>\n\n<p>If you want the \"wrapped\" element in the interface, use <a href=\"https://golang.org/pkg/reflect/#Value.Elem\" rel=\"nofollow noreferrer\"><code>Value.Elem()</code></a>:</p>\n\n<pre><code>} else if each.Kind() == reflect.Interface {\n    switch each.Elem().Kind() {\n    case reflect.String:\n        fmt.Println(\"value\", each.Interface(), \"is string\")\n    case reflect.Int, reflect.Int16:\n        fmt.Println(\"value\", each.Interface(), \"is int\")\n    default:\n        fmt.Println(\"value\", each.Interface(), \"is ?\")\n    }\n}\n</code></pre>\n\n<p>Then output will be (try it on the <a href=\"https://play.golang.org/p/31k3afRfehv\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>value noval is string\nvalue 0 is int\nvalue &lt;nil&gt; is nil\n</code></pre>\n\n<p>Also note that you're \"switching\" over the <em>kind</em> of the values, not over their actual <em>types</em>. What this means is that values of multiple types may end up in specific cases, like in this one:</p>\n\n<pre><code>type mystr string\nsrc := []interface{}{\"noval\", 0, nil, mystr(\"my\")}\nsrcType := reflect.ValueOf(src)\n\n// ...\n</code></pre>\n\n<p>Output of this will be (try it on the <a href=\"https://play.golang.org/p/F84qLLlVcY2\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>value noval is string\nvalue 0 is int\nvalue &lt;nil&gt; is nil\nvalue my is string\n</code></pre>\n\n<p>The value <code>mystr(\"my\")</code> is detected as <code>string</code>, because it is of <code>string</code> <em>\"kind\"</em>, but its type is not <code>string</code> but <code>mystr</code>. This may or may not be what you want. If you want to distinguish between a value of type <code>string</code> and <code>mystr</code>, then you should \"switch\" over the actual <em>type</em> of values like in this example:</p>\n\n<pre><code>} else if each.Kind() == reflect.Interface {\n    switch each.Elem().Type() {\n    case reflect.TypeOf(\"\"):\n        fmt.Println(\"value\", each.Interface(), \"is string\")\n    case reflect.TypeOf(0):\n        fmt.Println(\"value\", each.Interface(), \"is int\")\n    case reflect.TypeOf(mystr(\"\")):\n        fmt.Println(\"value\", each.Interface(), \"is mystr\")\n    default:\n        fmt.Println(\"value\", each.Interface(), \"is ?\")\n    }\n}\n</code></pre>\n\n<p>Then output will be (try it on the <a href=\"https://play.golang.org/p/InetxrB5QeI\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>value noval is string\nvalue 0 is int\nvalue &lt;nil&gt; is nil\nvalue my is mystr\n</code></pre>\n\n<p>As you can see <code>\"nova\"</code> is detected as a value of type <code>string</code>, and <code>mystr(\"my\")</code> is properly detected as a value of type <code>mystr</code>.</p>\n\n<p>Also note that for what you're trying to do, you don't need reflection, just use a <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\">type switch</a>:</p>\n\n<pre><code>src := []interface{}{\"noval\", 0, nil}\nfor _, v := range src {\n    switch v.(type) {\n    case string:\n        fmt.Println(\"value\", v, \"is string\")\n    case int:\n        fmt.Println(\"value\", v, \"is int\")\n    case nil:\n        fmt.Println(\"value\", v, \"is nil\")\n    default:\n        fmt.Println(\"value\", v, \"is ?\")\n    }\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/P0wytfG4Yq6\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>value noval is string\nvalue 0 is int\nvalue &lt;nil&gt; is nil\n</code></pre>\n"}], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1002, "favorite_count": 0, "accepted_answer_id": 49110370, "answer_count": 1, "score": 1, "last_activity_date": 1543726496, "creation_date": 1520251958, "last_edit_date": 1543726496, "question_id": 49110256, "link": "https://stackoverflow.com/questions/49110256/checking-reflect-kind-on-interface-return-invalid-result", "title": "Checking reflect.Kind on interface{} return invalid result", "body": "<p>I'm have some confusion over golang reflect behaviour.</p>\n\n<p>So basically I have a slice named <code>src</code> with type <code>[]interface{}</code>. I would like to get the actual type of each element. This is what I did:</p>\n\n<pre><code>src := []interface{}{\"noval\", 0, nil}\nsrcType := reflect.ValueOf(src)\n\nfor i := 0; i &lt; srcType.Len(); i++ {\n    each := srcType.Index(i)\n\n    if each.Interface() == nil {\n        fmt.Println(\"value\", each.Interface(), \"is nil\")\n    } else {\n        switch each.Kind() {\n        case reflect.String:\n            fmt.Println(\"value\", each.Interface(), \"is string\")\n        case reflect.Int, reflect.Int16:\n            fmt.Println(\"value\", each.Interface(), \"is int\")\n        default:\n            fmt.Println(\"value\", each.Interface(), \"is ?\")\n        }\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>value noval is ?\nvalue 0 is ?\nvalue &lt;nil&gt; is nil\n</code></pre>\n\n<p>I don't understand why type of elements <code>\"noval\"</code> is not detected as <code>string</code>, instead the <code>default</code> is called from the <code>switch</code>. </p>\n\n<p>Also the <code>0</code> value should be identified as <code>reflect.Int</code> but the <code>default</code> is called again.</p>\n\n<p>Can somebody enlighten me please, thank you in advance.</p>\n"}, {"tags": ["go", "deferred", "subroutine", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1520263964, "post_id": 49108247, "comment_id": 85232820, "body": "The documentation is clear: <code>defer</code>ed calls execute <i>when the function returns</i>. A goroutine runs concurrently, and therefor has no impact on the calling function&#39;s return timing. So, no, there is no reason why it would &quot;wait&quot; for the goroutine to finish, nor should it."}], "answers": [{"tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": true, "score": 2, "last_activity_date": 1520247986, "last_edit_date": 1520247986, "creation_date": 1520245845, "answer_id": 49108346, "question_id": 49108247, "link": "https://stackoverflow.com/questions/49108247/will-defer-be-waiting-until-subroutine-finishes-execution/49108346#49108346", "title": "Will defer be waiting until subroutine finishes execution?", "body": "<p>No. Defer will not wait for your go routine to finish.\nIF you want to do that, wait till the go routine is done executing using <code>sync.WaitGroup</code>. </p>\n\n<pre><code>func TestDefer(lock sync.RWMutex, wait time.Duration) {\n    wg := new(sync.WaitGroup)\n    lock.Lock()\n    defer lock.Unlock()\n\n    wg.Add(1)\n    // start goroutine \n    go func() {\n        defer wg.Done()\n        time.Sleep(wait)\n    }()\n    wg.Wait()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 4, "last_activity_date": 1520245849, "creation_date": 1520245849, "answer_id": 49108348, "question_id": 49108247, "link": "https://stackoverflow.com/questions/49108247/will-defer-be-waiting-until-subroutine-finishes-execution/49108348#49108348", "title": "Will defer be waiting until subroutine finishes execution?", "body": "<p>No, as soon as the <code>go</code> statement finishes its execution (that is, the Go runtime creates a new goroutine and puts it on some run queue), the execution of the function continues, and since the function's body ends there,\nthe functions deferred in it will run.</p>\n\n<p>Synchronization between goroutines only ever happens explicitly\u2014by means of channel operations of using primitives from the packages of the <code>sync</code> hierarchy.</p>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1146, "favorite_count": 0, "accepted_answer_id": 49108346, "answer_count": 2, "score": 0, "last_activity_date": 1520247986, "creation_date": 1520245525, "question_id": 49108247, "link": "https://stackoverflow.com/questions/49108247/will-defer-be-waiting-until-subroutine-finishes-execution", "title": "Will defer be waiting until subroutine finishes execution?", "body": "<p>I have such function:</p>\n\n<pre><code>func TestDefer(lock sync.RWMutex, wait time.Duration) {\n\n    lock.Lock()\n    defer lock.Unlock()\n\n    // start goroutine \n    go func() {\n        time.Sleep(wait)\n    }()\n}\n</code></pre>\n\n<p>I am eager to know when <code>lock.Unlock()</code> will be executed? Is it synchronized with subroutine <code>go func()</code> ? Will it be waiting until it finishes?  </p>\n"}, {"tags": ["go", "godoc"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1520241960, "post_id": 49106943, "comment_id": 85219099, "body": "Why the build tag?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1520242024, "post_id": 49106943, "comment_id": 85219134, "body": "Yes, the build tag causes this file to be excluded unless you explicitly provide that build tag, which godoc.org surely does not."}, {"owner": {"reputation": 912, "user_id": 6012434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MZcOa.png?s=128&g=1", "display_name": "Robo", "link": "https://stackoverflow.com/users/6012434/robo"}, "edited": false, "score": 0, "creation_date": 1520242553, "post_id": 49106943, "comment_id": 85219414, "body": "Ah, the build tag is there because I wanted to remove the mocks from the example code so I had to make it an integration test"}, {"owner": {"reputation": 912, "user_id": 6012434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MZcOa.png?s=128&g=1", "display_name": "Robo", "link": "https://stackoverflow.com/users/6012434/robo"}, "edited": false, "score": 0, "creation_date": 1520242754, "post_id": 49106943, "comment_id": 85219505, "body": "Thanks removing the build tag fixed it. I&#39;d still like it to be an integration test but I guess I&#39;ll have to find another way"}, {"owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "edited": false, "score": 0, "creation_date": 1520243060, "post_id": 49106943, "comment_id": 85219696, "body": "Try separating into a test package: &quot;As with typical tests, examples are functions that reside in a package&#39;s _test.go files. Unlike normal test functions, though, example functions take no arguments and begin with the word Example instead of Test.&quot;"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520264070, "post_id": 49106943, "comment_id": 85232899, "body": "Just keep integration tests and examples in separate files."}, {"owner": {"reputation": 912, "user_id": 6012434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MZcOa.png?s=128&g=1", "display_name": "Robo", "link": "https://stackoverflow.com/users/6012434/robo"}, "edited": false, "score": 0, "creation_date": 1520300278, "post_id": 49106943, "comment_id": 85249784, "body": "I am, but still when you run <code>go test</code> the examples are run and fail"}], "owner": {"reputation": 912, "user_id": 6012434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MZcOa.png?s=128&g=1", "display_name": "Robo", "link": "https://stackoverflow.com/users/6012434/robo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 466, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1520241506, "creation_date": 1520241506, "question_id": 49106943, "link": "https://stackoverflow.com/questions/49106943/why-arent-my-examples-showing-up-in-godoc", "title": "Why aren&#39;t my examples showing up in GoDoc?", "body": "<p>I created a package with examples in the _test.go file and it worked fine. I moved the examples to integration_test.go then example_test.go and now they don't show up in <a href=\"https://godoc.org/github.com/patrobinson/gokini\" rel=\"nofollow noreferrer\">my godoc</a></p>\n\n<p>The contents of example_test.go is like so:</p>\n\n<pre><code>//+build integration\n\npackage gokini\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype PrintRecordConsumer struct {\n    shardID string\n}\n\nfunc ExampleRecordConsumer() {\n    // SNIP\n\n    // Output:\n    // Checkpointer initializing\n    // foo\n    // PrintRecordConsumer Shutdown\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520241136, "post_id": 49106802, "comment_id": 85218654, "body": "Unmarshal into a simple value of type <code>interface{}</code>. Does that work for you? Any valid JSON can be unmarshaled into that."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520241141, "post_id": 49106802, "comment_id": 85218658, "body": "This is because When you are unmarshalling a json to interface{} it can also contain bool/float64/string. You have to add cases for the same too"}, {"owner": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1520241158, "post_id": 49106802, "comment_id": 85218669, "body": "I tried to switch the type of the &quot;val&quot; and convert it to string before passing it to the f.WriteString function, still the same error!!"}, {"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1520241185, "post_id": 49106802, "comment_id": 85218683, "body": "any example failed json would help"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1520242047, "post_id": 49106802, "comment_id": 85219150, "body": "You aren&#39;t handling strings, float and bools."}, {"owner": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1520248338, "post_id": 49106802, "comment_id": 85223128, "body": "So the JSON can either be an array or an object, in the second case I call PaseMap and iterate into the values, I added the cases to handle string, float, bool... I don&#39;t understand if the problem is in unmarshalling itself(I tried to unmarshal in a interface{}, still same error) or in converting and writing values in file in case they are not strings..."}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1520247420, "post_id": 49107090, "comment_id": 85222503, "body": "I did unmarshal JSON into an interface{} and then did a switch of the real type of the interface{} and added the cases as you said but I am still getting the same error."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1520248450, "post_id": 49107090, "comment_id": 85223193, "body": "Show the json that you are unmarshalling and the code that you have tried after passing data. Are you getting same error"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1520248890, "post_id": 49107090, "comment_id": 85223467, "body": "May be you are using file.WriteString that&#39;s why the string can be written. You can use file.Write"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1520249333, "post_id": 49107090, "comment_id": 85223738, "body": "I have found a mistake in your code and edited it. We needs to convert <code>other.(bool)</code> to <code>other.(interface{}).(bool)</code>"}, {"owner": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1520249733, "post_id": 49107090, "comment_id": 85223989, "body": "But I am converting values to string before using the file.WriteString!"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1520250012, "post_id": 49107090, "comment_id": 85224184, "body": "yeah its ok if you are converting the details into string but it is not a good approach. We should be printing  exact type to the file. Else in future we will not going to know the type of an element. I have also edited your question. Please check the changes and try it once again. see if it works"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1520250805, "post_id": 49107090, "comment_id": 85224643, "body": "In my code I have print the type of underlying value in interface{}. Using <code>fmt.Printf(&quot;Default value is of type %v&quot;, bb)</code> Check that in your code to see what it prints."}, {"owner": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1520257759, "post_id": 49107090, "comment_id": 85228838, "body": "So, my code works on its own now, but when defining it as a package in my API, I always get the error. I will check what is the cause of the error. Thank you all for your help."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1520258509, "post_id": 49107090, "comment_id": 85229290, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/166246/discussion-between-himanshu-and-dorra-hadrich\">continue this discussion in chat</a>."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1520277767, "post_id": 49107090, "comment_id": 85241184, "body": "We cannot discuss anything in comment If you have any other question post it."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 2, "last_activity_date": 1520248966, "last_edit_date": 1520248966, "creation_date": 1520242038, "answer_id": 49107090, "question_id": 49106802, "link": "https://stackoverflow.com/questions/49106802/golang-error-interface-conversion-interface-is-bool-float-not-string/49107090#49107090", "title": "Golang error: interface conversion: interface {} is bool/float..., not string", "body": "<p>The error says it all:</p>\n\n<blockquote>\n  <p>interface conversion: interface{} is bool/float64</p>\n</blockquote>\n\n<p>when you are unmarshalling json the values for int and bool which are not of interface type. In your switch add case for bool/float64/string too. Since json is arbitrary unmarshal them using interface{}.</p>\n\n<pre><code>func otherValues(other interface{}, f *os.File, err error) {\n    switch bb := other.(interface{}).(type) {\n    case string:\n        fmt.Println(\"This is a string\")\n    case float64:\n        fmt.Println(\"this is a float\")\n    case bool:\n        fmt.Println(\"this is a boolean\")\n    default:\n        fmt.Printf(\"Default value is of type %v\", bb)\n    }\n}\n</code></pre>\n\n<p>Use <a href=\"https://golang.org/pkg/os/#File.Write\" rel=\"nofollow noreferrer\">file.Write</a> in place of file.WriteString</p>\n\n<pre><code>func (f *File) Write(b []byte) (n int, err error)\n</code></pre>\n\n<blockquote>\n  <p>Write writes len(b) bytes to the File. It returns the number of bytes\n  written and an error, if any. Write returns a non-nil error when n !=\n  len(b).</p>\n</blockquote>\n"}], "owner": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6608, "favorite_count": 0, "accepted_answer_id": 49107090, "answer_count": 1, "score": 1, "last_activity_date": 1566919989, "creation_date": 1520240975, "last_edit_date": 1566919989, "question_id": 49106802, "link": "https://stackoverflow.com/questions/49106802/golang-error-interface-conversion-interface-is-bool-float-not-string", "title": "Golang error: interface conversion: interface {} is bool/float..., not string", "body": "<p>I am trying to decode an arbitrary JSON using Golang, so I unmarshal the incoming JSON in a map[string]interface{} as shown in the code below:</p>\n\n<pre><code>    func JsonHandler(jsonRequest []byte) {\n\n      // Creating the maps for JSON\n      var m interface{}\n\n      // Parsing/Unmarshalling JSON encoding/json\n      if err := json.Unmarshal([]byte(jsonRequest), &amp;m); err != nil {\n            panic(err)\n       }\n\n       //Creating an output file for writing\n       f, err := os.OpenFile(\"/home/dorrahadrich/Desktop/output.txt\", os.O_APPEND|os.O_WRONLY|os.O_CREATE, 0600)\n       if err != nil {\n           panic(err)\n       }\n\n       defer f.Close()\n\n       ParseJson(m, f, err)\n   }\n\n   func ParseJson(m interface{}, f *os.File, err error) {\n       switch v := m.(interface{}).(type){\n          case map[string]interface{}:\n               ParseMap (m.(map[string]interface{}),f,err)\n               fmt.Println(v)\n          case []interface{}:\n               ParseArray (m.([]interface{}),f,err)\n               fmt.Println(v)\n          default:\n     }\n }\n\n   func ParseMap(aMap map[string]interface{}, f *os.File, err error) {\n    for key, val := range aMap {\n        switch val.(type) {\n        case map[string]interface{}:\n            if _, err = f.WriteString(key + \"={\\n\"); err != nil {\n                panic(err)\n            }\n\n            ParseMap(val.(map[string]interface{}), f, err)\n\n            //Close brackets\n            if _, err = f.WriteString(\"};\\n\"); err != nil {\n                panic(err)\n            }\n\n        case []interface{}:\n            //Write to file\n            if _, err = f.WriteString(key + \"={\\n\"); err != nil {\n                panic(err)\n            }\n\n            ParseArray(val.([]interface{}), f, err)\n\n            //Close brackets\n            if _, err = f.WriteString(\"};\\n\"); err != nil {\n                panic(err)\n            }\n        default:\n            otherValues(key, val.(interface{}), f , err)\n        }\n    }\n}\n\nfunc ParseArray(anArray []interface{}, f *os.File, err error) {\n    for _, val := range anArray {\n        switch val.(type) {\n        case map[string]interface{}:\n            ParseMap(val.(map[string]interface{}), f, err)\n        case []interface{}:\n            ParseArray(val.([]interface{}), f, err)\n        default:\n        }\n    }\n\n}\nfunc otherValues(key string, other interface{}, f *os.File, err error) {\n     if _, err = f.WriteString(key); err != nil {\n           panic(err)\n        }\n    if _, err = f.WriteString(\"=\"); err != nil {\n        panic(err)\n        }\n\n   switch other.(interface{}).(type) {\n       case string:\n           if _, err = f.WriteString(other.(string)); err != nil {\n               panic(err)\n            }\n       case float64:\n           if _, err = f.WriteString(strconv.FormatFloat(other.(float64), 'f', -1, 64)); err != nil {\n                panic(err)\n            }\n       case bool:\n    if _, err = f.WriteString(strconv.FormatBool(other.(bool))); err != nil {\n                panic(err)\n            }\n       default:\n     }  \n   }\n</code></pre>\n\n<p>The problem is that whenever a JSON contains a bool/int/float or any not string value the program panics saying that it fails converting an interface to the given type! Please note that the JSON is arbitrary so I don't have any idea about the keys nor the values, I can't unmrashal into an interface nor access the values giving a path.</p>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 3, "creation_date": 1520234785, "post_id": 49105119, "comment_id": 85215615, "body": "Try to profile it by yourself using <a href=\"https://golang.org/pkg/runtime/pprof\" rel=\"nofollow noreferrer\">golang.org/pkg/runtime/pprof</a>"}], "answers": [{"tags": [], "owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "is_accepted": true, "score": 0, "last_activity_date": 1520276112, "creation_date": 1520276112, "answer_id": 49117563, "question_id": 49105119, "link": "https://stackoverflow.com/questions/49105119/websockets-running-in-background-of-go-program-causing-100-cpu-usage/49117563#49117563", "title": "Websockets running in background of go program causing 100% CPU usage", "body": "<p>This happens when you have an infinite loop spinning in a goroutine. It's hard to see where that's happening with the code subset you've posted. But that's the reason why. </p>\n"}], "owner": {"reputation": 127, "user_id": 8312588, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f526528e96c1fc2f91e923f2d82fc7e9?s=128&d=identicon&r=PG&f=1", "display_name": "leopardsticks", "link": "https://stackoverflow.com/users/8312588/leopardsticks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 394, "favorite_count": 0, "accepted_answer_id": 49117563, "answer_count": 1, "score": 0, "last_activity_date": 1520276112, "creation_date": 1520233725, "question_id": 49105119, "link": "https://stackoverflow.com/questions/49105119/websockets-running-in-background-of-go-program-causing-100-cpu-usage", "title": "Websockets running in background of go program causing 100% CPU usage", "body": "<p>I've implemented web sockets in my go program to regularly update three variables in the background while other processes are happening. Since doing this the program has begun taking up 100% of the CPU usage almost immediately and I'm unsure as to why.</p>\n\n<p>Here is the code in question:</p>\n\n<pre><code>streamOneHandler := func(event *websockets.Event) {\n    varOne, err = strconv.ParseFloat(event.Number, 64)\n}\n\nstreamTwoHandler := func(event *websockets.Event) {\n    varTwo, err = strconv.ParseFloat(event.Number, 64)\n}\n\nstreamThreeHandler := func(event *websockets.Event) {\n    varThree, err = strconv.ParseFloat(event.Number, 64)\n}\n\nerrHandler := func(err error) {\n    fmt.Println(err)\n}\n\n\nstreamOne, err = websockets.WsEventServe(\"string1\", streamOneHandler, errHandler )\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\nstreamTwo, err = websockets.WsEventServe(\"string2\", streamTwoHandler, errHandler )\n\n    if err != nil {\n        log.Fatal(err)\n\nstreamThree, err = websockets.WsEventServe(\"string3\", streamThreeHandler, errHandler )\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n\ngo func() {\n    &lt;- streamOne\n    &lt;- streamTwo\n    &lt;- streamThree\n}()\n</code></pre>\n\n<p>Any help figuring out what's causing this huge spike in CPU usage would be much appreciated.</p>\n"}, {"tags": ["go", "time", "timezone"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520236322, "post_id": 49104894, "comment_id": 85216284, "body": "You do need the time zone database, but you don&#39;t have to write the parsing logic for it. You may use <a href=\"https://golang.org/pkg/time/#LoadLocationFromTZData\" rel=\"nofollow noreferrer\"><code>time.LoadLocationFromTZData()</code></a>. Also see unexported <a href=\"https://golang.org/src/time/zoneinfo_abbrs_windows.go\" rel=\"nofollow noreferrer\"><code>time&#47;zoneinfo_abbrs_windows.go</code></a> which is generated by <a href=\"https://golang.org/src/time/genzabbrs.go\" rel=\"nofollow noreferrer\"><code>time&#47;genzabbrs.go</code></a>."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1537842379, "post_id": 49104894, "comment_id": 91920402, "body": "@icza I do not understant how that works, how do I get &quot;data&quot; parameter, could you make an example please, I&#39;m having trouble with container aplication <a href=\"https://stackoverflow.com/questions/52489347/how-to-create-a-binary-that-contains-zoneinfo-zip\" title=\"how to create a binary that contains zoneinfo zip\">stackoverflow.com/questions/52489347/&hellip;</a>"}, {"owner": {"reputation": 1073, "user_id": 1236933, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/wMe0s.jpg?s=128&g=1", "display_name": "Gintama", "link": "https://stackoverflow.com/users/1236933/gintama"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1541561767, "post_id": 49104894, "comment_id": 93256472, "body": "@JohnBalvinArias you can see example in <a href=\"https://golang.org/src/time/zoneinfo.go\" rel=\"nofollow noreferrer\">golang.org/src/time/zoneinfo.go</a>"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 1073, "user_id": 1236933, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/wMe0s.jpg?s=128&g=1", "display_name": "Gintama", "link": "https://stackoverflow.com/users/1236933/gintama"}, "edited": false, "score": 0, "creation_date": 1541573430, "post_id": 49104894, "comment_id": 93258852, "body": "@Gintama I just did it by the time a post my comment, but thanks anyway :D"}], "owner": {"reputation": 700, "user_id": 6940117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/us57e.png?s=128&g=1", "display_name": "Slotheroo", "link": "https://stackoverflow.com/users/6940117/slotheroo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3114, "favorite_count": 0, "closed_date": 1520236328, "answer_count": 0, "score": 1, "last_activity_date": 1520232556, "creation_date": 1520232556, "question_id": 49104894, "link": "https://stackoverflow.com/questions/49104894/golang-time-zone-list", "closed_reason": "Duplicate", "title": "Golang time zone list", "body": "<p>Does anyone know of a way to have Go's time package (<a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/</a>) provide me with a list of valid Locations (aka valid time zones)? I'm writing an application and I'd like to present users with a valid list of time zones based on the ones that will work with Go. However, based on my study of the package, it doesn't seem like any such list is available from an exported func or variable.</p>\n\n<p>I do know that Go uses the IANA Time Zone Database as its underlying supplier of time zone info, and I can get my own copy of the database to extract the information that I need. It just seems like it would be easier if I could get the list from Go since it already has access for that information without me having to write my own code to parse the IANA Time Zone Database.</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 1, "creation_date": 1520230030, "post_id": 49104292, "comment_id": 85213810, "body": "You have a race on updating filteredSymbols, you need a lock or switch to a results channel"}, {"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "reply_to_user": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 0, "creation_date": 1520230237, "post_id": 49104292, "comment_id": 85213894, "body": "can you please be more specific/clear with that? I&#39;m very new to programming as a whole. Just one year in the field"}, {"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "reply_to_user": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 0, "creation_date": 1520230712, "post_id": 49104292, "comment_id": 85214033, "body": "how can I switch to <code>results</code> channel when I need <code>sem</code> channel to handle limiting number of goroutines running concurrently? I may add it but can you please specify where the <code>filteredSymbols = append(filteredSymbols, &lt;-results)</code> should happen? Also, we need to consider that we don&#39;t know how many results will be returned"}, {"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "reply_to_user": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 0, "creation_date": 1520230937, "post_id": 49104292, "comment_id": 85214108, "body": "just saw <code>SizedWaitGroup</code> now. But still don&#39;t know the correct solution to the race in appending to <code>filteredSymbols</code>"}, {"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "reply_to_user": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 0, "creation_date": 1520232509, "post_id": 49104292, "comment_id": 85214699, "body": "after reading about <code>MUTEX</code>, I now know what to do. Still, to anyone,  feel free to answer this thread and I will accept the best one :) Sad that I have to change a lot of codes"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520236663, "post_id": 49104292, "comment_id": 85216433, "body": "See related <a href=\"https://stackoverflow.com/questions/38170852/is-this-an-idiomatic-worker-thread-pool-in-go/38172204#38172204\">Is this an idiomatic worker thread pool in Go?</a>"}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1520263492, "post_id": 49104292, "comment_id": 85232473, "body": "Maybe you might take a look at some concurrency tutorials <a href=\"https://talks.golang.org/2012/concurrency.slide#1\" rel=\"nofollow noreferrer\">talks.golang.org/2012/concurrency.slide#1</a> and <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">blog.golang.org/pipelines</a>."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1520263523, "post_id": 49104292, "comment_id": 85232500, "body": "and <a href=\"https://github.com/golang/go/wiki/LearnConcurrency\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/LearnConcurrency</a>"}], "answers": [{"tags": [], "owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "is_accepted": true, "score": 0, "last_activity_date": 1520310999, "creation_date": 1520310999, "answer_id": 49123465, "question_id": 49104292, "link": "https://stackoverflow.com/questions/49104292/how-to-implement-concurrent-goroutines-and-or-limit-them-properly-to-yield-con/49123465#49123465", "title": "How to implement concurrent goroutines (and/or limit them) properly to yield consistent results?", "body": "<p>You have a data race, multiple goroutines are updating filteredSymbols at the same time. The smallest change you can make to fix it is to add a mutex lock around the append call, e.g.</p>\n\n<pre><code>concurrency := 5\nsem := make(chan bool, concurrency)\nl := sync.Mutex{}\nfor i := range symbols {\n    sem &lt;- true\n    go func(int) {\n        defer func() { &lt;-sem }()\n        rows, err := stmt.Query(symbols[i])\n        if &lt;some condition is true&gt; {\n            l.Lock()\n            filteredSymbols = append(filteredSymbols, symbols[i])\n            l.Unlock()\n        }\n    }(i)\n}\nfor i := 0; i &lt; cap(sem); i++ {\n    sem &lt;- true\n}\n</code></pre>\n\n<p>The <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">Race Detector</a> could of helped you spot this as well.\nOne common alternative would be to use a channel to get work into a goroutine, and a channel to get the results out, something like.</p>\n\n<pre><code>concurrency := 5\nworkCh := make(chan string, concurrency)\nresCh := make(chan string, concurrency)\nworkersWg := sync.WaitGroup{}\n// start the required number of workers, use the WaitGroup to see when they're done\nfor i := 0; i &lt; concurrency; i++ {\n   workersWg.Add(1)\n   go func() {\n     defer workersWg.Done()\n     for symbol := range workCh {\n          // do some work\n          if cond {\n              resCh &lt;- symbol\n          }\n     }\n   }()\n}\ngo func() {\n    // when all the workers are done, close the resultsCh\n    workersWg.Wait()\n    close(resCh)\n}()\n// submit all the work\nfor _, s := range symbols {\n    workCh &lt;- s\n}\nclose(workCh)\n// collect up the results \nfor r := range resCh {\n    filteredSymbols = append(filteredSymbols, r)\n}\n</code></pre>\n"}], "owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 49123465, "answer_count": 1, "score": 1, "last_activity_date": 1520310999, "creation_date": 1520229402, "last_edit_date": 1520229749, "question_id": 49104292, "link": "https://stackoverflow.com/questions/49104292/how-to-implement-concurrent-goroutines-and-or-limit-them-properly-to-yield-con", "title": "How to implement concurrent goroutines (and/or limit them) properly to yield consistent results?", "body": "<p>I'm using this: (symbols is []string as well as filteredSymbols)</p>\n\n<pre><code>concurrency := 5\nsem := make(chan bool, concurrency)\n\nfor i := range symbols {\n    sem &lt;- true\n    go func(int) {\n        defer func() { &lt;-sem }()\n        rows, err := stmt.Query(symbols[i])\n        if &lt;some condition is true&gt; {\n            filteredSymbols = append(filteredSymbols, symbols[i])\n        }\n    }(i)\n}\nfor i := 0; i &lt; cap(sem); i++ {\n    sem &lt;- true\n}\n</code></pre>\n\n<p>to limit number of goroutines running concurrently. I need to limit it because every goroutine interacts with Postgres database and sometimes I do have more than 3000 symbols to evaluate. The code is for analysing big financial data, stocks and other securities. I'm also using same code to get OHLC and pre-calculated data from db. Is this a modern approach for this? I'm asking this because WaitGroups already exist and I'm looking for a way to use those instead.</p>\n\n<p>Also, I observed that my method above sometimes yield different results. I had a code where sometimes the resulting number of filteredSymbols is 1409. Without changing the parameters, it would then yield 1407 results, then 1408 at times. \nI even had a code where there were big deficit in results. </p>\n\n<p>The code below was very inconsistent so I removed the concurrency. (NOTE that in code below, I don't even have to limit concurrent goroutines since they only use in-memory resources). Removing concurrency fixed it</p>\n\n<pre><code>func getCommonSymbols(symbols1 []string, symbols2 []string) (symbols []string) {\n    defer timeTrack(time.Now(), \"Get common symbols\")\n    // concurrency := len(symbols1)\n    // sem := make(chan bool, concurrency)\n\n    // for _, s := range symbols1 {\n    for _, sym := range symbols1 {\n        // sym := s\n        // sem &lt;- true\n        // go func(string) {\n        // defer func() { &lt;-sem }()\n        for k := range symbols2 {\n            if sym == symbols2[k] {\n                symbols = append(symbols, sym)\n                break\n            }\n        }\n        // }(sym)\n    }\n    // for i := 0; i &lt; cap(sem); i++ {\n    //  sem &lt;- true\n    // }\n    return\n}\n</code></pre>\n"}, {"tags": ["go", "null", "slice"], "comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 1, "creation_date": 1520228949, "post_id": 49104157, "comment_id": 85213464, "body": "Is this similar to <a href=\"https://stackoverflow.com/q/30806931/6309\">stackoverflow.com/q/30806931/6309</a>?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1520231733, "post_id": 49104157, "comment_id": 85214406, "body": "Which subtle bugs regarding nil slices are you referring too?"}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1520234356, "post_id": 49104157, "comment_id": 85215434, "body": "In some situations there is a subtle difference between &quot;There are no apples in the box&quot; and &quot;There is no box&quot;."}, {"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 0, "creation_date": 1520238720, "post_id": 49104157, "comment_id": 85217344, "body": "I&#39;ve written an answer <a href=\"https://stackoverflow.com/a/45997533/1561148\">here</a>, which has some explanation from the <i>&quot;Go in action&quot;</i> book that might shed some light..."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1550831224, "last_edit_date": 1550831224, "creation_date": 1520238140, "answer_id": 49106111, "question_id": 49104157, "link": "https://stackoverflow.com/questions/49104157/what-is-the-point-of-having-nil-slice-and-empty-slice-in-golang/49106111#49106111", "title": "What is the point of having nil slice and empty slice in golang?", "body": "<p>A <code>nil</code> slice value needs no allocation. That might make a difference in cases where you want to build something in a slice, but often there will be no data to be appended, so the slice may remain <code>nil</code>, so no allocation will be required altogether.</p>\n\n<p>An empty slice might require an allocation, even if its capacity is zero.</p>\n\n<p>Also an empty slice means its length is 0, but its capacity may not be; so it's not true that <em>\"For all intents and purposes, a <code>nil</code> slice and an empty slice behave the same when using them.\"</em>. You can allocate a slice with 0 length and a big capacity, optimizing for further appends to avoid allocations (and copying over):</p>\n\n<pre><code>s := make([]int, 0)\nfmt.Println(s, len(s), cap(s))\ns = append(s, 1)\nfmt.Println(s, len(s), cap(s))\n\ns = make([]int, 0, 10)\nfmt.Println(s, len(s), cap(s))\ns = append(s, 1)\nfmt.Println(s, len(s), cap(s))\n</code></pre>\n\n<p>Output of the above (try it on the <a href=\"https://play.golang.org/p/mGRisWCO0Lg\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[] 0 0\n[1] 1 2\n[] 0 10\n[1] 1 10\n</code></pre>\n\n<p>What do we see? In the first example we created an empty slice with 0 length and 0 capacity. If we append an element to it, its length will become 1 (obviously), and its capacity increased to 2. This is because under the hood <code>append()</code> allocated a new array with size of 2 (thinking of future growth), copied the existing elements over (which was none in this case), and assigned the new element.</p>\n\n<p>In the second case we started with an empty slice but with a capacity of 10. This means we can append 10 elements to it without causing a new allocation and copying existing elements. This can be a big plus when slices are big and this needs to be done many times.</p>\n"}], "owner": {"reputation": 113, "user_id": 5861532, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/82d1a995accf9de144d18259d77fa605?s=128&d=identicon&r=PG&f=1", "display_name": "Ste", "link": "https://stackoverflow.com/users/5861532/ste"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1499, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1550831224, "creation_date": 1520228696, "last_edit_date": 1520238470, "question_id": 49104157, "link": "https://stackoverflow.com/questions/49104157/what-is-the-point-of-having-nil-slice-and-empty-slice-in-golang", "title": "What is the point of having nil slice and empty slice in golang?", "body": "<p>What is the point of differentiating between a nil slice, ie. uninitialized slice, and an empty slice, ie. initialized but empty slice?</p>\n\n<p>I understand the difference, but I'm wondering what the motivation is behind having the subtle difference between the two cases? For all intents and purposes, a nil slice and an empty slice behave the same when using them.</p>\n\n<p>It seems as though if Go developers just had one case, for example only allowed empty slices, it would have simplified the mental model and eliminated sources of subtle bugs.</p>\n\n<p>Is there a reason why those two use cases were created?</p>\n"}, {"tags": ["javascript", "ajax", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1520227968, "post_id": 49104009, "comment_id": 85213140, "body": "Show the JSON text. The error message is telling you that a JSON string cannot be decoded to a NewRule."}, {"owner": {"reputation": 21605, "user_id": 1142167, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/f9MAS.jpg?s=128&g=1", "display_name": "Joel Cornett", "link": "https://stackoverflow.com/users/1142167/joel-cornett"}, "edited": false, "score": 0, "creation_date": 1520228071, "post_id": 49104009, "comment_id": 85213171, "body": "I think you should post the JSON that is causing the error, but it seems to me that the error message states exactly what the problem is, you have a JSON string, and you need a JSON object (with keys and values) in order to decode into a struct."}, {"owner": {"reputation": 3194, "user_id": 4991677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7dabe78477c4b3697c3284fb556b1eca?s=128&d=identicon&r=PG&f=1", "display_name": "FDavidov", "link": "https://stackoverflow.com/users/4991677/fdavidov"}, "edited": false, "score": 0, "creation_date": 1520229625, "post_id": 49104009, "comment_id": 85213675, "body": "Add to your script <code>console.log(r.Body)</code> and <code>console.log(JSON.stringify(r.Body))</code> and post the result of the logging to console."}], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 2, "last_activity_date": 1520231578, "creation_date": 1520231578, "answer_id": 49104683, "question_id": 49104009, "link": "https://stackoverflow.com/questions/49104009/cant-unmarshal-string-into-go-value-of-type-struct/49104683#49104683", "title": "can&#39;t unmarshal string into Go value of type struct", "body": "<p>I think you're misunderstanding how <code>serializeObject</code> works in JavaScript. From the <a href=\"https://github.com/macek/jquery-serialize-object#api\" rel=\"nofollow noreferrer\">fine manual</a>:</p>\n\n<blockquote>\n  <p><strong>.serializeObject</strong> \u2014 serializes the selected form into a JavaScript object</p>\n\n<pre><code>$('form#contact').serializeObject();\n//=&gt; {user: {email: \"jsmith@example.com\", pets: [\"cat\", \"dog\"]}}\n</code></pre>\n  \n  <p><strong>.serializeJSON</strong> \u2014 serializes the selected form into JSON</p>\n\n<pre><code>$('form#contact').serializeJSON();\n//=&gt; '{\"user\":{\"email\":\"jsmith@example.com\",\"pets\":[\"cat\",\"dog\"]}}'\n</code></pre>\n</blockquote>\n\n<p><code>serializeObject</code> gives you an <em>object</em> so this:</p>\n\n<pre><code>{'rule': $('form').serializeObject(), 'ruleId': ruleID(), 'programId': parseInt(proID)}\n</code></pre>\n\n<p>will give you something like this JavaScript:</p>\n\n<pre><code>{\n    rule: { /* some JavaScript object goes here */ },\n    ruleId: 6,\n    programId: 11\n}\n</code></pre>\n\n<p>So the <code>\"rule\"</code> key in the JSON will have a whole object (not a string) as its value and <code>decoder.Decode</code> correctly refuses to unpack an object into a string.</p>\n\n<p>If you want the <code>rule</code> to be a string of JSON encoded data when you unpack it then you want JSON inside your JSON:</p>\n\n<pre><code>data: JSON.stringify({\n    'rule': $('form').serializeJSON(), // &lt;---- serialize the form to JSON, not an object\n    'ruleId': ruleID(),\n    'programId': parseInt(proID)\n})\n</code></pre>\n\n<p>Then what you're doing should work and you'll end up with JSON encoded data in <code>rules.Rule</code> in Go.</p>\n"}], "owner": {"reputation": 47, "user_id": 3724497, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/K4NBO.jpg?s=128&g=1", "display_name": "SashaAlex", "link": "https://stackoverflow.com/users/3724497/sashaalex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1605, "favorite_count": 0, "accepted_answer_id": 49104683, "answer_count": 1, "score": 0, "last_activity_date": 1520231578, "creation_date": 1520227864, "question_id": 49104009, "link": "https://stackoverflow.com/questions/49104009/cant-unmarshal-string-into-go-value-of-type-struct", "title": "can&#39;t unmarshal string into Go value of type struct", "body": "<p>I run below javascript code.</p>\n\n<pre><code>return $.ajax({\n                    url: \"/loyalty/api/rule/new\",\n                    type: \"POST\",\n                    contentType: \"application/json\",\n                    data: JSON.stringify({'rule':$('form').serializeObject(),'ruleId':ruleID(),'programId':parseInt(proID)})\n });\n</code></pre>\n\n<p>and I use below code to decode it.</p>\n\n<pre><code>decoder := json.NewDecoder(r.Body)\n    var rules models.NewRule\n    err := decoder.Decode(&amp;rules)\n</code></pre>\n\n<p>but then it gives below error message.</p>\n\n<pre><code>level=error msg=\"json: cannot unmarshal string into Go value of type models.NewRule\" api=\"/rule/new\" code=400 tenantid=7 username=admin \n</code></pre>\n\n<p>can you help me to fix this?</p>\n\n<p>my NewRule struct</p>\n\n<pre><code>type NewRule struct {\n    TenantID  int                `db:\"tenantId\"json:\"tenantId\"`\n    ProgramID commons.NullInt64  `db:\"programId\"json:\"programId\"`\n    RuleID    commons.NullInt64  `db:\"ruleId\"json:\"ruleId\"`\n    Rule      commons.NullString `db:\"rule\"json:\"rule\"`\n}\n\nfunc (p NewRule) String() string {\n    b, _ := json.Marshal(p)\n    return string(b)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1520237748, "post_id": 49103731, "comment_id": 85216897, "body": "You can embed HTML template simply like <code>const mytmeplate = `&lt;html&gt;...&lt;&#47;html&gt;`</code>. For more options, see <a href=\"https://stackoverflow.com/questions/13904441/whats-the-best-way-to-bundle-static-resources-in-a-go-program/28071360#28071360\">What&#39;s the best way to bundle static resources in a Go program?</a> Also don&#39;t parse templates inside handlers, for details see <a href=\"https://stackoverflow.com/a/28453523/1705598\">It takes too much time when using \u201ctemplate\u201d package to generate a dynamic web page to client in golang</a>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520237842, "post_id": 49103731, "comment_id": 85216934, "body": "Also if you parse the templates outside of handlers, it does not matter if the templates are bundled into the executable or available as separate files, they will only be read and parsed once (e.g. on app startup), so it does not matter."}], "answers": [{"tags": [], "owner": {"reputation": 8235, "user_id": 1284760, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/2f0d151197270b75a2c5e5bf6a2a6583?s=128&d=identicon&r=PG", "display_name": "see sharper", "link": "https://stackoverflow.com/users/1284760/see-sharper"}, "is_accepted": true, "score": 1, "last_activity_date": 1520228210, "creation_date": 1520228210, "answer_id": 49104065, "question_id": 49103731, "link": "https://stackoverflow.com/questions/49103731/how-organize-golang-webapp-with-templates/49104065#49104065", "title": "How organize Golang WebApp with templates?", "body": "<p>If I understand you correctly, I don't think there's any big problem doing it that way. You could, however, parse the templates into variables outside of the actual handlers then just call <code>tmp.Execute</code> in the handler function itself. That way you save the need to parse the files each time. You don't need to (and can't?) load the html into the binary.</p>\n"}], "owner": {"reputation": 177, "user_id": 5395433, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-6-U7i6GI7U8/AAAAAAAAAAI/AAAAAAAAACk/V2Rf_c3c-H0/photo.jpg?sz=128", "display_name": "Valentin Ouvrard", "link": "https://stackoverflow.com/users/5395433/valentin-ouvrard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "closed_date": 1520237523, "accepted_answer_id": 49104065, "answer_count": 1, "score": 0, "last_activity_date": 1520228210, "creation_date": 1520226026, "last_edit_date": 1520227700, "question_id": 49103731, "link": "https://stackoverflow.com/questions/49103731/how-organize-golang-webapp-with-templates", "closed_reason": "Duplicate", "title": "How organize Golang WebApp with templates?", "body": "<p>Small question about writing a WebApp in Go,</p>\n\n<p>Actually I have a working webApp that talks to an API and generates an HTML template to visualize my results,</p>\n\n<p>I use <code>gorilla/mux</code> and serve my templates like this :</p>\n\n<p><code>router.Handle(\"/\", http.HandlerFunc(handlers.GetHome)).Methods(\"GET\")</code></p>\n\n<p><code>tmpl := template.ParseFiles(\"templates/_head.html.tmpl\", \"templates/home.html.tmpl\")</code></p>\n\n<p><code>tmpl.Execute(w, ClusterDatas)</code></p>\n\n<p>So my html files are read by GO at each request.\nIs this a good way to do it? \nIs it possible (and better) to Get the HTML included in the Golang binary?</p>\n\n<p>Thanks a lot for any answers on that.</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1520225470, "last_edit_date": 1520225470, "creation_date": 1520224608, "answer_id": 49103558, "question_id": 49103221, "link": "https://stackoverflow.com/questions/49103221/goroutine-execution-order/49103558#49103558", "title": "Goroutine execution order", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Channel_types\" rel=\"nofollow noreferrer\">Channel types</a></p>\n  \n  <p>The capacity, in number of elements, sets the size of the buffer in\n  the channel. If the capacity is zero or absent, the channel is\n  unbuffered and communication succeeds only when both a sender and\n  receiver are ready.</p>\n</blockquote>\n\n<hr>\n\n<p>You have an unbuffered channel: <code>make(chan string)</code>.</p>\n\n<p><code>msg := &lt;- c</code> (ready to receive) and  <code>c &lt;- \"ping\"</code> (ready to send): send and receive <code>\"ping\"</code>. </p>\n\n<p><code>msg := &lt;- c</code> (ready to receive) and  <code>c &lt;- \"pong\"</code> (ready to send): send and receive <code>\"pong\"</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": false, "score": 1, "last_activity_date": 1520226625, "last_edit_date": 1520226625, "creation_date": 1520226209, "answer_id": 49103761, "question_id": 49103221, "link": "https://stackoverflow.com/questions/49103221/goroutine-execution-order/49103761#49103761", "title": "Goroutine execution order", "body": "<p>To better understand consider the following statement and demo program:</p>\n\n<ol>\n<li>Sends on a blocked channel will be serviced in order of attempted send.  I wasn't 100% sure about this but the demo program shows this behavior and this [ticket][1] mentions implementing this behavior over 2 years ago.</li>\n</ol>\n\n<p>To really see this you should run this on your machine:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    count := 10\n    c := make(chan int)\n    for i := 0; i &lt; count; i++ {\n        go func(i int) {\n            c &lt;- i + 1\n        }(i)\n    }\n    for i := 0; i &lt; count; i++ {\n        fmt.Println(\"c\", &lt;-c)\n    }\n\n    fmt.Println()\n\n    d := make(chan int)\n    for i := 0; i &lt; count; i++ {\n        go func(i int) {\n            d &lt;- i + 1\n        }(i)\n        time.Sleep(time.Millisecond * 5)\n    }\n    for i := 0; i &lt; count; i++ {\n        fmt.Println(\"d\", &lt;-d)\n    }\n\n    var input string\n    fmt.Scanln(&amp;input)\n}\n</code></pre>\n\n<p>Here is a playground, though it won't be as obvious what is happening because the first group (<code>c</code>) will always appear in a consistent (though non-sorted) order.  The second group (<code>d</code>) will always appear in order on the playground or locally.</p>\n\n<p><a href=\"https://play.golang.org/p/JCVyVlFPRXS\" rel=\"nofollow noreferrer\">https://play.golang.org/p/JCVyVlFPRXS</a></p>\n\n<p>These are the outputs from 3 runs locally</p>\n\n<pre><code> 1     2     3\n----------------\nc 2   c 10  c 10\nc 1   c 4   c 2\nc 6   c 1   c 1\nc 3   c 2   c 4\nc 4   c 3   c 3\nc 5   c 7   c 5\nc 8   c 5   c 8\nc 7   c 6   c 7\nc 9   c 8   c 9\nc 10  c 9   c 6\n\nd 1   d 1   d 1\nd 2   d 2   d 2\nd 3   d 3   d 3\nd 4   d 4   d 4\nd 5   d 5   d 5\nd 6   d 6   d 6\nd 7   d 7   d 7\nd 8   d 8   d 8\nd 9   d 9   d 9\nd 10  d 10  d 10\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 8156481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/826f2929069c5c856196c6bdea91e3fd?s=128&d=identicon&r=PG&f=1", "display_name": "Elega", "link": "https://stackoverflow.com/users/8156481/elega"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 778, "favorite_count": 2, "answer_count": 2, "score": 3, "last_activity_date": 1520226625, "creation_date": 1520221742, "question_id": 49103221, "link": "https://stackoverflow.com/questions/49103221/goroutine-execution-order", "title": "Goroutine execution order", "body": "<p>I'm a beginner of golang and I'm learning the goroutine and channel. Intuitively, I consider a gorountine in golang is essentially a thread running independently. Therefore, if there are more than one goroutine, the execution order won't be guaranteed. Hence, the following code should output \"ping\" and \"pong\" in a random order. However, what I observed is that the program yields \"ping\" and \"pong\" in turn. Can anyone explain the reason for me? Any reply would be helpful. Thanks!</p>\n\n<p>Another intriguing observation I found is that if I don't call sleep function inside the printer function, the program will output in a random order. </p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"time\"\n)\n\nfunc pinger(c chan string) {\n  for i := 0; ; i++ {\n    c &lt;- \"ping\"\n  }\n}\n\nfunc printer(c chan string) {\n  for {\n    msg := &lt;- c\n    fmt.Println(msg)\n    time.Sleep(time.Second * 1)\n  }\n}\n\nfunc ponger(c chan string) {\n  for i := 0; ; i++ {\n    c &lt;- \"pong\"\n  }\n}\n\nfunc main() {\n  var c chan string = make(chan string)\n\n  go pinger(c)\n  go ponger(c)\n  go printer(c)\n\n  var input string\n  fmt.Scanln(&amp;input)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1520223561, "last_edit_date": 1520223561, "creation_date": 1520222565, "answer_id": 49103312, "question_id": 49103204, "link": "https://stackoverflow.com/questions/49103204/jmp-instraction-in-golangs-assembly/49103312#49103312", "title": "JMP instraction in golang&#39;s assembly", "body": "<p><code>JMP 23</code> to line <code>0x0017 00023</code> for <code>i &lt; b</code>, <code>CMPQ DX, CX</code>. <code>JLT 17</code> to line <code>0x0011 00017</code> for <code>i++</code>, <code>INCQ DX</code>. For example,</p>\n\n<pre><code>package multiply\n\nfunc multiplyLoop(a, b int) int {\n    var res int\n    for i := 0; i &lt; b; i++ {\n        res += a\n    }\n    return res\n}\n</code></pre>\n\n<hr>\n\n<pre><code>$ go tool compile -S multiply.go\n\"\".multiplyLoop STEXT nosplit size=34 args=0x18 locals=0x0\n    0x0000 00000 (multiply.go:3)    TEXT    \"\".multiplyLoop(SB), NOSPLIT, $0-24\n    0x0000 00000 (multiply.go:3)    FUNCDATA    $0, gclocals\u00b754241e171da8af6ae173d69da0236748(SB)\n    0x0000 00000 (multiply.go:3)    FUNCDATA    $1, gclocals\u00b733cdeccccebe80329f1fdbee7f5874cb(SB)\n    0x0000 00000 (multiply.go:3)    MOVQ    \"\".a+8(SP), AX\n    0x0005 00005 (multiply.go:3)    MOVQ    \"\".b+16(SP), CX\n    0x000a 00010 (multiply.go:3)    XORL    DX, DX\n    0x000c 00012 (multiply.go:3)    MOVQ    DX, BX\n    0x000f 00015 (multiply.go:5)    JMP 23\n    0x0011 00017 (multiply.go:5)    INCQ    DX\n    0x0014 00020 (multiply.go:6)    ADDQ    AX, BX\n    0x0017 00023 (multiply.go:5)    CMPQ    DX, CX\n    0x001a 00026 (multiply.go:5)    JLT 17\n    0x001c 00028 (multiply.go:8)    MOVQ    BX, \"\".~r2+24(SP)\n    0x0021 00033 (multiply.go:8)    RET\n    0x0000 48 8b 44 24 08 48 8b 4c 24 10 31 d2 48 89 d3 eb  H.D$.H.L$.1.H...\n    0x0010 06 48 ff c2 48 01 c3 48 39 ca 7c f5 48 89 5c 24  .H..H..H9.|.H.\\$\n    0x0020 18 c3                                            ..\ngo.info.\"\".multiplyLoop SDWARFINFO size=78\n    0x0000 02 22 22 2e 6d 75 6c 74 69 70 6c 79 4c 6f 6f 70  .\"\".multiplyLoop\n    0x0010 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n    0x0020 00 01 9c 00 00 00 00 01 0e 61 00 00 03 00 00 00  .........a......\n    0x0030 00 01 9c 0e 62 00 00 03 00 00 00 00 02 91 08 0e  ....b...........\n    0x0040 7e 72 32 00 01 03 00 00 00 00 02 91 10 00        ~r2...........\n    rel 17+8 t=1 \"\".multiplyLoop+0\n    rel 25+8 t=1 \"\".multiplyLoop+34\n    rel 35+4 t=29 gofile../home/peter/Dropbox/gopath/src/so/multiply.go+0\n    rel 45+4 t=28 go.info.int+0\n    rel 56+4 t=28 go.info.int+0\n    rel 70+4 t=28 go.info.int+0\ngo.range.\"\".multiplyLoop SDWARFRANGE size=0\ngclocals\u00b754241e171da8af6ae173d69da0236748 SRODATA dupok size=9\n    0x0000 01 00 00 00 03 00 00 00 00                       .........\ngclocals\u00b733cdeccccebe80329f1fdbee7f5874cb SRODATA dupok size=8\n    0x0000 01 00 00 00 00 00 00 00     \n$ \n</code></pre>\n"}], "owner": {"reputation": 1623, "user_id": 3029603, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/824d95fefb6c433501601bf84bcf365a?s=128&d=identicon&r=PG&f=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/3029603/victor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 1, "accepted_answer_id": 49103312, "answer_count": 1, "score": 1, "last_activity_date": 1520223561, "creation_date": 1520221546, "question_id": 49103204, "link": "https://stackoverflow.com/questions/49103204/jmp-instraction-in-golangs-assembly", "title": "JMP instraction in golang&#39;s assembly", "body": "<p>I built golang code and output assembly code. Code and output are above.\nAm I correct, that <strong>JMP</strong> instruction in:\n<code>0x000f 00015 (math.go:17)   JMP 23</code> \nis pointing to <strong>0x0017</strong> (decimal 23)? I am a bit confused to see a decimal value after <strong>JMP</strong> instruction.</p>\n\n<p>Code:</p>\n\n<pre><code>(math.go:15)    func multiplyLoop(a, b int) int {\n(math.go:16)        var res int\n(math.go:17)        for i := 0; i &lt; b; i++ {\n(math.go:18)            res += a\n(math.go:19)        }\n(math.go:20)        return res \n(math.go:21)   }\n</code></pre>\n\n<p>Build:</p>\n\n<pre><code>go tool compile -S -m math.go\n</code></pre>\n\n<p>Assembly: </p>\n\n<pre><code>\"\".multiplyLoop STEXT nosplit size=34 args=0x18 locals=0x0\n    0x0000 00000 (math.go:15)   TEXT    \"\".multiplyLoop(SB), NOSPLIT, $0-24\n    0x0000 00000 (math.go:15)   FUNCDATA    $0, gclocals\u00b754241e171da8af6ae173d69da0236748(SB)\n    0x0000 00000 (math.go:15)   FUNCDATA    $1, gclocals\u00b733cdeccccebe80329f1fdbee7f5874cb(SB)\n    0x0000 00000 (math.go:15)   MOVQ    \"\".a+8(SP), AX\n    0x0005 00005 (math.go:15)   MOVQ    \"\".b+16(SP), CX\n    0x000a 00010 (math.go:15)   MOVL    $0, DX\n    0x000c 00012 (math.go:15)   MOVQ    DX, BX\n    0x000f 00015 (math.go:17)   JMP 23\n    0x0011 00017 (math.go:17)   INCQ    DX\n    0x0014 00020 (math.go:18)   ADDQ    AX, BX\n    0x0017 00023 (math.go:17)   CMPQ    DX, CX\n    0x001a 00026 (math.go:17)   JLT 17\n    0x001c 00028 (math.go:20)   MOVQ    BX, \"\".~r2+24(SP)\n    0x0021 00033 (math.go:20)   RET\n</code></pre>\n"}, {"tags": ["go", "ethereum", "go-ethereum", "geth"], "comments": [{"owner": {"reputation": 7307, "user_id": 8474917, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KOXGe.jpg?s=128&g=1", "display_name": "Adam Kipnis", "link": "https://stackoverflow.com/users/8474917/adam-kipnis"}, "edited": false, "score": 0, "creation_date": 1520277038, "post_id": 49102885, "comment_id": 85240827, "body": "The <code>networkid</code> should match the <code>chainid</code> in your genesis.json (output shows your node is connecting to Mainnet (network=1)). Make sure you\u2019re only running <code>init</code> once. And, why is your <code>datadir</code> in quotes? Output shows your saving to the default directory (database=/home/hansoli/.ethereum/geth/chaindata). There\u2019s nothing technically wrong with using the default directory, but you\u2019ll want to change so you can run different networks without stepping over each other."}, {"owner": {"reputation": 7307, "user_id": 8474917, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KOXGe.jpg?s=128&g=1", "display_name": "Adam Kipnis", "link": "https://stackoverflow.com/users/8474917/adam-kipnis"}, "edited": false, "score": 0, "creation_date": 1520277101, "post_id": 49102885, "comment_id": 85240860, "body": "And <code>console</code> should come at the end of your <code>geth</code> command."}, {"owner": {"reputation": 115, "user_id": 5102533, "user_type": "registered", "profile_image": "https://graph.facebook.com/854592894634687/picture?type=large", "display_name": "Jeong Hansol", "link": "https://stackoverflow.com/users/5102533/jeong-hansol"}, "reply_to_user": {"reputation": 7307, "user_id": 8474917, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KOXGe.jpg?s=128&g=1", "display_name": "Adam Kipnis", "link": "https://stackoverflow.com/users/8474917/adam-kipnis"}, "edited": false, "score": 0, "creation_date": 1520301789, "post_id": 49102885, "comment_id": 85250134, "body": "@AdamKipnis Thanks for answer! I trying this command:  <code>geth --rpc --rpcport 8080 --rpccorsdomain &quot;*&quot; --datadir datadir --port 30303 --nodiscover --rpcapi db,eth,net,web3 --networkid 42 console</code> and I could confirm network number is 42 and datadir is my datadir directory in console. But it still doesn&#39;t work."}, {"owner": {"reputation": 7307, "user_id": 8474917, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KOXGe.jpg?s=128&g=1", "display_name": "Adam Kipnis", "link": "https://stackoverflow.com/users/8474917/adam-kipnis"}, "edited": false, "score": 0, "creation_date": 1520352650, "post_id": 49102885, "comment_id": 85275238, "body": "Did you rerun your mining as well? Your output shows the mining went to the wrong datadir directory as well. I recommend starting over from the beginning. Wipe out the data directory, re-initialize your blockchain, mine some transactions, then restart your console. Double check the output after every command to make sure the correct data directory, keystore directory, and network id are being used. I&#39;ve just repeated the steps and everything was working fine."}, {"owner": {"reputation": 115, "user_id": 5102533, "user_type": "registered", "profile_image": "https://graph.facebook.com/854592894634687/picture?type=large", "display_name": "Jeong Hansol", "link": "https://stackoverflow.com/users/5102533/jeong-hansol"}, "reply_to_user": {"reputation": 7307, "user_id": 8474917, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KOXGe.jpg?s=128&g=1", "display_name": "Adam Kipnis", "link": "https://stackoverflow.com/users/8474917/adam-kipnis"}, "edited": false, "score": 0, "creation_date": 1520477430, "post_id": 49102885, "comment_id": 85334667, "body": "@AdamKipnis It seems a bug in geth. It works perfectly in geth 1.8.2 (released few days ago)"}], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 9445794, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/1d7c5d7bb610de33122dcb4997c35ea5?s=128&d=identicon&r=PG", "display_name": "rob", "link": "https://stackoverflow.com/users/9445794/rob"}, "is_accepted": true, "score": 0, "last_activity_date": 1520254028, "creation_date": 1520254028, "answer_id": 49110851, "question_id": 49102885, "link": "https://stackoverflow.com/questions/49102885/geth-how-to-keep-block-chain-status/49110851#49110851", "title": "Geth how to keep block chain status?", "body": "<p>maybe a bug in the current version...\nstart geth with option --gcmode \"archive\"</p>\n"}], "owner": {"reputation": 115, "user_id": 5102533, "user_type": "registered", "profile_image": "https://graph.facebook.com/854592894634687/picture?type=large", "display_name": "Jeong Hansol", "link": "https://stackoverflow.com/users/5102533/jeong-hansol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1362, "favorite_count": 1, "accepted_answer_id": 49110851, "answer_count": 1, "score": 0, "last_activity_date": 1520254028, "creation_date": 1520218829, "last_edit_date": 1520218895, "question_id": 49102885, "link": "https://stackoverflow.com/questions/49102885/geth-how-to-keep-block-chain-status", "title": "Geth how to keep block chain status?", "body": "<p>Fedora 27, CentOS 1708, Go-ethereum 1.8.1</p>\n\n<p>I am trying to make private block chain and coin using that for study.</p>\n\n<p>Genesis.json:</p>\n\n<pre><code>{\n  \"config\": {\n        \"chainId\": 42,\n        \"homesteadBlock\": 0,\n        \"eip155Block\": 0,\n        \"eip158Block\": 0\n    },\n  \"alloc\": {},\n  \"coinbase\"   : \"0x0000000000000000000000000000000000000000\",\n  \"difficulty\" : \"0x1000000\",\n  \"extraData\"  : \"\",\n  \"gasLimit\"   : \"0x2fefd8\",\n  \"nonce\"      : \"0x0000000012345678\",\n  \"mixhash\"    : \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n  \"parentHash\" : \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n  \"timestamp\"  : \"0x00\"\n}\n</code></pre>\n\n<p>And I run geth in console with:</p>\n\n<pre><code>geth init genesis.json --datadir datadir\ngeth console --rpc --rpcport \"8080\" --rpccorsdomain \"*\" --datadir \"datadir\" --port \"30303\" --nodiscover --rpcapi \"db,eth,net,web3\" --networkid 7296\n</code></pre>\n\n<p>Then I made new account and started mining. It works. But when I restart geth, block chain state seems not saved.</p>\n\n<pre><code>INFO [03-05|11:39:03] Successfully sealed new block            number=21 hash=ef088f\u20268b62cb\nINFO [03-05|11:39:03] \ud83d\udd17 block reached canonical chain          number=16 hash=4dea2d\u2026c41401\nINFO [03-05|11:39:03] \ud83d\udd28 mined potential block                  number=21 hash=ef088f\u20268b62cb\nINFO [03-05|11:39:03] Commit new mining work                   number=22 txs=0 uncles=0 elapsed=101.305\u00b5s\n&gt; miner.stop()\ntrue\n&gt; exit\nINFO [03-05|11:39:28] IPC endpoint closed                      endpoint=/home/hansoli/.ethereum/geth.ipc\nERROR[03-05|11:39:28] Dangling trie nodes after full cleanup \nINFO [03-05|11:39:28] Blockchain manager stopped \nINFO [03-05|11:39:28] Stopping Ethereum protocol \nINFO [03-05|11:39:28] Ethereum protocol stopped \nINFO [03-05|11:39:28] Transaction pool stopped \nINFO [03-05|11:39:28] Database closed                          database=/home/hansoli/.ethereum/geth/chaindata\n[hansoli@localhost ethereum]$ geth console --rpc --rpcport \"8080\" --rpccorsdomain \"*\" --datadir \"datadir\" --port \"30303\" --nodiscover --rpcapi \"db,eth,net,web3\" --networkid 7296\nINFO [03-05|11:39:59] Maximum peer count                       ETH=25 LES=0 total=25\nINFO [03-05|11:39:59] Starting peer-to-peer node               instance=Geth/v1.8.1-stable-1e67410e/linux-amd64/go1.9.4\nINFO [03-05|11:39:59] Allocated cache and file handles         database=/home/hansoli/.ethereum/geth/chaindata cache=768 handles=512\nINFO [03-05|11:39:59] Initialised chain configuration          config=\"{ChainID: 42 Homestead: 0 DAO: &lt;nil&gt; DAOSupport: false EIP150: &lt;nil&gt; EIP155: 0 EIP158: 0 Byzantium: &lt;nil&gt; Engine: unknown}\"\nINFO [03-05|11:39:59] Disk storage enabled for ethash caches   dir=/home/hansoli/.ethereum/geth/ethash count=3\nINFO [03-05|11:39:59] Disk storage enabled for ethash DAGs     dir=/home/hansoli/.ethash               count=2\nINFO [03-05|11:39:59] Initialising Ethereum protocol           versions=\"[63 62]\" network=1\nWARN [03-05|11:39:59] Head state missing, repairing chain      number=21 hash=ef088f\u20268b62cb\nINFO [03-05|11:39:59] Rewound blockchain to past state         number=0  hash=7016ba\u2026d4738f\nINFO [03-05|11:39:59] Loaded most recent local header          number=21 hash=ef088f\u20268b62cb td=351436106\nINFO [03-05|11:39:59] Loaded most recent local full block      number=0  hash=7016ba\u2026d4738f td=16777216\nINFO [03-05|11:39:59] Loaded most recent local fast block      number=21 hash=ef088f\u20268b62cb td=351436106\nINFO [03-05|11:39:59] Loaded local transaction journal         transactions=0 dropped=0\nINFO [03-05|11:39:59] Regenerated local transaction journal    transactions=0 accounts=0\nINFO [03-05|11:39:59] Starting P2P networking \nINFO [03-05|11:39:59] RLPx listener up                         self=\"enode://0482a34d9871d20c8beee1b227d7bd0b8e54a5c084d4f55afc86fac65e8d92c4ab51f669aee196c112a4ca6e6461e069ee111a82208f1fcaaff138c3d1a6254b@[::]:30303?discport=0\"\nINFO [03-05|11:39:59] IPC endpoint opened                      url=/home/hansoli/.ethereum/geth.ipc\nWelcome to the Geth JavaScript console!\n\ninstance: Geth/v1.8.1-stable-1e67410e/linux-amd64/go1.9.4\nINFO [03-05|11:39:59] Etherbase automatically configured       address=0x8eDE74913b1BbFA2be354B3B1E70635E96B6b158\ncoinbase: 0x8ede74913b1bbfa2be354b3b1e70635e96b6b158\nat block: 0 (Thu, 01 Jan 1970 09:00:00 KST)\n datadir: /home/hansoli/.ethereum\n modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0\n\n&gt; eth.blockNumber\n0\n&gt; \n</code></pre>\n\n<p>How to solve it? Can I keep block chain status after exit geth?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1520218648, "post_id": 49102752, "comment_id": 85210845, "body": "You get a panic because you&#39;re calling it in the last line of the <code>twoSum</code> function definition."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1520239121, "post_id": 49102752, "comment_id": 85217568, "body": "What panic? A complete question will include all relevant error messages."}], "answers": [{"comments": [{"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 1, "creation_date": 1520219082, "post_id": 49102886, "comment_id": 85210949, "body": "Or use <code>for i, ni := range ...</code> and <code>for _, nj := range ...</code> and skip most of the indexing altogether."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 1, "creation_date": 1520219219, "post_id": 49102886, "comment_id": 85210969, "body": "@muistooshort my first thought as well, but they need to return indexes of the found items."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1520221349, "post_id": 49102886, "comment_id": 85211431, "body": "Yeah, I guess that&#39;s sort of important :)"}, {"owner": {"reputation": 3, "user_id": 9204761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u5WWS.jpg?s=128&g=1", "display_name": "Cal Mitchell", "link": "https://stackoverflow.com/users/9204761/cal-mitchell"}, "edited": false, "score": 0, "creation_date": 1520309101, "post_id": 49102886, "comment_id": 85251690, "body": "Zerkms, thank you for the explanation regarding j being a 0-based index of a new slice. I am used to Python. There is definitely value in using an indexed for loop, it seems more clear what you are trying to do"}], "tags": [], "owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "is_accepted": true, "score": 1, "last_activity_date": 1520218834, "creation_date": 1520218834, "answer_id": 49102886, "question_id": 49102752, "link": "https://stackoverflow.com/questions/49102752/twosum-function-behaves-differently-with-different-array-inputs/49102886#49102886", "title": "twoSum function behaves differently with different array inputs", "body": "<p><code>for j := range nums[i + 1:] {</code></p>\n\n<p>This does not work like you expect: <code>j</code> here is a 0-based index of a new slice, that you obtained after you resliced the <code>nums</code> with <code>nums[i+1:]</code>.</p>\n\n<p>If you still want to have the absolute index in the <code>nums</code> slice you need to offset it manually, eg:</p>\n\n<pre><code>jx := j + i + 1\n</code></pre>\n\n<p>and then use <code>jx</code> instead of <code>j</code></p>\n\n<p>Demo: <a href=\"https://play.golang.org/p/s7_tcHvu6fB\" rel=\"nofollow noreferrer\">https://play.golang.org/p/s7_tcHvu6fB</a></p>\n\n<p>Alternatively you may have used a good old indexed <code>for</code> instead of <code>for-range</code> as a nested loop:</p>\n\n<pre><code>for j := i + 1; j &lt; length; j++ {\n</code></pre>\n\n<p>Demo: <a href=\"https://play.golang.org/p/-yF7cWYgYri\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-yF7cWYgYri</a></p>\n"}, {"tags": [], "owner": {"reputation": 59, "user_id": 5429860, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uJgVQdMge1s/AAAAAAAAAAI/AAAAAAAAABI/7KMbbfYvUrQ/photo.jpg?sz=128", "display_name": "\u591c\u9611\u542c\u98ce", "link": "https://stackoverflow.com/users/5429860/%e5%a4%9c%e9%98%91%e5%90%ac%e9%a3%8e"}, "is_accepted": false, "score": 0, "last_activity_date": 1520222112, "creation_date": 1520222112, "answer_id": 49103264, "question_id": 49102752, "link": "https://stackoverflow.com/questions/49102752/twosum-function-behaves-differently-with-different-array-inputs/49103264#49103264", "title": "twoSum function behaves differently with different array inputs", "body": "<p><code>for i := range nums[:length]</code>, you will get i's values as <code>0,1,2,3...</code></p>\n\n<p><code>for j := range nums[i+1:]</code>, you will get j's values as <code>0,1,2,3...</code></p>\n\n<p>Then, when you calculate the sum of <code>nums[i]+nums[j]</code>, you actually calculate <code>nums[0]+nums[0]</code>, which is <code>1+1=2</code> instead of <code>1+2=3</code>.</p>\n"}], "owner": {"reputation": 3, "user_id": 9204761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u5WWS.jpg?s=128&g=1", "display_name": "Cal Mitchell", "link": "https://stackoverflow.com/users/9204761/cal-mitchell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29, "favorite_count": 0, "accepted_answer_id": 49102886, "answer_count": 2, "score": 0, "last_activity_date": 1520239068, "creation_date": 1520217925, "last_edit_date": 1520239068, "question_id": 49102752, "link": "https://stackoverflow.com/questions/49102752/twosum-function-behaves-differently-with-different-array-inputs", "title": "twoSum function behaves differently with different array inputs", "body": "<p>When I run the following code, I get the expected answer <code>[3, 4]</code>, which is the index of the 2 numbers that add up to my target variable. However, when I change the myArray input to <code>[]int{1,2,3,4,6,11,4,12}</code> (I deleted the last 6), I get a panic. Please help me understand why this is happening. </p>\n\n<pre><code>func twoSum (nums []int, target int) []int {\n    length := len(nums) - 1\n    for i := range nums[:length] {\n        for j := range nums[i + 1:] {\n            if nums[i] + nums[j] == target {\n                return []int{i, j}\n                break\n            }\n        }\n    }\n    panic(\"should never happen\")\n}\n\nfunc main() {\n    myArray := []int{1,2,3,4,6,11,4,12}\n    myTarget := 10\n    fmt.Println(twoSum(myArray, myTarget))\n}\n</code></pre>\n"}, {"tags": ["function", "go", "concurrency", "duration", "channels"], "comments": [{"owner": {"reputation": 145, "user_id": 8980763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a283b39e20315447aa452b298277103e?s=128&d=identicon&r=PG&f=1", "display_name": "teolandon", "link": "https://stackoverflow.com/users/8980763/teolandon"}, "edited": false, "score": 1, "creation_date": 1520217099, "post_id": 49102623, "comment_id": 85210518, "body": "You&#39;re using the values from the <code>loads</code> channel as if they are integers, but they are actually of type <code>time.Duration</code>. Use the <code>Nanoseconds()</code> method to get a float64 of the duration, and then convert it to an integer.  You&#39;re also not passing enough arguments in the <code>go worker(w, jobs, results)</code> call."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 145, "user_id": 8980763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a283b39e20315447aa452b298277103e?s=128&d=identicon&r=PG&f=1", "display_name": "teolandon", "link": "https://stackoverflow.com/users/8980763/teolandon"}, "edited": false, "score": 2, "creation_date": 1520217502, "post_id": 49102623, "comment_id": 85210603, "body": "@teolandon: Type <code>time.Duration</code> is an integer: <code>type Duration int64</code>. Your comment does not make sense."}, {"owner": {"reputation": 145, "user_id": 8980763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a283b39e20315447aa452b298277103e?s=128&d=identicon&r=PG&f=1", "display_name": "teolandon", "link": "https://stackoverflow.com/users/8980763/teolandon"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1520218560, "post_id": 49102623, "comment_id": 85210826, "body": "@peterSO you&#39;re correct, and the int64 integer representation of it is just the nanosecond count, so all of what I said is redundant. The real issue in line 18 was that the channel is being used as if it was an integer."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1520217351, "creation_date": 1520217351, "answer_id": 49102697, "question_id": 49102623, "link": "https://stackoverflow.com/questions/49102623/how-to-pass-time-duration-type-to-a-go-function/49102697#49102697", "title": "How to pass time.Duration type to a go function?", "body": "<p>Even if you fix your compile errors, you still have problems.</p>\n\n<pre><code>//worker_pool improved example\n\npackage main\n\nimport \"fmt\"\nimport \"time\"\nimport \"math/rand\"\n\n// Here's the worker, of which we'll run several\n// concurrent instances. These workers will receive\n// work on the `jobs` channel and send the corresponding\n// results on `results`. We'll sleep a random number of seconds between\n// 1 and 5 to simulate an expensive task.\nfunc worker(id int, jobs &lt;-chan int, loads &lt;-chan time.Duration, results chan&lt;- int) {\n    for j := range jobs {\n        fmt.Println(\"worker\", id, \"started  job\", j, time.Now())\n        time.Sleep(&lt;-loads * time.Second)\n        fmt.Println(\"worker\", id, \"finished job\", j, time.Now())\n        results &lt;- j * 2\n    }\n}\n\nfunc main() {\n\n    // In order to use our pool of workers we need to send\n    // them work and collect their results. We make 2\n    // channels for this.\n    jobs := make(chan int)\n    loads := make(chan time.Duration)\n    results := make(chan int)\n\n    // This starts up 3 workers, initially blocked\n    // because there are no jobs yet.\n    for w := 1; w &lt;= 3; w++ {\n        go worker(w, jobs, loads, results)\n    }\n\n    // Here we send 24 `jobs` and then `close` that\n    // channel to indicate that's all the work we have.\n    for j := 1; j &lt;= 24; j++ {\n        jobs &lt;- j\n        r := rand.New(rand.NewSource(99))\n        load := time.Duration(r.Int63n(5000000))\n        loads &lt;- load\n    }\n    close(jobs)\n    close(loads)\n\n    // Finally we collect all the results of the work.\n    for a := 1; a &lt;= 24; a++ {\n        &lt;-results\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/tVdlKFHunKN\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tVdlKFHunKN</a></p>\n\n<p>Output:</p>\n\n<pre><code>worker 3 started  job 1 2009-11-10 23:00:00 +0000 UTC m=+0.000000001\nworker 1 started  job 2 2009-11-10 23:00:00 +0000 UTC m=+0.000000001\nworker 2 started  job 3 2009-11-10 23:00:00 +0000 UTC m=+0.000000001\nworker 1 finished job 2 2009-12-27 17:05:41 +0000 UTC m=+4039541.000000001\nworker 3 finished job 1 2009-12-27 17:05:41 +0000 UTC m=+4039541.000000001\nworker 2 finished job 3 2009-12-27 17:05:41 +0000 UTC m=+4039541.000000001\nfatal error: all goroutines are asleep - deadlock!\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 901, "user_id": 8414180, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/x4wrW.gif?s=128&g=1", "display_name": "data princess", "link": "https://stackoverflow.com/users/8414180/data-princess"}, "edited": false, "score": 0, "creation_date": 1573347092, "post_id": 49113667, "comment_id": 103852994, "body": "&quot;It returns the exact same numbers every time, given a certain seed, which in my mind defeats the concept of randomness.&quot; That&#39;s actually the point. It&#39;s good to be able to generate a reproducible pseudorandom sequence for testing purposes. The key is to generate the seed in an unpredictable way; using the computer&#39;s microsecond clock is a common way to do this"}], "tags": [], "owner": {"reputation": 67, "user_id": 4597319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbf9db6a0fd190044463d260b0ecfd8d?s=128&d=identicon&r=PG&f=1", "display_name": "user194145", "link": "https://stackoverflow.com/users/4597319/user194145"}, "is_accepted": false, "score": 0, "last_activity_date": 1520263116, "creation_date": 1520263116, "answer_id": 49113667, "question_id": 49102623, "link": "https://stackoverflow.com/questions/49102623/how-to-pass-time-duration-type-to-a-go-function/49113667#49113667", "title": "How to pass time.Duration type to a go function?", "body": "<p>Indeed there was a problem with the code.</p>\n\n<p>The channels I created were not buffered. I included a buffer of 100 (per original example) for the jobs and results channels, and the program worked OK.</p>\n\n<pre><code>//worker_pool improved example\n\npackage main\n\nimport \"fmt\"\nimport \"time\"\nimport \"math/rand\"\n\nfunc worker(id int, jobs &lt;-chan int, loads &lt;-chan time.Duration, results chan&lt;- int) {\n    for j := range jobs {\n        before := time.Now()\n        fmt.Println(\"worker\", id, \"started  job\", j)\n        time.Sleep(&lt;-loads)\n        after := time.Now()\n        fmt.Println(\"worker\", id, \"finished job\", j, \"in\", after.Sub(before))\n        results &lt;- j\n    }\n}\n\nfunc main() {\n\n    jobs := make(chan int, 100) // Buffered channel\n    loads := make(chan time.Duration)\n    results := make(chan int, 100) // Buffered channel\n\n    for w := 1; w &lt;= 3; w++ {\n        go worker(w, jobs, loads, results)\n    }\n\n    for j := 1; j &lt;= 24; j++ {\n        jobs &lt;- j\n        r := rand.New(rand.NewSource(int64(j*10)))\n        loads &lt;- time.Duration(r.Int63n(500000000)) // In nano seconds\n    }\n    close(jobs)\n    close(loads)\n\n    for a := 1; a &lt;= 24; a++ {\n        &lt;-results\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/bz-JIkD1OoG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bz-JIkD1OoG</a></p>\n\n<p>I am still getting used to the random generator logic. It returns the exact same numbers every time, given a certain seed, which in my mind defeats the concept of randomness. </p>\n\n<p>Partial results...</p>\n\n<pre><code>worker 3 started  job 1\nworker 1 started  job 2\nworker 2 started  job 3\nworker 1 finished job 2 in 168.00641ms\nworker 1 started  job 4\nworker 3 finished job 1 in 205.826435ms\nworker 3 started  job 5\nworker 3 finished job 5 in 160.909863ms\nworker 3 started  job 6\nworker 2 finished job 3 in 381.707665ms\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 4597319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbf9db6a0fd190044463d260b0ecfd8d?s=128&d=identicon&r=PG&f=1", "display_name": "user194145", "link": "https://stackoverflow.com/users/4597319/user194145"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1967, "favorite_count": 1, "answer_count": 2, "score": -2, "last_activity_date": 1520263116, "creation_date": 1520216744, "question_id": 49102623, "link": "https://stackoverflow.com/questions/49102623/how-to-pass-time-duration-type-to-a-go-function", "title": "How to pass time.Duration type to a go function?", "body": "<p>I am learning GOLANG, in particular for its concurrency capabilities.</p>\n\n<p>Have tried to further develop one of the worker_pool examples so that each worker receives a job id and a job load, represented in a random duration of the job.</p>\n\n<p>The duration is used by a time.sleep command to wait the alloted number of nano seconds, which are calculated randomly.</p>\n\n<p>Code looks like this...</p>\n\n<pre><code>//worker_pool improved example\n\npackage main\n\nimport \"fmt\"\nimport \"time\"\nimport \"math/rand\"\n\n// Here's the worker, of which we'll run several\n// concurrent instances. These workers will receive\n// work on the `jobs` channel and send the corresponding\n// results on `results`. We'll sleep a random number of seconds between\n// 1 and 5 to simulate an expensive task.\nfunc worker(id int, jobs &lt;-chan int, loads &lt;-chan time.Duration, results chan&lt;- int) {\n   for j := range jobs {\n        fmt.Println(\"worker\", id, \"started  job\", j, time.Now())\n        time.Sleep(loads*time.Second)  \n        fmt.Println(\"worker\", id, \"finished job\", j, time.Now())\n        results &lt;- j * 2\n    }\n}\n\nfunc main() {\n\n    // In order to use our pool of workers we need to send\n    // them work and collect their results. We make 2\n    // channels for this.\n    jobs := make(chan int)\n    loads := make(chan time.Duration)\n    results := make(chan int)\n\n    // This starts up 3 workers, initially blocked\n    // because there are no jobs yet.\n    for w := 1; w &lt;= 3; w++ {\n        go worker(w, jobs, results)\n    }\n\n    // Here we send 24 `jobs` and then `close` that\n    // channel to indicate that's all the work we have.\n    for j := 1; j &lt;= 24; j++ {\n        jobs &lt;- j\n        r := rand.New(rand.NewSource(99))\n        load := r.Int63n(5000000)\n        loads &lt;- load\n    }\n    close(jobs)\n    close(loads)\n\n\n    // Finally we collect all the results of the work.\n    for a := 1; a &lt;= 24; a++ {\n        &lt;-results\n    }\n}\n</code></pre>\n\n<p>I keep getting this error messages...</p>\n\n<p>prog.go:18:33: cannot convert loads (type &lt;-chan int) to type time.Duration</p>\n\n<p>prog.go:36:18: not enough arguments in call to worker\n    have (int, chan int, chan int)\n    want (int, &lt;-chan int, &lt;-chan int, chan&lt;- int)</p>\n\n<p>prog.go:45:15: cannot use load (type int64) as type int in send</p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["go", "concurrency", "parallel-processing"], "comments": [{"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 1, "creation_date": 1520200026, "post_id": 49100512, "comment_id": 85206881, "body": "Your test program isn&#39;t very robust. It&#39;s too short/fast, one of the go routines could finish in the blink of an eye long before the other go routine is started and gets scheduled to run. Change your loop to iterate a few tens of thousand times"}, {"owner": {"reputation": 500, "user_id": 9061909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dyipU.jpg?s=128&g=1", "display_name": "Josep", "link": "https://stackoverflow.com/users/9061909/josep"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1520200735, "post_id": 49100512, "comment_id": 85207105, "body": "You and peterSO are absolutely right. My code was too short. For the record, I got carried away by this blog: <a href=\"https://www.ardanlabs.com/blog/2014/01/concurrency-goroutines-and-gomaxprocs.html\" rel=\"nofollow noreferrer\">ardanlabs.com/blog/2014/01/&hellip;</a>  Where it clearly shows parallelism working with a small for loop that I couldn&#39;t replicate either, so I simplified the example."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1520244300, "post_id": 49100512, "comment_id": 85220398, "body": "JFTR, goroutines were parallel since day 0, just the defaults changed in 1.5. Before that, you could make your Go program see the <code>GOMAXPROCS</code> env. variable set to something greater than 1 to make it use that much OS threads to multiplex the execution of goroutines. Reading <a href=\"https://morsmachine.dk/go-scheduler\" rel=\"nofollow noreferrer\">this</a> and  <a href=\"https://rakyll.org/scheduler/\" rel=\"nofollow noreferrer\">this</a> is very much advised."}], "answers": [{"comments": [{"owner": {"reputation": 2446, "user_id": 5359531, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7636325b68a8f82a8f7b30fdfff251a?s=128&d=identicon&r=PG&f=1", "display_name": "user5359531", "link": "https://stackoverflow.com/users/5359531/user5359531"}, "edited": false, "score": 10, "creation_date": 1597243651, "post_id": 49100838, "comment_id": 112070503, "body": "can you explain how this output shows that its executing in parallel and not just concurrently on a single thread? Thanks"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1520200382, "last_edit_date": 1520200382, "creation_date": 1520200074, "answer_id": 49100838, "question_id": 49100512, "link": "https://stackoverflow.com/questions/49100512/how-to-achieve-proper-parallelism-in-golang-are-goroutines-parallel-in-versions/49100838#49100838", "title": "How to achieve proper parallelism in Golang? Are goroutines parallel in versions 1.5+?", "body": "<p>The Go Playground is a single-processor virtual machine. You are running a trivial goroutine. Toy programs run on toy machines get toy results. </p>\n\n<p>Run this on a multiple CPU machine:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"sync\"\n)\n\nvar wg sync.WaitGroup\n\nfunc count() {\n    defer wg.Done()\n    for i := 0; i &lt; 10; i++ {\n        fmt.Println(i)\n        i := 0\n        for ; i &lt; 1e6; i++ {\n        }\n        _ = i\n    }\n}\n\nfunc main() {\n    fmt.Println(\"Version\", runtime.Version())\n    fmt.Println(\"NumCPU\", runtime.NumCPU())\n    fmt.Println(\"GOMAXPROCS\", runtime.GOMAXPROCS(0))\n    wg.Add(2)\n    go count()\n    go count()\n    wg.Wait()\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Version go1.10\nNumCPU 8\nGOMAXPROCS 8\n0\n0\n1\n1\n2\n2\n3\n3\n4\n4\n5\n5\n6\n6\n7\n7\n8\n8\n9\n9\n</code></pre>\n"}], "owner": {"reputation": 500, "user_id": 9061909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dyipU.jpg?s=128&g=1", "display_name": "Josep", "link": "https://stackoverflow.com/users/9061909/josep"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4000, "favorite_count": 3, "accepted_answer_id": 49100838, "answer_count": 1, "score": 5, "last_activity_date": 1610617314, "creation_date": 1520197792, "last_edit_date": 1610617314, "question_id": 49100512, "link": "https://stackoverflow.com/questions/49100512/how-to-achieve-proper-parallelism-in-golang-are-goroutines-parallel-in-versions", "title": "How to achieve proper parallelism in Golang? Are goroutines parallel in versions 1.5+?", "body": "<p>I know the differences between parallelism and concurrency. I'm looking for how to achieve parallelism in Go. I expected goroutines to be parallel, but the documentation I found appears to say otherwise.</p>\n<p>The setting GOMAXPROCS allows us to configure the number of threads that the application can use to run in parallel. Since version 1.5, GOMAXPROCS has as value the number of cores. As far as I understand, goroutines are inherently parallel since version 1.5. Is this conclusion correct?</p>\n<p>Every question I find on sites like StackOverflow appears to be outdated and doesn't take into account this change in version 1.5. See: <a href=\"https://stackoverflow.com/questions/25106526/parallel-processing-in-golang\">Parallel processing in golang</a></p>\n<p>My confusion arises from trying to test this parallelism in practice. I have tried the following code I in Go 1.10 and it doesn't run in parallel.</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;sync&quot;\n)\n\nvar wg sync.WaitGroup\n\nfunc main() {\n\n    wg.Add(2)\n    go count()\n    go count()\n    wg.Wait()\n\n}\n\nfunc count() {\n    defer wg.Done()\n    for i := 0; i &lt; 10; i++ {\n        fmt.Println(i)\n    }\n}\n</code></pre>\n<p>Setting up GOMAXPROCS to 2 doesn't change the result. I get a concurrent program instead of a parallel one.</p>\n<p>I'm running all my tests on an 8 core system.</p>\n<p><strong>Edit</strong>: For future reference,</p>\n<p>I got carried away by this blog: <a href=\"https://www.ardanlabs.com/blog/2014/01/concurrency-goroutines-and-gomaxprocs.html\" rel=\"nofollow noreferrer\">https://www.ardanlabs.com/blog/2014/01/concurrency-goroutines-and-gomaxprocs.html</a> where parallelism is achieved without much hassle in a small for-loop. The answer by @peterSO is completely valid. For some reason, in Go 1.10 I couldn't replicate the results of the blog.</p>\n"}, {"tags": ["go", "dynamic"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520197766, "post_id": 49100447, "comment_id": 85206201, "body": "Change the argument type of <code>Get</code> to <code>interface{}</code> and make sure to pass in <code>&amp;t</code> and <code>&amp;t2</code>, and then remove the <code>&amp;</code> from inside <code>Get</code>&#39;s body. Also change the return type to <code>error</code> and return the <code>err</code> or remove the return type if you want to panic, since you&#39;re passing <code>&amp;t</code> to Get, after Get returns <code>t</code> will be what you want it to be."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520198050, "post_id": 49100447, "comment_id": 85206289, "body": "... like this: <a href=\"https://play.golang.org/p/YkTUrwMXamG\" rel=\"nofollow noreferrer\">play.golang.org/p/YkTUrwMXamG</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520198553, "post_id": 49100447, "comment_id": 85206454, "body": "... another suggestion: <a href=\"https://play.golang.org/p/FAujUKT7JHm\" rel=\"nofollow noreferrer\">play.golang.org/p/FAujUKT7JHm</a>"}, {"owner": {"reputation": 5444, "user_id": 71964, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1f00d9aa3c469deb0e21156954f2be2b?s=128&d=identicon&r=PG", "display_name": "raspi", "link": "https://stackoverflow.com/users/71964/raspi"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520202501, "post_id": 49100447, "comment_id": 85207624, "body": "@mkopriva FAujUKT7JHm is good."}], "owner": {"reputation": 5444, "user_id": 71964, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1f00d9aa3c469deb0e21156954f2be2b?s=128&d=identicon&r=PG", "display_name": "raspi", "link": "https://stackoverflow.com/users/71964/raspi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 213, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1520203056, "creation_date": 1520197359, "last_edit_date": 1520203056, "question_id": 49100447, "link": "https://stackoverflow.com/questions/49100447/return-dynamic-struct-array-in-go", "title": "Return dynamic struct array in go", "body": "<p>Is there a way to read JSON files with different structures and cast read data to correct struct in a more dynamic way? </p>\n\n<p>Structs:</p>\n\n<pre><code>type Person struct {\n    Name string `json:\"name,omitempty\"`\n    Age  int64  `json:\"age,omitempty\"`\n}\n\ntype Pet struct {\n    Name string `json:\"name,omitempty\"`\n    Age  int64  `json:\"age,omitempty\"`\n}\n</code></pre>\n\n<p>They are currently read from files with:</p>\n\n<pre><code>func ReadFileToByteArray(filepath string) ([]byte, error) {\n    var err error\n    err = os.MkdirAll(path.Dir(filepath), os.FileMode(0700))\n    if err != nil {\n        panic(err)\n    }\n\n    _, err = os.Stat(filepath)\n    if err != nil {\n        if os.IsNotExist(err) {\n            file, err := os.Create(filepath)\n            if err != nil {\n                panic(err)\n            }\n\n            defer file.Close()\n            file.Write([]byte(\"[]\"))\n        } else {\n            panic(err)\n        }\n    }\n\n    readbytes, err := ioutil.ReadFile(filepath)\n    if err != nil {\n        panic(err)\n    }\n\n    return readbytes, err\n}\n</code></pre>\n\n<p>Read as casted arrays:</p>\n\n<pre><code>func GetPersonArrayFromFile(fn string) (data []Person) {\n    readbytes, err := ReadFileToByteArray(fn)\n    if err != nil {\n        panic(err)\n    }\n\n    err = json.Unmarshal(readbytes, &amp;data)\n    if err != nil {\n        log.Fatal(fmt.Sprintf(\"Filename: %[1]s Error: %[2]s (%[2]T)\", fn, err))\n        panic(err)\n    }\n\n    return data\n}\n\nfunc GetPetArrayFromFile(fn string) (data []Pet) {\n    readbytes, err := ReadFileToByteArray(fn)\n    if err != nil {\n        panic(err)\n    }\n\n    err = json.Unmarshal(readbytes, &amp;data)\n    if err != nil {\n        log.Fatal(fmt.Sprintf(\"Filename: %[1]s Error: %[2]s (%[2]T)\", fn, err))\n        panic(err)\n    }\n\n    return data\n}\n</code></pre>\n\n<p>Current try (simplified):</p>\n\n<pre><code>func main() {\n    personsJSON := `[{\"name\": \"foo\", \"age\": 22}, {\"name\": \"bar\", \"age\": 33}]`\n    petsJSON := `[{\"name\": \"bunny bunnieface\", \"age\": 1}, {\"name\": \"you there\", \"age\": 5}]`\n\n    var t []Person\n    data := Get([]byte(personsJSON), t)\n\n    var t2 []Pet\n    data2 := Get([]byte(petsJSON), t2)\n\n    fmt.Println(\"%v\", data)\n    fmt.Println(\"%v\", data2)\n}\n\n// Return given type\nfunc Get(b []byte, t []struct{}) []struct{} {\n    err := json.Unmarshal(b, &amp;t)\n    if err != nil {\n        panic(err)\n    }\n    return t\n}\n</code></pre>\n\n<p>This gives:</p>\n\n<pre><code>cannot use t (type []Person) as type []struct {} in argument to Get\n</code></pre>\n\n<p>Can this be achieved as there's no generics or is there different approach?</p>\n\n<p><a href=\"https://play.golang.org/p/QEHEuqi92Wt\" rel=\"nofollow noreferrer\">https://play.golang.org/p/QEHEuqi92Wt</a></p>\n"}, {"tags": ["linux", "windows", "go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 363, "user_id": 7752659, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-hzkAu0lMAVI/AAAAAAAAAAI/AAAAAAAAAPw/DYH04TIw8Ck/photo.jpg?sz=128", "display_name": "Shoshin Nikita", "link": "https://stackoverflow.com/users/7752659/shoshin-nikita"}, "edited": false, "score": 0, "creation_date": 1521133763, "post_id": 49297528, "comment_id": 85612939, "body": "I decided to use Windows Subsystem for Linux. Thank you for advice!"}], "tags": [], "owner": {"reputation": 341, "user_id": 3196456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1X8eo.jpg?s=128&g=1", "display_name": "dontpanic", "link": "https://stackoverflow.com/users/3196456/dontpanic"}, "is_accepted": true, "score": 0, "last_activity_date": 1521111094, "creation_date": 1521111094, "answer_id": 49297528, "question_id": 49100108, "link": "https://stackoverflow.com/questions/49100108/get-error-when-try-to-build-go-code-for-linux-on-windows-10/49297528#49297528", "title": "Get error when try to build Go code for Linux on Windows 10", "body": "<p>It seems that you need a cross compiler and the dev environment for compiling a C program for Linux. After searching around, this post may help: <a href=\"https://stackoverflow.com/a/4770417/3196456\">https://stackoverflow.com/a/4770417/3196456</a> .</p>\n\n<p>Or, as you are using Windows 10, a more easier way is to try <a href=\"https://docs.microsoft.com/en-us/windows/wsl/install-win10\" rel=\"nofollow noreferrer\">Windows Subsystem for Linux</a>, which can give you a whole Linux development experience on Windows. If your Windows build is greater than 16215, you can directly install one through Microsoft Store, for example, <a href=\"https://www.microsoft.com/store/productId/9NBLGGH4MSV6\" rel=\"nofollow noreferrer\">Ubuntu</a>.</p>\n"}], "owner": {"reputation": 363, "user_id": 7752659, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-hzkAu0lMAVI/AAAAAAAAAAI/AAAAAAAAAPw/DYH04TIw8Ck/photo.jpg?sz=128", "display_name": "Shoshin Nikita", "link": "https://stackoverflow.com/users/7752659/shoshin-nikita"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 866, "favorite_count": 0, "accepted_answer_id": 49297528, "answer_count": 1, "score": 0, "last_activity_date": 1521111094, "creation_date": 1520195410, "last_edit_date": 1520235264, "question_id": 49100108, "link": "https://stackoverflow.com/questions/49100108/get-error-when-try-to-build-go-code-for-linux-on-windows-10", "title": "Get error when try to build Go code for Linux on Windows 10", "body": "<p>I try to build Go code on Windows with <code>CGO_ENABLED=1</code>. I have a .bat file with</p>\n\n<pre><code>set GOOS=linux\nset GOARCH=amd64\nset CGO_CFLAGS=-g -O2 -w\nset CGO_ENABLED=1\ngo build main.go constants.go functions.go\n</code></pre>\n\n<p>But I get error:</p>\n\n<pre><code>gcc_linux_amd64.c: In function '_cgo_sys_thread_start':\ngcc_linux_amd64.c:62:2: error: unknown type name 'sigset_t'\n  sigset_t ign, oset;\n  ^\n</code></pre>\n\n<p>What should I do? I could't find such error anywhere.</p>\n\n<p>P.S. If I haven't got \"-w\" flag in \"CGO_CFLAGS\" I will get this:</p>\n\n<pre><code># runtime/cgo\n_cgo_export.c:1:0: error: -fPIC ignored for target (all code is position \nindependent) [-Werror]\n /* Created by cgo - DO NOT EDIT. */\n ^\ncc1.exe: all warnings being treated as errors\n</code></pre>\n"}, {"tags": ["go", "switch-statement"], "comments": [{"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "edited": false, "score": 1, "creation_date": 1520259911, "post_id": 49098866, "comment_id": 85230173, "body": "On hold for opinion-based? I almost literally said in the last sentence &quot;personal opinions aside, which is preferred for performance?&quot;"}, {"owner": {"reputation": 15279, "user_id": 1058134, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/44W6b.png?s=128&g=1", "display_name": "Huangism", "link": "https://stackoverflow.com/users/1058134/huangism"}, "edited": false, "score": 0, "creation_date": 1520280201, "post_id": 49098866, "comment_id": 85242391, "body": "it&#39;s not too late to edit the question to say actually that and it can get reopened"}, {"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "reply_to_user": {"reputation": 15279, "user_id": 1058134, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/44W6b.png?s=128&g=1", "display_name": "Huangism", "link": "https://stackoverflow.com/users/1058134/huangism"}, "edited": false, "score": 0, "creation_date": 1520280252, "post_id": 49098866, "comment_id": 85242415, "body": "@Huangism that&#39;s fair, I&#39;ve updated the question"}], "answers": [{"comments": [{"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "edited": false, "score": 0, "creation_date": 1520189457, "post_id": 49099079, "comment_id": 85203428, "body": "Yes, I should have prefaced that, this particular case is mixed in with other cases that need the boolean-ness, like <code>case ctypeAlpha(mysql[i]):</code> is also in this switch earlier in the statement in the actual code"}, {"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "edited": false, "score": 0, "creation_date": 1520189655, "post_id": 49099079, "comment_id": 85203503, "body": "It&#39;s been updated"}, {"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "edited": false, "score": 0, "creation_date": 1520259842, "post_id": 49099079, "comment_id": 85230126, "body": "Nice and clean, I didn&#39;t know about the declaring in the switch syntax, that&#39;s definitely useful, thank you!"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1520191014, "last_edit_date": 1520191014, "creation_date": 1520189367, "answer_id": 49099079, "question_id": 49098866, "link": "https://stackoverflow.com/questions/49098866/boolean-switch-with-comma-vs-or/49099079#49099079", "title": "Boolean switch with comma vs or", "body": "<p>None of the above. For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc isAlpha(b byte) bool {\n    return (b &gt;= 'a' &amp;&amp; b &lt;= 'z') || (b &gt;= 'A' &amp;&amp; b &lt;= 'Z')\n}\n\nfunc isPunct(b byte) bool {\n    return b == '\"' || b == '\\'' || b == '`'\n}\n\nfunc main() {\n    i := 1\n    mysql := make([]byte, i+1)\n    mysql[i] = 'A'\n\n    switch b := mysql[i]; {\n    case isAlpha(b):\n        fmt.Printf(\"isAlpha(%c)\\n\", b)\n    case isPunct(b):\n        fmt.Printf(\"isPunct(%c\\n\", b)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/9SVWBExm9Xj\" rel=\"nofollow noreferrer\">https://play.golang.org/p/9SVWBExm9Xj</a></p>\n\n<p>Output:</p>\n\n<pre><code>isAlpha(A)\n</code></pre>\n\n<p>Note:</p>\n\n<pre><code>-gcflags='-m'\n\ninlining call to isAlpha\ninlining call to isPunct\n</code></pre>\n"}], "owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 1, "closed_date": 1520240538, "accepted_answer_id": 49099079, "answer_count": 1, "score": 2, "last_activity_date": 1520280240, "creation_date": 1520188181, "last_edit_date": 1520280240, "question_id": 49098866, "link": "https://stackoverflow.com/questions/49098866/boolean-switch-with-comma-vs-or", "closed_reason": "Opinion-based", "title": "Boolean switch with comma vs or", "body": "<p>I know that in Go, you can switch with conditions as the case statements like this:</p>\n\n<pre><code>func ctypeAlpha(b byte) bool {\n    return (b &gt;= 'a' &amp;&amp; b &lt;= 'z') || (b &gt;= 'A' &amp;&amp; b &lt;= 'Z')\n}\n\nswitch {\ncase ctypeAlpha(mysql[i]):\n    ...\ncase mysql[i] == '\"' || mysql[i] == '\\'' || mysql[i] == '`':\n    ...\n</code></pre>\n\n<p>But in learning that cases break implicitly, and that to have multiple matches execute the same code, you can use commas like this</p>\n\n<pre><code>switch {\ncase ctypeAlpha(mysql[i]):\n    ...\ncase mysql[i] == '\"', mysql[i] == '\\'', mysql[i] == '`':\n    ... \n</code></pre>\n\n<p>Personal opinions aside, which is preferred for performance? </p>\n"}, {"tags": ["json", "amazon-web-services", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520181729, "post_id": 49097385, "comment_id": 85200612, "body": "Json tags are used to store meta information. Basically when you are using json.Marshal it will by default takes the capital case field names of struct but if you are using json tags you will get different json ouput on marshalling."}, {"owner": {"reputation": 807, "user_id": 6341379, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/465dee470994316b746a788c73520445?s=128&d=identicon&r=PG&f=1", "display_name": "k_vishwanath", "link": "https://stackoverflow.com/users/6341379/k-vishwanath"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520182428, "post_id": 49097385, "comment_id": 85200892, "body": "I&#39;m getting proper o/p for this go struct CreateTargetGroupInput even though there is no json tag present .. also I can send the json name however I want as long as the name is correct in this case.. I can send Port as port, PorT, PORT, PoRT, etc. that&#39;s where my confusion is.. for normal struct it won&#39;t allow"}, {"owner": {"reputation": 807, "user_id": 6341379, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/465dee470994316b746a788c73520445?s=128&d=identicon&r=PG&f=1", "display_name": "k_vishwanath", "link": "https://stackoverflow.com/users/6341379/k-vishwanath"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520182599, "post_id": 49097385, "comment_id": 85200964, "body": "One thing what I observed is, I have declared targetGroupInput (targetGroupInput := &amp;elbv2.CreateTargetGroupInput{} ) as pointer and it works for all structs, no matter what json tag you give as long as parameter spelling remains same."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520183018, "post_id": 49097385, "comment_id": 85201104, "body": "yes it works like that but the change comes when you are marshalling the json which will name the json tag on basis of your struct field name or json tag if defined."}, {"owner": {"reputation": 807, "user_id": 6341379, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/465dee470994316b746a788c73520445?s=128&d=identicon&r=PG&f=1", "display_name": "k_vishwanath", "link": "https://stackoverflow.com/users/6341379/k-vishwanath"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520183605, "post_id": 49097385, "comment_id": 85201337, "body": "Yes, Himanshu I agree that during Marshalling it give either Capital case field or the name defined in json tag. Also it is the same for Unmarshalling if the object if not a struct pointer. I have updated the question. Please let me know if you have any idea on it."}, {"owner": {"reputation": 807, "user_id": 6341379, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/465dee470994316b746a788c73520445?s=128&d=identicon&r=PG&f=1", "display_name": "k_vishwanath", "link": "https://stackoverflow.com/users/6341379/k-vishwanath"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520219773, "post_id": 49097385, "comment_id": 85211096, "body": "What&#39;s wrong with question. Why down vote guys. Please comment it before doing"}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": -1, "last_activity_date": 1520891304, "last_edit_date": 1520891304, "creation_date": 1520183683, "answer_id": 49098077, "question_id": 49097385, "link": "https://stackoverflow.com/questions/49097385/how-to-decode-json-with-type-convert-from-string-to-integer-in-golang-for-non-lo/49098077#49098077", "title": "How to decode JSON with type convert from string to integer in Golang for non-local types?", "body": "<p>We can define any name whether lower or upper case when unmarshal the json bytes to a struct. But we cannot define it when marshaling the struct to json. As It will not convert the lower case field <code>name</code> It will not take the value of json since the <code>name</code> should be uppercase for it to become exportable. Check this code on <a href=\"https://play.golang.org/p/sF11W4OaLnw\" rel=\"nofollow noreferrer\">Go playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 807, "user_id": 6341379, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/465dee470994316b746a788c73520445?s=128&d=identicon&r=PG&f=1", "display_name": "k_vishwanath", "link": "https://stackoverflow.com/users/6341379/k-vishwanath"}, "edited": false, "score": 0, "creation_date": 1520184160, "post_id": 49098120, "comment_id": 85201524, "body": "Yes, but it is not a best practise to do the changes on the original struct of the aws go sdk. if there is no other way then I have to maintain a exact copy of the struct in my project with some little changes right"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 807, "user_id": 6341379, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/465dee470994316b746a788c73520445?s=128&d=identicon&r=PG&f=1", "display_name": "k_vishwanath", "link": "https://stackoverflow.com/users/6341379/k-vishwanath"}, "edited": false, "score": 0, "creation_date": 1520192352, "post_id": 49098120, "comment_id": 85204429, "body": "@k_vishwanath. No you don&#39;t. You have your own struct which matches the JSON you receive to unmarshal the JSON and you copy the value to the struct provided by the AWS sdk. Different things, different struct. Where&#39;s the problem with a little programming?"}, {"owner": {"reputation": 807, "user_id": 6341379, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/465dee470994316b746a788c73520445?s=128&d=identicon&r=PG&f=1", "display_name": "k_vishwanath", "link": "https://stackoverflow.com/users/6341379/k-vishwanath"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1520219588, "post_id": 49098120, "comment_id": 85211051, "body": "@Volker. I&#39;m already maintaining the copy of the SDK struct and using it. Thank you"}], "tags": [], "owner": {"reputation": 2384, "user_id": 9280994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/378f51f8fdf92e078e0fd52507fed62f?s=128&d=identicon&r=PG&f=1", "display_name": "Jonathan R", "link": "https://stackoverflow.com/users/9280994/jonathan-r"}, "is_accepted": false, "score": 7, "last_activity_date": 1520183934, "creation_date": 1520183934, "answer_id": 49098120, "question_id": 49097385, "link": "https://stackoverflow.com/questions/49097385/how-to-decode-json-with-type-convert-from-string-to-integer-in-golang-for-non-lo/49098120#49098120", "title": "How to decode JSON with type convert from string to integer in Golang for non-local types?", "body": "<p>To convert from string to int64 simply tell Go that its a string encoded int64.</p>\n\n<pre><code>type CreateTargetGroupInput struct {\n    _ struct{} `type:\"structure\"`\n    Name *string `type:\"string\" required:\"true\"`\n    Port *int64 `json:\",string\"`\n    Protocol *string `type:\"string\" required:\"true\" enum:\"ProtocolEnum\"`\n    VpcId *string `type:\"string\" required:\"true\"`\n}\n</code></pre>\n\n<p>from: <a href=\"https://golang.org/pkg/encoding/json\" rel=\"noreferrer\">https://golang.org/pkg/encoding/json</a></p>\n"}, {"tags": [], "owner": {"reputation": 171, "user_id": 3304460, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ituNw.jpg?s=128&g=1", "display_name": "Ranjith Manickam", "link": "https://stackoverflow.com/users/3304460/ranjith-manickam"}, "is_accepted": false, "score": 0, "last_activity_date": 1594800732, "last_edit_date": 1594800732, "creation_date": 1594800417, "answer_id": 62910297, "question_id": 49097385, "link": "https://stackoverflow.com/questions/49097385/how-to-decode-json-with-type-convert-from-string-to-integer-in-golang-for-non-lo/62910297#62910297", "title": "How to decode JSON with type convert from string to integer in Golang for non-local types?", "body": "<p>You can use the <code>json.Number</code> data type to convert the string to an integer value.</p>\n<p><strong>struct</strong></p>\n<pre><code>type CreateTargetGroupInput struct {\n    _        struct{}    `type:&quot;structure&quot;`\n    Name     string      `type:&quot;string&quot; required:&quot;true&quot;`\n    Port     json.Number `min:&quot;1&quot; type:&quot;integer&quot; required:&quot;true&quot;`\n    Protocol string      `type:&quot;string&quot; required:&quot;true&quot; enum:&quot;ProtocolEnum&quot;`\n    VpcId    string      `type:&quot;string&quot; required:&quot;true&quot;`\n}\n</code></pre>\n<p><strong>go code</strong></p>\n<pre><code>\nfunc main() {\n    s := `{ &quot;name&quot;: &quot;test-tg&quot;, &quot;port&quot;: &quot;8080&quot;, &quot;protocol&quot;: &quot;HTTP&quot; ,&quot;vpcId&quot;: &quot;vpc-xxxxxx&quot;}`\n\n    var targetGroupInput CreateTargetGroupInput\n    err := json.Unmarshal([]byte(s), &amp;targetGroupInput)\n\n    if err == nil {\n        fmt.Printf(&quot;%+v\\n&quot;, targetGroupInput)\n    }\n}\n</code></pre>\n<p><strong>output</strong></p>\n<pre><code>{\n    &quot;Name&quot;: &quot;test-tg&quot;,\n    &quot;Port&quot;: 8080,\n    &quot;Protocol&quot;: &quot;HTTP&quot;,\n    &quot;VpcId&quot;: &quot;vpc-xxxxxx&quot;\n}\n</code></pre>\n<p><strong>Reference:</strong> <a href=\"https://play.golang.org/p/3q4-CGnmNyE\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3q4-CGnmNyE</a></p>\n"}], "owner": {"reputation": 807, "user_id": 6341379, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/465dee470994316b746a788c73520445?s=128&d=identicon&r=PG&f=1", "display_name": "k_vishwanath", "link": "https://stackoverflow.com/users/6341379/k-vishwanath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5234, "favorite_count": 3, "answer_count": 3, "score": 3, "last_activity_date": 1594800732, "creation_date": 1520179707, "last_edit_date": 1520183414, "question_id": 49097385, "link": "https://stackoverflow.com/questions/49097385/how-to-decode-json-with-type-convert-from-string-to-integer-in-golang-for-non-lo", "title": "How to decode JSON with type convert from string to integer in Golang for non-local types?", "body": "<p>Below is the actual struct type in aws go sdk elbv2 package. \nThere are other parameters in this struct. I have kept only the necessary ones for simplicity.</p>\n\n<pre><code>type CreateTargetGroupInput struct {\n    _ struct{} `type:\"structure\"`\n    Name *string `type:\"string\" required:\"true\"`\n    Port *int64 `min:\"1\" type:\"integer\" required:\"true\"`\n    Protocol *string `type:\"string\" required:\"true\" enum:\"ProtocolEnum\"`\n    VpcId *string `type:\"string\" required:\"true\"`\n}  \n</code></pre>\n\n<p>I need to decode a JSON string with integer number like:</p>\n\n<pre><code>{ \"name\": \"test-tg\", \"port\": \"8080\", \"protocol\": \"HTTP\" ,\"vpcId\": \"vpc-xxxxxx\"}\n</code></pre>\n\n<p>go code:</p>\n\n<pre><code>func main() {\n    s := `{ \"name\": \"test-tg\", \"port\": \"8080\", \"protocol\": \"HTTP\" ,\"vpcId\": \"vpc-xxxxxx\"}`\n\n    targetGroupInput := &amp;elbv2.CreateTargetGroupInput{}\n    err := json.Unmarshal([]byte(s), targetGroupInput)\n\n    if err == nil {\n        fmt.Printf(\"%+v\\n\", targetGroupInput)\n    }\n}\n</code></pre>\n\n<p>I'm getting the below output, (if I pass port in integer format it'll work)</p>\n\n<pre><code>{\n    Name: \"testTG\",\n    Port: 0,\n    Protocol: \"HTTP\",\n    VpcId: \"vpc-0f2c8a76\"\n}\n</code></pre>\n\n<p>My question is there is no json field in the original struct, so whatever valid name I pass as json field, it is still maaping to go field. \ni.e. I can send Name field as </p>\n\n<pre><code>\"name, Name, NamE, etc\" \n</code></pre>\n\n<p>in json and it still works.</p>\n\n<p>I'm confused here. For other user defined struct it wont map properly if I don't provide valid json name as defined against that go field.</p>\n\n<p>Also how do I convert Port to integer from string during Json Unmarshlling? </p>\n\n<p>As of now I'm using the exact copy of the struct in my project and removing the string type to integer for all integer type fields (also removed all pointers from all struct fields) and receiving the json object and I'm then converting it to integer and making the object of original struct.</p>\n\n<p>It takes more time for me to maintain the exact copy by doing some changes in my project folder and to do validation against all such parameters. </p>\n\n<p>I have the following questions.</p>\n\n<ol>\n<li>Is there a way to convert string to integer during unmarshlling without adding json tag like (<code>json:\",string\"</code>) against the integer field.</li>\n<li>Is it a good practice to maintain an exact copy of the struct (struct of elbv2 package) with few changes?</li>\n</ol>\n"}, {"tags": ["go", "structure", "channels"], "answers": [{"tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 1, "last_activity_date": 1520178018, "last_edit_date": 1520178018, "creation_date": 1520177151, "answer_id": 49096951, "question_id": 49096893, "link": "https://stackoverflow.com/questions/49096893/meaning-of-variable-struct/49096951#49096951", "title": "Meaning of : variable &lt;-struct {}{}", "body": "<p><code>variable</code> is a variable of type channel (values are sent on it)</p>\n\n<p><code>&lt;-</code> is a send operator</p>\n\n<p><code>struct{}</code> is type empty struct (has no fields)</p>\n\n<p><code>{}</code> makes it a struct literal (creates a value of the given struct type)</p>\n\n<p>To better understand this form let me give you an example of a different struct type:</p>\n\n<pre><code>p := struct{ X, Y float64 }{0.0, 0.0}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520260413, "post_id": 49096994, "comment_id": 85230508, "body": "And the reason one might use this is to send a simple indicator over a channel when no data is needed - for example, a &quot;exit this routine&quot; channel or a &quot;hit counter&quot; channel. In this case, an empty struct is the most efficient because it uses no memory."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 7, "last_activity_date": 1520185448, "last_edit_date": 1520185448, "creation_date": 1520177379, "answer_id": 49096994, "question_id": 49096893, "link": "https://stackoverflow.com/questions/49096893/meaning-of-variable-struct/49096994#49096994", "title": "Meaning of : variable &lt;-struct {}{}", "body": "<blockquote>\n  <p>I don't understand the meaning of the double {}.</p>\n\n<pre><code>struct {}{}\n</code></pre>\n</blockquote>\n\n<p>In long form,</p>\n\n<pre><code>type T struct{}\nvar t = T{}\n</code></pre>\n\n<p><code>struct {}</code> is a type, a <code>struct</code> with no fields, and <code>struct {}{}</code> is a composite literal, with zero values, of that type.</p>\n\n<p>References:</p>\n\n<p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a> </p>\n\n<p><a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">Struct types</a></p>\n\n<p><a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">Composite literals</a></p>\n\n<p><a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">The zero value</a> </p>\n"}], "owner": {"reputation": 55, "user_id": 9301799, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/eb051a881076864cefa0edcb05fd5b14?s=128&d=identicon&r=PG", "display_name": "heretolearn", "link": "https://stackoverflow.com/users/9301799/heretolearn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1520185448, "creation_date": 1520176726, "question_id": 49096893, "link": "https://stackoverflow.com/questions/49096893/meaning-of-variable-struct", "title": "Meaning of : variable &lt;-struct {}{}", "body": "<p>I don't understand the meaning of the double {}. This is not made clear in any learning material.  Thanks.    </p>\n\n<pre><code>variable &lt;-struct {}{} \n</code></pre>\n"}, {"tags": ["xml", "go"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 0, "last_activity_date": 1520177147, "creation_date": 1520177147, "answer_id": 49096948, "question_id": 49096457, "link": "https://stackoverflow.com/questions/49096457/get-value-of-xml-node-attribute/49096948#49096948", "title": "get value of xml node attribute", "body": "<p>You could change your structure a bit.</p>\n\n<pre><code>type RoutingEngines struct {\n    RoutingEngine []struct {\n        Temperature struct {\n            Celsius int    `xml:\"celsius,attr\"`\n            Text    string `xml:\",chardata\"`\n        } `xml:\"temperature\"`\n    } `xml:\"route-engine-information&gt;route-engine\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/zxXsfW-Kzsa\" rel=\"nofollow noreferrer\">https://play.golang.org/p/zxXsfW-Kzsa</a></p>\n"}], "owner": {"reputation": 1, "user_id": 9441826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89263c827f21584bf216f7dd212d1a50?s=128&d=identicon&r=PG&f=1", "display_name": "trunkzee", "link": "https://stackoverflow.com/users/9441826/trunkzee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1520177147, "creation_date": 1520173598, "last_edit_date": 1520176358, "question_id": 49096457, "link": "https://stackoverflow.com/questions/49096457/get-value-of-xml-node-attribute", "title": "get value of xml node attribute", "body": "<p>I'm trying to unmarshal the following XML:</p>\n\n<pre><code>    &lt;rpc-reply xmlns:junos=\"http://xml.juniper.net/junos/12.3R9/junos\"&gt;\n        &lt;route-engine-information xmlns=\"http://xml.juniper.net/junos/12.3R9/junos-chassis\"&gt;\n            &lt;route-engine&gt;\n                [...]\n                &lt;temperature junos:celsius=\"36\"&gt;36 degrees C / 96 degrees F&lt;/temperature&gt;\n                [...]\n            &lt;/route-engine&gt;\n        &lt;/route-engine-information&gt; \n       [...]\n    &lt;/rpc-reply&gt;\n</code></pre>\n\n<p>In the end I want the <code>36</code> from the <code>junos:celsius</code> attribute but can't find a way, here's my approach:</p>\n\n<pre><code>type RoutingEngines struct {\n    RoutingEngine []struct {\n        [...]\n        Temperature int `xml:\"temperature,junos:celsius,attr\"`\n    } `xml:\"route-engine-information&gt;route-engine\"`\n}\n</code></pre>\n\n<p>Sadly this doesn't work</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520169795, "post_id": 49095867, "comment_id": 85196676, "body": "The <code>Read</code> method returns an error, please check that error and if it&#39;s <code>nil</code> or it&#39;s message is not clear come back. Same for <code>WriteString</code>. But it&#39;s probably the cursor, it&#39;s at the end of the file after <code>WriteString</code> <a href=\"https://play.golang.org/p/nCfxvaAg0y6\" rel=\"nofollow noreferrer\">play.golang.org/p/nCfxvaAg0y6</a>. You would see that if you checked the error from Read, you would get EOF."}, {"owner": {"reputation": 23, "user_id": 9441365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/750020eca140eb8c3f2b6c266f507be6?s=128&d=identicon&r=PG&f=1", "display_name": "offvw", "link": "https://stackoverflow.com/users/9441365/offvw"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520169990, "post_id": 49095867, "comment_id": 85196737, "body": "error is EOF, didn&#39;t know why."}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520170338, "post_id": 49095907, "comment_id": 85196835, "body": "It should be enough to just rewind the cursor with <code>Seek</code>. <a href=\"https://play.golang.org/p/nCfxvaAg0y6\" rel=\"nofollow noreferrer\">play.golang.org/p/nCfxvaAg0y6</a>"}, {"owner": {"reputation": 23, "user_id": 9441365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/750020eca140eb8c3f2b6c266f507be6?s=128&d=identicon&r=PG&f=1", "display_name": "offvw", "link": "https://stackoverflow.com/users/9441365/offvw"}, "edited": false, "score": 0, "creation_date": 1520253110, "post_id": 49095907, "comment_id": 85226133, "body": "Thank you. Yeah, all is because the Seeker."}], "tags": [], "owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "is_accepted": false, "score": 1, "last_activity_date": 1520170585, "last_edit_date": 1520170585, "creation_date": 1520169983, "answer_id": 49095907, "question_id": 49095867, "link": "https://stackoverflow.com/questions/49095867/why-f1-readbuf-doesnt-read-out-content-to-buf/49095907#49095907", "title": "why f1.Read(buf) doesn&#39;t read out content to buf?", "body": "<p>Generally because the written information might have not been flushed and stored to disk for reading. Try closing the file and reopening it for reading:</p>\n\n<pre><code>f1, _ := os.Create(\"/tmp/f1\")\n\nio.WriteString(f1, \"some content\")\nf1.Close()\n\nbuf := make([]byte, 8)\n\nf1, _ = os.Open(\"/tmp/f1\")\n\nf1.Read(buf)\n\nfmt.Println(buf)\n</code></pre>\n\n<p>Prints</p>\n\n<blockquote>\n  <p>[115 111 109 101 32 99 111 110]</p>\n</blockquote>\n\n<p>Interestingly though, if you just get a different handler to that file, it will also work. However, I suspect this might be very unstable and dependent on the OS specific file system implementation (OSX APFS in my case). The write is only truly complete with <code>Close</code> returning no error:</p>\n\n<pre><code>f1, _ := os.Create(\"/tmp/f1\")\n\nio.WriteString(f1, \"some content\")\n\nbuf := make([]byte, 8)\n\nf2, _ := os.Open(\"/tmp/f1\")\n\nf2.Read(buf)\n\nfmt.Println(buf)\n</code></pre>\n\n<p>Prints:</p>\n\n<blockquote>\n  <p>[115 111 109 101 32 99 111 110]</p>\n</blockquote>\n\n<p><strong>Correction</strong>: as the below comment suggests, rewinding the cursor on the same handle should work as well:</p>\n\n<pre><code>f1, _ := os.Create(\"/tmp/f1\")\n\nio.WriteString(f1, \"some content\")\n\nf1.Seek(0, 0)\n\nbuf := make([]byte, 8)\n\nf1.Read(buf)\n\nfmt.Println(buf)\n</code></pre>\n\n<p>Prints:</p>\n\n<blockquote>\n  <p>[115 111 109 101 32 99 111 110]</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1520172372, "post_id": 49096114, "comment_id": 85197444, "body": "&quot;Actually when your creating a pointer to the file *File using os.Create.It reads to EOF.&quot; Actually, &quot;[os] Create creates the named file, truncating it if it already exists.&quot; <a href=\"https://golang.org/pkg/os/#Create\" rel=\"nofollow noreferrer\">golang.org/pkg/os/#Create</a>"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": -2, "last_activity_date": 1520172652, "last_edit_date": 1520172652, "creation_date": 1520171253, "answer_id": 49096114, "question_id": 49095867, "link": "https://stackoverflow.com/questions/49095867/why-f1-readbuf-doesnt-read-out-content-to-buf/49096114#49096114", "title": "why f1.Read(buf) doesn&#39;t read out content to buf?", "body": "<p>After writing to the file use <code>Seek</code> to read from the origin of file which will read the contents from the start and insert to <code>buf</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\nfunc main() {\n\n    f1, err := os.Create(\"f1\")\n    if err != nil {\n        fmt.Println(err)\n    }\n    io.WriteString(f1, \"some content\")\n    buf := make([]byte, 8)\n    f1.Seek(0,0)\n    n, err := f1.Read(buf)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(string(buf))\n    fmt.Println(n)\n\n}\n</code></pre>\n\n<p>Output:</p>\n\n<blockquote>\n  <p>some content \n  12</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 23, "user_id": 9441365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/750020eca140eb8c3f2b6c266f507be6?s=128&d=identicon&r=PG&f=1", "display_name": "offvw", "link": "https://stackoverflow.com/users/9441365/offvw"}, "edited": false, "score": 0, "creation_date": 1520180571, "post_id": 49096723, "comment_id": 85200150, "body": "The Writer and Reader share offset, That&#39;s the reason. Before I think they doesn&#39;t affect each other."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 23, "user_id": 9441365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/750020eca140eb8c3f2b6c266f507be6?s=128&d=identicon&r=PG&f=1", "display_name": "offvw", "link": "https://stackoverflow.com/users/9441365/offvw"}, "edited": false, "score": 0, "creation_date": 1520181338, "post_id": 49096723, "comment_id": 85200478, "body": "@JinlongWang: The offset is a property of <code>os.File</code>, that&#39;s the reason."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1520175964, "last_edit_date": 1520175964, "creation_date": 1520175561, "answer_id": 49096723, "question_id": 49095867, "link": "https://stackoverflow.com/questions/49095867/why-f1-readbuf-doesnt-read-out-content-to-buf/49096723#49096723", "title": "why f1.Read(buf) doesn&#39;t read out content to buf?", "body": "<p>In Go, don't ignore errors. When writing to and reading from a file, keep track of the current file offset. </p>\n\n<p>After the write the offset is at the end-of-file, you need to set the offset to the start-of-file before the read. For example, with diagnostic information,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\nfunc main() {\n    f1, err := os.Create(\"f1\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer f1.Close()\n    // The file offset is its current location.\n    s, err := f1.Seek(0, io.SeekCurrent)\n    if err != nil {\n        fmt.Println(s, err)\n        return\n    }\n    fmt.Println(\"offset:\", s)\n    // writing takes place at the file offset, and\n    // the file offset is incremented by the number of bytes actually\n    // written.\n    n, err := f1.WriteString(\"some content\")\n    fmt.Println(\"write: \", n, err)\n    if err != nil {\n        fmt.Println(n, err)\n        return\n    }\n    // The file offset is its current location\n    s, err = f1.Seek(0, io.SeekCurrent)\n    if err != nil {\n        fmt.Println(s, err)\n        return\n    }\n    fmt.Println(\"offset:\", s)\n\n    buf := make([]byte, 8)\n\n    // the read operation commences at the\n    // file offset, and the file offset is incremented by the number of\n    // bytes read.  If the file offset is at or past the end of file, no\n    // bytes are read, and read() returns zero.\n    n, err = f1.Read(buf[:cap(buf)])\n    fmt.Println(\"read:  \", n, err)\n    buf = buf[:n]\n    fmt.Println(\"buffer:\", len(buf), buf)\n    if err != nil {\n        if err != io.EOF {\n            fmt.Println(n, err)\n            return\n        }\n    }\n\n    // The file offset is set to the start-of-file.\n    s, err = f1.Seek(0, io.SeekStart)\n    if err != nil {\n        fmt.Println(s, err)\n        return\n    }\n    fmt.Println(\"offset:\", s)\n    // the read operation commences at the\n    // file offset, and the file offset is incremented by the number of\n    // bytes read.  If the file offset is at or past the end of file, no\n    // bytes are read, and read() returns zero.\n    n, err = f1.Read(buf[:cap(buf)])\n    fmt.Println(\"read:  \", n, err)\n    buf = buf[:n]\n    fmt.Println(\"buffer:\", len(buf), buf)\n    if err != nil {\n        if err != io.EOF {\n            fmt.Println(n, err)\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/hPUn1ltKP2t\" rel=\"nofollow noreferrer\">https://play.golang.org/p/hPUn1ltKP2t</a></p>\n\n<p>Output:</p>\n\n<pre><code>offset: 0\nwrite:  12 &lt;nil&gt;\noffset: 12\nread:   0 EOF\nbuffer: 0 []\noffset: 0\nread:   8 &lt;nil&gt;\nbuffer: 8 [115 111 109 101 32 99 111 110]\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 9441365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/750020eca140eb8c3f2b6c266f507be6?s=128&d=identicon&r=PG&f=1", "display_name": "offvw", "link": "https://stackoverflow.com/users/9441365/offvw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 1, "accepted_answer_id": 49096723, "answer_count": 3, "score": 0, "last_activity_date": 1520175964, "creation_date": 1520169722, "question_id": 49095867, "link": "https://stackoverflow.com/questions/49095867/why-f1-readbuf-doesnt-read-out-content-to-buf", "title": "why f1.Read(buf) doesn&#39;t read out content to buf?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"io\"\n)\n\nfunc main() {\n\n    f1,_ := os.Create(\"f1\")\n\n    io.WriteString(f1, \"some content\")\n\n    buf := make([]byte, 8)\n\n    f1.Read(buf)\n\n    fmt.Println(buf)\n\n}\n</code></pre>\n\n<p>I create a file, then write in some string. then read out, but there is no content.</p>\n\n<p>The output is :  </p>\n\n<pre><code>go run test.go\n[0 0 0 0 0 0 0 0]\n</code></pre>\n"}, {"tags": ["go", "github", "package", "travis-ci", "absolute-path"], "comments": [{"owner": {"reputation": 465, "user_id": 1936173, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/8uQ1j.png?s=128&g=1", "display_name": "Illia Danko", "link": "https://stackoverflow.com/users/1936173/illia-danko"}, "edited": false, "score": 1, "creation_date": 1520157438, "post_id": 49092910, "comment_id": 85193369, "body": "This is a bad habit (in Go) to put sources into the src directory, and this is the cause of your problem. At least, one go file must be located in the root directory. Useful information you can find here <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a> and here <a href=\"https://blog.golang.org/organizing-go-code\" rel=\"nofollow noreferrer\">blog.golang.org/organizing-go-code</a>"}, {"owner": {"reputation": 153, "user_id": 1831738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ffaad782263b04db1a2afd9c8242718?s=128&d=identicon&r=PG", "display_name": "Hisko", "link": "https://stackoverflow.com/users/1831738/hisko"}, "reply_to_user": {"reputation": 465, "user_id": 1936173, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/8uQ1j.png?s=128&g=1", "display_name": "Illia Danko", "link": "https://stackoverflow.com/users/1936173/illia-danko"}, "edited": false, "score": 0, "creation_date": 1520179472, "post_id": 49092910, "comment_id": 85199752, "body": "@Illia Danko you are right I moved the files out of src and it worked."}], "owner": {"reputation": 153, "user_id": 1831738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ffaad782263b04db1a2afd9c8242718?s=128&d=identicon&r=PG", "display_name": "Hisko", "link": "https://stackoverflow.com/users/1831738/hisko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 835, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1520152136, "creation_date": 1520147334, "last_edit_date": 1520152136, "question_id": 49092910, "link": "https://stackoverflow.com/questions/49092910/cant-build-golang-project-with-absolute-package-path", "title": "Can&#39;t build golang project with absolute package path", "body": "<p>I am struggling with my travis-ci build.\nHere the arborescence of my project:</p>\n\n<pre><code>- github.com\n  - src\n    - MyLib\n      - MyLibImpl.go\n     - main.go\n</code></pre>\n\n<p>The main.go is referencing MyLib like this</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport MyLib \"github.com/hako910/GolangTest/src/MyLib\"\n\nfunc main() {\n    fmt.Printf(\"%v\", MyLib.HelloWorld())\n}\n</code></pre>\n\n<p>It works great on my machine but fails in travis-ci with this message:</p>\n\n<pre><code>$ go get -t -v ./...\ngithub.com/hako910/GolangTest (download)\npackage github.com/hako910/GolangTest/src/MyLib: /home/travis/gopath/src/github.com/hako910/GolangTest exists but /home/travis/gopath/src/github.com/hako910/GolangTest/.git does not - stale checkout?\n\nThe command \"eval go get -t -v ./... \" failed. Retrying, 2 of 3.\n</code></pre>\n\n<p>Here is my source code <a href=\"https://github.com/hako910/GolangTest\" rel=\"nofollow noreferrer\">https://github.com/hako910/GolangTest</a> and here is my travis-ci build <a href=\"https://travis-ci.org/hako910/GolangTest/jobs/348845103\" rel=\"nofollow noreferrer\">https://travis-ci.org/hako910/GolangTest/jobs/348845103</a></p>\n\n<p>What is wrong with my configuration?</p>\n"}, {"tags": ["arrays", "sorting", "go", "maps"], "comments": [{"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 2, "creation_date": 1520141269, "post_id": 49092273, "comment_id": 85189840, "body": "Learn to use the <a href=\"https://golang.org/pkg/sort/\" rel=\"nofollow noreferrer\"><code>sort</code></a> package.  In addition to the package documentation, there are a lot of examples and explanations online for you to read."}, {"owner": {"reputation": 1225, "user_id": 1125860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/5fbf3f7b67a3c8b8d48fe3f5edd78c68?s=128&d=identicon&r=PG", "display_name": "Swati Aggarwal", "link": "https://stackoverflow.com/users/1125860/swati-aggarwal"}, "reply_to_user": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1520141343, "post_id": 49092273, "comment_id": 85189849, "body": "@jrefior I have already checked the sort package but couldnt find an appropriate solution for this. Please help!"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 1, "creation_date": 1520141596, "post_id": 49092273, "comment_id": 85189887, "body": "Then you might not understand the power of sort.Sort yet.  For example, do you understand the <a href=\"https://golang.org/pkg/sort/#example__sortWrapper\" rel=\"nofollow noreferrer\">Wrapper Example</a> in the package documentation?"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1520141779, "post_id": 49092273, "comment_id": 85189917, "body": "Or perhaps you&#39;re not really trying to sort an array of maps.  The structure of your code excerpts is not completely clear as to data structure.  You could improve your question by posting a <a href=\"https://stackoverflow.com/help/mcve\"><code>MCVE</code></a>"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1520141931, "post_id": 49092273, "comment_id": 85189938, "body": "While you say you want to sort an array of maps, the operations you describe look more like sorting an array of arrays of maps.  Are those arrays in an array, or are they in something else?"}, {"owner": {"reputation": 1225, "user_id": 1125860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/5fbf3f7b67a3c8b8d48fe3f5edd78c68?s=128&d=identicon&r=PG", "display_name": "Swati Aggarwal", "link": "https://stackoverflow.com/users/1125860/swati-aggarwal"}, "reply_to_user": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1520142411, "post_id": 49092273, "comment_id": 85190008, "body": "@jrefior I have made my example more clear and you are right here I am trying to sort array of array of maps using value of a particular key in each array. Hope its more clear now. Please help!"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1520142936, "post_id": 49092273, "comment_id": 85190110, "body": "That is a little clearer.  And are these <code>map[string]int</code> maps or structs with <code>Name</code> and <code>Value</code> fields?  A little Go code where you define these structures or do something with them would still make the question clearer."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1520232569, "post_id": 49092273, "comment_id": 85214728, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/28999735/what-is-the-shortest-way-to-simply-sort-an-array-of-structs-by-arbitrary-field\">What is the shortest way to simply sort an array of structs by (arbitrary) field names?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 5, "last_activity_date": 1520145859, "last_edit_date": 1520145859, "creation_date": 1520145148, "answer_id": 49092665, "question_id": 49092273, "link": "https://stackoverflow.com/questions/49092273/sort-array-of-maps-using-keys-matching-a-value-go/49092665#49092665", "title": "Sort array of maps using keys matching a value GO", "body": "<p>Your data looks like it could be easily represented as a slice of maps of type <code>map[string]int</code>.  Since you didn't provide any Go code in your question, I cannot be sure of the data types, so I will assume it is a slice of maps of type <code>map[string]int</code> in this answer.</p>\n\n<p>A simple way to sort a slice of maps is to use <a href=\"https://golang.org/pkg/sort/#Slice\" rel=\"noreferrer\">the <code>sort.Slice</code> function</a>.  From <a href=\"https://golang.org/pkg/sort/#example_\" rel=\"noreferrer\">a comment in the first example</a> in the <code>sort</code> package documentation:</p>\n\n<blockquote>\n  <p>use <code>sort.Slice</code> with a custom Less function, which can be provided as a closure. In this case no methods are needed</p>\n</blockquote>\n\n<p>The Less function needs to satisfy the signature </p>\n\n<pre><code>func(i, j int) bool\n</code></pre>\n\n<p>Per <a href=\"https://golang.org/pkg/sort/#Interface\" rel=\"noreferrer\">package documentation (at Interface)</a>:</p>\n\n<blockquote>\n  <p>Less reports whether the element with index <code>i</code> should sort before the element with index <code>j</code>.</p>\n</blockquote>\n\n<p>Using a closure allows you to reference your data structure in the function body even though it is not part of the parameter list.</p>\n\n<p>Here's a runnable example that sorts a slice of <code>map[string]int</code> values matching the data in your question:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"sort\"\n)\n\nfunc main() {\n    in := []map[string]int{\n        {\n          \"A\": 100,\n          \"B\": 60,\n          \"C\": 170,\n          \"D\": 120,\n        },\n        {\n          \"A\": 64,\n          \"B\": 90,\n          \"C\": 52,\n          \"D\": 98,\n        },\n        {\n          \"A\": 154,\n          \"B\": 190,\n          \"C\": 179,\n          \"D\": 67,\n        },\n    }\n    for k, _ := range in[0] {\n        sort.Slice(in, func(i, j int) bool { return in[i][k] &lt; in[j][k] })\n        fmt.Printf(\"By %s: %v\\n\", k, in)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>By A: [map[A:64 B:90 C:52 D:98] map[A:100 B:60 C:170 D:120] map[A:154 B:190 C:179 D:67]]\nBy B: [map[A:100 B:60 C:170 D:120] map[B:90 C:52 D:98 A:64] map[C:179 D:67 A:154 B:190]]\nBy C: [map[A:64 B:90 C:52 D:98] map[A:100 B:60 C:170 D:120] map[A:154 B:190 C:179 D:67]]\nBy D: [map[A:154 B:190 C:179 D:67] map[B:90 C:52 D:98 A:64] map[A:100 B:60 C:170 D:120]]\n</code></pre>\n"}], "owner": {"reputation": 1225, "user_id": 1125860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/5fbf3f7b67a3c8b8d48fe3f5edd78c68?s=128&d=identicon&r=PG", "display_name": "Swati Aggarwal", "link": "https://stackoverflow.com/users/1125860/swati-aggarwal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1645, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1520145859, "creation_date": 1520141091, "last_edit_date": 1520142338, "question_id": 49092273, "link": "https://stackoverflow.com/questions/49092273/sort-array-of-maps-using-keys-matching-a-value-go", "title": "Sort array of maps using keys matching a value GO", "body": "<p>I have just started programming in Golang and want to sort an array of maps. I have an array of maps. Let's call it example_array. </p>\n\n<pre><code>example_array = [\n  [\n    { Name: \"A\", Value: 100 }, \n    { Name: \"B\", Value: 60 }, \n    { Name: \"C\", Value: 170 }, \n    { Name: \"D\", Value: 120} \n  ], \n  [\n    { Name: \"A\", Value: 64 }, \n    { Name: \"B\", Value: 90 }, \n    { Name: \"C\", Value: 52 }, \n    { Name: \"D\", Value: 98} \n  ], \n  [\n    { Name: \"A\", Value: 154 }, \n    { Name: \"B\", Value: 190 }, \n    { Name: \"C\", Value: 179 }, \n    { Name: \"D\", Value: 67 } \n  ]\n</code></pre>\n\n<p>]</p>\n\n<p>Now I want to sort this array using value of key <code>\"C\"</code> so the example_array should be modified to -></p>\n\n<pre><code>[\n[{Name: \"A\", Value: 64}, {Name: \"B\", Value: 90}, {Name: \"C\", Value: 52}, {Name: \"D\", Value: 98}],\n[{Name: \"A\", Value: 100}, {Name: \"B\", Value: 60}, {Name: \"C\", Value: 170}, {Name: \"D\", Value: 120}], \n[{Name: \"A\", Value: 154}, {Name: \"B\", Value: 190}, {Name: \"C\", Value: 179}, {Name: \"D\", Value: 67}]\n]\n</code></pre>\n\n<p>If I sort the original array using value of key <code>\"D\"</code>, the original array should be modified to -></p>\n\n<pre><code>[\n[{Name: \"A\", Value: 154}, {Name: \"B\", Value: 190}, {Name: \"C\", Value: 179}, {Name: \"D\", Value: 67}],\n[{Name: \"A\", Value: 64}, {Name: \"B\", Value: 90}, {Name: \"C\", Value: 52}, {Name: \"D\", Value: 98}]\n[{Name: \"A\", Value: 100}, {Name: \"B\", Value: 60}, {Name: \"C\", Value: 170}, {Name: \"D\", Value: 120}]\n]\n</code></pre>\n\n<p>How can I sort these array of maps in Golang. Please help!</p>\n"}, {"tags": ["forms", "go", "go-gin"], "answers": [{"comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1520131441, "post_id": 49090859, "comment_id": 85188199, "body": "I have not read the Gin code, but my assumption would be that it has already consumed the request body so it is not available in http.Request.Form."}, {"owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1520176684, "post_id": 49090859, "comment_id": 85198807, "body": "Actually, I think you&#39;re right. I&#39;ll amend my answer to remove that incorrect assertion."}], "tags": [], "owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "is_accepted": true, "score": -1, "last_activity_date": 1520176704, "last_edit_date": 1520176704, "creation_date": 1520124837, "answer_id": 49090859, "question_id": 49090766, "link": "https://stackoverflow.com/questions/49090766/location-of-full-html-post-form-data-in-golang/49090859#49090859", "title": "Location of full HTML POST form data in Golang", "body": "<p>I figured it out--my use of Gin was result in slightly different syntax that made most of the examples I found elsewhere not work.</p>\n\n<p>I access it with <code>c.Request.Form</code>.</p>\n"}], "owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 49090859, "answer_count": 1, "score": -1, "last_activity_date": 1520176704, "creation_date": 1520123919, "last_edit_date": 1520151537, "question_id": 49090766, "link": "https://stackoverflow.com/questions/49090766/location-of-full-html-post-form-data-in-golang", "title": "Location of full HTML POST form data in Golang", "body": "<p>I am posting an HTML form to a Golang/Gin backend. The following allows me to access individual values from the form in the backend:</p>\n\n<pre><code>titleValue := c.PostForm(\"Title\");\ncontentValue := c.PostForm(\"Content\");\n</code></pre>\n\n<p>But I cannot figure out how to access the entire form object at once instead of hard-coding in each key.</p>\n\n<p>How do I access it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1520151563, "post_id": 49089787, "comment_id": 85191889, "body": "Nothing in your question is about type aliases."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 2, "last_activity_date": 1520153357, "last_edit_date": 1520153357, "creation_date": 1520116443, "answer_id": 49089940, "question_id": 49089787, "link": "https://stackoverflow.com/questions/49089787/what-is-the-purpose-of-type-definitions-when-is-it-useful/49089940#49089940", "title": "What is the purpose of type definitions? When is it useful?", "body": "<p>That is not a type alias (as the OP originally asked, before the question was edited).<br>\nThat is a <a href=\"https://golang.org/ref/spec#Type_definitions\" rel=\"nofollow noreferrer\">type <em>definition</em></a> or \"<strong>defined type</strong>\".</p>\n\n<blockquote>\n  <p>A type definition creates a new, distinct type with the same underlying type and operations as the given type, and binds an identifier to it.</p>\n</blockquote>\n\n<pre><code>TypeDef = identifier Type .\n</code></pre>\n\n<p>That allows you to attach method on that type that you would not have been able to with the original type.</p>\n\n<hr>\n\n<p>Type <em>alias</em> is part of the <a href=\"https://golang.org/doc/go1.9#language\" rel=\"nofollow noreferrer\">Go 1.9 changes</a>.<br>\nIt was <a href=\"https://github.com/golang/proposal/blob/master/design/18130-type-alias.md\" rel=\"nofollow noreferrer\">proposed here</a> and documented in <a href=\"https://talks.golang.org/2016/refactor.article\" rel=\"nofollow noreferrer\">Code refactoring</a>.</p>\n\n<blockquote>\n  <p>Go should add the ability to create alternate equivalent names for types, in order to enable gradual code repair during codebase refactoring.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1520116487, "creation_date": 1520116487, "answer_id": 49089949, "question_id": 49089787, "link": "https://stackoverflow.com/questions/49089787/what-is-the-purpose-of-type-definitions-when-is-it-useful/49089949#49089949", "title": "What is the purpose of type definitions? When is it useful?", "body": "<p>It is helpful when you wants to redeclare different parameters which are going to be <code>map[int]int</code>. Just when serving post request they use <a href=\"https://golang.org/src/net/url/url.go?s=22818:22849#L783\" rel=\"nofollow noreferrer\">url.Values{}</a> which is actually a map[string][]string.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/url\"\n)\n\nfunc main() {\n    v := url.Values{}\n    v.Set(\"name\", \"Ava\")\n    v.Add(\"friend\", \"Jess\")\n    v.Add(\"friend\", \"Sarah\")\n    v.Add(\"friend\", \"Zoe\")\n    // v.Encode() == \"name=Ava&amp;friend=Jess&amp;friend=Sarah&amp;friend=Zoe\"\n    fmt.Println(v.Get(\"name\"))\n    fmt.Println(v.Get(\"friend\"))\n    fmt.Println(v[\"friend\"])\n}\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 8383667, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-hfZySuOHdGg/AAAAAAAAAAI/AAAAAAAAAFY/Ksu3_YA3V_4/photo.jpg?sz=128", "display_name": "p-ray", "link": "https://stackoverflow.com/users/8383667/p-ray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 2, "accepted_answer_id": 49089940, "answer_count": 2, "score": -2, "last_activity_date": 1520153357, "creation_date": 1520115228, "last_edit_date": 1520151624, "question_id": 49089787, "link": "https://stackoverflow.com/questions/49089787/what-is-the-purpose-of-type-definitions-when-is-it-useful", "title": "What is the purpose of type definitions? When is it useful?", "body": "<p>In golang you can define a type as a data structure </p>\n\n<pre><code>type MyMap map[int]int\nmapper := make(MyMap)\n</code></pre>\n\n<p>and go on to use it like a regular map in go</p>\n\n<pre><code>mapper[13] = 133\n</code></pre>\n\n<p>But I don't understand when to use this or in what scenarios this will helpful?</p>\n"}, {"tags": ["caching", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1520151916, "post_id": 49089366, "comment_id": 85191993, "body": "There&#39;s nothing wrong with that approach. Whether it&#39;s the best approach for a specific situation depends on factors not discussed."}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 4003965, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/100004587033109/picture?type=large", "display_name": "Ahmed Ashraf", "link": "https://stackoverflow.com/users/4003965/ahmed-ashraf"}, "edited": false, "score": 0, "creation_date": 1520118525, "post_id": 49089638, "comment_id": 85185875, "body": "Thanks for your comment :), I really appreciate"}, {"owner": {"reputation": 4976, "user_id": 99189, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e85341a6b300fd04dc33b1baa28b7fd8?s=128&d=identicon&r=PG", "display_name": "Jeremy Huiskamp", "link": "https://stackoverflow.com/users/99189/jeremy-huiskamp"}, "edited": false, "score": 0, "creation_date": 1520119391, "post_id": 49089638, "comment_id": 85186092, "body": "Minor point, but technically the initializations should be guarded by the mutex too."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4976, "user_id": 99189, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e85341a6b300fd04dc33b1baa28b7fd8?s=128&d=identicon&r=PG", "display_name": "Jeremy Huiskamp", "link": "https://stackoverflow.com/users/99189/jeremy-huiskamp"}, "edited": false, "score": 1, "creation_date": 1520122618, "post_id": 49089638, "comment_id": 85186794, "body": "@JeremyHuiskamp Because the <a href=\"https://golang.org/ref/mem#\" rel=\"nofollow noreferrer\">memory model</a>  guarantees that the initialization completes before the goroutines run, there&#39;s no need to guard the initializations."}, {"owner": {"reputation": 4976, "user_id": 99189, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e85341a6b300fd04dc33b1baa28b7fd8?s=128&d=identicon&r=PG", "display_name": "Jeremy Huiskamp", "link": "https://stackoverflow.com/users/99189/jeremy-huiskamp"}, "edited": false, "score": 0, "creation_date": 1520150448, "post_id": 49089638, "comment_id": 85191651, "body": "Ah, good call: \u201cthe go statement that starts a new goroutine happens before the goroutine\u2019s execution begins.\u201d"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 7, "last_activity_date": 1520122495, "last_edit_date": 1520122495, "creation_date": 1520114220, "answer_id": 49089638, "question_id": 49089366, "link": "https://stackoverflow.com/questions/49089366/what-is-the-best-way-to-cache-in-memory-and-update-with-go-routine/49089638#49089638", "title": "What is the best way to cache in memory and update with go-routine?", "body": "<p>The basic approach is OK, but there's a data race on <code>weather</code>.  Use a <a href=\"https://godoc.org/sync#RWMutex\" rel=\"nofollow noreferrer\">mutex</a> to protect the variable:</p>\n\n<pre><code>var mu sync.RWMutex\nvar weather ResponseBody\n\nfunc main() {\n    // load the weather first\n    weather = getWeather()\n    // update data every 1 second\n    go func() {\n        for {\n            time.Sleep(time.Second)\n            mu.Lock()\n            weather = getWeather()\n            mu.Unlock()\n        }\n    }()\n    // start the api\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", HomeHandler)\n    http.ListenAndServe(\":8080\", r)\n}\n\nfunc HomeHandler(w http.ResponseWriter, r *http.Request) {\n    mu.RLock()\n    b, _ := json.Marshal(weather)\n    mu.RUnlock()\n    w.Write(b)\n}\n</code></pre>\n\n<p>It is not necessary to guard the first assignment to <code>weather</code> in <code>main</code> because the assignment is <a href=\"https://golang.org/ref/mem#tmp_5\" rel=\"nofollow noreferrer\">guaranteed to happen before</a> the updating goroutine and the request handlers started by <code>ListenAndServer</code>.  </p>\n\n<p>An improvement is to cache the response body bytes:</p>\n\n<pre><code>var mu sync.RWMutex\nvar resp []byte\n\nfunc main() {\n    // load the weather first\n    weather := getWeather()\n    resp, _ = json.Marshal(weather)\n    // update data every 1 second\n    go func() {\n        for {\n            time.Sleep(time.Second)\n            mu.Lock()\n            weather = getWeather()\n            resp, _ = json.Marshal(weather)\n            mu.Unlock()\n        }\n    }()\n    // start the api\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", HomeHandler)\n    http.ListenAndServe(\":8080\", r)\n}\n\nfunc HomeHandler(w http.ResponseWriter, r *http.Request) {\n    mu.RLock()\n    b := resp\n    mu.RUnlock()\n    w.Write(b)\n}\n</code></pre>\n"}], "owner": {"reputation": 47, "user_id": 4003965, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/100004587033109/picture?type=large", "display_name": "Ahmed Ashraf", "link": "https://stackoverflow.com/users/4003965/ahmed-ashraf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1233, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1520151687, "creation_date": 1520112414, "last_edit_date": 1520151687, "question_id": 49089366, "link": "https://stackoverflow.com/questions/49089366/what-is-the-best-way-to-cache-in-memory-and-update-with-go-routine", "title": "What is the best way to cache in memory and update with go-routine?", "body": "<p><strong>The Case:</strong> Weather API - I will assume that the task is simple and I just want to make an API to return the weather based on another API </p>\n\n<p><strong>The code</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"io/ioutil\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\ntype ResponseBody struct {\n    CurrentObservation struct {\n        Weather         string `json:\"weather\"`\n        Temperature     string `json:\"temperature_string\"`\n        DisplayLocation struct {\n            City string `json:\"city\"`\n        } `json:\"display_location\"`\n    } `json:\"current_observation\"`\n}\n\nvar weather ResponseBody\n\nfunc main() {\n    // start the api\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", HomeHandler)\n    http.ListenAndServe(\":8080\", r)\n}\n\n// handler\nfunc HomeHandler(w http.ResponseWriter, r *http.Request) {\n    // load the weather first\n    weather = getWeather()\n    b, _ := json.Marshal(weather)\n    w.Write(b)\n}\n\n// get wether from wunderground api\nfunc getWeather() ResponseBody {\n    url := \"http://api.wunderground.com/api/MY_API_KEY/conditions/q/CA/San_Francisco.json\"\n    req, err := http.NewRequest(\"GET\", url, nil)\n    client := &amp;http.Client{}\n    resp, err := client.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    defer resp.Body.Close()\n    body, _ := ioutil.ReadAll(resp.Body)\n    var rb ResponseBody\n    json.Unmarshal([]byte(body), &amp;rb)\n    return rb\n}\n</code></pre>\n\n<p>Now every time someone hits the API it will send a request to the weather API, but this won't be efficient when I will have concurrent requests, so I will cache it in memory and will update the data in a go-routine every one second </p>\n\n<p>First: I will move the getWeather call to the main function</p>\n\n<pre><code>func main() {\n    // load the weather first\n    weather = getWeather()\n    // start the api\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", HomeHandler)\n    http.ListenAndServe(\":8080\", r)\n}\n\n// handler\nfunc HomeHandler(w http.ResponseWriter, r *http.Request) {\n    b, _ := json.Marshal(weather)\n    w.Write(b)\n}\n</code></pre>\n\n<p>and will start a go-routine in the main function too</p>\n\n<pre><code>func main() {\n    // load the weather first\n    weather = getWeather()\n    // update data every 1 second\n    go func() {\n        for {\n            time.Sleep(time.Second)\n            weather = getWeather()\n        }\n    }()\n    // start the api\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", HomeHandler)\n    http.ListenAndServe(\":8080\", r)\n}\n</code></pre>\n\n<p>so now the application could handle concurrent requests up to minimum 250 concurrent after testing with siege tool</p>\n\n<pre><code>Transactions:                250 hits\nAvailability:             100.00 %\nElapsed time:               0.47 secs\nData transferred:           0.03 MB\nResponse time:              0.00 secs\nTransaction rate:         531.91 trans/sec\nThroughput:             0.07 MB/sec\nConcurrency:                2.15\nSuccessful transactions:         250\nFailed transactions:               0\nLongest transaction:            0.04\nShortest transaction:           0.00\n</code></pre>\n\n<p>So is it right to cache and update data in this way? Or there is something wrong and I should do it in a better way?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520101678, "post_id": 49087586, "comment_id": 85180837, "body": "Please create <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable</a> example. Post the json that you want to unmarshal"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1520101866, "post_id": 49087586, "comment_id": 85180898, "body": "<a href=\"https://stackoverflow.com/a/31048860/1135424\">stackoverflow.com/a/31048860/1135424</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520102412, "post_id": 49087586, "comment_id": 85181100, "body": "Either allocate the value of the <code>Range</code> field so that it isn&#39;t <code>nil</code>, or add <code>,omitempty</code> to the json tag so that the json property is omitted if the <code>Range</code> field is <code>nil</code>. See here: <a href=\"https://play.golang.org/p/GWWm5yAP7lU\" rel=\"nofollow noreferrer\">play.golang.org/p/GWWm5yAP7lU</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520111214, "post_id": 49087586, "comment_id": 85183958, "body": "You can also define a type that will implement the <code>json.Marshaler</code> interface and have it decide how it&#39;s gonna be marshaled if it&#39;s empty or nil. <a href=\"https://play.golang.org/p/UJK5cjkctIw\" rel=\"nofollow noreferrer\">play.golang.org/p/UJK5cjkctIw</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "edited": false, "score": 0, "creation_date": 1520107955, "post_id": 49088683, "comment_id": 85182935, "body": "This doesn&#39;t make sense to me"}, {"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "reply_to_user": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "edited": false, "score": 0, "creation_date": 1520108888, "post_id": 49088683, "comment_id": 85183228, "body": "the range field you assign with []struct can be pointer to a string"}], "tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": false, "score": 0, "last_activity_date": 1520107477, "creation_date": 1520107477, "answer_id": 49088683, "question_id": 49087586, "link": "https://stackoverflow.com/questions/49087586/json-to-struct-conversion/49088683#49088683", "title": "JSON to struct conversion", "body": "<p>a way to do that is assign range as <code>*string</code> and then you should compare it with nil or not, if not nil convert it to string and marshall it again</p>\n"}, {"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 0, "last_activity_date": 1520325610, "last_edit_date": 1520325610, "creation_date": 1520110469, "answer_id": 49089120, "question_id": 49087586, "link": "https://stackoverflow.com/questions/49087586/json-to-struct-conversion/49089120#49089120", "title": "JSON to struct conversion", "body": "<p>assuming that you want to marshal the structs in your question and get a json output that looks like this:</p>\n\n<pre><code>  {\n    \"name\": \"cpus\",\n    \"ranges\": {\n      \"range\": []\n    },\n    \"type\": \"SCALAR\",\n    \"scalar\": {\n      \"value\": 1\n    }\n  },\n  {\n    \"name\": \"mem\",\n    \"ranges\": {\n      \"range\": []\n    }\n  }\n</code></pre>\n\n<p>In golang slices <code>[]</code> are a reference type, that are backed by an array.\nYou can read up on the internals of slices here: <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">https://blog.golang.org/go-slices-usage-and-internals</a></p>\n\n<p>Basically the reason that you are getting <code>null</code> in the output is because you have not instantiated the slice, the slice is essentially a pointer, and that pointer is nil.</p>\n\n<p>Create a new empty slice, like <code>[]Range{}</code> and assign that to the field in Resource that is currently <code>null</code> in the json, and instead of a nil pointer, you will have an empty slice that will be marshalled as <code>[]</code> and not <code>null</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 9013840, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39add896ff313859b92bbee948d67c65?s=128&d=identicon&r=PG", "display_name": "iFreezy", "link": "https://stackoverflow.com/users/9013840/ifreezy"}, "is_accepted": true, "score": 0, "last_activity_date": 1520257643, "creation_date": 1520257643, "answer_id": 49111921, "question_id": 49087586, "link": "https://stackoverflow.com/questions/49087586/json-to-struct-conversion/49111921#49111921", "title": "JSON to struct conversion", "body": "<p>That changes struct is resolved my problem: </p>\n\n<pre><code>type Resource struct {\n    Name   string  `json:\"name\"`\n    Ranges *Ranges  `json:\"ranges,omitempty\"`\n    Role   string  `json:\"role,omitempty\"`\n    Type   string  `json:\"type\"`\n    Scalar *Scalar `json:\"scalar,omitempty\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9013840, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39add896ff313859b92bbee948d67c65?s=128&d=identicon&r=PG", "display_name": "iFreezy", "link": "https://stackoverflow.com/users/9013840/ifreezy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 49111921, "answer_count": 3, "score": 1, "last_activity_date": 1520325610, "creation_date": 1520101193, "last_edit_date": 1520101372, "question_id": 49087586, "link": "https://stackoverflow.com/questions/49087586/json-to-struct-conversion", "title": "JSON to struct conversion", "body": "<p>This is the struct I have:</p>\n\n<pre><code>type Resource struct {\n    Name string `json:\"name\"`\n    Ranges struct {\n        Range []struct {\n            Begin int `json:\"begin\"`\n            End   int `json:\"end\"`\n        } `json:\"range\"`\n    } `json:\"ranges,omitempty\"`\n    Role string `json:\"role,omitempty\"`\n    Type string `json:\"type\"`\n    Scalar Scalar `json:\"scalar,omitempty\"`\n}\n</code></pre>\n\n<p>I don't know how to make fields in the JSON not <code>null</code>. For example, struct Range like that:</p>\n\n<pre><code>{\n    \"name\": \"cpus\",\n    \"ranges\": {\n        \"range\": null\n    },\n    \"type\": \"SCALAR\",\n    \"scalar\": {\n        \"value\": 1\n    }\n}, {\n    \"name\": \"mem\",\n    \"ranges\": {\n        \"range\": null\n}\n</code></pre>\n"}, {"tags": ["api", "post", "go", "request"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520095182, "post_id": 49086499, "comment_id": 85178483, "body": "I have also faced same issue when I am working with micro service. Can you print the output of error you should get on console when running your program using go run in terminal"}, {"owner": {"reputation": 486, "user_id": 6513167, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/597312657096897/picture?type=large", "display_name": "Martin Niederl", "link": "https://stackoverflow.com/users/6513167/martin-niederl"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520096150, "post_id": 49086499, "comment_id": 85178815, "body": "I updated my question and added the output, but as i said, the errors are nil and the response &quot;object&quot; contains 400."}], "answers": [{"comments": [{"owner": {"reputation": 486, "user_id": 6513167, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/597312657096897/picture?type=large", "display_name": "Martin Niederl", "link": "https://stackoverflow.com/users/6513167/martin-niederl"}, "edited": false, "score": 0, "creation_date": 1520098405, "post_id": 49086815, "comment_id": 85179598, "body": "I already tried setting the Content-Type before, but i did not know that you need to pass the url Values extra. Thank You"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 486, "user_id": 6513167, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/597312657096897/picture?type=large", "display_name": "Martin Niederl", "link": "https://stackoverflow.com/users/6513167/martin-niederl"}, "edited": false, "score": 0, "creation_date": 1520098652, "post_id": 49086815, "comment_id": 85179694, "body": "<code>url.Values{}</code> is actually a type <code>map[string][]string</code> which is a created <a href=\"https://golang.org/src/net/url/url.go?s=22818:22849#L783\" rel=\"nofollow noreferrer\">Type</a>"}, {"owner": {"reputation": 486, "user_id": 6513167, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/597312657096897/picture?type=large", "display_name": "Martin Niederl", "link": "https://stackoverflow.com/users/6513167/martin-niederl"}, "edited": false, "score": 0, "creation_date": 1520338675, "post_id": 49086815, "comment_id": 85265713, "body": "Do you have an idea why the parameters still aren&#39;t sent or received by the API with your approach? The API sends the exact same message it would send when you provide no parameters at all. If any parameter is corrupted it would return a specific error message, so that&#39;s not the case"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 486, "user_id": 6513167, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/597312657096897/picture?type=large", "display_name": "Martin Niederl", "link": "https://stackoverflow.com/users/6513167/martin-niederl"}, "edited": false, "score": 0, "creation_date": 1520352903, "post_id": 49086815, "comment_id": 85275427, "body": "will you show the error message that you are getting also are you able to get the posted parameters"}, {"owner": {"reputation": 486, "user_id": 6513167, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/597312657096897/picture?type=large", "display_name": "Martin Niederl", "link": "https://stackoverflow.com/users/6513167/martin-niederl"}, "edited": false, "score": 0, "creation_date": 1520367800, "post_id": 49086815, "comment_id": 85283867, "body": "This is the result I get from the API (i would expect it to have RESULT set to TRUE and instead of CAUSE return a TOKEN:  <code># #Tue Mar 06 12:20:41 PST 2018 CAUSE=null RESULT=FALSE</code>  I don&#39;t know what you mean by &quot;get the posted parameters&quot;."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1520097463, "last_edit_date": 1520097463, "creation_date": 1520096640, "answer_id": 49086815, "question_id": 49086499, "link": "https://stackoverflow.com/questions/49086499/golang-post-request-to-api-returns-400-while-the-same-request-with-e-g-postma/49086815#49086815", "title": "Golang POST request to API returns 400, while the same request with e. g. Postman returns 200", "body": "<p>Url-encoded parameters should be provided in body parameter not as query string. So this can be a problem too. Set your paramters in body implementing <code>io.Reader</code>.</p>\n\n<pre><code>func NewRequest(method, url string, body io.Reader) (*Request, error)\n</code></pre>\n\n<p>Set the header Content-Type in your request before sending it using <code>Client.Do</code>.</p>\n\n<pre><code>req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n</code></pre>\n\n<p>Since postman is smart enough to set the headers for you. Thats why no error.\nThe whole code becomes</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"net/url\"\n    \"io/ioutil\"\n    \"strings\"\n)\nfunc main(){\n\n    url := \"https://accounts.zoho.com/apiauthtoken/nb/create\"\n\n    var data url.Values{}\n    data.Set(\"SCOPE\",\"xxxx\")\n    data.Add(\"EMAIL\",\"xxxx\")\n    data.Add(\"PASSWORD\",\"xxxx\")\n    req, err := http.NewRequest(\"POST\", url, strings.NewReader(data.Encode()))\n    req.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\n\n    log.Println(err)\n\n    res, err := client.Do(req)\n    log.Println(err)\n\n    defer res.Body.Close()\n    body, err := ioutil.ReadAll(res.Body)\n    log.Println(err)\n\n    fmt.Println(res)\n    fmt.Println(string(body))\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 3192859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc972bc77938ff52a9c9efe005f9eff9?s=128&d=identicon&r=PG&f=1", "display_name": "PriyankRaj", "link": "https://stackoverflow.com/users/3192859/priyankraj"}, "is_accepted": false, "score": 0, "last_activity_date": 1592016554, "creation_date": 1592016554, "answer_id": 62354963, "question_id": 49086499, "link": "https://stackoverflow.com/questions/49086499/golang-post-request-to-api-returns-400-while-the-same-request-with-e-g-postma/62354963#62354963", "title": "Golang POST request to API returns 400, while the same request with e. g. Postman returns 200", "body": "<p>I was facing the similar issue. The reason for <code>401</code> simply means the invalid authorization token. Later I noticed that Postman executes the <code>Pre-request script</code> that updates the header every time. You can pull in the same pre-request script code in golang and it works. </p>\n"}], "owner": {"reputation": 486, "user_id": 6513167, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/597312657096897/picture?type=large", "display_name": "Martin Niederl", "link": "https://stackoverflow.com/users/6513167/martin-niederl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1349, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1592016554, "creation_date": 1520094799, "last_edit_date": 1520096028, "question_id": 49086499, "link": "https://stackoverflow.com/questions/49086499/golang-post-request-to-api-returns-400-while-the-same-request-with-e-g-postma", "title": "Golang POST request to API returns 400, while the same request with e. g. Postman returns 200", "body": "<p>In my Go application I use a Web API, which accepts a POST request and returns a token if it is successful.</p>\n\n<p>The URL is the following: \"<a href=\"https://accounts.zoho.com/apiauthtoken/nb/create?SCOPE=xxxx&amp;EMAIL_ID=xxxx&amp;PASSWORD=xxxx\" rel=\"nofollow noreferrer\">https://accounts.zoho.com/apiauthtoken/nb/create?SCOPE=xxxx&amp;EMAIL_ID=xxxx&amp;PASSWORD=xxxx</a>\"</p>\n\n<p>If I send this in Postman or any other tool, I get the status code 200 with the expected body, but in my go code the same request returns error code 400.</p>\n\n<pre><code>url := \"https://accounts.zoho.com/apiauthtoken/nb/create?SCOPE=xxxx&amp;EMAIL_ID=xxxx&amp;PASSWORD=xxxx\"\n\nreq, err := http.NewRequest(\"POST\", url, nil)\nlog.Println(err)\n\nres, err := client.Do(req)\nlog.Println(err)\n\ndefer res.Body.Close()\nbody, err := ioutil.ReadAll(res.Body)\nlog.Println(err)\n\nfmt.Println(res)\nfmt.Println(string(body))\n</code></pre>\n\n<p>All errors are nil, but the res struct contains 400 Bad Request and the last output (of the body) is empty.</p>\n\n<h2>Output:</h2>\n\n<pre><code>&amp;{400 Bad Request 400 HTTP/1.1 1 1 map[Date:[Sat, 03 Mar 2018 16:48:35 GMT] Connection:[keep-alive] Set-Cookie:[a8c61fa0dc=5f224f2ab9d067cfce10fd0b7fae48bf; Path=/; Secure; HttpOnly] Server:[ZGS]] 0xc04225a080 -1 [chunked] false false map[] 0xc042034a00 0xc0421bc370}\n</code></pre>\n\n<p>I would appreciate any help, because I don't know where this problem comes from.</p>\n"}, {"tags": ["go", "go-ethereum", "geth"], "answers": [{"tags": [], "owner": {"reputation": 314, "user_id": 4187777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa1fb656a66b067b32d4c41dab8513c5?s=128&d=identicon&r=PG&f=1", "display_name": "chengbin du", "link": "https://stackoverflow.com/users/4187777/chengbin-du"}, "is_accepted": true, "score": 4, "last_activity_date": 1520921994, "creation_date": 1520921994, "answer_id": 49249503, "question_id": 49085737, "link": "https://stackoverflow.com/questions/49085737/geth-ecrecover-invalid-signature-recovery-id/49249503#49249503", "title": "Geth ecrecover invalid signature recovery id", "body": "<p>See: <a href=\"https://github.com/ethereum/go-ethereum/blob/55599ee95d4151a2502465e0afc7c47bd1acba77/internal/ethapi/api.go#L452-L459\" rel=\"nofollow noreferrer\">https://github.com/ethereum/go-ethereum/blob/55599ee95d4151a2502465e0afc7c47bd1acba77/internal/ethapi/api.go#L452-L459</a></p>\n\n<pre><code>// EcRecover returns the address for the account that was used to create the signature.\n// Note, this function is compatible with eth_sign and personal_sign. As such it recovers\n// the address of:\n// hash = keccak256(\"\\x19Ethereum Signed Message:\\n\"${message length}${message})\n// addr = ecrecover(hash, signature)\n//\n// Note, the signature must conform to the secp256k1 curve R, S and V values, where\n// the V value must be be 27 or 28 for legacy reasons.\n//\n// https://github.com/ethereum/go-ethereum/wiki/Management-APIs#personal_ecRecover\nfunc (s *PrivateAccountAPI) EcRecover(ctx context.Context, data, sig hexutil.Bytes) (common.Address, error) {\n    if len(sig) != 65 {\n        return common.Address{}, fmt.Errorf(\"signature must be 65 bytes long\")\n    }\n    if sig[64] != 27 &amp;&amp; sig[64] != 28 {\n        return common.Address{}, fmt.Errorf(\"invalid Ethereum signature (V is not 27 or 28)\")\n    }\n    sig[64] -= 27 // Transform yellow paper V from 27/28 to 0/1\n\n    rpk, err := crypto.Ecrecover(signHash(data), sig)\n    if err != nil {\n        return common.Address{}, err\n    }\n    pubKey := crypto.ToECDSAPub(rpk)\n    recoveredAddr := crypto.PubkeyToAddress(*pubKey)\n    return recoveredAddr, nil\n}\n</code></pre>\n\n<p>Here is my gist: <a href=\"https://gist.github.com/dcb9/385631846097e1f59e3cba3b1d42f3ed#file-eth_sign_verify-go\" rel=\"nofollow noreferrer\">https://gist.github.com/dcb9/385631846097e1f59e3cba3b1d42f3ed#file-eth_sign_verify-go</a></p>\n"}], "owner": {"reputation": 430, "user_id": 1748620, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6c526bc199d6c2cbf42388722cc700f1?s=128&d=identicon&r=PG", "display_name": "Levon Tamrazov", "link": "https://stackoverflow.com/users/1748620/levon-tamrazov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1443, "favorite_count": 1, "accepted_answer_id": 49249503, "answer_count": 1, "score": 5, "last_activity_date": 1520921994, "creation_date": 1520090632, "last_edit_date": 1520104261, "question_id": 49085737, "link": "https://stackoverflow.com/questions/49085737/geth-ecrecover-invalid-signature-recovery-id", "title": "Geth ecrecover invalid signature recovery id", "body": "<p>I'm trying to verify signature passed in from client using the geth golang library. I'm getting the sample data (signature / address) from one of my cryptokitties accounts (I can see it in the request). If I paste the blow credentials into <a href=\"https://etherscan.io/verifySig\" rel=\"nofollow noreferrer\">https://etherscan.io/verifySig</a>, it gets verified, so I know the parameters are correct.</p>\n\n<p>My code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"github.com/ethereum/go-ethereum/common/hexutil\"\n    \"github.com/ethereum/go-ethereum/crypto\"\n)\n\nsig := 0x80f5bac5b6300ed64835d5e2f167a368c892ccc2d0e252bc84befbcb093f5a2d36294b95d86683cec778c8c796049933c04c71576c56c1d6e9a9fa10342beca31c\n\ndata := \"Cryptokitties\"\ndecoded = hexutil.MustDecode(sig) // j8aUTtPid0ZnNa/s4Ef5gisYYh1bCeLSmFrtJtDjNRRqxShUr+1A3BVgoAPwiZ+lKN0POB1JOdVhVHI9tcHmABs=\nhash := crypto.Keccak256([]byte(data)) // \"ljQQTm25oqIbD+LMl70aRUcTzXCeeDGfkRj9YJYsgKY=\"\npubKey, err := crypto.Ecrecover(hash, sig) // error: \"invalid signature recovery id\"\n</code></pre>\n\n<p>I'm sure I'm missing something simple, but not really sure where to look. </p>\n\n<p>**UPDATE</p>\n\n<p>What I tried after looking around some answers: </p>\n\n<ul>\n<li><p>changing the message like this:\n<code>fmt.Sprintf(\"\\u0019Ethereum Signed Message:\\n%d%s\", len(data), data)</code> <code>//\"\\u0019Ethereum Signed Message:\\n13Cryptokitties\"</code></p></li>\n<li><p>hex encoding the message before hashing it:\n<code>data=hexutil.Encode(data)</code></p></li>\n<li><p>combining the above two, so first prepending the 'Ethereum Signed Message', then hexencoding it.</p></li>\n</ul>\n\n<p>Any points would be appreciated, I'm sure this is a noob question.</p>\n\n<p>**UPDATE</p>\n\n<p>Looking through the source code, I discovered its expecting recovery id to be greater than 4:\n<code>sig[64] &gt;= 4</code></p>\n\n<p>In my case it turns out to be 27:\n<code>sig[64] --&gt; 27</code></p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 8946415, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/rG2p3.jpg?s=128&g=1", "display_name": "Arief Muarrief Buhari", "link": "https://stackoverflow.com/users/8946415/arief-muarrief-buhari"}, "edited": false, "score": 0, "creation_date": 1520260382, "post_id": 49086354, "comment_id": 85230483, "body": "Your answers are helpful as expected, thank you @sberry"}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": false, "score": 1, "last_activity_date": 1520094009, "creation_date": 1520094009, "answer_id": 49086354, "question_id": 49085355, "link": "https://stackoverflow.com/questions/49085355/protoc-in-makefile-to-build-protobuf/49086354#49086354", "title": "protoc in makefile to build protobuf", "body": "<p>You'll need to wrap your $GOPATH like this</p>\n\n<pre><code>protoc -I/usr/local/include -I. -I$(GOPATH)/src \\\n       -I$(GOPATH)/src/github.com/grpc-ecosystem/grpc-gateway/third_party/googleapis \\\n       proto/item.proto --go_out=plugins=grpc:.\n</code></pre>\n\n<p><code>\\</code> added to make it easier to read here.  The key is <code>$(GOPATH)</code> vs <code>$GOPATH</code></p>\n\n<p>Here is a demo:</p>\n\n<pre><code>get:\n    echo $(GOPATH)\n    echo $GOPATH\n</code></pre>\n\n<p>and the output</p>\n\n<pre><code>echo /Users/sberry/Development/golang\n/Users/sberry/Development/golang\necho OPATH\nOPATH\n</code></pre>\n\n<p>In an editor that knows Makefile syntax you can see the difference</p>\n\n<p><a href=\"https://i.stack.imgur.com/WNaut.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/WNaut.png\" alt=\"vim view\"></a></p>\n"}], "owner": {"reputation": 55, "user_id": 8946415, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/rG2p3.jpg?s=128&g=1", "display_name": "Arief Muarrief Buhari", "link": "https://stackoverflow.com/users/8946415/arief-muarrief-buhari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2355, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1520094009, "creation_date": 1520088365, "last_edit_date": 1520089317, "question_id": 49085355, "link": "https://stackoverflow.com/questions/49085355/protoc-in-makefile-to-build-protobuf", "title": "protoc in makefile to build protobuf", "body": "<p>I have installed a protocol buffer like the tutorial on <a href=\"https://github.com/google/protobuf/blob/master/src/README.md\" rel=\"nofollow noreferrer\">https://github.com/google/protobuf/blob/master/src/README.md</a></p>\n\n<p>after that I want to build protobuf and install go library with command as follows:</p>\n\n<pre><code>go get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-grpc-gateway\ngo get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-swagger\ngo get -u github.com/golang/protobuf/protoc-gen-go\nmake # generate app and protobuf\n</code></pre>\n\n<p>I have file <code>Makefile</code> on my root like this :</p>\n\n<pre><code>get:\n    echo \"Build Proto\"\n    protoc -I/usr/local/include -I. -I$GOPATH/src -I$GOPATH/src/github.com/grpc-ecosystem/grpc-gateway/third_party/googleapis proto/item.proto --go_out=plugins=grpc:.\n    protoc -I/usr/local/include -I. -I$GOPATH/src -I$GOPATH/src/github.com/grpc-ecosystem/grpc-gateway/third_party/googleapis proto/item.proto --grpc-gateway_out=logtostderr=true:.\n    protoc -I/usr/local/include -I. -I$GOPATH/src -I$GOPATH/src/github.com/grpc-ecosystem/grpc-gateway/third_party/googleapis proto/item.proto --swagger_out=logtostderr=true:.\n    echo \"Build APP\"\n    CGO_ENABLED=0 GOOS=linux go build -o ./server/storeitemservice ./server/cmd/server/main.go\n</code></pre>\n\n<p>but I want to generate app and protobuf in my root of application with the command <code>make</code> to build my app and the result like this:</p>\n\n<pre><code>echo \"Build Proto\"\nBuild Proto\nprotoc -I/usr/local/include -I. -IOPATH/src -IOPATH/src/github.com/grpc-ecosystem/grpc-gateway/third_party/googleapis proto/item.proto --go_out=plugins=grpc:.\nOPATH/src: warning: directory does not exist.\nOPATH/src/github.com/grpc-ecosystem/grpc-gateway/third_party/googleapis: warning: directory does not exist.\ngoogle/api/annotations.proto: File not found.\nproto/item.proto: Import \"google/api/annotations.proto\" was not found or had errors.\nMakefile:2: recipe for target 'get' failed\nmake: *** [get] Error 1\n</code></pre>\n\n<p>after seeing the problem like this I check each of its directory, and it turns out there is all.</p>\n"}, {"tags": ["go", "timezone"], "comments": [{"owner": {"reputation": 2394, "user_id": 2099873, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/321bd06eb43fe4b165b4d21466aa1753?s=128&d=identicon&r=PG", "display_name": "Svip", "link": "https://stackoverflow.com/users/2099873/svip"}, "edited": false, "score": 1, "creation_date": 1520090935, "post_id": 49084928, "comment_id": 85176882, "body": "That&#39;s problematic.  Say I enter &#39;WET&#39;, Western European Time, what then should the result be?  London?  But while the UK, Ireland and Portugal observes daylight savings time, Iceland - which is also in WET - does not.  So if an Icelandic developer uses WET to note time, it resulting in London would be problematic.  And you have the same problem with MST, as most of Arizona does not observe daylight savings time."}, {"owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "reply_to_user": {"reputation": 2394, "user_id": 2099873, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/321bd06eb43fe4b165b4d21466aa1753?s=128&d=identicon&r=PG", "display_name": "Svip", "link": "https://stackoverflow.com/users/2099873/svip"}, "edited": false, "score": 0, "creation_date": 1520092416, "post_id": 49084928, "comment_id": 85177423, "body": "Fair enough. Changes my questions correspondingly. Any further insight?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1520099986, "post_id": 49084928, "comment_id": 85180224, "body": "These timezone abbreviations <a href=\"https://en.m.wikipedia.org/wiki/List_of_time_zone_abbreviations\" rel=\"nofollow noreferrer\">are ambiguous</a>, which is why there is no support for them in the standard library. For instance, IST can mean any of Irish/Indian/Israel Standard Time."}, {"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 0, "creation_date": 1520120560, "post_id": 49084928, "comment_id": 85186361, "body": "this map is in the tree (unshared): <a href=\"https://golang.org/src/time/zoneinfo_abbrs_windows.go\" rel=\"nofollow noreferrer\">golang.org/src/time/zoneinfo_abbrs_windows.go</a>, generated by <a href=\"https://golang.org/src/time/genzabbrs.go\" rel=\"nofollow noreferrer\">golang.org/src/time/genzabbrs.go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11257, "user_id": 10197418, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/be8Y6.jpg?s=128&g=1", "display_name": "MrFuppes", "link": "https://stackoverflow.com/users/10197418/mrfuppes"}, "edited": false, "score": 0, "creation_date": 1615637593, "post_id": 66605411, "comment_id": 117756069, "body": "parsing one correctly while others are parsed (kind of) wrong honestly doesn&#39;t seem very <i><code>go</code></i> to me... related: <a href=\"https://stackoverflow.com/q/66466330/10197418\">stackoverflow.com/q/66466330/10197418</a>"}], "tags": [], "owner": {"reputation": 1973, "user_id": 484050, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/75870a83d2863117631cd690335d473d?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/484050/mike"}, "is_accepted": true, "score": 2, "last_activity_date": 1615573967, "creation_date": 1615573967, "answer_id": 66605411, "question_id": 49084928, "link": "https://stackoverflow.com/questions/49084928/parse-time-zone-into-a-location-struct-in-go/66605411#66605411", "title": "Parse time zone into a Location struct in Go", "body": "<p>There exists a package <a href=\"https://pkg.go.dev/github.com/tkuchiki/go-timezone\" rel=\"nofollow noreferrer\">github.com/tkuchiki/go-timezone</a> that provides mapping between zone abbreviations and locations. See its <a href=\"https://github.com/tkuchiki/go-timezone/blob/master/timezones.go\" rel=\"nofollow noreferrer\">timezones.go</a>.</p>\n<p>However, as commenters also pointed out, abbreviated timezone names are ambiguous and it is better to avoid user input with such names at all. As mentioned in other questions (<a href=\"https://stackoverflow.com/questions/49084316/why-doesnt-gos-time-parse-parse-the-timezone-identifier\">Why doesn&#39;t Go&#39;s time.Parse() parse the timezone identifier?</a> and <a href=\"https://stackoverflow.com/questions/25368415/how-to-properly-parse-timezone-codes\">How to properly parse timezone codes</a>), when parsing time, Go correctly parses abbreviated timezone when it matches local timezone of the machine running code and <code>UTC</code> timezone. All others are not parsed correctly in my experience.</p>\n"}], "owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 482, "favorite_count": 0, "accepted_answer_id": 66605411, "answer_count": 1, "score": 1, "last_activity_date": 1615573967, "creation_date": 1520085560, "last_edit_date": 1520092393, "question_id": 49084928, "link": "https://stackoverflow.com/questions/49084928/parse-time-zone-into-a-location-struct-in-go", "title": "Parse time zone into a Location struct in Go", "body": "<p>Given a time zone such as EDT or CEST is there a way to get a <code>time.Location</code> reference to use it to with <code>func (t Time) In(loc *Location) Time</code>? </p>\n\n<p>It is possible to initialize the location for e.g. CEST with <code>time.LoadLocation(\"Europe/Berlin\")</code> but how to do the same for the actual time zone notation? </p>\n\n<p>Given the very insightful comment by @Svip is there any sensible way to return a list of representative location? That is for <code>WET</code> return e.g. <code>[Europe/London, Atlantik/Reykjav\u00edk]</code>. All other <code>WET</code> locations would follow the same time zone arrangements as one of those two.</p>\n"}, {"tags": ["go", "struct", "interface"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520084423, "post_id": 49084723, "comment_id": 85174770, "body": "If the the <code>*DB</code> type implements the method <code>CreateUserTable() (sql.Result, error)</code> then it implicitly implements the interface and can be used anywhere where that interface is expected."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520084904, "post_id": 49084723, "comment_id": 85174896, "body": "... see here: <a href=\"https://play.golang.org/p/LMI8pcu2gAX\" rel=\"nofollow noreferrer\">play.golang.org/p/LMI8pcu2gAX</a>, you&#39;ll notice that the compiler complains in the second case but not in the first. In Go interfaces are implemented implicitly, that means you don&#39;t need to explicitly state that a type implements an interface, the type just needs to implement the method set of the interface and it can be used in its place automatically."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 1, "creation_date": 1520085667, "post_id": 49084723, "comment_id": 85175113, "body": "That&#39;s the point of interfaces. Concrete values are never values <i>of</i> the interface type, they&#39;re values of some other type that satisfies the interface, and that allows them to be assigned to variables / passed to parameters of the interface type."}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 2, "last_activity_date": 1520114529, "last_edit_date": 1520114529, "creation_date": 1520084676, "answer_id": 49084797, "question_id": 49084723, "link": "https://stackoverflow.com/questions/49084723/golang-parameters-conversion/49084797#49084797", "title": "Golang Parameters conversion", "body": "<p>As per <a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"nofollow noreferrer\">Golang Spec</a></p>\n\n<blockquote>\n  <p>An interface type specifies a method set called its interface. A\n  variable of interface type can store a value of any type with a method\n  set that is any superset of the interface. Such a type is said to\n  implement the interface.</p>\n</blockquote>\n\n<p>This is because interface can be implemented as a wrapper to every type. Interface actually points to two things mainly one is the underlying type which is a struct here and other one is the value of that type which is a pointer to DB</p>\n\n<p>You see <code>newFunc</code> is actually taking <code>interface{}</code> as an argument, So you can pass anything to it of type <code>T</code> which can be of primitive types too.</p>\n\n<pre><code>func main() {\n    db := model.InitDB()\n\n    newFunc(db)\n}\n</code></pre>\n\n<p>So In case you want to get the underlying value you need to type assert. Interface works like a wrapper to the struct here and save its type and value which can be get using type assertion.</p>\n"}], "owner": {"reputation": 233, "user_id": 7893198, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/91639ade70c5fc21ded9450808e3c97c?s=128&d=identicon&r=PG&f=1", "display_name": "blue panther", "link": "https://stackoverflow.com/users/7893198/blue-panther"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 49084797, "answer_count": 1, "score": 1, "last_activity_date": 1531404075, "creation_date": 1520084172, "last_edit_date": 1531404075, "question_id": 49084723, "link": "https://stackoverflow.com/questions/49084723/golang-parameters-conversion", "title": "Golang Parameters conversion", "body": "<p>Can somebody explain how can this happened?</p>\n\n<p>I put <code>interface</code> as parameter in a function. While invoking this function I pass <code>struct</code> into it, but it didn't give me error. Here's the code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/myusername/gomodel/domain\"\n    \"github.com/myusername/gomodel/model\"\n)\n\nfunc main() {\n    db := model.InitDB()\n\n    newFunc(db)\n}\n\n\nfunc newFunc(db domain.IUser) {\n\n    r, err := db.CreateUserTable()\n    if err != nil {\n        fmt.Println(\"error\", err)\n    }\n    fmt.Println(r)\n}\n</code></pre>\n\n<p>I've implemented the interface somewhere else in the code, because the program just work as the implemented interface expected to be.\n<code>IUser</code> is an interface whose member is:</p>\n\n<pre><code>type IUser interface {\n    CreateUserTable() (sql.Result, error)\n}\n</code></pre>\n\n<p><code>InitDB</code> is a function to open the database and return struct of database:</p>\n\n<pre><code>type DB struct {\n    *sql.DB\n}\n\n//InitDB initializes the database\nfunc InitDB() *DB {\n    db, err := sql.Open(dbDriver, dbName)\n    if err != nil {\n        log.Fatal(\"failed to initialize database: \",err)\n    }\n    err2 := db.Ping()\n    if err2 != nil {\n        log.Fatal(err2)\n    }\n\n    return &amp;DB{db}\n}\n</code></pre>\n\n<p>My question is: how can a function with a parameter type interface be passed a different type of parameter? And how is this working under the hood?</p>\n"}, {"tags": ["go", "networking", "server", "udp", "client"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1520084470, "post_id": 49084609, "comment_id": 85174778, "body": "The client is trying to bind to the wrong address."}, {"owner": {"reputation": 41, "user_id": 5796119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e684e8a68c8f7678dae3a7fe5cbdb5b1?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/5796119/daniel"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520087523, "post_id": 49084609, "comment_id": 85175731, "body": "Thanks for the reply @JimB - what address is the correct one? I thought I listen at the server&#39;s ip address"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1520108709, "post_id": 49084609, "comment_id": 85183180, "body": "Your client is trying to listen, as if it were the server."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1520117733, "post_id": 49084609, "comment_id": 85185673, "body": "@MichaelHampton, there is no client or server in UDP, and you normally bind UDP using Listen regardless, as Dial creates a \u201cconnected\u201d UDP socket that has slightly different behavior."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 5796119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e684e8a68c8f7678dae3a7fe5cbdb5b1?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/5796119/daniel"}, "edited": false, "score": 0, "creation_date": 1521149080, "post_id": 49086206, "comment_id": 85621036, "body": "I should clarify that you could also to listen on a socket on both endpoints like in <a href=\"https://stackoverflow.com/questions/30563473/golang-udp-server-only-recieving-locally-sent-packets\">this answer</a> and <a href=\"https://stackoverflow.com/questions/26028700/write-to-client-udp-socket-in-go\">this one</a>."}], "tags": [], "owner": {"reputation": 41, "user_id": 5796119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e684e8a68c8f7678dae3a7fe5cbdb5b1?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/5796119/daniel"}, "is_accepted": true, "score": 1, "last_activity_date": 1520094801, "last_edit_date": 1520094801, "creation_date": 1520093152, "answer_id": 49086206, "question_id": 49084609, "link": "https://stackoverflow.com/questions/49084609/bind-cannot-assign-requested-address-on-udpclient-in-local-network/49086206#49086206", "title": "bind: cannot assign requested address on UDPclient in local network", "body": "<p>Okay, I figured it out. Weird that I had to allow the app to communicate on public networks? While I am on my home network. <a href=\"https://i.stack.imgur.com/Zlo4B.png\" rel=\"nofollow noreferrer\">When starting the server - I had to enable public networks</a></p>\n\n<p>I figured out that I do not have to open a socket on the client side, but use <code>DialUDP</code></p>\n\n<p>Also the server needed the full Ip address in<br>\n<code>ServerAddr,err := net.ResolveUDPAddr(\"udp\",\"192.168.11.6:10001\")</code></p>\n\n<p>Improved Client code: (main func)</p>\n\n<pre><code>ServerAddr, err := net.ResolveUDPAddr(\"udp\", \"192.168.11.6:10001\")\nCheckError(err)\nbuf := make([]byte, 1024)\nConn, err := net.DialUDP(\"udp\", nil, ServerAddr)\nCheckError(err)\n\ndefer Conn.Close()\ni := 0\nfor {\n    msg := strconv.Itoa(i)\n    i++\n    fmt.Printf(msg)\n    n, err := Conn.Write([]byte(msg))\n    CheckError(err)\n    fmt.Printf(\"sent %d bytes\", n)\n    n, addr, err := Conn.ReadFromUDP(buf)\n    if err == nil {\n        fmt.Printf(\"%s %s\\n\", buf, addr)\n    } else {\n        fmt.Printf(\"some err %v\\n\", err)\n    }\n    time.Sleep(time.Second * 1)\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 5796119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e684e8a68c8f7678dae3a7fe5cbdb5b1?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/5796119/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2164, "favorite_count": 0, "accepted_answer_id": 49086206, "answer_count": 1, "score": 1, "last_activity_date": 1575381567, "creation_date": 1520083404, "last_edit_date": 1520083683, "question_id": 49084609, "link": "https://stackoverflow.com/questions/49084609/bind-cannot-assign-requested-address-on-udpclient-in-local-network", "title": "bind: cannot assign requested address on UDPclient in local network", "body": "<p>As I'm finding quite some examples how to write a go server and client, this works locally on one machine.</p>\n\n<p>Now I'm trying to communicate in my local network between two PCs, one running the go server script, one the client.</p>\n\n<p>However, I can't establish a connection because of the error:</p>\n\n<blockquote>\n  <p>Error:  listen udp 192.168.11.6:10001: bind: cannot assign requested address<br>\n  panic: runtime error: invalid memory address or nil pointer dereference\n  [signal 0xb code=0x1 addr=0x0 pc=0x401376] // ...</p>\n</blockquote>\n\n<p>Of course I will post my code (client, where the problem occurs):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"strconv\"\n    \"time\"\n)\n\nfunc CheckError(err error) {\n    if err != nil {\n        fmt.Println(\"Error: \", err)\n    }\n}\n\nfunc main() {\n    ServerAddr, err := net.ResolveUDPAddr(\"udp\", \"192.168.11.6:10001\")\n    CheckError(err)\n\n    Conn, err := net.ListenUDP(\"udp\", ServerAddr)\n    CheckError(err)\n\n    defer Conn.Close()\n    i := 0\n    for {\n        msg := strconv.Itoa(i)\n        i++\n        buf := []byte(msg)\n        _, err = Conn.WriteToUDP(buf, ServerAddr)\n        time.Sleep(time.Second * 1)\n    }\n}\n</code></pre>\n\n<p>Server:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"net\"\n    \"os\"\n)\n\n/* A Simple function to verify error */\nfunc CheckError(err error) {\n    if err  != nil {\n        fmt.Println(\"Error: \" , err)\n        os.Exit(0)\n    }\n}\n\nfunc main() {\n    ServerAddr,err := net.ResolveUDPAddr(\"udp\",\":10001\")\n    CheckError(err)\n\n    ServerConn, err := net.ListenUDP(\"udp\", ServerAddr)\n    CheckError(err)\n    defer ServerConn.Close()\n\n    buf := make([]byte, 1024)\n    for {\n        fmt.Println(\"Starting...\")\n        n,addr,err := ServerConn.ReadFromUDP(buf)\n        fmt.Println(\"Received \",string(buf[0:n]), \" from \",addr)\n        ServerConn.WriteToUDP([]byte(\"hello there!\"), addr)\n        if err != nil {\n            fmt.Println(\"Error: \",err)\n        }\n    }\n}\n</code></pre>\n\n<p>The client has the local network IP address 192.168.11.8 and the server 192.168.11.6. They can also ping each other, and I'm opening the port when Windows asks for it.</p>\n\n<p>I'm happy about all suggestions. I struggle with this because I only find localhost server client go examples.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "edited": false, "score": 0, "creation_date": 1520082370, "post_id": 49084316, "comment_id": 85174159, "body": "It looks like the godoc for the Parse function answers your question or am I missing something: ... &quot;If the zone abbreviation is unknown, Parse records the time as being in a fabricated location with the given zone abbreviation and a zero offset. This choice means that such a time can be parsed and reformatted with the same layout losslessly, but the exact instant used in the representation will differ by the actual zone offset. To avoid such problems, prefer time layouts that use a numeric zone offset, or use ParseInLocation.&quot;"}, {"owner": {"reputation": 2394, "user_id": 2099873, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/321bd06eb43fe4b165b4d21466aa1753?s=128&d=identicon&r=PG", "display_name": "Svip", "link": "https://stackoverflow.com/users/2099873/svip"}, "reply_to_user": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "edited": false, "score": 0, "creation_date": 1520082667, "post_id": 49084316, "comment_id": 85174240, "body": "But why would &#39;EDT&#39; be unknown?  A lot of their examples uses &#39;CEST&#39;, so I tried the reverse, but it&#39;s the same problem.  &#39;CEST&#39; gets parsed (without <code>ParseInLocation()</code>) to +0000 (not +0200)."}, {"owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "edited": false, "score": 0, "creation_date": 1520083133, "post_id": 49084316, "comment_id": 85174368, "body": "Your example above worked for me with CEST producing <code>2018-08-25 12:00:00 +0200 CEST</code> for plain <code>Parse</code> with CEST in the date string. I really have no idea why EDT would be unknown, but then my own timezone is CET/CEST so I hope that one is known to the parser :)"}, {"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 0, "creation_date": 1520084028, "post_id": 49084316, "comment_id": 85174648, "body": "Interesting problem. See <a href=\"https://golang.org/src/time/format.go#764\" rel=\"nofollow noreferrer\">golang.org/src/time/format.go#764</a>  &quot;When parsing a time with a zone abbreviation like MST, if the zone abbreviation has a defined offset in the current location, then that offset is used....&quot;"}, {"owner": {"reputation": 2394, "user_id": 2099873, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/321bd06eb43fe4b165b4d21466aa1753?s=128&d=identicon&r=PG", "display_name": "Svip", "link": "https://stackoverflow.com/users/2099873/svip"}, "edited": false, "score": 0, "creation_date": 1520090489, "post_id": 49084316, "comment_id": 85176747, "body": "OK, I only tested the &#39;CEST&#39; change on the Playground.  On my own system, it works as expected.  So the Playground has no timezones, basically."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1520108307, "post_id": 49084316, "comment_id": 85183053, "body": "TImezone specifications like &quot;EDT&quot; are ambiguous. I can think of at least three different places on the planet that that might refer to, all of which have different timezones/daylight saving rules."}, {"owner": {"reputation": 2394, "user_id": 2099873, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/321bd06eb43fe4b165b4d21466aa1753?s=128&d=identicon&r=PG", "display_name": "Svip", "link": "https://stackoverflow.com/users/2099873/svip"}, "edited": false, "score": 0, "creation_date": 1520117337, "post_id": 49084316, "comment_id": 85185586, "body": "EST/EDT would be daylight savings agnostic.  They are just names for specific offsets to UTC.  GMT, UTC and WET are all the same.  If EDT always means -0400, then it doesn&#39;t matter what locations on the planet it refers to.  If you can name a timezone called EDT that&#39;s not -0400, then I&#39;ll grant you that.  But as far as I know, timezone abbreviations don&#39;t tend to overlap (I could be wrong)."}], "answers": [{"comments": [{"owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "edited": false, "score": 0, "creation_date": 1520085590, "post_id": 49084700, "comment_id": 85175090, "body": "The follow up is here <a href=\"https://stackoverflow.com/questions/49084928/parse-time-zone-into-a-location-struct-in-go\" title=\"parse time zone into a location struct in go\">stackoverflow.com/questions/49084928/&hellip;</a>"}, {"owner": {"reputation": 2394, "user_id": 2099873, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/321bd06eb43fe4b165b4d21466aa1753?s=128&d=identicon&r=PG", "display_name": "Svip", "link": "https://stackoverflow.com/users/2099873/svip"}, "edited": false, "score": 0, "creation_date": 1520090565, "post_id": 49084700, "comment_id": 85176766, "body": "So the time zone identifier in the parse format is basically useless?  Either you need to have all timezones installed (how do you do that in Fedora?  Or any other Linux distribution?), or manually maintain a list.  Then one should just use location instead, even if that isn&#39;t exactly the same."}, {"owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "reply_to_user": {"reputation": 2394, "user_id": 2099873, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/321bd06eb43fe4b165b4d21466aa1753?s=128&d=identicon&r=PG", "display_name": "Svip", "link": "https://stackoverflow.com/users/2099873/svip"}, "edited": false, "score": 0, "creation_date": 1520092760, "post_id": 49084700, "comment_id": 85177546, "body": "My OSX has all the timezones installed, but they are not used in Go beyond the current location or so it looks. The reason might well be the ambiguity which you pointed out to in comment to my follow up. In which case I would say, they should have dropped any timezone support from Parse or do it comprehensively where a 1:1 match exists, otherwise return an error."}], "tags": [], "owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "is_accepted": false, "score": 2, "last_activity_date": 1520084009, "creation_date": 1520084009, "answer_id": 49084700, "question_id": 49084316, "link": "https://stackoverflow.com/questions/49084316/why-doesnt-gos-time-parse-parse-the-timezone-identifier/49084700#49084700", "title": "Why doesn&#39;t Go&#39;s time.Parse() parse the timezone identifier?", "body": "<p>A simple debug run shows that it all comes down to this function <code>go/1.10/libexec/src/time/zoneinfo.go:226</code></p>\n\n<pre><code>func (l *Location) lookupName(name string, unix int64) (offset int, ok bool) {\n    l = l.get()\n\n    // First try for a zone with the right name that was actually\n    // in effect at the given time. (In Sydney, Australia, both standard\n    // and daylight-savings time are abbreviated \"EST\". Using the\n    // offset helps us pick the right one for the given time.\n    // It's not perfect: during the backward transition we might pick\n    // either one.)\n    for i := range l.zone {\n        zone := &amp;l.zone[i]\n        if zone.name == name {\n            nam, offset, _, _, _ := l.lookup(unix - int64(zone.offset))\n            if nam == zone.name {\n                return offset, true\n            }\n        }\n    }\n\n    // Otherwise fall back to an ordinary name match.\n    for i := range l.zone {\n        zone := &amp;l.zone[i]\n        if zone.name == name {\n            return zone.offset, true\n        }\n    }\n\n    // Otherwise, give up.\n    return\n}\n</code></pre>\n\n<p>On my OSX (I am in Zurich, so <code>CET</code> as of now) the call to <code>l.get()</code> returns on object containing 4 values in the zone slice being <code>CET</code>, <code>CEST</code>, <code>CET</code> and <code>CEST</code> again. On top of that <code>GMT</code> and <code>UTC</code> are treated specially beforehand. All other zones are \"unknown\" to me, including EDT. </p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 2, "last_activity_date": 1610811075, "creation_date": 1610811075, "answer_id": 65751309, "question_id": 49084316, "link": "https://stackoverflow.com/questions/49084316/why-doesnt-gos-time-parse-parse-the-timezone-identifier/65751309#65751309", "title": "Why doesn&#39;t Go&#39;s time.Parse() parse the timezone identifier?", "body": "<p>Quoting from <a href=\"//golang.org/pkg/time#Parse\" rel=\"nofollow noreferrer\">time#Parse</a>:</p>\n<blockquote>\n<p>When parsing a time with a zone abbreviation like <code>MST</code>, if the zone\nabbreviation has a defined offset in the current location, then that offset\nis used.</p>\n</blockquote>\n<p>The key here is &quot;current location&quot;. For me, that is <code>CST</code>. Using this works as\nexpected:</p>\n<pre><code>package main\n\nimport (\n   &quot;log&quot;\n   &quot;time&quot;\n)\n\nfunc main() {\n   t, e := time.Parse(time.RFC1123, &quot;Wed, 01 Aug 2018 12:00:00 CST&quot;)\n   if e != nil {\n      log.Fatal(e)\n   }\n   s := t.String()\n   println(s == &quot;2018-08-01 13:00:00 -0500 CDT&quot;)\n}\n</code></pre>\n<blockquote>\n<p>If the zone abbreviation is unknown, Parse records the time as being in a\nfabricated location with the given zone abbreviation and a zero offset.</p>\n</blockquote>\n<pre><code>package main\n\nimport (\n   &quot;log&quot;\n   &quot;time&quot;\n)\n\nfunc main() {\n   t, e := time.Parse(time.RFC1123, &quot;Wed, 01 Aug 2018 12:00:00 EDT&quot;)\n   if e != nil {\n      log.Fatal(e)\n   }\n   s := t.String()\n   println(s == &quot;2018-08-01 12:00:00 +0000 EDT&quot;)\n}\n</code></pre>\n<blockquote>\n<p>To avoid such problems, prefer time layouts that use a numeric zone offset,\nor use ParseInLocation.</p>\n</blockquote>\n<pre><code>package main\n\nimport (\n   &quot;log&quot;\n   &quot;time&quot;\n)\n\nfunc check(e error) {\n   if e != nil {\n      log.Fatal(e)\n   }\n}\n\nfunc main() {\n   // example 1\n   t1, e := time.Parse(time.RFC1123Z, &quot;Wed, 01 Aug 2018 12:00:00 -0400&quot;)\n   check(e)\n   s1 := t1.String()\n   // example 2\n   loc, e := time.LoadLocation(&quot;America/New_York&quot;)\n   check(e)\n   t2, e := time.ParseInLocation(time.RFC1123, &quot;Wed, 01 Aug 2018 12:00:00 EDT&quot;, loc)\n   check(e)\n   s2 := t2.String()\n   // print\n   println(s1 == &quot;2018-08-01 12:00:00 -0400 -0400&quot;, s2 == &quot;2018-08-01 12:00:00 -0400 EDT&quot;)\n}\n</code></pre>\n"}], "owner": {"reputation": 2394, "user_id": 2099873, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/321bd06eb43fe4b165b4d21466aa1753?s=128&d=identicon&r=PG", "display_name": "Svip", "link": "https://stackoverflow.com/users/2099873/svip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2378, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1610811075, "creation_date": 1520081574, "question_id": 49084316, "link": "https://stackoverflow.com/questions/49084316/why-doesnt-gos-time-parse-parse-the-timezone-identifier", "title": "Why doesn&#39;t Go&#39;s time.Parse() parse the timezone identifier?", "body": "<p>Consider the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n    \"fmt\"\n)\n\nconst (\n    format = \"2006 01 02 15:04 MST\"\n\n    date = \"2018 08 01 12:00 EDT\"\n)\n\nfunc main() {\n    aloc, _ := time.LoadLocation(\"America/New_York\")\n    eloc, _ := time.LoadLocation(\"Europe/Berlin\")\n    tn, _ := time.Parse(format, date)\n    tl, _ := time.ParseInLocation(format, date, aloc)\n\n    fmt.Println(tn) // Says +0000 despite EDT being -0400\n    fmt.Println(tn.In(eloc)) // Expect 18:00, but get 14:00\n    fmt.Println(tl) // Correctly -0400\n    fmt.Println(tl.In(eloc)) // Correctly 18:00\n}\n</code></pre>\n\n<p>You can also try it out on <a href=\"https://play.golang.org/p/8ppyAssl8qv\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>When I run it, I get this result (both on my own system and through the Playground):</p>\n\n<pre><code>2018-08-01 12:00:00 +0000 EDT\n2018-08-01 14:00:00 +0200 CEST\n2018-08-01 12:00:00 -0400 EDT\n2018-08-01 18:00:00 +0200 CEST\n</code></pre>\n\n<p>I had expected the first and third line to be the same, and the second and fourth to be the same.</p>\n\n<p>It seems to me that Go's time library doesn't parse the \"EDT\" timezone identifier I've written in the date string, despite it being part of the format.</p>\n\n<p>My own system (Fedora 26) also recognises EST/EDT as a timezone:</p>\n\n<pre><code>$ TZ='America/New_York' date 080112002018\nWed  1 Aug 12:00:00 EDT 2018\n</code></pre>\n\n<p>Of course, as you can see, I can force the issue by using <code>ParseInLocation()</code>, but that's only useful if I know the timezone <em>beforehand</em>.  Otherwise I need to parse the 'EDT' part of the date string into 'America/New_York' myself.</p>\n\n<p>Or am I missing something?</p>\n"}, {"tags": ["mysql", "go", "mariadb"], "comments": [{"owner": {"reputation": 21378, "user_id": 3118209, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/3tgaf.jpg?s=128&g=1", "display_name": "Arpit Aggarwal", "link": "https://stackoverflow.com/users/3118209/arpit-aggarwal"}, "edited": false, "score": 0, "creation_date": 1520076170, "post_id": 49083528, "comment_id": 85172292, "body": "can you show us the error trace?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1520077289, "post_id": 49083528, "comment_id": 85172628, "body": "Not possible, you cannot parameterize table names, nor column names, placeholders are for values not tables, columns, etc. To do what you want do this: <code>db.Prepare(&quot;INSERT INTO &quot;+tableName+&quot; VALUES ()&quot;)</code> and make sure to sanitize the tableName value if it&#39;s user input."}, {"owner": {"reputation": 143, "user_id": 2855831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29dec7ccaaff52ec670d33a5861bec15?s=128&d=identicon&r=PG&f=1", "display_name": "thisischuck", "link": "https://stackoverflow.com/users/2855831/thisischuck"}, "edited": false, "score": 0, "creation_date": 1520083591, "post_id": 49083528, "comment_id": 85174514, "body": "Ensure that you are supplying a full table name that exists.  Mysql and I&#39;m pretty sure Maria require specification of the database and table if their are multiple on the server."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520102889, "post_id": 49083528, "comment_id": 85181270, "body": "To expand on @mkopriva&#39;s comment, there is currently no standard way to quote/escape/sanitize an identifier (but <a href=\"https://github.com/golang/go/issues/18478\" rel=\"nofollow noreferrer\">discussions have been underway</a> for awhile) so you&#39;ll have to consult the MySQL/MariaDB documentation to write your own quoting function if you can&#39;t trust <code>tableName</code> to be safe already."}], "owner": {"reputation": 1, "user_id": 7149706, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e178c528eac53ab87f41e3570a9581?s=128&d=identicon&r=PG&f=1", "display_name": "Rapha&#235;l Balet", "link": "https://stackoverflow.com/users/7149706/rapha%c3%abl-balet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "closed_date": 1520103629, "answer_count": 0, "score": 0, "last_activity_date": 1520081037, "creation_date": 1520075692, "last_edit_date": 1520081037, "question_id": 49083528, "link": "https://stackoverflow.com/questions/49083528/db-prepareinsert-into-values-not-working", "closed_reason": "Duplicate", "title": "db.Prepare(&quot;INSERT INTO ? VALUES ()&quot;) not working", "body": "<p>I'm wondering if there was any possibility to use this function:</p>\n\n<pre><code>stmt, err := db.Prepare(\"INSERT INTO ? VALUES ()\", tableName)\n\nfatal(err)\n</code></pre>\n\n<p>What I try to do is: Getting a table name and trying, with go, to create a new element in the database with default option. (database = MySQL)</p>\n\n<p>If you have any idea about why it isn't working or how I can do that I would be really greatfull</p>\n"}, {"tags": ["go", "sqlx"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1520081229, "post_id": 49082834, "comment_id": 85173825, "body": "You have two entirely unrelated questions here: 1. is about map ordering in Go. 2. is about formatting complex data structures when printing. This should be asked as two questions. And incidentally, neither actually has anything at all to do with sqlx."}], "answers": [{"comments": [{"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1520071750, "post_id": 49082898, "comment_id": 85171198, "body": "Better, but replaced with &quot;map&quot;. map[SIGN_ID:JD SIGN_NAME:John Doe] and the double quotes disappeared."}, {"owner": {"reputation": 4293, "user_id": 4069913, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100007329305829/picture?type=large", "display_name": "Orest Savchak", "link": "https://stackoverflow.com/users/4069913/orest-savchak"}, "reply_to_user": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 2, "creation_date": 1520071973, "post_id": 49082898, "comment_id": 85171245, "body": "I think the most appropriate solution for you would be to iterate over the map by yourself and print it in any format is suites for you."}], "tags": [], "owner": {"reputation": 4293, "user_id": 4069913, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100007329305829/picture?type=large", "display_name": "Orest Savchak", "link": "https://stackoverflow.com/users/4069913/orest-savchak"}, "is_accepted": false, "score": 1, "last_activity_date": 1520070949, "creation_date": 1520070949, "answer_id": 49082898, "question_id": 49082834, "link": "https://stackoverflow.com/questions/49082834/random-reverse-output-sqlx-on-golang/49082898#49082898", "title": "Random reverse output sqlx on Golang", "body": "<ol>\n<li><a href=\"https://github.com/golang/go/issues/21095\" rel=\"nofollow noreferrer\">It is known behaviour</a>. Keys are randomly ordered in golang map.</li>\n<li>Use <code>fmt.Printf(\"%v\\n\", results)</code></li>\n</ol>\n"}], "owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1520070949, "creation_date": 1520070428, "question_id": 49082834, "link": "https://stackoverflow.com/questions/49082834/random-reverse-output-sqlx-on-golang", "title": "Random reverse output sqlx on Golang", "body": "<p>Using sqlx in Golang with this code:</p>\n\n<pre><code>rows, err := db.Queryx(`SELECT \"SIGN_ID\",\"SIGN_NAME\" FROM sign`)\n for rows.Next() {\n    results := make(map[string]interface{})\n    err = rows.MapScan(results) \n    fmt.Printf(\"%#v\\n\", results)\n}\n</code></pre>\n\n<p>The result looks really promising:</p>\n\n<pre><code>map[string]interface {}{\"SIGN_ID\":\"JD\", \"SIGN_NAME\":\"John Doe\"}\nmap[string]interface {}{\"SIGN_ID\":\"JAD\", \"SIGN_NAME\":\"Jane Doe\"}\nmap[string]interface {}{\"SIGN_ID\":\"DD\", \"SIGN_NAME\":\"Donald Duck\"}\nmap[string]interface {}{\"SIGN_NAME\":\"Chris Walker\", \"SIGN_ID\":\"CW\"} &lt;----\nmap[string]interface {}{\"SIGN_ID\":\"SN\", \"SIGN_NAME\":\"St Nicolas\"}\n</code></pre>\n\n<p>Two questions:</p>\n\n<ol>\n<li>Why does one line random \"reverse\" the output order &lt;----:</li>\n</ol>\n\n<blockquote>\n  <p>map[string]interface {}{\"SIGN_NAME\":\"Chris Walker\", \"SIGN_ID\":\"CW\"}</p>\n</blockquote>\n\n<ol start=\"2\">\n<li>How can I get rid of the prefix: <strong>map[string]interface {}</strong></li>\n</ol>\n"}, {"tags": ["ubuntu", "docker", "go"], "answers": [{"comments": [{"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "edited": false, "score": 0, "creation_date": 1520045218, "post_id": 49080110, "comment_id": 85166056, "body": "No, the result was the same :S"}, {"owner": {"reputation": 376, "user_id": 4878645, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "MB11", "link": "https://stackoverflow.com/users/4878645/mb11"}, "reply_to_user": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "edited": false, "score": 0, "creation_date": 1520045434, "post_id": 49080110, "comment_id": 85166086, "body": "Can you please also add complete path to Entrypoint along with chmod. Relative path might be conflicting. ENTRYPOINT [&quot;/myapp&quot;]"}], "tags": [], "owner": {"reputation": 376, "user_id": 4878645, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "MB11", "link": "https://stackoverflow.com/users/4878645/mb11"}, "is_accepted": false, "score": -1, "last_activity_date": 1520045057, "creation_date": 1520045057, "answer_id": 49080110, "question_id": 49079981, "link": "https://stackoverflow.com/questions/49079981/golang-app-in-docker-exec-user-process-caused-no-such-file-or-directory/49080110#49080110", "title": "Golang app in Docker exec user process caused &quot;no such file or directory&quot;", "body": "<p>Inside the container /myfile doesn't have the permission for execution. You have to do a chmod +x /myfile inside the dockerfile. Just add following statement before ENTRYPOINT line.</p>\n\n<blockquote>\n  <p>RUN chmod +x /myfile</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1520066094, "post_id": 49080564, "comment_id": 85169811, "body": "Do note that this produces a <i>much</i> bigger image than if you add a statically compiled binary to a small (if not empty) base image."}, {"owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1520066564, "post_id": 49080564, "comment_id": 85169912, "body": "@PeterYes you&#39;re right but disk space is cheapest resource in the server , this method makes deployment and further changes easier on the run. you can fetch latest changes from git and rebuild the image instead of uploading a huge binary in every change."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1520073780, "post_id": 49080564, "comment_id": 85171688, "body": "It&#39;s not about disk space, it&#39;s about network traffic in my experience. Launching a 15MB image with one or two layers is orders of magnitude faster than a 300MB image with tens of layers."}, {"owner": {"reputation": 3851, "user_id": 6266540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0455a60b54cc79b3f8935832f4ca76c?s=128&d=identicon&r=PG&f=1", "display_name": "Fabian", "link": "https://stackoverflow.com/users/6266540/fabian"}, "edited": false, "score": 2, "creation_date": 1550172645, "post_id": 49080564, "comment_id": 96182580, "body": "Just use a multi-stage Dockerfile. You can push the last image."}], "tags": [], "owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "is_accepted": false, "score": 1, "last_activity_date": 1520050417, "creation_date": 1520050417, "answer_id": 49080564, "question_id": 49079981, "link": "https://stackoverflow.com/questions/49079981/golang-app-in-docker-exec-user-process-caused-no-such-file-or-directory/49080564#49080564", "title": "Golang app in Docker exec user process caused &quot;no such file or directory&quot;", "body": "<p>You have to build the binary inside docker not in your machine.  </p>\n\n<pre><code>FROM golang\n\nADD ./ /go/src/app\n\nWORKDIR /go/src/app\n\nRUN go get ./\n\nRUN go build\n\nCMD app\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7266, "user_id": 363448, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1252402b941681ed179ed997878571f3?s=128&d=identicon&r=PG", "display_name": "ndequeker", "link": "https://stackoverflow.com/users/363448/ndequeker"}, "edited": false, "score": 3, "creation_date": 1552665917, "post_id": 49080664, "comment_id": 97111047, "body": "I was running a go binary in an <code>alpine:latest</code> container, while the binary was built inside a <code>golang:1.11</code> container. Switching the base image for the building container into <code>golang:1.11-alpine</code> fixed this issue for me."}], "tags": [], "owner": {"reputation": 2094, "user_id": 38250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/516cbe06af26a1307128f55a9bfe69c3?s=128&d=identicon&r=PG", "display_name": "Enrico Stahn", "link": "https://stackoverflow.com/users/38250/enrico-stahn"}, "is_accepted": false, "score": 23, "last_activity_date": 1520051514, "creation_date": 1520051514, "answer_id": 49080664, "question_id": 49079981, "link": "https://stackoverflow.com/questions/49079981/golang-app-in-docker-exec-user-process-caused-no-such-file-or-directory/49080664#49080664", "title": "Golang app in Docker exec user process caused &quot;no such file or directory&quot;", "body": "<p>You most likely either:</p>\n\n<ul>\n<li>use the binary for the wrong platform</li>\n<li>the binary is not statically linked (has not all the necessary libraries)</li>\n</ul>\n\n<p>You can use <code>CGO_ENABLED=0</code> to build your binary statically.</p>\n"}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7265, "favorite_count": 2, "answer_count": 3, "score": 8, "last_activity_date": 1520051514, "creation_date": 1520043294, "last_edit_date": 1520044754, "question_id": 49079981, "link": "https://stackoverflow.com/questions/49079981/golang-app-in-docker-exec-user-process-caused-no-such-file-or-directory", "title": "Golang app in Docker exec user process caused &quot;no such file or directory&quot;", "body": "<p>I am trying to create the docker image of an app that was developed in Go. I have the binary called myapp, and if I execute it then it work correctly, I execute it with:</p>\n\n<pre><code>./myapp\n</code></pre>\n\n<p>Then, take that bin and put it alone in a directory called <code>mydirectory</code> and inside I put this dockerfile:</p>\n\n<pre><code># iron/go is the alpine image with only ca-certificates added\nFROM iron/go\n\nWORKDIR /\n\n# Now just add the binary\nADD myapp /\n\nENTRYPOINT [\"./myapp\"]\n</code></pre>\n\n<p>and then I create the docker image by typing:</p>\n\n<pre><code>docker build -t myDockerHubUser/myapp .\n</code></pre>\n\n<p>Then, when I run the image I get this message:</p>\n\n<pre><code>standard_init_linux.go:185: exec user process caused \"no such file or directory\"\n</code></pre>\n\n<p>What does it mean? I found some post related with the same message but the thing is that my bnary is executed correctly without any problems</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda"], "answers": [{"comments": [{"owner": {"reputation": 2095, "user_id": 5036757, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/eff2e3c2a959ba3ff23f199e14022b68?s=128&d=identicon&r=PG&f=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/5036757/justin"}, "edited": false, "score": 1, "creation_date": 1520089839, "post_id": 49080184, "comment_id": 85176549, "body": "Thank you! This fixed it! In the lambda settings I did not notice that it had a field called &quot;handler&quot; which was set to the name of my lambda function (&quot;github-activity&quot;). Changing the handler to &quot;main&quot; fixed the issue."}], "tags": [], "owner": {"reputation": 1422, "user_id": 2599618, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/98d6dc9ddad2799f31651ad9807cee24?s=128&d=identicon&r=PG", "display_name": "mewa", "link": "https://stackoverflow.com/users/2599618/mewa"}, "is_accepted": true, "score": 15, "last_activity_date": 1520045892, "creation_date": 1520045892, "answer_id": 49080184, "question_id": 49079579, "link": "https://stackoverflow.com/questions/49079579/unable-to-deploy-lambda-function-written-in-go/49080184#49080184", "title": "Unable to deploy lambda function written in Go", "body": "<p>Handler for a Go Lambda is the <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/lambda-go-how-to-create-deployment-package.html\" rel=\"noreferrer\">path to executable</a>.</p>\n\n<p>Since you're uploading a zip file of the following structure</p>\n\n<pre><code>main.zip\n|\n`-- main  &lt;-- executable\n</code></pre>\n\n<p>your handler name has to be <code>main</code>.</p>\n\n<p>If you packed your lambda in the following way, your handler would then be</p>\n\n<pre><code>main.zip\n|\n`-- subdir\n      |\n      `-- executableInASubdirPackedIntoAZip  &lt;-- executable\n</code></pre>\n\n<p>your handler would then be <code>subdir/executableInASubdirPackedIntoAZip</code>.</p>\n"}], "owner": {"reputation": 2095, "user_id": 5036757, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/eff2e3c2a959ba3ff23f199e14022b68?s=128&d=identicon&r=PG&f=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/5036757/justin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4444, "favorite_count": 2, "accepted_answer_id": 49080184, "answer_count": 1, "score": 9, "last_activity_date": 1535022296, "creation_date": 1520038955, "question_id": 49079579, "link": "https://stackoverflow.com/questions/49079579/unable-to-deploy-lambda-function-written-in-go", "title": "Unable to deploy lambda function written in Go", "body": "<p>I am attempting to deploy my code to AWS Lambda. I've written it in Go. It builds just fine but I receive this error when running it via the Lambda test functionality:</p>\n\n<pre><code>{\n  \"errorMessage\": \"fork/exec /var/task/github-activity: no such file or directory\",\n  \"errorType\": \"PathError\"\n}\n</code></pre>\n\n<p>You can view the full code at: <a href=\"https://github.com/JustinDFuller/github-activity\" rel=\"noreferrer\">https://github.com/JustinDFuller/github-activity</a>\nI have tested and seen that it works fine on my machine. (I've tried on windows and linux).</p>\n\n<p>The file I am deploying is made by running the following commands:</p>\n\n<p><code>\nGOOS=linux GOARCH=amd64 go build -o main awsLambdaImpl.go\nzip main.zip main\n</code></p>\n"}, {"tags": ["javascript", "go", "multidimensional-array"], "comments": [{"owner": {"reputation": 1039, "user_id": 4316060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3275afce26008a9c1d054bd13dc5b192?s=128&d=identicon&r=PG&f=1", "display_name": "Shyam Babu", "link": "https://stackoverflow.com/users/4316060/shyam-babu"}, "edited": false, "score": 0, "creation_date": 1520052727, "post_id": 49079521, "comment_id": 85167223, "body": "Could you add a sample of how the arrays are?"}, {"owner": {"reputation": 11, "user_id": 6460940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d13b6802b1e8ddf63086bc7433077c1?s=128&d=identicon&r=PG&f=1", "display_name": "rdacso", "link": "https://stackoverflow.com/users/6460940/rdacso"}, "reply_to_user": {"reputation": 1039, "user_id": 4316060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3275afce26008a9c1d054bd13dc5b192?s=128&d=identicon&r=PG&f=1", "display_name": "Shyam Babu", "link": "https://stackoverflow.com/users/4316060/shyam-babu"}, "edited": false, "score": 0, "creation_date": 1520118271, "post_id": 49079521, "comment_id": 85185811, "body": "@ShyamBabu Arrays look like: <code>price = [&#39;1.00&#39;, &#39;2.00&#39;, &#39;3.00&#39;]</code> <code>rider = [&#39;reduced&#39;, &#39;regular&#39;]</code>, <code>fare = [ &#39;one day&#39;, &#39;one day&#39;, &#39;two day&#39;, &#39;two day&#39;, &#39;week&#39;, &#39;week&#39;, &#39;month&#39;, &#39;month&#39;]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6460940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d13b6802b1e8ddf63086bc7433077c1?s=128&d=identicon&r=PG&f=1", "display_name": "rdacso", "link": "https://stackoverflow.com/users/6460940/rdacso"}, "edited": false, "score": 0, "creation_date": 1520279655, "post_id": 49108827, "comment_id": 85242143, "body": "I&#39;m pulling the &#39;price&#39; array from a golang server, which means I only get one array. But this is a fantastic start and answers some of my big questions. Thank you!"}, {"owner": {"reputation": 1039, "user_id": 4316060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3275afce26008a9c1d054bd13dc5b192?s=128&d=identicon&r=PG&f=1", "display_name": "Shyam Babu", "link": "https://stackoverflow.com/users/4316060/shyam-babu"}, "reply_to_user": {"reputation": 11, "user_id": 6460940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d13b6802b1e8ddf63086bc7433077c1?s=128&d=identicon&r=PG&f=1", "display_name": "rdacso", "link": "https://stackoverflow.com/users/6460940/rdacso"}, "edited": false, "score": 0, "creation_date": 1520322666, "post_id": 49108827, "comment_id": 85256271, "body": "Glad I could help. If it solves your question you can also accept the answer. :)"}, {"owner": {"reputation": 11, "user_id": 6460940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d13b6802b1e8ddf63086bc7433077c1?s=128&d=identicon&r=PG&f=1", "display_name": "rdacso", "link": "https://stackoverflow.com/users/6460940/rdacso"}, "edited": false, "score": 0, "creation_date": 1520392715, "post_id": 49108827, "comment_id": 85292403, "body": "New Question actually: Is there a way to have those values display horizontally rather than vertically?"}, {"owner": {"reputation": 1039, "user_id": 4316060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3275afce26008a9c1d054bd13dc5b192?s=128&d=identicon&r=PG&f=1", "display_name": "Shyam Babu", "link": "https://stackoverflow.com/users/4316060/shyam-babu"}, "reply_to_user": {"reputation": 11, "user_id": 6460940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d13b6802b1e8ddf63086bc7433077c1?s=128&d=identicon&r=PG&f=1", "display_name": "rdacso", "link": "https://stackoverflow.com/users/6460940/rdacso"}, "edited": false, "score": 0, "creation_date": 1520419581, "post_id": 49108827, "comment_id": 85304165, "body": "I&#39;ve made the code generic. As long the row length and col length match the two-D array length then it should be fine."}], "tags": [], "owner": {"reputation": 1039, "user_id": 4316060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3275afce26008a9c1d054bd13dc5b192?s=128&d=identicon&r=PG&f=1", "display_name": "Shyam Babu", "link": "https://stackoverflow.com/users/4316060/shyam-babu"}, "is_accepted": false, "score": 0, "last_activity_date": 1520419938, "last_edit_date": 1520419938, "creation_date": 1520247321, "answer_id": 49108827, "question_id": 49079521, "link": "https://stackoverflow.com/questions/49079521/create-a-two-headed-dynamic-table-populated-with-elements-from-three-different-a/49108827#49108827", "title": "Create a two headed dynamic table populated with elements from three different arrays pulled from golang server", "body": "<p>You seem to be missing the values for one of the columns.\nThe following code is with the data you provided. If you can provide other data and if the requirement is different I can maybe improve it afterwards.</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>let mytable = $('&lt;table&gt;&lt;/table&gt;').attr({\r\n    id: \"basicTable\",\r\n    class: \"table table-hover\"\r\n  });\r\n\r\n  const columnHeaders = ['one ride', 'one ride', 'two ride', 'two ride', 'week', 'week', 'month', 'month']\r\n  const rowHeaders = ['regular', 'reduced']\r\n  const rowValues = [['1.00', '2.00', '3.00', '4.00', '5.00', '6.00', '7.00', '8.00']]\r\n//The above two dimensional array should map to the length of rows and columns, then the following code will not fail.\r\n  \r\n  mytable.append(getTabelHTML(columnHeaders,rowHeaders,rowValues));\r\n  mytable.appendTo(\"#box\");\r\n\r\nfunction getTabelHTML(columnHeaders,rowHeaders, rowValues) {\r\n  //create col header html\r\n  const colheaderValue = ['', ...columnHeaders] //put one empty value for first empty column \r\n    .map((header) =&gt; `&lt;th scope=\"col\"&gt;${header}&lt;/th&gt;`)\r\n    .join(''); //join all the &lt;th&gt; strings\r\n   \r\n  const colheaderRowHTML = `&lt;tr&gt;${colheaderValue}&lt;/tr&gt;`; //wrap inside &lt;TR&gt;\r\n  \r\n  //create other row HTML\r\n  const otherRowsHTML = rowHeaders.map((header, index) =&gt; {\r\n    let rowHeader = `&lt;th scope=\"col\"&gt;${header}&lt;/th&gt;`\r\n    let rowValue = ''\r\n    if(rowValues[index]) {\r\n       rowValue = rowValues[index].map((rowcolValue)=&gt;`&lt;td scope=\"row\"&gt;${rowcolValue}&lt;/td&gt;`).join();\r\n     }\r\n    return `&lt;tr&gt;${rowHeader}${rowValue}&lt;/tr&gt;`;\r\n  });\r\n\r\n  return colheaderRowHTML.concat(otherRowsHTML);\r\n}</code></pre>\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;script src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js\"&gt;&lt;/script&gt;\r\n&lt;div id=\"box\"&gt;&lt;/div&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}], "owner": {"reputation": 11, "user_id": 6460940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d13b6802b1e8ddf63086bc7433077c1?s=128&d=identicon&r=PG&f=1", "display_name": "rdacso", "link": "https://stackoverflow.com/users/6460940/rdacso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1520419938, "creation_date": 1520038368, "last_edit_date": 1520118499, "question_id": 49079521, "link": "https://stackoverflow.com/questions/49079521/create-a-two-headed-dynamic-table-populated-with-elements-from-three-different-a", "title": "Create a two headed dynamic table populated with elements from three different arrays pulled from golang server", "body": "<p>I need to generate a two-headed table that draws data from three different arrays - riders, passes, and prices. Riders (column header) and Passes (row header) are both headers. Prices are where the Riders and Passes intersect. </p>\n\n<p>So something like this: <a href=\"https://www.w3.org/WAI/tutorials/tables/two-headers/\" rel=\"nofollow noreferrer\">https://www.w3.org/WAI/tutorials/tables/two-headers/</a></p>\n\n<p>Here's where I've been successful:</p>\n\n<ol>\n<li>Table is generated with the correct number of rows/cols based on length of the arrays</li>\n<li>The cells are being autofilled with elements from each array. </li>\n</ol>\n\n<p>Here's where I'm struggling:</p>\n\n<ol>\n<li>The header (passes) is only showing the first element in the array over and over again for each cell in the top row.</li>\n<li>Second row is displaying only the first element of the rider array over and over again in each cell.</li>\n<li>The rest of the cells are populated with prices, but they span the entire row. So instead of seeing $1.00, $2.00, $3.00 it's a row of $1.00 and then the row immediately under it is $2.00, etc. </li>\n</ol>\n\n<p>My questions: \n1. How can I make sure the rider array populates only the first column?</p>\n\n<ol start=\"2\">\n<li><p>How do I iterate over two of the loops so that I get more than just the first value? How do I make sure each cell has only one value?</p>\n\n<pre><code>&lt;script&gt;\nfunction createTable(){\n mytable = $('&lt;table&gt;&lt;/table&gt;').attr({ id: \n  \"basicTable\",class:\"table table-hover\"});\n let pass =['one ride', 'one ride', 'two ride', 'two ride', 'week', 'week', 'month', 'month']\n\nconsole.log(pass[0]);\nlet rider = [ 'regular', 'reduced']\n\nconsole.log(rider[0]);\n\nlet price = ['1.00', '2.00', '3.00', '4.00', '5.00', '6.00', '7.00', '8.00']\n];\nconsole.log(price[0]);\n\nlet rows = price.length;\nconsole.log(rows);\n\nlet cols = rider.length\nconsole.log(cols);\n\nvar tr = [];\n\nfor (var i = 0; i &lt;= rows; i++) {\n  var row = $('&lt;tr&gt;&lt;/tr&gt;').attr({ class: [\"class1\"].join(' ') \n  }).appendTo(mytable);\n  console.log(row)\nif (i==0) {\n for (var j = 0; j &lt; cols; j++) {\n  $('&lt;th scope=\"col\"&gt;&lt;/th&gt;').text(pass[i]).attr({class:\n  [\"info\"]}).appendTo(row);\n  }\n}else if (i==1) {\n for (var j = 0; j &lt; cols; j++) {\n  $('&lt;td scope=\"col\"&gt;&lt;/td&gt;').text(rider[i]).appendTo(row);   \n   }\n} else{\n for (var j = 0; j &lt; cols; j++) {\n    $('&lt;td scope=\"row\"&gt;&lt;/td&gt;').text(price[i]).appendTo(row); \n }}}\n\n mytable.appendTo(\"#box\");\n }\n</code></pre></li>\n</ol>\n"}, {"tags": ["go", "github", "go-git"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1520083350, "post_id": 49079109, "comment_id": 85174428, "body": "Git doesn&#39;t have that functionality. You&#39;ll have to set it up yourself, manually, and poll on a periodic basis."}], "answers": [{"tags": [], "owner": {"reputation": 643, "user_id": 5275040, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HoNHd.png?s=128&g=1", "display_name": "bzz", "link": "https://stackoverflow.com/users/5275040/bzz"}, "is_accepted": false, "score": 0, "last_activity_date": 1526765258, "creation_date": 1526765258, "answer_id": 50429644, "question_id": 49079109, "link": "https://stackoverflow.com/questions/49079109/how-to-poll-github-repo-to-pull-on-changes/50429644#50429644", "title": "How to poll GitHub repo to pull on changes", "body": "<p><a href=\"https://github.com/src-d/go-git\" rel=\"nofollow noreferrer\">go-git</a> does not provide this functionality out of the box, so you would need to write a small funciton.</p>\n\n<ol>\n<li>In order to pull a repository periodically in Golang, one could use <code>time.Ticker</code>, as described in <a href=\"https://stackoverflow.com/questions/39363794/periodically-polling-a-rest-endpoint-in-go\">Periodically polling a REST endpoint in Go</a> </li>\n<li>To pull from a Git repository, instead of <code>http.Get</code> for the REST API endpoint, one could use this <a href=\"https://github.com/src-d/go-git/blob/master/_examples/pull/main.go\" rel=\"nofollow noreferrer\">_examples/pull/main.go</a> from official go-git documentation </li>\n</ol>\n\n<p>Let me know if that helps!</p>\n"}], "owner": {"reputation": 175, "user_id": 7902359, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/cc136e9fe72b06c7f6c2f201bf9e7b39?s=128&d=identicon&r=PG&f=1", "display_name": "ecl0", "link": "https://stackoverflow.com/users/7902359/ecl0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 928, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1526765409, "creation_date": 1520034645, "last_edit_date": 1526765409, "question_id": 49079109, "link": "https://stackoverflow.com/questions/49079109/how-to-poll-github-repo-to-pull-on-changes", "title": "How to poll GitHub repo to pull on changes", "body": "<p>I need to add this functionality into my GO program, with goal to poll the repo and perform a git pull on changes. I have been using <a href=\"https://github.com/src-d/go-git\" rel=\"nofollow noreferrer\">https://github.com/src-d/go-git</a> but am unable to find a way to poll.</p>\n\n<p>I don't want to use a webhook to avoid creating a server for incoming payloads.</p>\n"}, {"tags": ["windows", "go", "dll", "compilation"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520031133, "post_id": 49078510, "comment_id": 85163202, "body": "Is cgo enabled? Do you have the C compiler installed?"}, {"owner": {"reputation": 123, "user_id": 6182909, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/63923266977d6f872bc6efe5b299c7cb?s=128&d=identicon&r=PG&f=1", "display_name": "t3ntman", "link": "https://stackoverflow.com/users/6182909/t3ntman"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520031574, "post_id": 49078510, "comment_id": 85163332, "body": "Apologies for my noob-ness in Golang. I added in the <code>CGO_ENABLED=1</code> option, which should enable CGO. The new command is <code>env GOOS=windows GOARCH=386 CGO_ENABLED=1 go build -buildmode=c-shared main.go</code>, but now I&#39;m receiving <code>gcc_libinit_windows.c:7:10: fatal error: &#39;windows.h&#39; file not found</code>. I&#39;m compiling on OSX if that helps."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520031712, "post_id": 49078510, "comment_id": 85163367, "body": "If you&#39;re compiling on osx, do you have a complete C compiler toolchain installed for windows?"}, {"owner": {"reputation": 123, "user_id": 6182909, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/63923266977d6f872bc6efe5b299c7cb?s=128&d=identicon&r=PG&f=1", "display_name": "t3ntman", "link": "https://stackoverflow.com/users/6182909/t3ntman"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520032183, "post_id": 49078510, "comment_id": 85163458, "body": "Ideally I want this to be compiled on an Ubuntu system, which should have gcc installed. Trying to build on Ubuntu gives the following error: <code>gcc: error: unrecognized command line option \u2018-mthreads\u2019; did you mean \u2018-pthread\u2019?</code> Thanks for the help so far!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520032431, "post_id": 49078510, "comment_id": 85163533, "body": "Having gcc installed doesn&#39;t mean you can compile for windows. You need a windows compiler and all the required headers. IIRC for windows the supported compiler is mingw."}, {"owner": {"reputation": 123, "user_id": 6182909, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/63923266977d6f872bc6efe5b299c7cb?s=128&d=identicon&r=PG&f=1", "display_name": "t3ntman", "link": "https://stackoverflow.com/users/6182909/t3ntman"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1520033603, "post_id": 49078510, "comment_id": 85163876, "body": "JimB, you are the man! What ended up working:  1. Install mingw on Ubuntu: <code>sudo apt-get install gcc-mingw-w64-i686</code> and <code>sudo apt-get install gcc-mingw-w64-x86-64</code> 2. Compile for Windows on Ubuntu: <code>env GOOS=windows GOARCH=386 CGO_ENABLED=1 CC=i686-w64-mingw32-gcc go build -buildmode=c-shared -o main.dll main.go</code> and <code>env GOOS=windows GOARCH=amd64 CGO_ENABLED=1 CC=x86_64-w64-mingw32-gcc go build -buildmode=c-shared -o main.dll main.go</code> 3. Verify everything works with <code>rundll32.exe main.dll,Test</code>  Thanks again!"}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1520065258, "post_id": 49079049, "comment_id": 85169638, "body": "I wonder why do you have all these <code>env</code> spilled around; should work fine without them."}], "tags": [], "owner": {"reputation": 123, "user_id": 6182909, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/63923266977d6f872bc6efe5b299c7cb?s=128&d=identicon&r=PG&f=1", "display_name": "t3ntman", "link": "https://stackoverflow.com/users/6182909/t3ntman"}, "is_accepted": false, "score": 6, "last_activity_date": 1588133113, "last_edit_date": 1588133113, "creation_date": 1520034158, "answer_id": 49079049, "question_id": 49078510, "link": "https://stackoverflow.com/questions/49078510/trouble-compiling-windows-dll-using-golang-1-10/49079049#49079049", "title": "Trouble compiling Windows DLL using Golang 1.10", "body": "<ol>\n<li><p>Make sure you have MinGW installed on Ubuntu: <code>sudo apt-get install gcc-mingw-w64-i686</code> and <code>sudo apt-get install gcc-mingw-w64-x86-64</code></p></li>\n<li><p>Compile using the following commands: <code>GOOS=windows GOARCH=386 CGO_ENABLED=1 CC=i686-w64-mingw32-gcc go build -buildmode=c-shared -o main.dll main.go</code> and <code>GOOS=windows GOARCH=amd64 CGO_ENABLED=1 CC=x86_64-w64-mingw32-gcc go build -buildmode=c-shared -o main.dll main.go</code></p></li>\n<li><p>Verify generated DLL works by testing the \"Test\" export: <code>rundll32.exe main.dll,Test</code></p></li>\n</ol>\n"}], "owner": {"reputation": 123, "user_id": 6182909, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/63923266977d6f872bc6efe5b299c7cb?s=128&d=identicon&r=PG&f=1", "display_name": "t3ntman", "link": "https://stackoverflow.com/users/6182909/t3ntman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2791, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1588133113, "creation_date": 1520030652, "question_id": 49078510, "link": "https://stackoverflow.com/questions/49078510/trouble-compiling-windows-dll-using-golang-1-10", "title": "Trouble compiling Windows DLL using Golang 1.10", "body": "<p>I'm having issues building a Windows DLL in Golang 1.10, which is supported in this latest version: </p>\n\n<p>\"The various build modes have been ported to more systems. Specifically, c-shared now works on linux/ppc64le, windows/386, and windows/amd64;\" (Source: <a href=\"https://golang.org/doc/go1.10\" rel=\"nofollow noreferrer\">https://golang.org/doc/go1.10</a>)</p>\n\n<p>I have a very simple program right now (<code>main.go</code>) that only exports one function \"Test\", but am having issues when using the following \"go build\" command: <code>env GOOS=windows GOARCH=386 go build -buildmode=c-shared main.go</code></p>\n\n<p>Specifically, receiving the <code>can't load package: package main: build constraints exclude all Go files in [PATH]</code> error. The source code for <code>main.go</code> is shown below:</p>\n\n<pre><code>package main\n\nimport (\n    \"C\"\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"from main\")\n}\n\n//export Test\nfunc Test() string {\n    return \"this is a test\"\n}\n</code></pre>\n\n<p>I've never encountered this error before and building without specifying <code>GOOS</code> and <code>GOARCH</code> works. Hoping someone has encountered this issue and can help me out.</p>\n"}]