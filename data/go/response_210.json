[{"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 6, "creation_date": 1547680993, "post_id": 54226848, "comment_id": 95279815, "body": "That code is explicit, easy to follow and type safe"}, {"owner": {"reputation": 114, "user_id": 5943947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fac2b84ee2f85c6e0c1119190484d5c9?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Betterton", "link": "https://stackoverflow.com/users/5943947/michael-betterton"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1547682153, "post_id": 54226848, "comment_id": 95280118, "body": "@zerkms is there a shorter, yet still easy to follow and type safe solution to my problem?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1547682233, "post_id": 54226848, "comment_id": 95280139, "body": "I&#39;m not sure &quot;2 lines per type&quot; is a too high price to bother."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1547709154, "post_id": 54226848, "comment_id": 95286329, "body": "Each question must be complete on its own, without following external links. Links (as to the playground) are great for extra information, but links die. Please put all relevant code directly into your question."}], "answers": [{"comments": [{"owner": {"reputation": 114, "user_id": 5943947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fac2b84ee2f85c6e0c1119190484d5c9?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Betterton", "link": "https://stackoverflow.com/users/5943947/michael-betterton"}, "edited": false, "score": 1, "creation_date": 1547692522, "post_id": 54227143, "comment_id": 95282054, "body": "Thanks for the response, based on your answer and the other commenter I&#39;ll leave the code as is."}], "tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": true, "score": 2, "last_activity_date": 1547682890, "creation_date": 1547682890, "answer_id": 54227143, "question_id": 54226848, "link": "https://stackoverflow.com/questions/54226848/is-there-a-more-idiomatic-approach-to-creating-variables-of-specific-types-based/54227143#54227143", "title": "Is there a more idiomatic approach to creating variables of specific types based on input?", "body": "<p>You can create a hashmap from \"string\" to \"function that returns animal\" but setting that up would be more verbose than the switch statement.</p>\n\n<p>Something like this (not tested)</p>\n\n<pre><code>type AnimalCtor func() animal\n\nvar animalMap map[string]AnimalCtor\n\n.....\n\nfunc init() {\n    animalMap[\"dog\"] = func() animal { return &amp;dog{} }\n    animalMap[\"cat\"] = func() animal { return &amp;cat{} }\n    animalMap[\"bird\"] = func() animal { return &amp;bird{} }\n    .....\n}\n\nfunc createAnimalFromString(input string) animal {\n    ctor, ok := animalMap[input]\n    if ok {\n        return ctor()\n    } else {\n        return nil\n    }\n}\n</code></pre>\n\n<p>But it's a lot more verbose than the switch statement and obscures what should otherwise be explicit and clear.</p>\n"}], "owner": {"reputation": 114, "user_id": 5943947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fac2b84ee2f85c6e0c1119190484d5c9?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Betterton", "link": "https://stackoverflow.com/users/5943947/michael-betterton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 54227143, "answer_count": 1, "score": 0, "last_activity_date": 1549235599, "creation_date": 1547680819, "last_edit_date": 1549235599, "question_id": 54226848, "link": "https://stackoverflow.com/questions/54226848/is-there-a-more-idiomatic-approach-to-creating-variables-of-specific-types-based", "title": "Is there a more idiomatic approach to creating variables of specific types based on input?", "body": "<p>In <a href=\"https://play.golang.org/p/MgL7r2hEWEh\" rel=\"nofollow noreferrer\">this playground link</a> I have created a contrived version of my code where I am creating a variable of type X based on an input string. The variable will be one of a handful of types and implement an interface. </p>\n\n<p>The code currently compiles and provides the correct result, however it strikes me as quite verbose and I'm trying to find if there is a shorthand approach to the result I'm achieving. The example has 3 types (dog, cat &amp; bird) that implement the interface (animal), however my actual code will have up to 40 types in this switch statement. </p>\n\n<p>The reason I am using this code is when retrieving results form a DBMS, I'm trying to use a generic load method that, when combined with <a href=\"https://github.com/jmoiron/sqlx\" rel=\"nofollow noreferrer\">sqlx</a>, loads the database table into the correct struct based on the input string. I have entire control over the application and can change the input string to another type if required. </p>\n\n<p>Code from playground link:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype animal interface {\n    call() string\n}\n\ntype dog struct {\n}\n\nfunc (d *dog) call() string {\n    return \"Woof!\"\n}\n\ntype cat struct {\n}\n\nfunc (c *cat) call() string {\n    return \"Meow!\"\n}\n\ntype bird struct {\n}\n\nfunc (c *bird) call() string {\n    return \"Chirp!\"\n}\n\nfunc main() {\n    var animal animal\n    animalType := \"dog\"\n    switch animalType{\n    case \"dog\":\n        animal = new(dog)\n    case \"cat\":\n        animal = new(cat)\n    case \"bird\":\n        animal = new(bird)\n</code></pre>\n"}, {"tags": ["angular", "go", "cors"], "comments": [{"owner": {"reputation": 5026, "user_id": 2052575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef811d74c86084dcaf8a9aa5b57b1dc0?s=128&d=identicon&r=PG", "display_name": "v25", "link": "https://stackoverflow.com/users/2052575/v25"}, "edited": false, "score": 1, "creation_date": 1547677451, "post_id": 54226085, "comment_id": 95278604, "body": "I had this issue with flask and my workaround was to install nginx on my dev box and run my frontend at <code>&#47;</code> and the backend at <code>&#47;api&#47;</code>which got around the CORS error completely as both were then on the same server <i>and</i> port from the browser&#39;s perspective. Probably not the solution you&#39;re looking for but it solved this headache of a problem for me. I use a similar endpoint configuration in production, and still run the app servers on different localhost ports."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1547685530, "post_id": 54226085, "comment_id": 95280824, "body": "&quot;OPTIONS [...] 405 (Method Not Allowed)&quot; means exactly what it says: your server doesn&#39;t allow OPTIONS requests because you configured only a single route for POST requests, and none for OPTIONS."}, {"owner": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1547716087, "post_id": 54226085, "comment_id": 95289582, "body": "@Peter I did also try setting and adding OPTIONS in the back end. However, running <code>curl -i -X OPTIONS http:&#47;&#47;localhost:12345&#47;anteroom</code> produced: TP/1.1 405 Method Not Allowed. My guess now is that somehow, OPTIONS as header in the backend is failing. I don&#39;t know why yet."}, {"owner": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "reply_to_user": {"reputation": 5026, "user_id": 2052575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef811d74c86084dcaf8a9aa5b57b1dc0?s=128&d=identicon&r=PG", "display_name": "v25", "link": "https://stackoverflow.com/users/2052575/v25"}, "edited": false, "score": 0, "creation_date": 1547716212, "post_id": 54226085, "comment_id": 95289667, "body": "@v25 Part of me wants to go with that. Part of me says, &quot;No! I must understand what&#39;s going on!&quot; But thanks. It might come down to that."}, {"owner": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1547717409, "post_id": 54226085, "comment_id": 95290380, "body": "@Peter Sorry, I forgot to add &quot;OPTIONS&quot; in <code>router.HandleFunc()</code>. curl is returning options now, but front end is still not sending in the JSON."}], "answers": [{"comments": [{"owner": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "edited": false, "score": 0, "creation_date": 1547715788, "post_id": 54226401, "comment_id": 95289419, "body": "Thanks for explaining it. Now I have a clearer idea of the process. I did try setting OPTIONS in the backend. Same result. However, running <code>curl -i -X OPTIONS http:&#47;&#47;localhost:12345&#47;anteroom </code> produced: TP/1.1 405 Method Not Allowed. My guess now is that somehow, setting/adding OPTIONS as header in the backend is failing."}, {"owner": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "edited": false, "score": 0, "creation_date": 1547717355, "post_id": 54226401, "comment_id": 95290343, "body": "Sorry, I forgot to add &quot;OPTIONS&quot; in <code>router.HandleFunc()</code>. curl is returning options now, but front end is still not sending in the JSON."}], "tags": [], "owner": {"reputation": 10248, "user_id": 268396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4220afde4dd928ef33648797c7415ada?s=128&d=identicon&r=PG", "display_name": "user268396", "link": "https://stackoverflow.com/users/268396/user268396"}, "is_accepted": false, "score": 2, "last_activity_date": 1547677992, "creation_date": 1547677992, "answer_id": 54226401, "question_id": 54226085, "link": "https://stackoverflow.com/questions/54226085/angular-frontend-post-to-golang-backend-method-not-allowed-and-blocked-by-cors-p/54226401#54226401", "title": "Angular frontend POST to Golang backend method not allowed and blocked by CORS policy", "body": "<p>This is not how you do <code>CORS</code> on the backend. Your backend needs to listen to HTTP <code>OPTIONS</code> type requests and send the CORS headers there.</p>\n\n<p>The control flow is roughly:</p>\n\n<ol>\n<li>You request something in the frontend</li>\n<li>The browser determines: uh-oh, this requires CORS</li>\n<li>The browser first performs an OPTIONS request to the requested resources to negotiate CORS</li>\n<li>Depending on the result, either browser throws your frontend an error</li>\n<li>Or it continues with the actual request your frontend issued.</li>\n<li>Things work almost normally from here on out</li>\n<li>When the browser gets the result of your actual API call back it filters out things that have not been whitelisted/negotiated in steps 3 and 4.</li>\n<li>It presents that potentially censored result to the frontend as the result of the HTTP call.</li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "edited": false, "score": 0, "creation_date": 1547716002, "post_id": 54227996, "comment_id": 95289534, "body": "Thanks for explaining. Origin is now set to &quot;*&quot;, and I tried <code>Add()</code> like you said. Same result. However, running <code>curl -i -X OPTIONS http:&#47;&#47;localhost:12345&#47;anteroom</code> produced: TP/1.1 405 Method Not Allowed. My guess now is that somehow, OPTIONS as header in the backend is failing. I don&#39;t know why yet."}, {"owner": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "edited": false, "score": 0, "creation_date": 1547717377, "post_id": 54227996, "comment_id": 95290356, "body": "Sorry, I forgot to add &quot;OPTIONS&quot; in <code>router.HandleFunc()</code>. curl is returning options now, but front end is still not sending in the JSON."}, {"owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "reply_to_user": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "edited": false, "score": 0, "creation_date": 1547800126, "post_id": 54227996, "comment_id": 95324337, "body": "if you set origin to &quot;*&quot;, the next step is just call <code>http.post()</code> in angular. Open <code>development tool</code> in <code>chrome</code>, check  &quot;<code>network</code>&quot;, you will see that two requests. the first is &quot;<code>option</code>&quot;, the second is &quot;<code>post</code>&quot;. The <code>CORS</code> part is done."}, {"owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "reply_to_user": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "edited": false, "score": 0, "creation_date": 1547800150, "post_id": 54227996, "comment_id": 95324352, "body": "the <code>json</code> part is another question."}, {"owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "reply_to_user": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "edited": false, "score": 0, "creation_date": 1547800265, "post_id": 54227996, "comment_id": 95324401, "body": "<code>public profile: string;</code>   and <code>.post(&quot;http:&#47;&#47;localhost:12345&#47;anteroom&quot;, this.profile, </code>, you want to post a string as body in <code>json</code> format, so the body is string. you should try <code>.post(url, { id: &#39;11111&#39;, name:&#39;aaaaa&#39;}</code> something like that."}], "tags": [], "owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "is_accepted": false, "score": 1, "last_activity_date": 1547690695, "creation_date": 1547690695, "answer_id": 54227996, "question_id": 54226085, "link": "https://stackoverflow.com/questions/54226085/angular-frontend-post-to-golang-backend-method-not-allowed-and-blocked-by-cors-p/54227996#54227996", "title": "Angular frontend POST to Golang backend method not allowed and blocked by CORS policy", "body": "<p>@user268396 had told you why, and I will tell you how.</p>\n\n<p>\"<code>Access-Control-Allow-Origin</code>\" means which origin you allowed to make request to this server. </p>\n\n<p>It can be in forms like:</p>\n\n<ul>\n<li>\"*\"</li>\n<li>\"<a href=\"https://github.com\" rel=\"nofollow noreferrer\">https://github.com</a>\"</li>\n<li>\"<a href=\"http://127.0.0.1:8080\" rel=\"nofollow noreferrer\">http://127.0.0.1:8080</a>\"</li>\n<li>\"chrome-extension://*\"</li>\n<li>\"*.some-domain.com\"</li>\n</ul>\n\n<p>\"<code>Access-Control-Allow-Methods</code>\" should be []string(\"POST\", \"OPTION\") when you want to post data from CORS.</p>\n\n<p>When it come to golang, see godoc <a href=\"https://golang.org/pkg/net/http/#Header\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Header</a></p>\n\n<pre><code>type Header map[string][]string\n</code></pre>\n\n<p>And I always suggest to use <code>Header.Add()</code> instead of <code>Header.Set()</code> unless you know exactly what you are doing. Because each value in header always be []string. </p>\n\n<p>So it should be</p>\n\n<pre><code>    res.Header().Add(\"Access-Control-Allow-Origin\", \"*\")\n    res.Header().Add(\"Access-Control-Allow-Methods\", \"POST\")\n    res.Header().Add(\"Access-Control-Allow-Methods\", \"OPTION\")\n    res.Header().Add(\"Content-Type\", \"application/json\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "is_accepted": false, "score": 1, "last_activity_date": 1547720760, "creation_date": 1547720760, "answer_id": 54233817, "question_id": 54226085, "link": "https://stackoverflow.com/questions/54226085/angular-frontend-post-to-golang-backend-method-not-allowed-and-blocked-by-cors-p/54233817#54233817", "title": "Angular frontend POST to Golang backend method not allowed and blocked by CORS policy", "body": "<p>Problem solved thanks in large part to everyone who helped me realise I wasn't doing CORS properly. Basically, there were two problems: 1. I didn't know to set headers properly in the back end, and 2. I didn't format my JSON data properly.</p>\n\n<p>I noticed that this is a fairly popular problem on Stack Overflow, possibly in part because some of us don't really understand how requests work. So here is a summary, drawn from Mozilla's invaluable and simply written <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\" rel=\"nofollow noreferrer\">documentation</a> and user268396's input. I'm new to this so please correct me if I'm wrong.</p>\n\n<p>Usually, it's straightforward: when you want to request something, the browser sets the appropriate headers based on whatever content you already have, and sends the request out. Server responds.</p>\n\n<p>But, assuming you have an API POST endpoint on your back end and a front end on the same domain (I suppose that's most of us in development, though maybe not in production), and you're working with anything other than application/x-www-form-urlencoded, multipart/form-data, and text/plain, then it's a bit different. In my case, I'm working with application/json. So, it looks like this:</p>\n\n<ol>\n<li><p>Browser sends request with the OPTIONS method asking for what methods and content-types and other things that are allowed. This is called a preflight request. It doesn't send my JSON object yet.</p></li>\n<li><p>Server responds to the preflight request.</p></li>\n</ol>\n\n<p>For the server to respond with the allowed stuff, we need to properly set the back end to allow the OPTIONS method in Access-Control-Allow-Methods, and if like me you're using Gorilla mux, remember to allow it in <code>router.HandleFunc()</code> too.</p>\n\n<p>Because our front and back ends are on the same domain (<a href=\"http://localhost\" rel=\"nofollow noreferrer\">http://localhost</a>), the easiest thing to do is to set Access-Control-Allow-Origin to \"*\". However, we probably don't want to do this in production depending on our needs because * means all the world and beyond gets to send in requests.</p>\n\n<p>Because I want to receive JSON, I also set Content-Type in the back end to application/json. This was the other half of my problem. Long story short, no matter what worked for other people, for some reason I still had to apply <code>JSON.stringify()</code> to my raw JSON data. Then it worked perfectly.</p>\n\n<ol start=\"3\">\n<li>Once the browser receives the allowed OPTIONS back, it filters out the stuff that's not allowed, and sends back a request with only the appropriate data. In my case, this would be the JSON object.</li>\n</ol>\n\n<p>And that's it.</p>\n"}], "owner": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1700, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1547720760, "creation_date": 1547676247, "last_edit_date": 1547720590, "question_id": 54226085, "link": "https://stackoverflow.com/questions/54226085/angular-frontend-post-to-golang-backend-method-not-allowed-and-blocked-by-cors-p", "title": "Angular frontend POST to Golang backend method not allowed and blocked by CORS policy", "body": "<p>I'm trying to make a post request from my Angular front end to my Golang back end, both served from the same machine. I keep getting:</p>\n\n<p><code>OPTIONS http://localhost:12345/anteroom 405 (Method Not Allowed)</code></p>\n\n<p>and</p>\n\n<p><code>Access to XMLHttpRequest at 'http://localhost:12345/anteroom' from origin 'http://localhost:4200' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource.</code></p>\n\n<p>Golang back end, using Gorilla mux router:</p>\n\n<pre><code>func main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/anteroom\", anteroom).Methods(\"POST\")\n    log.Fatal(http.ListenAndServe(\":12345\", router))\n}\n\nfunc anteroom(res http.ResponseWriter, req *http.Request) {\n    res.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    // *Edit 17 Jan 19 12.44pm*: Billy, user268396, and Peter suggest that OPTIONS should be added. As mentioned below, I've already tried that.\n    res.Header().Set(\"Access-Control-Allow-Methods\", \"POST\")\n    res.Header().Set(\"Content-Type\", \"application/json\")\n\n    // Put it into a struct variable and print a bit of it.\n    _ = json.NewDecoder(req.Body).Decode(&amp;member)\n    fmt.Println(member.ID)\n}\n</code></pre>\n\n<p>Angular front end component:</p>\n\n<pre><code>export class AnteroomComponent implements OnInit {\n  public profile: string;\n\n  constructor(private http: HttpClient, private cookieService: CookieService) {}\n\n  ngOnInit() {}\n\n  // This is the relevant function.\n  // Triggered by a button.\n  sendProfile(Profile) {\n    let httpHeaders = new HttpHeaders({\n      \"Content-Type\": \"application/json\",\n      \"Origin\": \"http://localhost:4200\"\n    });\n\n    return this.http\n      .post(\"http://localhost:12345/anteroom\", this.profile, {\n        headers: httpHeaders,\n        observe: \"response\"\n      })\n      .subscribe(\n        data =&gt; {\n          console.log(\"POST Request is successful \", data);\n        },\n        error =&gt; {\n          console.log(\"Error\", error);\n        }\n      );\n  }\n}\n</code></pre>\n\n<p>Here're some of the many things I tried:</p>\n\n<ul>\n<li><p>I read that it's the browser's job to set headers, not mine (which doesn't make sense to me because then what is <code>HttpHeaders()</code> for?), so I removed all the headers from Angular.</p></li>\n<li><p>I tried enabling CORS in Golang as shown <a href=\"https://flaviocopes.com/golang-enable-cors/\" rel=\"nofollow noreferrer\">here</a>:</p>\n\n<pre><code>(*w).Header().Set(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS, PUT, DELETE\")\nif (*req).Method == \"OPTIONS\" {\n    return\n}\n</code></pre></li>\n<li><p>I tried changing <code>Access-Control-Allow-Origin</code> from <code>*</code> to <code>Origin</code> because I read somewhere that <code>*</code> prevents cookies from being sent/received. (Lost the link.) Maybe it prevents some other MIME types too? I don't know, just trying. </p></li>\n<li><p><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\" rel=\"nofollow noreferrer\">Mozilla</a> says \"The constructor initializes an XMLHttpRequest. It must be called before any other method calls.\" So I thought I'd do that but then <a href=\"https://angular.io/guide/http\" rel=\"nofollow noreferrer\">Angular</a> says \"The HttpClient in @angular/common/http offers a simplified client HTTP API for Angular applications that rests on the XMLHttpRequest interface exposed by browsers.\" So, I guess that's not necessary? Constructor's already got <code>HttpClient</code> in it.</p></li>\n<li><p><code>this.Profile</code> seems pretty standard as JSON: <code>{id: testid, username: \"Mr Odour\", age: \"87\"}</code>. But maybe it's the problem. So I put it into <code>String()</code>. Then I dumped the response from the front end with Golang's <code>httputil.DumpRequest()</code>:</p>\n\n<pre><code>output, err := httputil.DumpRequest(req, true)\nif err != nil {\n    fmt.Println(\"Error dumping request:\", err)\n    return\n}\nfmt.Println(string(output))\n</code></pre>\n\n<p>This provided a bit more insight, maybe. It printed out:</p>\n\n<pre><code>POST /anteroom HTTP/1.1\nHost: localhost:12345\nAccept: application/json, text/plain, */*\nAccept-Encoding: gzip, deflate, br\nAccept-Language: en-US,en;q=0.9,en-GB;q=0.8\nConnection: keep-alive\nContent-Length: 15\nContent-Type: text/plain\nDnt: 1\nOrigin: http://localhost:4200\nReferer: http://localhost:4200/anteroom\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML,\n like Gecko) Chrome/71.0.3578.98 Safari/537.36\n</code></pre></li>\n</ul>\n\n<p>I think it came through? I'm not sure. It doesn't say 200 OK. Console does print \"POST Request is successful \", but without the <code>data</code>. I tried to read it with this in Golang:</p>\n\n<pre><code>body, err := ioutil.ReadAll(req.Body)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(body)\n</code></pre>\n\n<p>This produced <code>[]</code>. Empty.</p>\n\n<p>It also says <code>Content-Type: text/plain</code>. Is that the problem? Shouldn't it be <code>application/json</code>? But other people's code uses it the way it is, without <code>String()</code>, like <a href=\"https://www.concretepage.com/angular/angular-httpclient-post#Body\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>return this.http.post&lt;Article&gt;(this.url,\n     {\n    id: 100, \n    title: 'Java Functional Interface', \n    category: 'Java 8', \n    writer: 'Krishna'\n     }\n  );\n</code></pre>\n\n<ul>\n<li><p><em>Edit 17 Jan 19 12.45pm</em>: Billy suggests to use <code>Header().Add()</code> instead of <code>Header().Set()</code> like so:</p>\n\n<pre><code>res.Header().Add(\"Access-Control-Allow-Origin\", \"*\")\nres.Header().Add(\"Access-Control-Allow-Methods\", \"POST\")\nres.Header().Add(\"Access-Control-Allow-Methods\", \"OPTIONS\")\nres.Header().Add(\"Content-Type\", \"application/json\")\n</code></pre>\n\n<p>So, I did. Didn't work either.</p></li>\n</ul>\n\n<p>The back end seems ok. I posted to it with curl and it produces:</p>\n\n<pre><code>Connected to localhost (::1) port 12345 (#0)\n&gt; POST /anteroom HTTP/1.1\n&gt; Host: localhost:12345\n&gt; User-Agent: curl/7.47.1\n&gt; Accept: */*\n&gt; Content-Type: application/json\n&gt; Content-Length: 126\n&gt;\n} [126 bytes data]\n* upload completely sent off: 126 out of 126 bytes\n&lt; HTTP/1.1 200 OK\n*Edit 17 Jan 19 12.45pm*: Methods contains OPTIONS once the header is set in backend. So, no problem with curl this way.\n&lt; Access-Control-Allow-Methods: POST\n&lt; Access-Control-Allow-Origin: *\n&lt; Date: Tue, 15 Jan 2019 19:34:32 GMT\n&lt; Content-Length: 0\n</code></pre>\n\n<p>It also printed out <code>fmt.Println(member.ID)</code> and everything else from the JSON string just fine.</p>\n\n<p><em>Edit 17 Jan 19 13.25pm</em>: When I issue <code>curl -i -X OPTIONS http://localhost:12345/anteroom</code>, this comes back: \"Access-Control-Allow-Methods: POST, OPTIONS\". So OPTIONS is working. But front end request remains the same, no explicit 200 OK and JSON doesn't seem to go through even though console logs it as a success. The MIME type is listed as \"text/plain\" in response, but isn't that ok for JSON? As mentioned, other solutions use the same format and it works for them. I'm working on this part of the problem now.</p>\n\n<p>I'm new to Golang, TypeScript, and Angular, so I hope I'm posting all the relevant code. It seems like a popular problem so I looked through quite a handful of similar questions on here but still can't figure it out. What on earth have I missed?</p>\n"}, {"tags": ["go", "oauth", "server", "oauth-2.0", "access-token"], "comments": [{"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 0, "creation_date": 1547674568, "post_id": 54225301, "comment_id": 95277369, "body": "Which provider? For Google OAuth you need the Client ID, Client Secret and Refresh Token. With those three you can refresh an Access Token."}, {"owner": {"reputation": 123, "user_id": 2028254, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IzEMc.png?s=128&g=1", "display_name": "levye", "link": "https://stackoverflow.com/users/2028254/levye"}, "reply_to_user": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 0, "creation_date": 1547675586, "post_id": 54225301, "comment_id": 95277815, "body": "In my case the provider is Fitbit. But I believe Client ID, Client Secret, and Refresh Token is universal to refresh an access token for oAuth 2 standard right? So you suggest storing only refresh_token after the first authorization?"}, {"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 2, "creation_date": 1547676000, "post_id": 54225301, "comment_id": 95277984, "body": "Just those three items are required to generate a new access token. I wrote a couple of articles using curl to experiment with OAuth. <a href=\"https://www.jhanley.com/google-oauth-2-0-testing-with-curl-refresh-access-token/\" rel=\"nofollow noreferrer\">jhanley.com/&hellip;</a>"}, {"owner": {"reputation": 123, "user_id": 2028254, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IzEMc.png?s=128&g=1", "display_name": "levye", "link": "https://stackoverflow.com/users/2028254/levye"}, "reply_to_user": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 0, "creation_date": 1547679016, "post_id": 54225301, "comment_id": 95279152, "body": "Thanks, @JohnHanley So you basically suggest that, whenever the server starts a new query to API, the very first step should be refreshing the access token (actually generating a new one as we won&#39;t store access token) is that correct? (as we will have only client id, client secret and refresh token so we need to have  a access token)"}, {"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 3, "creation_date": 1547680247, "post_id": 54225301, "comment_id": 95279577, "body": "No, I am not saying that. I just meant that you only need those three items to refresh an access token. I recommend saving the access token for use until it expires and then refreshing."}, {"owner": {"reputation": 4945, "user_id": 1891133, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/DHTbb.png?s=128&g=1", "display_name": "Max", "link": "https://stackoverflow.com/users/1891133/max"}, "edited": false, "score": 0, "creation_date": 1547718153, "post_id": 54225301, "comment_id": 95290784, "body": "The diagram is wrong. You ask clients to authorize to API and THEN store tokens to SERVER."}, {"owner": {"reputation": 123, "user_id": 2028254, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IzEMc.png?s=128&g=1", "display_name": "levye", "link": "https://stackoverflow.com/users/2028254/levye"}, "reply_to_user": {"reputation": 4945, "user_id": 1891133, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/DHTbb.png?s=128&g=1", "display_name": "Max", "link": "https://stackoverflow.com/users/1891133/max"}, "edited": false, "score": 0, "creation_date": 1547754404, "post_id": 54225301, "comment_id": 95310823, "body": "@Max Diagram shows that clients authorize the API so that app can access the API for the client. I haven&#39;t shown all connections if it is not related to question. So yes client should authorize the API accessing the authorization server using the redirect URL provided by the app. You are right."}], "answers": [{"tags": [], "owner": {"reputation": 6658, "user_id": 731178, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/du44q.jpg?s=128&g=1", "display_name": "J&#225;n Hala\u0161a", "link": "https://stackoverflow.com/users/731178/j%c3%a1n-hala%c5%a1a"}, "is_accepted": false, "score": 1, "last_activity_date": 1547721393, "creation_date": 1547721393, "answer_id": 54234019, "question_id": 54225301, "link": "https://stackoverflow.com/questions/54225301/oauth-2-and-managing-multiple-user-access-tokens-for-server-side/54234019#54234019", "title": "OAuth 2 and managing multiple user access tokens for server side", "body": "<p>Since you need just a single token record for a user, the user table could be a good storage for it. You can consider creating a new one-to-one associated table for it, so you can apply any necessary constraints (not-null and such). You can also use any other safe storage.</p>\n\n<p>You must store the refresh token. Whether to store access tokens and their expiration times (from the <code>/token</code> endpoint response), depends on how often you fetch the patient data. If your scheduled task period is longer than the access token lifetime, then you don't need to keep them in a persistent storage. Otherwise, you can store them along with their refresh token. </p>\n\n<p>I don't think there is some general approach, since the solution depends on your requirements and architecture. You can consider storing the tokens in an encrypted form to improve security. I guess you do it with other patients sensitive data anyway.</p>\n\n<p>Just for clarification, the flow you are using is called the <a href=\"https://tools.ietf.org/html/rfc6749#section-4.1\" rel=\"nofollow noreferrer\">Authorization code grant</a>.</p>\n"}], "owner": {"reputation": 123, "user_id": 2028254, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IzEMc.png?s=128&g=1", "display_name": "levye", "link": "https://stackoverflow.com/users/2028254/levye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 804, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547721393, "creation_date": 1547672408, "question_id": 54225301, "link": "https://stackoverflow.com/questions/54225301/oauth-2-and-managing-multiple-user-access-tokens-for-server-side", "title": "OAuth 2 and managing multiple user access tokens for server side", "body": "<p>I have a server-side app (implemented in GO) which <strong>fetches</strong> user data <strong>from an external API.</strong> (<em>user data is stored by a 3rd party companies and they provide API to access it</em>.) I have actually two types of users. One of them is patients and other is a doctor. Doctor actor here is responsible for monitoring patient data. So the flow is, </p>\n\n<ol>\n<li>Patients (1..n) authorize the server-side application using OAuth2 grant access token flow.</li>\n<li>Server regularly fetch patient data via API and stores patient data on a local DB</li>\n<li>The doctor can check any patient data any time which has been stored on local DB</li>\n</ol>\n\n<p>Step 1 is easy. Implementing OAuth2 grant flow, I can get access_token and refresh_token for each user. Let's say I have 100 patients. I am assuming that I can obtain up-to-date access_token using refresh_token without patient interaction again. </p>\n\n<p><strong>Question is,</strong> After patient authorized the app, I need to store his/her access_token and refresh_token somewhere so that whenever server starts a scheduled job to fetch patient data, then the server can access external API using a valid token.  What is the general approach here? Should I store access_token and refresh_token on my user table and use them whenever needed?</p>\n\n<p>Since I have n patients (n tokens) and server can fetch external API anytime, then I need to find a consistent way to support this scenario. </p>\n\n<p>Please see the attached diagram for visualization.</p>\n\n<p>Thanks </p>\n\n<p><a href=\"https://i.stack.imgur.com/UxOWG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UxOWG.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["regex", "email", "google-app-engine", "go", "re2"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547741422, "post_id": 54225052, "comment_id": 95304423, "body": "I would consider an API using only a regex where one might want to exclude matches to be broken. Unfortunately there&#39;s not much you can do here."}, {"owner": {"reputation": 171, "user_id": 4527149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/856fd73864b4464722ebe2a10f2d6c79?s=128&d=identicon&r=PG&f=1", "display_name": "CdVr", "link": "https://stackoverflow.com/users/4527149/cdvr"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1595433243, "post_id": 54225052, "comment_id": 111474790, "body": "@JimB comment if there is any clue on this which would be helpful. Thanks!"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1610638663, "post_id": 54225052, "comment_id": 116201154, "body": "RE2 does not support lookarounds and will never support them."}], "owner": {"reputation": 45, "user_id": 2909394, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f8142e9c21b4ba7fa39fe44850e8cb7e?s=128&d=identicon&r=PG&f=1", "display_name": "John Zrobin", "link": "https://stackoverflow.com/users/2909394/john-zrobin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 976, "favorite_count": 0, "closed_date": 1610638706, "answer_count": 0, "score": 3, "last_activity_date": 1547709176, "creation_date": 1547671342, "last_edit_date": 1547709176, "question_id": 54225052, "link": "https://stackoverflow.com/questions/54225052/negative-lookahead-work-around-for-re2-syntax", "closed_reason": "Duplicate", "title": "Negative Lookahead work around for RE2 Syntax", "body": "<p>I was hoping to figure out how make re2 syntax work with a regular expression like the following:</p>\n\n<pre><code>(?!(support|help|admin|contact))@example\\.com\n</code></pre>\n\n<p>Where you do not match on <em>exactly</em> those terms above. </p>\n\n<p>For example, it should match:</p>\n\n<pre><code>test@example.com\nhello@example.com\n</code></pre>\n\n<p>but not match:</p>\n\n<pre><code>support@example.com\nhelp@example.com\n</code></pre>\n\n<p>i I cannot figure out a way for exactly those terms. I have seen a lot of work arounds where it requires you to test if it does match in golang/the re2 processer, and then return false. However this is not possible, because a service requires the regex, and I cannot ask it to alternate the match value.</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["json", "mongodb", "go", "nosql"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1547685014, "post_id": 54224955, "comment_id": 95280711, "body": "&quot;I can&#39;t convert docs into Json and use as a result in my Rest server.&quot; Why not? If you can do it for one value, you can also do it for a slice of such values with a simple loop. What&#39;s your question?"}, {"owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1547688267, "post_id": 54224955, "comment_id": 95281299, "body": "I agree with @Peter, what is your question?"}, {"owner": {"reputation": 33, "user_id": 10924534, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Sg1xzwN58m4/AAAAAAAAAAI/AAAAAAAAbVE/k-ZJgii39zs/photo.jpg?sz=128", "display_name": "Tomasz Makowski", "link": "https://stackoverflow.com/users/10924534/tomasz-makowski"}, "edited": false, "score": 0, "creation_date": 1547713024, "post_id": 54224955, "comment_id": 95288029, "body": "I&#39;ve just updated my post to explain why I can&#39;t use loop. GetAllCustomerBookings is returning value &quot;jsonDoc&quot; and server is giving it as a JSON."}], "answers": [{"comments": [{"owner": {"reputation": 1211, "user_id": 10051099, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-zEhaK71cFsM/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pY3uj2Rs4X15NaJSIsOYxNzX4COQ/mo/photo.jpg?sz=128", "display_name": "Yohei", "link": "https://stackoverflow.com/users/10051099/yohei"}, "edited": false, "score": 0, "creation_date": 1560849856, "post_id": 54242904, "comment_id": 99861552, "body": "You should be careful to handle <code>NaN</code>, because it raises error when <code>json.Marshal</code>"}], "tags": [], "owner": {"reputation": 33, "user_id": 10924534, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Sg1xzwN58m4/AAAAAAAAAAI/AAAAAAAAbVE/k-ZJgii39zs/photo.jpg?sz=128", "display_name": "Tomasz Makowski", "link": "https://stackoverflow.com/users/10924534/tomasz-makowski"}, "is_accepted": true, "score": 0, "last_activity_date": 1547896226, "last_edit_date": 1547896226, "creation_date": 1547752952, "answer_id": 54242904, "question_id": 54224955, "link": "https://stackoverflow.com/questions/54224955/convert-result-into-json-without-structs-using-mongo-go-driver/54242904#54242904", "title": "convert result into JSON without structs using mongo-go-driver", "body": "<p>This code works. After few hours of trying and thanks to good luck I managed to solve this issue. Maybe someone will explain this?</p>\n\n<p>Instead of <strong>bson.Raw</strong> I used <strong>bson.M</strong> and <strong>result.Decode()</strong> instead of <strong>result.DecodeBytes()</strong>\nNow I have the same output as nodejs gives me.</p>\n\n<pre><code> var docs []bson.M\n    for result.Next(ctx) {\n        var document bson.M\n        err = result.Decode(&amp;document)\n        if err != nil {\n            log.Println(err)\n        }\n        docs = append(docs, document)\n    }\n    return docs\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 10924534, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Sg1xzwN58m4/AAAAAAAAAAI/AAAAAAAAbVE/k-ZJgii39zs/photo.jpg?sz=128", "display_name": "Tomasz Makowski", "link": "https://stackoverflow.com/users/10924534/tomasz-makowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1841, "favorite_count": 0, "accepted_answer_id": 54242904, "answer_count": 1, "score": 1, "last_activity_date": 1547896226, "creation_date": 1547670890, "last_edit_date": 1547832582, "question_id": 54224955, "link": "https://stackoverflow.com/questions/54224955/convert-result-into-json-without-structs-using-mongo-go-driver", "title": "convert result into JSON without structs using mongo-go-driver", "body": "<p>I don't want to use structs before converting results into JSON. Let's say I have some results: </p>\n\n<pre><code>result, err := collection.Find(ctx, filter, options)\n</code></pre>\n\n<p>I can collect all results in <strong>docs</strong> variable and last result in <strong>doc</strong> variable:</p>\n\n<pre><code>    var doc bson.Raw\n    var docs []bson.Raw    \n    for result.Next(ctx) {\n            document, err := result.DecodeBytes()\n            if err != nil {\n                log.Println(err)\n            }\n            doc = document\n            docs = append(docs, doc)\n        }\n</code></pre>\n\n<p>I can easily convert last result into JSON without using any structs:</p>\n\n<pre><code>var jsonDoc bson.M\nerr = bson.Unmarshal(doc, &amp;jsonDoc)\nreturn jsonDoc\n</code></pre>\n\n<p>I can't convert docs into JSON and use as a result in my Rest server.</p>\n\n<p><strong>Update 2019-01-17:</strong></p>\n\n<p>I'm using result in my REST server like this:</p>\n\n<pre><code>user.GET(\"/booking/customer/:id\", func(c *gin.Context) {\n    result := GetAllCustomerBookings(c.Param(\"id\"))\n    c.JSON(http.StatusOK, result)\n})\n</code></pre>\n\n<p>so it can't be a loop through values.\nThe question: how to convert []bson.Raw to []byte or bson.Raw.\nLet's imagine that now I have {JSON} in each value of array. I need one JSON like this: [{JSON}, {JSON}, ...].</p>\n\n<p>Using nodejs was easier because I could send all records in one JSON document. Go and mongodb-go-driver needs to go through all records and I don't know how to build one JSON document.</p>\n\n<p><strong>Nodejs and mongodb equivalent:</strong></p>\n\n<pre><code>router.get('/bookings/customer/:id', function (req, res, next) {\n    db.Bookings.find({\n        \"booking.customer._id\": {\n            $eq: req.params.id\n        }\n    }).sort({\n            \"booking.arrival_date\": -1\n        },\n        function (err, bookings) {\n            if (err) {\n                res.send(err);\n            } else {\n                res.json(bookings);\n            }\n        });\n});\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 627, "user_id": 10081814, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6F_lJ08LDqA/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oxQPLc9kHyffxxEQqVKmEurgRSAw/mo/photo.jpg?sz=128", "display_name": "Evan Kim", "link": "https://stackoverflow.com/users/10081814/evan-kim"}, "edited": false, "score": 0, "creation_date": 1547669554, "post_id": 54224256, "comment_id": 95275084, "body": "So what my for loop is doing is adding a new key, e in <code>m[e]</code>, which you are saying starts with a default int value of 0. And then the <code>++</code> operator updating the value at <code>m[e]</code> with <code>m[e] + 1</code>?"}], "tags": [], "owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "is_accepted": true, "score": 4, "last_activity_date": 1547667958, "creation_date": 1547667958, "answer_id": 54224256, "question_id": 54224131, "link": "https://stackoverflow.com/questions/54224131/operator-for-map-key-loop-in-go/54224256#54224256", "title": "++ operator for map key loop in go", "body": "<p>The default value of <code>int</code> values in a <code>map</code> is <code>0</code>. So, when you iterate through <code>x</code> and call <code>m[e]++</code>, the expanded version would be</p>\n\n<pre><code>m[e] = m[e] + 1\n</code></pre>\n\n<p>In other words:</p>\n\n<pre><code>m[e] = 0 + 1\n</code></pre>\n\n<p>Of course, if a field repeats, it will already be in the map (with some value > 0).</p>\n\n<p>When you check the length of the map after the loop, it gives the number of unique fields in the string.</p>\n"}], "owner": {"reputation": 627, "user_id": 10081814, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6F_lJ08LDqA/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oxQPLc9kHyffxxEQqVKmEurgRSAw/mo/photo.jpg?sz=128", "display_name": "Evan Kim", "link": "https://stackoverflow.com/users/10081814/evan-kim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 54224256, "answer_count": 1, "score": 1, "last_activity_date": 1547667958, "creation_date": 1547667379, "question_id": 54224131, "link": "https://stackoverflow.com/questions/54224131/operator-for-map-key-loop-in-go", "title": "++ operator for map key loop in go", "body": "<p>I am following the Go tutorial here <a href=\"https://tour.golang.org/moretypes/23\" rel=\"nofollow noreferrer\">https://tour.golang.org/moretypes/23</a> and have modified the exercise a little bit to try to dig deeper.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc WordCount(s string) map[string]int {\n    m := make(map[string]int)\n    x := strings.Fields(s)\n    for _, e := range x {\n        m[e]++\n    }\n\n    return m\n}\n\nfunc main() {\n    phrase := \"The quick brown fox\"\n    fmt.Println(WordCount(phrase), \"length:\", len(WordCount(phrase)))\n}\n</code></pre>\n\n<p>What doesn't make sense to me is how the ++ operator works in this context when adding new elements to the map. </p>\n\n<blockquote>\n  <p>Definition of ++ operator: Increment operator. It increases the integer value by one.</p>\n</blockquote>\n\n<p>In this context, the ++ operator increasing the integer value of the LENGTH of the map and then adding the e element to the new map length?</p>\n"}, {"tags": ["go", "gofmt"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547709050, "post_id": 54223855, "comment_id": 95286275, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/54169068/does-converting-a-string-to-a-float-lose-precision\">Does converting a string to a float lose precision?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 173, "user_id": 5377850, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jv1yt.jpg?s=128&g=1", "display_name": "Devyzr", "link": "https://stackoverflow.com/users/5377850/devyzr"}, "edited": false, "score": 0, "creation_date": 1547666934, "post_id": 54223917, "comment_id": 95273909, "body": "Ah, crud. I don&#39;t know why I didn&#39;t see that. I went through the docs to avoid exactly this. However, it doesn&#39;t explain why the precision changes when I use %v or %g, as stated in the question."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 173, "user_id": 5377850, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jv1yt.jpg?s=128&g=1", "display_name": "Devyzr", "link": "https://stackoverflow.com/users/5377850/devyzr"}, "edited": false, "score": 1, "creation_date": 1547668285, "post_id": 54223917, "comment_id": 95274518, "body": "The rest of the docs do, specifically that <code>%v</code> uses the &quot;default format&quot; which for &quot;float32, complex64, etc&quot; is <code>%g</code>, and that (regarding default precision) &quot;for %g it is the smallest number of digits necessary to identify the value uniquely&quot;"}, {"owner": {"reputation": 173, "user_id": 5377850, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jv1yt.jpg?s=128&g=1", "display_name": "Devyzr", "link": "https://stackoverflow.com/users/5377850/devyzr"}, "edited": false, "score": 0, "creation_date": 1547673243, "post_id": 54223917, "comment_id": 95276777, "body": "Thanks a lot Adrian! I don&#39;t know how I missed this, I&#39;ll blame the lack of morning coffee."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 173, "user_id": 5377850, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jv1yt.jpg?s=128&g=1", "display_name": "Devyzr", "link": "https://stackoverflow.com/users/5377850/devyzr"}, "edited": false, "score": 1, "creation_date": 1547733743, "post_id": 54223917, "comment_id": 95299648, "body": "<code>fmt</code> has very thorough docs but they could definitely use a rewrite. It&#39;s full of internal references with no anchor links and details buried in the middle of a paragraph. It&#39;s unfortunate given how much use the package gets."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1547668312, "last_edit_date": 1547668312, "creation_date": 1547666511, "answer_id": 54223917, "question_id": 54223855, "link": "https://stackoverflow.com/questions/54223855/fmt-printff-n-x-rounds-a-float64-to-float32-but-fmt-printlnx-doesnt/54223917#54223917", "title": "fmt.Printf(&quot;%f\\n&quot;,x) rounds a Float64 to Float32, but fmt.Println(x) doesn&#39;t", "body": "<p><a href=\"https://golang.org/pkg/fmt/#hdr-Printing\" rel=\"nofollow noreferrer\">From the docs</a>:</p>\n\n<blockquote>\n  <p>The default precision for %e, %f and %#g is 6; for %g it is the smallest number of digits necessary to identify the value uniquely.</p>\n</blockquote>\n"}], "owner": {"reputation": 173, "user_id": 5377850, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jv1yt.jpg?s=128&g=1", "display_name": "Devyzr", "link": "https://stackoverflow.com/users/5377850/devyzr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 54223917, "answer_count": 1, "score": -6, "last_activity_date": 1547745840, "creation_date": 1547666188, "last_edit_date": 1547745840, "question_id": 54223855, "link": "https://stackoverflow.com/questions/54223855/fmt-printff-n-x-rounds-a-float64-to-float32-but-fmt-printlnx-doesnt", "title": "fmt.Printf(&quot;%f\\n&quot;,x) rounds a Float64 to Float32, but fmt.Println(x) doesn&#39;t", "body": "<p>I was working on some tests with dictionaries, to do this I print out the Float64 values I want from a database in a format to copy and paste them into my test struct array, but when my tests failed I noticed that the values differ, but only by <code>0.0000000000002</code></p>\n\n<p>Then, to check the value I wrote the following in a loop:</p>\n\n<pre><code>fmt.Printf(\"%f\\n\",value)\nfmt.Println(value)\n</code></pre>\n\n<p>And I got the following values back:</p>\n\n<pre><code>702.200000\n702.1999999999998\n5683.090000\n5683.089999999998\n975.300000\n975.3\n</code></pre>\n\n<p>I checked the docs and saw nothing that indicates that there's special notation for Float64 or that %f will replace Float64 for a Float32, however, I don't get the problem when I use <code>%v</code> or <code>%g</code> and the docs specify that they'll use <code>%f</code> when appropriate.</p>\n\n<p>I don't get the problem when I specify a precision of 12 using <code>%.12f</code> either, but no default precision is specified in the docs.</p>\n\n<p>Why does this happen?</p>\n\n<p>EDIT: This is the same issue as the duplicate, but I believe Adrien's explanation about it is more detailed.</p>\n"}, {"tags": ["go", "parquet", "amazon-athena"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1547665558, "last_edit_date": 1547665558, "creation_date": 1547665232, "answer_id": 54223615, "question_id": 54223547, "link": "https://stackoverflow.com/questions/54223547/whats-the-format-of-timestamp-to-write-parquet-file-in-go/54223615#54223615", "title": "What&#39;s the format of timestamp to write parquet file in go", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    type example struct {\n        CreatedAt int64 `parquet:\"name=created_at,type=TIMESTAMP_MILLIS\"`\n    }\n\n    ex := example{}\n    ex.CreatedAt = time.Now().UnixNano() / int64(time.Millisecond)\n    fmt.Println(ex.CreatedAt)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/ePOlUKiT6fD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ePOlUKiT6fD</a></p>\n\n<p>Output:</p>\n\n<pre><code>1257894000000\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 6469609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5565667ff23f44196fd7eba5e519553?s=128&d=identicon&r=PG&f=1", "display_name": "Piyush Agrawal", "link": "https://stackoverflow.com/users/6469609/piyush-agrawal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 485, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1547665558, "creation_date": 1547664902, "last_edit_date": 1547665370, "question_id": 54223547, "link": "https://stackoverflow.com/questions/54223547/whats-the-format-of-timestamp-to-write-parquet-file-in-go", "title": "What&#39;s the format of timestamp to write parquet file in go", "body": "<p>I am trying to write a Go struct in a Parquet file and upload to S3. What format and type do I specify for timestamp parameter in the struct so that athena displays correct timestamp when reading from the parquet file. </p>\n\n<pre><code>type example struct {\n     ID              int64  `parquet:\"name=id, type=INT64\"`\n     CreatedAt       int64  `parquet:\"name=created_at,type=TIMESTAMP_MILLIS\"`\n}\n\nex := example{}\nex.ID = int64(10)\nex.CreatedAt = time.Now().Unix()\n\nfw, err := ParquetFile.NewLocalFileWriter(\"new.parquet\")\npw, err := ParquetWriter.NewParquetWriter(fw, new(example), 1)\npw.Write(ex)\n\nUpload the file new.parquet to S3\n</code></pre>\n\n<p>Reference - <a href=\"https://github.com/xitongsys/parquet-go\" rel=\"nofollow noreferrer\">https://github.com/xitongsys/parquet-go</a>. I created a table in Athena with int and timestamp field for the same and trying querying the table. The date is showing something like - 1970-01-18 21:54:23.751. \nwhich no where matches the current timestamp. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1547660960, "post_id": 54222371, "comment_id": 95271104, "body": "Related / possible duplicate of <a href=\"https://stackoverflow.com/questions/41978101/check-if-key-exists-in-multiple-maps-in-one-condition/41978277#41978277\">Check if key exists in multiple maps in one condition</a>."}, {"owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1547661789, "post_id": 54222371, "comment_id": 95271515, "body": "Is it? I&#39;m looking in the same map"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1547660380, "creation_date": 1547660380, "answer_id": 54222532, "question_id": 54222371, "link": "https://stackoverflow.com/questions/54222371/using-or-logic-when-checking-for-multiple-keys-in-mapstringinterface/54222532#54222532", "title": "Using OR logic when checking for multiple keys in map[string]interface{}", "body": "<p>Test for both keys:</p>\n\n<pre><code>columnsOrRows, ok := mapped[\"columns\"].([]interface{})\nif !ok {\n    columnsOrRows, ok = mapped[\"rows\"].([]interface{})\n}\n\nif ok {\n    for _, columnOrRow := range columnsOrRows {\n        if columnOrRowValueIsString, ok = columnOrRow.(string); ok {\n            columnOrRowArray = append(columnOrRowArray, columnOrRowValueIsString)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16221, "user_id": 340128, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b0d73eeb11b1cd6de0c09746aacb41be?s=128&d=identicon&r=PG", "display_name": "Variant", "link": "https://stackoverflow.com/users/340128/variant"}, "is_accepted": false, "score": 1, "last_activity_date": 1589378371, "creation_date": 1589378371, "answer_id": 61776637, "question_id": 54222371, "link": "https://stackoverflow.com/questions/54222371/using-or-logic-when-checking-for-multiple-keys-in-mapstringinterface/61776637#61776637", "title": "Using OR logic when checking for multiple keys in map[string]interface{}", "body": "<p>I had to perform a broader check. Check if any of possible keys (more than 2) exist in the map. Ended up writing a utility function to accomplish the task and have the code remain readable.</p>\n\n<pre><code>func StringInSlice(s string, list []string) bool {\n    for _, item := range list {\n        if item == s {\n            return true\n        }\n    }\n    return false\n}\n\nfunc AnyKeyInMap(keys []string, keyMap map[string]interface{}) bool {\n    for k := range keyMap {\n        if StringInSlice(k, keys) {\n            return true\n        }\n    }\n    return false\n}\n</code></pre>\n\n<p>The usage is:</p>\n\n<pre><code>mapped := make(map[string]interface{})\nmapped[\"rows\"] = true\nif AnyKeyInMap([]string{\"rows\", \"columns\"}, mapped) {\n    fmt.Println(\"exists\")\n}\n</code></pre>\n\n<p>You can play with it here:\n<a href=\"https://play.golang.org/p/pz64YidEGMK\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pz64YidEGMK</a></p>\n"}], "owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 583, "favorite_count": 0, "accepted_answer_id": 54222532, "answer_count": 2, "score": -2, "last_activity_date": 1589378371, "creation_date": 1547659840, "question_id": 54222371, "link": "https://stackoverflow.com/questions/54222371/using-or-logic-when-checking-for-multiple-keys-in-mapstringinterface", "title": "Using OR logic when checking for multiple keys in map[string]interface{}", "body": "<p>I have a map[string]interface{} called mapped:</p>\n\n<pre><code>mapped map[stringinterface{}\n</code></pre>\n\n<p>I want to iterate through it checking to see if either of these keys exist:</p>\n\n<ul>\n<li>columns</li>\n<li>rows</li>\n</ul>\n\n<p>Then if so, I want to append the row or column to a slice of strings called:</p>\n\n<ul>\n<li>columnOrRowArray</li>\n</ul>\n\n<p>I understand that if I just needed to find, for example columns, within mapped I can do this:</p>\n\n<pre><code>var columnOrRowArray []string\n\nif columnsOrRows, ok := mapped[\"columns\"].([]interface{}); ok {\n    for _, columnOrRow := range columnsOrRows {\n        if columnOrRowValueIsString, ok = columnOrRow.(string); ok {\n            columnOrRowArray = append(columnOrRowArray, columnOrRowValueIsString)\n        }\n    }\n}\n</code></pre>\n\n<p><strong>What would be a clean way without me duplicating the above for using row logic for the mapped[\"rows\"]?</strong></p>\n\n<p>I want to do something that is basically this:</p>\n\n<pre><code>columnsOrRows, ok := mapped[\"columns\"].([]interface{}) || mapped[\"rows\"].([]interface{}); ok {\n</code></pre>\n\n<p>So in plain English, \"if mapped has a the column or row key, assign to variable columnsOrRows\"</p>\n\n<p>Obviously I know the syntax for that is wrong, but I can't find an example of someone doing this</p>\n"}, {"tags": ["json", "go", "struct", "unmarshalling"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1547655607, "post_id": 54221121, "comment_id": 95268181, "body": "Use a map, ie <code>map[string]Inside</code>."}, {"owner": {"reputation": 1357, "user_id": 3201684, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fce047896b7ee0a2f6967156e339521f?s=128&d=identicon&r=PG&f=1", "display_name": "ntonnelier", "link": "https://stackoverflow.com/users/3201684/ntonnelier"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1547655759, "post_id": 54221121, "comment_id": 95268268, "body": "you mean in the var @mkopriva ? var map[string]Inside ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1547656160, "post_id": 54221121, "comment_id": 95268520, "body": "<a href=\"https://play.golang.com/p/pPNflEMnWlY\" rel=\"nofollow noreferrer\">play.golang.com/p/pPNflEMnWlY</a>"}, {"owner": {"reputation": 1357, "user_id": 3201684, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fce047896b7ee0a2f6967156e339521f?s=128&d=identicon&r=PG&f=1", "display_name": "ntonnelier", "link": "https://stackoverflow.com/users/3201684/ntonnelier"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1547658912, "post_id": 54221121, "comment_id": 95270054, "body": "thanks @mkopriva, that worked"}], "owner": {"reputation": 1357, "user_id": 3201684, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fce047896b7ee0a2f6967156e339521f?s=128&d=identicon&r=PG&f=1", "display_name": "ntonnelier", "link": "https://stackoverflow.com/users/3201684/ntonnelier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "closed_date": 1547655876, "answer_count": 0, "score": 0, "last_activity_date": 1618408624, "creation_date": 1547655289, "last_edit_date": 1618408624, "question_id": 54221121, "link": "https://stackoverflow.com/questions/54221121/unmarshall-json-using-dynamic-key", "closed_reason": "Duplicate", "title": "unmarshall json using dynamic key", "body": "<p>I'm receiving a <code>json</code> object that has a known-static structure inside a key that varies between 10 different values.</p>\n<p>Consider <code>lastname</code> can be any in a list of 10 lastnames:</p>\n<pre><code>var lastnames = [...]string { &quot;Smith&quot;, &quot;Johnson&quot;, &quot;Williams&quot;, &quot;Brown&quot;, &quot;Jones&quot;, &quot;Miller&quot;, &quot;Davis&quot;, &quot;Garcia&quot;, &quot;Rodriguez&quot;, &quot;Wilson&quot; }\n</code></pre>\n<p>Now, this is how the <code>json</code> looks:</p>\n<pre><code>{ \n  (lastname here): \n    {\n        &quot;position&quot;: value,\n        &quot;user_email&quot;: value\n    }\n}\n</code></pre>\n<p>I tried to unmarshall it using the following structs, but I only get null values:</p>\n<pre><code>type Inside struct {\n    Rol   string   `json:&quot;position&quot;`\n    Email   string   `json:&quot;user_email&quot;`\n}\n\ntype Outside struct {\n    Key Inside\n}\n\n...\nvar outside Outside\njson.Unmarshal([]byte(body), &amp;outside)\n</code></pre>\n<p>Is it possible to unmarshall this directly without creating 10 different structs? Is there possible workaround?</p>\n"}, {"tags": ["go", "kubernetes", "configmap"], "answers": [{"comments": [{"owner": {"reputation": 575, "user_id": 1393136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70cefa201e790be5d2d4204b06d60b62?s=128&d=identicon&r=PG", "display_name": "Amudhan", "link": "https://stackoverflow.com/users/1393136/amudhan"}, "edited": false, "score": 1, "creation_date": 1547879054, "post_id": 54246759, "comment_id": 95353103, "body": "Sorry, but NO. I don&#39;t want to reload the deployment/application. I want the application to get the notification so that it can do some dynamic update of its state."}], "tags": [], "owner": {"reputation": 186, "user_id": 8802912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce8e7f0f7a0b1f9c1404cce15aeeea09?s=128&d=identicon&r=PG&f=1", "display_name": "Cindy", "link": "https://stackoverflow.com/users/8802912/cindy"}, "is_accepted": false, "score": 2, "last_activity_date": 1547776435, "creation_date": 1547776435, "answer_id": 54246759, "question_id": 54220143, "link": "https://stackoverflow.com/questions/54220143/how-to-get-notification-inside-an-application-in-kubernetes-when-configmaps-get/54246759#54246759", "title": "How to get notification inside an application in kubernetes when configmaps get updated", "body": "<p>Sounds like the <a href=\"https://github.com/stakater/Reloader\" rel=\"nofollow noreferrer\">Reloader</a> is the one you are looking for. It will watch the configmap/secret and update the deployment related to it.</p>\n"}, {"comments": [{"owner": {"reputation": 575, "user_id": 1393136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70cefa201e790be5d2d4204b06d60b62?s=128&d=identicon&r=PG", "display_name": "Amudhan", "link": "https://stackoverflow.com/users/1393136/amudhan"}, "edited": false, "score": 1, "creation_date": 1551949471, "post_id": 55029514, "comment_id": 96830622, "body": "Thank you! This is exactly what I wanted. I haven&#39;t tested it yet, but it clearly describes the problem I was facing and solves the exact thing! I was using Viper library only, but was using an older version. The link you pointed it out gives proper information and looks like all the releases after 1.3.0 will have this feature/fix."}], "tags": [], "owner": {"reputation": 4312, "user_id": 274811, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94807cb89f41f2a6dcc48ba70b95f839?s=128&d=identicon&r=PG", "display_name": "webwurst", "link": "https://stackoverflow.com/users/274811/webwurst"}, "is_accepted": true, "score": 6, "last_activity_date": 1551895282, "creation_date": 1551895282, "answer_id": 55029514, "question_id": 54220143, "link": "https://stackoverflow.com/questions/54220143/how-to-get-notification-inside-an-application-in-kubernetes-when-configmaps-get/55029514#55029514", "title": "How to get notification inside an application in kubernetes when configmaps get updated", "body": "<p>You might be experience a problem <a href=\"https://medium.com/@xcoulon/kubernetes-configmap-hot-reload-in-action-with-viper-d413128a1c9a\" rel=\"noreferrer\">like this</a>:</p>\n\n<blockquote>\n  <p>When a ConfigMap changes, the real path to the config files it contains changed, but this is kinda \u201chidden\u201d by 2 levels of symlinks: [..]</p>\n</blockquote>\n\n<p>So it seems you need to follow the chain of symlinks and watch that. Since your application is written in <code>go</code> you could just use <a href=\"https://github.com/spf13/viper\" rel=\"noreferrer\"><code>spf13/viper</code></a> since the feature <a href=\"https://github.com/spf13/viper/commit/e0f7631cf3ac7e7530949c7e154855076b0a4c17\" rel=\"noreferrer\">WatchConfig and Kubernetes</a> was added.</p>\n\n<p>Alternatively you can get notified by the Kubernetes API on <a href=\"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.13/#list-configmap-v1-core\" rel=\"noreferrer\">changes of a ConfigMap</a>. This requires configuring some <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/rbac/#role-examples\" rel=\"noreferrer\">access rules</a> upfront most probably. </p>\n"}], "owner": {"reputation": 575, "user_id": 1393136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70cefa201e790be5d2d4204b06d60b62?s=128&d=identicon&r=PG", "display_name": "Amudhan", "link": "https://stackoverflow.com/users/1393136/amudhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1765, "favorite_count": 1, "accepted_answer_id": 55029514, "answer_count": 2, "score": 7, "last_activity_date": 1551895282, "creation_date": 1547651842, "question_id": 54220143, "link": "https://stackoverflow.com/questions/54220143/how-to-get-notification-inside-an-application-in-kubernetes-when-configmaps-get", "title": "How to get notification inside an application in kubernetes when configmaps get updated", "body": "<p>I have an application running inside <code>kubernetes</code> which has a file mounted through <code>configmaps</code>. Now, from inside the application I want to perform some action when this file (from configmap) gets updated (lets say through <code>kubectl update configmaps xyz</code> command).</p>\n\n<p>Lets say I have created a configmap using the following command:</p>\n\n<pre><code>kubectl create configmap myy-config --from-file=config.json\n</code></pre>\n\n<p>and I have my Deployment created like this:</p>\n\n<pre><code>apiVersion: apps/v1beta2\nkind: Deployment\nmetadata:\n  name: myapp\nspec:\n  selector:\n    matchLabels:\n      app: myapp\n  template:\n    metadata:\n      labels:\n        app: myapp\n    spec:\n      containers:\n        -\n          image: \"xyz\"\n          name: myapp\n          ports:\n            -\n              containerPort: 5566\n          volumeMounts:\n            -\n              mountPath: /myapp/config\n              name: config\n      dnsPolicy: ClusterFirstWithHostNet\n      volumes:\n        -\n          name: config\n          configMap:\n            name: my-config\n</code></pre>\n\n<p>Now, if I do <code>kubectl exec -it &lt;pod&gt; sh</code> I can see the file. If I edit the configmap using <code>kubectl edit configmap my-config</code> and change the content, the application running in my pod doesn't get the file changed notification. I am using GO Lang for the application and it doesn't receive the fsnotify on the file <code>/myapp/config/config.json</code> even though I can see that after the edit, the file has changed.</p>\n\n<p>If I run the same application in my laptop, of course, the code gets the fsnotify and my application updates it configuration. The same code from within the kubernetes with the file coming from configmap, it doesn't work. I have read other SOF questions <a href=\"https://stackoverflow.com/questions/37317003/restart-pods-when-configmap-updates-in-kubernetes\">like this</a> and various others, but nothing specifically has solution for the problem I face.</p>\n\n<p>I understand that the file (which comes from the configmap) is a symlink and the actual file is in a folder called <code>..data/config.json</code>. I tried to add that file also, but still not getting the fsnotify signal. Is it possible to get fsnotify signal for files which come from configmap (as well as secrets) within the application? If so, can someone please help me and show how to do it (preferably in GO lang)?</p>\n"}, {"tags": ["database", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 2, "last_activity_date": 1547634577, "creation_date": 1547634577, "answer_id": 54215073, "question_id": 54214697, "link": "https://stackoverflow.com/questions/54214697/how-to-write-in-a-specif-db-schema-with-gorm/54215073#54215073", "title": "How to write in a specif db schema with gorm?", "body": "<p>In the <code>gorm</code> you can denote the schema in the <code>TableName()</code> method of your struct, for example:</p>\n\n<pre><code>type Person struct {\n    gorm.Model\n    Name string\n    Age  int\n}\n\nfunc (Person) TableName() string {\n    return \"people.persons\"\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 9590983, "user_type": "registered", "profile_image": "https://graph.facebook.com/1691291087629366/picture?type=large", "display_name": "Alex Colussi", "link": "https://stackoverflow.com/users/9590983/alex-colussi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1024, "favorite_count": 0, "accepted_answer_id": 54215073, "answer_count": 1, "score": 1, "last_activity_date": 1548631414, "creation_date": 1547633327, "last_edit_date": 1548631414, "question_id": 54214697, "link": "https://stackoverflow.com/questions/54214697/how-to-write-in-a-specif-db-schema-with-gorm", "title": "How to write in a specif db schema with gorm?", "body": "<p>I am new at golang. I am trying to write in a specific database schema using GORM and database/sql package.\nHere is my struct</p>\n\n<pre><code>type Person struct {\ngorm.Model\nName                string    \nAge                 int    \n}\n</code></pre>\n\n<p>and my function to write in db is:</p>\n\n<pre><code>func writedb(){\n\npsqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\" password=%s dbname=%s sslmode=disable\", host, port, user, password, dbname)\n    db, err := gorm.Open(\"postgres\", psqlInfo)\n    if err != nil {\n        panic(err)\n        fmt.Println(\"N\u00e3o conectou-se ao BANCO DE DADOS\")\n    }\n    defer db.Close()\n\n    db.AutoMigrate(&amp;Person{})\n\n    //t := time.Now()\n    //ts := t.Format(\"2006-01-02 15:04:05\")\n\n    db.Create(&amp;Person{Name : \"alex\", Age: 20})\n\n\n}\n</code></pre>\n\n<p>My db is structured like this\ndatabaseName\n--schemaPeople\n--schemaVehicle\n--schemaPublic</p>\n\n<p>When I compile, the data inserted goes to an new table in public schema, I want to insert an row in people schema. What am I doing wrong? Am I declaring the struct wrong? How I set the specific schema??</p>\n"}, {"tags": ["amazon-web-services", "unit-testing", "go"], "answers": [{"tags": [], "owner": {"reputation": 6491, "user_id": 410823, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/08ab32adfbfa32a2f52733864c72c0e6?s=128&d=identicon&r=PG", "display_name": "Skarab", "link": "https://stackoverflow.com/users/410823/skarab"}, "is_accepted": false, "score": 0, "last_activity_date": 1548333358, "creation_date": 1548333358, "answer_id": 54346846, "question_id": 54214305, "link": "https://stackoverflow.com/questions/54214305/mock-aws-api-gateway-request-and-dynamodb-for-golang-lambda-function-unit-test/54346846#54346846", "title": "Mock AWS API Gateway request and DynamoDB for Golang Lambda function unit Test", "body": "<p>Please, check whether running dynamo-db in a docker will not help you to implement your test.</p>\n\n<p>Check: <a href=\"https://stackoverflow.com/questions/48926260/connecting-aws-sam-local-with-dynamodb-in-docker\">connecting AWS SAM Local with dynamodb in docker</a></p>\n\n<p>You can also, quite easily, pass the event to handler in your test. </p>\n"}, {"tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1548994530, "creation_date": 1548994530, "answer_id": 54472804, "question_id": 54214305, "link": "https://stackoverflow.com/questions/54214305/mock-aws-api-gateway-request-and-dynamodb-for-golang-lambda-function-unit-test/54472804#54472804", "title": "Mock AWS API Gateway request and DynamoDB for Golang Lambda function unit Test", "body": "<p>While mocking is a viable option, you may also consider e2e testing with dedicated aws account, find some examples including dynamodb, and api gateway</p>\n\n<p><a href=\"https://github.com/adrianwit/serverless_e2e/tree/master/lambda\" rel=\"nofollow noreferrer\">lambda_e2e</a></p>\n"}, {"tags": [], "owner": {"reputation": 25525, "user_id": 750510, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/6995f16e417430a024c8413ae2d4aca1?s=128&d=identicon&r=PG", "display_name": "madhead", "link": "https://stackoverflow.com/users/750510/madhead"}, "is_accepted": false, "score": 0, "last_activity_date": 1569689823, "creation_date": 1569689823, "answer_id": 58148477, "question_id": 54214305, "link": "https://stackoverflow.com/questions/54214305/mock-aws-api-gateway-request-and-dynamodb-for-golang-lambda-function-unit-test/58148477#58148477", "title": "Mock AWS API Gateway request and DynamoDB for Golang Lambda function unit Test", "body": "<p>In addition to <a href=\"https://stackoverflow.com/a/54472804/750510\">Adrian's answer</a>:</p>\n\n<p>Take a look at <a href=\"https://github.com/localstack/localstack\" rel=\"nofollow noreferrer\">LocalStack</a>. It provides an easy-to-use test/mocking framework for developing AWS-related applications by spinning up the AWS-compatible APIs on your local machine or in Docker. It supports two dozen of AWS APIs and DynamoDB and Lambda are among them. It is really a great tool for functional testing without using a separate AWS environment for that.</p>\n"}, {"tags": [], "owner": {"reputation": 2341, "user_id": 279554, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/b98e2ecb4b9303349598da6c06436dd6?s=128&d=identicon&r=PG", "display_name": "Jaydeep Patel", "link": "https://stackoverflow.com/users/279554/jaydeep-patel"}, "is_accepted": false, "score": 1, "last_activity_date": 1581656967, "creation_date": 1581656967, "answer_id": 60220318, "question_id": 54214305, "link": "https://stackoverflow.com/questions/54214305/mock-aws-api-gateway-request-and-dynamodb-for-golang-lambda-function-unit-test/60220318#60220318", "title": "Mock AWS API Gateway request and DynamoDB for Golang Lambda function unit Test", "body": "<p>Although this question is bit old. I was also facing same issue and found below resources. Putting it here for the benefit of others. These resources show how to write tastable lambdas in golang. </p>\n\n<ol>\n<li><p><a href=\"https://ewanvalentine.io/how-im-writing-serverless-services-in-golang-these-days/\" rel=\"nofollow noreferrer\">https://ewanvalentine.io/how-im-writing-serverless-services-in-golang-these-days/</a>\nCode - <a href=\"https://github.com/EwanValentine/serverless-api-example\" rel=\"nofollow noreferrer\">https://github.com/EwanValentine/serverless-api-example</a></p></li>\n<li><p><a href=\"https://dev.to/prozz/serverless-in-go-how-to-write-testable-lambdas-4925\" rel=\"nofollow noreferrer\">https://dev.to/prozz/serverless-in-go-how-to-write-testable-lambdas-4925</a>\nCode - <a href=\"https://dev.to/prozz/serverless-in-go-how-to-write-testable-lambdas-4925\" rel=\"nofollow noreferrer\">https://dev.to/prozz/serverless-in-go-how-to-write-testable-lambdas-4925</a></p></li>\n<li><p><a href=\"https://github.com/jboursiquot/serverless-go-orchestration-on-aws-course/wiki/Hands-On:-Writing-and-testing-your-Go-Lambdas\" rel=\"nofollow noreferrer\">https://github.com/jboursiquot/serverless-go-orchestration-on-aws-course/wiki/Hands-On:-Writing-and-testing-your-Go-Lambdas</a>\nCode - <a href=\"https://github.com/jboursiquot/shoutouts\" rel=\"nofollow noreferrer\">https://github.com/jboursiquot/shoutouts</a></p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 3576, "user_id": 1484017, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Iwf8A.jpg?s=128&g=1", "display_name": "Yogesh", "link": "https://stackoverflow.com/users/1484017/yogesh"}, "is_accepted": false, "score": 0, "last_activity_date": 1583233719, "creation_date": 1583233719, "answer_id": 60505905, "question_id": 54214305, "link": "https://stackoverflow.com/questions/54214305/mock-aws-api-gateway-request-and-dynamodb-for-golang-lambda-function-unit-test/60505905#60505905", "title": "Mock AWS API Gateway request and DynamoDB for Golang Lambda function unit Test", "body": "<p>The question is bit old now but you could run <a href=\"https://github.com/dwmkerr/docker-dynamodb\" rel=\"nofollow noreferrer\">dynamodb locally</a> and use this <a href=\"https://github.com/yogeshlonkar/aws-lambda-go-test\" rel=\"nofollow noreferrer\">aws-lambda-go-test</a> module which can run lambda locally and can be used to test the actual response from lambda</p>\n\n<p>full disclosure I forked and upgraded this module</p>\n"}, {"tags": [], "owner": {"reputation": 408, "user_id": 2176086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd5bf0bad1687cf998f2a1b2ae9604c4?s=128&d=identicon&r=PG", "display_name": "Izabela Skibinska", "link": "https://stackoverflow.com/users/2176086/izabela-skibinska"}, "is_accepted": false, "score": 6, "last_activity_date": 1593358223, "last_edit_date": 1593358223, "creation_date": 1592970415, "answer_id": 62547275, "question_id": 54214305, "link": "https://stackoverflow.com/questions/54214305/mock-aws-api-gateway-request-and-dynamodb-for-golang-lambda-function-unit-test/62547275#62547275", "title": "Mock AWS API Gateway request and DynamoDB for Golang Lambda function unit Test", "body": "<p>The way I do it is to pass dependencies in pointer receiver (since the handler's signature is limited) and use interfaces. Each service has corresponding interface. For dynamodb - dynamodbiface . So in your case in lambda itself\nyou need to define a receiver:</p>\n<pre><code>type myReceiver struct {\n    dynI dynamodbiface.DynamoDBAPI\n}\n\n</code></pre>\n<p>change main to:</p>\n<pre><code>func main() {\n\n    sess := session.Must(session.NewSession(&amp;aws.Config{\n        Region: aws.String(&quot;your region&quot;)},\n    ))\n\n    inj := myReceiver{\n        dyn: dynamodb.New(sess),\n    }\n    lambda.Start(inj.CreateJobCommand)\n</code></pre>\n<p>change handler to</p>\n<pre><code>func (inj *myReceiver) CreateJobCommand(req events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error)\n</code></pre>\n<p>and all subsequent calls to dynamodb APIs would need to be to through interface:</p>\n<pre><code>    _, err = inj.dynI.PutItem(input)\n\n</code></pre>\n<p>Then in your test function you need to mock the responses:</p>\n<pre><code>\n type mockDynamo struct {\n    dynI dynamodbiface.DynamoDBAPI\n    dynResponse dynamodb.PutItemOutput\n\n} \n\nfunc (mq mockDynamo) PutItem (in *dynamodb.PutItemInput) (*dynamodb.PutItemOutput , error) {\n    return &amp;dynamodv.dynResponse, nil\n}\n\n\n        m1: = mockDynamo {\n\n            dynResponse : dynamodb.PutItemOutput{\n            \n            some mocked output\n        } \n\n\n        inj := myReceiver{\n            dyn: m1,         \n        }\n\n     inj.CreateJobCommand(some mocked data  for APIGateway request)\n</code></pre>\n"}], "owner": {"reputation": 2344, "user_id": 1127683, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/a76519a679f758a73ba52aba846b14f6?s=128&d=identicon&r=PG", "display_name": "GreenyMcDuff", "link": "https://stackoverflow.com/users/1127683/greenymcduff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1654, "favorite_count": 0, "answer_count": 6, "score": 4, "last_activity_date": 1593358223, "creation_date": 1547632152, "last_edit_date": 1569689852, "question_id": 54214305, "link": "https://stackoverflow.com/questions/54214305/mock-aws-api-gateway-request-and-dynamodb-for-golang-lambda-function-unit-test", "title": "Mock AWS API Gateway request and DynamoDB for Golang Lambda function unit Test", "body": "<p><strong>Setup</strong>  </p>\n\n<ul>\n<li>Windows 10</li>\n<li>go v1.10.3</li>\n<li>aws cli v1.16.67</li>\n</ul>\n\n<p><strong>What I'm trying to do</strong></p>\n\n<p>Test an AWS Lambda function written using <code>golang</code>. The function accepts a request from the <code>API Gateway</code> and then does some stuff with <code>DynamoDB</code>. Most of the below has been taken from <a href=\"https://www.alexedwards.net/blog/serverless-api-with-go-and-aws-lambda\" rel=\"nofollow noreferrer\">this</a> article (I'm a newbie with Go)</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"regexp\"\n\n    \"github.com/aws/aws-lambda-go/events\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n)\n\nvar uuidRegexp = regexp.MustCompile(`\\b[0-9a-f]{8}\\b-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-\\b[0-9a-f]{12}\\b`)\nvar errorLogger = log.New(os.Stderr, \"ERROR \", log.Llongfile)\n\ntype job struct {\n    ID                string `json:\"id\"`\n    ClientID          string `json:\"clientId\"`\n    Title             string `json:\"title\"`\n    Count             int    `json:\"count\"`\n}\n\n// CreateJobCommand manages interactions with DynamoDB\nfunc CreateJobCommand(req events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) {\n\n    if req.Headers[\"Content-Type\"] != \"application/json\" {\n        return clientError(http.StatusNotAcceptable) //406\n    }\n\n    newJob := new(job)\n    err := json.Unmarshal([]byte(req.Body), newJob)\n\n    // Ensure request has deserialized correctly\n    if err != nil {\n        return clientError(http.StatusUnprocessableEntity) //422\n    }\n\n    // Validate ID and ClientID attributes match RegEx pattern\n    if !uuidRegexp.MatchString(newJob.ID) || !uuidRegexp.MatchString(newJob.ClientID) {\n        return clientError(http.StatusBadRequest)\n    }\n\n    // Mandatory field check\n    if newJob.Title == \"\" {\n        return clientError(http.StatusBadRequest)\n    }\n\n    // Put item in database\n    err = putItem(newJob) // putItem is defined in another file\n    if err != nil {\n        return serverError(err)\n    }\n\n    return events.APIGatewayProxyResponse{\n        StatusCode: 201,\n    }, nil\n}\n\n// Add a helper for handling errors. This logs any error to os.Stderr\n// and returns a 500 Internal Server Error response that the AWS API\n// Gateway understands.\nfunc serverError(err error) (events.APIGatewayProxyResponse, error) {\n    errorLogger.Println(err.Error())\n\n    return events.APIGatewayProxyResponse{\n        StatusCode: http.StatusInternalServerError,\n        Body:       http.StatusText(http.StatusInternalServerError),\n    }, nil\n}\n\n// Similarly add a helper for send responses relating to client errors.\nfunc clientError(status int) (events.APIGatewayProxyResponse, error) {\n    return events.APIGatewayProxyResponse{\n        StatusCode: status,\n        Body:       http.StatusText(status),\n    }, nil\n}\n\nfunc putItem(job *job) error {\n\n    // create an aws session\n    sess := session.Must(session.NewSession(&amp;aws.Config{\n        Region:   aws.String(\"us-east-1\"),\n        Endpoint: aws.String(\"http://localhost:8000\"),\n    }))\n\n    // create a dynamodb instance\n    db := dynamodb.New(sess)\n\n    // marshal the job struct into an aws attribute value object\n    jobAVMap, err := dynamodbattribute.MarshalMap(job)\n    if err != nil {\n        return err\n    }\n\n    input := &amp;dynamodb.PutItemInput{\n        TableName: aws.String(\"TEST_TABLE\"),\n        Item:      jobAVMap,\n    }\n\n    _, err = db.PutItem(input)\n    return err\n}\n\nfunc main() {\n    lambda.Start(CreateJobCommand)\n}\n</code></pre>\n\n<p><strong>Problem</strong></p>\n\n<p>I want to write a set of unit tests to test this function.  In my mind, the first thing I need to do is mock the API Gateway request and the DynamoDB table, but I've no idea how to do this.  </p>\n\n<p><strong>Questions</strong></p>\n\n<ol>\n<li>Is there a mocking framework I should be using?</li>\n<li>If anyone knows of any documentation that would help on this topic could you point it out please? (My Google skills haven't revealed any yet)</li>\n</ol>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "naming", "go-interface"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1547630920, "post_id": 54213897, "comment_id": 95253533, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/38842457/interface-naming-convention-golang/38845301#38845301\">Interface naming convention Golang</a>."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1547645769, "post_id": 54213897, "comment_id": 95262033, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/38842457/interface-naming-convention-golang\">Interface naming convention Golang</a>"}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1547646576, "post_id": 54213897, "comment_id": 95262537, "body": "i wouldn&#39;t say that &quot;ReaderAndCloser&quot; is a &quot;bad&quot; name as it is stands the concept for itselft, i mean,  for anyone that reads it, the reader shall asumme that is in is front of &quot;somethign&quot; that reads and close &quot;things&quot;. Perhaps you should rename it to &quot;StreamReaderAndCloser&quot; in order to clarify what thing are you reading or closing. If the discussion is about naming and readability, i think you should be the more clear as possible, I don&#39; know why icza and jubobs limits their answer just to point the question as a duplicated ignoring what you are actually asking. Hope it helps!"}], "answers": [{"comments": [{"owner": {"reputation": 2049, "user_id": 324098, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5ddb089dbe33b4f8e0d04e7f87155e0b?s=128&d=identicon&r=PG", "display_name": "CodeGroover", "link": "https://stackoverflow.com/users/324098/codegroover"}, "edited": false, "score": 0, "creation_date": 1547716948, "post_id": 54216845, "comment_id": 95290096, "body": "I can&#39;t add to more to this answer. The third argument actually carries conviction to me."}], "tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": true, "score": 2, "last_activity_date": 1547640785, "creation_date": 1547640785, "answer_id": 54216845, "question_id": 54213897, "link": "https://stackoverflow.com/questions/54213897/rule-for-golang-interface-name-and-its-number-of-methods/54216845#54216845", "title": "Rule for GoLang Interface name and its number of methods", "body": "<p>This question is possibly going to get closed, either because it's deemed opinion based, or not code related, or whatever...</p>\n\n<p>However, golang being deemed quite opinionated, and because I deem standards very important, I'll chip in with my take on the unwritten rule, and how I'd reconcile, essentially why the <code>ReadCloser</code> is fine, but some other <code>er</code> interfaces might not be.</p>\n\n<hr>\n\n<p>I'd interpret the <code>ReadCloser</code> not to violate the <em>\"rule\"</em> (I'd call it a convention more like). I have a number of arguments why I'd say it's not violating the convention:</p>\n\n<h3>1. It's not a standalone interface</h3>\n\n<p>The <code>ReadCloser</code> interface isn't a self-contained interface. It's a composed interface. It's name reflects this. It concatenates <code>Read</code> and <code>Close</code> (the 2 functions in the interface you're after), and adds the <code>er</code> suffix. How both functions are implemented, and where they come from is irrelevant to the interface. If you read something, chances are you'll need to close the resource, too. It only makes sense to combine the two interfaces, so you can use the type that guarantees both <code>Reader</code> and <code>Closer</code> functionality to be available.</p>\n\n<h3>2. Names mustn't stutter</h3>\n\n<p>Much like the guidelines WRT <a href=\"https://blog.golang.org/package-names\" rel=\"nofollow noreferrer\">package names</a> stutter is to be avoided. Especially if it doesn't add any value. Technically, one could argue that the interface should be called <code>ReaderCloser</code>, but does that name communicate anything that isn't conveyed by the name <code>ReadCloser</code>? Surely not. The latter doesn't repeat the suffix, and reads easier.</p>\n\n<h3>3. The <code>er</code> interfaces and CamelCasing</h3>\n\n<p>The examples of single-function <code>er</code> interfaces like <code>Stringer</code>, or <code>Publisher</code> are indeed cut &amp; dry. A <code>Stringer</code> contains the <code>String</code> function. End of story. Same as the <code>Publisher</code> interface.</p>\n\n<p>You'll note that the <code>ReadCloser</code> interface is CamelCased, suggesting it's a composit type. Just split the name on UpperCase characters, and add the suffix to each part. If the parts are bona-fide <code>er</code> interfaces, and the composite interface makes sense (cf point 1: if you read, chances are you'll need to close), then it's a valid composite interface.</p>\n\n<p>Examples of an invalid <code>er</code> interface would be:</p>\n\n<pre><code>type FileReader interface {\n    ReadCloserer\n    ScanDir(string) ([]string, error)\n    IsFile(string) bool\n    Open(string, string) error\n    // and so on\n}\n</code></pre>\n\n<p>This interface contains too many BS functions to be packed into a <code>FileReader</code> interface.</p>\n"}], "owner": {"reputation": 2049, "user_id": 324098, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5ddb089dbe33b4f8e0d04e7f87155e0b?s=128&d=identicon&r=PG", "display_name": "CodeGroover", "link": "https://stackoverflow.com/users/324098/codegroover"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1431, "favorite_count": 0, "closed_date": 1547654839, "accepted_answer_id": 54216845, "answer_count": 1, "score": -4, "last_activity_date": 1547645713, "creation_date": 1547630802, "last_edit_date": 1547645713, "question_id": 54213897, "link": "https://stackoverflow.com/questions/54213897/rule-for-golang-interface-name-and-its-number-of-methods", "closed_reason": "Opinion-based", "title": "Rule for GoLang Interface name and its number of methods", "body": "<p>Ones I had a discussion at work about correlation between interface name and number its methods. \nIn particular, there is an unwritten rule about an interface with postfix notation ending with <code>er</code> in its name.\nThe rule says such an interface should have one method contained. </p>\n\n<p>Let's jump into an example. In the standard Go lang library, there is <code>Pusher</code> interface that does one thing \"Push initiates an HTTP/2 server push\". \nHere is its definition:</p>\n\n<pre><code>type Pusher interface {\n  Push(target string, opts *PushOptions) error\n}\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/net/http/#Pusher\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Pusher</a> </p>\n\n<p>Good example. However, some colleague defended his implementation that contained more than two methods with <code>er</code> in name's postfix.\nThe main argument was that there are stdlib's interfaces that violates such a rule. He referred to interface <code>ReadCloser</code>. </p>\n\n<p>Looking at its definition:</p>\n\n<pre><code>type ReadCloser interface {\n        Reader\n        Closer\n}\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/io/#ReadCloser\" rel=\"nofollow noreferrer\">https://golang.org/pkg/io/#ReadCloser</a> </p>\n\n<p>I can say its wrong assumption. Interface embed in itself two other interfaces. How I interpret that? The rule is not violated.</p>\n\n<p>How will you interpret such a case?</p>\n"}, {"tags": ["mysql", "go", "go-gorm", "go-iris"], "answers": [{"comments": [{"owner": {"reputation": 301, "user_id": 1636320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69f33f92d2d79e17cbe82dc485437ab9?s=128&d=identicon&r=PG", "display_name": "morteza khadem", "link": "https://stackoverflow.com/users/1636320/morteza-khadem"}, "edited": false, "score": 0, "creation_date": 1547635289, "post_id": 54214620, "comment_id": 95256152, "body": "my question is : do where open database connection and do where close it? and do should close connection?"}, {"owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "reply_to_user": {"reputation": 301, "user_id": 1636320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69f33f92d2d79e17cbe82dc485437ab9?s=128&d=identicon&r=PG", "display_name": "morteza khadem", "link": "https://stackoverflow.com/users/1636320/morteza-khadem"}, "edited": false, "score": 1, "creation_date": 1547636035, "post_id": 54214620, "comment_id": 95256552, "body": "In main.go you call Open to get DB struct. IIRC, database/sql doesn&#39;t actually open a connection instanteneously but does it lazily. The DB object is a logical construct for underlying DB connection. It would manage database connections on its own using a DB pool. The DB object is supposed to be long lived and you should close it when your application is shutting down."}], "tags": [], "owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "is_accepted": false, "score": 1, "last_activity_date": 1547633062, "creation_date": 1547633062, "answer_id": 54214620, "question_id": 54213310, "link": "https://stackoverflow.com/questions/54213310/how-to-open-and-close-database-connection/54214620#54214620", "title": "How to open and close database connection", "body": "<p>Your code is perhaps a test/POC code.\nIn a production project, you could go with a MVC or any other kind of architecture as per your needs.\nIt would be hard to pinpoint the exact structure of your project.\nBut at the very least, you would want to create a db package which declares an interface for all DB related interactions.\ne.g</p>\n\n<pre><code>type UserDBRepo interface{\n   AddUser(context.Context, *User)\n   GetUser(context.Context, uint64)\n}\n\ntype userDBRepo struct{ //implements UserDBRepo\n   *sql.DB // or whatever type gorm.Open returns\n}\n\nfunc NewUserDBRepo(db *sql.DB) DBRepo{\n  return &amp;dbRepo{DB: db}\n}\n</code></pre>\n\n<p>The above basically represents a single RDBMS table for this example.\nThere could be <code>n</code> such files for <code>n</code> DB tables.\nNow call <code>NewUserDBRepo</code> from the main.go and pass this instance to all services that need this DB.</p>\n"}], "owner": {"reputation": 301, "user_id": 1636320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69f33f92d2d79e17cbe82dc485437ab9?s=128&d=identicon&r=PG", "display_name": "morteza khadem", "link": "https://stackoverflow.com/users/1636320/morteza-khadem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1547633062, "creation_date": 1547628735, "question_id": 54213310, "link": "https://stackoverflow.com/questions/54213310/how-to-open-and-close-database-connection", "title": "How to open and close database connection", "body": "<p>I'm beginner in go and now want to create a big project\nmy question is where should create connection and where close connection in http requests\nnow i declare db in main function and use in all requests and don't close connection:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/jinzhu/gorm\"\n    \"github.com/kataras/iris\"\n    \"github.com/kataras/iris/context\"\n    \"github.com/kataras/iris/middleware/recover\"\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nvar db *gorm.DB\n\nfunc main() {\n\n\n    port := \"8080\"\n\n    app := iris.New()\n    app.Configure()\n    app.Logger().SetLevel(\"debug\")\n\n    app.Use(recover.New())\n\n    db1, err := gorm.Open(\"mysql\", \"root:@/database?charset=utf8&amp;parseTime=True&amp;loc=Local\")\n    //db1, err := gorm.Open(\"mysql\", \"payro:AEkCpNhd@/payro_db?charset=utf8&amp;parseTime=True&amp;loc=Local\")\n    if err != nil {\n        fmt.Println(err.Error())\n        panic(err)\n    }\n\n    db=db1\n\n    app.Get(\"/\", func(i context.Context) {\n        db.Exec(\"update tbl1 set col1=''\")\n        i.Next()\n    })\n    app.Get(\"/test\", func(i context.Context) {\n        db.Exec(\"update tbl2 set col2=''\")\n        i.Next()\n    })\n    _ = app.Run(iris.Addr(\":\"+port), iris.WithConfiguration(iris.Configuration{\n        //DisableBodyConsumptionOnUnmarshal:true,\n\n    }), iris.WithoutServerError(iris.ErrServerClosed))\n}\n</code></pre>\n\n<p>this code is ok?</p>\n"}, {"tags": ["string", "go", "time"], "comments": [{"owner": {"reputation": 1950, "user_id": 4049851, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh5.googleusercontent.com/-C6_hTSEP6Mc/AAAAAAAAAAI/AAAAAAAAAGg/fwUuZ82ifBA/photo.jpg?sz=128", "display_name": "Puck", "link": "https://stackoverflow.com/users/4049851/puck"}, "edited": false, "score": 0, "creation_date": 1547625193, "post_id": 54212305, "comment_id": 95250859, "body": "What exactly do you want to do? <code>Parse</code> is to return a <code>Time</code> variable when you have a string in an expected format. I think you want to do the opposite, which can be done using <code>Format</code>."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1547625103, "creation_date": 1547625103, "answer_id": 54212457, "question_id": 54212305, "link": "https://stackoverflow.com/questions/54212305/golang-converting-between-time-formats/54212457#54212457", "title": "Golang converting between time formats", "body": "<p>First you're omitting the error returned by <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\"><code>time.Parse()</code></a>. Never omit errors.</p>\n\n<p>If you print the error:</p>\n\n<pre><code>currentTime := time.Now().String()\nt1, err := time.Parse(time.RFC3339, currentTime)\nfmt.Println(err)\nfmt.Println(t1.String())\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/L6dGK1rXyQ1\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>parsing time \"2009-11-10 23:00:00 +0000 UTC m=+0.000000001\" as \"2006-01-02T15:04:05Z07:00\": cannot parse \" 23:00:00 +0000 UTC m=+0.000000001\" as \"T\"\n0001-01-01 00:00:00 +0000 UTC\n</code></pre>\n\n<p>The problem is that <a href=\"https://golang.org/pkg/time/#Time.String\" rel=\"nofollow noreferrer\"><code>Time.String()</code></a> produces the text representation in a different format than specified by <code>time.RFC3339</code>. <code>Time.String()</code> produces output using the format:</p>\n\n<pre><code>\"2006-01-02 15:04:05.999999999 -0700 MST\"\n</code></pre>\n\n<p>While you attempt to parse it from the format:</p>\n\n<pre><code>RFC3339 = \"2006-01-02T15:04:05Z07:00\"\n</code></pre>\n\n<p>Obviously that won't work.</p>\n"}, {"tags": [], "owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "is_accepted": false, "score": 0, "last_activity_date": 1547629606, "creation_date": 1547629606, "answer_id": 54213561, "question_id": 54212305, "link": "https://stackoverflow.com/questions/54212305/golang-converting-between-time-formats/54213561#54213561", "title": "Golang converting between time formats", "body": "<p>@icza is right. You should check it on godoc <a href=\"https://golang.org/pkg/time/#Time.String\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/#Time.String</a></p>\n\n<pre><code>String returns the time formatted using the format string\n\n\"2006-01-02 15:04:05.999999999 -0700 MST\"\n</code></pre>\n\n<p>In case if you are new to golang, you may want to know the right way.</p>\n\n<p>Here is how:</p>\n\n<pre><code>formatstr:=\"2006-01-02 15:04:05.999999999 -0700 MST\"\ncurrentTime := time.Now().String()\nt1, _ := time.Parse(formatstr, currentTime)\nfmt.Println(t1.String())\n</code></pre>\n"}], "owner": {"reputation": 638, "user_id": 443309, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/5db40f9afca164945a51690b269737b8?s=128&d=identicon&r=PG&f=1", "display_name": "gkns", "link": "https://stackoverflow.com/users/443309/gkns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "closed_date": 1547642321, "accepted_answer_id": 54212457, "answer_count": 2, "score": -1, "last_activity_date": 1547694436, "creation_date": 1547624169, "last_edit_date": 1547694436, "question_id": 54212305, "link": "https://stackoverflow.com/questions/54212305/golang-converting-between-time-formats", "closed_reason": "Needs details or clarity", "title": "Golang converting between time formats", "body": "<p>I am trying to parse a time string which is transported on the wire as JSON. In the below code, I am just experimenting the time parsing as part of that:</p>\n\n<pre><code>currentTime := time.Now().String()\n//currentTime has the time\nt1, _ := time.Parse(time.RFC3339, currentTime)\nfmt.Println(t1.String())\n</code></pre>\n\n<p>The last but one line mangles the time and produces the output:\n0001-01-01 00:00:00 +0000 UTC</p>\n\n<p>See this GoPlayground:<a href=\"https://play.golang.org/p/Q_G_qYcnaHP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Q_G_qYcnaHP</a></p>\n\n<p>What am I missing?</p>\n"}, {"tags": ["mysql", "go", "visual-studio-code", "go-echo"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 6, "creation_date": 1547628791, "post_id": 54212160, "comment_id": 95252378, "body": "Don&#39;t ignore the errors returned by Query, Scan, and <a href=\"https://golang.org/pkg/database/sql/#Rows.Err\" rel=\"nofollow noreferrer\">Rows.Err</a>"}], "owner": {"reputation": 11, "user_id": 10851055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7eec49080ae0468bc4f30cd13f6afd4c?s=128&d=identicon&r=PG&f=1", "display_name": "katy", "link": "https://stackoverflow.com/users/10851055/katy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1553995178, "creation_date": 1547623445, "last_edit_date": 1553995178, "question_id": 54212160, "link": "https://stackoverflow.com/questions/54212160/why-the-last-sentence-of-append-isnt-shown-at-web", "title": "Why the last sentence of append,isn&#39;t shown at web?", "body": "<p>Actually my last sentence of database(mysql table) after append does not show in web which I create with Echo framework. </p>\n\n<p>I have question on line 39: Comment item doesn't scan and show on local host:1324.</p>\n\n<pre><code>package main\n\n    import (\n        \"database/sql\"\n        \"fmt\"\n        \"net/http\"\n\n        _ \"github.com/go-sql-driver/mysql\"\n        \"github.com/labstack/echo\"\n    )\n\n    type datatype struct {\n        SiteID          string `sql: \"Site_ID\"`\n        Scope           string `sql: \"Scope\"`\n        Region          string `sql: \"Region\"`\n        Province        string `sql: \"Province\"`\n        Vendor          string `sql: \"Vendor\"`\n        Supervisor      string `sql: \"Supervisor\"`\n        SOAC_Date       string `sql: \"SOAC_Date\"`\n        Last_Visit_Date string `sql: \"Last_Visit_Date\"`\n        Number_of_Visit string `sql: \"Number_of_Visit\"`\n        COC_Date        string `sql: \"COC_Date\"`\n        FAT_Date        string `sql: \"FAT_Date\"`\n        FAC_Date        string `sql: \"FAC_Date\"`\n        Comment         string `sql: \"Comment\"`\n    }\n\n    func pegy(c echo.Context) error {\n        db, err := sql.Open(\"mysql\", \"root:Abc@12345@tcp(127.0.0.1:3306)/test\")\n        if err != nil {\n            return c.JSON(http.StatusBadRequest, \"Error while connecting to DB!\")\n        }\n        defer db.Close()\n        row, _ := db.Query(\"select Site_ID,Scope,region,province,vendor,supervisor,SOAC_Date,Last_Visit_Date,number_of_visit,COC_Date,FAT_Date,FAC_Date,Comment from test.db\")\n        var res []string\n        for row.Next() {\n            var db datatype\n            row.Scan(&amp;db.SiteID, &amp;db.Scope, &amp;db.Region, &amp;db.Province, &amp;db.Vendor, &amp;db.Supervisor, &amp;db.SOAC_Date, &amp;db.Last_Visit_Date, &amp;db.Number_of_Visit, &amp;db.COC_Date, &amp;db.FAT_Date, &amp;db.FAC_Date, &amp;db.Comment)\n            res = append(res, fmt.Sprintf(\"Site_Id: %s |Scope: %s|Region: %s |Province: %s|Vendor: %s |Supervisor: %s |SOAC_Date: %s|Last_Visit_date: %s|Number_of_Visit :%s|COC_Date: %s|FAT_Date: %s|FAC_Date: %s|Comment: %s\", db.SiteID, db.Scope, db.Region, db.Province, db.Vendor, db.Supervisor, db.SOAC_Date, db.Last_Visit_Date, db.Number_of_Visit, db.COC_Date, db.FAT_Date, db.FAC_Date, db.Comment))\n        }\n        return c.JSON(http.StatusOK, res)\n    }\n\n    func main() {\n        e := echo.New() //By Shayan\n        e.GET(\"/\", pegy)\n        e.Logger.Fatal(e.Start(\":1324\"))\n    }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1547627198, "post_id": 54211999, "comment_id": 95251636, "body": "It isn&#39;t clear how and what you store in your map of maps. But if you need fast lookup of offers by id, why don&#39;t you store that in the first place? <code>map[uint64][]*offer</code>?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1547628622, "post_id": 54211999, "comment_id": 95252302, "body": "Something like this <a href=\"https://play.golang.com/p/gxLX6oo8hAP\" rel=\"nofollow noreferrer\">play.golang.com/p/gxLX6oo8hAP</a> ?"}, {"owner": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1547630675, "post_id": 54211999, "comment_id": 95253394, "body": "@icza i need two indexes, one for two keys (uint64 and uint16 in this case) and second by id of offer. There should be only one copy of offer. Second index should be as pointer to the original offer."}, {"owner": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1547630807, "post_id": 54211999, "comment_id": 95253476, "body": "@mkopriva your script copy offer struct when you access by index. In my case it doubles amount of memory for offers which without doubling is already 50+ gb."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1547634246, "post_id": 54211999, "comment_id": 95255554, "body": "You could store your offers in a flat array, and then all your indexes can be pointers to elements in this array. No need for any shenanigans with reflect or unsafe."}, {"owner": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1547635823, "post_id": 54211999, "comment_id": 95256459, "body": "@SergioTulentsev store actual values in the main index gives me more performance for retrieving bucket of offers instead of collecting it from the sparse heap memory in case of storing pointers."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1547637293, "post_id": 54211999, "comment_id": 95257236, "body": "@abonec: with billions of elements, I don&#39;t doubt."}, {"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "edited": false, "score": 0, "creation_date": 1547693170, "post_id": 54211999, "comment_id": 95282169, "body": "it seems like you answered your own question. You can update your answer to include the correct solution."}], "answers": [{"comments": [{"owner": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1547635511, "post_id": 54213984, "comment_id": 95256284, "body": "In terms of changing slice values is no difference, but I showed how to do it by the reference to this value. In my case I need a reference to the value, not the copy."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547664478, "post_id": 54213984, "comment_id": 95272769, "body": "@abonec: note the warning that <code>go vet</code> gives you here, you really shouldn&#39;t ever need to do pointer arithmetic in Go."}], "tags": [], "owner": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "is_accepted": false, "score": -2, "last_activity_date": 1547643443, "last_edit_date": 1547643443, "creation_date": 1547631099, "answer_id": 54213984, "question_id": 54211999, "link": "https://stackoverflow.com/questions/54211999/get-pointers-for-values-in-the-slice/54213984#54213984", "title": "Get pointers for values in the slice", "body": "<p>After some investigation I came to the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"unsafe\"\n)\n\ntype offer struct {\n    id uint64\n}\n\nfunc main() {\n\n    sl := []offer{{1}, {id: 2}}\n\n    size := unsafe.Sizeof(offer{})\n    header := (*reflect.SliceHeader)(unsafe.Pointer(&amp;sl))\n    for i := 0; i &lt; len(sl); i++ {\n        offset := uintptr(i) * size\n        ptr := header.Data + offset\n\n        o := (*offer)(unsafe.Pointer(ptr))\n        o.id = 5\n        fmt.Println(o)\n    }\n\n    for _, o := range sl {\n        fmt.Println(o.id)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/OM3i84cKAB_7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/OM3i84cKAB_7</a></p>\n\n<p>Output:</p>\n\n<pre><code>&amp;{5}\n&amp;{5}\n5\n5\n</code></pre>\n\n<p>This snippet of code illustrate access to the actual data in the slice, not copied one.</p>\n\n<p><strong>Update:</strong>\nTake pointers via unsafe pointer give the same effect as take regular pointer from the slice by index.</p>\n"}], "owner": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 1, "answer_count": 1, "score": -3, "last_activity_date": 1547643443, "creation_date": 1547622710, "last_edit_date": 1547643283, "question_id": 54211999, "link": "https://stackoverflow.com/questions/54211999/get-pointers-for-values-in-the-slice", "title": "Get pointers for values in the slice", "body": "<p>Is there any way to get pointers to the actual value in slice? I have a tree of offers in the maps:</p>\n\n<pre><code>map[uint64]map[uint16][]offer\n</code></pre>\n\n<p>For fast access by id (which from 1 to n) I need a slice of pointers:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>[]*offer\n</code></pre>\n\n<p>Actual offers lies in the first tree, in the slice should be pointers to the that actual.</p>\n\n<p>I can't traverse tree and collect pointers of actual values because with <code>range</code> of this slice gives me a copies, but I have more than billions of this structs in total and copies will lead to waste of my memory: 40 bytes for one struct lead to the 100+ gb and much more in the future. I also need to store slice of values in the tree to contiguous in order to fact lookup of offers.</p>\n\n<p>May be there are some way to use <code>unsafe</code> or <code>reflect</code> package to get these pointers?</p>\n\n<p>Index of pointers build only one time and both structs are immutable and only used to lookup offers.</p>\n\n<p><strong>Update:</strong>\nI was totally wrong. There is no problem to get pointer to element in the slice. My code was:</p>\n\n<pre><code>        var offers []offer // actually there was about 50gb of offers\n        for i := range offers {\n            currentOffer := offers[i]\n            s.Relations[currentOffer.Id] = &amp;currentOffer\n        }\n</code></pre>\n\n<p>After this snippet overall amount of ram consumed by the app became 100+gb. I immediately thought that take element from slice of values give me a copy of that value, but it is wrong. I just copied original value to the <code>currentOffer</code> variable by myself. Little mistake took 50gb of ram away.</p>\n\n<p>Actually this snippet is work fine as expected:</p>\n\n<pre><code>    for i := range offers {\n        s.Relations[offers[i].Id] = &amp;offers[i]\n    }\n</code></pre>\n"}, {"tags": ["go", "jetbrains-ide", "goland"], "comments": [{"owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "edited": false, "score": 0, "creation_date": 1547621742, "post_id": 54211676, "comment_id": 95249500, "body": "You&#39;re passing the arguments correctly. Does your code run if you do <code>go run main.go sub.go</code> (or whatever the correct arg is) on the CLI? It looks odd to me that the argument has a suffix of <code>.go</code> and makes me think you&#39;re maybe trying to run the application incorrectly."}, {"owner": {"reputation": 127, "user_id": 8295289, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213923242815663/picture?type=large", "display_name": "yagu", "link": "https://stackoverflow.com/users/8295289/yagu"}, "reply_to_user": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "edited": false, "score": 0, "creation_date": 1547622295, "post_id": 54211676, "comment_id": 95249691, "body": "Yes, when I did <code>go run main.go service.go</code> . it is run correctly."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547622861, "post_id": 54211676, "comment_id": 95249916, "body": "@Flimzy that&#39;s actually not true. The &quot;go run&quot; command is designed to compile a list of files and does not work when not specifying any file (at least with the current 1.11 release)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547622928, "post_id": 54211676, "comment_id": 95249941, "body": "You&#39;re right, you should specify a package, though, not individual files. I&#39;ve updated my comment."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547622940, "post_id": 54211676, "comment_id": 95249946, "body": "This doesn&#39;t answer your question, but if you need to pass specific files on the &#39;go run&#39; command line, your package is poorly/incorrectly designed. You should be able to run simply <code>go run .</code>."}], "answers": [{"comments": [{"owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "edited": false, "score": 0, "creation_date": 1547852655, "post_id": 54211993, "comment_id": 95349188, "body": "Ah yep, this sounds right. Been a while since I&#39;ve had to deal with this. It would be worth providing an example using the context of the question. E.g. <code>Files</code> should be updated to remove the main.go and simply point to the package, and <code>Program arguments</code> should be left blank."}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 2, "last_activity_date": 1547622684, "creation_date": 1547622684, "answer_id": 54211993, "question_id": 54211676, "link": "https://stackoverflow.com/questions/54211676/how-to-run-and-pass-a-command-line-parameter-to-main-go-in-goland/54211993#54211993", "title": "How to run and pass a command-line-parameter to main.go in GoLand?", "body": "<p>If you need to specify multiple files to the build configuration, you can either use the \"Files\" field to add more files to compile or change the \"Run Kind\" to be \"Package\" from the current \"File\" .</p>\n\n<p>The \"Program arguments\" field is used for arguments to the final program, not to the go tool.</p>\n"}, {"tags": [], "owner": {"reputation": 127, "user_id": 8295289, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213923242815663/picture?type=large", "display_name": "yagu", "link": "https://stackoverflow.com/users/8295289/yagu"}, "is_accepted": false, "score": 0, "last_activity_date": 1547623178, "creation_date": 1547623178, "answer_id": 54212107, "question_id": 54211676, "link": "https://stackoverflow.com/questions/54211676/how-to-run-and-pass-a-command-line-parameter-to-main-go-in-goland/54212107#54212107", "title": "How to run and pass a command-line-parameter to main.go in GoLand?", "body": "<p>I didn't know it is possible to specify multiple file in \"Files\" field. \nAfter I specified multiple file in \"Files\" field, then it is work!\nThank you so much.</p>\n\n<p><a href=\"https://i.stack.imgur.com/0N4Li.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0N4Li.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 127, "user_id": 8295289, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213923242815663/picture?type=large", "display_name": "yagu", "link": "https://stackoverflow.com/users/8295289/yagu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2909, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1547653882, "creation_date": 1547620979, "last_edit_date": 1547653882, "question_id": 54211676, "link": "https://stackoverflow.com/questions/54211676/how-to-run-and-pass-a-command-line-parameter-to-main-go-in-goland", "title": "How to run and pass a command-line-parameter to main.go in GoLand?", "body": "<p>I am trying to run Go application with IDE GoLand by JetBrains. I just want to run the following command like this:</p>\n\n<pre><code>$ go run main.go service.go\n</code></pre>\n\n<p>Could you tell me how to configure at \"Edit Configuration\" panel? I tried to set \"Program arguments\" but that didn't work.</p>\n\n<p><a href=\"https://i.stack.imgur.com/DGvAy.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/DGvAy.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go", "visual-studio-code", "race-condition"], "comments": [{"owner": {"reputation": 60165, "user_id": 836330, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47fd5f542a64b8b2dac00112a4829de8?s=128&d=identicon&r=PG&f=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/836330/mark"}, "edited": false, "score": 0, "creation_date": 1547625592, "post_id": 54210354, "comment_id": 95250985, "body": "Will your Go launch configuration take a &quot;runtimeArgs&quot; key?"}, {"owner": {"reputation": 2046, "user_id": 2118405, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/5CCLJ.jpg?s=128&g=1", "display_name": "Henry Leu", "link": "https://stackoverflow.com/users/2118405/henry-leu"}, "reply_to_user": {"reputation": 60165, "user_id": 836330, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47fd5f542a64b8b2dac00112a4829de8?s=128&d=identicon&r=PG&f=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/836330/mark"}, "edited": false, "score": 0, "creation_date": 1547640561, "post_id": 54210354, "comment_id": 95259160, "body": "Yes, I did like <code>&quot;runtimeArgs&quot;: [&quot;-race&quot;]</code>. but it doesn&#39;t work @Mark"}, {"owner": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "edited": false, "score": 0, "creation_date": 1555099184, "post_id": 54210354, "comment_id": 98005884, "body": "Did you ever find a solution for it?"}], "owner": {"reputation": 2046, "user_id": 2118405, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/5CCLJ.jpg?s=128&g=1", "display_name": "Henry Leu", "link": "https://stackoverflow.com/users/2118405/henry-leu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 176, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1586070510, "creation_date": 1547612236, "last_edit_date": 1547622485, "question_id": 54210354, "link": "https://stackoverflow.com/questions/54210354/how-to-add-race-argument-in-launch-json-file", "title": "How to add -race argument in launch.json file?", "body": "<p>I debug Go programs in Visual Studio Code. How can I add the <code>-race</code> argument in launch.json file?</p>\n\n<p>I add config in launch.json like below, but it doesn't work.</p>\n\n<pre><code>\"args\": [\"-race\"]\n</code></pre>\n"}, {"tags": ["go", "math"], "comments": [{"owner": {"reputation": 1401, "user_id": 10786914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q3ZTk.png?s=128&g=1", "display_name": "dtanabe", "link": "https://stackoverflow.com/users/10786914/dtanabe"}, "edited": false, "score": 0, "creation_date": 1547608758, "post_id": 54209933, "comment_id": 95246063, "body": "How are you calling this method? At first glance, it looks like whatever calls <code>PrevSlot</code> is simply passing in the same value over and over again, so the problem is likely somewhere else."}, {"owner": {"reputation": 151, "user_id": 10527936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10faded8ee52ba8dcdf52cd40204f52c?s=128&d=identicon&r=PG&f=1", "display_name": "faker", "link": "https://stackoverflow.com/users/10527936/faker"}, "reply_to_user": {"reputation": 1401, "user_id": 10786914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q3ZTk.png?s=128&g=1", "display_name": "dtanabe", "link": "https://stackoverflow.com/users/10786914/dtanabe"}, "edited": false, "score": 0, "creation_date": 1547609101, "post_id": 54209933, "comment_id": 95246115, "body": "@dtanabe ,   i edited my question , <code>PrevSlot </code> is called like this ."}], "answers": [{"tags": [], "owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "is_accepted": true, "score": 3, "last_activity_date": 1547622577, "last_edit_date": 1547622577, "creation_date": 1547609403, "answer_id": 54210017, "question_id": 54209933, "link": "https://stackoverflow.com/questions/54209933/why-is-this-go-result-the-same/54210017#54210017", "title": "Why is this Go result the same?", "body": "<p>Actually,</p>\n\n<pre><code>int64((now - 1)/blockInterval * blockInterval\n</code></pre>\n\n<p>does not return the same result all the time. You will notice it changing every 10 seconds.</p>\n\n<p>This is caused by integer division in Go. If you apply integer division to any two numbers, then the fractional part of the result (remainder) is dropped. For example, <code>int(12 / 10) = 1</code>. In your specific case - dividing by ten, the code will drop the remainders from 1 until 9, and only increment the value when you get to the next 10.</p>\n\n<p>If you'd like to increase the precision of your operations, then you can force floating point division like so <code>float64(12)/float64(10)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 8798, "user_id": 306999, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/Ehw7z.jpg?s=128&g=1", "display_name": "sma", "link": "https://stackoverflow.com/users/306999/sma"}, "is_accepted": false, "score": 2, "last_activity_date": 1547609571, "creation_date": 1547609571, "answer_id": 54210027, "question_id": 54209933, "link": "https://stackoverflow.com/questions/54209933/why-is-this-go-result-the-same/54210027#54210027", "title": "Why is this Go result the same?", "body": "<p>Your problem is here:</p>\n\n<p><code>result := int64((now-1)/blockInterval) * blockInterval</code></p>\n\n<p><code>time.Now().Unix()</code> returns the current Unix time <em>in seconds</em>.  So, for consecutive iterations, <code>time.Now().Unix()</code> would be:</p>\n\n<pre><code>1257894001\n1257894002\n1257894003\n</code></pre>\n\n<p>But in your function, you are subtracting 1, then dividing by ten, so each of the above becomes the following because the fractional portion is dropped.</p>\n\n<pre><code>125789400\n125789400\n125789400\n</code></pre>\n\n<p>Then when you multiply by <code>blockInterval</code> (10), they all become:</p>\n\n<pre><code>1257894000\n1257894000\n1257894000\n</code></pre>\n\n<p>So, <code>result</code> ends up being the same.  If you let it run for longer than ten seconds, you'll see <code>result</code> change after 10 seconds:</p>\n\n<p><a href=\"https://play.golang.org/p/LgPtHwjwlC1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LgPtHwjwlC1</a></p>\n"}], "owner": {"reputation": 151, "user_id": 10527936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10faded8ee52ba8dcdf52cd40204f52c?s=128&d=identicon&r=PG&f=1", "display_name": "faker", "link": "https://stackoverflow.com/users/10527936/faker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 54210017, "answer_count": 2, "score": 1, "last_activity_date": 1547622923, "creation_date": 1547608662, "last_edit_date": 1547622923, "question_id": 54209933, "link": "https://stackoverflow.com/questions/54209933/why-is-this-go-result-the-same", "title": "Why is this Go result the same?", "body": "<p>When i review a Golang project, i found some code like this, \n<code>now</code> is Unix timestap. Call this function once every second:</p>\n\n<pre><code>//main.go\nfunc PrevSlot(now int64) int64 {\n    // now = time.Now().Unix()\n    var blockInterval = int64(10)\n\n    result := int64((now-1)/blockInterval) * blockInterval // why result is same ?\n    plog.Println(\"PrevSlot:\", int64(result), int64((now-1)/blockInterval), now)\n    return result\n}\n\n\nfunc main() {\n    ticker := time.NewTicker(1 * time.Second)\n    for {\n        &lt;-ticker.C\n\n        now := time.Now().Unix()\n        PrevSlot(now)\n    }\n\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2019-01-16 10:58:31.668597 I | dpos.go: PrevSlot: 1547607510 154760751 1547607511\n2019-01-16 10:58:32.668649 I | dpos.go: PrevSlot: 1547607510 154760751 1547607512\n2019-01-16 10:58:33.668568 I | dpos.go: PrevSlot: 1547607510 154760751 1547607513\n2019-01-16 10:58:34.668572 I | dpos.go: PrevSlot: 1547607510 154760751 1547607514\n2019-01-16 10:58:35.668547 I | dpos.go: PrevSlot: 1547607510 154760751 1547607515\n</code></pre>\n\n<p>The result is same. Why is this, what is the principle?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "edited": false, "score": 1, "creation_date": 1547612867, "post_id": 54209674, "comment_id": 95246902, "body": "is this a question about text editors? or do you want the go runtime to see a modified version of the tags?"}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "reply_to_user": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "edited": false, "score": 0, "creation_date": 1547613120, "post_id": 54209674, "comment_id": 95246963, "body": "huh? this is a go question"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1547622634, "post_id": 54209674, "comment_id": 95249825, "body": "@MarissaLevy: Yes, we know this is a Go question. user10753492&#39;s question was: Are you asking how to do this <i>at run time</i>, or <i>in your editor</i>?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1547656802, "post_id": 54209674, "comment_id": 95268888, "body": "Is this a one-time change? Just use sed? You can of course parse Go with Go and re-write the source, but changing Go source doesn&#39;t require Go."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 2, "last_activity_date": 1547618832, "creation_date": 1547618832, "answer_id": 54211278, "question_id": 54209674, "link": "https://stackoverflow.com/questions/54209674/how-do-i-change-the-prefix-for-all-struct-tags-in-a-non-manual-way/54211278#54211278", "title": "How do I change the prefix for all struct tags in a non-manual way?", "body": "<p>If this is not at runtime, but statically to modify your code source, you can use <a href=\"https://github.com/fatih/gomodifytags\" rel=\"nofollow noreferrer\"><code>fatih/gomodifytags</code></a>.</p>\n\n<p>See \"<a href=\"https://about.sourcegraph.com/go/writing-a-go-tool-to-parse-and-modify-struct-tags\" rel=\"nofollow noreferrer\">Writing a Go Tool to Parse and Modify Struct Tags</a>\"</p>\n\n<blockquote>\n  <p>Struct field tags are an important part of encode/decode types, especially when using packages such as encoding/json.<br>\n  However, modifying tags is repetitive, cumbersome and open to human errors.<br>\n  We can make it easy to modify tags with an automated tool that is written for this sole purpose.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 1, "last_activity_date": 1547643524, "creation_date": 1547643524, "answer_id": 54217598, "question_id": 54209674, "link": "https://stackoverflow.com/questions/54209674/how-do-i-change-the-prefix-for-all-struct-tags-in-a-non-manual-way/54217598#54217598", "title": "How do I change the prefix for all struct tags in a non-manual way?", "body": "<p>You also can do it at runtime with <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">reflect</a> if you need.</p>\n\n<pre><code>func (m *My) MarshalJSON() ([]byte, error) {\n    oldtype := reflect.TypeOf(*m)\n    fields := make([]reflect.StructField, oldtype.NumField())\n    for i := 0; i &lt; oldtype.NumField(); i++ {\n        field := oldtype.Field(i)\n        if _, ok := field.Tag.Lookup(\"xml\"); ok {\n            field.Tag = reflect.StructTag(strings.Replace(string(field.Tag), \"xml\", \"json\", 1))\n        }\n\n        fields[i] = field\n    }\n    newtype := reflect.StructOf(fields)\n    a := reflect.ValueOf(*m).Convert(newtype).Interface()\n    return json.Marshal(&amp;a)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/RzQ7n-_s0Dq\" rel=\"nofollow noreferrer\">Working example</a></p>\n"}], "owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 2, "accepted_answer_id": 54211278, "answer_count": 2, "score": 0, "last_activity_date": 1547643524, "creation_date": 1547606297, "last_edit_date": 1547614107, "question_id": 54209674, "link": "https://stackoverflow.com/questions/54209674/how-do-i-change-the-prefix-for-all-struct-tags-in-a-non-manual-way", "title": "How do I change the prefix for all struct tags in a non-manual way?", "body": "<p>Suppose I have the following:</p>\n\n<pre><code>type My struct{\n  First string `xml:\"first\"`\n  Last string `xml:\"name\"`\n  ...many more tags...\n}\n</code></pre>\n\n<p>I'd like to change the prefix of all the tags to \"mycustomtag\". I've seen <a href=\"https://stackoverflow.com/a/42549826/522962\">https://stackoverflow.com/a/42549826/522962</a> but that describes a manual way where you have defined a second struct w/ the tags manually. How do i do so automatically?</p>\n\n<p>e.g. I'd like to end up with something like below but since there are many, many fields how do I do it so I don't have to do it manually?:</p>\n\n<pre><code>// how do I do the next part automagically????\nfunc (m *My) MarshalJSON() ([]byte, error) {\n    type alias struct {\n        First string `mycustomtag:\"first\"`\n        Last string `mycustomtag:\"name\"`\n        ...many more tags...\n    }\n    var a alias = alias(*m)\n    return json.Marshal(&amp;a)\n}\n</code></pre>\n"}, {"tags": ["linux", "go", "plugins", "interface", "code-generation"], "comments": [{"owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "edited": false, "score": 1, "creation_date": 1547604510, "post_id": 54209256, "comment_id": 95245197, "body": "Another option, since you have a layer of indirection already, is to generated a tmp .go file on the fly with a shell script then run that generated file."}], "answers": [{"tags": [], "owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "is_accepted": true, "score": 2, "last_activity_date": 1547603158, "last_edit_date": 1592644375, "creation_date": 1547603158, "answer_id": 54209336, "question_id": 54209256, "link": "https://stackoverflow.com/questions/54209256/how-to-relax-the-name-function-into-a-variable/54209336#54209336", "title": "How to relax the name FUNCTION into a variable", "body": "<p><a href=\"https://golang.org/pkg/plugin/#Symbol\" rel=\"nofollow noreferrer\">godoc</a></p>\n<blockquote>\n<p>A Symbol is a pointer to a variable or function.</p>\n<p>For example, a plugin defined as</p>\n</blockquote>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport &quot;fmt&quot;\n\nfunc F() { fmt.Printf(&quot;Hello, number %d\\n&quot;, V) }\n</code></pre>\n<blockquote>\n<p>may be loaded with the Open function and then the exported package symbols V and F can be accessed</p>\n</blockquote>\n<pre class=\"lang-golang prettyprint-override\"><code>p, err := plugin.Open(&quot;plugin_name.so&quot;)\nif err != nil {\n    panic(err)\n}\nf, err := p.Lookup(&quot;F&quot;)\nif err != nil {\n    panic(err)\n}\nf.(func())() // prints &quot;Hello, number 7&quot;\n</code></pre>\n<p>&quot;F&quot; is just a String, so you can change its value at runtime anyway.</p>\n"}], "owner": {"reputation": 22041, "user_id": 108207, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/dd8608b8b423bdcbda3fe5c0cf8b6230?s=128&d=identicon&r=PG&f=1", "display_name": "Niklas R.", "link": "https://stackoverflow.com/users/108207/niklas-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 54209336, "answer_count": 1, "score": 1, "last_activity_date": 1547603158, "creation_date": 1547602360, "question_id": 54209256, "link": "https://stackoverflow.com/questions/54209256/how-to-relax-the-name-function-into-a-variable", "title": "How to relax the name FUNCTION into a variable", "body": "<p>I code a plugin generator in Go. The <a href=\"https://gitlab.com/montao/forbasile\" rel=\"nofollow noreferrer\">repo is open</a>.</p>\n\n<p>The project creates some Go code in some temporary file defining a function taken from command-line arguments, compiles that code into a plugin, loads that plugin, gets the function in it, and invokes that with parameters, then prints the results.</p>\n\n<p>We want to be able to process several functions and several plugins. For example, a function <code>SUM</code> of body <code>return x+y;</code>, a function <code>PROD</code> of body  <code>return x*y</code>; and so on.</p>\n\n<p>I don't want the generated code to always use the\nconstant name FUNCTION. Can't the generated .go file contain a\nfunction whose name is given at runtime, i.e. my <code>funame</code>\nin the code below? Is there some feature of the Go language forbidding that?</p>\n\n<pre><code>//TODO: Investigate how to relax the name FUNCTION into a variable\ntype Xinterface interface {\n    FUNCTION(x int, y int) int\n}\n</code></pre>\n\n<p>Complete code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n    \"path/filepath\"\n    \"plugin\"\n    \"reflect\"\n    \"strconv\"\n    \"strings\"\n)\n\n\n//TODO: Investigate how to relax the name FUNCTION into a variable\ntype Xinterface interface {\n    FUNCTION(x int, y int) int\n}\n\nfunc main() {\n    //Declare good variable names and create the file for the code\n    funame := os.Args[1]\n    funamel := strings.ToLower(funame)\n    funamet := strings.Title(funame)\n    fubody := os.Args[2]\n    x1, err := strconv.Atoi(os.Args[3])\n    y1, err := strconv.Atoi(os.Args[4])\n    filename := fmt.Sprintf(\"/tmp/%s.go\", funame)\n    f, err := os.Create(filename)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    //Here comes the program\n    strprg := fmt.Sprintf(`package main \nimport (\n    \"fmt\"\n)\ntype %s string \nfunc(s %s) FUNCTION (x int, y int) int { fmt.Println(\"\")\n%s} \nvar %s %s`, funamel, funamel, fubody, funamet, funamel)\n    fmt.Printf(\"func(s %s) FUNCTION (x int, y int) int { \\n\", funamel)\n    fmt.Printf(\"start of %s: x=%d, y=%d\\n\", funamel, x1, y1)\n    l, err := f.WriteString(strprg)\n    if err != nil {\n        fmt.Println(err)\n        f.Close()\n        return\n    }\n    fmt.Println(l, \"bytes written successfully\")\n    err = f.Close()\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    ex, err := os.Executable()\n    if err != nil {\n        panic(err)\n    }\n    exPath := filepath.Dir(ex)\n    fmt.Println(exPath)\n    fmt.Println(\"compiling plugin\")\n    cmd := exec.Command(\"go\", \"build\", \"-buildmode=plugin\", \"-o\", fmt.Sprintf(\"%s%s%s\", \"/tmp/\", funame, \".so\"), fmt.Sprintf(\"%s%s%s\", \"/tmp/\", funame, \".go\"))\n\n    out, err2 := cmd.Output()\n    fmt.Println(out)\n\n    if err2 != nil {\n        fmt.Println(err2)\n        return\n    }\n    fmt.Println(\"loading module\")\n    // load module\n    // 1. open the so file to load the symbols\n    plug, err := plugin.Open(fmt.Sprintf(\"%s%s%s\", \"/tmp/\", funame, \".so\"))\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    fmt.Println(\"looking up symbol\")\n    // 2. look up a symbol (an exported function or variable)\n    // in this case, variable funame\n    symX, err := plug.Lookup(funame)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    fmt.Println(\"checking module\")\n    // 3. Assert that loaded symbol is of a desired type\n    // in this case interface type X (defined above)\n    var myvar Xinterface\n    myvar, ok := symX.(Xinterface)\n    if !ok {\n        fmt.Println(fmt.Sprintf(\"unexpected type from module symbol %s\", reflect.TypeOf(symX.(Xinterface))))\n        os.Exit(1)\n    }\n\n    // 4. use the module\n\n    fmt.Println(myvar.FUNCTION(x1, y1))\n    fmt.Println(fmt.Sprintf(\"Generated code: %s\", fmt.Sprintf(\"/tmp/%s%s\", funamet , \".go\") ))\n    fmt.Println(fmt.Sprintf(\"Generated object file: %s\", fmt.Sprintf(\"/tmp/%s%s\", funamet , \".so\") ))\n\n}\n</code></pre>\n\n<p>Example usage:</p>\n\n<pre><code>$ go run forbasile.go SUM 'return x+y' 3 5\nfunc(s sum) FUNCTION (x int, y int) int { \nstart of sum: x=3, y=5\n131 bytes written successfully\n/tmp/go-build104174513/b001/exe\ncompiling plugin\n[]\nloading module\nlooking up symbol\nchecking module\n\n8\nGenerated code: /tmp/SUM.go\nGenerated object file: /tmp/SUM.so\n$ go run forbasile.go SUMSQUARE 'return x*x + y*y' 3 4\nfunc(s sumsquare) FUNCTION (x int, y int) int { \nstart of sumsquare: x=3, y=4\n161 bytes written successfully\n/tmp/go-build555823501/b001/exe\ncompiling plugin\n[]\nloading module\nlooking up symbol\nchecking module\n\n25\nGenerated code: /tmp/SUMSQUARE.go\nGenerated object file: /tmp/SUMSQUARE.so\n</code></pre>\n"}, {"tags": ["json", "api", "go", "hyperledger"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547598041, "post_id": 54208693, "comment_id": 95243923, "body": "That&#39;s not valid json. Have you verified that you&#39;re starting with the correct data?"}, {"owner": {"reputation": 23, "user_id": 10919667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03cc7fce6943ed99d661e34fbd1a5f22?s=128&d=identicon&r=PG&f=1", "display_name": "aditanix", "link": "https://stackoverflow.com/users/10919667/aditanix"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547598192, "post_id": 54208693, "comment_id": 95243948, "body": "I am aware its not, I am looking for the valid json. I am unaware of the proper syntax for slice of structs."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1547598708, "post_id": 54208693, "comment_id": 95244071, "body": "The Attributes field is a slice.  The corresponding JSON value is an object.  Either change the JSON to include a JSON array or change the Go type to remove the slice. It&#39;s unclear which one you want."}, {"owner": {"reputation": 23, "user_id": 10919667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03cc7fce6943ed99d661e34fbd1a5f22?s=128&d=identicon&r=PG&f=1", "display_name": "aditanix", "link": "https://stackoverflow.com/users/10919667/aditanix"}, "edited": false, "score": 0, "creation_date": 1547598925, "post_id": 54208693, "comment_id": 95244123, "body": "Thanks ThunderCat. I changed the JSON. Also edited the question. Still need help."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1547600133, "post_id": 54208693, "comment_id": 95244345, "body": "The JSON is invalid.   When looking past the errors in the JSON, the JSON does not match the Go types.  It&#39;s unclear if your goal is to match the Go types to the JSON or vice versa."}], "answers": [{"tags": [], "owner": {"reputation": 23, "user_id": 10919667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03cc7fce6943ed99d661e34fbd1a5f22?s=128&d=identicon&r=PG&f=1", "display_name": "aditanix", "link": "https://stackoverflow.com/users/10919667/aditanix"}, "is_accepted": false, "score": 1, "last_activity_date": 1547599321, "creation_date": 1547599321, "answer_id": 54208879, "question_id": 54208693, "link": "https://stackoverflow.com/questions/54208693/how-do-i-pass-array-of-key-value-pairs-to-golang-slice-of-struct-through-json/54208879#54208879", "title": "How do I pass array of key,value pairs to golang slice of struct through json", "body": "<p>Finally figured out the correct syntax. We have to pass an array of structs through JSON.</p>\n\n<pre><code>{  \n   \"type\":\"string\",\n   \"name\":\"string\",\n   \"organization\":\n   {  \n      \"orgID\":\"1\",\n      \"orgName\":\"string\",\n      \"peer\":\n      {  \n         \"peerID\":\"1\",\n         \"peerName\":\"string\"\n      },\n      \"attributes\":\n      [\n        {\"slide0001.html\": \"Looking Ahead\"},\n        {\"slide0008.html\": \"Forecast\"},\n        {\"slide0021.html\": \"Summary\"}\n      ]\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "is_accepted": false, "score": 0, "last_activity_date": 1547605413, "last_edit_date": 1547605413, "creation_date": 1547605108, "answer_id": 54209529, "question_id": 54208693, "link": "https://stackoverflow.com/questions/54208693/how-do-i-pass-array-of-key-value-pairs-to-golang-slice-of-struct-through-json/54209529#54209529", "title": "How do I pass array of key,value pairs to golang slice of struct through json", "body": "<p>you can do whatever you want in a <code>UnmarshalJSON</code> Function.</p>\n\n<p>i made an example in playground. <a href=\"https://play.golang.org/p/WY6OCR8K3Co\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WY6OCR8K3Co</a></p>\n\n<p>you can get output:  <code>{A:[{Name:slide0001.html Value:Looking Ahead} {Name:slide0008.html Value:Forecast} {Name:slide0021.html Value:Summary}]}</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var (\n    jso = []byte(`\n    {  \n        \"attributes\":\n        [\n            {\"slide0001.html\": \"Looking Ahead\"},\n            {\"slide0008.html\": \"Forecast\"},\n            {\"slide0021.html\": \"Summary\"}\n        ]\n     }`)\n)\n\ntype B struct {\n    A As `json:\"attributes\"`\n}\n\ntype As []A\n\ntype A struct {\n    Name  string\n    Value string\n}\n\nfunc (as *As) UnmarshalJSON(data []byte) error {\n    var attr []interface{}\n    if err := json.Unmarshal(data, &amp;attr); err != nil {\n        return err\n    }\n    if len(attr) &gt; 0 {\n        newAs := make([]A, len(attr))\n        // i := 0\n        for i, val := range attr {\n            if kv, ok := val.(map[string]interface{}); ok &amp;&amp; len(kv) &gt; 0 {\n                for k, v := range kv {\n                    a := A{\n                        Name:  k,\n                        Value: v.(string),\n                    }\n                    newAs[i] = a\n                    i++\n                    break\n                }\n            }\n        }\n        *as = newAs\n    }\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 10919667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03cc7fce6943ed99d661e34fbd1a5f22?s=128&d=identicon&r=PG&f=1", "display_name": "aditanix", "link": "https://stackoverflow.com/users/10919667/aditanix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1788, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1547605413, "creation_date": 1547597781, "last_edit_date": 1547598966, "question_id": 54208693, "link": "https://stackoverflow.com/questions/54208693/how-do-i-pass-array-of-key-value-pairs-to-golang-slice-of-struct-through-json", "title": "How do I pass array of key,value pairs to golang slice of struct through json", "body": "<p>I am writing a simple post api request. I am able to parse the JSON into golang structs upto the peername json object. I do not know the correct syntax to populate a golang slice of a struct by passing values through the JSON body of the api.</p>\n\n<p>I am trying to parse JSON body sent through an api. This is the sample body request - </p>\n\n<pre><code>{  \n   \"type\":\"string\",\n   \"name\":\"string\",\n   \"organization\":{  \n      \"orgID\":\"1\",\n      \"orgName\":\"string\",\n      \"peer\":{  \n         \"peerID\":\"1\",\n         \"peerName\":\"string\"\n      },\n      \"attributes\":[\n    [\"slide0001.html\", \"Looking Ahead\"],\n    [\"slide0008.html\", \"Forecast\"],\n    [\"slide0021.html\", \"Summary\"]\n]\n    }\n} \"peerName\":\"string\"\n          },\n          \"attributes\":[\"name\":\"string\":\"value\":true]\n        }\n    }\n</code></pre>\n\n<p>And this is my sample golang structs.</p>\n\n<pre><code>//Identity ...\ntype Identity struct {\n    Type         string        `json:\"type,omitempty\"`\n    Name         string        `json:\"name,omitempty\"`\n    Organization *Organization `json:\"organization,omitempty\"`\n}\n\n//Organization ....\ntype Organization struct {\n    OrgID      string      `json:\"orgID,omitempty\"`\n    OrgName    string      `json:\"orgName,omitempty\"`\n    Peer       *Peer       `json:\"peer,omitempty\"`\n    Attributes *Attributes `json:\"attributes\"`\n}\n\n//Peer ...\ntype Peer struct {\n    PeerID   string `json:\"peerID,omitempty\"`\n    PeerName string `json:\"peerName,omitempty\"`\n}\n\n//Attributes ...\ntype Attributes []struct {\n    Name  string `json:\"name\"`\n    Value bool   `json:\"value\"`\n}\n</code></pre>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1547576033, "post_id": 54204625, "comment_id": 95236010, "body": "Define &quot;non-standard symbol?&quot; Anything but <code>a-zA-Z0-9</code>? Is a period (<code>.</code>) a standard symbol? What about other common punctuation <code>&quot;,&#39;?!</code>?"}, {"owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1547576066, "post_id": 54204625, "comment_id": 95236024, "body": "@AdamSmith Precisely and yes, I was about to edit in that maybe something that looks for anything that&#39;s not an English letter or number could be the key."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1547576203, "post_id": 54204625, "comment_id": 95236090, "body": "If you make a string that contains all the runes you consider &quot;standard&quot;, you can use <a href=\"https://godoc.org/strings#ContainsAny\" rel=\"nofollow noreferrer\"><code>strings.ContainsAny</code></a> and negate the result."}, {"owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1547576360, "post_id": 54204625, "comment_id": 95236165, "body": "I misread your previous comment, I&#39;ll give that a go quickly in a playground."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1547576389, "post_id": 54204625, "comment_id": 95236176, "body": "You wrote the character class you want right in the question, why not just drop that in a regex?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1547576412, "post_id": 54204625, "comment_id": 95236181, "body": "Do you know of <a href=\"https://golang.org/pkg/regexp/#Regexp.MatchString\" rel=\"nofollow noreferrer\">golang.org/pkg/regexp/#Regexp.MatchString</a> ?"}, {"owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "edited": false, "score": 1, "creation_date": 1547576535, "post_id": 54204625, "comment_id": 95236232, "body": "Okay going to give the two methods a go and write small benchmark, thanks guys. If someone wants the answer and could create a small playground that&#39;d be good, otherwise I&#39;ll write it myself and post it soon."}], "answers": [{"comments": [{"owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "edited": false, "score": 1, "creation_date": 1547577598, "post_id": 54204977, "comment_id": 95236662, "body": "Yeah this was close to what I was writing but I was struggling a bit with the must compile, thanks jubobs."}], "tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": false, "score": 3, "last_activity_date": 1547625357, "last_edit_date": 1547625357, "creation_date": 1547577473, "answer_id": 54204977, "question_id": 54204625, "link": "https://stackoverflow.com/questions/54204625/how-do-i-check-a-string-for-one-or-more-symbols/54204977#54204977", "title": "How do I check a string for one or more symbols", "body": "<p>Since the whitelist can easily be defined as a regexp, use <a href=\"https://golang.org/pkg/regexp/#Regexp.MatchString\" rel=\"nofollow noreferrer\"><code>regexp.MatchString</code></a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nvar (\n    whitelist  = \"A-Za-z0-9\"\n    disallowed = regexp.MustCompile(fmt.Sprintf(\"[^%s]+\", whitelist))\n)\n\nfunc main() {\n    fmt.Println(IsValid(\"foobar007\"))\n    fmt.Println(IsValid(\"foo%bar&amp;007\"))\n}\n\nfunc IsValid(s string) bool {\n    return !disallowed.MatchString(s)\n}\n</code></pre>\n\n<p>(<a href=\"https://play.golang.org/p/ledwkw7xSm4\" rel=\"nofollow noreferrer\">playground</a>)</p>\n"}, {"comments": [{"owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "edited": false, "score": 0, "creation_date": 1547578657, "post_id": 54205151, "comment_id": 95237119, "body": "I really like your answer for simplicity, could you elaborate how the switch case statements work here?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "edited": false, "score": 0, "creation_date": 1547580027, "post_id": 54205151, "comment_id": 95237717, "body": "@lix: See my revised answer."}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 2, "creation_date": 1547592070, "post_id": 54205151, "comment_id": 95242446, "body": "I never really thought about the actual workings of <code>switch</code> that you outlined. Thanks for the tidbit."}, {"owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "edited": false, "score": 0, "creation_date": 1547607304, "post_id": 54205151, "comment_id": 95245750, "body": "As expected it&#39;s blazing fast, I ended up implementing this version instead on my app. I also learnt a fair bit about characters and strings in go."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1547646697, "post_id": 54205151, "comment_id": 95262619, "body": "Those benchmarks are a nice touch! I won&#39;t mind if the OP ends up accepting your answer rather than mine."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 6, "last_activity_date": 1547696386, "last_edit_date": 1547696386, "creation_date": 1547578304, "answer_id": 54205151, "question_id": 54204625, "link": "https://stackoverflow.com/questions/54204625/how-do-i-check-a-string-for-one-or-more-symbols/54205151#54205151", "title": "How do I check a string for one or more symbols", "body": "<p>In Go, write a simple function. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc isStandard(s string) bool {\n    for i := 0; i &lt; len(s); i++ {\n        switch b := s[i]; {\n        case b &gt;= 'a' &amp;&amp; b &lt;= 'z':\n            continue\n        case b &gt;= 'A' &amp;&amp; b &lt;= 'Z':\n            continue\n        case b &gt;= '0' &amp;&amp; b &lt;= '9':\n            continue\n        default:\n            return false\n        }\n    }\n    return true\n}\n\nfunc main() {\n    fmt.Println(isStandard(`ABCabc123`))\n    fmt.Println(isStandard(`#}{&amp;*\"(\u00a3)`))\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Y2KjDcHSupH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Y2KjDcHSupH</a></p>\n\n<p>Output:</p>\n\n<pre><code>true\nfalse\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a> </p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\">Switch statements</a></p>\n  \n  <p>\"Switch\" statements provide multi-way execution. An expression or type\n  specifier is compared to the \"cases\" inside the \"switch\" to determine\n  which branch to execute.</p>\n  \n  <p>Expression switches</p>\n  \n  <p>In an expression switch, the switch expression is evaluated and the\n  case expressions, which need not be constants, are evaluated\n  left-to-right and top-to-bottom; the first one that equals the switch\n  expression triggers execution of the statements of the associated\n  case; the other cases are skipped. If no case matches and there is a\n  \"default\" case, its statements are executed. There can be at most one\n  default case and it may appear anywhere in the \"switch\" statement.</p>\n  \n  <p>The switch expression may be preceded by a simple statement, which\n  executes before the expression is evaluated.</p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Fallthrough_statements\" rel=\"nofollow noreferrer\">Fallthrough statements</a></p>\n  \n  <p>A \"fallthrough\" statement transfers control to the first statement of\n  the next case clause in an expression \"switch\" statement. It may be\n  used only as the final non-empty statement in such a clause.</p>\n</blockquote>\n\n<hr>\n\n<pre><code>switch b := s[i]; {\n    // ...\n}\n</code></pre>\n\n<p>is equivalent to </p>\n\n<pre><code>switch b := s[i]; true {\n    // ...\n}\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>{\n    b := s[i]\n    switch true {\n        // ...\n    } \n}\n</code></pre>\n\n<p>The simple statement <code>b := s[i]</code> declares <code>b</code> to be a <code>switch { }</code> statement block local variable.</p>\n\n<p>The case expresions are evaluated and compared to <code>true</code>. If none are true, the <code>default</code> is taken.</p>\n\n<p>Go, unlike C, requires explicit <code>fallthrough</code>.</p>\n\n<p>ASCII is a subset of Unicode UTF-8. Since the standard characters are all ASCII, we can simply compare bytes.</p>\n\n<hr>\n\n<p>Here is a simple benchmark.</p>\n\n<p>Output:</p>\n\n<pre><code>$ go test standard_test.go -bench=. -benchmem\nBenchmarkPeterSO-8    200000000       8.10 ns/op    0 B/op    0 allocs/op\nBenchmarkJubobs-8      10000000     222 ns/op       0 B/op    0 allocs/op\n$ \n</code></pre>\n\n<p><code>standard_test.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"regexp\"\n    \"testing\"\n)\n\nfunc isStandard(s string) bool {\n    for i := 0; i &lt; len(s); i++ {\n        switch b := s[i]; {\n        case b &gt;= 'a' &amp;&amp; b &lt;= 'z':\n            continue\n        case b &gt;= 'A' &amp;&amp; b &lt;= 'Z':\n            continue\n        case b &gt;= '0' &amp;&amp; b &lt;= '9':\n            continue\n        default:\n            return false\n        }\n    }\n    return true\n}\n\nfunc BenchmarkPeterSO(b *testing.B) {\n    std := `ABCabc123`\n    for N := 0; N &lt; b.N; N++ {\n        isStandard(std)\n    }\n}\n\nvar (\n    whitelist  = \"A-Za-z0-9\"\n    disallowed = regexp.MustCompile(\"[^\" + whitelist + \" ]+\")\n)\n\nfunc IsValid(s string) bool {\n    return !disallowed.MatchString(s)\n}\n\nfunc BenchmarkJubobs(b *testing.B) {\n    std := `ABCabc123`\n    for N := 0; N &lt; b.N; N++ {\n        IsValid(std)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 1, "accepted_answer_id": 54205151, "answer_count": 2, "score": -1, "last_activity_date": 1547696386, "creation_date": 1547575829, "last_edit_date": 1547666935, "question_id": 54204625, "link": "https://stackoverflow.com/questions/54204625/how-do-i-check-a-string-for-one-or-more-symbols", "title": "How do I check a string for one or more symbols", "body": "<p>I'm struggling to find a method of checking to see if a string contains one or more symbols like the following: <code>#}{&amp;*\"(\u00a3)</code> While it's fairly trivial to make a check for one or more of these symbols I'm not looking to build and maintain a list or dictionary of possible entries. Is there a way I can check to see if a string contains one or more of <em>any</em> non standard symbol in go preferably using the standard library?</p>\n\n<p>Specifically I'm looking to detect anything that isn't <code>a-zA-Z0-9</code> which for the basis of my question would be counted as a non standard symbol.</p>\n"}, {"tags": ["database", "go", "database-connection", "go-gorm"], "comments": [{"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1547574079, "post_id": 54203807, "comment_id": 95235115, "body": "Have you tried making a super simple model, migrating it and inserting some data into it?"}, {"owner": {"reputation": 33, "user_id": 9590983, "user_type": "registered", "profile_image": "https://graph.facebook.com/1691291087629366/picture?type=large", "display_name": "Alex Colussi", "link": "https://stackoverflow.com/users/9590983/alex-colussi"}, "reply_to_user": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1547576224, "post_id": 54203807, "comment_id": 95236097, "body": "@Mihailo Yes. I tried a simple get and returns an error: column &#39;&#39;columnName&quot; does not exist"}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1547576479, "post_id": 54203807, "comment_id": 95236207, "body": "Have you migrated your models? Do they exist in the database?"}, {"owner": {"reputation": 33, "user_id": 9590983, "user_type": "registered", "profile_image": "https://graph.facebook.com/1691291087629366/picture?type=large", "display_name": "Alex Colussi", "link": "https://stackoverflow.com/users/9590983/alex-colussi"}, "reply_to_user": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1547576721, "post_id": 54203807, "comment_id": 95236303, "body": "Yes. they exist"}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1547576730, "post_id": 54203807, "comment_id": 95236305, "body": "You can read up on it <a href=\"http://gorm.io/docs/migration.html\" rel=\"nofollow noreferrer\">here</a>. If the tables don&#39;t exist there&#39;s nowhere for your data to be saved."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 9590983, "user_type": "registered", "profile_image": "https://graph.facebook.com/1691291087629366/picture?type=large", "display_name": "Alex Colussi", "link": "https://stackoverflow.com/users/9590983/alex-colussi"}, "edited": false, "score": 0, "creation_date": 1547578466, "post_id": 54205030, "comment_id": 95237044, "body": "I&#39;ve tried just like your example but doesn&#39;t work. My db has multiple schemas. How I set the specific schema that I want to insert the data?"}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "reply_to_user": {"reputation": 33, "user_id": 9590983, "user_type": "registered", "profile_image": "https://graph.facebook.com/1691291087629366/picture?type=large", "display_name": "Alex Colussi", "link": "https://stackoverflow.com/users/9590983/alex-colussi"}, "edited": false, "score": 0, "creation_date": 1547578563, "post_id": 54205030, "comment_id": 95237079, "body": "What is your OS? Have you setup your user authentication to use password instead of identity? It&#39;s normal to have multiple schemas, they come by default."}, {"owner": {"reputation": 33, "user_id": 9590983, "user_type": "registered", "profile_image": "https://graph.facebook.com/1691291087629366/picture?type=large", "display_name": "Alex Colussi", "link": "https://stackoverflow.com/users/9590983/alex-colussi"}, "edited": false, "score": 0, "creation_date": 1547579221, "post_id": 54205030, "comment_id": 95237387, "body": "it is w10. I&#39;ve already create, update, delete and get data from database. Now I&#39;m trying to use the gorm package to simplify things..."}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "reply_to_user": {"reputation": 33, "user_id": 9590983, "user_type": "registered", "profile_image": "https://graph.facebook.com/1691291087629366/picture?type=large", "display_name": "Alex Colussi", "link": "https://stackoverflow.com/users/9590983/alex-colussi"}, "edited": false, "score": 0, "creation_date": 1547579453, "post_id": 54205030, "comment_id": 95237477, "body": "OK so you&#39;re sure your user has <b>authentication via password and not identity</b>? If you copy-paste my code in a new file, change the credentials and run it. Does it insert into your db?"}, {"owner": {"reputation": 33, "user_id": 9590983, "user_type": "registered", "profile_image": "https://graph.facebook.com/1691291087629366/picture?type=large", "display_name": "Alex Colussi", "link": "https://stackoverflow.com/users/9590983/alex-colussi"}, "edited": false, "score": 0, "creation_date": 1547579709, "post_id": 54205030, "comment_id": 95237586, "body": "It runs, but does not insert in to db!!"}, {"owner": {"reputation": 33, "user_id": 9590983, "user_type": "registered", "profile_image": "https://graph.facebook.com/1691291087629366/picture?type=large", "display_name": "Alex Colussi", "link": "https://stackoverflow.com/users/9590983/alex-colussi"}, "edited": false, "score": 0, "creation_date": 1547632096, "post_id": 54205030, "comment_id": 95254249, "body": "I found where the data is saved. This example create a new table in PUBLIC SCHEMAS. I&#39;m trying to save data in a schema that already exist, just a row with firstname, lastname, age etc...How can I do this? @Mihailo"}], "tags": [], "owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "is_accepted": false, "score": -2, "last_activity_date": 1547577724, "creation_date": 1547577724, "answer_id": 54205030, "question_id": 54203807, "link": "https://stackoverflow.com/questions/54203807/how-set-a-specifc-database-schema-with-gorm/54205030#54205030", "title": "how set a specifc database schema with gorm?", "body": "<p>Here's a basic example of pretty much all you need to insert some simple data<br> into a <strong>PostgreSQL</strong> database via <strong>gorm</strong>.</p>\n\n<blockquote>\n  <p>main.go</p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\" // Don't forget the dialect\n)\n\n// Simple Example model\ntype FuelType struct {\n    gorm.Model // Gorm default columns (id, created_at, updated_at, deleted_at)\n    Name string\n}\n\nfunc main() {\n    // Database initialization\n    db, err := gorm.Open(\n        \"postgres\",\n        \"host=localhost port=5432 user=postgres dbname=foo password=bar sslmode=disable\",\n    )\n    if err != nil {\n        log.Fatalln(\"Can't connect to the db: \", err)\n    }\n    defer func() {\n        if err := db.Close(); err != nil {\n            log.Fatalln(\"Can't close the db connection: \", err)\n        }\n    }()\n\n    // Migration\n    db.AutoMigrate(&amp;FuelType{})\n\n    // Insertion\n    fuelType := FuelType{Name: \"100 GFuel\"}\n    db.Create(&amp;fuelType)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1151, "user_id": 4214922, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/100003077452923/picture?type=large", "display_name": "Mike Ottink", "link": "https://stackoverflow.com/users/4214922/mike-ottink"}, "edited": false, "score": 0, "creation_date": 1610530925, "post_id": 56944206, "comment_id": 116160598, "body": "I get the following error <code>DefaultTableNameHandler not declared by package gorm</code>"}], "tags": [], "owner": {"reputation": 21, "user_id": 6587371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/813a63448e3267f4100770632f23beb8?s=128&d=identicon&r=PG&f=1", "display_name": "Alan.WCR", "link": "https://stackoverflow.com/users/6587371/alan-wcr"}, "is_accepted": false, "score": 2, "last_activity_date": 1562634888, "creation_date": 1562634888, "answer_id": 56944206, "question_id": 54203807, "link": "https://stackoverflow.com/questions/54203807/how-set-a-specifc-database-schema-with-gorm/56944206#56944206", "title": "how set a specifc database schema with gorm?", "body": "<p>before automigrate do</p>\n\n<pre><code>gorm.DefaultTableNameHandler = func(dbVeiculosGorm *gorm.DB, defaultTableName string) string {\n    return \"your schema name.\" + defaultTableName\n}\n\ndbVeiculosGorm.AutoMigrate(&amp;model.Veiculo{})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 713, "user_id": 12162813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-22W2wmyNnEQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfCiW9MIj-T5ov3H31eHm8dOqD1pg/photo.jpg?sz=128", "display_name": "Thushara Buddhika", "link": "https://stackoverflow.com/users/12162813/thushara-buddhika"}, "is_accepted": false, "score": 1, "last_activity_date": 1578476205, "creation_date": 1578476205, "answer_id": 59643053, "question_id": 54203807, "link": "https://stackoverflow.com/questions/54203807/how-set-a-specifc-database-schema-with-gorm/59643053#59643053", "title": "how set a specifc database schema with gorm?", "body": "<p>In Addition to <strong>Alan.WCR</strong> to Capitalize Table name,</p>\n\n<pre><code>gorm.DefaultTableNameHandler = func(db *gorm.DB, table string) string {\n    var tableName string\n    names := strings.Split(table, \"_\")\n    for _, name := range names {\n        tableName = tableName + strings.Title(name)\n    }\n    return \"Users.\" + tableName\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 139, "user_id": 2522715, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I4uFY.png?s=128&g=1", "display_name": "Yurifull", "link": "https://stackoverflow.com/users/2522715/yurifull"}, "is_accepted": false, "score": 0, "last_activity_date": 1593735487, "creation_date": 1593735487, "answer_id": 62706754, "question_id": 54203807, "link": "https://stackoverflow.com/questions/54203807/how-set-a-specifc-database-schema-with-gorm/62706754#62706754", "title": "how set a specifc database schema with gorm?", "body": "<p>I use this configuration with my database with singular names with postgresql.</p>\n<pre><code>gorm.DefaultTableNameHandler = func(db *gorm.DB, table string) string {\n    fmt.Printf(table)\n    return &quot;schema_name.&quot; + table[:len(table)-1]\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 14096116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/27705d0bf479e8e777fc55b42c27923b?s=128&d=identicon&r=PG&f=1", "display_name": "Ethan Pailes", "link": "https://stackoverflow.com/users/14096116/ethan-pailes"}, "is_accepted": false, "score": 0, "last_activity_date": 1601989535, "creation_date": 1601989535, "answer_id": 64226416, "question_id": 54203807, "link": "https://stackoverflow.com/questions/54203807/how-set-a-specifc-database-schema-with-gorm/64226416#64226416", "title": "how set a specifc database schema with gorm?", "body": "<p>I don't have the reputation to comment yet or I would comment on Yurifull's post. It is worth mentioning that singularizing is a big more complex than chopping off the last character. Fortunately, jinzhu has split the singularization logic out into its own package so we can update Yurifull's code to look like:</p>\n<pre><code>import (\n    &quot;github.com/jinzhu/inflection&quot;\n)\n\n...\n\ngorm.DefaultTableNameHandler = func(db *gorm.DB, table string) string {\n    fmt.Printf(table)\n    return &quot;schema_name.&quot; + inflection.Singular(table)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1506, "user_id": 8689709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cd57855e7bff23fbca35abc8ddc0073?s=128&d=identicon&r=PG", "display_name": "Bill Zelenko", "link": "https://stackoverflow.com/users/8689709/bill-zelenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1613448350, "creation_date": 1613448350, "answer_id": 66218563, "question_id": 54203807, "link": "https://stackoverflow.com/questions/54203807/how-set-a-specifc-database-schema-with-gorm/66218563#66218563", "title": "how set a specifc database schema with gorm?", "body": "<p>To specify specific schema in your create statement modify your code like so:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>dbVeiculosGorm.Table(&quot;schema.tablename&quot;).Create(&amp;model.Veiculo{Placa: veiculo.Placa, Nome: veiculo.Nome}\n</code></pre>\n<p>To specify schema for your migrate action, add this method:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>type Veiculo struct {\n    gorm.Model\n    Codigo int    `json:&quot;vei_codigo&quot;`\n    Placa  string `json:&quot;vei_placa&quot;`\n    Nome   string `json:&quot;vei_nome&quot;`\n}\n\nfunc (u *Veiculo) TableName() string {\n    // custom table name, this is default\n    return &quot;schema.veiculo&quot;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 10027872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1310284b72992341109cb7cfcb850848?s=128&d=identicon&r=PG&f=1", "display_name": "hbswift", "link": "https://stackoverflow.com/users/10027872/hbswift"}, "is_accepted": false, "score": 0, "last_activity_date": 1617807580, "creation_date": 1617807580, "answer_id": 66988752, "question_id": 54203807, "link": "https://stackoverflow.com/questions/54203807/how-set-a-specifc-database-schema-with-gorm/66988752#66988752", "title": "how set a specifc database schema with gorm?", "body": "<p>If you are using the latest version of gorm this WILL not work:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>gorm.DefaultTableNameHandler = func(dbVeiculosGorm *gorm.DB, defaultTableName string) string {\n    return &quot;your schema name.&quot; + defaultTableName\n}\n\ndbVeiculosGorm.AutoMigrate(&amp;model.Veiculo{})\n</code></pre>\n<p>Instead define your naming convention in the gorm config. Example:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>    dsn := &quot;host=localhost user=myuser dbname=golang_tutorial port=5432&quot;\n    db,err := gorm.Open(postgres.Open(dsn), &amp;gorm.Config{\n            NamingStrategy: schema.NamingStrategy{\n                TablePrefix: &quot;golang_crud.&quot;, // schema name  \n                SingularTable: true,\n            },\n    })\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3, "user_id": 5705601, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IIYDE.jpg?s=128&g=1", "display_name": "Amr Ali", "link": "https://stackoverflow.com/users/5705601/amr-ali"}, "is_accepted": false, "score": 0, "last_activity_date": 1618979156, "creation_date": 1618979156, "answer_id": 67189272, "question_id": 54203807, "link": "https://stackoverflow.com/questions/54203807/how-set-a-specifc-database-schema-with-gorm/67189272#67189272", "title": "how set a specifc database schema with gorm?", "body": "<p>The Answer of <strong>@hbswift</strong> also worked for me but I tried something before which is a little bit different inspired by latest gorm Close idea.</p>\n<pre><code>func ConnectDB() (db *gorm.DB, err error) {\n    db, err = gorm.Open(postgres.New(postgres.Config{\n        DSN:                  `user=postgres password=a12345 dbname=YOUR-DB-NAME port=5432 sslmode=disable`,\n        PreferSimpleProtocol: true, // disables implicit prepared statement usage. By default pgx automatically uses the extended protocol\n    }), &amp;gorm.Config{})\n    return\n}\n\n\nfunc main() {\n    var sqlDB *sql.DB\n    var db *gorm.DB\n    {\n        var err error\n        db, err = ConnectDB()\n        if err != nil {\n            os.Exit(-1)\n        }\n        sqlDB, _ = db.DB()\n        sqlDB.Exec(`set search_path='Schema-Name'`)\n    }\n    defer sqlDB.Close()\n\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 9590983, "user_type": "registered", "profile_image": "https://graph.facebook.com/1691291087629366/picture?type=large", "display_name": "Alex Colussi", "link": "https://stackoverflow.com/users/9590983/alex-colussi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3774, "favorite_count": 1, "answer_count": 8, "score": 2, "last_activity_date": 1618979156, "creation_date": 1547572517, "last_edit_date": 1548631424, "question_id": 54203807, "link": "https://stackoverflow.com/questions/54203807/how-set-a-specifc-database-schema-with-gorm", "title": "how set a specifc database schema with gorm?", "body": "<p>I'm developing an CRUD app. I'm reading an JSON from an api and I want to write this JSON in a database with \"database/sql\" and GORM in a spcific schema\nthe struct:</p>\n\n<pre><code>type Veiculo struct {\ngorm.Model\nCodigo                int       `json:\"vei_codigo\"`\nPlaca                 string    `json:\"vei_placa\"`\nNome                  string    `json:\"vei_nome\"`\n}\n</code></pre>\n\n<p>the endpoint function:</p>\n\n<pre><code>func CreateVeiculo(c *gin.Context) {\n\nvar veiculo model.Veiculo\n//id := c.Params.ByName(\"id\")\n\nc.BindJSON(&amp;veiculo)\nc.JSON(200, veiculo)\n\npsqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\" password=%s dbname=%s sslmode=disable\", host, port, user, password, dbname)\ndbVeiculosGorm, err := gorm.Open(\"postgres\", psqlInfo)\nif err != nil {\n    panic(err)\n}\ndefer dbVeiculosGorm.Close()\n\ndbVeiculosGorm.AutoMigrate(&amp;model.Veiculo{})\n\n//t := time.Now()\n//ts := t.Format(\"2006-01-02 15:04:05\")\n\ndbVeiculosGorm.Create(&amp;model.Veiculo{Placa: veiculo.Placa, Nome: veiculo.Nome}\n</code></pre>\n\n<p>but the database is untouchable. There is multiple schemas. Do i have to set the specific schema?? What am i doing wrong?</p>\n"}, {"tags": ["go", "protocol-buffers", "ipc", "packet"], "comments": [{"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1547583929, "post_id": 54203692, "comment_id": 95239310, "body": "Could you please clarify a few things: Why is the packet stored in a field of the API and where does this length come from? Is all you really want to do writing a byte array consisting of the length (4 bytes) and then the actual message to the connection?"}, {"owner": {"reputation": 1781, "user_id": 4515566, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bOOZ7.jpg?s=128&g=1", "display_name": "arainone", "link": "https://stackoverflow.com/users/4515566/arainone"}, "edited": false, "score": 0, "creation_date": 1574155200, "post_id": 54203692, "comment_id": 104120651, "body": "What about accepting an answer?"}], "answers": [{"comments": [{"owner": {"reputation": 435, "user_id": 10061533, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fv61VUShbCs/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rTOnJlSCJr_asOOUez6u2WFiAdCQ/mo/photo.jpg?sz=128", "display_name": "Cubey Mew", "link": "https://stackoverflow.com/users/10061533/cubey-mew"}, "edited": false, "score": 0, "creation_date": 1547592647, "post_id": 54207398, "comment_id": 95242645, "body": "My purpose is to put the serialized buffer into the <code>packet</code>, instead of writing it directly to <code>conn</code>.  because the packet was already used by other components for my project. I can not refactor it. <code>proto.Marshal</code> returns <code>[]byte</code> and was copied into my packet. I am seeking a way to avoid the copy. An example is protobuf C++ API, it can marshal message into an <code>already allocated buffer</code>.  But go protobuf can only return it."}], "tags": [], "owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "is_accepted": false, "score": 0, "last_activity_date": 1547589137, "creation_date": 1547589137, "answer_id": 54207398, "question_id": 54203692, "link": "https://stackoverflow.com/questions/54203692/can-go-protobuf-marshal-message-to-an-already-allocated-byte-array-without-copy/54207398#54207398", "title": "Can go protobuf marshal message to an already allocated byte array without copy?", "body": "<p>It is not clear what you are asking. Notice that the proto Marshal() function does exactly what you are looking for: It serializes the message into a byte slice (what you probably mean by byte array) </p>\n\n<p>See if either of these help:</p>\n\n<pre><code>func(api *API) Send(m *proto.Message) error {\n    p := Packet{}\n    p.buffer, err := proto.Marshal(m)\n    if err != nil {\n        return err\n    }\n    _, err := api.conn.Write(p.buffer)\n    if err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>func(api *API) Send(m *proto.Message) error {\n    buffer := api.packet[:length]\n    buffer, err := proto.Marshal(m)\n    if err != nil {\n        return err\n    }\n    _, err := api.conn.Write(buffer)\n    if err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1547598037, "creation_date": 1547598037, "answer_id": 54208720, "question_id": 54203692, "link": "https://stackoverflow.com/questions/54203692/can-go-protobuf-marshal-message-to-an-already-allocated-byte-array-without-copy/54208720#54208720", "title": "Can go protobuf marshal message to an already allocated byte array without copy?", "body": "<p>Seems you can make <code>Packet.buffer</code> to be a <a href=\"https://godoc.org/github.com/golang/protobuf/proto#Buffer\" rel=\"nofollow noreferrer\"><code>proto.Buffer</code></a></p>\n\n<pre><code>type Packet struct {\n    length uint32\n    buffer proto.Buffer\n}\n...\nvar packet Packet\npacket.length = YouLength\npacket.buffer = proto.NewBuffer(make([]byte, YouLength))\n//Then you can Marshall in Packet directly and it  may be reused.\nerr := packet.Marshal(message)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1781, "user_id": 4515566, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bOOZ7.jpg?s=128&g=1", "display_name": "arainone", "link": "https://stackoverflow.com/users/4515566/arainone"}, "is_accepted": false, "score": 2, "last_activity_date": 1559798164, "creation_date": 1559798164, "answer_id": 56471244, "question_id": 54203692, "link": "https://stackoverflow.com/questions/54203692/can-go-protobuf-marshal-message-to-an-already-allocated-byte-array-without-copy/56471244#56471244", "title": "Can go protobuf marshal message to an already allocated byte array without copy?", "body": "<p>You're looking for <a href=\"https://godoc.org/github.com/gogo/protobuf/plugin/marshalto\" rel=\"nofollow noreferrer\">MarshalTo</a> method from <code>gogo/protobuf</code>, another implementation of protobuf, compatible with the original.</p>\n\n<p>You can re-use the same buffer through multiple marshal calls as you pass it the buffer to be filled. Obviously the buffer should be big enough.</p>\n\n<pre><code>func MarshalTo([]byte, m) error \n</code></pre>\n"}], "owner": {"reputation": 435, "user_id": 10061533, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fv61VUShbCs/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rTOnJlSCJr_asOOUez6u2WFiAdCQ/mo/photo.jpg?sz=128", "display_name": "Cubey Mew", "link": "https://stackoverflow.com/users/10061533/cubey-mew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1956, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1559798164, "creation_date": 1547572105, "question_id": 54203692, "link": "https://stackoverflow.com/questions/54203692/can-go-protobuf-marshal-message-to-an-already-allocated-byte-array-without-copy", "title": "Can go protobuf marshal message to an already allocated byte array without copy?", "body": "<p>I am implementing client server communication by self defined packets.\nI am using Go <code>net.conn</code>. It can dial tcp/unix schemes which is very convenient. I use <code>protocol buffer</code> to define my messages.</p>\n\n<p>I defined a Packet which contains <code>length</code> and <code>buffer</code>  </p>\n\n<pre><code>type Packet struct {\n    length uint32\n    buffer []byte\n}\n</code></pre>\n\n<p>The API function is like this:<br>\n<code>func(api *API) Send(m *proto.Message) error</code><br>\n<code>func(api *API) Receive(p *Packet) error</code></p>\n\n<p>Take <code>send</code> function as an example, it takes in a protobuf message, marshal it into <code>Packet</code>. And write it to the <code>net.conn</code>. </p>\n\n<p>Here is a simplified version of the Send function:</p>\n\n<pre><code>func(api *API) Send(m *proto.Message) error {\n    bytes, err := proto.Marshal(m)\n    if err != nil {\n        return err\n    }\n    buffer := api.packet[:length]\n    copy(buffer, bytes)\n    _, err := api.conn.Write(buffer)\n    if err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>I was copying <code>bytes</code> into <code>buffer</code>. Because Go protocol buffer API only provides<br>\n <code>func Marshal(pb Message) ([]byte, error)</code></p>\n\n<p>In protocol buffer C++, it provides\n<code>bool SerializeToArray(void * data, int size) const</code>, which is serializing the message and storing it in the given byte array.\nBut I can not find the same thing in Go protocol buffer API.</p>\n\n<p>Is there any way to avoid the copy if I want to directly storing serialized result in the given byte array? </p>\n"}, {"tags": ["go", "exec", "fuse"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1547572925, "post_id": 54203525, "comment_id": 95234546, "body": "Without a way to reproduce it&#39;s hard to say what you should try next. Start by seeing were <code>Start()</code> is hanging."}, {"owner": {"reputation": 799, "user_id": 675083, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/l75tP.jpg?s=128&g=1", "display_name": "sbs", "link": "https://stackoverflow.com/users/675083/sbs"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547641776, "post_id": 54203525, "comment_id": 95259791, "body": "It hangs at the os.StartProcess() call, which calls startProcess() in os/exec_posix.go, but I can&#39;t log inside there due to an import cycle."}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1547655172, "post_id": 54203525, "comment_id": 95267924, "body": "Might try <code>strace -f -o yourOutputFile yourCommand</code> and see if there&#39;s a specific system call that is hanging."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547656113, "post_id": 54203525, "comment_id": 95268491, "body": "Just look at the stack trace, and it will show you the exact line number that&#39;s hanging."}, {"owner": {"reputation": 799, "user_id": 675083, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/l75tP.jpg?s=128&g=1", "display_name": "sbs", "link": "https://stackoverflow.com/users/675083/sbs"}, "edited": false, "score": 0, "creation_date": 1547657755, "post_id": 54203525, "comment_id": 95269433, "body": "How do I see a stack trace at the time it has hung?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547664217, "post_id": 54203525, "comment_id": 95272650, "body": "send a SIGQUIT, panic with <code>GOTRACEBACK=all</code>, or setup a pprof http handler."}, {"owner": {"reputation": 799, "user_id": 675083, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/l75tP.jpg?s=128&g=1", "display_name": "sbs", "link": "https://stackoverflow.com/users/675083/sbs"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1548847960, "post_id": 54203525, "comment_id": 95688420, "body": "SIGQUIT did nothing. Putting a timeout with panic around the thing that does the Start() call also did not result in a panic until I did the <code>sudo umount -f</code>. Stack trace in my answer below @JimB"}], "answers": [{"tags": [], "owner": {"reputation": 799, "user_id": 675083, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/l75tP.jpg?s=128&g=1", "display_name": "sbs", "link": "https://stackoverflow.com/users/675083/sbs"}, "is_accepted": false, "score": 0, "last_activity_date": 1548848134, "last_edit_date": 1548848134, "creation_date": 1547657845, "answer_id": 54221849, "question_id": 54203525, "link": "https://stackoverflow.com/questions/54203525/golang-cmd-start-hanging-on-fuse-mounted-dir-sometimes/54221849#54221849", "title": "Golang cmd.Start() hanging on fuse mounted dir sometimes", "body": "<p>Seems like some sort of magical timing issue. I noticed that startProcess() in os/exec_posix.go does a Stat() call, so I just did the Stat() myself before calling Start(), and the problem seems to have gone away (or got rarer than 1/1000).</p>\n\n<p>Edit: Still happens, just rarer. Stack trace from when it hangs:</p>\n\n<pre><code>goroutine 648 [running]:\ngithub.com/VertebrateResequencing/wr/cmd.glob..func21.2(0xc0003c5140)\n    /home/ubuntu/wr/cmd/runner.go:205 +0x131\ncreated by github.com/VertebrateResequencing/wr/cmd.glob..func21\n    /home/ubuntu/wr/cmd/runner.go:200 +0x69e\n\ngoroutine 1 [runnable]:\nsyscall.Close(0xf, 0xc0006cedc0, 0x4)\n    /home/ubuntu/go/src/syscall/zsyscall_linux_amd64.go:309 +0xcc\nsyscall.forkExec(0xc0005a6d10, 0x9, 0xc0002fd8c0, 0x3, 0x3, 0xc0008288a8, 0x20, 0x0, 0xc00054cda0)\n    /home/ubuntu/go/src/syscall/exec_unix.go:202 +0x3a9\nsyscall.StartProcess(0xc0005a6d10, 0x9, 0xc0002fd8c0, 0x3, 0x3, 0xc0008288a8, 0x2, 0x4, 0x0, 0x0)\n    /home/ubuntu/go/src/syscall/exec_unix.go:241 +0x64\nos.startProcess(0xc0005a6d10, 0x9, 0xc0002fd8c0, 0x3, 0x3, 0xc000828a38, 0xc0000d6280, 0x27, 0x27)\n    /home/ubuntu/go/src/os/exec_posix.go:46 +0x213\nos.StartProcess(0xc0005a6d10, 0x9, 0xc0002fd8c0, 0x3, 0x3, 0xc000828a38, 0x0, 0x0, 0x101)\n    /home/ubuntu/go/src/os/exec.go:102 +0x7c\nos/exec.(*Cmd).Start(0xc000235b80, 0x351a1ba9ae4, 0x287cf80)\n    /home/ubuntu/go/src/os/exec/exec.go:383 +0x4bc\ngithub.com/VertebrateResequencing/wr/jobqueue.(*Client).Execute(0xc0003829a0, 0xc00015fb80, 0xc00035ea88, 0x4, 0x0, 0x0)\n    /home/ubuntu/wr/jobqueue/client.go:753 +0x144c\ngithub.com/VertebrateResequencing/wr/cmd.glob..func21(0x286a2e0, 0xc000382840, 0x0, 0xb)\n    /home/ubuntu/wr/cmd/runner.go:210 +0x74e\ngithub.com/spf13/cobra.(*Command).execute(0x286a2e0, 0xc000382790, 0xb, 0xb, 0x286a2e0, 0xc000382790)\n    /home/ubuntu/go/pkg/mod/github.com/spf13/cobra@v0.0.0-20180829160745-99dc12355885/command.go:766 +0x2cc\ngithub.com/spf13/cobra.(*Command).ExecuteC(0x286a080, 0x14e26de, 0x286a080, 0xc0004dff30)\n    /home/ubuntu/go/pkg/mod/github.com/spf13/cobra@v0.0.0-20180829160745-99dc12355885/command.go:852 +0x2fd\ngithub.com/spf13/cobra.(*Command).Execute(0x286a080, 0xc0004dff88, 0x405700)\n    /home/ubuntu/go/pkg/mod/github.com/spf13/cobra@v0.0.0-20180829160745-99dc12355885/command.go:800 +0x2b\ngithub.com/VertebrateResequencing/wr/cmd.Execute()\n    /home/ubuntu/wr/cmd/root.go:83 +0x2d\nmain.main()\n    /home/ubuntu/wr/main.go:120 +0x90\n\ngoroutine 18 [runnable]:\nos/signal.process(0x1b5d5a0, 0xc0004d8000)\n    /home/ubuntu/go/src/os/signal/signal.go:223 +0xf6\nos/signal.loop()\n    /home/ubuntu/go/src/os/signal/signal_unix.go:23 +0x52\ncreated by os/signal.init.0\n    /home/ubuntu/go/src/os/signal/signal_unix.go:29 +0x41\n\ngoroutine 33 [chan receive, 8 minutes]:\nk8s.io/klog.(*loggingT).flushDaemon(0x287d580)\n    /home/ubuntu/go/pkg/mod/k8s.io/klog@v0.1.0/klog.go:941 +0x8b\ncreated by k8s.io/klog.init.0\n    /home/ubuntu/go/pkg/mod/k8s.io/klog@v0.1.0/klog.go:403 +0x69\n\ngoroutine 175 [runnable]:\ngithub.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount.func1(0xc000344d20, 0xc00015f340)\n    /home/ubuntu/wr/jobqueue/job.go:574 +0x38\ncreated by github.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount\n    /home/ubuntu/wr/jobqueue/job.go:573 +0x930\n\ngoroutine 9 [select, 8 minutes]:\nnanomsg.org/go-mangos.(*dialer).dialer(0xc00052a1c0)\n    /home/ubuntu/go/pkg/mod/nanomsg.org/go-mangos@v0.0.0-20180815160134-b7ff4263f0d7/core.go:629 +0x347\ncreated by nanomsg.org/go-mangos.(*dialer).Dial\n    /home/ubuntu/go/pkg/mod/nanomsg.org/go-mangos@v0.0.0-20180815160134-b7ff4263f0d7/core.go:584 +0xbc\n\ngoroutine 38 [select, 8 minutes]:\nnanomsg.org/go-mangos/protocol/req.(*req).resender(0xc0003828f0)\n    /home/ubuntu/go/pkg/mod/nanomsg.org/go-mangos@v0.0.0-20180815160134-b7ff4263f0d7/protocol/req/req.go:83 +0x100\ncreated by nanomsg.org/go-mangos/protocol/req.(*req).AddEndpoint.func1\n    /home/ubuntu/go/pkg/mod/nanomsg.org/go-mangos@v0.0.0-20180815160134-b7ff4263f0d7/protocol/req/req.go:185 +0x57\n\ngoroutine 39 [IO wait, 7 minutes]:\ninternal/poll.runtime_pollWait(0x7f0b6fcc5d60, 0x72, 0xc0005598c0)\n    /home/ubuntu/go/src/runtime/netpoll.go:173 +0x66\ninternal/poll.(*pollDesc).wait(0xc000562018, 0x72, 0xffffffffffffff00, 0x1b51640, 0x2804620)\n    /home/ubuntu/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a\ninternal/poll.(*pollDesc).waitRead(0xc000562018, 0xc00046e800, 0x800, 0x800)\n    /home/ubuntu/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d\ninternal/poll.(*FD).Read(0xc000562000, 0xc00046e800, 0x800, 0x800, 0x0, 0x0, 0x0)\n    /home/ubuntu/go/src/internal/poll/fd_unix.go:169 +0x179\nnet.(*netFD).Read(0xc000562000, 0xc00046e800, 0x800, 0x800, 0x40884b, 0xc00002e000, 0x16bebe0)\n    /home/ubuntu/go/src/net/fd_unix.go:202 +0x4f\nnet.(*conn).Read(0xc000418008, 0xc00046e800, 0x800, 0x800, 0x0, 0x0, 0x0)\n    /home/ubuntu/go/src/net/net.go:177 +0x68\ncrypto/tls.(*block).readFromUntil(0xc000566090, 0x1b4f600, 0xc000418008, 0x5, 0xc000418008, 0xc00046e805)\n    /home/ubuntu/go/src/crypto/tls/conn.go:492 +0x89\ncrypto/tls.(*Conn).readRecord(0xc00031c000, 0x19c2117, 0xc00031c120, 0x0)\n    /home/ubuntu/go/src/crypto/tls/conn.go:593 +0xdd\ncrypto/tls.(*Conn).Read(0xc00031c000, 0xc0005a69d0, 0x8, 0x8, 0x0, 0x0, 0x0)\n    /home/ubuntu/go/src/crypto/tls/conn.go:1145 +0xf1\nio.ReadAtLeast(0x7f0b6fb25228, 0xc00031c000, 0xc0005a69d0, 0x8, 0x8, 0x8, 0x1633ae0, 0xc000559c01, 0xc0005a69d0)\n    /home/ubuntu/go/src/io/io.go:310 +0x88\nio.ReadFull(0x7f0b6fb25228, 0xc00031c000, 0xc0005a69d0, 0x8, 0x8, 0x43b11d, 0xc0003c45f8, 0x0)\n    /home/ubuntu/go/src/io/io.go:329 +0x58\nencoding/binary.Read(0x7f0b6fb25228, 0xc00031c000, 0x1b75aa0, 0x289ebd8, 0x15b5060, 0xc0005a69c8, 0x2, 0x2)\n    /home/ubuntu/go/src/encoding/binary/binary.go:171 +0x50a\nnanomsg.org/go-mangos.(*conn).Recv(0xc0000d0690, 0xc0002c08c0, 0x0, 0x0)\n    /home/ubuntu/go/pkg/mod/nanomsg.org/go-mangos@v0.0.0-20180815160134-b7ff4263f0d7/conn.go:52 +0xa7\nnanomsg.org/go-mangos.(*pipe).RecvMsg(0xc0000d06e0, 0xc000559f38)\n    /home/ubuntu/go/pkg/mod/nanomsg.org/go-mangos@v0.0.0-20180815160134-b7ff4263f0d7/pipe.go:109 +0x37\nnanomsg.org/go-mangos/protocol/req.(*req).receiver(0xc0003828f0, 0x1b6e220, 0xc0000d06e0)\n    /home/ubuntu/go/pkg/mod/nanomsg.org/go-mangos@v0.0.0-20180815160134-b7ff4263f0d7/protocol/req/req.go:114 +0x91\ncreated by nanomsg.org/go-mangos/protocol/req.(*req).AddEndpoint\n    /home/ubuntu/go/pkg/mod/nanomsg.org/go-mangos@v0.0.0-20180815160134-b7ff4263f0d7/protocol/req/req.go:193 +0x174\n\ngoroutine 40 [select, 7 minutes]:\nnanomsg.org/go-mangos/protocol/req.(*req).sender(0xc0003828f0, 0xc00056e840)\n    /home/ubuntu/go/pkg/mod/nanomsg.org/go-mangos@v0.0.0-20180815160134-b7ff4263f0d7/protocol/req/req.go:149 +0x18e\ncreated by nanomsg.org/go-mangos/protocol/req.(*req).AddEndpoint\n    /home/ubuntu/go/pkg/mod/nanomsg.org/go-mangos@v0.0.0-20180815160134-b7ff4263f0d7/protocol/req/req.go:195 +0x1b2\n\ngoroutine 51 [runnable]:\ncrypto/tls.(*block).resize(0xc0002fc180, 0xf)\n    /home/ubuntu/go/src/crypto/tls/conn.go:457 +0x72\ncrypto/tls.(*halfConn).decrypt(0xc000088820, 0xc0002fc180, 0x1f, 0xc0002fc180, 0x0)\n    /home/ubuntu/go/src/crypto/tls/conn.go:314 +0x700\ncrypto/tls.(*Conn).readRecord(0xc000088700, 0x19c2117, 0xc000088820, 0x455220)\n    /home/ubuntu/go/src/crypto/tls/conn.go:650 +0x27e\ncrypto/tls.(*Conn).Read(0xc000088700, 0xc0002e5000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /home/ubuntu/go/src/crypto/tls/conn.go:1145 +0xf1\nnet/http.(*persistConn).Read(0xc00007dc20, 0xc0002e5000, 0x1000, 0x1000, 0xc00055cc70, 0x404cd5, 0xc000830480)\n    /home/ubuntu/go/src/net/http/transport.go:1497 +0x75\nbufio.(*Reader).fill(0xc000509f80)\n    /home/ubuntu/go/src/bufio/bufio.go:100 +0x10f\nbufio.(*Reader).Peek(0xc000509f80, 0x1, 0x0, 0x0, 0x1, 0xc0008300c0, 0x0)\n    /home/ubuntu/go/src/bufio/bufio.go:132 +0x3f\nnet/http.(*persistConn).readLoop(0xc00007dc20)\n    /home/ubuntu/go/src/net/http/transport.go:1645 +0x1a2\ncreated by net/http.(*Transport).dialConn\n    /home/ubuntu/go/src/net/http/transport.go:1338 +0x941\n\ngoroutine 52 [select, 7 minutes]:\nnet/http.(*persistConn).writeLoop(0xc00007dc20)\n    /home/ubuntu/go/src/net/http/transport.go:1885 +0x113\ncreated by net/http.(*Transport).dialConn\n    /home/ubuntu/go/src/net/http/transport.go:1339 +0x966\n\ngoroutine 41 [runnable]:\ngithub.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount.func1(0xc00089c060, 0xc000402580)\n    /home/ubuntu/wr/jobqueue/job.go:574 +0x38\ncreated by github.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount\n    /home/ubuntu/wr/jobqueue/job.go:573 +0x930\n\ngoroutine 660 [runnable]:\nsyscall.Syscall(0x0, 0xe, 0xc000cf8000, 0x11000, 0x30, 0x11000, 0x0)\n    /home/ubuntu/go/src/syscall/asm_linux_amd64.s:18 +0x5\nsyscall.read(0xe, 0xc000cf8000, 0x11000, 0x11000, 0xc0007ed218, 0xc000766b80, 0xc000224408)\n    /home/ubuntu/go/src/syscall/zsyscall_linux_amd64.go:732 +0x5a\nsyscall.Read(0xe, 0xc000cf8000, 0x11000, 0x11000, 0x460f6b, 0xc0007ed230, 0xc000766980)\n    /home/ubuntu/go/src/syscall/syscall_unix.go:172 +0x49\ngithub.com/hanwen/go-fuse/fuse.(*Server).readRequest.func1(0xc000766980, 0x9f7255)\n    /home/ubuntu/go/pkg/mod/github.com/hanwen/go-fuse@v0.0.0-20190111173210-425e8d5301f6/fuse/server.go:266 +0x55\ngithub.com/hanwen/go-fuse/fuse.handleEINTR(0xc000776758, 0x15ec360, 0xc00053ee20)\n    /home/ubuntu/go/pkg/mod/github.com/hanwen/go-fuse@v0.0.0-20190111173210-425e8d5301f6/fuse/server.go:242 +0x27\ngithub.com/hanwen/go-fuse/fuse.(*Server).readRequest(0xc0007ed1d0, 0xc00003a401, 0xc000000000, 0xc000000000)\n    /home/ubuntu/go/pkg/mod/github.com/hanwen/go-fuse@v0.0.0-20190111173210-425e8d5301f6/fuse/server.go:264 +0x163\ngithub.com/hanwen/go-fuse/fuse.(*Server).loop(0xc0007ed1d0, 0xc00084a701)\n    /home/ubuntu/go/pkg/mod/github.com/hanwen/go-fuse@v0.0.0-20190111173210-425e8d5301f6/fuse/server.go:381 +0x6b\ncreated by github.com/hanwen/go-fuse/fuse.(*Server).readRequest\n    /home/ubuntu/go/pkg/mod/github.com/hanwen/go-fuse@v0.0.0-20190111173210-425e8d5301f6/fuse/server.go:291 +0x2d8\n\ngoroutine 376 [runnable]:\ngithub.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount.func1(0xc000344420, 0xc000402dc0)\n    /home/ubuntu/wr/jobqueue/job.go:574 +0x38\ncreated by github.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount\n    /home/ubuntu/wr/jobqueue/job.go:573 +0x930\n\ngoroutine 122 [runnable]:\ngithub.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount.func1(0xc0000b1440, 0xc00060e2c0)\n    /home/ubuntu/wr/jobqueue/job.go:574 +0x38\ncreated by github.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount\n    /home/ubuntu/wr/jobqueue/job.go:573 +0x930\n\ngoroutine 601 [runnable]:\nsyscall.Syscall(0x0, 0xe, 0xc000920000, 0x11000, 0xffffffffffffffff, 0x0, 0x13)\n    /home/ubuntu/go/src/syscall/asm_linux_amd64.s:18 +0x5\nsyscall.read(0xe, 0xc000920000, 0x11000, 0x11000, 0xc0007ed218, 0xc000766a00, 0xc000830120)\n    /home/ubuntu/go/src/syscall/zsyscall_linux_amd64.go:732 +0x5a\nsyscall.Read(0xe, 0xc000920000, 0x11000, 0x11000, 0x460f6b, 0xc0007ed230, 0xc000766800)\n    /home/ubuntu/go/src/syscall/syscall_unix.go:172 +0x49\ngithub.com/hanwen/go-fuse/fuse.(*Server).readRequest.func1(0xc000766800, 0xc0003a0180)\n    /home/ubuntu/go/pkg/mod/github.com/hanwen/go-fuse@v0.0.0-20190111173210-425e8d5301f6/fuse/server.go:266 +0x55\ngithub.com/hanwen/go-fuse/fuse.handleEINTR(0xc00077ef58, 0x15ec360, 0xc00056eee0)\n    /home/ubuntu/go/pkg/mod/github.com/hanwen/go-fuse@v0.0.0-20190111173210-425e8d5301f6/fuse/server.go:242 +0x27\ngithub.com/hanwen/go-fuse/fuse.(*Server).readRequest(0xc0007ed1d0, 0xc0003a0001, 0xc000000000, 0xc000000000)\n    /home/ubuntu/go/pkg/mod/github.com/hanwen/go-fuse@v0.0.0-20190111173210-425e8d5301f6/fuse/server.go:264 +0x163\ngithub.com/hanwen/go-fuse/fuse.(*Server).loop(0xc0007ed1d0, 0xc0001f7101)\n    /home/ubuntu/go/pkg/mod/github.com/hanwen/go-fuse@v0.0.0-20190111173210-425e8d5301f6/fuse/server.go:381 +0x6b\ncreated by github.com/hanwen/go-fuse/fuse.(*Server).readRequest\n    /home/ubuntu/go/pkg/mod/github.com/hanwen/go-fuse@v0.0.0-20190111173210-425e8d5301f6/fuse/server.go:291 +0x2d8\n\ngoroutine 593 [runnable]:\ngithub.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount.func1(0xc0003531a0, 0xc000403600)\n    /home/ubuntu/wr/jobqueue/job.go:574 +0x38\ncreated by github.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount\n    /home/ubuntu/wr/jobqueue/job.go:573 +0x930\n\ngoroutine 531 [runnable]:\ngithub.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount.func1(0xc000352a80, 0xc00015f600)\n    /home/ubuntu/wr/jobqueue/job.go:574 +0x38\ncreated by github.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount\n    /home/ubuntu/wr/jobqueue/job.go:573 +0x930\n\ngoroutine 662 [runnable]:\ngithub.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount.func1(0xc000508d20, 0xc00015fb80)\n    /home/ubuntu/wr/jobqueue/job.go:574 +0x38\ncreated by github.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount\n    /home/ubuntu/wr/jobqueue/job.go:573 +0x930\n\ngoroutine 665 [sleep, 7 minutes]:\ntime.Sleep(0x3333383e)\n    /home/ubuntu/go/src/runtime/time.go:105 +0x14f\ngithub.com/minio/minio-go.Client.newRetryTimer.func2(0xc000830060, 0xa, 0xc000830000, 0xc00034c780)\n    /home/ubuntu/go/pkg/mod/github.com/minio/minio-go@v6.0.12+incompatible/retry.go:82 +0x84\ncreated by github.com/minio/minio-go.Client.newRetryTimer\n    /home/ubuntu/go/pkg/mod/github.com/minio/minio-go@v6.0.12+incompatible/retry.go:72 +0x156\n\ngoroutine 649 [IO wait, 7 minutes]:\ninternal/poll.runtime_pollWait(0x7f0b6fcc5bc0, 0x72, 0xc000756c58)\n    /home/ubuntu/go/src/runtime/netpoll.go:173 +0x66\ninternal/poll.(*pollDesc).wait(0xc000352978, 0x72, 0xffffffffffffff01, 0x1b51640, 0x2804620)\n    /home/ubuntu/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a\ninternal/poll.(*pollDesc).waitRead(0xc000352978, 0xc000589001, 0x1000, 0x1000)\n    /home/ubuntu/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d\ninternal/poll.(*FD).Read(0xc000352960, 0xc000589000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /home/ubuntu/go/src/internal/poll/fd_unix.go:169 +0x179\nos.(*File).read(0xc0007aee38, 0xc000589000, 0x1000, 0x1000, 0x9f, 0xffffffffffffff01, 0xc000756dc0)\n    /home/ubuntu/go/src/os/file_unix.go:249 +0x4e\nos.(*File).Read(0xc0007aee38, 0xc000589000, 0x1000, 0x1000, 0x0, 0x7f0b71f316c0, 0x0)\n    /home/ubuntu/go/src/os/file.go:108 +0x69\nbufio.(*Reader).fill(0xc000352a20)\n    /home/ubuntu/go/src/bufio/bufio.go:100 +0x10f\nbufio.(*Reader).ReadSlice(0xc000352a20, 0xc000756f0a, 0xc000000300, 0xc000756e90, 0x4051bf, 0xc000756e70, 0x9f51cb)\n    /home/ubuntu/go/src/bufio/bufio.go:341 +0x36\nbufio.(*Reader).ReadBytes(0xc000352a20, 0xc000756f0a, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /home/ubuntu/go/src/bufio/bufio.go:419 +0x70\ngithub.com/VertebrateResequencing/wr/jobqueue.stdFilter.func1(0xc000352a20, 0x1b4d740, 0xc0007f0870, 0xc0003c5260)\n    /home/ubuntu/wr/jobqueue/utils.go:368 +0x4c\ncreated by github.com/VertebrateResequencing/wr/jobqueue.stdFilter\n    /home/ubuntu/wr/jobqueue/utils.go:365 +0xcc\n\ngoroutine 267 [runnable]:\ngithub.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount.func1(0xc00007f2c0, 0xc000403340)\n    /home/ubuntu/wr/jobqueue/job.go:574 +0x38\ncreated by github.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount\n    /home/ubuntu/wr/jobqueue/job.go:573 +0x930\n\ngoroutine 279 [runnable]:\ngithub.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount.func1(0xc00089c4e0, 0xc00060e580)\n    /home/ubuntu/wr/jobqueue/job.go:574 +0x38\ncreated by github.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount\n    /home/ubuntu/wr/jobqueue/job.go:573 +0x930\n\ngoroutine 657 [semacquire, 7 minutes]:\nsync.runtime_Semacquire(0xc0007ed2ac)\n    /home/ubuntu/go/src/runtime/sema.go:56 +0x39\nsync.(*WaitGroup).Wait(0xc0007ed2ac)\n    /home/ubuntu/go/src/sync/waitgroup.go:130 +0x64\ngithub.com/hanwen/go-fuse/fuse.(*Server).Serve(0xc0007ed1d0)\n    /home/ubuntu/go/pkg/mod/github.com/hanwen/go-fuse@v0.0.0-20190111173210-425e8d5301f6/fuse/server.go:332 +0x7b\ncreated by github.com/VertebrateResequencing/muxfys.(*MuxFys).Mount\n    /home/ubuntu/muxfys/muxfys.go:367 +0x5bb\n\ngoroutine 407 [runnable]:\ngithub.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount.func1(0xc000508a80, 0xc00060e840)\n    /home/ubuntu/wr/jobqueue/job.go:574 +0x38\ncreated by github.com/VertebrateResequencing/wr/jobqueue.(*Job).Mount\n    /home/ubuntu/wr/jobqueue/job.go:573 +0x930\n\ngoroutine 659 [runnable]:\nfmt.Sprintf(0x190224f, 0x30, 0xc000781f58, 0x2, 0x2, 0xc000499801, 0xc0004a4000)\n    /home/ubuntu/go/src/fmt/print.go:201 +0xdd\nlog.Printf(0x190224f, 0x30, 0xc000781f58, 0x2, 0x2)\n    /home/ubuntu/go/src/log/log.go:295 +0x53\ngithub.com/hanwen/go-fuse/fuse.(*Server).handleRequest(0xc0007ed1d0, 0xc000499680, 0xc000499680)\n    /home/ubuntu/go/pkg/mod/github.com/hanwen/go-fuse@v0.0.0-20190111173210-425e8d5301f6/fuse/server.go:433 +0x1a4\ngithub.com/hanwen/go-fuse/fuse.(*Server).loop(0xc0007ed1d0, 0xc00084a601)\n    /home/ubuntu/go/pkg/mod/github.com/hanwen/go-fuse@v0.0.0-20190111173210-425e8d5301f6/fuse/server.go:400 +0x148\ncreated by github.com/hanwen/go-fuse/fuse.(*Server).readRequest\n    /home/ubuntu/go/pkg/mod/github.com/hanwen/go-fuse@v0.0.0-20190111173210-425e8d5301f6/fuse/server.go:291 +0x2d8\n\ngoroutine 650 [IO wait, 7 minutes]:\ninternal/poll.runtime_pollWait(0x7f0b6fcc5af0, 0x72, 0xc000853c58)\n    /home/ubuntu/go/src/runtime/netpoll.go:173 +0x66\ninternal/poll.(*pollDesc).wait(0xc000352af8, 0x72, 0xffffffffffffff01, 0x1b51640, 0x2804620)\n    /home/ubuntu/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a\ninternal/poll.(*pollDesc).waitRead(0xc000352af8, 0xc000620001, 0x1000, 0x1000)\n    /home/ubuntu/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d\ninternal/poll.(*FD).Read(0xc000352ae0, 0xc000620000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /home/ubuntu/go/src/internal/poll/fd_unix.go:169 +0x179\nos.(*File).read(0xc0007aee48, 0xc000620000, 0x1000, 0x1000, 0x0, 0x0, 0x40369c)\n    /home/ubuntu/go/src/os/file_unix.go:249 +0x4e\nos.(*File).Read(0xc0007aee48, 0xc000620000, 0x1000, 0x1000, 0x300000002, 0xc00069db00, 0xc000853dd0)\n    /home/ubuntu/go/src/os/file.go:108 +0x69\nbufio.(*Reader).fill(0xc000352ba0)\n    /home/ubuntu/go/src/bufio/bufio.go:100 +0x10f\nbufio.(*Reader).ReadSlice(0xc000352ba0, 0x7f0b71f3a70a, 0x3f, 0x43cc7b, 0xc0000b17c8, 0xc000853e58, 0x48677c)\n    /home/ubuntu/go/src/bufio/bufio.go:341 +0x36\nbufio.(*Reader).ReadBytes(0xc000352ba0, 0x40510a, 0xc0000b1918, 0xc00056c790, 0xc000853fb0, 0x0, 0xc000853f30)\n    /home/ubuntu/go/src/bufio/bufio.go:419 +0x70\ngithub.com/VertebrateResequencing/wr/jobqueue.stdFilter.func1(0xc000352ba0, 0x1b4d740, 0xc0007f08c0, 0xc0003c52c0)\n    /home/ubuntu/wr/jobqueue/utils.go:368 +0x4c\ncreated by github.com/VertebrateResequencing/wr/jobqueue.stdFilter\n    /home/ubuntu/wr/jobqueue/utils.go:365 +0xcc\n</code></pre>\n"}], "owner": {"reputation": 799, "user_id": 675083, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/l75tP.jpg?s=128&g=1", "display_name": "sbs", "link": "https://stackoverflow.com/users/675083/sbs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1582784674, "creation_date": 1547571533, "question_id": 54203525, "link": "https://stackoverflow.com/questions/54203525/golang-cmd-start-hanging-on-fuse-mounted-dir-sometimes", "title": "Golang cmd.Start() hanging on fuse mounted dir sometimes", "body": "<p>In go I'm doing something like:</p>\n\n<pre><code>cmd := exec.Command(shell, \"-c\", someCmd)\n[...]\nerrReader, err := cmd.StderrPipe()\noutReader, err := cmd.StdoutPipe()\n[...do something with those readers...]\ncmd.Dir = aDirectory\n[...]\nerr = cmd.Start()\n</code></pre>\n\n<p>If aDirectory is a normal directory, Start() always returns ~immediately.</p>\n\n<p>But if it's an in-process fuse mount (mounted after setting cmd.Dir) that I successfully run <code>ioutil.ReadDir(aDirectory)</code> on, then about 1/1000 times, Start() hangs. I have to <code>sudo umount -f aDirectory</code> to end the go process.</p>\n\n<p>I haven't dived into Start() to see where it hangs, but any thoughts as to what could cause issues with it?</p>\n\n<p>Is my best bet here to use <code>CommandContext()</code> instead, to have a timeout on the Start() call? How would you implement that well?</p>\n"}, {"tags": ["docker", "go", "redis"], "comments": [{"owner": {"reputation": 634, "user_id": 10885545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t7rbI.png?s=128&g=1", "display_name": "sui", "link": "https://stackoverflow.com/users/10885545/sui"}, "edited": false, "score": 0, "creation_date": 1547570559, "post_id": 54202384, "comment_id": 95233340, "body": "You need to subscribe to a channel <code>redisdb.Subscribe(key)</code>"}, {"owner": {"reputation": 177, "user_id": 6613904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20b4277bb8450e16bf6fc49a9cba40b9?s=128&d=identicon&r=PG&f=1", "display_name": "henleyhoudini", "link": "https://stackoverflow.com/users/6613904/henleyhoudini"}, "reply_to_user": {"reputation": 634, "user_id": 10885545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t7rbI.png?s=128&g=1", "display_name": "sui", "link": "https://stackoverflow.com/users/10885545/sui"}, "edited": false, "score": 0, "creation_date": 1547573281, "post_id": 54202384, "comment_id": 95234725, "body": "The key is actually an unique ID that is different for every addition to the queue. Would this still work if the UID&#39;s are the same every time?"}, {"owner": {"reputation": 634, "user_id": 10885545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t7rbI.png?s=128&g=1", "display_name": "sui", "link": "https://stackoverflow.com/users/10885545/sui"}, "edited": false, "score": 0, "creation_date": 1547575771, "post_id": 54202384, "comment_id": 95235899, "body": "I see, you want to publish the information that key=value was set, I only wrote &quot;key&quot; cause it&#39;s the first parameter in publish. You are looking for something like this probably: <code>jobsQueue.Publish(&quot;myKeySetInfoChannel&quot;, key + &quot; was set to &quot; + value)</code> =&gt; <code>redisDb.Subscribe(&quot;myKeySetInfoChannel&quot;)</code>"}, {"owner": {"reputation": 177, "user_id": 6613904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20b4277bb8450e16bf6fc49a9cba40b9?s=128&d=identicon&r=PG&f=1", "display_name": "henleyhoudini", "link": "https://stackoverflow.com/users/6613904/henleyhoudini"}, "reply_to_user": {"reputation": 634, "user_id": 10885545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t7rbI.png?s=128&g=1", "display_name": "sui", "link": "https://stackoverflow.com/users/10885545/sui"}, "edited": false, "score": 0, "creation_date": 1547588932, "post_id": 54202384, "comment_id": 95241264, "body": "Thanks! I got it working."}], "answers": [{"tags": [], "owner": {"reputation": 33, "user_id": 2106531, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2qfda.jpg?s=128&g=1", "display_name": "Aleksandrs Antonovs", "link": "https://stackoverflow.com/users/2106531/aleksandrs-antonovs"}, "is_accepted": false, "score": -1, "last_activity_date": 1547570823, "creation_date": 1547570823, "answer_id": 54203314, "question_id": 54202384, "link": "https://stackoverflow.com/questions/54202384/using-redis-as-a-link-between-docker-containers/54203314#54203314", "title": "Using Redis as a Link Between Docker Containers", "body": "<p>As from <a href=\"https://godoc.org/github.com/go-redis/redis#PubSub\" rel=\"nofollow noreferrer\">docs</a></p>\n\n<p>receiver.go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/go-redis/redis\"\n)\n\nfunc main() {\n    c := redis.NewClient(&amp;redis.Options{\n        Addr: \":6379\",\n    })\n\n    pubsub := c.Subscribe(\"mychannel1\")\n\n    // Wait for confirmation that subscription is created before publishing anything.\n    _, err := pubsub.Receive()\n    if err != nil {\n        panic(err)\n    }\n\n    // Go channel which receives messages.\n    ch := pubsub.Channel()\n\n    // Consume messages.\n    for msg := range ch {\n        fmt.Println(msg.Channel, msg.Payload)\n    }\n}\n</code></pre>\n\n<p>sender.go</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n\n    \"github.com/go-redis/redis\"\n)\n\nfunc main() {\n    c := redis.NewClient(&amp;redis.Options{\n        Addr: \":6379\",\n    })\n\n    // Publish a message.\n    for range time.Tick(time.Second) {\n        err := c.Publish(\"mychannel1\", \"hello\").Err()\n        if err != nil {\n            panic(err)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 177, "user_id": 6613904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20b4277bb8450e16bf6fc49a9cba40b9?s=128&d=identicon&r=PG&f=1", "display_name": "henleyhoudini", "link": "https://stackoverflow.com/users/6613904/henleyhoudini"}, "is_accepted": false, "score": 0, "last_activity_date": 1547654547, "creation_date": 1547654547, "answer_id": 54220933, "question_id": 54202384, "link": "https://stackoverflow.com/questions/54202384/using-redis-as-a-link-between-docker-containers/54220933#54220933", "title": "Using Redis as a Link Between Docker Containers", "body": "<p>Just in case anyone else wonders about the answer: I ended up using a combination of both Aleksandrs and sui's answers. \nIn my first Docker container I published the results to a specific channel: </p>\n\n<pre><code>publishData := redisdb.Subscribe(\"CHANNELNAME\")\n</code></pre>\n\n<p>And then in my second Docker container that was subscribing to the channel, thanks to sui for the assistance on this part, I subscribed to the channel and pulled the both the UID and the IP information like so: </p>\n\n<pre><code>ch := pubsub.Channel()\n    for msg := range ch {\n        fmt.Println(msg.Payload)\n        s := strings.Split(msg.Payload, \":\")\n        UID, IP := s[0], s[1]\n        fmt.Println(UID, IP)\n    }\n</code></pre>\n\n<p>This is working great for me so far - thanks so much to sui and Aleksandrs for the assistance!</p>\n"}], "owner": {"reputation": 177, "user_id": 6613904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20b4277bb8450e16bf6fc49a9cba40b9?s=128&d=identicon&r=PG&f=1", "display_name": "henleyhoudini", "link": "https://stackoverflow.com/users/6613904/henleyhoudini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 509, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1547654547, "creation_date": 1547567649, "question_id": 54202384, "link": "https://stackoverflow.com/questions/54202384/using-redis-as-a-link-between-docker-containers", "title": "Using Redis as a Link Between Docker Containers", "body": "<p>I have a docker-compose file with several containers in, two of which are supposed to communicate via a Redis DB. Both containers have connections to Reids and I can read/write from both. However I'd like a container to be triggered every time the something is added from the other container. I thought I could accomplish this via Redis Sub/Pub but it when I run the code it never triggers anything, even when I can see I've added new items to the Redis queue. </p>\n\n<p>From this I have two questions: \n1. Is what I'm looking to do even possible? Can I do publish/subscribe in in two separate docker containers and expect it work as described above? \n2. If it is possible, can someone please point me below where I\"m going wrong with this tools? </p>\n\n<p>This is my function that I add new data to the Redis queue and then publish the data in Docker container 1. </p>\n\n<pre><code>func redisShare(key string, value string) {\njobsQueue.Set(key, value, 0) //setting in the queue\njobsQueue.Publish(key, value) //publishing for the other docker container to notice\nfmt.Println(\"added \", key, \"with a value of \", value, \"to the redis queue\")\n}\n</code></pre>\n\n<p>I'm using this line in my other docker container to subscribe to the Redis queue and listen for changes: \n        <code>redisdb.Subscribe()</code></p>\n\n<p>I would expect if something was added to the redis queue it would share the data to the other container and I'd see the message received, but right now Docker Container 2 just runs and then closes. </p>\n\n<p>Thanks! </p>\n"}, {"tags": ["docker", "go", "apache-kafka"], "answers": [{"comments": [{"owner": {"reputation": 186, "user_id": 5769853, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-78R6VQ0QNVE/AAAAAAAAAAI/AAAAAAAAHyg/TSbPZHeKWNs/photo.jpg?sz=128", "display_name": "shy alon", "link": "https://stackoverflow.com/users/5769853/shy-alon"}, "edited": false, "score": 0, "creation_date": 1547576899, "post_id": 54202960, "comment_id": 95236376, "body": "Thanks - I&#39;ll give it a shot"}], "tags": [], "owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "is_accepted": false, "score": 1, "last_activity_date": 1547633226, "last_edit_date": 1547633226, "creation_date": 1547569600, "answer_id": 54202960, "question_id": 54202373, "link": "https://stackoverflow.com/questions/54202373/building-go-application-using-confluent-kafka-go-on-linux/54202960#54202960", "title": "Building Go Application using confluent-kafka-go on Linux", "body": "<p>You can specify a version of package to be installed in apt-get command.\ne.g</p>\n\n<pre><code>apt-get install librdkafka-dev=0.11.6~1confluent5.0.1-1\n</code></pre>\n\n<p>If that doesn't work then I think the apt sources doesn't have version 0.11.5 of librdkafka.\nYou can add a repository with the right version of librdkafka in <code>/etc/apt/sources.list</code> as described here:\n<a href=\"https://docs.confluent.io/current/installation/installing_cp/deb-ubuntu.html#systemd-ubuntu-debian-install\" rel=\"nofollow noreferrer\">https://docs.confluent.io/current/installation/installing_cp/deb-ubuntu.html#systemd-ubuntu-debian-install</a></p>\n"}, {"tags": [], "owner": {"reputation": 7043, "user_id": 10272, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2cdc5c3059c40c76d5ca7bec8d149f9e?s=128&d=identicon&r=PG", "display_name": "Ran", "link": "https://stackoverflow.com/users/10272/ran"}, "is_accepted": true, "score": 12, "last_activity_date": 1547593605, "creation_date": 1547593605, "answer_id": 54208127, "question_id": 54202373, "link": "https://stackoverflow.com/questions/54202373/building-go-application-using-confluent-kafka-go-on-linux/54208127#54208127", "title": "Building Go Application using confluent-kafka-go on Linux", "body": "<p>I had a similar issue a few weeks ago. IIRC <code>confluent-kafka-go</code> requires a recent version of <code>librdkafka-dev</code>, which simply was not yet released to alpine or others. \nI was able to find it for ubuntu though, so my solution (which was more involved than I hoped for, but it worked), was to start from clean ubuntu, install <code>librdkafka-dev</code>, install Go version that I want and compile inside docker. </p>\n\n<p>Here's how it looks: </p>\n\n<pre><code>FROM ubuntu\n\n# Install the C lib for kafka\nRUN apt-get update\nRUN apt-get install -y --no-install-recommends apt-utils wget gnupg software-properties-common\nRUN apt-get install -y apt-transport-https ca-certificates\nRUN wget -qO - https://packages.confluent.io/deb/5.1/archive.key | apt-key add -\nRUN add-apt-repository \"deb [arch=amd64] https://packages.confluent.io/deb/5.1 stable main\"\nRUN apt-get update\nRUN apt-get install -y librdkafka-dev\n\n# Install Go\nRUN add-apt-repository ppa:longsleep/golang-backports\nRUN apt-get update\nRUN apt-get install -y golang-1.11-go\n\n# build the library\nWORKDIR /go/src/gitlab.appsflyer.com/rantav/kafka-mirror-tester\nCOPY *.go ./\nCOPY // the rest of your go files. You may copy recursive if you want\nCOPY vendor vendor\n\nRUN GOPATH=/go GOOS=linux /usr/lib/go-1.11/bin/go build -a -o main .\n\nEXPOSE 8000\n\nENTRYPOINT [\"./main\"]\n</code></pre>\n"}], "owner": {"reputation": 186, "user_id": 5769853, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-78R6VQ0QNVE/AAAAAAAAAAI/AAAAAAAAHyg/TSbPZHeKWNs/photo.jpg?sz=128", "display_name": "shy alon", "link": "https://stackoverflow.com/users/5769853/shy-alon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1841, "favorite_count": 2, "accepted_answer_id": 54208127, "answer_count": 2, "score": 5, "last_activity_date": 1547633226, "creation_date": 1547567586, "question_id": 54202373, "link": "https://stackoverflow.com/questions/54202373/building-go-application-using-confluent-kafka-go-on-linux", "title": "Building Go Application using confluent-kafka-go on Linux", "body": "<p>I am trying to create a docker image with my go application. The application (which was developed on MacOS) depends on <code>confluent-kafka-go</code> which in turn depends on <code>librdkafka-dev</code> which I install in the Docker image like so:</p>\n\n<pre><code>FROM golang:1.1\nRUN apt-get update\nRUN apt-get -y install librdkafka-dev\n\nVOLUME /workspace\nWORKDIR /workspace/src/my/app/folder\nENTRYPOINT [\"/bin/sh\", \"-c\"]\n</code></pre>\n\n<p>I am getting the following error:</p>\n\n<p>my/app/folder/vendor/github.com/confluentinc/confluent-kafka-go/kafka\n../folder/vendor/github.com/confluentinc/confluent-kafka-go/kafka/00version.go:44:2: error: #error \"confluent-kafka-go requires librdkafka v0.11.5 or later. Install the latest version of librdkafka from the Confluent repositories, see <a href=\"http://docs.confluent.io/current/installation.html\" rel=\"noreferrer\">http://docs.confluent.io/current/installation.html</a>\"</p>\n\n<p>As far as I understand the latest version <strong>is</strong> installed.\nHow can I fix it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1547565462, "post_id": 54201711, "comment_id": 95230369, "body": "&quot;got me in a dead end&quot; can you be more specific?"}, {"owner": {"reputation": 87, "user_id": 10765021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ced873201945cfa92e484c00e0459f4?s=128&d=identicon&r=PG&f=1", "display_name": "toti toto", "link": "https://stackoverflow.com/users/10765021/toti-toto"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1547567204, "post_id": 54201711, "comment_id": 95231429, "body": "Modified origianal"}], "answers": [{"tags": [], "owner": {"reputation": 87, "user_id": 10765021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ced873201945cfa92e484c00e0459f4?s=128&d=identicon&r=PG&f=1", "display_name": "toti toto", "link": "https://stackoverflow.com/users/10765021/toti-toto"}, "is_accepted": false, "score": 1, "last_activity_date": 1547568183, "creation_date": 1547568183, "answer_id": 54202547, "question_id": 54201711, "link": "https://stackoverflow.com/questions/54201711/how-to-marshal-xml-from-a-mapstringinterface/54202547#54202547", "title": "How to marshal XML from a map[string]interface{}?", "body": "<p>Solved. answer:\nfirst, my struct VALUE was of type <code>string</code> instead of <code>interaface</code>, and second- to see the data parsing I had to actually marshal it.. using:\n <code>x, _ := xml.MarshalIndent(Map(data), \"\", \"  \")</code></p>\n"}], "owner": {"reputation": 87, "user_id": 10765021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ced873201945cfa92e484c00e0459f4?s=128&d=identicon&r=PG&f=1", "display_name": "toti toto", "link": "https://stackoverflow.com/users/10765021/toti-toto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547568183, "creation_date": 1547565304, "last_edit_date": 1547567196, "question_id": 54201711, "link": "https://stackoverflow.com/questions/54201711/how-to-marshal-xml-from-a-mapstringinterface", "title": "How to marshal XML from a map[string]interface{}?", "body": "<p>I'm building an API to handle XML data in POST, and return it in the response. The function that should handle this marshaling is receiving variable data as type <code>map[string]interface{}</code> which looks like this (if you log it to the console):</p>\n\n<pre><code>map[lala:success blabla:0xc42011e700 status:true]\n</code></pre>\n\n<p>Replicating steps that worked for JSON marshaling or trying to follow the documentation got me in a dead end. This is the code I have so far:</p>\n\n<pre><code>type Map map[string]interface{}\n\ntype xmlMapEntry struct {\n    XMLName xml.Name\n    Value   string `xml:\",chardata\"`\n}\n\nfunc (m Map) MarshalXML(e *xml.Encoder, start xml.StartElement) error {\n\n    for k, v := range m {\n        e.Encode(xmlMapEntry{XMLName: xml.Name{Local: k}, Value: v})\n    }\n\n    return e.EncodeToken(start.End())\n}\n</code></pre>\n\n<p>I got to a dead end when the e.Encode line returned: <code>cannot use v (type interface {}) as type string in field value: need type assertion</code></p>\n"}, {"tags": ["go", "struct", "nested"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1547559375, "post_id": 54199792, "comment_id": 95226482, "body": "The code you posted works fine: <a href=\"https://play.golang.org/p/8FmgyTqXo1a\" rel=\"nofollow noreferrer\">play.golang.org/p/8FmgyTqXo1a</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7998520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90239dd2abea517b7db5d5728dcc2ef2?s=128&d=identicon&r=PG&f=1", "display_name": "Akhil", "link": "https://stackoverflow.com/users/7998520/akhil"}, "edited": false, "score": 0, "creation_date": 1547616374, "post_id": 54200217, "comment_id": 95247753, "body": "Thanks. The code runs fine. So it&#39;s the Visual Studio IDE that was showing me this issue, so I was not running it. But now that I run it, it works properly. Thanks again."}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 0, "last_activity_date": 1547560183, "creation_date": 1547560183, "answer_id": 54200217, "question_id": 54199792, "link": "https://stackoverflow.com/questions/54199792/how-initialize-a-variable-for-nested-array-struct-in-golang/54200217#54200217", "title": "How initialize a variable for nested array struct in Golang?", "body": "<p>Welcome to StackOverflow! As Volker said in a comment, your code seems to be working. Are you sure you're seeing the issue now? Can you run the playground link Volker provided?</p>\n\n<p>In general, this is possible in Go via the <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literals feature</a>; that link has several useful examples along with a discussion of semantics that you may find interesting. If something stops working I'd recommend building progressively more complicate structures until you see where the problem is, until you reach the level of nesting needed for your application.</p>\n"}], "owner": {"reputation": 11, "user_id": 7998520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90239dd2abea517b7db5d5728dcc2ef2?s=128&d=identicon&r=PG&f=1", "display_name": "Akhil", "link": "https://stackoverflow.com/users/7998520/akhil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1547566012, "creation_date": 1547558801, "last_edit_date": 1547566012, "question_id": 54199792, "link": "https://stackoverflow.com/questions/54199792/how-initialize-a-variable-for-nested-array-struct-in-golang", "title": "How initialize a variable for nested array struct in Golang?", "body": "<p>I am parsing a JSON file in Golang, by making a nested struct, and able to do it successfully. However, now I wish to make a variable of the same struct, but I get the following error <code>cannot use []Specs literal (type []Specs) as type []Specs in field value</code>. Could someone please point out my mistake here? What am I doing wrong?</p>\n\n<p>This is the Nested Struct:</p>\n\n<pre><code>type Config struct {\nOrdererOrgs []OrdererOrgs `json:\"OrdererOrgs\"`\nPeerOrgs []PeerOrgs `json:\"PeerOrgs\"`\n}\n\ntype OrdererOrgs struct {\nName string `json:\"name\"`\nDomain string `json:\"Domain\"`\nSpecs []Specs `json:\"Specs\"`\n}\n\ntype Specs struct {\nHostname string `json:\"Hostname\"`\nCommonname string `json:\"Commonname\"`\n}\n\ntype PeerOrgs struct {\nName   string `json:\"name\"`\nDomain   string `json:\"Domain\"`\nTemplate Template `json:\"Template\"`\nUsers Users `json:\"Users\"`\n}\n\ntype Template struct {\nCount int `json:\"Count\"`\nStart int `json:\"Start\"`\n}\n\ntype Users struct {\nCount int `json:\"Count\"`\n}\n</code></pre>\n\n<p>And this is my variable:</p>\n\n<pre><code>newconfig:= Config{\n    OrdererOrgs: []OrdererOrgs{\n        OrdererOrgs{\n            Name: \"Orderer1\",\n            Domain : \"Domain\",\n            Specs: []Specs{\n                Specs{\n                Hostname: \"H\",\n                Commonname: \"C\",\n                },\n                Specs{\n                    Hostname: \"H\",\n                    Commonname: \"C\",\n                    },\n            },\n        },\n        OrdererOrgs{\n            Name: \"Orderer2\",\n            Domain : \"Domain2\",\n            Specs: []Specs{\n                Specs{\n                Hostname: \"H\",\n                Commonname: \"C\",\n                },\n            },\n        },\n    },\n    PeerOrgs: []PeerOrgs{\n        PeerOrgs{\n            Name: \"Org1\",\n            Domain: \"D\",\n            Template: Template{\n                Count: 1,\n                Start: 0,\n            },\n            Users: Users{\n                Count: 1,\n            },\n        },\n        PeerOrgs{\n            Name: \"Org2\",\n            Domain: \"D2\",\n            Template: Template{\n                Count: 1,\n                Start: 0,\n            },\n            Users: Users{\n                Count: 1,\n            },\n        },\n    },\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1547553693, "post_id": 54198220, "comment_id": 95223522, "body": "it&#39;s not clear what error you are encountering or exactly what you are trying to do.  See this answer <a href=\"https://stackoverflow.com/questions/38816843/explain-type-assertions-in-go\" title=\"explain type assertions in go\">stackoverflow.com/questions/38816843/&hellip;</a> and this tour of go section <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">tour.golang.org/methods/15</a> for the basics of type assertions - maybe this is what you are looking for?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1547555583, "post_id": 54198220, "comment_id": 95224522, "body": "Probably the best advice here would be: Do not try to understand what&#39;s going on using reflection. Reflection is <i>hard</i>. It is hard even if you <i>do</i> know the language and how interfaces and the type system work. Trying to increase your understanding of the type system by use of reflection is doomed to fail."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1547561833, "post_id": 54198220, "comment_id": 95227991, "body": "If you tried something and it didn&#39;t work, please include that code in the body of your question, along with details on the way in which it didn&#39;t work."}, {"owner": {"reputation": 17, "user_id": 10916264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cda757891e2e1a042615805942b1776?s=128&d=identicon&r=PG&f=1", "display_name": "Liviu", "link": "https://stackoverflow.com/users/10916264/liviu"}, "edited": false, "score": 0, "creation_date": 1547562834, "post_id": 54198220, "comment_id": 95228650, "body": "I tried both solutions described below. I initialize the first element of the array in main through hard coding. The type test works fine for this element. The rest of the elements are initialized depending on the user input, and the type of the elements returned is the interface type. I do not want this. I want the return Struct1 or Struct2."}, {"owner": {"reputation": 355, "user_id": 1283658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bc0d9019c71a5620e823caaee1edbb0?s=128&d=identicon&r=PG", "display_name": "P.An", "link": "https://stackoverflow.com/users/1283658/p-an"}, "edited": false, "score": 1, "creation_date": 1547563453, "post_id": 54198220, "comment_id": 95229075, "body": "Ok, answer to your question is <code>type assestion</code>. It is not really possible to provide you with a fully working application (and this resource is not intended for such purpose) without knowing your particular requirements as currently they look bit confusing."}], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 10916264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cda757891e2e1a042615805942b1776?s=128&d=identicon&r=PG&f=1", "display_name": "Liviu", "link": "https://stackoverflow.com/users/10916264/liviu"}, "edited": false, "score": 0, "creation_date": 1547560117, "post_id": 54198453, "comment_id": 95226904, "body": "Unfortunately this solution returns Main_interface type. I want to return Struct1 type or Struct2 type, even is I append only Struct1 or Struct1 types"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1547561996, "post_id": 54198453, "comment_id": 95228091, "body": "Are you sure about that? This solution doesn&#39;t return a type at all, it prints the <i>value</i> if the type is <code>Struct1</code> or <code>Struct2</code>, otherwise it prints <code>unknown</code>."}, {"owner": {"reputation": 355, "user_id": 1283658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bc0d9019c71a5620e823caaee1edbb0?s=128&d=identicon&r=PG", "display_name": "P.An", "link": "https://stackoverflow.com/users/1283658/p-an"}, "edited": false, "score": 0, "creation_date": 1547562112, "post_id": 54198453, "comment_id": 95228162, "body": "No it does not. Please check the updated code in playground: you can assign struct values to <code>t</code>"}, {"owner": {"reputation": 17, "user_id": 10916264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cda757891e2e1a042615805942b1776?s=128&d=identicon&r=PG&f=1", "display_name": "Liviu", "link": "https://stackoverflow.com/users/10916264/liviu"}, "edited": false, "score": 0, "creation_date": 1547562337, "post_id": 54198453, "comment_id": 95228310, "body": "This solution works fine only for the first element of the array which I initialize in main, through hard coding. The rest of the elements are returned as the main interface."}], "tags": [], "owner": {"reputation": 355, "user_id": 1283658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bc0d9019c71a5620e823caaee1edbb0?s=128&d=identicon&r=PG", "display_name": "P.An", "link": "https://stackoverflow.com/users/1283658/p-an"}, "is_accepted": false, "score": 1, "last_activity_date": 1547562173, "last_edit_date": 1547562173, "creation_date": 1547553817, "answer_id": 54198453, "question_id": 54198220, "link": "https://stackoverflow.com/questions/54198220/how-do-i-get-the-type-of-struct-in-go/54198453#54198453", "title": "How do I get the type of struct in Go?", "body": "<p>You need to use type assestion as below:</p>\n\n<pre><code>var MyArray []Main_interface\n\nNewStruct1Block := Struct1{}\nNewStruct2Block := Struct2{}\n\nMyArray = append(MyArray, NewStruct1Block)\nMyArray = append(MyArray, NewStruct2Block)\n\nfmt.Printf(\"%v\", MyArray)\n\nswitch t := MyArray[0].(type) {\ncase Struct1:\n    fmt.Printf(\"%v\", t)\n    t.ID = 1\ncase Struct2:\n    fmt.Printf(\"%v\", t)\n    t.Timestamp = \"A\"\ndefault:\n    fmt.Print(\"unknown\")\n}\n</code></pre>\n\n<p>Working code here:\n<a href=\"https://play.golang.org/p/OhpBDJu_q2x\" rel=\"nofollow noreferrer\">https://play.golang.org/p/OhpBDJu_q2x</a></p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1547561909, "post_id": 54198641, "comment_id": 95228040, "body": "Just for clarity, option 1 is a type <i>assertion</i>, not a type <i>cast</i>: <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Type_assertions</a>"}, {"owner": {"reputation": 17, "user_id": 10916264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cda757891e2e1a042615805942b1776?s=128&d=identicon&r=PG&f=1", "display_name": "Liviu", "link": "https://stackoverflow.com/users/10916264/liviu"}, "edited": false, "score": 0, "creation_date": 1547562409, "post_id": 54198641, "comment_id": 95228360, "body": "Those solutions work fine only for the first element of the array which I initialize in main, through hard coding. The rest of the elements are returned as the main interface."}, {"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "reply_to_user": {"reputation": 17, "user_id": 10916264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cda757891e2e1a042615805942b1776?s=128&d=identicon&r=PG&f=1", "display_name": "Liviu", "link": "https://stackoverflow.com/users/10916264/liviu"}, "edited": false, "score": 0, "creation_date": 1547601727, "post_id": 54198641, "comment_id": 95244694, "body": "@Liviu if this doesn&#39;t answer your question, then I don&#39;t understand your question. Maybe you can clarify it better?"}], "tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": false, "score": 5, "last_activity_date": 1547560868, "last_edit_date": 1547560868, "creation_date": 1547554440, "answer_id": 54198641, "question_id": 54198220, "link": "https://stackoverflow.com/questions/54198220/how-do-i-get-the-type-of-struct-in-go/54198641#54198641", "title": "How do I get the type of struct in Go?", "body": "<p>Your array can be heteregenious, that is, it can contain elements of different types. You can't ensure (at compile time) that all elements are of the same type.</p>\n\n<p>That said, you can check a single element using the type cast syntax.</p>\n\n<p>You have three options:</p>\n\n<p>Option 1: Check against a specific type</p>\n\n<pre><code>var unknown Main_Interface = getSomethingSomewhere()\nresult, ok := unknown.(Struct1);\nif ok {\n    // result has type `Struct1` \n}\n</code></pre>\n\n<p>Option 2: Use a switch statement to cover multiple types (already presented in another answer)</p>\n\n<pre><code>switch t := unknown.(type) {\ncase Struct1:\n    // t has type `Struct1` within this block (at compile time)\ncase Struct2:\n    // t has type `Struct2` within this block (at compile time)\ndefault:\n    // neither Struct1 no Struct2\n}\n</code></pre>\n\n<p>Option 3: compare against another type at runtime.</p>\n\n<p>Note that types returned by <code>reflect.TypeOf</code> are comparable using the <code>==</code> operator, as documented here:</p>\n\n<p><a href=\"https://golang.org/pkg/reflect/#Type\" rel=\"nofollow noreferrer\">https://golang.org/pkg/reflect/#Type</a></p>\n\n<blockquote>\n  <p>Type values are comparable, such as with the == operator, so they can be used as map keys. Two Type values are equal if they represent identical types.</p>\n</blockquote>\n\n<p>So we can do something like this:</p>\n\n<pre><code>var s1 Struct1 // empty struct\nvar s2 Struct2 // empty struct\nif reflect.TypeOf(unknown) == reflect.TypeOf(s1) {\n    // unknown holds an s1 instance\n}\n</code></pre>\n\n<p>But this is obviously not useful when you can just do the compile time check. Instead, you can compare two unknowns to check if they are the same:</p>\n\n<pre><code>var unknown1 Main_Interface = getSomethingSomewhere()\nvar unknown2 Main_Interface = getSomethingSomewhereElse()\n\nif reflect.TypeOf(unknown1) == reflect.TypeOf(unknown2) {\n    // they are the same type\n}\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 10916264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cda757891e2e1a042615805942b1776?s=128&d=identicon&r=PG&f=1", "display_name": "Liviu", "link": "https://stackoverflow.com/users/10916264/liviu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "closed_date": 1547580116, "answer_count": 2, "score": -1, "last_activity_date": 1547562198, "creation_date": 1547552872, "last_edit_date": 1547562198, "question_id": 54198220, "link": "https://stackoverflow.com/questions/54198220/how-do-i-get-the-type-of-struct-in-go", "closed_reason": "Needs details or clarity", "title": "How do I get the type of struct in Go?", "body": "<p>I am working on a demo project to understand GO language. I have defined one interface and 2 struct type. Also, I have defined an array of interfaces. Depending on the user input, I define each element within the array as a type of struct. During the data manipulation, I want to check the type of the struct defined on the array.</p>\n\n<p>I have tried to use reflect, but unfortunately it did not worked. Also other methods on internet did not worked. I received messages such as panic or json cannot Unmarshal.</p>\n\n<pre><code>type Main_interface interface {\n}\n\ntype Struct1 struct {\n    Index                         int\n    ID                            int\n    Name                          string\n}\n\ntype Struct2 struct {\n    Index                         int\n    Timestamp                     string\n    Temporary_ID                  int\n}\n\n\nvar MyArray []Main_interface\n\n//...\nNewStruct1Block := generateStruct1Block(...)\nMyArray = append(MyArray, NewStruct1Block)\n\n//...\nNewStruct2Block := generateStruct2Block(...)\nMyArray = append(MyArray, NewStruct2Block)\n</code></pre>\n\n<p>UPDATE: I want to be able to check the kind of struct implements the interface at runtime, depending on the user input.</p>\n"}, {"tags": ["string", "go", "colors", "hex"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1547552836, "post_id": 54197913, "comment_id": 95223106, "body": "Sorry, there is no such function in the stdlib. You&#39;ll have to write it yourself."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1547557665, "post_id": 54198431, "comment_id": 95225583, "body": "To parse a uint8, use <code>ParseUint</code>, not <code>ParseInt</code>, and set the last argument to 8. Otherwise things like <code>&quot;#-e-4-c&quot;</code> are considered valid inputs."}], "tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": false, "score": -1, "last_activity_date": 1547558694, "last_edit_date": 1547558694, "creation_date": 1547553730, "answer_id": 54198431, "question_id": 54197913, "link": "https://stackoverflow.com/questions/54197913/parse-hex-string-to-image-color/54198431#54198431", "title": "Parse hex string to image/color", "body": "<p>You can convert any 2 hex digits into an integer using <a href=\"https://golang.org/pkg/strconv/#ParseUint\" rel=\"nofollow noreferrer\"><code>strconv.ParseUint</code></a></p>\n\n<pre><code>strconv.ParseUint(str, 16, 8)\n</code></pre>\n\n<p>The <code>16</code> indicates base 16 (hex) and the 8 indicates the bit count, in this case, one byte.</p>\n\n<p>You can use this to parse each 2 characters into their components</p>\n\n<p><a href=\"https://play.golang.org/p/B56B8_NvnVR\" rel=\"nofollow noreferrer\">https://play.golang.org/p/B56B8_NvnVR</a></p>\n\n<pre><code>func ParseHexColor(v string) (out color.RGBA, err error) {\n    if len(v) != 7 {\n        return out, errors.New(\"hex color must be 7 characters\")\n    }\n    if v[0] != '#' {\n        return out, errors.New(\"hex color must start with '#'\")\n    }\n    var red, redError = strconv.ParseUint(v[1:3], 16, 8)\n    if redError != nil {\n        return out, errors.New(\"red component invalid\")\n    }\n    out.R = uint8(red)\n    var green, greenError = strconv.ParseUint(v[3:5], 16, 8)\n    if greenError != nil {\n        return out, errors.New(\"green component invalid\")\n    }\n    out.G = uint8(green)\n    var blue, blueError = strconv.ParseUint(v[5:7], 16, 8)\n    if blueError != nil {\n        return out, errors.New(\"blue component invalid\")\n    }\n    out.B = uint8(blue)\n    return\n}\n</code></pre>\n\n<p>Edit: Thanks to <a href=\"https://stackoverflow.com/users/603316\">Peter</a> for the correction</p>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 3, "last_activity_date": 1547557292, "creation_date": 1547557292, "answer_id": 54199403, "question_id": 54197913, "link": "https://stackoverflow.com/questions/54197913/parse-hex-string-to-image-color/54199403#54199403", "title": "Parse hex string to image/color", "body": "<p>An RGBA color is just 4 bytes, one each for the red, green, blue, and alpha channels. For three or six hex digits the alpha byte is usually implied to be 0xFF (<code>AABBCC</code> is considered the same as <code>AABBCCFF</code>, as is <code>ABC</code>).</p>\n\n<p>So parsing the color string is as simple as normalizing it, such that it is of the form \"RRGGBBAA\" (4 hex encoded bytes), and then decoding it:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/hex\"\n    \"fmt\"\n    \"image/color\"\n    \"log\"\n)\n\nfunc main() {\n    colorStr := \"102030FF\"\n\n    colorStr, err := normalize(colorStr)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    b, err := hex.DecodeString(colorStr)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    color := color.RGBA{b[0], b[1], b[2], b[3]}\n\n    fmt.Println(color) // Output: {16 32 48 255}\n}\n\nfunc normalize(colorStr string) (string, error) {\n    // left as an exercise for the reader\n    return colorStr, nil\n}\n</code></pre>\n\n<p>Try it on the playground: <a href=\"https://play.golang.org/p/aCX-vyfMG4G\" rel=\"nofollow noreferrer\">https://play.golang.org/p/aCX-vyfMG4G</a></p>\n"}, {"comments": [{"owner": {"reputation": 5450, "user_id": 942317, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/SY5ID.jpg?s=128&g=1", "display_name": "STEEL", "link": "https://stackoverflow.com/users/942317/steel"}, "edited": false, "score": 0, "creation_date": 1579859124, "post_id": 54200713, "comment_id": 105915361, "body": "thanks. and even the <code>ParseHexColorFast</code> gives correct colour when working with 16bit colour pallets"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 11, "last_activity_date": 1579859315, "last_edit_date": 1579859315, "creation_date": 1547561886, "answer_id": 54200713, "question_id": 54197913, "link": "https://stackoverflow.com/questions/54197913/parse-hex-string-to-image-color/54200713#54200713", "title": "Parse hex string to image/color", "body": "<p><strong>Foreword:</strong> I released this utility (the 2. Fast solution) in <a href=\"https://github.com/icza/gox\" rel=\"nofollow noreferrer\"><code>github.com/icza/gox</code></a>, see <a href=\"https://godoc.org/github.com/icza/gox/imagex/colorx#ParseHexColor\" rel=\"nofollow noreferrer\"><code>colorx.ParseHexColor()</code></a>.</p>\n\n<hr>\n\n<h2>1. Elegant solution</h2>\n\n<p>Here's another solution using <a href=\"https://golang.org/pkg/fmt/#Sscanf\" rel=\"nofollow noreferrer\"><code>fmt.Sscanf()</code></a>. It certainly not the fastest solution, but it is elegant. It scans right into the fields of a <a href=\"https://golang.org/pkg/image/color/#RGBA\" rel=\"nofollow noreferrer\"><code>color.RGBA</code></a> struct:</p>\n\n<pre><code>func ParseHexColor(s string) (c color.RGBA, err error) {\n    c.A = 0xff\n    switch len(s) {\n    case 7:\n        _, err = fmt.Sscanf(s, \"#%02x%02x%02x\", &amp;c.R, &amp;c.G, &amp;c.B)\n    case 4:\n        _, err = fmt.Sscanf(s, \"#%1x%1x%1x\", &amp;c.R, &amp;c.G, &amp;c.B)\n        // Double the hex digits:\n        c.R *= 17\n        c.G *= 17\n        c.B *= 17\n    default:\n        err = fmt.Errorf(\"invalid length, must be 7 or 4\")\n\n    }\n    return\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>hexCols := []string{\n    \"#112233\",\n    \"#123\",\n    \"#000233\",\n    \"#023\",\n    \"invalid\",\n    \"#abcd\",\n    \"#-12\",\n}\nfor _, hc := range hexCols {\n    c, err := ParseHexColor(hc)\n    fmt.Printf(\"%-7s = %3v, %v\\n\", hc, c, err)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/MHMePGcExHl\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>#112233 = { 17  34  51 255}, &lt;nil&gt;\n#123    = { 17  34  51 255}, &lt;nil&gt;\n#000233 = {  0   2  51 255}, &lt;nil&gt;\n#023    = {  0  34  51 255}, &lt;nil&gt;\ninvalid = {  0   0   0 255}, input does not match format\n#abcd   = {  0   0   0 255}, invalid length, must be 7 or 4\n#-12    = {  0   0   0 255}, expected integer\n</code></pre>\n\n<h2>2. Fast solution</h2>\n\n<p>If performance does matter, <code>fmt.Sscanf()</code> is a really bad choice. It requires a format string which the implementation has to parse, and according to it parse the input, and use reflection to store the result to the pointed values.</p>\n\n<p>Since the task is basically just \"parsing\" a hexadecimal value, we can do better than this. We don't even have to call into a general hex parsing library (such as <a href=\"https://golang.org/pkg/encoding/hex/\" rel=\"nofollow noreferrer\"><code>encoding/hex</code></a>), we can do that on our own. We don't even have to treat the input as a <code>string</code>, or even as a series of <code>rune</code>s, we may lower to the level of treating it as a series of bytes. Yes, Go stores <code>string</code> values as UTF-8 byte sequences in memory, but if the input is a valid color string, all its bytes must be in the range of <code>0..127</code> which map to bytes 1-to-1. If that would not be the case, the input would already be invalid, which we will detect, but what color we return in that case should not matter (does not matter).</p>\n\n<p>Now let's see a fast implementation:</p>\n\n<pre><code>var errInvalidFormat = errors.New(\"invalid format\")\n\nfunc ParseHexColorFast(s string) (c color.RGBA, err error) {\n    c.A = 0xff\n\n    if s[0] != '#' {\n        return c, errInvalidFormat\n    }\n\n    hexToByte := func(b byte) byte {\n        switch {\n        case b &gt;= '0' &amp;&amp; b &lt;= '9':\n            return b - '0'\n        case b &gt;= 'a' &amp;&amp; b &lt;= 'f':\n            return b - 'a' + 10\n        case b &gt;= 'A' &amp;&amp; b &lt;= 'F':\n            return b - 'A' + 10\n        }\n        err = errInvalidFormat\n        return 0\n    }\n\n    switch len(s) {\n    case 7:\n        c.R = hexToByte(s[1])&lt;&lt;4 + hexToByte(s[2])\n        c.G = hexToByte(s[3])&lt;&lt;4 + hexToByte(s[4])\n        c.B = hexToByte(s[5])&lt;&lt;4 + hexToByte(s[6])\n    case 4:\n        c.R = hexToByte(s[1]) * 17\n        c.G = hexToByte(s[2]) * 17\n        c.B = hexToByte(s[3]) * 17\n    default:\n        err = errInvalidFormat\n    }\n    return\n}\n</code></pre>\n\n<p>Testing it with the same inputs as in the first example, the output is (try it on the <a href=\"https://play.golang.org/p/Z79xoFATpt8\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>#112233 = { 17  34  51 255}, &lt;nil&gt;\n#123    = { 17  34  51 255}, &lt;nil&gt;\n#000233 = {  0   2  51 255}, &lt;nil&gt;\n#023    = {  0  34  51 255}, &lt;nil&gt;\ninvalid = {  0   0   0 255}, invalid format\n#abcd   = {  0   0   0 255}, invalid format\n#-12    = {  0  17  34 255}, invalid format\n</code></pre>\n\n<h2>3. Benchmarks</h2>\n\n<p>Let's benchmark these 2 solutions. The benchmarking code will include calling them with long and short formats. Error case is excluded.</p>\n\n<pre><code>func BenchmarkParseHexColor(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        ParseHexColor(\"#112233\")\n        ParseHexColor(\"#123\")\n    }\n}\n\nfunc BenchmarkParseHexColorFast(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        ParseHexColorFast(\"#112233\")\n        ParseHexColorFast(\"#123\")\n    }\n}\n</code></pre>\n\n<p>And here are the benchmark results:</p>\n\n<pre><code>go test -bench . -benchmem\n\nBenchmarkParseHexColor-4         500000     2557 ns/op      144 B/op    9 allocs/op\nBenchmarkParseHexColorFast-4   100000000      10.3 ns/op      0 B/op    0 allocs/op\n</code></pre>\n\n<p>As we can see, the \"fast\" solution is roughly <strong>250 times</strong> faster and uses no allocation (unlike the \"elegant\" solution).</p>\n"}], "owner": {"reputation": 5619, "user_id": 1723695, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/dx9jj.jpg?s=128&g=1", "display_name": "Kirill", "link": "https://stackoverflow.com/users/1723695/kirill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3861, "favorite_count": 0, "accepted_answer_id": 54200713, "answer_count": 3, "score": 5, "last_activity_date": 1579859315, "creation_date": 1547551543, "last_edit_date": 1576394123, "question_id": 54197913, "link": "https://stackoverflow.com/questions/54197913/parse-hex-string-to-image-color", "title": "Parse hex string to image/color", "body": "<p>How can I parse RGB color in <a href=\"https://en.wikipedia.org/wiki/Web_colors\" rel=\"nofollow noreferrer\">web color</a> format (3 or 6 hex digits) to <code>Color</code> from <code>image/color</code>? Does go have any built-in parser for that?\nI want to be able to parse both <code>#XXXXXX</code> and <code>#XXX</code> colors formats.\n<code>color</code> docs says nothing about it: <a href=\"https://golang.org/pkg/image/color/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/image/color/</a>\nbut this task is very common, so I believe that go has some functions for that (which I just didn't find).</p>\n\n<hr>\n\n<p>Update: I created small Go library based on <a href=\"https://stackoverflow.com/a/54200713/1723695\">accepted</a> answer: <a href=\"https://github.com/g4s8/hexcolor\" rel=\"nofollow noreferrer\">github.com/g4s8/hexcolor</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1547549009, "post_id": 54196967, "comment_id": 95221183, "body": "While not recommended it is also possible to add a dot in front of the import, in which case <i>&quot;all the package&#39;s exported identifiers declared in that package&#39;s package block will be declared in the importing source file&#39;s file block and must be accessed without a qualifier.&quot;</i> <a href=\"https://golang.org/ref/spec#Import_declarations\" rel=\"nofollow noreferrer\">read more here</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 8, "last_activity_date": 1547548118, "creation_date": 1547548118, "answer_id": 54197005, "question_id": 54196967, "link": "https://stackoverflow.com/questions/54196967/why-am-i-unable-to-use-a-struct-defined-in-a-different-package/54197005#54197005", "title": "Why am I unable to use a struct defined in a different package?", "body": "<p>You have to first <a href=\"https://golang.org/ref/spec#Import_declarations\" rel=\"noreferrer\">import</a> the package whose <a href=\"https://golang.org/ref/spec#Identifiers\" rel=\"noreferrer\">identifiers</a> you want to refer to:</p>\n\n<pre><code>import \"path/to/fsm\"\n</code></pre>\n\n<p>Once you do this, the package name <code>fsm</code> becomes a new identifier in your <a href=\"https://golang.org/ref/spec#Blocks\" rel=\"noreferrer\">file block</a>, and you can refer to its <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"noreferrer\">exported identifiers</a> (identifiers that start with an uppercase letter) by using a <a href=\"https://golang.org/ref/spec#Qualified_identifiers\" rel=\"noreferrer\">qualified identifier</a>, which is <code>packagename.IdentifierName</code> like this:</p>\n\n<pre><code>Transitions := make(map[fsm.EKey]string)\n</code></pre>\n\n<p>See related question: <a href=\"https://stackoverflow.com/questions/36994445/getting-a-use-of-package-without-selector-error/36995058#36995058\">Getting a use of package without selector error</a></p>\n"}, {"tags": [], "owner": {"reputation": 205, "user_id": 3330989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d07ee2fd68bebc4798d7f38ebaecdf86?s=128&d=identicon&r=PG&f=1", "display_name": "liusy182", "link": "https://stackoverflow.com/users/3330989/liusy182"}, "is_accepted": false, "score": 1, "last_activity_date": 1547548119, "creation_date": 1547548119, "answer_id": 54197006, "question_id": 54196967, "link": "https://stackoverflow.com/questions/54196967/why-am-i-unable-to-use-a-struct-defined-in-a-different-package/54197006#54197006", "title": "Why am I unable to use a struct defined in a different package?", "body": "<p>try this</p>\n\n<pre><code>package main\n\nimport (\n\"encoding/json\"\n\"fmt\"\n\n\"github.com/looplab/fsm\"\n) \nfunc main(){\n    Transitions := make(map[fsm.EKey]string) \n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": false, "score": 2, "last_activity_date": 1547554712, "creation_date": 1547554712, "answer_id": 54198714, "question_id": 54196967, "link": "https://stackoverflow.com/questions/54196967/why-am-i-unable-to-use-a-struct-defined-in-a-different-package/54198714#54198714", "title": "Why am I unable to use a struct defined in a different package?", "body": "<p>You need to refer to your struct using <code>fsm.EKey</code></p>\n\n<p>If you want to import it to your local name space, you need a dot before the import path.</p>\n\n<pre><code>import (\n   // ....\n   . \"github.com/looplab/fsm\"\n)\n</code></pre>\n\n<p>Now you can refer to your struct directly as <code>EKey</code></p>\n"}], "owner": {"reputation": 1105, "user_id": 1274878, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/4c03ea4489c49fabca0a0c543b96f619?s=128&d=identicon&r=PG", "display_name": "user1274878", "link": "https://stackoverflow.com/users/1274878/user1274878"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1547554712, "creation_date": 1547547984, "question_id": 54196967, "link": "https://stackoverflow.com/questions/54196967/why-am-i-unable-to-use-a-struct-defined-in-a-different-package", "title": "Why am I unable to use a struct defined in a different package?", "body": "<p>I am unable to use a struct in <code>package main</code> which has been defined in a different package. Please note that I am importing the other package correctly</p>\n\n<p>I named the struct and its fields starting with a capital letter because I read that in Golang that is how we indicate that it is an exported field. Although it is not required if the package is imported.</p>\n\n<p>fsm.go</p>\n\n<pre><code>package fsm\n\nimport (\n\"fmt\"\n\"strings\"\n )\n// EKey is a struct key used for storing the transition map.\ntype EKey struct {\n// event is the name of the event that the keys refers to.\nEvent string\n\n// src is the source from where the event can transition.\nSrc string\n}\n</code></pre>\n\n<p>test.go</p>\n\n<pre><code>package main\n\nimport (\n\"encoding/json\"\n\"fmt\"\n\n\"github.com/looplab/fsm\"\n) \nfunc main(){\n    Transitions := make(map[EKey]string) \n}\n</code></pre>\n\n<p><code>Error: undefined EKey</code></p>\n"}, {"tags": ["go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 16, "last_activity_date": 1597952099, "last_edit_date": 1597952099, "creation_date": 1547544541, "answer_id": 54196005, "question_id": 54195834, "link": "https://stackoverflow.com/questions/54195834/how-to-inspect-slice-header/54196005#54196005", "title": "How to inspect slice header?", "body": "<p>The slice header is represented by the <a href=\"https://golang.org/pkg/reflect/#SliceHeader\" rel=\"nofollow noreferrer\"><code>reflect.SliceHeader</code></a> type:</p>\n<pre><code>type SliceHeader struct {\n        Data uintptr\n        Len  int\n        Cap  int\n}\n</code></pre>\n<p>You may use package <a href=\"https://golang.org/pkg/unsafe/\" rel=\"nofollow noreferrer\"><code>unsafe</code></a> to convert a slice pointer to <code>*reflect.SliceHeader</code> like this:</p>\n<pre><code>sh := (*reflect.SliceHeader)(unsafe.Pointer(&amp;newSlice2))\n</code></pre>\n<p>And then you may print it like any other structs:</p>\n<pre><code>fmt.Printf(&quot;%+v&quot;, sh)\n</code></pre>\n<p>Output will be (try it on the <a href=\"https://play.golang.org/p/zM1ylEdbd3f\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>&amp;{Data:1792106 Len:8 Cap:246}\n</code></pre>\n<p>Also note that you can access the info stored in a slice header without using package <code>unsafe</code> and <code>reflect</code>:</p>\n<ul>\n<li>to get the <code>Data</code> field, you may use <code>&amp;newSlice2[0]</code></li>\n<li>to get the <code>Len</code> field, use <code>len(newSlice2)</code></li>\n<li>to get the <code>Cap</code> field, use <code>cap(newSlice2)</code></li>\n</ul>\n<p>See a modified <a href=\"https://play.golang.org/p/Lw131X0e5Z1\" rel=\"nofollow noreferrer\">Go Playground</a> example which shows these values are the same as in the slice header.</p>\n<p>See related questions:</p>\n<p><a href=\"https://stackoverflow.com/questions/51187973/how-to-create-an-array-or-a-slice-from-an-array-unsafe-pointer-in-golang/51188315#51188315\">How to create an array or a slice from an array unsafe.Pointer in golang?</a></p>\n<p><a href=\"https://stackoverflow.com/questions/44305170/nil-slices-vs-non-nil-slices-vs-empty-slices-in-go-language/44305910#44305910\">nil slices vs non-nil slices vs empty slices in Go language</a></p>\n"}], "owner": {"reputation": 5432, "user_id": 4723732, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/77fa71fdc548472c228be40043c1bc1f?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Rublev", "link": "https://stackoverflow.com/users/4723732/richard-rublev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1409, "favorite_count": 4, "accepted_answer_id": 54196005, "answer_count": 1, "score": 4, "last_activity_date": 1597952099, "creation_date": 1547543947, "last_edit_date": 1547544693, "question_id": 54195834, "link": "https://stackoverflow.com/questions/54195834/how-to-inspect-slice-header", "title": "How to inspect slice header?", "body": "<p>This is slightly modified code from <a href=\"https://blog.golang.org/slices\" rel=\"noreferrer\">slices</a></p>\n\n<pre><code>var buffer [256] byte\n\nfunc SubtractOneFromLength(slice []byte) []byte {\n    slice = slice[0 : len(slice)-1]\n    return slice\n}\n\nfunc main() {\n    slice := buffer[10:20]\n    fmt.Println(\"Before: len(slice) =\", len(slice))\n    newSlice := SubtractOneFromLength(slice)\n    fmt.Println(\"After:  len(slice) =\", len(slice))\n    fmt.Println(\"After:  len(newSlice) =\", len(newSlice))\n    newSlice2 := SubtractOneFromLength(newSlice)\n    fmt.Println(\"After:  len(newSlice2) =\", len(newSlice2))\n}\n</code></pre>\n\n<p>It says that contents of a slice argument can be modified by a function, but its header cannot. \nHow can I print header of newSlice2 on my screen?</p>\n"}, {"tags": ["go", "reflect"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1547537920, "post_id": 54194433, "comment_id": 95215900, "body": "You can&#39;t get a function by its name. You can get methods though. See the marked duplicate."}, {"owner": {"reputation": 178, "user_id": 1367644, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1f13449555c3fbc245cda582fe0464f5?s=128&d=identicon&r=PG", "display_name": "lesovsky", "link": "https://stackoverflow.com/users/1367644/lesovsky"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1547547346, "post_id": 54194433, "comment_id": 95220283, "body": "Thank you, one of those solutions (transforming functions to methods) is suitable for my case."}], "owner": {"reputation": 178, "user_id": 1367644, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1f13449555c3fbc245cda582fe0464f5?s=128&d=identicon&r=PG", "display_name": "lesovsky", "link": "https://stackoverflow.com/users/1367644/lesovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 22, "favorite_count": 0, "closed_date": 1547537854, "answer_count": 0, "score": 0, "last_activity_date": 1547537660, "creation_date": 1547537660, "question_id": 54194433, "link": "https://stackoverflow.com/questions/54194433/generate-map-with-functions-in-golang", "closed_reason": "Duplicate", "title": "Generate map with functions in Golang", "body": "<p>I have an array of strings which could be generated with different number of elemnts. And I'd like to make a map, where each string from that array will be associated with specific function.\nIn theory, it might look like this example, but this code doesn't work of course:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strings\"\n\nvar (\n    Names []string {\"foo\", \"bar\", \"baz\"}\n)\n\nfunc main() {\n    m := make(map[string]interface{})\n    for _, name := range Names {\n        fnname := strings.Title(name)\n        // add function to the map\n        m[name] = fnname\n    }\n\n    // exec functions store in the map\n    for _, fn := range m {\n        fn()\n    }\n}\n\nfunc Foo() {\n    fmt.Println(\"I'm foo\")\n}\nfunc Bar() {\n    fmt.Println(\"I'm bar\")\n}\nfunc Baz() {\n    fmt.Println(\"I'm baz\")\n}\n</code></pre>\n\n<p>I'm looking on <code>reflect</code> package, but haven't found the way how to convert name of supposed function (which is string) to the function itself.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1547535655, "post_id": 54193469, "comment_id": 95215129, "body": "&quot;Is that even possible in Go to dynamically ...&quot; In a word: No."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1547535972, "post_id": 54193469, "comment_id": 95215232, "body": "&quot;requires passing myMethod signature with concrete type instead of that interface to do proper unmarshalling&quot; This doesn&#39;t make sense to me. What do you mean by &quot;passing myMethod signature&quot;? Concrete types are not required for unmarshalling. In fact, all unmarshal functions in the standard library take an empty interface as argument."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1547536707, "post_id": 54193469, "comment_id": 95215452, "body": "<code>MyType1</code> and <code>MyType2</code> values can be passed to <code>myMethod</code> as is: <code>myMethod(MyType1{}); myMethod(MyType2{})</code>.  Is this what you are trying to do?"}, {"owner": {"reputation": 2336, "user_id": 2182674, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/ac50caa222fd72b83e0e9c20409c0fc0?s=128&d=identicon&r=PG&f=1", "display_name": "TechCrunch", "link": "https://stackoverflow.com/users/2182674/techcrunch"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1547573771, "post_id": 54193469, "comment_id": 95234959, "body": "@ThunderCat. I want the signature of <code>myMethod(MyType)</code> to be changed to <code>myMethod(MyType1)</code> in runtime. I am ok to make a new function if that is a possibility."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1547574575, "post_id": 54193469, "comment_id": 95235351, "body": "Write and use a simple wrapper? <code>func myMethod2(v MyType1) { myMethod(v) }</code>"}], "answers": [{"comments": [{"owner": {"reputation": 2336, "user_id": 2182674, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/ac50caa222fd72b83e0e9c20409c0fc0?s=128&d=identicon&r=PG&f=1", "display_name": "TechCrunch", "link": "https://stackoverflow.com/users/2182674/techcrunch"}, "edited": false, "score": 0, "creation_date": 1547573914, "post_id": 54193971, "comment_id": 95235035, "body": "I started playing with reflections to see if I can use <code>MakeFunc</code> to achieve what I am trying. @ThunderCat. I want the signature of <code>myMethod(MyType)</code> to be changed to <code>myMethod(MyType1)</code> or create a new function with signature <code>fn(MyType1)</code> in runtime."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 2336, "user_id": 2182674, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/ac50caa222fd72b83e0e9c20409c0fc0?s=128&d=identicon&r=PG&f=1", "display_name": "TechCrunch", "link": "https://stackoverflow.com/users/2182674/techcrunch"}, "edited": false, "score": 0, "creation_date": 1547578317, "post_id": 54193971, "comment_id": 95236983, "body": "@TechCrunch You cannot change a method signature, not even with reflection."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 4, "last_activity_date": 1547535183, "creation_date": 1547535183, "answer_id": 54193971, "question_id": 54193469, "link": "https://stackoverflow.com/questions/54193469/how-to-change-function-parameter-type-dynamically-in-go/54193971#54193971", "title": "How to change function parameter type dynamically in go", "body": "<blockquote>\n  <p>How to change function parameter type dynamically in go [?]</p>\n</blockquote>\n\n<p>You simply cannot. Go is statically typed.</p>\n\n<p>(Making your code run is trivial, but probably not what you want:</p>\n\n<pre><code>type1Val := reflect.ValueOf(type1)\nmyMethod(*(type1Val.Interface().(*MyType1)))\n</code></pre>\n\n<p>and I have to admit I do not understand what you are trying to do with reflect here.)</p>\n"}], "owner": {"reputation": 2336, "user_id": 2182674, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/ac50caa222fd72b83e0e9c20409c0fc0?s=128&d=identicon&r=PG&f=1", "display_name": "TechCrunch", "link": "https://stackoverflow.com/users/2182674/techcrunch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 613, "favorite_count": 0, "closed_date": 1547558587, "accepted_answer_id": 54193971, "answer_count": 1, "score": -1, "last_activity_date": 1547574101, "creation_date": 1547532243, "last_edit_date": 1547574101, "question_id": 54193469, "link": "https://stackoverflow.com/questions/54193469/how-to-change-function-parameter-type-dynamically-in-go", "closed_reason": "Needs details or clarity", "title": "How to change function parameter type dynamically in go", "body": "<p>I have a program as below. I am trying to change the type of a function argument dynamically as another library I am using requires passing <code>myMethod</code> signature with concrete type instead of that interface to do proper unmarshalling. Is that even possible in Go to dynamically make a function or anonymous function with argument's type generated dynamically or perhaps change the parameter type of a function?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype MyType interface {\n    doThis()\n}\n\ntype MyType1 struct{}\n\nfunc (m MyType1) doThis() {\n    fmt.Println(\"Type1 doThis\")\n}\n\ntype MyType2 struct{}\n\nfunc (m MyType2) doThis() {\n    fmt.Println(\"Type2 doThis\")\n}\n\nfunc myMethod(myType MyType) {\n    myType.doThis()\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    var type1 MyType\n    type1 = &amp;MyType1{}\n    type1Val := reflect.TypeOf(type1)\n    // TODO - change myMethod signature dynamically to accept type1Val as the type\n}\n</code></pre>\n\n<p>Here is the GoPlay <a href=\"https://play.golang.org/p/ZZsIOSJP-ON\" rel=\"nofollow noreferrer\">link</a></p>\n\n<p><strong>Edit:</strong> Adding clarification</p>\n\n<p>The library I am using exposes a <code>registerSomething(someFunc)</code> where the input argument type of <code>someFunc</code> will be later used in some unmarshaling. If the input argument type is an interface, the unmarshal will return a map. If its a typed struct, the unmarshal will return the typed struct with all params populated correctly so I don't have to deal with unmarshaling.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 573, "user_id": 3015449, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/csGZm.gif?s=128&g=1", "display_name": "davo36", "link": "https://stackoverflow.com/users/3015449/davo36"}, "edited": false, "score": 0, "creation_date": 1547532653, "post_id": 54192891, "comment_id": 95214320, "body": "Hmmm, this seems right.  But then wouldn&#39;t every resource packed into a binary with packr suffer from the same problem?  Like say you pack some html files, then serve them up, why don&#39;t they need to be re-written back out to the file system?"}, {"owner": {"reputation": 3322, "user_id": 966798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b52a10544df0260f8eab84b3bbea4bb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/966798/matt"}, "reply_to_user": {"reputation": 573, "user_id": 3015449, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/csGZm.gif?s=128&g=1", "display_name": "davo36", "link": "https://stackoverflow.com/users/3015449/davo36"}, "edited": false, "score": 1, "creation_date": 1547532837, "post_id": 54192891, "comment_id": 95214369, "body": "It depends how you use the file data. I use packr a lot to embed things like SQL queries, HTML templates, images, fonts, etc but I read the bytes from the packr box and then pass those bytes directly to a function that accepts a <code>[]byte</code> parameter. You&#39;re calling <code>exec</code> which is an operating system call so you have pass your sound file the same way you would if you called <code>play</code> on the command line (i.e. as a file system path)."}, {"owner": {"reputation": 573, "user_id": 3015449, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/csGZm.gif?s=128&g=1", "display_name": "davo36", "link": "https://stackoverflow.com/users/3015449/davo36"}, "edited": false, "score": 0, "creation_date": 1547534825, "post_id": 54192891, "comment_id": 95214887, "body": "Yes I see what you mean.  I think you&#39;re probably right. Bugger.  This means we may as well distribute the sound files with the executable.  Either that or try and find some way of playing the files without calling exec..."}, {"owner": {"reputation": 3322, "user_id": 966798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b52a10544df0260f8eab84b3bbea4bb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/966798/matt"}, "reply_to_user": {"reputation": 573, "user_id": 3015449, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/csGZm.gif?s=128&g=1", "display_name": "davo36", "link": "https://stackoverflow.com/users/3015449/davo36"}, "edited": false, "score": 0, "creation_date": 1547537040, "post_id": 54192891, "comment_id": 95215568, "body": "I had a quick look at some Go audio libraries, there&#39;s a few around, but I&#39;m not sure how nice they are to use. Here&#39;s an <a href=\"https://github.com/hajimehoshi/go-mp3\" rel=\"nofollow noreferrer\">mp3 one</a> for example."}], "tags": [], "owner": {"reputation": 3322, "user_id": 966798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b52a10544df0260f8eab84b3bbea4bb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/966798/matt"}, "is_accepted": true, "score": 5, "last_activity_date": 1547611639, "last_edit_date": 1547611639, "creation_date": 1547528270, "answer_id": 54192891, "question_id": 54192824, "link": "https://stackoverflow.com/questions/54192824/how-to-use-gobuffalo-packr-with-golang/54192891#54192891", "title": "How to Use gobuffalo/packr with Golang", "body": "<p>You're still referencing the file on the file system, even though you have it packed into the binary:</p>\n\n<pre><code>args := []string{\"-v20\", \"./sounds/IEEE_float_mono_32kHz.wav\"}\noutput, err := exec.Command(\"play\", args...).Output()\n</code></pre>\n\n<p>You can grab the file data from your packr box like this:</p>\n\n<pre><code>bytes, err := soundsBox.FindBytes(\"IEEE_float_mono_32kHz.wav\")\n</code></pre>\n\n<p>To execute the file with <code>exec.Command()</code> I think you'll have to write those bytes back to the file system:</p>\n\n<pre><code>err := ioutil.WriteFile(\"/tmp/IEEE_float_mono_32kHz.wav\", bytes, 0755)\nexec.Command(\"play\", []string{\"-v20\", \"/tmp/IEEE_float_mono_32kHz.wav\"}\n</code></pre>\n\n<p>You might be able to pass your bytes to <code>play</code> via stdin, but that would depend on how the <code>play</code> binary works.</p>\n\n<pre><code>cmd.Stdin = bytes\ncmd.Run()\n</code></pre>\n"}], "owner": {"reputation": 573, "user_id": 3015449, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/csGZm.gif?s=128&g=1", "display_name": "davo36", "link": "https://stackoverflow.com/users/3015449/davo36"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1820, "favorite_count": 1, "accepted_answer_id": 54192891, "answer_count": 1, "score": 4, "last_activity_date": 1547611639, "creation_date": 1547527733, "question_id": 54192824, "link": "https://stackoverflow.com/questions/54192824/how-to-use-gobuffalo-packr-with-golang", "title": "How to Use gobuffalo/packr with Golang", "body": "<p>I'm trying to play a sound from Golang.  It's a .wav file.  And I want to package the .wav file into the executable using <a href=\"https://github.com/gobuffalo/packr\" rel=\"nofollow noreferrer\">packr</a></p>\n\n<p>I have created a very small project here: <a href=\"https://github.com/Davo36/packr-test\" rel=\"nofollow noreferrer\">packr-test repository</a> with the code.</p>\n\n<p>When I run the executable (./packr-test) in it's default folder, the sound plays. \n But the problem I'm having is that when I move the executable to another directory, I get an error trying to play the sound file.  Which I think probably means the sound file isn't being bundled up with the executable.</p>\n\n<p>This is on Ubuntu.  I'm using the 'play' command which is often installed by default, but if it's not there, can be done with: </p>\n\n<pre><code>sudo apt-get install sox\nsudo apt-get install sox libsox-fmt-all\n</code></pre>\n\n<p>To use play command:</p>\n\n<pre><code>play file_name.extension\n</code></pre>\n\n<p>To save you looking it up, here is my Go code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n\n    \"github.com/gobuffalo/packr\"\n)\n\nfunc main() {\n\n    soundsBox := packr.NewBox(\"./sounds\")\n    if soundsBox.Has(\"IEEE_float_mono_32kHz.wav\") {\n        fmt.Println(\"It's there.\")\n    } else {\n        fmt.Println(\"It's not there.\")\n    }\n\n    args := []string{\"-v20\", \"./sounds/IEEE_float_mono_32kHz.wav\"}\n    output, err := exec.Command(\"play\", args...).Output()\n    if err != nil {\n        // Play command was not successful\n        fmt.Println(\"Got an error.\")\n        fmt.Println(err.Error())\n    } else {\n        fmt.Println(string(output))\n    }\n\n}\n</code></pre>\n\n<p>Here is my output:</p>\n\n<pre><code>sudo ./packr-test \nIt's there.\nGot an error.\nexit status 2\n</code></pre>\n"}, {"tags": ["go", "gtk3"], "comments": [{"owner": {"reputation": 1896, "user_id": 4226702, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-siukF5ObSUs/AAAAAAAAAAI/AAAAAAAAAEc/Qww5nEqBNDw/photo.jpg?sz=128", "display_name": "Alexander Dmitriev", "link": "https://stackoverflow.com/users/4226702/alexander-dmitriev"}, "edited": false, "score": 0, "creation_date": 1547535840, "post_id": 54192398, "comment_id": 95215184, "body": "It&#39;s <code>focus-out-event</code> with dashes, not underscores"}, {"owner": {"reputation": 1896, "user_id": 4226702, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-siukF5ObSUs/AAAAAAAAAAI/AAAAAAAAAEc/Qww5nEqBNDw/photo.jpg?sz=128", "display_name": "Alexander Dmitriev", "link": "https://stackoverflow.com/users/4226702/alexander-dmitriev"}, "edited": false, "score": 0, "creation_date": 1547536153, "post_id": 54192398, "comment_id": 95215283, "body": "By the way, Gtk should have warned you that this signal is invalid. Did you ignore it?"}, {"owner": {"reputation": 1, "user_id": 9500881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1af792317fe808fe21032bce7c9934c7?s=128&d=identicon&r=PG&f=1", "display_name": "erick", "link": "https://stackoverflow.com/users/9500881/erick"}, "reply_to_user": {"reputation": 1896, "user_id": 4226702, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-siukF5ObSUs/AAAAAAAAAAI/AAAAAAAAAEc/Qww5nEqBNDw/photo.jpg?sz=128", "display_name": "Alexander Dmitriev", "link": "https://stackoverflow.com/users/4226702/alexander-dmitriev"}, "edited": false, "score": 0, "creation_date": 1547616789, "post_id": 54192398, "comment_id": 95247859, "body": "Hi,<code>focus-out-event</code> has the same result. I get the signal when click other buttons .That says the event can be triggered ,so I have not received warning. Could tell me how to trigger the event when I click anywhere but the  GtkEntry."}, {"owner": {"reputation": 1896, "user_id": 4226702, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-siukF5ObSUs/AAAAAAAAAAI/AAAAAAAAAEc/Qww5nEqBNDw/photo.jpg?sz=128", "display_name": "Alexander Dmitriev", "link": "https://stackoverflow.com/users/4226702/alexander-dmitriev"}, "edited": false, "score": 0, "creation_date": 1547707111, "post_id": 54192398, "comment_id": 95285502, "body": "Do you want to receive it every single time you click outside the entry?"}, {"owner": {"reputation": 1, "user_id": 9500881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1af792317fe808fe21032bce7c9934c7?s=128&d=identicon&r=PG&f=1", "display_name": "erick", "link": "https://stackoverflow.com/users/9500881/erick"}, "reply_to_user": {"reputation": 1896, "user_id": 4226702, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-siukF5ObSUs/AAAAAAAAAAI/AAAAAAAAAEc/Qww5nEqBNDw/photo.jpg?sz=128", "display_name": "Alexander Dmitriev", "link": "https://stackoverflow.com/users/4226702/alexander-dmitriev"}, "edited": false, "score": 0, "creation_date": 1547717515, "post_id": 54192398, "comment_id": 95290429, "body": "Yes,as you said"}], "owner": {"reputation": 1, "user_id": 9500881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1af792317fe808fe21032bce7c9934c7?s=128&d=identicon&r=PG&f=1", "display_name": "erick", "link": "https://stackoverflow.com/users/9500881/erick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547531549, "creation_date": 1547523642, "last_edit_date": 1547531549, "question_id": 54192398, "link": "https://stackoverflow.com/questions/54192398/how-i-get-the-text-of-gtkentry-and-do-some-other-things-when-i-click-anywhere-wi", "title": "How I get the text of GtkEntry and do some other things when I click anywhere without the original GtkEntry", "body": "<p>When I click labelEntity, the focus_out_event event doesn't execute. I want to get the text and do some things (here I'm only printing it), how do I do that?</p>\n\n<pre><code>box,_ := gtk.BoxNew(gtk.ORIENTATION_HORIZONTAL,0)\nlabelEntity,_ := gtk.EntryNew()\nlabelEntity.SetText(label)\nlabelEntity.SetVisibility(true)\n\nbox.Add(labelEntity)\nbox.ShowAll()\nlabelEntity.Connect(\"focus_out_event\", func() {\n    newLabel,_ := labelEntity.GetText()\n    fmt.Println(newLabel)\n})\n</code></pre>\n\n<p>I want the callback executing</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547535733, "post_id": 54191681, "comment_id": 95215152, "body": "The error tells you the problem--you have a type mismatch. You cannot multiply mismatched types together, so they must be converted to the same type."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 9, "last_activity_date": 1547517258, "creation_date": 1547517258, "answer_id": 54191710, "question_id": 54191681, "link": "https://stackoverflow.com/questions/54191681/how-to-create-a-time-duration-in-a-for-loop-mismatched-types-int-and-time-dur/54191710#54191710", "title": "How to create a time duration in a for loop - (mismatched types int and time.Duration)", "body": "<p>The operands to numeric operations must have the same type. <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"noreferrer\">Convert</a> the <code>int</code> value <code>idx</code> to a <code>time.Duration</code>: <code>var a = time.Duration(idx) * time.Minute</code></p>\n"}], "owner": {"reputation": 61601, "user_id": 1203556, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aca772bc8ed79a86894211c7efd920aa?s=128&d=identicon&r=PG", "display_name": "Tampa", "link": "https://stackoverflow.com/users/1203556/tampa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1326, "favorite_count": 0, "accepted_answer_id": 54191710, "answer_count": 1, "score": 1, "last_activity_date": 1547526815, "creation_date": 1547516990, "last_edit_date": 1547526815, "question_id": 54191681, "link": "https://stackoverflow.com/questions/54191681/how-to-create-a-time-duration-in-a-for-loop-mismatched-types-int-and-time-dur", "title": "How to create a time duration in a for loop - (mismatched types int and time.Duration)", "body": "<p>I have a loop where I start by a time.Time and I what to add a minute.</p>\n\n<pre><code> for idx := range keys {\n    var a = idx * time.Minute\n    var t = tInit.Add(time.Minute * a)\n    fmt.Println(t, idx)\n\n\n }\n</code></pre>\n\n<p>Here is my error</p>\n\n<pre><code>invalid operation: idx * time.Minute (mismatched types int and time.Duration)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1547516144, "post_id": 54191527, "comment_id": 95210973, "body": "The select will block if nothing sends to <code>w.ch1</code> or the channel returned by <code>w.recv2()</code>. Show a complete example including the code for <code>recv2</code>."}, {"owner": {"reputation": 11, "user_id": 9317007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82682cd59a637c7a153131f4f1d80193?s=128&d=identicon&r=PG", "display_name": "johncming", "link": "https://stackoverflow.com/users/9317007/johncming"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1547518829, "post_id": 54191527, "comment_id": 95211501, "body": "ok. the code is long which can&#39;t be post in comment. read the link <a href=\"https://gist.github.com/johncming/015106bc919d12110e81ca3f2fdf2358\" rel=\"nofollow noreferrer\">gist.github.com/johncming/015106bc919d12110e81ca3f2fdf2358</a>. there are two test cases, the second will be block which I don&#39;t know why. thanks for you reply."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1547519891, "post_id": 54191527, "comment_id": 95211710, "body": "It is a large amount of code to understand. Please create a <a href=\"https://stackoverflow.com/help/mcve\">minimal</a> example illustrating the problem."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1547531866, "post_id": 54191527, "comment_id": 95214173, "body": "Furthrrmore, I would like to point out that you can edit your question."}], "answers": [{"tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": true, "score": 2, "last_activity_date": 1547520479, "creation_date": 1547520479, "answer_id": 54192072, "question_id": 54191527, "link": "https://stackoverflow.com/questions/54191527/channel-has-a-strange-behaviorior-why-block/54192072#54192072", "title": "Channel has a strange behaviorior, why block?", "body": "<p><em>Every time</em> you call <code>recv1Block()</code>, it creates a new channel and launches a background goroutine that tries to read all of the data from it.  Since you're calling it in a loop, you will have many things all trying to consume the data from the channel; since the channel never closes, all of the goroutines will run forever.</p>\n\n<p>As an exercise, you might try changing your code to pass around a <code>chan int</code> instead of a <code>chan struct{}</code>, and write a series of sequential numbers, and print them out as they're ultimately received.  A sequence like this is valid:</p>\n\n<ol>\n<li><code>run</code> on goroutine #1 calls <code>recv1Block()</code>.</li>\n<li><code>recv1Block()</code> on GR#1 spawns GR#2, and returns channel#2.</li>\n<li><code>run</code> on GR#1 blocks receiving on channel#2.</li>\n<li><code>recv1Block()</code> on GR#2 reads <code>0</code> from <code>w.c1</code>.</li>\n<li><code>recv1Block()</code> on GR#2 writes <code>0</code> to channel#2 (where <code>run</code> on GR#1 is ready to read).</li>\n<li><code>recv1Block()</code> on GR#2 reads <code>1</code> from <code>w.c1</code>.</li>\n<li><code>recv1Block()</code> on GR#2 wants to write <code>0</code> to channel#2 but blocks.</li>\n<li><code>run</code> on GR#1 wakes up, and receives the <code>0</code>.</li>\n<li><code>run</code> on GR#1 calls <code>recv1Block()</code>.</li>\n<li><code>recv1Block()</code> on GR#1 spawns GR#3, and returns channel #3.</li>\n<li><code>recv1Block()</code> on GR#3 reads <code>2</code> from <code>w.c1</code>.</li>\n<li>...</li>\n</ol>\n\n<p>Notice that the value 1 in this sequence will never be written anywhere, and in fact there is nothing left that could read it.</p>\n\n<p>The easy solution here is to not call the channel-creating function in a loop:</p>\n\n<pre><code>func (w *waiter) runBlock(wg *sync.WaitGroup) {\n    defer wg.Done()\n    ch1 := w.recv1Block()\n    ch2 := w.recv2()\n    for {\n        select {\n        case _, ok := &lt;-ch1:\n            if !ok {\n                return\n            }\n            w.count++\n        case &lt;-ch2:\n    }\n}\n</code></pre>\n\n<p>It's also standard practice to close channels when you're done with them.  This will terminate a <code>for ... range ch</code> loop, and it will appear as readable to a <code>select</code> statement.  In your top-level generator function:</p>\n\n<pre><code>for i := 0; i &lt; w.limit; i++ {\n    w.ch1 &lt;- struct{}{}\n}\nclose(w.ch1)\n</code></pre>\n\n<p>And in your \"copy the channel\" function:</p>\n\n<pre><code>func (w *waiter) recv1Block() chan struct{} {\n    ch := make(chan struct{})\n    go func() {\n        for m := range w.ch1 {\n            ch &lt;- m\n        }\n        close(ch)\n    }()\n    return ch\n}\n</code></pre>\n\n<p>This also means that you don't need to run the main loop by \"dead reckoning\", expecting it to produce exactly 100 items then stop; you can stop whenever its channel exits.  The consumer loop I show above does this.</p>\n"}], "owner": {"reputation": 11, "user_id": 9317007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82682cd59a637c7a153131f4f1d80193?s=128&d=identicon&r=PG", "display_name": "johncming", "link": "https://stackoverflow.com/users/9317007/johncming"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 54192072, "answer_count": 1, "score": 0, "last_activity_date": 1547520479, "creation_date": 1547515626, "question_id": 54191527, "link": "https://stackoverflow.com/questions/54191527/channel-has-a-strange-behaviorior-why-block", "title": "Channel has a strange behaviorior, why block?", "body": "<p>go version go1.11.4 darwin/amd64</p>\n\n<p>A new channel and goroutine were created, and the content of the old channel was transferred to the new channel through goroutine. It should not block, but after testing, it was found to be blocked.</p>\n\n<p>thanks.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type waiter struct {\n    ch1   chan struct{}\n    ch2   &lt;-chan time.Time\n    limit int\n    count int\n}\n\nfunc (w *waiter) recv1Block() chan struct{} {\n    ch := make(chan struct{})\n    go func() {\n        for m := range w.ch1 {\n            ch &lt;- m\n        }\n    }()\n    return ch\n}\n\nfunc (w *waiter) runBlock(wg *sync.WaitGroup) {\n    defer wg.Done()\n\n    i := 0\n    for i &lt; w.limit {\n        select {\n        case &lt;-w.recv1Block():  **// why block here?**\n            i++\n        case &lt;-w.recv2():\n        }\n    }\n    w.count = i\n}\n</code></pre>\n\n<p>why <code>recv1Block</code> will be block.</p>\n"}, {"tags": ["go", "directory"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": -1, "last_activity_date": 1547519484, "last_edit_date": 1547519484, "creation_date": 1547518136, "answer_id": 54191817, "question_id": 54191366, "link": "https://stackoverflow.com/questions/54191366/i-get-a-segmentation-violation-when-accessing-a-mounted-directory/54191817#54191817", "title": "I get a segmentation violation when accessing a mounted directory", "body": "<blockquote>\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n</code></pre>\n</blockquote>\n\n<p>Start with the documentation:</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/path/filepath/\" rel=\"nofollow noreferrer\">Package filepath</a></p>\n  \n  <p>import \"path/filepath\" </p>\n  \n  <p><a href=\"https://golang.org/pkg/path/filepath/#WalkFunc\" rel=\"nofollow noreferrer\">type WalkFunc</a></p>\n  \n  <p>In the case of an error, the <code>info</code> argument will be <code>nil</code>.</p>\n\n<pre><code>type WalkFunc func(path string, info os.FileInfo, err error) error\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 46, "user_id": 7442483, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/200cc871f9e5bbe63e5b6e4e541d88e7?s=128&d=identicon&r=PG&f=1", "display_name": "Slo Learner", "link": "https://stackoverflow.com/users/7442483/slo-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547519484, "creation_date": 1547514149, "question_id": 54191366, "link": "https://stackoverflow.com/questions/54191366/i-get-a-segmentation-violation-when-accessing-a-mounted-directory", "title": "I get a segmentation violation when accessing a mounted directory", "body": "<p>segmentation violation code=0x1 error when accessing mounted network share</p>\n\n<p>Ubuntu server running a golang applicaiton (PwnDelorian) crashes.  Checked permissions of directory, everything seems fine there.</p>\n\n<pre><code>        fileList := []FileStruct{}\n        err := filepath.Walk(dir, func(path string, f os.FileInfo, err error) error {\n                fileList = append(fileList, FileStruct{f.Name(), path})\n                return nil\n        })\n        if err != nil {\n                return nil, err\n        }\n        return fileList, nil\n}\n\n&gt; panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x30 pc=0x6482bf]\n\n&gt;goroutine 1 [running]:\nmain.getAllFilesInDirectory.func1(0xc42031d950, 0x49, 0x0, 0x0, 0x71ea20, 0xc4202ba990, 0x0, 0x0)\n        /home/jim/go/src/PwnDelorean/filesystem.go:42 +0x2f\npath/filepath.walk(0xc42030fa80, 0x3c, 0x721ec0, 0xc420357930, 0xc42009b730, 0x0, 0x0)\n        /usr/lib/go-1.10/src/path/filepath/path.go:377 +0x20d\npath/filepath.walk(0xc42033eab0, 0x24, 0x721ec0, 0xc420356c30, 0xc42009b730, 0x0, 0x0)\n        /usr/lib/go-1.10/src/path/filepath/path.go:381 +0x2c2\npath/filepath.walk(0xc420313260, 0x16, 0x721ec0, 0xc420356820, 0xc42009b730, 0x0, 0x0)\n        /usr/lib/go-1.10/src/path/filepath/path.go:381 +0x2c2\npath/filepath.walk(0x7ffd2448320a, 0x11, 0x721ec0, 0xc4200a1d40, 0xc42009b730, 0x0, 0x10)\n        /usr/lib/go-1.10/src/path/filepath/path.go:381 +0x2c2\npath/filepath.Walk(0x7ffd2448320a, 0x11, 0xc42009b730, 0x0, 0x4982c4)\n        /usr/lib/go-1.10/src/path/filepath/path.go:403 +0x106\nmain.getAllFilesInDirectory(0x7ffd2448320a, 0x11, 0x11, 0x0, 0xc4200a1ba0, 0xc42006bdf0, 0x497b5d)\n        /home/jim/go/src/PwnDelorean/filesystem.go:41 +0xc4\nmain.startFileSystemScan()\n        /home/jim/go/src/PwnDelorean/filesystem.go:129 +0x4e\nmain.main()\n        /home/jim/go/src/PwnDelorean/main.go:136 +0x91\n\n\n\n\n</code></pre>\n"}, {"tags": ["go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 449, "user_id": 4986798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/625e6675083855baac5405d6c88af52d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/4986798/michael"}, "edited": false, "score": 0, "creation_date": 1547517213, "post_id": 54191615, "comment_id": 95211168, "body": "Yup, I was over-complicating it. Thank you!"}, {"owner": {"reputation": 449, "user_id": 4986798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/625e6675083855baac5405d6c88af52d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/4986798/michael"}, "edited": false, "score": 0, "creation_date": 1547517373, "post_id": 54191615, "comment_id": 95211212, "body": "Just to be complete though, you need to throw an Addr() call between FieldByName and Interface due to the pointer receiver."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1547517675, "last_edit_date": 1547517675, "creation_date": 1547516417, "answer_id": 54191615, "question_id": 54191322, "link": "https://stackoverflow.com/questions/54191322/go-reflect-field-name-to-specific-interface/54191615#54191615", "title": "Go Reflect field name to specific interface", "body": "<p>Use this code:</p>\n\n<pre><code>func renderField(name string, f *First) {\n    structVal := reflect.ValueOf(f).Elem()\n    field := structVal.FieldByName(name).Addr().Interface()\n    if renderer, ok := field.(Renderer); ok {\n        renderer.Render()\n    }\n}\n</code></pre>\n\n<p>The key point is to change:</p>\n\n<pre><code>structVal := reflect.ValueOf(*f)\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>structVal := reflect.ValueOf(f).Elem()\n</code></pre>\n\n<p>The statement used in the question creates a non-addressable struct value. The fields in a non-addressable struct are also not addressable, therefore it's not possible to access the pointer receiver on the fields.</p>\n\n<p>The statement used in this answer creates an addressable struct value.</p>\n"}], "owner": {"reputation": 449, "user_id": 4986798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/625e6675083855baac5405d6c88af52d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/4986798/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 797, "favorite_count": 0, "accepted_answer_id": 54191615, "answer_count": 1, "score": 0, "last_activity_date": 1547517675, "creation_date": 1547513794, "last_edit_date": 1547515203, "question_id": 54191322, "link": "https://stackoverflow.com/questions/54191322/go-reflect-field-name-to-specific-interface", "title": "Go Reflect field name to specific interface", "body": "<p>I have a struct type with a number of fields that all implement a Renderer interface. The field types implement the interface with pointer receivers. I would like to have a function that takes the field name and calls the Render method on that field. I am able to locate the field and get lots of information about it, but doing the type assertion seems to be biting me because of the pointer receivers. Here's some code that shows my problem:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Renderer interface {\n    Render()\n}\n\ntype First struct {\n    ExampleField Field\n}\n\ntype Field []int\n\nfunc (f *Field) Render() {\n    fmt.Println(\"Hello from first\")\n}\n\nfunc main() {\n    f := First{\n        Field{1, 2, 3},\n    }\n    f.ExampleField.Render()\n    renderField(\"ExampleField\", &amp;f)\n    renderField2(\"ExampleField\", &amp;f)\n}\n\nfunc renderField(field string, f *First) {\n    structVal := reflect.ValueOf(*f)\n    renderType := reflect.TypeOf((*Renderer)(nil)).Elem()\n    fieldToRender := structVal.FieldByName(field)\n    fieldPtr := reflect.PtrTo(fieldToRender.Type())\n    fmt.Printf(\"Implements? %v\\n\", fieldPtr.Implements(renderType))\n    fmt.Printf(\"Addressable? %v\\n\", fieldToRender.CanAddr())\n    fieldInter := fieldToRender.Interface()\n    if renderer, ok := fieldInter.(Renderer); ok {\n        // Pointer receiver so this never gets called\n        fmt.Print(\"Able to cast\")\n        renderer.Render()\n    }\n}\n\nfunc renderField2(field string, f *First) {\n    structVal := reflect.ValueOf(*f)\n    fieldToRender := structVal.FieldByName(field)\n    vp := reflect.New(reflect.TypeOf(fieldToRender))\n    vp.Elem().Set(reflect.ValueOf(fieldToRender))\n    vpAddr := vp.Elem().Addr()\n    typeVal := vpAddr.Interface()\n    fmt.Println(typeVal) // &lt;main.Field Value&gt;\u23ce\n    renderer := typeVal.(Renderer)\n    renderer.Render()\n    // interface conversion: *reflect.Value is not main.Renderer: missing method Render\n}\n</code></pre>\n\n<p>renderField2 seems to get me close but Addr() gives me a *Reflect.Value and when I call Interface() that seems to be the underlying type instead. If I switch to a non-pointer receiver then the first function works. I found <a href=\"https://stackoverflow.com/questions/50163955/reflect-value-interface-and-pointer-receiver\">reflect value Interface and pointer receiver</a> which seems to be almost exactly what I'm asking, and the question is answered but if I actually call the isZeroer method presented in the playground link it's always false so it doesn't actually seem to answer the question.</p>\n\n<p>It seems like <a href=\"https://golang.org/pkg/reflect/#Value.Addr\" rel=\"nofollow noreferrer\">Addr</a> is the key because it specifically mentions pointer receivers but I'm struggling to coerce it back into an interface.</p>\n"}, {"tags": ["docker", "go", "cgroups"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1547511793, "post_id": 54191055, "comment_id": 95210099, "body": "Each OS is different. If you&#39;re interested in how it&#39;s actually done, wouldn&#39;t that be answered simply by looking at the source that sets the cpu count? It&#39;s not worth linking and copying the current source, since that changes over time."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1547515875, "creation_date": 1547515875, "answer_id": 54191558, "question_id": 54191055, "link": "https://stackoverflow.com/questions/54191055/how-is-gomaxprocs-determined-on-different-platforms-and-inside-containers/54191558#54191558", "title": "How is GOMAXPROCS determined on different platforms and inside containers?", "body": "<p>Go <code>GOMAXPROCS</code> is a function of the number of CPUs. The number of CPUs is a function of the processor architecture: 386, amd64, arm, arm64, mips64, ppc64, s390, etc, The operating system provides an interface to the hardware: Linux, OpenBSD, Mac OS, etc. On Linux, we have <code>SYS_sched_getaffinity</code>.</p>\n\n<p>See <a href=\"https://go.googlesource.com/go\" rel=\"nofollow noreferrer\">Go source code</a> in <code>src/runtime</code>.</p>\n\n<p>See Linux documentation command <code>man sched_getaffinity</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547524078, "post_id": 54191992, "comment_id": 95212439, "body": "I don\u2019t get the point of the \u201cfinding the file\u201d section. The build constraints are in the filename, so why go through all that trouble to confirm what the toolchain is documented to do?"}, {"owner": {"reputation": 1030, "user_id": 9959748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Z5r3.jpg?s=128&g=1", "display_name": "celicoo", "link": "https://stackoverflow.com/users/9959748/celicoo"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547525542, "post_id": 54191992, "comment_id": 95212741, "body": "@JimB I agree, it was cumbersome and with a lot of unnecessary information, thank you for pointing that out. I updated my answer - less is more :D."}, {"owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "edited": false, "score": 0, "creation_date": 1547572451, "post_id": 54191992, "comment_id": 95234297, "body": "I was hoping the answer can link to some of the implementations directly or explain them. The reason I asked this is so that there\u2019s some explanation on the internet and not everyone has to dive into the runtime pkg source."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "edited": false, "score": 0, "creation_date": 1547594225, "post_id": 54191992, "comment_id": 95243069, "body": "@AhmetB-Google: then you need to ask a specific question about what you don&#39;t understand. We can&#39;t go through and explain every single aspect of the syscalls. Do you want a call by call explanation of the linux <code>sched_getaffinity</code> assembly? Do you want to know what <code>sysctl</code> is? Do you want to know how the windows loader sets up the <code>_GetProcessAffinityMask</code> syscall? They&#39;re all very different."}, {"owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "edited": false, "score": 0, "creation_date": 1547858506, "post_id": 54191992, "comment_id": 95350368, "body": "Yes this is my bad, I was asking for the actual syscalls or other methods Go use to find numprocs."}], "tags": [], "owner": {"reputation": 1030, "user_id": 9959748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Z5r3.jpg?s=128&g=1", "display_name": "celicoo", "link": "https://stackoverflow.com/users/9959748/celicoo"}, "is_accepted": false, "score": 3, "last_activity_date": 1547525874, "last_edit_date": 1547525874, "creation_date": 1547519805, "answer_id": 54191992, "question_id": 54191055, "link": "https://stackoverflow.com/questions/54191055/how-is-gomaxprocs-determined-on-different-platforms-and-inside-containers/54191992#54191992", "title": "How is GOMAXPROCS determined on different platforms and inside containers?", "body": "<p>The number of CPUs is evaluated at running time, and it is OS dependent. If you take a look inside the Go runtime package, you will see many files with \npostfixes related to OS and architecture names:</p>\n\n<ul>\n<li><a href=\"https://github.com/golang/go/blob/master/src/runtime/os_freebsd.go\" rel=\"nofollow noreferrer\">FreeBSD</a></li>\n<li><a href=\"https://github.com/golang/go/blob/master/src/runtime/os_darwin.go\" rel=\"nofollow noreferrer\">Darwin</a></li>\n<li><a href=\"https://github.com/golang/go/blob/master/src/runtime/os_plan9.go\" rel=\"nofollow noreferrer\">Plan9</a></li>\n<li><a href=\"https://github.com/golang/go/blob/master/src/runtime/os_openbsd.go\" rel=\"nofollow noreferrer\">OpenBSD</a></li>\n<li><a href=\"https://github.com/golang/go/blob/master/src/runtime/os_linux.go\" rel=\"nofollow noreferrer\">Linux</a></li>\n<li><a href=\"https://github.com/golang/go/blob/master/src/runtime/os_nacl.go\" rel=\"nofollow noreferrer\">Google Native\nClient</a></li>\n<li><a href=\"https://github.com/golang/go/blob/master/src/runtime/os_windows.go\" rel=\"nofollow noreferrer\">Windows</a></li>\n<li><a href=\"https://github.com/golang/go/blob/master/src/runtime/os_netbsd.go\" rel=\"nofollow noreferrer\">NetBSD</a></li>\n<li><a href=\"https://github.com/golang/go/blob/master/src/runtime/os3_solaris.go\" rel=\"nofollow noreferrer\">Solaris</a></li>\n<li><a href=\"https://github.com/golang/go/blob/master/src/runtime/os_dragonfly.go\" rel=\"nofollow noreferrer\">DragonFly\nBSD</a></li>\n</ul>\n\n<p>When a Go program is built, only the right runtime file that corresponds to the current OS and architecture is included. The number of CPUs will then be evaluated by the function <code>getncpu</code>.</p>\n"}], "owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 825, "favorite_count": 1, "accepted_answer_id": 54191558, "answer_count": 2, "score": 1, "last_activity_date": 1547525874, "creation_date": 1547511301, "question_id": 54191055, "link": "https://stackoverflow.com/questions/54191055/how-is-gomaxprocs-determined-on-different-platforms-and-inside-containers", "title": "How is GOMAXPROCS determined on different platforms and inside containers?", "body": "<p>I am curious how does Go runtime determine <code>runtime.NumCPU()</code> (count of CPUs) on various platforms with wildly different characteristics like Linux, macOS and Windows?</p>\n\n<p>For example on Linux: I'm curious if it uses sysfs (/sys) to look at paths like <code>/sys/fs/cgroup/cpu/cpu.cfs_quota_us</code> to determine how many CPUs exist, or  procfs (<code>/proc/cpuinfo</code>) (this will be the wrong value in a container environment where container may have access to fewer CPUs than the host CPU count exposed in this file).</p>\n\n<p>Similarly on macOS, how is this value determined?</p>\n\n<p>I know some applications like JVM relies on cgroups memory info exposed on  /sys to set their internal heap size etc.</p>\n"}, {"tags": ["go", "video-streaming", "reverse-proxy", "httpresponse"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 6600691, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3y0-OaSg5yE/AAAAAAAAAAI/AAAAAAAAAB4/_C0vX8l_dHg/photo.jpg?sz=128", "display_name": "Riley J", "link": "https://stackoverflow.com/users/6600691/riley-j"}, "edited": false, "score": 0, "creation_date": 1547504648, "post_id": 54188965, "comment_id": 95208292, "body": "Sorry, this totally works, as does everything else normally; I&#39;m running the two services in docker containers and it looks like docker-compose is the issue in some way. Thank you for your time!"}], "tags": [], "owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "is_accepted": true, "score": 0, "last_activity_date": 1547498950, "creation_date": 1547498950, "answer_id": 54188965, "question_id": 54186954, "link": "https://stackoverflow.com/questions/54186954/make-httputil-reverseproxy-foward-response-stream-correctly/54188965#54188965", "title": "Make httputil.ReverseProxy Foward Response Stream Correctly", "body": "<p>Do you get the same results when using:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"net/http/httputil\"\n    \"net/url\"\n)\n\nfunc main() {\n    u, err := url.Parse(\"http://localhost:8080/asdfasdf\")\n    if err != nil {\n        log.Fatal(\"url.Parse: %v\", err)\n    }\n\n    proxy := httputil.NewSingleHostReverseProxy(u)\n\n    log.Printf(\"Listening at :8081\")\n    if err := http.ListenAndServe(\":8081\", proxy); err != nil {\n        log.Fatal(\"ListenAndServe: %v\", err)\n    }\n}\n</code></pre>\n\n<p>Ultimately these are the same implementation under the hood, but the director provided here ensures that some of the expected headers exist that you will need for some proxy features to function as expected.</p>\n"}], "owner": {"reputation": 3, "user_id": 6600691, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3y0-OaSg5yE/AAAAAAAAAAI/AAAAAAAAAB4/_C0vX8l_dHg/photo.jpg?sz=128", "display_name": "Riley J", "link": "https://stackoverflow.com/users/6600691/riley-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 54188965, "answer_count": 1, "score": 0, "last_activity_date": 1547498950, "creation_date": 1547489417, "last_edit_date": 1547495676, "question_id": 54186954, "link": "https://stackoverflow.com/questions/54186954/make-httputil-reverseproxy-foward-response-stream-correctly", "title": "Make httputil.ReverseProxy Foward Response Stream Correctly", "body": "<p>I have reverse proxies in my main web-server that are dedicated to a certain micro-service and handle forward requests to their appropriate micro-services.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func newTrimPrefixReverseProxy(target *url.URL, prefix string) *httputil.ReverseProxy {\n    director := func(req *http.Request) {\n        // ... trims prefix from request path and prepends the path of the target url\n    }\n\n    return &amp;httputil.ReverseProxy{Director: director}\n}\n</code></pre>\n\n<p>This has worked perfectly for pure JSON responses, but I have ran into issues recently when trying to serve content (stream responses) through the reverse proxy. The means for serving the content is irrelevant, the (video) content is served as intended when the service is accessed directly and not through the reverse proxy.</p>\n\n<p>Serving the content:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    http.ServeContent(w, r, \"video.mp4\", time.Now().Add(time.Hour*24*365*12*9*-1), videoReadSeeker)\n})\n</code></pre>\n\n<p>Again, the videoReadSeeker and how the content is served is not the issue, the issue is having my response relayed as intended to the requester through the reverse proxy; when accessing the service directly, the video shows up and I can scrub it to my heart's content.</p>\n\n<p>Note that the response for data the content is received (http status, headers), but the content stream in the response body is not.</p>\n\n<p>How can I make sure that the reverse proxy handles streamed responses as intended for the content?</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 14274, "user_id": 579078, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/xC5kj.png?s=128&g=1", "display_name": "\u11bc\u11ba\u11bc", "link": "https://stackoverflow.com/users/579078/%e1%86%bc%e1%86%ba%e1%86%bc"}, "edited": false, "score": 0, "creation_date": 1547471158, "post_id": 54182019, "comment_id": 95192413, "body": "You are declaring <code>$temp</code> twice (<code>:=</code>). Use <code>=</code> for assignment on the second line"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1547471172, "post_id": 54182019, "comment_id": 95192420, "body": "Redeclared variable with <code>:=</code>.  See <a href=\"https://golang.org/pkg/text/template/#hdr-Variables\" rel=\"nofollow noreferrer\">golang.org/pkg/text/template/#hdr-Variables</a>. Totally unrelated to time or date."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547472480, "post_id": 54182019, "comment_id": 95193120, "body": "&quot;Doesn&#39;t work&quot; isn&#39;t a problem statement. What error do you see?"}], "answers": [{"comments": [{"owner": {"reputation": 1318, "user_id": 3177186, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/374675543dcada464668ba2bd9539adf?s=128&d=identicon&r=PG&f=1", "display_name": "not_a_generic_user", "link": "https://stackoverflow.com/users/3177186/not-a-generic-user"}, "edited": false, "score": 0, "creation_date": 1547472815, "post_id": 54182261, "comment_id": 95193326, "body": "Superb. Thank you for the clarification on assignments and also how to properly call  functions. Clearly, I have a lot to learn about this syntax."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1547472824, "last_edit_date": 1592644375, "creation_date": 1547471650, "answer_id": 54182261, "question_id": 54182019, "link": "https://stackoverflow.com/questions/54182019/cant-add-time-to-date-in-google-go-without-parse-error/54182261#54182261", "title": "Can&#39;t add time to date in Google go without parse error", "body": "<p>At first it may seem the problem is due to using <code>:=</code> syntax on an already existing variable, but that is not a problem, as this example illustrates:</p>\n<pre><code>t := template.Must(template.New(&quot;&quot;).Parse(`{{$temp := &quot;aa&quot;}}{{$temp}}\n{{$temp := &quot;bb&quot;}}{{$temp}}`))\n\nfmt.Println(t.Execute(os.Stdout, nil))\n</code></pre>\n<p>Which outputs (try it on the <a href=\"https://play.golang.org/p/W5D7ENdwW_1\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>aa\nbb&lt;nil&gt;\n</code></pre>\n<p>But of course, if the variable already exists, you should use the <code>=</code> assignment, because the <code>:=</code> will create a new variable, which if happens inside another block (e.g. <code>{{range}}</code> or <code>{{if}}</code>), the changed value will not remain outside the block.</p>\n<p><strong>The real problem is the function calling syntax:</strong></p>\n<pre><code>{{ $temp := $temp.AddDate(0,-1,0) }}\n</code></pre>\n<p>In Go templates you can't use the normal call syntax, you just have to enumerate the arguments, white-space separated, e.g.:</p>\n<pre><code>{{ $temp = $temp.AddDate 0 -1 0 }}\n</code></pre>\n<p>The error returned by <a href=\"https://golang.org/pkg/text/template/#Template.Execute\" rel=\"nofollow noreferrer\"><code>Template.Execute()</code></a> indicates this:</p>\n<pre><code>panic: template: :3: unexpected &quot;(&quot; in operand\n</code></pre>\n<p>This is detailed at <a href=\"https://golang.org/pkg/text/template/#hdr-Pipelines\" rel=\"nofollow noreferrer\"><code>template/Pipelines</code></a>:</p>\n<blockquote>\n<p>A command is a simple value (argument) or a function or method call, possibly with multiple arguments:</p>\n<pre><code>Argument\n     The result is the value of evaluating the argument.\n.Method [Argument...]\n     The method can be alone or the last element of a chain but,\n     unlike methods in the middle of a chain, it can take arguments.\n     The result is the value of calling the method with the\n     arguments:\n         dot.Method(Argument1, etc.)\nfunctionName [Argument...]\n     The result is the value of calling the function associated\n     with the name:\n         function(Argument1, etc.)\n     Functions and function names are described below.\n</code></pre>\n</blockquote>\n<p>Example:</p>\n<pre><code>t := template.Must(template.New(&quot;&quot;).Funcs(template.FuncMap{\n    &quot;now&quot;: time.Now,\n}).Parse(`{{$temp := now}}\n{{$temp}}\n{{$temp = $temp.AddDate 0 -1 0}}\n{{$temp}}`))\n\nfmt.Println(t.Execute(os.Stdout, nil))\n</code></pre>\n<p>Output (try it on the <a href=\"https://play.golang.org/p/jRmJ6jc6gdA\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>2009-11-10 23:00:00 &amp;#43;0000 UTC m=&amp;#43;0.000000001\n\n2009-10-10 23:00:00 &amp;#43;0000 UTC&lt;nil&gt;\n</code></pre>\n"}], "owner": {"reputation": 1318, "user_id": 3177186, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/374675543dcada464668ba2bd9539adf?s=128&d=identicon&r=PG&f=1", "display_name": "not_a_generic_user", "link": "https://stackoverflow.com/users/3177186/not-a-generic-user"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 54182261, "answer_count": 1, "score": -3, "last_activity_date": 1547472824, "creation_date": 1547470768, "last_edit_date": 1547471023, "question_id": 54182019, "link": "https://stackoverflow.com/questions/54182019/cant-add-time-to-date-in-google-go-without-parse-error", "title": "Can&#39;t add time to date in Google go without parse error", "body": "<p>Works:</p>\n\n<pre><code>{{ $temp := timestampToDate $var.date }}\n{{ $temp.Format 2006/01/02 }}\n</code></pre>\n\n<p>Doesn't work</p>\n\n<pre><code>{{ $temp := timestampToDate $var.date }}\n{{ $temp := $temp.AddDate(0,-1,0) }}    \n{{ $temp.Format 2006/01/02 }}\n</code></pre>\n\n<p>It says it can't parse the file with the second line but what's the issue? I'm using the command correctly as far as I can see.</p>\n"}, {"tags": ["go", "recursion", "mutex", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 1, "last_activity_date": 1547477126, "last_edit_date": 1547477126, "creation_date": 1547472057, "answer_id": 54182364, "question_id": 54182018, "link": "https://stackoverflow.com/questions/54182018/how-to-set-mutex-and-sync-waitgroup-in-recursive-function/54182364#54182364", "title": "How to set mutex and sync.waitgroup in recursive function?", "body": "<p>There is nothing inherently special about recursion w.r.t. mutexes, wait groups or other objects. It's the same as any function call. Since mutexes are mutable, you have to be careful to pass them around by pointers - and that should be that. To debug this it's often useful to printf the address of the object in caller and callee and ensure they're the same object.</p>\n\n<p>To get more specific help with your code snippet, I'd suggest you minimize it to something much simpler that demonstrates your problem: <a href=\"https://stackoverflow.com/help/mcve\">https://stackoverflow.com/help/mcve</a></p>\n\n<p>From a quick look at your code, each call to <code>parseLink</code> creates a new mutex and wait group, is this what you intended?</p>\n"}], "owner": {"reputation": 11, "user_id": 7317750, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wmsAoczdUnI/AAAAAAAAAAI/AAAAAAAAJD8/AKK0T7AZSJk/photo.jpg?sz=128", "display_name": "Samuel Simonney", "link": "https://stackoverflow.com/users/7317750/samuel-simonney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 316, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547502647, "creation_date": 1547470767, "question_id": 54182018, "link": "https://stackoverflow.com/questions/54182018/how-to-set-mutex-and-sync-waitgroup-in-recursive-function", "title": "How to set mutex and sync.waitgroup in recursive function?", "body": "<p>I wrote a little code in Go to parse a site and retrieve all link and their Http Response. My code works well but I would like to add GoRoutines to see how it works in recursive function.</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"regexp\"\n    \"strings\"\n    \"sync\"\n)\n\ntype linkWeb struct {\n    Link string\n    Code string\n}\n\nfunc parseLink(siteName string, arrayError []linkWeb) (arrayResult []linkWeb) {\n    var mutex = &amp;sync.Mutex{}\n    var wg = sync.WaitGroup{}\n    var baseSite = siteName\n    site, _ := http.Get(baseSite)\n    html, _ := ioutil.ReadAll(site.Body)\n    errorCodeHTTP := site.Status\n    mutex.Lock()\n    errorArray := arrayError\n    mutex.Unlock()\n    allJs := regexp.MustCompile(`src=\"[^\"]*\"+`)\n    allA := regexp.MustCompile(`(.)*href=\"[^\"]*\"+`)\n    var resultsJs = allJs.FindAllStringSubmatch(string(html), -1)\n    var resultUrls = allA.FindAllStringSubmatch(string(html), -1)\n    resultsJs = append(resultsJs, resultUrls...)\n    for _, linkJs := range resultsJs {\n        wg.Add(1)\n        go func() {\n            re := regexp.MustCompile(`(href|src)(.)*=\"[^\"]*\"`)\n            var execReg = re.FindAllStringSubmatch(linkJs[0], -1)\n            link := regexp.MustCompile(`\"(.)*\"`)\n            var linkCenter = link.FindAllStringSubmatch(execReg[0][0], -1)\n            resultrmvbefore := strings.TrimPrefix(linkCenter[0][0], \"\\\"\")\n            resultrmvafter := strings.TrimSuffix(resultrmvbefore, \"\\\"\")\n            var already = 0\n            mutex.Lock()\n            for _, itemURL := range errorArray {\n                if resultrmvafter == itemURL.Link {\n                    already = 1\n                }\n            }\n            mutex.Unlock()\n            if already == 0{\n                var actualState = linkWeb{resultrmvafter, \"-&gt; \" + errorCodeHTTP + \"\\r\\n\"}\n                mutex.Lock()\n                errorArray = append(errorArray, actualState)\n                mutex.Unlock()\n                return\n            } else {\n                if already == 0 {\n                    var actualState = linkWeb{resultrmvafter, \"-&gt; \" + errorCodeHTTP + \"\\r\\n\"}\n                    mutex.Lock()\n                    errorArray = append(errorArray, actualState)\n                    var arrayReturn = errorArray\n                    mutex.Unlock()\n                    parseLink(resultrmvafter, arrayReturn)\n                }\n            }\n            wg.Done()\n        }()\n    }\n    wg.Wait()\n    return\n}\nfunc main() {\n    var arrayError []linkWeb\n    var resultArray = parseLink(\"https://www.golem.ai/\", arrayError)\n}\n</code></pre>\n\n<p>I just don't know if it's necessary to pass my syncGroup as a function parameter because I made a test and I don't see any changes.\nI read the docs but I don't know if my problem is bound to my recursive function or something that I don't understand with Golang.\nThank you very much for your help :)</p>\n"}, {"tags": ["go", "cryptography", "x509"], "comments": [{"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 1, "creation_date": 1547469960, "post_id": 54181232, "comment_id": 95191789, "body": "A raw signature doesn&#39;t contain a certificate. It&#39;s just the statically sized, binary result of the modular exponentiation of the message hash + padding. If you want to include an X.509 certificate then you should look for an PKCS#7 / CMS / SMIME library (PKCS#7 is the standard, CMS - or Cryptographic Message Syntax - is the official name and SMIME is what it was designed for - secure mail). <a href=\"https://tools.ietf.org/html/rfc2315\" rel=\"nofollow noreferrer\">Here</a> is the RFC."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1547473100, "post_id": 54181232, "comment_id": 95193496, "body": "<a href=\"https://godoc.org/?q=pkcs7\" rel=\"nofollow noreferrer\">See also</a>"}], "owner": {"reputation": 53, "user_id": 8713562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db8cb7224289f3519097ba6a820723f0?s=128&d=identicon&r=PG&f=1", "display_name": "Daniyar Baitursynov", "link": "https://stackoverflow.com/users/8713562/daniyar-baitursynov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 630, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1547467545, "creation_date": 1547467545, "question_id": 54181232, "link": "https://stackoverflow.com/questions/54181232/golang-pkcs12-sign-with-inter-intermediate-certificate", "title": "Golang PKCS12 sign with inter intermediate certificate", "body": "<p>I have .p12 extension which contains certificate and passkey. Then I extract cert and key in PEM using these commands:</p>\n\n<pre><code>openssl pkcs12 -in &lt;filename&gt;.p12 -clcerts -nokeys -out passcertificate.pem -passin pass:&lt;password&gt;\n\nopenssl pkcs12 -in Certificates.p12 -nocerts -out passkey.pem -passin pass:&lt;password&gt; -passout pass:&lt;password_out&gt;\n</code></pre>\n\n<p>After all I sign file with private key and intermediate cert to get signature.</p>\n\n<pre><code>openssl smime -binary -sign -certfile &lt;intermediate&gt;.pem -signer passcertificate.pem -inkey passkey.pem -in manifest.json -out signature -outform DER -passin pass:&lt;password_out&gt;\n</code></pre>\n\n<p>Is this <strong>possible</strong> to reproduce these steps in Go using standard library?</p>\n\n<pre><code>// read file content to be signed\ncontent, err := ioutil.ReadFile(\".../path_to_file/manifest.json\")\nif err != nil {\n    //\n}\n// read .p12 file\nbuf, err := ioutil.ReadFile(\".../path_to_file/Certificate.p12\")\nif err != nil {\n    //\n}\n// extract key and cert\npk, cert, err := pkcs12.Decode(buf, password)\nif err != nil {\n    return err\n}\nprivateKey := pk.(*rsa.PrivateKey)\n// create hash\nh := crypto.SHA256.New()\n_, err = h.Write(content)\nif err != nil {\n    //\n}\nhashed := h.Sum(nil)\n// how to pass intermediate cert??\nsign, err := rsa.SignPKCS1v15(rand.Reader, privateKey, crypto.SHA256, \nhashed)\nif err != nil {\n    return err\n}\nsig := base64.RawURLEncoding.EncodeToString(sign)\n</code></pre>\n"}, {"tags": ["go", "dns"], "answers": [{"tags": [], "owner": {"reputation": 674, "user_id": 476372, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/790b2b4f6745a83ffc57216e43a609d7?s=128&d=identicon&r=PG", "display_name": "seduardo", "link": "https://stackoverflow.com/users/476372/seduardo"}, "is_accepted": false, "score": 0, "last_activity_date": 1547468288, "creation_date": 1547468288, "answer_id": 54181448, "question_id": 54180648, "link": "https://stackoverflow.com/questions/54180648/extracting-nameservers-from-domain-using-dnsutil-type-dns-rr-has-no-field-or-m/54181448#54181448", "title": "Extracting nameservers from domain using DNSutil | type dns.RR has no field or method Hdr", "body": "<p>to avoid compilation error change Hdr to Header()</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n\n    \"github.com/lixiangzhong/dnsutil\"\n)\n\nfunc main() {\n    var dig dnsutil.Dig\n    dig.SetDNS(\"8.8.4.4\")\n\n    res, _ := dig.Trace(\"example.com.\")\n    for _, nameservers := range res {\n        for _, ns := range nameservers.Msg.Ns {\n            json, _ := json.Marshal(ns)\n            fmt.Println(string(json))\n            fmt.Println(ns.Header().Name)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 2699750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/419f731b1ad246dea43da674aef11ca2?s=128&d=identicon&r=PG&f=1", "display_name": "Olivier", "link": "https://stackoverflow.com/users/2699750/olivier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1547468288, "creation_date": 1547465369, "question_id": 54180648, "link": "https://stackoverflow.com/questions/54180648/extracting-nameservers-from-domain-using-dnsutil-type-dns-rr-has-no-field-or-m", "title": "Extracting nameservers from domain using DNSutil | type dns.RR has no field or method Hdr", "body": "<p>I am trying to extract the nameservers from a DNS record using GoLang. The issue I'm walking into is that I'm unable to read the fields from a Struct.</p>\n\n<p>I'm turning the Response into JSON so I can \"read\" which fields it has, I'm using the following code for that:</p>\n\n<pre><code>json, _ := json.Marshal(ns)\nfmt.Println(string(json))\n</code></pre>\n\n<p>This prints out:</p>\n\n<pre><code>{\"Hdr\":{\"Name\":\"example.com.\",\"Rrtype\":2,\"Class\":1,\"Ttl\":172800,\"Rdlength\":16},\"Ns\":\"ns2.example.eu.\"}\n</code></pre>\n\n<p>Now when I try to read print out the Name value from this string using:</p>\n\n<pre><code>fmt.Println(ns.Hdr.Name)\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>./main.go:19:18: ns.Hdr undefined (type dns.RR has no field or method Hdr)\n</code></pre>\n\n<p>Could anyone help me to extract the Name (example.com.) from the Ns (Struct?).</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n\n    \"github.com/lixiangzhong/dnsutil\"\n)\n\nfunc main() {\n    var dig dnsutil.Dig\n    dig.SetDNS(\"8.8.4.4\")\n\n    res, _ := dig.Trace(\"example.com.\")\n    for _, nameservers := range res {\n        for _, ns := range nameservers.Msg.Ns {\n            json, _ := json.Marshal(ns)\n            fmt.Println(string(json))\n            fmt.Println(ns.Hdr.Name)\n        }\n    }\n}\n</code></pre>\n\n<p>I expected this to print out \"example.com.\" but instead I get an error.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "postman", "bearer-token", "go-gin"], "comments": [{"owner": {"reputation": 33, "user_id": 9590983, "user_type": "registered", "profile_image": "https://graph.facebook.com/1691291087629366/picture?type=large", "display_name": "Alex Colussi", "link": "https://stackoverflow.com/users/9590983/alex-colussi"}, "edited": false, "score": 0, "creation_date": 1547465654, "post_id": 54179909, "comment_id": 95189674, "body": "My question has already been answered here:  <a href=\"https://stackoverflow.com/questions/39518237/how-to-extract-and-verify-token-sent-from-frontend-in-golang\" title=\"how to extract and verify token sent from frontend in golang\">stackoverflow.com/questions/39518237/&hellip;</a>"}], "owner": {"reputation": 33, "user_id": 9590983, "user_type": "registered", "profile_image": "https://graph.facebook.com/1691291087629366/picture?type=large", "display_name": "Alex Colussi", "link": "https://stackoverflow.com/users/9590983/alex-colussi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2611, "favorite_count": 0, "closed_date": 1547469611, "answer_count": 0, "score": 0, "last_activity_date": 1547462521, "creation_date": 1547462521, "question_id": 54179909, "link": "https://stackoverflow.com/questions/54179909/how-to-get-a-header-request-authorization-bearer-with-gin-gonic", "closed_reason": "Duplicate", "title": "how to get a header request authorization (bearer) with gin gonic?", "body": "<p>I'm new at go language and I'm trying to read a bearer authorization in postman in go language and save as a string variable. </p>\n\n<pre><code>func ExampleParse(myToken string, myKey string) bool {\n//read bearer header auth from post man and store the variable and store in myToken\n\ntoken, err := jwt.Parse(myToken, func(token *jwt.Token) (interface{}, error) {\n    return []byte(myKey), nil\n})\n\nif err == nil &amp;&amp; token.Valid {\n    fmt.Println(\"Your token is valid.  I like your style.\")\n    return false\n} else {\n    fmt.Println(\"This token is terrible!  I cannot accept this.\")\n    return true\n}\n}\n</code></pre>\n\n<p>how can I read this request from post man and read the token send from an api to do compare this token sent using gin gonic??</p>\n"}, {"tags": ["go", "json-rpc"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1547462562, "post_id": 54179691, "comment_id": 95188143, "body": "I doubt you can."}], "answers": [{"comments": [{"owner": {"reputation": 115, "user_id": 3232153, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001484564745/picture?type=large", "display_name": "razielsd", "link": "https://stackoverflow.com/users/3232153/razielsd"}, "edited": false, "score": 0, "creation_date": 1547540625, "post_id": 54187086, "comment_id": 95216980, "body": "it&#39;s not working or me wrong doing:  <a href=\"https://pastebin.com/qKkGTuNw\" rel=\"nofollow noreferrer\">pastebin.com/qKkGTuNw</a>   curl -X POST -H &quot;Content-Type: application/json&quot; -d &#39;{&quot;id&quot;: 1, &quot;method&quot;: &quot;Arith.multiply&quot;, &quot;params&quot;: [{&quot;A&quot;: 10, &quot;B&quot;: 30}]}&#39; <a href=\"http://127.0.0.1:1234/rpc\" rel=\"nofollow noreferrer\">127.0.0.1:1234/rpc</a> rpc: can&#39;t find method &quot;Arith.multiply&quot;"}, {"owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "reply_to_user": {"reputation": 115, "user_id": 3232153, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001484564745/picture?type=large", "display_name": "razielsd", "link": "https://stackoverflow.com/users/3232153/razielsd"}, "edited": false, "score": 0, "creation_date": 1547545344, "post_id": 54187086, "comment_id": 95219204, "body": "You have to use the exported (capitalised) method for the rpc call. The rpc packages can\u2019t access the unexported (lowercase) method."}, {"owner": {"reputation": 115, "user_id": 3232153, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001484564745/picture?type=large", "display_name": "razielsd", "link": "https://stackoverflow.com/users/3232153/razielsd"}, "edited": false, "score": 0, "creation_date": 1547546999, "post_id": 54187086, "comment_id": 95220101, "body": "i know it, but need reproduce api contract."}, {"owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "reply_to_user": {"reputation": 115, "user_id": 3232153, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001484564745/picture?type=large", "display_name": "razielsd", "link": "https://stackoverflow.com/users/3232153/razielsd"}, "edited": false, "score": 0, "creation_date": 1547547047, "post_id": 54187086, "comment_id": 95220129, "body": "is the api contract the lowercase method?"}, {"owner": {"reputation": 115, "user_id": 3232153, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001484564745/picture?type=large", "display_name": "razielsd", "link": "https://stackoverflow.com/users/3232153/razielsd"}, "edited": false, "score": 0, "creation_date": 1547549177, "post_id": 54187086, "comment_id": 95221277, "body": "Yes, lowercase :("}, {"owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "reply_to_user": {"reputation": 115, "user_id": 3232153, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001484564745/picture?type=large", "display_name": "razielsd", "link": "https://stackoverflow.com/users/3232153/razielsd"}, "edited": false, "score": 0, "creation_date": 1547761002, "post_id": 54187086, "comment_id": 95313804, "body": "OK I think I understand better. Check the updated answer"}], "tags": [], "owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "is_accepted": true, "score": 1, "last_activity_date": 1547760980, "last_edit_date": 1547760980, "creation_date": 1547490038, "answer_id": 54187086, "question_id": 54179691, "link": "https://stackoverflow.com/questions/54179691/jsonrpc-server-to-accept-requested-lowercase-method-names-intended-for-uppercas/54187086#54187086", "title": "jsonrpc server to accept requested lowercase method names (intended for uppercase registered services)", "body": "<p>It appears you can sneak something into a custom Codec to direct the lowercase method to the correct uppercase one. Compose a CodecRequest of the gorilla/rpc/json implementation and you can continue to use all of the gorilla machinery to process the request.</p>\n\n<p>Working example below. It looks long but it's all comments.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"strings\"\n    \"unicode\"\n    \"unicode/utf8\"\n\n    \"github.com/gorilla/mux\"\n    \"github.com/gorilla/rpc\"\n    \"github.com/gorilla/rpc/json\"\n)\n\ntype Args struct {\n    A, B int\n}\ntype Arith int\n\ntype Result int\n\nfunc (t *Arith) Multiply(r *http.Request, args *Args, result *Result) error {\n    log.Printf(\"Multiplying %d with %d\\n\", args.A, args.B)\n    *result = Result(args.A * args.B)\n    return nil\n}\n\n// UpCodec creates a CodecRequest to process each request.\ntype UpCodec struct {\n}\n\n// NewUpCodec returns a new UpCodec.\nfunc NewUpCodec() *UpCodec {\n    return &amp;UpCodec{}\n}\n\n// NewRequest returns a new CodecRequest of type UpCodecRequest.\nfunc (c *UpCodec) NewRequest(r *http.Request) rpc.CodecRequest {\n    outerCR := &amp;UpCodecRequest{}   // Our custom CR\n    jsonC := json.NewCodec()       // json Codec to create json CR\n    innerCR := jsonC.NewRequest(r) // create the json CR, sort of.\n\n    // NOTE - innerCR is of the interface type rpc.CodecRequest.\n    // Because innerCR is of the rpc.CR interface type, we need a\n    // type assertion in order to assign it to our struct field's type.\n    // We defined the source of the interface implementation here, so\n    // we can be confident that innerCR will be of the correct underlying type\n    outerCR.CodecRequest = innerCR.(*json.CodecRequest)\n    return outerCR\n}\n\n// UpCodecRequest decodes and encodes a single request. UpCodecRequest\n// implements gorilla/rpc.CodecRequest interface primarily by embedding\n// the CodecRequest from gorilla/rpc/json. By selectively adding\n// CodecRequest methods to UpCodecRequest, we can modify that behaviour\n// while maintaining all the other remaining CodecRequest methods from\n// gorilla's rpc/json implementation\ntype UpCodecRequest struct {\n    *json.CodecRequest\n}\n\n// Method returns the decoded method as a string of the form \"Service.Method\"\n// after checking for, and correcting a lowercase method name\n// By being of lower depth in the struct , Method will replace the implementation\n// of Method() on the embedded CodecRequest. Because the request data is part\n// of the embedded json.CodecRequest, and unexported, we have to get the\n// requested method name via the embedded CR's own method Method().\n// Essentially, this just intercepts the return value from the embedded\n// gorilla/rpc/json.CodecRequest.Method(), checks/modifies it, and passes it\n// on to the calling rpc server.\nfunc (c *UpCodecRequest) Method() (string, error) {\n    m, err := c.CodecRequest.Method()\n    if len(m) &gt; 1 &amp;&amp; err == nil {\n        parts := strings.Split(m, \".\")\n        service, method := parts[0], parts[1]\n        r, n := utf8.DecodeRuneInString(method) // get the first rune, and it's length\n        if unicode.IsLower(r) {\n            upMethod := service + \".\" + string(unicode.ToUpper(r)) + method[n:]\n            log.Printf(\"lowercase method %s requested: treated as %s\\n\", m, upMethod)\n            return upMethod, err\n        }\n    }\n    return m, err\n}\n\nfunc main() {\n    s := rpc.NewServer()\n\n    // Register our own Codec\n    s.RegisterCodec(NewUpCodec(), \"application/json\")\n    s.RegisterCodec(NewUpCodec(), \"application/json;charset=UTF-8\")\n\n    arith := new(Arith)\n    s.RegisterService(arith, \"\")\n    r := mux.NewRouter()\n    r.Handle(\"/rpc\", s)\n    fmt.Println(http.ListenAndServe(\":1234\", r))\n}\n</code></pre>\n\n<p>Call the method via:</p>\n\n<pre><code>curl -X POST -H \"Content-Type: application/json\" -d '{\"id\": 1, \"method\": \"Arith.multiply\", \"params\": [{\"A\": 10, \"B\": 30}]}' 127.0.0.1:1234/rpc\n</code></pre>\n"}], "owner": {"reputation": 115, "user_id": 3232153, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001484564745/picture?type=large", "display_name": "razielsd", "link": "https://stackoverflow.com/users/3232153/razielsd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 1, "accepted_answer_id": 54187086, "answer_count": 1, "score": 0, "last_activity_date": 1547773964, "creation_date": 1547461723, "last_edit_date": 1547773964, "question_id": 54179691, "link": "https://stackoverflow.com/questions/54179691/jsonrpc-server-to-accept-requested-lowercase-method-names-intended-for-uppercas", "title": "jsonrpc server to accept requested lowercase method names (intended for uppercase registered services)", "body": "<p>I'm trying to write a jsonrpc server that will accept requested method names in lower case, eg Arith.multiply, and correctly route them to the corresponding uppercase methed, e.g Arith.Multiply. Is this possible?</p>\n\n<p>P.S. It's lightweight clone of production server for testing, the API is fixed, including the lowercase method names, so I can't change requested method names to uppercase.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n    \"github.com/gorilla/rpc\"\n    \"github.com/gorilla/rpc/json\"\n)\n\ntype Args struct {\n    A, B int\n}\n\ntype Arith int\n\ntype Result int\n\nfunc (t *Arith) Multiply(r *http.Request, args *Args, result *Result) error {\n    log.Printf(\"Multiplying %d with %d\\n\", args.A, args.B)\n    *result = Result(args.A * args.B)\n    return nil\n}\n\nfunc main() {\n    s := rpc.NewServer()\n    s.RegisterCodec(json.NewCodec(), \"application/json\")\n    s.RegisterCodec(json.NewCodec(), \"application/json;charset=UTF-8\")\n    arith := new(Arith)\n    s.RegisterService(arith, \"\")\n\n    r := mux.NewRouter()\n    r.Handle(\"/rpc\", s)\n    http.ListenAndServe(\":1234\", r)\n}\n\n</code></pre>\n"}, {"tags": ["go", "goland"], "comments": [{"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1547461691, "post_id": 54179416, "comment_id": 95187688, "body": "I&#39;ve created this issue on the GoLand issue tracker <a href=\"https://youtrack.jetbrains.com/issue/GO-6711\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issue/GO-6711</a>"}, {"owner": {"reputation": 93, "user_id": 10744620, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d83403abf258d8a46464264a1837e33?s=128&d=identicon&r=PG&f=1", "display_name": "unilep", "link": "https://stackoverflow.com/users/10744620/unilep"}, "reply_to_user": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1547462066, "post_id": 54179416, "comment_id": 95187885, "body": "Is not that what I&#39;m doing wrong? Is it likely to be a problem with GoLand? Thanks."}, {"owner": {"reputation": 393, "user_id": 2664120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e396f6a7678066cf12a38350f80a3e?s=128&d=identicon&r=PG", "display_name": "Nordiii", "link": "https://stackoverflow.com/users/2664120/nordiii"}, "edited": false, "score": 2, "creation_date": 1547462222, "post_id": 54179416, "comment_id": 95187959, "body": "It&#39;s probably no problem with GoLand, it just flushes the stdout at a different time. when you add ` fflush( stdout ); ` after your printf call it should work like you think."}, {"owner": {"reputation": 93, "user_id": 10744620, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d83403abf258d8a46464264a1837e33?s=128&d=identicon&r=PG&f=1", "display_name": "unilep", "link": "https://stackoverflow.com/users/10744620/unilep"}, "edited": false, "score": 0, "creation_date": 1547464699, "post_id": 54179416, "comment_id": 95189222, "body": "you are right. It works as expected when apply fflush. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 1253, "user_id": 374356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ca70d640864e28a6a700bbf265a42e3?s=128&d=identicon&r=PG", "display_name": "neverov", "link": "https://stackoverflow.com/users/374356/neverov"}, "edited": false, "score": 0, "creation_date": 1548522952, "post_id": 54183648, "comment_id": 95574766, "body": "Eli, could you please explain why it works fine in shell? I was s/ltracing bash executing this program but cannot find any calls which disable buffering."}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 1253, "user_id": 374356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ca70d640864e28a6a700bbf265a42e3?s=128&d=identicon&r=PG", "display_name": "neverov", "link": "https://stackoverflow.com/users/374356/neverov"}, "edited": false, "score": 0, "creation_date": 1548556299, "post_id": 54183648, "comment_id": 95581960, "body": "@neverov: there is no defined order between them, it depends on many factors of how the streams are handled"}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 3, "last_activity_date": 1547477053, "creation_date": 1547477053, "answer_id": 54183648, "question_id": 54179416, "link": "https://stackoverflow.com/questions/54179416/c-language-function-execution-order-in-golang/54183648#54183648", "title": "c language function execution order in golang", "body": "<p>C's <code>printf</code> is implemented in libc, using lower level system calls. libc has buffers for I/O to improve performance, and it decides when to flush these buffers (specifically the stdout stream which <code>printf</code> emits to is buffered).</p>\n\n<p>Go has its own <code>printf</code> using lower level system calls, it doesn't uses C's <code>printf</code> or libc at all for this. Therefore its flushing decisions are separate from C's <code>printf</code>.</p>\n\n<p>So there's not problem here, really. <code>printf</code> doesn't guarantee unbuffered output (you can use the error stream for that, if necessary, of flush explicitly), so there is no guaranteed ordering between the C and Go versions.</p>\n"}], "owner": {"reputation": 93, "user_id": 10744620, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d83403abf258d8a46464264a1837e33?s=128&d=identicon&r=PG&f=1", "display_name": "unilep", "link": "https://stackoverflow.com/users/10744620/unilep"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 54183648, "answer_count": 1, "score": 2, "last_activity_date": 1547477053, "creation_date": 1547460789, "question_id": 54179416, "link": "https://stackoverflow.com/questions/54179416/c-language-function-execution-order-in-golang", "title": "c language function execution order in golang", "body": "<p>I am studying golang, but there is a part that I do not understand using c language.</p>\n\n<p>In main, the c language function is executed for the second time, and the output is different depending on the IDE.\nWhy does this print out?</p>\n\n<pre><code>package main\n\n//#include&lt;stdio.h&gt;\n//void callC() {\n// printf(\"Calling C code!\\n\");\n//}\nimport \"C\"\nimport \"fmt\"\n\n\nfunc main() {\n    fmt.Println(\"A Go statement\")\n    C.callC()\n    fmt.Println(\"Another Go statement\")\n}\n</code></pre>\n\n<p>-- <b>in GoLand (Template: go build with Run after build option)</b> --<br>\noutput)<br>\nA Go statement<br>\nAnother Go statement<br>\nCalling C code!<br>\n<br>\n-- <b>in terminal</b><br>\n$ go run hello.go<br>\nA Go statement<br>\nCalling C code!<br>\nAnother Go statement<br></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1547460302, "post_id": 54179128, "comment_id": 95186935, "body": "It depends on what T is and how the value is used.    Show the definition of T."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 2, "creation_date": 1547463873, "post_id": 54179128, "comment_id": 95188850, "body": "This is not a duplicate, this question is about how to properly use a sync.Pool. The other question is about allocation, a technical issue."}], "answers": [{"comments": [{"owner": {"reputation": 64, "user_id": 7170503, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L9ZY6.png?s=128&g=1", "display_name": "cncal", "link": "https://stackoverflow.com/users/7170503/cncal"}, "edited": false, "score": 1, "creation_date": 1547462505, "post_id": 54179255, "comment_id": 95188119, "body": "<a href=\"https://github.com/golang/go/issues/16323\" rel=\"nofollow noreferrer\">Here</a> is the similar issue on github, does it make sense?"}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 2, "last_activity_date": 1547464233, "last_edit_date": 1547464233, "creation_date": 1547460203, "answer_id": 54179255, "question_id": 54179128, "link": "https://stackoverflow.com/questions/54179128/is-it-necessary-to-return-pointer-type-in-sync-pool-new-function/54179255#54179255", "title": "Is it necessary to return pointer type in sync.Pool New function?", "body": "<p>It is not necessary. In most cases it should be a pointer as you want to share an object, not to make copies.</p>\n\n<p>In some use cases this can be a non pointer type, like an id of some external resource. I can imagine a pool of paths (mounted disk drives) represented with strings where some large file operations are being conducted.</p>\n"}, {"comments": [{"owner": {"reputation": 64, "user_id": 7170503, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L9ZY6.png?s=128&g=1", "display_name": "cncal", "link": "https://stackoverflow.com/users/7170503/cncal"}, "edited": false, "score": 0, "creation_date": 1547525223, "post_id": 54179259, "comment_id": 95212668, "body": "Why it would be copied on every step? I don&#39;t think it would do allocations when I  <b>Get</b> the existing instance (<code>T{}</code>) from the pool (Assuming GC not executed yet)."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 64, "user_id": 7170503, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L9ZY6.png?s=128&g=1", "display_name": "cncal", "link": "https://stackoverflow.com/users/7170503/cncal"}, "edited": false, "score": 1, "creation_date": 1547537477, "post_id": 54179259, "comment_id": 95215711, "body": "@cncal that&#39;s how value types work. They&#39;re copied. You won&#39;t get the object from the pool, you&#39;ll get its copy. For this very reason, if your method mutates your struct, it must have pointer receiver."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 64, "user_id": 7170503, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L9ZY6.png?s=128&g=1", "display_name": "cncal", "link": "https://stackoverflow.com/users/7170503/cncal"}, "edited": false, "score": 1, "creation_date": 1547537674, "post_id": 54179259, "comment_id": 95215806, "body": "@cncal: actually, everything in go is pass-by-value (pass-by-copy), I think. Only when your value is a pointer, you don&#39;t care that it&#39;s a copy (of another pointer)."}, {"owner": {"reputation": 64, "user_id": 7170503, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L9ZY6.png?s=128&g=1", "display_name": "cncal", "link": "https://stackoverflow.com/users/7170503/cncal"}, "edited": false, "score": 0, "creation_date": 1547538802, "post_id": 54179259, "comment_id": 95216257, "body": "I get it... :)."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1606121375, "post_id": 54179259, "comment_id": 114854009, "body": "What if T is a slice ? It&#39;s a small structure. It&#39;s not a problem to be copied. What is important is the buffer it references with a pointer. Nevertheless, if I pass a slice value, won&#39;t it be &quot;boxed&quot; due to the <code>interface{}</code> type ?"}], "tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": true, "score": 5, "last_activity_date": 1547468179, "last_edit_date": 1547468179, "creation_date": 1547460219, "answer_id": 54179259, "question_id": 54179128, "link": "https://stackoverflow.com/questions/54179128/is-it-necessary-to-return-pointer-type-in-sync-pool-new-function/54179259#54179259", "title": "Is it necessary to return pointer type in sync.Pool New function?", "body": "<p>The whole point of <code>sync.Pool</code> is to avoid (expensive) allocations. Large-ish buffers, etc. You allocate a few buffers and they stay in memory, available for reuse. Hence the use of pointers.</p>\n\n<p>But here you'll be copying the values on every step, defeating the purpose. (Assuming your <code>T</code> is a \"normal\" struct and not something like <code>SliceHeader</code>)</p>\n"}], "owner": {"reputation": 64, "user_id": 7170503, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L9ZY6.png?s=128&g=1", "display_name": "cncal", "link": "https://stackoverflow.com/users/7170503/cncal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 525, "favorite_count": 1, "accepted_answer_id": 54179259, "answer_count": 2, "score": 0, "last_activity_date": 1547470873, "creation_date": 1547459728, "last_edit_date": 1547463418, "question_id": 54179128, "link": "https://stackoverflow.com/questions/54179128/is-it-necessary-to-return-pointer-type-in-sync-pool-new-function", "title": "Is it necessary to return pointer type in sync.Pool New function?", "body": "<p>I saw the <a href=\"https://github.com/golang/go/issues/16323\" rel=\"nofollow noreferrer\">issue</a> on Github which says sync.Pool should be used <strong>only</strong> with pointer types, for example:</p>\n\n<pre><code>var TPool = sync.Pool{\n    New: func() interface{} {\n       return new(T)\n    },\n}\n</code></pre>\n\n<p>Does it make sense? What about <code>return T{}</code> and which is the better choice, why? </p>\n"}, {"tags": ["sql", "go", "sql-parser"], "comments": [{"owner": {"reputation": 2956, "user_id": 2207924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d97be4271939adcd1eec201cd777f57?s=128&d=identicon&r=PG", "display_name": "JeffUK", "link": "https://stackoverflow.com/users/2207924/jeffuk"}, "edited": false, "score": 1, "creation_date": 1547460670, "post_id": 54178905, "comment_id": 95187129, "body": "What do you mean by &#39;the actual table names&#39;?  A SQL String could contain an infinite number of tables involved in SELECT, joins, subqueries, unions, etc.etc.  do you just want a list of any table involved in the query?  Do you have example input and output?"}, {"owner": {"reputation": 47, "user_id": 10911030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QcpsD-GuOWA/AAAAAAAAAAI/AAAAAAAAAA8/8i4F1vqx2mI/photo.jpg?sz=128", "display_name": "Hassnain Alvi", "link": "https://stackoverflow.com/users/10911030/hassnain-alvi"}, "reply_to_user": {"reputation": 2956, "user_id": 2207924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d97be4271939adcd1eec201cd777f57?s=128&d=identicon&r=PG", "display_name": "JeffUK", "link": "https://stackoverflow.com/users/2207924/jeffuk"}, "edited": false, "score": 0, "creation_date": 1547465613, "post_id": 54178905, "comment_id": 95189657, "body": "@JeffUK Yeah actually i just want to get FROM part of tables for now but if there is some functionality inside the parser API that can give me complete list of tables affected by query, that will be awesome"}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 10911030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QcpsD-GuOWA/AAAAAAAAAAI/AAAAAAAAAA8/8i4F1vqx2mI/photo.jpg?sz=128", "display_name": "Hassnain Alvi", "link": "https://stackoverflow.com/users/10911030/hassnain-alvi"}, "edited": false, "score": 0, "creation_date": 1547557212, "post_id": 54185584, "comment_id": 95225340, "body": "Thanks @rob74  i am able to get the query table name with your above insert statement using &gt; stmt.Table.Name But this somehow does not work with select statement because the structure is little complex with select and pointers addresses were returned when we print it. Can you please tell me how to do it with the select statement?"}, {"owner": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "reply_to_user": {"reputation": 47, "user_id": 10911030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QcpsD-GuOWA/AAAAAAAAAAI/AAAAAAAAAA8/8i4F1vqx2mI/photo.jpg?sz=128", "display_name": "Hassnain Alvi", "link": "https://stackoverflow.com/users/10911030/hassnain-alvi"}, "edited": false, "score": 1, "creation_date": 1547649797, "post_id": 54185584, "comment_id": 95264663, "body": "That&#39;s what I meant by using reflection - the <code>TableName</code> properties may occur in several places, so you can use reflection to (recursively) enumerate all fields of structs, elements of arrays etc. looking for values of type &quot;TableName&quot; and collect all table names. Here&#39;s an example: <a href=\"https://play.golang.org/p/B31wr2w1AL8\" rel=\"nofollow noreferrer\">play.golang.org/p/B31wr2w1AL8</a>"}, {"owner": {"reputation": 1239, "user_id": 944779, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c11ca457240834e7d5ddabcda6a0ace3?s=128&d=identicon&r=PG", "display_name": "kadir", "link": "https://stackoverflow.com/users/944779/kadir"}, "edited": false, "score": 0, "creation_date": 1553473359, "post_id": 54185584, "comment_id": 97385379, "body": "Hi @rob74 your code snippet is awesome but also prints aliases of tables. Do you have an idea how I can adapt it to exclude them? I am new to golang so am missing knowledge to understand the datastructures."}], "tags": [], "owner": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "is_accepted": true, "score": 2, "last_activity_date": 1547539919, "last_edit_date": 1547539919, "creation_date": 1547483773, "answer_id": 54185584, "question_id": 54178905, "link": "https://stackoverflow.com/questions/54178905/get-table-name-from-sql-query/54185584#54185584", "title": "Get table name from SQL query", "body": "<p>To get all the table names, you will have to pull them out from the <code>Statement</code> returned by <code>Parse</code>, possibly using reflection. If you run the following code: </p>\n\n<pre><code>stmt, _ := sqlparser.Parse(\"insert into my_table set my_column=1\")\nfmt.Printf(\"%#v\\n\", stmt)\n</code></pre>\n\n<p>you get the output (indented for readability):</p>\n\n<pre><code>&amp;sqlparser.Insert{\n    Action:\"insert\", \n    Comments:sqlparser.Comments(nil), \n    Ignore:\"\", \n    Table:sqlparser.TableName{\n        Name:sqlparser.TableIdent{v:\"my_table\"}, \n        Qualifier:sqlparser.TableIdent{v:\"\"}\n    }, \n    Partitions:sqlparser.Partitions(nil), \n    Columns:sqlparser.Columns{sqlparser.ColIdent{_:[0]struct { _ []uint8 }{}, val:\"my_column\", lowered:\"\"}}, \n    Rows:sqlparser.Values{sqlparser.ValTuple{(*sqlparser.SQLVal)(0xc00000a0c0)}}, \n    OnDup:sqlparser.OnDup(nil)\n}\n</code></pre>\n\n<p>as you can see, this contains a (sub)field of type <code>TableIdent</code> which contains the requested table from the statement.</p>\n"}, {"comments": [{"owner": {"reputation": 441, "user_id": 2361667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75aff8e7c9dc9e76aed2efe5d0268c9a?s=128&d=identicon&r=PG", "display_name": "Sanan Guliyev", "link": "https://stackoverflow.com/users/2361667/sanan-guliyev"}, "edited": false, "score": 0, "creation_date": 1612396340, "post_id": 55340735, "comment_id": 116757506, "body": "This works fine but the problem is it&#39;s handling qualifier as a table. E.g. if you have <code>select * from db.table</code> it returns [db table] as a result which is wrong."}], "tags": [], "owner": {"reputation": 1239, "user_id": 944779, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c11ca457240834e7d5ddabcda6a0ace3?s=128&d=identicon&r=PG", "display_name": "kadir", "link": "https://stackoverflow.com/users/944779/kadir"}, "is_accepted": false, "score": 1, "last_activity_date": 1553526106, "creation_date": 1553526106, "answer_id": 55340735, "question_id": 54178905, "link": "https://stackoverflow.com/questions/54178905/get-table-name-from-sql-query/55340735#55340735", "title": "Get table name from SQL query", "body": "<p>I took the snippet from the comments by @rob74 which was fantastic and modified it to only return table names. The original snippet also returned aliases of tables. E.g. </p>\n\n<pre><code>select * from my_table as mt join other_table using(my_key)\noriginal snippet returns: [my_table, mt, other_table]\nnew snippet returns:      [my_table, other_table]\n</code></pre>\n\n<p>original snippet by rob74: play.golang.org/p/B31wr2w1AL8</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/xwb1989/sqlparser\"\n    \"reflect\"\n)\n\nfunc main() {\n    stmt, _ := sqlparser.Parse(\"select * from my_table as mt join other_table using(my_key)\")\n    var tables []string\n    tables = getTableNames(reflect.Indirect(reflect.ValueOf(stmt)), tables, 0, false)\n    fmt.Printf(\"%s\", tables)\n}\n\nfunc getTableNames(v reflect.Value, tables []string, level int, isTable bool) []string {\n    switch v.Kind() {\n    case reflect.Struct:\n        if v.Type().Name() == \"TableIdent\" {\n            // if this is a TableIdent struct, extract the table name\n            tableName := v.FieldByName(\"v\").String()\n            if tableName != \"\" &amp;&amp; isTable{\n                tables = append(tables, tableName)\n            }\n        } else {\n            // otherwise enumerate all fields of the struct and process further\n            for i := 0; i &lt; v.NumField(); i++ {\n                tables = getTableNames(reflect.Indirect(v.Field(i)), tables, level+1, isTable)\n            }\n        }\n    case reflect.Array, reflect.Slice:\n        for i := 0; i &lt; v.Len(); i++ {\n            // enumerate all elements of an array/slice and process further\n            tables = getTableNames(reflect.Indirect(v.Index(i)), tables, level+1, isTable)\n        }\n    case reflect.Interface:\n        if v.Type().Name() == \"SimpleTableExpr\" {\n            isTable = true\n        }\n        // get the actual object that satisfies an interface and process further\n        tables = getTableNames(reflect.Indirect(reflect.ValueOf(v.Interface())), tables, level+1, isTable)\n    }\n\n    return tables\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 441, "user_id": 2361667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75aff8e7c9dc9e76aed2efe5d0268c9a?s=128&d=identicon&r=PG", "display_name": "Sanan Guliyev", "link": "https://stackoverflow.com/users/2361667/sanan-guliyev"}, "edited": false, "score": 0, "creation_date": 1612398864, "post_id": 56262971, "comment_id": 116758077, "body": "In case someone wants to use this code the library is here <a href=\"https://github.com/imantung/sqlstr\" rel=\"nofollow noreferrer\">github.com/imantung/sqlstr</a>"}], "tags": [], "owner": {"reputation": 47, "user_id": 9122077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c4a349c1f476414fea4904cb3392299?s=128&d=identicon&r=PG&f=1", "display_name": "iman tung", "link": "https://stackoverflow.com/users/9122077/iman-tung"}, "is_accepted": false, "score": 0, "last_activity_date": 1558549975, "creation_date": 1558549975, "answer_id": 56262971, "question_id": 54178905, "link": "https://stackoverflow.com/questions/54178905/get-table-name-from-sql-query/56262971#56262971", "title": "Get table name from SQL query", "body": "<p>I wrote some string manipulation library for SQL Query to get table names:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>queryString := sqlstr.NewQueryString(`SELECT column_name(s)\nFROM table1\nLEFT JOIN table2\nON table1.column_name = table2.column_name;`)\n\ntableNames := queryString.TableNames()\n\nfmt.Println(tableNames)\n\n// Output:\n// [table1 table2]\n</code></pre>\n"}], "owner": {"reputation": 47, "user_id": 10911030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QcpsD-GuOWA/AAAAAAAAAAI/AAAAAAAAAA8/8i4F1vqx2mI/photo.jpg?sz=128", "display_name": "Hassnain Alvi", "link": "https://stackoverflow.com/users/10911030/hassnain-alvi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1643, "favorite_count": 0, "accepted_answer_id": 54185584, "answer_count": 3, "score": 0, "last_activity_date": 1558549975, "creation_date": 1547458901, "last_edit_date": 1592644375, "question_id": 54178905, "link": "https://stackoverflow.com/questions/54178905/get-table-name-from-sql-query", "title": "Get table name from SQL query", "body": "<p>I am using <a href=\"https://github.com/xwb1989/sqlparser\" rel=\"nofollow noreferrer\">golang SQL parser</a> to fetch query related information from actual SQL query string. I am able to find the type of query using following code:</p>\n<pre><code>queryType := sqlparser.StmtType(sqlparser.Preview(sql))\nfmt.Println(queryType)\n</code></pre>\n<p>but i am not sure how to get actual table names from sql query. The documentation is not clear as well. Only information i get from parse function is a statement</p>\n<p>Can someone guide me how can get this information using golang sqlparser?</p>\n"}, {"tags": ["json", "dictionary", "go"], "answers": [{"comments": [{"owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "edited": false, "score": 0, "creation_date": 1547461176, "post_id": 54179207, "comment_id": 95187402, "body": "Got it. Would I be able to use that at a lower level, i.e. if at highest level decoding Config is fine but at a lower level I&#39;d need an Action of one type or other? In json I&#39;d implement the Marshal Interface on Action. Happy to do a new question if this exceeds the scope."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "edited": false, "score": 1, "creation_date": 1547467086, "post_id": 54179207, "comment_id": 95190340, "body": "@andig You can use this at lower level too. E.g. create the struct type that&#39;s known, and it may have a field of <code>map[string]interface{}</code> type. You can check another field to decide what to decode the map field into."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1547460032, "creation_date": 1547460032, "answer_id": 54179207, "question_id": 54178855, "link": "https://stackoverflow.com/questions/54178855/how-can-mapstructure-use-a-discriminator-to-decode-concrete-type/54179207#54179207", "title": "How can mapstructure use a discriminator to decode concrete type", "body": "<p>That library only maps maps to structures. It does not do type-specific decoding. Quoting from its doc:</p>\n\n<blockquote>\n  <p>Perhaps we can't populate a specific structure without first reading the \"type\" field from the JSON. We could always do two passes over the decoding of the JSON (reading the \"type\" first, and the rest later). However, it is much simpler to just decode this into a <code>map[string]interface{}</code> structure, read the \"type\" key, then use something like this library to decode it into the proper structure.</p>\n</blockquote>\n\n<p>All it offers is that you only have to parse the JSON source once, into a map, then you can decide yourself what type you need to map or unmarshal into. Then you can use the already constructed map to fill the type you need.</p>\n\n<p>See this example:</p>\n\n<pre><code>type Person struct {\n    Name string `json:\"name\"`\n}\n\ntype Credentials struct {\n    User     string `json:\"user\"`\n    Password string `json:\"password\"`\n}\n\nfunc main() {\n    for _, src := range []string{srcPerson, srcCredentials} {\n        var m map[string]interface{}\n        if err := json.Unmarshal([]byte(src), &amp;m); err != nil {\n            panic(err)\n        }\n\n        switch m[\"type\"] {\n        case \"person\":\n            var p Person\n            if err := mapstructure.Decode(m, &amp;p); err != nil {\n                panic(err)\n            }\n            fmt.Printf(\"%T %+v\\n\", p, p)\n        case \"credentials\":\n            var c Credentials\n            if err := mapstructure.Decode(m, &amp;c); err != nil {\n                panic(err)\n            }\n            fmt.Printf(\"%T %+v\\n\", c, c)\n        }\n    }\n}\n\nconst srcPerson = `{\n  \"type\": \"person\",\n  \"name\": \"Mitchell\"\n}`\n\nconst srcCredentials = `{\n  \"type\": \"credentials\",\n  \"user\": \"bob\",\n  \"password\": \"secret\"\n}`\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>main.Person {Name:Mitchell}\nmain.Credentials {User:bob Password:secret}\n</code></pre>\n"}], "owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 583, "favorite_count": 0, "accepted_answer_id": 54179207, "answer_count": 1, "score": -1, "last_activity_date": 1547460046, "creation_date": 1547458700, "last_edit_date": 1547460046, "question_id": 54178855, "link": "https://stackoverflow.com/questions/54178855/how-can-mapstructure-use-a-discriminator-to-decode-concrete-type", "title": "How can mapstructure use a discriminator to decode concrete type", "body": "<p>The docs (<a href=\"https://github.com/mitchellh/mapstructure\" rel=\"nofollow noreferrer\">https://github.com/mitchellh/mapstructure</a>) mention the benefits of mapstructure for decoding</p>\n\n<pre><code>{\n  \"type\": \"person\",\n  \"name\": \"Mitchell\"\n}\n</code></pre>\n\n<p>I'm looking for an example that show the decoding process, e.g. to unmarshal either a <code>Person</code> or <code>Pet</code> class</p>\n"}, {"tags": ["string", "date", "go", "time", "weekday"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1547456300, "post_id": 54178243, "comment_id": 95184997, "body": "1. parse the date with <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\"><code>time.Parse</code></a>, 2. call the <a href=\"https://golang.org/pkg/time/#Time.Weekday\" rel=\"nofollow noreferrer\"><code>Weekday</code></a> method on it."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1547456832, "post_id": 54178243, "comment_id": 95185231, "body": "Not related to your question, but your use of <code>p := fmt.Println</code> is a bit peculiar. I&#39;d strongly encourage you <i>not</i> to do that, because it makes your code hard to read.  But of course, that&#39;s just my opinion."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1547456962, "post_id": 54178243, "comment_id": 95185284, "body": "I&#39;m voting to close this question as off-topic because it is just code review."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 10, "last_activity_date": 1547456333, "creation_date": 1547456333, "answer_id": 54178303, "question_id": 54178243, "link": "https://stackoverflow.com/questions/54178243/how-to-find-a-weekday-from-the-given-date-in-string/54178303#54178303", "title": "How to find a weekday from the given date in string?", "body": "<p>Yes, simply parse the time using <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"noreferrer\"><code>time.Parse()</code></a>, e.g.</p>\n\n<pre><code>date := \"01-25-2019\"\nt, err := time.Parse(\"01-02-2006\", date)\nif err != nil {\n    panic(err)\n}\nfmt.Println(t.Weekday())\n</code></pre>\n\n<p><code>time.Parse()</code> will do the parsing that you tried to implement manually. Note that the first parameter to <code>time.Parse()</code> is a layout string, it must contain a reference time (which is <code>Mon Jan 2 15:04:05 -0700 MST 2006</code>) in the format your input is given.</p>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/7yeDPVLhCS0\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Friday\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1212, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1547457448, "creation_date": 1547456043, "last_edit_date": 1547457448, "question_id": 54178243, "link": "https://stackoverflow.com/questions/54178243/how-to-find-a-weekday-from-the-given-date-in-string", "title": "How to find a weekday from the given date in string?", "body": "<p>I have a function in my app that saves the date in string into the database, but it can't save the day on that date. I have tried a short code on this. Suppose we have a date in string.</p>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n    \"time\"\n)   \n\nfunc main() {\n    p := fmt.Println\n    date := \"01-25-2019\"\n    arrayDate := strings.Split(date, \"-\")\n    fmt.Println(arrayDate)\n    month, _ := strconv.Atoi(arrayDate[0])\n    dateInt, _ := strconv.Atoi(arrayDate[1])\n    year, _ := strconv.Atoi(arrayDate[2])\n    then := time.Date(\n        year, time.Month(month), dateInt, 0, 0, 0, 0, time.UTC)\n    p(then)\n\n    p(then.Weekday())\n\n}\n</code></pre>\n\n<p>Is there any more efficient way to do this?</p>\n\n<p>playground <a href=\"https://play.golang.org/p/TGeXz6Ev-EE\" rel=\"nofollow noreferrer\">link</a></p>\n"}, {"tags": ["go", "beego"], "comments": [{"owner": {"reputation": 2280, "user_id": 1918890, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/018e4722f070586f7a475e3942b9aa32?s=128&d=identicon&r=PG", "display_name": "Praveen", "link": "https://stackoverflow.com/users/1918890/praveen"}, "edited": false, "score": 0, "creation_date": 1547456167, "post_id": 54178225, "comment_id": 95184931, "body": "utils is a separate package? and main function is in a separate package?"}, {"owner": {"reputation": 113, "user_id": 5408831, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/10205070334419398/picture?type=large", "display_name": "Nasihun Amin Suhardiyan", "link": "https://stackoverflow.com/users/5408831/nasihun-amin-suhardiyan"}, "reply_to_user": {"reputation": 2280, "user_id": 1918890, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/018e4722f070586f7a475e3942b9aa32?s=128&d=identicon&r=PG", "display_name": "Praveen", "link": "https://stackoverflow.com/users/1918890/praveen"}, "edited": false, "score": 0, "creation_date": 1547456281, "post_id": 54178225, "comment_id": 95184986, "body": "yes i create a folder called utils, and I create a file named firebird.go inside utils to store my database preferences. I want call those globally in main.go and to others package @Praveen"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547457674, "post_id": 54178225, "comment_id": 95185627, "body": "Don&#39;t ignore errors. If you have a connection error <code>conn</code> will be nil, and you won&#39;t know, because you&#39;re ignoring errors."}, {"owner": {"reputation": 113, "user_id": 5408831, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/10205070334419398/picture?type=large", "display_name": "Nasihun Amin Suhardiyan", "link": "https://stackoverflow.com/users/5408831/nasihun-amin-suhardiyan"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547458354, "post_id": 54178225, "comment_id": 95185944, "body": "ah I see, I will add the handling later, I just curious with this case @Flimzy"}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 5408831, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/10205070334419398/picture?type=large", "display_name": "Nasihun Amin Suhardiyan", "link": "https://stackoverflow.com/users/5408831/nasihun-amin-suhardiyan"}, "edited": false, "score": 0, "creation_date": 1547458466, "post_id": 54178367, "comment_id": 95186003, "body": "Thanks for the answer. once again, if I create a new package (new folder), can I still access the Conn variable in other packages?"}], "tags": [], "owner": {"reputation": 2280, "user_id": 1918890, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/018e4722f070586f7a475e3942b9aa32?s=128&d=identicon&r=PG", "display_name": "Praveen", "link": "https://stackoverflow.com/users/1918890/praveen"}, "is_accepted": true, "score": 2, "last_activity_date": 1547456943, "last_edit_date": 1547456943, "creation_date": 1547456621, "answer_id": 54178367, "question_id": 54178225, "link": "https://stackoverflow.com/questions/54178225/how-can-i-pass-connection-parameter-db-to-main-go/54178367#54178367", "title": "How can I pass connection parameter db to main.go?", "body": "<p>First, if you want to access something from another package, it has to be exported. In Go, if you want to export something you name it with first letter as uppercase (in your case, it should be <code>Conn</code> instead of <code>conn</code>). </p>\n\n<p>Second, when you use <code>defer</code> it will get executed when the function returns. In your case, it returns immediately, so the connection is closed immediately. </p>\n\n<p><strong>Solution:</strong></p>\n\n<pre><code>var Conn *sql.DB\nfunc InitFirebird() {\n    var (\n        dbDriver   = beego.AppConfig.String(\"DB_CONNECTION\")\n        dbUsername = beego.AppConfig.String(\"DB_USERNAME\")\n        dbPassword = beego.AppConfig.String(\"DB_PASSWORD\")\n        dbServer   = beego.AppConfig.String(\"DB_HOST\")\n        // dbPort     = beego.AppConfig.String(\"DB_PORT\")\n        dbFileName = beego.AppConfig.String(\"DB_DATABASE\")\n    )\n    Conn, _ = sql.Open(dbDriver, dbUsername+\":\"+dbPassword+\"@\"+dbServer+\"/\"+dbFileName)\n}\n</code></pre>\n\n<p>Now in your main package:</p>\n\n<pre><code>func init() {\n    utils.InitFirebird()\n}\n\nfunc main() {\n    if beego.BConfig.RunMode == \"dev\" {\n        beego.BConfig.WebConfig.DirectoryIndex = true\n        beego.BConfig.WebConfig.StaticDir[\"/swagger\"] = \"swagger\"\n        }\n\n    var n int\n    defer utils.Conn.Close() // &lt;-- Close here\n\n    utils.Conn.QueryRow(\"SELECT Count(*) FROM rdb$relations\").Scan(&amp;n)\n    fmt.Println(\"Relations count=\", n)\n\n    beego.Run()\n}\n</code></pre>\n\n<p>Here <code>Close()</code> won't get executed immediately because <code>beego.Run()</code> will block.</p>\n\n<p><strong>PS:</strong>\nPassing DB connection using global variable is not recommended. If you want to learn more check this out: <a href=\"https://www.alexedwards.net/blog/organising-database-access\" rel=\"nofollow noreferrer\">https://www.alexedwards.net/blog/organising-database-access</a> </p>\n"}], "owner": {"reputation": 113, "user_id": 5408831, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/10205070334419398/picture?type=large", "display_name": "Nasihun Amin Suhardiyan", "link": "https://stackoverflow.com/users/5408831/nasihun-amin-suhardiyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 54178367, "answer_count": 1, "score": -3, "last_activity_date": 1547456943, "creation_date": 1547455976, "question_id": 54178225, "link": "https://stackoverflow.com/questions/54178225/how-can-i-pass-connection-parameter-db-to-main-go", "title": "How can I pass connection parameter db to main.go?", "body": "<p>I have trouble with my current works. I build an apps using beego framework, Im new in golang.</p>\n\n<p>First, I build other package called utils, and from that package I write some codes to access to my databases</p>\n\n<pre><code>func InitFirebird() {\n    var (\n        dbDriver   = beego.AppConfig.String(\"DB_CONNECTION\")\n        dbUsername = beego.AppConfig.String(\"DB_USERNAME\")\n        dbPassword = beego.AppConfig.String(\"DB_PASSWORD\")\n        dbServer   = beego.AppConfig.String(\"DB_HOST\")\n        // dbPort     = beego.AppConfig.String(\"DB_PORT\")\n        dbFileName = beego.AppConfig.String(\"DB_DATABASE\")\n    )\n    conn, _ := sql.Open(dbDriver, dbUsername+\":\"+dbPassword+\"@\"+dbServer+\"/\"+dbFileName)\n    defer conn.Close()\n}\n</code></pre>\n\n<p>After that, I go to my main.go and setting up my init function and main function like this:</p>\n\n<pre><code>func init() {\n    utils.InitFirebird()\n}\n\nfunc main() {\n    if beego.BConfig.RunMode == \"dev\" {\n        beego.BConfig.WebConfig.DirectoryIndex = true\n        beego.BConfig.WebConfig.StaticDir[\"/swagger\"] = \"swagger\"\n        }\n\n    var n int\n\n    conn.QueryRow(\"SELECT Count(*) FROM rdb$relations\").Scan(&amp;n)\n    fmt.Println(\"Relations count=\", n)\n\n    beego.Run()\n}\n</code></pre>\n\n<p>When I startover my apps, its error and provide me this message :</p>\n\n<p><code>\\main.go:23:2: undefined: conn</code></p>\n\n<p>How can I resolve this?</p>\n\n<p>Anyhelp will appreciate</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547455463, "post_id": 54178019, "comment_id": 95184648, "body": "I don&#39;t understand your question. Can you clarify? And show the code you&#39;re using which generates the error."}], "answers": [{"tags": [], "owner": {"reputation": 569, "user_id": 221689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f46fcd651a44e070e0f1e4c0905c6ee8?s=128&d=identicon&r=PG", "display_name": "Charley", "link": "https://stackoverflow.com/users/221689/charley"}, "is_accepted": false, "score": 1, "last_activity_date": 1547455843, "creation_date": 1547455843, "answer_id": 54178197, "question_id": 54178019, "link": "https://stackoverflow.com/questions/54178019/how-to-use-go-to-perform-cat-7zsd-sfx-config-txt-xxxx-7z-setup-exe/54178197#54178197", "title": "How to use Go to perform &quot;cat&#160;7zSD.sfx&#160;config.txt&#160;xxxx.7z&#160;&gt;&#160;setup.exe&quot;", "body": "<p>You appear to be expecting that exec.Command behave like your interactive shell behaves. It does not work that way. As explained in <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow noreferrer\">the exec documentation</a>:</p>\n\n<blockquote>\n  <p>Unlike the \"system\" library call from C and other languages, the os/exec package intentionally does not invoke the system shell and does not expand any glob patterns or handle other expansions, pipelines, or redirections typically done by shells.</p>\n</blockquote>\n"}], "owner": {"reputation": 15, "user_id": 6720794, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXHBX.jpg?s=128&g=1", "display_name": "dafeng", "link": "https://stackoverflow.com/users/6720794/dafeng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "closed_date": 1547477094, "answer_count": 1, "score": -2, "last_activity_date": 1547493969, "creation_date": 1547454973, "last_edit_date": 1547462132, "question_id": 54178019, "link": "https://stackoverflow.com/questions/54178019/how-to-use-go-to-perform-cat-7zsd-sfx-config-txt-xxxx-7z-setup-exe", "closed_reason": "Duplicate", "title": "How to use Go to perform &quot;cat&#160;7zSD.sfx&#160;config.txt&#160;xxxx.7z&#160;&gt;&#160;setup.exe&quot;", "body": "<p>In the Linux command line, it's possible to execute: </p>\n\n<pre><code>cat\u00a07zSD.sfx\u00a0config.txt\u00a0xxxx.7z\u00a0&gt;\u00a0setup.exe\n</code></pre>\n\n<p>However, trying the same using Go, fails. I tried:</p>\n\n<pre><code>exec.Command(\"cat\u00a07zSD.sfx\u00a0config.txt\u00a0xxxx.7z\u00a0&gt;\u00a0setup.exe\")\n</code></pre>\n\n<p>and I get \"executable file not found in $PATH.\"</p>\n\n<p>How can I execute the same command-line using Go?</p>\n"}, {"tags": ["docker", "go", "docker-api"], "comments": [{"owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "edited": false, "score": 0, "creation_date": 1547499703, "post_id": 54177064, "comment_id": 95206362, "body": "Could you provide a bit more detail about you question? Sample code?"}], "answers": [{"tags": [], "owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "is_accepted": true, "score": 0, "last_activity_date": 1547504434, "creation_date": 1547504434, "answer_id": 54190049, "question_id": 54177064, "link": "https://stackoverflow.com/questions/54177064/volume-mount-option-z-using-docker-golang-library/54190049#54190049", "title": "Volume mount option &#39;z&#39; using docker golang library", "body": "<p>I would think you can just add ':z' to the path of the volume, which is a string:</p>\n\n<pre><code>res, err := client.ContainerCreate(\n    ctx,\n    &amp;container.Config{\n        Image: \"nginx\",\n        Cmd:   []string{},\n    },\n    &amp;container.HostConfig{\n        Mounts: []mount.Mount{\n            {\n                Type:   mount.TypeVolume,\n                Source: \"/app:z\",   // &lt;---- HERE\n                Target: \"/target\",\n            },\n        },\n    },\n    nil,\n    \"\",\n)\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 10910205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c2814c9d99955906ca69c9aa09bd31c?s=128&d=identicon&r=PG&f=1", "display_name": "user10910205", "link": "https://stackoverflow.com/users/10910205/user10910205"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "accepted_answer_id": 54190049, "answer_count": 1, "score": 0, "last_activity_date": 1547504434, "creation_date": 1547449866, "question_id": 54177064, "link": "https://stackoverflow.com/questions/54177064/volume-mount-option-z-using-docker-golang-library", "title": "Volume mount option &#39;z&#39; using docker golang library", "body": "<p>How to pass z flag for volume mount using docker golang library ?\nFor supporting Selinux</p>\n"}, {"tags": ["arrays", "json", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1547448735, "post_id": 54176512, "comment_id": 95182194, "body": "Your title asks about unmarshaling arrays, but your question only mentions objects. Is the title just wrong, or is your question leaving out important details?"}, {"owner": {"reputation": 135, "user_id": 4208321, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/743ad69fd421838322645c1b0820b370?s=128&d=identicon&r=PG&f=1", "display_name": "satinder", "link": "https://stackoverflow.com/users/4208321/satinder"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1547451336, "post_id": 54176512, "comment_id": 95183017, "body": "Thanks @ThunderCat will look and try the help from your provided link."}, {"owner": {"reputation": 135, "user_id": 4208321, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/743ad69fd421838322645c1b0820b370?s=128&d=identicon&r=PG&f=1", "display_name": "satinder", "link": "https://stackoverflow.com/users/4208321/satinder"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547451441, "post_id": 54176512, "comment_id": 95183064, "body": "@Flimzy You can take a look at the value of <code>mfJson</code> and <code>mtJson</code>, <code>mfJson</code> is JSON array, so felt confusing with all that and since being new to golang, didn&#39;t sure how to put it in words here."}], "answers": [{"comments": [{"owner": {"reputation": 135, "user_id": 4208321, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/743ad69fd421838322645c1b0820b370?s=128&d=identicon&r=PG&f=1", "display_name": "satinder", "link": "https://stackoverflow.com/users/4208321/satinder"}, "edited": false, "score": 0, "creation_date": 1547452825, "post_id": 54176568, "comment_id": 95183561, "body": "Thanks! yes your make map example helped understanding what I needed to do. Tried and it shows the result in output with this test: <a href=\"https://play.golang.org/p/dtt9CSIu1gR\" rel=\"nofollow noreferrer\">play.golang.org/p/dtt9CSIu1gR</a>"}, {"owner": {"reputation": 135, "user_id": 4208321, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/743ad69fd421838322645c1b0820b370?s=128&d=identicon&r=PG&f=1", "display_name": "satinder", "link": "https://stackoverflow.com/users/4208321/satinder"}, "edited": false, "score": 0, "creation_date": 1547452905, "post_id": 54176568, "comment_id": 95183589, "body": "So, do I have to use the for loop or <code>exists</code> to select the dynamic key and then output work with the data in that key&#39;s object? Or is there other better way?"}, {"owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "reply_to_user": {"reputation": 135, "user_id": 4208321, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/743ad69fd421838322645c1b0820b370?s=128&d=identicon&r=PG&f=1", "display_name": "satinder", "link": "https://stackoverflow.com/users/4208321/satinder"}, "edited": false, "score": 0, "creation_date": 1547454310, "post_id": 54176568, "comment_id": 95184170, "body": "Yes you should use for loop or exists"}, {"owner": {"reputation": 135, "user_id": 4208321, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/743ad69fd421838322645c1b0820b370?s=128&d=identicon&r=PG&f=1", "display_name": "satinder", "link": "https://stackoverflow.com/users/4208321/satinder"}, "edited": false, "score": 0, "creation_date": 1547456474, "post_id": 54176568, "comment_id": 95185072, "body": "Thank you. Much appreciate your help. :)"}], "tags": [], "owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "is_accepted": true, "score": 4, "last_activity_date": 1547446744, "creation_date": 1547446744, "answer_id": 54176568, "question_id": 54176512, "link": "https://stackoverflow.com/questions/54176512/how-to-parse-golang-json-array-having-random-hash-value-in-field-name/54176568#54176568", "title": "how to parse golang json array having random hash value in field name", "body": "<p>Since the keys are not known, you have to resort to a dynamic data structure.</p>\n\n<p>Define the single element like:</p>\n\n<pre><code>type Element struct {\n            Size             int           `json:\"size\"`\n            Fee              float64       `json:\"fee\"`\n            Time             int           `json:\"time\"`\n            Height           int           `json:\"height\"`\n            Startingpriority float64       `json:\"startingpriority\"`\n            Currentpriority  float64       `json:\"currentpriority\"`\n            Depends          []interface{} `json:\"depends\"`\n}\n</code></pre>\n\n<p>Then parse your json to a <code>map[string]Element</code> like so:</p>\n\n<pre><code>result := make(map[string]Element)\njson.Unmarshal(jsonBytes, &amp;result)\n</code></pre>\n"}], "owner": {"reputation": 135, "user_id": 4208321, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/743ad69fd421838322645c1b0820b370?s=128&d=identicon&r=PG&f=1", "display_name": "satinder", "link": "https://stackoverflow.com/users/4208321/satinder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "closed_date": 1547474048, "accepted_answer_id": 54176568, "answer_count": 1, "score": -2, "last_activity_date": 1547446744, "creation_date": 1547446359, "question_id": 54176512, "link": "https://stackoverflow.com/questions/54176512/how-to-parse-golang-json-array-having-random-hash-value-in-field-name", "closed_reason": "Needs details or clarity", "title": "how to parse golang json array having random hash value in field name", "body": "<p>I'm trying to parse JSON from API in golang code.\nOf passed with <code>true</code> option argument it gives different additional info and with <code>false</code> different output.\nI have covered that in the following golang play link:\n<a href=\"https://play.golang.org/p/-JffO4AS01N\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-JffO4AS01N</a></p>\n\n<p>I need to parse the value of variable <code>mtJson</code>.</p>\n\n<p>Used the Json to Go (<a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a>) converted to get help in creating the struct type for this. But it was giving following struct type for the json example:</p>\n\n<pre><code>{\n\"result\": {\n\"99c4d91acc2486955c98015fbbdf06239b983c9d93d5069c39d040702af88738\": {\n\"size\": 845,\n\"fee\": 0.000144,\n\"time\": 1547444481,\n\"height\": 1183405,\n\"startingpriority\": 89509.20245398773,\n\"currentpriority\": 89509.20245398773,\n\"depends\": []\n},\n\"73f582cf419f8b1cd6a87f81e0e9a4e783add27c2be083361e8eb4a3bac0134e\": {\n\"size\": 1635,\n\"fee\": 0.000312,\n\"time\": 1547444435,\n\"height\": 1183405,\n\"startingpriority\": 341863.3540372671,\n\"currentpriority\": 341863.3540372671,\n\"depends\": []\n}\n},\n\"error\": null,\n\"id\": \"curltest\"\n}\n</code></pre>\n\n<pre><code>type AutoGenerated struct {\n    Result struct {\n        Nine9C4D91Acc2486955C98015Fbbdf06239B983C9D93D5069C39D040702Af88738 struct {\n            Size             int           `json:\"size\"`\n            Fee              float64       `json:\"fee\"`\n            Time             int           `json:\"time\"`\n            Height           int           `json:\"height\"`\n            Startingpriority float64       `json:\"startingpriority\"`\n            Currentpriority  float64       `json:\"currentpriority\"`\n            Depends          []interface{} `json:\"depends\"`\n        } `json:\"99c4d91acc2486955c98015fbbdf06239b983c9d93d5069c39d040702af88738\"`\n        Seven3F582Cf419F8B1Cd6A87F81E0E9A4E783Add27C2Be083361E8Eb4A3Bac0134E struct {\n            Size             int           `json:\"size\"`\n            Fee              float64       `json:\"fee\"`\n            Time             int           `json:\"time\"`\n            Height           int           `json:\"height\"`\n            Startingpriority float64       `json:\"startingpriority\"`\n            Currentpriority  float64       `json:\"currentpriority\"`\n            Depends          []interface{} `json:\"depends\"`\n        } `json:\"73f582cf419f8b1cd6a87f81e0e9a4e783add27c2be083361e8eb4a3bac0134e\"`\n    } `json:\"result\"`\n    Error interface{} `json:\"error\"`\n    ID    string      `json:\"id\"`\n}\n</code></pre>\n\n<p>This doesn't seem right.</p>\n\n<p>The value of the string hash key will be always different not determined, so can not just set that as is in struct.</p>\n\n<p>I'm feeling confused on how to parse the JSON so that I can finally get the values like this:</p>\n\n<pre><code>\nfmt.Println(mt.Result.(\"99c4d91acc2486955c98015fbbdf06239b983c9d93d5069c39d040702af88738\").Size)\n\nfmt.Println(mt.Result.(\"99c4d91acc2486955c98015fbbdf06239b983c9d93d5069c39d040702af88738\").Fee)\n\n</code></pre>\n\n<p>Please help</p>\n\n<p>I have covered that in the following golang play link:\n<a href=\"https://play.golang.org/p/-JffO4AS01N\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-JffO4AS01N</a></p>\n\n<p>I have covered that in the following golang play link:\n<a href=\"https://play.golang.org/p/-JffO4AS01N\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-JffO4AS01N</a></p>\n\n<p>Expected:\nfmt.Println(mt.Result.(\"99c4d91acc2486955c98015fbbdf06239b983c9d93d5069c39d040702af88738\").Size)\n845</p>\n\n<p>fmt.Println(mt.Result.(\"99c4d91acc2486955c98015fbbdf06239b983c9d93d5069c39d040702af88738\").Fee)\n0.000144</p>\n\n<p>Actual Result: {{0 0 0 0 0 0 []}}</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1547447458, "post_id": 54176511, "comment_id": 95181835, "body": "Your error message does not match your code."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1547452932, "post_id": 54176511, "comment_id": 95183603, "body": "<i>&quot;Now I think I can do above logic&quot;</i> No you can <i>not</i>. <code>func(params profile.GetProfileParams, principal *models.User) middleware.Responder</code> is not the same as <code>func(GetProfileParams, interface{}) middleware.Responder</code>. That is: <code>*models.User</code> is not the same type as <code>interface{}</code>."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1547457530, "post_id": 54176511, "comment_id": 95185552, "body": "@mkopriva But If I have implemented the single method in a interface with my type then I can use the interface also. That&#39;s how io.Reader works because it implements basic Read method."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1547457571, "post_id": 54176511, "comment_id": 95185572, "body": "@Volker error message is for reference main question is Can implement the interface."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1547457718, "post_id": 54176511, "comment_id": 95185656, "body": "It doesn&#39;t matter what interface the <code>GetProfileHandlerFunc</code> type implements, the error is not saying anything about interfaces, it tells you that you cannot convert A to B, where A is the func literal <code>func(params profile.GetProfileParams, principal *models.User) middleware.Responder</code> and B is the func type <code>GetProfileHandlerFunc</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1547457866, "post_id": 54176511, "comment_id": 95185721, "body": "... It&#39;s the same as trying to do <code>int(&quot;hello world&quot;)</code>, you are doing conversion between two incompatible types."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1547458113, "post_id": 54176511, "comment_id": 95185845, "body": "@mkopriva you are right but I have seen same thing when people implements io.Reader or other readers in interface"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1547458456, "post_id": 54176511, "comment_id": 95185997, "body": "@Himanshu. NO, you cannot have seen this because it is impossible in Go. See also <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_of_interface</a>. Go&#39;s type system does not work the way you think. <code>interface{}</code> does not mean &quot;whatever&quot; it means <code>interface{}</code> and only <code>interface{}</code>. You can <b>assign</b> anything to <code>interface{}</code> but as a type it is <code>interface{}</code> and <i>nothing</i> <i>else</i>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1547458513, "post_id": 54176511, "comment_id": 95186027, "body": "You&#39;ve probably misunderstood what you&#39;ve seen or the code was as well broken and would not compile just like yours."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1547458757, "post_id": 54176511, "comment_id": 95186151, "body": "@Volker what happens when you create a handler in which if you implement <code>ServeHTTP</code> it will implement the <code>Handler</code> interface and then you can use it in mux."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1547458840, "post_id": 54176511, "comment_id": 95186196, "body": "@Volker the issue was different because I have generated the code again and it is working now. But I do not the reason why it was not working before. Thanks for your comments."}], "answers": [{"tags": [], "owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "is_accepted": false, "score": 0, "last_activity_date": 1547641206, "creation_date": 1547641206, "answer_id": 54216968, "question_id": 54176511, "link": "https://stackoverflow.com/questions/54176511/implementing-interface-type-to-function-type-in-golang/54216968#54216968", "title": "Implementing interface type to function type in Golang", "body": "<p>the point is:\nif you have a function like </p>\n\n<pre><code>func A(param interface{}) {}\n</code></pre>\n\n<p>you can pass anything to param when you make a call to function A. like</p>\n\n<pre><code>A(10)\nA(true)\nA(nil)\n</code></pre>\n\n<p>Because interface{} means everything. So your handle func definition:</p>\n\n<pre><code>type GetProfileHandlerFunc func(GetProfileParams, interface{}) middleware.Responder\n</code></pre>\n\n<p>means a function GetProfileHandlerFunc which takes two params, the first is of type GetProfileParams, the second is of type interface{}. That means second param canbe anything.</p>\n\n<p>But </p>\n\n<pre><code>func(params profile.GetProfileParams, principal *models.User) middleware.Responder\n</code></pre>\n\n<p>means a function which takes two params, the first is of type GetProfileParams, the second is of type *models.User. So, do you think they are the same? No. </p>\n\n<p>I need a function can take anything as second param,not a function who can only take User as second function. </p>\n\n<p>When you call your handle</p>\n\n<pre><code>GetProfileHandlerFunc(params, 10) // this is ok\n</code></pre>\n\n<p>So is that ok for </p>\n\n<pre><code>func(params profile.GetProfileParams, principal *models.User) middleware.Responder\n</code></pre>\n\n<p>No.</p>\n\n<p>The right way to do this is :</p>\n\n<pre><code>api.ProfileGetProfileHandler = profile.GetProfileHandlerFunc(func(params profile.GetProfileParams, principal interface) middleware.Responder {\n\n     user:=principal.(*model.User) // watch this.\n}\n</code></pre>\n"}], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 346, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1547641206, "creation_date": 1547446347, "last_edit_date": 1547466495, "question_id": 54176511, "link": "https://stackoverflow.com/questions/54176511/implementing-interface-type-to-function-type-in-golang", "title": "Implementing interface type to function type in Golang", "body": "<p>I have created few types including interface as:</p>\n\n<pre><code>// GetProfileHandlerFunc turns a function with the right signature into a get profile handler\ntype GetProfileHandlerFunc func(GetProfileParams, interface{}) middleware.Responder\n\n// Handle executing the request and returning a response\nfunc (fn GetProfileHandlerFunc) Handle(params GetProfileParams, principal interface{}) middleware.Responder {\n    return fn(params, principal)\n}\n\n// GetProfileHandler interface for that can handle valid get profile params\ntype GetProfileHandler interface {\n    Handle(GetProfileParams, interface{}) middleware.Responder\n}\n</code></pre>\n\n<p>Now in my api implementation package. I am using a logic to handle the request parameters. I am trying to assign <code>GetProfileHandlerFunc</code> to another type since it implements <code>GetProfileHandler</code> interface as you can see above.</p>\n\n<pre><code>api.ProfileGetProfileHandler = profile.GetProfileHandlerFunc(func(params profile.GetProfileParams, principal *models.User) middleware.Responder {\n     // contains logic to handle the request\n}\n</code></pre>\n\n<p>Now I think I can do above logic. But I am getting type mismatch error.</p>\n\n<blockquote>\n  <p>cannot convert func literal (type func(profile.GetProfileParams,\n  *\"userproj/models\".User)\n  middleware.Responder) to type profile.GetProfileHandlerFuncgo</p>\n</blockquote>\n"}, {"tags": ["json", "pointers", "go", "marshalling", "unmarshalling"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547448974, "post_id": 54175787, "comment_id": 95182270, "body": "<code>Tests 1 and 2 lead me to believe that some runtime information is lost when something is assigned to a &quot;superclass&quot;</code> -- There are no classes, or superclasses in Go. So this conjecture makes no sense."}, {"owner": {"reputation": 57, "user_id": 9969966, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2NNiAoBGFk0/AAAAAAAAAAI/AAAAAAAAADQ/PesPnAVd7iQ/photo.jpg?sz=128", "display_name": "Arik Rundquist", "link": "https://stackoverflow.com/users/9969966/arik-rundquist"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547524649, "post_id": 54175787, "comment_id": 95212537, "body": "I apologize for the misnomer, I&#39;m coming straight from Java, so that is what I am familiar with. Nonetheless, passing any type to a variable of type interface{} results in a loss of static type information @Flimzy"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547535494, "post_id": 54175787, "comment_id": 95215079, "body": "No, static type information is never lost in Go."}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 9969966, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2NNiAoBGFk0/AAAAAAAAAAI/AAAAAAAAADQ/PesPnAVd7iQ/photo.jpg?sz=128", "display_name": "Arik Rundquist", "link": "https://stackoverflow.com/users/9969966/arik-rundquist"}, "edited": false, "score": 0, "creation_date": 1547525104, "post_id": 54176455, "comment_id": 95212630, "body": "Ahh, sorry about the brackets, I just copied the code from tests 1 and 2 and forgot to remove the {} when I changed interface to Test.  Alright, I&#39;m glad Unmarshal worked because Go walks pointers rather than it working because I was wrong about the &#39;depth&#39; of the pointer :)  Now that you&#39;ve described the behavior, I can see it in the documentation. I&#39;m still new to Go so I was kind of lost on my first reading. Thanks for the clarification!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1547485563, "last_edit_date": 1547485563, "creation_date": 1547446050, "answer_id": 54176455, "question_id": 54175787, "link": "https://stackoverflow.com/questions/54175787/change-in-unmarshalling-functionality-based-on-when-object-is-converted-to-point/54176455#54176455", "title": "Change in unmarshalling functionality based on when object is converted to pointer (sometimes pointer, sometimes map)", "body": "<p>The unmarshal function walks through pointers and interfaces containing pointer values to find the destination value.  Non-pointer values in interfaces are ignored because these values are not <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">addressable</a>.  (This description omits details that are unimportant to the question).</p>\n\n<p>If the destination is an <code>interface{}</code> and the JSON is an object, then the JSON is unmarshaled to a <code>map[string]interface{}</code> and that value is stored in the interface. (This is described in the <a href=\"https://godoc.org/encoding/json#Unmarshal\" rel=\"nofollow noreferrer\">json.Unmarshal documentation</a>).</p>\n\n<p>Test 1:  The argument to unmarshal is <code>*Test</code>. The unmarshal function walks through the pointer and decodes to the <code>Test</code> struct.</p>\n\n<p>Test 2: The argument to unmarshal is pointer to <code>interface{}</code> containing a <code>Test</code>. The unmarshal function walks through the pointer to get an <code>interface{}</code>. The <code>Test</code> value in the <code>interface{}</code> is ignored because it's not <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">addressable</a>.  Because the destination is an <code>interface{}</code> and the JSON is an object, the JSON is decoded to a <code>map[string]interface{}</code>. </p>\n\n<p>The code in 3, 4, 5 and 6 does not compile. I'll proceed assuming that the <code>{}</code> following <code>Test</code> is removed.</p>\n\n<pre><code>var o2 Test = o // 3\nvar o2 *Test = &amp;o // 4\nvar o2 *Test = &amp;o // 5\nvar o2 *Test = &amp;o // 6\n</code></pre>\n\n<p>Test 3 and 5:  The argument to unmarshal is a <code>*Test</code>.  This is the same as #1.</p>\n\n<p>Test 4 and 6: The argument is a <code>**Test</code>.  The unmarshal function walks through the pointers and decodes to the <code>Test</code> struct.</p>\n\n<p>Because Go does not have any anything like a \"superclass\", that's not the issue.   </p>\n"}], "owner": {"reputation": 57, "user_id": 9969966, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2NNiAoBGFk0/AAAAAAAAAAI/AAAAAAAAADQ/PesPnAVd7iQ/photo.jpg?sz=128", "display_name": "Arik Rundquist", "link": "https://stackoverflow.com/users/9969966/arik-rundquist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 1, "accepted_answer_id": 54176455, "answer_count": 1, "score": 0, "last_activity_date": 1547525350, "creation_date": 1547440041, "last_edit_date": 1547525350, "question_id": 54175787, "link": "https://stackoverflow.com/questions/54175787/change-in-unmarshalling-functionality-based-on-when-object-is-converted-to-point", "title": "Change in unmarshalling functionality based on when object is converted to pointer (sometimes pointer, sometimes map)", "body": "<p>I am implementing some methods for serializing objects (which probably already exists in the standard library, but I want the experience).\nI was able to get both json.Marshal and json.Unmarshal to correctly convert my data to a string and then read back into an object, but I noticed some interesting behavior that I want to understand better.</p>\n\n<p>To test the functions of the json package, I created a test struct:</p>\n\n<pre><code>type Test struct{\n    T int\n    S string\n    F float32\n}\n</code></pre>\n\n<p>Running</p>\n\n<pre><code>o := Test{32, \"struct\", 12.07}\nb, e := json.Marshal(o)\nfmt.Println(string(b), e)\n</code></pre>\n\n<p>prints</p>\n\n<pre><code>{\"T\":32,\"S\":\"struct\",\"F\":12.07} &lt;nil&gt;\n</code></pre>\n\n<p>which is what I would expect. However, I am able to get two different results when unmarshalling, depending on when I convert an object to a pointer:</p>\n\n<pre><code>// Test 1\nvar o2 interface{} = &amp;o\ne = json.Unmarshal(b, o2)\nfmt.Println(o2, e)\n</code></pre>\n\n<p>prints</p>\n\n<pre><code>// Output 1\n&amp;{32 struct 12.07} &lt;nil&gt;\n</code></pre>\n\n<p>while defining o2 as a value rather than a pointer and then calling Unmarshal with &amp;o2, <i>ie.</i></p>\n\n<pre><code>// Test 2\nvar o2 interface{} = o\ne = json.Unmarshal(b, &amp;o2)\nfmt.Println(o2, e)\n</code></pre>\n\n<p>prints</p>\n\n<pre><code>// Output 2\nmap[T:32 S:struct F:12.07] &lt;nil&gt;\n</code></pre>\n\n<p>Interestingly enough, all four of</p>\n\n<pre><code>// Test 3\nvar o2 Test = o\ne = json.Unmarshal(b, &amp;o2)\nfmt.Println(o2, e)\n</code></pre>\n\n<p>,</p>\n\n<pre><code>// Test 4\nvar o2 *Test = &amp;o\ne = json.Unmarshal(b, &amp;o2)\nfmt.Println(*o2, e)\n</code></pre>\n\n<p>,</p>\n\n<pre><code>// Test 5\nvar o2 *Test = &amp;o\ne = json.Unmarshal(b, o2)\nfmt.Println(o2, e)\n</code></pre>\n\n<p>, and</p>\n\n<pre><code>// Test 6\nvar o2 *Test = &amp;o\ne = json.Unmarshal(b, &amp;o2)\nfmt.Println(o2, e)\n</code></pre>\n\n<p>print one of the following:</p>\n\n<pre><code>// Output 3, 4\n{32 struct 12.07} &lt;nil&gt;\n\n// Output 5, 6\n&amp;{32 struct 12.07} &lt;nil&gt;\n</code></pre>\n\n<p>Tests 1 and 2 lead me to believe that some runtime information is lost when something is assigned to a \"superclass\"... it appears that assigning a pointer to my struct to o2 gives the Unmarshal function more type data about what it should be reading than does assigning my struct to o2 and then passing a pointer to o2 to Unmarshal. This makes a little bit of sense; at compile-time, Test 1 passes an interface{} to Unmarshal, while Test 2 passes a pointer to an interface{}. Even still, I would have thought that the runtime type of the argument would have been the same (a *Test). Can someone explain why Go works this way?</p>\n\n<p>Supporting my conclusion is the fact that declaring o2 as either a Test or a *Test allows Unmarshal (which thus receives a *Test as its argument) to always read my data as a struct rather than a map.</p>\n\n<p>Strangely, Test 4 and Test 6 show that passing a pointer to a pointer to my struct is totally acceptable, and Unmarshal correctly(?) sets the value of the struct. I would have expected a runtime error for those tests, as Unmarshal should have tried to dereference the double pointer and set the resulting pointer to the serialized struct it was reading. Automatic multi-pointer dereferencing might just be a feature of this function, but it wasn't mentioned in the official documentation. I'm not too concerned about these latter tests. I'm mostly just interested in what is going on to cause the difference between Test 1 and Test 2.</p>\n\n<p>**Edited 14 Jan 2018 to change second json.Marshal to json.Unmarshal, remove improper brackets from copy/pasted code</p>\n"}, {"tags": ["http", "go"], "answers": [{"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1547443289, "post_id": 54176096, "comment_id": 95180866, "body": "I&#39;m not quite sure what you are suggesting. Are you saying for when I want to dump request, I concatenate &quot;body&quot;?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1547445441, "post_id": 54176096, "comment_id": 95181358, "body": "@hendry The request body is now in buf and body. Just use any of those two (buf of course) during dumping."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1547446480, "post_id": 54176096, "comment_id": 95181599, "body": "So there is no way to dump the request as I want, with out reading body first and appending. Urgh."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1547447330, "post_id": 54176096, "comment_id": 95181804, "body": "@hendry Of course not. How could that be possible? You can dump the body while reading (a TeeReader is fine here) but httputil.DumpRequest is for dumping a request and a request body can be read just once (which should be obvious)."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1547450570, "post_id": 54176096, "comment_id": 95182766, "body": "Dumping the request is not obviously a one time action to be. Now I am puzzled how to concatenate body onto payload"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1547454244, "post_id": 54176096, "comment_id": 95184138, "body": "@hendry A HTTP request is a stream and clearly not something which can be redone, especially the request body. I have to admit I do not understand what &quot;concatenate body onto payload&quot; could mean and what the actual problem you are trying to solve is."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1547443114, "creation_date": 1547443114, "answer_id": 54176096, "question_id": 54175360, "link": "https://stackoverflow.com/questions/54175360/how-do-i-rewind-an-io-readcloser/54176096#54176096", "title": "How do I rewind an io.ReadCloser", "body": "<blockquote>\n  <p>How do I rewind a io.ReadCloser in Go[...]?</p>\n</blockquote>\n\n<p>You cannot. A ReadCloser can be read and closed. Unless the actual underlying type has some method to rewind you simply cannot.\n(For your case you may just use the bytes.Buffer, possibly after adding a Close method via io/ioutil.ReadCloser as the Request.Body; but this is not \"rewinding\" but \"replacing\".)</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 4, "last_activity_date": 1547449249, "creation_date": 1547449249, "answer_id": 54176956, "question_id": 54175360, "link": "https://stackoverflow.com/questions/54175360/how-do-i-rewind-an-io-readcloser/54176956#54176956", "title": "How do I rewind an io.ReadCloser", "body": "<p>You cannot rewind an <code>io.ReadCloser</code>, unless the underlying value is also an <a href=\"https://golang.org/pkg/io/#ReadSeeker\" rel=\"nofollow noreferrer\"><code>io.ReadSeeker</code></a>.</p>\n\n<p>An <code>io.ReadCloser</code>, by very definition, has exactly two methods: <code>Read</code> and <code>Close</code>. So there is obviously there is no option to rewind.</p>\n\n<p>An <code>io.ReadSeeker</code>, by contrast, has two methods: <code>Read</code> and <code>Seek</code>, the latter which allows rewinding.</p>\n\n<p>If you need to accept only <code>io.ReadCloser</code>s which are also seekable, you can easily combine these two:</p>\n\n<pre><code>type ReadSeekCloser interface {\n    io.Reader\n    io.Seeker\n    io.Closer\n}\n</code></pre>\n\n<p>Now you can use your custom <code>ReadSeekCloser</code> type in place of an <code>io.ReadCloser</code>, and you'll have the option to rewind your reader.</p>\n\n<p>Of course, few <code>io.ReadCloser</code>s in the wild actually conform to this interface (<code>os.File</code> will be the main one that does). If you have an <code>io.ReadCloser</code> that does not implement the <code>Seek</code> method (such as a network stream), probably the easiest way to make it <code>Seek</code>able is to dump the contents to a file, then open that file. There would be other ways to make an in-memory buffer seekable (<code>bytes.NewReader</code> for instance), but variations will require reading the stream into memory or onto disk, first.</p>\n"}, {"tags": [], "owner": {"reputation": 15752, "user_id": 16998, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/PstY2.jpg?s=128&g=1", "display_name": "jrwren", "link": "https://stackoverflow.com/users/16998/jrwren"}, "is_accepted": false, "score": 1, "last_activity_date": 1547482868, "creation_date": 1547482868, "answer_id": 54185327, "question_id": 54175360, "link": "https://stackoverflow.com/questions/54175360/how-do-i-rewind-an-io-readcloser/54185327#54185327", "title": "How do I rewind an io.ReadCloser", "body": "<p>Request bodies aren't seek-able. There is no rewind, they aren't buffered in memory. When that data is read, it is read from the network stream. Imagine a large upload, buffering all of that data in memory by default would be wasteful.</p>\n\n<p>That said, there are some things you can do to get the output you desire. It involves replacing r.Body after you've read it.</p>\n\n<p>You mention wishing for a lint check. I've found that declaring a buffer and using only that buffer can help. If you like, you can even replace r.Body with that buffer. You will still need to remember to \"rewind\" with Seek.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        var body ReedSeekCloser // Declare body as this interface, now it is a little easier to remember to use body, and it is seekable.\n        body = &amp;bytes.Buffer{}\n        _, err := io.Copy(body, r.Body)\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusBadRequest)\n            return\n        }\n        log.Println(\"body\", string(body))\n        r.Body = body\n        body.Seek(0, 0)\n        payload, err := httputil.DumpRequest(r, true)\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n            return\n        }\n        log.Println(\"dump request\", string(payload))\n        w.WriteHeader(http.StatusOK)\n    })\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "is_accepted": false, "score": 1, "last_activity_date": 1547642864, "creation_date": 1547642864, "answer_id": 54217407, "question_id": 54175360, "link": "https://stackoverflow.com/questions/54175360/how-do-i-rewind-an-io-readcloser/54217407#54217407", "title": "How do I rewind an io.ReadCloser", "body": "<p><a href=\"https://golang.org/pkg/net/http/httputil/#DumpRequest\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/httputil/#DumpRequest</a></p>\n\n<blockquote>\n  <p>DumpRequest returns the given request in its HTTP/1.x wire representation. It should only be used by servers to debug client requests.</p>\n</blockquote>\n\n<p>Clearly DumpRequest is for Dubug use.</p>\n\n<p>But if you don't care about that. The godoc also metioned:</p>\n\n<blockquote>\n  <p>If body is true, DumpRequest also returns the body. To do so, it consumes req.Body and then replaces it with a new io.ReadCloser that yields the same bytes. </p>\n</blockquote>\n\n<p>So you can call DumpRequest first then ReadAll from Body, cause the Body is still the same after DumpRequest.</p>\n\n<pre><code>func main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        payload, err := httputil.DumpRequest(r, true)\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n            return\n        }\n        log.Println(\"dump request\", string(payload))        \n\n        body, err := ioutil.ReadAll(r.Body)\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusBadRequest)\n            return\n        }\n        log.Println(\"body\", string(body))\n        w.WriteHeader(http.StatusOK)\n    })\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4240, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1599719959, "creation_date": 1547435683, "last_edit_date": 1599719959, "question_id": 54175360, "link": "https://stackoverflow.com/questions/54175360/how-do-i-rewind-an-io-readcloser", "title": "How do I rewind an io.ReadCloser", "body": "<p>I'm perpetually caught out by reading an <strong>io.ReadCloser</strong> and then forgetting that I've read it before, and when I read it again, I get an empty payload. I wish there was some lint check for my stupidity. Nonetheless, I think I can use TeeReader, but it fails to meet my expectations here:</p>\n\n<pre><code>func main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        buf := &amp;bytes.Buffer{}\n        tee := io.TeeReader(r.Body, buf)\n        body, err := ioutil.ReadAll(tee)\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusBadRequest)\n            return\n        }\n        log.Println(\"body\", string(body))\n        payload, err := httputil.DumpRequest(r, true)\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n            return\n        }\n        log.Println(\"dump request\", string(payload))\n        w.WriteHeader(http.StatusOK)\n    })\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>The body is missing from my \"dump request\" log line.</p>\n\n<p>I.e. when I run <code>curl -i -X POST --data '{\"username\":\"xyz\",\"password\":\"xyz\"}' http://localhost:8080</code></p>\n\n<p>I want the original request in full:</p>\n\n<pre><code>2019/01/14 11:09:50 dump request POST / HTTP/1.1\nHost: localhost:8080\nAccept: */*\nContent-Length: 35\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: curl/7.63.0\n\n{\"username\":\"xyz\",\"password\":\"xyz\"}\n</code></pre>\n\n<p>What am I missing?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "is_accepted": false, "score": 1, "last_activity_date": 1547430403, "creation_date": 1547430403, "answer_id": 54174904, "question_id": 54174618, "link": "https://stackoverflow.com/questions/54174618/is-golang-sync-map-range-function-thread-safe/54174904#54174904", "title": "Is golang sync.Map Range function thread safe?", "body": "<p>You hit it pretty spot on.</p>\n\n<p>Basically, this works the same way you'd use <code>for</code>: You're just grabbing a count up front, and then iterating each value you expect to exist.</p>\n\n<p>Ideally, if you have to worry about concurrency on the map, you should make a copy that you then iterate, or implement a <code>sync.Mutex</code> around it.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1547433527, "creation_date": 1547433527, "answer_id": 54175179, "question_id": 54174618, "link": "https://stackoverflow.com/questions/54174618/is-golang-sync-map-range-function-thread-safe/54175179#54175179", "title": "Is golang sync.Map Range function thread safe?", "body": "<p>Read all the documentation, including this part.</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow noreferrer\">Package sync</a></p>\n  \n  <p>import \"sync\" </p>\n  \n  <p><a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\">type Map 1.9</a></p>\n  \n  <p>Map is like a Go map[interface{}]interface{} but is safe for\n  concurrent use by multiple goroutines without additional locking or\n  coordination. Loads, stores, and deletes run in amortized constant\n  time.</p>\n  \n  <p>The Map type is specialized. Most code should use a plain Go map\n  instead, with separate locking or coordination, for better type safety\n  and to make it easier to maintain other invariants along with the map\n  content.</p>\n  \n  <p>The Map type is optimized for two common use cases: (1) when the entry\n  for a given key is only ever written once but read many times, as in\n  caches that only grow, or (2) when multiple goroutines read, write,\n  and overwrite entries for disjoint sets of keys. In these two cases,\n  use of a Map may significantly reduce lock contention compared to a Go\n  map paired with a separate Mutex or RWMutex.</p>\n</blockquote>\n\n<hr>\n\n<p>By design, <code>sync.Map</code> is thread safe. <code>sync.Map</code> is a special purpose map with limited uses. </p>\n\n<blockquote>\n  <p>Most code should use a plain Go map instead, with separate locking or\n  coordination, for better type safety and to make it easier to maintain\n  other invariants along with the map content.</p>\n</blockquote>\n\n<p>Don't add an additional layer of locking to <code>sync.Map</code>. Use a different algorithm or follow advice and use a plain Go <code>map</code> with separate locking or coordination.</p>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow noreferrer\">Package sync</a></p>\n  \n  <p>import \"sync\" </p>\n  \n  <p>func (*Map) Range 1.9</p>\n\n<pre><code>func (m *Map) Range(f func(key, value interface{}) bool)\n</code></pre>\n  \n  <p>Range calls f sequentially for each key and value present in the map.\n  If f returns false, range stops the iteration.</p>\n  \n  <p>Range does not necessarily correspond to any consistent snapshot of\n  the Map's contents: no key will be visited more than once, but if the\n  value for any key is stored or deleted concurrently, Range may reflect\n  any mapping for that key from any point during the Range call.</p>\n  \n  <p>Range may be O(N) with the number of elements in the map even if f\n  returns false after a constant number of calls.</p>\n</blockquote>\n\n<hr>\n\n<p>The weak invariants on <code>sync.Map</code> <code>Range</code> mean that it's often not very useful.</p>\n"}], "owner": {"reputation": 169, "user_id": 6513915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04fcbd92e7c84194bdb9b93197e64337?s=128&d=identicon&r=PG&f=1", "display_name": "J L", "link": "https://stackoverflow.com/users/6513915/j-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4084, "favorite_count": 2, "answer_count": 2, "score": 1, "last_activity_date": 1547433527, "creation_date": 1547427187, "question_id": 54174618, "link": "https://stackoverflow.com/questions/54174618/is-golang-sync-map-range-function-thread-safe", "title": "Is golang sync.Map Range function thread safe?", "body": "<p>From the <a href=\"https://golang.org/pkg/sync/#Map.Range\" rel=\"nofollow noreferrer\">doc</a></p>\n\n<pre><code>Range does not necessarily correspond to any consistent snapshot of the \nMap's contents: no key will be visited more than once, but if the value \nfor any key is stored or deleted concurrently, Range may reflect any \nmapping for that key from any point during the Range call.\n\n</code></pre>\n\n<p>Does this mean that no read lock is invoked during range call and user must implements his own mutex in order for <code>Range</code> call to be thread safe?</p>\n"}, {"tags": ["json", "database", "go", "boltdb"], "comments": [{"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1547426535, "post_id": 54174240, "comment_id": 95177999, "body": "You are not checking error after calling <code>t.transfer(b, 40000)</code>. Something fails and you not see that."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1547428059, "last_edit_date": 1547428059, "creation_date": 1547427615, "answer_id": 54174661, "question_id": 54174240, "link": "https://stackoverflow.com/questions/54174240/how-can-i-ensure-that-all-of-my-write-transaction-functions-get-resolved-in-orde/54174661#54174661", "title": "How can I ensure that all of my write transaction functions get resolved in order? Also, why is the else function not executing?", "body": "<p>You return unconditionally:</p>\n\n<pre><code>c := uBuck\n\nerr = c.Put([]byte(to.username), encoded2)\nreturn err\n\nfmt.Println(\"Success!\")\n\nerr = c.Put([]byte(from.username), encoded)\nreturn err\n\nfmt.Println(\"Success!\")\n</code></pre>\n\n<p>You are not returning and checking errors.</p>\n\n<pre><code>json.Unmarshal(uBuck.Get([]byte(from.username)), &amp;fbalance)\njson.Unmarshal(uBuck.Get([]byte(to.username)), &amp;tbalance)\n\nt.transfer(b, 40000)\n</code></pre>\n\n<p>And so on.</p>\n\n<hr>\n\n<p>Debug your code statement by statement.</p>\n"}], "owner": {"reputation": 3, "user_id": 5584175, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SD6x0MJtJnc/AAAAAAAAAAI/AAAAAAAAAFs/P-zbutB-6iU/photo.jpg?sz=128", "display_name": "FlyinOrion", "link": "https://stackoverflow.com/users/5584175/flyinorion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 1, "accepted_answer_id": 54174661, "answer_count": 1, "score": -2, "last_activity_date": 1547428059, "creation_date": 1547422890, "question_id": 54174240, "link": "https://stackoverflow.com/questions/54174240/how-can-i-ensure-that-all-of-my-write-transaction-functions-get-resolved-in-orde", "title": "How can I ensure that all of my write transaction functions get resolved in order? Also, why is the else function not executing?", "body": "<p>I'm trying to create a very simple Bolt database called \"ledger.db\" that includes one Bucket, called \"Users\", which contains Usernames as a Key and Balances as the value that allows users to transfer their balance to one another. I am using Bolter to view the database in the command line</p>\n\n<p>There are two problems, both contained in this transfer function issue resides in the transfer function. </p>\n\n<p>The First: Inside the transfer function is an if/else. If the condition is true, it executes as it should. If it's false, nothing happens. There's no syntax errors and the program runs as though nothing is wrong, it just doesn't execute the else statement.</p>\n\n<p>The Second: Even if the condition is true, when it executes, it doesn't update BOTH the respective balance values in the database. It updates the balance of the receiver, but it doesn't do the same for the sender. The mathematical operations are completed and the values are marshaled into a JSON-compatible format.</p>\n\n<p>The problem is that the sender balance is not updated in the database.</p>\n\n<p>Everything from the second \"Success!\" fmt.Println() function onward is not processed</p>\n\n<p>I've tried changing the \"db.Update()\" to \"db.Batch()\". I've tried changing the order of the Put() functions. I've tried messing with goroutines and defer, but I have no clue how to use those, as I am rather new to golang.</p>\n\n<pre><code>func (from *User) transfer(to User, amount int) error{\n        var fbalance int = 0\n        var tbalance int = 0\n\n        db, err := bolt.Open(\"ledger.db\", 0600, nil)\n        if err != nil {\n              log.Fatal(err)\n        }\n        defer db.Close()\n\n\n\n        return db.Update(func(tx *bolt.Tx) error {\n              uBuck := tx.Bucket([]byte(\"Users\"))\n\n              json.Unmarshal(uBuck.Get([]byte(from.username)), &amp;fbalance)\n              json.Unmarshal(uBuck.Get([]byte(to.username)), &amp;tbalance)\n\n              if (amount &lt;= fbalance) {\n                fbalance = fbalance - amount\n\n                encoded, err := json.Marshal(fbalance)\n                if err != nil {\n                  return err\n                }\n\n                tbalance = tbalance + amount\n\n                encoded2, err := json.Marshal(tbalance)\n                if err != nil {\n                  return err\n                }\n\n                fmt.Println(\"Success!\")\n\n                c := uBuck\n\n                err = c.Put([]byte(to.username), encoded2)\n                return err\n\n                fmt.Println(\"Success!\")\n\n                err = c.Put([]byte(from.username), encoded)\n                return err\n\n                fmt.Println(\"Success!\")\n\n              } else {\n                return fmt.Errorf(\"Not enough in balance!\", amount)\n              }\n\n\n\n            return nil\n\n\n        })\n\n\n\n\n        return nil\n}\n\nfunc main() {\n    /*\n    db, err := bolt.Open(\"ledger.db\", 0600, nil)\n    if err != nil {\n          log.Fatal(err)\n        }\n    defer db.Close()\n    */\n\n    var b User = User{\"Big\", \"jig\", 50000, 0}\n    var t User = User{\"Trig\", \"pig\", 40000, 0}\n\n    // These two functions add each User to the database, they aren't \n    // the problem\n    b.createUser()\n    t.createUser()\n\n    /*\n    db.View(func(tx *bolt.Tx) error {\n      c := tx.Bucket([]byte(\"Users\"))\n      get := c.Get([]byte(b.username))\n      fmt.Printf(\"The return value %v\",get)\n\n      return nil\n\n    })\n    */\n\n    t.transfer(b, 40000)\n\n\n}\n\n</code></pre>\n\n<p>I expect the database to show Big:90000 Trig:0 from the beginning values of Big:50000 Trig:40000</p>\n\n<p>Instead, the program outputs Big:90000 Trig:40000</p>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1547476625, "post_id": 54173885, "comment_id": 95195380, "body": "&quot;All documentation I can find seems to indicate that a struct should be created for all JSON responses/requests&quot; - where do you see this? It&#39;s absolutely not required. The default for a JSON object is a <code>map[string]interface{}</code>. But structs are generally a lot easier to work with, including for large responses (really, <i>especially</i> for large, deeply-nested responses, to avoid a ton of checks and assertions)."}], "answers": [{"tags": [], "owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "is_accepted": true, "score": 2, "last_activity_date": 1547423152, "last_edit_date": 1547423152, "creation_date": 1547422780, "answer_id": 54174232, "question_id": 54173885, "link": "https://stackoverflow.com/questions/54173885/go-handling-json-responses-and-requests/54174232#54174232", "title": "Go handling JSON Responses and Requests", "body": "<p>In most cases, you'll want to simply utilize json.Unmarshal. This usecase works most of the time:</p>\n\n<pre><code>var myClient = &amp;http.Client{Timeout: 10 * time.Second}\n\nfunc getJson(url string, target interface{}) error {\n    r, err := myClient.Get(url)\n    if err != nil {\n        return err\n    }\n    defer r.Body.Close()\n\n    return json.NewDecoder(r.Body).Decode(target)\n}\n\nfoo := Foo{}\ngetJson(\"http://example.com\", &amp;foo2)\nfmt.Printf(\"%+v\\n\", foo)\n</code></pre>\n\n<p>However, if you're truly working with a large dataset, check out <a href=\"https://golang.org/pkg/encoding/json/#example_Decoder_Decode_stream\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/#example_Decoder_Decode_stream</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"strings\"\n)\n\nfunc main() {\n    const jsonStream = `\n    [\n        {\"Name\": \"Ed\", \"Text\": \"Knock knock.\"},\n        {\"Name\": \"Sam\", \"Text\": \"Who's there?\"},\n        {\"Name\": \"Ed\", \"Text\": \"Go fmt.\"},\n        {\"Name\": \"Sam\", \"Text\": \"Go fmt who?\"},\n        {\"Name\": \"Ed\", \"Text\": \"Go fmt yourself!\"}\n    ]\n`\n    type Message struct {\n        Name, Text string\n    }\n    dec := json.NewDecoder(strings.NewReader(jsonStream))\n\n    // read open bracket\n    t, err := dec.Token()\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"%T: %v\\n\", t, t)\n\n    // while the array contains values\n    for dec.More() {\n        var m Message\n        // decode an array value (Message)\n        err := dec.Decode(&amp;m)\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        fmt.Printf(\"%v: %v\\n\", m.Name, m.Text)\n    }\n\n    // read closing bracket\n    t, err = dec.Token()\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"%T: %v\\n\", t, t)\n\n}\n</code></pre>\n\n<p>This will allow you to work in a more memory efficient way.</p>\n\n<p>To more of your question:</p>\n\n<ol>\n<li>Do I have to unmarshal to a full response struct? - Not really, you only have to define what you want to use in the struct, the rest will be ignored</li>\n<li>Are you doing it right? - You're not doing anything inherently wrong?</li>\n</ol>\n\n<p>If there's something I didn't answer, please let me know.</p>\n\n<p><strong>Edit:</strong> To your usage of <code>ioutil.ReadAll</code> - Generally speaking, you'll want to unmarshal into a struct so you can actually <em>use</em> the data, and benefit from type safety via your structs. If you literally just need the string, what you're doing is fine, but usually that's not the case.</p>\n"}], "owner": {"reputation": 79, "user_id": 7583410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e75838fe04d594f40feb46001c3e1a79?s=128&d=identicon&r=PG&f=1", "display_name": "John Baker", "link": "https://stackoverflow.com/users/7583410/john-baker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 571, "favorite_count": 0, "accepted_answer_id": 54174232, "answer_count": 1, "score": 0, "last_activity_date": 1547423152, "creation_date": 1547419254, "question_id": 54173885, "link": "https://stackoverflow.com/questions/54173885/go-handling-json-responses-and-requests", "title": "Go handling JSON Responses and Requests", "body": "<p>I'm relatively new to Go, and while I have a pretty good grasp on understanding most of it so far, I can't exactly figure out how JSON is supposed to be handled. </p>\n\n<p>So let's say I have an access token on the front end. I want to pass it go and want to make a request to an API to validate it.</p>\n\n<p>This is the json being passed to the backend:</p>\n\n<pre><code>{\n   \"accessToken\": \"xxxxxx\"\n}\n\n\ntype test_struct struct {\n    AccessToken string `json:\"accessToken\"`\n}\n\nfunc validateFacebookLogin(w http.ResponseWriter, r *http.Request) {\n    decoder := json.NewDecoder(r.Body)\n    var t test_struct\n    err := decoder.Decode(&amp;t)\n    if err != nil {\n        panic(err)\n    }\n    tokenCheck := \"xxxxxxxxx|xxxxxxxxxxxxxxxxxxxxxxxxxxx\"\n    req, err := http.NewRequest(\"GET\", \"https://graph.facebook.com/debug_token\", nil)\n    if err != nil {\n        log.Print(err)\n        os.Exit(1)\n    }\n    q := req.URL.Query()\n\n    q.Add(\"input_token\", t.AccessToken)\n    q.Add(\"access_token\", tokenCheck)\n    req.URL.RawQuery = q.Encode()\n    resp, err := http.Get(req.URL.String())\n    defer resp.Body.Close()\n    bodyBytes, _ := ioutil.ReadAll(resp.Body)\n    bodyString := string(bodyBytes)\n    fmt.Println(bodyString);\n    json.NewEncoder(w).Encode(map[string]string{\"message\": \"FINE\"})\n    json.NewEncoder(w).Encode(resp)\n\n}\n</code></pre>\n\n<p>All documentation I can find seems to indicate that a struct should be created for all JSON responses/requests (unless I'm misunderstanding). Isn't that kind of inconvenient? What if I have an incredibly large nested JSON response? Do I have to create struct of the COMPLETE response? </p>\n\n<p>Is the method I'm using above with ioutil bad practice? Where I could just pass back an entire string representation and manage decoding it on the front-end?</p>\n\n<p>I guess my main question is, when should I be assign my JSON to a struct? What are considered the best practices? If I intent on just returning the response immediately to the front end, is there any point it? </p>\n\n<p>And assuming I do want to maintain the data on the back end, is there any \"better\" method for handling large responses?</p>\n"}, {"tags": ["go", "linker", "shared-objects"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547481646, "post_id": 54173791, "comment_id": 95198362, "body": "possible duplicate: <a href=\"https://stackoverflow.com/questions/54064390/remove-hosts-source-code-from-plugin-to-reduce-file-size\" title=\"remove hosts source code from plugin to reduce file size\">stackoverflow.com/questions/54064390/&hellip;</a>"}], "owner": {"reputation": 123, "user_id": 709553, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/4147d40e748051e6f5cc9c806835b674?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/709553/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1547418365, "creation_date": 1547418365, "question_id": 54173791, "link": "https://stackoverflow.com/questions/54173791/golang-declare-plugin-export-list", "title": "Golang declare plugin export list", "body": "<p>I'm trying to reduce the size of a shared object produced by go plugin. (Building with 'go build -buildmode=plugin').\nAs it seems from disassembling the SO, all the public symbols are exported, so the linker cannot remove unused code as it does in executables, resulting with a bloated file size.\nIs there any way to specify explicitly which symbols I want to export, so the linker could remove the unused code from the binary?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5287, "user_id": 1813169, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wTAkF.jpg?s=128&g=1", "display_name": "MTCoster", "link": "https://stackoverflow.com/users/1813169/mtcoster"}, "edited": false, "score": 0, "creation_date": 1547401207, "post_id": 54171426, "comment_id": 95171840, "body": "Because <code>255 * 254 = 64770</code> and <code>64770 % 256 = 2</code>."}, {"owner": {"reputation": 1569, "user_id": 2819689, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/07cce556c9a96b1ec9622df191fc651c?s=128&d=identicon&r=PG&f=1", "display_name": "MikiBelavista", "link": "https://stackoverflow.com/users/2819689/mikibelavista"}, "reply_to_user": {"reputation": 5287, "user_id": 1813169, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wTAkF.jpg?s=128&g=1", "display_name": "MTCoster", "link": "https://stackoverflow.com/users/1813169/mtcoster"}, "edited": false, "score": 0, "creation_date": 1547401508, "post_id": 54171426, "comment_id": 95171921, "body": "ok,thanks,I understand now."}], "answers": [{"tags": [], "owner": {"reputation": 5287, "user_id": 1813169, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wTAkF.jpg?s=128&g=1", "display_name": "MTCoster", "link": "https://stackoverflow.com/users/1813169/mtcoster"}, "is_accepted": true, "score": 2, "last_activity_date": 1547402250, "creation_date": 1547402250, "answer_id": 54171643, "question_id": 54171426, "link": "https://stackoverflow.com/questions/54171426/how-to-calculate-golang-overflow/54171643#54171643", "title": "How to calculate golang overflow?", "body": "<p>You\u2019ve already hinted at overflow, and in fact this is exactly what\u2019s happening here. You already know what <code>u</code> and <code>u-1</code> are (255 and 254 respectively), so let\u2019s multiply those together. This gives us 64770, or in binary:</p>\n\n<pre><code>64770       = 1111 1101 0000 0010\n</code></pre>\n\n<p>This result is 16 bits wide, but we\u2019re storing it in a <code>uint8</code> which is only 8 bits wide. It is therefore truncated to the 8 <em>least significant</em> bits. Mathematically, this is equivalent to performing <strong>64770 mod 2^8</strong> or <strong>64770 mod 256</strong>. Programatically, it\u2019s equivalent to performing <code>64770 &amp; (1 &lt;&lt; 7)</code> or <code>64770 &amp; 256</code>:</p>\n\n<pre><code>64770       = 1111 1101 0000 0010\n256         =           1111 1111\n64770 &amp; 256 = 0000 0000 0000 0010 = 2\n</code></pre>\n\n<p>However you chose to imagine this operation, the result is 2.</p>\n"}], "owner": {"reputation": 1569, "user_id": 2819689, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/07cce556c9a96b1ec9622df191fc651c?s=128&d=identicon&r=PG&f=1", "display_name": "MikiBelavista", "link": "https://stackoverflow.com/users/2819689/mikibelavista"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 54171643, "answer_count": 1, "score": 0, "last_activity_date": 1547402250, "creation_date": 1547400828, "question_id": 54171426, "link": "https://stackoverflow.com/questions/54171426/how-to-calculate-golang-overflow", "title": "How to calculate golang overflow?", "body": "<p>I am a newbie to Golang</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var u uint8 = 255\n    var m uint16 = 255\n    fmt.Println(u, u-1, u*(u-1))\n    fmt.Println(m, m+1, m*m)\n}\n</code></pre>\n\n<p>OUTPUT</p>\n\n<pre><code>./g2\n255 254 2\n255 256 65025\n</code></pre>\n\n<p>I understand that I have overflow in the first case. But why did I get 2 as a result?</p>\n"}, {"tags": ["go", "constants"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 1, "creation_date": 1547402825, "post_id": 54169786, "comment_id": 95172311, "body": "Two universal answers: (1) if it really matters, write a benchmark and measure it.  (2) unless it changes the algorithmic complexity or involves I/O in some form, it doesn&#39;t really matter.  (Even if one form causes a cache miss and the other doesn&#39;t, you will never notice in most typical programs.)"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1547409367, "post_id": 54169786, "comment_id": 95174252, "body": "What happens is dependent on the compiler and not on the language so nobody can tell."}], "answers": [{"comments": [{"owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "edited": false, "score": 0, "creation_date": 1547399020, "post_id": 54170033, "comment_id": 95171233, "body": "Could you please elaborate on what you mean by &quot;swapped out at every reference during compilation&quot;? I&#39;m not yet familiar enough with compilation in Go am looking to understand this question/answer better. I had assumed, naively I suppose, that constants would be in the stack frame for their scope, conferring some performance benefit."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1547409077, "post_id": 54170033, "comment_id": 95174167, "body": "When your program is compiled, the value of the constant is compiled directly into your code at the points where it is used. There is no difference between defining a constant with the value 3 and using that as opposed to using the literal value 3."}, {"owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "edited": false, "score": 0, "creation_date": 1547467117, "post_id": 54170033, "comment_id": 95190355, "body": "So there is no memory allocation involved in defining the constant? And/or no memory calls when the constant is used?"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1548516620, "post_id": 54170033, "comment_id": 95573039, "body": "correct, no unique allocation happens because you used a const.   Obviously, the value of the const is in memory somewhere.   but as @AndySchweig said, it&#39;s the same as if you just put the literal wherever you would have used a const"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 5, "last_activity_date": 1547392129, "last_edit_date": 1547392129, "creation_date": 1547391142, "answer_id": 54170033, "question_id": 54169786, "link": "https://stackoverflow.com/questions/54169786/is-there-a-difference-between-constants-defined-inside-a-go-function-vs-ones-def/54170033#54170033", "title": "Is there a difference between constants defined inside a Go function vs ones defined at the top of a package?", "body": "<p>The only difference is scoping</p>\n\n<p>Constants are simply swapped out at every reference during compilation.<br>\nSo there's no difference at run time as to where it came from.</p>\n"}], "owner": {"reputation": 67, "user_id": 5193703, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/427cd29dd05973dcf64d232e3bd0f96f?s=128&d=identicon&r=PG&f=1", "display_name": "gil shelef", "link": "https://stackoverflow.com/users/5193703/gil-shelef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1547392129, "creation_date": 1547389299, "question_id": 54169786, "link": "https://stackoverflow.com/questions/54169786/is-there-a-difference-between-constants-defined-inside-a-go-function-vs-ones-def", "title": "Is there a difference between constants defined inside a Go function vs ones defined at the top of a package?", "body": "<p>Is there a difference, mainly in performance, between constants defined inside vs outside a function scope?</p>\n\n<pre><code>func (this *Person) SetDefaults() *Person{\n    const (\n        defaultFirstName = \"first\"\n        defaultLastName  = \"last\"\n    )\n\n    //do stuff with constants\n    return this\n}\n</code></pre>\n\n<p>vs.</p>\n\n<pre><code>const (\n    defaultFirstName = \"first\"\n    defaultLastName  = \"last\"\n)\nfunc (this *Person) SetDefaults() *Person{\n    //do stuff with constants\n    return this\n}  \n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 20968, "user_id": 2564301, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a6b5734cdcb5ce19598ccf9a7d8cc1ff?s=128&d=identicon&r=PG&f=1", "display_name": "Jongware", "link": "https://stackoverflow.com/users/2564301/jongware"}, "edited": false, "score": 1, "creation_date": 1547384269, "post_id": 54169068, "comment_id": 95167011, "body": "Does <code>Printf</code> in Go automatically display a fixed number of decimals? Is it possible to print more?"}, {"owner": {"reputation": 4059, "user_id": 5832842, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/656131bd44fe54e1d5ff70048310807c?s=128&d=identicon&r=PG&f=1", "display_name": "Bram  Vanbilsen", "link": "https://stackoverflow.com/users/5832842/bram-vanbilsen"}, "reply_to_user": {"reputation": 20968, "user_id": 2564301, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a6b5734cdcb5ce19598ccf9a7d8cc1ff?s=128&d=identicon&r=PG&f=1", "display_name": "Jongware", "link": "https://stackoverflow.com/users/2564301/jongware"}, "edited": false, "score": 0, "creation_date": 1547384465, "post_id": 54169068, "comment_id": 95167060, "body": "@usr2564301 That is it! Thanks for the fast reply."}], "answers": [{"comments": [{"owner": {"reputation": 2329, "user_id": 1363486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d556e3afbb20ad2623b46413d1cb345?s=128&d=identicon&r=PG", "display_name": "Marco Pantaleoni", "link": "https://stackoverflow.com/users/1363486/marco-pantaleoni"}, "edited": false, "score": 0, "creation_date": 1547457082, "post_id": 54169276, "comment_id": 95185336, "body": "Probably you do already know it, but it maybe useful to remember that not all decimal numbers keep their representation in floating point. For example 100.100 printed with 15 decimal digits would give &quot;100.099999999999994&quot;, or 100.499 would give 100.498999999999995"}], "tags": [], "owner": {"reputation": 4059, "user_id": 5832842, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/656131bd44fe54e1d5ff70048310807c?s=128&d=identicon&r=PG&f=1", "display_name": "Bram  Vanbilsen", "link": "https://stackoverflow.com/users/5832842/bram-vanbilsen"}, "is_accepted": false, "score": 3, "last_activity_date": 1547386334, "last_edit_date": 1547386334, "creation_date": 1547385692, "answer_id": 54169276, "question_id": 54169068, "link": "https://stackoverflow.com/questions/54169068/does-converting-a-string-to-a-float-lose-precision/54169276#54169276", "title": "Does converting a string to a float lose precision?", "body": "<p>The problem was not that the string was not correctly converted, but that <code>Printf</code> does, by default, not output the complete fractional part if it is long.\nThe following code prints the same as the original code but with 10 numbers after the decimal point:</p>\n\n<pre><code>origVal := \"0.00000628\"\nconvVal, err := strconv.ParseFloat(origVal, 64)\nif err == nil &amp;&amp; err2 ==nil {\n    fmt.Printf(\"Original value: %s\\nConverted value: %.10f\\n\", origVal, convVal)\n}\n</code></pre>\n\n<p>Thanks to @usr2564301 for the quick reply!</p>\n"}], "owner": {"reputation": 4059, "user_id": 5832842, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/656131bd44fe54e1d5ff70048310807c?s=128&d=identicon&r=PG&f=1", "display_name": "Bram  Vanbilsen", "link": "https://stackoverflow.com/users/5832842/bram-vanbilsen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1547419252, "creation_date": 1547383986, "last_edit_date": 1547419252, "question_id": 54169068, "link": "https://stackoverflow.com/questions/54169068/does-converting-a-string-to-a-float-lose-precision", "title": "Does converting a string to a float lose precision?", "body": "<h1>Problem</h1>\n\n<p>When converting a <code>string</code> to a <code>float64</code>, the fractional part of the <code>float64</code> loses a significant amount of numbers.</p>\n\n<h1>Code</h1>\n\n<pre><code>origVal := \"0.00000628\"\nconvVal, err := strconv.ParseFloat(origVal, 64)\nif err == nil {\n    fmt.Printf(\"Original value: %s\\nConverted value: %f\\n\", origVal, convVal)\n}\n</code></pre>\n\n<p>Outputs:</p>\n\n<pre><code>Original value: 0.00000628\nConverted value: 0.000006\n</code></pre>\n\n<p>The code is available on the Go Playground: <a href=\"https://play.golang.org/p/a8fH_JGug7l\" rel=\"nofollow noreferrer\">https://play.golang.org/p/a8fH_JGug7l</a></p>\n\n<h1>Context</h1>\n\n<p>I am pulling data from an API. This API stringifies floating point numbers. I convert these stringified numbers to floats because I want to do some basic arithmetics on them.<br>\nI am fairly new to Go, so my apologies if the answer is straightforward.</p>\n"}, {"tags": ["python", "go", "google-cloud-functions", "google-cloud-dataflow", "apache-beam"], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 10907445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e37ae7842168f820d588d3784f8a23f5?s=128&d=identicon&r=PG&f=1", "display_name": "mdtp", "link": "https://stackoverflow.com/users/10907445/mdtp"}, "edited": false, "score": 0, "creation_date": 1550237210, "post_id": 54168408, "comment_id": 96206012, "body": "Hey John, thanks for your answer. I found that the Apache Beam Go SDK supports <code>worker_binary</code> parameter which is similar to <code>template-location</code> for Java Dataflow jobs. Using this option, I was able to kick off a go dataflow job from my python cloud function."}], "tags": [], "owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "is_accepted": false, "score": 3, "last_activity_date": 1547379067, "creation_date": 1547379067, "answer_id": 54168408, "question_id": 54168079, "link": "https://stackoverflow.com/questions/54168079/how-to-call-a-dataflow-job-written-in-go-from-cloud-functions-in-gcp/54168408#54168408", "title": "How to call a Dataflow job written in Go from Cloud Functions in GCP", "body": "<blockquote>\n  <p>the Cloud Function should be written in Python</p>\n</blockquote>\n\n<p>The Cloud Dataflow Client SDK can only create Dataflow jobs from templates. Therefore this requirement cannot be achieved unless you create your own template.</p>\n\n<blockquote>\n  <p>I have a restriction that the Cloud Dataflow job should be written in\n  Go</p>\n</blockquote>\n\n<p>Since your Python objective cannot be achieved, your other option is to run your Go program in Cloud Functions. Cloud Functions for Go is in <code>alpha</code>. However, I know of no method to execute an Apache Beam (Dataflow) program in Cloud Functions. Keep in mind that an Apache Beam programs begins execution locally and connects itself to a cluster running somewhere else (Dataflow, Spark, etc.) unless you select <code>runner=DirectRunner</code>.</p>\n\n<p>You have chosen the least mature language to use Apache Beam. The order of maturity and features is Java (excellent), Python (good and getting better everyday), Go (not ready yet for primetime).</p>\n\n<p>If you want to run Apache Beam programs written in Go on Cloud Dataflow, then you will need to use a platform such as your local system, Google Compute Engine or Google App Engine Flex. I do not know if App Engine Standard can run Apache Beam in Go.</p>\n"}, {"tags": [], "owner": {"reputation": 121, "user_id": 10907445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e37ae7842168f820d588d3784f8a23f5?s=128&d=identicon&r=PG&f=1", "display_name": "mdtp", "link": "https://stackoverflow.com/users/10907445/mdtp"}, "is_accepted": true, "score": 3, "last_activity_date": 1550760908, "creation_date": 1550760908, "answer_id": 54809957, "question_id": 54168079, "link": "https://stackoverflow.com/questions/54168079/how-to-call-a-dataflow-job-written-in-go-from-cloud-functions-in-gcp/54809957#54809957", "title": "How to call a Dataflow job written in Go from Cloud Functions in GCP", "body": "<p>I found out that the Apache Beam Go SDK supports <code>worker_binary</code> parameter which is similar to <code>template-location</code> for Java Dataflow jobs. Using this option, I was able to kick off a go dataflow job from my python cloud function.</p>\n"}], "owner": {"reputation": 121, "user_id": 10907445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e37ae7842168f820d588d3784f8a23f5?s=128&d=identicon&r=PG&f=1", "display_name": "mdtp", "link": "https://stackoverflow.com/users/10907445/mdtp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 740, "favorite_count": 1, "accepted_answer_id": 54809957, "answer_count": 2, "score": 4, "last_activity_date": 1567083130, "creation_date": 1547376319, "question_id": 54168079, "link": "https://stackoverflow.com/questions/54168079/how-to-call-a-dataflow-job-written-in-go-from-cloud-functions-in-gcp", "title": "How to call a Dataflow job written in Go from Cloud Functions in GCP", "body": "<p>My goal is creating a mechanism that when a new file is uploaded into the Cloud Storage, it'll trigger a Cloud Function. Eventually, this Cloud function will trigger a Cloud Dataflow job.</p>\n\n<p>I have a restriction that the Cloud Dataflow job should be written in Go, and the Cloud Function should be written in Python. </p>\n\n<p>The problem I have been facing right now is, I cannot call Cloud Dataflow job from a Cloud Function.</p>\n\n<p>The problem in Cloud Dataflow written in Go is there is no <code>template-location</code> variable defined in Apache Beam Go SDK. That's why I cannot create dataflow templates. And, since there is no dataflow templates, the only way that I can call Cloud Dataflow job from a cloud function is writing a Python job which calls a bash script which runs dataflow job.</p>\n\n<p>The bash script looks like that:</p>\n\n<pre><code>go run wordcount.go \\\n--runner dataflow \\\n--input gs://dataflow-samples/shakespeare/kinglear.txt \\\n--output gs://${BUCKET?}/counts \\\n--project ${PROJECT?} \\\n--temp_location gs://${BUCKET?}/tmp/ \\\n--staging_location gs://${BUCKET?}/binaries/ \\\n--worker_harness_container_image=apache-docker-beam-snapshots-docker.bintray.io/beam/go:20180515\n</code></pre>\n\n<p>But above mechanism cannot create a new dataflow job and it seems it's cumbersome.</p>\n\n<p>Is there a better way to achieve my goal? And what am I doing wrong on the above mechanism?</p>\n"}, {"tags": ["mysql", "go", "scaling", "sharding", "high-availability"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547381515, "post_id": 54167998, "comment_id": 95166380, "body": "There is no one-size-fits-all answer to this. There are a few libraries I&#39;ve seen over the years that aim to help with this, but every time I&#39;ve dealt with this, I&#39;ve found it easier to write my own abstraction layer, for the simple reason that no two implementations ever have the same exact goals. Finding one that does exactly what you want is probably unlikely."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1547411409, "post_id": 54167998, "comment_id": 95174807, "body": "Take a look at Vitess, it&#39;s doing that and way more: <a href=\"https://vitess.io/\" rel=\"nofollow noreferrer\">vitess.io</a>"}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1547425767, "post_id": 54167998, "comment_id": 95177878, "body": "I hope that code does not open connections to all 5 shards, then use only 1."}, {"owner": {"reputation": 23, "user_id": 10907366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b920d956034e5d38457d289768eaa791?s=128&d=identicon&r=PG&f=1", "display_name": "nanom1t", "link": "https://stackoverflow.com/users/10907366/nanom1t"}, "reply_to_user": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1547449766, "post_id": 54167998, "comment_id": 95182526, "body": "@RickJames The question was exactly how to handle/open/close connection for all shards and use them. As no one has any ideas about this it looks like I will create a map with connections and open them at start of application. Then I will choose a proper connection from map for each API request and execute SQL queries."}, {"owner": {"reputation": 23, "user_id": 10907366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b920d956034e5d38457d289768eaa791?s=128&d=identicon&r=PG&f=1", "display_name": "nanom1t", "link": "https://stackoverflow.com/users/10907366/nanom1t"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1547450238, "post_id": 54167998, "comment_id": 95182664, "body": "@Not_a_Golfer I heard about Vitess and thought to use it, but it looks like a black box and there is no a lot of documentation/tutorials/examples/community. Also I&#39;m not sure that I will find a right solution if something goes wrong (for example, with resharding or something else). Do you use it in production?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1547452515, "post_id": 54167998, "comment_id": 95183444, "body": "@devops787 not personally. I work for Google and I know it&#39;s used in production and developed here."}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1547482555, "post_id": 54167998, "comment_id": 95198871, "body": "@devops787 - Is your app is like a web server, it comes and goes, so you don&#39;t want to waste time making 5 connections, then use only 1.  If the app runs the whole time, then, sure, make 5 connections."}, {"owner": {"reputation": 23, "user_id": 10907366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b920d956034e5d38457d289768eaa791?s=128&d=identicon&r=PG&f=1", "display_name": "nanom1t", "link": "https://stackoverflow.com/users/10907366/nanom1t"}, "reply_to_user": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1547535807, "post_id": 54167998, "comment_id": 95215177, "body": "@RickJames It is a Go application, which compiles into executable binary. It runs the whole time, listen and serve HTTP requests. It is not a PHP application, which runs by webserver on each HTTP request."}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1547567245, "post_id": 54167998, "comment_id": 95231458, "body": "@devops787 - Is the app single-threaded?  If so, sure, create 5 connections and use the appropriate one.  If it is multi-threaded, it gets more complex; first a question:  Will 5 threads suffice?"}, {"owner": {"reputation": 376, "user_id": 7182996, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UVy7d.jpg?s=128&g=1", "display_name": "Sugu Sougoumarane", "link": "https://stackoverflow.com/users/7182996/sugu-sougoumarane"}, "edited": false, "score": 0, "creation_date": 1547921278, "post_id": 54167998, "comment_id": 95362794, "body": "@devops787 I maintain Vitess. You can join the vitess Slack channel by following the top right link on vitess.io and get help that way. Also, PlanetScale now provides training, professional services and hosted solutions for Vitess."}, {"owner": {"reputation": 23, "user_id": 10907366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b920d956034e5d38457d289768eaa791?s=128&d=identicon&r=PG&f=1", "display_name": "nanom1t", "link": "https://stackoverflow.com/users/10907366/nanom1t"}, "reply_to_user": {"reputation": 376, "user_id": 7182996, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UVy7d.jpg?s=128&g=1", "display_name": "Sugu Sougoumarane", "link": "https://stackoverflow.com/users/7182996/sugu-sougoumarane"}, "edited": false, "score": 0, "creation_date": 1548008676, "post_id": 54167998, "comment_id": 95380924, "body": "@SuguSougoumarane ok. Thanks"}, {"owner": {"reputation": 23, "user_id": 10907366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b920d956034e5d38457d289768eaa791?s=128&d=identicon&r=PG&f=1", "display_name": "nanom1t", "link": "https://stackoverflow.com/users/10907366/nanom1t"}, "reply_to_user": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1548008969, "post_id": 54167998, "comment_id": 95381017, "body": "@RickJames I&#39;m not sure about this. As I know Golang utilizes one thread by default, but this not matter, because there are go-routines. They are a light version of threads and they can be runned in parallel mode."}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1548010375, "post_id": 54167998, "comment_id": 95381424, "body": "@devops787 - I is probably folly to share a MySQL connection between &quot;go-routines&quot;."}, {"owner": {"reputation": 23, "user_id": 10907366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b920d956034e5d38457d289768eaa791?s=128&d=identicon&r=PG&f=1", "display_name": "nanom1t", "link": "https://stackoverflow.com/users/10907366/nanom1t"}, "reply_to_user": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1548053971, "post_id": 54167998, "comment_id": 95390877, "body": "@RickJames That&#39;s why I ask how to do in right way in Golang."}], "owner": {"reputation": 23, "user_id": 10907366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b920d956034e5d38457d289768eaa791?s=128&d=identicon&r=PG&f=1", "display_name": "nanom1t", "link": "https://stackoverflow.com/users/10907366/nanom1t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 858, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547381464, "creation_date": 1547375577, "last_edit_date": 1547381464, "question_id": 54167998, "link": "https://stackoverflow.com/questions/54167998/mysql-sharding-in-golang", "title": "MySQL sharding in Golang", "body": "<p>I want to scale out my MySQL database into few servers using horizontal sharding. Let's imagine that I have 5 database servers (not replicas) and I want to distribute the data from users table between 5 database servers:</p>\n\n<pre><code>Shard 1 (192.168.1.1)\nShard 2 (192.168.1.2)\nShard 3 (192.168.1.3)\nShard 4 (192.168.1.4)\nShard 5 (192.168.1.5)\n</code></pre>\n\n<p>Now I want to connect to one of them depending on user_id (server_id = user_id % 5). I will do this on each API request from users in my Go application. </p>\n\n<p>I'm using <a href=\"https://github.com/go-sql-driver/mysql\" rel=\"nofollow noreferrer\">go-sql-driver</a> and standard database/sql package. </p>\n\n<pre><code>import \"database/sql\"\nimport _ \"github.com/go-sql-driver/mysql\"\n\nshard1, _ := sql.Open(\"mysql\", \"user:password@tcp(192.168.1.1:3306)/dbname\")\nshard2, _ := sql.Open(\"mysql\", \"user:password@tcp(192.168.1.2:3306)/dbname\")\nshard3, _ := sql.Open(\"mysql\", \"user:password@tcp(192.168.1.3:3306)/dbname\")\n...\n</code></pre>\n\n<p>There is a basic connection pool in the database/sql package, but there is not a lot of control on it. There are also few methods: SetMaxIdleConns, SetMaxOpenConns, SetConnMaxLifetime, but it looks that they work only with single database server at once.</p>\n\n<p>The question is how to properly handle and pool database connections in my Golang application? How to work with multiple database servers in Golang? </p>\n\n<p>Should I create a singleton object with connection map with *DB values, store all connections there and use them across the whole application? For example:</p>\n\n<pre><code>connections := make(map[string]interface{})\nconnections[\"shard1\"] = shard1\nconnections[\"shard2\"] = shard2\n...\n</code></pre>\n\n<p>How to close connections or don't close them after SQL query execution? </p>\n"}, {"tags": ["function", "go", "recursion"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 1, "creation_date": 1547378940, "post_id": 54167476, "comment_id": 95165805, "body": "It&#39;d be worth while stepping through this with delve, and maybe check the disassemble output, too. That should make things clear"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 10907161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6bd408592d51e96bed25872fadba5200?s=128&d=identicon&r=PG&f=1", "display_name": "dingdang", "link": "https://stackoverflow.com/users/10907161/dingdang"}, "edited": false, "score": 0, "creation_date": 1547401131, "post_id": 54170607, "comment_id": 95171819, "body": "when I use <code>h = mh(h)</code>, Why is mutual recursion happening?"}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 0, "last_activity_date": 1547395171, "creation_date": 1547395171, "answer_id": 54170607, "question_id": 54167476, "link": "https://stackoverflow.com/questions/54167476/how-to-understand-this-recursive-result/54170607#54170607", "title": "How to understand this recursive result", "body": "<p>The culprit is this assignment:</p>\n\n<pre><code>  h = mh(h) \n</code></pre>\n\n<p>It replaces the binding of <code>h</code> in <code>main</code> from the anonymous function that prints out before/after to whatever <code>mh</code> returns.</p>\n\n<p>If you replace </p>\n\n<pre><code>    h = mh(h)    \n    fmt.Printf(\"after func h=%x\\n\", h)    \n    return h(name)\n</code></pre>\n\n<p>With</p>\n\n<pre><code>    return mh(h)(name)\n</code></pre>\n\n<p>You will get the mutual recursion you expect</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1547454713, "creation_date": 1547454713, "answer_id": 54177966, "question_id": 54167476, "link": "https://stackoverflow.com/questions/54167476/how-to-understand-this-recursive-result/54177966#54177966", "title": "How to understand this recursive result", "body": "<p>The key thing to understand is that this line:</p>\n\n<pre><code>h = mh(h)\n</code></pre>\n\n<p>Does <strong>not</strong> call the <code>h</code> function. It calls the <code>mh()</code> function, which just returns a function value, but it does not call <code>h()</code> either. If the returned function value would be called, that would call <code>h()</code>.</p>\n\n<p>So the <code>main()</code> function stores a function value in <code>h</code>, then calls <code>h()</code>.</p>\n\n<p>This <code>h()</code> prints <code>\"before\"</code>, then <em>wraps</em> <code>h</code> in another function, and stores the result in <code>h</code>, then prints <code>\"after\"</code>. It's important to know that the wrapper function (the value returned by <code>mh()</code>) is a closure, and it stores the original value of <code>h</code>, so assigning the result to <code>h</code> does not affect the <code>h</code> inside the wrapped function.</p>\n\n<p>So <code>h</code> ends by calling <code>h</code> which is now the wrapped function. The wrapped function starts by printing <code>\"return\"</code>, then it calls the original, unwrapped <code>h</code>.</p>\n\n<p>The original, unwrapped <code>h</code> again prints <code>\"before\"</code>, then it wraps the current value of <code>h</code> (which is the wrapped function), stores it in <code>h</code>, then prints <code>\"after\"</code>.</p>\n\n<p>And then calls <code>h</code>, which is now a 2-times wrapped function. It starts by printing <code>\"return\"</code>, then calls the saved <code>h</code> value, which is a 1-time wrapped function. The 1-time wrapped function starts by printing <code>\"return\"</code> (again), then proceeds with the original one, which prints <code>\"before\"</code>, wraps <code>h</code> which will now be 3-times wrapped, stores it in <code>h</code>, then calls <code>h</code> (which is the 3-times wrapped function value)...</p>\n\n<p>This logic continues, the function value stored in <code>h</code> will become wrapped more and more, and the wrapped function always has a saved value of the one-less times wrapped previous function.</p>\n\n<p>As the \"iteration\" continues, the \"wrapping depth\" increases, therefore you'll see more and more <code>\"return\"</code> statements printed (as that's what the wrapping does).</p>\n"}], "owner": {"reputation": 43, "user_id": 10907161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6bd408592d51e96bed25872fadba5200?s=128&d=identicon&r=PG&f=1", "display_name": "dingdang", "link": "https://stackoverflow.com/users/10907161/dingdang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 1, "accepted_answer_id": 54177966, "answer_count": 2, "score": 4, "last_activity_date": 1547454713, "creation_date": 1547370967, "last_edit_date": 1547454192, "question_id": 54167476, "link": "https://stackoverflow.com/questions/54167476/how-to-understand-this-recursive-result", "title": "How to understand this recursive result", "body": "<p>I wrote a bug while coding, when I solved the problem, I was confused about the output of the code,the code show as below:</p>\n\n<pre><code>type (\n    Handler func(name string) error\n)\n\nfunc mh(h Handler) Handler {\n    return func(name string) error {\n        fmt.Printf(\"return mh,name=%s,h=%x\\n\", name, h)\n        return h(name)\n    }\n}\n\nfunc main() {\n    var h Handler\n    h = func(name string) error {\n        fmt.Printf(\"********************************\\n\")\n        fmt.Printf(\"before func h=%x\\n\", h)\n        h = mh(h)\n        fmt.Printf(\"after func h=%x\\n\", h)\n        return h(name)\n    }\n    fmt.Printf(\"main h=%x\\n\", h)\n    h(\"main\")\n}\n</code></pre>\n\n<p>Running the code, the output is:</p>\n\n<pre><code>main h=486d40\n********************************\nbefore func h=486d40\nafter func h=486c00\nreturn mh,name=main,h=486d40\n********************************\nbefore func h=486c00\nafter func h=486c00\nreturn mh,name=main,h=486c00\nreturn mh,name=main,h=486d40\n********************************\nbefore func h=486c00\nafter func h=486c00\nreturn mh,name=main,h=486c00\nreturn mh,name=main,h=486c00\nreturn mh,name=main,h=486d40\n.......\n</code></pre>\n\n<p>I don't understand the call stack.I thought the output should be loop \"mh\".</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 249903, "user_id": 2422776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2353050223ebecb113741c29458de4b2?s=128&d=identicon&r=PG", "display_name": "Mureinik", "link": "https://stackoverflow.com/users/2422776/mureinik"}, "is_accepted": false, "score": 1, "last_activity_date": 1547369553, "creation_date": 1547369553, "answer_id": 54167337, "question_id": 54167313, "link": "https://stackoverflow.com/questions/54167313/what-does-import-lib-math-in-golang/54167337#54167337", "title": "what does import _ &quot;lib/math&quot; in Golang?", "body": "<p>This pattern is useful for controlling the timing and order of imports. For example, you could want to force a slow initialization to happen during the program's startup, in an expected place where you don't care about speed, and then have later parts of the program import the package and use it without worrying about hanging due to the package's initialization.</p>\n"}], "owner": {"reputation": 134, "user_id": 8134743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7eaac7938bf3d976f017901db8b1ac43?s=128&d=identicon&r=PG&f=1", "display_name": "Pengcheng Zhou", "link": "https://stackoverflow.com/users/8134743/pengcheng-zhou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 0, "closed_date": 1547370117, "answer_count": 1, "score": 0, "last_activity_date": 1547370127, "creation_date": 1547369236, "question_id": 54167313, "link": "https://stackoverflow.com/questions/54167313/what-does-import-lib-math-in-golang", "closed_reason": "Duplicate", "title": "what does import _ &quot;lib/math&quot; in Golang?", "body": "<p>I have seen an import clause <code>import _ \"lib/math\"</code> in go Specification.</p>\n\n<p>The Specification states \"To import a package solely for its side-effects (initialization), use the blank identifier as explicit package name\"</p>\n\n<p>Why would import the package for initialization, if the package cant not be used since the package name is a blank identifier.\nwhat exactly is it used for? </p>\n"}, {"tags": ["go", "deadlock", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 683, "user_id": 2208386, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/c1c89c3a46372c69cd34b5126f2383aa?s=128&d=identicon&r=PG", "display_name": "Alex Ferg", "link": "https://stackoverflow.com/users/2208386/alex-ferg"}, "edited": false, "score": 0, "creation_date": 1547391223, "post_id": 54166493, "comment_id": 95168942, "body": "I&#39;ve tried before globalizing &#39;wg&#39; and it caused a deadlock, I guess that was because of the second and third issue. I understand now, thank you!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1547359526, "creation_date": 1547359526, "answer_id": 54166493, "question_id": 54166296, "link": "https://stackoverflow.com/questions/54166296/one-channel-with-one-receiver-and-unknown-number-of-goroutines-senders-causing-d/54166493#54166493", "title": "One channel with one receiver and unknown number of goroutines senders causing deadlock", "body": "<p>There are a few issues. </p>\n\n<p>The first is that the program copies wait group values when passing them as arguments.  Wait groups don't work correctly when copied. Pass pointer to a wait group instead.</p>\n\n<p>The second issue is that main waits for all of the goroutines complete before receiving values from the channels. Because the channel's buffer is not large enough to hold all sent values, the program deadlocks.</p>\n\n<p>A third issue is that main ranges over the channel, but nothing ever closes the channel.  Main will not exit as a result.</p>\n\n<p>To fix the second and third issues, start another goroutine to wait on <code>doSomthing</code>s and close the channel when they are done.</p>\n\n<p>Try this:</p>\n\n<pre><code>func doSomething(ch chan string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    ch &lt;- fmt.Sprintf(\"doSomething: %d\", i)\n    i++\n    if i == 10 {\n        return\n    }\n    wg.Add(1)\n    go doSomething(ch, wg)\n}\n\nfunc main() {\n    ch := make(chan string)\n    var wg sync.WaitGroup\n    wg.Add(1)\n    go doSomething(ch, &amp;wg)\n    go func() {\n        wg.Wait()\n        close(ch)\n    }()\n    for s := range ch {\n        fmt.Println(s)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 683, "user_id": 2208386, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/c1c89c3a46372c69cd34b5126f2383aa?s=128&d=identicon&r=PG", "display_name": "Alex Ferg", "link": "https://stackoverflow.com/users/2208386/alex-ferg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "accepted_answer_id": 54166493, "answer_count": 1, "score": 1, "last_activity_date": 1547359526, "creation_date": 1547356977, "question_id": 54166296, "link": "https://stackoverflow.com/questions/54166296/one-channel-with-one-receiver-and-unknown-number-of-goroutines-senders-causing-d", "title": "One channel with one receiver and unknown number of goroutines senders causing deadlock", "body": "<p>I have one channel and the receiver is main. I spawn multiple goroutines that each send a string over the channel.</p>\n\n<p>Now, this causes a deadlock because I didn't close the channel properly using the close function. The thing is, I have no idea how many goroutines will be created, so there's no way to know when to close the channel.</p>\n\n<p>I've tried using WaitGroup, the problem is, I've read that I can't use Add in the goroutine and that I should use wg.Add(1) in the main process/goroutine, I've tried using Add in the parent goroutine spawning the child goroutine, that also caused a deadlock</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"sync\"\n)\n\nvar i = 0\n\nfunc doSomething(ch chan string, wg sync.WaitGroup) {\n    defer wg.Done()\n    ch &lt;- fmt.Sprintf(\"doSomething: %d\", i)\n    i++\n    if i == 10 {return}\n    wg.Add(1)\n    go doSomething(ch, wg)\n}\n\nfunc main() {\n    ch := make(chan string)\n    var wg sync.WaitGroup\n    wg.Add(1)\n    go doSomething(ch, wg)\n    wg.Wait()\n    for s := range ch {\n        fmt.Println(s)\n    }\n}\n</code></pre>\n\n<p>Now, this is just a test code, so, assume that we don't know that we will create 10 goroutines only, assume that it's unknown at runtime, here I get a deadlock error instantly without any output, if I don't use WorkGroup I get the error at before printing the 10th string (because I didn't close the channel)</p>\n\n<p>I've also tried not spawning a goroutine for each function call and instead use one goroutine for all the recursive calls (starting from main), and to close the channel, I made an anonymous function for go that first calls the doSomething function then calls close, so all the recursive calls will have been evaluated and we will for sure know when to close the channel. But, this is now what I'm trying to accomplish, I'm trying to get the unknown number of goroutines to work together and close the channel after they're done somehow.</p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1548679700, "post_id": 54166042, "comment_id": 95615094, "body": "Do you have by chance compilation directive in your test files like <code>&#47;&#47; +build integration</code>? That can instruct tools to ignore file."}, {"owner": {"reputation": 2137, "user_id": 90797, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/7pblP.jpg?s=128&g=1", "display_name": "Virmundi", "link": "https://stackoverflow.com/users/90797/virmundi"}, "reply_to_user": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1548680032, "post_id": 54166042, "comment_id": 95615310, "body": "The only place with compilation directives is the vendor directory. Nothing in my immediate code."}], "answers": [{"comments": [{"owner": {"reputation": 2137, "user_id": 90797, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/7pblP.jpg?s=128&g=1", "display_name": "Virmundi", "link": "https://stackoverflow.com/users/90797/virmundi"}, "edited": false, "score": 0, "creation_date": 1547432564, "post_id": 54166052, "comment_id": 95179007, "body": "The problem is specific to test files. Intellisense works find in regular files. I found that activating the go language server helps go.useLanguageServer. Don&#39;t know why it&#39;s just the test files."}, {"owner": {"reputation": 2137, "user_id": 90797, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/7pblP.jpg?s=128&g=1", "display_name": "Virmundi", "link": "https://stackoverflow.com/users/90797/virmundi"}, "edited": false, "score": 0, "creation_date": 1548649665, "post_id": 54166052, "comment_id": 95602396, "body": "to clarify, I tried your advice, but was unable to get test file completion to work."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user4318630"}, "is_accepted": false, "score": -1, "last_activity_date": 1547353051, "creation_date": 1547353051, "answer_id": 54166052, "question_id": 54166042, "link": "https://stackoverflow.com/questions/54166042/intellisense-not-working-golang-test-files/54166052#54166052", "title": "Intellisense not working golang test files", "body": "<p>If the intellisense was already working and suddenly stops, you may try any of the below or both to resolve this.</p>\n\n<ol>\n<li><p>Reset the VisualStudio settings as explained here. <a href=\"https://docs.microsoft.com/en-us/previous-versions/visualstudio/visual-studio-2008/ms247075(v=vs.90)\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/previous-versions/visualstudio/visual-studio-2008/ms247075(v=vs.90)</a> </p></li>\n<li><p>Delete the <strong>.VS</strong> folder from your project.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 2137, "user_id": 90797, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/7pblP.jpg?s=128&g=1", "display_name": "Virmundi", "link": "https://stackoverflow.com/users/90797/virmundi"}, "is_accepted": true, "score": 3, "last_activity_date": 1548779016, "creation_date": 1548779016, "answer_id": 54425445, "question_id": 54166042, "link": "https://stackoverflow.com/questions/54166042/intellisense-not-working-golang-test-files/54425445#54425445", "title": "Intellisense not working golang test files", "body": "<p>I'm not sure as to the whys and the wherefores, but the solution was to reinstall all of the Go tools in VSCode. Look for \"Go: Install/Update Tools\". I selected them all. Once they installed,restart VScode. At this point autocomplete turned on.</p>\n\n<p>I didn't remember a VSCode update before things broke. If you run into this issue, try reinstalling the tools within VScode.</p>\n"}], "owner": {"reputation": 2137, "user_id": 90797, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/7pblP.jpg?s=128&g=1", "display_name": "Virmundi", "link": "https://stackoverflow.com/users/90797/virmundi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2340, "favorite_count": 0, "accepted_answer_id": 54425445, "answer_count": 2, "score": 0, "last_activity_date": 1548779016, "creation_date": 1547352807, "last_edit_date": 1548679457, "question_id": 54166042, "link": "https://stackoverflow.com/questions/54166042/intellisense-not-working-golang-test-files", "title": "Intellisense not working golang test files", "body": "<p>Title says it all. I open a test file. Type <code>$package.</code>. Nothing comes up. It's not a delay issue. It's not an empty package. How do I get intellisense to turn on?</p>\n\n<p>Update: I've open a bug ticket with the VSCode-Golang team. As we find more information, I'll report back here. <a href=\"https://github.com/Microsoft/vscode-go/issues/2278\" rel=\"nofollow noreferrer\">https://github.com/Microsoft/vscode-go/issues/2278</a></p>\n\n<p>For those down voting: please follow the community standard and explain why.</p>\n"}, {"tags": ["go", "testing"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547411641, "post_id": 54165975, "comment_id": 95174860, "body": "Obviously adding more tests doesn\u2019t prevent the existing tests from running You either need to exclude the other tests by name, or by constraints, the choice is yours."}], "answers": [{"comments": [{"owner": {"reputation": 1041, "user_id": 4233629, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh6.googleusercontent.com/-afuW4zm4V5Q/AAAAAAAAAAI/AAAAAAAAHR4/K4nGzVl8rsM/photo.jpg?sz=128", "display_name": "Sush", "link": "https://stackoverflow.com/users/4233629/sush"}, "edited": false, "score": 1, "creation_date": 1547362666, "post_id": 54166665, "comment_id": 95162945, "body": "No, that&#39;s not necessary"}], "tags": [], "owner": {"reputation": 351, "user_id": 500442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4d20ddb73bc3045e7236b78f270c7fd?s=128&d=identicon&r=PG", "display_name": "avivl", "link": "https://stackoverflow.com/users/500442/avivl"}, "is_accepted": false, "score": -4, "last_activity_date": 1547361850, "creation_date": 1547361850, "answer_id": 54166665, "question_id": 54165975, "link": "https://stackoverflow.com/questions/54165975/go-test-only-run-tests-that-contain-a-build-tag/54166665#54166665", "title": "go test: only run tests that contain a build tag?", "body": "<p>You need the <code>=</code> sign after <code>-tags</code></p>\n\n<p><code>go test -tags=func_test</code></p>\n"}, {"comments": [{"owner": {"reputation": 1041, "user_id": 4233629, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh6.googleusercontent.com/-afuW4zm4V5Q/AAAAAAAAAAI/AAAAAAAAHR4/K4nGzVl8rsM/photo.jpg?sz=128", "display_name": "Sush", "link": "https://stackoverflow.com/users/4233629/sush"}, "edited": false, "score": 1, "creation_date": 1547596573, "post_id": 54194062, "comment_id": 95243598, "body": "Yeah this is what I was afraid of. This means that all of our developers who write unittests need to be aware of this new tag called &quot;test_all&quot;"}], "tags": [], "owner": {"reputation": 136, "user_id": 8451486, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3WNzH.jpg?s=128&g=1", "display_name": "Deepak Kumar", "link": "https://stackoverflow.com/users/8451486/deepak-kumar"}, "is_accepted": false, "score": 2, "last_activity_date": 1547535704, "creation_date": 1547535704, "answer_id": 54194062, "question_id": 54165975, "link": "https://stackoverflow.com/questions/54165975/go-test-only-run-tests-that-contain-a-build-tag/54194062#54194062", "title": "go test: only run tests that contain a build tag?", "body": "<p>As per the golang Doc <a href=\"https://golang.org/pkg/go/build/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/go/build/</a></p>\n\n<p>The build tag lists the conditions under which a file should be included in the package. So if you want to run the test only for the build tags func_test then you need to provide a different tag for the other tests. </p>\n\n<p>Here is an example:\nI have following 2 test files in my test directory.</p>\n\n<p>func_test.go</p>\n\n<pre><code>//+build test_all func_test\n\npackage go_build_test\n\nimport (\n    \"fmt\"\n    \"testing\"\n)\n\nfunc TestNormal(t *testing.T) {\n    fmt.Println(\"testing:\", t.Name())\n\n}\n</code></pre>\n\n<p>other_test.go</p>\n\n<pre><code>//+build test_all,!func_test\n\npackage go_build_test\n\nimport \"testing\"\nimport \"fmt\"\n\nfunc TestOtherCase(t *testing.T) {\n    fmt.Println(\"testing:\", t.Name())\n}\n</code></pre>\n\n<p>Now If you want to run all the tests. </p>\n\n<pre><code>$ go test -tags=test_all\ntesting: TestNormal\ntesting: TestOtherCase\nPASS\nok      _/D_/Project/ARC/source/prototype/go/src/go-build-test  0.186s\n</code></pre>\n\n<p>Only running the func_test</p>\n\n<pre><code>$ go test -tags=func_test\ntesting: TestNormal\nPASS\nok      _/D_/Project/ARC/source/prototype/go/src/go-build-test  1.395s\n</code></pre>\n\n<p>The trick is to work with the //+build comment with AND/OR conditions.</p>\n"}], "owner": {"reputation": 1041, "user_id": 4233629, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh6.googleusercontent.com/-afuW4zm4V5Q/AAAAAAAAAAI/AAAAAAAAHR4/K4nGzVl8rsM/photo.jpg?sz=128", "display_name": "Sush", "link": "https://stackoverflow.com/users/4233629/sush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4526, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1547535704, "creation_date": 1547351986, "last_edit_date": 1547352968, "question_id": 54165975, "link": "https://stackoverflow.com/questions/54165975/go-test-only-run-tests-that-contain-a-build-tag", "title": "go test: only run tests that contain a build tag?", "body": "<p>I have a set of long running tests, defined with the build tag. For example, </p>\n\n<pre><code>// file some_test.go\n//+build func_test\n\n(rest of file with test cases)\n</code></pre>\n\n<p>And I have many other shorter running tests, without this build flag.\nIs there a way I can easily run only the tests containing the build tag \"func_test\"?</p>\n\n<p>Note that if I just run <code>go test -tags func_test</code>, it runs ALL tests including the ones in <code>some_test.go</code>.</p>\n"}, {"tags": ["string", "go", "int", "slice"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1547431091, "last_edit_date": 1547431091, "creation_date": 1547347912, "answer_id": 54165722, "question_id": 54165681, "link": "https://stackoverflow.com/questions/54165681/getting-a-slice-of-integers-from-a-string-integer-in-go/54165722#54165722", "title": "Getting a slice of integers from a string integer in Go?", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    toCheck := \"987654321\"\n    fmt.Println(toCheck)\n    toSum := make([]int, 0, len(toCheck)/2)\n    for i := len(toCheck) - 2; i &gt;= 0; i -= 2 {\n        c := toCheck[i]\n        if c &gt;= '0' &amp;&amp; c &lt;= '9' {\n            toSum = append(toSum, int(c-'0'))\n        }\n    }\n    fmt.Println(len(toSum), cap(toSum), toSum)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/wtIgqEKj-Bk\" rel=\"nofollow noreferrer\">https://play.golang.org/p/wtIgqEKj-Bk</a></p>\n\n<p>Output:</p>\n\n<pre><code>987654321\n4 4 [2 4 6 8]\n</code></pre>\n\n<hr>\n\n<p>This is Go. Code should be reasonably efficient. For example,</p>\n\n<pre><code>$ go test sum_test.go -bench=. -benchmem\nBenchmarkPeterSO-8         50000000     24.5 ns/op    32 B/op    1 allocs/op\nBenchmarkTom-8             20000000     77.6 ns/op    56 B/op    3 allocs/op\nBenchmarkUser10753492-8    20000000     79.0 ns/op    56 B/op    3 allocs/op\nBenchmarkGrissom-8         20000000    108 ns/op      56 B/op    3 allocs/op\n$\n</code></pre>\n\n<p><code>sum_test.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"strconv\"\n    \"testing\"\n)\n\n// https://play.golang.org/p/wtIgqEKj-Bk\nfunc BenchmarkPeterSO(b *testing.B) {\n    toCheck := \"987654321\"\n    for N := 0; N &lt; b.N; N++ {\n        toSum := make([]int, 0, len(toCheck)/2)\n        for i := len(toCheck) - 2; i &gt;= 0; i -= 2 {\n            c := toCheck[i]\n            if c &gt;= '0' &amp;&amp; c &lt;= '9' {\n                toSum = append(toSum, int(c-'0'))\n            }\n        }\n    }\n}\n\n// https://play.golang.org/p/KgQrbesy5rT\nfunc BenchmarkTom(b *testing.B) {\n    toCheck := \"987654321\"\n    for N := 0; N &lt; b.N; N++ {\n        var toSum []int\n        for i := len(toCheck) - 2; i &gt;= 0; i = i - 2 {\n            toSum = append(toSum, int(toCheck[i]))\n        }\n    }\n}\n\nfunc ByteToInt(c byte) (int, bool) {\n    if c &gt;= '0' &amp;&amp; c &lt;= '9' {\n        return int(c - '0'), true\n    } else {\n        return 0, false\n    }\n}\n\n// https://play.golang.org/p/MRqtgY0ugZY\nfunc BenchmarkUser10753492(b *testing.B) {\n    toCheck := \"987654321\"\n    for N := 0; N &lt; b.N; N++ {\n        var toSum []int\n        for i := len(toCheck) - 2; i &gt;= 0; i = i - 2 {\n            var digit, _ = ByteToInt(toCheck[i])\n            toSum = append(toSum, digit)\n        }\n    }\n}\n\n// https://play.golang.org/p/kNbQVn8GJ9R\nfunc BenchmarkGrissom(b *testing.B) {\n    toCheck := \"987654321\"\n    for N := 0; N &lt; b.N; N++ {\n        var toSum []int\n        for i := len(toCheck) - 2; i &gt;= 0; i = i - 2 {\n            v, _ := strconv.Atoi(string(toCheck[i]))\n            toSum = append(toSum, v)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 66, "user_id": 3135981, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1yq3a.jpg?s=128&g=1", "display_name": "Grissom", "link": "https://stackoverflow.com/users/3135981/grissom"}, "is_accepted": false, "score": 0, "last_activity_date": 1547348077, "creation_date": 1547348077, "answer_id": 54165734, "question_id": 54165681, "link": "https://stackoverflow.com/questions/54165681/getting-a-slice-of-integers-from-a-string-integer-in-go/54165734#54165734", "title": "Getting a slice of integers from a string integer in Go?", "body": "<p>use <code>strconv</code> package to do the conversion</p>\n\n<pre><code>  for i := len(toCheck) - 2; i &gt;= 0; i = i-2 {\n        v,_ := strconv.Atoi(string(toCheck[i]))\n        toSum = append(toSum, v)\n    }\n</code></pre>\n\n<p>strconv.Atoi is shortcut for strconv.ParseInt(s,10,0).</p>\n\n<p>finish in your playground\n<a href=\"https://play.golang.org/p/kNbQVn8GJ9R\" rel=\"nofollow noreferrer\">https://play.golang.org/p/kNbQVn8GJ9R</a></p>\n"}, {"tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": false, "score": 2, "last_activity_date": 1547358060, "creation_date": 1547358060, "answer_id": 54166377, "question_id": 54165681, "link": "https://stackoverflow.com/questions/54165681/getting-a-slice-of-integers-from-a-string-integer-in-go/54166377#54166377", "title": "Getting a slice of integers from a string integer in Go?", "body": "<blockquote>\n  <p>but it's giving me what I believe are ASCII values - I know that I can just subtract 48, but that seems a little hacky.</p>\n</blockquote>\n\n<p>It's not hacky. You have a byte representing an ascii digit and you want to get its value as an integer from 0-9. That's how you do it. That's also how converting a string to an integer works in general. You convert each individual byte to a number using this method.</p>\n\n<p>The UTF-8 representation for '0' is not going to change anytime soon. Of course, instead of subtracting <code>48</code> you can subtract <code>'0'</code>.</p>\n\n<p>To make it more general purpose, maybe you should also return a boolean indicating whether the byte can be converted or not.</p>\n\n<pre><code>func ByteToInt(c byte) (int, bool) {\n    if c &gt;= '0' &amp;&amp; c &lt;= '9' {\n        return int(c - '0'), true\n    } else {\n        return 0, false\n    }\n}\n</code></pre>\n\n<p>You can use this in your code sample and it would return your expected result:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc ByteToInt(c byte) (int, bool) {\n    if c &gt;= '0' &amp;&amp; c &lt;='9' {\n        return int(c - '0'), true\n    } else {\n        return 0, false\n    }\n}\n\nfunc main() {\n\ntoCheck := \"987654321\"\n\n    var toSum []int\n    for i := len(toCheck) - 2; i &gt;= 0; i = i-2 {\n        var digit, _ = ByteToInt(toCheck[i])\n        toSum = append(toSum, digit)\n    }\n\n    fmt.Println(toSum)\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/MRqtgY0ugZY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MRqtgY0ugZY</a></p>\n\n<p>The output is what you expect: <code>[2 4 6 8]</code></p>\n"}], "owner": {"reputation": 9, "user_id": 9457728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ac0ef219c8ee36cad88177582501bfa?s=128&d=identicon&r=PG&f=1", "display_name": "tom", "link": "https://stackoverflow.com/users/9457728/tom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 1, "answer_count": 3, "score": 1, "last_activity_date": 1547431091, "creation_date": 1547347298, "last_edit_date": 1547348107, "question_id": 54165681, "link": "https://stackoverflow.com/questions/54165681/getting-a-slice-of-integers-from-a-string-integer-in-go", "title": "Getting a slice of integers from a string integer in Go?", "body": "<p>I want to convert a string representing and integer into a slice containing each integer that made up the initial string. </p>\n\n<p><a href=\"https://play.golang.org/p/KgQrbesy5rT\" rel=\"nofollow noreferrer\">Playground link</a></p>\n\n<p>I've tried using the <code>Atoi()</code> function in <code>strconv</code>, it it gives <em>\"cannot use toCheck[i] (type byte) as type string in argument to strconv.Atoi\"</em>. I've also tried int() conversion, but it's giving me what I believe are ASCII values - I know that I can just subtract 48, but that seems a little hacky.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\ntoCheck := \"987654321\"\n\n    var toSum []int\n    for i := len(toCheck) - 2; i &gt;= 0; i = i-2 {\n        toSum = append(toSum, int(toCheck[i]))\n    }\n\n    fmt.Println(toSum)\n\n    // expected 2 4 6 8\n    // actual 50 52 54 56\n}\n</code></pre>\n\n<p>Expected output: 2 4 6 \nActual: 50 52 54 56</p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1547333842, "creation_date": 1547333842, "answer_id": 54164637, "question_id": 54164614, "link": "https://stackoverflow.com/questions/54164614/golang-function-cant-evaluate-field-in-type-string/54164637#54164637", "title": "Golang function &#39;can&#39;t evaluate field in type string&#39;", "body": "<p>The value <code>.</code> in that context is a string, not the <code>Item</code>.  Use a variable to refer to the item:</p>\n\n<pre><code>{{range $item := .Items}}\n  &lt;tr&gt;\n    &lt;td&gt;\n      {{range .ItemFields}}\n        {{if $item.IsHyperlink .}}\n          &lt;a href=\"{{.}}\"&gt;{{.}}&lt;/a&gt;\n        {{else}}\n          {{.}}\n        {{end}}\n      {{end}}\n    &lt;/td&gt;\n  &lt;/tr&gt;\n{{end}}\n</code></pre>\n"}], "owner": {"reputation": 233, "user_id": 6659021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6252687fde50e99e62377a916d5f05dc?s=128&d=identicon&r=PG&f=1", "display_name": "JetThomas", "link": "https://stackoverflow.com/users/6659021/jetthomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1789, "favorite_count": 0, "accepted_answer_id": 54164637, "answer_count": 1, "score": 3, "last_activity_date": 1547335506, "creation_date": 1547333603, "last_edit_date": 1547335506, "question_id": 54164614, "link": "https://stackoverflow.com/questions/54164614/golang-function-cant-evaluate-field-in-type-string", "title": "Golang function &#39;can&#39;t evaluate field in type string&#39;", "body": "<p>I have a struct of type Item that contains ItemFields which is a slice of type string.  I would like to conditionally print each string in ItemFields that is a hyperlink with an anchor tag.  To do so, I am using a function, IsHyperlink, to check whether each string in the slice should be wrapped in an anchor tag or simply printed out.  </p>\n\n<pre><code>type Item struct {\n  ItemFields []string\n}\n</code></pre>\n\n<p>I am looping through ItemFields in my page.html like this.</p>\n\n<pre><code>{{range .Items}}\n  &lt;ul&gt;\n    &lt;li&gt;\n      {{range .ItemFields}}\n        {{if .IsHyperlink .}}\n          &lt;a href=\"{{.}}\"&gt;{{.}}&lt;/a&gt;\n        {{else}}\n          {{.}}\n        {{end}}\n      {{end}}\n    &lt;/li&gt;\n  &lt;/ul&gt;\n{{end}}\n</code></pre>\n\n<p>However, when I run the application IsHyperlink is reporting that it 'cant evaluate field IsHyperlink in type string.</p>\n\n<p>How can I change my go code to successfully wrap the hyperlinks in anchor tags?</p>\n"}, {"tags": ["javascript", "go", "go-html-template"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1547334739, "post_id": 54164606, "comment_id": 95159119, "body": "Remove the double quotes from your html. ie <code>var someUrl = {{ .myUrl }}</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1547339386, "post_id": 54164606, "comment_id": 95159865, "body": "The string <code>&quot;https:\\&#47;\\&#47;some_domain123.com\\&#47;path1\\&#47;path2\\&#47;path3&quot;</code> is equal to <code>&quot;https:&#47;&#47;some_domain123.com&#47;path1&#47;path2&#47;path3&quot;</code> in Javascript.  The template adds the backslashes to protect against various attacks.  Why are the backslashes a problem in your application?"}, {"owner": {"reputation": 3, "user_id": 10906229, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/671e366d3ab1d353625b9cb1419ec874?s=128&d=identicon&r=PG&f=1", "display_name": "Nammami_mar", "link": "https://stackoverflow.com/users/10906229/nammami-mar"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1547346884, "post_id": 54164606, "comment_id": 95160930, "body": "@ThunderCat why do you want to know why?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1547347118, "post_id": 54164606, "comment_id": 95160964, "body": "I am trying to understand if there&#39;s an actual problem to solve and what it is.   There&#39;s encoding of the URL works OK as is."}], "answers": [{"tags": [], "owner": {"reputation": 14274, "user_id": 579078, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/xC5kj.png?s=128&g=1", "display_name": "\u11bc\u11ba\u11bc", "link": "https://stackoverflow.com/users/579078/%e1%86%bc%e1%86%ba%e1%86%bc"}, "is_accepted": true, "score": 0, "last_activity_date": 1547351663, "creation_date": 1547351663, "answer_id": 54165950, "question_id": 54164606, "link": "https://stackoverflow.com/questions/54164606/how-to-disable-escaping-url-string-in-an-html-template-in-a-javascript-block/54165950#54165950", "title": "How to disable escaping URL/string in an HTML template in a javascript block", "body": "<p><code>https:\\/\\/some_domain123.com\\/path1\\/path2\\/path3</code> is the same as <code>https://some_domain123.com/path1/path2/path3</code> in JavaScript.</p>\n\n<p>So, it actually works.</p>\n"}, {"tags": [], "owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "is_accepted": false, "score": 1, "last_activity_date": 1547400881, "creation_date": 1547400881, "answer_id": 54171432, "question_id": 54164606, "link": "https://stackoverflow.com/questions/54164606/how-to-disable-escaping-url-string-in-an-html-template-in-a-javascript-block/54171432#54171432", "title": "How to disable escaping URL/string in an HTML template in a javascript block", "body": "<p>As @mkopriva commented, remove the double quotes around <code>{{ .myURL }}</code>, and it works as you want.</p>\n\n<p><a href=\"https://play.golang.org/p/8GEB33oKX-c\" rel=\"nofollow noreferrer\">See it on the Playground</a></p>\n"}], "owner": {"reputation": 3, "user_id": 10906229, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/671e366d3ab1d353625b9cb1419ec874?s=128&d=identicon&r=PG&f=1", "display_name": "Nammami_mar", "link": "https://stackoverflow.com/users/10906229/nammami-mar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 390, "favorite_count": 0, "accepted_answer_id": 54165950, "answer_count": 2, "score": -1, "last_activity_date": 1547400881, "creation_date": 1547333574, "question_id": 54164606, "link": "https://stackoverflow.com/questions/54164606/how-to-disable-escaping-url-string-in-an-html-template-in-a-javascript-block", "title": "How to disable escaping URL/string in an HTML template in a javascript block", "body": "<p>I've tried to render a url as string, URL, JS and HTML. In all the cases this:</p>\n\n<pre><code> &lt;script&gt;\n  var someUrl = \"{{ .myUrl }}\";\n &lt;/script&gt;\n</code></pre>\n\n<p>gets rendered to this value:</p>\n\n<pre><code>https:\\/\\/some_domain123.com\\/path1\\/path2\\/path3\n</code></pre>\n\n<p>No matter what.</p>\n\n<p>I want this:</p>\n\n<pre><code>https://some_domain123.com/path1/path2/path3\n</code></pre>\n\n<p>What actually works?</p>\n"}, {"tags": ["go", "google-bigquery"], "comments": [{"owner": {"reputation": 25696, "user_id": 6253347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1387a55798cae58a3a836dcbcd6e1951?s=128&d=identicon&r=PG&f=1", "display_name": "Elliott Brossard", "link": "https://stackoverflow.com/users/6253347/elliott-brossard"}, "edited": false, "score": 0, "creation_date": 1547336062, "post_id": 54163963, "comment_id": 95159361, "body": "Did you create T2 using the streaming API?"}, {"owner": {"reputation": 3099, "user_id": 1031958, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/95178cfe1a6233353d8d3f0739d69ffc?s=128&d=identicon&r=PG", "display_name": "Tamir Klein", "link": "https://stackoverflow.com/users/1031958/tamir-klein"}, "edited": false, "score": 0, "creation_date": 1547361446, "post_id": 54163963, "comment_id": 95162781, "body": "Can you please share T2 Details page from the UI and tell us what you see when you Preview the table"}, {"owner": {"reputation": 4085, "user_id": 1510063, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/uXGc7.jpg?s=128&g=1", "display_name": "Charlie Egan", "link": "https://stackoverflow.com/users/1510063/charlie-egan"}, "reply_to_user": {"reputation": 25696, "user_id": 6253347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1387a55798cae58a3a836dcbcd6e1951?s=128&d=identicon&r=PG&f=1", "display_name": "Elliott Brossard", "link": "https://stackoverflow.com/users/6253347/elliott-brossard"}, "edited": false, "score": 0, "creation_date": 1547373328, "post_id": 54163963, "comment_id": 95164674, "body": "@ElliottBrossard I&#39;ve added some detail - I don&#39;t think I&#39;m using the streaming API."}, {"owner": {"reputation": 4085, "user_id": 1510063, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/uXGc7.jpg?s=128&g=1", "display_name": "Charlie Egan", "link": "https://stackoverflow.com/users/1510063/charlie-egan"}, "reply_to_user": {"reputation": 3099, "user_id": 1031958, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/95178cfe1a6233353d8d3f0739d69ffc?s=128&d=identicon&r=PG", "display_name": "Tamir Klein", "link": "https://stackoverflow.com/users/1031958/tamir-klein"}, "edited": false, "score": 0, "creation_date": 1547373444, "post_id": 54163963, "comment_id": 95164697, "body": "@TamirKlein I&#39;ve added a screenshot of the details showing 0 bytes but also that the data might still be in the streaming buffer?  I created a table last night and it had the correct values when I looked this morning. Might the issue be that it takes a long time for the streaming buffer to process?"}, {"owner": {"reputation": 3099, "user_id": 1031958, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/95178cfe1a6233353d8d3f0739d69ffc?s=128&d=identicon&r=PG", "display_name": "Tamir Klein", "link": "https://stackoverflow.com/users/1031958/tamir-klein"}, "edited": false, "score": 0, "creation_date": 1547373842, "post_id": 54163963, "comment_id": 95164778, "body": "1. You can try and query your streaming buffer using this SELECT * from <code>myProject.myDataSet.t2</code> where _PARTITIONTIME is NULL 2. The code you added show how you create your table and not how you insert which will tell if you are using streaming buffer"}, {"owner": {"reputation": 4085, "user_id": 1510063, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/uXGc7.jpg?s=128&g=1", "display_name": "Charlie Egan", "link": "https://stackoverflow.com/users/1510063/charlie-egan"}, "reply_to_user": {"reputation": 3099, "user_id": 1031958, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/95178cfe1a6233353d8d3f0739d69ffc?s=128&d=identicon&r=PG", "display_name": "Tamir Klein", "link": "https://stackoverflow.com/users/1031958/tamir-klein"}, "edited": false, "score": 0, "creation_date": 1547385137, "post_id": 54163963, "comment_id": 95167218, "body": "@TamirKlein, thanks for your replies. I&#39;ve added the code I&#39;m using to upload the data.  I&#39;ve tried the partition time query but get the following error <code>Unrecognized name: _PARTITIONTIME; Did you mean _PARTITION_NAME? </code> (_PARTITION_NAME seems to validate but fails to run with a similar error <code>Unrecognized name: _PARTITION_NAME at [1:71] </code>)"}, {"owner": {"reputation": 3099, "user_id": 1031958, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/95178cfe1a6233353d8d3f0739d69ffc?s=128&d=identicon&r=PG", "display_name": "Tamir Klein", "link": "https://stackoverflow.com/users/1031958/tamir-klein"}, "edited": false, "score": 0, "creation_date": 1547391028, "post_id": 54163963, "comment_id": 95168893, "body": "Can you add a partition field to T2 table? this will resolve the error <code>Unrecognized name:</code> and will enable you to query your streaming buffer"}, {"owner": {"reputation": 4085, "user_id": 1510063, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/uXGc7.jpg?s=128&g=1", "display_name": "Charlie Egan", "link": "https://stackoverflow.com/users/1510063/charlie-egan"}, "reply_to_user": {"reputation": 3099, "user_id": 1031958, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/95178cfe1a6233353d8d3f0739d69ffc?s=128&d=identicon&r=PG", "display_name": "Tamir Klein", "link": "https://stackoverflow.com/users/1031958/tamir-klein"}, "edited": false, "score": 0, "creation_date": 1547402150, "post_id": 54163963, "comment_id": 95172115, "body": "@TamirKlein I changed the T2 table to a partitioned table and now have the <code>_PARTITIONTIME</code> field.  I can upload the data in the same way but the table is empty (I get no results when querying the table, the table size is 0b, there are no longer any streaming stats shown).  I&#39;ll wait and see if the data shows up after some delay. How might I work out how long this takes?"}, {"owner": {"reputation": 4085, "user_id": 1510063, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/uXGc7.jpg?s=128&g=1", "display_name": "Charlie Egan", "link": "https://stackoverflow.com/users/1510063/charlie-egan"}, "edited": false, "score": 0, "creation_date": 1547416453, "post_id": 54163963, "comment_id": 95176076, "body": "I&#39;ve managed to get this working as a load job instead. Thanks for pointing me in the direction of the streaming buffer issue."}], "answers": [{"comments": [{"owner": {"reputation": 3099, "user_id": 1031958, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/95178cfe1a6233353d8d3f0739d69ffc?s=128&d=identicon&r=PG", "display_name": "Tamir Klein", "link": "https://stackoverflow.com/users/1031958/tamir-klein"}, "edited": false, "score": 1, "creation_date": 1547444265, "post_id": 54173551, "comment_id": 95181097, "body": "Great happy to see we managed to get you in the right direction although I still wonder why bq streaming buffer didn&#39;t worked."}], "tags": [], "owner": {"reputation": 4085, "user_id": 1510063, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/uXGc7.jpg?s=128&g=1", "display_name": "Charlie Egan", "link": "https://stackoverflow.com/users/1510063/charlie-egan"}, "is_accepted": false, "score": 0, "last_activity_date": 1547417855, "last_edit_date": 1547417855, "creation_date": 1547416334, "answer_id": 54173551, "question_id": 54163963, "link": "https://stackoverflow.com/questions/54163963/upload-data-to-table-without-waiting-for-streaming-buffer-to-flush/54173551#54173551", "title": "Upload data to table without waiting for streaming buffer to flush", "body": "<p>The comments on my question lead me to see that the issue was the streaming buffer. This was taking a long time to flush - it's not possible to flush manually.</p>\n\n<p>I ended up reading this issue and comment on GitHub <a href=\"https://github.com/googleapis/google-cloud-go/issues/507#issuecomment-370076232\" rel=\"nofollow noreferrer\">here</a>. This suggested using a Load job instead.</p>\n\n<p>After some research, I realised it was possible to read from an <code>io.Reader</code> as well as a Google Cloud Storage Reference by configuring the Loader's <code>ReaderSource</code>.</p>\n\n<p>My <strong>original</strong> implementation that used the streaming buffer looked like this:</p>\n\n<pre><code>var vss []*bigquery.ValuesSaver\n// for each row:\nvss = append(vss, &amp;bigquery.ValuesSaver{\n    Schema:   schema,\n    InsertID: fmt.Sprintf(index of loop),\n    Row: []bigquery.Value{\n        \"data\"\n    },\n})\n\nerr := uploader.Put(ctx, vss)\nif err != nil {\n    if pmErr, ok := err.(bigquery.PutMultiError); ok {\n        for _, rowInsertionError := range pmErr {\n            log.Println(rowInsertionError.Errors)\n        }\n    }\n\n    return fmt.Errorf(\"failed to insert data: %v\", err)\n}\n</code></pre>\n\n<p>I was able to change this to a load job with code that looked like this:</p>\n\n<pre><code>var lines []string\nfor _, v := range rows {\n    json, err := json.Marshal(v)\n    if err != nil {\n        return fmt.Errorf(\"failed generate json %v, %+v\", err, v)\n    }\n    lines = append(lines, string(json))\n}\n\ndataString := strings.Join(lines, \"\\n\")\n\nrs := bigquery.NewReaderSource(strings.NewReader(dataString))\nrs.FileConfig.SourceFormat = bigquery.JSON\nrs.FileConfig.Schema = schema\nloader := dataset.Table(t2Name).LoaderFrom(rs)\nloader.CreateDisposition = bigquery.CreateIfNeeded\nloader.WriteDisposition = bigquery.WriteTruncate\njob, err := loader.Run(ctx)\nif err != nil {\n    return fmt.Errorf(\"failed to start load job %v\", err)\n}\n_, err := job.Wait(ctx)\nif err != nil {\n    return fmt.Errorf(\"load job failed %v\", err)\n}\n</code></pre>\n\n<p>Now the data is available in the table 'immediately' - I no longer need to wait for the streaming buffer.</p>\n"}], "owner": {"reputation": 4085, "user_id": 1510063, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/uXGc7.jpg?s=128&g=1", "display_name": "Charlie Egan", "link": "https://stackoverflow.com/users/1510063/charlie-egan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 292, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1547417855, "creation_date": 1547328026, "last_edit_date": 1547416738, "question_id": 54163963, "link": "https://stackoverflow.com/questions/54163963/upload-data-to-table-without-waiting-for-streaming-buffer-to-flush", "title": "Upload data to table without waiting for streaming buffer to flush", "body": "<p>I have a Go program which downloads data from a table (T1), formats it, and uploads it to a new temporary table (T2). Once the data has been uploaded (30s or so), the data should be copied to a third table (T3).</p>\n\n<p>After uploading the formatted data to T2, querying the table returns results ok. However, when copying the table - the job completes almost instantly and the destination table (T3) is empty.</p>\n\n<p>I'm copying the table as suggested <a href=\"https://cloud.google.com/bigquery/docs/managing-tables#bigquery-copy-table-go\" rel=\"nofollow noreferrer\">here</a> - but the result is the same when performing the action in the UI.</p>\n\n<p>In the table metadata section it shows as 0B, 0 rows but there are about 100k rows and 18mb of data in there - or at least that's what comes back from a query.</p>\n\n<p><strong>Edit</strong> I did not spot that this data was still stuck in the streaming buffer - see my answer.</p>\n"}, {"tags": ["json", "postgresql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1547311511, "post_id": 54161698, "comment_id": 95153125, "body": "Have the <code>MY_JSON</code> type implement the <a href=\"https://golang.org/pkg/database/sql/#Scanner\" rel=\"nofollow noreferrer\">sql.Scanner</a> interface using <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">json.Unmarshal</a>. <i>(make sure to implement the Scanner on a pointer type)</i>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1547311836, "post_id": 54161698, "comment_id": 95153216, "body": "You would do well to rename your variables to be more Go idiomatic. Take a look at the naming suggestions in <a href=\"https://golang.org/doc/effective_go.html#names\" rel=\"nofollow noreferrer\">Effective Go</a>."}], "answers": [{"tags": [], "owner": {"reputation": 7865, "user_id": 576932, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/2084548226e1ab1a0814812cccb29bef?s=128&d=identicon&r=PG", "display_name": "ford", "link": "https://stackoverflow.com/users/576932/ford"}, "is_accepted": true, "score": 3, "last_activity_date": 1547312573, "creation_date": 1547312573, "answer_id": 54161874, "question_id": 54161698, "link": "https://stackoverflow.com/questions/54161698/how-to-convert-postgresql-json-type-to-golang-native/54161874#54161874", "title": "How to convert postgresql json type to golang native?", "body": "<p>By implementing the <a href=\"https://golang.org/pkg/database/sql/#Scanner\" rel=\"nofollow noreferrer\"><code>sql.Scanner</code></a> interface on <code>MY_JSON</code>, your code should work as is. To do this, you need only to add the <code>Scan</code> method on the <code>MY_JSON</code> type (with pointer receiver).</p>\n\n<pre><code>func (m *MY_JSON) Scan(src interface{}) error {\n    bs, ok := src.([]byte)\n    if !ok {\n        return errors.New(\"not a []byte\")\n    }\n    return json.Unmarshal(bs, m)\n}\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 6513915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04fcbd92e7c84194bdb9b93197e64337?s=128&d=identicon&r=PG&f=1", "display_name": "J L", "link": "https://stackoverflow.com/users/6513915/j-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1225, "favorite_count": 1, "accepted_answer_id": 54161874, "answer_count": 1, "score": 3, "last_activity_date": 1547312573, "creation_date": 1547311354, "question_id": 54161698, "link": "https://stackoverflow.com/questions/54161698/how-to-convert-postgresql-json-type-to-golang-native", "title": "How to convert postgresql json type to golang native?", "body": "<p>I am trying to convert a postgres column that is of type json to golang json object.</p>\n\n<pre><code>type MY_JSON struct {\n  MY_ID string `json:\"my_id\"`\n  MY_INFO []MY_INNER_JSON `json:\"my_info\"`\n}\n\ntype MY_INNER_JSON struct {\n    SOME_ID   string `json:\"some_id\"`\n    SOME_NUM  int64 `json:\"some_num\"`\n    SOME_OPTIONAL  string `json:\"some_optional,omitempty\"`\n}\n\nrows, err := db.Query(\"SELECT my_json FROM my_json_table LIMIT 1;\")\n\nfor rows.Next() {\n    var mycolumn MY_JSON\n    err = rows.Scan(&amp;mycolumn)\n    fmt.Println(mycolumn)\n}\n</code></pre>\n\n<p>This is what the json looks like</p>\n\n<pre><code>{\n    \"my_id\": \"this is my_id\",\n    \"my_info\": [\n        {\n            \"some_id\": \"some_id\",\n            \"some_num\": 123\n        },\n        {\n            \"some_id\": \"some_id\",\n            \"some_num\": 123,\n            \"some_optional\": \"sometimes more\"\n        },\n    ]\n}\n</code></pre>\n\n<p>I am getting panic from golang during runtime.</p>\n\n<p>Can someone point me a direction and tell me where I am doing wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1547301088, "post_id": 54160196, "comment_id": 95150417, "body": "It&#39;s a <i>type assertion</i>. <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Type_assertions</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1547301883, "post_id": 54160196, "comment_id": 95150589, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/38816843/explain-type-assertions-in-go\">Explain Type Assertions in Go</a>"}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 2, "last_activity_date": 1547303238, "last_edit_date": 1547303238, "creation_date": 1547302357, "answer_id": 54160386, "question_id": 54160196, "link": "https://stackoverflow.com/questions/54160196/type-assertion-syntax-using-go-ast/54160386#54160386", "title": "Type assertion syntax using go/ast", "body": "<p>As the comments say, this is a type assertion. Type assertions are described in the Go spec: <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Type_assertions</a></p>\n\n<p>Applied to your specific code sample, I think it's taken from the <a href=\"https://golang.org/pkg/go/ast/\" rel=\"nofollow noreferrer\">AST module documentation</a>, which you should read if you want to work with Go ASTs.</p>\n\n<p><code>ParseFile</code> returns an <code>ast.File</code>, which is:</p>\n\n<pre><code>type File struct {\n        Doc        *CommentGroup   // associated documentation; or nil\n        Package    token.Pos       // position of \"package\" keyword\n        Name       *Ident          // package name\n        Decls      []Decl          // top-level declarations; or nil\n        Scope      *Scope          // package scope (this file only)\n        Imports    []*ImportSpec   // imports in this file\n        Unresolved []*Ident        // unresolved identifiers in this file\n        Comments   []*CommentGroup // list of all comments in the source file\n}\n</code></pre>\n\n<p>So <code>Decls</code> is a slice of <code>Decl</code>, which is <em>an interface</em>. In brief, this means that at compile-time you don't know what the actual underlying type is (though you do know it satisfies the interface), so you do a run-time type assertion to verify it's something you expect.</p>\n\n<pre><code>    if f, ok := d.(*ast.FuncDecl); ok {\n        name := f.Name.String()\n        if regexp == nil || regexp.MatchString(name) {\n            tests = append(tests, name)\n        }\n    }\n</code></pre>\n\n<p>This means \"if <code>d</code> is actually a <code>FuncDecl</code>, do this thing\".</p>\n"}], "owner": {"reputation": 320, "user_id": 2803909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LFlVf.jpg?s=128&g=1", "display_name": "Minh Tri Le", "link": "https://stackoverflow.com/users/2803909/minh-tri-le"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 54160386, "answer_count": 1, "score": 0, "last_activity_date": 1547303280, "creation_date": 1547301040, "last_edit_date": 1547303280, "question_id": 54160196, "link": "https://stackoverflow.com/questions/54160196/type-assertion-syntax-using-go-ast", "title": "Type assertion syntax using go/ast", "body": "<p>I have read through the piece of code bellow and I don't know what exactly the syntax of\n <strong>d.()</strong> \nin \n <strong>if f, ok := d.(*ast.FuncDecl);</strong> mean. </p>\n\n<p>Can anybody explain it for me? </p>\n\n<pre><code>package main\n\nimport (\n    \"go/ast\"\n    \"go/parser\"\n    \"go/token\"\n    \"regexp\"\n\n    \"github.com/posener/complete\"\n)\n\nfunc functionsInFile(path string, regexp *regexp.Regexp) (tests []string) {\n    fset := token.NewFileSet()\n    f, err := parser.ParseFile(fset, path, nil, 0)\n    if err != nil {\n        complete.Log(\"Failed parsing %s: %s\", path, err)\n        return nil\n    }\n    for _, d := range f.Decls {\n        if f, ok := d.(*ast.FuncDecl); ok {\n            name := f.Name.String()\n            if regexp == nil || regexp.MatchString(name) {\n                tests = append(tests, name)\n            }\n        }\n    }\n    return\n}\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 1, "creation_date": 1547286414, "post_id": 54158249, "comment_id": 95146902, "body": "Have you tried something?"}, {"owner": {"reputation": 506, "user_id": 5165511, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/970e5ae962c625b4911f451d694e92dc?s=128&d=identicon&r=PG&f=1", "display_name": "curious_gudleif", "link": "https://stackoverflow.com/users/5165511/curious-gudleif"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1547287942, "post_id": 54158249, "comment_id": 95147286, "body": "@\u0417\u0435\u043b\u0451\u043d\u044b\u0439 well for starters I&#39;ve tried to read documentation several times but it has no hints as to how to achieve that. I could create a counter field and use it for sort but I don&#39;t want to manually maintain it. It would be really nice to have something like like rails&#39; counter_cache but alas."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1547288518, "post_id": 54158249, "comment_id": 95147406, "body": "This really has nothing to do with GORM. This is just a matter of forming the right SQL query. What have you tried?"}], "answers": [{"tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 1, "last_activity_date": 1547288560, "creation_date": 1547288560, "answer_id": 54158657, "question_id": 54158249, "link": "https://stackoverflow.com/questions/54158249/go-gorm-order-by-association-count/54158657#54158657", "title": "Go gorm order by association count", "body": "<p>There is no such feature like <a href=\"https://guides.rubyonrails.org/association_basics.html#options-for-belongs-to-counter-cache\" rel=\"nofollow noreferrer\"><code>rails counter cache</code></a> in the gorm, but gorm has callbacks <a href=\"http://gorm.io/docs/hooks.html\" rel=\"nofollow noreferrer\"><code>before*</code> &amp; <code>after*</code></a> so it is easy to implement order by collection count feature.</p>\n\n<p>For example:</p>\n\n<pre><code>// Updating data in same transaction\nfunc (c *Collection) AfterUpdate(tx *gorm.DB) (err error) {\n  tx.Model(&amp;Collection{}).Where(\"id = ?\", c.ID).Update(\"items_count\", gorm.Expr(\"items_count + ?\", 1))\n  return\n}\n</code></pre>\n"}], "owner": {"reputation": 506, "user_id": 5165511, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/970e5ae962c625b4911f451d694e92dc?s=128&d=identicon&r=PG&f=1", "display_name": "curious_gudleif", "link": "https://stackoverflow.com/users/5165511/curious-gudleif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 578, "favorite_count": 1, "accepted_answer_id": 54158657, "answer_count": 1, "score": 1, "last_activity_date": 1547288560, "creation_date": 1547285115, "question_id": 54158249, "link": "https://stackoverflow.com/questions/54158249/go-gorm-order-by-association-count", "title": "Go gorm order by association count", "body": "<p>I have a following data structure:</p>\n\n<pre><code>type Collection struct {\n    gorm.Model\n    Name            string\n    CollectionItems []CollectionItem\n}\n\ntype CollectionItem struct {\n    CollectionID uint\n    ItemID     uint\n    Item\n}\n</code></pre>\n\n<p>How can I query <code>collections</code> table ordering results by a number of <code>collection_item</code> associations i.e. collections with most items come first.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 10874864, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uywxa.jpg?s=128&g=1", "display_name": "Sunshine", "link": "https://stackoverflow.com/users/10874864/sunshine"}, "edited": false, "score": 0, "creation_date": 1547282490, "post_id": 54157914, "comment_id": 95146167, "body": "Ok, Thanks for your advice, but it&#39;s hard to understand channel for me, I will try again."}, {"owner": {"reputation": 1138, "user_id": 296066, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/940b69b965704253eca438cdfaf72b15?s=128&d=identicon&r=PG", "display_name": "metalim", "link": "https://stackoverflow.com/users/296066/metalim"}, "reply_to_user": {"reputation": 61, "user_id": 10874864, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uywxa.jpg?s=128&g=1", "display_name": "Sunshine", "link": "https://stackoverflow.com/users/10874864/sunshine"}, "edited": false, "score": 0, "creation_date": 1547284860, "post_id": 54157914, "comment_id": 95146612, "body": "Added buffered channel example."}, {"owner": {"reputation": 61, "user_id": 10874864, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uywxa.jpg?s=128&g=1", "display_name": "Sunshine", "link": "https://stackoverflow.com/users/10874864/sunshine"}, "edited": false, "score": 0, "creation_date": 1547288075, "post_id": 54157914, "comment_id": 95147317, "body": "According to your idea, I try the code again, it runs successfully, Thx again for your help. I&#39;m a newbie of golang and need to go on learning more knowledge about it."}], "tags": [], "owner": {"reputation": 1138, "user_id": 296066, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/940b69b965704253eca438cdfaf72b15?s=128&d=identicon&r=PG", "display_name": "metalim", "link": "https://stackoverflow.com/users/296066/metalim"}, "is_accepted": true, "score": 6, "last_activity_date": 1547284731, "last_edit_date": 1547284731, "creation_date": 1547281811, "answer_id": 54157914, "question_id": 54157836, "link": "https://stackoverflow.com/questions/54157836/a-simple-example-about-go-channel-with-deadlock-and-why/54157914#54157914", "title": "A simple example about Go Channel with deadlock and why", "body": "<p>Quote from <a href=\"https://tour.golang.org/concurrency/2\" rel=\"noreferrer\">https://tour.golang.org/concurrency/2</a>:</p>\n\n<blockquote>\n  <p>By default, sends and receives block until the other side is ready.\n  This allows goroutines to synchronize without explicit locks or\n  condition variables.</p>\n</blockquote>\n\n<p>Channels are meant to work between goroutines, but you have only 1. So <code>c1 &lt;- 10</code> blocks execution, until someone (usually in other goroutine) receives the value.</p>\n\n<p>To fix that:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    c1 := make(chan int)\n\n    go func() {\n        g1 := &lt;- c1 // wait for value\n        fmt.Println(\"get g1: \", g1)\n    }()\n\n    fmt.Println(\"push c1: \")\n    c1 &lt;- 10 // send value and wait until it is received.\n}\n</code></pre>\n\n<p>Try executing it in <a href=\"https://play.golang.org/p/qEW2jF3ntcW\" rel=\"noreferrer\">The Go Playground</a>.</p>\n\n<p>I suggest you go through official Go concurrency tour starting from <a href=\"https://tour.golang.org/concurrency/1\" rel=\"noreferrer\">https://tour.golang.org/concurrency/1</a></p>\n\n<p><strong>EDIT:</strong> Another option is to use Buffered channel, like below. However making Buffered channel does <strong>not</strong> mean it has non-blocking send/receive operations. It just means it will block send after N values in queue, where N is always predefined number. Internally it will store sent values into an array, and block until values are received (like non-buffered channel) when that array is filled.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    c1 := make(chan int, 1) // buffers 1 value without blocking.\n    fmt.Println(\"push c1: \")\n    c1 &lt;- 10\n    g1 := &lt;- c1\n    fmt.Println(\"get g1: \", g1)\n}\n</code></pre>\n\n<p>Try it on <a href=\"https://play.golang.org/p/7x_91oSoI2v\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 61, "user_id": 10874864, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uywxa.jpg?s=128&g=1", "display_name": "Sunshine", "link": "https://stackoverflow.com/users/10874864/sunshine"}, "edited": false, "score": 0, "creation_date": 1547398957, "post_id": 54164804, "comment_id": 95171214, "body": "Thanks a lot for your advice and I need to write some code about channel and to understand it&#39;s meaning.Thx very much."}], "tags": [], "owner": {"reputation": 104, "user_id": 6246590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed25f9b404bdde9d5a903a6d283da514?s=128&d=identicon&r=PG&f=1", "display_name": "echmel", "link": "https://stackoverflow.com/users/6246590/echmel"}, "is_accepted": false, "score": 0, "last_activity_date": 1547335488, "creation_date": 1547335488, "answer_id": 54164804, "question_id": 54157836, "link": "https://stackoverflow.com/questions/54157836/a-simple-example-about-go-channel-with-deadlock-and-why/54164804#54164804", "title": "A simple example about Go Channel with deadlock and why", "body": "<p>Channel could be buffered or nonbuffered (it means that it's possible to send into it the only value of a variable) and when you try to read from a nonbuffered channel you lock a goroutine in which you try to execute this operation. In order to unlock it, you have to write into the channel in another goroutine and vice versa, that is when you write on a channel you lock a goroutine in which you execute this operation but it will be unlocked when you try to read from the channel in another goroutine. You should learn this feature for developing flexible (with concurrency) programs. Channels are used for sending data between different routines which have to work independently or in parallel. You can create a pipeline of two, three or more goroutines for sending data from one goroutine to another by sequentially.</p>\n\n<p>In this example I create a channel of bool type <strong>ch</strong>. It's impossible to say exactly what line of 9-th and 11-th will be executed the first. \n<strong>sendq</strong> - is a list goroutines that are waiting writing to the channel. In this case the main (<strong>func main</strong>) routine is waiting when a line number 9 will be executed.</p>\n\n<p><a href=\"https://i.stack.imgur.com/vzDQq.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vzDQq.png\" alt=\"enter image description here\"></a></p>\n\n<p>Another example where we have deadlock. Execution will never go to 8-th line so goroutine (next line), in which I try to write data to channel, will never be launched.</p>\n\n<p><a href=\"https://i.stack.imgur.com/Mv2zc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Mv2zc.png\" alt=\"enter image description here\"></a></p>\n\n<p>More information about channels you can find here:\n<a href=\"http://dmitryvorobev.blogspot.com/2016/08/golang-channels-implementation.html\" rel=\"nofollow noreferrer\">http://dmitryvorobev.blogspot.com/2016/08/golang-channels-implementation.html</a></p>\n\n<p>There is such term as m:n scheduling. Golang has a m:n scheduler that is at m goroutines could be scheduled on n OS threads by Go scheduler.\n<a href=\"https://medium.com/@riteeksrivastava/a-complete-journey-with-goroutines-8472630c7f5c\" rel=\"nofollow noreferrer\">https://medium.com/@riteeksrivastava/a-complete-journey-with-goroutines-8472630c7f5c</a></p>\n\n<p>I recommend you to look through this book: <a href=\"https://rads.stackoverflow.com/amzn/click/com/0134190440\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">https://www.amazon.com/Programming-Language-Addison-Wesley-Professional-Computing/dp/0134190440</a> . In my opinion, this is the best book about Golang that gives a description of lots of conceptions and features of this language.</p>\n\n<p>About the difference between concurrency and parallelism you can read here: <a href=\"https://www.ardanlabs.com/blog/2018/12/scheduling-in-go-part3.html\" rel=\"nofollow noreferrer\">https://www.ardanlabs.com/blog/2018/12/scheduling-in-go-part3.html</a></p>\n"}], "owner": {"reputation": 61, "user_id": 10874864, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uywxa.jpg?s=128&g=1", "display_name": "Sunshine", "link": "https://stackoverflow.com/users/10874864/sunshine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2183, "favorite_count": 0, "accepted_answer_id": 54157914, "answer_count": 2, "score": 3, "last_activity_date": 1547335488, "creation_date": 1547280916, "question_id": 54157836, "link": "https://stackoverflow.com/questions/54157836/a-simple-example-about-go-channel-with-deadlock-and-why", "title": "A simple example about Go Channel with deadlock and why", "body": "<p>My code as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    c1 := make(chan int)\n    fmt.Println(\"push c1: \")\n    c1 &lt;- 10\n    g1 := &lt;- c1\n    fmt.Println(\"get g1: \", g1)\n}\n</code></pre>\n\n<p>when I debug with delve, it prints this result:</p>\n\n<pre><code>push c1:\nfatal error: all goroutines are asleep - deadlock!\ngoroutine 1 [chan send]:\nmain.main()\n        D:/Go/projects/hello-world/src/ch9/code9_6/code1.go:10 +0xde\nProcess 6276 has exited with status 2\n</code></pre>\n\n<p>I don't know why, it's just one simple channel example, I make one channel, send value to it and get value from it, just this, someone can tell me why, and how to correct it, Thx a lot. </p>\n"}, {"tags": ["sockets", "go", "concurrency", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 0, "last_activity_date": 1547299189, "last_edit_date": 1547299189, "creation_date": 1547298683, "answer_id": 54159909, "question_id": 54157736, "link": "https://stackoverflow.com/questions/54157736/whats-the-proper-way-to-use-sockets-in-goroutines/54159909#54159909", "title": "What&#39;s the proper way to use sockets in goroutines", "body": "<p>The <a href=\"https://golang.org/pkg/net/#Conn\" rel=\"nofollow noreferrer\">documentation of net.Conn</a> says:</p>\n\n<blockquote>\n  <p>Multiple goroutines may invoke methods on a Conn simultaneously.</p>\n</blockquote>\n\n<p>So I suspect this is not the issue per se, but rather you have a bug in your code.</p>\n\n<p>It is difficult to debug your code without setting up your env with the shard and client etc., but I just want to point out that concurrent access to <code>Conn</code> is not the problem. Try to instrument the client read more - is there any data read with the EOF?</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1547304723, "creation_date": 1547304723, "answer_id": 54160704, "question_id": 54157736, "link": "https://stackoverflow.com/questions/54157736/whats-the-proper-way-to-use-sockets-in-goroutines/54160704#54160704", "title": "What&#39;s the proper way to use sockets in goroutines", "body": "<p>The application handles all errors from network operations by calling <code>log.Fatal</code>.  The log.Fatal function exits the process.</p>\n\n<p>The log line </p>\n\n<pre><code>2019/01/12 14:32:45 FATAL: EOF\n</code></pre>\n\n<p>indicates that a peer closed a network connection. The application handled this error by exiting.</p>\n\n<p>The application should handle network errors by cleaning up any resources and exiting the goroutine.  For example:</p>\n\n<pre><code>func ClientToShard( client net.Conn, server net.Conn  ){\n    defer client.Close() // close network connections on return from this function\n    defer server.Close()\n\n    var buf = make([]byte, 1024)\n    var bufRead int\n    var err error\n\n    for {\n        bufRead, err = server.Read(buf)\n        if err != nil {\n            return\n        }\n\n        if bufRead &gt; 0 {\n            fmt.Printf(\"ClientToShard(%d): %X\\n\", bufRead, buf[0:bufRead])\n            bufRead, err = client.Write(buf[0:bufRead])\n            if err != nil {\n                return\n            }\n        }\n    }\n\n}\n</code></pre>\n\n<p>Make a similar change to ShardToClient.</p>\n\n<p>Bonus comment: Replace the core of <code>ClientToShard</code> with a call to <a href=\"https://godoc.org/io#Copy\" rel=\"nofollow noreferrer\">io.Copy</a>.</p>\n"}], "owner": {"reputation": 21, "user_id": 7906378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cf8ccf679778e59a42086c544f6df6b?s=128&d=identicon&r=PG&f=1", "display_name": "gabrielpe", "link": "https://stackoverflow.com/users/7906378/gabrielpe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 432, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1547304723, "creation_date": 1547279610, "last_edit_date": 1592644375, "question_id": 54157736, "link": "https://stackoverflow.com/questions/54157736/whats-the-proper-way-to-use-sockets-in-goroutines", "title": "What&#39;s the proper way to use sockets in goroutines", "body": "<p>Im reading different things about sockets in Go lang. Can it be used in 2 goroutines for reading and writing without any concurrency control?</p>\n<p>Im showing the code below, but I also failed using channels.</p>\n<p>I basically created a small app to intercept the communication protocol of a certain application and I'm replacing a few bytes from the server before it hits the client in my pc.</p>\n<p>for that I have 2 go routines:</p>\n<p>One reading the socket from the server, replacing some bytes and sending to the client.</p>\n<p>The other is reading the socket from the client and sending to the server.</p>\n<p>it works fine for a few messages an then crashes.\nThis is my code and console output:</p>\n<p>***Note:A similar implementation in python works fine.</p>\n<pre><code>    package main\n\n    import (\n        &quot;fmt&quot;\n        &quot;net&quot;\n        &quot;sync&quot;\n        &quot;log&quot;\n    )\n\n    func main() {\n\n    var wg sync.WaitGroup\n    wg.Add(2)\n\n    server := StartShard()\n    client := StartClient()\n\n    go func() {\n        ShardToClient(client, server)\n        wg.Done()\n    }()\n\n    go func() {\n        ClientToShard(client, server)\n        wg.Done()\n    }()\n\n    wg.Wait()\n\n}\n\nfunc StartClient() (net.Conn){\n\n    servAddr := &quot;server1.gamek.io:2593&quot;\n    tcpAddr, err := net.ResolveTCPAddr(&quot;tcp4&quot;, servAddr)\n    checkError(err)\n    conn, err := net.DialTCP(&quot;tcp&quot;, nil, tcpAddr)\n    checkError(err)\n\n    return conn\n}\n\nfunc StartShard() (net.Conn){\n\n    service := &quot;localhost:2593&quot;\n    tcpAddr, err := net.ResolveTCPAddr(&quot;tcp4&quot;, service)\n    checkError(err)\n    listener, err := net.ListenTCP(&quot;tcp&quot;, tcpAddr)\n    checkError(err)\n    conn, err := listener.Accept()\n    checkError(err)\n\n    return conn\n}\n\n\nfunc ShardToClient( client net.Conn, server net.Conn  ){\n\n    var buf = make([]byte, 1024)\n    var bufRead int\n    var err error\n\n    for {\n        bufRead, err = client.Read(buf)\n        checkError(err)\n\n        if bufRead &gt; 0 {\n            if buf[0] == 0x8C{\n                fmt.Println(&quot;AVOIDING REDIRECTION ...&quot;)\n                buf[1] = 127;\n                buf[2] = 0;\n                buf[3] = 0;\n                buf[4] = 1;\n            }\n            fmt.Printf(&quot;ShardToClient(%d): %X\\n&quot;, bufRead, buf[0:bufRead])\n            bufRead, _ = server.Write(buf[0:bufRead])\n\n        }\n    }\n}\n\nfunc ClientToShard( client net.Conn, server net.Conn  ){\n\n    var buf = make([]byte, 1024)\n    var bufRead int\n    var err error\n\n    for {\n        bufRead, err = server.Read(buf)\n        checkError(err)\n\n        if bufRead &gt; 0 {\n            fmt.Printf(&quot;ClientToShard(%d): %X\\n&quot;, bufRead, buf[0:bufRead])\n            bufRead, err = client.Write(buf[0:bufRead])\n            checkError(err)\n        }\n    }\n\n}\n\nfunc checkError(err error) {\n    if err != nil {\n        log.Fatal(&quot;fatal: %s&quot;, err)\n    }\n}\n</code></pre>\n<p>OUTPUT:</p>\n<blockquote>\n<p>ClientToShard(66): 0E00A8C08067616270000000073776F720000000FF</p>\n<p>ShardToClient(3): BD0003</p>\n<p>ClientToShard(11): BD000B352E302E392E3000</p>\n<p>ShardToClient(46):</p>\n<p>A8002EFF000100015468652046690D0F723</p>\n<p>ClientToShard(3): A00001</p>\n<p>AVOIDING REDIRECTION ...</p>\n<p>ShardToClient(11): 8C7F0000010A214C8D6573</p>\n<p>2019/01/12 14:32:45 FATAL: EOF</p>\n</blockquote>\n"}, {"tags": ["go", "image-processing", "gif"], "comments": [{"owner": {"reputation": 461, "user_id": 1821490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/U91FX.jpg?s=128&g=1", "display_name": "Alex Kroll", "link": "https://stackoverflow.com/users/1821490/alex-kroll"}, "edited": false, "score": 0, "creation_date": 1547275331, "post_id": 54157111, "comment_id": 95145081, "body": "bimg uses libvips via C-bindings. Does your  lipvbs builded with gif support?"}], "answers": [{"tags": [], "owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "is_accepted": false, "score": 0, "last_activity_date": 1547612142, "creation_date": 1547612142, "answer_id": 54210342, "question_id": 54157111, "link": "https://stackoverflow.com/questions/54157111/how-to-use-golang-compress-and-resize-a-gif/54210342#54210342", "title": "how to use golang compress and resize a gif", "body": "<p>I've never used but I think you can read/write GIFs using the std library (import \"image/gif\"). Then resize using something like \"resize\" (see <a href=\"https://stackoverflow.com/questions/22940724/go-resizing-images\">Go Resizing Images</a>) </p>\n"}, {"comments": [{"owner": {"reputation": 303, "user_id": 6449456, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-vKHnQSa8guA/AAAAAAAAAAI/AAAAAAAAAC8/3e1IcSxXIjk/photo.jpg?sz=128", "display_name": "wkzq", "link": "https://stackoverflow.com/users/6449456/wkzq"}, "edited": false, "score": 0, "creation_date": 1549933701, "post_id": 54210633, "comment_id": 96074582, "body": "<code>resize</code> only supports resize a image, does not support compression"}, {"owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "reply_to_user": {"reputation": 303, "user_id": 6449456, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-vKHnQSa8guA/AAAAAAAAAAI/AAAAAAAAAC8/3e1IcSxXIjk/photo.jpg?sz=128", "display_name": "wkzq", "link": "https://stackoverflow.com/users/6449456/wkzq"}, "edited": false, "score": 0, "creation_date": 1549951976, "post_id": 54210633, "comment_id": 96078949, "body": "image.Image is an interface (<code>https:&#47;&#47;golang.org&#47;pkg&#47;image&#47;#Image</code>). And image.Paletted implemented that interface. Check <code>https:&#47;&#47;golang.org&#47;pkg&#47;image&#47;#Paletted</code>."}], "tags": [], "owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "is_accepted": true, "score": 2, "last_activity_date": 1579835456, "last_edit_date": 1579835456, "creation_date": 1547614340, "answer_id": 54210633, "question_id": 54157111, "link": "https://stackoverflow.com/questions/54157111/how-to-use-golang-compress-and-resize-a-gif/54210633#54210633", "title": "how to use golang compress and resize a gif", "body": "<p>see doc <a href=\"https://golang.org/pkg/image/gif/#GIF\" rel=\"nofollow noreferrer\">https://golang.org/pkg/image/gif/#GIF</a></p>\n\n<pre><code>func DecodeAll(r io.Reader) (*GIF, error)\n</code></pre>\n\n<p>now you can get a GIF struct </p>\n\n<pre><code>type GIF struct {\n        Image []*image.Paletted // The successive images.\n</code></pre>\n\n<p>then you can resize each of Image in GIF. </p>\n\n<pre><code>for _,img:=range gif.Image{\n    resize(img)\n}\n</code></pre>\n\n<p>PS: image.Paletted implemented image.Image, so you can use <a href=\"https://github.com/nfnt/resize\" rel=\"nofollow noreferrer\">https://github.com/nfnt/resize</a> to resize the Image.</p>\n"}], "owner": {"reputation": 303, "user_id": 6449456, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-vKHnQSa8guA/AAAAAAAAAAI/AAAAAAAAAC8/3e1IcSxXIjk/photo.jpg?sz=128", "display_name": "wkzq", "link": "https://stackoverflow.com/users/6449456/wkzq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1908, "favorite_count": 0, "accepted_answer_id": 54210633, "answer_count": 2, "score": 2, "last_activity_date": 1579835456, "creation_date": 1547272169, "question_id": 54157111, "link": "https://stackoverflow.com/questions/54157111/how-to-use-golang-compress-and-resize-a-gif", "title": "how to use golang compress and resize a gif", "body": "<p>Is there has method or lib to compress and resize a gif use golang?</p>\n\n<p>ps: I was tried <strong><a href=\"https://github.com/h2non/bimg\" rel=\"nofollow noreferrer\">bimg</a></strong>, but it not support gif.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 7583410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e75838fe04d594f40feb46001c3e1a79?s=128&d=identicon&r=PG&f=1", "display_name": "John Baker", "link": "https://stackoverflow.com/users/7583410/john-baker"}, "edited": false, "score": 0, "creation_date": 1547270216, "post_id": 54156899, "comment_id": 95144433, "body": "I&#39;m on the most recent version. go version outputs: go version go1.11.4 windows/amd64  This was a fresh install of go.  I tried go clean -cache and tried forcing a rebuild again and am still receiving the same error.  Also, it should be mentioned I can only seem to find one package for time and it has the the Until function included. I don&#39;t know where the pre-1.8 package would be coming from since this was a fresh install of 1.11"}, {"owner": {"reputation": 79, "user_id": 7583410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e75838fe04d594f40feb46001c3e1a79?s=128&d=identicon&r=PG&f=1", "display_name": "John Baker", "link": "https://stackoverflow.com/users/7583410/john-baker"}, "edited": false, "score": 0, "creation_date": 1547273592, "post_id": 54156899, "comment_id": 95144831, "body": "Same issue after running go install -v -a in the lib/pq directory"}, {"owner": {"reputation": 79, "user_id": 7583410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e75838fe04d594f40feb46001c3e1a79?s=128&d=identicon&r=PG&f=1", "display_name": "John Baker", "link": "https://stackoverflow.com/users/7583410/john-baker"}, "edited": false, "score": 0, "creation_date": 1547275616, "post_id": 54156899, "comment_id": 95145122, "body": "I did a global search of C: and this is all of the references to it:  <code>.&#47;Go&#47;src&#47;runtime&#47;time.go</code>  <code>.&#47;Go&#47;src&#47;time&#47;time.go</code>  <code>.&#47;HashiCorp&#47;Vagrant&#47;embedded&#47;usr&#47;lib&#47;guile&#47;2.2&#47;ccache&#47;ice-9&#47;&zwnj;&#8203;time.go</code>  time.a here:  <code>.&#47;Go&#47;pkg&#47;windows_amd64&#47;time.a</code> <code>.&#47;Go&#47;pkg&#47;windows_amd64_race&#47;time.a</code> <code>.&#47;Go&#47;pkg&#47;windows_amd64_testcshared&#47;time.a</code>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1547274668, "last_edit_date": 1547274668, "creation_date": 1547269285, "answer_id": 54156899, "question_id": 54156819, "link": "https://stackoverflow.com/questions/54156819/go-lib-pq-open-method-returning-undefined-time-until/54156899#54156899", "title": "Go lib/pq open method returning undefined: time.Until", "body": "<blockquote>\n  <p><a href=\"https://golang.org/doc/go1.8\" rel=\"nofollow noreferrer\">Go 1.8 Release Notes</a></p>\n  \n  <p><a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">time</a></p>\n  \n  <p>The new function <a href=\"https://golang.org/pkg/time/#Until\" rel=\"nofollow noreferrer\">Until</a> complements the analogous Since function.</p>\n</blockquote>\n\n<hr>\n\n<p>You are picking up a package <code>time</code> prior to Go 1.8.</p>\n\n<p>What is your output from the <code>go version</code> command?</p>\n\n<p>Clean all caches. For example, <code>go clean -cache</code>. Search for occurrences of <code>pkg</code> file <code>time.a</code>.</p>\n\n<p>Reinstall the <code>time</code> package, forcing a rebuild: <code>go install -v -a time</code>.</p>\n\n<p>Reinstall the <code>lib/pq</code> package, forcing a rebuild: <code>cd</code> to <code>vendor/github.com/lib/pq</code> then <code>go install -v -a</code>.</p>\n\n<p>Where are all the <code>time.go</code> and <code>time.a</code> files on your system?</p>\n"}], "owner": {"reputation": 79, "user_id": 7583410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e75838fe04d594f40feb46001c3e1a79?s=128&d=identicon&r=PG&f=1", "display_name": "John Baker", "link": "https://stackoverflow.com/users/7583410/john-baker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 235, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1547274668, "creation_date": 1547268114, "question_id": 54156819, "link": "https://stackoverflow.com/questions/54156819/go-lib-pq-open-method-returning-undefined-time-until", "title": "Go lib/pq open method returning undefined: time.Until", "body": "<p>I'm running into a weird issue with the <strong>lib/pq</strong> GO Package.</p>\n\n<p>When attempting to open a connection, I'm receiving the following error:</p>\n\n<pre><code>vendor/github.com/lib/pq/notify.go:790: undefined: time.Until\n</code></pre>\n\n<p>I checked my $GOROOT and it's set correctly. <strong>Until</strong> is defined inside of the Time package. All the other methods seem to be working correctly, it's just <strong>Until</strong> that is breaking the build.</p>\n\n<p>My $GOPATH is set correctly as well. </p>\n\n<p>I was see the minimum version <strong>lib/pq</strong> supports is <strong>1.8</strong>, I'm using <strong>1.11</strong>\nFor the life of me, I can't figure out what is causing it. After doing some research, it seems most people were able to fix this by upgrading, but I'm on the most recent version (and I'd rather not downgrade to fix).</p>\n\n<p>Relevant GO environment information below:</p>\n\n<pre><code>set GOARCH=amd64\nset GOBIN=\nset GOCACHE=C:\\Users\\Jeff\\AppData\\Local\\go-build\nset GOEXE=.exe\nset GOFLAGS=\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOOS=windows\nset GOPATH=C:\\Users\\Jeff\\go\nset GOPROXY=\nset GORACE=\nset GOROOT=C:\\Go\nset GOTMPDIR=\nset GOTOOLDIR=C:\\Go\\pkg\\tool\\windows_amd64\n</code></pre>\n\n<p>My Project path is:</p>\n\n<pre><code>/c/Users/Jeff/go/src/github.com/project/m1\n</code></pre>\n\n<p>main.go is running the following (which is causing the error)</p>\n\n<pre><code>func initDB(){\n    var err error\n    db, err = sql.Open(\"postgres\", \"dbname=mydb sslmode=disable\")\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Any help would be appreciated.</p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 20, "last_activity_date": 1547776912, "last_edit_date": 1547776912, "creation_date": 1547259174, "answer_id": 54156238, "question_id": 54156119, "link": "https://stackoverflow.com/questions/54156119/range-over-string-slice-in-golang-template/54156238#54156238", "title": "Range over string slice in golang template", "body": "<p>Use <code>.</code> to refer to a simple values like a string, int, etc.</p>\n\n<pre><code> {{range .DataFields}}{{.}}{{end}}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ITnFGRXAKI9\" rel=\"noreferrer\">Run it on the Playground</a>.</p>\n\n<p>You can also assign to a template variable as in <code>{{range $v := .DataFields}}{{$v}}{{end}}</code>, but that's extra work.  Embrace the <code>.</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "is_accepted": true, "score": 13, "last_activity_date": 1547326587, "last_edit_date": 1547326587, "creation_date": 1547326215, "answer_id": 54163753, "question_id": 54156119, "link": "https://stackoverflow.com/questions/54156119/range-over-string-slice-in-golang-template/54163753#54163753", "title": "Range over string slice in golang template", "body": "<p>Or assign it to a variable, similar to a normal Go range clause:</p>\n\n<pre><code> {{range $element := .DataFields}} {{$element}} {{end}}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Use8Za8vwey\" rel=\"noreferrer\">Run it on the Playground</a></p>\n\n<p>From the <a href=\"https://golang.org/pkg/text/template/\" rel=\"noreferrer\">docs for text/template</a> (serves as interface docs for html/template):</p>\n\n<blockquote>\n<pre>{{range pipeline}} T1 {{end}}\n    The value of the pipeline must be an array, slice, map, or channel.\n    If the value of the pipeline has length zero, nothing is output;\n    otherwise, <b>dot is set to the successive elements of the array,\n    slice, or map</b> and T1 is executed. If the value is a map and the\n    keys are of basic type with a defined order (\"comparable\"), the\n    elements will be visited in sorted key order.</pre>\n  \n  <p>...</p>\n  \n  <p>A pipeline inside an action may initialize a variable to capture the result. The initialization has syntax</p>\n  \n  <p><code>$variable := pipeline</code></p>\n  \n  <p>...</p>\n  \n  <p>If a \"range\" action initializes a variable, the variable is set to the successive elements of the iteration. Also, a \"range\" may declare two variables, separated by a comma:</p>\n  \n  <p><code>range $index, $element := pipeline</code></p>\n  \n  <p>in which case $index and $element are set to the successive values of the array/slice index or map key and element, respectively. <strong>Note that if there is only one variable, it is assigned the element; this is opposite to the convention in Go range clauses.</strong></p>\n  \n  <p>(bold portions emphasized by me)</p>\n</blockquote>\n"}], "owner": {"reputation": 233, "user_id": 6659021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6252687fde50e99e62377a916d5f05dc?s=128&d=identicon&r=PG&f=1", "display_name": "JetThomas", "link": "https://stackoverflow.com/users/6659021/jetthomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14573, "favorite_count": 2, "accepted_answer_id": 54163753, "answer_count": 2, "score": 10, "last_activity_date": 1547776912, "creation_date": 1547257784, "last_edit_date": 1547292644, "question_id": 54156119, "link": "https://stackoverflow.com/questions/54156119/range-over-string-slice-in-golang-template", "title": "Range over string slice in golang template", "body": "<p>I have a struct that contains a slice of type string like the following. </p>\n\n<pre><code> type Data struct {\n      DataFields []string\n }\n</code></pre>\n\n<p>Within my html template file I would like to range over the string slice. However, the individual fields are just strings without any struct name. How can I loop over a slice that contains a simple type such as string, int, etc?</p>\n"}, {"tags": ["mysql", "sql", "json", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 573, "user_id": 1739369, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1721913f6713c5772c3d34692d97ac6d?s=128&d=identicon&r=PG", "display_name": "JonTroncoso", "link": "https://stackoverflow.com/users/1739369/jontroncoso"}, "edited": false, "score": 0, "creation_date": 1547255460, "post_id": 54155846, "comment_id": 95142714, "body": "So, I still need to create a <code>fieldNames</code> that has the field names? and it can&#39;t be snake_case (cuz that&#39;s what they are)?  Regardless of if I go this way, thanks for showing me some interesting Go that I wasn&#39;t aware of."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 573, "user_id": 1739369, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1721913f6713c5772c3d34692d97ac6d?s=128&d=identicon&r=PG", "display_name": "JonTroncoso", "link": "https://stackoverflow.com/users/1739369/jontroncoso"}, "edited": false, "score": 0, "creation_date": 1547256077, "post_id": 54155846, "comment_id": 95142803, "body": "The above code works with snake_case names. The only requirement is that the JSON property names match the table field names. Query the database to get the field names.  See <a href=\"https://stackoverflow.com/questions/1526688/get-table-column-names-in-mysql\">Get table column names in MySQL?</a> for an example of the queries to use."}, {"owner": {"reputation": 573, "user_id": 1739369, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1721913f6713c5772c3d34692d97ac6d?s=128&d=identicon&r=PG", "display_name": "JonTroncoso", "link": "https://stackoverflow.com/users/1739369/jontroncoso"}, "edited": false, "score": 0, "creation_date": 1547625531, "post_id": 54155846, "comment_id": 95250959, "body": "Thanks, I expanded on your example to fit my needs. Specifically, I used a switch to handle different fields differently. I might post my code later, but I&#39;d need to remove IP. Am I correct in understanding that this is not type safe? And that I need to use a struct for type safety? I might post a separate question on that"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1547653648, "last_edit_date": 1547653648, "creation_date": 1547254198, "answer_id": 54155846, "question_id": 54155668, "link": "https://stackoverflow.com/questions/54155668/how-do-i-convert-a-json-object-into-a-mysql-row/54155846#54155846", "title": "How do I convert a JSON object into a MySQL row?", "body": "<p>Use the following given a slice of valid database field names <code>fieldNames</code> and JSON data <code>data</code>:</p>\n\n<pre><code>var j map[string]interface{}\nif err := json.Unmarshal(data, &amp;j); err != nil {\n    // handle error\n}\nvar names []string\nvar inserts []string\nvar values []interface{}\nfor _, n := range fieldNames {\n    if v, ok := j[n]; ok {\n        names = append(names, n)\n        inserts = append(inserts, \"?\")\n        values = append(values, v)\n    }\n}\nstatement := \"insert into yourTable (\" +\n    strings.Join(names, \", \") +\n    \") values (\" + strings.Join(inserts, \", \") + \")\"\nerr := db.Exec(statement, values...)\n</code></pre>\n\n<p>To avoid SQL injection attacks, it's important to work from a slice of known column names.</p>\n\n<p>You can query the database to create the <code>fieldNames</code> slice.  See <a href=\"https://stackoverflow.com/questions/1526688/get-table-column-names-in-mysql\">Get table column names in MySQL?</a> for the query required. </p>\n\n<p>If the column names and JSON names are different, then replace the slice with a map where the keys are the column names and the values are the JSON names:</p>\n\n<pre><code>fieldNames := map[string]string{\n  \"column1\": \"json1\",\n  ... and so on\n}\n\nvar j map[string]interface{}\nif err := json.Unmarshal(data, &amp;j); err != nil {\n    // handle error\n}\nvar names []string\nvar inserts []string\nvar values []interface{}\nfor dbName, jsonName := range fieldNames {\n    if v, ok := j[jsonName]; ok {\n        names = append(names, dbName)\n        inserts = append(inserts, \"?\")\n        values = append(values, v)\n    }\n}\nstatement := \"insert into yourTable (\" +\n    strings.Join(names, \", \") +\n    \") values (\" + strings.Join(inserts, \", \") + \")\"\nerr := db.Exec(statement, values...)\n</code></pre>\n"}], "owner": {"reputation": 573, "user_id": 1739369, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1721913f6713c5772c3d34692d97ac6d?s=128&d=identicon&r=PG", "display_name": "JonTroncoso", "link": "https://stackoverflow.com/users/1739369/jontroncoso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 1, "accepted_answer_id": 54155846, "answer_count": 1, "score": -1, "last_activity_date": 1547653648, "creation_date": 1547252271, "last_edit_date": 1547288547, "question_id": 54155668, "link": "https://stackoverflow.com/questions/54155668/how-do-i-convert-a-json-object-into-a-mysql-row", "title": "How do I convert a JSON object into a MySQL row?", "body": "<p>I'd like to take a JSON string representing an object from a 3rd party API and insert it into a MySQL table. The JSON object properties match the table fields 1-to-1. There are several hundred columns in this table/JSON object. And there will be a few dozen rows to insert at any time.</p>\n\n<p>I'd rather not make a huge struct. But if I need to, then I'd rather not <code>db.Prepare()</code> an INSERT statement with several hundred \"?\"s. But if I have to then I'd rather not Have to write a <code>stmt.Exec()</code> with several hundred parameters.</p>\n\n<p>Is there a good way to do this in golang? Or is it just going to be extremely inefficient?</p>\n"}, {"tags": ["go", "natural-sort"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1547248534, "post_id": 54154711, "comment_id": 95141493, "body": "This is called natural sort: <a href=\"https://golanglibs.com/search?q=natural+sort\" rel=\"nofollow noreferrer\">golanglibs.com/search?q=natural+sort</a>"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1547299745, "post_id": 54154711, "comment_id": 95150114, "body": "To add to the other comments/answers, I would recommend to avoid this kind of data for sorting. Normalize it with leading zeros instead. The problem is that you&#39;ll run into all kinds of corner cases unless your problem is simple - JimB&#39;s answer assumes a certain format and will fail for others, for example. It&#39;s often worthwhile to clean up your data instead of bending backwards to process it"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 3, "last_activity_date": 1547244931, "creation_date": 1547244931, "answer_id": 54154761, "question_id": 54154711, "link": "https://stackoverflow.com/questions/54154711/sort-an-array-with-strings-and-numbers/54154761#54154761", "title": "Sort an array with strings and numbers", "body": "<p>If you don't want the numbers sorted lexicographically, you need to separate them from the strings and parse them as integers.</p>\n\n<p>This example assumes there is always a 2 letter prefix with a valid number, and slices the string accordingly: <a href=\"https://play.golang.org/p/LaX-pTr6etc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LaX-pTr6etc</a></p>\n\n<pre><code>s := []string{\"ex10\", \"ex2\", \"ex1\"}\n\nsort.Slice(s, func(i, j int) bool {\n    if s[i][:2] != s[j][:2] {\n        return s[i] &lt; s[j]\n    }\n    ii, _ := strconv.Atoi(s[i][2:])\n    jj, _ := strconv.Atoi(s[j][2:])\n    return ii &lt; jj\n})\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 10902424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9094c85dfd8ff0022ffba1916738b39?s=128&d=identicon&r=PG", "display_name": "thethinker", "link": "https://stackoverflow.com/users/10902424/thethinker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 479, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547246631, "creation_date": 1547244605, "last_edit_date": 1547246631, "question_id": 54154711, "link": "https://stackoverflow.com/questions/54154711/sort-an-array-with-strings-and-numbers", "title": "Sort an array with strings and numbers", "body": "<p>I passed few hours searching about a lib or a way to do this:</p>\n\n<p>I have an array []string{\"ex10\", \"ex2\", \"ex1\"} and after call the sort.Strings or using sort.Slice to compare with an array of bytes I get the result []string{\"ex1\", \"ex10\", \"ex2\"}</p>\n\n<p>anyone has an idea how to implement this?</p>\n\n<p>if anyone knows swift I've found the solution <a href=\"https://stackoverflow.com/questions/43870101/swift-sort-an-array-with-strings-and-numbers\">here</a></p>\n"}, {"tags": ["dictionary", "pointers", "go", "linked-list"], "answers": [{"comments": [{"owner": {"reputation": 9495, "user_id": 1395740, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/793c4377313587d742fad6f069d92d89?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1395740/nick"}, "edited": false, "score": 0, "creation_date": 1547249748, "post_id": 54154557, "comment_id": 95141789, "body": "In your second scenario the memory usage is going to be a problem, you keep multiple copies of the Node which is a string instead of simple pointers."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 1, "last_activity_date": 1547249593, "last_edit_date": 1547249593, "creation_date": 1547243689, "answer_id": 54154557, "question_id": 54154315, "link": "https://stackoverflow.com/questions/54154315/how-to-link-linkedlist-nodes-to-map-values/54154557#54154557", "title": "How to link LinkedList nodes to map values", "body": "<p>Things you trying to achieve are not possible the way you do it. It's about <em>addressability</em> and <em>assignability</em>. You should search language specification for this keywoards. Map values aren't addressable, so struct field in that value is not assignable. Also your data structure design looks not very efficient at least for me.</p>\n\n<p>Seems to me there are no reasons to store values in a map, references would be good enough</p>\n\n<pre><code>type Node struct {\n    root  string\n    links []*Node\n}\n//////\nrooturl := \"root\"\ngraph := Node{rooturl, []*Node{}}\ngraphMap := make(map[string]*Node)\ngraphMap[rooturl] = &amp;graph\nu := \"new node\"\n// if the link is not stored in the graph not create a new node\nif _, exists := graphMap[u]; !exists {\n    graphMap[u] = &amp;Node{u, []*Node{}}\n}\n// add the links to the graph\ngraphMap[rooturl].links = append(graphMap[rooturl].links, graphMap[u])\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/kHeJ4aHOmzA\" rel=\"nofollow noreferrer\">Working example</a> </p>\n\n<p>If you prefer to keep actual values in a map anyway, you need not tree structure at all. It looks like unneeded overhead. Information stored in a map would be enough for any operations.</p>\n\n<pre><code>type Node string\ntype Graph map[Node][]Node\n////\nrooturl := Node(\"root\")\ngraph := make(Graph)\ngraph[rooturl] = make([]Node, 0)\nu := Node(\"new node\")\n// if the link is not stored in the graph not create a new node\nif node, exists := graph[u]; !exists {\n    graph[u] = make([]Node, 0)\n    graph[rooturl] = append(graph[rooturl], u)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/M3yHREM8J13\" rel=\"nofollow noreferrer\">Working example</a></p>\n"}, {"tags": [], "owner": {"reputation": 193, "user_id": 1479516, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d8b14665e6546bb23b7751797f35beaf?s=128&d=identicon&r=PG", "display_name": "rhi", "link": "https://stackoverflow.com/users/1479516/rhi"}, "is_accepted": false, "score": 0, "last_activity_date": 1547243881, "creation_date": 1547243881, "answer_id": 54154589, "question_id": 54154315, "link": "https://stackoverflow.com/questions/54154315/how-to-link-linkedlist-nodes-to-map-values/54154589#54154589", "title": "How to link LinkedList nodes to map values", "body": "<p>Since go is a garbage collected language, you don't really need a notion of the map \"owning\" the node's memory. You can probably just store pointers in the map.</p>\n\n<p><a href=\"https://play.golang.org/p/DpcsIqg0Trx\" rel=\"nofollow noreferrer\">https://play.golang.org/p/DpcsIqg0Trx</a></p>\n"}], "owner": {"reputation": 9495, "user_id": 1395740, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/793c4377313587d742fad6f069d92d89?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1395740/nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 1, "accepted_answer_id": 54154557, "answer_count": 2, "score": 2, "last_activity_date": 1547249593, "creation_date": 1547242232, "last_edit_date": 1547245631, "question_id": 54154315, "link": "https://stackoverflow.com/questions/54154315/how-to-link-linkedlist-nodes-to-map-values", "title": "How to link LinkedList nodes to map values", "body": "<p>I want to implement a graph data structure, where each node is represented by:</p>\n\n<pre><code>type Node struct {\n    root  string\n    links []*Node\n}\n</code></pre>\n\n<p>Basically each node has a value <code>root</code> and a list of links, for each link a only want to store a pointer to it, since the memory of the struct will be allocated and owned by a map:</p>\n\n<pre><code>rooturl := \"root\"\ngraph := Node{rooturl, []*Node{}}\ngraphMap := make(map[string]Node)\ngraphMap[rooturl] = graph\n</code></pre>\n\n<p>The problem comes when I try to append a pointer to a newly created Node:</p>\n\n<pre><code>u := \"new node\"\n// if the link is not stored in the graph not create a new node\nif _, exists := graphMap[u]; !exists {\n    graphMap[u] = Node{u, []*Node{}}\n}\n// add the links to the graph\ngraphMap[rooturl].links = append(graphMap[rooturl].links, &amp;graphMap[u])\n</code></pre>\n\n<p>I get two errors:</p>\n\n<blockquote>\n  <p>cannot assign to struct field graphMap[rooturl].links in map</p>\n</blockquote>\n\n<p>and </p>\n\n<blockquote>\n  <p>cannot take the address of graphMap[u]</p>\n</blockquote>\n\n<p>How should I solve this properly?\nI would also like the need to query the map twice with <code>graphMap[rooturl].links</code> when appending (but since I cannot take a pointer or a reference to it I don't know how)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547238982, "post_id": 54153632, "comment_id": 95138370, "body": "You&#39;re not executing a shell, so don&#39;t try and format the arguments as such. Just pass the individual arguments to the command."}, {"owner": {"reputation": 1438, "user_id": 4260303, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e5ffc35d29354418bfb03c44dcf5fae5?s=128&d=identicon&r=PG&f=1", "display_name": "curiousengineer", "link": "https://stackoverflow.com/users/4260303/curiousengineer"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547239108, "post_id": 54153632, "comment_id": 95138413, "body": "Can u explain a bit more. Not clear yet"}], "owner": {"reputation": 1438, "user_id": 4260303, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e5ffc35d29354418bfb03c44dcf5fae5?s=128&d=identicon&r=PG&f=1", "display_name": "curiousengineer", "link": "https://stackoverflow.com/users/4260303/curiousengineer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 173, "favorite_count": 0, "closed_date": 1547239129, "answer_count": 0, "score": 0, "last_activity_date": 1547239418, "creation_date": 1547238620, "question_id": 54153632, "link": "https://stackoverflow.com/questions/54153632/golag-exec-command-and-bash-issue", "closed_reason": "Duplicate", "title": "Golag Exec.Command and Bash issue", "body": "<p>I have a sample go program that is not executing a specific kind of syntax. The same command string works just fine when executed directly on bash. Probably GoLang methods add quotes or something that I am unable to figure out. Here is the sample program</p>\n\n<pre><code>func main() {\n    cmd:= \"/usr/bin/vmtoolsd --cmd 'info-get guestinfo.ovfEnv'\"\n    //cmd:= \"/usr/bin/vmtoolsd --help\"\n    words := strings.Fields(cmd)\n    fmt.Printf(\"\\nwords are : %v\\n\",words)\n    oscmd := &amp;exec.Cmd{\n        Path: words[0],\n        Args: words[:],\n    }\n    stdoutStderr, err:=oscmd.CombinedOutput()\n    fmt.Printf(\"err:%v\\n\",err)\n    fmt.Printf(\"output:\\n%v\\n\",string(stdoutStderr))\n\n    fmt.Printf(\"execute again\")\n    cmd2:=\"/usr/bin/vmtoolsd\"\n    arg:=\"--cmd \\\"info-get guestinfo.ovfEnv\\\"\"\n    output:=exec.Command(cmd2,arg).Run()\n    if output!=nil {\n        fmt.Printf(\"\\nsome error\\n\")\n    }\n    if output!=nil {\n        fmt.Println(os.Stderr,output.Error())\n    }\n    //fmt.Printf(\"%v\",cmd)\n}\n</code></pre>\n\n<p>Program output</p>\n\n<p>[root@localhost tmp]# ./main</p>\n\n<pre><code>words are : [/usr/bin/vmtoolsd --cmd 'info-get guestinfo.ovfEnv']\nerr:exit status 1\noutput:\nUnknown command\n\nexecute again\nsome error\n&amp;{0xc000052120} exit status 1\n</code></pre>\n\n<p>Note that if I simply change the command to <code>/usr/bin/vmtoolsd --help</code>, it just works. I am certain it has got something to do with how the shell is interpreting the arguments in the failure case. Any tips will be appreciated.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1547237861, "post_id": 54153433, "comment_id": 95137962, "body": "Yes, why not just try it? (though you need to change the name conflict around the <code>Name</code> field and method)"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1547237987, "post_id": 54153433, "comment_id": 95138012, "body": "<a href=\"https://play.golang.org/p/_ojut46OvlK\" rel=\"nofollow noreferrer\">play.golang.org/p/_ojut46OvlK</a>"}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1547244284, "post_id": 54153433, "comment_id": 95140254, "body": "Same as Gavin, but with a function that accepts the interface as an argument <a href=\"https://play.golang.org/p/0UfNKWq1t8_h\" rel=\"nofollow noreferrer\">play.golang.org/p/0UfNKWq1t8_h</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1547245306, "post_id": 54153433, "comment_id": 95140583, "body": "No. Fields never affect interfaces, embedded or otherwise. Interfaces are <i>only</i> about methods. However, methods on embedded values <i>do</i> affect interfaces."}], "answers": [{"tags": [], "owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "is_accepted": false, "score": 0, "last_activity_date": 1547410306, "creation_date": 1547410306, "answer_id": 54172766, "question_id": 54153433, "link": "https://stackoverflow.com/questions/54153433/do-embedded-fields-count-towards-interfaces/54172766#54172766", "title": "Do embedded fields count towards interfaces", "body": "<p>Here's how to trace this down in the <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">language specification</a></p>\n\n<p>Find out what it means to implement an interface in the \"<a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"nofollow noreferrer\">Interface types</a>\" section:</p>\n\n<blockquote>\n  <p>Interface types \u00b6</p>\n  \n  <p>An interface type specifies a method set called its interface. A\n  variable of interface type can store a value of <strong>any type with a method\n  set that is any superset of the interface</strong>. Such a type is said to\n  implement the interface. </p>\n</blockquote>\n\n<p>Or from the section on \"<a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">Method sets</a>\"</p>\n\n<blockquote>\n  <p>The method set of a type determines the interfaces that the type implements...</p>\n</blockquote>\n\n<p>So what is important is the <em>method set</em> of the type you want to implement the interface. Let's see what constitutes a method set in the case of embedded fields:</p>\n\n<p>The first place I checked was the section \"<a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">Method Sets</a>\", but it sends us elsewhere:</p>\n\n<blockquote>\n  <p>Further rules apply to structs containing embedded fields, as described in the section on struct types.</p>\n</blockquote>\n\n<p>So we go to the section \"<a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">Struct types</a>\" and find:</p>\n\n<blockquote>\n  <p>A field or method f of an embedded field in a struct x is called\n  promoted if x.f is a legal selector that denotes that field or method\n  f.</p>\n  \n  <p>...</p>\n  \n  <p>Given a struct type S and a defined type T, <strong>promoted methods are\n  included in the method set of the struct as follows</strong>:</p>\n  \n  <ul>\n  <li>If S contains an embedded field T, the method sets of S and *S both    include promoted methods with receiver T. The method set of *S also includes promoted methods with receiver *T.</li>\n  <li>If S contains an embedded field *T, the method sets of S and *S both include promoted methods with receiver T or *T.</li>\n  </ul>\n</blockquote>\n\n<p>So, given that the methods of the embedded field are <em>promoted</em>, they <strong>are</strong> included in the <em>method set</em> of the containing struct. As we saw above the <em>method set</em> of any type is what determines whether it implements an interface.</p>\n"}], "owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1547410306, "creation_date": 1547237496, "last_edit_date": 1547243219, "question_id": 54153433, "link": "https://stackoverflow.com/questions/54153433/do-embedded-fields-count-towards-interfaces", "title": "Do embedded fields count towards interfaces", "body": "<p>In Golang, I can have an embedded fields inside of a <code>struct</code>. The embedded field gets \"promoted\", and the new <code>struct</code> gets to use all the functions of the embedded fields as if it's part of itself. So my question is, does the embedded fields' functions count towards interface implementation? For example:</p>\n\n<pre><code>type Foo struct {\n    Name string\n}\n\nfunc (f *Foo) Name() {\n    fmt.Println(f.Name)\n}\n\ntype Hello interface {\n    Name()\n    Hello()\n}\n\ntype Bar struct {\n    World string\n    *Foo\n}\n\nfunc (b *Bar) Hello() {\n    fmt.Println(\"Hello\")\n}\n</code></pre>\n\n<p>In the code above, <code>Bar{}</code> does not implement a function named <code>Name()</code>, but <code>Foo{}</code> does. Since <code>Foo{}</code> is an embedded field inside of <code>Bar{}</code>, is <code>Bar{}</code> a <code>Hello</code> type?</p>\n"}, {"tags": ["firebase", "google-app-engine", "authentication", "go", "google-cloud-platform"], "comments": [{"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1547237340, "post_id": 54153315, "comment_id": 95137778, "body": "If wanting to use Go, have you looked into <a href=\"https://godoc.org/firebase.google.com/go\" rel=\"nofollow noreferrer\">godoc.org/firebase.google.com/go</a>? Specifically, <a href=\"https://godoc.org/firebase.google.com/go/auth\" rel=\"nofollow noreferrer\">godoc.org/firebase.google.com/go/auth</a>"}, {"owner": {"reputation": 21333, "user_id": 226391, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/69dc78b59ef008c58e6e842f9f3e0624?s=128&d=identicon&r=PG", "display_name": "Michael Bleigh", "link": "https://stackoverflow.com/users/226391/michael-bleigh"}, "edited": false, "score": 0, "creation_date": 1547237444, "post_id": 54153315, "comment_id": 95137821, "body": "Firebase Auth is intended to be used directly from the client (JS in this case). The only pure-server way I&#39;m aware of to do this is via custom tokens, in which case you would need to store your own usernames/passwords and generate ID tokens on sign-in."}, {"owner": {"reputation": 31, "user_id": 10902320, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-2gy5HgUrS3o/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcbPcEnw4iokoedbRLCrcF6IHJtF5g/mo/photo.jpg?sz=128", "display_name": "shaun larkin", "link": "https://stackoverflow.com/users/10902320/shaun-larkin"}, "reply_to_user": {"reputation": 21333, "user_id": 226391, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/69dc78b59ef008c58e6e842f9f3e0624?s=128&d=identicon&r=PG", "display_name": "Michael Bleigh", "link": "https://stackoverflow.com/users/226391/michael-bleigh"}, "edited": false, "score": 0, "creation_date": 1547238655, "post_id": 54153315, "comment_id": 95138271, "body": "Yup, I&#39;ve been through the Auth firebase godocs. It looks like @MichaelBleigh is right so I&#39;ll stick to auth() through JS for now."}, {"owner": {"reputation": 411025, "user_id": 209103, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/12d378e6a9788ab9c94bbafe242b82b4?s=128&d=identicon&r=PG", "display_name": "Frank van Puffelen", "link": "https://stackoverflow.com/users/209103/frank-van-puffelen"}, "edited": false, "score": 0, "creation_date": 1547257471, "post_id": 54153315, "comment_id": 95142989, "body": "Also asked on <a href=\"https://groups.google.com/forum/#!topic/firebase-talk/19-yduAoGIk\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/firebase-talk/19-yduAoGIk</a>"}], "owner": {"reputation": 31, "user_id": 10902320, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-2gy5HgUrS3o/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcbPcEnw4iokoedbRLCrcF6IHJtF5g/mo/photo.jpg?sz=128", "display_name": "shaun larkin", "link": "https://stackoverflow.com/users/10902320/shaun-larkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 744, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1609888862, "creation_date": 1547236956, "last_edit_date": 1547380896, "question_id": 54153315, "link": "https://stackoverflow.com/questions/54153315/firebase-pure-go-language-based-authentication-golang", "title": "Firebase pure Go language based authentication | Golang", "body": "<p>I'm trying to find a way of authenticating a user with email /password purely through Go. I'm using Go templates and would like to use HTML purely as a dumb terminal to fetch input from. I seem to need to go through the firebase-app.js apis, sign-in, then pass the returned UID to go. Am I missing something? I am looking for something similar to the js :</p>\n\n<pre><code>firebase.auth().signInWithEmailAndPassword(_emailText, _passText)\n</code></pre>\n\n<p>I've had no luck finding anything in the godocs.</p>\n\n<p>I figured it would be straight forward since I'm hosting on GAE and fetching a firebase service account is trivial. But it seems I need to capture the userInfo through js and possibly pass it back to go possibly through a GET method.</p>\n\n<p>thanks in advance!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7, "user_id": 10902292, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WWJMST5GmRg/AAAAAAAAAAI/AAAAAAAAA98/WJour11PJjQ/photo.jpg?sz=128", "display_name": "Sneha Mishra", "link": "https://stackoverflow.com/users/10902292/sneha-mishra"}, "edited": false, "score": 0, "creation_date": 1547235810, "post_id": 54153088, "comment_id": 95137091, "body": "Giving Following error"}, {"owner": {"reputation": 9718, "user_id": 8186898, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/s0cEU.jpg?s=128&g=1", "display_name": "Nino Filiu", "link": "https://stackoverflow.com/users/8186898/nino-filiu"}, "edited": false, "score": 2, "creation_date": 1547236306, "post_id": 54153088, "comment_id": 95137326, "body": "<code>ture</code>: is this a typo or were you supposed to write <code>true</code>?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1547236431, "post_id": 54153088, "comment_id": 95137385, "body": "I assume <code>ture</code> is a typo for <code>true</code>.  If so, then both branches of the if statement return true. Neither branch returns false."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1547236577, "post_id": 54153088, "comment_id": 95137455, "body": "If your code is giving an error, it&#39;s important to include that error in your question."}], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 10902292, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WWJMST5GmRg/AAAAAAAAAAI/AAAAAAAAA98/WJour11PJjQ/photo.jpg?sz=128", "display_name": "Sneha Mishra", "link": "https://stackoverflow.com/users/10902292/sneha-mishra"}, "edited": false, "score": 0, "creation_date": 1547241616, "post_id": 54153282, "comment_id": 95139379, "body": "Thanks Peter it worked like charm"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1547237316, "last_edit_date": 1547237316, "creation_date": 1547236772, "answer_id": 54153282, "question_id": 54153088, "link": "https://stackoverflow.com/questions/54153088/my-program-for-div4-2-should-return-0-true-and-div4-3-should-return-1-f/54153282#54153282", "title": "My program for div(4,2) should return (0, true) and div(4,3) should return (1, false) is giving error", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc div(a int, b int) (int, bool) {\n    if a%b == 0 {\n        c := a % b\n        return c, true\n    } else {\n        c := a % b\n        return c, false\n    }\n}\n\nfunc main() {\n    fmt.Println(div(4, 2)) // should return (0, true)\n    fmt.Println(div(4, 3)) // should return (1, false)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/pEh55lBUFJI\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pEh55lBUFJI</a></p>\n\n<p>Output:</p>\n\n<pre><code>0 true\n1 false\n</code></pre>\n\n<hr>\n\n<p>Or simply,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc div(a int, b int) (int, bool) {\n    c := a % b\n    return c, c == 0\n}\n\nfunc main() {\n    fmt.Println(div(4, 2)) // should return (0, true)\n    fmt.Println(div(4, 3)) // should return (1, false)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/zIZvFMdzZqn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/zIZvFMdzZqn</a></p>\n\n<p>Output:</p>\n\n<pre><code>0 true\n1 false\n</code></pre>\n"}], "owner": {"reputation": 7, "user_id": 10902292, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WWJMST5GmRg/AAAAAAAAAAI/AAAAAAAAA98/WJour11PJjQ/photo.jpg?sz=128", "display_name": "Sneha Mishra", "link": "https://stackoverflow.com/users/10902292/sneha-mishra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 2, "closed_date": 1547251956, "accepted_answer_id": 54153282, "answer_count": 1, "score": -5, "last_activity_date": 1547237316, "creation_date": 1547235779, "last_edit_date": 1547236964, "question_id": 54153088, "link": "https://stackoverflow.com/questions/54153088/my-program-for-div4-2-should-return-0-true-and-div4-3-should-return-1-f", "closed_reason": "Needs details or clarity", "title": "My program for div(4,2) should return (0, true) and div(4,3) should return (1, false) is giving error", "body": "<p>My program for div(4,2) should return (0, true) and div(4,3) should return (1, false).</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc div(a int, b int) (int, bool) {\n    if a%b == 0 {\n        c := a % b\n        return c, true\n    } else {\n        c := a % b\n        return c, true\n    }\n}\n\nfunc main() {\n    fmt.Println(div(4, 2)) // should return (0, true)\n    fmt.Println(div(4, 3)) // should return (1, false)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/NyiGmd03SGE\" rel=\"nofollow noreferrer\">https://play.golang.org/p/NyiGmd03SGE</a></p>\n\n<p>Output:</p>\n\n<pre><code>0 true\n1 true\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1547234530, "post_id": 54152719, "comment_id": 95136536, "body": "The allocator is specific to the implementation, and changes over time. In the common implementation, you can&#39;t <i>force</i> allocations on the stack, but you can try to keep them from escaping. It&#39;s generally not too difficult to keep an allocation within the stack when you need to."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547235306, "post_id": 54152719, "comment_id": 95136904, "body": "To tack on to what @JimB said, the compiler is pretty good at escape analysis. Any variable that never leaves the function where it&#39;s allocated should live on the heap (not difficult since Go passes by copying)."}, {"owner": {"reputation": 13757, "user_id": 1270003, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/d5ed9123b92a6e4dffa75f9f6dd9e382?s=128&d=identicon&r=PG&f=1", "display_name": "texasbruce", "link": "https://stackoverflow.com/users/1270003/texasbruce"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1547235385, "post_id": 54152719, "comment_id": 95136939, "body": "@JimB I update the question as I am mainly concerned with gc go 1.11. Can you elaborate on how to &quot;keep an allocation within the stack&quot;?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1547235727, "post_id": 54152719, "comment_id": 95137058, "body": "go 1.12 is in beta"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1547236071, "post_id": 54152719, "comment_id": 95137199, "body": "@texasbruce: if a value isn&#39;t too big for the stack, and doesn&#39;t escape the scope of the function, then it is generally allocated on the stack. If you want specific details on this in a specific version, it&#39;s probably better to ask the mailing list. If you don&#39;t actually have a problem yet, then there&#39;s no reason to worry about theoretical allocations that haven&#39;t happened."}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 1, "last_activity_date": 1547298362, "creation_date": 1547298362, "answer_id": 54159868, "question_id": 54152719, "link": "https://stackoverflow.com/questions/54152719/how-does-gc-go-handle-heap-allocation/54159868#54159868", "title": "How does gc Go handle heap allocation?", "body": "<p>This is covered in various places, like <a href=\"https://golang.org/doc/faq#stack_or_heap\" rel=\"nofollow noreferrer\">the FAQ</a>:</p>\n\n<blockquote>\n  <p><strong>How do I know whether a variable is allocated on the heap or the stack?</strong></p>\n  \n  <p>From a correctness standpoint, you don't need to know. Each variable\n  in Go exists as long as there are references to it. The storage\n  location chosen by the implementation is irrelevant to the semantics\n  of the language.</p>\n  \n  <p>The storage location does have an effect on writing efficient\n  programs. When possible, the Go compilers will allocate variables that\n  are local to a function in that function's stack frame. However, if\n  the compiler cannot prove that the variable is not referenced after\n  the function returns, then the compiler must allocate the variable on\n  the garbage-collected heap to avoid dangling pointer errors. Also, if\n  a local variable is very large, it might make more sense to store it\n  on the heap rather than the stack.</p>\n  \n  <p>In the current compilers, if a variable has its address taken, that\n  variable is a candidate for allocation on the heap. However, a basic\n  escape analysis recognizes some cases when such variables will not\n  live past the return from the function and can reside on the stack.</p>\n</blockquote>\n\n<hr>\n\n<p>Go's memory allocation is carefully optimized for its needs, for example with a <a href=\"https://golang.org/src/runtime/malloc.go\" rel=\"nofollow noreferrer\">custom malloc</a>. I suspect you have a slightly different underlying question/problem that you're struggling with - it would be better to ask that instead. If this is just exploration/curiosity, you'll have to make your question much more specific.</p>\n"}], "owner": {"reputation": 13757, "user_id": 1270003, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/d5ed9123b92a6e4dffa75f9f6dd9e382?s=128&d=identicon&r=PG&f=1", "display_name": "texasbruce", "link": "https://stackoverflow.com/users/1270003/texasbruce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1547298362, "creation_date": 1547234162, "last_edit_date": 1547235407, "question_id": 54152719, "link": "https://stackoverflow.com/questions/54152719/how-does-gc-go-handle-heap-allocation", "title": "How does gc Go handle heap allocation?", "body": "<p>Does gc Go (specifically go1.11) pre-allocates a chunk of memory and take from it for each allocation (like JVM), or it allocates every time a variable is created, and is it a kernel call (malloc)?</p>\n\n<p>If it is one kernel call per allocation, that would make variable creation expensive. How can I force allocation on the stack/heap?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 6, "creation_date": 1547232169, "post_id": 54152264, "comment_id": 95135589, "body": "That appears to be a valid JSON representation of an array of strings, so you could use <a href=\"https://golang.org/pkg/encoding/json\" rel=\"nofollow noreferrer\"><code>encoding&#47;json</code></a>."}, {"owner": {"reputation": 308, "user_id": 10788397, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-HNfj9QFa5pU/AAAAAAAAAAI/AAAAAAAAKOA/q7PRzgV2OdM/photo.jpg?sz=128", "display_name": "dom", "link": "https://stackoverflow.com/users/10788397/dom"}, "edited": false, "score": 0, "creation_date": 1547233663, "post_id": 54152264, "comment_id": 95136189, "body": "So you have something like <code>str := &quot;[\\&quot;test1\\&quot;,\\&quot;test2\\&quot;]&quot;</code>, or <code>str := []string{&quot;test1&quot;,&quot;test2&quot;}</code>?"}, {"owner": {"reputation": 61601, "user_id": 1203556, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aca772bc8ed79a86894211c7efd920aa?s=128&d=identicon&r=PG", "display_name": "Tampa", "link": "https://stackoverflow.com/users/1203556/tampa"}, "edited": false, "score": 0, "creation_date": 1547233751, "post_id": 54152264, "comment_id": 95136237, "body": "i have exactly what I posted"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1547233890, "post_id": 54152264, "comment_id": 95136290, "body": "If you have a string, it&#39;s a string, not an &quot;interface&quot;. If the string contains valid json, you could unmarshal that into into a <code>[]interface{}</code>, or a <code>[]string</code>."}], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": true, "score": 1, "last_activity_date": 1547237175, "creation_date": 1547237175, "answer_id": 54153362, "question_id": 54152264, "link": "https://stackoverflow.com/questions/54152264/go-array-is-stored-as-a-string-how-to-convert-to-array/54153362#54153362", "title": "go array is stored as a string - how to convert to array", "body": "<p>Your json as a list of string will decode using a golang list of strings</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    test := `[\"test1\",\"test2\"]`\n    in := []byte(test)\n    var raw []string\n    json.Unmarshal(in, &amp;raw)\n    fmt.Println(raw[0])\n}\n</code></pre>\n"}], "owner": {"reputation": 61601, "user_id": 1203556, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aca772bc8ed79a86894211c7efd920aa?s=128&d=identicon&r=PG", "display_name": "Tampa", "link": "https://stackoverflow.com/users/1203556/tampa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 54153362, "answer_count": 1, "score": -4, "last_activity_date": 1547237175, "creation_date": 1547232033, "last_edit_date": 1547234047, "question_id": 54152264, "link": "https://stackoverflow.com/questions/54152264/go-array-is-stored-as-a-string-how-to-convert-to-array", "title": "go array is stored as a string - how to convert to array", "body": "<p>I have this list as a string:</p>\n\n<p>[\"test1\",\"test2\"]</p>\n\n<p>How do I convert?  From my limited understanding this is an interface:</p>\n\n<pre><code>[]interface{}\n</code></pre>\n\n<p>if so then how do I convert to an array?</p>\n\n<pre><code>fmt.Println(test)\n[\"test1\", \"test2\"]\n\nfmt.Println(reflect.TypeOf(test))\nstring\n</code></pre>\n\n<p>I tried the below:</p>\n\n<pre><code>in := []byte(test)\nvar raw []interface{}\njson.Unmarshal(in, &amp;raw)\nfmt.Println(raw[0])\n</code></pre>\n\n<p>the above worked fyi</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "gcloud"], "answers": [{"tags": [], "owner": {"reputation": 327, "user_id": 2803242, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/26b9b4595e94b0e09ffda71063461eff?s=128&d=identicon&r=PG&f=1", "display_name": "AdmiralThrawn", "link": "https://stackoverflow.com/users/2803242/admiralthrawn"}, "is_accepted": true, "score": 0, "last_activity_date": 1547764611, "creation_date": 1547764611, "answer_id": 54245280, "question_id": 54152203, "link": "https://stackoverflow.com/questions/54152203/how-to-get-current-gcloud-user-name-from-golang-executable/54245280#54245280", "title": "How to get current gcloud user name from golang executable?", "body": "<p>After significant time investment into researching this, there are no options as of Jan 2019. Best course of action is</p>\n\n<pre><code>gcloud config config-helper --format json\n</code></pre>\n"}], "owner": {"reputation": 327, "user_id": 2803242, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/26b9b4595e94b0e09ffda71063461eff?s=128&d=identicon&r=PG&f=1", "display_name": "AdmiralThrawn", "link": "https://stackoverflow.com/users/2803242/admiralthrawn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 54245280, "answer_count": 1, "score": 0, "last_activity_date": 1548234902, "creation_date": 1547231683, "question_id": 54152203, "link": "https://stackoverflow.com/questions/54152203/how-to-get-current-gcloud-user-name-from-golang-executable", "title": "How to get current gcloud user name from golang executable?", "body": "<p>I am trying to implement the below gcloud command in Go Lang.</p>\n\n<pre><code>&gt;gcloud config get-value account\nabc@def.com\n</code></pre>\n\n<p>I have looked in \"<a href=\"https://godoc.org/cloud.google.com/go\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go</a>\", but I am unable to find how I could implement this.</p>\n\n<p>Any suggestions for libraries\\code that I could look at?</p>\n"}]