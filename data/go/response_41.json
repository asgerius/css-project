[{"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 2, "last_activity_date": 1445454499, "creation_date": 1445454499, "answer_id": 33267317, "question_id": 33267106, "link": "https://stackoverflow.com/questions/33267106/golang-time-ticker-how-to-begin-on-even-timestamps/33267317#33267317", "title": "Golang time.Ticker, how to begin on even timestamps", "body": "<p>Ticker will always tick relative to the time you start it. Also, if you don't receive fast enough, odd things can happen.</p>\n\n<p>Best I can think of immediately is calculate the duration until the next 5 second interval and use <code>time.After</code> to get a signal at that time.</p>\n\n<p><a href=\"https://play.golang.org/p/5f4-8O79NH\" rel=\"nofollow\">playground link</a></p>\n\n<pre><code>const fiveSeconds = int64(5 * time.Second)\nfor i := 0; i &lt; 2; i++ {\n    // get current offset from 5 second interval.\n    relativeTime := time.Now().UnixNano() % fiveSeconds\n    // get remaining time in current 5 second interval.\n    waitTime := fiveSeconds - relativeTime\n    // wait that long\n    ch := time.After(time.Duration(waitTime))\n    &lt;-ch\n    fmt.Println(time.Now())\n}\n</code></pre>\n\n<p>It may be off a bit from exact 5 second intervals, but should be pretty close if you round it.</p>\n"}, {"comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1445455557, "post_id": 33267505, "comment_id": 54336332, "body": "Just note that if you don&#39;t pull from the channel as soon as it is available, the time can skew. No long running-tasks after pulling off."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1445458348, "post_id": 33267505, "comment_id": 54337788, "body": "@captncraig: true, it&#39;s just whether it&#39;s acceptable to miss an interval vs skew an interval (which you can control by running tasks asynchronously)."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1445457459, "last_edit_date": 1445457459, "creation_date": 1445455194, "answer_id": 33267505, "question_id": 33267106, "link": "https://stackoverflow.com/questions/33267106/golang-time-ticker-how-to-begin-on-even-timestamps/33267505#33267505", "title": "Golang time.Ticker, how to begin on even timestamps", "body": "<p>You can delay the start of your ticker to get pretty close to an even 5 second time:</p>\n\n<pre><code>fiveSec := int64(5 * time.Second)\ntime.Sleep(time.Duration(fiveSec - (time.Now().UnixNano() % fiveSec)))\n\nticker := time.NewTicker(time.Second * 5)\n</code></pre>\n\n<p>Or another way to get the correct delay with Time methods:</p>\n\n<pre><code>time.Sleep(time.Now().Truncate(5 * time.Second).Add(5 * time.Second).Sub(time.Now()))\n</code></pre>\n"}], "owner": {"reputation": 3466, "user_id": 1426673, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/a4lMw.jpg?s=128&g=1", "display_name": "Cameron Sparr", "link": "https://stackoverflow.com/users/1426673/cameron-sparr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1553, "favorite_count": 1, "accepted_answer_id": 33267505, "answer_count": 2, "score": 0, "last_activity_date": 1445457459, "creation_date": 1445453804, "question_id": 33267106, "link": "https://stackoverflow.com/questions/33267106/golang-time-ticker-how-to-begin-on-even-timestamps", "title": "Golang time.Ticker, how to begin on even timestamps", "body": "<p>I am attempting to begin a <code>time.Ticker</code> on even timestamps. Basically what I want is for this code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    ticker := time.NewTicker(time.Second * 5)\n\n    for i := 0; i &lt; 2; i++ {\n        select {\n        case &lt;-ticker.C:\n            fmt.Println(\"Time: \", time.Now().Round(time.Second*1))\n        }\n    }\n\n    ticker.Stop()\n}\n</code></pre>\n\n<p>To always print on an even 5-second interval:</p>\n\n<pre><code>Time:  2015-10-21 12:53:50 -0600 MDT\nTime:  2015-10-21 12:53:55 -0600 MDT\n</code></pre>\n\n<p>Is there an elegant solution to this?</p>\n"}, {"tags": ["string", "go"], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 0, "last_activity_date": 1445444140, "creation_date": 1445444140, "answer_id": 33264331, "question_id": 33264231, "link": "https://stackoverflow.com/questions/33264231/adding-a-space-between-uppsercase-letters/33264331#33264331", "title": "Adding a space between uppsercase letters", "body": "<p>You can test for upper case with the unicode package. This is my solution:</p>\n\n<p><a href=\"https://play.golang.org/p/m_LpqTHIMa\" rel=\"nofollow\">playground</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    \"unicode\"\n)\n\nfunc main() {\n    name := \"ClientLovesProcess\"\n    newName := \"\"\n    for _, c := range name {\n\n        if unicode.IsUpper(c){\n            newName += \" \"   \n        }\n        newName += string(c)\n    }\n    newName = strings.TrimSpace(newName) // get rid of space on edges.\n    fmt.Println(newName)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6647, "user_id": 914991, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/639555fcf960b5e80617a10f479ea476?s=128&d=identicon&r=PG", "display_name": "zmb", "link": "https://stackoverflow.com/users/914991/zmb"}, "is_accepted": true, "score": 7, "last_activity_date": 1445446839, "last_edit_date": 1445446839, "creation_date": 1445444439, "answer_id": 33264434, "question_id": 33264231, "link": "https://stackoverflow.com/questions/33264231/adding-a-space-between-uppsercase-letters/33264434#33264434", "title": "Adding a space between uppsercase letters", "body": "<p>The function you're looking for is <a href=\"https://golang.org/pkg/unicode/#IsUpper\" rel=\"nofollow\"><code>unicode.IsUpper(r rune) bool</code></a>.</p>\n\n<p>I would use a <code>bytes.Buffer</code> so that you're not doing a bunch of string concatenations, which results in extra unnecessary allocations.</p>\n\n<p>Here's an implementation:</p>\n\n<pre><code>func addSpace(s string) string {\n    buf := &amp;bytes.Buffer{}\n    for i, rune := range s {\n        if unicode.IsUpper(rune) &amp;&amp; i &gt; 0 {\n            buf.WriteRune(' ')\n        }\n        buf.WriteRune(rune)\n    }\n    return buf.String()\n}\n</code></pre>\n\n<p>And a <a href=\"https://play.golang.org/p/KVeodOEK8S\" rel=\"nofollow\">play link</a>.</p>\n"}], "owner": {"reputation": 1691, "user_id": 4803192, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/2dd1e87601f8ded02fcb4e3e142c671c?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeAccents", "link": "https://stackoverflow.com/users/4803192/threeaccents"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 33264434, "answer_count": 2, "score": 0, "last_activity_date": 1445446839, "creation_date": 1445443842, "question_id": 33264231, "link": "https://stackoverflow.com/questions/33264231/adding-a-space-between-uppsercase-letters", "title": "Adding a space between uppsercase letters", "body": "<p>I have string like this <code>ClientLovesProcess</code> I need to add a space between each uppercase letter except for the first uppercase letter so the end result would be this <code>Client Loves Process</code></p>\n\n<p>I don't think golang has the best string support but this is how I was thinking about going about it:</p>\n\n<p>First loop through each letter so something like this:</p>\n\n<pre><code>name := \"ClientLovesProcess\"\n\nwordLength := len(name)\n\nfor i := 0; i &lt; wordLength; i++ {\n    letter := string([]rune(name)[i])\n\n    // then in here I would like to check\n   // if the letter is upper or lowercase\n\n   if letter == uppercase{\n       // then break the string and add a space\n   }\n}\n</code></pre>\n\n<p>The issue is I don't know how to check if a letter is lower or uppercase in go. I checked the strings manual but they don't some to have a function for it. What would be another approach to get this done with go?</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1445435630, "post_id": 33261181, "comment_id": 54323420, "body": "Do you have the same index file: <a href=\"https://github.com/GoogleCloudPlatform/appengine-guestbook-go/blob/part4-usingdatastore/index.yaml\" rel=\"nofollow noreferrer\"><code>index.yaml</code></a>?"}, {"owner": {"reputation": 11, "user_id": 4547184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f869fc3090c1a8fe6de24fca51b8bea5?s=128&d=identicon&r=PG&f=1", "display_name": "Colin Adler", "link": "https://stackoverflow.com/users/4547184/colin-adler"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1445436010, "post_id": 33261181, "comment_id": 54323722, "body": "Yes, <a href=\"http://i.imgur.com/2TDVdpC.png\" rel=\"nofollow noreferrer\">my folder</a>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1445436334, "post_id": 33261181, "comment_id": 54323977, "body": "You have the file, yes, but is its content equal to the one I <a href=\"https://github.com/GoogleCloudPlatform/appengine-guestbook-go/blob/part4-usingdatastore/index.yaml\" rel=\"nofollow noreferrer\">linked</a>?"}, {"owner": {"reputation": 11, "user_id": 4547184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f869fc3090c1a8fe6de24fca51b8bea5?s=128&d=identicon&r=PG&f=1", "display_name": "Colin Adler", "link": "https://stackoverflow.com/users/4547184/colin-adler"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1445436917, "post_id": 33261181, "comment_id": 54324465, "body": "@icza sorry, it is the exact same. The files I am uploading have been downloaded directly from GitHub and have no changes."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1445436984, "post_id": 33261181, "comment_id": 54324527, "body": "The SDK may modify this file, so please check manually as it is not enough that you personally didn&#39;t modify it."}, {"owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 1, "creation_date": 1445439079, "post_id": 33261181, "comment_id": 54326152, "body": "My answer to this question applies to your case as well: <a href=\"http://stackoverflow.com/questions/33250351/django-nonrel-query-confusion\" title=\"django nonrel query confusion\">stackoverflow.com/questions/33250351/&hellip;</a>"}, {"owner": {"reputation": 1184, "user_id": 6938128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fcdfa61a165fe77418b79dc6eb5efb0?s=128&d=identicon&r=PG&f=1", "display_name": "George", "link": "https://stackoverflow.com/users/6938128/george"}, "edited": false, "score": 0, "creation_date": 1503520505, "post_id": 33261181, "comment_id": 78655868, "body": "The above comment by Dan should be posted more prominently as an answer to the  initial question."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 7222743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e0321f9e36f5175bb2385de4bcb02?s=128&d=identicon&r=PG&f=1", "display_name": "lili", "link": "https://stackoverflow.com/users/7222743/lili"}, "is_accepted": false, "score": 0, "last_activity_date": 1480536211, "last_edit_date": 1495541811, "creation_date": 1480536211, "answer_id": 40897156, "question_id": 33261181, "link": "https://stackoverflow.com/questions/33261181/api-error-4-datastore-v3-need-index-no-matching-index-found/40897156#40897156", "title": "API error 4 (datastore_v3: NEED_INDEX): no matching index found", "body": "<p>You can remove '.Order(\"-Date\")' in <a href=\"https://github.com/GoogleCloudPlatform/appengine-guestbook-go/blob/part4-usingdatastore/hello.go#L41\" rel=\"nofollow noreferrer\">Line 41</a>, and try to deploy it again.</p>\n\n<p>The reason is that q.Order(\"<strong>key</strong>\") uses the EntitiesByKind index, which is not supported, see in <a href=\"https://stackoverflow.com/questions/25671090/google-app-engine-reverse-key-order-query\">google-app-engine-reverse-key-order-query</a></p>\n"}], "owner": {"reputation": 11, "user_id": 4547184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f869fc3090c1a8fe6de24fca51b8bea5?s=128&d=identicon&r=PG&f=1", "display_name": "Colin Adler", "link": "https://stackoverflow.com/users/4547184/colin-adler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 868, "favorite_count": 3, "answer_count": 1, "score": 0, "last_activity_date": 1480536211, "creation_date": 1445435475, "question_id": 33261181, "link": "https://stackoverflow.com/questions/33261181/api-error-4-datastore-v3-need-index-no-matching-index-found", "title": "API error 4 (datastore_v3: NEED_INDEX): no matching index found", "body": "<p>I am currently attempting to upload a Guest Book application in Go that uses datastore for GAE found <a href=\"https://github.com/GoogleCloudPlatform/appengine-guestbook-go/tree/part4-usingdatastore\" rel=\"nofollow\">here</a>. </p>\n\n<p>Running a GAE server from my computer using <code>goapp serve</code>, the application runs and works fine. I submitted two entries, and shut down the server. But, when uploaded immediately after using <code>goapp deploy -application xxx app.yaml</code>, I get <code>API error 4 (datastore_v3: NEED_INDEX): no matching index found.</code> on my URL. It has been about a day or so since I last served the files.</p>\n\n<p>Any help is appreciated</p>\n"}, {"tags": ["go", "codenvy"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1445435709, "post_id": 33260236, "comment_id": 54323471, "body": "Are you looking for environment parameter  option ?"}, {"owner": {"reputation": 692, "user_id": 2355596, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/pXs2u.jpg?s=128&g=1", "display_name": "Thiago Augustus Oliveira", "link": "https://stackoverflow.com/users/2355596/thiago-augustus-oliveira"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1445436078, "post_id": 33260236, "comment_id": 54323772, "body": "@MIkCode Yep... I would like to know that"}], "answers": [{"comments": [{"owner": {"reputation": 692, "user_id": 2355596, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/pXs2u.jpg?s=128&g=1", "display_name": "Thiago Augustus Oliveira", "link": "https://stackoverflow.com/users/2355596/thiago-augustus-oliveira"}, "edited": false, "score": 0, "creation_date": 1445436539, "post_id": 33261484, "comment_id": 54324138, "body": "Really thanks! That solved my doubt. I wasn&#39;t understanding. @kalrsson"}], "tags": [], "owner": {"reputation": 470, "user_id": 2331089, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/758cee5a720d8e644a7a047386e4b998?s=128&d=identicon&r=PG&f=1", "display_name": "bianchi", "link": "https://stackoverflow.com/users/2331089/bianchi"}, "is_accepted": true, "score": 1, "last_activity_date": 1445436236, "creation_date": 1445436236, "answer_id": 33261484, "question_id": 33260236, "link": "https://stackoverflow.com/questions/33260236/run-a-go-server-on-codenvy-environment/33261484#33261484", "title": "Run a Go Server on Codenvy Environment", "body": "<p>The process runs in a container, and port 8080 is mapped to a random port each time the app start. So, it's a different port each time. However, the same internal port - as the app runs in a Docker container.</p>\n\n<p>Can you elaborate and give more details?</p>\n"}], "owner": {"reputation": 692, "user_id": 2355596, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/pXs2u.jpg?s=128&g=1", "display_name": "Thiago Augustus Oliveira", "link": "https://stackoverflow.com/users/2355596/thiago-augustus-oliveira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 0, "accepted_answer_id": 33261484, "answer_count": 1, "score": 0, "last_activity_date": 1445436236, "creation_date": 1445432941, "question_id": 33260236, "link": "https://stackoverflow.com/questions/33260236/run-a-go-server-on-codenvy-environment", "title": "Run a Go Server on Codenvy Environment", "body": "<p>I'm trying to use Codenvy to develop Go server apps, but I don't know how to run. \nI have already created the project and choose the Web Go runner environment. \nBut when I run it, the project run in a different URL port that I have defined.</p>\n\n<p>Have some way to not use an <strong>http port</strong> an use a dynamic port?</p>\n\n<pre><code>http.ListenAndServe(\"{get_url_port}\", nil)\n</code></pre>\n\n<blockquote>\n  <p>instead</p>\n</blockquote>\n\n<pre><code>http.ListenAndServe(\":8080\", nil)\n</code></pre>\n"}, {"tags": ["go", "interface", "type-switch"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1445428175, "post_id": 33258026, "comment_id": 54318141, "body": "How could a cleaner way work? Consider a comparison between <code>int64</code> and <code>uint64</code>. Such a comparison <b>must</b> handle a lot of cases, e.g. uint64-values unrepresentable by int64 and vice versa. Such cases are depending on <i>both</i> types, comparing uint32 to complex128 has different rules. If you have n types and m operators you will have to handle <code>n * (n-1) * m&#47;2</code> cases (if I did the math right). And there is no shortcut. Or you limit any input to something representable by float64 and convert anything to float64 first (maybe handling strings separately)."}, {"owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1445431381, "post_id": 33258026, "comment_id": 54320264, "body": "I was hoping someone more knowledgeable with Go would be able to reveal it to me :( I&#39;ll probably end up converting everything to float64."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445448009, "post_id": 33258026, "comment_id": 54332040, "body": "How about you just cast every number that comes in as a float? Int -&gt; float loses precision in a way that isn&#39;t suitable for comparison so your mixed type comparison is going to be int to float, may as well just convert/cast everything to float64 prior to any comparison logic."}, {"owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445502975, "post_id": 33258026, "comment_id": 54353854, "body": "@evanmcdonnal see my answer :) before any comparison takes place (assuming it&#39;s numeric) I&#39;ve put the interface values into concrete types. I&#39;m afraid there&#39;s gaps in my knowledge about floating point but I was under the impression you would only get rounding errors/inaccuracies when you tried to add a large float to a small float (so always order your terms before adding)?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1445532947, "post_id": 33258026, "comment_id": 54373022, "body": "@leylandski floats will have small errors in precision but that doesn&#39;t begin til like idk 10-20 decimal places out. I was just trying to make the point that if you give me an int and a float and want to compare them, there is no real decision to be made, they need to be compared as floats. If you really demand precision you won&#39;t be using floats anywhere in the first place, equality comparison is not reliable on the type due to the precision errors you alluded to. Applications that need extremely precise decimal numbers typical use complex types that represent the decimal values with ints."}], "answers": [{"tags": [], "owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "is_accepted": false, "score": 0, "last_activity_date": 1445433580, "creation_date": 1445433580, "answer_id": 33260458, "question_id": 33258026, "link": "https://stackoverflow.com/questions/33258026/in-go-is-there-any-way-to-compare-two-mixed-type-interfaces-without-nested-swit/33260458#33260458", "title": "In Go, is there any way to compare two mixed-type interfaces without nested switch statements?", "body": "<p>The solution I've got as of now (thanks to @Volker for the suggestion) does a quick type switch on the values that need comparing and then instead of using the originals in the <code>Operator()</code> switch, it uses the concrete float values:</p>\n\n<pre><code>/*\nvalidate returns a boolean value denoting whether a test was successful. This\nfunction will panic if the type assertions fail.\n*/\nfunc (sfvre standardFieldValidationRuleEntry) validate(fieldValue interface{}) bool {\n\n    var floatFieldVal, floatCompVal float64\n\n    //If the interface is int or float, convert it to a statically typed float64.\n    switch fieldValue.(type) {\n    case int:\n        floatFieldVal = float64(fieldValue.(int))\n    case float64:\n        floatFieldVal = fieldValue.(float64)\n    }\n\n    //Do the same with the comparison value.\n    switch sfvre.ComparisonOperand().(type) {\n    case int:\n        floatCompVal = float64(sfvre.ComparisonOperand().(int))\n    case float64:\n        floatCompVal = sfvre.ComparisonOperand().(float64)\n    }\n\n    switch sfvre.Operator() {\n    case VROP_EQUAL:\n        return fieldValue == sfvre.ComparisonOperand()\n    case VROP_NEQUAL:\n        return fieldValue != sfvre.ComparisonOperand()\n    case VROP_GT:\n        return floatFieldVal &gt; floatCompVal\n    case VROP_LT:\n        return floatFieldVal &lt; floatCompVal\n    case VROP_GTET:\n        return floatFieldVal &gt;= floatCompVal\n    case VROP_LTET:\n        return floatFieldVal &lt;= floatCompVal\n    case VROP_CONTAINS:\n        return strings.Contains(fieldValue.(string), sfvre.ComparisonOperand().(string))\n    case VROP_NCONTAINS:\n        return !strings.Contains(fieldValue.(string), sfvre.ComparisonOperand().(string))\n    default:\n        return false\n    }\n}\n</code></pre>\n\n<p>It doesn't catch everything, but restricting what operators the user can choose based on what field they're comparing can mitigate this, but that's part of the larger solution so irrelevant here.</p>\n"}], "owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 378, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1445433580, "creation_date": 1445426485, "question_id": 33258026, "link": "https://stackoverflow.com/questions/33258026/in-go-is-there-any-way-to-compare-two-mixed-type-interfaces-without-nested-swit", "title": "In Go, is there any way to compare two mixed-type interfaces without nested switch statements?", "body": "<p>Go's <code>interface{}</code> type is both the best and most annoying feature of the language, I find. I'm trying to create a simple user-customisable validation rule solution where the user can define:</p>\n\n<ul>\n<li>The comparison operator.</li>\n<li>The comparison operand.</li>\n<li>The map key that leads to the value to test.</li>\n</ul>\n\n<p>As well as a simple Boolean expression parser that allows the user to combine multiple rules using AND and OR. So far it all works well, the expressions can be parsed, tokenised, and evaluated successfully, but it's running the rules on the given data that causes problems.</p>\n\n<p>This is the current version of the function that actually evaluates the data:</p>\n\n<pre><code>/*\nvalidate returns a boolean value denoting whether a test was successful. This\nfunction will panic if the type assertions fail.\n*/\nfunc (sfvre standardFieldValidationRuleEntry) validate(fieldValue interface{}) bool {\n\n    switch sfvre.Operator() {\n    case VROP_EQUAL:\n        return fieldValue == sfvre.ComparisonOperand()\n    case VROP_NEQUAL:\n        return fieldValue != sfvre.ComparisonOperand()\n    case VROP_GT:\n        return fieldValue.(int) &gt; sfvre.ComparisonOperand().(int)\n    case VROP_LT:\n        return fieldValue.(int) &lt; sfvre.ComparisonOperand().(int)\n    case VROP_GTET:\n        return fieldValue.(int) &gt;= sfvre.ComparisonOperand().(int)\n    case VROP_LTET:\n        return fieldValue.(int) &lt;= sfvre.ComparisonOperand().(int)\n    case VROP_CONTAINS:\n        return strings.Contains(fieldValue.(string), sfvre.ComparisonOperand().(string))\n    case VROP_NCONTAINS:\n        return !strings.Contains(fieldValue.(string), sfvre.ComparisonOperand().(string))\n    default:\n        return false\n    }\n}\n</code></pre>\n\n<p>At the moment the operator implies whether the data is numeric (greater than, less than, etc.). The type assertion to int did the job while building the other parts of the package, but the finished system should also be able to take float64 and be able to handle mixed type comparisons.</p>\n\n<p>The only way I can see of doing this at the moment is by having multiple nested type switches, a level for each of:</p>\n\n<ul>\n<li>The operator.</li>\n<li>The type of the field value given.</li>\n<li>The type of the comparison operand.</li>\n</ul>\n\n<p>But this has the potential to become very large and not easily manageable. Is there a 'cleaner' way to do this that I can't see, or am I stuck using nested switches?</p>\n"}, {"tags": ["json", "parsing", "go"], "comments": [{"owner": {"reputation": 9375, "user_id": 4881811, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ntIt4.jpg?s=128&g=1", "display_name": "Maraboc", "link": "https://stackoverflow.com/users/4881811/maraboc"}, "edited": false, "score": 1, "creation_date": 1445420649, "post_id": 33255821, "comment_id": 54313185, "body": "What did you try so far ? some code will help to more understand your problem :)"}, {"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 1, "creation_date": 1445420677, "post_id": 33255821, "comment_id": 54313202, "body": "Just a heads up: People will complain about you not showing your progress, your specific problems and <i>code</i>. That being said, did you consider unmarshaling into two distinct structs and then merging them manually into one struct via embedding?"}, {"owner": {"reputation": 39, "user_id": 5273213, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8225edf7e7e3658201e31ae323d63eb4?s=128&d=identicon&r=PG&f=1", "display_name": "RieuxThomas", "link": "https://stackoverflow.com/users/5273213/rieuxthomas"}, "edited": false, "score": 0, "creation_date": 1445420782, "post_id": 33255821, "comment_id": 54313278, "body": "Yes i did but i need to merge them into a third one and it&#39;s not the lighter process i think"}, {"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 0, "creation_date": 1445420875, "post_id": 33255821, "comment_id": 54313353, "body": "please provide the two JSON objects and your code to parse/combine them."}, {"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 0, "creation_date": 1445421570, "post_id": 33255821, "comment_id": 54313839, "body": "Thanks for providing the code. A few general notes: In your first snippet, you have a line <code>if req = GetCliRedis(Data.Value[i].Id); err != nil {</code> - you do not actually <i>set</i> <code>err</code> in there, so checking if <code>err != nil</code> will use an <code>err</code> from before, and, as you always check if that&#39;s <code>!= nil</code>, <code>if</code> will always use the <code>else</code> branch. Additionally, but I&#39;ve never used beego, I&#39;m sure you can unmarshal the response directly, without reading it as a string first, but that&#39;s just a performance improvement..."}, {"owner": {"reputation": 39, "user_id": 5273213, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8225edf7e7e3658201e31ae323d63eb4?s=128&d=identicon&r=PG&f=1", "display_name": "RieuxThomas", "link": "https://stackoverflow.com/users/5273213/rieuxthomas"}, "reply_to_user": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 0, "creation_date": 1445422510, "post_id": 33255821, "comment_id": 54314439, "body": "@mrd0ll4r my first json its just for the view field and the seconde one is the rest"}, {"owner": {"reputation": 39, "user_id": 5273213, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8225edf7e7e3658201e31ae323d63eb4?s=128&d=identicon&r=PG&f=1", "display_name": "RieuxThomas", "link": "https://stackoverflow.com/users/5273213/rieuxthomas"}, "edited": false, "score": 0, "creation_date": 1445437192, "post_id": 33255821, "comment_id": 54324695, "body": "And each time its a JSON redis response and i don&#39;t know can i get them in one struct .."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445447370, "post_id": 33255821, "comment_id": 54331707, "body": "Please provide your json so we can see what we&#39;re working with. You could embed the two structs in a third very easily (along the lines of what you don&#39;t want but it is very clean, no re-writing of fields in the new type). If you don&#39;t do that, you&#39;ll have to implement a custom unmarshal for your type. Personally I think that&#39;s more work than it&#39;s worth. The embed is super clean and simple."}, {"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 0, "creation_date": 1445507264, "post_id": 33255821, "comment_id": 54356613, "body": "As I can see, you have some errors in your <code>json:</code> tags, for example the <code>json:id</code> should be <code>json:clipId</code> and <code>json:permalinkUrl</code> should be <code>json:permalinkBaseURL</code> - as long as the tags are not correct, the <code>encoding&#47;json</code> package will not know what to do."}], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 3, "last_activity_date": 1445468189, "creation_date": 1445468189, "answer_id": 33270629, "question_id": 33255821, "link": "https://stackoverflow.com/questions/33255821/golang-decode-2-json-items-into-1-struct/33270629#33270629", "title": "Golang decode 2 JSON items into 1 struct", "body": "<p>For lack of activity I'm just gonna post the embedding option as a solution. It's probably the simplest way to do what you want.</p>\n\n<pre><code>type ClipInfoAndMeta struct {\n      Metas\n      InfoClip\n}\n</code></pre>\n\n<p>Note I upper cased the name on <code>metas</code> not sure it's necessary but I believe it will be. The language feature being used here is called 'embedding' and it works a lot like composition except that the fields/methods for embedded types are more or less 'hoisted' to the containing types scope. IE with an instance of <code>ClipInfoAndMeta</code> you can directly access any exported field that is defined on <code>InfoClip</code>.</p>\n\n<p>One oddity of your set up is that you'll have collisions on field names between the two types. Not sure how that would play out. With all this being said, it would be helpful to see the json string you're trying to Unmarshal from. As I've been writing this I realized that <code>metas</code> is just a subset of <code>InfoClip</code>. Which has confused me about what you are actually trying to do? I mean, if the data coming back is all in one object, it would mean <code>InfoClip</code> is sufficient for storing  all of it. If that is the case you have no reason for the other object... And if you want to trim down the fields which get passed to the display layer of your app you should just define a method on the <code>InfoClip</code> type like <code>func (i *InfoClip) GetMetas() Metas { return &amp;Metas{ ... } }</code> then you can just deal with the one type everywhere and hand off the <code>Metas</code> to the display layer when it's needed.</p>\n"}, {"comments": [{"owner": {"reputation": 39, "user_id": 5273213, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8225edf7e7e3658201e31ae323d63eb4?s=128&d=identicon&r=PG&f=1", "display_name": "RieuxThomas", "link": "https://stackoverflow.com/users/5273213/rieuxthomas"}, "edited": false, "score": 0, "creation_date": 1445522405, "post_id": 33278946, "comment_id": 54365962, "body": "Thank you for helping me ! I have an error with json: unexpected end of json input"}, {"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "reply_to_user": {"reputation": 39, "user_id": 5273213, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8225edf7e7e3658201e31ae323d63eb4?s=128&d=identicon&r=PG&f=1", "display_name": "RieuxThomas", "link": "https://stackoverflow.com/users/5273213/rieuxthomas"}, "edited": false, "score": 0, "creation_date": 1445526403, "post_id": 33278946, "comment_id": 54368875, "body": "print your json before you decode it, inspect it manually, if you can&#39;t find the error, try something like <a href=\"https://jsonformatter.curiousconcept.com\" rel=\"nofollow noreferrer\">an online json formatter and validator</a>"}, {"owner": {"reputation": 39, "user_id": 5273213, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8225edf7e7e3658201e31ae323d63eb4?s=128&d=identicon&r=PG&f=1", "display_name": "RieuxThomas", "link": "https://stackoverflow.com/users/5273213/rieuxthomas"}, "edited": false, "score": 0, "creation_date": 1445591383, "post_id": 33278946, "comment_id": 54396321, "body": "The thing is this code work ouside the project but inside it can&#39;t decode []string"}, {"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "reply_to_user": {"reputation": 39, "user_id": 5273213, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8225edf7e7e3658201e31ae323d63eb4?s=128&d=identicon&r=PG&f=1", "display_name": "RieuxThomas", "link": "https://stackoverflow.com/users/5273213/rieuxthomas"}, "edited": false, "score": 0, "creation_date": 1445601138, "post_id": 33278946, "comment_id": 54402045, "body": "Well then, inside the project, print you JSON to some debug output and analyze it?"}], "tags": [], "owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "is_accepted": true, "score": 2, "last_activity_date": 1445511029, "last_edit_date": 1495542593, "creation_date": 1445509980, "answer_id": 33278946, "question_id": 33255821, "link": "https://stackoverflow.com/questions/33255821/golang-decode-2-json-items-into-1-struct/33278946#33278946", "title": "Golang decode 2 JSON items into 1 struct", "body": "<p>After a lot of trial and error, I present to you this fully functional solution:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"time\"\n)\n\ntype Clip struct {\n    Value []InfoClip `json:value`\n}\n\ntype customTime struct {\n    time.Time\n}\n\nconst ctLayout = \"2006-01-02 15:04:05\"\n\nfunc (ct *customTime) UnmarshalJSON(b []byte) (err error) {\n    if b[0] == '\"' &amp;&amp; b[len(b)-1] == '\"' {\n        b = b[1 : len(b)-1]\n    }\n    ct.Time, err = time.Parse(ctLayout, string(b))\n    return\n}\n\ntype InfoClip struct {\n    Id                string     `json:\"clipId\"`\n    CreatedAt         customTime `json:\"createdAt\"`\n    StartTimeCode     string     `json:\"startTimeCode\"` //if you want ints here, you'll have to decode manually, or fix the json beforehand\n    EndTimeCode       string     `json:\"endTimeCode\"`   //same for this one\n    Metas             metas      `json:\"-\"`\n    MetasString       string     `json:\"metas\"`\n    Tags              []string   `json:\"tags\"`\n    Categories        []string   `json:\"categories\"`\n    UserId            string     `json:\"userId\"`\n    SourceId          string     `json:\"sourceId\"`\n    ProviderName      string     `json:\"providerName\"`\n    ProviderReference string     `json:\"providerReference\"`\n    PublicationStatus string     `json:\"publicationStatus\"`\n    Name              string     `json:\"name\"`\n    FacebookPage      string     `json:\"facebookPage\"`\n    TwitterHandle     string     `json:\"twitterHandle\"`\n    PermaLinkUrl      string     `json:\"permalinkBaseURL\"`\n    Logo              string     `json:\"logo\"`\n    Link              string     `json:\"link\"`\n    Views             int        `json:\"views\"`\n}\n\ntype metas struct {\n    Title      string   `json:\"title\"`\n    Tags       []string `json:\"tags\"`\n    Categories []string `json:\"categories\"`\n    PermaLink  string   `json:\"permalink\"`\n}\n\nvar jsonString = `{  \n   \"clipId\":\"9b2ea9bb-e54b-4291-ba16-9211fa3c755f\",\n   \"streamUrl\":\"https://&lt;edited out&gt;/asset-32e43a5d-1500-80c3-cc6b-f1e4fe2b5c44\\/6c53fbf5-dbe9-4617-9692-78e8d76a7b6e_H264_500kbps_AAC_und_ch2_128kbps.mp4?sv=2012-02-12&amp;sr=c&amp;si=17ed71e8-5176-4432-8092-ee64928a55f6&amp;sig=KHyToRlqvwQxWZXVvRYOkBOBOF0SuBLVmKiGp4joBpw%3D&amp;st=2015-05-18T13%3A32%3A41Z&amp;se=2057-05-07T13%3A32%3A41Z\",\n   \"startTimecode\":\"6\",\n   \"endTimecode\":\"16\",\n   \"createdAt\":\"2015-05-19 13:31:32\",\n   \"metas\":\"{\\\"title\\\":\\\"Zapping : Obama, Marine Le Pen et Michael Jackson\\\",\\\"tags\\\":[\\\"actualite\\\"],\\\"categories\\\":[\\\"actualite\\\"],\\\"permalink\\\":\\\"http:\\/\\/videos.lexpress.fr\\/actualite\\/zapping-obama-marine-le-pen-et-michael-jackson_910357.html\\\"}\",\n   \"sourceId\":\"6c53fbf5-dbe9-4617-9692-78e8d76a7b6e\",\n   \"providerName\":\"dailymotion\",\n   \"providerReference\":\"x1xmnxq\",\n   \"publicationStatus\":\"1\",\n   \"userId\":\"b373400a-bd7e-452a-af68-36992b0323a5\",\n   \"name\":\"LEXPRESS.fr\",\n   \"facebookPage\":\"https:\\/\\/www.facebook.com\\/LExpress\",\n   \"twitterHandle\":\"https:\\/\\/twitter.com\\/lexpress\",\n   \"permalinkBaseURL\":\"https:\\/\\/tym.net\\/fr\\/{CLIP_ID}\",\n   \"logo\":\"lexpress-120px.png\",\n   \"link\":\"http:\\/\\/videos.lexpress.fr\\/\"\n}`\n\nfunc main() {\n    res := parseJson(jsonString)\n    fmt.Printf(\"%+v\\n\",res)\n}\n\nfunc parseJson(theJson string) InfoClip {\n    toParseInto := struct {\n        InfoClip\n        MetasString string `json:\"metas\"`\n    }{\n        InfoClip:    InfoClip{},\n        MetasString: \"\"}\n\n    err := json.Unmarshal([]byte(jsonString), &amp;toParseInto)\n    if err != nil {\n        log.Panic(err)\n    }\n\n    err = json.Unmarshal([]byte(toParseInto.MetasString), &amp;toParseInto.InfoClip.Metas)\n    if err != nil {\n        log.Panic(err)\n    }\n\n    return toParseInto.InfoClip\n}\n</code></pre>\n\n<p>What are we doing in the <code>parseJson</code> function?</p>\n\n<p>We create a new struct and assign that to the <code>toParseInto</code> variable. We design the struct in a way that it contains all of the fields from <code>InfoClip</code> via embedding, and We add a field to temporarily hold the JSON string <code>metas</code>.</p>\n\n<p>We then unmarshal into that struct, which, after fixing the issues listed below, works fine.</p>\n\n<p>After that, we unmarshal that <em>inner</em> JSON into the correct field in the embedded <code>InfoClip</code>.</p>\n\n<p>We can now easily return that embedded <code>InfoClip</code> to get what we really wanted.</p>\n\n<p>Now, all the issues I have identified in your original solution:</p>\n\n<ol>\n<li>The time format in your JSON is not the standard time format to be used in JSON. That is defined in some RFC, but anyways: because of that, we have to use our own type <code>customTime</code> to parse that. It handles just like a normal <code>time.Time</code>, because that is embedded within.</li>\n<li><strong>All</strong> your json tags were wrong. All of them had missing quotes, and some were just not even correct.</li>\n<li><code>startTimeCode</code> and <code>endTimeCode</code> are strings in the JSON, not ints</li>\n</ol>\n\n<p>Left to you to improve:</p>\n\n<ul>\n<li>Error handling: Don't just panic in the <code>parseJson</code> function, but rather return the error somehow</li>\n<li>If you want <code>startTimecode</code> and <code>endTimecode</code> to be available as ints, parse them manually. You can employ a \"hack\" similar to the one I used to parse the inner JSON.</li>\n</ul>\n\n<p>One final note, not related to this answer but rather to your question: If you had provided both your code and the JSON with your original question, you would have had an answer in probably less than an hour. <em>Please</em>, <em>please</em> don't make this harder than it needs to be.</p>\n\n<p>EDIT: I forgot to provide my sources, I used <a href=\"https://stackoverflow.com/questions/25087960/json-unmarshal-time-that-isnt-in-rfc-3339-format\">this question</a> to parse your time format.</p>\n"}], "owner": {"reputation": 39, "user_id": 5273213, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8225edf7e7e3658201e31ae323d63eb4?s=128&d=identicon&r=PG&f=1", "display_name": "RieuxThomas", "link": "https://stackoverflow.com/users/5273213/rieuxthomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 0, "accepted_answer_id": 33278946, "answer_count": 2, "score": -1, "last_activity_date": 1445603233, "creation_date": 1445420411, "last_edit_date": 1445509347, "question_id": 33255821, "link": "https://stackoverflow.com/questions/33255821/golang-decode-2-json-items-into-1-struct", "title": "Golang decode 2 JSON items into 1 struct", "body": "<p>i'm trying to decode 2 JSON items into the same struct, because the second JSON complet the first one, but it doesn't work (do nothing) have you got some ideas ?</p>\n\n<pre><code>func getUserClip(this *LibraryController, id string) (*Clip){\n//Test Api\n//Send Request to azure search\nData := Clip{}\nif req := GetClipById(\"b373400a-bd7e-452a-af68-36992b0323a5\"); req == nil {\n    return nil\n} else {\n    str, err := req.String()\n    if err != nil {\n        beego.Debug(\"Error Json req.String: \", err)\n    }\n    //Uncode Json to string\n    if err := json.Unmarshal([]byte(str), &amp;Data); err != nil {\n        beego.Debug(\"Error json\", err)\n    }\n    for i := range Data.Value {\n        if req = GetCliRedis(Data.Value[i].Id); err != nil {\n            return nil\n        } else {\n            str, err := req.String()\n            beego.Debug(\"JSON REDIS DEBUG: \", str)\n            if err != nil {\n                beego.Debug(\"Error Json req.String: \", err)\n            }\n            if err := json.Unmarshal([]byte(str), &amp;Data); err != nil {\n                beego.Debug(\"Error json\", err)\n            }\n        }\n        i++\n    }\n   }\n  return &amp;Data\n}\n</code></pre>\n\n<p>and the struct</p>\n\n<pre><code>type Clip struct {\nValue   []InfoClip `json:value`\n}\n\ntype InfoClip struct {\nId                  string      `json:id`\nCreatedAt           time.Time   `json:createdAt`\nStartTimeCode       int         `json:startTimeCode`\nEndTimeCode         int         `json:endTimeCode`\nMetas               metas       `json:metas`\nTags                []string    `json:tags`\nCategories          []string    `json:categories`\nUserId              string      `json:userId`\nSourceId            string      `json:sourceId`\nProviderName        string      `json:providerName`\nProviderReference   string      `json:providerReference`\nPublicationStatus   string      `json:publicationStatus`\nName                string      `json:name`\nFacebookPage        string      `json:facebookPage`\nTwitterHandle       string      `json:twitterHandle`\nPermaLinkUrl        string      `json:permalinkUrl`\nLogo                string      `json:logo`\nLink                string      `json:link`\nViews               int         `json:views`\n}\n\ntype metas struct {\nTitle               string      `json:title`\nTags                []string    `json:tags`\nCategories          []string    `json:categories`\nPermaLink           string      `json:permalink`\n}\n</code></pre>\n\n<p>The JSON I receive is:</p>\n\n<pre><code>{  \n   \"clipId\":\"9b2ea9bb-e54b-4291-ba16-9211fa3c755f\",\n   \"streamUrl\":\"https://&lt;edited out&gt;/asset-32e43a5d-1500-80c3-cc6b-f1e4fe2b5c44\\/6c53fbf5-dbe9-4617-9692-78e8d76a7b6e_H264_500kbps_AAC_und_ch2_128kbps.mp4?sv=2012-02-12&amp;sr=c&amp;si=17ed71e8-5176-4432-8092-ee64928a55f6&amp;sig=KHyToRlqvwQxWZXVvRYOkBOBOF0SuBLVmKiGp4joBpw%3D&amp;st=2015-05-18T13%3A32%3A41Z&amp;se=2057-05-07T13%3A32%3A41Z\",\n   \"startTimecode\":\"6\",\n   \"endTimecode\":\"16\",\n   \"createdAt\":\"2015-05-19 13:31:32\",\n   \"metas\":\"{\\\"title\\\":\\\"Zapping : Obama, Marine Le Pen et Michael Jackson\\\",\\\"tags\\\":[\\\"actualite\\\"],\\\"categories\\\":[\\\"actualite\\\"],\\\"permalink\\\":\\\"http:\\/\\/videos.lexpress.fr\\/actualite\\/zapping-obama-marine-le-pen-et-michael-jackson_910357.html\\\"}\",\n   \"sourceId\":\"6c53fbf5-dbe9-4617-9692-78e8d76a7b6e\",\n   \"providerName\":\"dailymotion\",\n   \"providerReference\":\"x1xmnxq\",\n   \"publicationStatus\":\"1\",\n   \"userId\":\"b373400a-bd7e-452a-af68-36992b0323a5\",\n   \"name\":\"LEXPRESS.fr\",\n   \"facebookPage\":\"https:\\/\\/www.facebook.com\\/LExpress\",\n   \"twitterHandle\":\"https:\\/\\/twitter.com\\/lexpress\",\n   \"permalinkBaseURL\":\"https:\\/\\/tym.net\\/fr\\/{CLIP_ID}\",\n   \"logo\":\"lexpress-120px.png\",\n   \"link\":\"http:\\/\\/videos.lexpress.fr\\/\"\n}\n</code></pre>\n\n<p>The Redis complet the azure search missing information :</p>\n\n<p>here the struct :</p>\n\n<pre><code>type Clip struct {\nValue   []SearchClip `json:value`\n}\n\ntype SearchClip struct {\nId                  string `json:id`\nCreatedAt           string`json:createdAt`\nTags                []string `json:tags`\nCategories          []string `json:categories`\nUserId              string `json:userId`\nSourceId            string `json:sourceId`\nViews               int `json:views`\n}\n</code></pre>\n\n<p>this is the basic information and redis complet this</p>\n\n<p>I don't want to merge 2 struct into a third one i think it's not the better process, i will do it if it's the last solution. </p>\n"}, {"tags": ["http", "go", "http-get", "postman"], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 5469458, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff354d3714f2120d67515ad301491578?s=128&d=identicon&r=PG&f=1", "display_name": "this.that", "link": "https://stackoverflow.com/users/5469458/this-that"}, "edited": false, "score": 0, "creation_date": 1445420349, "post_id": 33255157, "comment_id": 54312974, "body": "Thanks a lot for the insights @mrd0ll4r .  I am able to fetch the data now. So basically I think that r.GET is better option than HnadleFunc."}, {"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "reply_to_user": {"reputation": 97, "user_id": 5469458, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff354d3714f2120d67515ad301491578?s=128&d=identicon&r=PG&f=1", "display_name": "this.that", "link": "https://stackoverflow.com/users/5469458/this-that"}, "edited": false, "score": 0, "creation_date": 1445420542, "post_id": 33255157, "comment_id": 54313118, "body": "It is basically the same - what I did was adding the <code>httprouter</code> in between, who decies what handler to use."}, {"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 1, "creation_date": 1445433171, "post_id": 33255157, "comment_id": 54321623, "body": "@mrd0ll4r the way to do this with just the std lib is to register a handler for <code>&#47;location&#47;</code> which will match <code>&#47;location&#47;titan rolex</code> short example <a href=\"http://play.golang.org/p/fyJVDqL2Ox\" rel=\"nofollow noreferrer\">play.golang.org/p/fyJVDqL2Ox</a> long example <a href=\"https://golang.org/doc/articles/wiki/\" rel=\"nofollow noreferrer\">golang.org/doc/articles/wiki</a>"}], "tags": [], "owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "is_accepted": true, "score": 0, "last_activity_date": 1445494094, "last_edit_date": 1445494094, "creation_date": 1445418401, "answer_id": 33255157, "question_id": 33254561, "link": "https://stackoverflow.com/questions/33254561/how-to-process-get-operation-crud-in-go-lang-via-postman/33255157#33255157", "title": "How to process GET operation (CRUD) in go lang via Postman?", "body": "<p>What you are doing is binding the <em>complete</em> path <code>/location/{titan rolex}</code> to be handled by <code>GetUser</code>.</p>\n\n<p>What you really want is to bind <code>/location/&lt;every possible string&gt;</code> to be handled by one handler (e.g. <code>LocationHandler</code>).</p>\n\n<p>You can do that with either the standard library or another router. I will present both ways:</p>\n\n<ol>\n<li><p>Standard lib:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"net/http\"\n    \"log\"\n)\n\nfunc locationHandler(w http.ResponseWriter, r *http.Request) {\n    name := r.URL.Path[len(\"/location/\"):]\n    fmt.Fprintf(w, \"Location: %s\\n\", name)\n}\n\nfunc main() {\n    http.HandleFunc(\"/location/\", locationHandler)\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>Note however, more complex paths (such as <code>/location/&lt;every possible string&gt;/&lt;some int&gt;/&lt;another string&gt;</code>) will be tedious to implement this way.</p></li>\n<li><p>The other way is to use <a href=\"https://github.com/julienschmidt/httprouter\" rel=\"nofollow\">github.com/julienschmidt/httprouter</a>, especially if you encounter these situations more often (and have more complex paths).</p>\n\n<p>Here's an example for your use case:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"github.com/julienschmidt/httprouter\"\n    \"net/http\"\n    \"log\"\n)\n\nfunc LocationHandler(w http.ResponseWriter, r *http.Request, ps httprouter.Params) {\n    fmt.Fprintf(w, \"Location: %s\\n\", ps.ByName(\"loc\"))\n}\n\nfunc main() {\n    router := httprouter.New()\n    router.GET(\"/location/:loc\", LocationHandler)\n\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n</code></pre>\n\n<p>Note that <code>httprouter</code> uses a slightly different signature for handlers. This is because, as you can see, it passes these parameters to the functions as well.</p></li>\n</ol>\n\n<p>Oh and another note, you can just hit <code>http://localhost:8080/location/titan rolex</code> with your browser (or something else) - if that something else is decent enough, it will URLEncode that to be <code>http://localhost:8080/location/titan%20rolex</code>.</p>\n"}], "owner": {"reputation": 97, "user_id": 5469458, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff354d3714f2120d67515ad301491578?s=128&d=identicon&r=PG&f=1", "display_name": "this.that", "link": "https://stackoverflow.com/users/5469458/this-that"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 0, "accepted_answer_id": 33255157, "answer_count": 1, "score": 0, "last_activity_date": 1445494094, "creation_date": 1445416627, "question_id": 33254561, "link": "https://stackoverflow.com/questions/33254561/how-to-process-get-operation-crud-in-go-lang-via-postman", "title": "How to process GET operation (CRUD) in go lang via Postman?", "body": "<p>I want to perform a get operation. I am passng  name as a resource to the URL. \nThe URL I am hitting in Postman is : <code>localhost:8080/location/{titan rolex}</code> ( I chose the GET method in the dropdown list)\nOn the URL hit in Postman, I am executing the GetUser func() with body as:</p>\n\n<pre><code>func GetUser(rw http.ResponseWriter, req *http.Request) {\n\n}\n</code></pre>\n\n<p>Now I wish to get the resource value i.e 'titan rolex' in the GetUser method. \nHow can I achieve this in golang?</p>\n\n<p>In main(), I have this : </p>\n\n<pre><code>http.HandleFunc(\"/location/{titan rolex}\", GetUser)\n</code></pre>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["linux", "go"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1445422914, "post_id": 33254256, "comment_id": 54314693, "body": "<code>&#47;tmp&#47;test &gt; &#47;tmp&#47;test.log</code> makes two process, whos pid you need?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1445447668, "post_id": 33254256, "comment_id": 54331879, "body": "As @JiangYD says, you&#39;re getting the PID of the shell, not the command<b>s</b> that the shell runs. Also note that this is unsafe as <code>SHELL</code> may be set to anything, perhaps a shell with different/unexpected escaping/semantics (e.g. it may not implement <code>-c</code>). It&#39;s especially dangerous if the input <code>command string</code> is not per-screened/verified as safe (e.g. <code>execCmd(toUser(&quot;root&quot;), &quot;rm -rf &#47; &amp; expected_cmd&quot;)</code>."}, {"owner": {"reputation": 5435, "user_id": 1078503, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/00cb3812de2cb2d15f6e5d14c15e6ed8?s=128&d=identicon&r=PG", "display_name": "leiyonglin", "link": "https://stackoverflow.com/users/1078503/leiyonglin"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1445479764, "post_id": 33254256, "comment_id": 54345522, "body": "@JiangYD   i need the process <code>&#47;tmp&#47;test</code> , i want to use the pid to kill process <code>&#47;tmp&#47;test</code>"}], "owner": {"reputation": 5435, "user_id": 1078503, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/00cb3812de2cb2d15f6e5d14c15e6ed8?s=128&d=identicon&r=PG", "display_name": "leiyonglin", "link": "https://stackoverflow.com/users/1078503/leiyonglin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2504, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1445480075, "creation_date": 1445415657, "last_edit_date": 1445480075, "question_id": 33254256, "link": "https://stackoverflow.com/questions/33254256/golang-exec-command-start-a-process-and-get-pid", "title": "golang - exec.Command start a process and get pid", "body": "<p>I wrote a function to run process, this is my code:</p>\n\n<pre><code>func execCmd(user User, command string) (*exec.Cmd, error) {\n    cmd := exec.Command(os.Getenv(\"SHELL\"), \"-c\", command)\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n    cmd.SysProcAttr = &amp;syscall.SysProcAttr{}\n    cmd.SysProcAttr.Credential = &amp;syscall.Credential{Uid: uint32(user.UID), Gid: uint32(user.GID)}\n    if err := cmd.Start(); err != nil {\n        return nil, err\n    }\n    return cmd, nil\n}\n</code></pre>\n\n<p>I used <code>cmd.Process.Pid</code> to get the pid of the process after the process has started.\nIt works well with a command like <code>/tmp/test</code> but returns an unexpected pid with the command <code>/tmp/test &gt; /tmp/test.log</code>. The command returns 1 less than the actual pid (<code>actual pid - 1</code>). I want to get the pid <code>/tmp/test</code> and after use this pid kill <code>/tmp/test</code>.</p>\n\n<p>For example: <code>cmd.Process.pid = 10667</code>, but <code>ps -ef | grep /tmp/test</code> shows that the pid equals 10668 </p>\n\n<p>Thanks.</p>\n"}, {"tags": ["testing", "go", "benchmarking"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1445409079, "post_id": 33252269, "comment_id": 54306260, "body": "<code>go test -bench BenchmarkMyTest</code>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1445421941, "last_edit_date": 1445421941, "creation_date": 1445409310, "answer_id": 33252495, "question_id": 33252269, "link": "https://stackoverflow.com/questions/33252269/go-benchmark-by-function-name/33252495#33252495", "title": "Go benchmark by function name", "body": "<p>Described at <a href=\"https://golang.org/cmd/go/#hdr-Description_of_testing_flags\" rel=\"nofollow\">Command Go: Description of testing flags</a>:</p>\n\n<pre><code>-bench regexp\n    Run benchmarks matching the regular expression.\n    By default, no benchmarks run. To run all benchmarks,\n    use '-bench .' or '-bench=.'.\n\n-run regexp\n    Run only those tests and examples matching the regular\n    expression.\n</code></pre>\n\n<p>So the syntax is that you have to separate it with a space or with the equal sign (with no apostrophe marks), and what you specify is a regexp:</p>\n\n<pre><code>go test -bench BenchmarkMyTest\ngo test -run TestMyTest\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>go test -bench=BenchmarkMyTest\ngo test -run=TestMyTest\n</code></pre>\n\n<p><strong>Specifying exactly 1 function</strong></p>\n\n<p>As the specified expression is a regexp, this will also match functions whose name contains the specified name (e.g. another function whose name starts with this, for example <code>\"BenchmarkMyTestB\"</code>). If you only want to match <code>\"BenchmarkMyTest\"</code>, append the regexp word boundary <code>'\\b'</code>:</p>\n\n<pre><code>go test -bench BenchmarkMyTest\\b\ngo test -run TestMyTest\\b\n</code></pre>\n\n<p>Note that it's enough to append it only to the end as if the function name doesn't start with <code>\"Benchmark\"</code>, it is not considered to be a benchmark function, and similarly if it doesn't start with <code>\"Test\"</code>, it is not considered to be a test function (and will not be picked up anyway).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4211028"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1037, "favorite_count": 0, "accepted_answer_id": 33252495, "answer_count": 1, "score": 1, "last_activity_date": 1445421941, "creation_date": 1445408420, "last_edit_date": 1445421786, "question_id": 33252269, "link": "https://stackoverflow.com/questions/33252269/go-benchmark-by-function-name", "title": "Go benchmark by function name", "body": "<p>I have this Benchmark function:</p>\n\n<pre><code>BenchmarkMyTest(b *testing.B) {\n}\n</code></pre>\n\n<p>And I would like to run only this function not running all other tests, but the command never worked for me.</p>\n\n<pre><code>go test -bench='BenchmarkMyTest'\nor\ngo test -run='BenchmarkMyTest'\n</code></pre>\n\n<p>What's the correct way of running one single benchmark function in Go?\nIt says to use regex but I can't find any documentation.</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["go", "goquery"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1445404758, "post_id": 33251406, "comment_id": 54304496, "body": "What is your expected output? <code>1 2 3 17 2</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 3, "last_activity_date": 1445405236, "creation_date": 1445405236, "answer_id": 33251573, "question_id": 33251406, "link": "https://stackoverflow.com/questions/33251406/goquery-selection-extractor-not-working/33251573#33251573", "title": "GoQuery selection extractor not working", "body": "<p><code>li := pageIterator.Find(\"li a\")</code> is actually a sequence of elements, but you only take the attr of the first one. It is kinda like jquery in this regard. What you actually want to do is iterate over all links, and <code>Each</code> is going to be your friend here. I find it much easier than iterating with Eq.</p>\n\n<p>This snippet works for me:</p>\n\n<pre><code>var html = `\n&lt;div class=\"pagination pagination-responsive\"&gt;\n      &lt;ul class=\"list-unstyled\"&gt; \n          &lt;li class=\"active\"&gt;\n             &lt;a rel=\"start\" target=\"1\" href=\"/s/Cambridge--MA--United-States\"&gt;1&lt;/a&gt;\n          &lt;/li&gt; \n          &lt;li&gt;\n             &lt;a rel=\"next\" target=\"2\" href=\"/s/Cambridge--MA--United-States?page=2\"&gt;2&lt;/a&gt;\n          &lt;/li&gt; \n          &lt;li&gt;\n              &lt;a target=\"3\" href=\"/s/Cambridge--MA--United-States?page=3\"&gt;3&lt;/a&gt;\n          &lt;/li&gt; \n          &lt;li class=\"gap\"&gt;&lt;span class=\"gap\"&gt;&amp;hellip;&lt;/span&gt;\n          &lt;/li&gt; \n          &lt;li&gt;\n            &lt;a target=\"17\" href=\"/s/Cambridge--MA--United-States?page=17\"&gt;17&lt;/a&gt;\n          &lt;/li&gt; \n          &lt;li class=\"next next_page\"&gt;&lt;a target=\"2\" rel=\"next\" href=\"/s/Cambridge--MA--United-States?page=2\"&gt;\n          &lt;span class=\"screen-reader-only\"&gt;Next&lt;/span&gt;&lt;i class=\"icon icon-caret-right\"&gt;&lt;/i&gt;&lt;/a&gt;\n          &lt;/li&gt;\n        &lt;/ul&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n`\n\nfunc main() {\n    doc, err := goquery.NewDocumentFromReader(strings.NewReader(html))\n    pageCounts := doc.Find(\".pagination-responsive .list-unstyled\")\n    pageCounts.Each(func(_ int, ul *goquery.Selection) {\n        links := ul.Find(\"li a\")\n        links.Each(func(_ int, li *goquery.Selection) {\n            if val, ok := li.Attr(\"target\"); ok {\n                fmt.Println(val)\n            }\n        })\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 547, "user_id": 2780187, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c82623ac37e00724492a4a22186b36b3?s=128&d=identicon&r=PG&f=1", "display_name": "user2780187", "link": "https://stackoverflow.com/users/2780187/user2780187"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 706, "favorite_count": 0, "accepted_answer_id": 33251573, "answer_count": 1, "score": 1, "last_activity_date": 1445405370, "creation_date": 1445404353, "last_edit_date": 1445405370, "question_id": 33251406, "link": "https://stackoverflow.com/questions/33251406/goquery-selection-extractor-not-working", "title": "GoQuery selection extractor not working", "body": "<p>I am attempting to extract the target attribute and add to a slice from the HTML snippet</p>\n\n<pre><code>&lt;div class=\"pagination pagination-responsive\"&gt;\n      &lt;ul class=\"list-unstyled\"&gt; \n          &lt;li class=\"active\"&gt;\n             &lt;a rel=\"start\" target=\"1\" href=\"/s/Cambridge--MA--United-States\"&gt;1&lt;/a&gt;\n          &lt;/li&gt; \n          &lt;li&gt;\n             &lt;a rel=\"next\" target=\"2\" href=\"/s/Cambridge--MA--United-States?page=2\"&gt;2&lt;/a&gt;\n          &lt;/li&gt; \n          &lt;li&gt;\n              &lt;a target=\"3\" href=\"/s/Cambridge--MA--United-States?page=3\"&gt;3&lt;/a&gt;\n          &lt;/li&gt; \n          &lt;li class=\"gap\"&gt;&lt;span class=\"gap\"&gt;&amp;hellip;&lt;/span&gt;\n          &lt;/li&gt; \n          &lt;li&gt;\n            &lt;a target=\"17\" href=\"/s/Cambridge--MA--United-States?page=17\"&gt;17&lt;/a&gt;\n          &lt;/li&gt; \n          &lt;li class=\"next next_page\"&gt;&lt;a target=\"2\" rel=\"next\" href=\"/s/Cambridge--MA--United-States?page=2\"&gt;\n          &lt;span class=\"screen-reader-only\"&gt;Next&lt;/span&gt;&lt;i class=\"icon icon-caret-right\"&gt;&lt;/i&gt;&lt;/a&gt;\n          &lt;/li&gt;\n        &lt;/ul&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\npageCounts := doc.Find(\".pagination-responsive .list-unstyled\")\n    for page := range pageCounts.Nodes {\n        pageIterator := pageCounts.Eq(page)\n        li := pageIterator.Find(\"li a\")\n        href, _ := li.Attr(\"target\")\n        fmt.Println(href)\n    }\n</code></pre>\n\n<p>Can someone please indicate what I might be missing here?</p>\n"}, {"tags": ["http", "struct", "go", "httpresponse", "postman"], "comments": [{"owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "edited": false, "score": 0, "creation_date": 1445391541, "post_id": 33249338, "comment_id": 54301023, "body": "You kind of answered your own question implicitly, but I&#39;ll try to make it more clear in an answer..."}], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 5469458, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff354d3714f2120d67515ad301491578?s=128&d=identicon&r=PG&f=1", "display_name": "this.that", "link": "https://stackoverflow.com/users/5469458/this-that"}, "edited": false, "score": 0, "creation_date": 1445392958, "post_id": 33249576, "comment_id": 54301400, "body": "Thanks a lot @Will C for your inputs.  Now the struct prints as I want but it is preceded by a &#39;&amp;&#39; character. ( as if it is a pointer). The output is : &amp;{ID:1 Name:John Smith Address:123 Main St City:San Francisco State:CA Zip:94113 Coordinate:{Latitude:37.7917618 Longitude:-122.3943405}}"}, {"owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "reply_to_user": {"reputation": 97, "user_id": 5469458, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff354d3714f2120d67515ad301491578?s=128&d=identicon&r=PG&f=1", "display_name": "this.that", "link": "https://stackoverflow.com/users/5469458/this-that"}, "edited": false, "score": 1, "creation_date": 1445399271, "post_id": 33249576, "comment_id": 54302963, "body": "I think thats because <code>m</code> happens to be a pointer so you might be able to do <code>fmt.Sprintf(&quot;%+v\\n&quot;, *m)</code> to dereference <code>m</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1445431356, "post_id": 33249576, "comment_id": 54320242, "body": "No need for the extra string conversion, <code>fmt.Fprintf(rw, &quot;%+v\\n&quot;, m)</code>"}, {"owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1445432564, "post_id": 33249576, "comment_id": 54321198, "body": "Good call! @JimB&#39;s suggestion is probably better. I&#39;ll update my answer to include it."}], "tags": [], "owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "is_accepted": true, "score": 1, "last_activity_date": 1445432660, "last_edit_date": 1445432660, "creation_date": 1445391550, "answer_id": 33249576, "question_id": 33249338, "link": "https://stackoverflow.com/questions/33249338/how-to-print-a-struct-in-the-http-response-in-go-lang/33249576#33249576", "title": "How to print a Struct in the Http Response in go lang", "body": "<p>Somehow you have indirectly answered your question but just didn't know about it. </p>\n\n<p>You mentioned this example, which has the function you're looking for. <code>fmt.Sprintf</code> returns a formatted string instead of the one you were already using that prints to standard out, <code>fmt.Printf</code>.</p>\n\n<blockquote>\n  <p>rw.Write([]byte(fmt.Sprintf(\"Hello, %s!\", t.Name)))</p>\n</blockquote>\n\n<p>So instead of <code>fmt.Printf(\"%+v\\n\", m)</code>, you can use something like the below that uses <code>fmt.Sprintf</code>:</p>\n\n<pre><code>structString := fmt.Sprintf(\"%+v\\n\", m)\nrw.Write([]byte(structString))\n</code></pre>\n\n<p>The other solution as @JimB suggested is to use <code>fmt.Fprintf</code> directly taking an <code>io.Writer</code> as its first parameter and a format string afterwards.</p>\n\n<pre><code>fmt.Fprintf(rw, \"%+v\\n\", *m)\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 5469458, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff354d3714f2120d67515ad301491578?s=128&d=identicon&r=PG&f=1", "display_name": "this.that", "link": "https://stackoverflow.com/users/5469458/this-that"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1366, "favorite_count": 0, "accepted_answer_id": 33249576, "answer_count": 1, "score": 0, "last_activity_date": 1445432660, "creation_date": 1445389890, "last_edit_date": 1445390372, "question_id": 33249338, "link": "https://stackoverflow.com/questions/33249338/how-to-print-a-struct-in-the-http-response-in-go-lang", "title": "How to print a Struct in the Http Response in go lang", "body": "<p>I am using POSTMAN for handling POST requests in go lang. I wish to display the response in the struct format(A struct of json data). \nFor displaying a normal string, I am using <code>rw.Write([]byte(fmt.Sprintf(\"Hello, %s!\", t.Name)))</code></p>\n\n<p>What should I do to display the <strong>Struct in response body?(using rw.write method)</strong></p>\n\n<p><code>fmt.Printf(\"%+v\\n\", m)</code> outputs to <code>{ID:1 Name:John Smith Address:123 Main St City:San Francisco State:CA Zip:94113 Coordinate:{Latitude:37.7917618 Longitude:-122.3943405}}</code></p>\n\n<p>This is what I want to display exactly in the Postman response . </p>\n\n<p>Thanks in advance:)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18219, "user_id": 627492, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a65ecbb7d583a75511cff7d78dd7d6e7?s=128&d=identicon&r=PG", "display_name": "Duke Dougal", "link": "https://stackoverflow.com/users/627492/duke-dougal"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1445401481, "post_id": 33249076, "comment_id": 54303560, "body": "@Amit I don&#39;t understand what you are asking.  Why would I want to do a one line return hello world? That makes no sense."}], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 4, "last_activity_date": 1445389327, "last_edit_date": 1445389327, "creation_date": 1445387980, "answer_id": 33249093, "question_id": 33249076, "link": "https://stackoverflow.com/questions/33249076/golang-how-to-convert-string-slice-to-string/33249093#33249093", "title": "Golang how to convert string slice to string?", "body": "<p><code>myvar</code> is a slice of strings, and you want a single string? If you just want to concatinate them you can use <code>strings.Join(myvar,\"\")</code>.</p>\n\n<p>Or not make a string slice in the first place:</p>\n\n<pre><code>myvar := \"\"\nmyvar += \"hello, world!\"\nreturn myvar\n</code></pre>\n"}], "owner": {"reputation": 18219, "user_id": 627492, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a65ecbb7d583a75511cff7d78dd7d6e7?s=128&d=identicon&r=PG", "display_name": "Duke Dougal", "link": "https://stackoverflow.com/users/627492/duke-dougal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2309, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1445389327, "creation_date": 1445387825, "question_id": 33249076, "link": "https://stackoverflow.com/questions/33249076/golang-how-to-convert-string-slice-to-string", "title": "Golang how to convert string slice to string?", "body": "<p>Here's the error:</p>\n\n<pre><code>ubuntu@buildserver:~/gospace$ go build src/runk/test.go\n# command-line-arguments\nsrc/runk/test.go:8: cannot convert myvar (type []string) to type string\nubuntu@buildserver:~/gospace$\n</code></pre>\n\n<p>Here's the code:</p>\n\n<pre><code>ubuntu@buildserver:~/gospace$ cat src/run/test.go\npackage main\n\nfunc Test() string {\n\n    var myvar []string\n    myvar = append(myvar, \"hello world\")\n\n    return string(myvar)\n\n}\n\nfunc main() {\n    Test()\n}\nubuntu@buildserver:~/gospace$\n</code></pre>\n"}, {"tags": ["c", "go", "shared-libraries", "stack-trace"], "comments": [{"owner": {"reputation": 2265, "user_id": 251552, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4097489e7e878de0ae36436bcb16d076?s=128&d=identicon&r=PG", "display_name": "rmonjo", "link": "https://stackoverflow.com/users/251552/rmonjo"}, "edited": false, "score": 0, "creation_date": 1461709797, "post_id": 33248427, "comment_id": 61320421, "body": "Any update on this ? Did you find a solution / workaround ? I&#39;m facing a similar issue ..."}, {"owner": {"reputation": 15334, "user_id": 3348604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QybjW.jpg?s=128&g=1", "display_name": "Jan Garaj", "link": "https://stackoverflow.com/users/3348604/jan-garaj"}, "reply_to_user": {"reputation": 2265, "user_id": 251552, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4097489e7e878de0ae36436bcb16d076?s=128&d=identicon&r=PG", "display_name": "rmonjo", "link": "https://stackoverflow.com/users/251552/rmonjo"}, "edited": false, "score": 0, "creation_date": 1461763703, "post_id": 33248427, "comment_id": 61346820, "body": "No, I didn&#39;t find any workaround."}], "answers": [{"tags": [], "owner": {"reputation": 2265, "user_id": 251552, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4097489e7e878de0ae36436bcb16d076?s=128&d=identicon&r=PG", "display_name": "rmonjo", "link": "https://stackoverflow.com/users/251552/rmonjo"}, "is_accepted": true, "score": 4, "last_activity_date": 1461782582, "creation_date": 1461782582, "answer_id": 36898305, "question_id": 33248427, "link": "https://stackoverflow.com/questions/33248427/how-to-debug-c-shared-library-written-in-go-it-hangs-on-net-call/36898305#36898305", "title": "How to debug C-shared library (written in Go) - it hangs on net call", "body": "<p>Ok I solved this for my use case, you might be in a similar situation.</p>\n\n<p>When you link your Go c-shared library to your C or C++ application, the Go runtime is loaded when you start the application (you can verify this, in <code>func init()</code> for example, it's called directly when you start your app). Then, if you fork a process and use the Go library, you will have unpredictable behaviour.\nBasically, you must load the Go shared library after fork and can't rely on it once you forked. Using <code>dlopen</code> and <code>dlsym</code> will allow you to control when the Go runtime get loaded.</p>\n"}], "owner": {"reputation": 15334, "user_id": 3348604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QybjW.jpg?s=128&g=1", "display_name": "Jan Garaj", "link": "https://stackoverflow.com/users/3348604/jan-garaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 823, "favorite_count": 0, "accepted_answer_id": 36898305, "answer_count": 1, "score": 3, "last_activity_date": 1461782582, "creation_date": 1445383022, "question_id": 33248427, "link": "https://stackoverflow.com/questions/33248427/how-to-debug-c-shared-library-written-in-go-it-hangs-on-net-call", "title": "How to debug C-shared library (written in Go) - it hangs on net call", "body": "<p>Go code with <em>http.Post()</em>. If I build exe, it's OK. If I build C shared library <em>-buildmode=c-shared</em>, it hangs on https.Post().</p>\n\n<p>I've tried <em>strace -fp PID</em>:</p>\n\n<pre><code>futex(0x7f618b2c1cd0, FUTEX_WAKE, 1)    = 0\nfutex(0xc820022110, FUTEX_WAIT, 0, NULL\n</code></pre>\n\n<p>I've tried to add profiler:</p>\n\n<pre><code>http.ListenAndServe(\"localhost:6060\", nil)\nhttp.Post()\n</code></pre>\n\n<p>But again it hangs on http.Post and profiler was blocked as well (it was listening, but not response from 6060 port). I've sent SIGQUIT signal - stack trace:</p>\n\n<pre><code>SIGQUIT: quit\nPC=0x7f0cad5c9081 m=1\n\ngoroutine 0 [idle]:\nruntime.futex(0xc820022110, 0x0, 0x0, 0x0, 0x7f0c00000000, 0x7f0cad577879, 0x0, 0x0, 0x7f0cad577ae8, 0xc820022110, ...)\n        /usr/local/go/src/runtime/sys_linux_amd64.s:288 +0x21\nruntime.futexsleep(0xc820022110, 0xc800000000, 0xffffffffffffffff)\n        /usr/local/go/src/runtime/os1_linux.go:39 +0x53\nruntime.notesleep(0xc820022110)\n        /usr/local/go/src/runtime/lock_futex.go:142 +0xa8\nruntime.stoplockedm()\n        /usr/local/go/src/runtime/proc1.go:1268 +0xb2\nruntime.schedule()\n        /usr/local/go/src/runtime/proc1.go:1590 +0x72\nruntime.park_m(0xc820000600)\n        /usr/local/go/src/runtime/proc1.go:1698 +0x191\nruntime.mcall(0x7f0cad5c722a)\n        /usr/local/go/src/runtime/asm_amd64.s:204 +0x53\n\ngoroutine 17 [IO wait, locked to thread]:\nruntime.gopark(0x7f0cada4a878, 0x7f0ca594b198, 0x7f0cad993b20, 0x7, 0x1b, 0x5)\n        /usr/local/go/src/runtime/proc.go:185 +0x169 fp=0xc820041868 sp=0xc820041840\nruntime.netpollblock(0x7f0ca594b170, 0x72, 0x7f0cac21e050)\n        /usr/local/go/src/runtime/netpoll.go:338 +0x160 fp=0xc8200418b0 sp=0xc820041868\nnet.runtime_pollWait(0x7f0ca594b170, 0x72, 0xc82000a1c0)\n        /usr/local/go/src/runtime/netpoll.go:157 +0x62 fp=0xc8200418d0 sp=0xc8200418b0\nnet.(*pollDesc).Wait(0xc82011c140, 0x72, 0x0, 0x0)\n        /usr/local/go/src/net/fd_poll_runtime.go:73 +0x3c fp=0xc8200418f0 sp=0xc8200418d0\nnet.(*pollDesc).WaitRead(0xc82011c140, 0x0, 0x0)\n        /usr/local/go/src/net/fd_poll_runtime.go:78 +0x38 fp=0xc820041918 sp=0xc8200418f0\nnet.(*netFD).accept(0xc82011c0e0, 0x0, 0x7f0ca594b268, 0xc8200b4440)\n        /usr/local/go/src/net/fd_unix.go:408 +0x27e fp=0xc820041a18 sp=0xc820041918\nnet.(*TCPListener).AcceptTCP(0xc8200b8050, 0xc820041ab0, 0x0, 0x0)\n        /usr/local/go/src/net/tcpsock_posix.go:254 +0x4f fp=0xc820041a78 sp=0xc820041a18\nnet/http.tcpKeepAliveListener.Accept(0xc8200b8050, 0x0, 0x0, 0x0, 0x0)\n        /usr/local/go/src/net/http/server.go:2135 +0x43 fp=0xc820041ab0 sp=0xc820041a78\nnet/http.(*Server).Serve(0xc8200b20c0, 0x7f0ca594b230, 0xc8200b8050, 0x0, 0x0)\n        /usr/local/go/src/net/http/server.go:1887 +0xb5 fp=0xc820041b98 sp=0xc820041ab0\nnet/http.(*Server).ListenAndServe(0xc8200b20c0, 0x0, 0x0)\n        /usr/local/go/src/net/http/server.go:1877 +0x138 fp=0xc820041c28 sp=0xc820041b98\nnet/http.ListenAndServe(0x7f0cad9a6ae0, 0xe, 0x0, 0x0, 0x0, 0x0)\n        /usr/local/go/src/net/http/server.go:1967 +0x91 fp=0xc820041c50 sp=0xc820041c28\nmain.Code(0xc8201122a0, 0x0, 0x0, 0x0, 0x0)\n        /opt/gopath/src/github.com/jangaraj/zabbix-module/zabbix_module.go:152 +0x94 fp=0xc820041d58 sp=0xc820041c50\ngithub.com/cavaliercoder/g2z.route_item(0x7ffe7bc803e0, 0x7ffe7bc80c90, 0x0)\n        /opt/gopath/src/github.com/cavaliercoder/g2z/router.go:65 +0xc2a fp=0xc820041ed0 sp=0xc820041d58\nruntime.call32(0x0, 0x7ffe7bc802d8, 0x7ffe7bc80360, 0x18)\n        /usr/local/go/src/runtime/asm_amd64.s:437 +0x40 fp=0xc820041ef8 sp=0xc820041ed0\nruntime.cgocallbackg1()\n        /usr/local/go/src/runtime/cgocall.go:252 +0x110 fp=0xc820041f30 sp=0xc820041ef8\nruntime.cgocallbackg()\n        /usr/local/go/src/runtime/cgocall.go:177 +0xd9 fp=0xc820041f90 sp=0xc820041f30\nruntime.cgocallback_gofunc(0x0, 0x0, 0x0)\n        /usr/local/go/src/runtime/asm_amd64.s:801 +0x5d fp=0xc820041fa0 sp=0xc820041f90\nruntime.goexit()\n        /usr/local/go/src/runtime/asm_amd64.s:1696 +0x1 fp=0xc820041fa8 sp=0xc820041fa0\n\ngoroutine 18 [syscall, locked to thread]:\nruntime.goexit()\n        /usr/local/go/src/runtime/asm_amd64.s:1696 +0x1\n\ngoroutine 5 [chan receive]:\ngithub.com/golang/glog.(*loggingT).flushDaemon(0x7f0cadd99bc0)\n        /opt/gopath/src/github.com/golang/glog/glog.go:882 +0x69\ncreated by github.com/golang/glog.init.1\n        /opt/gopath/src/github.com/golang/glog/glog.go:410 +0x299\n\nrax    0xca\nrbx    0x0\nrcx    0xffffffffffffffff\nrdx    0x0\nrdi    0xc820022110\nrsi    0x0\nrbp    0x1\nrsp    0x7ffe7bc801a8\nr8     0x0\nr9     0x0\nr10    0x0\nr11    0x286\nr12    0x4\nr13    0x7f0cada47090\nr14    0xd\nr15    0x8\nrip    0x7f0cad5c9081\nrflags 0x286\ncs     0x33\nfs     0x0\ngs     0x0\n</code></pre>\n\n<p>How to debug/solve this problem? Code looks OK - standard executable binary returns correct value. Only C shared library version has some issue. Another methods from shared library, which don't use http.post()/net.Dial() are OK.</p>\n\n<p>Original issue: <a href=\"https://github.com/cavaliercoder/g2z/issues/5\" rel=\"nofollow\">https://github.com/cavaliercoder/g2z/issues/5</a></p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 1, "creation_date": 1445383920, "post_id": 33248090, "comment_id": 54299268, "body": "Just do the request: In go or with curl"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1445385670, "post_id": 33248090, "comment_id": 54299679, "body": "In both cases you&#39;re working with the same object. It&#39;s just how things are handled that is different. For example if you instantiate a request and don&#39;t set the method then send that request, it will default to <code>GET</code>. However, on the server, when they access the <code>Method</code> field, it will never be empty, it will have the method the request used. If you want to some unit test of a server side method, you can just instantiate a request object and pass it into that for testing."}, {"owner": {"reputation": 269, "user_id": 2105489, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2f2de1fca3cddc2162f295dcf528f431?s=128&d=identicon&r=PG", "display_name": "nullgraph", "link": "https://stackoverflow.com/users/2105489/nullgraph"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1445385890, "post_id": 33248090, "comment_id": 54299722, "body": "@evanmcdonnal If I do <code>req:= http.NewRequest(&quot;GET&quot;,&quot;http:&#47;&#47;localhost&#47;test&quot;,&quot;&quot;)</code>, I get a client request. It makes a difference for me because in unit test, when I test for empty body, if  I generate request by NewRequest, empty body will give me <code>nil</code>, but if I use curl, empty body is not nil."}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1445386448, "post_id": 33248090, "comment_id": 54299851, "body": "No, you start a server, reqister a handler and then do a request to that server - either using go or curl. Just look at the documentation of the http package."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 1, "creation_date": 1445388813, "post_id": 33248090, "comment_id": 54300392, "body": "Yes but in your example you&#39;re not doing much to prep your test object. I might be wrong but I&#39;m pretty confident you could use composite literal syntax to initialize it with all the values you want or just set them after the fact. Now, the advice given by @0x434D53 might be smarter and easier though they serve different purposes so I wouldn&#39;t just follow it without considering your needs. If you&#39;re starting an http server then sending it an actual request that isn&#39;t a unit test. If your request handlers pass the request into other helper methods then it&#39;s probably not the right approach here."}, {"owner": {"reputation": 269, "user_id": 2105489, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2f2de1fca3cddc2162f295dcf528f431?s=128&d=identicon&r=PG", "display_name": "nullgraph", "link": "https://stackoverflow.com/users/2105489/nullgraph"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445389291, "post_id": 33248090, "comment_id": 54300489, "body": "@evanmcdonnal Yes, I didn&#39;t want to follow the advice by 0x434D53 because I want to write a unit test. I figured this is a common enough scenario, so I&#39;m surprised I couldn&#39;t find any reference to it. Do you mind writing up your solution as an answer?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445389571, "post_id": 33248090, "comment_id": 54300544, "body": "Sure. Give me a few minutes and I&#39;ll verify what I said is true, assuming it is, I&#39;ll make an answer out of it."}], "answers": [{"comments": [{"owner": {"reputation": 269, "user_id": 2105489, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2f2de1fca3cddc2162f295dcf528f431?s=128&d=identicon&r=PG", "display_name": "nullgraph", "link": "https://stackoverflow.com/users/2105489/nullgraph"}, "edited": false, "score": 0, "creation_date": 1445453698, "post_id": 33265709, "comment_id": 54335333, "body": "When it&#39;s a server GET request, I get <code>&amp;{{} {&lt;nil&gt;}}</code> as the body, not nil, but I can use your idea of <code>NewReader(&quot;&quot;)</code> as well. Thanks!"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 269, "user_id": 2105489, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2f2de1fca3cddc2162f295dcf528f431?s=128&d=identicon&r=PG", "display_name": "nullgraph", "link": "https://stackoverflow.com/users/2105489/nullgraph"}, "edited": false, "score": 0, "creation_date": 1445454613, "post_id": 33265709, "comment_id": 54335821, "body": "@nullgraph awesome! glad I could help."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 2, "last_activity_date": 1445448767, "creation_date": 1445448767, "answer_id": 33265709, "question_id": 33248090, "link": "https://stackoverflow.com/questions/33248090/http-server-vs-client-request-in-golang/33265709#33265709", "title": "HTTP server vs client request in golang", "body": "<p>Sorry for the delayed answer. Got a bit side tracked last night. Here's a quick example of making a request object with a non-nil body. One thing to note that I don't think I bothered asking, HTTP GET's don't have a body so you may always get a nil value for that HTTP method. Not positive about that but it would not surprise me if it were the case.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"net/http\"\nimport \"strings\"\n\nfunc main() {\n        reader := strings.NewReader(\"\")\n        req, _ := http.NewRequest(\"POST\", \"http://example.com\", reader)\n    fmt.Printf(\"Body != nil ? %v, value: %s END\\n\", req.Body != nil, req.Body)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/5Fb6b2qgSo\" rel=\"nofollow\">https://play.golang.org/p/5Fb6b2qgSo</a></p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 762253, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vFqsn.jpg?s=128&g=1", "display_name": "Scootaloot", "link": "https://stackoverflow.com/users/762253/scootaloot"}, "is_accepted": false, "score": 1, "last_activity_date": 1500023752, "creation_date": 1500023752, "answer_id": 45099147, "question_id": 33248090, "link": "https://stackoverflow.com/questions/33248090/http-server-vs-client-request-in-golang/45099147#45099147", "title": "HTTP server vs client request in golang", "body": "<p>I dont know if you are still looking for an answer here, but Go actually has a package for testing HTTP servers.</p>\n\n<p><a href=\"https://golang.org/pkg/net/http/httptest/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/httptest/</a></p>\n\n<p>Its fantastic for testing. You can create both the request and the server through here for testing.</p>\n"}], "owner": {"reputation": 269, "user_id": 2105489, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2f2de1fca3cddc2162f295dcf528f431?s=128&d=identicon&r=PG", "display_name": "nullgraph", "link": "https://stackoverflow.com/users/2105489/nullgraph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2228, "favorite_count": 0, "accepted_answer_id": 33265709, "answer_count": 2, "score": 2, "last_activity_date": 1500023752, "creation_date": 1445381058, "last_edit_date": 1445634160, "question_id": 33248090, "link": "https://stackoverflow.com/questions/33248090/http-server-vs-client-request-in-golang", "title": "HTTP server vs client request in golang", "body": "<p>The <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow\">documentation</a> says there's a difference between server and client http request, for example, in the case where the body is empty. How do I create a server request to simulate incoming http request for testing purpose?</p>\n\n<p>Edit: I specifically want to create http server request for use during unit test.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1445372781, "post_id": 33245947, "comment_id": 54294565, "body": "You cannot as <code>type Vertex</code> does not have any methods at all (only <code>*Vertex</code> has methods)."}], "answers": [{"comments": [{"owner": {"reputation": 750, "user_id": 654493, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/048fb052b006f21b685400b71e964b32?s=128&d=identicon&r=PG", "display_name": "David Smith", "link": "https://stackoverflow.com/users/654493/david-smith"}, "edited": false, "score": 0, "creation_date": 1445384929, "post_id": 33246055, "comment_id": 54299501, "body": "Thanks for the detailed answer, although &quot;slightly confused&quot; is a bit of an understatement; I&#39;m feeling particularly thick at the moment."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 750, "user_id": 654493, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/048fb052b006f21b685400b71e964b32?s=128&d=identicon&r=PG", "display_name": "David Smith", "link": "https://stackoverflow.com/users/654493/david-smith"}, "edited": false, "score": 0, "creation_date": 1445385366, "post_id": 33246055, "comment_id": 54299616, "body": "@DavidSmith how can I help clear up that confusion? Think of it this way, the implementing type is what&#39;s in the parenthesis to the left of the functions name. <code>AnyType</code> and <code>*AnyType</code> are not the same type. Whichever you use will be the one that implements the interface. If you&#39;re not familiar with the distinction between those I&#39;d recommend reading a bit about pointers and value vs reference types. Most of the concepts are relevant in many systems languages (C, C++, C# to name a few)."}, {"owner": {"reputation": 750, "user_id": 654493, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/048fb052b006f21b685400b71e964b32?s=128&d=identicon&r=PG", "display_name": "David Smith", "link": "https://stackoverflow.com/users/654493/david-smith"}, "edited": false, "score": 0, "creation_date": 1445387538, "post_id": 33246055, "comment_id": 54300136, "body": "You&#39;re very patient - I understand how I could change Abs to match the interface but the question that came to mind is, how to do the reverse; change the interface so the present Vertex satisfies it. I guess that I don&#39;t have any experience with using interfaces so from reading your answer, perhaps it is just a nonsense; you would never define an interface that requires a type to have a function that only acts on a pointer?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 750, "user_id": 654493, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/048fb052b006f21b685400b71e964b32?s=128&d=identicon&r=PG", "display_name": "David Smith", "link": "https://stackoverflow.com/users/654493/david-smith"}, "edited": false, "score": 0, "creation_date": 1445389521, "post_id": 33246055, "comment_id": 54300532, "body": "@DavidSmith to that last question, yes. What you&#39;re alluding to isn&#39;t possible and doesn&#39;t make a lot of sense. In Go, the pointer is a distinctly different type than the value version. If you want to make it so all that&#39;s required to fulfill the interface is a function pointer, you probably want to use embedding. I can elaborate on that if it&#39;s what you want. But to give more context, this is basically like having a function pointer on a struct in C. For a type to implement an interface, it must match the function definition, afaik an interface could not consist of a function pointer."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 2, "last_activity_date": 1445372959, "last_edit_date": 1445372959, "creation_date": 1445372221, "answer_id": 33246055, "question_id": 33245947, "link": "https://stackoverflow.com/questions/33245947/in-a-go-tour-how-do-i-modify-the-interface-to-require-a-method-on-a-pointer/33246055#33246055", "title": "In &quot;A Go Tour&quot;, how do I modify the interface to require a method on a pointer?", "body": "<p>You're slightly confused about what is implementing what. In this case, <code>*Vertex</code> is implementing <code>Abser</code> and not <code>Vertex</code> to make it so <code>Vertex</code> does as well, you have to change the receiving type on your implementation of <code>Abs</code> so that it's not a pointer;</p>\n\n<pre><code>func (v Vertex) Abs() float64 {\n    return math.Sqrt(v.X*v.X + v.Y*v.Y)\n} // Vertex implementing Abser here\n</code></pre>\n\n<p>So the way you're phrasing the question is a bit misleading. The interface requires no change and should receive none. Just fyi, you can have both <code>*Vertex</code> and <code>Vertex</code> implement the interface by using the method I put above as well as the one you already have.</p>\n\n<p>This is a point that often trips people up in Go. When you declare <code>func (t SomeType)</code> you're specifying the receiving type, if this is a pointer like <code>(t *SomeType)</code> then the thing implementing the interface is not <code>SomeType</code> but rather <code>*SomeType</code>. This differs a little from other languages where the method is implemented by the class and it doesn't matter if you're working with a reference or a value. In Go, the class doesn't implement the method, you specify the 'receiving type' - the thing that the method can be called on - that first argument actually gets pushed on the stack and used the same as an argument passed into a method, the distinction is only relevant for compilation (interface fulfillment really is the only reason to have the feature afaik). So, to summarize, if you want <code>Vertex</code> to implement the <code>Abser</code> interface which features a single method <code>Abs() float64</code> then you need to define the function as <code>func (v Vertex) Abs() float64 { ... }</code>.</p>\n\n<p>Just for the sake of having clear readable code I recommend not having the interface defined for both pointers and values... You can work around that using the address of or dereference operator.</p>\n"}], "owner": {"reputation": 750, "user_id": 654493, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/048fb052b006f21b685400b71e964b32?s=128&d=identicon&r=PG", "display_name": "David Smith", "link": "https://stackoverflow.com/users/654493/david-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 33246055, "answer_count": 1, "score": -2, "last_activity_date": 1445381548, "creation_date": 1445371872, "last_edit_date": 1495540327, "question_id": 33245947, "link": "https://stackoverflow.com/questions/33245947/in-a-go-tour-how-do-i-modify-the-interface-to-require-a-method-on-a-pointer", "title": "In &quot;A Go Tour&quot;, how do I modify the interface to require a method on a pointer?", "body": "<p>In <a href=\"http://tour.golang.org/methods/4\" rel=\"nofollow noreferrer\">\"A Go Tour\" on Interfaces</a> we have this interface:</p>\n\n<pre><code>type Abser interface {\n    Abs() float64\n}\n</code></pre>\n\n<p>It is explained that this type, Vertex, does not satisfy the above Abser:</p>\n\n<pre><code>type Vertex struct {\n    X, Y float64\n}\n\nfunc (v *Vertex) Abs() float64 {\n    return math.Sqrt(v.X*v.X + v.Y*v.Y)\n}\n</code></pre>\n\n<p>How do I modify the Abser interface so that Vertex satisfies it?</p>\n\n<p>(It's okay if it no longer satisfies MyFloat in the full example.)</p>\n\n<p>Before I posted this question I spent some hours searching and head scratching but after posting I found another SO question which covers similar material and may be of help to other neophytes:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/7438323/method-requires-pointer-receiver-in-go-programming-language\">\"method requires pointer receiver\u201d in Go Programming Language</a></p>\n"}, {"tags": ["json", "go", "interface", "marshalling", "unmarshalling"], "comments": [{"owner": {"reputation": 19564, "user_id": 5292302, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3b61b00d5bcb378f99eadff312544514?s=128&d=identicon&r=PG", "display_name": "Petter Friberg", "link": "https://stackoverflow.com/users/5292302/petter-friberg"}, "edited": false, "score": 0, "creation_date": 1445370159, "post_id": 33245431, "comment_id": 54293158, "body": "sort before you output.."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445372091, "post_id": 33245431, "comment_id": 54294225, "body": "Just fyi might want to revise your question a bit as the problem you&#39;re actually encountering is how to display data. There is no sorting happening here and nothing to sort. If you decided to sort the <code>MainGradient</code> array by the sum of RGB values descending, that would be a sort. From what I can tell, you just want to format the data you have in memory different. If that&#39;s not the case please offer correction but neither a map, nor a struct (which are the only two options for housing the data in the RGB objects) has any notion of order."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 4765088, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-SAodBQD6fOI/AAAAAAAAAAI/AAAAAAAAAJY/DIjzyh0r9pc/photo.jpg?sz=128", "display_name": "pvazquezdiaz", "link": "https://stackoverflow.com/users/4765088/pvazquezdiaz"}, "edited": false, "score": 0, "creation_date": 1445449544, "post_id": 33245547, "comment_id": 54332975, "body": "Thank you JimB, It does what I needed to do. The Playground example was perfect for my needs. Thanks again. :)"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1445371251, "last_edit_date": 1445371251, "creation_date": 1445370371, "answer_id": 33245547, "question_id": 33245431, "link": "https://stackoverflow.com/questions/33245431/sorting-interface-in-go/33245547#33245547", "title": "Sorting interface in Go", "body": "<p>Maps are unordered, both in Go and per the JSON spec. You will have to call them in order as you need them.</p>\n\n<pre><code>r, g, b := color[\"red\"], color[\"green\"], color[\"blue\"]\n</code></pre>\n\n<p>You can also unmarshal the values into a struct, which will give you a deterministic layout:</p>\n\n<pre><code>type Color struct {\n    Red   int `json:\"red\"`\n    Green int `json:\"green\"`\n    Blue  int `json:\"blue\"`\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/0l01NxJ4dq\" rel=\"nofollow\">http://play.golang.org/p/0l01NxJ4dq</a></p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1445371148, "creation_date": 1445371148, "answer_id": 33245757, "question_id": 33245431, "link": "https://stackoverflow.com/questions/33245431/sorting-interface-in-go/33245757#33245757", "title": "Sorting interface in Go", "body": "<p>While I personally would take the route JimB describes above another option is just to change how you display the data. I can infer based on your output that you did; <code>fmt.Printf(\"%v\", YourInstance)</code>. The order of the items in the map is irrelevant if you explicitly specify where each goes with a format string like;</p>\n\n<pre><code>fmt.Printf(\"red: %v, green: %v, blue: %v\\n\", ColorInstance[\"red\"], ColorInstance[\"green\"], ColorInstance[\"blue\"])\n</code></pre>\n\n<p>Now that only prints a single instance so to print the whole thing you'd need further logic but that's the basic idea.</p>\n\n<p>If you want things in order, a map is not the structure for you. If you want quick access based on a key, then a map is a good choice. If you just want to format your output for writing to console or a file or whatever, it can be done easily with a map but personally I think, JimB's suggestion is the best way to approach deserializing and processing data like that. My philosophy is to make the structures as concrete as possible. You get the work out of the way up front and have cleaner, more concise, better performing code there after.</p>\n"}], "owner": {"reputation": 3, "user_id": 4765088, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-SAodBQD6fOI/AAAAAAAAAAI/AAAAAAAAAJY/DIjzyh0r9pc/photo.jpg?sz=128", "display_name": "pvazquezdiaz", "link": "https://stackoverflow.com/users/4765088/pvazquezdiaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 33245547, "answer_count": 2, "score": -2, "last_activity_date": 1445371251, "creation_date": 1445370010, "question_id": 33245431, "link": "https://stackoverflow.com/questions/33245431/sorting-interface-in-go", "title": "Sorting interface in Go", "body": "<p>Been googling and stacking around for the solution with no success.</p>\n\n<p>I'm importing a JSON file to an struct, however, when I want to use it, the values come out in a random order. This is an example of my JSON file:  </p>\n\n<pre><code>\"Assets\": {\n    \"asset1\": \"asset1.png\",\n    \"asset2\": \"asset2.png\"\n  },\n  \"Colors\": {\n    \"MainColor\": [\n      {\n        \"red\": 247,\n        \"green\": 0,\n        \"blue\": 247\n      }\n    ],\n    \"MainGradient\": [\n      {\n        \"red\": 9,\n        \"green\": 103,\n        \"blue\": 170\n      },\n      {\n        \"red\": 18,\n        \"green\": 138,\n        \"blue\": 221\n      }\n    ]\n}\n</code></pre>\n\n<p>I can import the JSON using Unmarshal, however, when I print it, the \"red, green,blue\" values outputs in random order, like this:</p>\n\n<pre><code>[{map[asset1:asset1.png asset2:asset2.png] {[map[red:247 green:0 blue:247]] [map[green:103 red:9 blue:170] map[green:138 blue:221 red:18]]}}]\n</code></pre>\n\n<p>As you can see, the RGB values come at random order every time. I want to know if there's a way to always output the in the same order: red, green, blue.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["csv", "go", "transactions", "neo4j", "cypher"], "comments": [{"owner": {"reputation": 6843, "user_id": 2286415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tbRoS.png?s=128&g=1", "display_name": "logisima", "link": "https://stackoverflow.com/users/2286415/logisima"}, "edited": false, "score": 0, "creation_date": 1445371434, "post_id": 33244783, "comment_id": 54293898, "body": "Have you tried with a single instance of neo4j 2.3 ?  Do your http transactions requests are made on the same node ? Can you provide us your HAProxy conf ?"}, {"owner": {"reputation": 39550, "user_id": 728812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f522bc835d745f319a9567d63f5c0cc9?s=128&d=identicon&r=PG", "display_name": "Michael Hunger", "link": "https://stackoverflow.com/users/728812/michael-hunger"}, "edited": false, "score": 0, "creation_date": 1445379578, "post_id": 33244783, "comment_id": 54297939, "body": "Did you make sure that the requests are all routed to the same (master) service?"}, {"owner": {"reputation": 5087, "user_id": 2942471, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/100000008666513/picture?type=large", "display_name": "manonthemat", "link": "https://stackoverflow.com/users/2942471/manonthemat"}, "edited": false, "score": 0, "creation_date": 1445384131, "post_id": 33244783, "comment_id": 54299314, "body": "It all goes to the same instance. I replaced the haproxy ip/port with the master&#39;s instance and the result is exactly the same. I&#39;ve sent my haproxy configuration to neo4j support before to get some performance pointers on it, but no changes needed to be made to it."}, {"owner": {"reputation": 440, "user_id": 1183175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94bb8eea3e3eedec92408d81ec3a654a?s=128&d=identicon&r=PG", "display_name": "SwarmIntelligence", "link": "https://stackoverflow.com/users/1183175/swarmintelligence"}, "edited": false, "score": 0, "creation_date": 1447434788, "post_id": 33244783, "comment_id": 55168147, "body": "Having the same issue. Tested with a direct connection to the database instance but still no dice."}], "owner": {"reputation": 5087, "user_id": 2942471, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/100000008666513/picture?type=large", "display_name": "manonthemat", "link": "https://stackoverflow.com/users/2942471/manonthemat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 210, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1445367719, "creation_date": 1445367719, "question_id": 33244783, "link": "https://stackoverflow.com/questions/33244783/neo4j-cq-driver-failed-with-unrecognized-transaction-id-transaction-may-have-t", "title": "Neo4j cq driver failed with &quot;Unrecognized transaction id. Transaction may have timed out and been rolled back.&quot;", "body": "<p>I have recently moved our staging environment from a neo4j 2.2.2 community edition docker container to a 2.3.0-RC1 HA cluster.</p>\n\n<p>This go script provides an API end-point for authenticated users to upload a csv file which then gets processed in a way that it matches the id of a product (upc) with the existing product data. On a match the user's associated distributor creates a relationship to the found product and adds information available in the csv file onto that created relationship.</p>\n\n<p>My problem is that I'm getting a failure from Neo4j in the new environment that I can't track down: \"Unrecognized transaction id. Transaction may have timed out and been rolled back.\" when the user tries to upload the file.</p>\n\n<p>Here's the complete script (my second golang script, so pointers on style are welcome, too).</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"encoding/csv\"\n    \"fmt\"\n    _ \"gopkg.in/cq.v1\"\n    _ \"gopkg.in/cq.v1/types\"\n    \"net/http\"\n    \"os\"\n    \"strconv\"\n    \"strings\"\n)\n\ntype ProductInfo struct {\n    Upc       uint64\n    InStock   uint64\n    BasePrice float64\n    LeadMin   uint64\n    LeadMax   uint64\n    Sku       string\n}\n\nfunc uploadHandler(w http.ResponseWriter, r *http.Request) {\n    file, _, err := r.FormFile(\"file\")\n\n    if err != nil {\n        fmt.Fprintln(w, err)\n        return\n    }\n\n    defer file.Close()\n\n    distributor := strings.Split(r.URL.Path, \"/\")[2]\n\n    reader := csv.NewReader(file)\n    reader.FieldsPerRecord = 6\n    reader.TrimLeadingSpace = true\n\n    rawCSVdata, err := reader.ReadAll()\n\n    if err != nil {\n        fmt.Fprintln(w, err)\n        return\n    }\n\n    db, err := sql.Open(\"neo4j-cypher\", os.Getenv(\"MINAMI_NEO4J_URL\"))\n    if err != nil {\n        fmt.Fprintln(w, err)\n        return\n    }\n    defer db.Close()\n\n    tx, err := db.Begin()\n    if err != nil {\n        fmt.Fprintln(w, err)\n        return\n    }\n\n    stmt, err := tx.Prepare(`\n        MATCH (d:Distributor {slug:'` + distributor + `'})\n        MATCH (p:Product {upc: {0}})\n        MERGE (d)-[r:SELLS]-&gt;(p)\n        SET r.inStock = {1}, r.sellsFor = {2}, r.leadMin = {3}, r.leadMax = {4}, r.sku = {5}\n        RETURN p LIMIT 1\n    `)\n\n    if err != nil {\n        fmt.Fprintln(w, err)\n        return\n    }\n\n    var Row ProductInfo\n\n    for _, each := range rawCSVdata {\n        Row.Upc, _ = strconv.ParseUint(each[0], 10, 0)\n        Row.InStock, _ = strconv.ParseUint(each[1], 10, 0)\n        Row.BasePrice, _ = strconv.ParseFloat(each[2], 0)\n        Row.LeadMin, _ = strconv.ParseUint(each[3], 10, 0)\n        Row.LeadMax, _ = strconv.ParseUint(each[4], 10, 0)\n        Row.Sku = each[5]\n\n        stmt.Exec(Row.Upc, Row.InStock, Row.BasePrice, Row.LeadMin, Row.LeadMax, Row.Sku)\n    }\n\n    err = tx.Commit()\n    if err != nil {\n        fmt.Fprintln(w, err)\n        return\n    }\n\n    fmt.Fprintf(w, \"File uploaded and products in store updated.\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", uploadHandler)\n    http.ListenAndServe(\":8888\", nil)\n}\n</code></pre>\n\n<p>I'm using haproxy to know who's master and who are the slaves in the HA cluster. The environment variable MINAMI_NEO4J_URL is set to the master via haproxy in this form: http://{haproxyip}:{masterport}</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1445363998, "post_id": 33243532, "comment_id": 54289578, "body": "The <code>-o</code> flag isn&#39;t defined for <code>install</code> or <code>run</code>. What&#39;s the error in documentation?"}, {"owner": {"reputation": 449, "user_id": 1299930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67005382b9156d5db68cc3bc4d78ed4e?s=128&d=identicon&r=PG", "display_name": "theeddieh", "link": "https://stackoverflow.com/users/1299930/theeddieh"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 7, "creation_date": 1445364393, "post_id": 33243532, "comment_id": 54289779, "body": "<code>go help install</code> gives <code>usage: go install [build flags] [packages]</code> so it seems reasonable to assume that any flags defined for <code>go build</code> are accepted here."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 2, "creation_date": 1445364556, "post_id": 33243532, "comment_id": 54289877, "body": "<code>go build -h</code> lists <code>The build flags are shared by the build, clean, get, install, list, run, and test commands:</code> only after -o and -i are described. <code>-o</code> is not one of the shared build flags."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1445364572, "post_id": 33243532, "comment_id": 54289883, "body": "If you read the output of <code>go help build</code>: The build flags section starts with <code>The build flags are shared by the build, clean, get, install, list, run, and test commands:</code>, and <code>-o</code> is not listed there."}, {"owner": {"reputation": 449, "user_id": 1299930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67005382b9156d5db68cc3bc4d78ed4e?s=128&d=identicon&r=PG", "display_name": "theeddieh", "link": "https://stackoverflow.com/users/1299930/theeddieh"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1445365370, "post_id": 33243532, "comment_id": 54290339, "body": "@JimB That was my mistake. Next time, I&#39;ll RTFMC (the C is for closely)"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1445364122, "post_id": 33243591, "comment_id": 54289653, "body": "<code>go build</code> isn&#39;t the same, because it discards all compiled artifacts after the binary is built. It&#39;s usually recommended to favor <code>go install</code>."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1445364318, "post_id": 33243591, "comment_id": 54289744, "body": "@JimB <code>go build -i</code> will save dependency artifacts in the <code>pkg</code> folders."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1445364515, "post_id": 33243591, "comment_id": 54289857, "body": "ah yes, forgot about that."}, {"owner": {"reputation": 449, "user_id": 1299930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67005382b9156d5db68cc3bc4d78ed4e?s=128&d=identicon&r=PG", "display_name": "theeddieh", "link": "https://stackoverflow.com/users/1299930/theeddieh"}, "edited": false, "score": 2, "creation_date": 1445364813, "post_id": 33243591, "comment_id": 54290021, "body": "@captncraig Thanks, this works just fine. I reread <code>go help build</code> and realized that both the <code>-o</code> and <code>-i</code> flags are described above the line: <code>The build flags are shared by the build, clean, get, install, list, run, and test commands:  &lt;list of build flags&gt;</code> The wording was just vague enough that I didn&#39;t realize the preceeding flags were excluded."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 40, "last_activity_date": 1445363904, "creation_date": 1445363904, "answer_id": 33243591, "question_id": 33243532, "link": "https://stackoverflow.com/questions/33243532/go-install-does-not-recognize-o-flag/33243591#33243591", "title": "go install does not recognize &quot;-o&quot; flag", "body": "<p><code>go build</code> accepts the <code>-o</code> flag but <code>go install</code> does not. </p>\n\n<p><code>go install</code> will always output to <code>$GOPATH/bin</code></p>\n\n<p>If you want to install a custom binary name to your gopath you can do <code>go build -o $GOPATH/bin/whatever</code> and that will be roughly equivalent to <code>go install</code></p>\n"}, {"tags": [], "owner": {"reputation": 698, "user_id": 2656413, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74d01ca2fb0a9c99ee5a2981b3780bc8?s=128&d=identicon&r=PG", "display_name": "grandchild", "link": "https://stackoverflow.com/users/2656413/grandchild"}, "is_accepted": false, "score": 0, "last_activity_date": 1558456655, "creation_date": 1558456655, "answer_id": 56242811, "question_id": 33243532, "link": "https://stackoverflow.com/questions/33243532/go-install-does-not-recognize-o-flag/56242811#56242811", "title": "go install does not recognize &quot;-o&quot; flag", "body": "<p>You can fake the -o flag, if all you care about is the location, and not the name of the binary. Define <code>GOBIN</code> for the install command:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>GOBIN=`readlink -f my/location` go install some/persons/go-package\n</code></pre>\n\n<p><em>Caveat</em>: This doesn't work for cross-compiled binaries.</p>\n"}], "owner": {"reputation": 449, "user_id": 1299930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67005382b9156d5db68cc3bc4d78ed4e?s=128&d=identicon&r=PG", "display_name": "theeddieh", "link": "https://stackoverflow.com/users/1299930/theeddieh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12745, "favorite_count": 6, "accepted_answer_id": 33243591, "answer_count": 2, "score": 16, "last_activity_date": 1558456655, "creation_date": 1445363720, "question_id": 33243532, "link": "https://stackoverflow.com/questions/33243532/go-install-does-not-recognize-o-flag", "title": "go install does not recognize &quot;-o&quot; flag", "body": "<p>I'm trying to do a <code>go install</code> and rename the output with the <code>-o</code> flag. </p>\n\n<pre><code>go install -o bar.exe src/foo.go\n</code></pre>\n\n<p>But this fails with the error:</p>\n\n<pre><code>flag provided but not defined: -o\nusage: install [build flags] [packages]\n</code></pre>\n\n<p><code>go help build</code> shows <code>-o</code> as the correct build flag to rename the output binary. There is no mention that this flag is not defined for <code>go install</code>.</p>\n\n<p><code>go run -o bar.exe src/foo.go</code> fails with the same error.</p>\n\n<p><code>go build -o bar.exe src/foo.go</code> works. I get bar.exe.</p>\n\n<p>So is this just an error of documentation, or have I missed something?</p>\n\n<p>My version: <code>go1.5 windows/386</code>.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1445363680, "post_id": 33242850, "comment_id": 54289386, "body": "It&#39;s hard to use the wrong one, since it usually won&#39;t compile. Just try them out to get a feel for what they do: <a href=\"http://tour.golang.org/moretypes/1\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/1</a>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445365106, "post_id": 33242850, "comment_id": 54290188, "body": "I second that advice. I couldn&#39;t accurately state the rules for the two operators like what&#39;s in the spec to save my life but I make them work whenever I need to through trial and error. Most of the time it won&#39;t compile if it&#39;s wrong because you&#39;ll have incompatible types on either side of an assignment."}, {"owner": {"reputation": 21272, "user_id": 52277, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/67498fd0e17d27cb9be0c107f306e378?s=128&d=identicon&r=PG", "display_name": "Michael Freidgeim", "link": "https://stackoverflow.com/users/52277/michael-freidgeim"}, "edited": false, "score": 0, "creation_date": 1617341169, "post_id": 33242850, "comment_id": 118282373, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/3552626/what-does-the-asterisk-do-in-go\">What does the asterisk do in &quot;Go&quot;?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1445366382, "post_id": 33242962, "comment_id": 54290941, "body": "Terminological correction: the <code>&amp;</code> operation might take a value, not necessary a variable -- a good example is taking an address out of literal, like in <code>v := &amp;SomeType{}</code>; the <code>*</code> operator returns a value, not a variable. A variable is the name; you can use it in a context which requires a value to refer to that value, but the pointer-dereferencing operator returns a value, and that value may have no variable bound to it."}, {"owner": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1445379436, "post_id": 33242962, "comment_id": 54297888, "body": "@kostix: Good point, thanks; fixed. I&#39;m too used to the Java spec, where any lvalue is called a &quot;variable&quot;. :-P"}], "tags": [], "owner": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "is_accepted": false, "score": 7, "last_activity_date": 1445379395, "last_edit_date": 1445379395, "creation_date": 1445361822, "answer_id": 33242962, "question_id": 33242850, "link": "https://stackoverflow.com/questions/33242850/in-golang-what-is-the-difference-between-and/33242962#33242962", "title": "In golang, what is the difference between &amp; and *", "body": "<p>They are the opposite. As explained in <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"noreferrer\">the \"Address operators\" section of the spec</a>:</p>\n\n<blockquote>\n  <p>For an operand <code>x</code> of type <code>T</code>, the address operation <code>&amp;x</code> generates a pointer of type <code>*T</code> to <code>x</code>. [&hellip;]</p>\n  \n  <p>For an operand <code>x</code> of pointer type <code>*T</code>, the pointer indirection <code>*x</code> denotes the variable of type <code>T</code> pointed to by <code>x</code>. If <code>x</code> is <code>nil</code>, an attempt to evaluate <code>*x</code> will cause a run-time panic.</p>\n</blockquote>\n\n<p>In other words: <code>&amp;</code> takes a variable (or other addressable entity) and returns a pointer that points to it, whereas <code>*</code> takes a pointer and returns the thing that it points to (unless it's <code>nil</code>, meaning it doesn't point to anything).</p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 6, "last_activity_date": 1445362033, "creation_date": 1445362033, "answer_id": 33243031, "question_id": 33242850, "link": "https://stackoverflow.com/questions/33242850/in-golang-what-is-the-difference-between-and/33243031#33243031", "title": "In golang, what is the difference between &amp; and *", "body": "<p><code>&amp;</code> is the address of operator. <code>*</code> represent a pointer in some cases, in others it is used as the 'dereference operator'.</p>\n\n<p>So basically, if you do <code>p := &amp;SometType{}</code> the address of operator is used to return the address of the object created with the composite literal statement <code>SomeType{}</code> if I were to remove it, I would no longer have a reference and instead be assigning the value directly to <code>p</code>. In this case <code>p</code> will be a <code>*SomeType</code> because that is the types who's address I took. If I declare a type with <code>*</code> in front of it, I'm designating it as a pointer to that type.</p>\n\n<p>Now the last remaining use is as a the deference operator, you don't use this much in Go in my experience but it was super common in C and C++. This is used to return the actual value rather, it's most often leverage for assignment. Because like if I have <code>p</code> and it is a <code>*SomeType</code> and locally I want to assign to an instance of <code>SomeType</code> then I'll need the following statement <code>someType := *p</code> so that the value is assigned to my value type.</p>\n\n<p>Hope that explanation helps. It's not the most technical one, rather my goal is to provide understanding of the common uses.</p>\n"}, {"comments": [{"owner": {"reputation": 243, "user_id": 3959815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c2839dcc969efc86863db6d8fe1367?s=128&d=identicon&r=PG&f=1", "display_name": "tyonne", "link": "https://stackoverflow.com/users/3959815/tyonne"}, "edited": false, "score": 1, "creation_date": 1445821529, "post_id": 33249869, "comment_id": 54470565, "body": "In the context of &quot; func HandleFunc(pattern string, handler func(ResponseWriter, *Request)) &quot;, why does Request dereference a pointer whereas ResponseWriter doesn&#39;t?"}, {"owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "reply_to_user": {"reputation": 243, "user_id": 3959815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c2839dcc969efc86863db6d8fe1367?s=128&d=identicon&r=PG&f=1", "display_name": "tyonne", "link": "https://stackoverflow.com/users/3959815/tyonne"}, "edited": false, "score": 0, "creation_date": 1445822043, "post_id": 33249869, "comment_id": 54470686, "body": "That function signature usually looks like this <code>func(w http.ResponseWriter, r *http.Request)</code>, where <code>w</code> is <code>http.ResponseWriter</code> object and <code>r</code> is a pointer to <code>http.Request</code> object. There is no dereferencing in this case."}, {"owner": {"reputation": 309, "user_id": 5042376, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TmRyQ.png?s=128&g=1", "display_name": "Al Elizalde", "link": "https://stackoverflow.com/users/5042376/al-elizalde"}, "edited": false, "score": 0, "creation_date": 1597000567, "post_id": 33249869, "comment_id": 111985497, "body": "This is a good example, just use bPtr instead b_ptr as golang recommends avoid using &quot;_&quot; on variable declaration"}], "tags": [], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "is_accepted": true, "score": 39, "last_activity_date": 1445393896, "creation_date": 1445393896, "answer_id": 33249869, "question_id": 33242850, "link": "https://stackoverflow.com/questions/33242850/in-golang-what-is-the-difference-between-and/33249869#33249869", "title": "In golang, what is the difference between &amp; and *", "body": "<p>Here is a very simple example, that illustrates how <code>&amp;</code> and <code>*</code> are used. Note that <code>*</code> can be used for two different things 1) to declare a variable to be a pointer 2) to dereference a pointer. </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    b := 6 \n\n    var b_ptr *int // *int is used delcare variable\n                   // b_ptr to be a pointer to an int\n\n    b_ptr = &amp;b     // b_ptr is assigned value that is the address\n                       // of where variable b is stored\n\n    // Shorhand for the above two lines is:\n    // b_ptr := &amp;b\n\n    fmt.Printf(\"address of b_ptr: %p\\n\", b_ptr)\n\n    // We can use *b_ptr get the value that is stored\n    // at address b_ptr, or dereference the pointer \n    fmt.Printf(\"value stored at b_ptr: %d\\n\", *b_ptr)\n\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>address of b_ptr: 0xc82007c1f0\nvalue stored at b_ptr: 6\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 709, "user_id": 789096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e49d9e3fbc5927db7abee02cf9f9e22?s=128&d=identicon&r=PG", "display_name": "Rio", "link": "https://stackoverflow.com/users/789096/rio"}, "is_accepted": false, "score": -6, "last_activity_date": 1445408343, "creation_date": 1445408343, "answer_id": 33252253, "question_id": 33242850, "link": "https://stackoverflow.com/questions/33242850/in-golang-what-is-the-difference-between-and/33252253#33252253", "title": "In golang, what is the difference between &amp; and *", "body": "<p>&amp; and * is used mainly in functions:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Person struct {\n    name     string\n    ageYears int\n    areDays  int\n}\n\nfunc main() {\n    john := Person{name: \"John\", ageYears: 46}\n    toDays(&amp;john)\n    fmt.Println(john) //{John 46 16790}\n    toDays2(john)\n    fmt.Println(john) //{John 46 16790}\n}\n\nfunc toDays(p *Person) {\n    p.areDays = p.ageYears * 365\n}\n\nfunc toDays2(p Person) {\n    p.areDays = -1\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "is_accepted": false, "score": 5, "last_activity_date": 1445518540, "creation_date": 1445518540, "answer_id": 33281579, "question_id": 33242850, "link": "https://stackoverflow.com/questions/33242850/in-golang-what-is-the-difference-between-and/33281579#33281579", "title": "In golang, what is the difference between &amp; and *", "body": "<p><code>&amp;</code> makes a pointer from a variable.</p>\n\n<p><code>*</code> \"fetches\" the value stored where a pointer points to.</p>\n\n<p>For types, <code>var *type</code> means \"*var is of the type <em>type</em>\" (and without a variable, it simply means \"a pointer to something of <em>type</em>\".</p>\n"}, {"tags": [], "owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "is_accepted": false, "score": 15, "last_activity_date": 1526995700, "creation_date": 1526995700, "answer_id": 50468968, "question_id": 33242850, "link": "https://stackoverflow.com/questions/33242850/in-golang-what-is-the-difference-between-and/50468968#50468968", "title": "In golang, what is the difference between &amp; and *", "body": "<p>This helped me understand better, you can run the code in playground and play with it a bit to see how it behaves link here: <a href=\"https://play.golang.org/p/c7jxLJkdRDd\" rel=\"noreferrer\">https://play.golang.org/p/c7jxLJkdRDd</a> (if link is deactivet in the future just copy paste code below)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n    var a = 5\n    var p = &amp;a // copy by reference\n    var x = a  // copy by value\n\n    fmt.Println(\"a = \", a)   // a =  5\n    fmt.Println(\"p = \", p)   // p =  0x10414020\n    fmt.Println(\"*p = \", *p) // *p =  5\n    fmt.Println(\"&amp;p = \", &amp;p) // &amp;p =  0x1040c128\n    fmt.Println(\"x = \", x)   // x =  5\n\n    fmt.Println(\"\\n Change *p = 3\")\n    *p = 3\n    fmt.Println(\"a = \", a)   // a =  3\n    fmt.Println(\"p = \", p)   // p =  0x10414020\n    fmt.Println(\"*p = \", *p) // *p =  3\n    fmt.Println(\"&amp;p = \", &amp;p) // &amp;p =  0x1040c128\n    fmt.Println(\"x = \", x)   // x =  5\n\n    fmt.Println(\"\\n Change a = 888\")\n    a = 888\n    fmt.Println(\"a = \", a)   // a =  888\n    fmt.Println(\"p = \", p)   // p =  0x10414020\n    fmt.Println(\"*p = \", *p) // *p =  888\n    fmt.Println(\"&amp;p = \", &amp;p) // &amp;p =  0x1040c128\n    fmt.Println(\"x = \", x)   // x =  5\n\n    fmt.Println(\"\\n Change x = 1\")\n    x = 1\n    fmt.Println(\"a = \", a)   // a =  888\n    fmt.Println(\"p = \", p)   // p =  0x10414020\n    fmt.Println(\"*p = \", *p) // *p =  888\n    fmt.Println(\"&amp;p = \", &amp;p) // &amp;p =  0x1040c128\n    fmt.Println(\"x = \", x)   // x =  1\n\n    &amp;p = 3 // error: Cannot assign to &amp;p because this is the address of variable a\n}\n</code></pre>\n"}], "owner": {"reputation": 243, "user_id": 3959815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c2839dcc969efc86863db6d8fe1367?s=128&d=identicon&r=PG&f=1", "display_name": "tyonne", "link": "https://stackoverflow.com/users/3959815/tyonne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10709, "favorite_count": 5, "accepted_answer_id": 33249869, "answer_count": 6, "score": 21, "last_activity_date": 1526995700, "creation_date": 1445361455, "question_id": 33242850, "link": "https://stackoverflow.com/questions/33242850/in-golang-what-is-the-difference-between-and", "title": "In golang, what is the difference between &amp; and *", "body": "<p>Can someone explain the difference between &amp; and * in GO lang .. and provide examples of when &amp; and * would be used to illustrate the difference?\nFrom what I have read, they both relate to accessing a variables memory location however i'm not sure when to use &amp; or *.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1445371538, "post_id": 33242837, "comment_id": 54293940, "body": "That&#39;s not the best idea. A session roughly translates to a connection. So passing it around may well lead to an artificial bottleneck."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 1, "last_activity_date": 1445361428, "creation_date": 1445361428, "answer_id": 33242837, "question_id": 33241679, "link": "https://stackoverflow.com/questions/33241679/create-a-function-which-returns-a-mongo-collection-with-golang-and-mgo/33242837#33242837", "title": "Create a function which returns a mongo collection with Golang and MGO", "body": "<p>Why don't you have the session created in your <code>main</code> function, and pass it to the packages that need it.  This is obviously missing a ton of stuff but the general idea would be</p>\n\n<pre><code>package main\n//imports\nfunc main() {\n    session := *MongoConnection().CreateSession()\n    defer session.Close()\n    Card.SetSession(session)\n    //other stuff\n    log.Fatal(http.ListenAndServe(\":80\", nil))\n}\n</code></pre>\n\n<p>Then in Card</p>\n\n<pre><code>package Card\n\nvar session *mgo.Session\n\nfunc SetSession(s *mgo.Session) {\n    session = s\n}\n\nfunc (c *Card) Collection() *mgo.Collection {\n    return session.DB(db).C(cardsCollection)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 0, "last_activity_date": 1445372570, "creation_date": 1445372570, "answer_id": 33246146, "question_id": 33241679, "link": "https://stackoverflow.com/questions/33241679/create-a-function-which-returns-a-mongo-collection-with-golang-and-mgo/33246146#33246146", "title": "Create a function which returns a mongo collection with Golang and MGO", "body": "<p>What you are describing is a factory pattern. But there are caveats to deal with.\nDefer is local to scope it is called. So in case you would put the defer into a factory method, the session would be closed basically when it is returned.</p>\n\n<p>Simply defining just one session und reuse it all over the place is pretty much the same as using a single SQL database connection and not a pool - it scales horribly.</p>\n\n<p>Here is what I tend to do: I have my collections as global, and do the following at the beginning of my method</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>// Create a func-local session\nmyCollection := globalCollection.With( globalCollection.Database.Session.Copy() )\n// Close it on exiting the scope\ndefer myCollection.Database.Session.Close()\n</code></pre>\n\n<p>Of course, you could externalize the first line into a factory, but that would not really declutter the code or make it more readable.</p>\n"}], "owner": {"reputation": 2144, "user_id": 1143357, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8aebc0e3ebfeb4bebe9d20140d373a27?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/1143357/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1148, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1445372570, "creation_date": 1445357724, "question_id": 33241679, "link": "https://stackoverflow.com/questions/33241679/create-a-function-which-returns-a-mongo-collection-with-golang-and-mgo", "title": "Create a function which returns a mongo collection with Golang and MGO", "body": "<p>I'm new to GOLANG - I would like to reduce the complexity of the handlers in my GO API. I'm coming from a Node.js background!</p>\n\n<p>At the moment a route handler looks like this:</p>\n\n<pre><code>func getCards(c web.C, w http.ResponseWriter, r *http.Request) {\n\n    session := *MongoConnection().CreateSession()\n    defer session.Close()\n\n    collection := session.DB(db).C(cardsCollection)\n\n    result := []Card{}\n\n    err := collection.Find(bson.M{}).All(&amp;result)\n    if err != nil {\n        panic(err)\n    }\n\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    encoder := json.NewEncoder(w)\n    encoder.Encode(result)\n}\n</code></pre>\n\n<p>What I would like to do is return a collection for use without having to do this part:</p>\n\n<pre><code>session := *MongoConnection().CreateSession()\ndefer session.Close()\n\ncollection := session.DB(db).C(cardsCollection)\n</code></pre>\n\n<p>Instead I would like to do something like</p>\n\n<pre><code>collection := Card.Collection()\n</code></pre>\n\n<p>And have it create the session etc, Is this possible?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1445356652, "post_id": 33241042, "comment_id": 54285225, "body": "A write to a nil channel will block indefinitely. I learned something new today."}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 1, "last_activity_date": 1445356361, "creation_date": 1445356361, "answer_id": 33241226, "question_id": 33241042, "link": "https://stackoverflow.com/questions/33241042/go-channel-not-working/33241226#33241226", "title": "Go channel not working", "body": "<p>You forgot to initialise the channel. Here's how you do it:</p>\n\n<pre><code>var medium = make(chan int64)\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/fEMcHlnxdV\" rel=\"nofollow\">https://play.golang.org/p/fEMcHlnxdV</a>.</p>\n"}], "owner": {"reputation": 117, "user_id": 5467814, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/522f564d07b0b386f7c867a7df919a72?s=128&d=identicon&r=PG&f=1", "display_name": "Nitin", "link": "https://stackoverflow.com/users/5467814/nitin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 730, "favorite_count": 0, "closed_date": 1445356696, "accepted_answer_id": 33241226, "answer_count": 1, "score": 0, "last_activity_date": 1445356361, "creation_date": 1445355817, "question_id": 33241042, "link": "https://stackoverflow.com/questions/33241042/go-channel-not-working", "closed_reason": "Duplicate", "title": "Go channel not working", "body": "<p>I want to use a global channel to send and receive between two goroutines. What is wrong in this program</p>\n\n<p><a href=\"https://play.golang.org/p/Y_9-rw0JoV\" rel=\"nofollow\">https://play.golang.org/p/Y_9-rw0JoV</a></p>\n\n<p>The global chan <code>medium</code> is not receiving the data in <code>ProgB</code>.\nInfact in <code>ProgA</code> program stucks at <code>medium &lt;- a</code>.</p>\n"}, {"tags": ["java", "go", "interface", "type-narrowing"], "comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1598318811, "post_id": 33239864, "comment_id": 112413262, "body": "It may be worth noting that APIs that take in a one-method <code>interface</code> could be re-written as taking a function type. See <a href=\"https://stackoverflow.com/a/63557675/12817546\">stackoverflow.com/a/63557675/12817546</a>."}], "answers": [{"comments": [{"owner": {"reputation": 16400, "user_id": 350542, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/024d1da9fad214ca44af8fcc649ebb86?s=128&d=identicon&r=PG", "display_name": "jayunit100", "link": "https://stackoverflow.com/users/350542/jayunit100"}, "edited": false, "score": 0, "creation_date": 1445354431, "post_id": 33240037, "comment_id": 54283716, "body": "I guess we can use a dead-code-finder to find &quot;old interface impls&quot; which arent required anymore."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 0, "last_activity_date": 1445353009, "creation_date": 1445353009, "answer_id": 33240037, "question_id": 33239864, "link": "https://stackoverflow.com/questions/33239864/minimizing-interfaces-in-golang/33240037#33240037", "title": "Minimizing interfaces in Golang", "body": "<blockquote>\n  <p>Are there commonly used go tools which check for unused functions ?</p>\n</blockquote>\n\n<p>Sort of, but it is really hard to be sure for exported interfaces. <a href=\"https://golang.org/x/tools/cmd/oracle\" rel=\"nofollow\">oracle</a> can be used to find references to types or methods, but only if you have all of the code that references you availible on your gopath.</p>\n\n<blockquote>\n  <p>can you ensure a type implements a contract?</p>\n</blockquote>\n\n<p>If you attempt to use a type as an interface, the compiler will complain if it does not have all of the methods. I generally do this by exporting interfaces but not implementations, and making a constructor:</p>\n\n<pre><code>type MyInterface interface{\n    Foo()\n}\ntype impl struct{}\nfunc (i *impl) Foo(){}\nfunc NewImpl() MyInterface{\n    return &amp;impl{}\n}\n</code></pre>\n\n<p>This will not compile if impl does not implement all of the required functions.</p>\n\n<p>In go, it is not needed to declare that you implement an interface. This allows you to implement an interface without even referencing the package it is defined in. This is pretty much exactly the opposite of \"tightly binding to an interface specification\", but it does allow for some interesting usage patterns.</p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1445365690, "last_edit_date": 1495540718, "creation_date": 1445365690, "answer_id": 33244141, "question_id": 33239864, "link": "https://stackoverflow.com/questions/33239864/minimizing-interfaces-in-golang/33244141#33244141", "title": "Minimizing interfaces in Golang", "body": "<p>What your asking for isn't really a part of Go. There are no best practices for annotating that a function satisfies an interface. I would personally say the only clear best practice is to document which interfaces your types implement so that people can know. If you want to test explicitly (at compile time) if a type implements an interface you can do so using assignment, check out my answer here on the topic; <a href=\"https://stackoverflow.com/questions/29684609/how-to-check-if-an-object-has-a-particular-method/\">How to check if an object has a particular method?</a></p>\n\n<p>If you're just looking to take inventory of your code base to do some clean up I would recommend using that assignment method for all your types to generate compile time errors regarding what they don't implement, scale down the declarations until it compiles. In doing so you should become aware of the disparity between what might be implemented and what actually is.</p>\n\n<p>Go is also lacking in IDE options. As a result some of those friendly features like \"find all references\" aren't there. You can use text searching tricks to get around this, like searching <code>func TheName</code> to get only the declaration and <code>.TheName(</code> to get all invocations. I'm sure you'll get used to it pretty quickly if you continue to use this tooling.</p>\n"}], "owner": {"reputation": 16400, "user_id": 350542, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/024d1da9fad214ca44af8fcc649ebb86?s=128&d=identicon&r=PG", "display_name": "jayunit100", "link": "https://stackoverflow.com/users/350542/jayunit100"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 210, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1445365690, "creation_date": 1445352579, "question_id": 33239864, "link": "https://stackoverflow.com/questions/33239864/minimizing-interfaces-in-golang", "title": "Minimizing interfaces in Golang", "body": "<p>In golang, interfaces are extremely important for decoupling and composing code, and thus, an advanced go program might easily define 1000s of interfaces .</p>\n\n<p>How do we evolve these interfaces over time, to ensure that they remain minimal?   </p>\n\n<ul>\n<li><p>Are there commonly used go tools which check for unused functions ?  </p></li>\n<li><p>Are there best practices for annotating go functions with something similar to java's <code>@Override</code>, which ensures that a declared function is properly implementing a expected contract? </p></li>\n</ul>\n\n<p>Typically in the java language, it is easy to keep code tightly bound to an interface specification because the advanced tooling allows us to find and remove functions which aren't referenced at all (usually this is highlighted automatically for you in any common IDE).</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1445351894, "post_id": 33239552, "comment_id": 54281902, "body": "you need to show what  <code>errorEval</code> does"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1445352064, "post_id": 33239552, "comment_id": 54282026, "body": "<code>errorEval(w, json.NewEncoder(w...</code> is not checked. Possible that is writing headers, and you are continuing to do other things."}, {"owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "edited": false, "score": 2, "creation_date": 1445354819, "post_id": 33239552, "comment_id": 54283979, "body": "As a side note, I would say that generally, the response writing should be in the handler function which in this case is your <code>RootHandler</code>. Having <code>errorEval</code> makes it difficult to trace and isn&#39;t quite beneficial. You moved the conditional one layer down to check the error but you&#39;re returning a boolean to yet again use in another conditional."}], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 1, "last_activity_date": 1445352306, "creation_date": 1445352306, "answer_id": 33239759, "question_id": 33239552, "link": "https://stackoverflow.com/questions/33239552/submitting-data-from-front-end-to-back-end-in-go/33239759#33239759", "title": "Submitting data from front end to back end in Go", "body": "<p>It looks to me like <code>errorEval</code> likely writes the status code and maybe a body if an error is encountered. Most places you call it you check the return and return from your handler if it handles an error. </p>\n\n<p>In the case of <code>errorEval(w, json.NewEncoder(w).Encode(&amp;Bla{c, gk}), http.StatusInternalServerError)</code> you are not checking the return.</p>\n\n<p>My guess is, there is some json error and the handler is writing a 500 response, and you are continuing to do other things which in turn try to write additional responses. </p>\n"}], "owner": {"reputation": 1, "user_id": 5467573, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6b46b9d2e7969e6446e5efbabf6bff?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Titla", "link": "https://stackoverflow.com/users/5467573/mr-titla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1445352724, "creation_date": 1445351721, "last_edit_date": 1445352724, "question_id": 33239552, "link": "https://stackoverflow.com/questions/33239552/submitting-data-from-front-end-to-back-end-in-go", "title": "Submitting data from front end to back end in Go", "body": "<p>I have simple website. Go with JavaScript. Now I get this message  \"http: multiple response.WriteHeader calls\" and I know that a have another header open. But I don't know where and I'm struggling to find a solution. </p>\n\n<pre><code>func (t *Server) RootHandler(w http.ResponseWriter, r *http.Request) {\n    var c *entities.Korisnik\n    var k *entities.Kilometri\n    var a *entities.Auto\n\n    if c = t.authentication(w, r); c == nil {\n        return\n    }\n\n    gk, err := t.store.GetKilometri(c)\n\n    if errorEval(w, err, http.StatusInternalServerError) {\n        return\n    }\n    if err := r.ParseForm(); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    if r.FormValue(\"debug\") == \"true\" {\n        s, _ := json.MarshalIndent(&amp;Bla{c, gk}, \"\", \"    \")\n        w.Write(s)\n        return\n    } else {\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        errorEval(w, json.NewEncoder(w).Encode(&amp;Bla{c, gk}), http.StatusInternalServerError)\n\n    }\n\n    log.Println(\"0\")\n    if errorEval(w, json.NewDecoder(r.Body).Decode(&amp;Input{a, k}), http.StatusBadRequest) {\n        log.Println(\"1\")\n        return\n    }\n    err = t.store.NewKilometri(k, c, a)\n    log.Println(\"2\")\n    if errorEval(w, err, http.StatusInternalServerError) {\n        return\n\n    }\n}\n</code></pre>\n\n<p>I get this in my terminal</p>\n\n<pre><code>015/10/20 16:12:32 0\n2015/10/20 16:12:32 EOF\n2015/10/20 16:12:32 http: multiple response.WriteHeader calls\n2015/10/20 16:12:32 1\n2015/10/20 16:12:32 0\n2015/10/20 16:12:32 EOF\n2015/10/20 16:12:32 http: multiple response.WriteHeader calls\n2015/10/20 16:12:32 1\n\nfunc errorEval(w http.ResponseWriter, err error, status int) bool {\nif err == nil {\n    return false\n}\nlog.Println(err)\nhttp.Error(w, errorString[status], status)\nreturn true\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3197, "user_id": 3750381, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f3203f61c9d9e29b6ab0491c5727eec6?s=128&d=identicon&r=PG&f=1", "display_name": "Vasantha Ganesh", "link": "https://stackoverflow.com/users/3750381/vasantha-ganesh"}, "edited": false, "score": 0, "creation_date": 1597823314, "post_id": 33238518, "comment_id": 112255750, "body": "Its alright to put defer resp.Body.Close() after the err != nil when return is present because, when the err is not nil, it already comes closed. On the other hand the body needs to closed explicitly when the request succeeds."}], "answers": [{"comments": [{"owner": {"reputation": 85953, "user_id": 2635, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/503dc458e66746c5ac681e7057d209dd?s=128&d=identicon&r=PG", "display_name": "mmcdole", "link": "https://stackoverflow.com/users/2635/mmcdole"}, "edited": false, "score": 5, "creation_date": 1472517307, "post_id": 33238755, "comment_id": 65772686, "body": "According to this <a href=\"http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/index.html#close_http_resp_body\" rel=\"nofollow noreferrer\">link</a> it is still possible to leak the connection with your code.  There are some instances where the response is non-nil and the error is non-nil."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 85953, "user_id": 2635, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/503dc458e66746c5ac681e7057d209dd?s=128&d=identicon&r=PG", "display_name": "mmcdole", "link": "https://stackoverflow.com/users/2635/mmcdole"}, "edited": false, "score": 15, "creation_date": 1472520939, "post_id": 33238755, "comment_id": 65773466, "body": "@mmcdole: That post is just wrong, and there&#39;s no guarantee that it won&#39;t panic, since whatever response is returned on an error doesn&#39;t have a defined state. If a Body isn&#39;t closed on an error, then it&#39;s a bug and needs to be reported. You should go by the <a href=\"https://golang.org/pkg/net/http/#Client.Do\" rel=\"nofollow noreferrer\">official client documentation</a>, which states &quot;On error, any Response can be ignored&quot;, rather than a random blog post."}, {"owner": {"reputation": 85953, "user_id": 2635, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/503dc458e66746c5ac681e7057d209dd?s=128&d=identicon&r=PG", "display_name": "mmcdole", "link": "https://stackoverflow.com/users/2635/mmcdole"}, "edited": false, "score": 0, "creation_date": 1472522970, "post_id": 33238755, "comment_id": 65773882, "body": "Thanks for the clarification. I had a bug report logged against my go library that referenced that source and I hadn&#39;t vetted it.  Interestingly, it looks like there was a <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/AidX-vUBLI0\" rel=\"nofollow noreferrer\">discussion about this very source</a> on the golang mailing list.  It looks that the line you referenced in the docs was recently added in 1.6.2 -- so I assume that is where the confusion came in for the original blogger who wrote the post."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 85953, "user_id": 2635, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/503dc458e66746c5ac681e7057d209dd?s=128&d=identicon&r=PG", "display_name": "mmcdole", "link": "https://stackoverflow.com/users/2635/mmcdole"}, "edited": false, "score": 0, "creation_date": 1472523771, "post_id": 33238755, "comment_id": 65774053, "body": "@mmcdole, that particular line was added recently to try and make the issue as unambiguous as possible. It has always been documented as shown in the official examples."}, {"owner": {"reputation": 3311, "user_id": 61363, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30ed41f682f716613fe62a0831f522dd?s=128&d=identicon&r=PG", "display_name": "del-boy", "link": "https://stackoverflow.com/users/61363/del-boy"}, "edited": false, "score": 0, "creation_date": 1483922395, "post_id": 33238755, "comment_id": 70284238, "body": "@JimB What about draining body? Like io.Copy(ioutil.Discard, req.Body), in case when body is not read entirely (in case of faulty logic in http handler)? Would that be useful or just waste of CPU cycles? I was thinking of adding this to some middleware, since I do not see downside of doing it, but I am not sure if there is a benefit."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 3311, "user_id": 61363, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30ed41f682f716613fe62a0831f522dd?s=128&d=identicon&r=PG", "display_name": "del-boy", "link": "https://stackoverflow.com/users/61363/del-boy"}, "edited": false, "score": 2, "creation_date": 1483972010, "post_id": 33238755, "comment_id": 70305348, "body": "@del-boy: If you expect that client to make more requests, then you should try to read the body so the connection can be reused. If you don&#39;t need the connection, then don&#39;t bother reading the body. If you read the body, wrap it with <code>io.LimitReader</code>. I usually use a fairly small limit, since it&#39;s faster to make a new connection if the request is too big."}, {"owner": {"reputation": 1887, "user_id": 1597656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/22f0d3352b38fd97b8d86992c5dde179?s=128&d=identicon&r=PG", "display_name": "Yerken", "link": "https://stackoverflow.com/users/1597656/yerken"}, "edited": false, "score": 0, "creation_date": 1498410791, "post_id": 33238755, "comment_id": 76478304, "body": "@JimB do we need to close the response as well (aside from fully reading it) to make the connection reusable ?"}, {"owner": {"reputation": 1454, "user_id": 786418, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8b52ad7b6375c1bcfbde2e24bd7833e4?s=128&d=identicon&r=PG", "display_name": "lucaswxp", "link": "https://stackoverflow.com/users/786418/lucaswxp"}, "edited": false, "score": 0, "creation_date": 1505525414, "post_id": 33238755, "comment_id": 79462748, "body": "So, should I close the body if not nil, even if I got an error or not?!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1454, "user_id": 786418, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8b52ad7b6375c1bcfbde2e24bd7833e4?s=128&d=identicon&r=PG", "display_name": "lucaswxp", "link": "https://stackoverflow.com/users/786418/lucaswxp"}, "edited": false, "score": 0, "creation_date": 1505525683, "post_id": 33238755, "comment_id": 79462782, "body": "@lucaswxp: no. from the docs: <b><code>On error, any Response can be ignored</code></b>"}, {"owner": {"reputation": 372, "user_id": 1214879, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/HTNHK.jpg?s=128&g=1", "display_name": "j boschiero", "link": "https://stackoverflow.com/users/1214879/j-boschiero"}, "edited": false, "score": 1, "creation_date": 1510099140, "post_id": 33238755, "comment_id": 81288611, "body": "It&#39;s worth pointing out that doing <code>_, err := client.Do(req)</code> also results in the file descriptor staying open. So even if one does not care what the response is, it is still necessary to assign it to a variable and close the body."}, {"owner": {"reputation": 2088, "user_id": 3309046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ce388de97238b3147f3d4ba62b17cb?s=128&d=identicon&r=PG", "display_name": "nishanthshanmugham", "link": "https://stackoverflow.com/users/3309046/nishanthshanmugham"}, "edited": false, "score": 1, "creation_date": 1514771238, "post_id": 33238755, "comment_id": 83064816, "body": "For anyone interested, the full documentation is (emphasis added): &quot;On error, any Response can be ignored. A non-nil Response with a non-nil error only occurs when CheckRedirect fails, and <i>even then</i> the returned Response.Body is already closed.&quot;"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2088, "user_id": 3309046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ce388de97238b3147f3d4ba62b17cb?s=128&d=identicon&r=PG", "display_name": "nishanthshanmugham", "link": "https://stackoverflow.com/users/3309046/nishanthshanmugham"}, "edited": false, "score": 0, "creation_date": 1515020519, "post_id": 33238755, "comment_id": 83147727, "body": "@nishanths: you&#39;ve quoted verbatim the exact statement that&#39;s in the answer already. If the documentation changes (it hasn&#39;t yet), then feel free to edit the answer."}, {"owner": {"reputation": 2088, "user_id": 3309046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ce388de97238b3147f3d4ba62b17cb?s=128&d=identicon&r=PG", "display_name": "nishanthshanmugham", "link": "https://stackoverflow.com/users/3309046/nishanthshanmugham"}, "edited": false, "score": 0, "creation_date": 1515052693, "post_id": 33238755, "comment_id": 83156169, "body": "@JimB yeah, that was dumb; I didn&#39;t notice that part of the answer."}, {"owner": {"reputation": 6930, "user_id": 2309704, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/WfvDZ.jpg?s=128&g=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/2309704/siva"}, "edited": false, "score": 0, "creation_date": 1546927077, "post_id": 33238755, "comment_id": 95004777, "body": "Is there any static checker to detect this kind of <i>resource</i> leaks ?"}, {"owner": {"reputation": 8456, "user_id": 1879101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/knzYU.jpg?s=128&g=1", "display_name": "Vitaly Zdanevich", "link": "https://stackoverflow.com/users/1879101/vitaly-zdanevich"}, "edited": false, "score": 0, "creation_date": 1554911977, "post_id": 33238755, "comment_id": 97926987, "body": "I still do not understand. <code>file descriptor won&#39;t be freed</code> - what is that mean? This is about RAM? TCP connection reuse?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 8456, "user_id": 1879101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/knzYU.jpg?s=128&g=1", "display_name": "Vitaly Zdanevich", "link": "https://stackoverflow.com/users/1879101/vitaly-zdanevich"}, "edited": false, "score": 0, "creation_date": 1554913107, "post_id": 33238755, "comment_id": 97927585, "body": "@VitalyZdanevich: file descriptors are a finite resource, and you will run out if you don&#39;t close them (or run out of ports first if that is your lower limit). Yes, this also prevents the connection from being re-used (which I&#39;ll note more explicitly in the answer)"}, {"owner": {"reputation": 2259, "user_id": 2101525, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/04455ce77bcdb356791c40fa4de10cc4?s=128&d=identicon&r=PG", "display_name": "L.T", "link": "https://stackoverflow.com/users/2101525/l-t"}, "edited": false, "score": 0, "creation_date": 1583982787, "post_id": 33238755, "comment_id": 107297606, "body": "Will the response.Body auto close if error is timeout of read response body not dial timeout  ?"}, {"owner": {"reputation": 51, "user_id": 4841297, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ID3DartJQ90/AAAAAAAAAAI/AAAAAAAAADk/GKzd2xf86os/photo.jpg?sz=128", "display_name": "Michael Meepo", "link": "https://stackoverflow.com/users/4841297/michael-meepo"}, "edited": false, "score": 0, "creation_date": 1599820202, "post_id": 33238755, "comment_id": 112899457, "body": "<code>On error, any Response can be ignored. A non-nil Response with a non-nil error only occurs when CheckRedirect fails, and even then the returned Response.Body is already closed.</code> From golang http client document. <a href=\"https://golang.org/pkg/net/http/#Client.Do\" rel=\"nofollow noreferrer\">link</a>"}, {"owner": {"reputation": 3934, "user_id": 916440, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c3f3495133a7d9411b0b4c04189ecf91?s=128&d=identicon&r=PG", "display_name": "Kamil Dziedzic", "link": "https://stackoverflow.com/users/916440/kamil-dziedzic"}, "edited": false, "score": 0, "creation_date": 1603556930, "post_id": 33238755, "comment_id": 114077684, "body": "What always bothers me is lack of handling error from Close(). Even linter complains, yet there is no nice solution to check the error from Close(). I was always wondering when could call to Close fail here?"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 121, "last_activity_date": 1554913230, "last_edit_date": 1554913230, "creation_date": 1445349535, "answer_id": 33238755, "question_id": 33238518, "link": "https://stackoverflow.com/questions/33238518/what-could-happen-if-i-dont-close-response-body/33238755#33238755", "title": "What could happen if I don&#39;t close response.Body?", "body": "<blockquote>\n  <p>What happens in this case? will there be a memory leak? </p>\n</blockquote>\n\n<p>It's a resource leak. The connection won't be re-used, and can remain open in which case the file descriptor won't be freed.</p>\n\n<blockquote>\n  <p>Also is it safe to put in defer resp.Body.Close() immediately after getting the response object?</p>\n</blockquote>\n\n<p>No, follow the example provided in the documentation and close it immediately after checking the error. </p>\n\n<pre><code>client := http.DefaultClient\nresp, err := client.Do(req)\nif err != nil {\n    return nil, err\n}\ndefer resp.Body.Close()\n</code></pre>\n\n<p>From the <code>http.Client</code> documentation:</p>\n\n<blockquote>\n  <p>If the returned error is nil, the Response will contain a non-nil Body which the user is expected to close. If the Body is not both read to EOF and closed, the Client's underlying RoundTripper (typically Transport) may not be able to re-use a persistent TCP connection to the server for a subsequent \"keep-alive\" request.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1472848472, "post_id": 37572367, "comment_id": 65934655, "body": "This is incorrect, and there&#39;s no guarantee that resp.Body is nit nil when there&#39;s an error."}, {"owner": {"reputation": 39, "user_id": 5277749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6894801ba1e52a77fefb30e77cebf5ec?s=128&d=identicon&r=PG&f=1", "display_name": "candita", "link": "https://stackoverflow.com/users/5277749/candita"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1499436050, "post_id": 37572367, "comment_id": 76920324, "body": "Thanks @JimB.  The wording in the docs is &quot;On error, any Response can be ignored.&quot;  It would be more accurate to say &quot;On error, the response Body is always closed.&quot;"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1499437167, "post_id": 37572367, "comment_id": 76921133, "body": "No, because there usually isn&#39;t a response body to be closed. If you continue reading that paragraph in the docs - &quot;A non-nil Response with a non-nil error only occurs when CheckRedirect fails, and even then the returned Response.Body is already closed.&quot;"}], "tags": [], "owner": {"reputation": 39, "user_id": 5277749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6894801ba1e52a77fefb30e77cebf5ec?s=128&d=identicon&r=PG&f=1", "display_name": "candita", "link": "https://stackoverflow.com/users/5277749/candita"}, "is_accepted": false, "score": 1, "last_activity_date": 1464793956, "last_edit_date": 1464793956, "creation_date": 1464793338, "answer_id": 37572367, "question_id": 33238518, "link": "https://stackoverflow.com/questions/33238518/what-could-happen-if-i-dont-close-response-body/37572367#37572367", "title": "What could happen if I don&#39;t close response.Body?", "body": "<p>See <a href=\"https://golang.org/src/net/http/client.go\" rel=\"nofollow\">https://golang.org/src/net/http/client.go</a><br>\n\"When err is nil, resp always contains a non-nil resp.Body.\"</p>\n\n<p>but they do not say when err != nil, resp always is nil. They go on to say:<br>\n\"If resp.Body is not closed, the Client's underlying RoundTripper  (typically Transport) may not be able to re-use a persistent TCP connection to the server for a subsequent \"keep-alive\" request.\"  </p>\n\n<p>So I have typically solved the issue like this: </p>\n\n<pre><code>client := http.DefaultClient\nresp, err := client.Do(req)\nif resp != nil {\n   defer resp.Body.Close()\n}\nif err != nil {\n    return nil, err \n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 371, "user_id": 2505740, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/RUsyT.jpg?s=128&g=1", "display_name": "applewood", "link": "https://stackoverflow.com/users/2505740/applewood"}, "edited": false, "score": 4, "creation_date": 1532028314, "post_id": 41512208, "comment_id": 89831743, "body": "You should note that they should return within your error handling condition.  This is going to cause a panic if the user does not return in their error handling."}], "tags": [], "owner": {"reputation": 24361, "user_id": 629685, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cadce7a59af35a66f18b9aaddebfd50f?s=128&d=identicon&r=PG", "display_name": "I159", "link": "https://stackoverflow.com/users/629685/i159"}, "is_accepted": false, "score": 15, "last_activity_date": 1497547829, "last_edit_date": 1497547829, "creation_date": 1483728119, "answer_id": 41512208, "question_id": 33238518, "link": "https://stackoverflow.com/questions/33238518/what-could-happen-if-i-dont-close-response-body/41512208#41512208", "title": "What could happen if I don&#39;t close response.Body?", "body": "<p>If <code>Response.Body</code> won't be closed with <code>Close()</code> method than a resources associated with a fd won't be freed. This is a resource leak.</p>\n\n<h3>Closing <code>Response.Body</code></h3>\n\n<p>From <a href=\"https://golang.org/src/net/http/response.go\" rel=\"noreferrer\">response source</a>:</p>\n\n<blockquote>\n  <p>It is the caller's responsibility to close Body.</p>\n</blockquote>\n\n<p>So there is no finalizers bound to the object and it must be closed explicitly.</p>\n\n<h3>Error handling and deferred cleanups</h3>\n\n<blockquote>\n  <p>On error, any Response can be ignored. A non-nil Response with a non-nil error only occurs when CheckRedirect fails, and even then the returned Response.Body is already closed.</p>\n</blockquote>\n\n<pre><code>resp, err := http.Get(\"http://example.com/\")\nif err != nil {\n    // Handle error if error is non-nil\n}\ndefer resp.Body.Close() // Close body only if response non-nil\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 7703678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f9a89e6d0bdb07cb94fea26c2031afb?s=128&d=identicon&r=PG&f=1", "display_name": "zatrix", "link": "https://stackoverflow.com/users/7703678/zatrix"}, "is_accepted": false, "score": 5, "last_activity_date": 1503575540, "last_edit_date": 1503575540, "creation_date": 1503574061, "answer_id": 45860425, "question_id": 33238518, "link": "https://stackoverflow.com/questions/33238518/what-could-happen-if-i-dont-close-response-body/45860425#45860425", "title": "What could happen if I don&#39;t close response.Body?", "body": "<p>At first the descriptor never closes, as things mentioned above.</p>\n\n<p>And what's more, golang will cache the connection (using <code>persistConn</code> struct to wrap) for reusing it, if <code>DisableKeepAlives</code> is false.</p>\n\n<p>In golang after use <code>client.Do</code> method, go will run goroutine <code>readLoop</code> method as one of the step.</p>\n\n<p>So in golang http <code>transport.go</code>, a <code>pconn(persistConn struct)</code> won't be put into <code>idleConn</code> channel until the req canceled in the <code>readLoop</code> method, and also this goroutine(<code>readLoop</code> method) will be blocked until the req canceled.</p>\n\n<p><a href=\"https://github.com/golang/go/blob/release-branch.go1.8/src/net/http/transport.go#L1599\" rel=\"noreferrer\">Here is the code</a> showing it.</p>\n\n<p>If you want to know more, you need to see the <code>readLoop</code> method.</p>\n"}], "owner": {"reputation": 10946, "user_id": 1259261, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a105607c3fd93df0d386c6d6a6b4aad?s=128&d=identicon&r=PG", "display_name": "Daniel Robinson", "link": "https://stackoverflow.com/users/1259261/daniel-robinson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52877, "favorite_count": 24, "accepted_answer_id": 33238755, "answer_count": 4, "score": 109, "last_activity_date": 1595621696, "creation_date": 1445348981, "last_edit_date": 1585577915, "question_id": 33238518, "link": "https://stackoverflow.com/questions/33238518/what-could-happen-if-i-dont-close-response-body", "title": "What could happen if I don&#39;t close response.Body?", "body": "<p>In Go, I have some http responses and I sometimes forget to call: </p>\n\n<pre><code>resp.Body.Close()\n</code></pre>\n\n<p>What happens in this case? will there be a memory leak? Also is it safe to put in <code>defer resp.Body.Close()</code> immediately after getting the response object?</p>\n\n<pre><code>client := http.DefaultClient\nresp, err := client.Do(req)\ndefer resp.Body.Close()\nif err != nil {\n    return nil, err\n}\n</code></pre>\n\n<p>What if there is an error, could <code>resp</code> or <code>resp.Body</code> be nil? </p>\n"}, {"tags": ["go", "command-line-interface"], "answers": [{"comments": [{"owner": {"reputation": 3391, "user_id": 4470201, "user_type": "registered", "accept_rate": 66, "profile_image": "https://graph.facebook.com/558270100/picture?type=large", "display_name": "Shikloshi", "link": "https://stackoverflow.com/users/4470201/shikloshi"}, "edited": false, "score": 0, "creation_date": 1445345762, "post_id": 33237188, "comment_id": 54277256, "body": "Thanks, couldn&#39;t find this question I guess because of poor title (:"}, {"owner": {"reputation": 1151, "user_id": 2241348, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb155ddab6564900c4c5f35923723ff4?s=128&d=identicon&r=PG", "display_name": "abalos", "link": "https://stackoverflow.com/users/2241348/abalos"}, "reply_to_user": {"reputation": 3391, "user_id": 4470201, "user_type": "registered", "accept_rate": 66, "profile_image": "https://graph.facebook.com/558270100/picture?type=large", "display_name": "Shikloshi", "link": "https://stackoverflow.com/users/4470201/shikloshi"}, "edited": false, "score": 2, "creation_date": 1445345814, "post_id": 33237188, "comment_id": 54277310, "body": "It happens. Not a problem. Glad I could help! :)"}], "tags": [], "owner": {"reputation": 1151, "user_id": 2241348, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb155ddab6564900c4c5f35923723ff4?s=128&d=identicon&r=PG", "display_name": "abalos", "link": "https://stackoverflow.com/users/2241348/abalos"}, "is_accepted": false, "score": 0, "last_activity_date": 1445345765, "last_edit_date": 1495535232, "creation_date": 1445345498, "answer_id": 33237188, "question_id": 33237126, "link": "https://stackoverflow.com/questions/33237126/writing-a-cli-how-to-avoid-showing-the-typed-password-on-screen/33237188#33237188", "title": "Writing a CLI: How to avoid showing the typed password on screen", "body": "<p>Type this stuff into Google before you come here.</p>\n\n<blockquote>\n  <p>you can do this by execing <code>stty -echo</code> to turn off echo and then \n  <code>stty echo</code> after reading in the password to turn it back on</p>\n</blockquote>\n\n<p>OR</p>\n\n<blockquote>\n  <p>Just saw a mail in #go-nuts maillist. There is someone who wrote quite\n  a simple go package to be used. You can find it here:\n  <a href=\"https://github.com/howeyc/gopass\" rel=\"nofollow noreferrer\">https://github.com/howeyc/gopass</a></p>\n  \n  <p>It something like that:</p>\n\n<pre><code>package main\n\nimport \"fmt\" import \"github.com/howeyc/gopass\"\n\nfunc main() {\n    fmt.Printf(\"Password: \")\n    pass := gopass.GetPasswd()\n    // Do something with pass }\n</code></pre>\n</blockquote>\n\n<p><a href=\"https://stackoverflow.com/questions/2137357/getpasswd-functionality-in-go\">Taken from another Stackoverflow post.</a></p>\n"}], "owner": {"reputation": 3391, "user_id": 4470201, "user_type": "registered", "accept_rate": 66, "profile_image": "https://graph.facebook.com/558270100/picture?type=large", "display_name": "Shikloshi", "link": "https://stackoverflow.com/users/4470201/shikloshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "closed_date": 1445345738, "answer_count": 1, "score": 0, "last_activity_date": 1445345765, "creation_date": 1445345334, "question_id": 33237126, "link": "https://stackoverflow.com/questions/33237126/writing-a-cli-how-to-avoid-showing-the-typed-password-on-screen", "closed_reason": "Duplicate", "title": "Writing a CLI: How to avoid showing the typed password on screen", "body": "<p>I'm writing a command line tool with Go and one of the command will query the user for its username and password (and save it to a config file inside the home directory). </p>\n\n<p>For now I couldn't realize how to replace the typed password to '*' or even not to type anything as a lot of command line tools are doing.</p>\n\n<p>How does can this be done when using golang?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1445343480, "post_id": 33236040, "comment_id": 54275735, "body": "Implement the Marshaler interface (<a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Marshaler</a>) for your struct and you can marshal either <code>v</code> or <code>value</code> as you see fit."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 3, "creation_date": 1445344268, "post_id": 33236040, "comment_id": 54276250, "body": "If you&#39;re using REST, you really ought to encode versions in your REST URLs, not in the data you shovel around. That is, all the API URLs containing, say, <code>&#47;v1&#47;</code> as a component in their path parts must return and consume JSON which is formatted according to the &quot;v1&quot; rules, forever. If you need to change the data formats, introduce &quot;v2&quot;, provide a new API endpoint implementing the new rules and gradually transition your clients. After transition, the &quot;v1&quot; endpoint becomes obsolete and may be removed safely."}, {"owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "edited": false, "score": 0, "creation_date": 1445516498, "post_id": 33236040, "comment_id": 54362147, "body": "Thanks. Here, we are not using the REST API. In this case, we are collecting data from different clients automatically using a javascript script. Technically we could also introduce REST method here, but we are not doing it now. We will consider it in the future. Thanks for the tip."}], "answers": [{"comments": [{"owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "edited": false, "score": 0, "creation_date": 1445516406, "post_id": 33237125, "comment_id": 54362092, "body": "Thanks @Ainar-G. I took your approach in inserting into the same structure, and then just copying it, into the new variable if version is lower."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 1, "last_activity_date": 1445346275, "last_edit_date": 1445346275, "creation_date": 1445345331, "answer_id": 33237125, "question_id": 33236040, "link": "https://stackoverflow.com/questions/33236040/renamed-json-field/33237125#33237125", "title": "Renamed JSON field", "body": "<p><strong>EDIT:</strong> You can actually do it with one unmarshaling, albeit you'll need another type:</p>\n\n<pre><code>type Second struct {\n    Version int `json:\"version\"`\n    Value   int `json:\"v\"`\n}\n\ntype SecondWithOldValue struct {\n    OldValue int `json:\"value\"`\n    Second\n}\n\ntype MyStruct SecondWithOldValue\n\nfunc (v *MyStruct) UnmarshalJSON(b []byte) error {\n    if err := json.Unmarshal(b, (*SecondWithOldValue)(v)); err != nil {\n        return err\n    }\n\n    if v.Version &lt;= 1 {\n        v.Value = v.OldValue\n    }\n    return nil\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/yII-ncxnU4\" rel=\"nofollow\">https://play.golang.org/p/yII-ncxnU4</a>.</p>\n\n<p>Old answer below.</p>\n\n<hr>\n\n<p>If you're OK with double unmarshaling, you can do it like this:</p>\n\n<pre><code>type Second struct {\n    Version int `json:\"version\"`\n    Value   int `json:\"v\"`\n}\n\ntype MyStruct struct {\n    Second\n}\n\nfunc (v *MyStruct) UnmarshalJSON(b []byte) error {\n    if err := json.Unmarshal(b, &amp;v.Second); err != nil {\n        return err\n    }\n\n    if v.Version &lt;= 1 {\n        var oldV struct{ Value int }\n        if err := json.Unmarshal(b, &amp;oldV); err != nil {\n            return err\n        }\n        v.Value = oldV.Value\n    }\n    return nil\n}\n</code></pre>\n\n<p>First, unmarshal into the inner struct, check version, and if it's an old one, get the old value.</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/AaULW6vJz_\" rel=\"nofollow\">https://play.golang.org/p/AaULW6vJz_</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "edited": false, "score": 0, "creation_date": 1445516474, "post_id": 33237206, "comment_id": 54362129, "body": "Thanks. Here, we are not using the REST API. For REST, we use different version. However, in this case, we are collecting data from different clients automatically using js. Technically we could also introduce REST method here, but we are not doing it now. We will consider it in the future. Thanks for the tip."}], "tags": [], "owner": {"reputation": 399, "user_id": 532670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ff0448f388ac08eac5f4cf78fb03c06?s=128&d=identicon&r=PG", "display_name": "AkiAki007", "link": "https://stackoverflow.com/users/532670/akiaki007"}, "is_accepted": false, "score": 0, "last_activity_date": 1445345563, "creation_date": 1445345563, "answer_id": 33237206, "question_id": 33236040, "link": "https://stackoverflow.com/questions/33236040/renamed-json-field/33237206#33237206", "title": "Renamed JSON field", "body": "<p>I would opt to not use 3 different struct here as they are all the same really.</p>\n\n<p>Modify your struct MyStruct as you have and load the <code>json:\"value\"</code> into a new variable as you are and part of your Unmarshal should copy the value into the Value variable if Value is not present.</p>\n\n<p>However I would second Kostix's recommendation here. Your API or process that loads and saves data should try to account for versioning by the mechanism suggested. Add a v# to your URI or if you're saving the item down to disk, then perhaps save it with a version number as such and then process the inner section per struct that corresponds to the proper version:</p>\n\n<pre><code>{\n    \"version\": 1,\n    \"struct\": { ... }\n}\n</code></pre>\n"}], "owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2294, "favorite_count": 0, "accepted_answer_id": 33237125, "answer_count": 2, "score": 3, "last_activity_date": 1445346275, "creation_date": 1445342245, "question_id": 33236040, "link": "https://stackoverflow.com/questions/33236040/renamed-json-field", "title": "Renamed JSON field", "body": "<p>We want to rename a JSON field <code>value</code> to <code>v</code> in production. Till all our users use the new struct, we would continue to get old JSON structs into our code. So we want to handle this as well.</p>\n\n<p>If you notice, <code>First</code> is the original structure, <code>Second</code> is the new structure. To handle both these structures, I have created a <code>MyStruct</code> and based on <code>version</code>, I copy the <code>OldValue</code> into <code>Value</code></p>\n\n<pre><code>if m.Version &lt;= 1 {\n    m.Value = m.OldValue\n}\n</code></pre>\n\n<p>Is there a better way to handle this, instead of my code.</p>\n\n<p><a href=\"https://play.golang.org/p/igArKQwEJQ\" rel=\"nofollow\">Go Playground Link</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"encoding/json\"\nimport \"log\"\n\ntype First struct {\n    Version int `json:\"version\"`\n    Value   int `json:\"value\"`\n}\n\ntype Second struct {\n    Version int `json:\"version\"`\n    Value   int `json:\"v\"`\n}\n\ntype MyStruct struct {\n    Version  int `json:\"version\"`\n    OldValue int `json:\"value\"`\n    Value    int `json:\"v\"`\n}\n\nfunc main() {\n    oldValue := []byte(`{\"version\":1, \"value\":5}`)\n    newValue := []byte(`{\"version\":2, \"v\":7}`)\n\n    var m MyStruct\n\n    err := json.Unmarshal(newValue, &amp;m)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"New Struct\")\n    fmt.Println(m.Value)\n\n    err = json.Unmarshal(oldValue, &amp;m)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"Old Struct\")\n    if m.Version &lt;= 1 {\n        m.Value = m.OldValue\n    }\n    fmt.Println(m.Value)\n\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "channel-api"], "comments": [{"owner": {"reputation": 1344, "user_id": 1549523, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7d2fc76dcb19f2699da1d8b42e0893cc?s=128&d=identicon&r=PG&f=1", "display_name": "Ani", "link": "https://stackoverflow.com/users/1549523/ani"}, "edited": false, "score": 1, "creation_date": 1445355909, "post_id": 33235817, "comment_id": 54284736, "body": "I don&#39;t understand what you try to achieve here (not familiar with Go) or why your main handler for &quot;/&quot; is called by POST requests to /_ah/channel/* routes. The disconnects typically originates from the client switching to a different page or doing a page refresh. In other words, if the page loads, the client will call /_ah/channel/connect, if the page is &quot;closed&quot;, the client will call /_ah/channel/disconnect. Typically you would add a connect handler and a disconnect handler to your app, different from your handlerMain for &quot;/&quot;."}, {"owner": {"reputation": 273, "user_id": 5250918, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a241b785773d58ae2cd8be649f9b97a?s=128&d=identicon&r=PG&f=1", "display_name": "Kaign", "link": "https://stackoverflow.com/users/5250918/kaign"}, "reply_to_user": {"reputation": 1344, "user_id": 1549523, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7d2fc76dcb19f2699da1d8b42e0893cc?s=128&d=identicon&r=PG&f=1", "display_name": "Ani", "link": "https://stackoverflow.com/users/1549523/ani"}, "edited": false, "score": 0, "creation_date": 1445362386, "post_id": 33235817, "comment_id": 54288643, "body": "@Ani, That is the case, I should recieve requests to */connect and /disconnect only ins situations which you have mentioned. In this example,  I open channel succesfully and recieve one POST  /_ah/channel/connect. So everything is fine for now. But then, after some time,(I do nothing with webpage, just stare at it) connects and disconnects start to follow each after another, as described above. It looks like Channel have some kind of timeout."}, {"owner": {"reputation": 273, "user_id": 5250918, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a241b785773d58ae2cd8be649f9b97a?s=128&d=identicon&r=PG&f=1", "display_name": "Kaign", "link": "https://stackoverflow.com/users/5250918/kaign"}, "reply_to_user": {"reputation": 1344, "user_id": 1549523, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7d2fc76dcb19f2699da1d8b42e0893cc?s=128&d=identicon&r=PG&f=1", "display_name": "Ani", "link": "https://stackoverflow.com/users/1549523/ani"}, "edited": false, "score": 0, "creation_date": 1445362612, "post_id": 33235817, "comment_id": 54288768, "body": "And yes, handlerMain should be executed only after page reload, so this is another problem"}, {"owner": {"reputation": 1344, "user_id": 1549523, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7d2fc76dcb19f2699da1d8b42e0893cc?s=128&d=identicon&r=PG&f=1", "display_name": "Ani", "link": "https://stackoverflow.com/users/1549523/ani"}, "edited": false, "score": 0, "creation_date": 1445374052, "post_id": 33235817, "comment_id": 54295206, "body": "@Kain I have checked my logs, I don&#39;t see random disconnects and Channel API works fine for push notifications in my apps (Python) . Maybe something in your client code makes the browser send the POST disconnect request? Have you looked into your browser&#39;s developer tools / console?"}, {"owner": {"reputation": 273, "user_id": 5250918, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a241b785773d58ae2cd8be649f9b97a?s=128&d=identicon&r=PG&f=1", "display_name": "Kaign", "link": "https://stackoverflow.com/users/5250918/kaign"}, "reply_to_user": {"reputation": 1344, "user_id": 1549523, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7d2fc76dcb19f2699da1d8b42e0893cc?s=128&d=identicon&r=PG&f=1", "display_name": "Ani", "link": "https://stackoverflow.com/users/1549523/ani"}, "edited": false, "score": 0, "creation_date": 1445421831, "post_id": 33235817, "comment_id": 54314007, "body": "@Ani please, look at the edited post. I have figured out that reconnects happens only when localhost tab in browser is inactive."}, {"owner": {"reputation": 1344, "user_id": 1549523, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7d2fc76dcb19f2699da1d8b42e0893cc?s=128&d=identicon&r=PG&f=1", "display_name": "Ani", "link": "https://stackoverflow.com/users/1549523/ani"}, "edited": false, "score": 0, "creation_date": 1445423362, "post_id": 33235817, "comment_id": 54314958, "body": "I didn&#39;t know you are running on local dev server. This might be a behavior that only happens with localhost, maybe because of security issues (same origin policy). If so, this SO question might help: <a href=\"http://stackoverflow.com/questions/13260620/google-app-engine-channel-api-javascript-location\" title=\"google app engine channel api javascript location\">stackoverflow.com/questions/13260620/&hellip;</a>  Try to deploy your app into test production environment and see if the behavior still persists."}], "answers": [{"tags": [], "owner": {"reputation": 273, "user_id": 5250918, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a241b785773d58ae2cd8be649f9b97a?s=128&d=identicon&r=PG&f=1", "display_name": "Kaign", "link": "https://stackoverflow.com/users/5250918/kaign"}, "is_accepted": true, "score": 0, "last_activity_date": 1446145317, "creation_date": 1446145317, "answer_id": 33422548, "question_id": 33235817, "link": "https://stackoverflow.com/questions/33235817/channel-api-persistent-disconnections-and-connections/33422548#33422548", "title": "Channel api: persistent disconnections and connections", "body": "<p>Channels connection/disconnections appears only on my macbook, not on the PC. Looks like it have something to do with app-engine development server, here more details: <a href=\"https://groups.google.com/forum/#!topic/google-appengine-go/dLe2UvzUgdA\" rel=\"nofollow\">https://groups.google.com/forum/#!topic/google-appengine-go/dLe2UvzUgdA</a>   </p>\n"}], "owner": {"reputation": 273, "user_id": 5250918, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a241b785773d58ae2cd8be649f9b97a?s=128&d=identicon&r=PG&f=1", "display_name": "Kaign", "link": "https://stackoverflow.com/users/5250918/kaign"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 33422548, "answer_count": 1, "score": 1, "last_activity_date": 1446145317, "creation_date": 1445341608, "last_edit_date": 1445421649, "question_id": 33235817, "link": "https://stackoverflow.com/questions/33235817/channel-api-persistent-disconnections-and-connections", "title": "Channel api: persistent disconnections and connections", "body": "<p>I am using Channel API, and after about 1 minute after channel's opening in terminal I see</p>\n\n<pre><code>INFO     2015-10-20 11:18:08,489 module.py:786] default: \"POST /_ah/channel/disconnected/ HTTP/1.1\" 200 2278\n2015/10/20 11:18:10 handlerMain executed\nINFO     2015-10-20 11:18:10,482 module.py:786] default: \"POST /_ah/channel/connected/ HTTP/1.1\" 200 2279\n2015/10/20 11:18:13 handlerMain executed\nINFO     2015-10-20 11:18:13,486 module.py:786] default: \"POST /_ah/channel/disconnected/ HTTP/1.1\" 200 2279\n2015/10/20 11:18:14 handlerMain executed\nINFO     2015-10-20 11:18:14,482 module.py:786] default: \"POST /_ah/channel/connected/ HTTP/1.1\" 200 2279\n</code></pre>\n\n<p>and so on..</p>\n\n<p>my .go file</p>\n\n<pre><code>func init() {\n    http.HandleFunc(\"/\", handlerMain)\n}\nfunc handlerMain(w http.ResponseWriter, r *http.Request) {\n            log.Println(\"handlerMain executed\")\n\n            c := appengine.NewContext(r)\n            tok, err := channel.Create(c, \"123\")\n            if err != nil {\n                    panic(err)\n            }   \n            templ := template.Must(template.ParseFiles(\"./templates/posts.html\"))\n            err = templ.Execute(w, map[string]string{\n                    \"token\": tok,\n            })  \n            if err != nil {\n                    panic(err)\n            }   \n }\n</code></pre>\n\n<p>javascript from my .html file</p>\n\n<pre><code>  &lt;script&gt;\n    channel = new goog.appengine.Channel('{{.token}}');\n    socket = channel.open();\n    socket.onopen = onOpened;\n    socket.onmessage = onMessage;\n    socket.onerror = onError;\n    socket.onclose = onClose;\n  &lt;/script&gt;\n</code></pre>\n\n<p>If it where just simple  notifications, I could have handle it, but this disconnections reexecutes my handlerMain() function, and in this function I want to start goroutine which will send messages to client, in this case I will have multiple repetitions of messages in my html page.</p>\n\n<p>Any thoughts?\nIs there alternative for Channel API? I know that websockets unfortunately doesn't work with GAE</p>\n\n<p>UPDATE:\nIn browser I see GET XMLHttpRequests are sent every second to the </p>\n\n<pre><code>http://localhost:8080/_ah/channel/dev?command=poll&amp;channel=237c7242478266a2856d947decce4b55-channel-2105948409-1445426965-123&amp;client=1\n</code></pre>\n\n<p>with header Connection : \"keep alive\";</p>\n\n<p>When I switch browser to another tab, after a few seconds these requests are stopped(or very much slowed down), and I start recieve this connection/disconnection notifications. If i jump back to the page, requests are sent again every second, and no notifications.</p>\n"}, {"tags": ["go", "controller", "beego"], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 4830638, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-apztjpp44PA/AAAAAAAAAAI/AAAAAAAAALA/3eK8Lrmn2a4/photo.jpg?sz=128", "display_name": "kwtucker", "link": "https://stackoverflow.com/users/4830638/kwtucker"}, "is_accepted": true, "score": 0, "last_activity_date": 1467035479, "creation_date": 1467035479, "answer_id": 38055754, "question_id": 33235643, "link": "https://stackoverflow.com/questions/33235643/can-i-call-a-controller-directly-from-main-without-router-in-beego/38055754#38055754", "title": "can i call a controller directly from main without router in beego", "body": "<p>This is an example I found using Beego Framework. Hope this helps.</p>\n\n<p><a href=\"https://github.com/ikeikeikeike/beego-samples/blob/master/auth/routers/router.go\" rel=\"nofollow\">Link to example Code</a></p>\n\n<pre><code>package routers\n\nimport (\n    \"github.com/astaxie/beego\"\n    ctl \"github.com/ikeikeikeike/beego-samples/auth/controllers\"\n)\n\nfunc init() {\n    beego.Router(\"/\", &amp;ctl.UsersController{}, \"get:Index\")\n    beego.Router(\"/login\", &amp;ctl.LoginController{}, \"get,post:Login\")\n    beego.Router(\"/logout\", &amp;ctl.LoginController{}, \"get:Logout\")\n    beego.Router(\"/signup\", &amp;ctl.LoginController{}, \"get,post:Signup\")\n}\n</code></pre>\n"}], "owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 0, "accepted_answer_id": 38055754, "answer_count": 1, "score": 0, "last_activity_date": 1467035479, "creation_date": 1445341158, "question_id": 33235643, "link": "https://stackoverflow.com/questions/33235643/can-i-call-a-controller-directly-from-main-without-router-in-beego", "title": "can i call a controller directly from main without router in beego", "body": "<p>I have a controller say XXController from package xx. Now i want this controller to be called as an function like xx.XXController{}. And the login inside controller should get executed.</p>\n"}, {"tags": ["json", "http", "go", "postman", "gorilla"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1445337552, "post_id": 33233942, "comment_id": 54271832, "body": "You should print <code>t</code> not <code>req.Body</code>. And <b>please</b>: Handle each and every error."}, {"owner": {"reputation": 21, "user_id": 5464560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05ff45480bdc8944e55b1bc721192aec?s=128&d=identicon&r=PG&f=1", "display_name": "fnaticrc_getright", "link": "https://stackoverflow.com/users/5464560/fnaticrc-getright"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1445337685, "post_id": 33233942, "comment_id": 54271921, "body": "@Volker : I tried that . Printing t gives me a blank &#39;{}&#39; . Nothing inside it :("}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1445337869, "post_id": 33233942, "comment_id": 54272035, "body": "How did you print <code>t</code>? Like <code>&quot;%s&quot;, t.name</code> or <code>&quot;%#v&quot;, t</code>. an output of &quot;{}&quot; seems strange. And handle every error."}, {"owner": {"reputation": 21, "user_id": 5464560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05ff45480bdc8944e55b1bc721192aec?s=128&d=identicon&r=PG&f=1", "display_name": "fnaticrc_getright", "link": "https://stackoverflow.com/users/5464560/fnaticrc-getright"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1445338201, "post_id": 33233942, "comment_id": 54272274, "body": "@Volker When I use fmt.Fprintf(rw, &quot;%s\\n&quot;, t) , I get {} . For fmt.Fprintf(rw, &quot;%#v&quot;, t)  I get main.Input{Name:&quot;&quot;} in the output . Any inputs on this ?"}, {"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1445338678, "post_id": 33233942, "comment_id": 54272595, "body": "I guess your JSON decoding fails and you ignore the error - the JSON you posted above does look strange because it uses these &quot;special&quot; quotation marks around <code>name</code>. So, as @Volker suggested, try handling <i>all</i> the errors first."}, {"owner": {"reputation": 21, "user_id": 5464560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05ff45480bdc8944e55b1bc721192aec?s=128&d=identicon&r=PG&f=1", "display_name": "fnaticrc_getright", "link": "https://stackoverflow.com/users/5464560/fnaticrc-getright"}, "edited": false, "score": 1, "creation_date": 1445339221, "post_id": 33233942, "comment_id": 54272931, "body": "Yes handling the error was an issue . I just got to know how much important error-handling is in GO .  Thanks guys :)"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 5464560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05ff45480bdc8944e55b1bc721192aec?s=128&d=identicon&r=PG&f=1", "display_name": "fnaticrc_getright", "link": "https://stackoverflow.com/users/5464560/fnaticrc-getright"}, "edited": false, "score": 0, "creation_date": 1445339319, "post_id": 33234838, "comment_id": 54272992, "body": "THe decode method did not return any error but worked fine with the code you suggested. I still wonder sir what did the err variable had a role here. ANy insights would be appreciated.  thanks a lot:)"}, {"owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "reply_to_user": {"reputation": 21, "user_id": 5464560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05ff45480bdc8944e55b1bc721192aec?s=128&d=identicon&r=PG&f=1", "display_name": "fnaticrc_getright", "link": "https://stackoverflow.com/users/5464560/fnaticrc-getright"}, "edited": false, "score": 0, "creation_date": 1445339603, "post_id": 33234838, "comment_id": 54273183, "body": "Not a magic like you think. If no error return (err == nil) then the Decode success. In your case when the <code>t</code> variale empty, must be some error happened!"}, {"owner": {"reputation": 322, "user_id": 2446350, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n55Fh.jpg?s=128&g=1", "display_name": "Chair", "link": "https://stackoverflow.com/users/2446350/chair"}, "edited": false, "score": 0, "creation_date": 1583678226, "post_id": 33234838, "comment_id": 107190271, "body": "I got the same problem, and didn&#39;t solve it by the code upstair"}], "tags": [], "owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "is_accepted": true, "score": 1, "last_activity_date": 1445338739, "creation_date": 1445338739, "answer_id": 33234838, "question_id": 33233942, "link": "https://stackoverflow.com/questions/33233942/request-body-is-null-in-go-lang-postman/33234838#33234838", "title": "Request Body is null in Go lang (Postman)", "body": "<p>Reuqes Body should be empty because you already read all from it. But that not the issue.<br>\nFrom your question, it seem your input is not valid JSON (you have <strong>\u201c</strong> which is different with <strong>\"</strong>).<br>\nThe <strong>Decode</strong> method will return error, you should check that.</p>\n\n<pre><code>if err := json.NewDecoder(req.Body).Decode(&amp;t); err != nil {\n  fmt.Println(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 5464560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05ff45480bdc8944e55b1bc721192aec?s=128&d=identicon&r=PG&f=1", "display_name": "fnaticrc_getright", "link": "https://stackoverflow.com/users/5464560/fnaticrc-getright"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2871, "favorite_count": 0, "accepted_answer_id": 33234838, "answer_count": 1, "score": 1, "last_activity_date": 1445338739, "creation_date": 1445336142, "question_id": 33233942, "link": "https://stackoverflow.com/questions/33233942/request-body-is-null-in-go-lang-postman", "title": "Request Body is null in Go lang (Postman)", "body": "<p>I am using Postman to post the json string on localhost. The json string that  Iam passing in Postman is : </p>\n\n<pre><code>{\n    \u201cname\u201d: \"foo\"\n} \n</code></pre>\n\n<p>However, when I retrieve the data in my test function, the <code>req.Body</code> i get something like this : <code>&amp;{%!s(*io.LimitedReader=&amp;{0xc0820142a0 0}) &lt;nil&gt; %!s(*bufio.Reader=&lt;nil&gt;) %!s(bool=false) %!s(bool=true) {%!s(int32=0) %!s(uint32=0)} %!s(bool=true) %!s(bool=false) %!s(bool=false)}</code></p>\n\n<p>I wish to get the name:foo in the request body.</p>\n\n<p>My go lang code for the same is : </p>\n\n<pre><code>import (\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n)\n\ntype Input struct {\n    Name string `json:\"name\"`\n}\n\n\nfunc test(rw http.ResponseWriter, req *http.Request) {\n    var t Input\n    json.NewDecoder(req.Body).Decode(&amp;t)\n    fmt.Fprintf(rw, \"%s\\n\", req.Body)\n}\n\nfunc main() {\n    http.HandleFunc(\"/test\", test)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>Can anyone tell me why I am getting blank data in the req.Body attribute ? Thanks a lot. </p>\n"}, {"tags": ["oop", "go", "struct", "embedding", "law-of-demeter"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 3, "creation_date": 1445333284, "post_id": 33232516, "comment_id": 54269080, "body": "In that code, I&#39;d be more worried about <a href=\"https://en.wikipedia.org/wiki/Separation_of_concerns\" rel=\"nofollow noreferrer\">SoC</a>. Does an SQL transaction have anything to do with a user?"}, {"owner": {"reputation": 1543, "user_id": 3589634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VyTzB.jpg?s=128&g=1", "display_name": "Anony-mouse", "link": "https://stackoverflow.com/users/3589634/anony-mouse"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1445333644, "post_id": 33232516, "comment_id": 54269339, "body": "@Ainar-G User wants to query the database. Then would it be violation of SoC ?"}, {"owner": {"reputation": 1543, "user_id": 3589634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VyTzB.jpg?s=128&g=1", "display_name": "Anony-mouse", "link": "https://stackoverflow.com/users/3589634/anony-mouse"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1445333985, "post_id": 33232516, "comment_id": 54269570, "body": "Moreover, even if I pull out the transaction and replace it with another object(say Superpower), I still believe it violates Law of Demeter"}, {"owner": {"reputation": 1543, "user_id": 3589634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VyTzB.jpg?s=128&g=1", "display_name": "Anony-mouse", "link": "https://stackoverflow.com/users/3589634/anony-mouse"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1445587800, "post_id": 33232516, "comment_id": 54394405, "body": "Can any of downvoters explain what the issue with the question is ?"}], "answers": [{"comments": [{"owner": {"reputation": 1543, "user_id": 3589634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VyTzB.jpg?s=128&g=1", "display_name": "Anony-mouse", "link": "https://stackoverflow.com/users/3589634/anony-mouse"}, "edited": false, "score": 0, "creation_date": 1445340277, "post_id": 33234590, "comment_id": 54273628, "body": "I believe LOD was in existence to make sure that the changes in one class are propagated to other in a very limited way. Both the approaches you mention, do not seem to solve the problem.(I might be totally wrong but that&#39;s how I feel, as delegation to a new method still remains a code smell)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1543, "user_id": 3589634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VyTzB.jpg?s=128&g=1", "display_name": "Anony-mouse", "link": "https://stackoverflow.com/users/3589634/anony-mouse"}, "edited": false, "score": 0, "creation_date": 1445341440, "post_id": 33234590, "comment_id": 54274390, "body": "@Anony-mouse In the example, if <code>u.Query()</code> is used, the clients using this are not affected if internals of <code>User</code> are changed (it doesn&#39;t matter if <code>u.Query()</code> denotes a promoted method or it denotes a method of <code>User</code>, that is: <code>User.Query()</code>)."}, {"owner": {"reputation": 1543, "user_id": 3589634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VyTzB.jpg?s=128&g=1", "display_name": "Anony-mouse", "link": "https://stackoverflow.com/users/3589634/anony-mouse"}, "edited": false, "score": 0, "creation_date": 1445341786, "post_id": 33234590, "comment_id": 54274606, "body": "What about the case where <code>tx</code> itself changes? Now <code>u.Query()</code> might not be a valid operation at all. Since I have introduced this dependency,  any issue with <code>tx</code> will directly influence my <code>User</code> which should be avoided right? One more thing is LoD such a bad thing? Should I dump it altogether?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1543, "user_id": 3589634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VyTzB.jpg?s=128&g=1", "display_name": "Anony-mouse", "link": "https://stackoverflow.com/users/3589634/anony-mouse"}, "edited": false, "score": 0, "creation_date": 1445342721, "post_id": 33234590, "comment_id": 54275255, "body": "@Anony-mouse If <code>sql.Tx</code> changes, yes, <code>u.Query()</code> might not be valid anymore. But an incompatible <code>sql.Tx</code> is unlikely to happen. And if you&#39;re the developer of the changed package, and making incompatible changes, it is your responsibility to change other code that depends on your incompatible change. Doing so (properly updating <code>u.Query()</code>) the client who calls <code>u.Query()</code> will not be affected, the client still doesn&#39;t need to know something changed under the hood."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1543, "user_id": 3589634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VyTzB.jpg?s=128&g=1", "display_name": "Anony-mouse", "link": "https://stackoverflow.com/users/3589634/anony-mouse"}, "edited": false, "score": 0, "creation_date": 1445342828, "post_id": 33234590, "comment_id": 54275336, "body": "@Anony-mouse This is exactly what LoD guarantees: if you use <code>u.Query()</code> instead of <code>u.Tx.Query()</code>, if the <code>User</code> changes internally, the client calling <code>u.Query()</code> does not need to know or worry about that. LoD is not a bad thing. You should not drop it. You may choose what principles you follow, but you should also think and not follow everything a chosen principle dictates all the time at any costs."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1543, "user_id": 3589634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VyTzB.jpg?s=128&g=1", "display_name": "Anony-mouse", "link": "https://stackoverflow.com/users/3589634/anony-mouse"}, "edited": false, "score": 0, "creation_date": 1445343772, "post_id": 33234590, "comment_id": 54275912, "body": "@Anony-mouse One more thing to clear: LoD does not involve API incompatible changes. What it offers is if followed, internal changes of an entity will not have effect on other entities using the &quot;public&quot; face of the entity. If <code>sql.Tx</code> is changed in a drastic way that <code>Tx.Query()</code> will not be available anymore, that is not &quot;covered&quot; by LoD."}, {"owner": {"reputation": 1543, "user_id": 3589634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VyTzB.jpg?s=128&g=1", "display_name": "Anony-mouse", "link": "https://stackoverflow.com/users/3589634/anony-mouse"}, "edited": false, "score": 0, "creation_date": 1445587626, "post_id": 33234590, "comment_id": 54394320, "body": "Soory I was busy, I think with this comment you have pretty much answered the question. I am closing it now."}, {"owner": {"reputation": 1543, "user_id": 3589634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VyTzB.jpg?s=128&g=1", "display_name": "Anony-mouse", "link": "https://stackoverflow.com/users/3589634/anony-mouse"}, "edited": false, "score": 0, "creation_date": 1445587936, "post_id": 33234590, "comment_id": 54394480, "body": "can you  edit the answer above and add the details to it. It might be better for future references."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1543, "user_id": 3589634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VyTzB.jpg?s=128&g=1", "display_name": "Anony-mouse", "link": "https://stackoverflow.com/users/3589634/anony-mouse"}, "edited": false, "score": 0, "creation_date": 1445588737, "post_id": 33234590, "comment_id": 54394880, "body": "@Anony-mouse Done. Thanks for the suggestion."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1459320725, "last_edit_date": 1459320725, "creation_date": 1445337996, "answer_id": 33234590, "question_id": 33232516, "link": "https://stackoverflow.com/questions/33232516/does-embedding-in-golang-violate-law-of-demeter/33234590#33234590", "title": "Does embedding in golang violate law of demeter?", "body": "<p>The embedding concept somewhat violates <a href=\"https://en.wikipedia.org/wiki/Law_of_Demeter\" rel=\"nofollow\"><em>Law of Demeter</em></a> as it <em>doesn't hide</em> the fact that a type was embedded <em>if</em> the type itself is <em>exported</em>. Note that embedding an unexported type <strong>does not</strong> violate LoD (you can't refer to unexported fields and methods).</p>\n\n<p>But this <em>doesn't force</em> you to refer to promoted fields or methods in a way that also violates LoD. Embedding itself is just a technique so that you can \"outsource\" common, shared code to other types; or from another point of view to make use of other types when creating new ones. The way you refer to the promoted fields or methods of the embedded types is what may violate the law.</p>\n\n<p>As you said, if you call it as <code>u.Tx.Query()</code>, that is a clear violation of <em>Law of Demeter</em>: you are using the implementation detail that <code>User</code> embeds <code>*sql.Tx</code>.</p>\n\n<p>But if you call it like this: <code>u.Query()</code> that is ok. This form does not expose or take advantage of the fact that <code>*sql.Tx</code> is embedded. This form will continue to work if implementation changes and <code>*sql.Tx</code> will not be embedded anymore (e.g. it is changed to be a \"regular\" field or removed completely, and a <code>User.Query()</code> method is added).</p>\n\n<p>If you don't want to allow access to the field value of the exported embedded type, make it an unexported regular field and add an \"explicit\" <code>User.Query()</code> method which may delegate to the field, e.g.:</p>\n\n<pre><code>type User struct {\n    Name     string\n    Password string\n    tx       *sql.Tx // regular field, not embedded; and not exported\n}\n\nfunc (u *User) Query(query string, args ...interface{}) (*sql.Rows, error) {\n    return u.tx.Query(query, args...)\n}\n</code></pre>\n\n<p><strong>Further notes:</strong></p>\n\n<p>In the example, if <code>u.Query()</code> is used, the clients using this are not affected if internals of <code>User</code> are changed (it doesn't matter if <code>u.Query()</code> denotes a promoted method or it denotes a method of <code>User</code>, that is: <code>User.Query()</code>).</p>\n\n<p>If <code>sql.Tx</code> changes, yes, <code>u.Query()</code> might not be valid anymore. But an incompatible <code>sql.Tx</code> is unlikely to happen. And if you're the developer of the changed package, and making incompatible changes, it is your responsibility to change other code that depends on your incompatible change. Doing so (properly updating <code>u.Query()</code>) the client who calls <code>u.Query()</code> will not be affected, the client still doesn't need to know something changed under the hood. </p>\n\n<p>This is exactly what LoD guarantees: if you use <code>u.Query()</code> instead of <code>u.Tx.Query()</code>, if the <code>User</code> changes internally, the client calling <code>u.Query()</code> does not need to know or worry about that. LoD is not a bad thing. You should not drop it. You may choose what principles you follow, but you should also think and not follow everything a chosen principle dictates all the time at any costs.</p>\n\n<p>One more thing to clear: LoD does not involve API incompatible changes. What it offers is if followed, internal changes of an entity will not have effect on other entities using the \"public\" face of the entity. If <code>sql.Tx</code> is changed in a drastic way that <code>Tx.Query()</code> will not be available anymore, that is not \"covered\" by LoD.</p>\n"}], "owner": {"reputation": 1543, "user_id": 3589634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VyTzB.jpg?s=128&g=1", "display_name": "Anony-mouse", "link": "https://stackoverflow.com/users/3589634/anony-mouse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 0, "accepted_answer_id": 33234590, "answer_count": 1, "score": 4, "last_activity_date": 1475439145, "creation_date": 1445332221, "last_edit_date": 1475439145, "question_id": 33232516, "link": "https://stackoverflow.com/questions/33232516/does-embedding-in-golang-violate-law-of-demeter", "title": "Does embedding in golang violate law of demeter?", "body": "<p>This is what the <strong>Effective GO</strong> had to say about <em>Embedding</em> in golang </p>\n\n<blockquote>\n  <p>When we embed a type, the methods of that type become methods of the outer type, but when they are invoked the receiver of the method is the inner type, not the outer one</p>\n</blockquote>\n\n<p>I had a code snippet where I had <code>Struct User</code> defined as follows</p>\n\n<pre><code>type User struct {\n    Name     string\n    Password string\n    *sql.Tx\n}\n</code></pre>\n\n<p>And then I call <code>u.Query(\"some query here\")</code> etc. I had done this specifically so that I could avoid calls like <code>u.Transaction.Query(\"query\")</code>, which clearly violates <em>Law of Demeter</em>. Now after reading the docs and effective go, I am doubtful about merits of the first approach as well.\nAm I violating <em>Law of Demeter</em>? If yes the how can I avoid it ?</p>\n"}, {"tags": ["xml", "go"], "answers": [{"tags": [], "owner": {"reputation": 124, "user_id": 5364128, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-R6Kk7EZliRY/AAAAAAAAAAI/AAAAAAAABAg/MIgikl2r_bk/photo.jpg?sz=128", "display_name": "Johannes", "link": "https://stackoverflow.com/users/5364128/johannes"}, "is_accepted": true, "score": 0, "last_activity_date": 1445330498, "creation_date": 1445330498, "answer_id": 33231912, "question_id": 33230936, "link": "https://stackoverflow.com/questions/33230936/parse-multiple-xml-tags-in-go/33231912#33231912", "title": "Parse multiple XML Tags in Go", "body": "<p>I had to allocate the parameter of a new object to the object which was returned. I tried this before but I did a mistake</p>\n\n<pre><code>type XMLStrap struct {\n  Status     string `xml:\"status,attr\"`\n  SSLversion string `xml:\"sslversion,attr\"`\n  Bits       string `xml:\"bits,attr\"`\n  Cipher     string `xml:\"cipher,attr\"`\n  Valid      string \"\"\n}\n\ntype Certs struct {\n  Cert string `xml:\"not-valid-after\"`\n}\n\ntype XMLStraps struct {\n  XMLName    xml.Name   `xml:\"document\"`\n  Straps     []XMLStrap `xml:\"ssltest&gt;cipher\"`\n  Validation Certs      `xml:\"ssltest&gt;certificate\"`\n}\n\nfunc ReadStraps(reader io.Reader) ([]XMLStrap, error) {\n  var xmlStraps XMLStraps\n  if err := xml.NewDecoder(reader).Decode(&amp;xmlStraps); err != nil {\n    return nil, err\n  }\n  xmlStraps.Straps[0].Valid = xmlStraps.Validation.Cert\n  return xmlStraps.Straps, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 124, "user_id": 5364128, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-R6Kk7EZliRY/AAAAAAAAAAI/AAAAAAAABAg/MIgikl2r_bk/photo.jpg?sz=128", "display_name": "Johannes", "link": "https://stackoverflow.com/users/5364128/johannes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 387, "favorite_count": 0, "accepted_answer_id": 33231912, "answer_count": 1, "score": 0, "last_activity_date": 1445330498, "creation_date": 1445327389, "question_id": 33230936, "link": "https://stackoverflow.com/questions/33230936/parse-multiple-xml-tags-in-go", "title": "Parse multiple XML Tags in Go", "body": "<p>I'm trying to parse an xml file for sslscan which has the following output (shortened).\nI want to parse it with Go.</p>\n\n<pre><code>&lt;document title=\"SSLScan Results\"&gt;\n &lt;ssltest host=\"x.x.x.x\" port=\"443\"&gt;\n   &lt;cipher status=\"accepted\" sslversion=\"TLSv1.0\" bits=\"256\" cipher=\"DHE-RSA-CAMELLIA256-SHA\" dhebits=\"2048\" /&gt;\n             .\n             .\n   &lt;cipher status=\"accepted\" sslversion=\"TLSv1.2\" bits=\"112\" cipher=\"DES-CBC3-SHA\" /&gt;               .\n\n  &lt;certificate&gt;\n   &lt;not-valid-before&gt;Jun  6 00:00:00 2014 GMT&lt;/not-valid-before&gt;\n   &lt;not-valid-after&gt;Jul  4 23:59:59 2017 GMT&lt;/not-valid-after&gt;\n  &lt;/certificate&gt;\n &lt;/ssltest&gt;\n&lt;/document&gt;\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>type XMLStrap struct {\n  Status     string `xml:\"status,attr\"`\n  SSLversion string `xml:\"sslversion,attr\"`\n  Bits       string `xml:\"bits,attr\"`\n  Cipher     string `xml:\"cipher,attr\"`\n}\n\ntype XMLStraps struct {\n  XMLName xml.Name   `xml:\"document\"`\n  Straps  []XMLStrap `xml:\"ssltest&gt;cipher\"`\n}\n\nfunc ReadStraps(reader io.Reader) ([]XMLStrap, error) {\n  var xmlStraps XMLStraps\n  if err := xml.NewDecoder(reader).Decode(&amp;xmlStraps); err != nil {\n    return nil, err\n  }\n  return xmlStraps.Straps, nil\n}\n\n\nfunc main() {\n  strapsFilePath, err := filepath.Abs(\"straps.xml\")\n  if err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n  }\n\n  file, err := os.Open(strapsFilePath)\n  if err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n  }\n\n  defer file.Close()\n\n  xmlStraps, err := ReadStraps(file)\n  if err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n  }\n\n  for i := 0; i &lt; len(xmlStraps); i++ {\n    fmt.Printf(\"%s %s %s %s\\n\", xmlStraps[i].Status,      xmlStraps[i].SSLversion, xmlStraps[i].Bits, xmlStraps[i].Cipher)\n  }\n}\n</code></pre>\n\n<p>Everything works fine but I have no idea how to parse the date in <code>&lt;certificate&gt;&lt;not-valid-before&gt;</code> without creating a new reader?</p>\n\n<p>I tried to change the first two structs to</p>\n\n<pre><code>type XMLStrap struct {\n  Status     string `xml:\"cipher&gt;status,attr\"`\n  SSLversion string `xml:\"cipher&gt;sslversion,attr\"`\n  Bits       string `xml:\"cipher&gt;bits,attr\"`\n  Cipher     string `xml:\"cipher&gt;cipher,attr\"`\n  Cert       string `xml:\"certificate&gt;not-valid-after,chardata\"`\n}\n\ntype XMLStraps struct {\n  XMLName xml.Name   `xml:\"document\"`\n  Straps  []XMLStrap `xml:\"ssltest\"`\n}\n</code></pre>\n\n<p>but this doesn't work.</p>\n\n<p><code>xml: cipher&gt;status chain not valid with attr flag\nexit status 1</code></p>\n\n<p>Apparently in older versions of Go it worked.</p>\n"}, {"tags": ["json", "http", "go", "request", "connection"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1445327499, "post_id": 33229860, "comment_id": 54265612, "body": "Hmm. Maybe simplest is to implement the old behavior yourself: <code>defer func() { io.Copy(ioutil.Discard, resp.Body); resp.Body.Close() }()</code>."}, {"owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "edited": false, "score": 0, "creation_date": 1445338971, "post_id": 33229860, "comment_id": 54272782, "body": "Maybe after <b>decoder.Decode(data),</b> returned then you have read all your data."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1445347583, "post_id": 33229860, "comment_id": 54278601, "body": "If you&#39;re only expecting 1 json response of a reasonable size in the body, don&#39;t bother with the Decoder. Use ReadAll and json.Unmarshal."}, {"owner": {"reputation": 118, "user_id": 3067627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa6ae3bcdb95860cdde8f54e7f4c32eb?s=128&d=identicon&r=PG&f=1", "display_name": "bawjensen", "link": "https://stackoverflow.com/users/3067627/bawjensen"}, "edited": false, "score": 0, "creation_date": 1445373331, "post_id": 33229860, "comment_id": 54294827, "body": "I&#39;m expecting the JSON to be of a reasonable size, but there may be many concurrent/parallel goroutines each handling a response. Currently I&#39;m on a system that has plenty of RAM to handle this, but I don&#39;t want to rely on that."}], "answers": [{"comments": [{"owner": {"reputation": 118, "user_id": 3067627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa6ae3bcdb95860cdde8f54e7f4c32eb?s=128&d=identicon&r=PG&f=1", "display_name": "bawjensen", "link": "https://stackoverflow.com/users/3067627/bawjensen"}, "edited": false, "score": 0, "creation_date": 1445377401, "post_id": 33247251, "comment_id": 54296957, "body": "Yeah, I came across <code>More()</code>, and I wasn&#39;t sure if it was doing exactly what I wanted. Thanks!"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1465909707, "last_edit_date": 1465909707, "creation_date": 1445377067, "answer_id": 33247251, "question_id": 33229860, "link": "https://stackoverflow.com/questions/33229860/go-http-requests-json-reusing-connections/33247251#33247251", "title": "Go - HTTP Requests, JSON, reusing connections", "body": "<p>If you want to only decode a single object using the Decoder, then you can use the <code>More()</code> method to see if there is more in the stream that needs to be read.</p>\n\n<pre><code>decoder := json.NewDecoder(resp.Body)\nerr := decoder.Decode(data)\nif err != nil {\n    // handle err\n}\nif decoder.More() {\n    // there's more data in the stream, so discard whatever is left\n    io.Copy(ioutil.Discard, resp.Body)\n}\n</code></pre>\n\n<p>You can also just defer the Copy on every call, but this way you could more easily handle or log if there was unexpected data or an error. </p>\n"}], "owner": {"reputation": 118, "user_id": 3067627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa6ae3bcdb95860cdde8f54e7f4c32eb?s=128&d=identicon&r=PG&f=1", "display_name": "bawjensen", "link": "https://stackoverflow.com/users/3067627/bawjensen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 861, "favorite_count": 4, "accepted_answer_id": 33247251, "answer_count": 1, "score": 4, "last_activity_date": 1465909707, "creation_date": 1445323880, "last_edit_date": 1495542302, "question_id": 33229860, "link": "https://stackoverflow.com/questions/33229860/go-http-requests-json-reusing-connections", "title": "Go - HTTP Requests, JSON, reusing connections", "body": "<p>I'm using Go to make many requests over HTTPS, and I'm having issues with not reusing connections, and running out of ports. The requests I'm making are to an API that returns data in the JSON format, which I then <code>json.Decode</code> into a Go value.</p>\n\n<p>According to questions I've come across on this site (<a href=\"https://stackoverflow.com/questions/17959732/why-is-go-https-client-not-reusing-connections\">#1</a>, <a href=\"https://stackoverflow.com/questions/17948827/reusing-http-connections-in-golang\">#2</a>), in order for Go to reuse the connection for another request, I must read the entirety of the response's body before closing (note this wasn't always the behavior, as stated <a href=\"https://code.google.com/p/go/source/detail?r=d4e1ec84876c0f5611ab86a03826da14b866efb2&amp;name=release-branch.go1.1&amp;path=/src/pkg/net/http/transport.go\" rel=\"nofollow noreferrer\">here</a>).</p>\n\n<pre><code>Previously the HTTP client's (*Response).Body.Close would try to keep\nreading until EOF, hoping to reuse the keep-alive HTTP connection...\n</code></pre>\n\n<p>In a typical instance, I would use the example shown in the earlier links, like so:</p>\n\n<pre><code>ioutil.ReadAll(resp.Body)\n</code></pre>\n\n<p>but since I'm pulling the data out of the JSON through code like this:</p>\n\n<pre><code>...\n\nreq, _ := http.NewRequest(\"GET\", urlString, nil)\nreq.Header.Add(\"Connection\", \"keep-alive\")\nresp, err = client.Do(req)\ndefer resp.Body.Close()\n\n...\n\ndecoder := json.NewDecoder(resp.Body)\ndecoder.Decode(data)\n</code></pre>\n\n<p>I'm not sure how the two methods would interact.</p>\n\n<p>So the question is, how do I make sure the entire response has been read, so that the connection can later be reused for another request?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 17713, "user_id": 226648, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/3196df423fd95dc4fce7dfadb8ec9953?s=128&d=identicon&r=PG", "display_name": "el.pescado", "link": "https://stackoverflow.com/users/226648/el-pescado"}, "edited": false, "score": 1, "creation_date": 1445320281, "post_id": 33228809, "comment_id": 54262017, "body": "Try <code>ldd runk</code> to see what <code>runk</code> links to."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1445347071, "post_id": 33229480, "comment_id": 54278223, "body": "The go1.5 net changes don&#39;t affect linking, just the code path. Libc is still linked for systems with an nsswitch.conf that require it, and for the netgo GODEBUG option to switch resolvers at runtime."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": false, "score": 3, "last_activity_date": 1445356652, "last_edit_date": 1445356652, "creation_date": 1445322511, "answer_id": 33229480, "question_id": 33228809, "link": "https://stackoverflow.com/questions/33228809/why-is-my-go-application-not-statically-linked/33229480#33229480", "title": "Why is my Go application not statically linked?", "body": "<p>Go still dynamically links to some shared library functions when using packages like <code>net</code> and <code>os/user</code>.</p>\n\n<p>Go 1.5 further reduced these requirements for the <code>net</code> package: <a href=\"https://golang.org/doc/go1.5#net\" rel=\"nofollow\">https://golang.org/doc/go1.5#net</a></p>\n\n<blockquote>\n  <p>The DNS resolver in the net package has almost always used cgo to access the system interface. A change in Go 1.5 means that on most Unix systems DNS resolution will no longer require cgo, which simplifies execution on those platforms. Now, if the system's networking configuration permits, the native Go resolver will suffice. The important effect of this change is that each DNS resolution occupies a goroutine rather than a thread, so a program with multiple outstanding DNS requests will consume fewer operating system resources.</p>\n</blockquote>\n\n<p>Advanced reading: <a href=\"http://dominik.honnef.co/posts/2015/06/statically_compiled_go_programs__always__even_with_cgo__using_musl/\" rel=\"nofollow\">http://dominik.honnef.co/posts/2015/06/statically_compiled_go_programs__always__even_with_cgo__using_musl/</a></p>\n"}, {"tags": [], "owner": {"reputation": 18219, "user_id": 627492, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a65ecbb7d583a75511cff7d78dd7d6e7?s=128&d=identicon&r=PG", "display_name": "Duke Dougal", "link": "https://stackoverflow.com/users/627492/duke-dougal"}, "is_accepted": false, "score": 0, "last_activity_date": 1445387617, "creation_date": 1445387617, "answer_id": 33249054, "question_id": 33228809, "link": "https://stackoverflow.com/questions/33228809/why-is-my-go-application-not-statically-linked/33249054#33249054", "title": "Why is my Go application not statically linked?", "body": "<p>The answer that I'm going with it what @DaveCheney suggested elsewhere:</p>\n\n<p>If you want static compilation always then I recommend installing Go from\nsource</p>\n\n<p>env CGO_ENABLED=0 ./all.bash</p>\n\n<p>That will disable cgo permanently.</p>\n"}], "owner": {"reputation": 18219, "user_id": 627492, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a65ecbb7d583a75511cff7d78dd7d6e7?s=128&d=identicon&r=PG", "display_name": "Duke Dougal", "link": "https://stackoverflow.com/users/627492/duke-dougal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1445387617, "creation_date": 1445319573, "last_edit_date": 1445320158, "question_id": 33228809, "link": "https://stackoverflow.com/questions/33228809/why-is-my-go-application-not-statically-linked", "title": "Why is my Go application not statically linked?", "body": "<p>I had expected a static binary when using Go.</p>\n\n<pre><code>ubuntu@ugbuildserver:~/gospace$ go build src/runk/runk.go\nubuntu@ugbuildserver:~/gospace$ file runk\nrunk: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), not stripped\nubuntu@ugbuildserver:~/gospace$\n</code></pre>\n\n<p>Any suggestions for what is wrong?</p>\n"}, {"tags": ["go", "gob"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1475847005, "last_edit_date": 1475847005, "creation_date": 1445319932, "answer_id": 33228913, "question_id": 33228700, "link": "https://stackoverflow.com/questions/33228700/is-encoding-gob-deterministic/33228913#33228913", "title": "Is encoding/gob deterministic?", "body": "<p>You shouldn't really care as long as it \"gets the job done\". But current <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"noreferrer\"><code>encoding/gob</code></a> implementation is deterministic. But (continue reading)!</p>\n\n<p>Since:</p>\n\n<blockquote>\n  <p>A stream of gobs is self-describing. Each data item in the stream is preceded by a specification of its type, expressed in terms of a small set of predefined types.</p>\n</blockquote>\n\n<p>This means if you encode a value of a type for the first time, type information will be sent. If you encode another value of the same type, the type description will not be transmitted again, just a reference to its previous spec. So even if you encode the same value twice, it will produce different byte sequences as the first will contain type spec and the value, the second will contain only a type ref (e.g. type id) and the value.</p>\n\n<p>See this example:</p>\n\n<pre><code>type Int struct{ X int }\n\nb := &amp;bytes.Buffer{}\ne := gob.NewEncoder(b)\n\ne.Encode(Int{1})\nfmt.Println(b.Bytes())\n\ne.Encode(Int{1})\nfmt.Println(b.Bytes())\n\ne.Encode(Int{1})\nfmt.Println(b.Bytes())\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/PKSqWR6iZF\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[23 255 129 3 1 1 3 73 110 116 1 255 130 0 1 1 1 1 88 1 4 0 0 0 5 255 130 1 2 0]\n[23 255 129 3 1 1 3 73 110 116 1 255 130 0 1 1 1 1 88 1 4 0 0 0 5 255 130 1 2 0 5 255 130 1 2 0]\n[23 255 129 3 1 1 3 73 110 116 1 255 130 0 1 1 1 1 88 1 4 0 0 0 5 255 130 1 2 0 5 255 130 1 2 0 5 255 130 1 2 0]\n</code></pre>\n\n<p>As seen the first <code>Encode()</code> generates lots of bytes plus the value for our <code>Int</code> value being <code>[5 255 130 1 2 0]</code>, the second and third calls add the same <code>[5 255 130 1 2 0]</code> sequence.</p>\n\n<p>But if you create 2 different <a href=\"https://golang.org/pkg/encoding/gob/#Encoder\" rel=\"noreferrer\"><code>gob.Encoder</code></a>s and you write the same values in the same order, they will produce exact results.</p>\n\n<p>Note that in the previous statement \"same order\" is also important. Because type specification is transmitted when first value of such type is sent, sending values of different types in different order will transmit type specs in different order too, and so the references/identifiers of the types may differ, which implies that when a value of such type is encoded, different type reference/id will be used/sent.</p>\n\n<p>Also note that the implementation of the <code>gob</code> package may change from release to release. These changes will be backward compatible (they must explicitly state if for some reason they would make backward incompatible changes), but being backward compatible does not mean the output is the same. So different Go versions may produce different results (but all is decodeable with all compatible versions).</p>\n"}, {"comments": [{"owner": {"reputation": 1658, "user_id": 516037, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/b4987583409b6d79fca0bd1145c54609?s=128&d=identicon&r=PG&f=1", "display_name": "dpington", "link": "https://stackoverflow.com/users/516037/dpington"}, "edited": false, "score": 0, "creation_date": 1528374465, "post_id": 50733233, "comment_id": 88489832, "body": "This this a recent change or has it always been like this?"}, {"owner": {"reputation": 1658, "user_id": 516037, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/b4987583409b6d79fca0bd1145c54609?s=128&d=identicon&r=PG&f=1", "display_name": "dpington", "link": "https://stackoverflow.com/users/516037/dpington"}, "edited": false, "score": 0, "creation_date": 1528375067, "post_id": 50733233, "comment_id": 88490219, "body": "It seems like it was always like this?"}, {"owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "reply_to_user": {"reputation": 1658, "user_id": 516037, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/b4987583409b6d79fca0bd1145c54609?s=128&d=identicon&r=PG&f=1", "display_name": "dpington", "link": "https://stackoverflow.com/users/516037/dpington"}, "edited": false, "score": 0, "creation_date": 1528420159, "post_id": 50733233, "comment_id": 88512033, "body": "Map iteration order (and I guess map item order in encoding/gob) has been fully non-deterministic since at least 2014 (go 1.3): <a href=\"https://github.com/golang/go/issues/6719\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/6719</a>  I assume the accepted answer didn&#39;t test using maps?"}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 1, "creation_date": 1566857247, "post_id": 50733233, "comment_id": 101779700, "body": "I posted an answer in 2015 mentioning the possibility of map iteration order, only to have it pointed out to me that the question specifically asks about structs and arrays and <i>no maps</i>, so I deleted my answer. I don&#39;t mind that, but it&#39;s worth pointing out that that&#39;s why the accepted answer <i>isn&#39;t</i> incorrect."}], "tags": [], "owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "is_accepted": false, "score": 4, "last_activity_date": 1528420324, "last_edit_date": 1528420324, "creation_date": 1528347542, "answer_id": 50733233, "question_id": 33228700, "link": "https://stackoverflow.com/questions/33228700/is-encoding-gob-deterministic/50733233#50733233", "title": "Is encoding/gob deterministic?", "body": "<p>It should probably be noted that the accepted answer is not correct: encoding/gob doesn't order map elements in a deterministic way: <a href=\"https://play.golang.org/p/Hh3_5Kb3Znn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Hh3_5Kb3Znn</a></p>\n\n<p>I've forked encoding/gob and added some code to order maps by key before writing them to the stream. This will affect performance, but my particular application doesn't need high performance. Remember custom marshalers can break this, so use with care: <a href=\"https://github.com/dave/stablegob\" rel=\"nofollow noreferrer\">https://github.com/dave/stablegob</a></p>\n"}, {"tags": [], "owner": {"reputation": 829, "user_id": 341761, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/11a31d0f75a4d5188161c3970867c9c3?s=128&d=identicon&r=PG", "display_name": "hbt", "link": "https://stackoverflow.com/users/341761/hbt"}, "is_accepted": false, "score": 0, "last_activity_date": 1603711431, "creation_date": 1603711431, "answer_id": 64536178, "question_id": 33228700, "link": "https://stackoverflow.com/questions/33228700/is-encoding-gob-deterministic/64536178#64536178", "title": "Is encoding/gob deterministic?", "body": "<p>It also isn't deterministic if you use different types and different encoders.</p>\n<p>Example:</p>\n<pre><code>package main\n\nimport (\n    &quot;bytes&quot;\n    &quot;crypto/sha1&quot;\n    &quot;encoding/gob&quot;\n    &quot;encoding/hex&quot;\n    &quot;log&quot;\n)\n\nfunc main() {\n    encint()\n    encint64()\n    encstring()\n\n}\n\nfunc encint() {\n    s1 := []int{0, 2, 4, 5, 7}\n    buf2 := bytes.Buffer{}\n    enc2 := gob.NewEncoder(&amp;buf2)\n    enc2.Encode(s1)\n}\n\nfunc encint64() {\n    s1 := []int64{0, 2, 4, 5, 7}\n    buf2 := bytes.Buffer{}\n    enc2 := gob.NewEncoder(&amp;buf2)\n    enc2.Encode(s1)\n}\n\nfunc encstring() {\n    s1 := []string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;}\n    buf2 := bytes.Buffer{}\n    enc2 := gob.NewEncoder(&amp;buf2)\n    enc2.Encode(s1)\n    log.Println(buf2.Bytes())\n\n    hash := sha1.New()\n    hash.Write(buf2.Bytes())\n    ret := hash.Sum(nil)\n    log.Println(hex.EncodeToString(ret))\n}\n</code></pre>\n<p>Run in <a href=\"https://play.golang.org/p/YYhvPpVG_K9\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n<p>Notice if you comment out <code>encint()</code> or <code>encint64()</code> the <code>encstring</code> will produce different bytes and a different hashcode.</p>\n<p>This happens despite using different objects/pointers.</p>\n"}], "owner": {"reputation": 1658, "user_id": 516037, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/b4987583409b6d79fca0bd1145c54609?s=128&d=identicon&r=PG&f=1", "display_name": "dpington", "link": "https://stackoverflow.com/users/516037/dpington"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 948, "favorite_count": 0, "accepted_answer_id": 33228913, "answer_count": 3, "score": 8, "last_activity_date": 1603711431, "creation_date": 1445319063, "last_edit_date": 1528386383, "question_id": 33228700, "link": "https://stackoverflow.com/questions/33228700/is-encoding-gob-deterministic", "title": "Is encoding/gob deterministic?", "body": "<p>Can we expect for two Go objects x, y such that x is equal to y (assuming no trickiness with interfaces and maps, just structs and arrays) that the output of gob_encode(x) and gob_encode(y) will always be the same?</p>\n\n<p>edit (Jun 8 2018):</p>\n\n<p>gob encoding is <strong>non-deterministic</strong> when <strong>maps</strong> are involved. This is due to the random iteration order of the maps, resulting in their serialisation to be randomly ordered.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445313551, "post_id": 33227063, "comment_id": 54259790, "body": "No but you could refactor your code so it can shut down gracefully and then the defer would get executed. I recommend declaring <code>c</code> at the top of main and passing it in to the go routines. In side the <code>for</code> loop you need a select statement that listens on <code>c</code>, if you get a signal on it, stop what you&#39;re doing and return. Then you don&#39;t need to use <code>os.Exit</code> to kill your goroutines (as you never should...) and your program can return normally allowing your defered <code>os.RemoveAll</code> to do clean up."}], "answers": [{"comments": [{"owner": {"reputation": 385, "user_id": 5386963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d57a66c301b782f4630f4e45200cc2a5?s=128&d=identicon&r=PG&f=1", "display_name": "AndrewN", "link": "https://stackoverflow.com/users/5386963/andrewn"}, "edited": false, "score": 1, "creation_date": 1445315040, "post_id": 33227884, "comment_id": 54260207, "body": "A better answer than I&#39;d written in the time it took me to write it out. Still, figuring it out was fun. For completeness you could add quotes from the spec about what happens to <a href=\"https://golang.org/ref/spec#Program_execution\" rel=\"nofollow noreferrer\">non-main goroutines</a> on program exit. Ditto from <a href=\"https://golang.org/pkg/os/#Exit\" rel=\"nofollow noreferrer\">os.Exit()</a> &quot;The program terminates immediately; deferred functions are not run.&quot;"}], "tags": [], "owner": {"reputation": 540, "user_id": 707949, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a138d00aecaf8062c3e14b1307ec079a?s=128&d=identicon&r=PG", "display_name": "Chakib", "link": "https://stackoverflow.com/users/707949/chakib"}, "is_accepted": false, "score": 1, "last_activity_date": 1445314991, "last_edit_date": 1445314991, "creation_date": 1445314489, "answer_id": 33227884, "question_id": 33227063, "link": "https://stackoverflow.com/questions/33227063/best-way-to-clear-up-temporary-files/33227884#33227884", "title": "Best way to clear up temporary files", "body": "<p>From golang reference: </p>\n\n<blockquote>\n  <p>A \"defer\" statement invokes a function whose execution is deferred to\n  the moment the surrounding function <strong>returns</strong></p>\n</blockquote>\n\n<p>When you call os.Exit(0) you bypass the normal return procedure and your deferred functions are not executed. </p>\n\n<p>Also, even if the deferred worked inside the main goroutine, the defers in other goroutines would not work since they would die before returning. </p>\n\n<p>A better code architecture would allow you to get something similar. You need to think about your long running processes as workers. Export every long running process in workers and defer any clean up right after calling the worker. Use a select in the main goroutine to capture signals and synchronise work </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n    \"time\"\n)\n\nfunc check(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\n\nfunc main() {\n    ioutil.WriteFile(\"./foo.txt\", []byte(\"foo\"), 0644)\n    defer os.RemoveAll(\"./foo.txt\")\n\n    // Worker 1\n    done := make(chan bool, 1)\n    go func(done chan bool) {\n        fmt.Println(\"worker 1 with bar ...\")\n\n        ioutil.WriteFile(\"./bar.txt\", []byte(\"bar\"), 0644)\n\n        // various long running things\n        time.Sleep(3 * time.Second)\n        done &lt;- true\n    }(done)\n    defer os.RemoveAll(\"./bar.txt\")\n    // End worker1\n\n    s := make(chan os.Signal, 1)\n    signal.Notify(s, os.Interrupt)\n    signal.Notify(s, syscall.SIGTERM)\n\n    // Worker 2\n    done2 := make(chan bool, 1)\n    go func(done chan bool) {\n        fmt.Println(\"worker 2 ...\")\n        time.Sleep(6 * time.Second)\n        done &lt;- true\n    }(done2)\n    // End worker 2\n\n    select {\n    case &lt;-s:\n        fmt.Println(\"Quiting with signal - exit\")\n    case &lt;-done:\n        &lt;-done2\n    case &lt;-done2:\n        &lt;-done\n    }\n\n    return\n}\n</code></pre>\n\n<p>This select is a quick and dirty way to handle two workers, a better way would be to use sync.WaitGroup</p>\n"}, {"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 0, "last_activity_date": 1445314610, "creation_date": 1445314610, "answer_id": 33227904, "question_id": 33227063, "link": "https://stackoverflow.com/questions/33227063/best-way-to-clear-up-temporary-files/33227904#33227904", "title": "Best way to clear up temporary files", "body": "<p>I would recommend not relying on defer, but defining a reusable function that can be used in a defer or in the signal block. Something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n)\n\nfunc main() {\n    ioutil.WriteFile(\"./foo.txt\", []byte(\"foo\"), 0644)\n    cleanup := func(){\n       os.RemoveAll(\"./foo.txt\")\n       os.RemoveAll(\"./bar.txt\")\n    }\n    defer cleanup() //for normal return\n\n    go func() {\n        ioutil.WriteFile(\"./bar.txt\", []byte(\"bar\"), 0644)\n        for {\n            // various long running things\n        }\n    }()\n\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, os.Interrupt)\n    signal.Notify(c, syscall.SIGTERM)\n    go func() {\n        &lt;-c\n        fmt.Println(\"Received OS interrupt - exiting.\")\n        cleanup()\n        os.Exit(0)\n    }()\n\n    for {\n        // various long running things\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 365, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1445314991, "creation_date": 1445308715, "question_id": 33227063, "link": "https://stackoverflow.com/questions/33227063/best-way-to-clear-up-temporary-files", "title": "Best way to clear up temporary files", "body": "<p>Is there any way to exit a Go program, but execute all the pending defer statements?</p>\n\n<p>I've been clearing up temporary files by using defer, but the deferred statements aren't executed when the program is interrupted with Ctrl+C or even os.Exit. </p>\n\n<p>After exiting this program with Ctrl+C, both foo.txt and bar.txt are left over:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n)\n\nfunc main() {\n    ioutil.WriteFile(\"./foo.txt\", []byte(\"foo\"), 0644)\n    defer os.RemoveAll(\"./foo.txt\")\n\n    go func() {\n        ioutil.WriteFile(\"./bar.txt\", []byte(\"bar\"), 0644)\n        defer os.RemoveAll(\"./bar.txt\")\n        for {\n            // various long running things\n        }\n    }()\n\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, os.Interrupt)\n    signal.Notify(c, syscall.SIGTERM)\n    go func() {\n        &lt;-c\n        fmt.Println(\"Received OS interrupt - exiting.\")\n        os.Exit(0)\n    }()\n\n    for {\n        // various long running things\n    }\n}\n</code></pre>\n"}, {"tags": ["http", "go", "https", "network-programming", "connection"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1445349395, "post_id": 33226248, "comment_id": 54279995, "body": "You seem to just be asking &quot;how does http work&quot;? The go client handles http/1.1 (and http/2 in go1.6). If you understand the protocol, what the client does follows suit. This isn&#39;t the place for a tutorial on the details of http. If you want a <i>discussion</i> about how to use the client, the mailing list is a much better forum for that, but here you should pose specific questions."}], "answers": [{"comments": [{"owner": {"reputation": 118, "user_id": 3067627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa6ae3bcdb95860cdde8f54e7f4c32eb?s=128&d=identicon&r=PG&f=1", "display_name": "bawjensen", "link": "https://stackoverflow.com/users/3067627/bawjensen"}, "edited": false, "score": 1, "creation_date": 1445309048, "post_id": 33226638, "comment_id": 54258679, "body": "Ok, thanks! One question though, when the error states something along the lines of &quot;the connection was closed&quot;, is that the connection for a single request or is it more persistent, handling multiple &quot;GET&quot;s?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 118, "user_id": 3067627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa6ae3bcdb95860cdde8f54e7f4c32eb?s=128&d=identicon&r=PG&f=1", "display_name": "bawjensen", "link": "https://stackoverflow.com/users/3067627/bawjensen"}, "edited": false, "score": 0, "creation_date": 1445348706, "post_id": 33226638, "comment_id": 54279456, "body": "@bawjensen: a connection may or may not be persistent. This is up to the client to handle at the protocol level, you don&#39;t need to worry about it."}, {"owner": {"reputation": 118, "user_id": 3067627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa6ae3bcdb95860cdde8f54e7f4c32eb?s=128&d=identicon&r=PG&f=1", "display_name": "bawjensen", "link": "https://stackoverflow.com/users/3067627/bawjensen"}, "edited": false, "score": 0, "creation_date": 1445373468, "post_id": 33226638, "comment_id": 54294894, "body": "You&#39;re right, I don&#39;t <b>have</b> to worry about it. But since I&#39;m getting errors about connections and I&#39;m spending <b>a lot</b> of time establishing the cryptography around an HTTPS connection, maybe if I can optimize the behavior of the connections to my specific circumstances, I can eliminate those errors and speed up my code."}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": true, "score": 3, "last_activity_date": 1445422673, "last_edit_date": 1445422673, "creation_date": 1445304999, "answer_id": 33226638, "question_id": 33226248, "link": "https://stackoverflow.com/questions/33226248/network-golang-anatomy-of-a-get-request/33226638#33226638", "title": "Network/Golang - Anatomy of a &quot;GET&quot; request", "body": "<p>the network:</p>\n\n<p>dns->ip->tcp->http.  DNS resolve the domain to a ip address; tcp adding a port (like HTTP default 80) and others; http adding headers, form data and others. finally your http load in ip packet send from your network adapter and well processed by routers in Internet and will arrive to right http server.</p>\n\n<p>net/http:</p>\n\n<p>we have answer to all your transport layer questions in golang document, mainly <a href=\"https://golang.org/pkg/net/http/#RoundTripper\" rel=\"nofollow\">this</a>. please read it carefully.</p>\n\n<p>update:</p>\n\n<p>a connection error just effect one request. even if multiple request use same tcp connection, because the request-reponse pair goes one bye one, so one connection error will never make two request fail.</p>\n"}], "owner": {"reputation": 118, "user_id": 3067627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa6ae3bcdb95860cdde8f54e7f4c32eb?s=128&d=identicon&r=PG&f=1", "display_name": "bawjensen", "link": "https://stackoverflow.com/users/3067627/bawjensen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 0, "accepted_answer_id": 33226638, "answer_count": 1, "score": 0, "last_activity_date": 1445422673, "creation_date": 1445301985, "question_id": 33226248, "link": "https://stackoverflow.com/questions/33226248/network-golang-anatomy-of-a-get-request", "title": "Network/Golang - Anatomy of a &quot;GET&quot; request", "body": "<p>I imagine this is something that has been asked before, and answered, but I have no idea what to search to find it. This occurs to me as something that you would learn as part of a college course on computer networking - something I never took. If someone can point me towards the answer, that would be great.</p>\n\n<p>So, the question is:</p>\n\n<p>In many languages, like Go and JavaScript, it is relatively simple to make a \"GET\" request to an API over http/https. But what is happening under the surface, in a relatively high-level description?</p>\n\n<p>I ask because I need a better understanding to grasp how to handle various errors that I receive when things don't behave as they should.</p>\n\n<p>For an idea of the kind of answer I'm going for, I'll refer to the Golang method of making http calls. In Golang, you can import the <code>net/http</code> package and make the call as such <code>http.Get(\"http://www.example.com\")</code>. But you can also specify a \"client\" which you can configure to have things like specific customized headers, etc. You can specify some more complex things inside the client like the transport used, and more, stuff that I'm not really interested in unless it solves my problem.</p>\n\n<p>Basically, it comes down to this: Go is completely concurrent, and in my case parallel. I'm making around 300 requests every second to one API. The suggestion from the <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow\">golang docs</a> is that clients are safe for concurrent use, so should only instantiated once - essentially, I have one global client through which flows every request.</p>\n\n<p>If I get an error saying that a connection has been killed, does that affect one request, many requests, do I have to do anything to the client to get another connection?</p>\n\n<p>Also, is it one request per connection at a time, or is there a new connection made for every request? Are connections persistent between requests, what determines when they die?</p>\n\n<p>This question is probably pretty rambling, and may not make sense. If anyone can answer any section of it, that would greatly be appreciated.</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 17491, "user_id": 901827, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/86a6acccf7e8dbe398ebda4f8524ed50?s=128&d=identicon&r=PG", "display_name": "LinearZoetrope", "link": "https://stackoverflow.com/users/901827/linearzoetrope"}, "reply_to_user": {"reputation": 55, "user_id": 5464945, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e7f8e753bd6872d7f6efe66e21096d3a?s=128&d=identicon&r=PG&f=1", "display_name": "GoInterface", "link": "https://stackoverflow.com/users/5464945/gointerface"}, "edited": false, "score": 0, "creation_date": 1445327993, "post_id": 33226357, "comment_id": 54265872, "body": "Maybe it would be better to say that these types are defined, but they&#39;re passthrough-only. The only thing you can meaningfully/safely do with them is pass them back into Go code."}, {"owner": {"reputation": 55, "user_id": 5464945, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e7f8e753bd6872d7f6efe66e21096d3a?s=128&d=identicon&r=PG&f=1", "display_name": "GoInterface", "link": "https://stackoverflow.com/users/5464945/gointerface"}, "edited": false, "score": 0, "creation_date": 1445329916, "post_id": 33226357, "comment_id": 54266923, "body": "Yes, that&#39;s the point! Since the only thing I can do is pass them back. From where I could get them. Because, go cannot pass these types to me. I have no method to build one in C. this confuse me. Thanks for your patient, Jsor."}, {"owner": {"reputation": 17491, "user_id": 901827, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/86a6acccf7e8dbe398ebda4f8524ed50?s=128&d=identicon&r=PG", "display_name": "LinearZoetrope", "link": "https://stackoverflow.com/users/901827/linearzoetrope"}, "reply_to_user": {"reputation": 55, "user_id": 5464945, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e7f8e753bd6872d7f6efe66e21096d3a?s=128&d=identicon&r=PG&f=1", "display_name": "GoInterface", "link": "https://stackoverflow.com/users/5464945/gointerface"}, "edited": false, "score": 0, "creation_date": 1445334358, "post_id": 33226357, "comment_id": 54269819, "body": "That&#39;s what I said in my answer, you want to use the C struct from C, and then for all the code you call from C, you want to return a C.x instead of an X. You could even make a function like <code>func AsCType(x *X) *C.x</code> and call <code>AsCType(MyFunctionThatReturnsX())</code>."}, {"owner": {"reputation": 55, "user_id": 5464945, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e7f8e753bd6872d7f6efe66e21096d3a?s=128&d=identicon&r=PG&f=1", "display_name": "GoInterface", "link": "https://stackoverflow.com/users/5464945/gointerface"}, "edited": false, "score": 0, "creation_date": 1445340351, "post_id": 33226357, "comment_id": 54273681, "body": "Yes, I did what you said in my code. I #defined void * GoObject, and use it in my code for go struct types, it works fine. Maybe _cgo_export.h is just not a complete design till now. Thanks for your answer."}, {"owner": {"reputation": 55, "user_id": 5464945, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e7f8e753bd6872d7f6efe66e21096d3a?s=128&d=identicon&r=PG&f=1", "display_name": "GoInterface", "link": "https://stackoverflow.com/users/5464945/gointerface"}, "edited": false, "score": 0, "creation_date": 1445394659, "post_id": 33226357, "comment_id": 54301818, "body": "Those types are used internally by cgo.  They aren&#39;t documented and they aren&#39;t intended for use by the program using cgo."}], "tags": [], "owner": {"reputation": 17491, "user_id": 901827, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/86a6acccf7e8dbe398ebda4f8524ed50?s=128&d=identicon&r=PG", "display_name": "LinearZoetrope", "link": "https://stackoverflow.com/users/901827/linearzoetrope"}, "is_accepted": true, "score": 2, "last_activity_date": 1445315405, "last_edit_date": 1445315405, "creation_date": 1445302828, "answer_id": 33226357, "question_id": 33226125, "link": "https://stackoverflow.com/questions/33226125/cgo-how-to-represent-go-types-in-c/33226357#33226357", "title": "cgo how to represent go types in c?", "body": "<p>No, Go doesn't have any way to export types as \"C readable\". Further, you <strong>cannot</strong> reference a Go struct from within C, and it is not safe to try and finagle a C struct to \"look like\" a Go struct since you have no control over memory layout.</p>\n\n<p>The \"right\" way to do this is to create a type in a C file and add it as a field in the Go struct:</p>\n\n<pre><code>// from C\ntypedef struct x {\n    // fields\n} x;\n\n\n// From Go, include your .h file that defines this type.\ntype X struct {\n   c C.x\n}\n</code></pre>\n\n<p>Then operate on your type that way, and pass <code>C.x</code> into all your C functions instead of <code>x</code>.</p>\n\n<p>There are a couple other ways, (for instance, converting between them any time you want to use it as one or the other), but this one is the best in a vague general sense.</p>\n\n<p>Edit: a FEW Go types can be represented in C, for instance, <code>int64</code> will be defined in code that's compiled via cgo, but for the most part what I said holds.</p>\n"}], "owner": {"reputation": 55, "user_id": 5464945, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e7f8e753bd6872d7f6efe66e21096d3a?s=128&d=identicon&r=PG&f=1", "display_name": "GoInterface", "link": "https://stackoverflow.com/users/5464945/gointerface"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 750, "favorite_count": 0, "accepted_answer_id": 33226357, "answer_count": 1, "score": 1, "last_activity_date": 1445315405, "creation_date": 1445301086, "question_id": 33226125, "link": "https://stackoverflow.com/questions/33226125/cgo-how-to-represent-go-types-in-c", "title": "cgo how to represent go types in c?", "body": "<p><em>when export go func to c, the interface type port to GoInterface, and int to GoInt. How to port my c funcs to go with these types?</em></p>\n\n<p>a.h</p>\n\n<pre><code>void *SomeFunc(GoInterface arg);\n</code></pre>\n\n<p>a.c</p>\n\n<pre><code>void *SomeFunc(GoInterface arg) {\n}\n</code></pre>\n\n<p>a.go</p>\n\n<pre><code>package main\n\n// #include \"a.h\"\nimport \"C\"\n\ntype A struct {\n}\n\nfunc main() {\n    var a = new(A)\n}\n</code></pre>\n\n<p><em>when I go build:</em></p>\n\n<pre><code>cc errors for preamble:\nIn file included from ./a.go:3:0:\na.h:1:16: error: unknown type name 'GoInterface'\n void *SomeFunc(GoInterface arg)\n</code></pre>\n\n<p><em>Is there a header file for go like jni.h for java, So I can include there types.</em> </p>\n"}, {"tags": ["paypal", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445294862, "post_id": 33225037, "comment_id": 54254939, "body": "I don&#39;t know that this is the problem but using localhost as a redirect url is probably not allowed. Most servers will fail requests that send it along for purposes like that because it could expose a security vulnerability. Can you link to the docs for this request? In order to say if it&#39;s good or bad I gotta be able to compare it to what the API is expecting. Also, status code and any other information from the response body would generally be helpful."}, {"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445295107, "post_id": 33225037, "comment_id": 54255024, "body": "<a href=\"https://developer.paypal.com/docs/api/#create-a-payment\" rel=\"nofollow noreferrer\">developer.paypal.com/docs/api/#create-a-payment</a> thats how the request shall look like - As for using localhost well the problem is not there (I guess) since it says its malformed"}, {"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445295609, "post_id": 33225037, "comment_id": 54255202, "body": "The error MALFORMED_REQUEST on paypal docs says Incoming JSON request does not map to API request"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445296161, "post_id": 33225037, "comment_id": 54255383, "body": "That would imply the requests url is wrong but I don&#39;t think that&#39;s the case. Your request body seems fine. Can you get a good response from any other requests to that server?"}, {"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445296401, "post_id": 33225037, "comment_id": 54255461, "body": "Well yeah I make 1 request at first to get an oauth token and everything works fine"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445297264, "post_id": 33225037, "comment_id": 54255706, "body": "Yeah sorry I don&#39;t have any other advice than to trouble shoot it by stripping down your request to only the required arguments, getting something to work, then adding in more and more data until you have what you want working. Based on the docs and information above I&#39;d expect the request to succeed. Have you tried doing the same with curl? If you can make the request you want work through curl then you at least know there is something wrong with the Go code."}, {"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 1, "creation_date": 1445299326, "post_id": 33225037, "comment_id": 54256243, "body": "The docs show lowercase <code>payer</code> but you&#39;ve got <code>Payer</code>. It&#39;s probably dying on the case difference"}], "answers": [{"comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1445361723, "post_id": 33226166, "comment_id": 54288258, "body": "@AlvaroCarvajalNakosmai did you apply it recursively through all your types? Notice all their property names are lower cased. I can&#39;t see any difference between your schema and the one implemented in their example if that is the case."}, {"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1445367592, "post_id": 33226166, "comment_id": 54291690, "body": "Yeah on all structs. no idea what else to do"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1445367925, "post_id": 33226166, "comment_id": 54291881, "body": "@AlvaroCarvajalNakosmai I&#39;m running out of ideas. Couple things, firstly in their docs it shows the error string as <code>MALFORMED_REQUEST_ERROR</code> that&#39;s not what you posted in the question. Was that a mistake on your part? Is the value returned from their API different than what is documented? Can you verify the response is in fact from PayPal and not from an intermediary service like Akamai? If the error your getting is the documented one and the response comes directly from PayPal the only remaining advice I have is to contact them directly."}, {"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1445379570, "post_id": 33226166, "comment_id": 54297935, "body": "I added a pic of the body response Im getting"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1445383389, "post_id": 33226166, "comment_id": 54299143, "body": "@AlvaroCarvajalNakosmai when I get a minute I&#39;ll follow the link they returned. That response is certainly not what is documented in the broader documents location so I&#39;m pretty skeptical that PayPal is upholding their end of the bargain here."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 2, "last_activity_date": 1445301415, "creation_date": 1445301415, "answer_id": 33226166, "question_id": 33225037, "link": "https://stackoverflow.com/questions/33225037/go-paypal-rest-api-request/33226166#33226166", "title": "Go paypal REST API request", "body": "<p>As pointed out by @jcbwlkr you're casing doesn't match what is in the docs. If you don't have json tags on your types you'll have to add them. You have to keep the property names uppercase in Go because it's what marks the fields as being exported. If you're not familiar with this do a search for 'unexported vs exported fields golang'</p>\n\n<p>For example your <code>Payment</code> structs definition needs to look like this;</p>\n\n<pre><code>type Payment struct {\n     Amount *Amount `json:\"amount\"`\n     Transactions *Transactions `json:\"transactions\"`\n     RdUrls *Redirect_urls `json:\"redirect_urls\"`\n}\n</code></pre>\n\n<p>Also, just fyi you can use nest those declarations where you declare the payment so you don't have to assign to local instances of <code>Amount</code>, <code>Transactions</code> and <code>Redirect_urls</code> in order to do the declaration.</p>\n\n<p>It's just like;</p>\n\n<pre><code>p := &amp;Payment{\"sale\", payer, &amp;Transactions{amount, \"A super test\"}, uris}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "is_accepted": true, "score": 0, "last_activity_date": 1445421562, "creation_date": 1445421562, "answer_id": 33256264, "question_id": 33225037, "link": "https://stackoverflow.com/questions/33225037/go-paypal-rest-api-request/33256264#33256264", "title": "Go paypal REST API request", "body": "<p>The problem was transactions needed to be an array. how blind I am</p>\n\n<pre><code>Transactions []*Transactions `json:\"transactions\"`\n</code></pre>\n"}], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 33256264, "answer_count": 2, "score": -1, "last_activity_date": 1445421562, "creation_date": 1445293876, "last_edit_date": 1445379552, "question_id": 33225037, "link": "https://stackoverflow.com/questions/33225037/go-paypal-rest-api-request", "title": "Go paypal REST API request", "body": "<p>So Im currently using Go and Im trying to create a payment for Paypal I been trying this code</p>\n\n<pre><code>    payer := &amp;Payer{\"paypal\"}\n    amount := &amp;Amount{\"EUR\", \"12\"}\n    trans := &amp;Transactions{amount, \"A super test\"}\n    uris := &amp;Redirect_urls{\"http://localhost\", \"http://localhost\"}\n    p := &amp;Payment{\"sale\", payer, trans, uris}\n    response, err := json.Marshal(p)\n    if err != nil {\n        log.Println(\"Error at PaypalPayment - buy controller\")\n        log.Fatal(err)\n    }\n    log.Println(string(response))\n\n    client := &amp;http.Client{}\n    buf := bytes.NewBuffer(response)\n    req, err := http.NewRequest(\"POST\", \"https://api.sandbox.paypal.com/v1/payments/payment\", buf)\n    if err != nil {\n        log.Println(\"Error at PaypalPayment - buy controller - 2\")\n        log.Fatal(err)\n    }\n    req.Header.Set(\"Content-Type\", \"application/json\")\n    req.Header.Set(\"Authorization\", \"Bearer \" + token.Access_token)\n    resp, err := client.Do(req)\n    if err != nil {\n        log.Println(\"Error at PaypalPayment - buy controller - 3\")\n        log.Fatal(err)\n    }\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Println(\"Error at PaypalPayment - buy controller - 4\")\n        log.Fatal(err)\n    }\n    log.Println(string(body))\n</code></pre>\n\n<p>I already got the access token, the problem is Im getting this error on the response body (last line)</p>\n\n<blockquote>\n  <p>MALFORMED_REQUEST</p>\n</blockquote>\n\n<p>The request Im using is this (as of the println)</p>\n\n<pre><code>{\n   \"Intent\":\"sale\",\n   \"Payer\":{\n      \"Payment_method\":\"paypal\"\n   },\n   \"Transactions\":{\n      \"Amount\":{\n         \"Currency\":\"EUR\",\n         \"Total\":\"12\"\n      },\n      \"Description\":\"Super test\"\n   },\n   \"Redirect_urls\":{\n      \"Return_url\":\"http://localhost\",\n      \"Cancel_url\":\"http://localhost\"\n   }\n}\n</code></pre>\n\n<p>At my eyes seems a good request... no idea what im missing\n<a href=\"https://i.stack.imgur.com/4Fu0m.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4Fu0m.png\" alt=\"Error image\"></a></p>\n"}, {"tags": ["json", "go", "gorilla", "mux"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1445292157, "post_id": 33224464, "comment_id": 54253927, "body": "Where in <code>&#47;data?name=&quot;bill&quot;&amp;value=&quot;red&quot;</code> should some JSON be hidden? What would be wrong with plain parsing the URL?"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1445299579, "post_id": 33224464, "comment_id": 54256305, "body": "<code>mux.Vars</code> is when you&#39;re using gorilla/mux&#39;s URL parameter binding. If you want to parse the query string params you can just use <a href=\"https://golang.org/pkg/net/http/#Request.FormValue\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Request.FormValue</a> or <code>request.URL</code> with <code>net&#47;url</code> to parse them."}], "answers": [{"tags": [], "owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "is_accepted": true, "score": 0, "last_activity_date": 1445339506, "last_edit_date": 1495541963, "creation_date": 1445339506, "answer_id": 33235117, "question_id": 33224464, "link": "https://stackoverflow.com/questions/33224464/how-to-list-all-variables-in-gorilla-mux/33235117#33235117", "title": "How to list all variables in Gorilla Mux?", "body": "<p>For list all Gorilla Mux:</p>\n\n<pre><code>for k, v := range mux.Vars(request) {\n    log.Printf(\"key=%v, value=%v\", k, v)\n}\n</code></pre>\n\n<p>The <code>Vars</code> function return a <code>map</code>, <code>for range</code> loop help you read all the items like I show you.<br>\nBut I think your question is a bit different, if you want to read the JSON data or other kid of data that send with the request, you need to read the request Body (req.Body). Note that request Body is a Reader interface not a string. An example if you expect the input in JSON format:<br>\n<a href=\"https://stackoverflow.com/questions/15672556/handling-json-post-request-in-go\">Handling JSON Post Request in Go</a></p>\n"}], "owner": {"reputation": 13, "user_id": 5282597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b328c419ea1edf192beedf3df1598d86?s=128&d=identicon&r=PG&f=1", "display_name": "user65271", "link": "https://stackoverflow.com/users/5282597/user65271"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1936, "favorite_count": 0, "accepted_answer_id": 33235117, "answer_count": 1, "score": -2, "last_activity_date": 1445339506, "creation_date": 1445291126, "question_id": 33224464, "link": "https://stackoverflow.com/questions/33224464/how-to-list-all-variables-in-gorilla-mux", "title": "How to list all variables in Gorilla Mux?", "body": "<p>When you create a funcHandler in Golang and use Gorilla Mux, I know that you can access a specific input variable by calling Mux.Vars. However, I'm not sure how that works when you have data stored in JSON format, and part of that is because I'm not sure how Mux.Vars() works. So, I'd like to know how to list all variables stored by Mux.Vars() when you enter a funcHandler and how to parse JSON stored in a URL (ie, /data?name=\"bill\"&amp;value=\"red\", where I would want to find the value of the name and value keys). </p>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445290360, "post_id": 33223699, "comment_id": 54253166, "body": "What package are you using for postgres? I think your problem is along the lines of what I put in my now deleted answer however my language is definitely wrong. The <code>*DB</code> object returned from <code>Open</code> can be used to manage multiple connections, your driver may very well have the limit at one or not be designed to open new connections each driver has it&#39;s own implementation, a list of them can be found here; <a href=\"https://github.com/golang/go/wiki/SQLDrivers\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/SQLDrivers</a>"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1445292509, "post_id": 33223699, "comment_id": 54254078, "body": "<a href=\"https://github.com/lib/pq\" rel=\"nofollow noreferrer\">github.com/lib/pq</a>  I&#39;ve looked over the sourcecode, and it doesn&#39;t <i>seem</i> to have any limits that I can find.  Generally, drivers are encouraged to let golang handle the pooling, from what I can tell."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1445294299, "post_id": 33223699, "comment_id": 54254725, "body": "hmm I&#39;m not sure but if you look at the source here it seems most of the responsibility is on the driver; <a href=\"https://golang.org/src/database/sql/sql.go?s=5752:6728#L211\" rel=\"nofollow noreferrer\">golang.org/src/database/sql/sql.go?s=5752:6728#L211</a>"}], "answers": [{"comments": [{"owner": {"reputation": 719, "user_id": 740165, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a87c1e04a4db3550c89de947fef393a4?s=128&d=identicon&r=PG", "display_name": "Matthew Clark", "link": "https://stackoverflow.com/users/740165/matthew-clark"}, "edited": false, "score": 0, "creation_date": 1472244044, "post_id": 33241341, "comment_id": 65690936, "body": "As a side note, if you want to have it not wait if it can&#39;t get a lock then you can add <code>NOWAIT</code> to the query. source: <a href=\"http://stackoverflow.com/questions/23702284/how-to-manually-lock-and-unlock-a-row\" title=\"how to manually lock and unlock a row\">stackoverflow.com/questions/23702284/&hellip;</a>"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 719, "user_id": 740165, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a87c1e04a4db3550c89de947fef393a4?s=128&d=identicon&r=PG", "display_name": "Matthew Clark", "link": "https://stackoverflow.com/users/740165/matthew-clark"}, "edited": false, "score": 0, "creation_date": 1472454792, "post_id": 33241341, "comment_id": 65740673, "body": "Ooooo, that&#39;s also handy.  I&#39;ll have to keep that one in mind.  Thanks, @MatthewClark!"}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 3, "last_activity_date": 1445356708, "creation_date": 1445356708, "answer_id": 33241341, "question_id": 33223699, "link": "https://stackoverflow.com/questions/33223699/golang-concurrent-sql-transactions/33241341#33241341", "title": "Golang Concurrent SQL Transactions", "body": "<p>After further research, it looks like this isn't actually an issue with Golang, or the SQL or PQ packages.  This is an inherent (and by design) behavior within PostgreSQL:</p>\n\n<blockquote>\n  <p>UPDATE, DELETE, SELECT FOR UPDATE, and SELECT FOR SHARE commands behave the same as SELECT in terms of searching for target rows: they will only find target rows that were committed as of the command start time. However, such a target row might have already been updated (or deleted or locked) by another concurrent transaction by the time it is found. In this case, the would-be updater will wait for the first updating transaction to commit or roll back (if it is still in progress). </p>\n</blockquote>\n\n<p><a href=\"http://www.postgresql.org/docs/9.1/static/transaction-iso.html\" rel=\"nofollow\">http://www.postgresql.org/docs/9.1/static/transaction-iso.html</a></p>\n\n<p>So the block is occurring in Postgres, not in Go.  This can be confirmed by running concurrent transactions that Update (or Insert or Delete, et al) the same record in separate terminals using <code>psql</code>.  The second Update/Insert/Delete will block until the transaction in which the first one was called either calls COMMIT or ROLLBACK.</p>\n"}], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6144, "favorite_count": 2, "accepted_answer_id": 33241341, "answer_count": 1, "score": 4, "last_activity_date": 1445356708, "creation_date": 1445287952, "last_edit_date": 1445288929, "question_id": 33223699, "link": "https://stackoverflow.com/questions/33223699/golang-concurrent-sql-transactions", "title": "Golang Concurrent SQL Transactions", "body": "<p>Running into an issues with concurrency and SQL transactions.  I have the (stubbed) code below (error checks and such removed for clarity):</p>\n\n<pre><code>dao, _ := sql.Open(\"postgres\", args)\n\ntx1 := dao.Begin()\nres, _ := tx1.Exec(\"UPDATE &lt;...&gt;\", args...)\n// error check\n\ntx2 := dao.Begin()\nres, _ = tx2.Exec(\"UPDATE &lt;same&gt;\", args...)\n\n_ = tx1.Commit()\n\n_ = tx2.Commit()\n</code></pre>\n\n<p>This occurs within a unit test.  The idea is to force a concurrency failure, since the two Execs are trying to update the same row, to make sure the proper conflict error response is given.  However, the second Exec blocks permanently.  </p>\n\n<p>As far as I can tell, this type of blocking is only supposed to occur if the DB is out of database connections, but transactions are all supposed to run in their own (exclusive) connections, and I'm not setting a max connections anywhere (I've also tried setting it to something like 100, no effect).  </p>\n\n<p>Here's the strange part.  If I separate out the tx2 Exec() and Commit() into a separate goroutine with a synchronizing channel to block the main thread from running tx1.Commit() until tx2 has run it's Exec(), the same thing happens, block indefinitely on the tx2.Exec().  If I use a time.Sleep() instead of a sync channel, the tx2.Exec blocks until the sleep finishes and tx1.Commit() is run, then completes with the expected error (<code>pq: could not serialize access due to concurrent update</code>)</p>\n\n<p>Am I missing something about how golang's SQL package, or the postgres driver, handles connection pools?  Why is the second transaction Exec blocking until the first one is committed?  Isn't the point of transactions that the two can run simultaneously, and whichever commits (or is it starts?) first wins?</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"comments": [{"owner": {"reputation": 273, "user_id": 5250918, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a241b785773d58ae2cd8be649f9b97a?s=128&d=identicon&r=PG&f=1", "display_name": "Kaign", "link": "https://stackoverflow.com/users/5250918/kaign"}, "edited": false, "score": 0, "creation_date": 1445284952, "post_id": 33222620, "comment_id": 54250341, "body": "But what exactly happens when I first visit my localhost page? I thought that it doesn&#39;t do anything that could be recognized as code modification"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1445285078, "last_edit_date": 1445285078, "creation_date": 1445283865, "answer_id": 33222620, "question_id": 33222556, "link": "https://stackoverflow.com/questions/33222556/second-execution-of-func-init-in-gae/33222620#33222620", "title": "Second Execution of func init() in GAE", "body": "<p>It is perfectly fine.</p>\n\n<p>The Go AppEngine SDK monitors the application's code base, and whenever it detects changes (e.g. you modified a <code>.go</code> source file) it automatically reloads your application. This includes / involves unloading your code and reloading it -  running <code>init()</code> functions again.</p>\n\n<p>Basically control over when an app is reloaded - and therefore execution of the <code>init()</code> functions - is in the \"hands\" of the SDK. Try to modify a <code>.go</code> file and hit refresh in the browser: you will experience another <code>init()</code> function execution.</p>\n\n<p>When you first start your app, all the code is loaded/compiled (and <code>init()</code> functions get executed) - this needs to be done in order to report if there are errors. After that the SDK may unload it (not sure - couldn't find relevant docs) and only load it again if a request does happen (which may or may not come anytime soon).</p>\n"}], "owner": {"reputation": 273, "user_id": 5250918, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a241b785773d58ae2cd8be649f9b97a?s=128&d=identicon&r=PG&f=1", "display_name": "Kaign", "link": "https://stackoverflow.com/users/5250918/kaign"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 33222620, "answer_count": 1, "score": 1, "last_activity_date": 1445285078, "creation_date": 1445283632, "question_id": 33222556, "link": "https://stackoverflow.com/questions/33222556/second-execution-of-func-init-in-gae", "title": "Second Execution of func init() in GAE", "body": "<p>I have very simple code, my .go file:</p>\n\n<pre><code>func init() {\nhttp.HandleFunc(\"/\", handlerMain)\nlog.Println(\"init executed\")\n}\n\nfunc handlerMain(w http.ResponseWriter, r *http.Request) {\nfmt.Fprintf(w, \"TEST\")\n}\n</code></pre>\n\n<p>and app.yaml:</p>\n\n<pre><code>application: newsboard\nversion: 1\nruntime: go\napi_version: go1 \n\nhandlers:\n- url: /.* \n  script: _go_app\n</code></pre>\n\n<p>When Executed at first everything goes fine, this is output from console</p>\n\n<pre><code>INFO     2015-10-19 19:28:56,626 devappserver2.py:763] Skipping SDK update check.\nINFO     2015-10-19 19:28:56,652 api_server.py:205] Starting API server at: http://localhost:56946\nINFO     2015-10-19 19:28:56,655 dispatcher.py:197] Starting module \"default\" running at: http://localhost:8080\nINFO     2015-10-19 19:28:56,658 admin_server.py:116] Starting admin server at: http://localhost:8000\n2015/10/19 19:28:59 init executed\n</code></pre>\n\n<p>But when I Enter <a href=\"http://localhost:8080\" rel=\"nofollow\">http://localhost:8080</a> I get following:</p>\n\n<pre><code>INFO     2015-10-19 19:32:16,394 module.py:786] default: \"GET / HTTP/1.1\" 200 4\n2015/10/19 19:32:16 init executed\n</code></pre>\n\n<p>So init() somehow is being executed twice. Then, Every time when I reload page everething is ok,\"init executed\" doesn't appear in console anymore.\nMy question: Why init() happens twice and is this okay?</p>\n"}, {"tags": ["json", "performance", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1445282162, "post_id": 33222075, "comment_id": 54248793, "body": "python&#39;s json library is mostly optimized C. These <i>should</i> be around the same speed to start with (that&#39;s not to say there couldn&#39;t be other optimizations, I haven&#39;t looked)"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 3, "creation_date": 1445282691, "post_id": 33222075, "comment_id": 54249076, "body": "I haven&#39;t done a side by side to compare but I&#39;d be surprised if unmarshalling into a struct wouldn&#39;t improve performance. I mean, why are you deserializing into a map just so that you can explicitly assign every value while having to specify the type?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1445282982, "post_id": 33222075, "comment_id": 54249242, "body": "@evanmcdonnal&#39;s comment is probably the only big change you can easily make to this code, use a struct with proper tags. Next step would be to make a json.Unmarshaler to avoid the reflection (and could do the etime parsing for you at the same time). If you want ffjson to do this for you, that&#39;s another question."}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1445402224, "post_id": 33222075, "comment_id": 54303762, "body": "You can also add paralelisim to gain more speed. For example creating for workers, one per CPU and read part of the file, for lines 500 to 1000 etc."}], "answers": [{"comments": [{"owner": {"reputation": 393, "user_id": 2708215, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/09b61fdf2abd311263f2ab2e4c0a48aa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/2708215/andrew"}, "edited": false, "score": 0, "creation_date": 1445285552, "post_id": 33222371, "comment_id": 54250659, "body": "I will post how it works.  I&#39;m trying now to integrate it into my code.  It&#39;s a long process... I&#39;m very new at this, and I&#39;d like to do it without asking questions.  Thank you."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 393, "user_id": 2708215, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/09b61fdf2abd311263f2ab2e4c0a48aa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/2708215/andrew"}, "edited": false, "score": 2, "creation_date": 1445286503, "post_id": 33222371, "comment_id": 54251190, "body": "@Andrew: I had a minute to test (during a long, non-go related build ;) ), and this will give you the best improvement (I got 36% faster). If you want to try and squeeze another 10% or so, you can give ffjson a try, but there&#39;s not a huge gain with a small, simple repeating structure like this."}, {"owner": {"reputation": 393, "user_id": 2708215, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/09b61fdf2abd311263f2ab2e4c0a48aa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/2708215/andrew"}, "edited": false, "score": 0, "creation_date": 1445288128, "post_id": 33222371, "comment_id": 54252072, "body": "Nice!   <code>$ time cat &#47;mnt&#47;ramdisk&#47;logfile | .&#47;stdin_conv_typed &gt; &#47;dev&#47;null  real\t0m37.862s</code>.  Thank you very much.  Sorry for taking so long, but it&#39;s been educational."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 393, "user_id": 2708215, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/09b61fdf2abd311263f2ab2e4c0a48aa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/2708215/andrew"}, "edited": false, "score": 0, "creation_date": 1445288708, "post_id": 33222371, "comment_id": 54252354, "body": "@Andrew np! Thanks for the confirmation. Ideally I would test it anyway but I&#39;m not working in Go currently so it would have been fairly time consuming for me to get things set up."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 5, "last_activity_date": 1445283032, "creation_date": 1445283032, "answer_id": 33222371, "question_id": 33222075, "link": "https://stackoverflow.com/questions/33222075/speeding-up-json-parsing-in-go/33222371#33222371", "title": "Speeding up JSON parsing in Go", "body": "<p>Try using a type to remove all this unnecessary assignment and type assertion;</p>\n\n<pre><code>type RenameMe struct {\n     Status string `json:\"status\"`\n     Astatus string `json:\"a_status\"`\n     Method string `json:\"method\"`\n     Path string `json:\"path\"`\n     ElementUid string `json:\"element_uid\"`\n     TimeLocal time.Time `json:\"time_local\"`\n     Etime time.Time // deal with this after the fact\n}\n\ndata := &amp;RenameMe{}\nif err := json.Unmarshal(byt, data); err != nil {\n            break\n        }\n\ndata.Etime,  _ := time.Parse(\"[02/Jan/2006:15:04:05 -0700]\", time_local)\n</code></pre>\n\n<p>I'm not going to test this to ensure it outperforms your code but I bet it does by a large margin. Give it a try and let me know please.</p>\n"}, {"tags": [], "owner": {"reputation": 3038, "user_id": 568689, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/3a68e2585beb59c1bd2a19c46045f57b?s=128&d=identicon&r=PG", "display_name": "Eden", "link": "https://stackoverflow.com/users/568689/eden"}, "is_accepted": false, "score": 0, "last_activity_date": 1445407519, "creation_date": 1445407519, "answer_id": 33252056, "question_id": 33222075, "link": "https://stackoverflow.com/questions/33222075/speeding-up-json-parsing-in-go/33252056#33252056", "title": "Speeding up JSON parsing in Go", "body": "<p>Check <a href=\"https://github.com/pquerna/ffjson\" rel=\"nofollow\">https://github.com/pquerna/ffjson</a></p>\n\n<p>I saw 3x improvements over the standard json marshal/unmarshal method employed by the standard lib. It does so by rewrite the source and removing the need for reflection.</p>\n"}, {"tags": [], "owner": {"reputation": 662, "user_id": 2002739, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/ppQ7I.jpg?s=128&g=1", "display_name": "Martian Puss", "link": "https://stackoverflow.com/users/2002739/martian-puss"}, "is_accepted": false, "score": 1, "last_activity_date": 1484185645, "creation_date": 1484185645, "answer_id": 41603823, "question_id": 33222075, "link": "https://stackoverflow.com/questions/33222075/speeding-up-json-parsing-in-go/41603823#41603823", "title": "Speeding up JSON parsing in Go", "body": "<p><a href=\"http://jsoniter.com/\" rel=\"nofollow noreferrer\">http://jsoniter.com/</a> declares itself to be the fastest json parser, golang and java implementations are provided. Two types of api can be used. And pre-injected json object definition is optional. </p>\n"}], "owner": {"reputation": 393, "user_id": 2708215, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/09b61fdf2abd311263f2ab2e4c0a48aa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/2708215/andrew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3571, "favorite_count": 0, "accepted_answer_id": 33222371, "answer_count": 3, "score": 1, "last_activity_date": 1484185645, "creation_date": 1445281907, "question_id": 33222075, "link": "https://stackoverflow.com/questions/33222075/speeding-up-json-parsing-in-go", "title": "Speeding up JSON parsing in Go", "body": "<p>We have transaction log files in which each transaction is a single line in JSON format.  We often need to take selected parts of the data, perform a single time conversion, and feed results into another system in a specific format.  I wrote a Python script that does this as we need, but I hoped that Go would be faster, and would give me a chance to start learning Go.  So, I wrote the following:</p>\n\n<pre><code>package main\nimport \"encoding/json\"\nimport \"fmt\"\nimport \"time\"\nimport \"bufio\"\nimport \"os\"\n\nfunc main() {\n\n    sep := \",\"\n\n    reader := bufio.NewReader(os.Stdin)\n\n    for {\n        data, _ := reader.ReadString('\\n')\n        byt := []byte(data)\n\n        var dat map[string]interface{}\n\n        if err := json.Unmarshal(byt, &amp;dat); err != nil {\n            break\n        }\n\n        status := dat[\"status\"].(string)\n        a_status := dat[\"a_status\"].(string)\n        method := dat[\"method\"].(string)\n        path := dat[\"path\"].(string)\n        element_uid := dat[\"element_uid\"].(string)\n        time_local := dat[\"time_local\"].(string)\n        etime, _ := time.Parse(\"[02/Jan/2006:15:04:05 -0700]\", time_local)\n        fmt.Print(status, sep, a_status, sep, method, sep, path, sep, element_uid, sep, etime.Unix(), \"\\n\")\n    }\n}\n</code></pre>\n\n<p>That compiles without complaint, but I'm surprised at the lack of performance improvement.  To test, I placed 2,000,000 lines of logs into a tmpfs (to ensure that disk I/O would not be a limitation) and compared the two versions of the script.  My results:</p>\n\n<pre><code>$ time cat /mnt/ramdisk/logfile | ./stdin_conv &gt; /dev/null \nreal    0m51.995s\n\n$ time cat /mnt/ramdisk/logfile | ./stdin_conv.py &gt; /dev/null \nreal    0m52.471s\n\n$ time cat /mnt/ramdisk/logfile &gt; /dev/null \nreal    0m0.149s\n</code></pre>\n\n<p>How can this be made faster?  I have made some rudimentary efforts.  The ffjson project, for example, proposes to create static functions that make reflection unnecessary; however, I have failed so far to get it to work, getting the error:</p>\n\n<pre><code>Error: Go Run Failed for: /tmp/ffjson-inception810284909.go\nSTDOUT:\n\nSTDERR:\n/tmp/ffjson-inception810284909.go:9:2: import \"json_parse\" is a program, not an importable package\n\n:\n</code></pre>\n\n<p>Besides, wouldn't what I have above be considered statically typed?  Possibly not-- I am positively dripping behind the ears where Go is concerned.  I have tried selectively disabling different attributes in the Go code to see if one is especially problematic.  None have had an appreciable effect on performance.  Any suggestions on improving performance, or is this simply a case where compiled languages have no substantial benefit over others?</p>\n"}, {"tags": ["go", "stop-words"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1445265992, "post_id": 33217194, "comment_id": 54239034, "body": "What&#39;s your bottleneck when you profile your program?"}, {"owner": {"reputation": 871, "user_id": 4082595, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-6W6eHjAujPs/AAAAAAAAAAI/AAAAAAAACLs/wb0Bm2pFt4U/photo.jpg?sz=128", "display_name": "Benjamin BALET", "link": "https://stackoverflow.com/users/4082595/benjamin-balet"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1445266147, "post_id": 33217194, "comment_id": 54239151, "body": "The line that tests if it is a stop words... either if _, ok := dict[w]; ok { or if filter.Test([]byte(w)) {"}], "answers": [{"comments": [{"owner": {"reputation": 871, "user_id": 4082595, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-6W6eHjAujPs/AAAAAAAAAAI/AAAAAAAACLs/wb0Bm2pFt4U/photo.jpg?sz=128", "display_name": "Benjamin BALET", "link": "https://stackoverflow.com/users/4082595/benjamin-balet"}, "edited": false, "score": 0, "creation_date": 1445270166, "post_id": 33217507, "comment_id": 54242009, "body": "Thank you. The exact expression should be something like var filter = regexp.MustCompile(<code>\\A(a|along|another|yet)\\z</code>) although you wanted to do something else than a match ? With a match this improve the speed by a factor of 60%."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "reply_to_user": {"reputation": 871, "user_id": 4082595, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-6W6eHjAujPs/AAAAAAAAAAI/AAAAAAAACLs/wb0Bm2pFt4U/photo.jpg?sz=128", "display_name": "Benjamin BALET", "link": "https://stackoverflow.com/users/4082595/benjamin-balet"}, "edited": false, "score": 1, "creation_date": 1445270344, "post_id": 33217507, "comment_id": 54242135, "body": "@BenjaminBALET I would suggest not using the word splitter and trying to match individual words -- instead, match the stopword regex against the whole input string. That way the regex engine can efficiently skip over large numbers of non-matching words. If <code>ReplaceAllFunc</code> isn&#39;t powerful enough, then <code>FindStringIndex</code> should help you do the job."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 4, "last_activity_date": 1445266199, "creation_date": 1445266199, "answer_id": 33217507, "question_id": 33217194, "link": "https://stackoverflow.com/questions/33217194/in-golang-what-is-the-fastest-way-to-remove-stop-words/33217507#33217507", "title": "In golang, what is the fastest way to remove stop words?", "body": "<p>Try building a regex by pasting together all of your candidate words with <code>|</code> and compiling it ahead of time. The RE2 regex engine will convert the big list of alternations into an efficient trie data structure for matching. You can do it like:</p>\n\n<pre><code>reStr := \"\"\n\nfor i, word := range words {\n    if i != 0 {\n        reStr += `|`\n    }\n    reStr += `\\Q` + word + `\\E`\n}\nre := regexp.MustCompile(reStr)\n</code></pre>\n\n<p>(the <code>\\Q</code> and <code>\\E</code> prevent any problems in the unlikely case that any of the words in the list contain regex metacharacters, and are harmless otherwise).</p>\n"}], "owner": {"reputation": 871, "user_id": 4082595, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-6W6eHjAujPs/AAAAAAAAAAI/AAAAAAAACLs/wb0Bm2pFt4U/photo.jpg?sz=128", "display_name": "Benjamin BALET", "link": "https://stackoverflow.com/users/4082595/benjamin-balet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1274, "favorite_count": 0, "accepted_answer_id": 33217507, "answer_count": 1, "score": 0, "last_activity_date": 1445279107, "creation_date": 1445265294, "question_id": 33217194, "link": "https://stackoverflow.com/questions/33217194/in-golang-what-is-the-fastest-way-to-remove-stop-words", "title": "In golang, what is the fastest way to remove stop words?", "body": "<p>I've created a go <a href=\"https://github.com/bbalet/stopwords\" rel=\"nofollow\">package to remove stopwords</a> and I'm trying to optimize it.</p>\n\n<p>Based on my research, the average list of stop words in many languages contains around 300 words.</p>\n\n<p>In the current version of the package, I'm using a simple map in order to store the list of stop words. Then, I break words in the original content and recreate a filtered content by adding the words that are not in the map (of stopwords).</p>\n\n<p>I've tried to use a <a href=\"https://github.com/willf/bloom\" rel=\"nofollow\">bloom filter</a>, but it doesn't improve the performance. I think it's due to two factors :</p>\n\n<ul>\n<li>Bloom filters are fast when it comes to search into a large set, but they cost a lot to build (even if it is built once). So the overall gain is little where m is about 300.</li>\n<li>In the current version, I used maps and, if I remeber well, go builds a hashmap for searching the key faster.</li>\n</ul>\n\n<p>Is there a faster way?</p>\n"}, {"tags": ["bash", "go", "ansible", "ansible-playbook", "gvm"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1445262687, "post_id": 33216185, "comment_id": 54236341, "body": "When are you sourcing the gvm environment? Your ansible task is only calling &#39;gvm&#39;."}, {"owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1445262907, "post_id": 33216185, "comment_id": 54236509, "body": "@JimB I have updated the main question with reference to the sourcing."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1445263086, "post_id": 33216185, "comment_id": 54236659, "body": "Ansible tasks are run independently. Changing the environment in one shell doesn&#39;t affect another. You need to install gvm in a manner that you can call it directly with the correct environment. If it&#39;s just a PATH problem, use the full path."}], "answers": [{"tags": [], "owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "is_accepted": true, "score": 0, "last_activity_date": 1445265050, "creation_date": 1445265050, "answer_id": 33217102, "question_id": 33216185, "link": "https://stackoverflow.com/questions/33216185/ansible-gvm-go-version-manager/33217102#33217102", "title": "Ansible GVM - Go Version Manager", "body": "<p>I ended up running two commands in the ansible command</p>\n\n<pre><code>name: Install go\n  shell: . /etc/profile.d/golang.sh &amp;&amp; gvm install go1.5 executable=/bin/bash\n</code></pre>\n\n<p>This ensures the source has been set then allows the <code>gvm</code> command to be run.</p>\n"}], "owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 0, "accepted_answer_id": 33217102, "answer_count": 1, "score": 0, "last_activity_date": 1445265050, "creation_date": 1445262535, "last_edit_date": 1445262878, "question_id": 33216185, "link": "https://stackoverflow.com/questions/33216185/ansible-gvm-go-version-manager", "title": "Ansible GVM - Go Version Manager", "body": "<p>Writing my first Ansible Script. I am trying to install GVM.</p>\n\n<p>I install GVM ok (I logged into the box and checked) when I run gvm version on the box direct I get: <code>Go Version Manager v1.0.22 installed at /d1/golang/gvm</code></p>\n\n<p>But when I run it as a command in Ansible:</p>\n\n<pre><code>- name: GVM Version\n  shell: gvm version\n  become: yes\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>failed: [prod2] =&gt; {\"changed\": true, \"cmd\": \"gvm version\", \"delta\": \"0:00:00.002081\", \"end\": \"2015-10-19 13:41:54.123575\", \"rc\": 127, \"start\": \"2015-10-19 13:41:54.121494\", \"warnings\": []}\nstderr: /bin/bash: gvm: command not found\n\nFATAL: all hosts have already failed -- aborting\n</code></pre>\n\n<p>I am running a bash script which contains: <code>source /d1/golang/gvm/scripts/gvm</code> which is supposed to ensure you don't have to restart the terminal - see ansible command below.</p>\n\n<pre><code>- name: Run gvm source\n  shell: . /etc/profile.d/golang.sh executable=/bin/bash\n  become: yes\n</code></pre>\n\n<p>Any ideas what I am doing wrong?</p>\n"}, {"tags": ["c", "go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1445259885, "post_id": 33212939, "comment_id": 54234241, "body": "A c program with a <code>main</code> isn&#39;t usually used as a library. Why are you trying to do this?"}, {"owner": {"reputation": 8608, "user_id": 1091116, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/15098b2b940cacd8b4d07026e01e3102?s=128&d=identicon&r=PG", "display_name": "d33tah", "link": "https://stackoverflow.com/users/1091116/d33tah"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1445259996, "post_id": 33212939, "comment_id": 54234309, "body": "@JimB: To be able to partially port a C program to Go - the way I understand it, I need to call the program within Go runtime first and then I should be able to make C and Go talk both ways."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1445260179, "post_id": 33212939, "comment_id": 54234453, "body": "You need your <code>main</code> entry point to be in Go. You should probably change <code>main</code> in the C program to something else."}], "answers": [{"tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": true, "score": 8, "last_activity_date": 1445263305, "last_edit_date": 1445263305, "creation_date": 1445260236, "answer_id": 33215335, "question_id": 33212939, "link": "https://stackoverflow.com/questions/33212939/how-to-wrap-a-c-hello-world-with-argv-using-cgo/33215335#33215335", "title": "How to wrap a C &quot;hello world&quot; with argv using cgo?", "body": "<p>I get the same result when using <code>go run main.go</code>, but when using <code>go build .</code>, you get a better error:</p>\n\n<pre><code>/tmp/go-build887090083/cgoSO/_obj/hello.o: In function `main':\n/usr/include/x86_64-linux-gnu/bits/stdio2.h:104: multiple definition of `main'\n/tmp/go-build887090083/cgoSO/_obj/_cgo_main.o:/tmp/go-build887090083/cgoSO/_obj/_cgo_main.c:1: first defined here\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>I then added the <code>-work</code> flag to <code>go build</code> to persist the tmp workspace, and here is the content of <code>/tmp/go-build465152107/cgoSO/_obj/_cgo_main.c</code>:</p>\n\n<pre><code>int main() { return 0; }\nvoid crosscall2(void(*fn)(void*, int), void *a, int c) { }\nvoid _cgo_wait_runtime_init_done() { }\nchar* _cgo_topofstack(void) { return (char*)0; }\nvoid _cgo_allocate(void *a, int c) { }\nvoid _cgo_panic(void *a, int c) { }\nvoid _cgo_reginit(void) { }\n</code></pre>\n\n<p>That first line is written there: <a href=\"https://github.com/golang/go/blob/f2e4c8b5fb3660d793b2c545ef207153db0a34b1/src/cmd/cgo/out.go#L49\" rel=\"nofollow\">https://github.com/golang/go/blob/f2e4c8b5fb3660d793b2c545ef207153db0a34b1/src/cmd/cgo/out.go#L49</a></p>\n\n<p>And there is no conditions, so it cannot be avoided.</p>\n\n<p>Conclusion: You cannot import a C program, you can only import libraries (it actually makes sense).</p>\n\n<p>If the C is your code, then just change <code>main</code> for anything else and it will work.</p>\n"}], "owner": {"reputation": 8608, "user_id": 1091116, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/15098b2b940cacd8b4d07026e01e3102?s=128&d=identicon&r=PG", "display_name": "d33tah", "link": "https://stackoverflow.com/users/1091116/d33tah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 755, "favorite_count": 1, "accepted_answer_id": 33215335, "answer_count": 1, "score": 4, "last_activity_date": 1445263305, "creation_date": 1445253261, "last_edit_date": 1445256834, "question_id": 33212939, "link": "https://stackoverflow.com/questions/33212939/how-to-wrap-a-c-hello-world-with-argv-using-cgo", "title": "How to wrap a C &quot;hello world&quot; with argv using cgo?", "body": "<p>Consider the following <code>hello.c</code>:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint main(int argc, char* argv[]) {\n    printf(\"Hello, world! argv[0]=%s\\n\", argv[0]);\n}\n</code></pre>\n\n<p>Makefile only contains one line: <code>all: hello</code>. How can I wrap (and compile) this function around a Go program, like in this (non-working) example?</p>\n\n<pre><code>package main\n// int main(int argc, char* argv[]);\nimport \"C\"\nfunc main() {\nargc := C.int(1);\nargv := make([]*C.char, 1)\nargv[0] = C.CString(\"hai\");\nC.main(argc, &amp;argv[0])\n}\n</code></pre>\n\n<p>The error I'm getting is:</p>\n\n<pre><code>(virtualenv)[14:16:21][/tmp/cgo]$ ./main \nfatal error: unexpected signal during runtime execution\n[signal 0xb code=0x1 addr=0x1c000000000 pc=0x41d563]\n\nruntime stack:\nruntime.throw(0x48b400, 0x2a)\n /usr/lib/golang/src/runtime/panic.go:527 +0x90\nruntime.sigpanic()\n /usr/lib/golang/src/runtime/sigpanic_unix.go:12 +0x5a\nruntime.mHeap_Grow(0x6c7c20, 0x8, 0x0)\n /usr/lib/golang/src/runtime/mheap.go:647 +0x243\nruntime.mHeap_AllocSpanLocked(0x6c7c20, 0x1, 0x0)\n /usr/lib/golang/src/runtime/mheap.go:532 +0x5f1\nruntime.mHeap_Alloc_m(0x6c7c20, 0x1, 0x15, 0x0)\n /usr/lib/golang/src/runtime/mheap.go:425 +0x1ac\nruntime.mHeap_Alloc.func1()\n /usr/lib/golang/src/runtime/mheap.go:484 +0x41\nruntime.systemstack(0x7ffcb3aab958)\n /usr/lib/golang/src/runtime/asm_amd64.s:278 +0xab\nruntime.mHeap_Alloc(0x6c7c20, 0x1, 0x10000000015, 0x40a954)\n /usr/lib/golang/src/runtime/mheap.go:485 +0x63\nruntime.mCentral_Grow(0x6d0898, 0x0)\n /usr/lib/golang/src/runtime/mcentral.go:190 +0x93\nruntime.mCentral_CacheSpan(0x6d0898, 0x6c1180)\n /usr/lib/golang/src/runtime/mcentral.go:86 +0x4d4\nruntime.mCache_Refill(0x7fbc9971d050, 0x15, 0x40ca28)\n /usr/lib/golang/src/runtime/mcache.go:118 +0xcf\nruntime.mallocgc.func2()\n /usr/lib/golang/src/runtime/malloc.go:611 +0x2b\nruntime.systemstack(0x7ffcb3aabb28)\n /usr/lib/golang/src/runtime/asm_amd64.s:278 +0xab\nruntime.mallocgc(0x180, 0x476220, 0x0, 0x800000000)\n /usr/lib/golang/src/runtime/malloc.go:612 +0x842\nruntime.newobject(0x476220, 0x6c0c40)\n /usr/lib/golang/src/runtime/malloc.go:760 +0x42\nruntime.malg(0x8000, 0x6c0e40)\n /usr/lib/golang/src/runtime/proc1.go:2188 +0x27\nruntime.mpreinit(0x6c1180)\n /usr/lib/golang/src/runtime/os1_linux.go:197 +0x1f\nruntime.mcommoninit(0x6c1180)\n /usr/lib/golang/src/runtime/proc1.go:114 +0x100\nruntime.schedinit()\n /usr/lib/golang/src/runtime/proc1.go:57 +0x79\nruntime.rt0_go(0xc82002e008, 0x1, 0xc82002e008, 0x1, 0x40122a, 0xc82004fef8, 0x0, 0x8, 0x44fbaa, 0xc82004fe80, ...)\n /usr/lib/golang/src/runtime/asm_amd64.s:109 +0x132\n\ngoroutine 1 [syscall, locked to thread]:\nruntime.cgocall(0x401210, 0xc82004fef8, 0x0)\n /usr/lib/golang/src/runtime/cgocall.go:120 +0x11b fp=0xc82004feb0 sp=0xc82004fe80\nmain._Cfunc_main(0x1, 0xc82002e008, 0x0)\n command-line-arguments/_obj/_cgo_gotypes.go:49 +0x39 fp=0xc82004fef8 sp=0xc82004feb0\nmain.main()\n /tmp/cgo/main.go:8 +0xb4 fp=0xc82004ff50 sp=0xc82004fef8\nruntime.main()\n /usr/lib/golang/src/runtime/proc.go:111 +0x2b0 fp=0xc82004ffa0 sp=0xc82004ff50\nruntime.goexit()\n /usr/lib/golang/src/runtime/asm_amd64.s:1696 +0x1 fp=0xc82004ffa8 sp=0xc82004ffa0\n\ngoroutine 17 [syscall, locked to thread]:\nruntime.goexit()\n /usr/lib/golang/src/runtime/asm_amd64.s:1696 +0x1\n</code></pre>\n"}, {"tags": ["function", "go", "return-value"], "answers": [{"comments": [{"owner": {"reputation": 241, "user_id": 3992906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PA0G5.jpg?s=128&g=1", "display_name": "Aditya Sanghi", "link": "https://stackoverflow.com/users/3992906/aditya-sanghi"}, "edited": false, "score": 0, "creation_date": 1445252932, "post_id": 33212699, "comment_id": 54229683, "body": "reversing the order of the defer statements also gives the exact same output. Another thing is that why is the constant 45 outputted the first time but not in the second case?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 241, "user_id": 3992906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PA0G5.jpg?s=128&g=1", "display_name": "Aditya Sanghi", "link": "https://stackoverflow.com/users/3992906/aditya-sanghi"}, "edited": false, "score": 0, "creation_date": 1445253124, "post_id": 33212699, "comment_id": 54229800, "body": "@AdityaSanghi The <code>45</code> is outputted by the <code>fmt.Println()</code> statement in the <b><code>main()</code></b> function, not by the <code>Println()</code> in the <code>c()</code> function. <code>45</code> is returned from <code>c()</code>, that&#39;s why."}, {"owner": {"reputation": 241, "user_id": 3992906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PA0G5.jpg?s=128&g=1", "display_name": "Aditya Sanghi", "link": "https://stackoverflow.com/users/3992906/aditya-sanghi"}, "edited": false, "score": 0, "creation_date": 1445253258, "post_id": 33212699, "comment_id": 54229882, "body": "But why is it returning 1 when I explicitly modify i (in the second code example). Basically I am not clear about why the return values are behaving differently in the 2 code examples."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 241, "user_id": 3992906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PA0G5.jpg?s=128&g=1", "display_name": "Aditya Sanghi", "link": "https://stackoverflow.com/users/3992906/aditya-sanghi"}, "edited": false, "score": 0, "creation_date": 1445253389, "post_id": 33212699, "comment_id": 54229958, "body": "@AdityaSanghi In your first example, deferred functions don&#39;t modify <code>i</code>, so <code>45</code> is returned (from <code>return 45</code>). In your second example a deferred function modifies <code>i</code> to <code>1</code>, so <code>1</code> will be returned."}, {"owner": {"reputation": 241, "user_id": 3992906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PA0G5.jpg?s=128&g=1", "display_name": "Aditya Sanghi", "link": "https://stackoverflow.com/users/3992906/aditya-sanghi"}, "edited": false, "score": 0, "creation_date": 1445253497, "post_id": 33212699, "comment_id": 54230044, "body": "so does modifying the i cause it to take priority as the return value?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 241, "user_id": 3992906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PA0G5.jpg?s=128&g=1", "display_name": "Aditya Sanghi", "link": "https://stackoverflow.com/users/3992906/aditya-sanghi"}, "edited": false, "score": 0, "creation_date": 1445253556, "post_id": 33212699, "comment_id": 54230084, "body": "@AdityaSanghi Yes, deferred functions are run <b>after</b> the values specified in the <code>return</code> statement are set."}, {"owner": {"reputation": 241, "user_id": 3992906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PA0G5.jpg?s=128&g=1", "display_name": "Aditya Sanghi", "link": "https://stackoverflow.com/users/3992906/aditya-sanghi"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1445253603, "post_id": 33212699, "comment_id": 54230110, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/92718/discussion-between-aditya-sanghi-and-icza\">continue this discussion in chat</a>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 241, "user_id": 3992906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PA0G5.jpg?s=128&g=1", "display_name": "Aditya Sanghi", "link": "https://stackoverflow.com/users/3992906/aditya-sanghi"}, "edited": false, "score": 0, "creation_date": 1445253730, "post_id": 33212699, "comment_id": 54230188, "body": "@AdityaSanghi I don&#39;t have access to chat here. Just think it through. I think you have all the info to understand it now."}, {"owner": {"reputation": 241, "user_id": 3992906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PA0G5.jpg?s=128&g=1", "display_name": "Aditya Sanghi", "link": "https://stackoverflow.com/users/3992906/aditya-sanghi"}, "edited": false, "score": 0, "creation_date": 1445253871, "post_id": 33212699, "comment_id": 54230294, "body": "The only small doubt remaining is that shouldnt the function c() always look for the value of named return value <b>i</b> and return that even if <b>i</b> is not being modified"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 241, "user_id": 3992906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PA0G5.jpg?s=128&g=1", "display_name": "Aditya Sanghi", "link": "https://stackoverflow.com/users/3992906/aditya-sanghi"}, "edited": false, "score": 0, "creation_date": 1445254004, "post_id": 33212699, "comment_id": 54230397, "body": "@AdityaSanghi I don&#39;t understand your question. <code>i</code> will be set to the value specified in the <code>return</code> statement. This may be optionally modified <i>after</i> in the deferred functions. The value <code>i</code> holds after running the deferred functions will be the value returned from <code>c()</code>."}, {"owner": {"reputation": 241, "user_id": 3992906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PA0G5.jpg?s=128&g=1", "display_name": "Aditya Sanghi", "link": "https://stackoverflow.com/users/3992906/aditya-sanghi"}, "edited": false, "score": 0, "creation_date": 1445254223, "post_id": 33212699, "comment_id": 54230527, "body": "thankyou so much. so basically in the first example, 45 was implicitly being stored in i and returned as such."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 241, "user_id": 3992906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PA0G5.jpg?s=128&g=1", "display_name": "Aditya Sanghi", "link": "https://stackoverflow.com/users/3992906/aditya-sanghi"}, "edited": false, "score": 1, "creation_date": 1445254387, "post_id": 33212699, "comment_id": 54230615, "body": "@AdityaSanghi Yes. It was also stored in the 2nd example, but then it was changed to <code>1</code>, so <code>1</code> was returned."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1445253306, "last_edit_date": 1495535227, "creation_date": 1445252479, "answer_id": 33212699, "question_id": 33212539, "link": "https://stackoverflow.com/questions/33212539/does-a-constant-returned-by-a-function-automatically-become-the-value-of-the-nam/33212699#33212699", "title": "Does a constant returned by a function automatically become the value of the named return variable", "body": "<p>In deferred functions you have the opportunity to modify the values of the result parameters.</p>\n\n<p>When deferred functions are called, values specified in the <code>return</code> statement are already set.</p>\n\n<p>If there are multiple deferred functions, they are executed in LIFO order (last in, first out).</p>\n\n<p>In your second example <code>fmt.Println()</code> is executed first, then the other, anonymous function.</p>\n\n<p>But what you need to know that when the <code>defer</code> statement is executed, the arguments to the deferred function are evaluated immediately, not when the deferred function will be run (later, before returning).</p>\n\n<p><a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\">Spec: Defer statements:</a></p>\n\n<blockquote>\n  <p>Each time a \"defer\" statement executes, the function value and parameters to the call are <a href=\"https://golang.org/ref/spec#Calls\" rel=\"nofollow noreferrer\">evaluated as usual</a> and saved anew but the actual function is not invoked. Instead, deferred functions are invoked immediately before the surrounding function returns, in the reverse order they were deferred.</p>\n</blockquote>\n\n<p>So this line:</p>\n\n<pre><code>defer fmt.Println(\"our i is\", i)\n</code></pre>\n\n<p>Will always mean to call <code>fmt.Println()</code> with <code>i = 0</code> argument:</p>\n\n<pre><code>fmt.Println(\"our i is\", 0)\n</code></pre>\n\n<p>Because when this line runs, <code>i</code> has a value of <code>0</code>.</p>\n\n<p>So in your 2nd example <code>fmt.Println()</code> prints <code>0</code>, then runs the other deferred function which sets <code>i</code> to <code>1</code> and this is what is returned.</p>\n\n<p>Your first example just prints something (<code>i = 0</code>), but the deferred functions in the first example do not modify the value of <code>i</code> so <code>45</code> will be returned (and printed by the <code>fmt.Println()</code> function from the <code>main()</code>).</p>\n\n<p>Please see the following questions/answer for more on the topic:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/31404471/defer-usage-clarification\">Defer usage clarification</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/33167282/how-to-return-a-value-in-a-go-function-that-panics\">How to return a value in a Go function that panics?</a></p>\n"}], "owner": {"reputation": 241, "user_id": 3992906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PA0G5.jpg?s=128&g=1", "display_name": "Aditya Sanghi", "link": "https://stackoverflow.com/users/3992906/aditya-sanghi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "accepted_answer_id": 33212699, "answer_count": 1, "score": 2, "last_activity_date": 1445253306, "creation_date": 1445251889, "last_edit_date": 1445252387, "question_id": 33212539, "link": "https://stackoverflow.com/questions/33212539/does-a-constant-returned-by-a-function-automatically-become-the-value-of-the-nam", "title": "Does a constant returned by a function automatically become the value of the named return variable", "body": "<p>This is a function in Golang that uses defer to alter the named return value of the function c(). </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc c() (i int) { \n    defer func() {  }()     \n    defer fmt.Println(\"our i is\", i)\n    return 45\n   }\n\nfunc main() {   \n   fmt.Println(c()) \n }\n</code></pre>\n\n<p>The output of the program is: </p>\n\n<blockquote>\n  <p>our i is 0</p>\n  \n  <p>45</p>\n</blockquote>\n\n<p>changing the anonymous func() in the code</p>\n\n<pre><code>func c() (i int) { \n        defer func() { i = 1 }()   \n        defer fmt.Println(\"our i is\", i)\n        return 45\n       }\n\n    func main() {   \n       fmt.Println(c()) \n     }\n</code></pre>\n\n<p>This results in the output:</p>\n\n<blockquote>\n  <p>our i is 0</p>\n  \n  <p>1</p>\n</blockquote>\n\n<p>It seems like the return value 45 is copied to i automatically if no other value is being put inside i. But I am not a 100% sure if that is the exact reason for the output</p>\n"}, {"tags": ["multithreading", "go", "atomic"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1445246617, "post_id": 33210519, "comment_id": 54225961, "body": "Maybe the best advice would be: Use neither <code>sync&#47;atomic</code> nor <code>runtime.Gosched</code>. The atomic operations in <code>snyc&#47;atomic</code> are there because <b>sometimes</b> atomic operations provide significant performance gain. Most user will not need these and most should not use atomic operations as this quickly becomes complicated. Keep away from such low-level stuff."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1445246822, "post_id": 33210519, "comment_id": 54226090, "body": "The call to <code>Gosched</code> has <i>abolutely</i> <i>nothing</i> to do with <code>atomic.AddUint64</code>. You could substitute <code>i++</code> for the AddUint64. It just happens, that the inner loop is too tight and won&#39;t yield to the scheduler, but this has nothing to do with atomic operations. See David&#39;s answer for details."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1445257899, "post_id": 33210519, "comment_id": 54232876, "body": "@Volker, I&#39;m afraid, <code>i++</code> isn&#39;t a preemption point. Back in the day, they happened to be at syscalls and calls to <code>C</code> but since some version (1.4 ?) normal Go function calls also serve as preemption points, so something like <code>func(){return}()</code> should suffice (well, unless may be such a call could be completely optimized away)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1445259092, "post_id": 33210519, "comment_id": 54233697, "body": "@kostix Sorry, I was unclear: You could substitute <code>i++</code> for <code>AddUint64</code> (not for <code>GoSched</code>). This would be racy, but as you stated, it would not allow preemption."}], "answers": [{"comments": [{"owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 0, "creation_date": 1445251219, "post_id": 33210656, "comment_id": 54228600, "body": "The answer you mention is correct but as of Go 1.5, GOMAXPROCS is automatically set to how many CPU cores you have."}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "reply_to_user": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 6, "creation_date": 1445251589, "post_id": 33210656, "comment_id": 54228844, "body": "@wldsvc That doesn&#39;t change anything. You still have cooperative multithreading. If, for example, GOMAXPROCS is 8 and you have 9 threads, none of which hit any pre-emption points, one of the threads will still be starved. It&#39;s not about how many threads you have but about how you switch what tasks the threads are doing. (Also, there are still machines with only one core. Virtual machines with one core aren&#39;t even uncommon.)"}], "tags": [], "owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "is_accepted": false, "score": 5, "last_activity_date": 1445245948, "last_edit_date": 1495542665, "creation_date": 1445245948, "answer_id": 33210656, "question_id": 33210519, "link": "https://stackoverflow.com/questions/33210519/why-do-we-need-to-call-runtime-gosched-after-call-to-atomic-adduint64-and-other/33210656#33210656", "title": "Why do we need to call runtime.Gosched after call to atomic.AddUint64 and other similar atomic ops?", "body": "<p>This is how <a href=\"http://www.cafeaulait.org/course/week11/32.html\" rel=\"nofollow noreferrer\">cooperative multithreading</a> works. If one thread remains ready to run, it continues to run and other threads don't. Explicit and implicit pre-emption points are used to allow other threads to run. If your thread has a loop that it stays in for lots of time with no implicit pre-emption points, you'll starve other threads if you don't add an explicit pre-emption point.</p>\n\n<p><a href=\"https://stackoverflow.com/a/13108469/721269\">This answer</a> has much more information about when Go uses cooperative multithreading.</p>\n"}], "owner": {"reputation": 6120, "user_id": 1309352, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/8ff1bfcff680fcc6dcd170ba54194ecb?s=128&d=identicon&r=PG", "display_name": "Bleeding Fingers", "link": "https://stackoverflow.com/users/1309352/bleeding-fingers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 772, "favorite_count": 3, "answer_count": 1, "score": 3, "last_activity_date": 1445245948, "creation_date": 1445245503, "question_id": 33210519, "link": "https://stackoverflow.com/questions/33210519/why-do-we-need-to-call-runtime-gosched-after-call-to-atomic-adduint64-and-other", "title": "Why do we need to call runtime.Gosched after call to atomic.AddUint64 and other similar atomic ops?", "body": "<p>Going through <em><a href=\"https://gobyexample.com/atomic-counters\" rel=\"nofollow\">Go by Example: Atomic Counters</a></em>. The code example calls <code>runtime.Gosched</code> after calling <code>atomic.AddUint64</code>.</p>\n\n<p><code>atomic.AddUint64</code> is called to</p>\n\n<blockquote>\n  <p><a href=\"https://gobyexample.com/mutexes\" rel=\"nofollow\">ensure that this goroutine doesn\u2019t starve the scheduler</a></p>\n</blockquote>\n\n<p>Unfortunately, I am finding the explanation not so meaty and satisfying.</p>\n\n<p>I tried running the sample code (comments removed for conciseness):</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\nimport \"sync/atomic\"\nimport \"runtime\"\n\nfunc main() {\n\n    var ops uint64 = 0\n\n    for i := 0; i &lt; 50; i++ {\n        go func() {\n            for {\n                atomic.AddUint64(&amp;ops, 1)\n\n                runtime.Gosched()\n            }\n        }()\n    }\n\n    time.Sleep(time.Second)\n\n    opsFinal := atomic.LoadUint64(&amp;ops)\n    fmt.Println(\"ops:\", opsFinal)\n}\n</code></pre>\n\n<p>without the <code>runtime.Gosched()</code> (<code>go run conc.go</code>) and the program never exited even when I reduced the loop from 50 to 1.</p>\n\n<p><strong>Question:</strong></p>\n\n<p>What happens under the hood after the call to <code>atomic.AddUint64</code> that it is necessary to call <code>runtime.Gosched</code>? And how does <code>runtime.Gosched</code> fixes this? I did not find any hint to such a thing in <a href=\"https://golang.org/pkg/sync/atomic\" rel=\"nofollow\"><code>sync/atomic</code></a>'s documentation.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 0, "last_activity_date": 1445245362, "creation_date": 1445245362, "answer_id": 33210474, "question_id": 33210377, "link": "https://stackoverflow.com/questions/33210377/comparing-the-return-values-of-methods-with-multiple-return-values/33210474#33210474", "title": "Comparing the return values of methods with multiple return values", "body": "<p>This might not be exactly what you want, but if instead of returning three unnamed ints you return structs, you can compare them directly. E.g.</p>\n\n<pre><code>type XYZ struct{ X, Y, Z int }\n\nfunc f() XYZ { return XYZ{1, 2, 3} }\nfunc g() XYZ { return XYZ{1, 2, 3} }\n\nfunc main() {\n    fmt.Println(f() == g())\n    // Output:\n    //   true\n}\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/zFXPqPjTtZ\" rel=\"nofollow\">http://play.golang.org/p/zFXPqPjTtZ</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1486657832, "last_edit_date": 1486657832, "creation_date": 1445245520, "answer_id": 33210526, "question_id": 33210377, "link": "https://stackoverflow.com/questions/33210377/comparing-the-return-values-of-methods-with-multiple-return-values/33210526#33210526", "title": "Comparing the return values of methods with multiple return values", "body": "<h3>With structs</h3>\n\n<p>You can slightly improve it by storing the result in values of a struct which are comparable:</p>\n\n<pre><code>type Result struct {\n    a, b, c int\n}\n</code></pre>\n\n<p>And using it:</p>\n\n<pre><code>p, q := Result{}, Result{}\np.a, p.b, p.c = a()\nq.a, q.b, q.c = b()\nfmt.Println(p == q)\n</code></pre>\n\n<h3>With arrays</h3>\n\n<p>Or you can use arrays (arrays are also comparable unlike slices), although this won't be shorter, but you don't need a new type for this:</p>\n\n<pre><code>x, y := [3]int{}, [3]int{}\nx[0], x[1], x[2] = a()\ny[0], y[1], y[2] = b()\nfmt.Println(x == y)\n</code></pre>\n\n<h3>General solution (using <code>reflect</code>)</h3>\n\n<p>A general solution may be constructed using the <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\"><code>reflect</code></a> package. This basically calls both functions, and compares all the result values. Error checks omitted!</p>\n\n<pre><code>func check(v1, v2 reflect.Value) bool {\n    r1 := v1.Call(nil)\n    r2 := v2.Call(nil)\n    if len(r1) != len(r2) {\n        return false\n    }\n\n    for i, a := range r1 {\n        if a.Interface() != r2[i].Interface() {\n            return false\n        }\n    }\n\n    return true\n}\n</code></pre>\n\n<p>And using it:</p>\n\n<pre><code>fmt.Println(check(reflect.ValueOf(a), reflect.ValueOf(b)))\n</code></pre>\n\n<p>Try these on the <a href=\"http://play.golang.org/p/iHmnwiNrIq\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 15349, "user_id": 2282538, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0a4fff09f1f0e3360daeabb30c2c06bb?s=128&d=identicon&r=PG", "display_name": "Tyler", "link": "https://stackoverflow.com/users/2282538/tyler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1486657832, "creation_date": 1445245043, "question_id": 33210377, "link": "https://stackoverflow.com/questions/33210377/comparing-the-return-values-of-methods-with-multiple-return-values", "title": "Comparing the return values of methods with multiple return values", "body": "<p>Considering the following example methods, each of which returns three integers:</p>\n\n<pre><code>func a() (int, int, int) {...}\n\nfunc b() (int, int, int) {...}\n</code></pre>\n\n<p>I want to know if the return values of these methods are the same, something like this:</p>\n\n<pre><code>equal := a() == b()\n</code></pre>\n\n<p>However, this doesn't compile because the compiler is expecting a single value: </p>\n\n<pre><code>my_file.go:14: multiple-value a() in single-value context\nmy_file.go:14: multiple-value b() in single-value context\n</code></pre>\n\n<hr>\n\n<p>My current work around is to create a custom type with the same signature as the methods, and then create a third function to do the checking:</p>\n\n<pre><code>type multiReturnFunc func() (int, int, int)\nfunc a() (int, int, int) {...}\nfunc b() (int, int, int) {...}\n\nfunc checkMultiReturns(a, b multiReturnFunc) bool {\n    a1, a2, a3 := a()\n    b1, b2, b3 := b()\n    return a1 == b1 &amp;&amp; a2 == b2 &amp;&amp; a3 == b3\n}\n\n...\n\nequal := checkMultiReturns(a, b)\n</code></pre>\n\n<p>But I would like to have a more general solution.</p>\n"}, {"tags": ["inheritance", "methods", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1445269089, "post_id": 33209953, "comment_id": 54241233, "body": "See <a href=\"http://stackoverflow.com/questions/29397801/whats-the-best-practice-to-infer-the-methods/29397985#29397985\">this answer</a> for examples on the difference between embedding/not-embedding a custom time type."}], "answers": [{"comments": [{"owner": {"reputation": 15349, "user_id": 2282538, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0a4fff09f1f0e3360daeabb30c2c06bb?s=128&d=identicon&r=PG", "display_name": "Tyler", "link": "https://stackoverflow.com/users/2282538/tyler"}, "edited": false, "score": 0, "creation_date": 1445244139, "post_id": 33209983, "comment_id": 54224484, "body": "Did not know about the <code>promotion</code> functionality, thanks!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 15349, "user_id": 2282538, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0a4fff09f1f0e3360daeabb30c2c06bb?s=128&d=identicon&r=PG", "display_name": "Tyler", "link": "https://stackoverflow.com/users/2282538/tyler"}, "edited": false, "score": 1, "creation_date": 1445244702, "post_id": 33209983, "comment_id": 54224843, "body": "@Tyler Thanks for the edit. Also edited the code on the Playground and posted the new link."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1475436780, "last_edit_date": 1475436780, "creation_date": 1445243734, "answer_id": 33209983, "question_id": 33209953, "link": "https://stackoverflow.com/questions/33209953/calling-method-of-named-type/33209983#33209983", "title": "Calling method of named type", "body": "<p>Using the <code>type</code> keyword you are creating a new type and as such it will not have the methods of the underlying type.</p>\n\n<p>Use embedding:</p>\n\n<pre><code>type StartTime struct {\n    time.Time\n}\n</code></pre>\n\n<p>Quoting from the <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow\">Spec: Struct types</a>:</p>\n\n<blockquote>\n  <p>A field or <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow\">method</a> <code>f</code> of an anonymous field in a struct <code>x</code> is called <em>promoted</em> if <code>x.f</code> is a legal selector that denotes that field or method <code>f</code>.</p>\n</blockquote>\n\n<p>So all the methods and fields of the embedded (anonymous) fields are promoted and can be referred to.</p>\n\n<p>Example using it:</p>\n\n<pre><code>type StartTime struct {\n    time.Time\n}\n\nfunc main() {\n    s := StartTime{time.Now()}\n    fmt.Println(s.Date())\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/srY1ZAloNI\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>2009 November 10\n</code></pre>\n"}], "owner": {"reputation": 15349, "user_id": 2282538, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0a4fff09f1f0e3360daeabb30c2c06bb?s=128&d=identicon&r=PG", "display_name": "Tyler", "link": "https://stackoverflow.com/users/2282538/tyler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 1, "accepted_answer_id": 33209983, "answer_count": 1, "score": 1, "last_activity_date": 1475436888, "creation_date": 1445243614, "last_edit_date": 1475436888, "question_id": 33209953, "link": "https://stackoverflow.com/questions/33209953/calling-method-of-named-type", "title": "Calling method of named type", "body": "<p>I have a named type, which I needed to make to do some JSON unmarshmaling:</p>\n\n<pre><code>type StartTime time.Time\nfunc (st *StartTime) UnmarshalJSON(b []byte) error {...}\n</code></pre>\n\n<p>Since <code>StartTime</code> is a <code>time.Time</code>, I thought that I would be able to call methods that belong to <code>time.Time</code>, such as <code>Date()</code>:</p>\n\n<pre><code>myStartTime.Date() // myStartTime.Date undefined (type my_package.StartTime has no field or method Date)\n</code></pre>\n\n<p>How can I add methods to an existing type, while preserving its original methods?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 313, "user_id": 2952192, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uEaNB.jpg?s=128&g=1", "display_name": "Vitaly Senko", "link": "https://stackoverflow.com/users/2952192/vitaly-senko"}, "edited": false, "score": 0, "creation_date": 1445238347, "post_id": 33208235, "comment_id": 54221344, "body": "No, reinstallation didn&#39;t fix it. Go 1.5.1, Git 2.6.1, Mercurial 3.5.2"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 313, "user_id": 2952192, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uEaNB.jpg?s=128&g=1", "display_name": "Vitaly Senko", "link": "https://stackoverflow.com/users/2952192/vitaly-senko"}, "edited": false, "score": 0, "creation_date": 1445238408, "post_id": 33208235, "comment_id": 54221376, "body": "@VitalySenko did you try with an empty GOPATH folder?"}, {"owner": {"reputation": 313, "user_id": 2952192, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uEaNB.jpg?s=128&g=1", "display_name": "Vitaly Senko", "link": "https://stackoverflow.com/users/2952192/vitaly-senko"}, "edited": false, "score": 0, "creation_date": 1445238485, "post_id": 33208235, "comment_id": 54221420, "body": "Add the most interesting thing is that i have all worked on my another machine, but i see no difference."}, {"owner": {"reputation": 313, "user_id": 2952192, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uEaNB.jpg?s=128&g=1", "display_name": "Vitaly Senko", "link": "https://stackoverflow.com/users/2952192/vitaly-senko"}, "edited": false, "score": 0, "creation_date": 1445238541, "post_id": 33208235, "comment_id": 54221444, "body": "Yes. Both on clear and with bin,src,pkg created folders."}, {"owner": {"reputation": 313, "user_id": 2952192, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uEaNB.jpg?s=128&g=1", "display_name": "Vitaly Senko", "link": "https://stackoverflow.com/users/2952192/vitaly-senko"}, "edited": false, "score": 0, "creation_date": 1445238767, "post_id": 33208235, "comment_id": 54221538, "body": "&quot;Deleting the whole golang.org/x/tools &quot; - i have no such directory installed. And trying do go get on this gcimporter fails too."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 313, "user_id": 2952192, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uEaNB.jpg?s=128&g=1", "display_name": "Vitaly Senko", "link": "https://stackoverflow.com/users/2952192/vitaly-senko"}, "edited": false, "score": 0, "creation_date": 1445256665, "post_id": 33208235, "comment_id": 54232081, "body": "@VitalySenko Considering it is working without issue on my side, maybe there is an issue with your PATH? <code>echo %PATH%</code>. Try to have: <code>C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\W&zwnj;&#8203;INDOWS\\System32\\Wind&zwnj;&#8203;owsPowerShell\\v1.0\\;&zwnj;&#8203;C:\\prgs\\go\\go1.5.1.w&zwnj;&#8203;indows-amd64\\bin;C:\\&zwnj;&#8203;prgs\\git\\PortableGit&zwnj;&#8203;-2.6.1-64-bit\\bin;C:&zwnj;&#8203;\\prgs\\hg\\Mercurial-2&zwnj;&#8203;.9.1-x64</code>"}, {"owner": {"reputation": 313, "user_id": 2952192, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uEaNB.jpg?s=128&g=1", "display_name": "Vitaly Senko", "link": "https://stackoverflow.com/users/2952192/vitaly-senko"}, "edited": false, "score": 0, "creation_date": 1445257393, "post_id": 33208235, "comment_id": 54232539, "body": "PATH is OK. I can do go/git/hg version in my console. I made exact Go setup on my notebook and all is OK. But my workstation fails. Main differences are: Notebook (Win 10, git 1.9); PC (Win 7, git 2.6)"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 313, "user_id": 2952192, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uEaNB.jpg?s=128&g=1", "display_name": "Vitaly Senko", "link": "https://stackoverflow.com/users/2952192/vitaly-senko"}, "edited": false, "score": 0, "creation_date": 1445257631, "post_id": 33208235, "comment_id": 54232683, "body": "@VitalySenko I meant: try with the smallest PATh possible, to make sure there is no side-effect from other programs in that PATH."}, {"owner": {"reputation": 313, "user_id": 2952192, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uEaNB.jpg?s=128&g=1", "display_name": "Vitaly Senko", "link": "https://stackoverflow.com/users/2952192/vitaly-senko"}, "edited": false, "score": 0, "creation_date": 1445335318, "post_id": 33208235, "comment_id": 54270441, "body": "Can it depend on my hard disk ciphering?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 313, "user_id": 2952192, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uEaNB.jpg?s=128&g=1", "display_name": "Vitaly Senko", "link": "https://stackoverflow.com/users/2952192/vitaly-senko"}, "edited": false, "score": 0, "creation_date": 1445336612, "post_id": 33208235, "comment_id": 54271251, "body": "@VitalySenko do you mean that your hard drive is encrypted? (as in <a href=\"https://en.wikipedia.org/wiki/Disk_encryption_theory\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Disk_encryption_theory</a>)"}, {"owner": {"reputation": 313, "user_id": 2952192, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uEaNB.jpg?s=128&g=1", "display_name": "Vitaly Senko", "link": "https://stackoverflow.com/users/2952192/vitaly-senko"}, "edited": false, "score": 0, "creation_date": 1445337435, "post_id": 33208235, "comment_id": 54271759, "body": "Yes, you can see it in my explorer (in screenshot)"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 313, "user_id": 2952192, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uEaNB.jpg?s=128&g=1", "display_name": "Vitaly Senko", "link": "https://stackoverflow.com/users/2952192/vitaly-senko"}, "edited": false, "score": 0, "creation_date": 1445337582, "post_id": 33208235, "comment_id": 54271855, "body": "@VitalySenko That is possible indeed, I don&#39;t have direct experience with encrypted hard drive though."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 1, "last_activity_date": 1445237332, "creation_date": 1445237332, "answer_id": 33208235, "question_id": 33207967, "link": "https://stackoverflow.com/questions/33207967/golang-another-unrecognized-import-path/33208235#33208235", "title": "Golang another unrecognized import path", "body": "<p>There is a <a href=\"https://github.com/golang/lint/issues/158\" rel=\"nofollow\">go get issue currently discussed</a></p>\n\n<blockquote>\n  <p>my go tools were out of date, but go get could not update them because they switched form mercurial to git at some point. Deleting the whole golang.org/x/tools directory in my GOPATH and reinstalling fixed the issue. </p>\n</blockquote>\n\n<p>Make sure you have the latest go, and try with a fresh empty <code>GOPATH</code> folder, to see if the issue persists.</p>\n"}], "owner": {"reputation": 313, "user_id": 2952192, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uEaNB.jpg?s=128&g=1", "display_name": "Vitaly Senko", "link": "https://stackoverflow.com/users/2952192/vitaly-senko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 475, "favorite_count": 1, "accepted_answer_id": 33208235, "answer_count": 1, "score": -1, "last_activity_date": 1445237332, "creation_date": 1445236328, "question_id": 33207967, "link": "https://stackoverflow.com/questions/33207967/golang-another-unrecognized-import-path", "title": "Golang another unrecognized import path", "body": "<p>When i am trying to install golint (or gin, for example) i get \"unrecognized import path error\".</p>\n\n<p>I know that there are many same questions, but main answer is to check environment variables.</p>\n\n<p>There is screenshot of my environment variables, my folders and console with error.\n<a href=\"https://i.stack.imgur.com/07xNK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/07xNK.png\" alt=\"enter image description here\"></a></p>\n\n<p>I tried to install go both with .msi installer and just by copying files and setting env var manually. I got the same results.</p>\n"}, {"tags": ["arrays", "string", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 691, "user_id": 5266452, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8ea07a3ee8a8f9a3f997377e06edd689?s=128&d=identicon&r=PG&f=1", "display_name": "Maiko Ohkawa", "link": "https://stackoverflow.com/users/5266452/maiko-ohkawa"}, "edited": false, "score": 1, "creation_date": 1445242571, "post_id": 33207265, "comment_id": 54223628, "body": "icza, thank you for your answer and grammar check! Hmm, I see, I understood that I need to treat Set data type myself in Go. Your source code is clear. It was easy to understand. Thank you very much."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1538990219, "last_edit_date": 1538990219, "creation_date": 1445232881, "answer_id": 33207265, "question_id": 33207197, "link": "https://stackoverflow.com/questions/33207197/how-can-i-create-an-array-that-contains-unique-strings/33207265#33207265", "title": "How can I create an array that contains unique strings?", "body": "<p>If you want a collection of unique elements, that is the <a href=\"https://en.wikipedia.org/wiki/Set_(abstract_data_type)\" rel=\"noreferrer\">Set</a> data type. Go does not have a set data type, but you can use a <code>map[string]bool</code> to act as a set.</p>\n\n<p>For a \"nice\" set, use a map with <code>bool</code> value type (with <code>true</code> values) and exploit the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"noreferrer\">zero value</a>. For a set with the smallest memory footprint, use a map with <code>struct{}</code> value type as values of <code>struct{}</code> type occupy no memory; and use the comma-ok idiom to tell if a value is in the set / map.</p>\n\n<p>Here's how the \"nice\" version of set looks like. Instead of a slice add your elements to a <code>map[string]bool</code> as the key with a <code>true</code> as the value:</p>\n\n<pre><code>m := make(map[string]bool)\n\nm[\"aaa\"] = true\nm[\"bbb\"] = true\nm[\"bbb\"] = true\nm[\"ccc\"] = true\n</code></pre>\n\n<p>To check if an element is already in the collection (map), you can simply use an <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"noreferrer\">index expression</a>:</p>\n\n<pre><code>exists := m[\"somevalue\"]\n</code></pre>\n\n<p>This exploits the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"noreferrer\">zero value</a>, that is if the map does not yet contain an element, the zero value of the value type is returned which is <code>false</code> in case of <code>bool</code> type, properly indicating that the element is not in the collection.</p>\n\n<p>Elements in a map have no fixed order. If you need to keep the order (e.g. insertion order), then use a slice (to remember the order) and a map (to tell if an element to be added is new). This is easiest with a helper <code>add()</code> function:</p>\n\n<pre><code>var m = make(map[string]bool)\nvar a = []string{}\n\nfunc main() {\n    add(\"aaa\")\n    add(\"bbb\")\n    add(\"bbb\")\n    add(\"ccc\")\n}\n\nfunc add(s string) {\n    if m[s] {\n        return // Already in the map\n    }\n    a = append(a, s)\n    m[s] = true\n}\n</code></pre>\n"}], "owner": {"reputation": 691, "user_id": 5266452, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8ea07a3ee8a8f9a3f997377e06edd689?s=128&d=identicon&r=PG&f=1", "display_name": "Maiko Ohkawa", "link": "https://stackoverflow.com/users/5266452/maiko-ohkawa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2446, "favorite_count": 0, "accepted_answer_id": 33207265, "answer_count": 1, "score": 1, "last_activity_date": 1538990219, "creation_date": 1445232430, "last_edit_date": 1445235725, "question_id": 33207197, "link": "https://stackoverflow.com/questions/33207197/how-can-i-create-an-array-that-contains-unique-strings", "title": "How can I create an array that contains unique strings?", "body": "<p>I want to create an array that contains unique strings. How can I do that?</p>\n\n<pre><code>var paths = make([]string, 0)\n\nfunc main() {\n    // Members are added dynamically\n    paths = append(paths, \"aaa\")\n    paths = append(paths, \"bbb\")\n    paths = append(paths, \"bbb\")\n    paths = append(paths, \"ccc\")\n\n    // convert [\"aaa\", \"bbb\", \"bbb\", \"ccc\"] -&gt; [\"aaa\", \"bbb\", \"ccc\"] \n    // or can I use some class that disallow the same string automaticaly?\n}\n</code></pre>\n"}, {"tags": ["go", "floating-point", "type-conversion"], "answers": [{"comments": [{"owner": {"reputation": 385, "user_id": 5386963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d57a66c301b782f4630f4e45200cc2a5?s=128&d=identicon&r=PG&f=1", "display_name": "AndrewN", "link": "https://stackoverflow.com/users/5386963/andrewn"}, "edited": false, "score": 1, "creation_date": 1445227048, "post_id": 33206266, "comment_id": 54217341, "body": "I&#39;ve not used that package before, but looking at the docs, it certainly appears as if after rounding, you can call Unscaled() to extract an int value directly, rather than grabbing a string and converting it through strcon yet again."}, {"owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "reply_to_user": {"reputation": 385, "user_id": 5386963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d57a66c301b782f4630f4e45200cc2a5?s=128&d=identicon&r=PG&f=1", "display_name": "AndrewN", "link": "https://stackoverflow.com/users/5386963/andrewn"}, "edited": false, "score": 0, "creation_date": 1445227758, "post_id": 33206266, "comment_id": 54217495, "body": "Ah yes you&#39;re right. Totally forgotten that. Will update the code! Thanks!"}], "tags": [], "owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "is_accepted": false, "score": 0, "last_activity_date": 1445227817, "last_edit_date": 1445227817, "creation_date": 1445225795, "answer_id": 33206266, "question_id": 33206059, "link": "https://stackoverflow.com/questions/33206059/go-converting-float64-to-int-with-multiplier/33206266#33206266", "title": "Go: Converting float64 to int with multiplier", "body": "<p>This is probably likely a problem with floating points in general in most programming languages though some have different implementations than others. I wouldn't go into the intricacies here but most languages usually have a \"decimal\" approach either as a standard library or a third party library to get finer precision.</p>\n\n<p>For instance, I've found the <a href=\"https://godoc.org/gopkg.in/inf.v0\" rel=\"nofollow\">inf.v0</a> package largely useful. Underlying the library is a <code>Dec</code> struct that holds the exponents and the integer value. Therefore, it's able to hold <code>1.003</code> as <code>1003 * 10^-3</code>. See below for an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"gopkg.in/inf.v0\"\n)\n\nfunc main() {\n    // represents 1003 * 10^-3\n    someDec := inf.NewDec(1003, 3)\n\n    // multiply someDec by 1000 * 10^0\n    // which translates to 1003 * 10^-3 * 1000 * 10^0\n    someDec.Mul(someDec, inf.NewDec(1000, 0))\n\n    // inf.RoundHalfUp rounds half up in the 0th scale, eg. 0.5 rounds to 1\n    value, ok := someDec.Round(someDec, 0, inf.RoundHalfUp).Unscaled()\n    fmt.Println(value, ok)\n}\n</code></pre>\n\n<p>Hope this helps!</p>\n"}, {"tags": [], "owner": {"reputation": 385, "user_id": 5386963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d57a66c301b782f4630f4e45200cc2a5?s=128&d=identicon&r=PG&f=1", "display_name": "AndrewN", "link": "https://stackoverflow.com/users/5386963/andrewn"}, "is_accepted": false, "score": 2, "last_activity_date": 1445226534, "creation_date": 1445226534, "answer_id": 33206350, "question_id": 33206059, "link": "https://stackoverflow.com/questions/33206059/go-converting-float64-to-int-with-multiplier/33206350#33206350", "title": "Go: Converting float64 to int with multiplier", "body": "<p>As Will mentions, this comes down to how floats are represented on various platforms. Essentially you need to round the float rather than let the default truncating behavior to happen. There's no standard library function for this, probably because there's a lot of possible behavior and it's trivial to implement.</p>\n\n<p>If you knew you'd always have errors of the sort described, where you're slightly below (1299.999999) the value desired (1300.00000) you could use the math library's <code>Ceil</code> function:</p>\n\n<pre><code>f := 1.29999\nn := math.Ceil(f*1000)\n</code></pre>\n\n<p>But if you have different kinds of floating error and want a more general sorting behavior? Use the math library's <code>Modf</code> function to separate the your floating point value by the decimal point:</p>\n\n<pre><code>f := 1.29999\n\nf1,f2 := math.Modf(f*1000)\nn := int(f1) // n = 1299   \nif f2 &gt; .5 { \n    n++\n}\nfmt.Println(n)\n</code></pre>\n\n<p>You can run a slightly more generalized version of this code in the <a href=\"http://play.golang.org/p/6nCSpaFUPt\" rel=\"nofollow\">playground</a> yourself.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1471850118, "last_edit_date": 1592644375, "creation_date": 1445238042, "answer_id": 33208417, "question_id": 33206059, "link": "https://stackoverflow.com/questions/33206059/go-converting-float64-to-int-with-multiplier/33208417#33208417", "title": "Go: Converting float64 to int with multiplier", "body": "<p><a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">Go spec: Conversions:</a></p>\n<blockquote>\n<p><strong>Conversions between numeric types</strong></p>\n<p>When converting a floating-point number to an integer, the fraction is discarded (truncation towards zero).</p>\n</blockquote>\n<p>So basically when you convert a floating-point number to an integer, only the integer part is kept.</p>\n<p>If you just want to avoid errors arising from representing with finite bits, just add <code>0.5</code> to the number before converting it to <code>int</code>. No external libraries or function calls (from standard library) required.</p>\n<p>Since <code>float -&gt; int</code> conversion is <em>not rounding</em> but <em>keeping the integer part</em>, this will give you the desired result. Taking into consideration both the possible smaller and greater representation:</p>\n<pre><code>1002.9999 + 0.5 = 1003.4999;     integer part: 1003\n1003.0001 + 0.5 = 1003.5001;     integer part: 1003\n</code></pre>\n<p>So simply just write:</p>\n<pre><code>var f float64 = 1.003\nfmt.Println(int(f * 1000 + 0.5))\n</code></pre>\n<p>To wrap this into a function:</p>\n<pre><code>func toint(f float64) int {\n    return int(f + 0.5)\n}\n\n// Using it:\nfmt.Println(toint(f * 1000))\n</code></pre>\n<p>Try them on the <a href=\"http://play.golang.org/p/m4qqMtiMbn\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n<p><strong>Note:</strong></p>\n<p>Be careful when you apply this in case of negative numbers! For example if you have a value of <code>-1.003</code>, then you probably want the result to be <code>-1003</code>. But if you add <code>0.5</code> to it:</p>\n<pre><code>-1002.9999 + 0.5 = -1002.4999;     integer part: -1002\n-1003.0001 + 0.5 = -1002.5001;     integer part: -1002\n</code></pre>\n<p>So if you have negative numbers, you have to either:</p>\n<ul>\n<li>subtract <code>0.5</code> instead of adding it</li>\n<li>or add <code>0.5</code> but subtract <code>1</code> from the result</li>\n</ul>\n<p>Incorporating this into our helper function:</p>\n<pre><code>func toint(f float64) int {\n    if f &lt; 0 {\n        return int(f - 0.5)\n    }\n    return int(f + 0.5)\n}\n</code></pre>\n"}], "owner": {"reputation": 1057, "user_id": 1750407, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/EobHJ.jpg?s=128&g=1", "display_name": "Wendy Adi", "link": "https://stackoverflow.com/users/1750407/wendy-adi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2713, "favorite_count": 1, "accepted_answer_id": 33208417, "answer_count": 3, "score": 3, "last_activity_date": 1471850118, "creation_date": 1445224294, "last_edit_date": 1445241092, "question_id": 33206059, "link": "https://stackoverflow.com/questions/33206059/go-converting-float64-to-int-with-multiplier", "title": "Go: Converting float64 to int with multiplier", "body": "<p>I want to convert a <code>float64</code> number, let's say it <code>1.003</code> to <code>1003</code> (integer type). My implementation is simply multiply the <code>float64</code> with <code>1000</code> and cast it to <code>int</code>.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n\nfunc main() {\n  var f float64 = 1.003\n  fmt.Println(int(f * 1000))\n}\n</code></pre>\n\n<p>But when I run that code, what I got is <code>1002</code> not <code>1003</code>. Because Go automatically stores <code>1.003</code> as <code>1.002999...</code> in the variable. What is the correct approach to do this kind of operation on Golang?</p>\n"}, {"tags": ["go", "overloading", "built-in"], "answers": [{"comments": [{"owner": {"reputation": 13457, "user_id": 954376, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/08PZK.jpg?s=128&g=1", "display_name": "NeoWang", "link": "https://stackoverflow.com/users/954376/neowang"}, "edited": false, "score": 1, "creation_date": 1445222787, "post_id": 33205700, "comment_id": 54216419, "body": "By <code>override</code> I mean when <code>item = items[0]</code>, it is actually calling <code>getItem</code>, it is not the case in your code."}], "tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": false, "score": 0, "last_activity_date": 1445221732, "creation_date": 1445221732, "answer_id": 33205700, "question_id": 33205482, "link": "https://stackoverflow.com/questions/33205482/does-go-support-operator-overloading-for-builtin-types-like-map-and-slice/33205700#33205700", "title": "Does Go support operator overloading for builtin types like map and slice?", "body": "<p>You could do something like that using <code>map</code> type. Here is the example.</p>\n\n<pre><code>type MyItem struct {\n    name string\n}\n\ntype MySlice map[int]MyItem\n\nfunc (m MySlice) getItem(i int) MyItem {\n    return m[i]\n}\n\nfunc (m MySlice) setItem(i int, item MyItem) {\n    m[i] = item\n}\n\nfunc main() {\n    var items = MySlice{}\n    items.setItem(0, MyItem{\"john\"})\n    items[1] = MyItem{\"doe\"}\n\n    var item0 = items[0]\n    fmt.Println(item0.name)\n\n    var item1 = items.getItem(1)\n    fmt.Println(item1.name)\n}\n</code></pre>\n\n<p>As we could see, the way to set &amp; get <code>item0</code> and <code>item1</code> is different but the result is same. </p>\n\n<pre><code>// set data\nitems.setItem(0, item)\nitems[0] = item\n\n// get data\nitem = items[0]\nitem = items.getItem(0)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1591, "user_id": 622121, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5eb5b05a7391cfa97fc9016ce95471ee?s=128&d=identicon&r=PG", "display_name": "Kenji Noguchi", "link": "https://stackoverflow.com/users/622121/kenji-noguchi"}, "edited": false, "score": 0, "creation_date": 1589754742, "post_id": 33206004, "comment_id": 109412347, "body": "I really disagree with the last phrase.  For example I wished there were + and - operator for Time object to adjust by Duration.  There are <code>.Add</code> and <code>Sub</code> methods.  Ok, sounds good, right? Actually not. Guess what? Add is for Duration, Sub is for Time.  As for comparison there are <code>.After</code> and <code>.Before</code> but how do you EqualOrAfter EqualOrBefore?.  You have to negate the .Before or .After with obj and arg flipped!  Every operational type  has to come up with unnecessarily verbose op func names.  On top of that there is no enforcement of the naming convention.  This is really messy and bad."}], "tags": [], "owner": {"reputation": 385, "user_id": 5386963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d57a66c301b782f4630f4e45200cc2a5?s=128&d=identicon&r=PG&f=1", "display_name": "AndrewN", "link": "https://stackoverflow.com/users/5386963/andrewn"}, "is_accepted": true, "score": 7, "last_activity_date": 1445223940, "last_edit_date": 1592644375, "creation_date": 1445223940, "answer_id": 33206004, "question_id": 33205482, "link": "https://stackoverflow.com/questions/33205482/does-go-support-operator-overloading-for-builtin-types-like-map-and-slice/33206004#33206004", "title": "Does Go support operator overloading for builtin types like map and slice?", "body": "<p>No, operator overloading is not a feature of Go.</p>\n<p>Quoting from the <a href=\"https://golang.org/doc/faq#overloading\" rel=\"noreferrer\">official FAQ</a> to explain <em>why</em>:</p>\n<blockquote>\n<p>Method dispatch is simplified if it doesn't need to do type matching as well. Experience with other languages told us that having a variety of methods with the same name but different signatures was occasionally useful but that it could also be confusing and fragile in practice. Matching only by name and requiring consistency in the types was a major simplifying decision in Go's type system.</p>\n<p>Regarding operator overloading, it seems more a convenience than an absolute requirement. Again, things are simpler without it.</p>\n</blockquote>\n"}], "owner": {"reputation": 13457, "user_id": 954376, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/08PZK.jpg?s=128&g=1", "display_name": "NeoWang", "link": "https://stackoverflow.com/users/954376/neowang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 915, "favorite_count": 1, "accepted_answer_id": 33206004, "answer_count": 2, "score": 0, "last_activity_date": 1445223940, "creation_date": 1445219914, "last_edit_date": 1445221043, "question_id": 33205482, "link": "https://stackoverflow.com/questions/33205482/does-go-support-operator-overloading-for-builtin-types-like-map-and-slice", "title": "Does Go support operator overloading for builtin types like map and slice?", "body": "<p>In python, I can define types that override list item access and dict value access by defining <code>__getitem__()</code>. Can I do something similar in Go?</p>\n\n<pre><code>// What I mean is:\ntype MySlice []MyItem\n// Definition of MySlice\n......\nfunc (s MySlice) getItem(i int) MyItem {\n}\n......\n// Access is overrided with calling getItem()\nitem := ms[0] //calling ms.getItem(0)\n// Is this doable?\n</code></pre>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1445217927, "post_id": 33204589, "comment_id": 54215214, "body": "Are you <i>sure</i> your credentials are correct? No trailing spaces/formatting from copying it into your editor? Note that your program just continues if there&#39;s an error connecting to the driver (it should probably be <code>log.Fatal(err)</code> in that instance)"}, {"owner": {"reputation": 79, "user_id": 5357200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/281343c28c4be8a226c3afcf15386a7a?s=128&d=identicon&r=PG&f=1", "display_name": "anonymus", "link": "https://stackoverflow.com/users/5357200/anonymus"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1445242612, "post_id": 33204589, "comment_id": 54223654, "body": "i have not put credentials in code but &lt;dbuser&gt;:&lt;dbpassword&gt; are username and password. I got this format &#39;mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@ds041154.mongolab.com:41154&zwnj;&#8203;/location&#39; by creating mongodb online."}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1447411016, "post_id": 33204589, "comment_id": 55153331, "body": "@elithrar My credentials are also correct but I&#39;m getting <code>auth failed</code> error calling <code>mgo.Dial</code>"}], "answers": [{"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 4, "last_activity_date": 1445222330, "creation_date": 1445222330, "answer_id": 33205776, "question_id": 33204589, "link": "https://stackoverflow.com/questions/33204589/connection-to-remote-mongodb-server-failed-in-golang-giving-authentication-erro/33205776#33205776", "title": "connection to remote mongodb server failed in golang, giving authentication error", "body": "<p>You need to call <a href=\"https://godoc.org/gopkg.in/mgo.v2#Database.Login\" rel=\"nofollow\">.Login(user, pass string)</a> on the database you need to authenticate with:</p>\n\n<pre><code>if err:= session.DB(authDB).Login(user, pass); err != nil {\n  panic(err)\n}\n</code></pre>\n\n<p>Note that this authenticates the <code>session</code>, so each other session you <a href=\"https://godoc.org/gopkg.in/mgo.v2#Session.Copy\" rel=\"nofollow\">.Copy()</a> or <a href=\"https://godoc.org/gopkg.in/mgo.v2#Session.Clone\" rel=\"nofollow\">.Clone()</a> from it is also authenticated.</p>\n"}, {"tags": [], "owner": {"reputation": 1859, "user_id": 1307985, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/971c9be683402a64b53babcb56e5c205?s=128&d=identicon&r=PG", "display_name": "Velin Georgiev", "link": "https://stackoverflow.com/users/1307985/velin-georgiev"}, "is_accepted": false, "score": 6, "last_activity_date": 1449871916, "creation_date": 1449871916, "answer_id": 34233387, "question_id": 33204589, "link": "https://stackoverflow.com/questions/33204589/connection-to-remote-mongodb-server-failed-in-golang-giving-authentication-erro/34233387#34233387", "title": "connection to remote mongodb server failed in golang, giving authentication error", "body": "<p>I was getting similar error, but I found that I had entered wrong login credentials.</p>\n\n<p>This code worked for me:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    \"gopkg.in/mgo.v2\"\n)\n\n//const MongoDb details\nconst (\n    hosts      = \"ds026491.mongolab.com:26491\"\n    database   = \"messagingdb\"\n    username   = \"admin\"\n    password   = \"youPassword\"\n    collection = \"messages\"\n)\n\nfunc main() {\n\n    info := &amp;mgo.DialInfo{\n        Addrs:    []string{hosts},\n        Timeout:  60 * time.Second,\n        Database: database,\n        Username: username,\n        Password: password,\n    }\n\n    session, err1 := mgo.DialWithInfo(info)\n    if err1 != nil {\n        panic(err1)\n    }\n\n    col := session.DB(database).C(collection)\n\n    count, err2 := col.Count()\n    if err2 != nil {\n        panic(err2)\n    }\n    fmt.Println(fmt.Sprintf(\"Messages count: %d\", count))\n}\n</code></pre>\n\n<p>It is also on <a href=\"https://github.com/Velkata/Golang-MongoDB3.0-Example\" rel=\"noreferrer\">Github</a></p>\n"}], "owner": {"reputation": 79, "user_id": 5357200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/281343c28c4be8a226c3afcf15386a7a?s=128&d=identicon&r=PG&f=1", "display_name": "anonymus", "link": "https://stackoverflow.com/users/5357200/anonymus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8169, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1549604490, "creation_date": 1445212387, "last_edit_date": 1445217796, "question_id": 33204589, "link": "https://stackoverflow.com/questions/33204589/connection-to-remote-mongodb-server-failed-in-golang-giving-authentication-erro", "title": "connection to remote mongodb server failed in golang, giving authentication error", "body": "<p>I am trying to connect to remote mongodb server in golang and adding data in database. Its giving me error as follows:\nserver returned error on SASL authentication step: Authentication failed.</p>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n    \"log\"\n    // \"os\"\n)\n\ntype Person struct {\n    Name  string\n    Phone string\n}\n\nfunc main() {\n\n    session, err := mgo.Dial(\"mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@ds041154.mongolab.com:41154/location\")\n\n    if err != nil {\n        fmt.Println(err)\n    } else {\n        fmt.Println(\"Session created\")\n    }\n\n    // Optional. Switch the session to a monotonic behavior.\n    session.SetMode(mgo.Monotonic, true)\n\n    c := session.DB(\"location\").C(\"people\")\n    err = c.Insert(&amp;Person{\"Ale\", \"+55 53 8116 9639\"},\n        &amp;Person{\"Cla\", \"+55 53 8402 8510\"})\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    result := Person{}\n    err = c.Find(bson.M{\"name\": \"Ale\"}).One(&amp;result)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(\"Phone:\", result.Phone)\n\n}\n</code></pre>\n\n<p>Any help on this is appreciated.</p>\n"}, {"tags": ["mongodb", "go", "goroutine", "mgo"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1445220184, "post_id": 33204397, "comment_id": 54215737, "body": "You&#39;ll need to post your database code to help debug this efficiency\u2014particularly around how you&#39;re using goroutines."}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1445249709, "post_id": 33204397, "comment_id": 54227786, "body": "Edited question to include my code that communicates with the database. Thx"}], "answers": [{"comments": [{"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1445257429, "post_id": 33214151, "comment_id": 54232565, "body": "Yeah I realise that, I was being extremely lazy and copy pasting code to make sure it worked. I do plan on cleaning up the DB connections, however I don&#39;t think it changes why I get the stack trace?"}, {"owner": {"reputation": 18455, "user_id": 2657550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88d553accfca32636d96a8d5075e85d1?s=128&d=identicon&r=PG", "display_name": "Gustavo Niemeyer", "link": "https://stackoverflow.com/users/2657550/gustavo-niemeyer"}, "reply_to_user": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1445363891, "post_id": 33214151, "comment_id": 54289507, "body": "I provided details for what exactly is the problem in the code you pasted above. Are you not using the code you pasted, or do you not agree that this is the issue? If you disagree, it should be on a better basis than &quot;I don&#39;t think&quot;."}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1445442146, "post_id": 33214151, "comment_id": 54328434, "body": "Your response reads as though you are commenting on best practices and efficiency, not directly talking about why I am experiencing the stack trace. I&#39;ll tidy it up so that it doesn&#39;t connect and disconnect every time - it was a POC rather than &quot;finished code&quot;"}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1445452419, "post_id": 33214151, "comment_id": 54334556, "body": "Gustavo I re-read the link you posted, so does that mean I should create an instance of the &quot;Master Session&quot; in <code>main()</code> and then pass the session to each function and routine that needs in, then call <code>dataStore()</code> to get a copy of it when its needed?"}, {"owner": {"reputation": 18455, "user_id": 2657550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88d553accfca32636d96a8d5075e85d1?s=128&d=identicon&r=PG", "display_name": "Gustavo Niemeyer", "link": "https://stackoverflow.com/users/2657550/gustavo-niemeyer"}, "reply_to_user": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1445457784, "post_id": 33214151, "comment_id": 54337485, "body": "Yes, something along these lines. If you read the package documentation for mgo, and search for session management strategies in the mailing list or online, you should find several conversations on the topic."}], "tags": [], "owner": {"reputation": 18455, "user_id": 2657550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88d553accfca32636d96a8d5075e85d1?s=128&d=identicon&r=PG", "display_name": "Gustavo Niemeyer", "link": "https://stackoverflow.com/users/2657550/gustavo-niemeyer"}, "is_accepted": true, "score": 0, "last_activity_date": 1445256941, "last_edit_date": 1495539870, "creation_date": 1445256941, "answer_id": 33214151, "question_id": 33204397, "link": "https://stackoverflow.com/questions/33204397/mongodb-queries-on-routines-produces-huge-stack-trace/33214151#33214151", "title": "Mongodb queries on routines produces huge stack trace", "body": "<p>It looks like the quoted logic is dialing MongoDB every time it needs to do something with it, which isn't the appropriate way to hold sustained database communication within an HTTP server.</p>\n\n<p>Every time you <code>Dial</code> a MongoDB server (or replica set, or mongos), some background activity is started to keep the cluster topology up-to-date in memory, and to maintain the pool of connections sane (note that <em>all</em> sessions that are created after a single <code>Dial</code> call will share a single pool of connections).</p>\n\n<p>Calling <code>Dial</code> every time one wants to talk to the database means all of that logic becomes independent for each of the dials, and that background activity may take a moment to shut down after the last session is closed. </p>\n\n<p>So even though it will work, it's very inefficient as it has to learn again about the topology in use, it fails to use connections from an existing pool, and it also creates unnecessary background churn which is what you are observing in your backtrace.</p>\n\n<p>For some ideas on how to better maintain a session in this context, please see this topic:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/26574594/best-practice-to-maintain-a-mgo-session\">Best practice to maintain a mgo session</a></li>\n</ul>\n"}], "owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1028, "favorite_count": 0, "accepted_answer_id": 33214151, "answer_count": 1, "score": 0, "last_activity_date": 1572514344, "creation_date": 1445210733, "last_edit_date": 1572514344, "question_id": 33204397, "link": "https://stackoverflow.com/questions/33204397/mongodb-queries-on-routines-produces-huge-stack-trace", "title": "Mongodb queries on routines produces huge stack trace", "body": "<p>I am doing lots of web calls to an api in a go program, and the results are stored in a database (using mgo). The api calls are done on separate go routines. On other routines, I am pulling the information out of the database and processing it, before updating the database. When the data is put back, a flag is set so that it is known that that data has been post processed so when the program asks the database for another entry to post process the database hands back one where the flag <code>complete</code> is set to <code>false</code>. When the flag is set to true, the go routine is shutdown: <code>wg.done()</code>.</p>\n\n<p>All is good, I have lots of print outs telling me how the program is getting on, however towards the end of its running I get a huge stack trace containing lots of the same:</p>\n\n<blockquote>\n  <p>goroutine 56731 [sleep]: time.Sleep(0x12a05f200)\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/time.go:59 +0xf9\n  gopkg.in/mgo%2ev2.(*mongoServer).pinger(0xc82601b420, 0x1)\n    /Users/alex/go/src/gopkg.in/mgo.v2/server.go:295 +0x1b4 created by\n  gopkg.in/mgo%2ev2.newServer\n    /Users/alex/go/src/gopkg.in/mgo.v2/server.go:88 +0x162</p>\n  \n  <p>goroutine 56698 [sleep]: time.Sleep(0x12a05f200)\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/time.go:59 +0xf9\n  gopkg.in/mgo%2ev2.(*mongoServer).pinger(0xc82601bce0, 0x1)\n    /Users/alex/go/src/gopkg.in/mgo.v2/server.go:295 +0x1b4 created by\n  gopkg.in/mgo%2ev2.newServer\n    /Users/alex/go/src/gopkg.in/mgo.v2/server.go:88 +0x162</p>\n  \n  <p>goroutine 56699 [sleep]: time.Sleep(0x1dcd6500)\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/time.go:59 +0xf9\n  gopkg.in/mgo%2ev2.(*mongoCluster).syncServersLoop(0xc8256425a0)\n    /Users/alex/go/src/gopkg.in/mgo.v2/cluster.go:353 +0x2b1 created by\n  gopkg.in/mgo%2ev2.newCluster\n    /Users/alex/go/src/gopkg.in/mgo.v2/cluster.go:73 +0x1a0</p>\n  \n  <p>goroutine 56738 [sleep]: time.Sleep(0x12a05f200)\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/time.go:59 +0xf9\n  gopkg.in/mgo%2ev2.(*mongoServer).pinger(0xc82606fa40, 0x1)\n    /Users/alex/go/src/gopkg.in/mgo.v2/server.go:295 +0x1b4 created by\n  gopkg.in/mgo%2ev2.newServer\n    /Users/alex/go/src/gopkg.in/mgo.v2/server.go:88 +0x162</p>\n</blockquote>\n\n<p>There is one thing amongst all of those that is below, which is the only different output on the stack trace to the above (the above is just a sample, my terminal can't scroll back to the beginning there is so many)</p>\n\n<blockquote>\n  <p>goroutine 57201 [IO wait]: net.runtime_pollWait(0xedb6f0, 0x72,\n  0xc82000a2c0)\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/netpoll.go:157 +0x60\n  net.(*pollDesc).Wait(0xc827b0e5a0, 0x72, 0x0, 0x0)\n    /usr/local/Cellar/go/1.5/libexec/src/net/fd_poll_runtime.go:73 +0x3a\n  net.(*pollDesc).WaitRead(0xc827b0e5a0, 0x0, 0x0)\n    /usr/local/Cellar/go/1.5/libexec/src/net/fd_poll_runtime.go:78 +0x36\n  net.(*netFD).Read(0xc827b0e540, 0xc828d61000, 0x1000, 0x1000, 0x0,\n  0x754050, 0xc82000a2c0)\n    /usr/local/Cellar/go/1.5/libexec/src/net/fd_unix.go:232 +0x23a\n  net.(*conn).Read(0xc8260eac38, 0xc828d61000, 0x1000, 0x1000, 0x0, 0x0,\n  0x0)  /usr/local/Cellar/go/1.5/libexec/src/net/net.go:172 +0xe4\n  net/http.noteEOFReader.Read(0x7960c0, 0xc8260eac38, 0xc82751fd38,\n  0xc828d61000, 0x1000, 0x1000, 0xc82644dc20, 0x0, 0x0)\n    /usr/local/Cellar/go/1.5/libexec/src/net/http/transport.go:1370 +0x67\n  net/http.(*noteEOFReader).Read(0xc826116e60, 0xc828d61000, 0x1000,\n  0x1000, 0xc827d1a770, 0x0, 0x0)   :126 +0xd0\n  bufio.(*Reader).fill(0xc82644d4a0)\n    /usr/local/Cellar/go/1.5/libexec/src/bufio/bufio.go:97 +0x1e9\n  bufio.(*Reader).Peek(0xc82644d4a0, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/Cellar/go/1.5/libexec/src/bufio/bufio.go:132 +0xcc\n  net/http.(*persistConn).readLoop(0xc82751fce0)\n    /usr/local/Cellar/go/1.5/libexec/src/net/http/transport.go:876 +0xf7\n  created by net/http.(*Transport).dialConn\n    /usr/local/Cellar/go/1.5/libexec/src/net/http/transport.go:685 +0xc78</p>\n</blockquote>\n\n<p>I am struggling to work out what it is telling me, whether its locking on writing to the database, whether the routines aren't closing and something is timing out, I don't know. \nI am using go 1.5 btw.</p>\n\n<p>The code that talks with the database is below:</p>\n\n<pre><code>func (l *Ledger) addRaceToDatabase(race Race) { //true if added, \n\nfalse if existed\n  session, err := mgo.Dial(\"127.0.0.1\")\n  if err != nil {\n    panic(err)\n  }\n\n  defer session.Close()\n\n  session.SetMode(mgo.Monotonic, true)\n\n  c := session.DB(\"collection\").C(\"races\")\n\n    // Index\n  index := mgo.Index{\n    Key:        []string{\"id\"},\n    Unique:     true,\n    DropDups:   true,\n    Background: true,\n    Sparse:     true,\n  }\n\n  err = c.EnsureIndex(index)\n  if err != nil {\n    panic(err)\n  }\n\n  result := Race{}\n  //if the race exists, don't add it to the database\n  err = c.Find(bson.M{\"id\": race.ID}).One(&amp;result)\n  if err != nil {\n    //if there is an error there wasn't an entry so add this to the database\n    err = c.Insert(race)\n    if err != nil {\n        panic(err)\n    }   \n  } else {\n    //if it does find an entry, it will print it\n    fmt.Println(\"FOUND: \", result.ID)\n  }\n}\n</code></pre>\n"}, {"tags": ["go", "revel"], "comments": [{"owner": {"reputation": 222, "user_id": 2250895, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f375caf81f964c28b84d22992f4d7b11?s=128&d=identicon&r=PG", "display_name": "Herman", "link": "https://stackoverflow.com/users/2250895/herman"}, "edited": false, "score": 0, "creation_date": 1445200980, "post_id": 33202323, "comment_id": 54210755, "body": "Problem solved: git was an old version. I had tried EVERYTHING, but didn&#39;t enable rpmforge; default CentOS base repository was 1.7.1. I upgraded git and compiled from source - for sh*ts and giggles - and voila. Fixed. Good God!"}, {"owner": {"reputation": 7922, "user_id": 2747593, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/cdcEd.jpg?s=128&g=1", "display_name": "Scott Weldon", "link": "https://stackoverflow.com/users/2747593/scott-weldon"}, "edited": false, "score": 0, "creation_date": 1484605377, "post_id": 33202323, "comment_id": 70569078, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/29895951/go-get-hanging-on-certain-library\">&quot;go get&quot; hanging on certain library</a>"}], "answers": [{"tags": [], "owner": {"reputation": 222, "user_id": 2250895, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f375caf81f964c28b84d22992f4d7b11?s=128&d=identicon&r=PG", "display_name": "Herman", "link": "https://stackoverflow.com/users/2250895/herman"}, "is_accepted": true, "score": 1, "last_activity_date": 1484605353, "last_edit_date": 1484605353, "creation_date": 1445203507, "answer_id": 33203416, "question_id": 33202323, "link": "https://stackoverflow.com/questions/33202323/golang-revel-freezes-when-download-gopkg-in-fsnotify-v1/33203416#33203416", "title": "Golang Revel freezes when download gopkg.in/fsnotify.v1", "body": "<p>Upgrade Git so that it is greater than 1.7.1 (latest CentOS base version). Try rpmforge first; if that doesn't work, compile from source: <a href=\"https://git-scm.com/book/en/v2/Getting-Started-Installing-Git#Installing-from-Source\" rel=\"nofollow noreferrer\">https://git-scm.com/book/en/v2/Getting-Started-Installing-Git#Installing-from-Source</a></p>\n\n<p>I'm on Git 2.6.2 and it's working fine now: <code>go get -v github.com/revel/revel</code> (<code>-v</code> for verbose mode)</p>\n"}], "owner": {"reputation": 222, "user_id": 2250895, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f375caf81f964c28b84d22992f4d7b11?s=128&d=identicon&r=PG", "display_name": "Herman", "link": "https://stackoverflow.com/users/2250895/herman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 626, "favorite_count": 1, "accepted_answer_id": 33203416, "answer_count": 1, "score": 1, "last_activity_date": 1484605353, "creation_date": 1445197019, "last_edit_date": 1484605224, "question_id": 33202323, "link": "https://stackoverflow.com/questions/33202323/golang-revel-freezes-when-download-gopkg-in-fsnotify-v1", "title": "Golang Revel freezes when download gopkg.in/fsnotify.v1", "body": "<p>I'm using CentOS7; tried downloading the golang 1.5.1 binary and also <code>yum install golang</code>, and run into the same problem installed revel. Go works fine; when I do <code>go version</code> it displays the proper version.</p>\n\n<p>When I type <code>go get -v github.com/revel/revel</code>, a few packages download just fine.... until it gets to fsnotify. Then I get this output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Fetching https://gopkg.in/fsnotify.v1?go-get=1\nParsing meta tags from https://gopkg.in/fsnotify.v1?go-get=1 (status code 200)\nget \"gopkg.in/fsnotify.v1\": found meta tag main.metaImport{Prefix:\"gopkg.in/fsnotify.v1\", VCS:\"git\", RepoRoot:\"https://gopkg.in/fsnotify.v1\"} at https://gopkg.in/fsnotify.v1?go-get=1\ngopkg.in/fsnotify.v1 (download)\n</code></pre>\n\n<p>And it just freezes. No matter what I try, it doesn't download anything into <code>src/gopkg.in/fsnotify</code>. Files in <code>src/github.com</code> and <code>src/golang.org</code> are pulled just fine. I already made sure I'm able to curl into <a href=\"http://gopkg.in\" rel=\"nofollow noreferrer\">http://gopkg.in</a> and <a href=\"https://gopkg.in\" rel=\"nofollow noreferrer\">https://gopkg.in</a>, so it doesn't look like an SSLv3 issue.</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["reflection", "go"], "comments": [{"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "edited": false, "score": 0, "creation_date": 1445185248, "post_id": 33200095, "comment_id": 54205226, "body": "For my fellow answerers, runnable playground link: <a href=\"https://play.golang.org/p/fnjfVl1anv\" rel=\"nofollow noreferrer\">play.golang.org/p/fnjfVl1anv</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": true, "score": 2, "last_activity_date": 1445186842, "last_edit_date": 1445186842, "creation_date": 1445185813, "answer_id": 33200344, "question_id": 33200095, "link": "https://stackoverflow.com/questions/33200095/how-to-extract-the-interface-type-name-and-package-using-reflection/33200344#33200344", "title": "How to extract the interface type name and package using reflection?", "body": "<p>Here is some working code: <a href=\"https://play.golang.org/p/ET8FlguA_C\" rel=\"nofollow\">https://play.golang.org/p/ET8FlguA_C</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype MyInterface interface {\n    MyMethod()\n}\n\ntype MyStruct struct{}\n\nfunc (ms *MyStruct) MyMethod() {}\n\nfunc main() {\n    var structVar MyInterface = &amp;MyStruct{}\n    c := reflect.TypeOf(structVar)\n\n    fn := func(MyInterface) {}\n    fc := reflect.TypeOf(fn).In(0)\n\n    fmt.Println(isMyInterface(c), isMyInterface(fc), c, fc)\n    // OP expects : \"true true main.MyInterface main.MyInterface\"\n}\n\nfunc isMyInterface(r reflect.Type) bool {\n    // TypeOf trick found at https://groups.google.com/forum/#!topic/golang-nuts/qgJy_H2GysY\n    return r.Implements(reflect.TypeOf((*MyInterface)(nil)).Elem())\n}\n</code></pre>\n\n<hr>\n\n<p>Here is my answer before I found an actual solution with <code>reflect</code>.\nI'm gonna let it here because I think it still has some interesting parts.</p>\n\n<hr>\n\n<p>First things first: for <code>c</code>, r.PkgPath() and r.Name() are empty because the underlying type is a pointer (<code>*context.valueCtx</code>).</p>\n\n<p>To fix that, you can use <code>c := reflect.Indirect(reflect.ValueOf(withValue(\"\"))).Type()</code></p>\n\n<p>But that does not make <code>isContext(c)</code> true, because you then have <code>r.PkgPath() == \"golang.org/x/net/context\" &amp;&amp; r.Name() == \"valueCtx\"</code>.</p>\n\n<p>The best way to check if a var implements an interface is to drop the reflection and use a type assertion like this:</p>\n\n<p><a href=\"https://play.golang.org/p/td1YaHHej9\" rel=\"nofollow\">https://play.golang.org/p/td1YaHHej9</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype MyInterface interface {\n    MyMethod()\n}\n\ntype MyStruct struct{}\n\nfunc (ms *MyStruct) MyMethod() {}\n\nfunc main() {\n    var structVar MyInterface = &amp;MyStruct{}\n\n    fmt.Println(isMyInterface(structVar))\n}\n\nfunc isMyInterface(object interface{}) bool {\n    _, ok := object.(MyInterface)\n    return ok\n}\n</code></pre>\n\n<p>Your code works as you expect with the function parameter because there is no underlying value, so <code>reflect</code> uses the interface type. But for any concrete var, it will use the actual type of the value.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 1457843, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/029783af40e3ce0caf31d3049e5aaf8b?s=128&d=identicon&r=PG", "display_name": "bbiao", "link": "https://stackoverflow.com/users/1457843/bbiao"}, "is_accepted": false, "score": 0, "last_activity_date": 1557197910, "creation_date": 1557197910, "answer_id": 56014927, "question_id": 33200095, "link": "https://stackoverflow.com/questions/33200095/how-to-extract-the-interface-type-name-and-package-using-reflection/56014927#56014927", "title": "How to extract the interface type name and package using reflection?", "body": "<p>There are two kinds of Interface in golang, aka, <strong>eface</strong> and <strong>iface</strong>. And the eface is an empty interface, which can simply represented as <code>interface {}</code>. The iface is kind of interface which has at least one method, such as:</p>\n\n<pre><code>type MyInterface interface {\n    Greeting() string\n}\n</code></pre>\n\n<p>In golang implementation, both eface and iface are two-word long struct. The eface holds the data and the data type, the iface holds the data, the interfacetype and the data type. When an iface assigned to an eface, the interfacetype information is ignored. Only the data and the data type passed to the eface.</p>\n\n<p>So, <code>reflect.TypeOf(i interface{})</code> 's parameter is and eface, no interfacetype information (aka context.Context in your case). So you can't get the original interfacetype.</p>\n"}], "owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3609, "favorite_count": 1, "accepted_answer_id": 33200344, "answer_count": 2, "score": 2, "last_activity_date": 1557197910, "creation_date": 1445184364, "last_edit_date": 1445184776, "question_id": 33200095, "link": "https://stackoverflow.com/questions/33200095/how-to-extract-the-interface-type-name-and-package-using-reflection", "title": "How to extract the interface type name and package using reflection?", "body": "<p>I need to know the type name and its path using reflection. type <code>Type</code> has a Name() and PkgPath() method but both of them return empty if the type is an interface.</p>\n\n<p>However if I reflect a function and extract the type information of its arguments I get the correct type information. Should I assume it's a bug in the former case? Shouldn't TypeOf return the same type information regardless the context(e.g. type function parameter or type of a value) ?</p>\n\n<p><em>I'm aware of type assertion but I don't always have a value to do the assertion so I need to work with reflect.Type information.</em></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"golang.org/x/net/context\"\n)\n\nfunc main() {\n    c := reflect.TypeOf(withValue(\"\"))\n    fn := func(context.Context){}\n    fc := reflect.TypeOf(fn).In(0)\n    fmt.Println(isContext(c),  isContext(fc), c, fc)\n}\n\nfunc isContext(r reflect.Type) bool {\n    return r.PkgPath() == \"golang.org/x/net/context\" &amp;&amp; r.Name() == \"Context\"\n}\n\n\nfunc withValue(v interface{}) context.Context {\n    return context.WithValue(context.TODO(), \"mykey\", v)\n}\n</code></pre>\n\n<p>Prints</p>\n\n<pre><code>false true *context.valueCtx context.Context\n</code></pre>\n"}, {"tags": ["go", "boltdb"], "answers": [{"tags": [], "owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "is_accepted": true, "score": 2, "last_activity_date": 1445183300, "last_edit_date": 1445183300, "creation_date": 1445182674, "answer_id": 33199827, "question_id": 33199261, "link": "https://stackoverflow.com/questions/33199261/golang-http-handler-context/33199827#33199827", "title": "golang http handler context", "body": "<p>I think I see your bug. This one is usually a little difficult to track because its just the <code>:</code> in front of the equals. It was basically a scoping issue because you declared <code>db</code> as a global while at the same time creating a <code>db</code> variable that was scoped to your main function.</p>\n\n<p>You used <code>db, err := ...</code> to assign the values instead of just <code>=</code>. <code>:=</code> will both declare and infer the type. Since its also doing declaration, the <code>db</code> you're using in the <code>main</code> function is not the <code>db</code> you have declared in the global scope. Meanwhile the handler is still attempting to use the <code>db</code> that was declared in the global scope. The below code is the same code as you initially had with a few comments in the code to outline what the working changes are. Hope this helps!</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/boltdb/bolt\"\n)\n\nvar db *bolt.DB // this is going to be a pointer and is going to be nil until its set by the main function\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    dberr := db.Update(func(tx *bolt.Tx) error {\n        log.Println(\"here\")\n        b := tx.Bucket([]byte(\"MyBucket\"))\n        loving := b.Get([]byte(\"loving\"))\n        log.Printf(\"He's loving %s but prefers %s\", r.URL.Path[1:], string(loving))\n        fmt.Fprintf(w, \"He's loving %s but prefers %s\", r.URL.Path[1:], string(loving))\n        return nil\n    })\n    if dberr != nil {\n        fmt.Errorf(\"db update: %s\", dberr)\n    }\n    log.Printf(\"Finished handling\")\n}\n\nfunc main() {\n    var err error                           // this will have to be declared because of the next line to assign db the first value returned from `bolt.Open`\n    db, err = bolt.Open(\"my.db\", 0600, nil) // notice that this has changed and is no longer `db, err := ...` rather its `db, err = ...`\n    if err != nil {\n        log.Fatal(err)\n    } else {\n        log.Println(\"database opened\")\n    }\n    dberr := db.Update(func(tx *bolt.Tx) error {\n        b, err := tx.CreateBucketIfNotExists([]byte(\"MyBucket\"))\n        if err != nil {\n            return fmt.Errorf(\"create bucket: %s\", err)\n        }\n        err2 := b.Put([]byte(\"loving\"), []byte(\"pizza\"))\n        if err2 != nil {\n            return fmt.Errorf(\"put loving: %s\", err2)\n        }\n        loving := b.Get([]byte(\"loving\"))\n        log.Printf(\"He's loving %s\", string(loving))\n        return nil\n    })\n\n    if dberr != nil {\n        fmt.Errorf(\"db update: %s\", err)\n    }\n    defer db.Close()\n\n    http.HandleFunc(\"/\", handler)\n    http.ListenAndServe(\":3000\", nil)\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user494599"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1116, "favorite_count": 0, "accepted_answer_id": 33199827, "answer_count": 1, "score": 0, "last_activity_date": 1445183300, "creation_date": 1445179326, "question_id": 33199261, "link": "https://stackoverflow.com/questions/33199261/golang-http-handler-context", "title": "golang http handler context", "body": "<p>I'm trying to understand variable scopes in golang with the following code.\nIn this example, calling in http a page will echo the uri query combined with a stored value in Boltdb.</p>\n\n<p>The problem is that the database driver doesn't seem to run correctly in the http handler context: it doesn't print anything to stdout nor to the http request.</p>\n\n<p>I was expecting it to print :</p>\n\n<blockquote>\n  <p>He's loving &lt;'uri query content'> but prefers pizza (data from bolt.db driver)</p>\n</blockquote>\n\n<p>How to fix this code?\n    package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"net/http\"\n    \"log\"\n    \"github.com/boltdb/bolt\"\n)\n\nvar db bolt.DB\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    dberr := db.Update(func(tx *bolt.Tx) error {\n    log.Println(\"here\")\n        b := tx.Bucket([]byte(\"MyBucket\"))\n            loving := b.Get([]byte(\"loving\"))\n        log.Printf(\"He's loving %s but prefers %s\",r.URL.Path[1:], string(loving))\n            fmt.Fprintf(w,\"He's loving %s but prefers %s\",r.URL.Path[1:], string(loving) )\n        return nil\n    })\n    if dberr != nil {\n        fmt.Errorf(\"db update: %s\", dberr)\n    }\n    log.Printf(\"Finished handling\")\n}\n\nfunc main() {\n\n    db, err := bolt.Open(\"my.db\", 0600, nil)\n    if err != nil {\n        log.Fatal(err)\n    }else{\n        log.Println(\"database opened\")\n    }\n    dberr := db.Update(func(tx *bolt.Tx) error {\n        b, err := tx.CreateBucketIfNotExists([]byte(\"MyBucket\"))\n        if err != nil {\n        return fmt.Errorf(\"create bucket: %s\", err)\n        }\n        err2 := b.Put([]byte(\"loving\"), []byte(\"pizza\"))\n        if err2 != nil {\n        return fmt.Errorf(\"put loving: %s\", err2)\n        }\n        loving := b.Get([]byte(\"loving\"))\n        log.Printf(\"He's loving %s\", string(loving))\n        return nil\n    })\n\n        if dberr != nil {\n        fmt.Errorf(\"db update: %s\", err)\n        }\n    defer db.Close()\n\n    http.HandleFunc(\"/\", handler)\n    http.ListenAndServe(\":8080\", nil)\n\n   }\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": false, "score": 0, "last_activity_date": 1445165340, "creation_date": 1445165340, "answer_id": 33197052, "question_id": 33196989, "link": "https://stackoverflow.com/questions/33196989/error-get-page-request/33197052#33197052", "title": "Error GET page request", "body": "<ol>\n<li>don't ignore error returned from template.ParseFiles</li>\n<li>put path including directory into template.ParseFiles </li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1445173117, "post_id": 33197231, "comment_id": 54201282, "body": "Building on this: keep in mind that if you&#39;re using <code>go run</code> then the program may not be running from the same directory as your templates. Better to a) use absolute paths and b) parse templates in main() and not within every handler (which means you&#39;re reading from disk in every request)."}], "tags": [], "owner": {"reputation": 2010, "user_id": 873070, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/035f76515d641ce019c3f43f5d90814e?s=128&d=identicon&r=PG", "display_name": "blang", "link": "https://stackoverflow.com/users/873070/blang"}, "is_accepted": true, "score": 3, "last_activity_date": 1445166494, "creation_date": 1445166494, "answer_id": 33197231, "question_id": 33196989, "link": "https://stackoverflow.com/questions/33196989/error-get-page-request/33197231#33197231", "title": "Error GET page request", "body": "<p>Always handle your errors</p>\n\n<pre><code> t, _ := template.ParseFiles(\"login.gtpl\")\n</code></pre>\n\n<p>What if this fails? Then <code>t</code> is nil and you get the same error</p>\n"}], "owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 33197231, "answer_count": 2, "score": -1, "last_activity_date": 1445166494, "creation_date": 1445164929, "question_id": 33196989, "link": "https://stackoverflow.com/questions/33196989/error-get-page-request", "title": "Error GET page request", "body": "<p>I'm new to Golang and I'm trying to create a simple web server but I'm getting an error in a GET request. This is the code:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"html/template\"\n    \"log\"\n    \"net/http\"\n    \"strings\"\n)\n\nfunc sayhelloName(w http.ResponseWriter, r *http.Request) {\n    r.ParseForm() \n    fmt.Println(r.Form) // print information on server side.\n    fmt.Println(\"path\", r.URL.Path)\n    fmt.Println(\"scheme\", r.URL.Scheme)\n    fmt.Println(r.Form[\"url_long\"])\n    for k, v := range r.Form {\n        fmt.Println(\"key:\", k)\n        fmt.Println(\"val:\", strings.Join(v, \"\"))\n    }\n    fmt.Fprintf(w, \"Hello Worrld!\") // write data to response\n}\n\nfunc login(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"method:\", r.Method) //get request method\n    if r.Method == \"GET\" {\n        t, _ := template.ParseFiles(\"login.gtpl\")\n        t.Execute(w, nil)\n    } else {\n        r.ParseForm()\n        // logic part of log in\n        fmt.Println(\"username:\", r.Form[\"username\"])\n        fmt.Println(\"password:\", r.Form[\"password\"])\n    }\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", sayhelloName) // setting router rule\n    http.HandleFunc(\"/login\", login)\n    err := http.ListenAndServe(\":9090\", nil) // setting listening port\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n\n<p><code>sayhelloName</code> works but not the <code>login</code> function. This is the output error:  </p>\n\n<pre><code>method: GET\n2015/10/18 12:46:28 http: panic serving 127.0.0.1:51714: runtime error: invalid memory address or nil pointer dereference\ngoroutine 6 [running]:\nnet/http.(*conn).serve.func1(0x1247aa20, 0xaf5380, 0x12490390)\n    c:/go/src/net/http/server.go:1287 +0xa2\nhtml/template.(*Template).escape(0x0, 0x0, 0x0)\n    c:/go/src/html/template/template.go:79 +0x37\nhtml/template.(*Template).Execute(0x0, 0xaf54e8, 0x12530080, 0x0, 0x0, 0x0, 0x0)\n    c:/go/src/html/template/template.go:101 +0x2b\nmain.login(0xaf5468, 0x12530080, 0x124f6620)\n    C:/Users/Fabio/Go/hello.go:30 +0x209\nnet/http.HandlerFunc.ServeHTTP(0x7462e4, 0xaf5468, 0x12530080, 0x124f6620)\n    c:/go/src/net/http/server.go:1422 +0x34\nnet/http.(*ServeMux).ServeHTTP(0x1252a020, 0xaf5468, 0x12530080, 0x124f6620)\n    c:/go/src/net/http/server.go:1699 +0x133\nnet/http.serverHandler.ServeHTTP(0x12476480, 0xaf5468, 0x12530080, 0x124f6620)\n    c:/go/src/net/http/server.go:1862 +0x156\nnet/http.(*conn).serve(0x1247aa20)\n    c:/go/src/net/http/server.go:1361 +0xc05\ncreated by net/http.(*Server).Serve\n    c:/go/src/net/http/server.go:1910 +0x343\n\nlogin.gptl it's in the same folder of source code file\n</code></pre>\n"}, {"tags": ["go", "gofmt"], "answers": [{"tags": [], "owner": {"reputation": 2010, "user_id": 873070, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/035f76515d641ce019c3f43f5d90814e?s=128&d=identicon&r=PG", "display_name": "blang", "link": "https://stackoverflow.com/users/873070/blang"}, "is_accepted": false, "score": 4, "last_activity_date": 1445166766, "creation_date": 1445166766, "answer_id": 33197275, "question_id": 33196952, "link": "https://stackoverflow.com/questions/33196952/how-to-use-rewrite-rule-to-replace-tabs-with-spaces-in-gofmt-tool/33197275#33197275", "title": "How to use rewrite rule to replace tabs with spaces in gofmt tool?", "body": "<p>Go's format forced by <code>gofmt</code> dictates to use tab indentation.\nAlso see the decision lead to it:\n <a href=\"https://code.google.com/p/go/issues/detail?id=7101\" rel=\"nofollow\">https://code.google.com/p/go/issues/detail?id=7101</a></p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1445189596, "creation_date": 1445189596, "answer_id": 33201047, "question_id": 33196952, "link": "https://stackoverflow.com/questions/33196952/how-to-use-rewrite-rule-to-replace-tabs-with-spaces-in-gofmt-tool/33201047#33201047", "title": "How to use rewrite rule to replace tabs with spaces in gofmt tool?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/cmd/gofmt/\" rel=\"nofollow\">Command gofmt</a></p>\n  \n  <p>The rewrite rule specified with the -r flag must be a string of the\n  form:</p>\n\n<pre><code>pattern -&gt; replacement\n</code></pre>\n  \n  <p>Both pattern and replacement must be valid Go expressions.</p>\n</blockquote>\n\n<p>The tab and space characters are not valid Go expressions. It won't work.</p>\n\n<blockquote>\n  <p>The Go Programming Language</p>\n  \n  <p>Alan A. A. Donovan &amp; Brian W. Kernighan</p>\n  \n  <p>ISBN: 978-0134190440</p>\n  \n  <p><a href=\"http://www.gopl.io/\" rel=\"nofollow\">gopl.io</a></p>\n  \n  <p>Go takes a strong stance on code formatting. The gofmt tool rewrites\n  code into the standard format, and the go tool\u2019s fmt subcommand\n  applies gofmt to all the files in the specified package, or the ones\n  in the current directory by default. All Go source files in the book\n  have been run through gofmt, and you should get into the habit of\n  doing the same for your own code. Declaring a standard format by fiat\n  eliminates a lot of pointless debate about trivia and, more\n  importantly, enables a variety of automated source code\n  transformations that would be infeasible if arbitrary formatting were\n  allowed.</p>\n</blockquote>\n\n<p>Always use gofmt code formatting.</p>\n"}], "owner": {"reputation": 2628, "user_id": 825563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9767bd2a811cab859b83635e3636e657?s=128&d=identicon&r=PG", "display_name": "Psylone", "link": "https://stackoverflow.com/users/825563/psylone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1419, "favorite_count": 1, "accepted_answer_id": 33201047, "answer_count": 2, "score": 0, "last_activity_date": 1445189596, "creation_date": 1445164673, "question_id": 33196952, "link": "https://stackoverflow.com/questions/33196952/how-to-use-rewrite-rule-to-replace-tabs-with-spaces-in-gofmt-tool", "title": "How to use rewrite rule to replace tabs with spaces in gofmt tool?", "body": "<p><code>gofmt</code> command supports -r flag to use rewrite rule during formatting the code. How to use it to replace <em>tabs indentation</em> with the <em>spaces indentation</em>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2010, "user_id": 873070, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/035f76515d641ce019c3f43f5d90814e?s=128&d=identicon&r=PG", "display_name": "blang", "link": "https://stackoverflow.com/users/873070/blang"}, "edited": false, "score": 1, "creation_date": 1445162881, "post_id": 33196183, "comment_id": 54198551, "body": "You&#39;re talking about tests, you don&#39;t mean unit tests i guess? I can not imagine a proper unit test needing your manual go routine scheduling"}, {"owner": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "reply_to_user": {"reputation": 2010, "user_id": 873070, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/035f76515d641ce019c3f43f5d90814e?s=128&d=identicon&r=PG", "display_name": "blang", "link": "https://stackoverflow.com/users/873070/blang"}, "edited": false, "score": 0, "creation_date": 1445163102, "post_id": 33196183, "comment_id": 54198600, "body": "No, of course, I don&#39;t mean unit tests.. I mean any work that returns a bool.. Sorry if I phrased it wrong. Should probably  rewrite the title. Say I want to test if the number is a prime or divisible by some other number. Does not matter really."}, {"owner": {"reputation": 2010, "user_id": 873070, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/035f76515d641ce019c3f43f5d90814e?s=128&d=identicon&r=PG", "display_name": "blang", "link": "https://stackoverflow.com/users/873070/blang"}, "edited": false, "score": 0, "creation_date": 1445165813, "post_id": 33196183, "comment_id": 54199385, "body": "Have a look at my answer, it&#39;s the best fit for your scenario i guess. But there are other options, but not as clean imo."}, {"owner": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "reply_to_user": {"reputation": 2010, "user_id": 873070, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/035f76515d641ce019c3f43f5d90814e?s=128&d=identicon&r=PG", "display_name": "blang", "link": "https://stackoverflow.com/users/873070/blang"}, "edited": false, "score": 0, "creation_date": 1445166038, "post_id": 33196183, "comment_id": 54199447, "body": "I am looking at it. Thank you. I have not run it yet but it looks like it is what I want. I was just waiting if any other implementations/options pop up."}, {"owner": {"reputation": 2010, "user_id": 873070, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/035f76515d641ce019c3f43f5d90814e?s=128&d=identicon&r=PG", "display_name": "blang", "link": "https://stackoverflow.com/users/873070/blang"}, "edited": false, "score": 0, "creation_date": 1445166105, "post_id": 33196183, "comment_id": 54199471, "body": "Yep, you can use the playground to test this solution and make adjustments"}], "answers": [{"tags": [], "owner": {"reputation": 2010, "user_id": 873070, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/035f76515d641ce019c3f43f5d90814e?s=128&d=identicon&r=PG", "display_name": "blang", "link": "https://stackoverflow.com/users/873070/blang"}, "is_accepted": true, "score": 2, "last_activity_date": 1445166030, "last_edit_date": 1445166030, "creation_date": 1445163888, "answer_id": 33196840, "question_id": 33196183, "link": "https://stackoverflow.com/questions/33196183/spread-sequential-tests-into-4-go-routines-and-terminate-all-if-one-fails/33196840#33196840", "title": "Spread sequential tests into 4 go routines and terminate all if one fails", "body": "<p>You can create a producer/consumer system: <a href=\"https://play.golang.org/p/rks0gB3aDb\" rel=\"nofollow\">https://play.golang.org/p/rks0gB3aDb</a></p>\n\n<pre><code>func main() {\n    ch := make(chan int)\n    clients := 4\n    // make it buffered, so all clients can fail without hanging\n    notifyCh := make(chan struct{}, clients)\n    go produce(100, ch, notifyCh)\n\n    var wg sync.WaitGroup\n    wg.Add(clients)\n    for i := 0; i &lt; clients; i++ {\n        go func() {\n            consumer(ch, notifyCh)\n            wg.Done()\n        }()\n    }\n    wg.Wait()\n\n}\n\nfunc consumer(in chan int, notifyCh chan struct{}) {\n    fmt.Printf(\"Start consumer\\n\")\n    for i := range in {\n        &lt;-time.After(100 * time.Millisecond)\n        if i == 42 {\n            fmt.Printf(\"%d fails\\n\", i)\n            notifyCh &lt;- struct{}{}\n            return\n        } else {\n            fmt.Printf(\"%d\\n\", i)\n        }\n\n    }\n    fmt.Printf(\"Consumer stopped working\\n\")\n}\n\nfunc produce(N int, out chan int, notifyCh chan struct{}) {\n    for i := 0; i &lt; N; i++ {\n        select {\n        case out &lt;- i:\n        case &lt;-notifyCh:\n            close(out)\n            return\n        }\n    }\n    close(out)\n}\n</code></pre>\n\n<p>The producer pushes numbers from 0 to 99 to the channel, the consumer consumes until the channel is closed. In main we create 4 clients and add them to a waitgroup to reliably check if every goroutine returned.\nEvery consumer can signal on the notifyCh, the producer stops working and no further numbers are generated, therefor all consumers return after their current number.</p>\n\n<p>There's also an option to create 4 go routines, wait for all of them to return, start the next 4 go routines. But this adds quite an overhead on waiting.</p>\n\n<p>Since you mentioned prime numbers, here's a really cool prime seive: <a href=\"https://golang.org/doc/play/sieve.go\" rel=\"nofollow\">https://golang.org/doc/play/sieve.go</a></p>\n"}, {"comments": [{"owner": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "edited": false, "score": 0, "creation_date": 1445165554, "post_id": 33196987, "comment_id": 54199316, "body": "Yes, do Test returns bool. If any of four routines fail the test, then all four should be terminated. The idea is simple, I just wanted to know how to implement it in go. I want to run some work for every number in succession. The range could be [1..1000] or [1..1000000000] Given that the range could be very long I want to split the tests in four parallel threads and tests numbers in blocks of four. And the question was how to construct this in go and how to terminate all threads if one of the routines fails the test. Thanks for the articles, I&#39;ll have a read"}], "tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": false, "score": 0, "last_activity_date": 1445164896, "creation_date": 1445164896, "answer_id": 33196987, "question_id": 33196183, "link": "https://stackoverflow.com/questions/33196183/spread-sequential-tests-into-4-go-routines-and-terminate-all-if-one-fails/33196987#33196987", "title": "Spread sequential tests into 4 go routines and terminate all if one fails", "body": "<p>Whether you will create one channel common or a channel per routines depend on what you want.</p>\n\n<p>If you want only put some numbers (or more general - requests) inside and you don't care which goroutine serve that, than of course is better to share a channel. In case when you want for example first 250 request to be served by goroutine1, than of course you cannot share a channel.</p>\n\n<p>For channel is a good practice use it as input or output. And the simples thing how sender can sent, that he is finished is close the channel. Good article about that is <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow\">https://blog.golang.org/pipelines</a></p>\n\n<p>What is not mentiond in the question - is you need also another channel (or channels) or or any other communication primitive to get results. And here is the channel most interesting than to feeding.</p>\n\n<p>What information should be sent - it should be sent, a bool after every doTest, or just know when everthing was done (it this case neither bool is not necessary just close a channel)?</p>\n\n<p>If you prefer program at first fail. Than I would prefer use buffered shared channel to feed the numbers. Don't forget to close it, when all numbers will be feed.</p>\n\n<p>And another unbuffered chan to let main thread know, that tests are done. It can be channel, there you only put the number, where test failed, or if you also want a positive result - channel of struct containing number and result, or any other informantion returned from doTest.</p>\n\n<p>Very good article about channel is also <a href=\"http://dave.cheney.net/2014/03/19/channel-axioms\" rel=\"nofollow\">http://dave.cheney.net/2014/03/19/channel-axioms</a></p>\n\n<p>Each of your four goroutines can report a failure (by sending error and closing channel). But gotcha is what goroutines should do, when all numbers passed and feeding channel is closed. And about that is also nice article <a href=\"http://nathanleclaire.com/blog/2014/02/15/how-to-wait-for-all-goroutines-to-finish-executing-before-continuing/\" rel=\"nofollow\">http://nathanleclaire.com/blog/2014/02/15/how-to-wait-for-all-goroutines-to-finish-executing-before-continuing/</a></p>\n"}], "owner": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 33196840, "answer_count": 2, "score": 0, "last_activity_date": 1535453844, "creation_date": 1445159427, "last_edit_date": 1535453844, "question_id": 33196183, "link": "https://stackoverflow.com/questions/33196183/spread-sequential-tests-into-4-go-routines-and-terminate-all-if-one-fails", "title": "Spread sequential tests into 4 go routines and terminate all if one fails", "body": "<p>Suppose I have a simple loop which does sequential tests like this.</p>\n\n<pre><code> for f := 1; f &lt;= 1000; f++ {\n            if doTest(f) {\n              break\n            }\n  }\n</code></pre>\n\n<p>I loop through range of numbers and do a test for each number. If test fails for one number, I break and exit the main thread. Simple enough.</p>\n\n<p>Now, how do correctly feed the test numbers in say four or several go routines. Basically, I want to test the numbers from 1 to 1000 in batches of 4 (or whatever number of go routines is).\nDo I create 4 routines reading from one channel and feed the numbers sequentially into this channel? Or do I make 4 routines with an individual channel?</p>\n\n<p>And another question. How do I stop all 4 routines if one of them fails the test? I've been reading some texts on channels but I cannot put the pieces together.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 691, "user_id": 5266452, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8ea07a3ee8a8f9a3f997377e06edd689?s=128&d=identicon&r=PG&f=1", "display_name": "Maiko Ohkawa", "link": "https://stackoverflow.com/users/5266452/maiko-ohkawa"}, "edited": false, "score": 0, "creation_date": 1445150936, "post_id": 33195104, "comment_id": 54195630, "body": "Oh, I see. I need the library name ahead of the object name. My question is cleared up. Thank you for your answer."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1445151264, "last_edit_date": 1445151264, "creation_date": 1445150657, "answer_id": 33195104, "question_id": 33195072, "link": "https://stackoverflow.com/questions/33195072/how-can-i-use-library-object/33195104#33195104", "title": "How can I use library object?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Qualified_identifiers\" rel=\"nofollow\">Qualified identifiers</a></p>\n  \n  <p>A qualified identifier is an identifier qualified with a package name\n  prefix. Both the package name and the identifier must not be blank.</p>\n\n<pre><code>QualifiedIdent = PackageName \".\" identifier .\n</code></pre>\n  \n  <p>A qualified identifier accesses an identifier in a different package,\n  which must be imported. The identifier must be exported and declared\n  in the package block of that package.</p>\n\n<pre><code>math.Sin  // denotes the Sin function in package math\n</code></pre>\n</blockquote>\n\n<p>Use the fully qualified name: <code>goquery.Document</code>. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/PuerkitoBio/goquery\"\n    \"log\"\n    \"os\"\n)\n\nfunc getLocalFile(filename string) *goquery.Document {\n    f, e := os.Open(filename)\n    if e != nil {\n        log.Fatal(e)\n    }\n    defer f.Close()\n\n    doc, e := goquery.NewDocumentFromReader(f)\n    if e != nil {\n        log.Fatal(e)\n    }\n    return doc\n}\n\nconst FILE_NAME = \"input.html\"\n\nfunc main() {\n    doc := getLocalFile(FILE_NAME)\n    println(doc)\n}\n</code></pre>\n"}], "owner": {"reputation": 691, "user_id": 5266452, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8ea07a3ee8a8f9a3f997377e06edd689?s=128&d=identicon&r=PG&f=1", "display_name": "Maiko Ohkawa", "link": "https://stackoverflow.com/users/5266452/maiko-ohkawa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 1, "accepted_answer_id": 33195104, "answer_count": 1, "score": 0, "last_activity_date": 1445151264, "creation_date": 1445150355, "question_id": 33195072, "link": "https://stackoverflow.com/questions/33195072/how-can-i-use-library-object", "title": "How can I use library object?", "body": "<p>I have an error.\n<code>Document</code> is struct object on goquery library.\nI can't use it in my code below. How can I do?</p>\n\n<pre><code>package main\nimport (\n    \"log\"\n    \"github.com/PuerkitoBio/goquery\"\n    \"os\"\n)\n\nfunc getLocalFile(filename string) (*Document) { // Error\n    f, e := os.Open(FILTER_FILE)\n    if e != nil {\n        log.Fatal(e)\n    }\n    defer f.Close()\n\n    doc, e := goquery.NewDocumentFromReader(f)\n    if e != nil {\n        log.Fatal(e)\n    }\n    return doc\n}\n\nconst FILE_NAME = \"input.html\"\nfunc main() {\n    doc := getLocalFile(FILE_NAME)\n    println(doc)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 5380705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058691e95bcbebd91b8ed2b330ef6d9e?s=128&d=identicon&r=PG&f=1", "display_name": "B. Kelso", "link": "https://stackoverflow.com/users/5380705/b-kelso"}, "edited": false, "score": 0, "creation_date": 1445148651, "post_id": 33194519, "comment_id": 54195170, "body": "Awesome, thanks! Looks daunting but a few of those will produce an explicit error message though like &quot;Unused imports&quot;. I will go through the list to see which ones produce error messages that may seem unrelated to the actual error. The list should end up being smaller."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 6, "last_activity_date": 1541693719, "last_edit_date": 1541693719, "creation_date": 1445144882, "answer_id": 33194519, "question_id": 33194409, "link": "https://stackoverflow.com/questions/33194409/what-are-common-go-tchas-that-someone-learning-golang-should-watch-out-for/33194519#33194519", "title": "What are common &quot;Go-tchas&quot; that someone learning Golang should watch out for?", "body": "<p><sup>This could've been just a comment, but posted as an answer to lay more emphasis on it, because I do believe the linked article is really good, useful even for non-starters and it is still unknown.</sup></p>\n\n<hr>\n\n<p>This is the best and most complete I've seen:</p>\n\n<p><strong><a href=\"http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/\" rel=\"nofollow noreferrer\">50 Shades of Go: Traps, Gotchas, and Common Mistakes for New Golang Devs</a></strong></p>\n\n<p>It has topics ranging from total beginner (like <em>\"Opening Brace Can't Be Placed on a Separate Line\"</em> or <em>\"Unused Imports\"</em>) to advanced beginner (like <em>\"nil\" Interfaces and \"nil\" Interfaces Values</em> or <em>\"Preemptive Scheduling\"</em>).</p>\n\n<p>So a nice summary of the common pitfalls or \"gotchas\" is basically their table of contents, all of which you can read more about there:</p>\n\n<p><strong>Total Beginner:</strong></p>\n\n<ul>\n<li>Opening Brace Can't Be Placed on a Separate Line</li>\n<li>Unused Variables</li>\n<li>Unused Imports</li>\n<li>Short Variable Declarations Can Be Used Only Inside Functions</li>\n<li>Redeclaring Variables Using Short Variable Declarations</li>\n<li>Accidental Variable Shadowing</li>\n<li>Can't Use \"nil\" to Initialize a Variable Without an Explicit Type</li>\n<li>Using \"nil\" Slices and Maps</li>\n<li>Map Capacity</li>\n<li>Strings Can't Be \"nil\"</li>\n<li>Array Function Arguments</li>\n<li>Unexpected Values in Slice and Array \"range\" Clauses</li>\n<li>Slices and Arrays Are One-Dimensional</li>\n<li>Accessing Non-Existing Map Keys</li>\n<li>Strings Are Immutable</li>\n<li>Conversions Between Strings and Byte Slices</li>\n<li>Strings and Index Operator</li>\n<li>Strings Are Not Always UTF8 Text</li>\n<li>String Length</li>\n<li>Missing Comma In Multi-Line Slice/Array/Map Literals</li>\n<li>log.Fatal and log.Panic Do More Than Log</li>\n<li>Built-in Data Structure Operations Are Not Synchronized</li>\n<li>Iteration Values For Strings in \"range\" Clauses</li>\n<li>Iterating Through a Map Using a \"for range\" Clause</li>\n<li>Fallthrough Behavior in \"switch\" Statements</li>\n<li>Increments and Decrements</li>\n<li>Bitwise NOT Operator</li>\n<li>Operator Precedence Differences</li>\n<li>Unexported Structure Fields Are Not Encoded</li>\n<li>App Exits With Active Goroutines</li>\n<li>Sending to an Unbuffered Channel Returns As Soon As the Target Receiver Is Ready</li>\n<li>Sending to an Closed Channel Causes a Panic</li>\n<li>Using \"nil\" Channels</li>\n<li>Methods with Value Receivers Can't Change the Original Value</li>\n</ul>\n\n<p><strong>Intermediate Beginner:</strong></p>\n\n<ul>\n<li>Closing HTTP Response Body</li>\n<li>Closing HTTP Connections</li>\n<li>Unmarshalling JSON Numbers into Interface Values</li>\n<li>Comparing Structs, Arrays, Slices, and Maps</li>\n<li>Recovering From a Panic</li>\n<li>Updating and Referencing Item Values in Slice, Array, and Map \"for range\" Clauses</li>\n<li>\"Hidden\" Data in Slices</li>\n<li>Slice Data Corruption</li>\n<li>\"Stale\" Slices</li>\n<li>Type Declarations and Methods</li>\n<li>Breaking Out of \"for switch\" and \"for select\" Code Blocks</li>\n<li>Iteration Variables and Closures in \"for\" Statements</li>\n<li>Deferred Function Call Argument Evaluation</li>\n<li>Deferred Function Call Execution</li>\n<li>Failed Type Assertions</li>\n<li>Blocked Goroutines and Resource Leaks</li>\n</ul>\n\n<p><strong>Advanced Beginner:</strong></p>\n\n<ul>\n<li>Using Pointer Receiver Methods On Value Instances</li>\n<li>Updating Map Value Fields</li>\n<li>\"nil\" Interfaces and \"nil\" Interfaces Values</li>\n<li>Stack and Heap Variables</li>\n<li>GOMAXPROCS, Concurrency, and Parallelism</li>\n<li>Read and Write Operation Reordering</li>\n<li>Preemptive Scheduling </li>\n</ul>\n"}], "owner": {"reputation": 39, "user_id": 5380705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058691e95bcbebd91b8ed2b330ef6d9e?s=128&d=identicon&r=PG&f=1", "display_name": "B. Kelso", "link": "https://stackoverflow.com/users/5380705/b-kelso"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 1, "closed_date": 1445150168, "answer_count": 1, "score": -8, "last_activity_date": 1541693719, "creation_date": 1445143776, "question_id": 33194409, "link": "https://stackoverflow.com/questions/33194409/what-are-common-go-tchas-that-someone-learning-golang-should-watch-out-for", "closed_reason": "Opinion-based", "title": "What are common &quot;Go-tchas&quot; that someone learning Golang should watch out for?", "body": "<p>For example, the \"Effective Go\" documentation has the following entries:</p>\n\n<blockquote>\n  <p>Like C, Go's formal grammar uses semicolons to terminate statements, but unlike in C, those semicolons do not appear in the source. Instead the lexer uses a simple rule to insert semicolons automatically as it scans, so the input text is mostly free of them. </p>\n</blockquote>\n\n<p>Cut off some parts for brevity.</p>\n\n<blockquote>\n  <p>Write them like this</p>\n</blockquote>\n\n<pre><code>if i &lt; f() {\n    g()\n}\n</code></pre>\n\n<blockquote>\n  <p>not like this</p>\n</blockquote>\n\n<pre><code>if i &lt; f()  // wrong!\n{           // wrong!\n    g()\n}\n</code></pre>\n\n<p>The wrong version when executed produces the following error messages:</p>\n\n<pre><code>/tmp/test.go:6: missing condition in if statement\n/tmp/test.go:6: true evaluated but not used\n</code></pre>\n\n<p>IMO, both messages don't give the coder a clue about misplaced curly braces. Had I failed to read the documentation above, I would have probably written some Go code in the future using the wrong version (I usually use the 1st version in writing code that uses curly braces), then banged my head as to why I'm missing an \"if\" condition when one is clearly present. </p>\n\n<p>Are there other \"gotchas\" in Golang that I should be aware of?</p>\n"}, {"tags": ["go", "arguments", "command-line-interface"], "comments": [{"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 5, "creation_date": 1445147630, "post_id": 33194184, "comment_id": 54195001, "body": "It sounds like you actually want different subcommands, each with their own flag sets, e.g. <code>.&#47;gocli test -name &lt;name&gt; -load &lt;num_cases&gt;</code>, <code>.&#47;gocli startserver -name &lt;name&gt; -port &lt;port&gt;</code>, and <code>.&#47;gocli addhost -name &lt;host_name&gt;</code>."}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 1, "creation_date": 1445929925, "post_id": 33194184, "comment_id": 54518875, "body": "Subcommands solved the purpose !!"}], "owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 716, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1493847194, "creation_date": 1445141035, "last_edit_date": 1493847194, "question_id": 33194184, "link": "https://stackoverflow.com/questions/33194184/how-to-group-arguments-using-flag-in-golang", "title": "How to group arguments using flag in golang", "body": "<p>In my use case I am writing a CLI in golang with multiple group of arguments. For example </p>\n\n<pre><code>./gocli -test &lt;test-name&gt; -load &lt;no-of-cases&gt;\n./gocli -startserver &lt;server-name&gt; -port &lt;port-number&gt;\n./gocli -addhost &lt;host-name&gt;\n</code></pre>\n\n<p>CLI is used for different purposes. I could write a check for each flag variable and perform the actions. But is there any best approach to do this? Also I would like to validate the arguments for each group[For example, if any of the arguments missing in a group while others are given, CLI should throw an error]</p>\n\n<p>Could anyone help me on this?</p>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 3, "creation_date": 1445124267, "post_id": 33192605, "comment_id": 54191108, "body": "Go is a verbose language. It&#39;s only 4 or 8 accesses depending if you&#39;re taking those diagonally neighboring items. Just write it out in a clean straight forward conditional structure. It&#39;s still a 20-30 line function, that&#39;s not really a big deal."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 1, "creation_date": 1445149881, "post_id": 33192605, "comment_id": 54195409, "body": "I think you&#39;re approaching the problem wrong, you should know the bounds, maybe if you share some code someone can help better."}, {"owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 0, "creation_date": 1445216723, "post_id": 33192605, "comment_id": 54214939, "body": "The only efficient way of doing it is by minimizing the amount of required bounds checks. But I guess that you have already figured this out. Now how to do it entirely depends on your use case. Do you scan the whole array in a loop (cellular automaton)? Or are you checking elements at random? Sharing some code would definitely help."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 0, "last_activity_date": 1496956678, "creation_date": 1496956678, "answer_id": 44445716, "question_id": 33192605, "link": "https://stackoverflow.com/questions/33192605/what-is-the-most-efficient-way-of-visiting-neighbor-elements-in-a-2-d-array-in-g/44445716#44445716", "title": "What is the most efficient way of visiting neighbor elements in a 2-D array in Go?", "body": "<p>The general solution would follow the <a href=\"https://stackoverflow.com/a/652123/6309\">pseudo-code presented here</a>.<br>\nSee for a Go example this <a href=\"https://github.com/yucchiy/minesweeper/blob/c02cede38aa6b046eca399b70b9f6d3e081a11bb/field.go#L130-L150\" rel=\"nofollow noreferrer\">yucchiy/minesweeper <code>field.go#GetNeighbors(x, y int)</code></a>.</p>\n\n<p>It depends if you can enrich your data structure with an actual Array object composed of Fields, each one knowing its neighbor. Then \"visiting neighbor elements in a 2-D array\" become asking a Field for the list of Fields which are its neighbor.</p>\n"}], "owner": {"reputation": 2145, "user_id": 5257450, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/eccdf31878110f7e03a2bd4fd359550e?s=128&d=identicon&r=PG&f=1", "display_name": "xxx222", "link": "https://stackoverflow.com/users/5257450/xxx222"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 117, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1596735735, "creation_date": 1445123632, "last_edit_date": 1596735735, "question_id": 33192605, "link": "https://stackoverflow.com/questions/33192605/what-is-the-most-efficient-way-of-visiting-neighbor-elements-in-a-2-d-array-in-g", "title": "What is the most efficient way of visiting neighbor elements in a 2-D array in Go?", "body": "<p>The problem I met is I have to visit all the eight neighbors of an element <code>[i, j]</code> in a 2D array.</p>\n\n<p>However, considering the error of array out of bound, I have to do a lot of if else statement on <code>[i-1, j]</code> or <code>[i+1, j]</code>...It's kind of verbose to me. </p>\n\n<p>So I wonder if there is any efficient way to implement this kind of problem in Go?<br>\nLike error-catching system?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1445106287, "post_id": 33189975, "comment_id": 54185932, "body": "I haven&#39;t tried doing this in go yet, but in Python I would use <code>unittest.mock.patch</code> to monkeypatch a different bufio onto <code>os.stdout</code> for the duration of the function call, then read from that bufio after to see if it&#39;s been written to."}, {"owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "edited": false, "score": 0, "creation_date": 1445106289, "post_id": 33189975, "comment_id": 54185934, "body": "Can you pass a differing file(possible a mock) to your implementation other than stdout that you can make assertions on?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1445106316, "post_id": 33189975, "comment_id": 54185947, "body": "Test it from &quot;the ouside&quot; or make stdout configurable (changing it during testing) or don&#39;t test such stuff at all."}, {"owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "edited": false, "score": 4, "creation_date": 1445107892, "post_id": 33189975, "comment_id": 54186582, "body": "use &quot;Examples&quot; from <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow noreferrer\">golang.org/pkg/testing</a> ?"}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1445223919, "post_id": 33189975, "comment_id": 54216665, "body": "Do you want to test stdout?! What is the use case? Why do you need to prove writing?"}], "answers": [{"tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": false, "score": 1, "last_activity_date": 1445118553, "creation_date": 1445118553, "answer_id": 33191957, "question_id": 33189975, "link": "https://stackoverflow.com/questions/33189975/how-can-i-check-whether-stdout-has-been-written-to/33191957#33191957", "title": "How can I check whether stdout has been written to?", "body": "<p>In my opinion, the correct way to handle this is to make your code take the io.Writer as a parameter in some way instead of using stdout directly. You really should avoid printing to stdout without a way for higher level code to redirect it. Nearly all of the stdlib takes this approach. Very little of the stdlib writes to stdout by default and most of the places that do have a more general form which takes a Writer. For example, <a href=\"https://golang.org/src/fmt/print.go?s=5229:5292#L186\" rel=\"nofollow\">fmt.Printf is simply a convenience function for fmt.Fprintf.</a> </p>\n\n<p>That being said, you can mock stdout. If your code is pushing to stdout, all you need to do is make a global variable for stdout and write to there instead. This is done in the stdlib tests to mock <code>time.Now()</code>. Instead of using time.Now, they use a package global <code>now()</code> and set that depending on if a test is being run.</p>\n\n<p>As a last resort, assuming the previous two things are impossible, you can make a copy of the current os.Stdout and replace it with an os.Pipe. Then you need another goroutine to listen on that pipe and report whatever was returned.</p>\n"}], "owner": {"reputation": 287, "user_id": 4418309, "user_type": "registered", "accept_rate": 22, "profile_image": "https://i.stack.imgur.com/NqKTU.jpg?s=128&g=1", "display_name": "Dipen", "link": "https://stackoverflow.com/users/4418309/dipen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1445118553, "creation_date": 1445105711, "last_edit_date": 1445106150, "question_id": 33189975, "link": "https://stackoverflow.com/questions/33189975/how-can-i-check-whether-stdout-has-been-written-to", "title": "How can I check whether stdout has been written to?", "body": "<p>I am trying to test whether a function, which is capable of printing to stdout using the \"os\" package's stdout variable, actually prints to stdout. I ran this function and I found that it does print to the stdout. Now I am trying to figure out how to prove that this function prints to stdout using golang code. Could I possibly use the \"os\" package's stdout variable to check whether stdout has been written to after calling one of the functions in the array?</p>\n\n<p>I tried to figure out whether stdout had been written to by calling the Stat() method on the os.stdout variable in order to have access to the size and last modified time of stdout, but the size and last modified time did not reflect the fact that a function had written to the stdout.    </p>\n"}, {"tags": ["php", "go", "gearman"], "answers": [{"tags": [], "owner": {"reputation": 14588, "user_id": 3166303, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/877b076ec96e4ab48f7f4567c1ea2741?s=128&d=identicon&r=PG", "display_name": "leeor", "link": "https://stackoverflow.com/users/3166303/leeor"}, "is_accepted": true, "score": 5, "last_activity_date": 1445105030, "creation_date": 1445105030, "answer_id": 33189859, "question_id": 33189840, "link": "https://stackoverflow.com/questions/33189840/php-gearman-workers-equivalent-in-go/33189859#33189859", "title": "PHP gearman workers equivalent in GO?", "body": "<p>You can use the go bindings for gearman. Check it out here:</p>\n\n<p><a href=\"https://github.com/mikespook/gearman-go\" rel=\"noreferrer\">https://github.com/mikespook/gearman-go</a></p>\n\n<p>This is linked from the <a href=\"http://gearman.org/download/\" rel=\"noreferrer\">downloads</a> section of the main gearman site.</p>\n"}], "owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "accepted_answer_id": 33189859, "answer_count": 1, "score": 2, "last_activity_date": 1445105030, "creation_date": 1445104875, "last_edit_date": 1445104955, "question_id": 33189840, "link": "https://stackoverflow.com/questions/33189840/php-gearman-workers-equivalent-in-go", "title": "PHP gearman workers equivalent in GO?", "body": "<p>I'm working on one project which is processing data. Every 5 minutes cron executes go script which is doing all job. One part of job is taking a little more performance and more important, it's taking to much time so I would like to take this part of proccess and put in separate go script. This script would receive proccess_id and do that stuff while main job can continue and important, it would not wait that background go script finishes. It's not required that background job call me back when it's done (that info would be saved in db).</p>\n\n<p>That kind of situation in PHP would be solved by gearman worker which you call, send data and you can contiue with your job while gearman is processing data by himself in background</p>\n\n<p>Is there any similar in go lang which can also be called and not over http?</p>\n\n<p>Thank you</p>\n"}, {"tags": ["go", "google-cloud-storage"], "answers": [{"tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": true, "score": 2, "last_activity_date": 1445189513, "last_edit_date": 1445189513, "creation_date": 1445189103, "answer_id": 33200944, "question_id": 33189486, "link": "https://stackoverflow.com/questions/33189486/using-golanggoogle-cloud-storage-authentication/33200944#33200944", "title": "using golangGoogle Cloud Storage Authentication", "body": "<pre><code>func ExampleJWTConfigFromJSON() {\n    // Your credentials should be obtained from the Google\n    // Developer Console (https://console.developers.google.com).\n    // Navigate to your project, then see the \"Credentials\" page\n    // under \"APIs &amp; Auth\".\n    // To create a service account client, click \"Create new Client ID\",\n    // select \"Service Account\", and click \"Create Client ID\". A JSON\n    // key file will then be downloaded to your computer.\n    data, err := ioutil.ReadFile(\"/path/to/your-project-key.json\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    conf, err := google.JWTConfigFromJSON(data, \"https://www.googleapis.com/auth/bigquery\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    // Initiate an http.Client. The following GET request will be\n    // authorized and authenticated on the behalf of\n    // your service account.\n    client := conf.Client(oauth2.NoContext)\n    client.Get(\"...\")\n}\n</code></pre>\n\n<p>--</p>\n\n<pre><code>func JWTConfigFromJSON(jsonKey []byte, scope ...string) (*jwt.Config, error)\n{\n    var key struct {\n        Email      string `json:\"client_email\"`\n        PrivateKey string `json:\"private_key\"`\n    }\n    if err := json.Unmarshal(jsonKey, &amp;key); err != nil {\n        return nil, err\n    }\n    return &amp;jwt.Config{\n        Email:      key.Email,\n        PrivateKey: []byte(key.PrivateKey),\n        Scopes:     scope,\n        TokenURL:   JWTTokenURL,\n    }, nil\n}\n</code></pre>\n\n<p>For details : </p>\n\n<p><a href=\"https://github.com/golang/oauth2/blob/master/google/example_test.go\" rel=\"nofollow\">https://github.com/golang/oauth2/blob/master/google/example_test.go</a>\n<a href=\"https://github.com/golang/oauth2/blob/master/google/google.go\" rel=\"nofollow\">https://github.com/golang/oauth2/blob/master/google/google.go</a></p>\n\n<p>Hope this will help.</p>\n"}], "owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 963, "favorite_count": 0, "accepted_answer_id": 33200944, "answer_count": 1, "score": 0, "last_activity_date": 1445189513, "creation_date": 1445102889, "question_id": 33189486, "link": "https://stackoverflow.com/questions/33189486/using-golanggoogle-cloud-storage-authentication", "title": "using golangGoogle Cloud Storage Authentication", "body": "<p>I have a go application running on a server. The application needs access to save image to Google Cloud Storage. From the <a href=\"https://cloud.google.com/storage/docs/authentication?hl=FR#service_accounts\" rel=\"nofollow\">Google Cloud Storage authentication</a> documentation is can see how to create a PKCS12 key.</p>\n\n<p>I am using </p>\n\n<pre><code>import(\nstorage \"google.golang.org/api/storage/v1\"\n)\n</code></pre>\n\n<p>How do you use this key with the golang \"storage\" client in an application?</p>\n\n<p>Regards</p>\n"}, {"tags": ["go", "enums"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 6, "creation_date": 1445101392, "post_id": 33189060, "comment_id": 54184261, "body": "First, all Go identifiers are normally in <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#mixed-caps\" rel=\"nofollow noreferrer\">MixedCaps</a>, including constants. You could either do a simple loop such as <code>for d := Monday; d &lt;= Sunday; d++ {}</code> where you explicitly know the start/end values or you could add aliases for those (e.g. something like <code>firstDay = Monday; lastDay = Sunday</code>). Although it&#39;s possible to go further to make something that would use <code>range</code> IMO it&#39;s absolutely not worth it."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1445101534, "post_id": 33189060, "comment_id": 54184319, "body": "By the way, there already is <a href=\"https://golang.org/pkg/time/#Weekday\" rel=\"nofollow noreferrer\"><code>time.Weekday</code></a> that goes from <code>time.Sunday</code> to <code>time.Saturday</code>. (Of course you just happened to put days of the week as an arbitrary example this is unimportant)."}, {"owner": {"reputation": 269, "user_id": 3142303, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/39f23a408e48229147f4336d765dd649?s=128&d=identicon&r=PG&f=1", "display_name": "Jack_125", "link": "https://stackoverflow.com/users/3142303/jack-125"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1445102380, "post_id": 33189060, "comment_id": 54184580, "body": "Dave, Thank you for your response. I corrected the case for the constants. I am looking enums in general not just the weekday. firstDay and lastDay seems interesting to me. Should that go in the const lists or they are outside variables? Thanks!"}, {"owner": {"reputation": 1039, "user_id": 382733, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e3f31a7fa1e87dbeaeabc38476f595cd?s=128&d=identicon&r=PG", "display_name": "Vitor De Mario", "link": "https://stackoverflow.com/users/382733/vitor-de-mario"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1445103452, "post_id": 33189060, "comment_id": 54184947, "body": "@DaveC: your comment would be fine as an answer"}, {"owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 1, "creation_date": 1445216331, "post_id": 33189060, "comment_id": 54214852, "body": "For enums that I need to be iterable, I usually add a dummy end marker. Taking the example of days of the week, my code would have loops like <code>for i := Monday; i &lt; LastDay; i++ {</code>. That way, if hell freezes over and I need to add an 8th day to the week, I just have to shove it before <code>LastDay</code>, the dummy end marker. This is a common pattern in languages that do not have builtin support for iterating over enums, like C, Go, etc."}], "answers": [{"tags": [], "owner": {"reputation": 874, "user_id": 350436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79ada6fc471a2f578e85389ddaf94151?s=128&d=identicon&r=PG", "display_name": "Jeremy Fishman", "link": "https://stackoverflow.com/users/350436/jeremy-fishman"}, "is_accepted": false, "score": 18, "last_activity_date": 1458351305, "creation_date": 1458351305, "answer_id": 36096846, "question_id": 33189060, "link": "https://stackoverflow.com/questions/33189060/is-there-a-way-to-iterate-over-constant-used-as-enum/36096846#36096846", "title": "is there a way to iterate over constant used as enum", "body": "<p>There is no direct way to enumerate the values/instances of named type at runtime, whether variables or constants, unless you specifically define a slice that lists them. This is left up to the definer or the user of the enumeration type.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nvar Weekdays = []time.Weekday{\n    time.Sunday,\n    time.Monday,\n    time.Tuesday,\n    time.Wednesday,\n    time.Thursday,\n    time.Friday,\n    time.Saturday,\n}\n\nfunc main() {\n    for _, day := range Weekdays {\n            fmt.Println(day)\n    }\n}\n</code></pre>\n\n<p>In order be able to generate this list dynamically at runtime, e.g. via reflection, the linker would have to retain all the symbols defined in all packages, like Java does. The golang-nuts group discussed this, regarding names and functions exported from a package, a superset of package constant definitions. <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/M0ORoEU115o\" rel=\"noreferrer\">https://groups.google.com/forum/#!topic/golang-nuts/M0ORoEU115o</a></p>\n\n<p>It would be possible for the language to include syntactic sugar for generating this list at compile time if and only if it were referenced by the program. What should the iteration order be, though? If your week starts on Monday the list I defined is not very helpful; you will have to define your own slice to range through the days from Monday to Sunday.</p>\n"}], "owner": {"reputation": 269, "user_id": 3142303, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/39f23a408e48229147f4336d765dd649?s=128&d=identicon&r=PG&f=1", "display_name": "Jack_125", "link": "https://stackoverflow.com/users/3142303/jack-125"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13098, "favorite_count": 3, "answer_count": 1, "score": 21, "last_activity_date": 1458351305, "creation_date": 1445100259, "last_edit_date": 1445101887, "question_id": 33189060, "link": "https://stackoverflow.com/questions/33189060/is-there-a-way-to-iterate-over-constant-used-as-enum", "title": "is there a way to iterate over constant used as enum", "body": "<p>I am trying to use enum in golang as below. I am struggling to find a easy way to iterate over the list of constant values. What are common practice in golang to iterate over constant values used as enum. Thanks!</p>\n\n<pre><code>type DayOfWeek int\nconst(\n       Monday DayOfWeek = iota\n       Tuesday\n       Wednesday\n       Thursday\n       Friday\n       Saturday\n       Sunday\n      )\n</code></pre>\n\n<p>In Java, we can iterate as below.</p>\n\n<pre><code>public enum DayOfWeek {\n    MONDAY, \n    TUESDAY,\n    WEDNESDAY,\n    THURSDAY,\n    FRIDAY,\n    SATURDAY,\n    SUNDAY\n}\n\nfor (DayOfWeek day: DayOfWeek.values()) {\n   // code logic\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1445088946, "post_id": 33186783, "comment_id": 54180283, "body": "This might be useful to you: <a href=\"https://godoc.org/golang.org/x/mobile/exp/gl/glutil#Image\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/mobile/exp/gl/glutil#Image</a>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1445096559, "post_id": 33186783, "comment_id": 54182658, "body": "The <a href=\"https://tip.golang.org/pkg/image/#Image\" rel=\"nofollow noreferrer\">image package documentation</a> makes this obvious."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1445260487, "post_id": 33198436, "comment_id": 54234705, "body": "I would check if the image is already an RGBA first, and just use Pix directly in that case. Also, using <code>At</code> isn&#39;t complex, it&#39;s just inefficient, which is why we have access to Pix."}, {"owner": {"reputation": 7099, "user_id": 1475548, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/09sbK.jpg?s=128&g=1", "display_name": "Octopus", "link": "https://stackoverflow.com/users/1475548/octopus"}, "edited": false, "score": 1, "creation_date": 1498615915, "post_id": 33198436, "comment_id": 76565881, "body": "Actually, using the At function isn&#39;t so hard... <code>r,g,b,a := image.At(x,y).RGBA() </code> and then <code>red := uint8(r&gt;&gt;8)</code> etc."}], "tags": [], "owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "is_accepted": false, "score": 5, "last_activity_date": 1445174773, "creation_date": 1445174773, "answer_id": 33198436, "question_id": 33186783, "link": "https://stackoverflow.com/questions/33186783/get-a-pixel-array-from-from-golang-image-image/33198436#33198436", "title": "Get a pixel array from from golang image.Image", "body": "<p>This is what I ended up doing. I am using <a href=\"https://golang.org/pkg/image/draw/\" rel=\"noreferrer\">image/draw</a> package's Draw function to refill an <code>image.RGBA</code> instance</p>\n\n<pre><code>rect := img.Bounds()\nrgba := image.NewRGBA(rect)\ndraw.Draw(rgba, rect, img, rect.Min, draw.Src)\n</code></pre>\n\n<p>Now <code>rgba.Pix</code> contains the array I want and can be used in the <code>TexImage2D</code> method.</p>\n\n<pre><code>glctx.TexImage2D(gl.TEXTURE_2D, 0, rect.Max.X-rect.Min.X, rect.Max.Y-rect.Min.Y, gl.RGBA, gl.UNSIGNED_BYTE, rgba.Pix)\n</code></pre>\n\n<p><strong>Alternately</strong></p>\n\n<p><a href=\"https://golang.org/pkg/image/#Image\" rel=\"noreferrer\">Image</a> instances contains an <code>At</code> method that returns a <a href=\"https://golang.org/pkg/image/color/#Color\" rel=\"noreferrer\">Color</a>. So it is possible to loop through each pixel and and collect colors. But converting returned rgba values from the <code>Color</code> might be complex. Quoting documentation:</p>\n\n<pre><code>    // RGBA returns the alpha-premultiplied red, green, blue and alpha values\n    // for the color. Each value ranges within [0, 0xffff], but is represented\n    // by a uint32 so that multiplying by a blend factor up to 0xffff will not\n    // overflow.\n    //\n    // An alpha-premultiplied color component c has been scaled by alpha (a),\n    // so has valid values 0 &lt;= c &lt;= a.  \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7099, "user_id": 1475548, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/09sbK.jpg?s=128&g=1", "display_name": "Octopus", "link": "https://stackoverflow.com/users/1475548/octopus"}, "edited": false, "score": 0, "creation_date": 1498616111, "post_id": 41185404, "comment_id": 76565924, "body": "Why 257? Why not 256?"}, {"owner": {"reputation": 2459, "user_id": 439745, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/16a8ca59efba12bdd0fb9b484ea82833?s=128&d=identicon&r=PG", "display_name": "Kesarion", "link": "https://stackoverflow.com/users/439745/kesarion"}, "reply_to_user": {"reputation": 7099, "user_id": 1475548, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/09sbK.jpg?s=128&g=1", "display_name": "Octopus", "link": "https://stackoverflow.com/users/1475548/octopus"}, "edited": false, "score": 1, "creation_date": 1498635056, "post_id": 41185404, "comment_id": 76572762, "body": "The values are multiplied by 101 in base 16, which means 257 in base 10. I&#39;m don&#39;t remember what&#39;s special about the number or why this is done, but the result should be an integer &lt; 256, otherwise you have a different representation for pixels (depends on the img type)."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1532707608, "post_id": 41185404, "comment_id": 90090286, "body": "@Kesarion If you look at <a href=\"https://github.com/golang/go/blob/dev.boringcrypto.go1.10/src/image/color/color.go#L176\" rel=\"nofollow noreferrer\">rgbaModel</a> (which implements <code>color.RGBAModel</code>) it just does <code>&gt;&gt; 8</code>. In general if you have a <code>color.Color</code> and you want a specific format you use a color model to do the conversion; in this case <code>color.RGBAModel</code>. If you want most or all of an image in the format and memory isn&#39;t a concern it&#39;s best to use <code>image&#47;draw</code> to bulk convert (taking advantage of it&#39;s optimizations) then you can use <code>image.RGBA</code>&#39;s <code>RGBAAt()</code> or <code>.Pix</code> slice."}], "tags": [], "owner": {"reputation": 2459, "user_id": 439745, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/16a8ca59efba12bdd0fb9b484ea82833?s=128&d=identicon&r=PG", "display_name": "Kesarion", "link": "https://stackoverflow.com/users/439745/kesarion"}, "is_accepted": false, "score": 12, "last_activity_date": 1481894569, "creation_date": 1481894569, "answer_id": 41185404, "question_id": 33186783, "link": "https://stackoverflow.com/questions/33186783/get-a-pixel-array-from-from-golang-image-image/41185404#41185404", "title": "Get a pixel array from from golang image.Image", "body": "<p>You can simply use <code>img.At(x, y).RGBA()</code> to get the RBGA values for a pixel, you just need to divide them by 257 to get the 8 bit representation. I'd recommend building your own bi-dimensional array of pixels. Here's a possible implementation, modify it as needed:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"image\"\n    \"image/png\"\n    \"os\"\n    \"io\"\n    \"net/http\"\n)\n\nfunc main() {\n    // You can register another format here\n    image.RegisterFormat(\"png\", \"png\", png.Decode, png.DecodeConfig)\n\n    file, err := os.Open(\"./image.png\")\n\n    if err != nil {\n        fmt.Println(\"Error: File could not be opened\")\n        os.Exit(1)\n    }\n\n    defer file.Close()\n\n    pixels, err := getPixels(file)\n\n    if err != nil {\n        fmt.Println(\"Error: Image could not be decoded\")\n        os.Exit(1)\n    }\n\n    fmt.Println(pixels)\n}\n\n// Get the bi-dimensional pixel array\nfunc getPixels(file io.Reader) ([][]Pixel, error) {\n    img, _, err := image.Decode(file)\n\n    if err != nil {\n        return nil, err\n    }\n\n    bounds := img.Bounds()\n    width, height := bounds.Max.X, bounds.Max.Y\n\n    var pixels [][]Pixel\n    for y := 0; y &lt; height; y++ {\n        var row []Pixel\n        for x := 0; x &lt; width; x++ {\n            row = append(row, rgbaToPixel(img.At(x, y).RGBA()))\n        }\n        pixels = append(pixels, row)\n    }\n\n    return pixels, nil\n}\n\n// img.At(x, y).RGBA() returns four uint32 values; we want a Pixel\nfunc rgbaToPixel(r uint32, g uint32, b uint32, a uint32) Pixel {\n    return Pixel{int(r / 257), int(g / 257), int(b / 257), int(a / 257)}\n}\n\n// Pixel struct example\ntype Pixel struct {\n    R int\n    G int\n    B int\n    A int\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 12201191, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a6c3073f4b7e2528623a7082e33a2ba?s=128&d=identicon&r=PG&f=1", "display_name": "leondgarse", "link": "https://stackoverflow.com/users/12201191/leondgarse"}, "is_accepted": false, "score": 2, "last_activity_date": 1579081111, "last_edit_date": 1579081111, "creation_date": 1579077951, "answer_id": 59747737, "question_id": 33186783, "link": "https://stackoverflow.com/questions/33186783/get-a-pixel-array-from-from-golang-image-image/59747737#59747737", "title": "Get a pixel array from from golang image.Image", "body": "<p>In my test, <code>Pix</code> method shows <strong>~4 times faster</strong> than <code>At</code>, but still takes too long...</p>\n\n<p>Here is my test script, not sure about the <code>height</code> / <code>width</code> order, but this works for me:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// test_image_time.go\npackage main\n\nimport (\n    \"os\"\n    \"fmt\"\n    \"image\"\n    _ \"image/jpeg\"\n    \"golang.org/x/image/draw\"\n    \"time\"\n)\n\nfunc main() {\n    img_path:= \"/path/to/image/.jpg\"\n    aa := time.Now()\n    reader, _ := os.Open(img_path)\n    m, _, _ := image.Decode(reader)\n    bounds := m.Bounds()\n    fmt.Println(\"Bounds: \", bounds.Min.Y, bounds.Max.Y, bounds.Min.X, bounds.Max.X)\n    bb := time.Now()\n    fmt.Println(\"Read file time: \", float64(bb.Nanosecond() - aa.Nanosecond()) / 1e9)\n\n    aa = time.Now()\n    _ = image_2_array_at(m)\n    bb = time.Now()\n    fmt.Println(\"At Time: \", float64(bb.Nanosecond() - aa.Nanosecond()) / 1e9)\n\n    aa = time.Now()\n    _ = image_2_array_pix(m)\n    bb = time.Now()\n    fmt.Println(\"Pix Time: \", float64(bb.Nanosecond() - aa.Nanosecond()) / 1e9)\n}\n\nfunc image_2_array_at(src image.Image) [][][3]float32 {\n    bounds := src.Bounds()\n    width, height := bounds.Max.X, bounds.Max.Y\n    iaa := make([][][3]float32, height)\n\n    for y := 0; y &lt; height; y++ {\n        row := make([][3]float32, width)\n        for x := 0; x &lt; width; x++ {\n            r, g, b, _ := src.At(x, y).RGBA()\n            // A color's RGBA method returns values in the range [0, 65535].\n            // Shifting by 8 reduces this to the range [0, 255].\n            row[x] = [3]float32{float32(r&gt;&gt;8), float32(g&gt;&gt;8), float32(b&gt;&gt;8)}\n        }\n        iaa[y] = row\n    }\n\n    return iaa\n}\n\nfunc image_2_array_pix(src image.Image) [][][3]float32 {\n    bounds := src.Bounds()\n    width, height := bounds.Max.X, bounds.Max.Y\n    iaa := make([][][3]float32, height)\n    src_rgba := image.NewRGBA(src.Bounds())\n    draw.Copy(src_rgba, image.Point{}, src, src.Bounds(), draw.Src, nil)\n\n    for y := 0; y &lt; height; y++ {\n        row := make([][3]float32, width)\n        for x := 0; x &lt; width; x++ {\n            idx_s := (y * width + x) * 4\n            pix := src_rgba.Pix[idx_s : idx_s + 4]\n            row[x] = [3]float32{float32(pix[0]), float32(pix[1]), float32(pix[2])}\n        }\n        iaa[y] = row\n    }\n\n    return iaa\n}\n</code></pre>\n\n<p><strong>Run</strong></p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ go run test_image_time.go\nBounds:  0 976 0 1920\nRead file time:  0.025212067\nAt Time:  0.069091218\nPix Time:  0.0165787\n</code></pre>\n"}], "owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14497, "favorite_count": 1, "answer_count": 3, "score": 12, "last_activity_date": 1579081111, "creation_date": 1445085953, "question_id": 33186783, "link": "https://stackoverflow.com/questions/33186783/get-a-pixel-array-from-from-golang-image-image", "title": "Get a pixel array from from golang image.Image", "body": "<p>I need to get a pixel array in the form of <code>[]byte</code> to be passed to the <code>texImage2D</code> method of a <a href=\"https://godoc.org/golang.org/x/mobile/gl#Context\">Contex</a> from the <a href=\"https://godoc.org/golang.org/x/mobile/gl\">/mobile/gl</a> package.</p>\n\n<p>It needs a pixel array where rgba values of each pixel is appended in the order of pixels left to right, top to bottom. Currently I have an image loaded from a file.</p>\n\n<pre><code>a, err := asset.Open(\"key.jpeg\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer a.Close()\n\nimg, _, err := image.Decode(a)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>I am looking for something like <code>img.Pixels()</code></p>\n"}, {"tags": ["go", "redis", "publish-subscribe", "redigo"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1445089196, "post_id": 33186550, "comment_id": 54180357, "body": "How about creating a <a href=\"https://godoc.org/github.com/garyburd/redigo/redis#Pool\" rel=\"nofollow noreferrer\"><code>redis.Pool</code></a> whose <code>Dial</code> function also subscribes to the appropriate channels."}, {"owner": {"reputation": 39, "user_id": 706630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7d84cbce0d75343c42986b5367f0697?s=128&d=identicon&r=PG&f=1", "display_name": "kic", "link": "https://stackoverflow.com/users/706630/kic"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1445189134, "post_id": 33186550, "comment_id": 54206578, "body": "@tim-cooper very clean way. +1"}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 706630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7d84cbce0d75343c42986b5367f0697?s=128&d=identicon&r=PG&f=1", "display_name": "kic", "link": "https://stackoverflow.com/users/706630/kic"}, "edited": false, "score": 0, "creation_date": 1445188354, "post_id": 33193989, "comment_id": 54206291, "body": "Tim Cooper&#39;s solution in comment is more cleaner. Dial takes care of subscription during reconnects. Thanks +1"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 39, "user_id": 706630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7d84cbce0d75343c42986b5367f0697?s=128&d=identicon&r=PG&f=1", "display_name": "kic", "link": "https://stackoverflow.com/users/706630/kic"}, "edited": false, "score": 0, "creation_date": 1445192076, "post_id": 33193989, "comment_id": 54207631, "body": "@aloksrivastava78 Subscribe from dial prevents use of pool for other purposes in the application, moves subscription code further away from receiving code and is not allowed per redigo documentation."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1445138807, "creation_date": 1445138807, "answer_id": 33193989, "question_id": 33186550, "link": "https://stackoverflow.com/questions/33186550/how-to-write-better-receive-in-golang-for-redisredigo-pubsub/33193989#33193989", "title": "How to write better Receive() in Golang for Redis(redigo) Pubsub?", "body": "<p>Use two nested loops. The outer loop gets a connection, sets up the subscriptions and then invokes the inner loop to receive messages. The inner loop executes until there's a permanent error on the connection.</p>\n\n<pre><code>for {\n    // Get a connection from a pool\n    c := pool.Get()\n    psc := redis.PubSubConn{c}\n\n    // Set up subscriptions\n    psc.Subscribe(\"example\"))\n\n    // While not a permanent error on the connection.\n    for c.Err() == nil {\n        switch v := psc.Receive().(type) {\n        case redis.Message:\n            fmt.Printf(\"%s: message: %s\\n\", v.Channel, v.Data)\n        case redis.Subscription:\n            fmt.Printf(\"%s: %s %d\\n\", v.Channel, v.Kind, v.Count)\n        case error:\n            fmt.Printf(err)\n        }\n    }\n    c.Close()\n}\n</code></pre>\n\n<p>This example uses a Redigo <a href=\"http://godoc.org/github.com/garyburd/redigo/redis#Pool\" rel=\"noreferrer\">pool</a> to get connections.  An alternative is to dial a connection directly:</p>\n\n<pre><code> c, err := redis.Dial(\"tcp\", serverAddress)\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 706630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7d84cbce0d75343c42986b5367f0697?s=128&d=identicon&r=PG&f=1", "display_name": "kic", "link": "https://stackoverflow.com/users/706630/kic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4199, "favorite_count": 1, "accepted_answer_id": 33193989, "answer_count": 1, "score": 0, "last_activity_date": 1445138807, "creation_date": 1445084439, "question_id": 33186550, "link": "https://stackoverflow.com/questions/33186550/how-to-write-better-receive-in-golang-for-redisredigo-pubsub", "title": "How to write better Receive() in Golang for Redis(redigo) Pubsub?", "body": "<pre><code>psc := redis.PubSubConn{c}\npsc.Subscribe(\"example\")\n\nfunc Receive() {\n    for {\n        switch v := psc.Receive().(type) {\n        case redis.Message:\n            fmt.Printf(\"%s: message: %s\\n\", v.Channel, v.Data)\n        case redis.Subscription:\n            fmt.Printf(\"%s: %s %d\\n\", v.Channel, v.Kind, v.Count)\n        case error:\n            return v\n        }\n    }\n}\n</code></pre>\n\n<p>In the above code(taken from <a href=\"https://godoc.org/github.com/garyburd/redigo/redis\" rel=\"nofollow\">Redigo doc</a>), if connection is lost, all subscriptions are also lost. What will be better way to recover from lost connection and resubscribe.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "edited": false, "score": 0, "creation_date": 1445075108, "post_id": 33184619, "comment_id": 54176341, "body": "Weird, goquery says the img tag with src=&quot;y18.gif&quot; has 59 children (when it should have none, img tags are self-closing)"}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "edited": false, "score": 0, "creation_date": 1445078909, "post_id": 33184619, "comment_id": 54177325, "body": "I can reproduce with this minimal code : <a href=\"https://play.golang.org/p/u60bW3M8rm\" rel=\"nofollow noreferrer\">play.golang.org/p/u60bW3M8rm</a> (it won&#39;t run on the playground, I just needed a place to share the code snippet)"}], "answers": [{"comments": [{"owner": {"reputation": 691, "user_id": 5266452, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8ea07a3ee8a8f9a3f997377e06edd689?s=128&d=identicon&r=PG&f=1", "display_name": "Maiko Ohkawa", "link": "https://stackoverflow.com/users/5266452/maiko-ohkawa"}, "edited": false, "score": 0, "creation_date": 1445082548, "post_id": 33185858, "comment_id": 54178418, "body": "Wow! Excelent! You are genius. I see. <code>Children()</code> not return child node. It returns the nodes including children, that is the same hierarchy as that&#39;s receiver, isn&#39;t it? Therefore I need <code>Each()</code>, aha! Thank you for your kindness. Thank you very very much for helping me."}], "tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": true, "score": 1, "last_activity_date": 1445079916, "creation_date": 1445079916, "answer_id": 33185858, "question_id": 33184619, "link": "https://stackoverflow.com/questions/33184619/how-can-i-get-all-elements-name-on-html-my-bad-code-run-loop/33185858#33185858", "title": "How can I get all elements name on html (My bad code run loop)", "body": "<p>It seems to work with this:</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n\n    \"github.com/PuerkitoBio/goquery\"\n    \"golang.org/x/net/html\"\n)\n\nvar areWeLooping = make(map[*goquery.Selection]struct{})\n\nfunc getTagName(s *goquery.Selection) {\n    if _, weAreLooping := areWeLooping[s]; weAreLooping {\n        println(\"loop detected\")\n        os.Exit(1)\n    }\n\n    areWeLooping[s] = struct{}{}\n\n    for _, n := range s.Nodes {\n        if n.Type != html.ElementNode {\n            continue\n        }\n        println(n.Data)\n    }\n\n    s.Children().Each(func(_ int, s *goquery.Selection) {\n        getTagName(s)\n    })\n}\n\nfunc main() {\n    doc, _ := goquery.NewDocument(\"https://news.ycombinator.com/\")\n    doc.Find(\"html body\").Children().Each(func(_ int, s *goquery.Selection) {\n        getTagName(s)\n    })\n}\n</code></pre>\n\n<p>Having <code>getTagName(s.Children())</code> inside the loop was causing trouble.</p>\n"}], "owner": {"reputation": 691, "user_id": 5266452, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8ea07a3ee8a8f9a3f997377e06edd689?s=128&d=identicon&r=PG&f=1", "display_name": "Maiko Ohkawa", "link": "https://stackoverflow.com/users/5266452/maiko-ohkawa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 0, "accepted_answer_id": 33185858, "answer_count": 1, "score": 0, "last_activity_date": 1445079916, "creation_date": 1445071452, "last_edit_date": 1445072469, "question_id": 33184619, "link": "https://stackoverflow.com/questions/33184619/how-can-i-get-all-elements-name-on-html-my-bad-code-run-loop", "title": "How can I get all elements name on html (My bad code run loop)", "body": "<p>I want to get a document tree.\nThen, first, I displayed all elements name.\nBut my code run loop.\nHow can I do?</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/PuerkitoBio/goquery\"\n    \"golang.org/x/net/html\"\n)\n\nfunc getTagName(s *goquery.Selection) {\n    for _, n := range s.Nodes {\n        if n.Type != html.ElementNode {\n            continue\n        }\n        println(n.Data)\n        getTagName(s.Children())\n    }\n}\n\nfunc main() {\n    doc, _ := goquery.NewDocument(\"https://news.ycombinator.com/\")\n    doc.Find(\"html body\").Each(func(_ int, s *goquery.Selection) {\n        getTagName(s)\n    })\n}\n</code></pre>\n"}, {"tags": ["go", "garbage-collection"], "comments": [{"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "edited": false, "score": 1, "creation_date": 1445073247, "post_id": 33184428, "comment_id": 54175888, "body": "Go does have a runtime"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1445073308, "creation_date": 1445073308, "answer_id": 33184861, "question_id": 33184428, "link": "https://stackoverflow.com/questions/33184428/garbage-collection-in-golang-how-does-it-happen/33184861#33184861", "title": "Garbage collection in golang - how does it happen?", "body": "<p>A Go program is a collection of packages which are compiled and then linked together. One of these packages is <code>runtime</code> which includes the Go garbage collector.</p>\n\n<p>See <a href=\"https://golang.org/src/runtime/\" rel=\"nofollow\">Directory src/runtime/</a></p>\n"}], "owner": {"reputation": 3391, "user_id": 4470201, "user_type": "registered", "accept_rate": 66, "profile_image": "https://graph.facebook.com/558270100/picture?type=large", "display_name": "Shikloshi", "link": "https://stackoverflow.com/users/4470201/shikloshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 618, "favorite_count": 2, "answer_count": 1, "score": -1, "last_activity_date": 1445073308, "creation_date": 1445069933, "question_id": 33184428, "link": "https://stackoverflow.com/questions/33184428/garbage-collection-in-golang-how-does-it-happen", "title": "Garbage collection in golang - how does it happen?", "body": "<p>It is known that go is garbage collected language and with a very efficient garbage collector.</p>\n\n<p>How can that happen if go is compiled to machine code and has no run time environment that manages the memory deallocation?</p>\n"}, {"tags": ["encryption", "go", "command-line-interface"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1445069192, "post_id": 33183692, "comment_id": 54174940, "body": "Whatever you do, storing a password in any form and decoding it just by your app without a secret info from the user (e.g. another password) is just as insecure."}, {"owner": {"reputation": 3391, "user_id": 4470201, "user_type": "registered", "accept_rate": 66, "profile_image": "https://graph.facebook.com/558270100/picture?type=large", "display_name": "Shikloshi", "link": "https://stackoverflow.com/users/4470201/shikloshi"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1445069618, "post_id": 33183692, "comment_id": 54175053, "body": "So how does any CLI (docker e.g.) saves my  password to the docker config file if I didn&#39;t put any secret?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1445070127, "post_id": 33183692, "comment_id": 54175181, "body": "I don&#39;t know how Docker does it, most likey using AES with a secret key saved in Docker&#39;s code or in some other file. But if someone can access Docker&#39;s code or this key file, the encrypted password can be decrypted just as easily. This only has the advantage of not seeing the cleartext password from the comfig file. Go&#39;s standard library supports the AES algorithm, you can do the same."}, {"owner": {"reputation": 3391, "user_id": 4470201, "user_type": "registered", "accept_rate": 66, "profile_image": "https://graph.facebook.com/558270100/picture?type=large", "display_name": "Shikloshi", "link": "https://stackoverflow.com/users/4470201/shikloshi"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1445070286, "post_id": 33183692, "comment_id": 54175215, "body": "Yes, the main goal is just so that there is no plain test password written in a file. But I guess base64 will be just like encrypting the password without any secret. Thanks!"}, {"owner": {"reputation": 444, "user_id": 1202623, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cbae78493ed2188bfb70b0c078ceb2c3?s=128&d=identicon&r=PG", "display_name": "Nikkolasg", "link": "https://stackoverflow.com/users/1202623/nikkolasg"}, "edited": false, "score": 0, "creation_date": 1445082804, "post_id": 33183692, "comment_id": 54178499, "body": "No. Go with AES approach. Like ask the user a  regular password (kinda easy to remember) and generate the password for the docker config file with a tool like pwgen. Then encrypt this password with the user password. Dont forget to put the right permission on the file also !!"}], "answers": [{"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1610530204, "post_id": 65698223, "comment_id": 116160231, "body": "That looks like a great idea. Upvoted."}], "tags": [], "owner": {"reputation": 845, "user_id": 2231168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oaRc5.jpg?s=128&g=1", "display_name": "Nergal", "link": "https://stackoverflow.com/users/2231168/nergal"}, "is_accepted": false, "score": 1, "last_activity_date": 1610733974, "last_edit_date": 1610733974, "creation_date": 1610526850, "answer_id": 65698223, "question_id": 33183692, "link": "https://stackoverflow.com/questions/33183692/creating-a-cli-what-should-i-do-with-the-password-in-the-config-file-and-how/65698223#65698223", "title": "Creating a CLI: What should I do with the password in the config file (and how)?", "body": "<p><strong>Disclaimer</strong>: The core lib does not provide this functionality out of the box. There is a third party lib for Go (from Docker) which can help.</p>\n<p>Modern Operating Systems provide tools and APIs to store secrets in a secure way.</p>\n<ul>\n<li>Apple: Keychain</li>\n<li>Linux: Secret Service</li>\n<li>Windows: Credentials Manager API</li>\n</ul>\n<p>Git and Docker uses these tools to store your credentials.</p>\n<p>David Calavera who contributed <a href=\"https://github.com/docker/docker-credential-helpers\" rel=\"nofollow noreferrer\">Docker credential helpers</a> to Docker Engine v1.11 wrote an article titled <a href=\"https://medium.com/@calavera/stop-saving-credential-tokens-in-text-files-65e840a237bb\" rel=\"nofollow noreferrer\">Stop saving credential tokens in text files</a> in 2016. The article describes the problem, a simple implementation for Linux and shows how to use the library.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n  &quot;github.com/docker/docker-credential-helpers/client&quot;\n  &quot;github.com/docker/docker-credential-helpers/credentials&quot;\n)\n\nvar nativeStore = client.NewShellProgramFunc(&quot;docker-credential-secretservice&quot;)\n\nfunc main() {\n  c := &amp;credentials.Credentials{\n    ServerURL: &quot;https://api.github.com&quot;,\n    Username: &quot;token&quot;,\n    Secret: &quot;my-super-secret-token&quot;,\n  }\n  \n  client.Store(nativeStore, c)\n  storedCreds, err := client.Get(nativeStore, &quot;https://api.github.com&quot;)\n}\n</code></pre>\n<p><strong>The drawback of Docker credential helpers is that it expects you to install its binaries and needs CGo.</strong> I added the Docker solution specifically because it was mentioned in the comments but <strong>there are similar libraries</strong>:</p>\n<ul>\n<li><a href=\"https://github.com/99designs/keyring\" rel=\"nofollow noreferrer\">99designs/keyring</a> - Originally was part of AWS vault lib.</li>\n<li><a href=\"https://github.com/zalando/go-keyring\" rel=\"nofollow noreferrer\">zalando/go-keyring</a> - A pure Go implementation which goal was to avoid C bindings.</li>\n</ul>\n"}], "owner": {"reputation": 3391, "user_id": 4470201, "user_type": "registered", "accept_rate": 66, "profile_image": "https://graph.facebook.com/558270100/picture?type=large", "display_name": "Shikloshi", "link": "https://stackoverflow.com/users/4470201/shikloshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 2, "answer_count": 1, "score": 2, "last_activity_date": 1610733974, "creation_date": 1445064232, "question_id": 33183692, "link": "https://stackoverflow.com/questions/33183692/creating-a-cli-what-should-i-do-with-the-password-in-the-config-file-and-how", "title": "Creating a CLI: What should I do with the password in the config file (and how)?", "body": "<p>I'm writing a CLI with Go and I want to save the password to a config file that is saved in the user home directory. </p>\n\n<p>Should I encrypt the password on save and decrypt it when sending it to the server the CLI interact with?</p>\n\n<p>And if so, is there a good built in library in go library to do so? I want to keep it as simple as possible and without using any additional outside packages. All the answers I saw was quite complex. </p>\n\n<p>Should be something like this:</p>\n\n<pre><code>func Encrypt(password string) string\nfunc Decrypt(password string) string\n</code></pre>\n\n<p>Any ideas?</p>\n"}, {"tags": ["dom", "go", "goquery"], "answers": [{"comments": [{"owner": {"reputation": 691, "user_id": 5266452, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8ea07a3ee8a8f9a3f997377e06edd689?s=128&d=identicon&r=PG&f=1", "display_name": "Maiko Ohkawa", "link": "https://stackoverflow.com/users/5266452/maiko-ohkawa"}, "edited": false, "score": 0, "creation_date": 1445064507, "post_id": 33183585, "comment_id": 54173921, "body": "Oh, I see. I understood that <code>Data</code> string is tag name. Thank you for your advice. Your code is clear and safety. It&#39;s helpfull for me. Thank you."}], "tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": true, "score": 5, "last_activity_date": 1445063486, "creation_date": 1445063486, "answer_id": 33183585, "question_id": 33183508, "link": "https://stackoverflow.com/questions/33183508/how-can-i-get-the-type-name-of-dom-using-goquery/33183585#33183585", "title": "How can I get the type name of DOM using goquery?", "body": "<p><a href=\"https://godoc.org/github.com/PuerkitoBio/goquery#Selection.First\" rel=\"noreferrer\"><code>*Selection.First</code></a> gives you another <a href=\"https://godoc.org/github.com/PuerkitoBio/goquery#Selection\" rel=\"noreferrer\"><code>*Selection</code></a> which contains a slice of <a href=\"https://godoc.org/golang.org/x/net/html#Node\" rel=\"noreferrer\"><code>*html.Node</code></a> which has a <code>Data</code> field which contains:</p>\n\n<blockquote>\n  <p>tag name for element nodes, content for text</p>\n</blockquote>\n\n<p>So something like that:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/PuerkitoBio/goquery\"\n    \"golang.org/x/net/html\"\n)\n\nfunc main() {\n    doc, _ := goquery.NewDocument(\"https://news.ycombinator.com/\")\n    doc.Find(\"html body\").Each(func(_ int, s *goquery.Selection) {\n        // for debug.\n        println(s.Size()) // return 1\n\n        if len(s.Nodes) &gt; 0 &amp;&amp; s.Nodes[0].Type == html.ElementNode {\n            println(s.Nodes[0].Data)\n        }\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 691, "user_id": 5266452, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8ea07a3ee8a8f9a3f997377e06edd689?s=128&d=identicon&r=PG&f=1", "display_name": "Maiko Ohkawa", "link": "https://stackoverflow.com/users/5266452/maiko-ohkawa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1746, "favorite_count": 0, "accepted_answer_id": 33183585, "answer_count": 1, "score": 2, "last_activity_date": 1445405558, "creation_date": 1445062755, "last_edit_date": 1445405558, "question_id": 33183508, "link": "https://stackoverflow.com/questions/33183508/how-can-i-get-the-type-name-of-dom-using-goquery", "title": "How can I get the type name of DOM using goquery?", "body": "<p>I want to get the type name of DOM like 'a', img', 'tr', 'td', 'center' using goquery.\nHow can I get?</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/PuerkitoBio/goquery\"\n)\n\nfunc main() {\n    doc, _ := goquery.NewDocument(\"https://news.ycombinator.com/\")\n    doc.Find(\"html body\").Each(func(_ int, s *goquery.Selection) {\n        // for debug.\n        println(s.Size()) // return 1\n\n        // I expect '&lt;center&gt;' on this URL, but I can't get it's name.\n        // println(s.First().xxx) // ?\n    })\n}\n</code></pre>\n"}, {"tags": ["json", "rest", "serialization", "go", "deserialization"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1445063465, "post_id": 33183071, "comment_id": 54173714, "body": "In Go, <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">arrays and <b>slices</b> are very different things</a>. You almost certainly mean the later."}], "answers": [{"comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1445061264, "post_id": 33183170, "comment_id": 54173267, "body": "Up&#39;d because this is in fact how it works.  See @mike&#39;s comment in my answer to understand the limitations of my solution."}, {"owner": {"reputation": 4395, "user_id": 442219, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TKAbI.jpg?s=128&g=1", "display_name": "tothemario", "link": "https://stackoverflow.com/users/442219/tothemario"}, "edited": false, "score": 0, "creation_date": 1475547555, "post_id": 33183170, "comment_id": 66975903, "body": "What about using a pointer to the slice? Like you would do a pointer to string so it can be nil? Is that possible?"}, {"owner": {"reputation": 702, "user_id": 3777314, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/600103728/picture?type=large", "display_name": "ocket8888", "link": "https://stackoverflow.com/users/3777314/ocket8888"}, "edited": false, "score": 0, "creation_date": 1588975080, "post_id": 33183170, "comment_id": 109117875, "body": "You can still tell the difference, because you can literally compare against <code>nil</code>: <a href=\"https://play.golang.org/p/fxV0atFXJSX\" rel=\"nofollow noreferrer\">play.golang.org/p/fxV0atFXJSX</a>"}], "tags": [], "owner": {"reputation": 4018, "user_id": 2252889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H31dX.jpg?s=128&g=1", "display_name": "Mike Precup", "link": "https://stackoverflow.com/users/2252889/mike-precup"}, "is_accepted": false, "score": 12, "last_activity_date": 1445060873, "last_edit_date": 1445060873, "creation_date": 1445060120, "answer_id": 33183170, "question_id": 33183071, "link": "https://stackoverflow.com/questions/33183071/golang-serialize-deserialize-an-empty-array-not-as-null/33183170#33183170", "title": "Golang serialize/deserialize an Empty Array not as null", "body": "<p>No, it's not possible. To understand why, let's look at the Go spec. For it to output two different results for empty vs. nil, any serialization method would need to be able to tell the difference between the two. However, according to the Go spec, </p>\n\n<blockquote>\n  <p>Two array types are identical if they have identical element types and\n  the same array length.</p>\n</blockquote>\n\n<p>Since neither contains any elements and have the same element type, the only difference could be in length, but it also states that </p>\n\n<blockquote>\n  <p>The length of a nil slice, map or channel is 0</p>\n</blockquote>\n\n<p>So through comparison, it would be unable to tell. Of course, there are methods other than comparison, so to really put the nail in the coffin, here's the portion that shows they have the same underlying representation. The spec also guarantees that</p>\n\n<blockquote>\n  <p>A struct or array type has size zero if it contains no fields (or\n  elements, respectively) that have a size greater than zero.</p>\n</blockquote>\n\n<p>so the actual allocated structure of a zero length array has to be of size zero. If it's of size zero, it can't store any information about whether it's empty or <code>nil</code>, so the object itself can't know either. In short, there is no difference between a <code>nil</code> array and a zero length array.</p>\n\n<p>The \"perceptible initial difference between an empty array and pointer to null\" is not lost during serialization/deserialization, it's lost from the moment initial assignment is complete.</p>\n"}, {"comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1445060572, "post_id": 33183187, "comment_id": 54173143, "body": "Not sure why this was down-voted.  It does what the OP is asking for, returning an empty json array in place of a null."}, {"owner": {"reputation": 4018, "user_id": 2252889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H31dX.jpg?s=128&g=1", "display_name": "Mike Precup", "link": "https://stackoverflow.com/users/2252889/mike-precup"}, "edited": false, "score": 1, "creation_date": 1445060751, "post_id": 33183187, "comment_id": 54173176, "body": "Not the downvoter, but I would assume because it doesn&#39;t actually differentiate the two. If it was originally <code>nil</code>, it would now be <code>[]</code>."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 4018, "user_id": 2252889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H31dX.jpg?s=128&g=1", "display_name": "Mike Precup", "link": "https://stackoverflow.com/users/2252889/mike-precup"}, "edited": false, "score": 2, "creation_date": 1445060903, "post_id": 33183187, "comment_id": 54173205, "body": "@MikePrecup: Unless I am reading the OP&#39;s question incorrectly, I believe that is what they are after."}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "edited": false, "score": 0, "creation_date": 1445060995, "post_id": 33183187, "comment_id": 54173213, "body": "Arf, my bad, I misunderstood your answer and downvoted too quickly, sorry. It&#39;s locked now, but if you can edit your answer (adding a playground link for example) I&#39;ll be able to change this into an upvote. Edit: ok, upvoted"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 4018, "user_id": 2252889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H31dX.jpg?s=128&g=1", "display_name": "Mike Precup", "link": "https://stackoverflow.com/users/2252889/mike-precup"}, "edited": false, "score": 0, "creation_date": 1445061207, "post_id": 33183187, "comment_id": 54173255, "body": "@MikePrecup, I see your point.  I guess that is up to the OP and perhaps the system in question as to whether nil Addresses are possible.  Based on the comment about &quot;causing a contract broken&quot; I would assume the empty array is always desired."}, {"owner": {"reputation": 4018, "user_id": 2252889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H31dX.jpg?s=128&g=1", "display_name": "Mike Precup", "link": "https://stackoverflow.com/users/2252889/mike-precup"}, "edited": false, "score": 0, "creation_date": 1445103848, "post_id": 33183187, "comment_id": 54185097, "body": "Good point, depends on what the contract is! I&#39;ll leave my answer for posterity in case anyone else has the other problem."}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 18, "last_activity_date": 1445061608, "last_edit_date": 1445061608, "creation_date": 1445060265, "answer_id": 33183187, "question_id": 33183071, "link": "https://stackoverflow.com/questions/33183071/golang-serialize-deserialize-an-empty-array-not-as-null/33183187#33183187", "title": "Golang serialize/deserialize an Empty Array not as null", "body": "<p>I am pretty sure the easiest way you can do it is to change your line </p>\n\n<pre><code>var cust1_recovered Customer\n</code></pre>\n\n<p>to</p>\n\n<pre><code>cust1_recovered := Customer{Addresses: []Address{}}\n</code></pre>\n\n<p>Unless I am reading your question incorrectly, I believe this is your desired output:</p>\n\n<pre><code>ORIGINAL  Customer 2 {\n  \"Name\": \"Customer number 2\",\n  \"Addresses\": []\n}\nRECOVERED Customer 2 {\n  \"Name\": \"Customer number 2\",\n  \"Addresses\": []\n}\n</code></pre>\n\n<p>Here is a playground to verify with: <a href=\"https://play.golang.org/p/T9K1VSTAM0\" rel=\"noreferrer\">https://play.golang.org/p/T9K1VSTAM0</a></p>\n\n<p>The limitation here, as @mike pointed out, is if <code>Addresses</code> is truly <code>nil</code> before you encode, once you decode you do not get the json equivalent <code>null</code>, but would instead end up with an empty list.</p>\n"}, {"tags": [], "owner": {"reputation": 131, "user_id": 755788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64806f505df2a52e1ff2c7105a4a187d?s=128&d=identicon&r=PG", "display_name": "cbelsole", "link": "https://stackoverflow.com/users/755788/cbelsole"}, "is_accepted": false, "score": 2, "last_activity_date": 1536240908, "creation_date": 1536240908, "answer_id": 52205316, "question_id": 33183071, "link": "https://stackoverflow.com/questions/33183071/golang-serialize-deserialize-an-empty-array-not-as-null/52205316#52205316", "title": "Golang serialize/deserialize an Empty Array not as null", "body": "<p>For another solution, we have <a href=\"https://github.com/helloeave/json\" rel=\"nofollow noreferrer\">forked encoding/json</a> to add a new method called <code>MarshalSafeCollections()</code>. This method will marshal Slices/Arrays/Maps as their respective empty values (<code>[]</code>/<code>{}</code>). Since most of our instantiation happens on the data layer we did not want to add code that fixed issues in our http response layer. The changes to the library are minimal and follow go releases.</p>\n"}], "owner": {"reputation": 423, "user_id": 3435329, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ek5Ff.jpg?s=128&g=1", "display_name": "DLopes", "link": "https://stackoverflow.com/users/3435329/dlopes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14981, "favorite_count": 4, "accepted_answer_id": 33183187, "answer_count": 3, "score": 20, "last_activity_date": 1545467523, "creation_date": 1445059311, "last_edit_date": 1545467523, "question_id": 33183071, "link": "https://stackoverflow.com/questions/33183071/golang-serialize-deserialize-an-empty-array-not-as-null", "title": "Golang serialize/deserialize an Empty Array not as null", "body": "<p>Is there a way to serialize an empty array attribute (not null) of a struct and deserialize it back to an empty array (not null again)?</p>\n\n<p>Considering that an empty array is actually a pointer to null, is the perceptible initial difference between an empty array and pointer to null completely lost after serialize/deserialize?</p>\n\n<p>The worst practical scenario is that when I show an empty array attribute to my REST client, as a json \"att\":[], at first time, and, after cache register to redis and recover it, the same attribute is shown to my client as \"att\":null, causing a contract broken and a lot of confusing.</p>\n\n<p><strong>Summing up</strong>: is possible to show the Customer 2 addresses like an json empty array, after serialize/deserialize => <a href=\"https://play.golang.org/p/TVwvTWDyHZ\" rel=\"noreferrer\">https://play.golang.org/p/TVwvTWDyHZ</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4018, "user_id": 2252889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H31dX.jpg?s=128&g=1", "display_name": "Mike Precup", "link": "https://stackoverflow.com/users/2252889/mike-precup"}, "edited": false, "score": 2, "creation_date": 1445059123, "post_id": 33183028, "comment_id": 54172884, "body": "Yes, that particular article is still valid. Do you mean has it changed much since its very first release, or since 1.0? The changes since 1.0 haven&#39;t been particularly drastic compared to the ones before 1.0. Go 1.x versions are backwards compatible to 1.0, and changes may be found <a href=\"https://golang.org/doc/devel/release.html\" rel=\"nofollow noreferrer\">here.</a>"}, {"owner": {"reputation": 39, "user_id": 5380705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058691e95bcbebd91b8ed2b330ef6d9e?s=128&d=identicon&r=PG&f=1", "display_name": "B. Kelso", "link": "https://stackoverflow.com/users/5380705/b-kelso"}, "reply_to_user": {"reputation": 4018, "user_id": 2252889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H31dX.jpg?s=128&g=1", "display_name": "Mike Precup", "link": "https://stackoverflow.com/users/2252889/mike-precup"}, "edited": false, "score": 0, "creation_date": 1445141944, "post_id": 33183028, "comment_id": 54194088, "body": "@MikePrecup: versions that are more commonly found out in the world, so I&#39;m guessing only versions 1.0 and later, and peterSO provided an answer."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1445080408, "last_edit_date": 1445080408, "creation_date": 1445080105, "answer_id": 33185901, "question_id": 33183028, "link": "https://stackoverflow.com/questions/33183028/has-go-changed-much-since-its-creation/33185901#33185901", "title": "Has Go changed much since its creation?", "body": "<p>Go hasn't changed much such its first public release. The blog is good.</p>\n\n<p>Go has compatibility guarantees.</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/doc/go1compat\" rel=\"nofollow\">Go 1 and the Future of Go Programs</a></p>\n  \n  <p>Introduction<br>\n  Expectations<br>\n  Sub-repositories<br>\n  Operating systems<br>\n  Tools</p>\n  \n  <p><a href=\"https://golang.org/doc/go1compat#introduction\" rel=\"nofollow\">Introduction</a></p>\n  \n  <p>The release of Go version 1 (March 2012), Go 1 for short, is a major milestone in\n  the development of the language. Go 1 is a stable platform for the\n  growth of programs and projects written in Go.</p>\n  \n  <p>Go 1 defines two things: first, the specification of the language; and\n  second, the specification of a set of core APIs, the \"standard\n  packages\" of the Go library. The Go 1 release includes their\n  implementation in the form of two compiler suites (gc and gccgo), and\n  the core libraries themselves.</p>\n  \n  <p>It is intended that programs written to the Go 1 specification will\n  continue to compile and run correctly, unchanged, over the lifetime of\n  that specification. At some indefinite point, a Go 2 specification may\n  arise, but until that time, Go programs that work today should\n  continue to work even as future \"point\" releases of Go 1 arise (Go\n  1.1, Go 1.2, etc.).</p>\n  \n  <p>Compatibility is at the source level. Binary compatibility for\n  compiled packages is not guaranteed between releases. After a point\n  release, Go source will need to be recompiled to link against the new\n  release.</p>\n  \n  <p>The APIs may grow, acquiring new packages and features, but not in a\n  way that breaks existing Go 1 code.</p>\n</blockquote>\n"}], "owner": {"reputation": 39, "user_id": 5380705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058691e95bcbebd91b8ed2b330ef6d9e?s=128&d=identicon&r=PG&f=1", "display_name": "B. Kelso", "link": "https://stackoverflow.com/users/5380705/b-kelso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1445082481, "creation_date": 1445058977, "last_edit_date": 1445082481, "question_id": 33183028, "link": "https://stackoverflow.com/questions/33183028/has-go-changed-much-since-its-creation", "title": "Has Go changed much since its creation?", "body": "<p>I've also been recently learning about Ember.js. It's not really an apples-to-apples comparison since Ember.js is a framework while Go is a language. Ember.js is relatively new and I've found out that some tutorials written as recently as this year are already out of date. </p>\n\n<p>For example, is this blog from 2010, <a href=\"https://blog.golang.org/gos-declaration-syntax\" rel=\"nofollow\">https://blog.golang.org/gos-declaration-syntax</a>, about Go's declaration syntax still valid?</p>\n"}, {"tags": ["reflection", "go"], "answers": [{"comments": [{"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1445032949, "post_id": 33180089, "comment_id": 54167635, "body": "The issue is that I can&#39;t assign to the map created(as it&#39;s not allocated). I will edit the question to elaborate why this is an issue."}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1445033787, "post_id": 33180089, "comment_id": 54167902, "body": "I&#39;ve updated the question. Long story short is that I need the map allocated unless I&#39;m willing to implement a diff function and additional copies after each Unmarshal"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1445033995, "post_id": 33180089, "comment_id": 54167959, "body": "@Theuserwithnohat: OK, added an example of setting the pointer value to an allocated map."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1445033971, "last_edit_date": 1445033971, "creation_date": 1445032222, "answer_id": 33180089, "question_id": 33179876, "link": "https://stackoverflow.com/questions/33179876/how-to-make-a-map-pointer-using-reflect/33180089#33180089", "title": "How to make a map pointer using reflect?", "body": "<p>For a function like <code>json.Unamrshal</code>, you don't need the map, you only need the correct type pointer, which you can make with <code>reflect.New</code>. The json package will allocate the map as needed.</p>\n\n<pre><code>m := reflect.New(reflect.MapOf(reflect.TypeOf(\"\"), reflect.TypeOf(typ)))\n</code></pre>\n\n<p>If you need to allocate the map, use the Set method to assign it to the pointer.</p>\n\n<p><a href=\"http://play.golang.org/p/hnOhh8242i\" rel=\"noreferrer\">http://play.golang.org/p/hnOhh8242i</a></p>\n\n<pre><code>mapType := reflect.MapOf(reflect.TypeOf(\"\"), reflect.TypeOf(typ))\n\nptr := reflect.New(mapType)\nptr.Elem().Set(reflect.MakeMap(mapType))\n</code></pre>\n"}], "owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 666, "favorite_count": 0, "accepted_answer_id": 33180089, "answer_count": 1, "score": 1, "last_activity_date": 1445033971, "creation_date": 1445031112, "last_edit_date": 1445033716, "question_id": 33179876, "link": "https://stackoverflow.com/questions/33179876/how-to-make-a-map-pointer-using-reflect", "title": "How to make a map pointer using reflect?", "body": "<p>I need to pass a pointer to a map to another function using the reflect package. Think of encoding/json.Unmarshal which accepts only pointers. Below is some code of what I need to do using reflection:</p>\n\n<pre><code>  myTyp := &amp;MyType{}\n  json.Unmarshal(jsonPayload1, myTyp)\n  m := make(map[string]*MyType)\n  m[\"someKey\"] = myTyp\n  // Dump it again to Unmarshal. It will overwrite it only if \n  // there is a `someKey` key.\n  x := json.Unmarshal(jsonPayload2, &amp;m)\n</code></pre>\n\n<p>So far I have the following:</p>\n\n<pre><code>  ....\n  m := reflect.MakeMap(reflect.MapOf(reflect.TypeOf(\"\"), reflect.TypeOf(typ))\n  x := json.Unmarshal(jsonPayload2, m.Interface())\n</code></pre>\n\n<p>The issue with this code is that it's making a map of map[string]MyType but there is no way I can create a pointer for it. If I try to make the pointer [2] directly it panics with <code>reflect.MakeMap of non-map type</code>. </p>\n\n<p><strong>Why the map must be allocated:</strong></p>\n\n<p>I need the map allocated so that I can set myTyp on a specific key. myTyp is decoded using multiple decoding sources so I don't know what fields were decoded with each source but I know that Unmarshal overwrites only keys that match the json content/keys so it's safe to use the same variable to multiple Unmarshal functions. </p>\n\n<p>[2] <code>reflect.MakeMap(reflect.PtrTo(reflect.MapOf(reflect.TypeOf(\"\")),  reflect.TypeOf(typ))</code></p>\n"}, {"tags": ["struct", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1445029697, "post_id": 33179479, "comment_id": 54166361, "body": "Given there are only two options, what is the problem with explicitly referring to the field by name? It&#39;s a simple if-else statement to write out your where clause. If your real use case has a lot of fields, rather than just a couple then I could understand wanting to use reflection but it&#39;s unpredictable way to write a query. Like you could talk all fields and use the first one in the array that has a value set to generate your where, but what happens when the first item with a value is some random meaningless non identifying column?"}, {"owner": {"reputation": 186, "user_id": 4021293, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/be50cb780c45f41f9fa40b6736d1ca44?s=128&d=identicon&r=PG&f=1", "display_name": "goda", "link": "https://stackoverflow.com/users/4021293/goda"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1445030144, "post_id": 33179479, "comment_id": 54166552, "body": "I suppose writing a function like this isn&#39;t really practical, especially now that I think of the validations. I will go with the if-else structure you suggested."}], "answers": [{"comments": [{"owner": {"reputation": 186, "user_id": 4021293, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/be50cb780c45f41f9fa40b6736d1ca44?s=128&d=identicon&r=PG&f=1", "display_name": "goda", "link": "https://stackoverflow.com/users/4021293/goda"}, "edited": false, "score": 0, "creation_date": 1445047490, "post_id": 33180182, "comment_id": 54170867, "body": "I can write explicit functions, which I did at first. I thought I could make one function handle all of them. But the consensus is that it will cause too many complications which makes sense with sql"}, {"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "reply_to_user": {"reputation": 186, "user_id": 4021293, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/be50cb780c45f41f9fa40b6736d1ca44?s=128&d=identicon&r=PG&f=1", "display_name": "goda", "link": "https://stackoverflow.com/users/4021293/goda"}, "edited": false, "score": 0, "creation_date": 1445061779, "post_id": 33180182, "comment_id": 54173389, "body": "Using closures make writing functions easier. Them you can simply write a function which parameter is field, and it returns you a function, that select this field."}], "tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": true, "score": 0, "last_activity_date": 1445032684, "creation_date": 1445032684, "answer_id": 33180182, "question_id": 33179479, "link": "https://stackoverflow.com/questions/33179479/golang-return-first-field-from-struct/33180182#33180182", "title": "golang return first field from struct", "body": "<p>What you want has several bad or at least controversary design decision.</p>\n\n<p>1) SQL statement you cannot use \"WHERE ? = ?\". Name of the column cannot be replaced with ?, only values can. It is not caused by golang, but by database, because when it obtain request create a plan how to obtain a data (which index use or full table scan or ...).</p>\n\n<p>That means you have to create different string of query for each column, you want use in where clause. It can look something like this:</p>\n\n<pre><code>    func GetUserInfoByColumn(field string) *User, error {\nquery := fmt.Sprintf(\"SELECT user_id, name, email FROM users WHERE %s = ?\", column)\n    var u User\n    err := db.QueryRow(query, value).Scan(&amp;u.User_id, &amp;u.Name, &amp;u.Email)\n    if err != nil {return nil, err}\n    return &amp;u, nil\n    }\n</code></pre>\n\n<p>More efective than this is using a closure and create query there.</p>\n\n<p>2) db.QueryRow looks like another problem. You can use it only if you are sure, that only one row matches your criteria. If you are not so sure, please use db.Query.</p>\n\n<p>3) In go you can use reflect to get a name of all items in struct. But if your struct has only few field it is too complicated. In our case you can simple create all necessary functions very simple.</p>\n\n<p>4) I don't understand why you tries to fill always just one field of struct and put the filter into struct. Would not be better have more functions and just call UserInfoByName, or UserInfoByEmail at proper place of code? Why you tries to choose a filter accoring field?</p>\n"}], "owner": {"reputation": 186, "user_id": 4021293, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/be50cb780c45f41f9fa40b6736d1ca44?s=128&d=identicon&r=PG&f=1", "display_name": "goda", "link": "https://stackoverflow.com/users/4021293/goda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1060, "favorite_count": 0, "accepted_answer_id": 33180182, "answer_count": 1, "score": -2, "last_activity_date": 1445032684, "creation_date": 1445029230, "question_id": 33179479, "link": "https://stackoverflow.com/questions/33179479/golang-return-first-field-from-struct", "title": "golang return first field from struct", "body": "<p>I am trying to return all user information given ONE attribute which can either be user_id, email, or name.</p>\n\n<pre><code>u := User{\n Email: \"goda@go.com\"\n })\nk := User {\nName: \"john\"\n}\n\nReturnUserInfo(u)\nReturnUserInfo(k)\n</code></pre>\n\n<p>I invoke the function passing a User struct with only one field. Then I want to parse the field without EXPLICITLY saying the email. In the end I get the user information by passing an implicit field (user_id OR email etc.)</p>\n\n<pre><code>func ReturnUserInfo(u User) (y User){\n    // Retrieve first field from u and set them to field and value.\n    // NOT explicitly stating field := email, value := u.Email\n\n    db, _ := sql.Open(\"mysql\", \"root:password@/users\")\n    _ := db.QueryRow(\"SELECT user_id, name, email FROM users WHERE ? = ?\", field, value).Scan(\n        &amp;u.User_id, &amp;u.Name, &amp;u.Email)\n    y = User{\n        User_id: u.User_id,\n        Name: u.Name,\n        Email: u.Email,\n    }\n    return y\n\n}\n</code></pre>\n\n<p>I am not sure if I am able to do this in Golang, but I am creating this function so I do not have to explicitly tell Go to look for a particular attribute to return a user's information.</p>\n"}, {"tags": ["mysql", "database", "go"], "comments": [{"owner": {"reputation": 4018, "user_id": 2252889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H31dX.jpg?s=128&g=1", "display_name": "Mike Precup", "link": "https://stackoverflow.com/users/2252889/mike-precup"}, "edited": false, "score": 2, "creation_date": 1445017096, "post_id": 33176367, "comment_id": 54160071, "body": "I don&#39;t understand what your question is, could you please state it more clearly?"}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 5273213, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8225edf7e7e3658201e31ae323d63eb4?s=128&d=identicon&r=PG&f=1", "display_name": "RieuxThomas", "link": "https://stackoverflow.com/users/5273213/rieuxthomas"}, "edited": false, "score": 0, "creation_date": 1445090886, "post_id": 33182597, "comment_id": 54180910, "body": "Thanks for the correction ;) i will test it tonight"}, {"owner": {"reputation": 39, "user_id": 5273213, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8225edf7e7e3658201e31ae323d63eb4?s=128&d=identicon&r=PG&f=1", "display_name": "RieuxThomas", "link": "https://stackoverflow.com/users/5273213/rieuxthomas"}, "edited": false, "score": 0, "creation_date": 1445247651, "post_id": 33182597, "comment_id": 54226596, "body": "I don&#39;t understand how to implement it, how can i get the metas values with this interface in the &quot;row.Next&quot; ?"}], "tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": true, "score": 12, "last_activity_date": 1445257045, "last_edit_date": 1445257045, "creation_date": 1445054533, "answer_id": 33182597, "question_id": 33176367, "link": "https://stackoverflow.com/questions/33176367/golang-decode-json-string-to-struct-from-mysql-db/33182597#33182597", "title": "Golang: Decode json string to struct from mysql db", "body": "<p>You can make your <code>metas</code> struct implement the <a href=\"https://golang.org/pkg/database/sql/#Scanner\" rel=\"noreferrer\"><code>sql.Scanner</code></a> interface</p>\n\n<p>It should look something like this:</p>\n\n<pre><code>func (m *metas) Scan(src interface{}) error {\n    strValue, ok := src.(string)\n\n    if !ok {\n        return fmt.Errorf(\"metas field must be a string, got %T instead\", src)\n    }\n\n    return json.Unmarshal([]byte(strValue), m)\n}\n</code></pre>\n\n<p>After that you can use it as an <code>InfoClip</code> field and pass it directly to <code>Scan</code> and drop the <code>decodeJsonSql</code>:</p>\n\n<pre><code>type InfoClip struct {\n    // [...]\n    Metas metas `json:metas`\n    // [...]\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>q := \"SELECT c.id AS clipId, c.streamUrl, c.startTimecode,  c.endTimecode, c.createdAt, s.metas,... FROM clips WHERE c.id = ?\"\nrow := datab.QueryRow(q, mediaId)\nclips := InfoClip{}\nerr := row.Scan(&amp;clips.ClipId, &amp;clips.StreamUrl, &amp;clips.StartTimeCode, &amp;clips.EndTimeCode, &amp;clips.CreatedAt, &amp;clips.Metas) // [...]\nif err != nil {\n    fmt.Printf(\"SQL Err: %s\", err)\n    return err\n}\n</code></pre>\n\n<p>(BTW, as you can see, I replaced <code>datab.Query</code> with <a href=\"https://golang.org/pkg/database/sql/#DB.QueryRow\" rel=\"noreferrer\"><code>datab.QueryRow</code></a> as you are expecting only one result)</p>\n"}], "owner": {"reputation": 39, "user_id": 5273213, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8225edf7e7e3658201e31ae323d63eb4?s=128&d=identicon&r=PG&f=1", "display_name": "RieuxThomas", "link": "https://stackoverflow.com/users/5273213/rieuxthomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5280, "favorite_count": 0, "accepted_answer_id": 33182597, "answer_count": 1, "score": 2, "last_activity_date": 1445257045, "creation_date": 1445017015, "last_edit_date": 1445059726, "question_id": 33176367, "link": "https://stackoverflow.com/questions/33176367/golang-decode-json-string-to-struct-from-mysql-db", "title": "Golang: Decode json string to struct from mysql db", "body": "<p>I'm trying to get informations from my db, and one of my fields is actually JSON stored as a string and I would like to get it as a struct.</p>\n\n<p>This is my row's struct :</p>\n\n<pre><code>//there is json flag because I use it to get data from redis too\ntype InfoClip struct {\n ClipId             string `json:clipId`\n StreamUrl          string `json:streamUrl`\n StartTimeCode      int `json:startTimeCode`\n EndTimeCode        int `json:endTimeCode`\n CreatedAt          string `json:createdAt`\n Metas              string `json:metas` // here I get a string instead of a 'metas' struct\n SourceId           string `json:sourceId`\n ProviderName       string `json:providerName`\n ProviderReference  string `json:providerReference`\n PublicationStatus  string `json:publicationStatus`\n UserId             string `json:userId`\n Name               string `json:name`\n FacebookPage       string `json:facebookPage`\n TwitterHandle      string `json:twitterHandle`\n PermaLinkUrl       string `json:permalinkUrl`\n Logo               string `json:logo`\n Link               string `json:link`\n}\n</code></pre>\n\n<p>This is my <code>metas</code> struct :</p>\n\n<pre><code>type metas struct {\n Title      string `json:title`\n Tags       []string `json:tags`\n categories []string `json:permalink`\n}\n</code></pre>\n\n<p>This is how I'm trying to get this field</p>\n\n<pre><code>func decodeJsonSql (met string) (*metas, error) {\n m := metas{}\n if err := json.Unmarshal([]byte(met), &amp;m); err != nil {\n    fmt.Printf(\"Error decode metas: \", err)\n    return nil, err\n } else {\n    return &amp;m, err\n }\n } \n\nfunc CheckIdSql(mediaId string) (error){\n datab, err := sql.Open(\"mysql\", \"tcp()\")\n if err != nil {\n    fmt.Printf(\"[SQL ERROR] Cannot Open db =&gt; \", err)\n    return err\n}\nif err := datab.Ping(); err != nil {\n    fmt.Printf(\"[SQL ERROR] db connection =&gt; \", err)\n    return err\n}\nfmt.Printf(\"[SQL ONLINE] =&gt;\", datab)\ndefer datab.Close()\n\nq := \"SELECT c.id AS clipId, c.streamUrl, c.startTimecode,  c.endTimecode, c.createdAt, s.metas,... FROM clips WHERE c.id = ?\"\nrows, err := datab.Query(q, mediaId)\nif err != nil || err == sql.ErrNoRows {\n    fmt.Printf(\"SQL Err: %s\", err)\n    return err\n}\nclips := InfoClip{}\nfor rows.Next() {\n    rows.Scan(&amp;clips.ClipId, &amp;clips.StreamUrl, &amp;clips.StartTimeCode, &amp;clips.EndTimeCode, &amp;clips.CreatedAt, &amp;clips.Metas, ...)\n}\nret, err := decodeJsonSql(clips.Metas)\nif err != nil{\n    return err\n}\nclips.Metas = ret\nfmt.Printf(\"\\n\\n[SQL DEBUG RESPONSE]: %v\", clips)\nreturn nil\n}\n</code></pre>\n\n<p>But this process is pretty heavy, surely there is an easier way?\nThanks.</p>\n"}, {"tags": ["struct", "go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1445013850, "post_id": 33175355, "comment_id": 54158457, "body": "@JimB: Your choice of a duplicate was poor. It doesn&#39;t include an explanation of tags."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1445013905, "post_id": 33175355, "comment_id": 54158482, "body": "@peterSO: agree. This gets asked so frequently, I&#39;m having trouble finding the good ones now"}], "answers": [{"comments": [{"owner": {"reputation": 28, "user_id": 1156784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/44f9f5997c230702bb952cb095dfd5e6?s=128&d=identicon&r=PG", "display_name": "Pedo Souza", "link": "https://stackoverflow.com/users/1156784/pedo-souza"}, "edited": false, "score": 1, "creation_date": 1445013481, "post_id": 33175393, "comment_id": 54158262, "body": "But the webservice what I need consume, the object starts with m lowercase. How can I consume him ?"}, {"owner": {"reputation": 28, "user_id": 1156784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/44f9f5997c230702bb952cb095dfd5e6?s=128&d=identicon&r=PG", "display_name": "Pedo Souza", "link": "https://stackoverflow.com/users/1156784/pedo-souza"}, "edited": false, "score": 0, "creation_date": 1445014125, "post_id": 33175393, "comment_id": 54158598, "body": "I just replace m lower to upper and worked fine. Thanks a lot"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 28, "user_id": 1156784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/44f9f5997c230702bb952cb095dfd5e6?s=128&d=identicon&r=PG", "display_name": "Pedo Souza", "link": "https://stackoverflow.com/users/1156784/pedo-souza"}, "edited": false, "score": 1, "creation_date": 1445015602, "post_id": 33175393, "comment_id": 54159345, "body": "@PedoSouza the other way to work with that is to use json annotations like <code>json:&quot;mTheActualNameCouldBeAnything&quot;</code>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1445016656, "post_id": 33175393, "comment_id": 54159865, "body": "@evanmcdonnal: In Go, they are called JSON (struct field) tags, not annotations."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 1, "last_activity_date": 1445016453, "last_edit_date": 1445016453, "creation_date": 1445013230, "answer_id": 33175393, "question_id": 33175355, "link": "https://stackoverflow.com/questions/33175355/struct-not-been-entirely-marshaled/33175393#33175393", "title": "struct not been entirely marshaled", "body": "<p>All your other fields are unexported (like private in other languages) and the unmarshaller can't access them. This is designated by the case of the first letter in the field name, needs to be uppercase.</p>\n\n<p>For reference, here's an example using a field name on your struct that differs from the json's field name;</p>\n\n<pre><code>var jsonBlob = []byte(`[\n    {\"Name\": \"Platypus\", \"Purchase\": \"Monotremata\"},\n    {\"Name\": \"Quoll\",    \"Purchase\": \"Dasyuromorphia\"}\n]`)\ntype Animal struct {\n    Name  string\n    Order string `json:\"Purchase\"`\n}\nvar animals []Animal\nerr := json.Unmarshal(jsonBlob, &amp;animals)\nif err != nil {\n    fmt.Println(\"error:\", err)\n}\nfmt.Printf(\"%+v\", animals)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/iJqaXQY7Ch\" rel=\"nofollow\">https://play.golang.org/p/iJqaXQY7Ch</a></p>\n"}], "owner": {"reputation": 28, "user_id": 1156784, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/44f9f5997c230702bb952cb095dfd5e6?s=128&d=identicon&r=PG", "display_name": "Pedo Souza", "link": "https://stackoverflow.com/users/1156784/pedo-souza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 33175393, "answer_count": 1, "score": -2, "last_activity_date": 1445016453, "creation_date": 1445013131, "question_id": 33175355, "link": "https://stackoverflow.com/questions/33175355/struct-not-been-entirely-marshaled", "title": "struct not been entirely marshaled", "body": "<p>I have a struct what I need to marshal to consume the webservice, but in my tests I the Marshal function only encode one field:</p>\n\n<pre><code>type DataRows []struct {\n    mData interface{}\n}\n\ntype DataColumns []struct {\n    mColumnName      string\n    mColumnType      int\n    mColumnPrecision int\n    mColumnScale     int\n}\ntype DataTables []struct {\n    mDataColumns DataColumns\n    mDataRows    DataRows\n    mIndex       int\n}\n\ntype CFFDataSet struct {\n    mDataTables DataTables\n    mUser       string\n    DBServer    int\n}\n\nfunc main() {\n    ds := CFFDataSet{\n        mDataTables: DataTables{{\n            mDataColumns: DataColumns{{\n                mColumnName:      \"Test\",\n                mColumnType:      1,\n                mColumnPrecision: 1,\n                mColumnScale:     1,\n            }},\n            mDataRows: DataRows{{\n                mData: \"Test\",\n            }},\n            mIndex: 0,\n        }},\n        mUser:    \"Teste\",\n        DBServer: 2,\n    }\n\n    marchaled, _ := json.Marshal(ds)\n    fmt.Println(string(marchaled))\n}\n</code></pre>\n\n<p>is returning </p>\n\n<pre><code>$ go run getrest.go\n{\"DBServer\":2}\n</code></pre>\n\n<p>Can someone give me a hint why not this working ?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "edited": false, "score": 0, "creation_date": 1445011433, "post_id": 33174758, "comment_id": 54157087, "body": "Thanks for your response. Trouble is, I&#39;m trying to get a set of data for each array item if that makes sense. So I&#39;m not just iterating over a series of files, each iteration will contain a height and width value also."}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "reply_to_user": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "edited": false, "score": 0, "creation_date": 1445011870, "post_id": 33174758, "comment_id": 54157344, "body": "Are you trying to derive the height and width from the uploaded file, or is it inputed when the file is uploaded?"}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "reply_to_user": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "edited": false, "score": 0, "creation_date": 1445012067, "post_id": 33174758, "comment_id": 54157454, "body": "If you are trying to derive the width and height you will have to open the file and decode the image based on mimetype to determine the width and height."}, {"owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "edited": false, "score": 0, "creation_date": 1445012122, "post_id": 33174758, "comment_id": 54157491, "body": "It&#39;s just a generic upload, I&#39;m uploading several files, each given a height and width and I have a function which crops that image to the height and width etc. I&#39;m just struggling to access the post data in rows if that makes sense?"}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "reply_to_user": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "edited": false, "score": 0, "creation_date": 1445012397, "post_id": 33174758, "comment_id": 54157656, "body": "Ok. You can just use a regular form array for width and height that correspond to the order that the files were uploaded. Then when you iterate your files you can accesses the form&#39;s Value map to get the width and height by index."}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "reply_to_user": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "edited": false, "score": 0, "creation_date": 1445012566, "post_id": 33174758, "comment_id": 54157747, "body": "I updated my answer to illustrate how you would access width and height if they were arrays in your form post."}, {"owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "edited": false, "score": 0, "creation_date": 1445014131, "post_id": 33174758, "comment_id": 54158605, "body": "Thank you so much! Perfect!"}], "tags": [], "owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "is_accepted": true, "score": 3, "last_activity_date": 1445012511, "last_edit_date": 1445012511, "creation_date": 1445011065, "answer_id": 33174758, "question_id": 33174247, "link": "https://stackoverflow.com/questions/33174247/accessing-array-post-params-in-golang-gin/33174758#33174758", "title": "Accessing array post params in golang (gin)", "body": "<p>You can access the <code>File</code> slice directly instead of using the <code>FormFile</code> method on <code>Request</code>. Assuming you have a form array for <code>width</code> and <code>height</code> that correspond to the order that the files were uploaded. </p>\n\n<pre><code>if err := ctx.Request.ParseMultipartForm(32 &lt;&lt; 20); err != nil {\n    // handle error\n}\n\nfor i, fh := range ctx.Request.MultipartForm.File[\"item\"] {\n    // access file header using fh\n    w := ctx.Request.MultipartForm.Value[\"width\"][i]\n    h := ctx.Request.MultipartForm.Value[\"height\"][i]\n}\n</code></pre>\n\n<p>The <code>FormFile</code> method on <code>Request</code> is just a wrapper around <code>MultipartForm.File</code> that returns the first file at that key.</p>\n"}], "owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1904, "favorite_count": 0, "accepted_answer_id": 33174758, "answer_count": 1, "score": 2, "last_activity_date": 1445012511, "creation_date": 1445009461, "question_id": 33174247, "link": "https://stackoverflow.com/questions/33174247/accessing-array-post-params-in-golang-gin", "title": "Accessing array post params in golang (gin)", "body": "<p>I'm attempting to access an array of files and values posted to an API written in Gin (golang). I've got a function which takes a file, height and width. It then calls functions to resize the file, and then upload it to S3. However, I'm attempting to also upload multiple files.</p>\n\n<pre><code>func (rc *ResizeController) Resize(c *gin.Context) {\n\n    file, header, err := c.Request.FormFile(\"file\")\n    filename := header.Filename\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    height := c.PostForm(\"height\")\n    width := c.PostForm(\"width\")\n\n    finalFile := rc.Crop(height, width, file)\n\n    go rc.Upload(filename, finalFile, \"image/jpeg\", s3.BucketOwnerFull)\n\n    c.JSON(200, gin.H{\"filename\": filename})\n}\n</code></pre>\n\n<p>I couldn't see anywhere in the docs how to access data in the following format: </p>\n\n<pre><code>item[0]file\nitem[0]width\nitem[0]height\nitem[1]file\nitem[1]width\nitem[1]height\n</code></pre>\n\n<p>etc.</p>\n\n<p>I figured something along the lines of:</p>\n\n<pre><code>for index, element := range c.Request.PostForm(\"item\") {\n    fmt.Println(element.Height)\n}\n</code></pre>\n\n<p>But that threw \"c.Request.Values undefined (type *http.Request has no field or method Values)\"</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6529, "user_id": 4252320, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh3.googleusercontent.com/-_DAs7Dtci9U/AAAAAAAAAAI/AAAAAAAAIf8/96ZNJAUF2Xk/photo.jpg?sz=128", "display_name": "ergonaut", "link": "https://stackoverflow.com/users/4252320/ergonaut"}, "edited": false, "score": 0, "creation_date": 1445009336, "post_id": 33174148, "comment_id": 54155846, "body": "you could just put the if block in a method.."}, {"owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "reply_to_user": {"reputation": 6529, "user_id": 4252320, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh3.googleusercontent.com/-_DAs7Dtci9U/AAAAAAAAAAI/AAAAAAAAIf8/96ZNJAUF2Xk/photo.jpg?sz=128", "display_name": "ergonaut", "link": "https://stackoverflow.com/users/4252320/ergonaut"}, "edited": false, "score": 0, "creation_date": 1445009435, "post_id": 33174148, "comment_id": 54155904, "body": "@ergonaut the <code>total</code> type is different. Will it still work?"}, {"owner": {"reputation": 6529, "user_id": 4252320, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh3.googleusercontent.com/-_DAs7Dtci9U/AAAAAAAAAAI/AAAAAAAAIf8/96ZNJAUF2Xk/photo.jpg?sz=128", "display_name": "ergonaut", "link": "https://stackoverflow.com/users/4252320/ergonaut"}, "edited": false, "score": 0, "creation_date": 1445009861, "post_id": 33174148, "comment_id": 54156163, "body": "I guess not.  <a href=\"https://golang.org/doc/faq#generics\" rel=\"nofollow noreferrer\">golang.org/doc/faq#generics</a>"}, {"owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "reply_to_user": {"reputation": 6529, "user_id": 4252320, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh3.googleusercontent.com/-_DAs7Dtci9U/AAAAAAAAAAI/AAAAAAAAIf8/96ZNJAUF2Xk/photo.jpg?sz=128", "display_name": "ergonaut", "link": "https://stackoverflow.com/users/4252320/ergonaut"}, "edited": false, "score": 0, "creation_date": 1445009935, "post_id": 33174148, "comment_id": 54156200, "body": "@ergonaut yes, I realise that <code>generics</code> is not supported. But any workarounds till that time. Any other intelligent ways to handle this. I thought golang did not add generics, because, there are other ways to do it. Is it not true?"}, {"owner": {"reputation": 6529, "user_id": 4252320, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh3.googleusercontent.com/-_DAs7Dtci9U/AAAAAAAAAAI/AAAAAAAAIf8/96ZNJAUF2Xk/photo.jpg?sz=128", "display_name": "ergonaut", "link": "https://stackoverflow.com/users/4252320/ergonaut"}, "edited": false, "score": 0, "creation_date": 1445010284, "post_id": 33174148, "comment_id": 54156428, "body": "Sorry I don&#39;t know go.  But you go search &quot;polymorphism golang&quot; which may give you ideas."}, {"owner": {"reputation": 4018, "user_id": 2252889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H31dX.jpg?s=128&g=1", "display_name": "Mike Precup", "link": "https://stackoverflow.com/users/2252889/mike-precup"}, "edited": false, "score": 4, "creation_date": 1445010386, "post_id": 33174148, "comment_id": 54156493, "body": "Are the two data structures really coupled? In other words, should changing one&#39;s base functionality change the other? If they are, you can have them share a data storage type and use composition. If not, go&#39;s design encourages liberal use of lightweight interfaces. This may be a situation where you want to rework the code so that both data types have a common interface, and can thus both be used in the same method."}, {"owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "reply_to_user": {"reputation": 4018, "user_id": 2252889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H31dX.jpg?s=128&g=1", "display_name": "Mike Precup", "link": "https://stackoverflow.com/users/2252889/mike-precup"}, "edited": false, "score": 0, "creation_date": 1445010828, "post_id": 33174148, "comment_id": 54156736, "body": "@MikePrecup <code>Match</code> and <code>Activity</code> are two completely separate items. They do not have any common items between them. Changing one, should not have an effect on other. Did I understand your question on <code>coupled</code> correctly? If not, can you please explain more on what coupled really means here. I\u2019m looking more about having a common interface, but I\u2019m not able to figure out how to get interface work in this case. You see, here, we have a for loop, looping over a map. And the input (the <code>dailyActivities</code> or <code>dailyMatches</code>) comes from a different function. The <code>total.Add</code> is not common. Any tips?"}, {"owner": {"reputation": 4018, "user_id": 2252889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H31dX.jpg?s=128&g=1", "display_name": "Mike Precup", "link": "https://stackoverflow.com/users/2252889/mike-precup"}, "edited": false, "score": 0, "creation_date": 1445012102, "post_id": 33174148, "comment_id": 54157477, "body": "I take back what I said, I&#39;m not sure you can use interfaces here without side effects since you&#39;re taking an argument of the same type, I missed that. I can&#39;t come up with a clean way to do this while maintaining the current code design. You may be able to fix this by redesigning from the original problem as opposed to the current solution. The golang source is the gold standard for go design, and should be trusted more than anything I say."}], "answers": [{"tags": [], "owner": {"reputation": 444, "user_id": 1202623, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cbae78493ed2188bfb70b0c078ceb2c3?s=128&d=identicon&r=PG", "display_name": "Nikkolasg", "link": "https://stackoverflow.com/users/1202623/nikkolasg"}, "is_accepted": false, "score": 1, "last_activity_date": 1445108372, "last_edit_date": 1445108372, "creation_date": 1445084016, "answer_id": 33186503, "question_id": 33174148, "link": "https://stackoverflow.com/questions/33174148/making-code-more-generic/33186503#33186503", "title": "Making code more generic", "body": "<p>Go has a pretty package \"reflect\". You can <strong>not</strong> do genericity strictly speaking but you can get unification of code for the same behavior.\nI've changed your playground a bit : <a href=\"https://play.golang.org/p/bfqZsFOgVQ\" rel=\"nofollow\">https://play.golang.org/p/bfqZsFOgVQ</a></p>\n\n<p>The main part : </p>\n\n<pre><code>func AddTwo(a, b interface{}) interface{} {\n    va := reflect.ValueOf(a)\n    vb := reflect.ValueOf(b)\n    res := reflect.New(reflect.TypeOf(a)).Elem()\n    if va.Kind() != reflect.Struct &amp;&amp; vb.Kind() != reflect.Struct {\n        return nil\n    }\n\n    na, nb := va.NumField(), vb.NumField()\n    if na != nb {\n        return nil\n    }\n\n    for i := 0; i &lt; na; i++ {\n        // additional verification needed here\n        fa := va.Field(i).Uint()\n        fb := vb.Field(i).Uint()\n        fr := fa + fb\n        res.Field(i).SetUint(fr)\n    }\n\n    return res.Interface()\n}\n</code></pre>\n\n<p>I use reflect to check the fields of the struct I am given. If both are uint64, I can add them reflectively. If your structs contains many uint64, it can add them all !</p>\n\n<p>Note that you must convert the resulting interface to the type of the struct given after calling this function. That is why this is not strictly generic, because the returning type is a interface, and not a Match or Activity.</p>\n\n<p><strong>EDIT</strong>: No need even to return a new struct. You can simply update the field of the \"a\" struct by calling .SetUint() method.</p>\n"}], "owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1445108372, "creation_date": 1445009167, "last_edit_date": 1445010159, "question_id": 33174148, "link": "https://stackoverflow.com/questions/33174148/making-code-more-generic", "title": "Making code more generic", "body": "<p>I have a program where many functionalities are similar across different structures, however, I end up writing these functions again and again, esp because the variable that are being dealt inside are of different structures.</p>\n\n<p>I have written a sample code here.</p>\n\n<p><a href=\"https://play.golang.org/p/R2kZb_X5Kl\" rel=\"nofollow\">In Go Playgroud</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc (a *Match) Add(v Match) {\n    a.Runs += v.Runs\n    a.Points += v.Points\n}\n\ntype Match struct {\n    Runs   uint64\n    Points uint64\n}\n\nfunc (a *Activity) Add(v Activity) {\n    a.Walk += v.Walk\n    a.Jog += v.Jog\n}\n\ntype Activity struct {\n    Walk uint64\n    Jog  uint64\n}\n\nfunc GetDailyMatches() map[string]Match {\n    var dailyMatches map[string]Match\n\n    Match1, Match2 := Match{5, 10}, Match{1, 2}\n    dailyMatches = make(map[string]Match)\n    dailyMatches[\"01\"] = Match1\n    dailyMatches[\"02\"] = Match2\n    dailyMatches[\"03\"] = Match1\n    dailyMatches[\"04\"] = Match2\n    return dailyMatches\n}\n\nfunc GetDailyActivities() map[string]Activity {\n    var dailyActivities map[string]Activity\n\n    Activity1, Activity2 := Activity{5, 10}, Activity{1, 2}\n    dailyActivities = make(map[string]Activity)\n    dailyActivities[\"01\"] = Activity1\n    dailyActivities[\"02\"] = Activity2\n    dailyActivities[\"03\"] = Activity1\n    dailyActivities[\"04\"] = Activity2\n    return dailyActivities\n}\n\nfunc main() {\n    fmt.Println(CalculateMatchSummary(\"01\", \"03\"))\n    fmt.Println(CalculateActivitySummary(\"02\", \"04\"))\n    fmt.Println(CalculateMatchSummary(\"01\", \"03\"))\n    fmt.Println(CalculateActivitySummary(\"02\", \"04\"))\n}\n\nfunc CalculateMatchSummary(start, end string) (total Match) {\n    dailyMatches := GetDailyMatches()\n    for day, value := range dailyMatches {\n        if day &lt; start {\n            continue\n        } else if day &gt; end {\n            continue\n        } else {\n            total.Add(value)\n        }\n    }\n    return\n}\n\nfunc CalculateActivitySummary(start, end string) (total Activity) {\n    dailyActivities := GetDailyActivities()\n    for day, value := range dailyActivities {\n        if day &lt; start {\n            continue\n        } else if day &gt; end {\n            continue\n        } else {\n            total.Add(value)\n        }\n    }\n    return\n}\n</code></pre>\n\n<p>If you notice, both <code>Match</code> and <code>Activity</code> has the same functions and same structures, except that internally they are of different structures.</p>\n\n<p>Is there a easy way to make the code more generic (Go generics, which is not there in Go??) in Golang itself.</p>\n"}, {"tags": ["go", "google-api"], "answers": [{"tags": [], "owner": {"reputation": 438, "user_id": 1699865, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7dfd127ca79430fed151aa1665ac7c84?s=128&d=identicon&r=PG", "display_name": "Elwyn", "link": "https://stackoverflow.com/users/1699865/elwyn"}, "is_accepted": true, "score": 0, "last_activity_date": 1446825072, "creation_date": 1446825072, "answer_id": 33570582, "question_id": 33173938, "link": "https://stackoverflow.com/questions/33173938/google-reports-api-with-a-service-account/33570582#33570582", "title": "Google Reports API with a service account", "body": "<p>Fixed it. Needed to explicitly specify the subject value.\nI now follow the Service Account example : <a href=\"https://godoc.org/golang.org/x/oauth2/google\" rel=\"nofollow\">https://godoc.org/golang.org/x/oauth2/google</a></p>\n"}], "owner": {"reputation": 438, "user_id": 1699865, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7dfd127ca79430fed151aa1665ac7c84?s=128&d=identicon&r=PG", "display_name": "Elwyn", "link": "https://stackoverflow.com/users/1699865/elwyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "accepted_answer_id": 33570582, "answer_count": 1, "score": 0, "last_activity_date": 1446825072, "creation_date": 1445008509, "question_id": 33173938, "link": "https://stackoverflow.com/questions/33173938/google-reports-api-with-a-service-account", "title": "Google Reports API with a service account", "body": "<p>I'm trying to make a call to Google Reports API with a service account.</p>\n\n<p>I follow this code example : <a href=\"https://godoc.org/golang.org/x/oauth2/google#JWTConfigFromJSON\" rel=\"nofollow\">https://godoc.org/golang.org/x/oauth2/google#JWTConfigFromJSON</a></p>\n\n<pre><code>{\n \"error\": {\n  \"errors\": [\n   {\n    \"domain\": \"global\",\n    \"reason\": \"authError\",\n    \"message\": \"Access denied. You are not authorized to read activity records.\"\n,\n    \"locationType\": \"header\",\n    \"location\": \"Authorization\"\n   }\n  ],\n  \"code\": 401,\n  \"message\": \"Access denied. You are not authorized to read activity records.\"\n }\n}\n</code></pre>\n\n<p>I'm pretty sure it is on Google configuration side but :</p>\n\n<ul>\n<li>I created the service account</li>\n<li>I downloaded the JWT</li>\n<li>I authorized the needed scopes</li>\n</ul>\n\n<p>Then I try to call this URL : <a href=\"https://www.googleapis.com/admin/reports/v1/activity/users/all/applications/login\" rel=\"nofollow\">https://www.googleapis.com/admin/reports/v1/activity/users/all/applications/login</a></p>\n\n<p>What could I have forget ?</p>\n\n<p>Thanks for helping me.</p>\n"}, {"tags": ["windows", "go", "filepath"], "answers": [{"comments": [{"owner": {"reputation": 307, "user_id": 1864805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0393fcefefad7c5a1ce9434a2897a79?s=128&d=identicon&r=PG", "display_name": "Konoha", "link": "https://stackoverflow.com/users/1864805/konoha"}, "edited": false, "score": 0, "creation_date": 1445003726, "post_id": 33172067, "comment_id": 54151977, "body": "This makes complete sense. A rookie mistake. Thankyou for pointing it out. I need to learn more about error handling in Go."}], "tags": [], "owner": {"reputation": 149903, "user_id": 14637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1904e7096278a10f1dfb3fdc0ceb53cc?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/14637/thomas"}, "is_accepted": true, "score": 4, "last_activity_date": 1445003084, "creation_date": 1445003084, "answer_id": 33172067, "question_id": 33171991, "link": "https://stackoverflow.com/questions/33171991/filepath-walk-in-go-not-picking-up-folders-under-c-drive-properly-in-windows/33172067#33172067", "title": "Filepath.Walk in Go not picking up folders under C: drive properly in Windows", "body": "<p>You're blindly returning errors without logging them. Returning a non-<code>nil</code> error from the callback is a signal for <code>filepath.Walk</code> to abort.</p>\n\n<p>Presumably there is some file you don't have access to, or something.</p>\n"}, {"tags": [], "owner": {"reputation": 4018, "user_id": 2252889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H31dX.jpg?s=128&g=1", "display_name": "Mike Precup", "link": "https://stackoverflow.com/users/2252889/mike-precup"}, "is_accepted": false, "score": 1, "last_activity_date": 1445003179, "creation_date": 1445003179, "answer_id": 33172099, "question_id": 33171991, "link": "https://stackoverflow.com/questions/33171991/filepath-walk-in-go-not-picking-up-folders-under-c-drive-properly-in-windows/33172099#33172099", "title": "Filepath.Walk in Go not picking up folders under C: drive properly in Windows", "body": "<p>You're returning an error, so it stops walking the paths. As <a href=\"https://golang.org/pkg/path/filepath/#WalkFunc\" rel=\"nofollow\">the spec</a> states, whenever an error is returned (besides one special case), processing stops. If you'd like to continue processing and ignore the error, just <code>return nil</code> instead.</p>\n\n<p>Running it on my machine gives me an <code>Access is denied</code> error on one file, which then nukes the walk. The reason is only sees <code>$Recycle.Bin</code> is because it happens to be the first folder in the directory, and the walk is killed before it can get to any others.</p>\n"}], "owner": {"reputation": 307, "user_id": 1864805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0393fcefefad7c5a1ce9434a2897a79?s=128&d=identicon&r=PG", "display_name": "Konoha", "link": "https://stackoverflow.com/users/1864805/konoha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 489, "favorite_count": 0, "accepted_answer_id": 33172067, "answer_count": 2, "score": 0, "last_activity_date": 1445004236, "creation_date": 1445002824, "last_edit_date": 1445004236, "question_id": 33171991, "link": "https://stackoverflow.com/questions/33171991/filepath-walk-in-go-not-picking-up-folders-under-c-drive-properly-in-windows", "title": "Filepath.Walk in Go not picking up folders under C: drive properly in Windows", "body": "<p>I am using the Filepath.Walk in Go to try to get all the folders under C: recursively. However it just returns me sub-folders starting with $Recycle.Bin. What am I doing wrong here?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"path/filepath\"\n    \"os\"\n)\n\nfunc main() {\n    array := Subfolders(\"C:\")\n    for _,value := range array {\n        fmt.Println(value)\n    }\n}\n\nfunc Subfolders(path string) (paths []string) {\n    filepath.Walk(path, func(newPath string, info os.FileInfo, err error) error {\n        if err != nil {\n            return err\n        }\n        if info.IsDir() {\n            paths = append(paths, newPath)\n        }\n        return nil\n    })  \n    return paths\n}\n\nOutput:\nC:\nC:\\$Recycle.Bin\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$R0L9M20\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$R22ZOD9\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$R3LS9P4\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$R4T2IGU\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$R8TZIET\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$R9QQZB9\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$RA71HY3\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$RBOC0V4.com\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$RBOC0V4.com\\go-fsnotify\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$REJFS3Z\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$RF9A1Y6\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$ROMESWQ\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$RP4CYID\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$RQHMPV5\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$RV0K99H\nC:\\$Recycle.Bin\\S-1-5-21-310629982-3373693989-3733510080-1000\\$RX54T04\n</code></pre>\n\n<p>I have many other folders under C: which donot get picked up by the filepath.walk. I wanted to understand what was the reason behind it.</p>\n\n<p>EDIT</p>\n\n<hr>\n\n<p>Thanks to the answers I was able to resolve the issue as below:-</p>\n\n<pre><code>func Subfolders(path string) (paths []string) {\n    filepath.Walk(path, func(newPath string, info os.FileInfo, err error) error {\n        if err != nil {\n            log.Println(err)\n            return filepath.SkipDir\n        }\n\n        if info.IsDir() {\n            paths = append(paths, newPath)\n        }\n        return nil\n    })\n</code></pre>\n"}, {"tags": ["sql", "postgresql", "go"], "answers": [{"tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": true, "score": 2, "last_activity_date": 1445002088, "creation_date": 1445002088, "answer_id": 33171739, "question_id": 33171661, "link": "https://stackoverflow.com/questions/33171661/go-build-error-rows-columns-undefined-type-sql-row-has-no-field-or-method-col/33171739#33171739", "title": "go build error &quot;rows.Columns undefined (type *sql.Row has no field or method Columns)&quot;", "body": "<p><a href=\"https://golang.org/pkg/database/sql/#DB.QueryRow\" rel=\"nofollow\"><code>QueryRow</code></a> returns a single <a href=\"https://golang.org/pkg/database/sql/#Row\" rel=\"nofollow\"><code>*sql.Row</code></a></p>\n\n<p>What you want is <a href=\"https://golang.org/pkg/database/sql/#DB.Query\" rel=\"nofollow\"><code>Query</code></a>, which will give you <a href=\"https://golang.org/pkg/database/sql/#Rows\" rel=\"nofollow\"><code>*sql.Rows</code></a> which has the methods you are trying to use.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 6176456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7V2sm.jpg?s=128&g=1", "display_name": "Dashen", "link": "https://stackoverflow.com/users/6176456/dashen"}, "is_accepted": false, "score": 1, "last_activity_date": 1530071002, "creation_date": 1530071002, "answer_id": 51054240, "question_id": 33171661, "link": "https://stackoverflow.com/questions/33171661/go-build-error-rows-columns-undefined-type-sql-row-has-no-field-or-method-col/51054240#51054240", "title": "go build error &quot;rows.Columns undefined (type *sql.Row has no field or method Columns)&quot;", "body": "<p>you masked the database/sql package here: sql := `select * from table\nsql is then a string, not the package. Rename the string e.g. to query and it will work</p>\n"}], "owner": {"reputation": 324, "user_id": 3713745, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/dCxa9.jpg?s=128&g=1", "display_name": "Joe Sebin", "link": "https://stackoverflow.com/users/3713745/joe-sebin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3742, "favorite_count": 0, "accepted_answer_id": 33171739, "answer_count": 2, "score": 0, "last_activity_date": 1530071002, "creation_date": 1445001873, "last_edit_date": 1592644375, "question_id": 33171661, "link": "https://stackoverflow.com/questions/33171661/go-build-error-rows-columns-undefined-type-sql-row-has-no-field-or-method-col", "title": "go build error &quot;rows.Columns undefined (type *sql.Row has no field or method Columns)&quot;", "body": "<p>I want to print multiple rows having multiple columns from my postgresql database using golang.while buildng the following code</p>\n<pre><code>package main\n\nimport (\n    &quot;database/sql&quot;\n    &quot;fmt&quot;\n    &quot;github.com/gin-gonic/gin&quot;\n    _ &quot;github.com/lib/pq&quot;\n    &quot;log&quot;\n    &quot;runtime&quot;\n)\n\nfunc main() {\n\n    runtime.GOMAXPROCS(runtime.NumCPU())\n\n    db, err := sql.Open(&quot;postgres&quot;, &quot;dbname=sample_data user=postgres password=postgres sslmode=disable&quot;)\n    defer db.Close()\n    if err != nil {\n        fmt.Println(&quot;error connecting to DB&quot;)\n    }\n    r := gin.Default()\n    r.GET(&quot;/cin_display&quot;, func(c *gin.Context) {\n        rows := db.QueryRow(&quot;SELECT cin FROM companies limit 1;&quot;)\n\n        columns, _ := rows.Columns()\n        count := len(columns)\n        values := make([]interface{}, count)\n        valuePtrs := make([]interface{}, count)\n\n        for rows.Next() {\n\n            for i, _ := range columns {\n                valuePtrs[i] = &amp;values[i]\n            }\n\n            rows.Scan(valuePtrs...)\n\n            for i, col := range columns {\n\n                var v interface{}\n\n                val := values[i]\n\n                b, ok := val.([]byte)\n\n                if ok {\n                    v = string(b)\n                } else {\n                    v = val\n                }\n\n                fmt.Println(col, v)\n            }\n        }\n\n    })\n}\n\nfunc Connect(connectionString string) *sql.DB {\n    db, err := sql.Open(&quot;postgres&quot;, connectionString)\n    if err != nil {\n        log.Fatal(err)\n    }\n    return db\n}\n</code></pre>\n<p>I am getting the errors like</p>\n<blockquote>\n<p>rows.Columns undefined (type *sql.Row has no field or method Columns)</p>\n<p>rows.Next undefined (type *sql.Row has no field or method Next)</p>\n</blockquote>\n<p>how to solve this?</p>\n"}, {"tags": ["go", "escaping", "backslash", "quote"], "answers": [{"tags": [], "owner": {"reputation": 1280, "user_id": 4932403, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uLzID.jpg?s=128&g=1", "display_name": "KeylorSanchez", "link": "https://stackoverflow.com/users/4932403/keylorsanchez"}, "is_accepted": true, "score": 28, "last_activity_date": 1444999069, "creation_date": 1444999069, "answer_id": 33170699, "question_id": 33170566, "link": "https://stackoverflow.com/questions/33170566/golang-escaping-single-quotes/33170699#33170699", "title": "Golang : Escaping single quotes", "body": "<p>You need to ALSO escape the slash in strings.Replace.</p>\n\n<pre><code>str := \"I'm Bob, and I'm 25.\"\nstr = strings.Replace(str, \"'\", \"\\\\'\", -1)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/mZaaNU3FHw\" rel=\"noreferrer\">https://play.golang.org/p/mZaaNU3FHw</a></p>\n"}, {"comments": [{"owner": {"reputation": 4635, "user_id": 1411589, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2a6b1a1c31198db776d76af7f04c1bbd?s=128&d=identicon&r=PG", "display_name": "deepakssn", "link": "https://stackoverflow.com/users/1411589/deepakssn"}, "edited": false, "score": 1, "creation_date": 1495346015, "post_id": 33170845, "comment_id": 75208684, "body": "Even the first string can be in backquote. In my case i had to replace \\&quot; with &quot; in my dbjson variable dbjson = strings.Replace(dbjson, `\\&quot;`, `&quot;`, -1)  This answer helped me to get there :)"}], "tags": [], "owner": {"reputation": 1218, "user_id": 749836, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/HjVtW.jpg?s=128&g=1", "display_name": "coquin", "link": "https://stackoverflow.com/users/749836/coquin"}, "is_accepted": false, "score": 11, "last_activity_date": 1444999528, "creation_date": 1444999528, "answer_id": 33170845, "question_id": 33170566, "link": "https://stackoverflow.com/questions/33170566/golang-escaping-single-quotes/33170845#33170845", "title": "Golang : Escaping single quotes", "body": "<p>+to @KeylorSanchez answer: your can wrap replace string in back-ticks:</p>\n\n<pre><code>strings.Replace(str, \"'\", `\\'`, -1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 10298929, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SGj6e.jpg?s=128&g=1", "display_name": "syyongx", "link": "https://stackoverflow.com/users/10298929/syyongx"}, "is_accepted": false, "score": 0, "last_activity_date": 1535703402, "creation_date": 1535703402, "answer_id": 52111251, "question_id": 33170566, "link": "https://stackoverflow.com/questions/33170566/golang-escaping-single-quotes/52111251#52111251", "title": "Golang : Escaping single quotes", "body": "<pre><code>// addslashes()\nfunc Addslashes(str string) string {\n    var buf bytes.Buffer\n    for _, char := range str {\n        switch char {\n        case '\\'':\n            buf.WriteRune('\\\\')\n        }\n        buf.WriteRune(char)\n    }\n    return buf.String()\n}\n</code></pre>\n\n<p>If you want to escaping single/double quotes or backlash, you can refer to <a href=\"https://github.com/syyongx/php2go\" rel=\"nofollow noreferrer\">https://github.com/syyongx/php2go</a></p>\n"}], "owner": {"reputation": 1640, "user_id": 4273851, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/24f0896e35ca5cf36f0b6b4ec2aeec34?s=128&d=identicon&r=PG&f=1", "display_name": "A.D", "link": "https://stackoverflow.com/users/4273851/a-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43451, "favorite_count": 2, "accepted_answer_id": 33170699, "answer_count": 3, "score": 12, "last_activity_date": 1535703402, "creation_date": 1444998603, "question_id": 33170566, "link": "https://stackoverflow.com/questions/33170566/golang-escaping-single-quotes", "title": "Golang : Escaping single quotes", "body": "<p>Is there a way to escape single quotes in go?</p>\n\n<p>The following:</p>\n\n<pre><code>str := \"I'm Bob, and I'm 25.\"\nstr = strings.Replace(str, \"'\", \"\\'\", -1)\n</code></pre>\n\n<p>Gives the error: unknown escape sequence: '</p>\n\n<p>I would like str to be</p>\n\n<pre><code>\"I\\'m Bob, and I\\'m 25.\"\n</code></pre>\n"}, {"tags": ["go", "amazon-s3"], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 11, "creation_date": 1444994969, "post_id": 33169317, "comment_id": 54146385, "body": "Note that this will only decode JPG images. It would be better to use <a href=\"https://golang.org/pkg/image/#Decode\" rel=\"nofollow noreferrer\"><code>image.Decode()</code></a> which auto-detects the image format. But remember that you need imports for this to work, e.g. <code>import _ &quot;image&#47;png&quot;</code>. See package doc of <a href=\"https://golang.org/pkg/image/\" rel=\"nofollow noreferrer\"><code>image</code></a> for details."}], "tags": [], "owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "is_accepted": false, "score": 3, "last_activity_date": 1444994745, "creation_date": 1444994745, "answer_id": 33169317, "question_id": 33168973, "link": "https://stackoverflow.com/questions/33168973/converting-multipart-file-to-an-image-object-in-golang/33169317#33169317", "title": "Converting multipart file to an image object in golang", "body": "<p>Figured it out, I just needed to use </p>\n\n<p><code>image, err := jpeg.Decode(file)</code></p>\n"}], "owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3365, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1444994745, "creation_date": 1444993584, "question_id": 33168973, "link": "https://stackoverflow.com/questions/33168973/converting-multipart-file-to-an-image-object-in-golang", "title": "Converting multipart file to an image object in golang", "body": "<p>I'm attempting to upload an image, resize it and then upload it to Amazon S3 in go, however I'm struggling to figure out how to convert the image from multipart.File to image.Image</p>\n\n<pre><code>package controllers\n\nimport (\n    \"github.com/gin-gonic/gin\"\n    \"github.com/mitchellh/goamz/aws\"\n    \"github.com/mitchellh/goamz/s3\"\n    \"github.com/nfnt/resize\"\n    _ \"image/jpeg\"\n    \"log\"\n    \"os\"\n    \"strconv\"\n)\n\ntype ResizeController struct {\n}\n\nfunc NewResizeController() *ResizeController {\n    return &amp;ResizeController{}\n}\n\nfunc (rc ResizeController) Resize(c *gin.Context) {\n\n    auth, err := aws.EnvAuth()\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    client := s3.New(auth, aws.EUWest)\n    bucket := client.Bucket(os.Getenv(\"AWS_BUCKET_NAME\"))\n\n    file, header, err := c.Request.FormFile(\"file\")\n    filename := header.Filename\n\n    height := c.Query(\"height\")\n    width := c.Query(\"width\")\n\n    h64, err := strconv.ParseUint(height, 10, 32)\n    w64, err := strconv.ParseUint(width, 10, 32)\n    h := uint(h64)\n    w := uint(w64)\n\n    m := resize.Resize(w, h, file, resize.Lanczos3)\n\n    err = bucket.Put(\"/content/\"+filename, m, \"content-type\", s3.Private)\n\n    c.JSON(200, gin.H{\"filename\": header.Filename})\n}\n</code></pre>\n\n<p>I'm getting the error <code>controllers/resize_controller.go:43: cannot use file (type multipart.File) as type image.Image in argument to resize.Resize:</code> </p>\n"}, {"tags": ["go", "exception-handling", "recover"], "answers": [{"comments": [{"owner": {"reputation": 2679, "user_id": 3081480, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/UVerL.jpg?s=128&g=1", "display_name": "Kyle Chadha", "link": "https://stackoverflow.com/users/3081480/kyle-chadha"}, "edited": false, "score": 0, "creation_date": 1506374137, "post_id": 33167433, "comment_id": 79786485, "body": "I was interested in <b>what would be returned if there were no named return values</b>. Playing with your playground, it looks like it&#39;s the zero value of the type"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2679, "user_id": 3081480, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/UVerL.jpg?s=128&g=1", "display_name": "Kyle Chadha", "link": "https://stackoverflow.com/users/3081480/kyle-chadha"}, "edited": false, "score": 0, "creation_date": 1577344424, "post_id": 33167433, "comment_id": 105145494, "body": "@KyleChadha Yes, if results are unnamed and a <code>return</code> statement is not reached (e.g. due to a panic), the zero values of the result types are returned. This is detailed in <a href=\"https://stackoverflow.com/questions/59461527/why-can-a-normal-return-hide-a-panic-that-a-named-return-correctly-provides-to-t/59461751#59461751\">Why can a normal return hide a panic that a named return correctly provides to the caller?</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 39, "last_activity_date": 1471848277, "last_edit_date": 1471848277, "creation_date": 1444989061, "answer_id": 33167433, "question_id": 33167282, "link": "https://stackoverflow.com/questions/33167282/how-to-return-a-value-in-a-go-function-that-panics/33167433#33167433", "title": "How to return a value in a Go function that panics?", "body": "<p>You can use <a href=\"https://golang.org/ref/spec#Function_types\" rel=\"noreferrer\">named result parameters</a>. Name your return values, and in the deferred function when panic was detected, you can change the values of the return \"variables\". The changed new values will be returned.</p>\n\n<p>Example:</p>\n\n<pre><code>func main() {\n    fmt.Println(\"Returned:\", MyFunc())\n}\n\nfunc MyFunc() (ret string) {\n    defer func() {\n        if r := recover(); r != nil {\n            ret = fmt.Sprintf(\"was panic, recovered value: %v\", r)\n        }\n    }()\n    panic(\"test\")\n    return \"Normal Return Value\"\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/ZOSD2QU6VO\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Returned: was panic, recovered value: test\n</code></pre>\n\n<p>This is mentioned in the <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"noreferrer\"><strong>Spec: Defer statements</strong></a>:</p>\n\n<blockquote>\n  <p>For instance, if the deferred function is a <a href=\"https://golang.org/ref/spec#Function_literals\" rel=\"noreferrer\">function literal</a> and the surrounding function has <a href=\"https://golang.org/ref/spec#Function_types\" rel=\"noreferrer\">named result parameters</a> that are in scope within the literal, the deferred function may access and modify the result parameters before they are returned.</p>\n</blockquote>\n\n<p>It is also mentioned in the blog post <a href=\"https://blog.golang.org/defer-panic-and-recover\" rel=\"noreferrer\"><strong>Defer, Panic and Recover</strong></a>:</p>\n\n<blockquote>\n  <p>Deferred functions may read and assign to the returning function's named return values.</p>\n</blockquote>\n\n<p>And also in <a href=\"https://golang.org/doc/effective_go.html#recover\" rel=\"noreferrer\"><strong>Effective Go: Recover</strong></a>:</p>\n\n<blockquote>\n  <p>If <code>doParse</code> panics, the recovery block will set the return value to <code>nil</code>\u2014deferred functions can modify named return values.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 10868780, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WOv28xJ33iI/AAAAAAAAAAI/AAAAAAAAAHA/crx1LAvpxsQ/photo.jpg?sz=128", "display_name": "Carlos Fuentes", "link": "https://stackoverflow.com/users/10868780/carlos-fuentes"}, "is_accepted": false, "score": 2, "last_activity_date": 1557434326, "creation_date": 1557434326, "answer_id": 56067237, "question_id": 33167282, "link": "https://stackoverflow.com/questions/33167282/how-to-return-a-value-in-a-go-function-that-panics/56067237#56067237", "title": "How to return a value in a Go function that panics?", "body": "<p>Using the example in icza's answer, and if you wonder what happens <strong>if you recover from the panic but don't assign the value for the named return</strong>, like this:</p>\n\n<pre><code>func main() {\n    fmt.Println(\"Returned:\", MyFunc()) // false\n}\n\nfunc MyFunc() (ret bool) {\n    defer func() {\n        if r := recover(); r != nil {\n        }\n    }()\n    panic(\"test\")\n    return true\n}\n</code></pre>\n\n<p>The function <strong>will return the zero value</strong> of the specified return type.</p>\n\n<p>Run the example in the <a href=\"https://play.golang.org/p/13s9ty45cL6\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}], "owner": {"reputation": 13457, "user_id": 954376, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/08PZK.jpg?s=128&g=1", "display_name": "NeoWang", "link": "https://stackoverflow.com/users/954376/neowang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5047, "favorite_count": 4, "accepted_answer_id": 33167433, "answer_count": 2, "score": 12, "last_activity_date": 1557434326, "creation_date": 1444988715, "question_id": 33167282, "link": "https://stackoverflow.com/questions/33167282/how-to-return-a-value-in-a-go-function-that-panics", "title": "How to return a value in a Go function that panics?", "body": "<p>My Go function is expected to return a value, but it may panic when calling a library function. I can use <code>recover()</code> to capture this in a deferred call, but how can I return a value in this case?</p>\n\n<pre><code>func MyFunc() string{\n    defer func() {\n        if err := recover(); err != nil {\n            // What do I do to make MyFunc() return a value in case of panic?\n        }\n    }()\n    SomeFuncThatMayPanic()\n    return \"Normal Return Value\"\n    // How can I return \"ERROR\" in case of panic?\n}\n</code></pre>\n"}, {"tags": ["go", "nodes", "kubernetes"], "answers": [{"tags": [], "owner": {"reputation": 3921, "user_id": 5446771, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-5k4DhEqhqPU/AAAAAAAAAAI/AAAAAAAAAF0/6_hv0_g57tM/photo.jpg?sz=128", "display_name": "Prashanth B", "link": "https://stackoverflow.com/users/5446771/prashanth-b"}, "is_accepted": false, "score": 0, "last_activity_date": 1601123679, "last_edit_date": 1601123679, "creation_date": 1445021654, "answer_id": 33177703, "question_id": 33167023, "link": "https://stackoverflow.com/questions/33167023/kubernetes-go-client-used-storage-of-nodes-and-cluster/33177703#33177703", "title": "kubernetes go client used storage of nodes and cluster", "body": "<p>This is actually 2 problems:</p>\n<ol>\n<li><p>How do I perform http requests to the Kubernetes master?<br />\nSee [1] for more details. Tl;dr you can access the apiserver in at least 3 ways:<br />\na. <code>kubectl get nodes</code> (not go)<br />\nb. <code>kubectl proxy</code>, followed by a go http client to this url<br />\nc. Running a pod in a kubernetes cluster</p>\n</li>\n<li><p>What are the requests I need to do to get node stats?<br />\na. Run <code>kubectl describe node</code>, it should show you resource information.<br />\nb. Now run <code>kubectl describe node --v=7</code>, it should show you the REST calls.</p>\n</li>\n</ol>\n<p>I also think you should reformat the title of your question per <a href=\"https://stackoverflow.com/help/how-to-ask\">https://stackoverflow.com/help/how-to-ask</a>, so it reflects what you're really asking.</p>\n<p>[1] <a href=\"https://github.com/kubernetes/kubernetes/blob/release-1.0/docs/user-guide/accessing-the-cluster.md\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/kubernetes/blob/release-1.0/docs/user-guide/accessing-the-cluster.md</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4410009"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1601123679, "creation_date": 1444987988, "question_id": 33167023, "link": "https://stackoverflow.com/questions/33167023/kubernetes-go-client-used-storage-of-nodes-and-cluster", "title": "kubernetes go client used storage of nodes and cluster", "body": "<p>I am newbie in Go. I want to get the storage statistics of nodes and cluster in kubernetes using Go code. How i can get the free and used storage of Kubernetes nodes and cluster using Go.</p>\n"}, {"tags": ["ssh", "go", "xterm"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1444991614, "post_id": 33166867, "comment_id": 54144373, "body": "Have <code>ls</code> not output colors: <code>ls --color=never</code>?"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1444992618, "post_id": 33166867, "comment_id": 54144991, "body": "Take a look at <a href=\"https://godoc.org/golang.org/x/crypto/ssh/terminal#Terminal\" rel=\"nofollow noreferrer\"><code>terminal.Terminal</code></a>&#39;s <code>Escape</code> field and  <a href=\"https://github.com/golang/crypto/blob/master/ssh/terminal/terminal.go#L24\" rel=\"nofollow noreferrer\"><code>vt100EscapeCodes</code></a>. That might be a solution."}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 3, "creation_date": 1444996346, "post_id": 33166867, "comment_id": 54147208, "body": "You&#39;re claiming to be an <code>xterm</code> (which supports colour).  Perhaps pick a different terminal type?"}, {"owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1445215355, "post_id": 33166867, "comment_id": 54214639, "body": "Whether color codes are sent by the server depend on two factors: the terminal ID set in <code>RequestPty</code> and how it&#39;s interpreted (or not) on the server. i.e. if you have, on the server, a shell init script that sets up <code>ls</code> to output colors regardless of <code>$TERM</code>, changing the terminal ID won&#39;t change a thing (oh, yes, <code>$TERM</code> on the server is initialized with the term ID that you pass in <code>RequestPty</code>). So unless you really want something interactive, I&#39;d go for @Volker&#39;s solution."}], "answers": [{"comments": [{"owner": {"reputation": 42737, "user_id": 4518274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UPurS.png?s=128&g=1", "display_name": "Thomas Dickey", "link": "https://stackoverflow.com/users/4518274/thomas-dickey"}, "edited": false, "score": 0, "creation_date": 1445037621, "post_id": 33175546, "comment_id": 54168985, "body": "Maybe/maybe not: <a href=\"https://godoc.org/golang.org/x/crypto/ssh/terminal#NewTerminal\" rel=\"nofollow noreferrer\">NewTerminal</a> does not appear to care what type is passed in, and looking for examples of use for <code>RequestPty</code> I find nothing useful."}, {"owner": {"reputation": 56, "user_id": 5331511, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153170441971818/picture?type=large", "display_name": "Gregory Man", "link": "https://stackoverflow.com/users/5331511/gregory-man"}, "reply_to_user": {"reputation": 42737, "user_id": 4518274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UPurS.png?s=128&g=1", "display_name": "Thomas Dickey", "link": "https://stackoverflow.com/users/4518274/thomas-dickey"}, "edited": false, "score": 0, "creation_date": 1445074513, "post_id": 33175546, "comment_id": 54176201, "body": "You don&#39;t need to use <code>NewTerminal</code> to execute commands using ssh. Example: <a href=\"https://play.golang.org/p/0q0Yu_8vpE\" rel=\"nofollow noreferrer\">play.golang.org/p/0q0Yu_8vpE</a>"}, {"owner": {"reputation": 42737, "user_id": 4518274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UPurS.png?s=128&g=1", "display_name": "Thomas Dickey", "link": "https://stackoverflow.com/users/4518274/thomas-dickey"}, "edited": false, "score": 1, "creation_date": 1445079081, "post_id": 33175546, "comment_id": 54177373, "body": "That isn&#39;t useful to me.  What would be useful would be showing how the &quot;vt220&quot; gets passed to the other side of the pty and is <i>used</i>.  Lacking that, I cannot distinguish between your answer and others."}], "tags": [], "owner": {"reputation": 56, "user_id": 5331511, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153170441971818/picture?type=large", "display_name": "Gregory Man", "link": "https://stackoverflow.com/users/5331511/gregory-man"}, "is_accepted": false, "score": 0, "last_activity_date": 1445037163, "last_edit_date": 1445037163, "creation_date": 1445013795, "answer_id": 33175546, "question_id": 33166867, "link": "https://stackoverflow.com/questions/33166867/how-to-remove-the-color-code-in-golang-ssh-client/33175546#33175546", "title": "How to remove the color code in golang ssh client", "body": "<p>Use <a href=\"https://godoc.org/golang.org/x/crypto/ssh#Session.RequestPty\" rel=\"nofollow\">session.RequestPty</a> with \"vt220\" terminal type</p>\n\n<p>example: \n  session.RequestPty(\"vt220\", 80, 40, modes)</p>\n"}], "owner": {"reputation": 69, "user_id": 5450078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0fdc9bb0e236ae2b03b3d33ca977385a?s=128&d=identicon&r=PG&f=1", "display_name": "ddaddca", "link": "https://stackoverflow.com/users/5450078/ddaddca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 892, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1445037163, "creation_date": 1444987572, "question_id": 33166867, "link": "https://stackoverflow.com/questions/33166867/how-to-remove-the-color-code-in-golang-ssh-client", "title": "How to remove the color code in golang ssh client", "body": "<p>I am using golang ssh package to build a ssh client, I set the terminal modes as below</p>\n\n<pre><code>// Set up terminal modes\nmodes := ssh.TerminalModes{\n    ssh.ECHO:          0,     // disable echoing\n    ssh.TTY_OP_ISPEED: 14400, // input speed = 14.4kbaud\n    ssh.TTY_OP_OSPEED: 14400, // output speed = 14.4kbaud\n}\n\n// Request pseudo terminal\nif err := session.RequestPty(\"xterm\", 80, 40, modes); err != nil {\n    log.Fatalf(\"request for pseudo terminal failed: %s\", err)\n}\n</code></pre>\n\n<p>it works fine, but a tiny problem, when I use \"ls\" command, it returns the names with color code, like below</p>\n\n<pre><code>[root@localhost ~]# ls\nls\nanaconda-ks.cfg    [0m[01;34mpeter[0m\n[01;32mbuild.sh[0m           [01;34mredis64[0m\n</code></pre>\n\n<p>it makes me feel difficult to read the file names, so is there any method to remove the color code around the names? \nthanks</p>\n"}, {"tags": ["multithreading", "go", "subprocess", "goroutine", "sigint"], "answers": [{"comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 2, "creation_date": 1465844875, "post_id": 33171307, "comment_id": 63060771, "body": "This doesn&#39;t work for windows as there is no <code>Setpgid</code> in <code>SysProcAttr</code> under windows. Any alternatives?"}, {"owner": {"reputation": 4199, "user_id": 346335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4481fa93eb8710047ed4e11a3ac533c8?s=128&d=identicon&r=PG", "display_name": "alastair", "link": "https://stackoverflow.com/users/346335/alastair"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1579854238, "post_id": 33171307, "comment_id": 105913011, "body": "@tkausl Yes. On Windows you need to set <code>CreationFlags</code> in the <code>syscall.SysProcAttr</code> to <code>syscall.CREATE_NEW_PROCESS_GROUP</code>."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 12, "last_activity_date": 1455633998, "last_edit_date": 1455633998, "creation_date": 1445000832, "answer_id": 33171307, "question_id": 33165530, "link": "https://stackoverflow.com/questions/33165530/prevent-ctrlc-from-interrupting-exec-command-in-golang/33171307#33171307", "title": "Prevent Ctrl+C from interrupting exec.Command in Golang", "body": "<p>The shell will signal the entire process group when you press <code>ctrl+c</code>. If you signal the parent process directly, the child process won't receive the signal.</p>\n\n<p>To prevent the shell from signaling the children, you need to start the command in its own process group with with the <code>Setpgid</code> and <code>Pgid</code> fields in <a href=\"https://golang.org/pkg/syscall/#SysProcAttr\" rel=\"noreferrer\"><code>syscall.SysProcAttr</code></a> before starting the processes</p>\n\n<pre><code>cmd := exec.Command(\"sleep\", \"60\")\ncmd.SysProcAttr = &amp;syscall.SysProcAttr{\n    Setpgid: true,\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2071, "user_id": 427640, "user_type": "registered", "accept_rate": 7, "profile_image": "https://www.gravatar.com/avatar/d4d4b63465bfebec10aa1cc13b4085df?s=128&d=identicon&r=PG", "display_name": "ideawu", "link": "https://stackoverflow.com/users/427640/ideawu"}, "edited": false, "score": 1, "creation_date": 1582724440, "post_id": 44189843, "comment_id": 106875558, "body": "import(&quot;os/signal&quot; &quot;syscall&quot;)"}, {"owner": {"reputation": 195, "user_id": 9316533, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JBbUC.jpg?s=128&g=1", "display_name": "Nikolay Edigaryev", "link": "https://stackoverflow.com/users/9316533/nikolay-edigaryev"}, "edited": false, "score": 0, "creation_date": 1612990859, "post_id": 44189843, "comment_id": 116941999, "body": "This only works because the child (in this case <code>sleep</code>) inherits parent&#39;s signal dispositions. The signal is still delivered and this might fail if the target application restores default signal behavior with e.g. <code>signal(SIGINT, SIG_DFL)</code> or sets it&#39;s own signal handler."}], "tags": [], "owner": {"reputation": 415, "user_id": 7844239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f4592b2e5235c0a47eb851d1a58d942?s=128&d=identicon&r=PG&f=1", "display_name": "J Aamish", "link": "https://stackoverflow.com/users/7844239/j-aamish"}, "is_accepted": false, "score": 0, "last_activity_date": 1495746442, "creation_date": 1495746442, "answer_id": 44189843, "question_id": 33165530, "link": "https://stackoverflow.com/questions/33165530/prevent-ctrlc-from-interrupting-exec-command-in-golang/44189843#44189843", "title": "Prevent Ctrl+C from interrupting exec.Command in Golang", "body": "<p>You can ignore the <code>syscall.SIGINT</code> signal, then it won't be passed to the <code>exec.Command</code>.</p>\n\n<pre><code>func main() {\n    var doneChannel = make(chan bool)\n\n    signal.Ignore(syscall.SIGINT)\n\n    go func() {\n        log.Println(\"Sleep start\")\n        cmd := exec.Command(\"sleep\", \"10\")\n        cmd.Run()\n        log.Println(\"Sleep stop\")\n        doneChannel &lt;- true\n    }()\n\n    &lt;-doneChannel\n}\n</code></pre>\n"}], "owner": {"reputation": 78861, "user_id": 561309, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/6d833d9f0ffa2265a01359ccecd26d54?s=128&d=identicon&r=PG&f=1", "display_name": "laurent", "link": "https://stackoverflow.com/users/561309/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2857, "favorite_count": 0, "accepted_answer_id": 33171307, "answer_count": 2, "score": 7, "last_activity_date": 1495746442, "creation_date": 1444983102, "question_id": 33165530, "link": "https://stackoverflow.com/questions/33165530/prevent-ctrlc-from-interrupting-exec-command-in-golang", "title": "Prevent Ctrl+C from interrupting exec.Command in Golang", "body": "<p>I've noticed that processes started with <code>exec.Command</code> get interrupted even when the interrupt call has been intercepted via <code>signal.Notify</code>. I've done the following example to show the issue:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"os/exec\"\n    \"os/signal\"\n    \"syscall\"\n)\n\nfunc sleep() {\n    log.Println(\"Sleep start\")\n    cmd := exec.Command(\"sleep\", \"60\")\n    cmd.Run()\n    log.Println(\"Sleep stop\")\n}\n\nfunc main() {\n    var doneChannel = make(chan bool)\n\n    go sleep()\n\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, os.Interrupt)\n    signal.Notify(c, syscall.SIGTERM)\n    go func() {\n        &lt;-c\n        log.Println(\"Receved Ctrl + C\")\n    }()\n\n    &lt;-doneChannel\n}\n</code></pre>\n\n<p>If Ctrl+C is pressed while this program is running, it's going to print:</p>\n\n<pre><code>2015/10/16 10:05:50 Sleep start\n^C2015/10/16 10:05:52 Receved Ctrl + C\n2015/10/16 10:05:52 Sleep stop\n</code></pre>\n\n<p>showing that the <code>sleep</code> commands gets interrupted. Ctrl+C is successfully caught though and the main program doesn't quit, it's just the <code>sleep</code> commands that gets affected.</p>\n\n<p>Any idea how to prevent this from happening?</p>\n"}, {"tags": ["post", "go", "http-post"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 3, "creation_date": 1444980491, "post_id": 33164564, "comment_id": 54138115, "body": "are you sending your request with the right content type? it should be <code>application&#47;x-www-form-urlencoded</code>"}, {"owner": {"reputation": 5621, "user_id": 1472186, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1d558e820c0bf111894a0f7bff6611cb?s=128&d=identicon&r=PG", "display_name": "paradite", "link": "https://stackoverflow.com/users/1472186/paradite"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1444981397, "post_id": 33164564, "comment_id": 54138578, "body": "@Not_a_Golfer thanks. that solved the issue. wonder why it was not mentioned here: <a href=\"http://stackoverflow.com/a/23797348/1472186\">stackoverflow.com/a/23797348/1472186</a>"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1444989205, "post_id": 33164564, "comment_id": 54142884, "body": "rephrasing as an answer then"}], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 1893018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8235aef8be1151b359b8f1138d3945c8?s=128&d=identicon&r=PG", "display_name": "Federico Leon", "link": "https://stackoverflow.com/users/1893018/federico-leon"}, "edited": false, "score": 0, "creation_date": 1493324052, "post_id": 33167507, "comment_id": 74381147, "body": "Same thing when you&#39;re working with XML / JSON. If your request is sending json always set the header <code>Content-Type: application&#47;json</code>. Same for XML. Its a very good practice, (and sometimes mandatory), to configure the request according to its content to avoid backends the need to &quot;guess&quot; what&#39;s processing."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 16, "last_activity_date": 1444989276, "creation_date": 1444989276, "answer_id": 33167507, "question_id": 33164564, "link": "https://stackoverflow.com/questions/33164564/golang-parse-post-request/33167507#33167507", "title": "golang parse POST request", "body": "<p>The problem is not in your server code which is fine, but simply that your client, whatever it is, is missing the correct <code>Content-Type</code> header for POST forms. Simply set the header to </p>\n\n<pre><code>Content-Type: application/x-www-form-urlencoded\n</code></pre>\n\n<p>In your client.</p>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 5408944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/esg6W.jpg?s=128&g=1", "display_name": "yaziedda", "link": "https://stackoverflow.com/users/5408944/yaziedda"}, "is_accepted": false, "score": 4, "last_activity_date": 1476270987, "last_edit_date": 1476270987, "creation_date": 1476270611, "answer_id": 39997112, "question_id": 33164564, "link": "https://stackoverflow.com/questions/33164564/golang-parse-post-request/39997112#39997112", "title": "golang parse POST request", "body": "<blockquote>\n  <p>Get value form your params use PostFormValue(\"params\") from your http.Request</p>\n</blockquote>\n\n<pre><code>err := r.ParseForm() \nif err != nil{\n       panic(err)\n}\n\nparams := r.PostFormValue(\"params\") // to get params value with key\n</code></pre>\n"}], "owner": {"reputation": 5621, "user_id": 1472186, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1d558e820c0bf111894a0f7bff6611cb?s=128&d=identicon&r=PG", "display_name": "paradite", "link": "https://stackoverflow.com/users/1472186/paradite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15439, "favorite_count": 2, "accepted_answer_id": 33167507, "answer_count": 2, "score": 10, "last_activity_date": 1476270987, "creation_date": 1444979671, "question_id": 33164564, "link": "https://stackoverflow.com/questions/33164564/golang-parse-post-request", "title": "golang parse POST request", "body": "<p>I have a HTTP POST request with payload</p>\n\n<pre><code>indices=0%2C1%2C2\n</code></pre>\n\n<p>Here is my golang backend code</p>\n\n<pre><code>err := r.ParseForm()\nif err != nil {\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n    return\n}\nlog.Println(\"r.PostForm\", r.PostForm)\nlog.Println(\"r.Form\", r.Form)\n\nbody, err := ioutil.ReadAll(r.Body)\nif err != nil {\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n    return\n}\nlog.Println(\"r.Body\", string(body))\n\nvalues, err := url.ParseQuery(string(body))\nif err != nil {\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n    return\n}\nlog.Println(\"indices from body\", values.Get(\"indices\"))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>r.PostForm map[]\nr.Form map[]\nr.Body indices=0%2C1%2C2\nindices from body 0,1,2\n</code></pre>\n\n<p>Why is it that the POST request is not parsed by <code>r.ParseForm()</code>, while manaully parsing it with <code>url.ParseQuery(string(body))</code> gives the correct result?</p>\n"}, {"tags": ["go", "websocket", "go-echo"], "comments": [{"owner": {"reputation": 4452, "user_id": 2354099, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/7f136983231a6281fcb14761ef972fa0?s=128&d=identicon&r=PG", "display_name": "pinkpanther", "link": "https://stackoverflow.com/users/2354099/pinkpanther"}, "edited": false, "score": 0, "creation_date": 1589668974, "post_id": 33162687, "comment_id": 109386570, "body": "You better off using some form of publish subscribe."}], "answers": [{"comments": [{"owner": {"reputation": 1350, "user_id": 3200803, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/1325785612/picture?type=large", "display_name": "asubanovsky", "link": "https://stackoverflow.com/users/3200803/asubanovsky"}, "edited": false, "score": 0, "creation_date": 1444977156, "post_id": 33163851, "comment_id": 54136485, "body": "Thanks a lot, Hector. I got this working like a charm."}], "tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": true, "score": 5, "last_activity_date": 1444976817, "creation_date": 1444976817, "answer_id": 33163851, "question_id": 33162687, "link": "https://stackoverflow.com/questions/33162687/websocket-send-all-clients-a-message-in-echo-framework/33163851#33163851", "title": "Websocket send all clients a message in Echo Framework", "body": "<p>You indeed need to follow the same principle of connection pool.</p>\n\n<p>Here is the Echo example, with a very basic implementation of a pool:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"sync\"\n\n    \"github.com/labstack/echo\"\n    mw \"github.com/labstack/echo/middleware\"\n    \"golang.org/x/net/websocket\"\n)\n\nvar connectionPool = struct {\n    sync.RWMutex\n    connections map[*websocket.Conn]struct{}\n}{\n    connections: make(map[*websocket.Conn]struct{}),\n}\n\nfunc main() {\n    e := echo.New()\n\n    e.Use(mw.Logger())\n    e.Use(mw.Recover())\n\n    e.Static(\"/\", \"public\")\n    e.WebSocket(\"/ws\", func(c *echo.Context) (err error) {\n        ws := c.Socket()\n\n        connectionPool.Lock()\n        connectionPool.connections[ws] = struct{}{}\n\n        defer func(connection *websocket.Conn){\n            connectionPool.Lock()\n            delete(connectionPool.connections, connection)\n            connectionPool.Unlock()\n        }(ws)\n\n        connectionPool.Unlock()\n\n        msg := \"\"\n\n        for {\n            if err = websocket.Message.Receive(ws, &amp;msg); err != nil {\n                return err\n            }\n            err = sendMessageToAllPool(msg)\n            if err != nil {\n                return err\n            }\n            fmt.Println(msg)\n        }\n        return err\n    })\n\n    e.Run(\":1323\")\n}\n\nfunc sendMessageToAllPool(message string) error {\n    connectionPool.RLock()\n    defer connectionPool.RUnlock()\n    for connection := range connectionPool.connections {\n        if err := websocket.Message.Send(connection, message); err != nil {\n            return err\n        }\n    }\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 1350, "user_id": 3200803, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/1325785612/picture?type=large", "display_name": "asubanovsky", "link": "https://stackoverflow.com/users/3200803/asubanovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2421, "favorite_count": 0, "accepted_answer_id": 33163851, "answer_count": 1, "score": 4, "last_activity_date": 1521026956, "creation_date": 1444970480, "last_edit_date": 1521026956, "question_id": 33162687, "link": "https://stackoverflow.com/questions/33162687/websocket-send-all-clients-a-message-in-echo-framework", "title": "Websocket send all clients a message in Echo Framework", "body": "<p>I believe that this question is almost the same with <a href=\"https://stackoverflow.com/questions/31532652/go-websocket-send-all-clients-a-message\">this.</a></p>\n\n<p>But I use websocket in Echo framework instead of Gorilla. So I think the approach will be different.</p>\n\n<p>Echo does provide the <a href=\"http://labstack.com/echo/recipes/websocket\" rel=\"nofollow noreferrer\">example.</a> But it only shows how to connect with single client. When there are more than one client, the other clients don't receive message from server. </p>\n\n<p>How do I make the server broadcasts message to all connected clients?</p>\n\n<p>The accepted answer from referred link says that I have to use connection pool to broadcast messages to all connections. How can I do this in Echo framework?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1444973796, "post_id": 33162487, "comment_id": 54135116, "body": "While this is simpler than the other solution, it should be noted that this will not strip the <code>&#39;\\r&#39;</code> character if newline happens to be <code>&quot;\\r\\n&quot;</code> (might be the case if the string was read from a file that was edited on Windows). <code>Scanner</code> properly handles all valid variations of new-line characters."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1445002821, "post_id": 33162487, "comment_id": 54151367, "body": "@icza There is no need to strip <code>\\r</code>.  <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">Return characters (<code>\\r</code>) are discarded from raw string values</a>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1445003674, "post_id": 33162487, "comment_id": 54151939, "body": "I&#39;m not talking about raw string literals, I&#39;m talking about a file edited on Windows (where line terminators are <code>&quot;\\r\\n&quot;</code>), if this file is read e.g. with <code>ioutil.ReadFile()</code>, it will contain <code>&#39;\\r&#39;</code> chars too. Also <code>&#39;\\r&#39;</code> chars are not removed from non-raw string literals."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1445006986, "post_id": 33162487, "comment_id": 54154216, "body": "@icza I assumed that OP is asking how to iterate over lines in a string literal as presented in the question. Answer updated to clarify this assumption."}, {"owner": {"reputation": 792, "user_id": 3729597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xOwN9.jpg?s=128&g=1", "display_name": "lyang", "link": "https://stackoverflow.com/users/3729597/lyang"}, "edited": false, "score": 0, "creation_date": 1491535218, "post_id": 33162487, "comment_id": 73606732, "body": "Notice that if the string ends with a new line character, this way will generate 4 lines, while the answer from Ben Campbell will generate three lines."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 18, "last_activity_date": 1491538520, "last_edit_date": 1491538520, "creation_date": 1444968994, "answer_id": 33162487, "question_id": 33162449, "link": "https://stackoverflow.com/questions/33162449/iterate-over-multiline-string-in-go/33162487#33162487", "title": "Iterate over multiline string in Go", "body": "<p>If you want to iterate over a multiline string literal as shown in the question, then use this code:</p>\n\n<pre><code>for _, line := range strings.Split(strings.TrimSuffix(x, \"\\n\"), \"\\n\") {\n    fmt.Println(line)\n}\n</code></pre>\n\n<p><kbd><a href=\"https://play.golang.org/p/8TVPHhvIPV\" rel=\"noreferrer\">Run the code on the playground</a></kbd></p>\n\n<p>If you want to iterate over data read from a file, use <a href=\"https://godoc.org/bufio#Scanner\" rel=\"noreferrer\">bufio.Scanner</a>. The documentation has an example showing how to iterate over lines:</p>\n\n<pre><code>scanner := bufio.NewScanner(f) // f is the *os.File\nfor scanner.Scan() {\n    fmt.Println(scanner.Text()) // Println will add back the final '\\n'\n}\nif err := scanner.Err(); err != nil {\n   // handle error\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 6, "creation_date": 1444970241, "post_id": 33162587, "comment_id": 54133948, "body": "You should check for errors. See the <code>bufio</code> example: <a href=\"https://golang.org/pkg/bufio/#example_Scanner_lines\" rel=\"nofollow noreferrer\">golang.org/pkg/bufio/#example_Scanner_lines</a>."}], "tags": [], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "is_accepted": true, "score": 27, "last_activity_date": 1445015699, "last_edit_date": 1445015699, "creation_date": 1444969803, "answer_id": 33162587, "question_id": 33162449, "link": "https://stackoverflow.com/questions/33162449/iterate-over-multiline-string-in-go/33162587#33162587", "title": "Iterate over multiline string in Go", "body": "<p>You can use <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"noreferrer\"><code>bufio.Scanner</code></a> in Go which iterates over lines from an <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"noreferrer\"><code>io.Reader</code></a>. The following example creates a reader from the given multiline string and passes it to the scanner factory function. Each invocation of <a href=\"https://golang.org/pkg/bufio/#Scanner.Scan\" rel=\"noreferrer\"><code>scanner.Scan()</code></a> splits the reader on the next line and buffers the line. If there is no more lines it returns false. Calling <a href=\"https://golang.org/pkg/bufio/#Scanner.Text\" rel=\"noreferrer\"><code>scanner.Text()</code></a> returns the buffered split. </p>\n\n<pre><code>var x string = `this is\nmy multiline\nstring`\n\nscanner := bufio.NewScanner(strings.NewReader(x))\nfor scanner.Scan() {\n    fmt.Println(scanner.Text())\n}\n</code></pre>\n\n<p>In the example, the for loop will continue until <code>Scan()</code> returns false at the end of the multiline string. In each loop we print the line returned by the scan. </p>\n\n<p><a href=\"https://play.golang.org/p/U9_B4TsH6M\" rel=\"noreferrer\">https://play.golang.org/p/U9_B4TsH6M</a></p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1618234330, "creation_date": 1618234330, "answer_id": 67059346, "question_id": 33162449, "link": "https://stackoverflow.com/questions/33162449/iterate-over-multiline-string-in-go/67059346#67059346", "title": "Iterate over multiline string in Go", "body": "<p>I think using <code>bufio</code> is the best option, but if you do need to just split a\nstring, I think <code>TrimRight</code> is better than <code>TrimSuffix</code>, as it could cover any\ncombination of repeated trailing newlines or carriage returns:</p>\n<pre><code>package main\nimport &quot;strings&quot;\n\nfunc main() {\n   x := `this is\nmy multiline\nstring!\n`\n   for _, line := range strings.Split(strings.TrimRight(x, &quot;\\n&quot;), &quot;\\n&quot;) {\n      println(line)\n   }\n}\n</code></pre>\n<p><a href=\"https://golang.org/pkg/strings#TrimRight\" rel=\"nofollow noreferrer\">https://golang.org/pkg/strings#TrimRight</a></p>\n"}], "owner": {"reputation": 18219, "user_id": 627492, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a65ecbb7d583a75511cff7d78dd7d6e7?s=128&d=identicon&r=PG", "display_name": "Duke Dougal", "link": "https://stackoverflow.com/users/627492/duke-dougal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 20637, "favorite_count": 3, "accepted_answer_id": 33162587, "answer_count": 3, "score": 18, "last_activity_date": 1618234330, "creation_date": 1444968699, "question_id": 33162449, "link": "https://stackoverflow.com/questions/33162449/iterate-over-multiline-string-in-go", "title": "Iterate over multiline string in Go", "body": "<p>In Python I can iterate over a multiline string.</p>\n\n<pre><code>x = \"\"\"\\\nthis is\nmy multiline\nstring!\"\"\"\n\nfor line in x.splitlines():\n    print(line)\n</code></pre>\n\n<p>Can Go do the same?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1444972559, "post_id": 33162323, "comment_id": 54134679, "body": "Relative imports generate more problems than they solve. Search the golang-nuts mailing list for lots of discussions about it."}], "owner": {"reputation": 2527, "user_id": 3476121, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/1c621706e2e37eed4f82f074af9f706a?s=128&d=identicon&r=PG", "display_name": "sadlil", "link": "https://stackoverflow.com/users/3476121/sadlil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "closed_date": 1445011097, "answer_count": 0, "score": 4, "last_activity_date": 1444967780, "creation_date": 1444967780, "question_id": 33162323, "link": "https://stackoverflow.com/questions/33162323/go-coding-style-relative-import-of-package", "closed_reason": "Duplicate", "title": "Go Coding Style - relative import of package", "body": "<p>Suppose I have a go project that includes many package. in example we can see this</p>\n\n<pre><code>-Project\n---A\n----aa\n----ab\n---B\n----ba\n----bb\n</code></pre>\n\n<p>Now while coding If i need to use methods of package <strong>aa</strong> into my <strong>bb</strong> package the standered way is to import like </p>\n\n<pre><code>import \"github.com/user/project/A/aa\"\n</code></pre>\n\n<p>But I have seen this package importing supports also relative import like</p>\n\n<pre><code>import \"./../../A/aa\"\n</code></pre>\n\n<p>That will also import that package and allow mw to use the methods.</p>\n\n<p>Now my question is - I didn't see any one importing like this. So is this type of <strong>relative importing is  prohibited? or it is allowed but using this is only a bad practice of coding?</strong>  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 1, "creation_date": 1444965454, "post_id": 33161284, "comment_id": 54132646, "body": "I don&#39;t think there is anything like that available.  You might be best off copying the <code>MkdirAll</code> source and adding an appropriate <code>Chown</code> call to do what you want (IIRC there is no way to atomically create a directory with a non-default owner)."}, {"owner": {"reputation": 28206, "user_id": 624884, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04a353473303cb908cd95f25277a4ba2?s=128&d=identicon&r=PG&f=1", "display_name": "F21", "link": "https://stackoverflow.com/users/624884/f21"}, "reply_to_user": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 1, "creation_date": 1444968810, "post_id": 33161284, "comment_id": 54133588, "body": "I think that&#39;s the best option at the moment, although it feels like a code smell."}], "answers": [{"comments": [{"owner": {"reputation": 28206, "user_id": 624884, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04a353473303cb908cd95f25277a4ba2?s=128&d=identicon&r=PG&f=1", "display_name": "F21", "link": "https://stackoverflow.com/users/624884/f21"}, "edited": false, "score": 0, "creation_date": 1444973614, "post_id": 33162772, "comment_id": 54135053, "body": "I think <code>filepath.Walk()</code> is a good idea, but I would still need to duplicate the innards of <code>mkdirall</code> to work out which folders in the chain do not exist yet, call <code>mkdirall</code> to create the folder and then use <code>filepath.Walk()</code> to walk through the chain and filter on the list of folders collected in the first them and call <code>chown</code>. I think compared to this, making a copy of <code>mkdirall</code> and adding a line to call <code>chown</code> is much more simpler and easier to understand."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 28206, "user_id": 624884, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04a353473303cb908cd95f25277a4ba2?s=128&d=identicon&r=PG&f=1", "display_name": "F21", "link": "https://stackoverflow.com/users/624884/f21"}, "edited": false, "score": 0, "creation_date": 1444973778, "post_id": 33162772, "comment_id": 54135113, "body": "@F21 no, the walk is only to apply chown, not to create the folders. All you do is check if the current path is a folder, and is a prefix of <code>&#47;var&#47;test1&#47;test2&#47;test3</code>: if it is, chown. If it is not, keep walking."}, {"owner": {"reputation": 28206, "user_id": 624884, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04a353473303cb908cd95f25277a4ba2?s=128&d=identicon&r=PG&f=1", "display_name": "F21", "link": "https://stackoverflow.com/users/624884/f21"}, "edited": false, "score": 0, "creation_date": 1444977024, "post_id": 33162772, "comment_id": 54136427, "body": "As another example, let say <code>&#47;etc&#47;lib&#47;</code> already exists and I want to create <code>&#47;etc&#47;lib&#47;test1&#47;test2</code>. <code>test1</code> and <code>test2</code> would also need to have their <code>uid</code> and <code>gid</code> changed, but I would like to leave <code>&#47;etc&#47;lib</code> as is. In all of these cases, wouldn&#39;t I have to do some processing to see what folders don&#39;t exist yet, call <code>mkdirall</code> to create them and then use the information from the first step with <code>filepath.Walk()</code> to change their <code>uid</code> and <code>gid</code>? Otherwise, without the information, I would be changing the owner and group of parent folders that already exists."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 28206, "user_id": 624884, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04a353473303cb908cd95f25277a4ba2?s=128&d=identicon&r=PG&f=1", "display_name": "F21", "link": "https://stackoverflow.com/users/624884/f21"}, "edited": false, "score": 0, "creation_date": 1444977197, "post_id": 33162772, "comment_id": 54136513, "body": "@F21 Simply pass 2 parameters: a prefix path (<code>&quot;&#47;etc&#47;lib&#47;&quot;</code>) and a path that was just created by mkdirAll (<code>&quot;test1&#47;test2&quot;</code>): if the current walked path is a prefix of both (<code>&quot;&#47;etc&#47;lib&#47;&quot;+&quot;test1&#47;test2&quot;</code>) but is <i>not</i> a prefix of the first parameter (<code>&quot;&#47;etc&#47;lib&#47;&quot;</code>), you are good: <code>chown</code>. If it is also a prefix of the first parameter, no good: no <code>chown</code>."}, {"owner": {"reputation": 28206, "user_id": 624884, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04a353473303cb908cd95f25277a4ba2?s=128&d=identicon&r=PG&f=1", "display_name": "F21", "link": "https://stackoverflow.com/users/624884/f21"}, "edited": false, "score": 0, "creation_date": 1444981242, "post_id": 33162772, "comment_id": 54138510, "body": "Ah, I see. In my case I do not have the luxury of know the prefix before hand, so I would still need to do some processing on each absolute path to determine the prefix."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 4, "last_activity_date": 1444971005, "creation_date": 1444971005, "answer_id": 33162772, "question_id": 33161284, "link": "https://stackoverflow.com/questions/33161284/recursively-create-a-directory-with-a-certain-owner-and-group/33162772#33162772", "title": "Recursively create a directory with a certain owner and group", "body": "<p>A bit like this <a href=\"https://github.com/gutengo/fil/blob/6109b2e0b5cfdefdef3a254cc1a3eaa35bc89284/file.go#L27-L34\" rel=\"nofollow\"><code>ChownR()</code> type of function</a>, the idea would be to filter the walk, and apply the chown only to folders which are part of a path passed in parameter (here <code>\"/var/test1/test2/test3</code>)</p>\n\n<p>Without filter:</p>\n\n<pre><code>func ChownR(path string, uid, gid int) error {\n    return filepath.Walk(path, func(name string, info os.FileInfo, err error) error {\n        if err == nil {\n            err = os.Chown(name, uid, gid)\n        }\n        return err\n    })\n}\n</code></pre>\n\n<p>In other words, with <a href=\"https://golang.org/pkg/path/filepath/#Walk\" rel=\"nofollow\"><code>filepath.Walk()</code></a>, there should not be too much \"manual work\" involved here.</p>\n"}, {"comments": [{"owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "edited": false, "score": 0, "creation_date": 1588967228, "post_id": 33162828, "comment_id": 109114589, "body": "You just saved my bacon. Username checks out. :)"}, {"owner": {"reputation": 1447, "user_id": 3570747, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/RKIuH.png?s=128&g=1", "display_name": "vastlysuperiorman", "link": "https://stackoverflow.com/users/3570747/vastlysuperiorman"}, "reply_to_user": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "edited": false, "score": 1, "creation_date": 1589208747, "post_id": 33162828, "comment_id": 109194719, "body": "@farhany glad I could help! For the record, my username started as a joke way back in high school. I don&#39;t actually think I&#39;m &quot;vastly superior&quot;. lol."}, {"owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "edited": false, "score": 0, "creation_date": 1589231635, "post_id": 33162828, "comment_id": 109206968, "body": "I am not too aware of SysProcAttrs. Any place you&#39;d recommend for reading about this stuff?"}, {"owner": {"reputation": 1447, "user_id": 3570747, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/RKIuH.png?s=128&g=1", "display_name": "vastlysuperiorman", "link": "https://stackoverflow.com/users/3570747/vastlysuperiorman"}, "reply_to_user": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "edited": false, "score": 0, "creation_date": 1589291752, "post_id": 33162828, "comment_id": 109230661, "body": "@farhany Details on the SysProcAttrs are available in the syscall docs here: <a href=\"https://golang.org/pkg/syscall/#SysProcAttr\" rel=\"nofollow noreferrer\">golang.org/pkg/syscall/#SysProcAttr</a>. Learning more about how system calls work in general will depend on the operating system and filesystem you&#39;re using."}], "tags": [], "owner": {"reputation": 1447, "user_id": 3570747, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/RKIuH.png?s=128&g=1", "display_name": "vastlysuperiorman", "link": "https://stackoverflow.com/users/3570747/vastlysuperiorman"}, "is_accepted": false, "score": 1, "last_activity_date": 1445011744, "last_edit_date": 1445011744, "creation_date": 1444971342, "answer_id": 33162828, "question_id": 33161284, "link": "https://stackoverflow.com/questions/33161284/recursively-create-a-directory-with-a-certain-owner-and-group/33162828#33162828", "title": "Recursively create a directory with a certain owner and group", "body": "<p>Switch the mkdir process to the user you wish to create directories for. This has the advantage of creating directories with correct permissions and ownership in a single command instead of creating loops or running multiple commands back to back. </p>\n\n<p>Example: </p>\n\n<pre><code>import \"os/exec\"\nimport \"syscall\"\n\nfunc main() {\n    // The command here can use flags to create all of the dirs at once\n    cmd := exec.Command('mkdir', '-p', '/var/test1/test2/test3/')\n\n    _ = syscall.Umask(0077) // Set umask for this process\n\n    cmd.SysProcAttr = &amp;syscall.SysProcAttr{}\n    cmd.SysProcAttr.Credential = &amp;syscall.Credential{Uid: uid, Gid: gid}\n\n    cmd.Run()\n\n}\n</code></pre>\n\n<p>Since the subprocess \"mkdir\" runs as the user specified by <code>uid</code>, the folders would already have the correct owner. If you get the umask part right, each directory will also have correct permissions.</p>\n\n<p>One caveat: this is not a very portable solution. Using syscall should only be your solution if you are certain your code will only be executing on a specific OS.   </p>\n"}], "owner": {"reputation": 28206, "user_id": 624884, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/04a353473303cb908cd95f25277a4ba2?s=128&d=identicon&r=PG&f=1", "display_name": "F21", "link": "https://stackoverflow.com/users/624884/f21"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3942, "favorite_count": 2, "answer_count": 2, "score": 3, "last_activity_date": 1445011744, "creation_date": 1444960134, "question_id": 33161284, "link": "https://stackoverflow.com/questions/33161284/recursively-create-a-directory-with-a-certain-owner-and-group", "title": "Recursively create a directory with a certain owner and group", "body": "<p>I would like to recursively create a directory and assign an owner and group for the folders and its parents that were created.</p>\n\n<p>For example, assuming <code>/var</code> exists, I want to create <code>/var/test1/test2/test3</code>.</p>\n\n<p>I am able to do this using <code>os.MkdirAll(\"/var/test1/test2/test3\", 0600)</code>.</p>\n\n<p>However, I also want to set <code>test1</code>, <code>test2</code>, and <code>test3</code>'s <code>uid</code> to <code>user1</code> and <code>gid</code> to <code>user1</code>.</p>\n\n<p>It's possible to do so using <code>os.Chown</code>, but that requires a lot of manually work. I would need build a tree of the folder and its parents that do not exist before creating the folder chain and then use <code>os.Chown</code> on each folder after creation.</p>\n\n<p>Is there a simpler way?</p>\n"}, {"tags": ["linux", "go", "path", "pid", "working-directory"], "answers": [{"tags": [], "owner": {"reputation": 148, "user_id": 4235856, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gsZg8.jpg?s=128&g=1", "display_name": "stellarpower", "link": "https://stackoverflow.com/users/4235856/stellarpower"}, "is_accepted": false, "score": 0, "last_activity_date": 1444954526, "last_edit_date": 1495542149, "creation_date": 1444954526, "answer_id": 33160570, "question_id": 33160412, "link": "https://stackoverflow.com/questions/33160412/can-an-executable-dynamically-resolve-its-location-on-the-filesystem-or-its-actu/33160570#33160570", "title": "Can an executable dynamically resolve its location on the filesystem or its actual &quot;resting place&quot; vs just the working directory of the user?", "body": "<p>This will depend on the language but as far as I know most programming languages have a way to get either the 'basename' of the program, e.g. helloworld, or the full path, e.g. /usr/bin/helloworld. Often this is provided as the first argument to the program, inserted by the OS/runtime library/interpreter, etc. For example, in C, argv[0] (as we start counting from 0 in C) gives the name of the current program, but the calling process initialises this special argument so the exact format can vary, and in bash, $0 will expand into the path of the script as given when executed (I think). From here: <a href=\"https://gobyexample.com/command-line-arguments\" rel=\"nofollow noreferrer\">https://gobyexample.com/command-line-arguments</a>, \"os.Args provides access to raw command-line arguments. Note that the first value in this slice is the path to the program, and os.Args[1:] holds the arguments to the program.\" So it appears you don't need to worry about /proc but if you're interested, <a href=\"https://stackoverflow.com/questions/933850/how-to-find-the-location-of-the-executable-in-c\">How do I find the location of the executable in C?</a></p>\n"}, {"tags": [], "owner": {"reputation": 9932, "user_id": 1839777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a382084bb1495af216e9a847c727d92e?s=128&d=identicon&r=PG", "display_name": "vonbrand", "link": "https://stackoverflow.com/users/1839777/vonbrand"}, "is_accepted": true, "score": 3, "last_activity_date": 1444958133, "creation_date": 1444958133, "answer_id": 33161012, "question_id": 33160412, "link": "https://stackoverflow.com/questions/33160412/can-an-executable-dynamically-resolve-its-location-on-the-filesystem-or-its-actu/33161012#33161012", "title": "Can an executable dynamically resolve its location on the filesystem or its actual &quot;resting place&quot; vs just the working directory of the user?", "body": "<p>In Linux (and perhaps in other Unixy systems) you'll find a symbolic link to the actual executable running as <code>pid</code> under <code>/proc/pid/exe</code>, checking that one will give what you want if it is a binary. If it is a script of some sort, that will probably just give the interpreter.</p>\n\n<p>But note that it is perfectly possible to start a process and delete the executable while it is running, leaving either a dangling link or just nothing.</p>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1445002651, "post_id": 33164543, "comment_id": 54151269, "body": "This still fails if the command was called via a relative path and the process changed directories, or if the executable was found from PATH. In the former case, there&#39;s no way to know for sure (that&#39;s why we parse <code>&#47;proc</code>), and the latter case you can try to find the correct executable in PATH (<code>exec.LookPath</code> can do this)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1444987699, "last_edit_date": 1444987699, "creation_date": 1444979609, "answer_id": 33164543, "question_id": 33160412, "link": "https://stackoverflow.com/questions/33160412/can-an-executable-dynamically-resolve-its-location-on-the-filesystem-or-its-actu/33164543#33164543", "title": "Can an executable dynamically resolve its location on the filesystem or its actual &quot;resting place&quot; vs just the working directory of the user?", "body": "<p>The exported variable <code>os.Args</code> (which is a slice: <code>[]string</code>) holds the program arguments, its first element being the executable name with full path.</p>\n\n<p>If the executable is not a symlink, you can use the <a href=\"https://golang.org/pkg/path/\" rel=\"nofollow\"><code>path</code></a> or <a href=\"https://golang.org/pkg/path/filepath/\" rel=\"nofollow\"><code>filepath</code></a> packages to get the folder of the executable like this:</p>\n\n<pre><code>folder := filepath.Dir(os.Args[0])\n</code></pre>\n\n<p>And you can use <a href=\"https://golang.org/pkg/os/#Readlink\" rel=\"nofollow\"><code>os.Readlink()</code></a> to resolve a symbolic link.</p>\n\n<p>And to test if your executable is a symlink, you can use <a href=\"https://golang.org/pkg/os/#Lstat\" rel=\"nofollow\"><code>os.Lstat()</code></a> which makes no attempt to follow a link (as opposed to <a href=\"https://golang.org/pkg/os/#Stat\" rel=\"nofollow\"><code>os.Stat()</code></a>).</p>\n\n<p>So your final version should look like this:</p>\n\n<pre><code>s := os.Args[0]\nfi, err := os.Lstat(s)\nif err != nil {\n    panic(err) // Failed to get stats\n}\n\n// Check if it's a symlink and if so, try to resolve it\nif fi.Mode()&amp;os.ModeSymlink != 0 {\n    if s, err = os.Readlink(s); err != nil {\n        panic(err) // Failed to resolve symlink\n    }\n}\ns = filepath.Dir(s) // We only want the folder part\n</code></pre>\n"}], "owner": {"reputation": 1897, "user_id": 473368, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4e24aa1cfabf417ef8833ea8721a66a8?s=128&d=identicon&r=PG", "display_name": "01AutoMonkey", "link": "https://stackoverflow.com/users/473368/01automonkey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 33161012, "answer_count": 3, "score": 2, "last_activity_date": 1444987699, "creation_date": 1444953355, "question_id": 33160412, "link": "https://stackoverflow.com/questions/33160412/can-an-executable-dynamically-resolve-its-location-on-the-filesystem-or-its-actu", "title": "Can an executable dynamically resolve its location on the filesystem or its actual &quot;resting place&quot; vs just the working directory of the user?", "body": "<p>If I have an executable in <code>/usr/bin</code> and call it while I'm located at <code>~/dev/wikis/</code> (that is <code>user@HAL:~/dev/wikis$ the_executable</code>), the <code>ioutil.ReadFile(\"file.txt\")</code> function in the executable will look in <code>/home/user/dev/wikis/file.txt</code>, but is it possible to make it look in <code>/usr/bin/file.txt</code> instead without the user or developer knowing beforehand that the executable will be located in <code>/usr/bin</code> (it could just as well be located in <code>/home/user/dev/my_program/the_executable</code>)?</p>\n\n<p>And then to add a layer of complexity, another situation, say I call the executable from a <em>symbolic link</em> in <code>/usr/bin</code> with the \"source\" of the executable actually being in <code>/home/user/dev/my_program/the_executable</code>, and I want the program to know about <code>/home/user/dev/my_program/</code> in this case, dynamically, rather then <code>/usr/bin</code>.</p>\n\n<p><strong>In short:</strong> How can an executable dynamically resolve its location on the filesystem or its actual \"resting place\" vs the working directory of the user (which can easily be gotten through <code>os.Getwd()</code> and which other commands like <code>ioutil.ReadFile</code> use, or use something comparible, for resolving paths).</p>\n\n<p>My best bet is that I have to get the PID of the running program (<code>os.Getpid</code>) and then somehow use that integer to access information about the instance of the program running under that PID, and hopefully that information contains a string of its directory which I can then use.</p>\n"}, {"tags": ["pointers", "reflection", "struct", "go"], "answers": [{"tags": [], "owner": {"reputation": 1308, "user_id": 4709839, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh6.googleusercontent.com/-4w1KKdkUNJk/AAAAAAAAAAI/AAAAAAAAABc/Xg55afDDwjk/photo.jpg?sz=128", "display_name": "William Poussier", "link": "https://stackoverflow.com/users/4709839/william-poussier"}, "is_accepted": true, "score": 2, "last_activity_date": 1444958719, "last_edit_date": 1444958719, "creation_date": 1444952717, "answer_id": 33160325, "question_id": 33159923, "link": "https://stackoverflow.com/questions/33159923/reflection-anonymous-struct-field-pointer/33160325#33160325", "title": "Reflection anonymous struct field pointer", "body": "<p>Okay, after some digging, and thanks to my IDE, i found that using a method <code>elem()</code> on <code>ptr</code> who return a pointer <code>*time.Duration</code> do the trick. It also work if i directly use <code>&amp;ptr.Duration</code></p>\n\n<p>Here is the working code.</p>\n\n<pre><code>func (d *duration) elem() *time.Duration {\n    return &amp;d.Duration\n}\n\nfunc assignFlags(v interface{}) {\n\n    // Dereference into an adressable value\n    xv := reflect.ValueOf(v).Elem()\n    xt := xv.Type()\n\n    for i := 0; i &lt; xt.NumField(); i++ {\n        f := xt.Field(i)\n\n        // Get tags for this field\n        name := f.Tag.Get(\"long\")\n        short := f.Tag.Get(\"short\")\n        usage := f.Tag.Get(\"usage\")\n\n        addr := xv.Field(i).Addr().Interface()\n\n        // Assign field to a flag\n        switch ptr := addr.(type) {\n        case *duration:\n            if len(short) &gt; 0 {\n                flag.DurationVarP(ptr.elem(), name, short, 0, usage)\n            } else {\n                flag.DurationVar(ptr.elem(), name, 0, usage)\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1308, "user_id": 4709839, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh6.googleusercontent.com/-4w1KKdkUNJk/AAAAAAAAAAI/AAAAAAAAABc/Xg55afDDwjk/photo.jpg?sz=128", "display_name": "William Poussier", "link": "https://stackoverflow.com/users/4709839/william-poussier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1527, "favorite_count": 0, "accepted_answer_id": 33160325, "answer_count": 1, "score": 2, "last_activity_date": 1444958719, "creation_date": 1444949996, "question_id": 33159923, "link": "https://stackoverflow.com/questions/33159923/reflection-anonymous-struct-field-pointer", "title": "Reflection anonymous struct field pointer", "body": "<p>I have a struct like this</p>\n\n<pre><code>type duration struct {\n    time.Duration\n}\n</code></pre>\n\n<p>and another one like that</p>\n\n<pre><code>type Config struct {\n    Announce duration\n}\n</code></pre>\n\n<p>I am using reflection to assign flags to the fields of the struct Config. However, with the particular use case of the type <code>duration</code>, i am stuck.\nThe problem is that when i do a switch type, i got <code>*config.duration</code> instead of <code>*time.Duration</code>. How can i access the anonymous field ?</p>\n\n<p>Here is the full code</p>\n\n<pre><code>func assignFlags(v interface{}) {\n\n    // Dereference into an adressable value\n    xv := reflect.ValueOf(v).Elem()\n    xt := xv.Type()\n\n    for i := 0; i &lt; xt.NumField(); i++ {\n        f := xt.Field(i)\n\n        // Get tags for this field\n        name := f.Tag.Get(\"long\")\n        short := f.Tag.Get(\"short\")\n        usage := f.Tag.Get(\"usage\")\n\n        addr := xv.Field(i).Addr().Interface()\n\n        // Assign field to a flag\n        switch ptr := addr.(type) { // i get `*config.duration` here\n        case *time.Duration:\n            if len(short) &gt; 0 {\n                // note that this is not flag, but pflag library. The type of the first argument muste be `*time.Duration`\n                flag.DurationVarP(ptr, name, short, 0, usage)\n            } else {\n                flag.DurationVar(ptr, name, 0, usage)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1444957828, "creation_date": 1444957828, "answer_id": 33160977, "question_id": 33159873, "link": "https://stackoverflow.com/questions/33159873/g-in-printf-does-not-give-fixed-decimal-places-like-f-or-e/33160977#33160977", "title": "%g in Printf does not give fixed decimal places like %f or %e", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow\">Package fmt</a></p>\n  \n  <p>Printing</p>\n  \n  <p>The default precision for %g is the smallest number of digits\n  necessary to identify the value uniquely</p>\n</blockquote>\n\n<p>For the value 2.0 that is one digit giving the value 2.</p>\n"}], "owner": {"reputation": 2100, "user_id": 886596, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/566bb5099075650583dacdd82be64bbf?s=128&d=identicon&r=PG", "display_name": "user886596", "link": "https://stackoverflow.com/users/886596/user886596"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 1, "accepted_answer_id": 33160977, "answer_count": 1, "score": 1, "last_activity_date": 1444957828, "creation_date": 1444949735, "question_id": 33159873, "link": "https://stackoverflow.com/questions/33159873/g-in-printf-does-not-give-fixed-decimal-places-like-f-or-e", "title": "%g in Printf does not give fixed decimal places like %f or %e", "body": "<p>According to <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow\">these docs</a> <code>%g</code> is <code>%e for large exponents, %f otherwise</code>. However, when I do:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var a float64 = 2.0\n    fmt.Printf(\"%f\\n\", a)\n    fmt.Printf(\"%e\\n\", a)\n    fmt.Printf(\"%g\\n\", a)\n}\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>2.000000\n2.000000e+00\n2\n</code></pre>\n\n<p>Why does the output for <code>%g</code> not contain fixed decimal places like <code>%e</code> or <code>%f</code>?</p>\n"}]