[{"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1568259544, "post_id": 57897526, "comment_id": 102219496, "body": "go list works no matter if a package is module or not just do not use the -m flag. For the rest of the questions: There is nothing to worry about, all works fine. Unused dependencies are not a problem and stuff inside a package but unused during your build also is not a problem to worry about."}, {"owner": {"reputation": 1158, "user_id": 6117625, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cff13813080b5f227531191b1dc96b60?s=128&d=identicon&r=PG&f=1", "display_name": "Dean coakley", "link": "https://stackoverflow.com/users/6117625/dean-coakley"}, "edited": false, "score": 1, "creation_date": 1568295733, "post_id": 57897526, "comment_id": 102235955, "body": "Having some difficulty understanding the question. I think the answer is &quot;no, I don&#39;t think you should be running <code>go build</code> on each dep that uses go modules&quot;. Perhaps you can understand why better from this: <a href=\"https://github.com/golang/go/wiki/Modules#why-does-go-mod-tidy-record-indirect-and-test-dependencies-in-my-gomod\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>"}, {"owner": {"reputation": 51, "user_id": 12055459, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-1Gy0A4Vd4EM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePEprUhs2JSq4O22GuL-3KZJ8Wjw/photo.jpg?sz=128", "display_name": "deniv", "link": "https://stackoverflow.com/users/12055459/deniv"}, "edited": false, "score": 0, "creation_date": 1568299545, "post_id": 57897526, "comment_id": 102238285, "body": "The issue with using go list is that it does not show the version of the dependency used, which is something I need and is why I am using the -m tag"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568301038, "post_id": 57897526, "comment_id": 102239198, "body": "It has no notion of non-module dependencies&#39; versions. It only understands versions for modules."}, {"owner": {"reputation": 4336, "user_id": 819651, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b3b2801b397b45b57b784c83b6274e22?s=128&d=identicon&r=PG", "display_name": "Lu&#237;s Soares", "link": "https://stackoverflow.com/users/819651/lu%c3%ads-soares"}, "edited": false, "score": 1, "creation_date": 1585957386, "post_id": 57897526, "comment_id": 107957672, "body": "does it help: <a href=\"https://stackoverflow.com/a/55866702/819651\">stackoverflow.com/a/55866702/819651</a> ?"}], "answers": [{"tags": [], "owner": {"reputation": 2165, "user_id": 8030651, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/aOHs0.jpg?s=128&g=1", "display_name": "kozmo", "link": "https://stackoverflow.com/users/8030651/kozmo"}, "is_accepted": false, "score": 1, "last_activity_date": 1607872481, "last_edit_date": 1607872481, "creation_date": 1607864755, "answer_id": 65275933, "question_id": 57897526, "link": "https://stackoverflow.com/questions/57897526/getting-all-dependencies-of-a-go-project/65275933#65275933", "title": "Getting all dependencies of a Go project", "body": "<p>I can try to analyze <code>go.sum</code> file (when you execute <code>go list -u</code>, <code>go.sum</code> was created)</p>\n<blockquote>\n<p>The go command uses the go.sum file to ensure that future downloads of these modules retrieve the same bits as the first download, to ensure the modules your project depends on do not change unexpectedly, whether for malicious, accidental, or other reasons. Both go.mod and go.sum should be checked into version control. (<a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">Using Go Modules - Adding a dependency</a>)</p>\n</blockquote>\n<p><code>go.sum</code> file lists down the checksum (and version tag) of direct and indirect dependency required by the module.</p>\n<pre><code>% cat go.sum\n...\ngithub.com/bmizerany/perks v0.0.0-20141205001514-d9a9656a3a4b/go.mod h1:ac9efd0D1fsDb3EJvhqgXRbFx7bs2wqZ10HQPeU8U/Q=\ngithub.com/c2h5oh/datasize v0.0.0-20171227191756-4eba002a5eae/go.mod h1:S/7n9copUssQ56c7aAgHqftWO4LTf4xY6CGWt8Bc+3M=\ngithub.com/cespare/xxhash v1.1.0/go.mod h1:XrSqR1VqqWfGrhpAt58auRo0WTKS1nRRg3ghfAqPWnc=\ngithub.com/client9/misspell v0.3.4/go.mod h1:qj6jICC3Q7zFZvVWo7KLAzC3yx5G7kyvSDkc90ppPyw=\ngithub.com/cockroachdb/apd v1.1.0/go.mod h1:8Sl8LxpKi29FqWXR16WEFZRNSz3SoPzUzeMeY4+DwBQ=\n...\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 12055459, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-1Gy0A4Vd4EM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePEprUhs2JSq4O22GuL-3KZJ8Wjw/photo.jpg?sz=128", "display_name": "deniv", "link": "https://stackoverflow.com/users/12055459/deniv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2818, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1607872481, "creation_date": 1568240566, "last_edit_date": 1568273978, "question_id": 57897526, "link": "https://stackoverflow.com/questions/57897526/getting-all-dependencies-of-a-go-project", "title": "Getting all dependencies of a Go project", "body": "<p>For my project I am trying to get all the dependencies and sub dependencies of my project. I need to specific version of each of these dependencies. Not only do I need the dependencies of my project, but the dependencies of the dependencies and so on until the root.</p>\n\n<p>For my project, <code>go list -m all</code> works for everything except indirect dependencies that have not opted into using go.mod files. Right now my workflow is taking an initial batch of repositories, downloading them from git then using \u201cGO111MODULE=on go build ./\u2026\u201d. and \u201cGO111MODULE=on go list -m -json all\u201d to get the list of dependencies. I do not check for go.mod as all of the repositories I am scanning are using go.mod files. </p>\n\n<p>For the list of dependencies that come out of this initial list I have some questions, for files without go.mod files, I used this as a reference: \u201c<a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">https://blog.golang.org/using-go-modules</a>\u201d</p>\n\n<p>-Path = Received from <code>go list -m all</code>, it can be GitHub, gopkg, or whatever is used to dl the go package.</p>\n\n<p>Without go.mod</p>\n\n<pre><code>-\u201cGO111MODULE=on go mod init &lt;PATH from parent go.mod&gt;\u201d\n\n-\u201cGO111MODULE=on go build ./\u2026\u201d\n\n-\u201cGO111MODULE=on go mod tidy\u201d\n\n-\u201cGO111MODULE=on go list -m -json all\u201d\n\n-From there I get a list of the dependencies of this module. \n</code></pre>\n\n<p>With go.mod </p>\n\n<pre><code>-\u201cGO111MODULE=on go build ./\u2026\u201d\n\n-\u201cGO111MODULE=on go mod tidy\u201d\n\n-\u201cGO111MODULE=on go list -m -json all\u201d\n</code></pre>\n\n<p>Should I be running <code>go build</code> on each dependency that has a go.mod file? For ones without a go.mod file, I understand this should be done, as how else will we populate the go.mod file with the dependencies. But for files with a go.mod file, will I be pulling extra stuff that is not necessarily being used by my project with go build, like test files and other files that might not be used when I am simply importing that project? I understand that its better to get more unused dependencies rather than missing some, but it is getting a bit overwhelming with how massive the amount of dependencies is. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1568239193, "post_id": 57897116, "comment_id": 102215543, "body": "The code that works copies <code>currResult</code>s backing array to the result.  The code that does not work shares the backing arrays between the result and computation in progress."}, {"owner": {"reputation": 1, "user_id": 12055295, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mA319Quaaear7KVqpnP9jwWBYskx8BWhr-YcjqocQ=k-s128", "display_name": "Vinil Cheeramvelil", "link": "https://stackoverflow.com/users/12055295/vinil-cheeramvelil"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568390389, "post_id": 57897116, "comment_id": 102271370, "body": "Thank you.. Since the array that was shared was updated by the caller and it just points to the latest copy of the array..."}], "owner": {"reputation": 1, "user_id": 12055295, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mA319Quaaear7KVqpnP9jwWBYskx8BWhr-YcjqocQ=k-s128", "display_name": "Vinil Cheeramvelil", "link": "https://stackoverflow.com/users/12055295/vinil-cheeramvelil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1568237814, "creation_date": 1568237814, "question_id": 57897116, "link": "https://stackoverflow.com/questions/57897116/wrong-result-when-appending-to-a-int-slice-combinationsum-problem", "title": "Wrong result when appending to a [][]int slice - CombinationSum problem", "body": "<p>When I append to a slice of type [][]int, the result is not what I expected. I have code below that illustrates the problem and has a fix. But I would like to understand what exactly is going on</p>\n\n<p>The functioning code is at <a href=\"https://play.golang.org/p/aeibeDW17z2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/aeibeDW17z2</a>\nThe one that is broken is at <a href=\"https://play.golang.org/p/eP5MiH1VjSu\" rel=\"nofollow noreferrer\">https://play.golang.org/p/eP5MiH1VjSu</a></p>\n\n<p>This is from the leetcode problem\n<a href=\"https://leetcode.com/problems/combination-sum\" rel=\"nofollow noreferrer\">https://leetcode.com/problems/combination-sum</a></p>\n\n<p>Could someone please explain what exactly is going on? I beleive its got to do with reuse of the backing array.. but don't really understand. </p>\n\n<p>Thanks in advance</p>\n\n<p>Problematic Code</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    if target == 0 {\n        fmt.Println(\"Current Result:\", currResult)\n        fmt.Println(\"Result Before:\", result)\n\n        r := append([]int{}, currResult...)\n        fmt.Println(\"r=\", r)\n\n\n        //*result = append(*result, r)\n    // if you uncomment above line and comment below, you will get right result - Why?\n        *result = append(*result, currResult)\n\n\n        fmt.Println(\"Result:\", *result)\n        return\n    }\n</code></pre>\n\n<p><strong>Working Code</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nimport \"sort\"\n\nfunc combinationSum(candidates []int, target int) [][]int {\n    sort.Ints(candidates)\n    result := [][]int{}\n    helper(candidates, target, 0, []int{}, &amp;result)\n    return result\n\n}\n\nfunc helper(candidates []int, target int, pos int, currResult []int, result *[][]int){\n\n    if pos == len(candidates) || target &lt; 0 {\n        return\n    }\n\n    if target == 0 {\n        fmt.Println(\"Current Result:\", currResult)\n        fmt.Println(\"Result Before:\", result)\n\n        r := append([]int{}, currResult...)\n        fmt.Println(\"r=\", r)\n\n\n        *result = append(*result, r)\n    // if you comment above line and uncomment below, you will get wrong result - Why?\n        //*result = append(*result, currResult)\n\n\n        fmt.Println(\"Result:\", *result)\n        return\n    }\n\n    // lets see if we can optimize this call\n\n    for i := pos; i &lt; len(candidates); i++ {\n        temp := append(currResult, candidates[i])\n        helper(candidates, target-candidates[i], i, temp, result)\n\n    }\n}\n\n\nfunc main() {\n\n    candidates :=[]int{2,3,5}\n    target := 8\n\n    fmt.Println(\"Input:\\n-----\\n\",\"Target:\", target, \"Candidates:\", candidates )\n    //fmt.Println(\"Target:\", target, \"Candidates:\", candidates)\n\n    fmt.Println(\"\\nDebug\\n-----\")\n    result :=combinationSum(candidates, 8)\n\n    fmt.Println(\"\\n\\nResults:\\n------\\n\", result)\n\n\n}\n\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda"], "answers": [{"tags": [], "owner": {"reputation": 45894, "user_id": 271415, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/8648256cc53b261c5e1d266380a256fc?s=128&d=identicon&r=PG", "display_name": "jarmod", "link": "https://stackoverflow.com/users/271415/jarmod"}, "is_accepted": true, "score": 1, "last_activity_date": 1568245781, "creation_date": 1568245781, "answer_id": 57898062, "question_id": 57896732, "link": "https://stackoverflow.com/questions/57896732/generating-presign-url-for-set-of-image-files/57898062#57898062", "title": "Generating Presign URL for set of image files", "body": "<p>I'm not aware of a pre-sign SDK method, in any of the SDKs, that accepts a list of S3 keys.</p>\n\n<p>However, you should just go ahead and call the pre-sign method, file by file. It's not a network API call. It's a purely local signing operation.</p>\n"}], "owner": {"reputation": 51, "user_id": 11943909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a986c685885fadcd636b4159863f9a?s=128&d=identicon&r=PG&f=1", "display_name": "Stefan995", "link": "https://stackoverflow.com/users/11943909/stefan995"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30, "favorite_count": 0, "accepted_answer_id": 57898062, "answer_count": 1, "score": 1, "last_activity_date": 1568274096, "creation_date": 1568235560, "last_edit_date": 1568274096, "question_id": 57896732, "link": "https://stackoverflow.com/questions/57896732/generating-presign-url-for-set-of-image-files", "title": "Generating Presign URL for set of image files", "body": "<p>Is it possible to call AWS API only once, specifically <code>Presign</code> function, in order to obtain Authorization token, and then use it for set of, lets say 50, image files on S3?</p>\n\n<p>I don't want to invoke AWS API <strong>X</strong> times in order to generate URLs for image files on S3. Is there a way around it?</p>\n"}, {"tags": ["python", "c++", "go", "cgo", "pybind11"], "comments": [{"owner": {"reputation": 1069, "user_id": 3283333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2363a3623beb1efba518c1896bc92e66?s=128&d=identicon&r=PG&f=1", "display_name": "Christian", "link": "https://stackoverflow.com/users/3283333/christian"}, "edited": false, "score": 1, "creation_date": 1568636309, "post_id": 57896135, "comment_id": 102325207, "body": "I&#39;m guessing your problem comes from differences at compilation between C and C++ compilers. To correctly call C functions, make sure they are &quot;embedded&quot; within <code>extern &quot;C&quot;</code> <a href=\"https://stackoverflow.com/a/1041880/3283333\">see this answer</a>.  Could you post your code for &quot;hello.h&quot; please ?"}, {"owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "reply_to_user": {"reputation": 1069, "user_id": 3283333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2363a3623beb1efba518c1896bc92e66?s=128&d=identicon&r=PG&f=1", "display_name": "Christian", "link": "https://stackoverflow.com/users/3283333/christian"}, "edited": false, "score": 0, "creation_date": 1568639371, "post_id": 57896135, "comment_id": 102326969, "body": "Thanks for sharing that, looking into it. Unfortunately it does seem like the key function in question <code>Sum</code> is surrounded by an <code>extern &quot;C&quot;</code> tag in <code>hello.h</code>."}], "owner": {"reputation": 2640, "user_id": 733545, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vnzM9.jpg?s=128&g=1", "display_name": "Peteris", "link": "https://stackoverflow.com/users/733545/peteris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 201, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1568665142, "creation_date": 1568232527, "last_edit_date": 1568665142, "question_id": 57896135, "link": "https://stackoverflow.com/questions/57896135/symbol-not-found-linking-a-go-library-into-python-with-cgo-and-pybind11", "title": "SYMBOL NOT FOUND: Linking a `go` library into `python` with `cgo` and `pybind11`", "body": "<p>I'm trying to make a <code>go</code> function available in Python. I'm using the standard <code>cgo</code> approach combined with <code>pybind11</code> but not able to get it working. I'm leveraging this <a href=\"https://github.com/bast/pybind11-demo\" rel=\"nofollow noreferrer\">demo</a> which works on its own but not when trying to link the <code>go</code> code. Equally I'm able to call the <code>go</code> code from C but not from Python.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I've confirmed that the issue is definitely in the linking step by using a shared library not compiled from Go. The error is very likely in either the shared library definition or the CMake file setup.</p>\n\n<p>I've got the following file in <code>go</code>:</p>\n\n<pre><code>package main\n\nimport \"C\"\n\n//export Sum\nfunc Sum(a, b int) int {\n    return a + b\n}\n\n\nfunc main() {}\n</code></pre>\n\n<p>That I'm compiling into a C shared library <code>hello.so</code> via:</p>\n\n<p><code>go build -buildmode=c-shared -o hello.so hello.go</code></p>\n\n<p>Then adding a C++ file <code>example.cpp</code>:</p>\n\n<pre><code>#include &lt;pybind11/pybind11.h&gt;\n#include \"hello.h\"\n\n\nint add(int i, int j) {\n    long long other_sum = Sum(2, 3);\n    return i + j;\n}\n\nnamespace py = pybind11;\n\nPYBIND11_MODULE(example, m) {\n    // optional module docstring\n    m.doc() = \"pybind11 example plugin\";\n\n    // define add function\n    m.def(\"add\", &amp;add, \"A function which adds two numbers\");\n}\n</code></pre>\n\n<p>Then, with the full source code of <code>pybind11</code> into a folder called <code>pybind11</code>, I run the following:</p>\n\n<p><code>mkdir build &amp;&amp; cd build &amp;&amp; cmake .. &amp;&amp; make</code></p>\n\n<p>which successfully creates a Python library in folder <code>build</code>.</p>\n\n<p>However, when calling the Python CLI <code>cd build &amp;&amp; python3</code> and then importing <code>add</code> with <code>from example import add</code>, I run into the following issue:</p>\n\n<pre><code>ImportError: Symbol not found: _Sum\n</code></pre>\n\n<p>This seems like a library linking issue, but it doesn't go away with the following <code>CMakeLists.txt</code> configuration:</p>\n\n<pre><code>cmake_minimum_required(VERSION 2.8.12)\nproject(example)\n\nfind_package(PythonLibs)\ninclude_directories(${PYTHON_INCLUDE_DIRS})\n\nadd_subdirectory(pybind11)\npybind11_add_module(example example.cpp)\n\n# first attempt to link\ninclude_directories(.)\nlink_directories($PWD)\n\n# second attempt to link\nadd_library(hello SHARED IMPORTED)\nset_property(TARGET hello PROPERTY IMPORTED_LOCATION \"./hello.so\")\n</code></pre>\n\n<p>Any thoughts on why the attempt to link is failing?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Code for <code>hello.h</code>:</p>\n\n<pre><code>/* Code generated by cmd/cgo; DO NOT EDIT. */\n\n/* package command-line-arguments */\n\n\n#line 1 \"cgo-builtin-export-prolog\"\n\n#include &lt;stddef.h&gt; /* for ptrdiff_t below */\n\n#ifndef GO_CGO_EXPORT_PROLOGUE_H\n#define GO_CGO_EXPORT_PROLOGUE_H\n\n#ifndef GO_CGO_GOSTRING_TYPEDEF\ntypedef struct { const char *p; ptrdiff_t n; } _GoString_;\n#endif\n\n#endif\n\n/* Start of preamble from import \"C\" comments.  */\n\n\n\n\n/* End of preamble from import \"C\" comments.  */\n\n\n/* Start of boilerplate cgo prologue.  */\n#line 1 \"cgo-gcc-export-header-prolog\"\n\n#ifndef GO_CGO_PROLOGUE_H\n#define GO_CGO_PROLOGUE_H\n\ntypedef signed char GoInt8;\ntypedef unsigned char GoUint8;\ntypedef short GoInt16;\ntypedef unsigned short GoUint16;\ntypedef int GoInt32;\ntypedef unsigned int GoUint32;\ntypedef long long GoInt64;\ntypedef unsigned long long GoUint64;\ntypedef GoInt64 GoInt;\ntypedef GoUint64 GoUint;\ntypedef __SIZE_TYPE__ GoUintptr;\ntypedef float GoFloat32;\ntypedef double GoFloat64;\ntypedef float _Complex GoComplex64;\ntypedef double _Complex GoComplex128;\n\n/*\n  static assertion to make sure the file is being used on architecture\n  at least with matching size of GoInt.\n*/\ntypedef char _check_for_64_bit_pointer_matching_GoInt[sizeof(void*)==64/8 ? 1:-1];\n\n#ifndef GO_CGO_GOSTRING_TYPEDEF\ntypedef _GoString_ GoString;\n#endif\ntypedef void *GoMap;\ntypedef void *GoChan;\ntypedef struct { void *t; void *v; } GoInterface;\ntypedef struct { void *data; GoInt len; GoInt cap; } GoSlice;\n\n#endif\n\n/* End of boilerplate cgo prologue.  */\n\n#ifdef __cplusplus\nextern \"C\" {\n#endif\n\n\nextern GoInt Sum(GoInt p0, GoInt p1);\n\n#ifdef __cplusplus\n}\n#endif\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568234505, "post_id": 57896049, "comment_id": 102214167, "body": "The example code does not demonstrate the stated issue. Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">Minimal, Reproducible Example</a> showing what is actually causing your problem."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 8662410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2adcb692e03a2536720e99c1bfe3bbd9?s=128&d=identicon&r=PG&f=1", "display_name": "Racchio", "link": "https://stackoverflow.com/users/8662410/racchio"}, "edited": false, "score": 0, "creation_date": 1568232947, "post_id": 57896140, "comment_id": 102213663, "body": "This fixed my issue! Thanks"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1568233614, "post_id": 57896140, "comment_id": 102213885, "body": "<code>WaitGroup</code>s <i>can</i> be shared among multiple go-routines. However the <code>WaitGroup</code> concept spans a particular <i>task</i>. Since there are multiple <i>tasks</i>, then as this answer shows, one needs individual <code>WaitGroup</code>s for each task."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568234433, "post_id": 57896140, "comment_id": 102214126, "body": "There is no inherent requirement to have one WG per task. You can use it in any way that suits the purpose."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568236607, "post_id": 57896140, "comment_id": 102214885, "body": "@Adrian sure it&#39;s just a counter - a counter that cannot go below zero. But its very name suggests it &quot;wait&quot; for a &quot;group&quot; (of sub-tasks) which represents a bigger <i>task</i>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568237337, "post_id": 57896140, "comment_id": 102215098, "body": "It&#39;s very name suggests it &quot;waits&quot; for a &quot;group&quot; - &quot;task&quot; isn&#39;t in there.  <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">The documentation clearly states</a> &quot;A WaitGroup waits for a collection of goroutines to finish&quot;. The things it&#39;s waiting for agroup of are, specifically, goroutines. &quot;Task&quot; is a notion that you might have found helpful, but it has nothing to do with WaitGroups."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568240995, "post_id": 57896140, "comment_id": 102215965, "body": "@Adrian I&#39;ll offer an example: I recently had a crawler of X go-routine workers that work on recursive task. To track when the task was complete, I used a <code>WaitGroup</code>: Add(1) for each recursive step; Done() when complete. The X go-routines never finish (they sit for any future next tasks) - but I can signal that the recursive-task has complete to the caller by waiting on this &quot;recursive&quot; WaitGroup."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568292760, "post_id": 57896140, "comment_id": 102234165, "body": "Sounds like you should have just used channels. Regardless, the statement &quot;However the WaitGroup concept spans a particular task. Since there are multiple tasks, then as this answer shows, one needs individual WaitGroups for each task&quot; is not objectively true; it may be your personal rule of thumb, but it has nothing to do with how WaitGroups are intended to be used."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1568239072, "last_edit_date": 1568239072, "creation_date": 1568232544, "answer_id": 57896140, "question_id": 57896049, "link": "https://stackoverflow.com/questions/57896049/waitgroup-is-reused-before-previous-wait-has-returned-in-multiple-go-routines/57896140#57896140", "title": "WaitGroup is reused before previous Wait has returned in multiple go routines", "body": "<p>If funcfile2() is called from multiple goroutines, then they are all sharing the same WaitGroup wg, which is valid. You get this error because in one of the goroutines wg.Wait() is called, and then in another goroutine wg.Add(3) is called, which is not valid. You cannot add more to a waitgroup once it starts waiting.</p>\n\n<p>You have to have a separate waitgroup for each goroutine that calls funcfile2(). If this is in a for-loop, you can do something like:</p>\n\n<pre><code>for {\n   wg:=sync.WaitGroup{}\n   go funcfile2(&amp;wg)\n}\n</code></pre>\n\n<p>That way each goroutine calling funcfile2 will use its own waitgroup. Of course, funcfile2 has to pass the same waitgroup to the goroutines it creates.</p>\n"}], "owner": {"reputation": 51, "user_id": 8662410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2adcb692e03a2536720e99c1bfe3bbd9?s=128&d=identicon&r=PG&f=1", "display_name": "Racchio", "link": "https://stackoverflow.com/users/8662410/racchio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 744, "favorite_count": 0, "accepted_answer_id": 57896140, "answer_count": 1, "score": 0, "last_activity_date": 1568270880, "creation_date": 1568232157, "last_edit_date": 1568270880, "question_id": 57896049, "link": "https://stackoverflow.com/questions/57896049/waitgroup-is-reused-before-previous-wait-has-returned-in-multiple-go-routines", "title": "WaitGroup is reused before previous Wait has returned in multiple go routines", "body": "<p>I have a go program with multiple goroutines. I am experiencing this error and I can't figure out why. This is my code logic:</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>for {\n   ...\n   go funcFile2()\n}\n</code></pre>\n\n<p>Where funcFile2 is defined in File2.go and is called multiple times in a sort of loop</p>\n\n<p><strong>File2.go</strong></p>\n\n<pre><code>var wg sync.WaitGroup\n\nfunc func1(){\n    defer wg.Done()\n    return\n}\nfunc func2(){\n    defer wg.Done()\n    return\n}\nfunc func3(){\n    defer wg.Done()\n    return\n}\n\nfunc funcFile2(){\nwg.Add(3)\ngo func1()\ngo func2()\ngo func3()\nwg.Wait()\n}\n</code></pre>\n\n<p>GO Version: go1.12.7</p>\n\n<p>How can I solve?</p>\n"}, {"tags": ["go", "tuples"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1568233429, "post_id": 57895826, "comment_id": 102213821, "body": "The Tour of Go might be a helpful resource."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1568279410, "post_id": 57895826, "comment_id": 102226820, "body": "if ordering does nor matter use a <code>map[int]string</code>"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 3, "last_activity_date": 1568231435, "creation_date": 1568231435, "answer_id": 57895918, "question_id": 57895826, "link": "https://stackoverflow.com/questions/57895826/working-with-an-array-of-both-int-str-in-go/57895918#57895918", "title": "Working with an array of both int &amp; str in Go", "body": "<p>If you <em>really</em> want to do this with arrays only:</p>\n\n<pre><code>List:=[][]interface{}{ {1,\"Pie\"}, {10,\"Fish\"}, {5, \"apples\"} }\n</code></pre>\n\n<p>Then, you can do type assertions:</p>\n\n<pre><code>intValue:=List[0][0].(int)\nstrValue:=List[0][1].(string)\n</code></pre>\n\n<p>However, a better way would be to define a struct containing an int and string member and use an array of that.</p>\n"}, {"tags": [], "owner": {"reputation": 598, "user_id": 2756123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x71E3.jpg?s=128&g=1", "display_name": "Tom Trebicky", "link": "https://stackoverflow.com/users/2756123/tom-trebicky"}, "is_accepted": true, "score": 5, "last_activity_date": 1568231713, "creation_date": 1568231713, "answer_id": 57895974, "question_id": 57895826, "link": "https://stackoverflow.com/questions/57895826/working-with-an-array-of-both-int-str-in-go/57895974#57895974", "title": "Working with an array of both int &amp; str in Go", "body": "<p>I would recommend going about this like so</p>\n\n<pre><code>type Foo struct {\n  Number int\n  Text string\n}\n\n  // ...\n  array := []Foo{{Number: 1, Text: \"pie\"}, {Number: 10, Text: \"fish\"}, {Number: 5, Text: \"apples\"}}\n  if array[0].Number == 1 {\n    fmt.Println(array[0].Text)\n  }\n  // ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 66, "user_id": 2648684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345598dc4a3606e8ed42f8336de1f8ab?s=128&d=identicon&r=PG", "display_name": "VC Healy", "link": "https://stackoverflow.com/users/2648684/vc-healy"}, "is_accepted": false, "score": 0, "last_activity_date": 1568303070, "creation_date": 1568303070, "answer_id": 57910310, "question_id": 57895826, "link": "https://stackoverflow.com/questions/57895826/working-with-an-array-of-both-int-str-in-go/57910310#57910310", "title": "Working with an array of both int &amp; str in Go", "body": "<p>Using the solution above I was able  to get the basics of what I needed.</p>\n\n<pre><code>\n// The function determines if it's one of or more than 1\n// Giving the correct English sentence\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\ntype Foo struct {\n    Number int\n    Text   string\n}\n\nfunc main() {\n    // change the value of fish between 1 and 10 to test the function works as expected\n    // List could be pulled in from somewhere else then ran through this function\n    array := []Foo{{Number: 1, Text: \"pie\"}, {Number: 10, Text: \"fish\"}, {Number: 5, Text: \"apples\"}}\n    for i := 0; i &lt;= 2; i++ {\n        n := strconv.Itoa(array[i].Number)\n        g := (array[i].Text)\n        if array[i].Number == 1 {\n            fmt.Println(\"There is \" + n + \" \" + g + \".\")\n        } else {\n            fmt.Println(\"There are \" + n + \" \" + g + \".\")\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 66, "user_id": 2648684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345598dc4a3606e8ed42f8336de1f8ab?s=128&d=identicon&r=PG", "display_name": "VC Healy", "link": "https://stackoverflow.com/users/2648684/vc-healy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 394, "favorite_count": 0, "accepted_answer_id": 57895974, "answer_count": 3, "score": 1, "last_activity_date": 1568303070, "creation_date": 1568231001, "last_edit_date": 1568231164, "question_id": 57895826, "link": "https://stackoverflow.com/questions/57895826/working-with-an-array-of-both-int-str-in-go", "title": "Working with an array of both int &amp; str in Go", "body": "<p>I am trying to use an array in Go but I cannot find anything that works with both integers and strings in the same array. I am looking for some documentation that would help me with this problem.</p>\n\n<p>I have it working in Python and I am trying to translate it into Go.\nMost of the information I found online is showing either arrays of integers or arrays of strings but not both combined.</p>\n\n<p>The integer &amp; string will be passed into another function, depending on the value of the integer determines which string will be concatenated to the string value of the array.</p>\n\n<p>This is an example from Python:</p>\n\n<pre><code># This is the set arrays\nList = [[1, \"Pie\"], [10, \"Fish\"], [5, \"apples\"]]\n\n#This is the code of the function that each array will be passed into\n if list[0] == 1:\n        return \"There is one \" + list[1] + \".\"\n    else:\n        return \"There are \" + str(list[0]) + \" \" + list[1] + \".\"\n</code></pre>\n\n<p>Final Print Output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>There is one Pie.\nThere are 10 Fish.\nThere are 5 apples.\n</code></pre>\n"}, {"tags": ["mongodb", "rest", "go", "crud"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 12052106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f1f4da49fcec43a9d11632d9b9bc5ae?s=128&d=identicon&r=PG&f=1", "display_name": "jkim615", "link": "https://stackoverflow.com/users/12052106/jkim615"}, "edited": false, "score": 0, "creation_date": 1568241147, "post_id": 57897407, "comment_id": 102216005, "body": "Sorry, I&#39;m having trouble understanding what you&#39;re saying. So is my issue not in the FindOneAndUpdate call? Here is the link to the code: <a href=\"https://github.com/jasonkim615/internship-db/blob/master/main.go\" rel=\"nofollow noreferrer\">github.com/jasonkim615/internship-db/blob/master/main.go</a>"}], "tags": [], "owner": {"reputation": 316, "user_id": 10708920, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c66ce356482cea812439909bd3ce1416?s=128&d=identicon&r=PG&f=1", "display_name": "Josh", "link": "https://stackoverflow.com/users/10708920/josh"}, "is_accepted": false, "score": 0, "last_activity_date": 1568239661, "creation_date": 1568239661, "answer_id": 57897407, "question_id": 57895565, "link": "https://stackoverflow.com/questions/57895565/findoneandupdate-function-does-not-update-the-database/57897407#57897407", "title": "FindOneAndUpdate function does not update the database", "body": "<p>So it appears you are trying to decode into the Company . I can not see the structure of Company, but the data it holds may help answer your question. create structs to mimic your json structure and then decode your json. Here is an example \n(using UnMarshall, due to using static string in example)  for stream data with \n*Writer Type  Use Decode. </p>\n\n<pre><code>    package main \n\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype person struct {\n    Name  string `json:\"Name\"`\n    Age   int    `json:\"Age\"`\n    Alive bool   `json:\"Alive\"`\n}\n\nfunc main(){\n    JSON:= `[{\"Name\":\"somename\",\"Age\":29,\"Alive\":true},{\"Name\":\"Tyrone\",\"Age\":39,\"Alive\":true}]`\n    //First Must Convert to slice of bytes\n    JSONBYTE:= []byte(JSON)\n    //Made New Slice To Hold Data From JSON \n   var people  []person\n    //Converting JSON to Struct must give *Address\n      err := json.Unmarshal(JSONBYTE, &amp;people)\n  //If \n    if err != nil {\n        fmt.Println(err)\n    }\n\n        for _, i := range people {\n            fmt.Printf(\"Person Name: %v\\n\", i.Name)\n        }\n    //Save To DB example only\n    // _, err = db.Collection(COLLECTION).InsertMany(context.Background(), people)\n    //  if err != nil {\n    //   log.Fatal(err)\n       }\n</code></pre>\n\n<p>Here is an example using Decoder From \n<a href=\"https://stackoverflow.com/questions/45756011/parse-json-http-response-using-golang/45758022\">Parse JSON HTTP response using golang</a></p>\n\n<pre><code>    package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\ntype Example struct {\n    Type    string   `json:\"type,omitempty\"`\n    Subsets []Subset `json:\"subsets,omitempty\"`\n}\n\ntype Subset struct {\n    Addresses []Address `json:\"addresses,omitempty\"`\n}\n\ntype Address struct {\n    IP string `json:\"IP,omitempty\"`\n}\n    func main() {\n\n    m := []byte(`{\"type\":\"example\",\"data\": {\"name\": \"abc\",\"labels\": {\"key\": \"value\"}},\"subsets\": [{\"addresses\": [{\"ip\": \"192.168.103.178\"}],\"ports\": [{\"port\": 80}]}]}`)\n\n    r := bytes.NewReader(m)\n    decoder := json.NewDecoder(r)\n\n    val := &amp;Example{}\n    err := decoder.Decode(val)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // If you want to read a response body\n    // decoder := json.NewDecoder(res.Body)\n    // err := decoder.Decode(val)\n\n    // Subsets is a slice so you must loop over it\n    for _, s := range val.Subsets {\n        // within Subsets, address is also a slice\n        // then you can access each IP from type Address\n        for _, a := range s.Addresses {\n            fmt.Println(a.IP)\n        }\n    }\n\n}\n//The output would be: 192.168.103.178\n</code></pre>\n\n<p>Also Really neat tool for turning JSON to Struct \n<a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a></p>\n"}], "owner": {"reputation": 11, "user_id": 12052106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f1f4da49fcec43a9d11632d9b9bc5ae?s=128&d=identicon&r=PG&f=1", "display_name": "jkim615", "link": "https://stackoverflow.com/users/12052106/jkim615"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1568286524, "creation_date": 1568229547, "last_edit_date": 1568286524, "question_id": 57895565, "link": "https://stackoverflow.com/questions/57895565/findoneandupdate-function-does-not-update-the-database", "title": "FindOneAndUpdate function does not update the database", "body": "<p>I'm creating a REST api using Go and Mongo. I am still fairly new to the languages. So basically, I call this function to update existing data in a database. It is not actually updating anything in the database.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func UpdateCompanyEndpoint(response http.ResponseWriter, request *http.Request) {\n    response.Header().Set(\"content-type\", \"application/json\")\n    params := mux.Vars(request)\n    name, _ := params[\"name\"]\n    var company Company\n    _ = json.NewDecoder(request.Body).Decode(&amp;company)\n    filter := bson.D{{\"name\", name}}\n    fmt.Println(name)\n    update := bson.D{{\"$set\", bson.D{{\"application\", company.Application}}}}\n    collection := client.Database(\"RESTful\").Collection(\"companies\")\n    doc := collection.FindOneAndUpdate(\n        context.Background(),\n        filter,\n        update,\n        nil)\n    fmt.Println(doc)\n}\n</code></pre>\n\n<p>The database looks like this:</p>\n\n<pre><code>[\n    {\n        \"name\": \"Test1\",\n        \"application\": \"Test1\"\n    },\n    {\n        \"name\": \"Test2\",\n        \"application\": \"Test2\"\n    },\n    {\n        \"name\": \"Test3\",\n        \"application\": \"Test3\"\n    }\n]\n</code></pre>\n\n<p>I call the put method on <a href=\"http://localhost:8080/update/Test2\" rel=\"nofollow noreferrer\">http://localhost:8080/update/Test2</a> with:</p>\n\n<pre><code>{\n    \"name\": \"Test2\",\n    \"application\": \"Test2update\"\n}\n</code></pre>\n\n<p>However, it does not update anything in the database.\nHere is the code: <a href=\"https://github.com/jasonkim615/internship-db/blob/master/main.go\" rel=\"nofollow noreferrer\">https://github.com/jasonkim615/internship-db/blob/master/main.go</a></p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 614, "user_id": 666259, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4fb38875b875d5d14defba30661c9668?s=128&d=identicon&r=PG", "display_name": "Markus", "link": "https://stackoverflow.com/users/666259/markus"}, "edited": false, "score": 0, "creation_date": 1581001998, "post_id": 57895109, "comment_id": 106291123, "body": "You&#39;ve probably solved it by now, but further error information is usually present in the response body from AWS."}, {"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "reply_to_user": {"reputation": 614, "user_id": 666259, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4fb38875b875d5d14defba30661c9668?s=128&d=identicon&r=PG", "display_name": "Markus", "link": "https://stackoverflow.com/users/666259/markus"}, "edited": false, "score": 0, "creation_date": 1581258882, "post_id": 57895109, "comment_id": 106362986, "body": "Thanks. There was a bug with the SDK (can\u2019t remember what exactly), so I used Python instead... project was using AWS Lambda, so wasn\u2019t hard to swap out. Maybe bug has been fixed at this point."}], "owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 191, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1568227507, "creation_date": 1568227507, "question_id": 57895109, "link": "https://stackoverflow.com/questions/57895109/aws-presigned-url-not-implemented-using-go", "title": "AWS Presigned URL &quot;Not Implemented&quot; using Go", "body": "<p>Trying to use presigned URLs to upload a file to S3 using Go.</p>\n\n<p>I took AWS's own example and modified it to add a file (rather than just text).</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\npackage main\n\nimport (\n    \"crypto/md5\"\n    \"encoding/base64\"\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n    \"strings\"\n    \"time\"\n\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/s3\"\n)\n\n// Downloads an item from an S3 Bucket in the region configured in the shared config\n// or AWS_REGION environment variable.\n//\n// Usage:\n//    go run s3_download.go\nfunc main() {\n    h := md5.New()\n    content := strings.NewReader(\"\")\n    content.WriteTo(h)\n\n    // Initialize a session in us-west-2 that the SDK will use to load\n    // credentials from the shared credentials file ~/.aws/credentials.\n    sess, err := session.NewSession(&amp;aws.Config{\n        Region: aws.String(\"us-west-2\")},\n    )\n\n    // Create S3 service client\n    svc := s3.New(sess)\n\n    bucket_name := \"just.some.bucket\"\n    object_key := \"7920629709534756622.png\"\n    file, err := os.Open(object_key)\n    if err != nil {\n        fmt.Println(err)\n    }\n    defer file.Close()\n\n    resp, _ := svc.PutObjectRequest(&amp;s3.PutObjectInput{\n        Bucket: aws.String(bucket_name),\n        Key:    aws.String(object_key),\n    })\n\n    md5s := base64.StdEncoding.EncodeToString(h.Sum(nil))\n    resp.HTTPRequest.Header.Set(\"Content-MD5\", md5s)\n\n    url, err := resp.Presign(15 * time.Minute)\n    if err != nil {\n        fmt.Println(\"error presigning request\", err)\n        return\n    }\n\n    req, err := http.NewRequest(\"PUT\", url, file)\n    req.Header.Set(\"Content-MD5\", md5s)\n    if err != nil {\n        fmt.Println(\"error creating request\", url)\n        return\n    }\n\n    defClient, err := http.DefaultClient.Do(req)\n    fmt.Println(defClient, err)\n}\n</code></pre>\n\n<p>I'm receiving a <code>Not Implemented 501</code> error and can't figure out why.  </p>\n\n<p>The bucket is new with default settings. Do I need to add CORS allowances or something?</p>\n"}, {"tags": ["go", "time", "reflection", "tags"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568228221, "post_id": 57895092, "comment_id": 102211788, "body": "Do you want to associate the tag with type <code>Custom</code> or is the tag associated with the use of <code>Custom</code> in <code>Out.C</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1568227723, "creation_date": 1568227723, "answer_id": 57895164, "question_id": 57895092, "link": "https://stackoverflow.com/questions/57895092/how-to-access-a-struct-tag-from-inside-a-field-type-in-golang/57895164#57895164", "title": "How to access a struct tag from inside a field-type in golang", "body": "<p>That's not possible. Tags belong to struct fields, not types. So type <code>C</code> has no way of knowing what tag was used. Also, how would it work if:</p>\n\n<pre><code>type A struct {\n  C Custom `tag1`\n}\ntype B struct {\n  C Custom `tag2`\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 0, "last_activity_date": 1568234934, "creation_date": 1568234934, "answer_id": 57896622, "question_id": 57895092, "link": "https://stackoverflow.com/questions/57895092/how-to-access-a-struct-tag-from-inside-a-field-type-in-golang/57896622#57896622", "title": "How to access a struct tag from inside a field-type in golang", "body": "<p>Since the question has <code>reflection</code> tagged, to go that route you'd need to pass in the <code>Out</code>-type in some fashion to your un/marshalling methods e.g.</p>\n\n<pre><code>var o *Out // nil-pointer so we don't waste any space\n\nc := Custom{}\n\n// bs is of type []byte{}\n\nerr := MyUnmarshalerWithReflect(bs, &amp;c, o)\n</code></pre>\n\n<p>So maybe this is an <a href=\"https://en.wikipedia.org/wiki/XY_problem\" rel=\"nofollow noreferrer\">XY problem</a> and it's more intuitive to <code>Unmarshal</code> directly with the desired time-format e.g.</p>\n\n<pre><code>err := MyUnmarshalerWithTimeFormat(bs, &amp;c, \"2006-01-02\")\n</code></pre>\n"}], "owner": {"reputation": 487, "user_id": 3004786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mQ3jy.jpg?s=128&g=1", "display_name": "huehnerhose", "link": "https://stackoverflow.com/users/3004786/huehnerhose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1568234934, "creation_date": 1568227446, "question_id": 57895092, "link": "https://stackoverflow.com/questions/57895092/how-to-access-a-struct-tag-from-inside-a-field-type-in-golang", "title": "How to access a struct tag from inside a field-type in golang", "body": "<p>I want to know if and how it is possible to access a struct tag set from a custom type used inside this struct. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Out struct {\n    C Custom `format:\"asd\"`\n}\n\ntype Custom struct {\n}\n\nfunc (c Custom) GetTag() string {\n    // somehow get access to `format:\"asd\"`\n}\n</code></pre>\n\n<p>My goal is to be able to define a timeformat for un/marshaling and handle the actual time-unmarshalling parameterized by the structtag.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "stackdriver", "distributed-tracing", "google-cloud-trace", "opencensus"], "answers": [{"comments": [{"owner": {"reputation": 2008, "user_id": 710618, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/779233af08fd9f187990a44146f1778c?s=128&d=identicon&r=PG", "display_name": "Alexandre Thenorio", "link": "https://stackoverflow.com/users/710618/alexandre-thenorio"}, "edited": false, "score": 0, "creation_date": 1568289329, "post_id": 57898349, "comment_id": 102232205, "body": "Thank you but opencensus seems to already generate this ID on each span along the way. I am not talking about logging or metrics here, just tracing"}], "tags": [], "owner": {"reputation": 11, "user_id": 11612493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/207b08a4b63341dfce2623acaaf8d937?s=128&d=identicon&r=PG&f=1", "display_name": "SachinKapale", "link": "https://stackoverflow.com/users/11612493/sachinkapale"}, "is_accepted": false, "score": 0, "last_activity_date": 1568249054, "creation_date": 1568249054, "answer_id": 57898349, "question_id": 57894336, "link": "https://stackoverflow.com/questions/57894336/how-to-tracing-a-request-through-a-chain-of-microservices-end-to-end/57898349#57898349", "title": "How to tracing a request through a chain of microservices end-to-end?", "body": "<p>Architecturally I will say when you are developing your microservices make sure your API Gateway creates a unique id like GUID, which gets propagated through all the microservices &amp; similarly you make sure that you have log aggregator which will be collecting logs from all the services &amp; finally you are getting nice tracebility of request. </p>\n"}], "owner": {"reputation": 2008, "user_id": 710618, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/779233af08fd9f187990a44146f1778c?s=128&d=identicon&r=PG", "display_name": "Alexandre Thenorio", "link": "https://stackoverflow.com/users/710618/alexandre-thenorio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 182, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1573500211, "creation_date": 1568223973, "last_edit_date": 1573500211, "question_id": 57894336, "link": "https://stackoverflow.com/questions/57894336/how-to-tracing-a-request-through-a-chain-of-microservices-end-to-end", "title": "How to tracing a request through a chain of microservices end-to-end?", "body": "<p>I am using OpenCensus in Go to push tracing data to Stackdriver for calls involving a chain of 2 or more micro services and I noticed that I get many traces which contain spans only for certain services but not the entire end to end call.</p>\n\n<p>At the moment I attribute this to the fact that not all calls are traced (only a certain sample) and each service decides whether to trace its current span or not.</p>\n\n<p>Is this the way it is intended to work? Is there any way to make sure when a trace is sampled, it is done so by all services in the call chain?</p>\n"}, {"tags": ["go", "packaging", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 0, "last_activity_date": 1568224378, "creation_date": 1568224378, "answer_id": 57894409, "question_id": 57894092, "link": "https://stackoverflow.com/questions/57894092/go-library-cannot-find-module-providing-package-lib/57894409#57894409", "title": "Go library: cannot find module providing package lib", "body": "<p>The directory structure and package names are a bit off - it should be a URL to your project's repo, like every other import that isn't from the stdlib. If you have no repo and want to use local references you'll need to add a <code>replace</code> directive to <code>ace/go.mod</code> like so:</p>\n\n<pre><code>replace aceslib =&gt; ../aceslib\n</code></pre>\n\n<p>As documented <a href=\"https://github.com/golang/go/wiki/Modules#can-i-work-entirely-outside-of-vcs-on-my-local-filesystem\" rel=\"nofollow noreferrer\">in the Modules docs</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 307, "user_id": 6013979, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a9a594885e641ccaa827d19d1ca303c4?s=128&d=identicon&r=PG&f=1", "display_name": "yulivee", "link": "https://stackoverflow.com/users/6013979/yulivee"}, "edited": false, "score": 0, "creation_date": 1568226447, "post_id": 57894692, "comment_id": 102211032, "body": "ace and aces-client share structs and some functionality, thats the reason for the seperation"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 307, "user_id": 6013979, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a9a594885e641ccaa827d19d1ca303c4?s=128&d=identicon&r=PG&f=1", "display_name": "yulivee", "link": "https://stackoverflow.com/users/6013979/yulivee"}, "edited": false, "score": 0, "creation_date": 1568226853, "post_id": 57894692, "comment_id": 102211227, "body": "Yes, but you don&#39;t need to make them separate modules. They can still be separate packages under a single module."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1568225609, "creation_date": 1568225609, "answer_id": 57894692, "question_id": 57894092, "link": "https://stackoverflow.com/questions/57894092/go-library-cannot-find-module-providing-package-lib/57894692#57894692", "title": "Go library: cannot find module providing package lib", "body": "<p>IIRC, package names without directories are reserved for stdlib packages. So, you should first push the source tree down at least a level so you can access it by \"dir/package\".</p>\n\n<p>Next, do you really want to treat these packages as separate modules? You have separate mod files under ace and aceslib packages. You may combine them under one module with a single go.mod at the project root and make life easier for yourself. That way you don't need redirects, etc.</p>\n\n<p>You also have to include the modules with their directories:</p>\n\n<pre><code>import lib \"dir/aceslib\"\n</code></pre>\n"}], "owner": {"reputation": 307, "user_id": 6013979, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a9a594885e641ccaa827d19d1ca303c4?s=128&d=identicon&r=PG&f=1", "display_name": "yulivee", "link": "https://stackoverflow.com/users/6013979/yulivee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 496, "favorite_count": 0, "accepted_answer_id": 57894409, "answer_count": 2, "score": -1, "last_activity_date": 1568225609, "creation_date": 1568222782, "last_edit_date": 1568223257, "question_id": 57894092, "link": "https://stackoverflow.com/questions/57894092/go-library-cannot-find-module-providing-package-lib", "title": "Go library: cannot find module providing package lib", "body": "<p>I am creating 3 separate go projects: <code>ace</code>, <code>aces-client</code> and a library shared by both projects <code>aceslib</code>. I am having trouble including the shared library according to the go-documentation (<a href=\"https://golang.org/doc/code.html#Library\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html#Library</a>)</p>\n\n<p>all go files in aceslib share the package-name <code>aceslib</code>. I am including the library in ace and aces-client with <code>import lib \"aceslib\"</code>. I can build the library with <code>go build</code> and it gets installed with <code>go install</code>, in the directory listing one can see that the file <code>go/pkg/windows_amd64/aceslib.a</code> gets created.</p>\n\n<p>But when I try to build <code>ace</code> or <code>ace-client</code> go complains:</p>\n\n<pre><code>$ go build \nbuild ace: cannot load aceslib: cannot find module providing package aceslib\n</code></pre>\n\n<p>My go setup:</p>\n\n<pre><code>$ go version\ngo version go1.12.9 windows/amd64\n$ go env\nset GOARCH=amd64\nset GOBIN=\nset GOCACHE=C:\\Users\\Yulivee\\AppData\\Local\\go-build\nset GOEXE=.exe\nset GOFLAGS=\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOOS=windows\nset GOPATH=C:\\Users\\Yulivee\\go\nset GOPROXY=\nset GORACE=\nset GOROOT=c:\\go\nset GOTMPDIR=\nset GOTOOLDIR=c:\\go\\pkg\\tool\\windows_amd64\nset GCCGO=gccgo\nset CC=gcc\nset CXX=g++\nset CGO_ENABLED=1\nset GOMOD=C:\\Users\\Yulivee\\go\\src\\ace\\go.mod\nset CGO_CFLAGS=-g -O2\nset CGO_CPPFLAGS=\nset CGO_CXXFLAGS=-g -O2\nset CGO_FFLAGS=-g -O2\nset CGO_LDFLAGS=-g -O2\nset PKG_CONFIG=pkg-config\nset GOGCCFLAGS=-m64 -mthreads -fmessage-length=0 -fdebug-prefix-map=C:\\Users\\Yulivee\\AppData\\Local\\Temp\\go-build024649150=/tmp/go-build -gno-record-gcc-switches\n</code></pre>\n\n<p>Directory Structure:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 bin\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ace-client.exe\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 ace.exe\n\u251c\u2500\u2500 pkg\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 mod\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 cache\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 golang.org\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 windows_amd64\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 ace\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 aceslib.a\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 golang.org\n\u2514\u2500\u2500 src\n    \u251c\u2500\u2500 ace\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 README.md\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 go.mod\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 go.sum\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 main.go\n    \u251c\u2500\u2500 ace-client\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 main.go\n    \u251c\u2500\u2500 aceslib\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 README.md\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 crypto.go\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 go.mod\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 utils.go\n</code></pre>\n\n<p>What am I missing?</p>\n\n<hr>\n\n<p>Things I have tried, that did not help and lead to the same error:</p>\n\n<pre><code>$ go clean -i -x -cache -modcache\n$ chmod 755 go/pkg/windows_amd64/aceslib.a\n$ go get\nbuild ace: cannot load aceslib: cannot find module providing package aceslib\n$ rm -rf go/pkg/*\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568218406, "post_id": 57893004, "comment_id": 102207617, "body": "Have you considered passing both, the single type instance and the slice instance into your generic func? Then you can avoid having to use reflect."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1568218549, "post_id": 57893004, "comment_id": 102207698, "body": "<a href=\"https://golang.org/pkg/reflect/#MakeSlice\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect/#MakeSlice</a> ie <a href=\"https://play.golang.org/p/p_hOGik5jqD\" rel=\"nofollow noreferrer\">play.golang.org/p/p_hOGik5jqD</a>"}, {"owner": {"reputation": 93, "user_id": 12053978, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCBOuGPWdr7YpDhqjgFVWI3lfivQNnyKzCnTssx=k-s128", "display_name": "LZR", "link": "https://stackoverflow.com/users/12053978/lzr"}, "edited": false, "score": 0, "creation_date": 1568277097, "post_id": 57893004, "comment_id": 102225638, "body": "Sadly, when I use :   reflect.MakeSlice(reflect.SliceOf(reflect.TypeOf(data)), 0, 20).Interface() :  -  or I get: reflect.flag.mustBeAssignable using unaddressable value - or it&#39;s not considered as a slice or interface  Depending on using a pointer or not on the call :  GetDB().LogMode(true).Model(data).Offset(offset).Limit(pages&zwnj;&#8203;ize).Find(pages)  If I use []interface{} in argumet of my function, it doesn&#39;t allow me to pass []&amp;models.User{}"}], "answers": [{"tags": [], "owner": {"reputation": 93, "user_id": 12053978, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCBOuGPWdr7YpDhqjgFVWI3lfivQNnyKzCnTssx=k-s128", "display_name": "LZR", "link": "https://stackoverflow.com/users/12053978/lzr"}, "is_accepted": false, "score": 4, "last_activity_date": 1568278206, "creation_date": 1568278206, "answer_id": 57903068, "question_id": 57893004, "link": "https://stackoverflow.com/questions/57893004/how-to-use-reflection-type-for-gorm-to-generalize-an-api-function/57903068#57903068", "title": "How to use reflection type for gorm to generalize an api function", "body": "<p>I found the solution !!</p>\n\n<pre><code>func GenericGetAll(w http.ResponseWriter, r *http.Request, data interface{}) {\n    dtype := reflect.TypeOf(data)\n    pages := reflect.New(reflect.SliceOf(dtype)).Interface()\n    offset, pagesize, order := GetAllFromDb(r)\n    err := error(nil)\n    if offset &lt;= 0 &amp;&amp; pagesize &lt;= 0 {\n        err = errors.New(order)\n    }\n\n    if order != \"\" {\n        err = GetDB().LogMode(true).Model(data).Order(order).Offset(offset).Limit(pagesize).Find(pages).Error\n    } else {\n        err = GetDB().LogMode(true).Model(data).Offset(offset).Limit(pagesize).Find(pages).Error\n    }\n    if err != nil {\n        utils.Respond(w, utils.Message(false, fmt.Sprintf(\"Error while retrieving data\")))\n        return\n    }\n    resp := utils.Message(true, \"data returned\")\n    resp[\"data\"] = pages\n    utils.Respond(w, resp)\n\n}\n</code></pre>\n\n<p>Instead of getting an interface of an Elem()</p>\n\n<pre><code>reflect.New(reflect.SliceOf(dtype)).Elem().Interface()\n</code></pre>\n\n<p>Which return <strong>[]*models.User</strong></p>\n\n<p>The solution was to use directly an Interface :</p>\n\n<pre><code>pages := reflect.New(reflect.SliceOf(dtype)).Interface()\n</code></pre>\n\n<p>Which return <strong>*[]*models.User</strong> that is accepted by gorm's interface :)</p>\n"}], "owner": {"reputation": 93, "user_id": 12053978, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCBOuGPWdr7YpDhqjgFVWI3lfivQNnyKzCnTssx=k-s128", "display_name": "LZR", "link": "https://stackoverflow.com/users/12053978/lzr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 541, "favorite_count": 3, "answer_count": 1, "score": 4, "last_activity_date": 1568278206, "creation_date": 1568217938, "question_id": 57893004, "link": "https://stackoverflow.com/questions/57893004/how-to-use-reflection-type-for-gorm-to-generalize-an-api-function", "title": "How to use reflection type for gorm to generalize an api function", "body": "<p>I'm developping an API with lots of models using go-gorm.\nSo far for the \"GetAll\" function, i've been using the following (simplified) :</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func GetAllUsers(w,r){\n//... get params and do some check \npages := []*models.User{} //&lt;-main problem I have to give the full type \nmodels.GetDB().Model(&amp;models.User{}).Offset(offset).Limit(pagesize).Find(&amp;pages)\n//do the http response(w,pages)\n}\n</code></pre>\n\n<p>But I'd like to avoid copying/pasting the function to just modify the type (here models.User) to get all models from db.</p>\n\n<p>I did try different approach using reflect or interface but none seems to work like :</p>\n\n<pre><code>func GenericGetAll(w http.ResponseWriter, r *http.Request, data interface{}) {\n    dtype := reflect.TypeOf(data)\n    pages := reflect.New(reflect.SliceOf(dtype)).Elem().Interface()\n    log.Printf(\"%+v\", pages)\n    //reflect.MakeSlice(reflect.SliceOf(reflect.TypeOf(data)), 0, 20)\n    //new([]gorm.Model)\n    GetDB().LogMode(true).Model(data).Offset(offset).Limit(pagesize).Find(&amp;pages)\n\nutils.Respond(w, pages)\n\n}\n</code></pre>\n\n<p>So I could use this directly in my handlers :</p>\n\n<pre><code>GenericGetAll(w,r,&amp;models.User{}) for user\nGenericGetAll(w,r,&amp;models.Product{}) for Product\nGenericGetAll(w,r,&amp;models.Company{}) for Company\n</code></pre>\n\n<p>This would be cleaner than copying/pasting the other function just to modify the type ...</p>\n\n<p>But using those different approach give problems :</p>\n\n<ul>\n<li>[]*interface{}, I lose the table name and get a sql error because tablename '' doesn't exist</li>\n<li>new([]gorm.Model) it lose my tablename and use gorm.model default tablename :/</li>\n<li>reflect.New(reflect.SliceOf(dtype)).Elem().Interface() and I get an error : unsupported destination, should be slice or struct evenif it did create the slice :/ the log.printf() give an empty array []</li>\n</ul>\n\n<p><strong>How should I use reflect to get a slice from the type in argument of the function ?</strong></p>\n\n<p>Is this only doable with Golang ? I know that polymorphism doesn't exist in golang but ... this is a required features or is there something magic I don't know about golang ? ^^.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["database", "pointers", "go", "time", "null"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1568217750, "post_id": 57892148, "comment_id": 102207286, "body": "i prefer to use std types so that if i use a library to encode/decode/check an input, that maps straight to the db, it just works. To me the meaning of a pointer within a db struct is rather clear."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568218117, "post_id": 57892148, "comment_id": 102207482, "body": "Note also that you can use COALESCE and NULLIF in your queries... It will make the Go code a bit simpler but in turn you&#39;ll have to write more sql."}], "answers": [{"tags": [], "owner": {"reputation": 30574, "user_id": 427763, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e7314f6ed3c46d62ce8671cad2c82b97?s=128&d=identicon&r=PG", "display_name": "prolink007", "link": "https://stackoverflow.com/users/427763/prolink007"}, "is_accepted": false, "score": -1, "last_activity_date": 1568216929, "last_edit_date": 1568216929, "creation_date": 1568215690, "answer_id": 57892393, "question_id": 57892148, "link": "https://stackoverflow.com/questions/57892148/what-is-better-to-use-nil-or-null-for-nullable-stuct-fields/57892393#57892393", "title": "What is better to use nil or Null* for nullable stuct fields", "body": "<p>I would recommend using the <code>sql.Null</code> types, because it is easier to understand what is going on when reading the code.</p>\n\n<p>If you are using nil pointers it is unclear what you are trying to accomplish by making those fields pointers.</p>\n"}, {"tags": [], "owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "is_accepted": false, "score": 2, "last_activity_date": 1568223338, "last_edit_date": 1568223338, "creation_date": 1568219192, "answer_id": 57893300, "question_id": 57892148, "link": "https://stackoverflow.com/questions/57892148/what-is-better-to-use-nil-or-null-for-nullable-stuct-fields/57893300#57893300", "title": "What is better to use nil or Null* for nullable stuct fields", "body": "<p>Go lacks <a href=\"https://en.wikipedia.org/wiki/Void_safety\" rel=\"nofollow noreferrer\">null safety</a>, so this is a workaround. <a href=\"https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare/\" rel=\"nofollow noreferrer\">Null pointers are problematic.</a> . </p>\n\n<p>By using <code>sql.NullType</code> you will get the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">Zero value</a> instead of a <code>Nil</code> in the scanned field. This fact, when hitting an edge case, could be the difference between panicking or not for your application.</p>\n\n<p>As a rule of thumb, <strong>when in doubt, do not use a pointer.</strong></p>\n"}], "owner": {"reputation": 1481, "user_id": 469898, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/Qf9DF.jpg?s=128&g=1", "display_name": "Dr.eel", "link": "https://stackoverflow.com/users/469898/dr-eel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "closed_date": 1568240085, "answer_count": 2, "score": 1, "last_activity_date": 1568362976, "creation_date": 1568214775, "last_edit_date": 1568362976, "question_id": 57892148, "link": "https://stackoverflow.com/questions/57892148/what-is-better-to-use-nil-or-null-for-nullable-stuct-fields", "closed_reason": "Opinion-based", "title": "What is better to use nil or Null* for nullable stuct fields", "body": "<p><a href=\"https://stackoverflow.com/questions/24564619/nullable-time-time-in-golang\">Here</a> I saw a question about nullable fields in struct. \nFrom Go 1.13 you can use <a href=\"https://golang.org/pkg/database/sql/#NullTime\" rel=\"nofollow noreferrer\">sql.NullTime</a> (earlier declared in <code>pg</code> and <code>mysql</code>). \nFrom now we can use these two options to declare the <code>ResolvedAt</code> nullable time field:</p>\n\n<p>A. ResolvedAt as NullTime:</p>\n\n<pre><code>type Event struct {\n    Id         int   \n    Resolved   bool\n    CreatedAt  time.Time\n    ResolvedAt sql.NullTime        \n}\n</code></pre>\n\n<p>B. ResolvedAt as pointer:</p>\n\n<pre><code>type Event struct {\n    Id         int \n    Resolved   bool\n    CreatedAt  time.Time\n    ResolvedAt *time.Time\n}\n</code></pre>\n\n<p>For <code>Scan</code> method there is no difference:</p>\n\n<pre><code>rows, err := db.Query(\"SELECT * FROM Event\")\n\nfor rows.Next() {\n    e:= new(Event)\n    err := rows.Scan(&amp;e.Id, &amp;e.CreatedAt, &amp;e.ResolvedAt)\n}  \n</code></pre>\n\n<p>But when testing for Null there is a difference:</p>\n\n<pre><code>// A. \ne.Resolved = (e.ResolvedAt != nil)  \n// B.  \ne.Resolved = (e.ResolvedAt.Valid)\n</code></pre>\n\n<p><em>In which case is SHOULD to use Null... type rather then pointer?</em></p>\n"}, {"tags": ["go", "logging", "google-cloud-platform"], "answers": [{"comments": [{"owner": {"reputation": 404, "user_id": 6017902, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pVJYw.png?s=128&g=1", "display_name": "jwtea", "link": "https://stackoverflow.com/users/6017902/jwtea"}, "edited": false, "score": 0, "creation_date": 1568206213, "post_id": 57889335, "comment_id": 102200714, "body": "Hi Pawel, Ideally i&#39;d prefer not to tie in the logging to GCP"}, {"owner": {"reputation": 1040, "user_id": 11135159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcb3b536ae330b4e19e8359824aef583?s=128&d=identicon&r=PG&f=1", "display_name": "Pawel Czuczwara", "link": "https://stackoverflow.com/users/11135159/pawel-czuczwara"}, "reply_to_user": {"reputation": 404, "user_id": 6017902, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pVJYw.png?s=128&g=1", "display_name": "jwtea", "link": "https://stackoverflow.com/users/6017902/jwtea"}, "edited": false, "score": 0, "creation_date": 1568206430, "post_id": 57889335, "comment_id": 102200831, "body": "This is the recommended solution."}, {"owner": {"reputation": 404, "user_id": 6017902, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pVJYw.png?s=128&g=1", "display_name": "jwtea", "link": "https://stackoverflow.com/users/6017902/jwtea"}, "edited": false, "score": 0, "creation_date": 1568207086, "post_id": 57889335, "comment_id": 102201250, "body": "If you want to use stack driver yes, however i&#39;m talking about the log viewer on GCP  and don&#39;t want to couple the application to stack driver logging"}, {"owner": {"reputation": 1040, "user_id": 11135159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcb3b536ae330b4e19e8359824aef583?s=128&d=identicon&r=PG&f=1", "display_name": "Pawel Czuczwara", "link": "https://stackoverflow.com/users/11135159/pawel-czuczwara"}, "reply_to_user": {"reputation": 404, "user_id": 6017902, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pVJYw.png?s=128&g=1", "display_name": "jwtea", "link": "https://stackoverflow.com/users/6017902/jwtea"}, "edited": false, "score": 0, "creation_date": 1568207264, "post_id": 57889335, "comment_id": 102201343, "body": "You could give a try <a href=\"https://github.com/znly/logrus-gce\" rel=\"nofollow noreferrer\">GCP formatter for logrus</a>, however your code would need change. And I did not test this solution."}, {"owner": {"reputation": 1040, "user_id": 11135159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcb3b536ae330b4e19e8359824aef583?s=128&d=identicon&r=PG&f=1", "display_name": "Pawel Czuczwara", "link": "https://stackoverflow.com/users/11135159/pawel-czuczwara"}, "reply_to_user": {"reputation": 404, "user_id": 6017902, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pVJYw.png?s=128&g=1", "display_name": "jwtea", "link": "https://stackoverflow.com/users/6017902/jwtea"}, "edited": false, "score": 0, "creation_date": 1568209228, "post_id": 57889335, "comment_id": 102202498, "body": "I did update the answer, please accept it if it worked for you, for better visibility for another users."}], "tags": [], "owner": {"reputation": 1040, "user_id": 11135159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcb3b536ae330b4e19e8359824aef583?s=128&d=identicon&r=PG&f=1", "display_name": "Pawel Czuczwara", "link": "https://stackoverflow.com/users/11135159/pawel-czuczwara"}, "is_accepted": false, "score": 3, "last_activity_date": 1568208358, "last_edit_date": 1568208358, "creation_date": 1568205323, "answer_id": 57889335, "question_id": 57888588, "link": "https://stackoverflow.com/questions/57888588/logging-to-stderr-and-stdout-golang-google-cloud-platform/57889335#57889335", "title": "Logging to stderr and stdout golang Google Cloud Platform", "body": "<p>You can use Stackdriver library package for GoLang:</p>\n\n<pre><code>go get -u cloud.google.com/go/logging\n</code></pre>\n\n<p>Then you can use StandardLogger:</p>\n\n<pre><code>// Sample stdlogging writes log.Logger logs to the Stackdriver Logging.\npackage main\n\nimport (\n        \"context\"\n        \"log\"\n\n        \"cloud.google.com/go/logging\"\n)\n\nfunc main() {\n        ctx := context.Background()\n\n        // Sets your Google Cloud Platform project ID.\n        projectID := \"YOUR_PROJECT_ID\"\n\n        // Creates a client.\n        client, err := logging.NewClient(ctx, projectID)\n        if err != nil {\n                log.Fatalf(\"Failed to create client: %v\", err)\n        }\n        defer client.Close()\n\n        // Sets the name of the log to write to.\n        logName := \"my-log\"\n\n        logger := client.Logger(logName).StandardLogger(logging.Info)\n\n        // Logs \"hello world\", log entry is visible at\n        // Stackdriver Logs.\n        logger.Println(\"hello world\")\n}\n</code></pre>\n\n<p>Here you can find <a href=\"https://cloud.google.com/logging/docs/setup/go\" rel=\"nofollow noreferrer\">documentation on Google Cloud website</a></p>\n\n<p>Update: <hr>\nAlternatively you could give a try <a href=\"https://github.com/znly/logrus-gce\" rel=\"nofollow noreferrer\">GCP formatter for logrus</a></p>\n\n<p>This will not tie your app to Google Cloud Platform. However, it does not mean that on another platform you will not need to change your code to format output.</p>\n\n<p>Using StackDriver library is the recommended solution for Google Cloud.</p>\n"}, {"tags": [], "owner": {"reputation": 3359, "user_id": 122727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5e946def051f311e802140ecb9fbf?s=128&d=identicon&r=PG", "display_name": "kubanczyk", "link": "https://stackoverflow.com/users/122727/kubanczyk"}, "is_accepted": false, "score": 0, "last_activity_date": 1611582189, "creation_date": 1611582189, "answer_id": 65885968, "question_id": 57888588, "link": "https://stackoverflow.com/questions/57888588/logging-to-stderr-and-stdout-golang-google-cloud-platform/65885968#65885968", "title": "Logging to stderr and stdout golang Google Cloud Platform", "body": "<p>I recommend the <a href=\"https://github.com/apsystole/log\" rel=\"nofollow noreferrer\">https://github.com/apsystole/log</a>. You can swap either <code>log</code> and <code>logrus</code> imports for it. It is a small zero-dependency module, hence much lighter than logrus.</p>\n"}], "owner": {"reputation": 404, "user_id": 6017902, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pVJYw.png?s=128&g=1", "display_name": "jwtea", "link": "https://stackoverflow.com/users/6017902/jwtea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1516, "favorite_count": 2, "answer_count": 2, "score": 4, "last_activity_date": 1611582189, "creation_date": 1568202876, "question_id": 57888588, "link": "https://stackoverflow.com/questions/57888588/logging-to-stderr-and-stdout-golang-google-cloud-platform", "title": "Logging to stderr and stdout golang Google Cloud Platform", "body": "<p>Currently running a go service on GCP however in the logs viewer every message is treated as an error.</p>\n\n<p>Is there a generally advised way of logging to stderr and stdout depending on the log level. Ie errors to stderr and anything else to stdout.</p>\n\n<p>I'm currently using the <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">logrus</a> package and have come across this implementation. Other ways i see achieving this while still using the same package is to pass the logger to each package that needs it or to create a global log object, neither of which i am too keen on.</p>\n\n<p><a href=\"https://github.com/microsoft/fabrikate/pull/252/commits/bd24d62d7c2b851ad6e7b36653eb0a6dc364474b#diff-ed0770fdbf87b0c6d536e33a99a8df9c\" rel=\"nofollow noreferrer\">https://github.com/microsoft/fabrikate/pull/252/commits/bd24d62d7c2b851ad6e7b36653eb0a6dc364474b#diff-ed0770fdbf87b0c6d536e33a99a8df9c</a></p>\n"}, {"tags": ["go", "int"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 9, "creation_date": 1568196814, "post_id": 57886864, "comment_id": 102195747, "body": "The first one is converting a constant, the other one a variable. The are different rules when converting contants. <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Conversions</a> <b>Constants:</b> <code>int(1.2) &#47;&#47; illegal: 1.2 cannot be represented as an int</code> <b>Non-Constant:</b> x can be converted to type T if <code>x&#39;s type and T are both integer or floating point types.</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 6, "creation_date": 1568196915, "post_id": 57886864, "comment_id": 102195793, "body": "See related / possible duplicate: <a href=\"https://stackoverflow.com/questions/39444852/does-go-compilers-evaluation-differ-for-constant-expression-and-other-expressio/39445372#39445372\">Does Go compiler&#39;s evaluation differ for constant expression and other expression</a>"}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 2, "creation_date": 1568199511, "post_id": 57886864, "comment_id": 102197106, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/16151199/go-lang-constant-truncated-to-integer\">GO lang - constant truncated to integer</a>"}], "owner": {"reputation": 27, "user_id": 5633195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dd4a2175fc3799c250679f465fe067c?s=128&d=identicon&r=PG&f=1", "display_name": "ymy", "link": "https://stackoverflow.com/users/5633195/ymy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1568196618, "creation_date": 1568196618, "question_id": 57886864, "link": "https://stackoverflow.com/questions/57886864/why-int0-1-is-error-but-x-0-1-y-intx-is-correct-in-golang", "title": "Why int(0.1) is error but x := 0.1; y := int(x) is correct in golang", "body": "<p>In Golang</p>\n\n<p>why \n<code>var y = int(0.1)</code> have a error\nbut <code>x := 0.1; y := int(x)</code> is ok?</p>\n"}, {"tags": ["mongodb", "rest", "go", "crud"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 12052106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f1f4da49fcec43a9d11632d9b9bc5ae?s=128&d=identicon&r=PG&f=1", "display_name": "jkim615", "link": "https://stackoverflow.com/users/12052106/jkim615"}, "edited": false, "score": 0, "creation_date": 1568221279, "post_id": 57886101, "comment_id": 102208928, "body": "Doesn&#39;t my FindOneAndUpdate function return the new and updated data, so there is no error if err == nil?"}, {"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "reply_to_user": {"reputation": 11, "user_id": 12052106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f1f4da49fcec43a9d11632d9b9bc5ae?s=128&d=identicon&r=PG&f=1", "display_name": "jkim615", "link": "https://stackoverflow.com/users/12052106/jkim615"}, "edited": false, "score": 0, "creation_date": 1568221762, "post_id": 57886101, "comment_id": 102209128, "body": "But why are you returning Internal Server Error if err == nil?"}, {"owner": {"reputation": 11, "user_id": 12052106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f1f4da49fcec43a9d11632d9b9bc5ae?s=128&d=identicon&r=PG&f=1", "display_name": "jkim615", "link": "https://stackoverflow.com/users/12052106/jkim615"}, "edited": false, "score": 0, "creation_date": 1568222203, "post_id": 57886101, "comment_id": 102209310, "body": "Ok, so I got rid of the error handling for now to try and make the code work. It still does not work. Maybe the issue is within my filter or update? Or is it in my FindOneAndUpdate?"}, {"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "reply_to_user": {"reputation": 11, "user_id": 12052106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f1f4da49fcec43a9d11632d9b9bc5ae?s=128&d=identicon&r=PG&f=1", "display_name": "jkim615", "link": "https://stackoverflow.com/users/12052106/jkim615"}, "edited": false, "score": 0, "creation_date": 1568222278, "post_id": 57886101, "comment_id": 102209338, "body": "try to log <code>err</code>"}, {"owner": {"reputation": 11, "user_id": 12052106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f1f4da49fcec43a9d11632d9b9bc5ae?s=128&d=identicon&r=PG&f=1", "display_name": "jkim615", "link": "https://stackoverflow.com/users/12052106/jkim615"}, "edited": false, "score": 0, "creation_date": 1568222747, "post_id": 57886101, "comment_id": 102209543, "body": "I see many examples online on github where they do not handle the error."}, {"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "reply_to_user": {"reputation": 11, "user_id": 12052106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f1f4da49fcec43a9d11632d9b9bc5ae?s=128&d=identicon&r=PG&f=1", "display_name": "jkim615", "link": "https://stackoverflow.com/users/12052106/jkim615"}, "edited": false, "score": 0, "creation_date": 1568223077, "post_id": 57886101, "comment_id": 102209680, "body": "I would not recommend that though"}], "tags": [], "owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "is_accepted": false, "score": 1, "last_activity_date": 1568194243, "creation_date": 1568194243, "answer_id": 57886101, "question_id": 57886029, "link": "https://stackoverflow.com/questions/57886029/why-does-my-update-function-return-the-new-query-but-not-update-the-database/57886101#57886101", "title": "Why does my update function return the new query but not update the database?", "body": "<p>Your problem is in this block:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if err == nil {\n    response.WriteHeader(http.StatusInternalServerError)\n    return\n}\njson.NewEncoder(response).Encode(company)\n</code></pre>\n\n<p>Notice carefully, you are sending <code>StatusInternalServerError</code> is <code>err</code> is <code>nil</code>, and you get the response you posted when <code>err != nil</code>, so some error is occuring in your case.</p>\n"}], "owner": {"reputation": 11, "user_id": 12052106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f1f4da49fcec43a9d11632d9b9bc5ae?s=128&d=identicon&r=PG&f=1", "display_name": "jkim615", "link": "https://stackoverflow.com/users/12052106/jkim615"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568209383, "creation_date": 1568193968, "last_edit_date": 1568209383, "question_id": 57886029, "link": "https://stackoverflow.com/questions/57886029/why-does-my-update-function-return-the-new-query-but-not-update-the-database", "title": "Why does my update function return the new query but not update the database?", "body": "<p>I am creating a RESTful API and am in the process of creating an update function. I use FindOneAndUpdate, and it doesn't actually update the database.</p>\n\n<p>I have tried many things, but I'm fairly new to the language so I'm a bit lost.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func UpdateCompanyEndpoint(response http.ResponseWriter, request *http.Request) {\n    response.Header().Set(\"content-type\", \"application/json\")\n    params := mux.Vars(request)\n    name, _ := params[\"name\"]\n    var company Company\n    _ = json.NewDecoder(request.Body).Decode(&amp;company)\n    collection := client.Database(\"RESTful\").Collection(\"companies\")\n    ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)\n    defer cancel()\n    filter := bson.D{{\"name\", name}}\n    update := bson.D{{\"$set\", bson.D{{\"application\", company.Application}}}}\n    err := collection.FindOneAndUpdate(\n        ctx,\n        filter,\n        update).Decode(&amp;company)\n    if err == nil {\n        response.WriteHeader(http.StatusInternalServerError)\n        return\n    }\n    json.NewEncoder(response).Encode(company)\n}\n</code></pre>\n\n<pre><code>[\n    {\n        \"name\": \"Test1\",\n        \"application\": \"Test1\"\n    },\n    {\n        \"name\": \"Test2\",\n        \"application\": \"Test2\"\n    },\n    {\n        \"name\": \"Test3\",\n        \"application\": \"Test3\"\n    }\n]\n</code></pre>\n\n<p>This is the current database. When I call the function, it returns:</p>\n\n<pre><code>{\n    \"name\": \"Test2\",\n    \"application\": \"Test2update\"\n}\n</code></pre>\n\n<p>but the database remains unchanged.</p>\n"}, {"tags": ["go", "ssh", "gitlab"], "comments": [{"owner": {"reputation": 36, "user_id": 3434532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1dca8c222cb1cbc478d69dffc89ebde4?s=128&d=identicon&r=PG&f=1", "display_name": "Weev", "link": "https://stackoverflow.com/users/3434532/weev"}, "edited": false, "score": 0, "creation_date": 1568194707, "post_id": 57885949, "comment_id": 112489359, "body": "Would you happen to have a file in your private repo with an asterisk in its name by any chance ?"}, {"owner": {"reputation": 751, "user_id": 12052086, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-3lmI35znrXQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcrRUavGlEPpVnOCo1GBhZfYDN4kg/photo.jpg?sz=128", "display_name": "noveaustack", "link": "https://stackoverflow.com/users/12052086/noveaustack"}, "reply_to_user": {"reputation": 36, "user_id": 3434532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1dca8c222cb1cbc478d69dffc89ebde4?s=128&d=identicon&r=PG&f=1", "display_name": "Weev", "link": "https://stackoverflow.com/users/3434532/weev"}, "edited": false, "score": 0, "creation_date": 1568195026, "post_id": 57885949, "comment_id": 112489360, "body": "well, no. only alphabetical characters and not even numeric."}], "answers": [{"tags": [], "owner": {"reputation": 751, "user_id": 12052086, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-3lmI35znrXQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcrRUavGlEPpVnOCo1GBhZfYDN4kg/photo.jpg?sz=128", "display_name": "noveaustack", "link": "https://stackoverflow.com/users/12052086/noveaustack"}, "is_accepted": false, "score": 44, "last_activity_date": 1568371206, "last_edit_date": 1568371206, "creation_date": 1568197318, "answer_id": 57887036, "question_id": 57885949, "link": "https://stackoverflow.com/questions/57885949/private-repo-go-1-13-go-mod-failed-ping-sum-golang-org-lookup-ver/57887036#57887036", "title": "private repo - go 1.13 - `go mod ..` failed: ping &quot;sum.golang.org/lookup&quot; .. verifying package .. 410 gone", "body": "<p>Answering my own question after looking up, </p>\n\n<p>Setting the GOPRIVATE variable seems to help.</p>\n\n<pre><code>GOPRIVATE=gitlab.com/mycompany/*  go mod why\n</code></pre>\n\n<p>\"\nThe new GOPRIVATE environment variable indicates module paths that are not publicly available. It serves as the default value for the lower-level GONOPROXY and GONOSUMDB variables, which provide finer-grained control over which modules are fetched via proxy and verified using the checksum database.\n\" from <a href=\"https://golang.org/doc/go1.13\" rel=\"noreferrer\">https://golang.org/doc/go1.13</a> </p>\n\n<p><strong>Aliter:</strong></p>\n\n<p>Setting the env variable GONOSUMDB also seems to work. \nSpecifically, invoking the following command seems to help.</p>\n\n<pre><code>    GONOSUMDB=gitlab.com/mycompany/* go mod why\n</code></pre>\n\n<p>The above env variable prevents the ping to sum.golang.org/lookup for a checksum match. It also prevents leaking the names of private repos to a public checksum db. [ Source - <a href=\"https://docs.gomods.io/configuration/sumdb/\" rel=\"noreferrer\">https://docs.gomods.io/configuration/sumdb/</a> ]</p>\n\n<p>Also - here at</p>\n\n<pre><code>  * GONOSUMDB=prefix1,prefix2,prefix3 sets a list of module path prefixes, again possibly containing globs, that should not be looked up using the database.\n</code></pre>\n\n<p>source: <a href=\"https://go.googlesource.com/proposal/+/master/design/25530-sumdb.md\" rel=\"noreferrer\">https://go.googlesource.com/proposal/+/master/design/25530-sumdb.md</a></p>\n\n<p>Related Issues:</p>\n\n<ul>\n<li><a href=\"https://github.com/golang/go/issues/32291\" rel=\"noreferrer\">https://github.com/golang/go/issues/32291</a> </li>\n<li><a href=\"https://github.com/golang/go/issues/33985\" rel=\"noreferrer\">https://github.com/golang/go/issues/33985</a> \n[\"Go 1.13 has been released, and this issue was filed well after the freeze window. The proposed changes will not happen in 1.13, but don't assume they will necessarily happen in 1.14 either.\" from issue 33985 above. ]</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 14451, "user_id": 1334561, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LhV7w.jpg?s=128&g=1", "display_name": "Muhammad Soliman", "link": "https://stackoverflow.com/users/1334561/muhammad-soliman"}, "is_accepted": false, "score": 7, "last_activity_date": 1582174827, "last_edit_date": 1582174827, "creation_date": 1582173915, "answer_id": 60313024, "question_id": 57885949, "link": "https://stackoverflow.com/questions/57885949/private-repo-go-1-13-go-mod-failed-ping-sum-golang-org-lookup-ver/60313024#60313024", "title": "private repo - go 1.13 - `go mod ..` failed: ping &quot;sum.golang.org/lookup&quot; .. verifying package .. 410 gone", "body": "<p>Basically it failed to verify private repository. However I don't like turning off checksum, but you can easily set <code>GOSUMDB</code> to <code>off</code> before trying to get module. something like this:</p>\n\n<pre><code>GOSUMDB=off go get github.com/mycompany/myproject\n</code></pre>\n\n<p>ref: <a href=\"https://github.com/golang/go/issues/35164#issuecomment-546503518\" rel=\"noreferrer\">https://github.com/golang/go/issues/35164#issuecomment-546503518</a></p>\n\n<p>A second and better solution is to set <code>GOPRIVATE</code> environment variable that controls which modules the go command considers to be private (not available publicly) and should therefore NOT use the proxy or checksum database. The variable is a comma-separated list of glob patterns (same syntax of Go's <code>path.Match</code>) of module path prefixes. For example,</p>\n\n<pre><code>export GOPRIVATE=*.corp.example.com,rsc.io/private\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>go env -w GOPRIVATE=github.com/mycompany/*\n</code></pre>\n\n<p>Last solution you can try is to turn off such checks for all private repositories that you don't want to go public or being verified through  <code>sum.golang.org/lookup/github.com/mycompany/...</code></p>\n\n<pre><code>GONOSUMDB=gitlab.com/mycompany/* go mod why\n</code></pre>\n\n<p><strong>Note that:</strong></p>\n\n<p>If you have issues fetching modules or repos over https, you may want to add the following to your <code>~/.gitconfig</code> to make <code>go</code> get/fetch repositories using <code>ssh</code> instead of <code>https</code> </p>\n\n<p>[url \"ssh://git@github.com/\"]\n       insteadOf = <a href=\"https://github.com/\" rel=\"noreferrer\">https://github.com/</a></p>\n"}, {"tags": [], "owner": {"reputation": 2764, "user_id": 5326634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/agDBB.jpg?s=128&g=1", "display_name": "Siyaram Malav", "link": "https://stackoverflow.com/users/5326634/siyaram-malav"}, "is_accepted": false, "score": -1, "last_activity_date": 1594297068, "creation_date": 1594297068, "answer_id": 62814630, "question_id": 57885949, "link": "https://stackoverflow.com/questions/57885949/private-repo-go-1-13-go-mod-failed-ping-sum-golang-org-lookup-ver/62814630#62814630", "title": "private repo - go 1.13 - `go mod ..` failed: ping &quot;sum.golang.org/lookup&quot; .. verifying package .. 410 gone", "body": "<p>Change following go variable's setting and then upgrade your package,</p>\n<pre><code>$ export GO111MODULE=on\n$ export GOPROXY=direct\n$ export GOSUMDB=off\n$ go get -u &lt;your dependency package&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 198, "user_id": 1109065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49b8f0969fef9e859da59ac70c0732b3?s=128&d=identicon&r=PG", "display_name": "MichaelWang", "link": "https://stackoverflow.com/users/1109065/michaelwang"}, "is_accepted": false, "score": 0, "last_activity_date": 1612320799, "last_edit_date": 1612320799, "creation_date": 1612320454, "answer_id": 66020532, "question_id": 57885949, "link": "https://stackoverflow.com/questions/57885949/private-repo-go-1-13-go-mod-failed-ping-sum-golang-org-lookup-ver/66020532#66020532", "title": "private repo - go 1.13 - `go mod ..` failed: ping &quot;sum.golang.org/lookup&quot; .. verifying package .. 410 gone", "body": "<p>I have this scenario too and this works for me.</p>\n<ol>\n<li>edit your .git/config and add two lines in it.( I have this in a global .gitconfig in home dir)</li>\n</ol>\n<pre><code>[url &quot;ssh://youprivate.com&quot;]\n     insteadOf = https://yourprivate.com\n</code></pre>\n<ol start=\"2\">\n<li>export GOSUMDB=off</li>\n</ol>\n<p>Then everything will OK.</p>\n"}], "owner": {"reputation": 751, "user_id": 12052086, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-3lmI35znrXQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcrRUavGlEPpVnOCo1GBhZfYDN4kg/photo.jpg?sz=128", "display_name": "noveaustack", "link": "https://stackoverflow.com/users/12052086/noveaustack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11328, "favorite_count": 6, "answer_count": 4, "score": 31, "last_activity_date": 1612320799, "creation_date": 1568193682, "last_edit_date": 1568371024, "question_id": 57885949, "link": "https://stackoverflow.com/questions/57885949/private-repo-go-1-13-go-mod-failed-ping-sum-golang-org-lookup-ver", "title": "private repo - go 1.13 - `go mod ..` failed: ping &quot;sum.golang.org/lookup&quot; .. verifying package .. 410 gone", "body": "<p>I am using golang 1.13 . </p>\n\n<p>I have a project that depends on a private gitlab project. </p>\n\n<p>I have the ssh keys for the same. </p>\n\n<p>When I try to retrieve the dependencies for a newly created module, I am getting the following error: </p>\n\n<pre><code>$ go version\ngo version go1.13 linux/amd64\n\n$ go mod why\ngo: downloading gitlab.com/mycompany/myproject v0.0.145\nverifying gitlab.com/mycompany/myproject@v0.0.145: gitlab.com/mycompany/myproject@v0.0.145: reading https://sum.golang.org/lookup/gitlab.com/mycompany/myproject@v0.0.145: 410 Gone\n</code></pre>\n\n<p>I have no idea why it is trying to ping sum.golang.org/lookup since it is a private gitlab project. </p>\n\n<p>My ~/.gitconfig contains the following (based on my looking up in google search for similar errors)</p>\n\n<pre><code># Enforce SSH\n[url \"ssh://git@github.com/\"]\n  insteadOf = https://github.com/\n[url \"ssh://git@gitlab.com/\"]\n        insteadOf = https://gitlab.com/\n[url \"ssh://git@bitbucket.org/\"]\n  insteadOf = https://bitbucket.org/\n[url \"git@gitlab.com:\"]\n        insteadOf = https://gitlab.com/\n</code></pre>\n\n<p>The error still persists. </p>\n\n<p>I would expect the package to be downloaded from my private gitlab project repository to the current project. </p>\n\n<p>Is there anything I need to do in my private gitlab project repository to make it ready for 'go get' ? </p>\n\n<p>The private gitlab project repository already contains the go.sum and go.mod for the project as well. </p>\n\n<p>Anything that I am missing ?</p>\n\n<p>edit: 1) The private repo name and the company name contains no asterisks or any other special characters. only alphabets and not even numeric characters. </p>\n"}, {"tags": ["go", "struct", "protocol-buffers", "proto", "protobuf-go"], "answers": [{"comments": [{"owner": {"reputation": 1724, "user_id": 1230559, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/cac803f8fb5f55281c2c0f0f9e17ea4d?s=128&d=identicon&r=PG", "display_name": "city", "link": "https://stackoverflow.com/users/1230559/city"}, "edited": false, "score": 0, "creation_date": 1596662326, "post_id": 57886310, "comment_id": 111886862, "body": "another related question: how to get the value with the name? I didn&#39;t find a good answer to how to iterate the pb struct. thanks."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1724, "user_id": 1230559, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/cac803f8fb5f55281c2c0f0f9e17ea4d?s=128&d=identicon&r=PG", "display_name": "city", "link": "https://stackoverflow.com/users/1230559/city"}, "edited": false, "score": 0, "creation_date": 1596730201, "post_id": 57886310, "comment_id": 111911325, "body": "@city Please post a new question with all the details."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1568194921, "creation_date": 1568194921, "answer_id": 57886310, "question_id": 57885851, "link": "https://stackoverflow.com/questions/57885851/how-to-get-all-fields-names-in-golang-proto-generated-complex-structs/57886310#57886310", "title": "How to get all Fields names in golang proto generated complex structs", "body": "<p>If the type is interface, you can't do much about that. In an actual value it may be a struct or any other type that implements that interface, but the interface <em>type</em> itself cannot tell you this, it does not restrict the concrete type.</p>\n\n<p>You may do what you want if you start with <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>reflect.Value</code></a> instead of <a href=\"https://golang.org/pkg/reflect/#Type\" rel=\"nofollow noreferrer\"><code>reflect.Type</code></a>, because if you have a value, you can examine the value (or its type) that is stored in the interface. To get the <code>reflect.Value</code> descriptor wrapped in an interface value, you may use <a href=\"https://golang.org/pkg/reflect/#Value.Elem\" rel=\"nofollow noreferrer\"><code>reflect.Elem()</code></a>.</p>\n\n<p>Also, to handle pointer to structs, you again may use <code>reflect.Elem()</code> to get the pointed value. You may check if a value is a pointer by comparing its kind to <code>reflect.Ptr</code>.</p>\n\n<p>Here's an example of your <code>printFieldNames()</code>, rewritten to work with <code>reflect.Value</code>, and it recurses into structs stored in interface values. This is not a solution that handles all cases, but demonstrates how to do it:</p>\n\n<pre><code>func printFieldNames(v reflect.Value) {\n    for i := 0; i &lt; v.NumField(); i++ {\n        field := v.Field(i)\n        if field.Kind() == reflect.Ptr {\n            field = field.Elem()\n        }\n        if field.Kind() == reflect.Struct {\n            printFieldNames(field)\n            continue\n        }\n        if field.Kind() == reflect.Interface {\n            wrapped := field.Elem()\n            if wrapped.Kind() == reflect.Ptr {\n                wrapped = wrapped.Elem()\n            }\n            printFieldNames(wrapped)\n        }\n        structfield := v.Type().Field(i)\n        column := structfield.Tag.Get(\"json\")\n        fmt.Printf(\"column: %s, json tag: %s\\n\", structfield.Name, column)\n    }\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>a := Action{\n    ActionType: Action_TaskAction{\n        TaskAction: &amp;TaskAction{},\n    },\n}\nprintFieldNames(reflect.ValueOf(a))\n</code></pre>\n\n<p>Output will be (try it on the <a href=\"https://play.golang.org/p/dex4v0LnEnX\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>column: Name, json tag: name,omitempty\ncolumn: Progress, json tag: progress,omitempty\ncolumn: ActionType, json tag: \n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 4243781, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SRkIqTPm-68/AAAAAAAAAAI/AAAAAAAAAGg/QgaWbGAsJo8/photo.jpg?sz=128", "display_name": "Nishant Sankhala", "link": "https://stackoverflow.com/users/4243781/nishant-sankhala"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1602, "favorite_count": 0, "accepted_answer_id": 57886310, "answer_count": 1, "score": 1, "last_activity_date": 1568194921, "creation_date": 1568193328, "question_id": 57885851, "link": "https://stackoverflow.com/questions/57885851/how-to-get-all-fields-names-in-golang-proto-generated-complex-structs", "title": "How to get all Fields names in golang proto generated complex structs", "body": "<p>I am trying to get all the fields names in the go file generated from proto.\nBelow is the generated struct.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Action struct {\n    Name             string            `protobuf:\"bytes,1,opt,name=name,proto3\" json:\"name,omitempty\"`\n    // Types that are valid to be assigned to ActionType:\n    //  *Action_TaskAction\n    ActionType           isAction_ActionType `protobuf_oneof:\"action_type\"`\n}\n</code></pre>\n\n<p>As it is seen that ActionType is oneof Field in proto which is implemented as below.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type isAction_ActionType interface {\n    isAction_ActionType()\n}\n\ntype Action_TaskAction struct {\n    TaskAction *TaskAction `protobuf:\"bytes,16,opt,name=task_action,json=taskAction,proto3,oneof\"`\n}\n\ntype TaskAction struct {\n    Progress             float32  `protobuf:\"fixed32,1,opt,name=progress,proto3\" json:\"progress,omitempty\"`\n}\n</code></pre>\n\n<p>As I want to get the field name in TaskAction struct which is Progress.</p>\n\n<p>I am using below code to get the field names but facing issue if the field type is interface(for oneof field)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func printFieldNames(t reflect.Type) error {\n    for i := 0; i &lt; t.NumField(); i++ {\n        field := t.Field(i)\n        if field.Type.Kind() == reflect.Struct {\n            printFieldNames(field.Type)\n            continue\n        }\n        if field.Type.Kind() == reflect.Interface {\n            // what to do here.\n        }\n        column := field.Tag.Get(\"json\")\n        fmt.Println(\"column: \", column)\n    }\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568188939, "post_id": 57884642, "comment_id": 102191702, "body": "I have removed your unrelated question about upgrading Go. If you need help with that, ask a separate question, and actually explain the problem you&#39;re having."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1568188972, "post_id": 57884642, "comment_id": 102191723, "body": "To answer your question: You should probably vendor your dependencies, if you&#39;re working in an environment without network access."}], "answers": [{"tags": [], "owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "is_accepted": false, "score": 0, "last_activity_date": 1568192011, "creation_date": 1568192011, "answer_id": 57885499, "question_id": 57884642, "link": "https://stackoverflow.com/questions/57884642/how-to-eliminate-go-get-dependency-check/57885499#57885499", "title": "How to eliminate go get dependency check?", "body": "<p>Embarassed to answer the question myself but I do find its solution.</p>\n\n<p>When <code>${GOPATH}/src/golang.org/x/sys</code> already exists before you fetch from <code>github.com/golang/sys</code>.It will jump this stage and cause an occasion that when you execute <code>git remote -v</code>.It will list origin <code>https://go.googlesource.com/sys fetch/push</code>.This is exactly what causes my stuck <code>fetch googlesource.com/sys time out</code>.</p>\n\n<p>Ok,Now there is two way to fix it.</p>\n\n<p>First way, remove existed package and make it exactly fetched from github.com/golang/sys.\n<code>rm -rf ${GOPATH}/src/golang.org/x/sys</code>.After jenkins shell jobs, its git remote will correctly convert to <code>https://github.com/golang/sys</code></p>\n\n<p>Second way, change its origin remote.</p>\n\n<pre><code>cd ${GOPATH}/src/golang.org/x/sys\ngit remote remove origin\ngit remote add origin https://github.com/golang/sys.git\n\n</code></pre>\n\n<p>Hope it helpful to all of you.</p>\n"}], "owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568192011, "creation_date": 1568188797, "last_edit_date": 1568188994, "question_id": 57884642, "link": "https://stackoverflow.com/questions/57884642/how-to-eliminate-go-get-dependency-check", "title": "How to eliminate go get dependency check?", "body": "<p>When I exec <code>go get -u github.com/spf13/viper</code>, which has a dependency <code>golang.org/x/sys</code>.It will auto-execute <code>cd ${GOPATH}/src/golang.org/x/sys; git pull --ff-only</code>.</p>\n\n<p>This is really extra no use.</p>\n\n<p>My network can't reach golang.org/x/sys. So I've already used <code>github.com/golang/sys</code> and put it into my <code>GOPATH/src/golang.org/x</code>.Which means the auto-check(<code>cd ${GOPATH}/src/golang.org/x/sys; git pull --ff-only</code>) for the progress(<code>go get -u github.com/spf13/viper</code>) should be totally eliminated, because it stuck my jenkins deploy time.</p>\n\n<p>More than 90% time of jenkins deployment is wasted in checks like</p>\n\n<p><code>cd ${GOPATH}/src/golang.org/x/sys; git pull --ff-only</code></p>\n\n<p><code>cd ${GOPATH}/src/golang.org/x/text; git pull --ff-only</code></p>\n\n<p>...</p>\n\n<p>Here is part of my jenkins log:</p>\n\n<pre><code># cd /home/tonnn/go/src/golang.org/x/sys; git pull --ff-only\nfatal: unable to access 'https://go.googlesource.com/sys/': Failed connect to go.googlesource.com:443; Connection timed out\npackage golang.org/x/sys/unix: exit status 1\n\n# cd /home/tonnn/go/src/golang.org/x/text; git pull --ff-only\nfatal: unable to access 'https://go.googlesource.com/text/': Failed connect to go.googlesource.com:443; Connection timed out\n\n</code></pre>\n\n<p>So, is there a way to only get <code>viper</code> but do not check its dependencies?</p>\n\n<p><code>viper</code> is only an example to show my question.I bet most of you have met this kind of question.</p>\n\n<p>I'm using Go 1.9.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 11, "creation_date": 1568181167, "post_id": 57882571, "comment_id": 102188459, "body": "Yes of course, defer is not free. And whether these 50ns make a difference for your application is something only you can tell."}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 1, "creation_date": 1568186247, "post_id": 57882571, "comment_id": 102190407, "body": "It&#39;s not 50, just 49 ns ;-)"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1568187425, "post_id": 57882571, "comment_id": 102190967, "body": "For benchmark results, provide the benchmark code and the output from the <code>go version</code> command. <a href=\"https://golang.org/doc/go1.13\" rel=\"nofollow noreferrer\">Go 1.13 Release Notes</a>: This release improves performance of most uses of defer by 30%."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1568208912, "post_id": 57882571, "comment_id": 102202309, "body": "&quot;Do I need to avoid the use of defer&quot; - only if you actually have a <i>measurable performance problem in the overall application that you can trace back to this function</i>. There are lots of things you can do to make code slightly faster while also making it worse in other ways (more error-prone, harder to read, etc.). Whether or not that&#39;s a reasonable trade-off depends on a lot more than what&#39;s shown here."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1568192045, "creation_date": 1568192045, "answer_id": 57885508, "question_id": 57882571, "link": "https://stackoverflow.com/questions/57882571/defer-in-go-seems-to-add-latency/57885508#57885508", "title": "Defer in Go seems to add latency", "body": "<p><code>defer</code> executes another function, so yes, it adds additional overhead.</p>\n\n<p>You can read more about the details <a href=\"https://medium.com/i0exception/runtime-overhead-of-using-defer-in-go-7140d5c40e32\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 1559, "user_id": 1197768, "user_type": "registered", "accept_rate": 35, "profile_image": "https://i.stack.imgur.com/oQXRV.jpg?s=128&g=1", "display_name": "sabu", "link": "https://stackoverflow.com/users/1197768/sabu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 126, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1568192045, "creation_date": 1568179283, "last_edit_date": 1568184820, "question_id": 57882571, "link": "https://stackoverflow.com/questions/57882571/defer-in-go-seems-to-add-latency", "title": "Defer in Go seems to add latency", "body": "<p>I am using mutex for synchronisation in Go. Below is the code</p>\n\n<pre><code>func (c *MyStruct) Put(key string, value interface{}) {\n  c.mu.Lock()\n  defer c.mu.Unlock()\n  val, found := c.items[key]\n  if found {\n    item := val.Value.(*Item)\n    item.Value = value\n    item.Expiration = time.Now().Add(c.ttl).UnixNano()\n    return\n  }\n  ele := c.list.PushFront(&amp;Item{key, value, expirationTime})\n  c.items[key] = ele\n}\n</code></pre>\n\n<p>When I run a benchmark test on this the output seems is</p>\n\n<pre><code>BenchmarkXxx-12      5000000           206 ns/op          37 B/op          2 allocs/op\n</code></pre>\n\n<p>But when I change the code and unlock the mutex manually at the end of the function. It is increasing the performance. </p>\n\n<pre><code>BenchmarkLru_put-12     10000000           157 ns/op          26 B/op          2 allocs/op\n</code></pre>\n\n<p>Does defer function add latency to the code? Do I need to avoid the use of defer in this case?</p>\n"}, {"tags": ["mysql", "go", "beego"], "owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1568170530, "creation_date": 1568170530, "question_id": 57881462, "link": "https://stackoverflow.com/questions/57881462/unexpected-eof-and-invalid-connection-beego-orm", "title": "Unexpected EOF and Invalid Connection Beego ORM", "body": "<p>This happens when I already connected website and didn't do anything while and try to reconnect again I gets this error at first attempt.</p>\n\n<blockquote>\n  <p>unexpected EOF, invalid connection</p>\n</blockquote>\n\n<p>I found the error log:</p>\n\n<pre><code>[mysql] 2019/09/11 09:21:56 packets.go:36: unexpected EOF\n[ORM]2019/09/11 09:21:56  -[Queries/default] - [FAIL /    db.Query /     0.0ms] - [SELECT T0.`i_d`, T0.`username`, T0.`password`, T0.`firstname`, T0.`lastname`, T0.`email`, T0.`stack_i_d`, T0.`stack_password`, T0.`default_tenant_i_d`, T0.`role`, T0.`created`, T0.`updated`, T0.`is_activated` FROM `user` T0 WHERE T0.`email` = ? ] - `EMAIL@YAHOO.COM` - invalid connection\n</code></pre>\n\n<p>And second try I successfully connect to website by login</p>\n\n<pre><code>[ORM]2019/09/11 09:23:46  -[Queries/default] - [  OK /    db.Query /     6.9ms] - [SELECT T0.`i_d`, T0.`username`, T0.`password`, T0.`firstname`, T0.`lastname`, T0.`email`, T0.`stack_i_d`, T0.`stack_password`, T0.`default_tenant_i_d`, T0.`role`, T0.`created`, T0.`updated`, T0.`is_activated` FROM `user` T0 WHERE T0.`email` = ? ] - `EMAIL@YAHOO.COM`\n</code></pre>\n"}, {"tags": ["json", "go", "struct", "marshalling"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568167101, "post_id": 57880928, "comment_id": 102185459, "body": "If it wasn&#39;t for that email field, you could&#39;ve created two identical structs with different json tags and simply say v1=v2 where v1 is one struct and v2 is the other. But with that email translation that&#39;s not possible. You can still do two structs, and copy from one to the other field by field."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568181386, "post_id": 57880928, "comment_id": 102188531, "body": "You cannot use encoding/json with one struct and different names. Dead simple. You either have to have different structs with different tags or use e.g. a map[string]interface{} as the source of serialisation. In any case you will have to copy. Or your write your own JSON serialisation."}], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 1888765, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/8c9928a184a34229cbf1c4399506afef?s=128&d=identicon&r=PG", "display_name": "NightMarcher", "link": "https://stackoverflow.com/users/1888765/nightmarcher"}, "edited": false, "score": 0, "creation_date": 1568240127, "post_id": 57882466, "comment_id": 102215770, "body": "@ polo xue Your first example is exactly what I was looking for. Thanks!"}], "tags": [], "owner": {"reputation": 84, "user_id": 11484375, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Ci0LH8WkltQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfXUaM9_bZrD__rzBzJESn9PAQB_w/mo/photo.jpg?sz=128", "display_name": "polo xue", "link": "https://stackoverflow.com/users/11484375/polo-xue"}, "is_accepted": true, "score": 2, "last_activity_date": 1568179001, "last_edit_date": 1568179001, "creation_date": 1568178576, "answer_id": 57882466, "question_id": 57880928, "link": "https://stackoverflow.com/questions/57880928/how-to-marshall-json-from-one-struct-to-another-with-different-json-tags-in-go/57882466#57882466", "title": "How to Marshall json from one struct to another with different json tags in Go?", "body": "<p>I think you can define different structures according to different sources. Then, transform it into that common structure.</p>\n\n<p>This method is flexible, readable and easy to implement when new sources are added.</p>\n\n<p>The sample code is as follows:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype User struct {\n    ID         string `json:id`\n    GiveName   string `json:given_name`\n    FamilyName string `json:family_name`\n    Email      string `json:email`\n}\n\ntype UserFromMySQL struct {\n    ID        string `json:\"id\"`\n    FirstName string `json:\"first_name\"`\n    LastName  string `json:\"last_name\"`\n    Email     string `json:\"email\"`\n}\n\nfunc (u *UserFromMySQL) GetUser() *User {\n    return &amp;User{\n        ID:         u.ID,\n        GiveName:   u.FirstName,\n        FamilyName: u.LastName,\n        Email:      u.Email,\n    }\n}\n\nfunc main() {\n    um := new(UserFromMySQL)\n\n    b := []byte(`{\n   \"id\": \"123\",\n   \"first_name\": \"john\",\n   \"last_name\": \"smith\",\n   \"email\": \"js@mail.com\"\n}`)\n    err := json.Unmarshal(b, um)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"%+v\\n\", um)\n    fmt.Printf(\"%+v\\n\", um.GetUser())\n}\n</code></pre>\n\n<p>Of course, you can do this by adding redundant fields, define <code>user</code> as follows:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Email {\n    Primary string `json:\"primary\"`\n}\n\ntype User struct {\n    ID           string `json:\"id\"`\n    GiveName     string `json:\"given_name\"`\n    FamilyName   string `json:\"family_name\"`\n    FirstName    string `json:\"last_name\"`\n    LastName     string `json:\"last_name\"`\n    Email        string `json:\"email\"`\n}\n</code></pre>\n\n<p>Choose the right way for you. I prefer the first one.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12013479, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-pqK7Luzl9Js/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfeAuFhPqaVkRSMLhgmpbsVHWGWlQ/photo.jpg?sz=128", "display_name": "Peradon C.", "link": "https://stackoverflow.com/users/12013479/peradon-c"}, "is_accepted": false, "score": 0, "last_activity_date": 1568224040, "creation_date": 1568224040, "answer_id": 57894346, "question_id": 57880928, "link": "https://stackoverflow.com/questions/57880928/how-to-marshall-json-from-one-struct-to-another-with-different-json-tags-in-go/57894346#57894346", "title": "How to Marshall json from one struct to another with different json tags in Go?", "body": "<p>I recommended you to separate the struct for each of the data you have. </p>\n\n<p>Golang is a strong type language, so each of the structs should only represent only one data type. This does not only eliminate the Guam code but also reduce the time other develops need to track a type of the data, which sometimes happens in non-strong type language like Python. </p>\n\n<p>Anyway, if you really need to represent those data in the same struct you can write as below.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type User struct {\n   ID         string `json:\"id,omitempty\"`\n   GivenName  string `json:\"given_name,omitempty\"`\n   FamilyName string `json:\"family_name,omitempty\"`\n   FirstName  string `json:\"first,omitempty\"`\n   LastName   string `json:\"last,omitempty\"`\n   PlainEmail string `json:\"plain_email,omitempty\"`\n   Email struct{\n    Primary string `json:\"primary\"`\n   } `json:\"email,omitempty\"`\n}\n</code></pre>\n\n<p>Add <em>omitempty</em> in the JSON tag, so if the struct is created with user type A then the type B fields will not be represented in JSON. However, I do not recommend this method but if you need to, this is the way. </p>\n\n<p>Anyway, <em>Email</em> and <em>PlainEmail</em> JSON tag needed to be separated or the compiler will be confused.</p>\n"}], "owner": {"reputation": 149, "user_id": 1888765, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/8c9928a184a34229cbf1c4399506afef?s=128&d=identicon&r=PG", "display_name": "NightMarcher", "link": "https://stackoverflow.com/users/1888765/nightmarcher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 972, "favorite_count": 0, "accepted_answer_id": 57882466, "answer_count": 2, "score": 0, "last_activity_date": 1568224040, "creation_date": 1568165926, "question_id": 57880928, "link": "https://stackoverflow.com/questions/57880928/how-to-marshall-json-from-one-struct-to-another-with-different-json-tags-in-go", "title": "How to Marshall json from one struct to another with different json tags in Go?", "body": "<p>I am creating a Go application that consumes data from multiple sources that all have similar data but different structures to their data/responses. These responses need to be marshalled into a common struct that is then sent to another service.</p>\n\n<p>Common struct:</p>\n\n<pre><code>type common struct {\n   ID         string `json:id`\n   GivenName  string `json:given_name`\n   FamilyName string `json:family_name`\n   Email:     string `json:email`\n}\n</code></pre>\n\n<p>One response:</p>\n\n<pre><code>{\n   \"id\": \"123\",\n   \"first_name\": \"john\",\n   \"last_name\": \"smith\",\n   \"email\": \"js@mail.com\"\n}\n\n</code></pre>\n\n<p>Another response:</p>\n\n<pre><code>{\n   \"id\": \"456\",\n   \"first\": \"larry\",\n   \"last\": \"smith\",\n   \"email\": {\n      \"primary\": \"larry@mail.com\"\n   }\n}\n</code></pre>\n\n<p>How do I marshal a json response with one structure into a struct with a different structure?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2274, "user_id": 6476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1ca185cf4b12910506f46f431d2371?s=128&d=identicon&r=PG&f=1", "display_name": "kingkupps", "link": "https://stackoverflow.com/users/6476496/kingkupps"}, "is_accepted": false, "score": 1, "last_activity_date": 1568237376, "last_edit_date": 1568237376, "creation_date": 1568154992, "answer_id": 57878988, "question_id": 57878878, "link": "https://stackoverflow.com/questions/57878878/what-does-return-obj-mean-what-impact-does-it-have-on-equality-checks/57878988#57878988", "title": "What does return &amp;obj mean? What impact does it have on equality checks", "body": "<p><code>errorString{text}</code> is a struct and <code>&amp;errorString{text}</code> is a pointer to a struct. See <a href=\"https://tour.golang.org/moretypes/1\" rel=\"nofollow noreferrer\">https://tour.golang.org/moretypes/1</a> for a more detailed explanation of what this means.</p>\n\n<p>There is also this question which has specifics on when to return which: <a href=\"https://stackoverflow.com/questions/23542989/pointers-vs-values-in-parameters-and-return-values\">Pointers vs. values in parameters and return values</a>. Returning <code>errorText{text}</code> returns a copy of the entire struct while <code>&amp;errorText{text}</code> returns a pointer to a struct instead.</p>\n\n<p>A struct <code>S</code> and a pointer to a struct of type <code>S</code> are two separate types in Go. For <code>errorText</code> to implement the <code>error</code> interface, <code>errorText</code> must implement the <code>Error() string</code> method but it also needs to have the correct receiver type.</p>\n\n<p>For example, this is OK:</p>\n\n<pre><code>type errorText struct {\n    text string\n}\n\nfunc (e errorText) Error() string { return e.text }\n\nfunc SomethingThatReturnsYourError() error {\n    return errorText{\"an error\"}\n}\n</code></pre>\n\n<p>This is also OK:</p>\n\n<pre><code>type errorText struct {\n    text string\n}\n\nfunc (e errorText) Error() string { return e.text }\n\nfunc SomethingThatReturnsYourError() error {\n    return &amp;errorText{\"an error\"} // Notice the &amp;\n}\n</code></pre>\n\n<p>But this is not OK and the compiler will hit you with an error:</p>\n\n<pre><code>type errorText struct {\n    text string\n}\n\n// notice the pointer receiver type\nfunc (e *errorText) Error() string { return e.text }\n\nfunc SomethingThatReturnsYourError() error {\n    return errorText{\"an error\"}\n}\n</code></pre>\n\n<p>Error message: <code>cannot use errorString literal (type errorString) as type error in return argument:\n    errorString does not implement error (Error method has pointer receiver)</code></p>\n\n<p>In order to use a pointer receiver you have to return a pointer:</p>\n\n<pre><code>type errorText struct {\n    text string\n}\n\nfunc (e *errorText) Error() string { return e.text }\n\nfunc SomethingThatReturnsYourError() error {\n    return &amp;errorText{\"an error\"}\n}\n</code></pre>\n"}], "owner": {"reputation": 1116, "user_id": 3103271, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/327a4e9fd339d47885623a2628021613?s=128&d=identicon&r=PG&f=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3103271/charlie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1568237376, "creation_date": 1568154113, "last_edit_date": 1568237211, "question_id": 57878878, "link": "https://stackoverflow.com/questions/57878878/what-does-return-obj-mean-what-impact-does-it-have-on-equality-checks", "title": "What does return &amp;obj mean? What impact does it have on equality checks", "body": "<p>What is the difference in returning </p>\n\n<pre><code>func New(text string) error { return &amp;errorString{text} }\n</code></pre>\n\n<p>or returning like </p>\n\n<pre><code>func New(text string) error { return errorString{text} }\n</code></pre>\n\n<p>errorString is defined as follow</p>\n\n<pre><code>type errorString struct { text string }\n</code></pre>\n\n<p>error is defined as follow</p>\n\n<pre><code>type error interface {\n  Error() string\n}\n</code></pre>\n\n<p>I especially want to know what the difference in the return value is:</p>\n\n<pre><code>return &amp;errorString{text}\n      vs.\nreturn errorString{text}\n</code></pre>\n\n<p>I already read the guide but it didn't mentioned the difference. It only mentioned, that with one you are not able to use equal what you do not want with the error object.</p>\n"}, {"tags": ["go", "github", "glide-golang"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1568141325, "post_id": 57876558, "comment_id": 102178035, "body": "If you&#39;re using Go modules (added in v1.11), you can just use <code>go get github.com&#47;googollee&#47;go-socket.io@v1.4.0</code> (or whatever 1.4.x version you want)."}, {"owner": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568142475, "post_id": 57876558, "comment_id": 102178487, "body": "@Adrian , My dear go get github.com/googollee/go-socket.io@v1.4.0 dont work"}, {"owner": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568142505, "post_id": 57876558, "comment_id": 102178500, "body": "@Adrian go: cannot use path@version syntax in GOPATH mode"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1568144497, "post_id": 57876558, "comment_id": 102179276, "body": "Correct - that&#39;s why I started off saying &quot;If you&#39;re using Go modules&quot;. If you are using a recent version of Go, you might consider updating your project to use modules, it makes it much easier to manage dependencies like this where you want a specific version."}, {"owner": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568145246, "post_id": 57876558, "comment_id": 102179580, "body": "@Adrian how can i use Go modules ?"}, {"owner": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568145314, "post_id": 57876558, "comment_id": 102179617, "body": "@Adrian , i want to install v1.0 , v1.4 and.... my go veriosn : go version go1.12.9 windows/amd64"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568147128, "post_id": 57876558, "comment_id": 102180335, "body": "<a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/Modules</a>"}, {"owner": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568149980, "post_id": 57876558, "comment_id": 102181264, "body": "@Adrian can you connect my pc with teamviewer and solve my problem?"}, {"owner": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568160952, "post_id": 57876558, "comment_id": 102183620, "body": "i use this <a href=\"https://github.com/zhouhui8915/socket.io-go\" rel=\"nofollow noreferrer\">github.com/zhouhui8915/socket.io-go</a> and run go get github.com/googollee/go-socket.io"}], "answers": [{"comments": [{"owner": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "edited": false, "score": 0, "creation_date": 1568143984, "post_id": 57877082, "comment_id": 102179091, "body": "can you tell me how can install v.1.0 ? can you type me ? learn me with exaple"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "edited": false, "score": 0, "creation_date": 1568144430, "post_id": 57877082, "comment_id": 102179252, "body": "@melina disregard this answer, it&#39;s totally irrelevant to your question."}, {"owner": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "edited": false, "score": 0, "creation_date": 1568144497, "post_id": 57877082, "comment_id": 102179275, "body": "Dear , how can use old version of this link? <a href=\"https://github.com/googollee/go-socket.io/\" rel=\"nofollow noreferrer\">github.com/googollee/go-socket.io</a>"}], "tags": [], "owner": {"reputation": 2359, "user_id": 3955129, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZxfYS.jpg?s=128&g=1", "display_name": "Abdollah", "link": "https://stackoverflow.com/users/3955129/abdollah"}, "is_accepted": false, "score": -1, "last_activity_date": 1568232227, "last_edit_date": 1592644375, "creation_date": 1568143513, "answer_id": 57877082, "question_id": 57876558, "link": "https://stackoverflow.com/questions/57876558/how-can-i-pull-older-branches-of-a-package-from-github-using-go-get-command/57877082#57877082", "title": "How can I pull older branches of a package from github using go get command", "body": "<p><strong>UPDATE</strong></p>\n<p>You need to use modules. Module-based behavior is an opt-in feature that is available from <strong>Go 1.11</strong> but it is disabled by default in <code>%GOPATH%</code> directory. (If you don't know your <code>%GOPATH%</code>, run <code>go env</code>.) For example, if your <code>%GOPATH%</code> is set to <code>C:\\Users\\Melina\\go</code> (I suppose so in the remainder of the answer), you cannot use module-based behavior of <code>go get</code> in that directory or its subdirectories like<code>C:\\Users\\Melina\\go\\src</code> regarding default settings. To change it, do the following steps:</p>\n<ol>\n<li><p>Set <code>GO111MODULE</code> environment variable to <code>on</code></p>\n<p>Add an environment variable called <code>GO111MODULE</code> and set it to <code>on</code>. (You can do this simply by running command <code>setx GO111MODULE &quot;on&quot;</code> in Windows shell either Command Prompt or Windows Powershell. You <strong>MUST</strong> repoen the shell so it takes effect. Or if you are using Visual Studio Code, restart your IDE.)</p>\n</li>\n<li><p>In <code>C:\\Users\\Melina\\go\\src</code>, create a directory called e.g. <code>socket.io.1.4</code>. It will contain source code of <code>socket.io</code> module. Run the following commands:</p>\n</li>\n<li><p><code>cd C:\\Users\\Melina\\go\\socket.io.1.4</code></p>\n</li>\n<li><p><code>go mod init github.com/googollee/go-socket.io@v1.4</code> to create a module that pulls <code>v1.4</code> of <code>go-socket.io</code>.</p>\n</li>\n<li><p><code>go get github.com/googollee/go-socket.io@v1.4</code> to get the specified version of the module. Getting the module will start like this:\n<a href=\"https://i.stack.imgur.com/nwwz3.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nwwz3.png\" alt=\"enter image description here\" /></a></p>\n</li>\n</ol>\n<p>There is an alternative way without touching <code>GO111MODULE</code>. Since out of <code>%GOPATH%</code>, the module-based behavior is enabled by default, you can do step 2 out of <code>%GOPATH%</code>, i.e. create directory <code>socket.io.1.4</code> out of <code>C:\\Users\\Melina\\go</code> and its subdirectories. Other steps are the same.</p>\n"}], "owner": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1568242688, "creation_date": 1568140760, "last_edit_date": 1568242688, "question_id": 57876558, "link": "https://stackoverflow.com/questions/57876558/how-can-i-pull-older-branches-of-a-package-from-github-using-go-get-command", "title": "How can I pull older branches of a package from github using go get command", "body": "<p>From this link:</p>\n\n<blockquote>\n  <p><a href=\"https://github.com/googollee/go-socket.io/tree/v1.4\" rel=\"nofollow noreferrer\">https://github.com/googollee/go-socket.io/tree/v1.4</a></p>\n</blockquote>\n\n<p>I want to get this module.\nHow can I do it? I don't want to get <code>master</code> module, but I want to get <code>v1.4</code> branch. When I use the following command, it downloads <code>master</code> module:</p>\n\n<blockquote>\n  <p>go get github.com/googollee/go-socket.io</p>\n</blockquote>\n\n<p>How can I use <code>go get</code> for an older version or other branches?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1568138473, "post_id": 57876044, "comment_id": 102176922, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/38036752/go-and-in-clause-in-postgres\">Go and IN clause in Postgres</a>"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1568138488, "post_id": 57876044, "comment_id": 102176927, "body": "I don&#39;t think <code>value1,value2 in ...</code>  is  valid sql. You can rewrite the query as (lat=v1 and long=v2) or (lat=v2 and long=v4) or ..."}, {"owner": {"reputation": 133, "user_id": 10451979, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JhajMscZ_IA/AAAAAAAAAAI/AAAAAAAAATQ/zj7Y8MMVekQ/photo.jpg?sz=128", "display_name": "Davenporten", "link": "https://stackoverflow.com/users/10451979/davenporten"}, "edited": false, "score": 0, "creation_date": 1568142413, "post_id": 57876044, "comment_id": 102178458, "body": "Try running your sql statement through a validator like <a href=\"https://www.eversql.com/sql-syntax-check-validator/\" rel=\"nofollow noreferrer\">eversql.com/sql-syntax-check-validator</a>"}, {"owner": {"reputation": 17, "user_id": 12048262, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCGs1qKbGfS6-aDBTpOm3ExvIWCO0JreuzdJQ-9=k-s128", "display_name": "Nitin Mishra", "link": "https://stackoverflow.com/users/12048262/nitin-mishra"}, "edited": false, "score": 0, "creation_date": 1568200172, "post_id": 57876044, "comment_id": 102197453, "body": "Updated my question. Can you please suggest the solution?"}], "answers": [{"tags": [], "owner": {"reputation": 9, "user_id": 12049424, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCKIpEMmgHtglOPjFe4ULNHlDDSc9ZwzItuZI8lug=k-s128", "display_name": "EE Hsiao", "link": "https://stackoverflow.com/users/12049424/ee-hsiao"}, "is_accepted": false, "score": 0, "last_activity_date": 1568163676, "last_edit_date": 1568163676, "creation_date": 1568163253, "answer_id": 57879748, "question_id": 57876044, "link": "https://stackoverflow.com/questions/57876044/postgres-select-where-col1-col2-in-with-2d-golang-slice/57879748#57879748", "title": "Postgres select WHERE col1, col2 IN with 2d golang slice", "body": "<pre class=\"lang-golang prettyprint-override\"><code>Query: r.db.QueryContext(ctx,(\"SELECT id, lat, long FROM table2 WHERE lat, long IN (select $1, $2 union select $3, $4)\", latlongdata[0][0], latlongdata[0][1], latlongdata[1][0], latlongdata[1][1])\n</code></pre>\n\n<p>or create and insert <code>latlongdata</code> into a temp table\nthen </p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>WHERE lat, long IN (select filed1, field2 from temptable)\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 12048262, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCGs1qKbGfS6-aDBTpOm3ExvIWCO0JreuzdJQ-9=k-s128", "display_name": "Nitin Mishra", "link": "https://stackoverflow.com/users/12048262/nitin-mishra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568183663, "creation_date": 1568138247, "last_edit_date": 1568183663, "question_id": 57876044, "link": "https://stackoverflow.com/questions/57876044/postgres-select-where-col1-col2-in-with-2d-golang-slice", "title": "Postgres select WHERE col1, col2 IN with 2d golang slice", "body": "<p>I am not sure how to make postgres query where (col1, col2) in 2dslice </p>\n\n<p>I have tried the following:</p>\n\n<p>`</p>\n\n<pre><code>CREATE TABLE table2 (\n  id CHAR(27) NOT NULL,\n  lat FLOAT8 NOT NULL,\n  lon FLOAT8 NOT NULL,\n  PRIMARY KEY (id)\n);\n\n\nlatlongdata := [][]float64{}\nlatlongdata = append(latlongdata, []float64{1.2, 2.3},)\nlatlongdata = append(latlongdata, []float64{1.3, 2.4},)\n......................................\nlatlongdata = append(latlongdata, []float64{1.4, 2.5},)\n\nfmt.Println(latlongdata)// prints [[1.2 2.3] [1.3 2.4] ....... [1.4 2.5]] (very long array)\n\nQuery: r.db.QueryContext(ctx,(\"SELECT id, lat, lon FROM table2 WHERE (lat, lon) IN $1\", latlongdata,)\n</code></pre>\n\n<p>`</p>\n\n<p>Can you please suggest how to do it?</p>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1568132390, "post_id": 57874683, "comment_id": 102174384, "body": "What is the query?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1568135774, "post_id": 57874683, "comment_id": 102175892, "body": "The error is helpful but you need to include the relevant code in your question."}, {"owner": {"reputation": 35, "user_id": 6873810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e21f827962a199bb8073c3b88820b4?s=128&d=identicon&r=PG&f=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/6873810/arun"}, "edited": false, "score": 0, "creation_date": 1568214894, "post_id": 57874683, "comment_id": 102205733, "body": "I have added sample code."}], "answers": [{"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": true, "score": 0, "last_activity_date": 1568246826, "creation_date": 1568246826, "answer_id": 57898153, "question_id": 57874683, "link": "https://stackoverflow.com/questions/57874683/mongo-go-drivers-documentcount-does-not-support-nearsphere/57898153#57898153", "title": "Mongo go driver&#39;s DocumentCount does not support $nearSphere", "body": "<blockquote>\n  <p>(BadValue) $geoNear, $near, and $nearSphere are not allowed in this context</p>\n</blockquote>\n\n<p>You're getting this message due to the restricted use of <a href=\"https://docs.mongodb.com/manual/reference/method/db.collection.countDocuments/\" rel=\"nofollow noreferrer\">db.collection.countDocuments()</a>. </p>\n\n<p>The method <code>countDocuments()</code> essentially wraps aggregation pipeline <code>$match</code> and <code>$group</code>. See <a href=\"https://docs.mongodb.com/manual/reference/method/db.collection.countDocuments/#mechanics\" rel=\"nofollow noreferrer\">The Mechanics of countDocuments()</a> for more information. There are a number of query operators that are restricted : <a href=\"https://docs.mongodb.com/manual/reference/method/db.collection.countDocuments/#query-restrictions\" rel=\"nofollow noreferrer\">Query Restrictions</a>, one of them being <a href=\"https://docs.mongodb.com/manual/reference/operator/query/nearSphere/#op._S_nearSphere\" rel=\"nofollow noreferrer\">$nearSphere</a> operator. </p>\n\n<p>An alternative is to use [$geoWithin] and <a href=\"https://docs.mongodb.com/manual/reference/operator/query/centerSphere/#op._S_centerSphere\" rel=\"nofollow noreferrer\">$centerSphere</a>: </p>\n\n<pre><code>filter := bson.D{ \n  { Key: \"address.location\", \n    Value: bson.D{ \n        { Key: \"$geoWithin\", \n            Value: bson.D{ \n                { Key: \"$centerSphere\", \n                  Value: bson.A{ \n                            bson.A{ query.Longitude, query.Latitude } , \n                            maxDistance}, \n                }, \n            },\n        },\n    },\n  }}\n</code></pre>\n\n<p>Note that the <code>maxDistance</code> in spherical geometry has to be in a radius. You need to convert the distance, for example <code>10/6378.1</code> for 10 kilometres please see <a href=\"https://docs.mongodb.com/manual/tutorial/calculate-distances-using-spherical-geometry-with-2d-geospatial-indexes/\" rel=\"nofollow noreferrer\">Calculate Distance using Spherical Geometry</a> for more information.</p>\n\n<p>Also worth mentioning that although <a href=\"https://docs.mongodb.com/manual/reference/operator/query/centerSphere/\" rel=\"nofollow noreferrer\">$centerSphere</a> works <em>without</em> having a geospatial index, geospatial indexes support much faster queries than the unindexed equivalents.</p>\n"}], "owner": {"reputation": 35, "user_id": 6873810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e21f827962a199bb8073c3b88820b4?s=128&d=identicon&r=PG&f=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/6873810/arun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "accepted_answer_id": 57898153, "answer_count": 1, "score": 1, "last_activity_date": 1568246826, "creation_date": 1568132140, "last_edit_date": 1568214810, "question_id": 57874683, "link": "https://stackoverflow.com/questions/57874683/mongo-go-drivers-documentcount-does-not-support-nearsphere", "title": "Mongo go driver&#39;s DocumentCount does not support $nearSphere", "body": "<p>I am working on geo location query where I want to get total number of collections that satisfy geo location query. Mongo go library provides Document Count method with doesn't support filter based on geo location.</p>\n\n<p>The error I am getting is:\n(BadValue) $geoNear, $near, and $nearSphere are not allowed in this context</p>\n\n<pre><code>filter := bson.D{\n    {\n        Key: \"address.location\",\n        Value: bson.D{\n            {\n                Key: \"$nearSphere\",\n                Value: bson.D{\n                    {\n                        Key: \"$geometry\",\n                        Value: bson.D{\n                            {\n                                Key:   \"type\",\n                                Value: \"Point\",\n                            },\n                            {\n                                Key:   \"coordinates\",\n                                Value: bson.A{query.Longitude, query.Latitude},\n                            },\n                        },\n                    },\n                    {\n                        Key:   \"$maxDistance\",\n                        Value: maxDistance,\n                    },\n                },\n            },\n        },\n    },\n}\ncollection := db.Database(\"catalog\").Collection(\"restaurant\")\ntotalCount, findError := collection.CountDocuments(ctx, filter)\n</code></pre>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568131488, "post_id": 57873989, "comment_id": 102173922, "body": "The easiest way is probably to implement sql.Scanner interface with your Point type, and parse the data coming from the database. You have to figure out how the data is returned, it looks like it is getting a []uint8."}, {"owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1568131985, "post_id": 57873989, "comment_id": 102174185, "body": "The []uint8 return this: KDEyLjEyNjgxNDIsLTg2LjI3NTQwMDAwMDAwMDAwNSk= i need to convert that data into his numeric value."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568132209, "post_id": 57873989, "comment_id": 102174295, "body": "That looks like base64 encoded data. Decode it, see what it shows. Btw, isn&#39;t Point a postgres data type? Maybe there is a Point struct somewhere in postgres sql drivers?"}, {"owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1568132540, "post_id": 57873989, "comment_id": 102174455, "body": "Actually yes, i put at the beginning that i have a table whose column type was a Point DataType, however postgres don&#39;t have a Point struct, so i need to parse it"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 2, "creation_date": 1568132851, "post_id": 57873989, "comment_id": 102174603, "body": "I base64 decoded that text, and it prints: (12.1268142,-86.275400000000005) I guess you can go from there."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user3599924"}, "is_accepted": false, "score": 0, "last_activity_date": 1582246506, "creation_date": 1582246506, "answer_id": 60330720, "question_id": 57873989, "link": "https://stackoverflow.com/questions/57873989/golang-parse-point-datatype/60330720#60330720", "title": "GoLang Parse Point DataType", "body": "<p>As i can see you need to set to set a structure with the current lat, long and then unmarshal from the database.</p>\n"}], "owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 503, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1582246506, "creation_date": 1568129430, "question_id": 57873989, "link": "https://stackoverflow.com/questions/57873989/golang-parse-point-datatype", "title": "GoLang Parse Point DataType", "body": "<p>In my DB i have a table that require a coordinate value.\nsuch value is stored as a </p>\n\n<blockquote>\n  <p>Point DataType</p>\n</blockquote>\n\n<p>however when i try to obtain such value, GO responds with an error:</p>\n\n<blockquote>\n  <p>unsupported Scan, storing driver.Value type []uint8 into type *models.Point</p>\n</blockquote>\n\n<p>this is my Model</p>\n\n<pre><code>type Business struct {\n    ID int `json:\"id,omitempty\"`\n    Name string `json:\"name,omitempty\"`\n    Owner string `json:\"owner,omitempty\"`\n    Coordinates Point `json:\"coordinates,omitempty\"`\n    Reason string `json:\"reason,omitempty\"`\n    BusinessBranches []BusinessBranches `json:\"reason,omitempty\"`\n}\n</code></pre>\n\n<p>and this is the Point type model</p>\n\n<pre><code>type Point struct {\n    X float64 `json:\"lat\"`\n    Y float64 `json:\"lon\"`\n}\n</code></pre>\n\n<p>in my controller i call the selection of Business.</p>\n\n<pre><code>func (b *BusinessRepoImpl) Select() ([]models.Business, error) {\n    business_list := make([]models.Business, 0)\n    rows, err := b.Db.Query(\"SELECT id, name, owner, coordinates, reason FROM business\")\n    if err != nil {\n        return business_list, err\n    }\n    for rows.Next() {\n        business := models.Business{}\n        err := rows.Scan(&amp;business.ID, &amp;business.Name, &amp;business.Owner, &amp;business.Coordinates, &amp;business.Reason)\n        if err !=  nil {\n            fmt.Println(err)\n            break\n        }\n        business_list = append(business_list, business)\n    }\n    err = rows.Err()\n    if err != nil {\n        return business_list, err\n    }\n    return business_list, nil\n}\n</code></pre>\n\n<p>anyone know how to parse such DataType, so i can read it and store it?\nThanks. :)</p>\n"}, {"tags": ["git", "docker", "go"], "comments": [{"owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "edited": false, "score": 0, "creation_date": 1568138788, "post_id": 57873142, "comment_id": 102177033, "body": "What does the <code>Proxy-Authenticate</code> response header say? Do you get the same behavior if you issue a GET request with <code>curl</code>? Maybe see this <a href=\"https://stackoverflow.com/questions/10383299/how-do-i-configure-go-command-to-use-a-proxy\" title=\"how do i configure go command to use a proxy\">stackoverflow.com/questions/10383299/&hellip;</a>"}, {"owner": {"reputation": 493, "user_id": 9420497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61e1e486b8924298f25487988d52c828?s=128&d=identicon&r=PG&f=1", "display_name": "Brian", "link": "https://stackoverflow.com/users/9420497/brian"}, "reply_to_user": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "edited": false, "score": 0, "creation_date": 1568227928, "post_id": 57873142, "comment_id": 102211657, "body": "so when I curl directly I get a better picture. I get the same error, and it refer&#39;s to the forward to the new url (the github address). Is it possible to do a git clone on the site itself and somehow point go to the path locally?"}], "owner": {"reputation": 493, "user_id": 9420497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61e1e486b8924298f25487988d52c828?s=128&d=identicon&r=PG&f=1", "display_name": "Brian", "link": "https://stackoverflow.com/users/9420497/brian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1568132313, "creation_date": 1568126237, "last_edit_date": 1568132313, "question_id": 57873142, "link": "https://stackoverflow.com/questions/57873142/issues-with-proxy-and-go-modules-using-go-get", "title": "issues with proxy and Go modules using go get", "body": "<p>I am trying to get <code>go</code> modules from <code>github</code>.\nFor example:</p>\n\n<pre><code>go get -v -insecure github.com/aws/aws-sdk-go\ngo get -v -insecure github.com/gruntworks-io/terratest/modules/aws\nect..\n</code></pre>\n\n<p>in a <code>docker build</code>. \nI am behind a corporate proxy. I believe I have set them correctly:</p>\n\n<pre><code>http_proxy=....\nhttps_proxy=...\n</code></pre>\n\n<p>I get this message: <code>Received HTTP code 407 from proxy after connect</code>.</p>\n\n<p>I believe (I could be wrong) it is a proxy issue with accessing the <code>go</code> modules from <code>github</code>, possibly from forwarding that's taking place. </p>\n\n<p>I have tried a few <code>git</code> related settings to see if they help but no success yet.:</p>\n\n<pre><code>git config --global http.sslverify false &amp;&amp;\\\ngit config --global https.sslverify false &amp;&amp;\\\ngit config --global http.proxy http://... &amp;&amp;\\\ngit config --global https.proxy http://... &amp;&amp;\\\ngit config --global http.proxyAuthMethod 'basic' &amp;&amp;\\\ngit config --global https.proxyAuthMethod 'basic'\n</code></pre>\n\n<p>I don't think they would have an effect, but I tried for fun anyway. \nI'm open to ideas. One idea is to use <code>curl</code> in some way to get the modules and point <code>go</code> to the modules manually. I'm not sure if that would work and how. </p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "serverless-framework"], "comments": [{"owner": {"reputation": 4856, "user_id": 349333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/25b78ea128b61107fc07250603c981e2?s=128&d=identicon&r=PG", "display_name": "Jochem Schulenklopper", "link": "https://stackoverflow.com/users/349333/jochem-schulenklopper"}, "edited": false, "score": 0, "creation_date": 1568124783, "post_id": 57872576, "comment_id": 102170208, "body": "What I&#39;m trying to avoid is making one generic (rot) handler for all request types (HTTP GET, HTTP POST), and in that handler differentiate between the request types and relay the logic to the proper functions. But if that is what it requires..."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1568124870, "post_id": 57872576, "comment_id": 102170259, "body": "Have you tried calling the first <code>lambda.Start</code> as a goroutine (<code>go lambda.Start(HandleGetRequest)</code>)? Per the docs, <code>Start</code> blocks indefinitely, like <code>http.ListenAndServe</code> and similar server functions."}, {"owner": {"reputation": 4856, "user_id": 349333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/25b78ea128b61107fc07250603c981e2?s=128&d=identicon&r=PG", "display_name": "Jochem Schulenklopper", "link": "https://stackoverflow.com/users/349333/jochem-schulenklopper"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568126085, "post_id": 57872576, "comment_id": 102170985, "body": "Tried, but it doesn&#39;t work. The handlers in the <code>serverless.yml</code> apparently seem to be only valid when specifying a file, not a file-and-function. The error when trying to run the event handler is &quot;fork/exec /var/task/go-handler.HandleGet: no such file or directory: PathError&quot;, so it looks that a function cannot be specified."}], "answers": [{"comments": [{"owner": {"reputation": 4856, "user_id": 349333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/25b78ea128b61107fc07250603c981e2?s=128&d=identicon&r=PG", "display_name": "Jochem Schulenklopper", "link": "https://stackoverflow.com/users/349333/jochem-schulenklopper"}, "edited": false, "score": 2, "creation_date": 1568137159, "post_id": 57873778, "comment_id": 102176389, "body": "&quot;In essence, you&#39;re building a Go HTTP server, but in Lambda.&quot; Thanks. I was trying to avoid to make one generic handler for all request methods (HTTP GET, HTTP POST) and to relay the processing logic to the specific event handler functions. That&#39;s not necessary in Python, Ruby and JavaScript, as in those languages the proper functions can be specified directly. I guess that&#39;s currently not supported (by Serverless Framework, or by Go)."}, {"owner": {"reputation": 493, "user_id": 9397953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adb1da3d1fcaedcd0a2fc57a94d703ed?s=128&d=identicon&r=PG&f=1", "display_name": "mealesbia", "link": "https://stackoverflow.com/users/9397953/mealesbia"}, "edited": false, "score": 0, "creation_date": 1586871454, "post_id": 57873778, "comment_id": 108282945, "body": "So it is a good idea to use aws-lambda-go-api-proxy in your lambda, even if you have no greedy paths?"}], "tags": [], "owner": {"reputation": 1541, "user_id": 2232135, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7swMf.png?s=128&g=1", "display_name": "smcstewart", "link": "https://stackoverflow.com/users/2232135/smcstewart"}, "is_accepted": true, "score": 3, "last_activity_date": 1568129379, "last_edit_date": 1568129379, "creation_date": 1568128619, "answer_id": 57873778, "question_id": 57872576, "link": "https://stackoverflow.com/questions/57872576/specify-multiple-event-handlers-for-aws-lambda-in-go/57873778#57873778", "title": "Specify multiple event handlers for AWS Lambda in Go", "body": "<p>You can use the same function (and handler) for your <code>get</code> and your <code>post</code>:</p>\n\n<pre><code>skeleton-go:\n    name: skeleton-go\n    runtime: go1.x\n    handler: go-handler\n    events:\n      - http:\n          path: skeleton/go\n          method: get\n      - http:\n          path: skeleton/go\n          method: post\n</code></pre>\n\n<p>Use Go's <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">built-in HTTP router</a> or use a third-party one, such as <a href=\"https://www.gorillatoolkit.org/pkg/mux\" rel=\"nofollow noreferrer\">Gorilla Mux</a> or <a href=\"https://github.com/go-chi/chi\" rel=\"nofollow noreferrer\">Chi</a> as shown in the example code below (because that's what I had handy). In essence, you're building a Go HTTP server, but in Lambda. So, follow the details for setting up a Go web server, and take a look at <a href=\"https://github.com/awslabs/aws-lambda-go-api-proxy/\" rel=\"nofollow noreferrer\">AWS's API Gateway Proxy</a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"net/http\"\n\n    \"github.com/aws/aws-lambda-go/events\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n\n    \"github.com/go-chi/chi\"\n    chiproxy \"github.com/awslabs/aws-lambda-go-api-proxy/chi\"\n)\n\nvar adapter *chiproxy.ChiLambda\n\nfunc GetSkeleton(w http.ResponseWriter, r *http.Request) {\n    ...\n}\n\nfunc PostSkeletonToMom(w http.ResponseWriter, r *http.Request) {\n    ...\n}\n\nfunc init() {\n    r := chi.NewRouter()\n\n    r.Get(\"/skeleton/go\", GetSkeleton)\n    r.Post(\"/skeleton/go\", PostSkeletonToMom)\n\n    adapter = chiproxy.New(r)\n}\n\nfunc lambdaHandler(ctx context.Context, req events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) {\n    c, err := adapter.ProxyWithContext(ctx, req)\n\n    return c, err\n}\n\nfunc main() {\n    lambda.Start(lambdaHandler)\n}\n</code></pre>\n"}], "owner": {"reputation": 4856, "user_id": 349333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/25b78ea128b61107fc07250603c981e2?s=128&d=identicon&r=PG", "display_name": "Jochem Schulenklopper", "link": "https://stackoverflow.com/users/349333/jochem-schulenklopper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1717, "favorite_count": 0, "accepted_answer_id": 57873778, "answer_count": 1, "score": 4, "last_activity_date": 1568135457, "creation_date": 1568124457, "last_edit_date": 1568135457, "question_id": 57872576, "link": "https://stackoverflow.com/questions/57872576/specify-multiple-event-handlers-for-aws-lambda-in-go", "title": "Specify multiple event handlers for AWS Lambda in Go", "body": "<p>Typically, a AWS Lambda event handler code in Go (using Serverless Framework) is coded as:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n  \"fmt\"\n  \"context\"\n  \"github.com/aws/aws-lambda-go/lambda\"\n)\n\ntype MyEvent struct {\n  Name string `json:\"name\"`\n}\n\nfunc HandleRequest(ctx context.Context, name MyEvent) (string, error) {\n  return fmt.Sprintf(\"Hello %s!\", name.Name ), nil\n}\n\nfunc main() {\n  lambda.Start(HandleRequest)\n}\n</code></pre>\n\n<p>The <code>serverless.yml</code> file then contains a section like:</p>\n\n<pre><code>  skeleton-go-get:\n    name: skeleton-go-get\n    runtime: go1.x\n    handler: go-handler  # &lt;- This specifies a file, not a function.\n    events:\n      - http:\n          path: skeleton/go\n          method: get\n</code></pre>\n\n<p>That ^ creates one request handler... but now I want my one Go script / program to contain the event handlers for both HTTP GET and POST requests, and not use one Go program file per serverless function.</p>\n\n<p>Exactly this is possible in languages like Node.js, Ruby, Python, with the <code>serverless.yml</code> specifying which function in the handler file is to be used for which serverless function. For example (for Python functions):</p>\n\n<pre><code>[...]\nfunctions:\n  skeleton-python-get:\n    name: skeleton-python-get\n    handler: python-handler.handle_get  # &lt;- Specifies the HTTP GET handler.\n    events:\n      - http:\n          path: skeleton/python\n          method: get\n  skeleton-python-post:\n    name: skeleton-python-post\n    handler: python-handler.handle_post  # &lt;- Specifies the HTTP POST handler.\n    events:\n      - http:\n          path: skeleton/python\n          method: post\n</code></pre>\n\n<p>I cannot get this same trick to work for Go. I tried to include the proper request in <code>main()</code> but to no avail:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func HandleGetRequest(ctx context.Context, name MyEvent) (string, error) {\n  return fmt.Sprintf(\"Hello %s!\", name.Name ), nil\n}\n\nfunc HandlePostRequest(ctx context.Context, name MyEvent) (string, error) {\n  return fmt.Sprintf(\"Hello %s!\", name.Name ), nil\n}\n\nfunc main() {\n  lambda.Start(HandleGetRequest)\n  lambda.Start(HandlePostRequest)  // &lt;- Attempt to add another handler.\n}\n</code></pre>\n\n<p>And specifying multiple event handler functions in the <code>serverless.yml</code> file for the Go handlers also doesn't work: the function isn't a valid part of the handler declaration.</p>\n\n<pre><code>  skeleton-go-get:\n    name: skeleton-go-get\n    runtime: go1.x\n    handler: go-handler.HandleGet  # &lt;- Attempt to specify a function.\n    events:\n      - http:\n          path: skeleton/go\n          method: get\n\n  skeleton-go-post:\n    name: skeleton-go-post\n    runtime: go1.x\n    handler: go-handler.HandlePost  # &lt;- Attempt to specify a function.\n    events:\n      - http:\n          path: skeleton/go\n          method: post\n</code></pre>\n\n<p>Q: How can I include more than one AWS Lambda event handler in one Go program (using Serverless Framework)?</p>\n"}, {"tags": ["unit-testing", "http", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1568124452, "post_id": 57872522, "comment_id": 102170008, "body": "Malformed URLs should produce an error, or URLs with a scheme other than http or https."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1568125328, "post_id": 57872522, "comment_id": 102170537, "body": "Yep. Pretty much the only way <a href=\"https://golang.org/src/net/http/request.go?s=26884:26953#L802\" rel=\"nofollow noreferrer\"><code>NewRequest</code></a> can fail is if you pass an invalid URL, or an &quot;invalid&quot; (not just blank, it will default to GET) method. The latter is a whole separate problem because according to the spec, <a href=\"https://tools.ietf.org/html/rfc2616#section-5.1.1\" rel=\"nofollow noreferrer\">non-standard methods are permitted</a>."}, {"owner": {"reputation": 10642, "user_id": 1251684, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iX2Jq.png?s=128&g=1", "display_name": "BentCoder", "link": "https://stackoverflow.com/users/1251684/bentcoder"}, "edited": false, "score": 2, "creation_date": 1587979241, "post_id": 57872522, "comment_id": 108712147, "body": "Or just use <code>&quot;*?&quot;</code> as request method. This should return <code>net&#47;http: invalid method &quot;*?&quot;</code> error."}, {"owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "edited": false, "score": 0, "creation_date": 1614350492, "post_id": 57872522, "comment_id": 117366546, "body": "In case you can&#39;t change the request method, you can also pass <code>string([]byte{0x7f})</code> as the URL; this will result in a <code>parse &quot;\\u007f&quot;: net&#47;url: invalid control character in URL</code> error."}], "answers": [{"tags": [], "owner": {"reputation": 96, "user_id": 6337003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bh17B.jpg?s=128&g=1", "display_name": "Jeremie Zazoun", "link": "https://stackoverflow.com/users/6337003/jeremie-zazoun"}, "is_accepted": false, "score": 0, "last_activity_date": 1608631638, "creation_date": 1608631638, "answer_id": 65406734, "question_id": 57872522, "link": "https://stackoverflow.com/questions/57872522/how-to-mock-http-newrequest-to-return-an-error/65406734#65406734", "title": "How to mock http.NewRequest to return an error", "body": "<p>If you want your tests to be reliable you should try to avoid mocking as much as you can.</p>\n<p>So if you are wondering how you can test a library that is creating http request, the best way is to create a local server in your unit test, this way you can test every aspects of the request.</p>\n<p>The best example I can provide you is this: <a href=\"https://github.com/gojek/heimdall/blob/master/httpclient/client_test.go\" rel=\"nofollow noreferrer\">https://github.com/gojek/heimdall/blob/master/httpclient/client_test.go</a>\nIn Heimdall an open source http client, you can see how they implemented the tests without mocks.</p>\n<p>And for your specific question, BentCoder replied to you: &quot;just use &quot;*?&quot; as request method. This should return <code>net/http: invalid method &quot;*?&quot; error.</code>&quot;</p>\n"}], "owner": {"reputation": 347, "user_id": 4843781, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/52c093f50721e23f74c85989baafc1b1?s=128&d=identicon&r=PG&f=1", "display_name": "Roger", "link": "https://stackoverflow.com/users/4843781/roger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 780, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1608631638, "creation_date": 1568124227, "last_edit_date": 1568127508, "question_id": 57872522, "link": "https://stackoverflow.com/questions/57872522/how-to-mock-http-newrequest-to-return-an-error", "title": "How to mock http.NewRequest to return an error", "body": "<p>I have a Go method that makes an http request to an external web page, that I am screen scraping.  I have unit tests for when everything works as planned.  I can mock the httpclient and set the response to a predefined value.  However, I am having trouble creating tests for when things don't work.  I want to mock http.NewRequest to return an error.</p>\n\n<p>I am using httptest and go tool cover.</p>\n\n<p>Method to test:</p>\n\n<pre><code>func (cli *Client) GetSomething(sometext string) (string, error) {\n\n    searchURL := strings.Replace(someUrl, \"{PERSON_NAME}\", url.QueryEscape(sometext), 1)\n    req, err := http.NewRequest(\"GET\", someUrl, nil)\n    if err != nil {\n    // I want to test this scenario\n        return \"\", errors.Wrap(err, \"failed to build request\")\n    }\n\n    resp, err := cli.HTTPClient.Do(req)\n\n    if err != nil {\n        return \"\", errors.Wrap(err, \"request failed\")\n    }\n\n    defer resp.Body.Close()\n\n    document, err := goquery.NewDocumentFromReader(resp.Body)\n\n    if err != nil {\n        return \"\", err\n    }\n\n    value:= document.Find(\".someclass\").Text()\n\n    return value, nil\n}\n</code></pre>\n\n<p>Test Method works for the httpclient.  Not sure how to mock http.NewRequest to return an error.  This would probably never happen, but just to be complete and as an exercise.</p>\n\n<pre><code>func TestGetSomethingFailedReqest(t *testing.T) {\n\n    h := http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        panic(\"Create error\")\n    })\n\n//TestingHTTPClient is a helper function to create an HTTPClient.  Not needed for this test.\n\n    httpClient, teardown := test.TestingHTTPClient(h)  \n    defer teardown()\n    scraperClient := NewClient()\n    scraperClient.HTTPClient = httpClient\n\n    var person= \"John Doe\"\n\n    _, err := scraperClient.GetSomething(person)\n\n    assert.Regexp(t, \".*failed to build request\", err.Error())\n}\n\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "kubectl", "client-go"], "answers": [{"tags": [], "owner": {"reputation": 2069, "user_id": 11207414, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe8d2b0efd28e43f5580e7546cf912f5?s=128&d=identicon&r=PG&f=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/11207414/mark"}, "is_accepted": false, "score": 0, "last_activity_date": 1568197508, "last_edit_date": 1592644375, "creation_date": 1568197508, "answer_id": 57887076, "question_id": 57872287, "link": "https://stackoverflow.com/questions/57872287/how-to-retrieve-all-the-data-from-kubectl-describe-pods-namespace-from-an-in-c/57887076#57887076", "title": "How to retrieve all the data from kubectl describe pods &lt;namespace&gt; from an in-cluster client-go api call", "body": "<p>I didn't try, but I would suggest to start with:</p>\n<p><strong>1.</strong> using kubectl with  --verbosity option to see the full api request</p>\n<pre><code> kubectl describe pod xxx -v=8 \n</code></pre>\n<p>like:</p>\n<pre><code>  GET https://xx.xx.xx.xx:6443/api/v1/namespaces/default/events?fieldSelector=involvedObject.uid%3Ddd77c4aa-28e6-4bf0-8dfe-0d8610cbe9c9%2CinvolvedObject.name%3Dmy-app%2CinvolvedObject.namespace%3Ddefault\n</code></pre>\n<p>It contains fields related to your POD: <strong>fieldSelector=involvedObject.uid, involvedObject.name, involvedObject.namespace</strong></p>\n<p><strong>2.</strong> I thing the good start it will be the code from github <a href=\"https://github.com/kubernetes/kubernetes/blob/b6a0718858876bbf8cedaeeb47e6de7e650a6c5b/pkg/kubectl/describe/versioned/describe.go#L619\" rel=\"nofollow noreferrer\">func describePod</a> to start with.</p>\n<p>Hope this help.</p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 5158171, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-HNRaOPNrZ_c/AAAAAAAAAAI/AAAAAAAAANM/I2dP1KfTQXI/photo.jpg?sz=128", "display_name": "Ben Lord", "link": "https://stackoverflow.com/users/5158171/ben-lord"}, "edited": false, "score": 0, "creation_date": 1568226010, "post_id": 57887976, "comment_id": 102210835, "body": "Thanks for the pointers, I&#39;ll delve into this and give it a shot. I&#39;ll report back when I have something working. Cheers"}], "tags": [], "owner": {"reputation": 781, "user_id": 207488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZIIlL.jpg?s=128&g=1", "display_name": "cewood", "link": "https://stackoverflow.com/users/207488/cewood"}, "is_accepted": false, "score": 2, "last_activity_date": 1568200727, "creation_date": 1568200727, "answer_id": 57887976, "question_id": 57872287, "link": "https://stackoverflow.com/questions/57872287/how-to-retrieve-all-the-data-from-kubectl-describe-pods-namespace-from-an-in-c/57887976#57887976", "title": "How to retrieve all the data from kubectl describe pods &lt;namespace&gt; from an in-cluster client-go api call", "body": "<p>Looking at the <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/kubectl/pkg/describe/versioned/describe.go#L668\" rel=\"nofollow noreferrer\">describePod</a> and <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/kubectl/pkg/describe/versioned/describe.go#L632\" rel=\"nofollow noreferrer\">Describe</a> funcs from staging/src/k8s.io/kubectl/pkg/describe/versioned/describe.go should give you a better picture of how to do this. And since <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/kubectl/pkg/describe/versioned/describe.go#L632\" rel=\"nofollow noreferrer\">Describe</a> and <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/kubectl/pkg/describe/versioned/describe.go#L628\" rel=\"nofollow noreferrer\">PodDescriber</a> are public, you can reuse these for your use case.</p>\n\n<p>You could couple this with a <a href=\"https://godoc.org/k8s.io/client-go/kubernetes/typed/core/v1#CoreV1Client\" rel=\"nofollow noreferrer\">CoreV1Client</a> which has a <a href=\"https://godoc.org/k8s.io/client-go/kubernetes/typed/core/v1#CoreV1Client.Pods\" rel=\"nofollow noreferrer\">Pods</a> func, that returns a <a href=\"https://godoc.org/k8s.io/client-go/kubernetes/typed/core/v1#PodInterface\" rel=\"nofollow noreferrer\">PodInterface</a> that has a <a href=\"https://godoc.org/k8s.io/api/core/v1#PodList\" rel=\"nofollow noreferrer\">List</a> func which would return a list of <a href=\"https://godoc.org/k8s.io/api/core/v1#Pod\" rel=\"nofollow noreferrer\">Pod</a> objects for the given namespace.</p>\n\n<p>Those pod objects will provide the Name needed for the <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/kubectl/pkg/describe/versioned/describe.go#L632\" rel=\"nofollow noreferrer\">Describe</a> func, the Namespace is already known, and the <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/kubectl/pkg/describe/interface.go#L49\" rel=\"nofollow noreferrer\">describe.DescriberSettings</a> is just a struct type that you could inline to enable showing events in the <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/kubectl/pkg/describe/versioned/describe.go#L632\" rel=\"nofollow noreferrer\">Describe</a> output.</p>\n\n<p>Using the <a href=\"https://godoc.org/k8s.io/api/core/v1#PodList\" rel=\"nofollow noreferrer\">List</a> func will only list the pods that one time. If you're interested in having this list be updated regularly, you might want to look at the Reflector and Informer patterns; both of which are largely implemented in the <a href=\"https://godoc.org/k8s.io/client-go/tools/cache\" rel=\"nofollow noreferrer\">tools/cache</a> package, and the docs briefly explain this concept in the <a href=\"https://kubernetes.io/docs/reference/using-api/api-concepts/#efficient-detection-of-changes\" rel=\"nofollow noreferrer\">Efficient detection of changes</a> section.</p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 1, "user_id": 5158171, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-HNRaOPNrZ_c/AAAAAAAAAAI/AAAAAAAAANM/I2dP1KfTQXI/photo.jpg?sz=128", "display_name": "Ben Lord", "link": "https://stackoverflow.com/users/5158171/ben-lord"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1462, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1569367820, "creation_date": 1568123438, "question_id": 57872287, "link": "https://stackoverflow.com/questions/57872287/how-to-retrieve-all-the-data-from-kubectl-describe-pods-namespace-from-an-in-c", "title": "How to retrieve all the data from kubectl describe pods &lt;namespace&gt; from an in-cluster client-go api call", "body": "<p>I need to grab some pod information which will be used for some unit tests which will be run in-cluster. I need all the information which kubectl describe po  gives but from an in cluster api call. </p>\n\n<p>I have some working code which makes an api call to apis/metrics.k8s.io/v1beta1/pods, and have installed the metrics-server on minikube for testing which is all working and gives me output like this: </p>\n\n<pre><code>Namespace: kube-system\nPod name: heapster-rgnlj\nSelfLink: /apis/metrics.k8s.io/v1beta1/namespaces/kube-system/pods/heapster-rgnlj\nCreationTimestamp: 2019-09-10 12:27:13 +0000 UTC\nWindow: 30s\nTimestamp: 2019-09-10 12:26:23 +0000 UTC\nName: heapster\nCpu usage: 82166n\nMem usage: 19420Ki \n</code></pre>\n\n<pre><code>...\nfunc getMetrics(clientset *kubernetes.Clientset, pods *PodMetricsList) error {\n    data, err := clientset.RESTClient().Get().AbsPath(\"apis/metrics.k8s.io/v1beta1/pods\").DoRaw()\n    if err != nil {\n        return err\n    }\n    err = json.Unmarshal(data, &amp;pods)\n    return err\n}\n\nfunc main() {\n\n    config, err := rest.InClusterConfig()\n    if err != nil {\n        fmt.Println(err)\n    }\n    // creates the clientset\n    clientset, err := kubernetes.NewForConfig(config)\n    if err != nil {\n        fmt.Println(err)\n    }\n    var pods PodMetricsList\n    err = getMetrics(clientset, &amp;pods)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    for _, m := range pods.Items {\n\n        fmt.Print(\"Namespace: \", m.Metadata.Namespace, \"\\n\", \"Pod name: \", m.Metadata.Name, \"\\n\", )\n        fmt.Print(\"SelfLink: \", m.Metadata.SelfLink, \"\\n\", \"CreationTimestamp: \", m.Metadata.CreationTimestamp, \"\\n\", )\n        fmt.Print(\"Window: \", m.Window, \"\\n\", \"Timestamp: \", m.Timestamp, \"\\n\", )\n\n        for _, c := range m.Containers {\n            fmt.Println(\"Name:\", c.Name)\n            fmt.Println(\"Cpu usage:\", c.Usage.CPU)\n            fmt.Println(\"Mem usage:\", c.Usage.Memory, \"\\n\")\n...\n</code></pre>\n\n<p>As I say, what i really need is what you'd get with a 'describe pods' type call. Having looked through the kubernetes source this NodeDescriber looks like the right type of function, but I'm slightly at a loss as to how to integrate / implement it to get the desired results. </p>\n\n<p>kubernetes/pkg/printers/internalversion/describe.go</p>\n\n<p>Line 2451 in 4f2d7b9</p>\n\n<p>func (d *NodeDescriber) Describe(namespace, name string, describerSettings...etc)</p>\n\n<p>I'm new to Go and not particularly familiar with kubernetes.\nAny pointers as to how to go about it would be greatly appreciated.</p>\n"}, {"tags": ["dictionary", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "edited": false, "score": 0, "creation_date": 1568158117, "post_id": 57871467, "comment_id": 102183162, "body": ":facepalm: yes, <code>for _, key</code> makes complete sense.  Thanks for pointing that out.  I&#39;m also super grateful for this more efficient approach.  So <code>[:0]</code> is basically selecting no batch keys, thus returning an empty map, effectively clearing it out?"}, {"owner": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "edited": false, "score": 0, "creation_date": 1568158546, "post_id": 57871467, "comment_id": 102183242, "body": "Bonus question: If it takes 30 seconds for <code>for k := range items {</code> to process these items, but throughout that 30 seconds the length of <code>items</code> changes and some of the <code>int</code> values are changed, will any errors be encountered?  I&#39;m fine not picking up on those updates..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "edited": false, "score": 0, "creation_date": 1568186397, "post_id": 57871467, "comment_id": 102190490, "body": "@Webnet The batch keys are gathered in a <i>slice</i> called <code>batchKeys</code>. <code>batchKeys = batchKeys[:0]</code> means to reslice this slice having a new length of <code>0</code>. This has the effect of &quot;clearing&quot; the slice (throwing away the previous batch&#39;s keys), and has the benefit of keeping the backing array, so it can be reused, no reallocation is required, no garbage is generated."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "edited": false, "score": 0, "creation_date": 1568186565, "post_id": 57871467, "comment_id": 102190560, "body": "@Webnet Bonus answer: if you add entries to the map while iterating over, that&#39;s not a problem, but the new elements may or may not be visited by the loop, see <a href=\"https://stackoverflow.com/questions/55399243/how-to-add-into-map-in-range-loop/55399337#55399337\">How to add into map in range loop</a>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "edited": false, "score": 0, "creation_date": 1568186595, "post_id": 57871467, "comment_id": 102190573, "body": "... This applies if you add elements in the same loop. If you add elements in another goroutine, you must synchronize access to the map, else that&#39;s a race condition and the runtime will intentionally crash your app, see <a href=\"https://stackoverflow.com/questions/39288741/how-to-recover-from-concurrent-map-writes/39289246#39289246\">How to recover from concurrent map writes?</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "edited": false, "score": 1, "creation_date": 1568186669, "post_id": 57871467, "comment_id": 102190616, "body": "... See this question how to apply proper synchronization if you need to add elements to a map in another goroutine while you iterate over it: <a href=\"https://stackoverflow.com/questions/40442846/concurrent-access-to-maps-with-range-in-go/40456170#40456170\">Concurrent access to maps with &#39;range&#39; in Go</a>. Although the easiest is to block modifications while you iterate over it (but that may be a problem to you if looping over it takes a long time)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1568122143, "last_edit_date": 1568122143, "creation_date": 1568120704, "answer_id": 57871467, "question_id": 57871411, "link": "https://stackoverflow.com/questions/57871411/how-to-slice-a-mapstringint-into-chunks/57871467#57871467", "title": "How to slice a map[string]int into chunks", "body": "<p>When you process a chunk:</p>\n\n<pre><code>for x := range keys[chunkStart:chunkEnd] {}\n</code></pre>\n\n<p>You are iterating over a slice, and having one iteration variable, it will be the slice index, not the element from the slice (at the given index). Hence it will always start at <code>0</code>. (When you iterate over a map, first iteration variable is the key because there is no index there, and the second is the value associated with that key.)</p>\n\n<p>Instead you want this:</p>\n\n<pre><code>for _, key := range keys[chunkStart:chunkEnd] {}\n</code></pre>\n\n<p>Also note that it's redundant to first collect the keys in a slice, and then  process them. You may do that when iterating over the map once, at first. Just keep a variable counting the iterations to know when you reach the chunk size, which may be implicit if you use data structures that keeps this (e.g. the size of a keys batch slice).</p>\n\n<p>For example (try it on the <a href=\"https://play.golang.org/p/NfaIFqqh8sO\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>chunkSize := 20\nbatchKeys := make([]string, 0, chunkSize)\nprocess := func() {\n    fmt.Println(\"Batch keys:\", batchKeys)\n    batchKeys = batchKeys[:0]\n}\n\nfor k := range items {\n    batchKeys = append(batchKeys, k)\n    if len(batchKeys) == chunkSize {\n        process()\n    }\n}\n// Process last, potentially incomplete batch\nif len(batchKeys) &gt; 0 {\n    process()\n}\n</code></pre>\n"}], "owner": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 828, "favorite_count": 0, "accepted_answer_id": 57871467, "answer_count": 1, "score": 2, "last_activity_date": 1568122176, "creation_date": 1568120511, "last_edit_date": 1568122176, "question_id": 57871411, "link": "https://stackoverflow.com/questions/57871411/how-to-slice-a-mapstringint-into-chunks", "title": "How to slice a map[string]int into chunks", "body": "<p>My objective is to take a <code>map[string]int</code> containing potentially up to a million entries and chunk it in sizes of up to 500 and POST the map to an external service.  I'm newer to golang, so I'm tinkering in the Go Playground for now.</p>\n\n<blockquote>\n  <p>Any tips anyone has on how to improve the efficiency of my code base, please share!</p>\n</blockquote>\n\n<p>Playground: <a href=\"https://play.golang.org/p/eJ4_Pd9X91c\" rel=\"nofollow noreferrer\">https://play.golang.org/p/eJ4_Pd9X91c</a></p>\n\n<p>The CLI output I'm seeing is:</p>\n\n<pre><code>original size 60\nchunk bookends 0 20\n0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,\nchunk bookends 20 40\n0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,\nchunk bookends 40 60\n0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,\n</code></pre>\n\n<p>The problem here is that while the chunk bookends are being calculated correctly, the <code>x</code> value is starting at 0 each time.  I think I should expect it to start at the chunk bookend minimum, which would be 0, 20, 40, etc.  <strong>How come the range is starting at zero each time?</strong></p>\n\n<p>Source:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"strconv\"\n)\n\nfunc main() {\n    items := make(map[string]int)\n\n    // Generate some fake data for our testing, in reality this could be 1m entries\n    for i := 0; i &lt; 60; i ++ {\n        // int as strings are intentional here\n        items[strconv.FormatInt(int64(rand.Int()), 10)] = rand.Int()\n    }\n\n    // Create a map of just keys so we can easily chunk based on the numeric keys\n    i := 0\n    keys := make([]string, len(items))\n    for k := range items {\n            keys[i] = k\n            i++\n    }\n\n    fmt.Println(\"original size\", len(keys))\n    //batchContents := make(map[string]int)\n\n    // Iterate numbers in the size batch we're looking for\n    chunkSize := 20\n    for chunkStart := 0; chunkStart &lt; len(keys); chunkStart += chunkSize {\n        chunkEnd := chunkStart + chunkSize\n\n        if chunkEnd &gt; len(items) {  \n            chunkEnd = len(items)\n        }\n\n        // Iterate over the keys\n        fmt.Println(\"chunk bookends\", chunkStart, chunkEnd)\n        for x := range keys[chunkStart:chunkEnd] {\n            fmt.Print(x, \",\")\n\n            // Build the batch contents with the contents needed from items\n            // @todo is there a more efficient approach?\n            //batchContents[keys[i]] = items[keys[i]]\n        }\n        fmt.Println()\n\n        // @todo POST final batch contents\n        //fmt.Println(batchContents)\n    }\n\n}\n</code></pre>\n"}, {"tags": ["tensorflow", "go", "tensorflow-serving"], "owner": {"reputation": 1248, "user_id": 4921432, "user_type": "registered", "accept_rate": 94, "profile_image": "https://graph.facebook.com/832297310191806/picture?type=large", "display_name": "Jim", "link": "https://stackoverflow.com/users/4921432/jim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1568111916, "creation_date": 1568111916, "question_id": 57869029, "link": "https://stackoverflow.com/questions/57869029/tensorflow-serving-sharedbatchscheduler-for-golang", "title": "Tensorflow serving SharedBatchScheduler for golang", "body": "<p>I want to optimize serving tensorflow model in Golang and study tensorflow serving.</p>\n\n<p><a href=\"https://github.com/tensorflow/serving/tree/master/tensorflow_serving/batching#servers-with-multiple-models-model-versions-or-subtasks\" rel=\"nofollow noreferrer\">servers-with-multiple-models-model-versions-or-subtasks</a></p>\n\n<blockquote>\n  <p>SharedBatchScheduler presents an abstraction of queues, accepts requests to schedule a particular kind of task. Each batch contains tasks of just one type, i.e. from one queue. The scheduler ensures fairness by interleaving the different types of batches.</p>\n</blockquote>\n\n<p>Is there any Golang repo working on SharedBatchScheduler? Or I have to rewrite the tensorflow serving <a href=\"https://github.com/tensorflow/serving/issues/96\" rel=\"nofollow noreferrer\">BatchingSession</a> C++ source code to Golang version?</p>\n"}, {"tags": ["go", "time", "duration"], "answers": [{"tags": [], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "is_accepted": false, "score": 1, "last_activity_date": 1568111192, "last_edit_date": 1568111192, "creation_date": 1568110676, "answer_id": 57868675, "question_id": 57868612, "link": "https://stackoverflow.com/questions/57868612/golang-fmt-println-timer/57868675#57868675", "title": "Golang fmt.Println timer", "body": "<p>If you want to do something only once <strong>after</strong> 5 minutes you can use goroutine and <code>WaitGroup</code>:</p>\n\n<pre><code>var wg sync.WaitGroup\nwg.Add(1)\n\ngo func() {\n   defer wg.Done()\n   time.Sleep(...)\n   fmt.Println(\"hello\")\n}()\nwg.Wait()\n</code></pre>\n\n<p>Go playground example: <a href=\"https://play.golang.org/p/UxJ76f44k3x\" rel=\"nofollow noreferrer\">https://play.golang.org/p/UxJ76f44k3x</a></p>\n\n<p>If you want to do something <strong>every 5 minutes</strong>:</p>\n\n<pre><code>func doEvery(d time.Duration, f func(time.Time)) {\n    for x := range time.Tick(d) {\n        f(x)\n    }\n}\n\nfunc helloworld(t time.Time) {\n    fmt.Printf(\"%v: Hello, World!\\n\", t)\n}\n\nfunc main() {\n    doEvery(3*time.Second, helloworld)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/0S3MfGlgVRL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0S3MfGlgVRL</a></p>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 10125510, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_qfS36ltJTU/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qctxv4YWwWczLPQY4IbzDYIiR20A/mo/photo.jpg?sz=128", "display_name": "xu feng", "link": "https://stackoverflow.com/users/10125510/xu-feng"}, "is_accepted": false, "score": 2, "last_activity_date": 1568114395, "last_edit_date": 1568114395, "creation_date": 1568112002, "answer_id": 57869045, "question_id": 57868612, "link": "https://stackoverflow.com/questions/57868612/golang-fmt-println-timer/57869045#57869045", "title": "Golang fmt.Println timer", "body": "<p>If do something after 5min, simply use <code>time.AfterFunc</code>:</p>\n\n<pre><code>time.AfterFunc(time.Minute * 5, func() {\n    // Do something after 5min\n    h := fmt.Sprintf(\"%x\", word)\n    fmt.Println(h)\n})\n</code></pre>\n\n<p>Else if do something every 5min, use for loop (and go routine if need):</p>\n\n<pre><code>for{\n    time.Sleep(time.Minute * 5)\n    // Do something every 5min\n    h := fmt.Sprintf(\"%x\", word)\n    fmt.Println(h)\n}\n</code></pre>\n\n<p>Other way, use <code>time.NewTicker</code> can get a time counter:</p>\n\n<pre><code>ticker:=time.NewTicker(time.Minute * 5)\nfor{\n    select{\n    case &lt;-ticker.C:\n        // Do something every 5min\n        h := fmt.Sprintf(\"%x\", word)\n        fmt.Println(h)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 1, "creation_date": 1568173621, "post_id": 57869684, "comment_id": 102186528, "body": "I have found another link and updated the answer."}, {"owner": {"reputation": 85, "user_id": 5009007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dafb59e4b59a4b2cf29b66517f1dbdbf?s=128&d=identicon&r=PG&f=1", "display_name": "Mad", "link": "https://stackoverflow.com/users/5009007/mad"}, "edited": false, "score": 0, "creation_date": 1568197203, "post_id": 57869684, "comment_id": 102195920, "body": "Thanks! But seems I haven&#39;t asked the correct question. Check <b>EDIT</b> part and tell me if this is useful :)"}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "reply_to_user": {"reputation": 85, "user_id": 5009007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dafb59e4b59a4b2cf29b66517f1dbdbf?s=128&d=identicon&r=PG&f=1", "display_name": "Mad", "link": "https://stackoverflow.com/users/5009007/mad"}, "edited": false, "score": 1, "creation_date": 1568198838, "post_id": 57869684, "comment_id": 102196746, "body": "@Mad But you should specify that first."}, {"owner": {"reputation": 85, "user_id": 5009007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dafb59e4b59a4b2cf29b66517f1dbdbf?s=128&d=identicon&r=PG&f=1", "display_name": "Mad", "link": "https://stackoverflow.com/users/5009007/mad"}, "edited": false, "score": 0, "creation_date": 1568212356, "post_id": 57869684, "comment_id": 102204263, "body": "yeah sorry for that :("}], "tags": [], "owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "is_accepted": false, "score": 1, "last_activity_date": 1568173577, "last_edit_date": 1568173577, "creation_date": 1568114279, "answer_id": 57869684, "question_id": 57868612, "link": "https://stackoverflow.com/questions/57868612/golang-fmt-println-timer/57869684#57869684", "title": "Golang fmt.Println timer", "body": "<p>There are ways to do a task repeatedly. It is up to you which one you choose. Some are listed:</p>\n\n<ul>\n<li><p>Simplest way (may be):</p>\n\n<pre><code>go func() {\n    for {\n        fmt.Println(\"hello\")\n        time.Sleep(5 * time.Minute)\n    }\n}()\ntime.Sleep(30 * time.Minute)\n</code></pre></li>\n<li><p><a href=\"https://golang.org/pkg/time/#NewTicker\" rel=\"nofollow noreferrer\">func NewTicker</a> returns a new Ticker containing a channel that will send the time with a period specified by the duration argument.</p>\n\n<pre><code>ticker := time.NewTicker(5 * time.Minute)\ndefer ticker.Stop()\ndone := make(chan bool)\ngo func() {\n    time.Sleep(30 * time.Minute)\n    done &lt;- true\n}()\nfor {\n    select {\n    case &lt;-done:\n        fmt.Println(\"Done!\")\n        return\n    case &lt;-ticker.C:\n        fmt.Println(\"hello\")\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/_Deey4oJDNn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_Deey4oJDNn</a></p></li>\n<li><p>If you don't like to use the channel, then</p>\n\n<pre><code>go func() {\n    for range time.Tick(5 * time.Second){\n        fmt.Println(\"hello\")\n    }\n}()\ntime.Sleep(30 * time.Second)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/s2efNToSymM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/s2efNToSymM</a></p></li>\n<li><p><a href=\"https://github.com/robfig/cron\" rel=\"nofollow noreferrer\">https://github.com/robfig/cron</a> is also helpful.</p>\n\n<pre><code>c := cron.New()\nc.AddFunc(\"@every 5m\", func() { fmt.Println(\"hello\") })\nc.Start()\nselect {}\n</code></pre></li>\n</ul>\n\n<p><strong>UPDATE</strong></p>\n\n<ul>\n<li>I have found another link in github: <a href=\"https://gist.github.com/ryanfitz/4191392\" rel=\"nofollow noreferrer\">two ways to call a function every 2 seconds</a></li>\n</ul>\n"}], "owner": {"reputation": 85, "user_id": 5009007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dafb59e4b59a4b2cf29b66517f1dbdbf?s=128&d=identicon&r=PG&f=1", "display_name": "Mad", "link": "https://stackoverflow.com/users/5009007/mad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 0, "closed_date": 1568116934, "answer_count": 3, "score": -3, "last_activity_date": 1568173577, "creation_date": 1568110469, "last_edit_date": 1568142319, "question_id": 57868612, "link": "https://stackoverflow.com/questions/57868612/golang-fmt-println-timer", "closed_reason": "Duplicate", "title": "Golang fmt.Println timer", "body": "<p>How can I use fmt.Println only every 5 min</p>\n\n<pre><code>h := fmt.Sprintf(\"%x\", word)\nfmt.Println(h)\n</code></pre>\n\n<p>I need something like this:\n<strong>if time := 5 min then fmt.Println(h)</strong></p>\n\n<p>just to show <strong>(n)</strong> only every 5 min not every line</p>\n\n<blockquote>\n  <p><strong>EDIT: Obviously I haven't asked the correct question.</strong></p>\n  \n  <p>There is a cycle which generate random digits every second.</p>\n\n<pre><code>for i := n1; i.Cmp(n2) &lt; 0; i.Add(i, one) {\n</code></pre>\n  \n  <p>What I want is: not to show every generated variable (i) but\n  just one in every 5 minutes.</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1568110227, "post_id": 57868506, "comment_id": 102162017, "body": "You have to convert <code>[]string</code> to <code>[]interface{}</code> before passing it to <code>Exec</code>. And the way to do that is to loop over the strings and add each one to a new slice of interface{}."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1568110311, "post_id": 57868506, "comment_id": 102162067, "body": "<a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_of_interface</a>"}, {"owner": {"reputation": 378, "user_id": 2661434, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/wlA7d.png?s=128&g=1", "display_name": "Ram", "link": "https://stackoverflow.com/users/2661434/ram"}, "edited": false, "score": 0, "creation_date": 1568110445, "post_id": 57868506, "comment_id": 102162136, "body": "any other solution without using loop"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1568110496, "post_id": 57868506, "comment_id": 102162168, "body": "No, there isn&#39;t."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1568111961, "post_id": 57868506, "comment_id": 102162878, "body": "@mkopriva He could use a recursive solution which formally isn&#39;t a loop ;-)"}], "answers": [{"comments": [{"owner": {"reputation": 378, "user_id": 2661434, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/wlA7d.png?s=128&g=1", "display_name": "Ram", "link": "https://stackoverflow.com/users/2661434/ram"}, "edited": false, "score": 0, "creation_date": 1568111859, "post_id": 57868642, "comment_id": 102162822, "body": "v:= []interface{}{&quot;nantha&quot;,&quot;nk&quot;} -&gt; Insert(q,v) i&#39;m getting unsupported type []interface {}, a slice of interface"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 378, "user_id": 2661434, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/wlA7d.png?s=128&g=1", "display_name": "Ram", "link": "https://stackoverflow.com/users/2661434/ram"}, "edited": false, "score": 0, "creation_date": 1568111942, "post_id": 57868642, "comment_id": 102162865, "body": "@Nantha You don&#39;t need to do that, <code>Insert(q, &quot;Nantha&quot;, &quot;nk&quot;)</code> will still work, even after you change the <code>Insert</code> to <code>Insert(query string, args ...interface{})</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 378, "user_id": 2661434, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/wlA7d.png?s=128&g=1", "display_name": "Ram", "link": "https://stackoverflow.com/users/2661434/ram"}, "edited": false, "score": 0, "creation_date": 1568112079, "post_id": 57868642, "comment_id": 102162945, "body": "@Nantha and if you want to use <code>v := []interface{}{&quot;nantha&quot;,&quot;nk&quot;}</code>, you can do it like this <code>Insert(q, v...)</code>."}, {"owner": {"reputation": 378, "user_id": 2661434, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/wlA7d.png?s=128&g=1", "display_name": "Ram", "link": "https://stackoverflow.com/users/2661434/ram"}, "edited": false, "score": 0, "creation_date": 1568112709, "post_id": 57868642, "comment_id": 102163245, "body": "it&#39;s working :) thank you so much"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 3, "last_activity_date": 1568112202, "last_edit_date": 1568112202, "creation_date": 1568110563, "answer_id": 57868642, "question_id": 57868506, "link": "https://stackoverflow.com/questions/57868506/cannot-use-args-type-string-as-type-interface/57868642#57868642", "title": "Cannot use args (type []string) as type []interface {}", "body": "<p>The error is pretty clear, the function expects type <code>[]interface{}</code> but you're passing in a value of type <code>[]string</code>. You have to first convert <code>[]string</code> to <code>[]interface{}</code> before passing it to <code>Exec</code>. And the way to do that is to loop over the strings and add each one to a new slice of <code>interface{}</code>.</p>\n\n<p><a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">https://golang.org/doc/faq#convert_slice_of_interface</a></p>\n\n<hr>\n\n<p>As an alternative approach, you can change the <code>Insert</code> argument types.</p>\n\n<pre><code>func Insert(query string, args ...interface{}) (err error) {\n    db, err := sql.Open(\"sqlite3\", \"sqlite.db\")\n    if err != nil {\n        return err\n    }\n    q, err := db.Prepare(query)\n    if err != nil {\n        return err\n    }\n    _, err = q.Exec(args...)\n    return err\n}\n\nfunc main() {\n    err := Insert(\"INSERT INTO table(first,last) VALUES(?,?)\", \"Nantha\", \"nk\")\n    if err !=nil{\n        fmt.Println(err.Error())\n        return\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>Please note that you're using the <code>database/sql</code> package incorrectly. Many of the objects returned from that package's functions/methods need to be <strong>closed</strong> to release the underlying resources.</p>\n\n<p>This is true for <code>*sql.DB</code> returned by <code>Open</code>, <code>*sql.Stmt</code> returned by <code>Prepare</code>, <code>*sql.Rows</code> returned by <code>Query</code>, etc.</p>\n\n<p>So your function should look closer to something like this:</p>\n\n<pre><code>func Insert(query string, args ...interface{}) (err error) {\n    db, err := sql.Open(\"sqlite3\", \"sqlite.db\")\n    if err != nil {\n        return err\n    }\n    defer db.Close()\n\n    q, err := db.Prepare(query)\n    if err != nil {\n        return err\n    }\n    defer q.Close()\n\n    _, err = q.Exec(args...)\n    return err\n}\n</code></pre>\n\n<hr>\n\n<p>Also note that <a href=\"https://golang.org/pkg/database/sql/#DB\" rel=\"nofollow noreferrer\"><code>sql.DB</code></a> is reusable, that means that you don't have to <code>sql.Open</code> a new instance every time you need to talk to the database.</p>\n\n<p>From the docs on Open:</p>\n\n<blockquote>\n  <p>The returned DB is safe for concurrent use by multiple goroutines and\n  maintains its own pool of idle connections. Thus, the Open function\n  should be called just once. It is rarely necessary to close a DB.</p>\n</blockquote>\n\n<p>If you keep doing it the way you're doing it, openning a new <code>DB</code> every time you call <code>Insert</code> or any other function that needs to talk to the <code>DB</code>, your program will perform worse than if you had a single <code>DB</code> and have your functions reuse that.</p>\n"}], "owner": {"reputation": 378, "user_id": 2661434, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/wlA7d.png?s=128&g=1", "display_name": "Ram", "link": "https://stackoverflow.com/users/2661434/ram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5587, "favorite_count": 0, "closed_date": 1568122916, "accepted_answer_id": 57868642, "answer_count": 1, "score": 1, "last_activity_date": 1568112202, "creation_date": 1568110036, "question_id": 57868506, "link": "https://stackoverflow.com/questions/57868506/cannot-use-args-type-string-as-type-interface", "closed_reason": "Duplicate", "title": "Cannot use args (type []string) as type []interface {}", "body": "<p>my golang sqlite insert function. i'm using this package <code>\"github.com/mattn/go-sqlite3\"</code> </p>\n\n<pre><code>func Insert(args ...string)(err error){\n  db, err:=sql.Open(\"sqlite3\",\"sqlite.db\")\n  if err !=nil {\n    return\n  }\n  q, err := db.Prepare(args[0])\n  if err !=nil{\n    return\n  }\n  _,err = q.Exec(args[1:]...)\n  return\n }\nmain (){\n  err := Insert(\"INSERT INTO table(first,last) VALUES(?,?)\",\"Nantha\",\"nk\")\n  if err !=nil{\n  fmt.Println(err.Error())\n    return\n  }\n}\n</code></pre>\n\n<p>i'm getting this error</p>\n\n<blockquote>\n  <p>cannot use args (type []string) as type []interface {} in argument to\n  q.Exec</p>\n</blockquote>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1568109194, "post_id": 57867635, "comment_id": 102161460, "body": "You&#39;re calling <code>defer db.Close()</code> inside <code>NewDatabase</code>. Don&#39;t do that if you don&#39;t want your db closed when NewDatabase returns. You don&#39;t need to close the <code>db</code> if you plan on reusing it. However you need to close <code>rows</code> whenever you call <code>Query</code>, otherwise your app will hit the connection limit and crash."}, {"owner": {"reputation": 33, "user_id": 12045534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82c2c080c4696d9d07e7813165612463?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v7", "link": "https://stackoverflow.com/users/12045534/jpskgc-v7"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568111468, "post_id": 57867635, "comment_id": 102162645, "body": "Thanks for suggestion. Issue is resolved."}], "answers": [{"tags": [], "owner": {"reputation": 1733, "user_id": 10490857, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GA97O.jpg?s=128&g=1", "display_name": "Maxim", "link": "https://stackoverflow.com/users/10490857/maxim"}, "is_accepted": false, "score": 8, "last_activity_date": 1568114340, "creation_date": 1568114340, "answer_id": 57869695, "question_id": 57867635, "link": "https://stackoverflow.com/questions/57867635/mysql-database-gets-error-in-golang-sql-database-is-closed/57869695#57869695", "title": "mysql database gets error in golang \u3010sql: database is closed\u3011", "body": "<p>Just remove <code>defer db.Close()</code> in <code>db.go</code>\nYou need to close connection out of <code>NewDatabase</code> method</p>\n"}], "owner": {"reputation": 33, "user_id": 12045534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82c2c080c4696d9d07e7813165612463?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v7", "link": "https://stackoverflow.com/users/12045534/jpskgc-v7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5045, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1568114340, "creation_date": 1568107017, "question_id": 57867635, "link": "https://stackoverflow.com/questions/57867635/mysql-database-gets-error-in-golang-sql-database-is-closed", "title": "mysql database gets error in golang \u3010sql: database is closed\u3011", "body": "<p>I try to set up mysql database in <code>golang</code>.<br>\nI created <code>db.go</code> for mysql setting up and import it to <code>main.go</code>.<br>\nBut when I run <code>main.go</code>, error occurs because of <code>db.go</code>.<br>\nI want to resolve this error.<br></p>\n\n<p>There is no compile error.<br>\nBut when running <code>go run main.go</code>, error occurs.<br></p>\n\n<p>main.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\n// import\n\nfunc main() {\n    err := godotenv.Load()\n    if err != nil {\n    }\n    db := db.NewDatabase(os.Getenv(\"MYSQL_USER\"), os.Getenv(\"MYSQL_PASSWORD\"), os.Getenv(\"MYSQL_HOST\"))\n    s3 := s3.NewS3(os.Getenv(\"AWS_ACCESS_KEY_ID\"), os.Getenv(\"AWS_SECRET_ACCESS_KEY\"))\n    dao := dao.NewDao(db.DATABASE, s3)\n    service := service.NewService(dao)\n    cntlr := controller.NewController(service)\n\n    router := gin.Default()\n\n    router.Use(cors.New(cors.Config{\n        AllowOrigins:     []string{\"*\"},\n        AllowMethods:     []string{\"GET\", \"POST\", \"OPTIONS\"},\n        AllowHeaders:     []string{\"Content-Type\", \"Content-Length\", \"Accept-Encoding\", \"X-CSRF-Token\", \"Authorization\", \"accept\", \"origin\", \"Cache-Control\", \"X-Requested-With\"},\n        ExposeHeaders:    []string{\"Content-Length\"},\n        AllowCredentials: true,\n        AllowOriginFunc: func(origin string) bool {\n            return true\n        },\n        MaxAge: 15 * time.Second,\n    }))\n\n    api := router.Group(\"/api\")\n    {\n        api.GET(\"/articles\", func(c *gin.Context) {\n            cntlr.GetArticleController(c)\n        })\n        api.GET(\"/article/:id\", func(c *gin.Context) {\n            cntlr.GetSingleArticleController(c)\n        })\n        api.GET(\"/delete/:id\", func(c *gin.Context) {\n            cntlr.DeleteArticleController(c)\n        })\n        api.POST(\"/post\", func(c *gin.Context) {\n            cntlr.PostController(c)\n        })\n        api.POST(\"/post/image\", func(c *gin.Context) {\n            cntlr.PostImageController(c)\n        })\n        api.POST(\"/post/image/db\", func(c *gin.Context) {\n            cntlr.PostImageToDBController(c)\n        })\n    }\n\n    router.Run(\":2345\")\n}\n\n</code></pre>\n\n<p>db.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package db\n\nimport \"database/sql\"\n\ntype Database struct {\n    MYSQL_USER     string\n    MYSQL_PASSWORD string\n    MYSQL_HOST     string\n    DATABASE       *sql.DB\n}\n\nfunc NewDatabase(user, password, host string) *Database {\n    db, err := sql.Open(\"mysql\", user+\":\"+password+\"@tcp(\"+host+\":3306)/article\")\n    if err != nil {\n        panic(err.Error())\n    }\n\n    defer db.Close()\n\n    err = db.Ping()\n    if err != nil {\n        panic(err.Error())\n    }\n\n    _, err = db.Exec(\"CREATE DATABASE IF NOT EXISTS article;\")\n    if err != nil {\n        panic(err)\n    }\n\n    _, err = db.Exec(\"use article;\")\n    if err != nil {\n        panic(err)\n    }\n\n    _, err = db.Exec(\"CREATE TABLE IF NOT EXISTS `articles` (`id` int NOT NULL AUTO_INCREMENT PRIMARY KEY,uuid varchar(36), `title` VARCHAR(100) NOT NULL,`content` TEXT NOT NULL ) ENGINE=InnoDB DEFAULT CHARSET=utf8;\")\n    if err != nil {\n        panic(err)\n    }\n\n    _, err = db.Exec(\"create table IF NOT EXISTS images (id int AUTO_INCREMENT NOT NULL PRIMARY KEY, article_uuid varchar(36), image_name varchar(50)); \")\n    if err != nil {\n        panic(err)\n    }\n    Database := new(Database)\n    Database.DATABASE = db\n    return Database\n}\n\n</code></pre>\n\n<p>Here is full source code(branch: refactor-db):<br>\n<a href=\"https://github.com/jpskgc/article/tree/refactor-db\" rel=\"nofollow noreferrer\">https://github.com/jpskgc/article/tree/refactor-db</a></p>\n\n<p>I expect there is no error when running <code>go run main.go</code>.<br>\nBut the actual is not.<br>\nThere will be some problem around <code>db.go</code>.<br></p>\n\n<p>Here is the error message.<br></p>\n\n<pre><code>GET /api/articles HTTP/1.1\nHost: localhost:2345\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3\nAccept-Encoding: gzip, deflate, br\nAccept-Language: en-US,en;q=0.9\nCache-Control: max-age=0\nConnection: keep-alive\nSec-Fetch-Mode: navigate\nSec-Fetch-Site: none\nSec-Fetch-User: ?1\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36\n\n\nsql: database is closed\n/Users/jpskgc/article/api/dao/dao.go:36 (0x1553240)\n        (*Dao).GetArticleDao: panic(err.Error())\n/Users/jpskgc/article/api/service/service.go:34 (0x17a9abb)\n        Service.GetArticleService: results := s.dao.GetArticleDao()\n/Users/jpskgc/article/api/controller/controller.go:19 (0x17cd664)\n        Controller.GetArticleController: articles := controller.service.GetArticleService()\n/Users/jpskgc/article/api/main.go:79 (0x17cec1f)\n        main.func2: cntlr.GetArticleController(c)\n/Users/jpskgc/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/context.go:124 (0x1791e89)\n        (*Context).Next: c.handlers[c.index](c)\n/Users/jpskgc/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/recovery.go:83 (0x17a5159)\n        RecoveryWithWriter.func1: c.Next()\n/Users/jpskgc/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/context.go:124 (0x1791e89)\n        (*Context).Next: c.handlers[c.index](c)\n/Users/jpskgc/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/logger.go:240 (0x17a4200)\n        LoggerWithConfig.func1: c.Next()\n/Users/jpskgc/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/context.go:124 (0x1791e89)\n        (*Context).Next: c.handlers[c.index](c)\n/Users/jpskgc/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/gin.go:389 (0x179b6a1)\n        (*Engine).handleHTTPRequest: c.Next()\n/Users/jpskgc/go/pkg/mod/github.com/gin-gonic/gin@v1.4.0/gin.go:351 (0x179aed3)\n        (*Engine).ServeHTTP: engine.handleHTTPRequest(c)\n/usr/local/go/src/net/http/server.go:2774 (0x12e2a07)\n        serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)\n/usr/local/go/src/net/http/server.go:1878 (0x12de5f0)\n        (*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)\n/usr/local/go/src/runtime/asm_amd64.s:1337 (0x1059ea0)\n        goexit: BYTE    $0x90   // NOP\n\n[GIN] 2019/09/10 - 16:58:46 | 500 |    5.990926ms |             ::1 | GET      /api/articles\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 967, "user_id": 5105392, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1019878568022717/picture?type=large", "display_name": "Harry", "link": "https://stackoverflow.com/users/5105392/harry"}, "edited": false, "score": 0, "creation_date": 1568097344, "post_id": 57864980, "comment_id": 102155712, "body": "what exactly build artefacts is?"}], "tags": [], "owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "is_accepted": false, "score": 2, "last_activity_date": 1568096145, "creation_date": 1568096145, "answer_id": 57864980, "question_id": 57863793, "link": "https://stackoverflow.com/questions/57863793/what-is-difference-between-installed-package-and-gocache/57864980#57864980", "title": "What is difference between installed package and GOCACHE", "body": "<p>Your questions is self-answering:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ ls $(go env GOCACHE)\n$ cat $(go env GOCACHE)/README\n</code></pre>\n\n<p>and</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ ls $(go env GOPATH)/pkg\n</code></pre>\n\n<p>As you can see - there is nothing similar between them:</p>\n\n<ul>\n<li>GOPATH/pkg - compiled packages that remains static between builds. Those files are not \"cashe\" files actually</li>\n<li>GOCACHE - collections of build artefacts that constantly changes between builds</li>\n</ul>\n\n<p>More elaborate answer could be done by examining sources of <code>go build</code></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1568099009, "last_edit_date": 1568099009, "creation_date": 1568098598, "answer_id": 57865510, "question_id": 57863793, "link": "https://stackoverflow.com/questions/57863793/what-is-difference-between-installed-package-and-gocache/57865510#57865510", "title": "What is difference between installed package and GOCACHE", "body": "<p><strong>TLDR;</strong> The cache folder is internal to the <code>go</code> tool and its working should be opaque to the user, and its purpose is to speed up builds and tests. For example if you use a version control system (such as <code>git</code>), switching between branches or versions, the <code>GOPATH/pkg</code> may only contain package files of one version. The go cache folder may contain (partially) compiled packages of multiple branches and versions, speeding up future builds when you switch between branches and versions.</p>\n\n<hr>\n\n<p>The cache folder was introduced in <a href=\"https://golang.org/doc/go1.10#build\" rel=\"nofollow noreferrer\">Go 1.10</a>:</p>\n\n<blockquote>\n  <p>The <code>go build</code> command now maintains a cache of recently built packages, separate from the installed packages in <code>$GOROOT/pkg</code> or <code>$GOPATH/pkg</code>. <strong>The effect of the cache should be to speed builds that do not explicitly install packages or when switching between different copies of source code (for example, when changing back and forth between different branches in a version control system).</strong> The old advice to add the <code>-i</code> flag for speed, as in <code>go build -i</code> or <code>go test -i</code>, is no longer necessary: builds run just as fast without <code>-i</code>. For more details, see <code>go help cache</code>.</p>\n</blockquote>\n\n<p>So you don't need to use <code>-i</code> anymore for fast builds.</p>\n\n<p>Some quotes from the output of <code>go help cache</code>:</p>\n\n<blockquote>\n  <p>The go command caches build outputs for reuse in future builds.\n  The default location for cache data is a subdirectory named go-build\n  in the standard user cache directory for the current operating system.\n  Setting the GOCACHE environment variable overrides this default,\n  and running 'go env GOCACHE' prints the current cache directory.</p>\n  \n  <p>The go command periodically deletes cached data that has not been\n  used recently. Running 'go clean -cache' deletes all cached data.</p>\n  \n  <p>The build cache correctly accounts for changes to Go source files,\n  compilers, compiler options, and so on: cleaning the cache explicitly\n  should not be necessary in typical use. However, the build cache\n  does not detect changes to C libraries imported with cgo.\n  If you have made changes to the C libraries on your system, you\n  will need to clean the cache explicitly or else use the -a build flag\n  (see 'go help build') to force rebuilding of packages that\n  depend on the updated C libraries.</p>\n  \n  <p><strong>The go command also caches successful package test results.\n  See 'go help test' for details. Running 'go clean -testcache' removes\n  all cached test results (but not cached build results).</strong></p>\n</blockquote>\n\n<p>The cache folder is also used to store test results, so in some circumstances, the cached results may be presented without running the tests again.</p>\n"}], "owner": {"reputation": 967, "user_id": 5105392, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1019878568022717/picture?type=large", "display_name": "Harry", "link": "https://stackoverflow.com/users/5105392/harry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 959, "favorite_count": 0, "accepted_answer_id": 57865510, "answer_count": 2, "score": 2, "last_activity_date": 1568099009, "creation_date": 1568087281, "last_edit_date": 1568097447, "question_id": 57863793, "link": "https://stackoverflow.com/questions/57863793/what-is-difference-between-installed-package-and-gocache", "title": "What is difference between installed package and GOCACHE", "body": "<p>I always build with -i flag to install packages and .a files are installed in GOPATH/pkg directory.\nGOCACHE directory shown by <code>go env GOCACHE</code> seems to store cache files as well.\nWhat's difference between them?</p>\n\n<p>And what I wanna know is both of them should be saved if I want to make build time faster?</p>\n"}, {"tags": ["go", "terraform", "bazel"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 11816857, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3bpAytLbf6o/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdYnPNU1vDxVuKZiFbzGnFq0yAcKw/photo.jpg?sz=128", "display_name": "Phuong ITBK", "link": "https://stackoverflow.com/users/11816857/phuong-itbk"}, "edited": false, "score": 0, "creation_date": 1568188885, "post_id": 57875339, "comment_id": 102191678, "body": "Thanks. Now I get other error, using latest bazel, bazel_gazelle and io_bazel_rules_go: ERROR: /home/phuonglu/.cache/bazel/_bazel_phuonglu/ad07032ffc2f7bfb&zwnj;&#8203;6275d446f85e98cd/ext&zwnj;&#8203;ernal/com_github_aws&zwnj;&#8203;_aws_sdk_go/aws/sign&zwnj;&#8203;er/v4/BUILD.bazel:3:&zwnj;&#8203;1: @com_github_aws_aws_sdk_go//aws /signer/v4:go_default_library: no such attribute &#39;importpath_aliases&#39; in &#39;go_library&#39; rule"}, {"owner": {"reputation": 26173, "user_id": 1891, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c40d475927f7a86639ec54aa32517572?s=128&d=identicon&r=PG", "display_name": "Jay Conrod", "link": "https://stackoverflow.com/users/1891/jay-conrod"}, "reply_to_user": {"reputation": 45, "user_id": 11816857, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3bpAytLbf6o/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdYnPNU1vDxVuKZiFbzGnFq0yAcKw/photo.jpg?sz=128", "display_name": "Phuong ITBK", "link": "https://stackoverflow.com/users/11816857/phuong-itbk"}, "edited": false, "score": 0, "creation_date": 1568297684, "post_id": 57875339, "comment_id": 102237180, "body": "That indicates you need to upgrade rules_go or downgrade gazelle. gazelle 0.18.0 requires rules_go 0.19.0 at minimum."}], "tags": [], "owner": {"reputation": 26173, "user_id": 1891, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c40d475927f7a86639ec54aa32517572?s=128&d=identicon&r=PG", "display_name": "Jay Conrod", "link": "https://stackoverflow.com/users/1891/jay-conrod"}, "is_accepted": true, "score": 1, "last_activity_date": 1568134755, "creation_date": 1568134755, "answer_id": 57875339, "question_id": 57863511, "link": "https://stackoverflow.com/questions/57863511/need-some-help-to-build-a-custom-terraform-provider-with-bazel/57875339#57875339", "title": "Need some help to build a custom terraform provider with bazel", "body": "<p>From the error you pasted, it looks like two copies of the package <code>google.golang.org/grpc/naming</code> are being incorporated into the same binary. This causes a type error: these are different packages (even if the code is identical), and their exported types are not interchangeable.</p>\n\n<p>The best thing to do here is probably to exclude the <code>vendor</code> directory in the <code>github.com/hashicorp/terraform</code> repository. You can add an argument to Gazelle in the corresponding <code>go_repository</code> rule in WORKSPACE. This prevents Gazelle from generating rules and resolving dependencies in that directory.</p>\n\n<pre><code>go_repository(\n    name = \"com_github_hashicorp_terraform\",\n    importpath = \"github.com/hashicorp/terraform\",\n    # ...\n    build_extra_args = [\"-exclude=vendor\"],\n)\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 11816857, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3bpAytLbf6o/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdYnPNU1vDxVuKZiFbzGnFq0yAcKw/photo.jpg?sz=128", "display_name": "Phuong ITBK", "link": "https://stackoverflow.com/users/11816857/phuong-itbk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 1, "accepted_answer_id": 57875339, "answer_count": 1, "score": 3, "last_activity_date": 1568189047, "creation_date": 1568084875, "last_edit_date": 1568189047, "question_id": 57863511, "link": "https://stackoverflow.com/questions/57863511/need-some-help-to-build-a-custom-terraform-provider-with-bazel", "title": "Need some help to build a custom terraform provider with bazel", "body": "<p>I'm trying to build a custom terraform provider as the link: <a href=\"https://www.terraform.io/docs/extend/writing-custom-providers.html\" rel=\"nofollow noreferrer\">https://www.terraform.io/docs/extend/writing-custom-providers.html</a></p>\n\n<p>Building with go is good.\nBut I couldn't make the build work with bazel.</p>\n\n<pre><code>load(\"@io_bazel_rules_go//go:def.bzl\", \"go_binary\", \"go_library\")\nload(\"@bazel_gazelle//:def.bzl\", \"gazelle\")\n\n# gazelle:prefix nox\ngazelle(name = \"gazelle\")\n\ngo_library(\n    name = \"go_default_library\",\n    srcs = [\n        \"main.go\",\n        \"provider.go\",\n        \"resource_server.go\",\n    ],\n    importpath = \"nox\",\n    visibility = [\"//visibility:private\"],\n    deps = [\n        \"@com_github_hashicorp_terraform//helper/schema:go_default_library\",\n        \"@com_github_hashicorp_terraform//plugin:go_default_library\",\n        \"@com_github_hashicorp_terraform//terraform:go_default_library\",\n    ],\n)\n\ngo_binary(\n    name = \"nox\",\n    embed = [\":go_default_library\"],\n    visibility = [\"//visibility:public\"],\n)\n</code></pre>\n\n<p>Got error:</p>\n\n<pre><code>/home/phuonglu/.cache/bazel/_bazel_phuonglu/1776745e55763483ee3d48d730fcf433/sandbox/linux-sandbox/935/execroot/__main__/external/com_github_hashicorp_terraform/vendor/google.golang\n.org/api/option/option.go:163:54: cannot use \"github.com/hashicorp/terraform/vendor/google.golang.org/api/internal\".NewPoolResolver(int(w), o) (type *\"github.com/hashicorp/terraform\n/vendor/google.golang.org/api/internal\".PoolResolver) as type \"google.golang.org/grpc/naming\".Resolver in argument to grpc.RoundRobin:\n        *\"github.com/hashicorp/terraform/vendor/google.golang.org/api/internal\".PoolResolver does not implement \"google.golang.org/grpc/naming\".Resolver (wrong type for Resolve meth\nod)\n                have Resolve(string) (\"github.com/hashicorp/terraform/vendor/google.golang.org/grpc/naming\".Watcher, error)\n                want Resolve(string) (\"google.golang.org/grpc/naming\".Watcher, error)\n</code></pre>\n\n<p>Other error:</p>\n\n<pre><code>ERROR: /home/phuonglu/.cache/bazel/_bazel_phuonglu/ad07032ffc2f7bfb6275d446f85e98cd/external/com_github_aws_aws_sdk_go/aws/signer/v4/BUILD.bazel:3:1: @com_github_aws_aws_sdk_go//aws\n/signer/v4:go_default_library: no such attribute 'importpath_aliases' in 'go_library' rule\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1568087365, "post_id": 57863389, "comment_id": 102153199, "body": "<a href=\"https://golang.org/doc/faq#closures_and_goroutines\" rel=\"nofollow noreferrer\">golang.org/doc/faq#closures_and_goroutines</a>"}], "answers": [{"tags": [], "owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "is_accepted": false, "score": 0, "last_activity_date": 1568084240, "creation_date": 1568084240, "answer_id": 57863442, "question_id": 57863389, "link": "https://stackoverflow.com/questions/57863389/why-in-my-code-goroutine-seems-to-freeze-the-loop-variable-automatically/57863442#57863442", "title": "Why in my code goroutine seems to freeze the loop variable automatically", "body": "<p>Go passes parameter by value. Your first example does actually create a new variable and copy the current index into it before launching the new goroutine, which is the same as your 3rd example.</p>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 4943287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/022f5900039a20c1b6518dc3011dc970?s=128&d=identicon&r=PG&f=1", "display_name": "Frank Yao", "link": "https://stackoverflow.com/users/4943287/frank-yao"}, "edited": false, "score": 0, "creation_date": 1568085456, "post_id": 57863466, "comment_id": 102152845, "body": "So in the first case the current value of <code>i</code> is memorized and stored before the function is executed while in the second case <code>i</code>  always remains the newest? Confused..."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "reply_to_user": {"reputation": 11, "user_id": 4943287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/022f5900039a20c1b6518dc3011dc970?s=128&d=identicon&r=PG&f=1", "display_name": "Frank Yao", "link": "https://stackoverflow.com/users/4943287/frank-yao"}, "edited": false, "score": 1, "creation_date": 1568088024, "post_id": 57863466, "comment_id": 102153309, "body": "The parameters to a function called with <code>go</code> are always evaluated by the caller, so your function always gets the value of <code>i</code> at the time of the call. See <a href=\"https://tour.golang.org/concurrency/1\" rel=\"nofollow noreferrer\">tour.golang.org/concurrency/1</a>. In the second example, the anonymous function is a closure because it references the variable <code>i</code> which is defined in the scope of the loop. That causes it to share the variable <code>i</code> with the other code in the loop. See <a href=\"https://tour.golang.org/moretypes/25\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/25</a>."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": false, "score": 0, "last_activity_date": 1568084390, "creation_date": 1568084390, "answer_id": 57863466, "question_id": 57863389, "link": "https://stackoverflow.com/questions/57863389/why-in-my-code-goroutine-seems-to-freeze-the-loop-variable-automatically/57863466#57863466", "title": "Why in my code goroutine seems to freeze the loop variable automatically", "body": "<p>In the first example, the value of <code>i</code> is evaluated at the time that statement is executed. You see the other behavior in the second example because the anonymous function creates a closure on <code>i</code>, so you get whatever value <code>i</code> has at the time <code>Print</code> is called.</p>\n"}], "owner": {"reputation": 11, "user_id": 4943287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/022f5900039a20c1b6518dc3011dc970?s=128&d=identicon&r=PG&f=1", "display_name": "Frank Yao", "link": "https://stackoverflow.com/users/4943287/frank-yao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1568084390, "creation_date": 1568083577, "last_edit_date": 1568084017, "question_id": 57863389, "link": "https://stackoverflow.com/questions/57863389/why-in-my-code-goroutine-seems-to-freeze-the-loop-variable-automatically", "title": "Why in my code goroutine seems to freeze the loop variable automatically", "body": "<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"fmt\"\n)\n\n\nfunc Print(i int) {\n    fmt.Println(i)\n}\n\nfunc PrintR(i *int) {\n    fmt.Println(*i)\n}\n\n\nfunc main() {\n    for i := 0; i &lt; 10; i++ {\n        go Print(i)   // Get: 1 9 2 3 4 5 7 6 8 0\n\n        //go func() {\n        //  Print(i)\n        //}()  // Get: 10 10 7 10 4 10 7 10 10 10 10\n\n        //go PrintR(&amp;i)  // Get: 7 10 10 7 10 7 10 10 10 10\n    }\n    select {\n\n    }\n}\n</code></pre>\n\n<p>The 2nd, 3rd example got the expected output, but I have thought that the 1st case's output <code>go Print(i)</code> should be similar to the 2nd's since both of them do not use a new variable to freeze the current value of i. What cause the difference?</p>\n"}, {"tags": ["go", "github", "websocket", "golang-migrate"], "comments": [{"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "edited": false, "score": 1, "creation_date": 1568077625, "post_id": 57862771, "comment_id": 102151507, "body": "can you share te error message"}, {"owner": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "reply_to_user": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "edited": false, "score": 0, "creation_date": 1568078065, "post_id": 57862771, "comment_id": 102151567, "body": ".\\main2.go:15:11: server.On undefined (type *socketio.Server has no field or method On) .\\main2.go:15:37: undefined: socketio.Socket .\\main2.go:20:19: server.BroadcastTo undefined (type *socketio.Server has no field or method BroadcastTo) .\\main2.go:26:11: server.On undefined (type *socketio.Server has no field or method On) .\\main2.go:26:32: undefined: socketio.Socket"}, {"owner": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "reply_to_user": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "edited": false, "score": 0, "creation_date": 1568078173, "post_id": 57862771, "comment_id": 102151583, "body": "@novalagung i edited my question....please read it again"}, {"owner": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "reply_to_user": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "edited": false, "score": 0, "creation_date": 1568078521, "post_id": 57862771, "comment_id": 102151649, "body": "@novalagung i use v1.4 but i need to use v1.0"}], "answers": [{"comments": [{"owner": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "edited": false, "score": 0, "creation_date": 1568109205, "post_id": 57864276, "comment_id": 102161471, "body": "it didnot work . go: cannot use path@version syntax in GOPATH mode"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "edited": false, "score": 0, "creation_date": 1568109968, "post_id": 57864276, "comment_id": 102161901, "body": "@melina make sure you are using the latest Go (1.13) and that you have a go.mod (<code>go mod init myproject</code>) first: that will be enough to <i>not</i> be in the &quot;GOPATH mode&quot;"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 0, "last_activity_date": 1568091563, "creation_date": 1568091563, "answer_id": 57864276, "question_id": 57862771, "link": "https://stackoverflow.com/questions/57862771/how-can-get-go-socket-io-from-github-to-use-in-go/57864276#57864276", "title": "How can get go-socket.io from github to use in Go", "body": "<p>If your project <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">uses go modules</a> (has a go.mod file, after a go mod init myproject), all you might need to do is:</p>\n\n<pre><code>go get  github.com/googollee/go-socket.io@v1.0.1\n</code></pre>\n\n<p>I use v1.0.1 because there is no 1.0.0 tag in the <a href=\"https://github.com/googollee/go-socket.io/releases\" rel=\"nofollow noreferrer\"><code>googollee/go-socket.io</code></a> releases</p>\n"}], "owner": {"reputation": 129, "user_id": 8567152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8ea8638371a6b451331959a33abe03?s=128&d=identicon&r=PG&f=1", "display_name": "melina", "link": "https://stackoverflow.com/users/8567152/melina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1326, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1585712566, "creation_date": 1568077156, "last_edit_date": 1568078486, "question_id": 57862771, "link": "https://stackoverflow.com/questions/57862771/how-can-get-go-socket-io-from-github-to-use-in-go", "title": "How can get go-socket.io from github to use in Go", "body": "<p>My Go version is:</p>\n\n<blockquote>\n  <p>go version go1.12.9 windows/amd64</p>\n</blockquote>\n\n<p>From this link:</p>\n\n<p><a href=\"https://github.com/googollee/go-socket.io/tree/v1.0\" rel=\"nofollow noreferrer\">https://github.com/googollee/go-socket.io/tree/v1.0</a></p>\n\n<p>I run this code in cmd:</p>\n\n<blockquote>\n  <p>go get github.com/googollee/go-socket.io</p>\n</blockquote>\n\n<p>But i cant run this code :</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n\n    \"github.com/googollee/go-socket.io\"\n)\n\nfunc main() {\n    server, err := socketio.NewServer(nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n    server.On(\"connection\", func(so socketio.Socket) {\n        log.Println(\"on connection\")\n        so.Join(\"chat\")\n        so.On(\"chat message\", func(msg string) {\n            log.Println(\"emit:\", so.Emit(\"chat message\", msg))\n            server.BroadcastTo(\"chat\", \"chat message\", msg)\n        })\n        so.On(\"disconnection\", func() {\n            log.Println(\"on disconnect\")\n        })\n    })\n    server.On(\"error\", func(so socketio.Socket, err error) {\n        log.Println(\"error:\", err)\n    })\n\n    http.Handle(\"/socket.io/\", server)\n    http.Handle(\"/\", http.FileServer(http.Dir(\"./asset\")))\n    log.Println(\"Serving at localhost:5000...\")\n    log.Fatal(http.ListenAndServe(\":5000\", nil))\n}\n</code></pre>\n\n<p>I cant run it , why?</p>\n\n<p>I think my problem is in getting  V1.4 and v1.0 </p>\n\n<blockquote>\n  <p>go get github.com/googollee/go-socket.io</p>\n</blockquote>\n\n<p>how can i get v1.0 for Golang from github?</p>\n\n<p>But this code work well</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"github.com/googollee/go-socket.io\"\n)\n\nfunc main() {\n    server, err := socketio.NewServer(nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n    server.OnConnect(\"/\", func(s socketio.Conn) error {\n        s.SetContext(\"\")\n        fmt.Println(\"connected:\", s.ID())\n        return nil\n    })\n\n\n\n    http.Handle(\"/socket.io/\", server)\n    http.Handle(\"/\", http.FileServer(http.Dir(\"./asset\")))\n    log.Println(\"Serving at localhost:8000...\")\n    log.Fatal(http.ListenAndServe(\":8000\", nil))\n}\n</code></pre>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 53905, "user_id": 2864740, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e7a05a144f218bde07b659bc98e1ca7d?s=128&d=identicon&r=PG&f=1", "display_name": "user2864740", "link": "https://stackoverflow.com/users/2864740/user2864740"}, "edited": false, "score": 0, "creation_date": 1568075424, "post_id": 57862599, "comment_id": 102151147, "body": "Hint 1: In the linked example the method takes NO arguments and yet is supplied one in \u2018Call\u2019. Hint 2: see the documentation for \u2018Call\u2019."}], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 0, "last_activity_date": 1568078668, "creation_date": 1568078668, "answer_id": 57862912, "question_id": 57862599, "link": "https://stackoverflow.com/questions/57862599/how-to-dynamically-call-all-methods-of-a-struct-in-golang/57862912#57862912", "title": "How to dynamically call all methods of a struct in Golang?", "body": "<p>To call the method from the <em>type</em>, you must pass a <code>reflect.Value</code> instance that provides the <code>Foo</code> object that is the receiver <em>plus</em> a <code>reflect.Value</code> instance that provides the <code>int</code> argument that each function receives:</p>\n\n<pre><code>fooType := reflect.TypeOf(&amp;Foo{})\nfooVal := reflect.ValueOf(&amp;Foo{})\nfmt.Println(\"--- Calling methods ---\")\nfor i := 0; i &lt; fooType.NumMethod(); i++ {\n    method := fooType.Method(i)\n    arg := i + 10\n    method.Func.Call([]reflect.Value{fooVal, reflect.ValueOf(arg)})\n}\n</code></pre>\n\n<p>for instance.  Note that if you call the method from the <em>value</em>, the receiver is provided via that value, so we get to drop the first argument:</p>\n\n<pre><code>    arg = i + 20\n    reflect.Indirect(fooVal).Method(i).Call([]reflect.Value{reflect.ValueOf(arg)})\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/_W6KJTm2Bti\" rel=\"nofollow noreferrer\">complete example on Go playground</a>\u2014but note that we only need to obtain the <code>foo</code> object once, above the loop over its methods: <a href=\"https://play.golang.org/p/HHk_mO2KXc6\" rel=\"nofollow noreferrer\">https://play.golang.org/p/HHk_mO2KXc6</a> so that the last line in the loop is just:</p>\n\n<pre><code>    fooObj.Method(i).Call([]reflect.Value{reflect.ValueOf(arg)})\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8206906, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Gg-yXNvvcXE/AAAAAAAAAAI/AAAAAAAAABg/T-XLBBZ-MkQ/photo.jpg?sz=128", "display_name": "Daniel Stinson-Diess", "link": "https://stackoverflow.com/users/8206906/daniel-stinson-diess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 0, "closed_date": 1568101250, "accepted_answer_id": 57862912, "answer_count": 1, "score": 1, "last_activity_date": 1568078668, "creation_date": 1568075224, "question_id": 57862599, "link": "https://stackoverflow.com/questions/57862599/how-to-dynamically-call-all-methods-of-a-struct-in-golang", "closed_reason": "Duplicate", "title": "How to dynamically call all methods of a struct in Golang?", "body": "<p>I'm building a library where once methods are added to a struct we want them to be automatically called w/o using some sort of method list. </p>\n\n<p>I want to build on the work here by calling all of the methods dumped that is linked here <a href=\"https://stackoverflow.com/questions/21397653/how-to-dump-methods-of-structs-in-golang\">How to dump methods of structs in Golang?</a>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Foo struct {\n    Prop string\n}\n\nfunc (f Foo) Bar(i int) {\n    fmt.Println(\"Called from Foo.Bar()\")\n}\n\nfunc (f Foo) Baz(i int) {\n    fmt.Println(\"Called from Foo.Baz()\")\n}\n\nfunc (f Foo) Floop(i int) {\n    fmt.Println(\"Called from Foo.Floop()\")\n}\n\nfunc main() {\n    fooType := reflect.TypeOf(&amp;Foo{})\n\n    fmt.Println(\"--- Calling methods ---\")\n    for i := 0; i &lt; fooType.NumMethod(); i++ {\n        method := fooType.Method(i)\n\n        method.Func.Call(nil)\n    }\n}\n</code></pre>\n\n<p>Also seen here: <a href=\"https://play.golang.org/p/gNUsANjuPV0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/gNUsANjuPV0</a></p>\n\n<p>This will always panic w/ a message for too few arguments to .Call(). I don't see where this differs structurally from the code here: <a href=\"https://play.golang.org/p/HB8yB91LRme\" rel=\"nofollow noreferrer\">https://play.golang.org/p/HB8yB91LRme</a>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1568060407, "post_id": 57860319, "comment_id": 102147635, "body": "You can use buffered and unbuffered channels both with and without goroutines. You just use whichever you need for the use case."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1568058419, "creation_date": 1568058419, "answer_id": 57860357, "question_id": 57860319, "link": "https://stackoverflow.com/questions/57860319/why-do-we-need-to-run-unbuffered-channels-in-go-routine-but-buffered-channels-ca/57860357#57860357", "title": "Why do we need to run unbuffered channels in go routine but buffered channels can work without go routine?", "body": "<p>A channel send will succeed only if the channel can accept the input, that is, either there's a listener for that channel, or there is available buffer in the channel. Otherwise goroutine will go to sleep until one of those become true: either someone starts listening, or someone reads from the channel and there is now buffer space.</p>\n\n<p>With a channel with no buffer, the only way you can write to it is if someone is listening to it. If there is only one goroutine and if you write to the channel, all goroutines will be asleep.</p>\n\n<p>With a channel with buffer size 3 and one goroutine, you can write to if 3 times without reading from it. The 4th write will put all goroutines to sleep.</p>\n"}, {"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 0, "last_activity_date": 1568065659, "creation_date": 1568065659, "answer_id": 57861588, "question_id": 57860319, "link": "https://stackoverflow.com/questions/57860319/why-do-we-need-to-run-unbuffered-channels-in-go-routine-but-buffered-channels-ca/57861588#57861588", "title": "Why do we need to run unbuffered channels in go routine but buffered channels can work without go routine?", "body": "<blockquote>\n  <p>buffered channels are working fine without go routine</p>\n</blockquote>\n\n<p>because they won't block until their buffer is full. \nWhich is what happens in <code>channelBufferingDemo</code>. It has a length of 3, you write twice on it, it is not full, thus the program keeps going on, you read twice on it, it dequeues and let the program finish.</p>\n\n<p>In <code>channelDemo</code> the channel does not have a buffer, so the first time you read or write, it blocks until another routine performs the opposite operations.\nBecause in your example you are running both operations sequentially within the same routine, it inevitably block, ending with this fatal error.</p>\n"}], "owner": {"reputation": 21, "user_id": 7041807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e61960527f69dbae30e6545bfd81acb8?s=128&d=identicon&r=PG&f=1", "display_name": "abhishek karande", "link": "https://stackoverflow.com/users/7041807/abhishek-karande"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 57860357, "answer_count": 2, "score": -2, "last_activity_date": 1568065659, "creation_date": 1568058121, "question_id": 57860319, "link": "https://stackoverflow.com/questions/57860319/why-do-we-need-to-run-unbuffered-channels-in-go-routine-but-buffered-channels-ca", "title": "Why do we need to run unbuffered channels in go routine but buffered channels can work without go routine?", "body": "<p>I was going through tutorials on gobyexample. I noticed the author has shown example of gochannel using go routine but in buggered go channel he is directly sending messages to channel .</p>\n\n<p>I tried on my local system to run unbuffered channel without go routine but it is throwing \"fatal error: all goroutines are asleep - deadlock!\"\nbut buffered channels are working fine without go routine</p>\n\n<pre><code>func channelDemo() {\n    message := make(chan string)\n    // go func() {\n    //  message &lt;- \"Hello\"\n    // }()\n    message &lt;- \"Hello\"\n    msg := &lt;-message\n\n    fmt.Println(\"msg\", msg)\n}\nfunc channelBufferingDemo() {\n    messages := make(chan string, 3)\n\n    messages &lt;- \"Buffered\"\n    messages &lt;- \"channel\"\n    fmt.Println(&lt;-messages)\n    fmt.Println(&lt;-messages)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568057671, "post_id": 57860131, "comment_id": 102146627, "body": "I don&#39; t know how feasible this would be in your case, but you could implement <code>Foo.BarCallMe</code>, then <code>typedef foo Foo</code> and implement <code>foo.Bar</code>, and convert between the two as necessary."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1568058851, "post_id": 57860131, "comment_id": 102147061, "body": "I think this is not possible, if it is an interface of another package. Because the method and all input and output types need to be exported. Also why implement a method, which gives you an error/panic if it is called directly? Could be a bad code smell."}, {"owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1568059373, "post_id": 57860131, "comment_id": 102147237, "body": "@apxp I gave a concrete example. The heap&#39;s <code>push</code> method calls your <code>push</code> implementation but it also calls <code>up</code>, see here: <a href=\"https://golang.org/src/container/heap/heap.go?s=1949:1986#L42\" rel=\"nofollow noreferrer\">golang.org/src/container/heap/heap.go?s=1949:1986#L42</a>. If a user calls your <code>push</code> method directly, it won&#39;t have the desired effect. So, you need a user facing function that calls <code>heap.Push</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568060466, "post_id": 57860131, "comment_id": 102147653, "body": "Don&#39;t export the methods you don&#39;t want people to use."}], "answers": [{"comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568057806, "post_id": 57860246, "comment_id": 102146677, "body": "<code>type foo Foo</code> does not declare a type alias, it declares a new type."}, {"owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "edited": false, "score": 0, "creation_date": 1568066300, "post_id": 57860246, "comment_id": 102149479, "body": "this golang doesn&#39;t really answer the question. The user has no way of calling <code>F.Foobar() where F is an instance of Foo</code>."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": -1, "last_activity_date": 1568057867, "last_edit_date": 1568057867, "creation_date": 1568057720, "answer_id": 57860246, "question_id": 57860131, "link": "https://stackoverflow.com/questions/57860131/how-to-implement-interface-but-publish-new-api/57860246#57860246", "title": "How to implement interface, but publish new API?", "body": "<p>You could use an unexported type, and only implement the method on the \"alias\":</p>\n\n<p><a href=\"https://play.golang.org/p/ZHg2U1sbVwo\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ZHg2U1sbVwo</a></p>\n\n<pre><code>type Foo struct {}\ntype foo Foo\n\nfunc (f *foo) Bar(\n  ...\n) // dictated by I\n\nfunc (f Foo) BarCallMe() {\n    ...\n    I.Bar(foo(f))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "edited": false, "score": 0, "creation_date": 1568066456, "post_id": 57860564, "comment_id": 102149517, "body": "I was hoping there was a way to say something like <code>InternalPop implements Pop</code> so that I can implement the required function but give it my own name, then define my own Pop. But, I trust that this answer is correct and so essentially I&#39;m SOL."}, {"owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "edited": false, "score": 0, "creation_date": 1568066688, "post_id": 57860564, "comment_id": 102149565, "body": "I don\u2019t understand how people \u201cwrap\u201d interfaces then where they utilize, but hide the internal interface."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "edited": false, "score": 0, "creation_date": 1568073527, "post_id": 57860564, "comment_id": 102150802, "body": "@Tommy you can&#39;t do that using a single type. You have to use at least two types, one with the internal interface and one with the public one, and somehow consolidate the underlying implementation."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 2, "last_activity_date": 1568059580, "creation_date": 1568059580, "answer_id": 57860564, "question_id": 57860131, "link": "https://stackoverflow.com/questions/57860131/how-to-implement-interface-but-publish-new-api/57860564#57860564", "title": "How to implement interface, but publish new API?", "body": "<p>Very simply you can't. If you don't provide all of the methods in the interface, then you don't implement the interface, and if the interface requires that the methods are exported (which it must, because you're using it from another package), then those methods have to be public. No amount of playing around with anonymous embedding or new type names is going to change the fact that <strong>if you want your user to be able to pass something to <code>heap.Pop</code>, it must have a <code>Pop()</code> that they can call.</strong> If you create something that doesn't have <code>Pop()</code> callable on it, then it isn't usable with the functions in <code>heap</code>, and won't be unless you provide some way to turn it into a <code>heap.Interface</code>, at which point the user will be able to call <code>Pop()</code> on it. This isn't unique to you, and it's fundamental to how the Go designers chose to make interfaces work. You can live with it (and trust your users not to deliberately break things), or you can choose not to use the containers in the standard library.</p>\n"}], "owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 1, "answer_count": 2, "score": -1, "last_activity_date": 1568066543, "creation_date": 1568057126, "last_edit_date": 1568066543, "question_id": 57860131, "link": "https://stackoverflow.com/questions/57860131/how-to-implement-interface-but-publish-new-api", "title": "How to implement interface, but publish new API?", "body": "<p>How does one implement an interface but forbid users from calling the functions that implement that interface? </p>\n\n<p>For example, we have a module that implements some interface <code>I</code> which has a required function to implement <code>Bar</code>:</p>\n\n<pre><code>//mymodule.go\nimport (I)\n\ntype Foo struct {\n}\n\nfunc (f *Foo) Bar(\n      ...\n      // DONT want users calling this directly\n      // I.Bar eventually calls this   \n) // dictated by I\n\nfunc (f *Foo) BarCallMe() {\n    ...\n    I.Bar(f)\n}\n\nF = Foo{}\nF.Bar() // make this not possible, do not want!\nF.BarCallMe() // $PROFIT\n</code></pre>\n\n<p>How do we prevent a user of mymodule from using <code>Bar()</code> directly like <code>f.Bar()</code>? Meaning, if we want users of this module to only call <code>BarCallMe</code> how do we hide <code>Bar</code>?</p>\n\n<p>More generically, how do you implement one interface but publish another?</p>\n\n<p>Concrete example: Recently I implemented golang's heap interface which requires <code>Push</code> and <code>Pop</code> be implemented by the implementor. However, <code>heap.Push</code> calls your <code>Push</code> (<a href=\"https://golang.org/src/container/heap/heap.go?s=1949:1986#L42\" rel=\"nofollow noreferrer\">https://golang.org/src/container/heap/heap.go?s=1949:1986#L42</a>), so if a user called my <code>Push</code> directly, it would not have the intended result. So the question here is how to publish a <code>Push</code> that users call, while still providing a <code>Push</code> that meets the interface reqs.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568060580, "post_id": 57859946, "comment_id": 102147695, "body": "The only way to accomplish this is to write your own driver implementation that wraps your underlying driver."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568060593, "post_id": 57859946, "comment_id": 102147702, "body": "That said, this does sound entirely like an XY Problem, which you seem to know :)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1568060728, "post_id": 57859946, "comment_id": 102147741, "body": "Apart from implementing the Scanner interface <i>and</i> using that in Scan, I don&#39;t think there&#39;s anything else in <code>database&#47;sql</code> that would give you the driver.Value that&#39;s fed to <code>*sql.Rows</code>... Depending on what database you&#39;re talking to, you may want to look at lower-level implementations of the driver, such as <a href=\"https://github.com/jackc/pgx\" rel=\"nofollow noreferrer\">pgx</a> for example."}, {"owner": {"reputation": 12085, "user_id": 842685, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b00aa217caf47e646f5d5aea851dc4a7?s=128&d=identicon&r=PG", "display_name": "Joshua Honig", "link": "https://stackoverflow.com/users/842685/joshua-honig"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568061104, "post_id": 57859946, "comment_id": 102147884, "body": "@Flimzy I disagree on that. It&#39;s entirely reasonable to decouple the mechanics of retrieving values from a database from the business logic of conversions to the runtime representations."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568061408, "post_id": 57859946, "comment_id": 102147989, "body": "What are you disagreeing with?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568061711, "post_id": 57859946, "comment_id": 102148090, "body": "&quot;It&#39;s entirely reasonable to decouple the mechanics of retrieving values from a database from the business logic of conversions to the runtime representations.&quot; -- I agree with this completely. As do the authors of the sql driver, which is why it&#39;s possible to implement your own Scanner, to do just that."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1568061990, "creation_date": 1568061990, "answer_id": 57860983, "question_id": 57859946, "link": "https://stackoverflow.com/questions/57859946/how-to-access-unconverted-driver-value-slice-of-sql-rows/57860983#57860983", "title": "How to access unconverted driver.Value slice of sql.Rows", "body": "<p>The normal solution is to implement your own <a href=\"https://golang.org/pkg/database/sql/#Scanner\" rel=\"nofollow noreferrer\"><code>sql.Scanner</code></a>.  But this does use <code>rows.Scan</code>, so it violates your mysterious requirement not to use <code>rows.Scan</code>.</p>\n\n<p>If you truly must avoid <code>rows.Scan</code>, you'll need to write your own driver implementation (possibly wrapping an existing driver) which provides access to the <code>driver.Value</code> values without <code>rows.Scan</code>.</p>\n"}], "owner": {"reputation": 12085, "user_id": 842685, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b00aa217caf47e646f5d5aea851dc4a7?s=128&d=identicon&r=PG", "display_name": "Joshua Honig", "link": "https://stackoverflow.com/users/842685/joshua-honig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1568061990, "creation_date": 1568056396, "question_id": 57859946, "link": "https://stackoverflow.com/questions/57859946/how-to-access-unconverted-driver-value-slice-of-sql-rows", "title": "How to access unconverted driver.Value slice of sql.Rows", "body": "<p>My goal is to get to the raw <code>driver.Value</code> values as deserialized by a sql driver in its implementation of <code>driver.Rows.Next()</code>. <strong>I want to handle the conversion from the values returned by the driver to the needed target types,  instead of relying on the automatic conversions built in to <code>Rows.Scan</code>.</strong> Note this question does not ask your opinion on whether <code>Rows.Scan</code> \"should\" be used. I don't want to use it, and I am asking if there is any way to avoid it.</p>\n\n<p><strong>A meaningful answer does not use <code>Rows.Scan</code> at all</strong>. The dynamic approach illustrated in <a href=\"http://go-database-sql.org/varcols.html\" rel=\"nofollow noreferrer\">Working with Unknown Columns</a> is awful: It invokes all the overhead of Scan <em>and destroys the type information of the source columns</em>, instead shredding the actual <code>driver.Value</code>s into <code>SqlBytes</code>. </p>\n\n<p>The following hack works, but relies on the internal implementation detail that <code>sql.Rows.Next()</code> populates the internal field <code>lastcols</code> with exactly the unconverted values which I want:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>vpRows := reflect.ValueOf(rows)                    // rows is a *sql.Rows\nvRows := reflect.Indirect(vpRows)                  // now we have the sql.Rows struct\nmem := vRows.FieldByName(\"lastcols\")               // unexported field lastcols\nunsafeLastCols := unsafe.Pointer(mem.UnsafeAddr()) // Evil\nplastCols := (*[]driver.Value)(unsafeLastCols)     // But effective\n\nfor rows.Next() {\n    rowVals := *plastCols\n    fmt.Println(rowVals)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568055273, "post_id": 57859015, "comment_id": 102145622, "body": "Do not install Go via brew."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1568055504, "post_id": 57859015, "comment_id": 102145719, "body": "You may want to coordinate your changes with Daniel Marti: <a href=\"https://groups.google.com/d/msg/golang-dev/YMw7aBRvk-4/71YNDg73AQAJ\" rel=\"nofollow noreferrer\">groups.google.com/d/msg/golang-dev/YMw7aBRvk-4/71YNDg73AQAJ</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "edited": false, "score": 0, "creation_date": 1568053064, "post_id": 57859131, "comment_id": 102144680, "body": "Doesn&#39;t work either:  imports internal/testenv: use of internal package internal/testenv not allowed"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "edited": false, "score": 0, "creation_date": 1568053957, "post_id": 57859131, "comment_id": 102145086, "body": "It worked fine for me. What version of Go are you using?"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1568052461, "creation_date": 1568052461, "answer_id": 57859131, "question_id": 57859015, "link": "https://stackoverflow.com/questions/57859015/how-can-i-benchmark-packages-of-the-golang-standard-library/57859131#57859131", "title": "How can I benchmark packages of the golang standard library?", "body": "<p>I believe this is due to Go modules, but what worked for me was to execute from within the stdlib:</p>\n\n<pre><code>cd /usr/local/go/src/encoding/json\ngo test -run='^$' -bench .\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1568052655, "post_id": 57859150, "comment_id": 102144518, "body": "You don&#39;t have to bootstrap, you can run the benchmarks/tests against a normal install of Go."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568052686, "post_id": 57859150, "comment_id": 102144529, "body": "Yes, true. Let me fix that description"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568052779, "post_id": 57859150, "comment_id": 102144572, "body": "Your answer also only says how to run tests, which OP said were working for them. Benchmarks were the issue."}, {"owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "edited": false, "score": 0, "creation_date": 1568053015, "post_id": 57859150, "comment_id": 102144663, "body": "I didn&#39;t ask that but I still don&#39;t see how to run that against a normal go?  \u276f go test ./encoding/json -bench=. # std/encoding/json package std/encoding/json (test)         imports internal/testenv: use of internal package internal/testenv not allowed FAIL    std/encoding/json [setup failed] FAIL"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568053274, "post_id": 57859150, "comment_id": 102144772, "body": "Do you have multiple versions of go installed by any chance?"}, {"owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "edited": false, "score": 0, "creation_date": 1568054083, "post_id": 57859150, "comment_id": 102145136, "body": "I have go installed via brew (on OSX) and go cloned outside ouf GOROOT. WFM inside GOROOT, much appreciated!"}, {"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 0, "creation_date": 1568054134, "post_id": 57859150, "comment_id": 102145158, "body": "The dot in <code>.&#47;encoding&#47;json</code> is  not needed.    <code>go clean -testcache &amp;&amp; go test encoding&#47;json -bench=&quot;.&quot;</code> must work"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568054582, "post_id": 57859150, "comment_id": 102145351, "body": "If you&#39;re trying to run it in the cloned go directory, then run the all script first, build the binary, and then run <code>..&#47;bin&#47;go test ...</code>. That should not complain about the internal dir."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1568053086, "last_edit_date": 1568053086, "creation_date": 1568052547, "answer_id": 57859150, "question_id": 57859015, "link": "https://stackoverflow.com/questions/57859015/how-can-i-benchmark-packages-of-the-golang-standard-library/57859150#57859150", "title": "How can I benchmark packages of the golang standard library?", "body": "<p>If this is a fresh checkout of the go source tree, after bootstrapping (i.e. running all.bash), go under go/src/ and run</p>\n\n<pre><code> ../bin/go test ./encoding/json -bench=.\n</code></pre>\n\n<p>Or you can run it against the installed version the same way by going under /usr/local/go/src.</p>\n\n<p>If you're planning to submit a performance enhancement, they'll want you to have before/after benchmarks comparisons. So run the benchmarks 10-20 times before and after, and compare the results using the <code>benchstat</code> tool.</p>\n\n<pre><code>../bin/go test ./encoding/json -bench=. -count=10 &gt;after\n</code></pre>\n"}], "owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 0, "accepted_answer_id": 57859150, "answer_count": 2, "score": 2, "last_activity_date": 1568053086, "creation_date": 1568051903, "question_id": 57859015, "link": "https://stackoverflow.com/questions/57859015/how-can-i-benchmark-packages-of-the-golang-standard-library", "title": "How can I benchmark packages of the golang standard library?", "body": "<p>I'd like to make a small contribution the golang and need to run the benchmarks, e.g. for encoding/json.</p>\n\n<p>All my attempts are failed (go1.13):</p>\n\n<pre><code>\u276f go test -bench encoding/json\nbuild .: cannot find module for path .\n\n\u276f go test encoding/json\nok      encoding/json   1.412s\n\n\u276f go test -bench std/encoding/json\nbuild .: cannot find module for path .\n\n\u276f go test std/encoding/json\n# std/encoding/json\npackage std/encoding/json (test)\n        imports internal/testenv: use of internal package internal/testenv not allowed\nFAIL    std/encoding/json [setup failed]\nFAIL\n\n\u276f go test std\nok      archive/tar     (cached)\n\n\u276f go test -bench std\nbuild .: cannot find module for path .\n</code></pre>\n\n<p>So how would I exclusively test encoding/json?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1568049316, "post_id": 57858415, "comment_id": 102143134, "body": "You can have as many files in a directory as you want and they can be part of the same package as long as you use the same <i>package declaration</i> at the top of each file. i.e. change <code>package auth</code> to <code>package main</code> in the auth file."}, {"owner": {"reputation": 3647, "user_id": 4093955, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/bjZjz.jpg?s=128&g=1", "display_name": "Ay0", "link": "https://stackoverflow.com/users/4093955/ay0"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1568049919, "post_id": 57858415, "comment_id": 102143391, "body": "@mkopriva ahh I got that info wrong, I thought that a package&#39;s name must be unique, meaning that only one definition of <code>package foo</code> could exist. Working fine now in two files."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1568055342, "post_id": 57858415, "comment_id": 102145650, "body": "You might find &quot;How to Write Go Code&quot; an informative source."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1568049417, "creation_date": 1568049417, "answer_id": 57858494, "question_id": 57858415, "link": "https://stackoverflow.com/questions/57858415/multiple-files-in-same-package-in-go/57858494#57858494", "title": "Multiple files in same package in Go", "body": "<p>You can have only one package in a directory, and it looks like you don't need a package for this addition, so you can simply put that in a separate file, and add <code>package main</code> at the top. Having a <code>main</code> package and putting everything under it works up to a point. As things get larger, you have to break it up into self-contained packages.</p>\n"}], "owner": {"reputation": 3647, "user_id": 4093955, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/bjZjz.jpg?s=128&g=1", "display_name": "Ay0", "link": "https://stackoverflow.com/users/4093955/ay0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1084, "favorite_count": 0, "accepted_answer_id": 57858494, "answer_count": 1, "score": 0, "last_activity_date": 1568049417, "creation_date": 1568049039, "question_id": 57858415, "link": "https://stackoverflow.com/questions/57858415/multiple-files-in-same-package-in-go", "title": "Multiple files in same package in Go", "body": "<p>I'm writing my first Go code which among other things, sends an email. After finding out that the package <code>net/smtp</code> only supports <code>Plain Auth</code> (but some providers like outlook doesn't support it), I asked for a solution and got pointed out to <a href=\"https://gist.github.com/andelf/5118732\" rel=\"nofollow noreferrer\">https://gist.github.com/andelf/5118732</a>.</p>\n\n<p>That code works like a charm, but as it's not something written by myself, I would like to add it in a separate file and just reference it in my <code>main.go</code>.</p>\n\n<p>What's the right approach to have multiple files in the same package? I don't want to create a different package just for that code, first because it's not mine, and secondly, because I think it's an \"overkill\" approach, isn't it?</p>\n\n<p>I thought that as long as the files are in the same directory, I could have many <code>*.go</code> files, but it seems it's not working out. If I just create a file with the content of that gist, the compiler fails because <code>expected package, found import</code>. If I add something like <code>package auth</code>, then it fails because <code>found packages auth (auth.go) and main (main.go)</code></p>\n\n<p>So, what's the general practice in this situations? Just create packages for everything?</p>\n"}, {"tags": ["go", "grpc"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1568041557, "post_id": 57856570, "comment_id": 102139613, "body": "One thing you can improve is to unlock immediately after checking, instead of using defer. Otherwise, it looks reasonable to me. There shouldn&#39;t be much performance impact for readers. When you&#39;re updating, all new readers will wait until all the existing readers are done and writer unlocks."}, {"owner": {"reputation": 41, "user_id": 11573167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c90fccbbda463690f45b5093d83a0605?s=128&d=identicon&r=PG&f=1", "display_name": "jimpeter", "link": "https://stackoverflow.com/users/11573167/jimpeter"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568041726, "post_id": 57856570, "comment_id": 102139707, "body": "Thanks for pointing that out about unlocking immediately after, @bserdar. I&#39;ve got it ingrained into my head to defer in case something goes wrong, but in this example there&#39;s no risk of that :)"}, {"owner": {"reputation": 649, "user_id": 554480, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/m1Kjt.png?s=128&g=1", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/554480/mikhail"}, "edited": false, "score": 0, "creation_date": 1568045530, "post_id": 57856570, "comment_id": 102141516, "body": "Why don&#39;t just use some function &quot;isHappyHour(time.Time)&quot; which returns bool based on the given argument? The stateless is always safer than stateful."}, {"owner": {"reputation": 41, "user_id": 11573167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c90fccbbda463690f45b5093d83a0605?s=128&d=identicon&r=PG&f=1", "display_name": "jimpeter", "link": "https://stackoverflow.com/users/11573167/jimpeter"}, "reply_to_user": {"reputation": 649, "user_id": 554480, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/m1Kjt.png?s=128&g=1", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/554480/mikhail"}, "edited": false, "score": 0, "creation_date": 1568047473, "post_id": 57856570, "comment_id": 102142376, "body": "@Mikhail - My real code is a bit more involved than my example, but I think that would still be a viable option for my needs. Thanks!"}], "owner": {"reputation": 41, "user_id": 11573167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c90fccbbda463690f45b5093d83a0605?s=128&d=identicon&r=PG&f=1", "display_name": "jimpeter", "link": "https://stackoverflow.com/users/11573167/jimpeter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1568041059, "creation_date": 1568041059, "question_id": 57856570, "link": "https://stackoverflow.com/questions/57856570/how-to-safely-add-bool-field-to-grpc-server-struct", "title": "How to safely add bool field to gRPC server struct?", "body": "<p>I'm looking to add what's essentially a \"status\" boolean field to my gRPC Server.\nThe idea is that the state of the server could be set when certain conditions are met, so when any new gRPC requests come in, the response would be tailored accordingly.</p>\n\n<p>I have a <code>server struct</code> that I'm using, and for this example, I've added a <code>HappyHour bool</code> field.\nI have a goroutine that runs when the server is started, and every minute it checks the time of day. If the time of day is between 5-7pm, HappyHour gets set to true. Otherwise, it gets set to false.</p>\n\n<pre><code>type server struct {\n    HappyHour bool\n    mu     sync.RWMutex\n}\n\nfunc (s *server) OrderDrink(ctx context.Context, req *bar.DrinkRequest) (*flatbuffers.Builder, error) {\n\n    drink := string(req.drink())\n    qty := req.qty()\n\n\n    // Code here to look up the price of the drink in the database\n    total := price*qty\n\n    // Use a mutex to check HappyHour status \n    s.mu.RLock()\n    defer mu.RLock()\n    if s.HappyHour == true {\n        total=total/2\n    }\n\n    b := flatbuffers.NewBuilder(0)\n    // Serialize the response and send it to the client\n}\n\n\nfunc main() {\n    lis, err := net.Listen(\"tcp\", \"0.0.0.0:50051\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    s := grpc.NewServer(grpc.CustomCodec(flatbuffers.FlatbuffersCodec{}))\n\n    var srv server\n    bar.RegisterBARServer(s, &amp;srv) \n\n    // Monitor happy hour\n    go happyHour(&amp;srv)\n}\n</code></pre>\n\n<p>Things seem to be working from my initial testing, but I'm quite new to gRPC, and am a bit worried about using a mutex on the server struct. </p>\n\n<p>Will there be negative performance impacts if there are many clients connecting to the server? If I'm reading or updating HappyHour, and the lock has been acquired, would this impact new users connecting or sending requests? Or would this only impact the actual <code>HappyHour</code> field?</p>\n"}, {"tags": ["xml", "parsing", "go", "struct"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568099330, "post_id": 57854313, "comment_id": 102156540, "body": "You can implement the xml.Unmarshaler interface on a custom map type like so: <a href=\"https://play.golang.com/p/gi9Fiv3PS8M\" rel=\"nofollow noreferrer\">play.golang.com/p/gi9Fiv3PS8M</a>"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1568099890, "post_id": 57854313, "comment_id": 102156776, "body": "Is this XML under your control? Because dynamic tags are a VERY bad practice."}, {"owner": {"reputation": 295, "user_id": 3075732, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/40493478bdfded4a664080c48cb3927e?s=128&d=identicon&r=PG&f=1", "display_name": "MZON", "link": "https://stackoverflow.com/users/3075732/mzon"}, "edited": false, "score": 0, "creation_date": 1568101106, "post_id": 57854313, "comment_id": 102157355, "body": "Unfortunately the xml file is a 3rd party"}, {"owner": {"reputation": 295, "user_id": 3075732, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/40493478bdfded4a664080c48cb3927e?s=128&d=identicon&r=PG&f=1", "display_name": "MZON", "link": "https://stackoverflow.com/users/3075732/mzon"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568101407, "post_id": 57854313, "comment_id": 102157499, "body": "@mkopriva your suggestion works like a charm. Please add it as a answer so I can accept it"}], "answers": [{"tags": [], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "is_accepted": false, "score": 1, "last_activity_date": 1568039005, "last_edit_date": 1568039005, "creation_date": 1568038681, "answer_id": 57855860, "question_id": 57854313, "link": "https://stackoverflow.com/questions/57854313/parse-dynamic-xml/57855860#57855860", "title": "Parse dynamic XML", "body": "<p>You can use this library (<a href=\"https://github.com/clbanning/mxj\" rel=\"nofollow noreferrer\">https://github.com/clbanning/mxj</a>):</p>\n\n<pre><code>var input = []byte(`&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n    &lt;products&gt;\n        &lt;product&gt;\n            &lt;name&gt;hello&lt;/name&gt;\n            &lt;images&gt;\n                &lt;image1&gt;one&lt;/image1&gt;\n                &lt;image2&gt;one&lt;/image2&gt;\n            &lt;/images&gt;\n        &lt;/product&gt;\n    &lt;/products&gt;`)\n\ntype Products struct {\n    XMLName xml.Name `xml:\"products\"`\n    Products []Product `xml:\"product\"`\n}\n\ntype Product struct {\n    XMLName xml.Name `xml:\"product\"`\n    Name string `xml:\"name\"`\n    Images map[string]interface{}\n}\n\n\nfunc (p *Product) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n\n    var v struct {\n        XMLName xml.Name `xml:\"product\"`\n        Name string `xml:\"name\"`\n        Images struct {\n            Inner []byte `xml:\",innerxml\"`\n        } `xml:\"images\"`\n    }\n\n    err := d.DecodeElement(&amp;v, &amp;start)\n    if err != nil {\n        return err\n    }\n\n    images := make(map[string]interface{})\n    // use mxj here and fill images from v.Images.Inner\n\n    p.Name = v.Name\n    p.Images = images\n\n    return nil\n}\n\n\nfunc main() {\n\n    var data Products\n    err := xml.Unmarshal(input, &amp;data)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1568102853, "creation_date": 1568102853, "answer_id": 57866525, "question_id": 57854313, "link": "https://stackoverflow.com/questions/57854313/parse-dynamic-xml/57866525#57866525", "title": "Parse dynamic XML", "body": "<p>You can implement the xml.Unmarshaler interface on a custom map type like so:</p>\n\n<pre><code>type Images map[string]string\n\nfunc (i *Images) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n    *i = make(Images) // initialize the map\n    for {\n        tok, err := d.Token()\n        if err != nil {\n            if err == io.EOF {\n                return nil\n            }\n            return err\n        }\n\n        if se, ok := tok.(xml.StartElement); ok {\n            tok, err = d.Token()\n            if err != nil {\n                if err == io.EOF {\n                    return nil\n                }\n                return err\n            }\n            if data, ok := tok.(xml.CharData); ok {\n                (*i)[se.Name.Local] = string(data)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/gi9Fiv3PS8M\" rel=\"nofollow noreferrer\">https://play.golang.com/p/gi9Fiv3PS8M</a></p>\n"}], "owner": {"reputation": 295, "user_id": 3075732, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/40493478bdfded4a664080c48cb3927e?s=128&d=identicon&r=PG&f=1", "display_name": "MZON", "link": "https://stackoverflow.com/users/3075732/mzon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 57866525, "answer_count": 2, "score": 3, "last_activity_date": 1568102853, "creation_date": 1568033006, "last_edit_date": 1568035814, "question_id": 57854313, "link": "https://stackoverflow.com/questions/57854313/parse-dynamic-xml", "title": "Parse dynamic XML", "body": "<p>I understand how to unmarshal simple xml data to Go structs but can't figure out how to handle dynamic tags. Here's an example. There can be <code>&lt;image_3&gt;&lt;image_4&gt;</code> etc</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;products&gt;\n  &lt;product&gt;\n    &lt;product_id&gt;11600&lt;/product_id&gt;\n    &lt;date_created&gt;&lt;![CDATA[2018-10-19 15:20:22]]&gt;&lt;/date_created&gt;\n    &lt;price&gt;200&lt;/price&gt;\n    &lt;stock_status&gt;In Stock&lt;/stock_status&gt;\n    &lt;images&gt;\n      &lt;image_1&gt;1.jpg&lt;/image_1&gt;\n      &lt;image_2&gt;2.jpg&lt;/image_2&gt;\n   &lt;/images\n   &lt;/product&gt;\n&lt;/products&gt;\n</code></pre>\n\n<p>//update </p>\n\n<pre><code>type Products struct {\n        XMLName xml.Name `xml:\"products\"`\n        Text    string   `xml:\",chardata\"`\n        Product struct {\n                Text        string `xml:\",chardata\"`\n                ProductID   string `xml:\"product_id\"`\n                DateCreated string `xml:\"date_created\"`\n                Price       string `xml:\"price\"`\n                StockStatus string `xml:\"stock_status\"`\n                Images          map[string]string `xml:\"images\"`\n        } `xml:\"product\"`\n} \n</code></pre>\n\n<p>When I run <code>fmt.Println(len(products.Product[0].Images))</code> I get 0. What I'm missing here?</p>\n"}, {"tags": ["go", "struct", "interface"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568036989, "post_id": 57854174, "comment_id": 102136968, "body": "If it&#39;s only using the <code>name</code> field, why does it take the entire struct as a parameter instead of just taking the name? i.e. just have one function <code>workOnName(name string)</code>."}, {"owner": {"reputation": 2301, "user_id": 1773628, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4330cfb8feb2db8b3bb30595741b9af2?s=128&d=identicon&r=PG", "display_name": "Mark Anderson", "link": "https://stackoverflow.com/users/1773628/mark-anderson"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568037573, "post_id": 57854174, "comment_id": 102137342, "body": "@Adrian In this case, it only uses the name, and I used this for illustrative purposes. The actual problem contains around 10 fields that are used. In addition, the check whether the pointer is nil has to happen somewhere, so if it doesn&#39;t happen in the function (where it belongs), that would mean checking whether the pointer is nil in dozens of places."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568037976, "post_id": 57854174, "comment_id": 102137558, "body": "Your question said &quot;This function, which only uses name, is the same across all structs&quot; - your comment, &quot;around 10 fields that are used&quot; implies a very different problem. I&#39;d probably be looking to change the model so that the fields aren&#39;t duplicated but instead use an embedded struct with the shared fields, then write the <code>workOnNameAndStuff</code> function to take the embedded type. But, without seeing actually relevant example code it&#39;s hard to offer much advice."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568038640, "post_id": 57854174, "comment_id": 102137920, "body": "@MarkAnderson If the function needs only the name to do its job, why don&#39;t you pass the name field to the function instead of the whole struct?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568038823, "post_id": 57854174, "comment_id": 102138031, "body": "@MarkAnderson <i>&quot;An interface has a pair of references, a reference to a type and reference to a value. If the interface itself is nil, then these are both nil. If the interface points to a nil value, then the type is non-nil (it points to the type of the nil value), but the value is nil. If the interface is of the first kind, type assertion fails because type is nil. If the interface is of the second kind, type assertion works because there is a non-nil type.&quot;</i> from: <a href=\"https://stackoverflow.com/questions/57781058/how-to-cast-nil-interface-to-nil-other-interface/57781089#comment101998636_57781089\" title=\"how to cast nil interface to nil other interface\">stackoverflow.com/questions/57781058/&hellip;</a>"}, {"owner": {"reputation": 2301, "user_id": 1773628, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4330cfb8feb2db8b3bb30595741b9af2?s=128&d=identicon&r=PG", "display_name": "Mark Anderson", "link": "https://stackoverflow.com/users/1773628/mark-anderson"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568038908, "post_id": 57854174, "comment_id": 102138074, "body": "@mkopriva Thanks for that second reply, but is there a way to get around this and only get the first reference?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568038946, "post_id": 57854174, "comment_id": 102138096, "body": "@MarkAnderson <a href=\"https://play.golang.org/p/apgPbhX0uYm\" rel=\"nofollow noreferrer\">play.golang.org/p/apgPbhX0uYm</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1568039107, "post_id": 57854174, "comment_id": 102138184, "body": "@MarkAnderson you could use reflect to figure out if a non-nil interface&#39;s value is nil <a href=\"https://play.golang.org/p/TJiIVf8JMED\" rel=\"nofollow noreferrer\">play.golang.org/p/TJiIVf8JMED</a>"}, {"owner": {"reputation": 2301, "user_id": 1773628, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4330cfb8feb2db8b3bb30595741b9af2?s=128&d=identicon&r=PG", "display_name": "Mark Anderson", "link": "https://stackoverflow.com/users/1773628/mark-anderson"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568040846, "post_id": 57854174, "comment_id": 102139227, "body": "@mkopriva Thanks! This worked great. If you want to add it as a reply, I can mark it as the right answer."}], "answers": [{"comments": [{"owner": {"reputation": 2301, "user_id": 1773628, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4330cfb8feb2db8b3bb30595741b9af2?s=128&d=identicon&r=PG", "display_name": "Mark Anderson", "link": "https://stackoverflow.com/users/1773628/mark-anderson"}, "edited": false, "score": 0, "creation_date": 1568037495, "post_id": 57854280, "comment_id": 102137289, "body": "Thanks for the answer, but this does not work. See this playground here: <a href=\"https://play.golang.org/p/_d1qiZwnMe_f\" rel=\"nofollow noreferrer\">play.golang.org/p/_d1qiZwnMe_f</a> The problem is (and that I&#39;ve been wrestling with) is that Go will not see the pointer as nil, even though it is, and will run the &quot;else&quot; branch instead."}, {"owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "reply_to_user": {"reputation": 2301, "user_id": 1773628, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4330cfb8feb2db8b3bb30595741b9af2?s=128&d=identicon&r=PG", "display_name": "Mark Anderson", "link": "https://stackoverflow.com/users/1773628/mark-anderson"}, "edited": false, "score": 0, "creation_date": 1568133914, "post_id": 57854280, "comment_id": 102175123, "body": "you&#39;re right. I just edited the answer with the new changes. in Go, an interface variable is considered nil if, and only if, the variable points to nil - and not to a variable of some type, which has the value of nil. in other words, &quot;var fakePointer WithName = nil&quot; is not the same as &quot;var fakePointer *foo = nil&quot;. one is a nil interface reference, the other one is a reference of foo pointing to nil. you need to use reflection to different both cases generically. please take a look at this (<a href=\"https://dev.to/pauljlucas/go-tcha-when-nil--nil-hic\" rel=\"nofollow noreferrer\">dev.to/pauljlucas/go-tcha-when-nil--nil-hic</a>) for more details."}], "tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": true, "score": 2, "last_activity_date": 1568133956, "last_edit_date": 1568133956, "creation_date": 1568032898, "answer_id": 57854280, "question_id": 57854174, "link": "https://stackoverflow.com/questions/57854174/how-can-i-implement-the-same-function-for-pointers-to-different-structs/57854280#57854280", "title": "How can I implement the same function for pointers to different structs?", "body": "<p>You can declare an interface which declares a function returning a name:</p>\n\n<pre><code>type WithName interface {\n    Name() string\n}\n</code></pre>\n\n<p>In order to implement that interface, you types (<code>foo</code>, <code>bar</code>, etc) need to have that method - not just the field, the method.</p>\n\n<pre><code>func (f foo) Name() string {\n    return f.name\n}\n</code></pre>\n\n<p>Then, <code>workOnName</code> needs to receive a reference of that interface:</p>\n\n<pre><code>func workOnName(n WithName) interface{} {\n    if (n == nil || reflect.ValueOf(n).isNil()) {\n        // Do lots of stuff\n    } else {\n        // Do lots of other stuff\n    }\n    // Do even more stuff\n    return something\n}\n</code></pre>\n\n<p>Keep in mind that the parameter <code>n WithName</code> is always treated as a pointer, not an object value.</p>\n"}, {"tags": [], "owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "is_accepted": false, "score": 0, "last_activity_date": 1568059188, "creation_date": 1568059188, "answer_id": 57860502, "question_id": 57854174, "link": "https://stackoverflow.com/questions/57854174/how-can-i-implement-the-same-function-for-pointers-to-different-structs/57860502#57860502", "title": "How can I implement the same function for pointers to different structs?", "body": "<p>I think that's the case for <code>reflect</code>.</p>\n\n<p>Something like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc SetFieldX(obj, value interface{}) {\n    v := reflect.ValueOf(obj).Elem()\n    if !v.IsValid() {\n        fmt.Println(\"obj is nil\")\n        return\n    }\n    f := v.FieldByName(\"X\")\n    if f.IsValid() &amp;&amp; f.CanSet() {\n        f.Set(reflect.ValueOf(value))\n    }\n\n}\n\nfunc main() {\n    st1 := &amp;struct{ X int }{10}\n    var stNil *struct{}\n\n    SetFieldX(st1, 555)\n    SetFieldX(stNil, \"SSS\")\n\n    fmt.Printf(\"%v\\n%v\\n\", st1, stNil)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/OddSWT4JkSG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/OddSWT4JkSG</a></p>\n\n<p>Note that <code>IsValid</code> checks more than just <code>obj==nil</code> but if you really want to distinguish cases of <code>nil pointers</code> and non-struct objects - you are free to implement it.</p>\n"}], "owner": {"reputation": 2301, "user_id": 1773628, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4330cfb8feb2db8b3bb30595741b9af2?s=128&d=identicon&r=PG", "display_name": "Mark Anderson", "link": "https://stackoverflow.com/users/1773628/mark-anderson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 57854280, "answer_count": 2, "score": 0, "last_activity_date": 1568133956, "creation_date": 1568032458, "last_edit_date": 1568037667, "question_id": 57854174, "link": "https://stackoverflow.com/questions/57854174/how-can-i-implement-the-same-function-for-pointers-to-different-structs", "title": "How can I implement the same function for pointers to different structs?", "body": "<p>Suppose I have a lot of different structs, but they all share a common field, such as \"name\". For example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type foo struct {\n    name string\n    someOtherString string\n    // Other fields\n}\n\ntype bar struct {\n    name string\n    someNumber int\n    // Other fields\n}\n</code></pre>\n\n<p>Further on in the program, I repeatedly encounter the situation where I get pointers to these structs (so *foo, *bar, etc.) and need to perform operations depending on whether the pointer is nil or not, basically like so:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func workOnName(f *foo) interface{} {\n    if (f == nil) {\n        // Do lots of stuff\n    } else {\n        // Do lots of other stuff\n    }\n    // Do even more stuff\n    return something\n}\n</code></pre>\n\n<p>This function, which only uses <code>name</code>, is the same across all structs. If these were not pointers, I know I could write a common interface for each struct that returns the name and use that as the type. But with pointers, none of this has worked. Go either complains while compiling, or the nil check doesn't work and Go panics. I haven't found anything smarter than to copy/paste the exact same code for every struct that I have, so basically to implement all the functions:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (f *foo) workOnName() interface{}\nfunc (b *bar) workOnName() interface{}\nfunc (h *ham) workOnName() interface{}\n// And so on...\n</code></pre>\n\n<p>Is there a way to do this better, i.e. to only implement a simple function (or even better, no function at all) for all my structs and simply write the complicated stuff once, for all the structs?</p>\n\n<p>Edit: Thank you to the answers so far, but simply using an interface of the type:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (f foo) Name() string {\n    return f.name\n}\n</code></pre>\n\n<p>for some interface that provides <code>Name()</code> does not work, because the pointer is not recognized as nil. See this playground: <a href=\"https://play.golang.org/p/_d1qiZwnMe_f\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_d1qiZwnMe_f</a></p>\n"}, {"tags": ["go", "apache-beam"], "answers": [{"tags": [], "owner": {"reputation": 652, "user_id": 9726037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HtEYC.jpg?s=128&g=1", "display_name": "MichelDelpech", "link": "https://stackoverflow.com/users/9726037/micheldelpech"}, "is_accepted": true, "score": 0, "last_activity_date": 1568091675, "last_edit_date": 1568091675, "creation_date": 1568053042, "answer_id": 57859259, "question_id": 57853725, "link": "https://stackoverflow.com/questions/57853725/go-sdk-apache-beam-singleton-side-input-singleton-for-int-ill-defined/57859259#57859259", "title": "Go SDK Apache Beam : singleton side input Singleton for int ill-defined", "body": "<p><strong>Update:</strong></p>\n\n<p>This can be simplified by removing the <code>beam.Impulse()</code> function (I think the wrong type caused the trouble here):</p>\n\n<pre><code>mapped := beam.ParDo(s,\n        func(k string, v int,\n            sideCounted int,\n            emit func(ratio models.RecommendRatio)) {\n\n            p := percent.PercentOf(v, sideCounted)\n\n            emit(models.RecommendRatio{\n                DoRecommend: k,\n                NumVotes:    v,\n                Percent:     p,\n            })\n\n        }, summed,\n        beam.SideInput{Input: counted})\n</code></pre>\n\n<p>Old:\nSeems like I've found a solution, maybe just a workaround, <strong>looking for a quick review and open to room for improvements</strong>. (I believe that function isnt idempotent because if it may executed more than once on multiple node workers, the append() function will duplicate entries...)</p>\n\n<p>But the global idea here is to make a singleton PCollection of a <code>[]uint8 byte</code> using <code>beam.Impulse(scope)</code> function and pass all the \"real\" data as a side inputs.</p>\n\n<pre><code>    // Pair each recommendation value with one -&gt; PColl&lt;KV&lt;string, int&gt;&gt;\n    pairedWithOne := beam.ParDo(s, func(r models.Review) (string, int) {\n        return r.DoRecommend, 1\n    }, col)\n\n    // Sum num occurrences of a recommendation k/v pair\n    summed := stats.SumPerKey(s, pairedWithOne)\n\n    // Drop keys for latter global count\n    droppedKey := beam.DropKey(s, pairedWithOne)\n\n    // Count globally the number of recommendation values -&gt; PColl&lt;int&gt;\n    counted := stats.Sum(s, droppedKey)\n\n    // Map to a struct with percentage per ratio\n    mapped := beam.ParDo(s,\n        func(_ []uint8,\n            sideSummed func(k *string, v *int) bool,\n            sideCounted int,\n            emit func(ratio []models.RecommendRatio)) {\n\n            var k string\n            var v int\n            var ratios []models.RecommendRatio\n\n\n            for sideSummed(&amp;k, &amp;v) {\n                p := percent.PercentOf(v, sideCounted)\n\n                ratio := models.RecommendRatio{\n                    DoRecommend: k,\n                    NumVotes:    v,\n                    Percent:     p,\n                }\n\n                ratios = append(ratios, ratio)\n            }\n\n            emit(ratios)\n\n        }, beam.Impulse(s),\n        beam.SideInput{Input: summed},\n        beam.SideInput{Input: counted})\n</code></pre>\n"}], "owner": {"reputation": 652, "user_id": 9726037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HtEYC.jpg?s=128&g=1", "display_name": "MichelDelpech", "link": "https://stackoverflow.com/users/9726037/micheldelpech"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 521, "favorite_count": 1, "accepted_answer_id": 57859259, "answer_count": 1, "score": 2, "last_activity_date": 1568091675, "creation_date": 1568030830, "last_edit_date": 1568046696, "question_id": 57853725, "link": "https://stackoverflow.com/questions/57853725/go-sdk-apache-beam-singleton-side-input-singleton-for-int-ill-defined", "title": "Go SDK Apache Beam : singleton side input Singleton for int ill-defined", "body": "<p>Using the Go SDK for Apache Beam, I'm trying to create a view of a PCollection using a side input.</p>\n\n<p>But I'm getting this weird error:</p>\n\n<pre><code>Failed to execute job: on ctx=      making side input 0:\nsingleton side input Singleton for int ill-defined\nexit status 1\n</code></pre>\n\n<p>Here the code I'm using:</p>\n\n<pre><code>// A PCollection of key/value pairs\npairedWithOne := beam.ParDo(s, func(r models.Review) (string, int) {\n        return r.DoRecommend, 1\n    }, col)\n\n// A PCollection of ints (demo)\npcollInts := beam.CreateList(s, [3]int{\n        1, 2, 3,\n})\n\n// A PCollection of key/values pairs\nsummed := stats.SumPerKey(s, pairedWithOne)\n\n// Here is where I'd like to use my side input.\nmapped := beam.ParDo(s, func(k string, v int, side int, emit func(ratio \nmodels.RecommendRatio)) {\n        var ratio = models.RecommendRatio{\n            DoRecommend: k,\n            NumVotes:    v,\n        }\n\n        emit(ratio)\n    }, summed, beam.SideInput{Input: pcollInts})\n</code></pre>\n\n<p>I found this example on <a href=\"https://github.com/apache/beam/blob/master/sdks/go/pkg/beam/pardo.go\" rel=\"nofollow noreferrer\">git</a>:</p>\n\n<pre><code>// Side Inputs\n//\n// While a ParDo processes elements from a single \"main input\" PCollection, it\n// can take additional \"side input\" PCollections. These SideInput along with\n// the DoFn parameter form express styles of accessing PCollection computed by\n// earlier pipeline operations, passed in to the ParDo transform using SideInput\n// options, and their contents accessible to each of the DoFn operations. For\n// example:\n//\n//     words := ...\n//     cufoff := ...  // Singleton PCollection&lt;int&gt;\n//     smallWords := beam.ParDo(s, func (word string, cutoff int, emit func(string)) {\n//           if len(word) &lt; cutoff {\n//                emit(word)\n//           }\n//     }, words, beam.SideInput{Input: cutoff})\n</code></pre>\n\n<p><strong>update:</strong> It seems like the <code>Impulse(scope)</code> function has a role here but I cannot figure what. From GoDoc : </p>\n\n<pre><code>Impulse emits a single empty []byte into the global window. The resulting PCollection is a singleton of type []byte.\n\nThe purpose of Impulse is to trigger another transform, such as ones that take all information as side inputs.\n</code></pre>\n\n<p>If this can help, here my structs:</p>\n\n<pre><code>type Review struct {\n    Date        time.Time `csv:\"date\" json:\"date\"`\n    DoRecommend string    `csv:\"doRecommend\" json:\"doRecommend\"`\n    NumHelpful  int       `csv:\"numHelpful\" json:\"numHelpful\"`\n    Rating      int       `csv:\"rating\" json:\"rating\"`\n    Text        string    `csv:\"text\" json:\"text\"`\n    Title       string    `csv:\"title\" json:\"title\"`\n    Username    string    `csv:\"username\" json:\"username\"`\n}\n\ntype RecommendRatio struct {\n    DoRecommend string `json:\"doRecommend\"`\n    NumVotes    int    `json:\"numVotes\"`\n}\n</code></pre>\n\n<p>Any solution for this?</p>\n\n<p>thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568029510, "post_id": 57852250, "comment_id": 102132898, "body": "&quot;I want to do some watch when env variable value is changed&quot; -- This won&#39;t ever happen while the program is running, unless your program itself changes it."}, {"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568029762, "post_id": 57852250, "comment_id": 102133030, "body": "@Flimzy - currently I want to check if config is changed ( this is working  the event was raised) but the<code>new</code> value (which was changed in the conifgfile ) is not reflected, any idea ?"}, {"owner": {"reputation": 598, "user_id": 2756123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x71E3.jpg?s=128&g=1", "display_name": "Tom Trebicky", "link": "https://stackoverflow.com/users/2756123/tom-trebicky"}, "edited": false, "score": 0, "creation_date": 1568029956, "post_id": 57852250, "comment_id": 102133128, "body": "@JennyM where is <code>viper_env&#47;configuration</code> coming from?"}, {"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "reply_to_user": {"reputation": 598, "user_id": 2756123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x71E3.jpg?s=128&g=1", "display_name": "Tom Trebicky", "link": "https://stackoverflow.com/users/2756123/tom-trebicky"}, "edited": false, "score": 0, "creation_date": 1568030047, "post_id": 57852250, "comment_id": 102133169, "body": "@TomTrebicky - it should be <code>myproj</code> ,I&#39;ve updated the post , thanks. it reference to the first file"}], "answers": [{"comments": [{"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "edited": false, "score": 0, "creation_date": 1568031386, "post_id": 57853817, "comment_id": 102133859, "body": "Sorry, I miss your point :) , how does the log level will be changed? I want that when I change the value from <code>config.yaml: &#39;log: debug&#39;</code> to <code>config.yaml: &#39;log: error&#39; </code>, it will change the log output from <code>debug </code> to <code>error</code>  , how can I achive that with your proposal ?"}, {"owner": {"reputation": 598, "user_id": 2756123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x71E3.jpg?s=128&g=1", "display_name": "Tom Trebicky", "link": "https://stackoverflow.com/users/2756123/tom-trebicky"}, "reply_to_user": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "edited": false, "score": 0, "creation_date": 1568031592, "post_id": 57853817, "comment_id": 102133992, "body": "I am talking about the <b>config.yaml</b> file itself and its contents. Instead of the whole two lines of <code>data:\\nconfig.yaml: &#39;log: debug&#39;</code> make it only what I posted <code>log: &#39;level&#39;</code> where level is w/e you want: <code>info</code>, <code>debug</code>, <code>warn</code>, etc."}, {"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "edited": false, "score": 0, "creation_date": 1568032011, "post_id": 57853817, "comment_id": 102134247, "body": "thanks! Tom 1+ , please see my update still I see everthing with <code>warn</code> and not changed according to the log level, any idea as inside the watch I update the log level"}, {"owner": {"reputation": 598, "user_id": 2756123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x71E3.jpg?s=128&g=1", "display_name": "Tom Trebicky", "link": "https://stackoverflow.com/users/2756123/tom-trebicky"}, "reply_to_user": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "edited": false, "score": 0, "creation_date": 1568032474, "post_id": 57853817, "comment_id": 102134477, "body": "That&#39;s because of this line in your <code>setLogLevel</code> function: <code>logrus.WithField(&quot;level&quot;, logLevel).Warn(&quot;setting log level&quot;)</code>. You print the line at the <code>warn</code> level. Change your config option to level <code>error</code> and all these messages disappear. Internally, logrus&#39; print tests whether the requested log level <code>logrus.WithField().Warn()</code> is less or equal than the level set by <code>logrus.SetLevel()</code> and if it is it prints it."}, {"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "edited": false, "score": 0, "creation_date": 1568477410, "post_id": 57853817, "comment_id": 102290221, "body": "HI, please see if you can assist also here, it&#39;s similar question but now on K8S :) <a href=\"https://stackoverflow.com/questions/57936885/k8s-change-config-map-and-update-app-log-level\" title=\"k8s change config map and update app log level\">stackoverflow.com/questions/57936885/&hellip;</a>   , thanks!"}], "tags": [], "owner": {"reputation": 598, "user_id": 2756123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x71E3.jpg?s=128&g=1", "display_name": "Tom Trebicky", "link": "https://stackoverflow.com/users/2756123/tom-trebicky"}, "is_accepted": true, "score": 1, "last_activity_date": 1568033083, "last_edit_date": 1568033083, "creation_date": 1568031136, "answer_id": 57853817, "question_id": 57852250, "link": "https://stackoverflow.com/questions/57852250/how-to-change-value-in-config-file-doesnt-provide-the-value/57853817#57853817", "title": "How to change value in config file doesnt provide the value", "body": "<p>There is nothing wrong with your code as far as I can see since <code>fsnotify</code> truly does trigger. So the culprit has to be in parsing. The first call to <code>setLogLevel(c.GetLogLevel())</code> outside your <code>onConfigChange</code> callback returns an incorrect value. Change the contents of your yaml file to just</p>\n\n<pre><code>log: 'level'\n</code></pre>\n\n<p>and all should be working as desired.</p>\n\n<p>The logrus package supports the following levels (as of the time of writing) in order: <code>Panic</code>, <code>Fatal</code>, <code>Error</code>, <code>Warn</code>, <code>Info</code>, <code>Debug</code>, and <code>Trace</code>. The corresponding methods are: <code>logrus.Panic()</code>, <code>logrus.Fatal()</code>, <code>logrus.Warn()</code>, <code>logrus.Info()</code>, <code>logrus.Debug()</code>, and <code>logrus.Trace()</code>.</p>\n\n<p>For example, if the current level is set to <code>Warn</code>, the call <code>logrus.Warn(\"boo!\")</code> shall output <code>boo!</code>. However, calling <code>logrus.Info(\"boo!\")</code> will show nothing.</p>\n"}], "owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 2, "accepted_answer_id": 57853817, "answer_count": 1, "score": 1, "last_activity_date": 1568033709, "creation_date": 1568025172, "last_edit_date": 1568033709, "question_id": 57852250, "link": "https://stackoverflow.com/questions/57852250/how-to-change-value-in-config-file-doesnt-provide-the-value", "title": "How to change value in config file doesnt provide the value", "body": "<p>I want to do some watch when env variable/ config property value is changed\nI\u2019ve found viper which should support this scenario but didn't able \nto make it work. \nI see that the <code>OnConfigChange</code> is called but the value from config\nis not taken from the config when it change. The config is loaded successfully</p>\n\n<p>I\u2019ve created a sample to demonstrate the issue.</p>\n\n<p>File <code>cfg.go</code></p>\n\n<p><code>go/src/myproj/configuration/cfg.go</code></p>\n\n<pre><code>package configuration\n\nimport (\n   \"fmt\"\n   \"os\"\n   \"strings\"\n\n   \"github.com/fsnotify/fsnotify\"\n   \"github.com/sirupsen/logrus\"\n   \"github.com/spf13/viper\"\n)\n\nconst (\n   varLogLevel     = \"log\"\n   varPathToConfig = \"config.file\"\n)\n\ntype Configuration struct {\n   v *viper.Viper\n}\n\nfunc New() *Configuration {\n   c := Configuration{\n      v: viper.New(),\n   }\n\n   c.v.SetDefault(varPathToConfig, \"./config.yaml\")\n   c.v.SetDefault(varLogLevel, \"info\")\n   c.v.AutomaticEnv()\n   c.v.SetConfigFile(c.GetPathToConfig())\n   err := c.v.ReadInConfig() // Find and read the config file\n   logrus.WithField(\"path\", c.GetPathToConfig()).Warn(\"loading config\")\n   // just use the default value(s) if the config file was not found\n   if _, ok := err.(*os.PathError); ok {\n      logrus.Warnf(\"no config file '%s' not found. Using default values\", c.GetPathToConfig())\n   } else if err != nil { // Handle other errors that occurred while reading the config file\n      panic(fmt.Errorf(\"fatal error while reading the config file: %s\", err))\n   }\n   setLogLevel(c.GetLogLevel())\n   // monitor the changes in the config file\n   c.v.WatchConfig()\n   c.v.OnConfigChange(func(e fsnotify.Event) {\n      logrus.WithField(\"file\", e.Name).Warn(\"Config file changed\")\n      setLogLevel(c.GetLogLevel())\n   })\n   return &amp;c\n}\n\n// GetLogLevel returns the log level\nfunc (c *Configuration) GetLogLevel() string {\n   s := c.v.GetString(varLogLevel)\n   return s\n}\n\n// GetPathToConfig returns the path to the config file\nfunc (c *Configuration) GetPathToConfig() string {\n   return c.v.GetString(varPathToConfig)\n}\n\nfunc setLogLevel(logLevel string) {\n   logrus.WithField(\"level\", logLevel).Warn(\"setting log level\")\n   level, err := logrus.ParseLevel(logLevel)\n   if err != nil {\n      logrus.WithField(\"level\", logLevel).Fatalf(\"failed to start: %s\", err.Error())\n   }\n   logrus.SetLevel(level)\n}\n\n</code></pre>\n\n<p>And I create some sample web-application server to make the program running in background\n(to be able to change the config and see wheatear something is changed ) </p>\n\n<p><code>go/src/myproj</code></p>\n\n<pre><code>package main\n\nimport (\n   \"fmt\"\n   \"net/http\"\n   \"myproj/configuration\"\n)\n\nfunc main() {\n\n   cfg := configuration.New()\n   fmt.Println(cfg)\n\n   http.HandleFunc(\"/\", HelloServer)\n   http.ListenAndServe(\":8080\", nil)\n}\n\nfunc HelloServer(w http.ResponseWriter, r *http.Request) {\n   fmt.Fprintf(w, \"Hello, %s!\", r.URL.Path[1:])\n}\n\n</code></pre>\n\n<p>The problem is that the function <code>GetLogLevel()</code> bring the old value and not read the value from config ?</p>\n\n<p>This is the sample of config-file (I've put it sibling to the <code>main.go</code> file under the root project folder</p>\n\n<p><strong>This is the project structure</strong></p>\n\n<pre><code>go/src/myproj\n  - main.go\n  - configuration #folder\n  -- cfg.go\n  - config.yaml\n</code></pre>\n\n<pre><code>data:\n  config.yaml: 'log: debug'\n</code></pre>\n\n<p>when I change it from <code>info</code> to <code>debug</code> (or other option) I see that the event <code>watch</code> was raised but\nit not fetch the new value (like debug). Any idea?</p>\n\n<p><strong>update</strong>\nwhen I change the configfile like @Tom suggested I was able to see that the log was change but not the level, it stay on <code>warn</code>  </p>\n\n<p>This is the logs , I still see the warn</p>\n\n<pre><code>WARN[0000] loading config                                path=./config.yaml\nWARN[0000] setting log level                             fields.level=info\n&amp;{0xc00012e300}\nWARN[0008] Config file changed                           file=config.yaml\nWARN[0008] setting log level                             fields.level=error\nWARN[0020] Config file changed                           file=config.yaml\nWARN[0020] setting log level                             fields.level=debug\nWARN[0060] Config file changed                           file=config.yaml\nWARN[0060] setting log level                             fields.level=warn\n\n</code></pre>\n"}, {"tags": ["go", "github", "github-api", "go-github"], "answers": [{"comments": [{"owner": {"reputation": 3396, "user_id": 2090453, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/mpG1D.jpg?s=128&g=1", "display_name": "DonOfDen", "link": "https://stackoverflow.com/users/2090453/donofden"}, "edited": false, "score": 1, "creation_date": 1569477622, "post_id": 58107713, "comment_id": 102610764, "body": "Wow!! Nice logic. @Bertrand I will try checking this with my script and keep you posted."}], "tags": [], "owner": {"reputation": 31626, "user_id": 2614364, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tQZrZ.jpg?s=128&g=1", "display_name": "Bertrand Martel", "link": "https://stackoverflow.com/users/2614364/bertrand-martel"}, "is_accepted": true, "score": 1, "last_activity_date": 1569453779, "creation_date": 1569453779, "answer_id": 58107713, "question_id": 57851545, "link": "https://stackoverflow.com/questions/57851545/how-do-we-know-the-user-changed-profile-picture-from-default-in-github-via-api/58107713#58107713", "title": "how do we know the user changed profile picture from default in github via api", "body": "<p>One way to do this is to get some information about the images using tools like <a href=\"https://imagemagick.org/index.php\" rel=\"nofollow noreferrer\">ImageMagick</a> </p>\n\n<p>After checking the Github auto-generated <a href=\"https://github.blog/2013-08-14-identicons/\" rel=\"nofollow noreferrer\">identicons</a>, there are 2 check that would be interesting : </p>\n\n<ul>\n<li><p>check that the image has 2 unique colors :</p>\n\n<pre><code>identify -format %k  github_avatar.png\n</code></pre></li>\n</ul>\n\n<p>output: </p>\n\n<pre><code>2\n</code></pre>\n\n<ul>\n<li><p>one of this color is grey-ish F0F0F0</p>\n\n<pre><code>convert github_avatar.png -colors 2 \\\n    -format \"%c\" histogram:info: | \\\n    cut -d'#' -f2 | cut -d' ' -f1\n</code></pre></li>\n</ul>\n\n<p>output: </p>\n\n<pre><code>D65193\nF0F0F0\n</code></pre>\n\n<p><a href=\"https://linux.die.net/man/1/identify\" rel=\"nofollow noreferrer\">identify</a> and <a href=\"https://linux.die.net/man/1/convert\" rel=\"nofollow noreferrer\">convert</a> tools are part of ImageMagick</p>\n\n<p>The following code use <a href=\"/questions/tagged/go-github\" class=\"post-tag\" title=\"show questions tagged &#39;go-github&#39;\" rel=\"tag\">go-github</a> to fetch 50 members of an organization and check each <code>avatarURL</code> with the 2 checks above : </p>\n\n<pre><code>package main\nimport (\n    \"github.com/google/go-github/github\"\n    \"fmt\"\n    \"context\"\n    \"os/exec\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    client := github.NewClient(nil)\n    opt := &amp;github.ListMembersOptions{\n        ListOptions: github.ListOptions{PerPage: 50},\n    }\n    members, _, err := client.Organizations.ListMembers(context.Background(), \"IBM\", opt)\n    if err != nil {\n        println(err.Error())\n        return\n    }\n    max := 50\n    for i := 0; i &lt; max; i++ {\n        identify_cmd := fmt.Sprintf(\"identify -format %%k %s\",*members[i].AvatarURL)\n        cmd := exec.Command(\"bash\", \"-c\",identify_cmd)\n        stdout, err := cmd.Output()\n        if err != nil {\n            println(err.Error())\n        } else {\n            color_unique, err := strconv.Atoi(string(stdout))\n            if err != nil {\n                println(err.Error())\n            }\n            //check that the thumbnail has exactly 2 unique colors\n            if (color_unique == 2) {\n                //check that the thumbnail has F0F0F0 among those 2 colors\n                convert_cmd := fmt.Sprintf(\"convert %s -colors 2 -format \\\"%%c\\\" histogram:info: | cut -d'#' -f2 | cut -d' ' -f1\",*members[i].AvatarURL)\n                cmd := exec.Command(\"bash\",\"-c\",convert_cmd)\n                stdout, err := cmd.Output()\n                if err != nil {\n                    println(err.Error())\n                } else {\n                    colors:=strings.Split(string(stdout),\"\\n\")\n                    has_color:=false\n                    for i := 0; i &lt; len(colors); i++ {\n                        if (colors[i] == \"F0F0F0\") {\n                            has_color = true\n                            break\n                        }\n                    }\n                    if (has_color) {\n                        fmt.Printf(\"[%v/%v] user %v has not set her/his thumbnail image (%v)\\n\",i+1,max,*members[i].HTMLURL,*members[i].AvatarURL)\n                    } else {\n                        fmt.Printf(\"[%v/%v] the thumbnail for user %v has 2 unique color but none of them is F0F0F0 (%v)\\n\",i+1,max,*members[i].HTMLURL,*members[i].AvatarURL)\n                    }\n                }\n            } else {\n                fmt.Printf(\"[%v/%v] %v is not a default thumbnail\\n\",i+1,max,*members[i].AvatarURL)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Note: In order to pass URL to the tools instead of regular files, I had to edit the file under <code>/etc/ImageMagick-6/policy.xml</code> <a href=\"https://alexvanderbist.com/posts/2018/fixing-imagick-error-unauthorized\" rel=\"nofollow noreferrer\">commenting https policy</a> but you can modify the code to download the avatar image yourself if needed</p>\n"}], "owner": {"reputation": 3396, "user_id": 2090453, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/mpG1D.jpg?s=128&g=1", "display_name": "DonOfDen", "link": "https://stackoverflow.com/users/2090453/donofden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 58107713, "answer_count": 1, "score": 2, "last_activity_date": 1590477967, "creation_date": 1568022442, "last_edit_date": 1590477967, "question_id": 57851545, "link": "https://stackoverflow.com/questions/57851545/how-do-we-know-the-user-changed-profile-picture-from-default-in-github-via-api", "title": "how do we know the user changed profile picture from default in github via api", "body": "<p>I'm working on a script to audit Github. so in that process im trying to find a way to know if the GitHub user in my organization has changed their profile picture from the default profile picture.</p>\n\n<p>Im working with the <code>go-github</code> package to access Github. <a href=\"https://github.com/google/go-github/blob/ababee01b03f69965d0ec370e65b61ec7967be34/github/users.go\" rel=\"nofollow noreferrer\">https://github.com/google/go-github/blob/ababee01b03f69965d0ec370e65b61ec7967be34/github/users.go</a></p>\n\n<p>Currently, I can get the list of users from <code>ListMembers</code> method and <code>GetAvatarURL</code> gets organization users profile image. But I can't get any differentiation from default github image and the user changed image.</p>\n\n<p>Following is the default image ima talking about.</p>\n\n<p><a href=\"https://i.stack.imgur.com/378Rcs.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/378Rcs.png\" alt=\"enter image description here\"></a> </p>\n\n<p>I get the AvatarURL like \n<code>https://avatars0.githubusercontent.com/u/XXXXXX?v=4</code>\nThis is the same for default and for images uploaded by the users. only change is the host server of the images like <code>avatars1</code>, <code>avatars2</code>, <code>avatars3</code> &amp; <code>avatars4</code>.</p>\n\n<p>Is there any other way to find the difference?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1568020100, "post_id": 57850902, "comment_id": 102128500, "body": "Yes, it&#39;s possible. <a href=\"https://golang.org/pkg/io/#TeeReader\" rel=\"nofollow noreferrer\">io.TeeReader</a> will probably help you."}, {"owner": {"reputation": 24588, "user_id": 1527544, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6665878d41d42307eb53e9fae311a471?s=128&d=identicon&r=PG", "display_name": "Antoniossss", "link": "https://stackoverflow.com/users/1527544/antoniossss"}, "edited": false, "score": 2, "creation_date": 1568020108, "post_id": 57850902, "comment_id": 102128505, "body": "Abstract: Read some bytes, do the calculation regarding md5, write those bytes to file, repeat."}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1568020576, "post_id": 57850902, "comment_id": 102128730, "body": "@Flimzy Ok, I need some time to understand the idea of using io.TeeReader"}], "answers": [{"comments": [{"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "edited": false, "score": 1, "creation_date": 1568020904, "post_id": 57851095, "comment_id": 102128889, "body": "Thank you for your code. But as you can can see I use io.LimitReader to validate max file size. Actually I do not understand how to use it with io.TeeReader"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "edited": false, "score": 1, "creation_date": 1568021115, "post_id": 57851095, "comment_id": 102128994, "body": "i updated the example code. The Limit reader is to be set onto the source of data so you limit both computations and ends early the processing."}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "edited": false, "score": 1, "creation_date": 1568021604, "post_id": 57851095, "comment_id": 102129273, "body": "It is a little bit different logic. In my code if the file is over limit I won&#39;t save it (I will delete it). As I can see in your code, if the file is over limit you will save a part of the file. So I use io.LimitReader to save files which are smaller then limit (I have updated my code)"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "edited": false, "score": 2, "creation_date": 1568021892, "post_id": 57851095, "comment_id": 102129407, "body": "with a io.LimitReader setup on the source you can <b>not</b> have files written on disk larger than <code>maxSize</code>. Your logic is wrong. You should stat your files to get their sizes before proceeding further."}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "edited": false, "score": 0, "creation_date": 1568022122, "post_id": 57851095, "comment_id": 102129508, "body": "@mn-cbon Ok, Yes, you are right, I see my mistake. So my &quot;if statement&quot; will be always false?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "edited": false, "score": 0, "creation_date": 1568022191, "post_id": 57851095, "comment_id": 102129544, "body": "You have set the limitReader to <code>maxSize **+ 1**</code>. You will end up with files chunks written of max(size)=(maxSize + 1). So <code>written</code> can <b>never</b> be larger than <code>maxSize</code>"}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "edited": false, "score": 0, "creation_date": 1568022394, "post_id": 57851095, "comment_id": 102129651, "body": "Ok, I forgot about it :D Is it possible to change code to work with <code>reader = r.MultipartReader()</code> <code>reader.NextPart()</code> instead of <code>strings.NewReader()</code>? I will accept your answer"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "edited": false, "score": 0, "creation_date": 1568022685, "post_id": 57851095, "comment_id": 102129788, "body": "<code>multipart.Part</code> implements the standard <code>io.Reader</code> interface. <a href=\"https://golang.org/pkg/mime/multipart/#Part.Read\" rel=\"nofollow noreferrer\">golang.org/pkg/mime/multipart/#Part.Read</a> it should be easy to integrate that into your code."}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "edited": false, "score": 0, "creation_date": 1568123333, "post_id": 57851095, "comment_id": 102169363, "body": "It doesn&#39;t work. What should I place instead <code>os.Stdout</code> in this line  <code>io.Copy(os.Stdout, tr)</code>? I need to save it to file, but I can&#39;t as I do not know it&#39;s name"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "edited": false, "score": 0, "creation_date": 1568126601, "post_id": 57851095, "comment_id": 102171292, "body": "anything that is an io.Writer"}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 4, "last_activity_date": 1568021057, "last_edit_date": 1568021057, "creation_date": 1568020725, "answer_id": 57851095, "question_id": 57850902, "link": "https://stackoverflow.com/questions/57850902/is-it-possible-to-calculate-md5-of-the-file-and-write-file-to-the-disk-in-the-sa/57851095#57851095", "title": "Is it possible to calculate md5 of the file and write file to the disk in the same time?", "body": "<p>here is an example using io.TeeReader to perform both computation and copy at same time</p>\n\n<p><a href=\"https://play.golang.org/p/IJJQiaeTOBh\" rel=\"noreferrer\">https://play.golang.org/p/IJJQiaeTOBh</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"crypto/sha256\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"strings\"\n)\n\nfunc main() {\n\n    var s io.Reader = strings.NewReader(\"some data\")\n\n    // maxSize := 4096\n    // s = io.LimitReader(s, maxSize + 1)\n\n    h := sha256.New()\n    tr := io.TeeReader(s, h)\n    io.Copy(os.Stdout, tr)\n    fmt.Printf(\"\\n%x\", h.Sum(nil))\n\n}\n// Output:\n//some data\n//1307990e6ba5ca145eb35e99182a9bec46531bc54ddf656a602c780fa0240dee\n</code></pre>\n\n<p>And the comparison test for correctness</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ echo -n \"some data\" | sha256sum -\n1307990e6ba5ca145eb35e99182a9bec46531bc54ddf656a602c780fa0240dee  -\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "is_accepted": false, "score": 1, "last_activity_date": 1568124374, "creation_date": 1568124374, "answer_id": 57872557, "question_id": 57850902, "link": "https://stackoverflow.com/questions/57850902/is-it-possible-to-calculate-md5-of-the-file-and-write-file-to-the-disk-in-the-sa/57872557#57872557", "title": "Is it possible to calculate md5 of the file and write file to the disk in the same time?", "body": "<p>Instead of using <code>io.TeeReader</code> I have used <code>io.MultiWriter</code> to create 2 buffers (I will use the first buffer to calculate md5 and the second to write to a file with md5 name)</p>\n\n<pre><code>lmt := io.LimitReader(buf, maxSize + 1)\n\nhash := md5.New()\n\nvar buf1, buf2 bytes.Buffer\nw := io.MultiWriter(&amp;buf1, &amp;buf2)\n\nif _, err := io.Copy(w, lmt); err != nil {\n    log.Fatal(err)\n}\nif _, err := io.Copy(hash, &amp;buf1); err != nil {\n    log.Fatal(err)\n}\n\nfmt.Println(\"md5 is: \", hex.EncodeToString(hash.Sum(nil)))\n\n// Now we can create file with os.Openfile passing md5 name as an argument + write &amp;buf2 to this file\n</code></pre>\n"}], "owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1568124374, "creation_date": 1568019987, "last_edit_date": 1568021628, "question_id": 57850902, "link": "https://stackoverflow.com/questions/57850902/is-it-possible-to-calculate-md5-of-the-file-and-write-file-to-the-disk-in-the-sa", "title": "Is it possible to calculate md5 of the file and write file to the disk in the same time?", "body": "<p>I write a file uploader with Go. I would like to have md5 of the file as a file name when I save it to the disk.</p>\n\n<p>What is the best way to solve this problem?</p>\n\n<p>I save a file this way:</p>\n\n<pre><code>reader, _ := r.MultipartReader()\np, _ := reader.NextPart()\n\nf, _ := os.Create(\"./filename\") // here I need md5 as a file name\ndefer f.Close()\n\nlmt := io.LimitReader(p, maxSize + 1)\nwritten, _ := io.Copy(f, lmt)\nif written &gt; maxSize {\n    os.Remove(f.Name())\n}\n</code></pre>\n"}, {"tags": ["go", "thrift"], "comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1568054564, "post_id": 57850778, "comment_id": 102145341, "body": "Where is the handler?"}, {"owner": {"reputation": 1, "user_id": 12040584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e589c59df056f074eda0a0d237b1f1af?s=128&d=identicon&r=PG&f=1", "display_name": "hnxydq", "link": "https://stackoverflow.com/users/12040584/hnxydq"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1568079288, "post_id": 57850778, "comment_id": 102151772, "body": "Added some code of handler above. The handler is just the implementation of  the interface."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1568127078, "post_id": 57850778, "comment_id": 102171545, "body": "I guess I can&#39;t help here. Usually I would expect some kind of connection in a handler to get the IP from. But I haven&#39;t worked with thrift and it seems to work differently."}, {"owner": {"reputation": 12067, "user_id": 499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc0612ec9a2b6af96500cc6e4bfdc7c?s=128&d=identicon&r=PG", "display_name": "JensG", "link": "https://stackoverflow.com/users/499466/jensg"}, "edited": false, "score": 0, "creation_date": 1568242898, "post_id": 57850778, "comment_id": 102216395, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/44962798/how-to-get-clients-ip-in-a-golang-thrift-server\">How to get client&#39;s IP in a golang thrift server</a>"}, {"owner": {"reputation": 12067, "user_id": 499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc0612ec9a2b6af96500cc6e4bfdc7c?s=128&d=identicon&r=PG", "display_name": "JensG", "link": "https://stackoverflow.com/users/499466/jensg"}, "edited": false, "score": 0, "creation_date": 1568242931, "post_id": 57850778, "comment_id": 102216404, "body": "BTW, Thrift 0.10.0 is not the most recent version."}], "owner": {"reputation": 1, "user_id": 12040584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e589c59df056f074eda0a0d237b1f1af?s=128&d=identicon&r=PG&f=1", "display_name": "hnxydq", "link": "https://stackoverflow.com/users/12040584/hnxydq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 123, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1568079089, "creation_date": 1568019514, "last_edit_date": 1568079089, "question_id": 57850778, "link": "https://stackoverflow.com/questions/57850778/how-to-get-client-ip-from-thrift-server-in-go-thrift-version-0-10-0", "title": "How to get client IP from Thrift Server in Go, thrift version 0.10.0?", "body": "<p>I'm writing a thrift service in Golang and I would like to understand how I can get the client's IP address in the handler functions implementation.</p>\n\n<p>I have tried it in Java, which can be obtained by overwrite TProcessor#process(in,out), but it seems that this way doesn't work in Golang.</p>\n\n<pre><code>serverTransport, err := thrift.NewTServerSocket(net.JoinHostPort(ip, strconv.FormatInt(port, 10)))\n    //serverTransport, err := thrift.NewTServerSocket(net.JoinHostPort(\"127.0.0.1\", \"9999\"))\n    if err != nil {\n        log.Error(err.Error())\n        os.Exit(1)\n    }\n    protocolFactory := thrift.NewTCompactProtocolFactory()\n    transportFactory := thrift.NewTFramedTransportFactoryMaxLength(thrift.NewTTransportFactory(), 524288000) \n\n    processor := iface.NewNMPDataServiceProcessor(new(impl.NMPDataService))\n\n    server := thrift.NewTSimpleServer4(processor, serverTransport, transportFactory, protocolFactory)\n    server.Serve()\n\n    defer server.Stop()\n</code></pre>\n\n<p>The Handler implementation of NMPDataService interface\uff1a</p>\n\n<pre><code>package impl\n\nimport (\n    \"NMPService/Framework/logger\"\n    \"NMPService/NmpService/thrift/iface\"\n    \"NMPService/NmpService/utils\"\n    \"syscall\"\n    \"errors\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"os\"\n    \"path/filepath\"\n    \"regexp\"\n    \"strconv\"\n    \"strings\"\n    \"time\"\n\n    \"github.com/yeka/zip\"\n)\n\nvar log = logger.GetBeeLogger()\n\n// NMPDataService .\ntype NMPDataService struct {\n}\n\nconst (\n    // MaxDownloadFileLimit ...\n    MaxDownloadFileLimit int64 = 15728640\n    TempFolder string = \"tmp\"\n)\n\n// ExistsFolder method\n// Parameters:\n//  - Path\nfunc (handler *NMPDataService) ExistsFolder(path string) (bool, error) {\n    log.Info(\"Check exist folder, path: %s\", path)\n    if strings.Contains(path, \"\\\\\") {\n        path = strings.ReplaceAll(path, \"\\\\\", \"/\")\n    }\n    fileInfo, err := os.Stat(path)\n    if os.IsNotExist(err) {\n        log.Error(\"folder %s not exist\", path)\n        return false, nil\n    }\n\n    if !fileInfo.IsDir() {\n        msg := \"the path is not folder.\"\n        log.Error(msg)\n        return false, NewRPCException(1, msg, errors.New(msg))\n    }\n\n    if err != nil {\n        log.Error(\"Check exist folder error.\")\n        return false, NewRPCException(1, \"Check exist folder error\", err)\n    }\n\n    return true, nil\n}\n\n</code></pre>\n\n<p>Above is my code on Server side. I want to get client IP information from server.</p>\n"}, {"tags": ["go", "logging", "thread-safety"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1568017927, "post_id": 57850353, "comment_id": 102127439, "body": "<a href=\"https://github.com/sirupsen/logrus#thread-safety\" rel=\"nofollow noreferrer\">github.com/sirupsen/logrus#thread-safety</a>"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1568018904, "creation_date": 1568018904, "answer_id": 57850606, "question_id": 57850353, "link": "https://stackoverflow.com/questions/57850353/is-redirecting-standard-library-log-to-logrus-thread-safe/57850606#57850606", "title": "is redirecting standard library log to logrus thread safe", "body": "<p>Is Logrus Thread-safe?</p>\n\n<p><a href=\"https://github.com/sirupsen/logrus#thread-safety\" rel=\"nofollow noreferrer\">Yes</a>:</p>\n\n<blockquote>\n  <h2>Thread safety</h2>\n  \n  <p>By default, Logger is protected by a mutex for concurrent writes.</p>\n</blockquote>\n\n<p>Except <a href=\"https://github.com/sirupsen/logrus/issues?utf8=%E2%9C%93&amp;q=is%3Aissue+is%3Aopen+race\" rel=\"nofollow noreferrer\">when it isn't</a>.</p>\n\n<p>Most of the non-thread-safe cases are bugs which will occur only in rare situations. Whether any of them matter to you depends, of course, on your use case.</p>\n"}], "owner": {"reputation": 63, "user_id": 3091282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ad5c29b4ad1c6ada40a27c06084b1a8?s=128&d=identicon&r=PG&f=1", "display_name": "Yogesh", "link": "https://stackoverflow.com/users/3091282/yogesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 441, "favorite_count": 0, "accepted_answer_id": 57850606, "answer_count": 1, "score": 1, "last_activity_date": 1568018904, "creation_date": 1568017813, "question_id": 57850353, "link": "https://stackoverflow.com/questions/57850353/is-redirecting-standard-library-log-to-logrus-thread-safe", "title": "is redirecting standard library log to logrus thread safe", "body": "<p>I am using <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">logrus</a> library for structured logging in my Go project.</p>\n\n<p>I have configured my logrus as below:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\n// Global variable for logging\nvar gLog = &amp;Logger{moduleName: ModuleName, logrus: logrus.New()}\n\ntype Logger struct {\n    moduleName string\n    logrus     *logrus.Logger\n}\n\nfunc SetupGlobalLogger(logPrefix string, logMode string) error {\n    if logMode == \"file\" {\n        logFilePath := fmt.Sprintf(\"var/%s.log\", vite.Environment())\n\n        file, err := os.OpenFile(logFilePath, logFileFlags, logFilePermission)\n        if err != nil {\n            return err\n        }\n        gLog.logrus.SetOutput(file)\n\n        // redirect logs written using standard log library to same place as logrus\n        log.SetOutput(gLog.logrus.Writer())\n\n        log.Println(vite.MarkInfo, \"redirect log to file:\", logFilePath)\n    }\n\n    return nil\n}\n\n</code></pre>\n\n<p>In this Go project, there are several places where standard log library statements like <code>log.Println()</code> are used.</p>\n\n<p>I want to redirect those log messages to logrus.</p>\n\n<p>For that I am using following statement in above code.</p>\n\n<pre><code>log.SetOutput(gLog.logrus.Writer())\n</code></pre>\n\n<p>My question is: Is this thread safe?</p>\n\n<p>If one thread/go-routine is executing log.Println() while another executing gLog.logrus.Info() or something on logrus, will that be fine?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "is_accepted": false, "score": 2, "last_activity_date": 1568010462, "creation_date": 1568010462, "answer_id": 57848810, "question_id": 57848630, "link": "https://stackoverflow.com/questions/57848630/unable-to-convert-my-string-to-hex-message/57848810#57848810", "title": "Unable to convert my string to hex message", "body": "<p>You cannot build a string from a byte sequence that way... <code>\\x01</code> is an escaping notation processed by the compiler when reading literal strings, you cannot use that processing at runtime.</p>\n\n<p>To build a string with the bytes you want you can simply use</p>\n\n<pre><code>x := string([]byte{1, 2, 3, 4})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 75, "user_id": 5248496, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-eUeIwoVXr0o/AAAAAAAAAAI/AAAAAAAABnk/7NA1Tq0ICcE/photo.jpg?sz=128", "display_name": "Rajesh S", "link": "https://stackoverflow.com/users/5248496/rajesh-s"}, "is_accepted": false, "score": 5, "last_activity_date": 1568012676, "creation_date": 1568012676, "answer_id": 57849233, "question_id": 57848630, "link": "https://stackoverflow.com/questions/57848630/unable-to-convert-my-string-to-hex-message/57849233#57849233", "title": "Unable to convert my string to hex message", "body": "<p>This is what i wanted - got my issue resolved ! :) Thanks all</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"encoding/hex\"\n)\n\nfunc main() {\n    //Expected string\n    x := \"\\x01\"\n    //Trying to convert my 01 in string form to same as above - Basically recreate above string again\n    y,err :=  hex.DecodeString(\"01\")\n    if err != nil {\n            panic(err)\n    }\n    fmt.Println(x)\n    fmt.Println(y)\n    fmt.Println([]byte(x))\n    fmt.Println([]byte(y))\n}\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 5248496, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-eUeIwoVXr0o/AAAAAAAAAAI/AAAAAAAABnk/7NA1Tq0ICcE/photo.jpg?sz=128", "display_name": "Rajesh S", "link": "https://stackoverflow.com/users/5248496/rajesh-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1568016450, "creation_date": 1568009278, "last_edit_date": 1568016450, "question_id": 57848630, "link": "https://stackoverflow.com/questions/57848630/unable-to-convert-my-string-to-hex-message", "title": "Unable to convert my string to hex message", "body": "<p>Below has x which is my expected string\nI am trying to recreate <code>y</code> myself to match my expected string. Basically trying to convert <code>\"01\"</code> to <code>\"\\x01\"</code> so that I get the same byte when printed.</p>\n\n<p>Now when I print <code>[]byte(x)</code> and <code>[]byte(y)</code> I want them to be the same but they aren't. Please help me recreate <code>x</code> with <code>\"01\"</code> as my input.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    //Expected string\n    x := \"\\x01\"\n    //Trying to convert my 01 in string form to same as above - Basically recreate above string again\n    y := \"\\\\x\" + \"01\"\n    fmt.Println(x)\n    fmt.Println(y)\n    fmt.Println([]byte(x))\n    fmt.Println([]byte(y))\n}\n</code></pre>\n"}, {"tags": ["unit-testing", "go", "testify"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568009723, "post_id": 57848372, "comment_id": 102124199, "body": "Before you fix this error, you need to seriously start closing the returned <code>*sql.Rows</code> object. Please see <code>database&#47;sql</code> documentation on how to properly use that type of result. If you don&#39;t do it, your program will keep crashing because of too-many-connections open."}], "answers": [{"comments": [{"owner": {"reputation": 1935, "user_id": 2546381, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/51a638830d4743d0f4834f000df2cf63?s=128&d=identicon&r=PG&f=1", "display_name": "VanagaS", "link": "https://stackoverflow.com/users/2546381/vanagas"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 1, "creation_date": 1581944472, "post_id": 57848691, "comment_id": 106594988, "body": "@TehSphinX, its correct to remove <code>t *testing.T</code> from argument. The user is using package &quot;suite&quot; in which, we do not need to send the &quot;<code>t *testing.T</code>&quot; parameter as<code>go test</code> doesn&#39;t run this test function <code>TestGetArticleService</code> directly, but &quot;<code>suite</code>&quot; will. To get the testing context, one needs to use suite.T() within the function."}, {"owner": {"reputation": 163, "user_id": 1789670, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/SwNnM.jpg?s=128&g=1", "display_name": "marti_", "link": "https://stackoverflow.com/users/1789670/marti"}, "edited": false, "score": 0, "creation_date": 1582839949, "post_id": 57848691, "comment_id": 106925592, "body": "you must use T() from suite"}], "tags": [], "owner": {"reputation": 181, "user_id": 11961623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdc708b456c938a06985dcb7acab1f0b?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v3", "link": "https://stackoverflow.com/users/11961623/jpskgc-v3"}, "is_accepted": false, "score": 10, "last_activity_date": 1568009664, "creation_date": 1568009664, "answer_id": 57848691, "question_id": 57848372, "link": "https://stackoverflow.com/questions/57848372/error-suite-go61-test-panicked-reflect-call-with-too-few-input-arguments/57848691#57848691", "title": "Error: suite.go:61: test panicked: reflect: Call with too few input arguments", "body": "<p>It's resolved by removing <code>t *testing.T</code> from aurgument.</p>\n\n<pre><code>func (s *ServiceSuite) TestGetArticleService() {\n// some code\n}\n</code></pre>\n"}], "owner": {"reputation": 181, "user_id": 11961623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdc708b456c938a06985dcb7acab1f0b?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v3", "link": "https://stackoverflow.com/users/11961623/jpskgc-v3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1464, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1568009664, "creation_date": 1568007424, "question_id": 57848372, "link": "https://stackoverflow.com/questions/57848372/error-suite-go61-test-panicked-reflect-call-with-too-few-input-arguments", "title": "Error: suite.go:61: test panicked: reflect: Call with too few input arguments", "body": "<p>I'm setting unit test in <code>golang</code>.<br>\nBut now I'm facing error when running <code>go test -v</code>.<br> \nI want to resolve this error and make test success.<br></p>\n\n<pre><code>article\n  \u251c client\n  \u251c api\n  \u2502  \u251c main.go\n  \u2502  \u251c contoroller\n  \u2502  \u2502    \u251c contoroller.go\n  \u2502  \u2502    \u2514 contoroller_test.go\n  \u2502  \u251c service\n  \u2502  \u2502    \u251c service.go\n  \u2502  \u2502    \u2514 service_test.go\n  \u2502  \u251c dao\n  \u2502  \u2502    \u251c dao.go\n  \u2502  \u2502    \u2514 dao_test.go\n  \u2502  \u251c s3\n  \u2502  \u2502    \u251c s3.go\n  \u2502  \u2502    \u2514 s3_test.go\n  \u2502  \u251c go.mod \n  \u2502  \u251c go.sum\n  \u2502  \u2514 Dockerfile\n  \u251c nginx\n  \u2514 docker-compose.yml\n</code></pre>\n\n<p>Now I'm setting <code>service_test.go</code> for <code>service.go</code>.<br></p>\n\n<p>service_test.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package service\n\n// import\n\ntype MockDaoInterface struct {\n}\n\nfunc (_m *MockDaoInterface) GetArticleDao() *sql.Rows {\n    db, mock, _ := sqlmock.New()\n    mockRows := mock.NewRows([]string{\"id\", \"uuid\", \"title\", \"content\"}).\n        AddRow(1, \"bea1b24d-0627-4ea0-aa2b-8af4c6c2a41c\", \"test\", \"test\").\n        AddRow(2, \"844bc620-7336-41a3-9cb4-552a0024ff1c\", \"test2\", \"test2\")\n    mock.ExpectQuery(\"select\").WillReturnRows(mockRows)\n    rows, _ := db.Query(\"select\")\n    return rows\n}\n\n\ntype ServiceSuite struct {\n    suite.Suite\n    service *Service\n    dao     dao.DaoInterface\n}\n\nfunc (s *ServiceSuite) SetupTest() {\n    s.service = NewService(s.dao)\n    s.service.dao = &amp;MockDaoInterface{}\n}\n\nfunc (s *ServiceSuite) TestGetArticleService(t *testing.T) {\n\n    articles := s.service.GetArticleService()\n\n    var expectedArticles []util.Article\n\n    expectedArticle1 := util.Article{\n        ID:      1,\n        UUID:    \"bea1b24d-0627-4ea0-aa2b-8af4c6c2a41c\",\n        TITLE:   \"test\",\n        CONTENT: \"test\",\n    }\n    expectedArticles = append(expectedArticles, expectedArticle1)\n\n    expectedArticle2 := util.Article{\n        ID:      2,\n        UUID:    \"844bc620-7336-41a3-9cb4-552a0024ff1c\",\n        TITLE:   \"test2\",\n        CONTENT: \"test2\",\n    }\n    expectedArticles = append(expectedArticles, expectedArticle2)\n\n    assert.Equal(s.T(), expectedArticles, articles)\n}\n\nfunc TestServiceSuite(t *testing.T) {\n    suite.Run(t, new(ServiceSuite))\n}\n\n</code></pre>\n\n<p>service.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package service\n\n// import \n\ntype Service struct {\n    dao dao.DaoInterface\n}\n\nfunc NewService(dao dao.DaoInterface) *Service {\n    return &amp;Service{dao: dao}\n}\n\nfunc (s Service) GetArticleService() []util.Article {\n    var articles []util.Article\n\n    results := s.dao.GetArticleDao()\n\n    article := util.Article{}\n    for results.Next() {\n        err := results.Scan(&amp;article.ID, &amp;article.UUID, &amp;article.TITLE, &amp;article.CONTENT)\n        if err != nil {\n            panic(err.Error())\n        } else {\n            articles = append(articles, article)\n        }\n    }\n    return articles\n}\n</code></pre>\n\n<p>dao.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package dao\n\n// import\n\ntype Dao struct {\n    database *sql.DB\n    s3       s3.S3Interface\n}\n\nfunc NewDao(database *sql.DB, s3 s3.S3Interface) *Dao {\n    objs := &amp;Dao{database: database, s3: s3}\n    return objs\n}\n\ntype DaoInterface interface {\n    GetArticleDao() *sql.Rows\n}\n</code></pre>\n\n<p>Here is the full source code(branch: go-test-service)<br>\n<a href=\"https://github.com/jpskgc/article/tree/go-test-service\" rel=\"nofollow noreferrer\">https://github.com/jpskgc/article/tree/go-test-service</a></p>\n\n<p>I expect <code>service_test.go</code> to success test.<br>\nBut the actual is it fails with error.<br>\nI want to resolve this error and to success test.<br></p>\n\n<pre><code>$ go test -v\n=== RUN   TestServiceSuite\n=== RUN   TestServiceSuite/TestGetArticleService\n--- FAIL: TestServiceSuite (0.00s)\n    --- FAIL: TestServiceSuite/TestGetArticleService (0.00s)\n        suite.go:61: test panicked: reflect: Call with too few input arguments\nFAIL\nexit status 1\nFAIL    article/api/service     0.045s\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1567997044, "post_id": 57847242, "comment_id": 102121642, "body": "There is no broadcast or pub/sub in grpc. You have to keep a list of all connected clients. Each client connection will create a separate stream on the server. If you have data for one of the subscribers, you have to keep a map of all active subscribers, and write the data to the stream for the subscriber."}, {"owner": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1568001447, "post_id": 57847242, "comment_id": 102122349, "body": "@bserdar Do you any exist similar code for demo this concept?"}, {"owner": {"reputation": 2274, "user_id": 7567579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ab9644beeb1d324d1247b2951d28927?s=128&d=identicon&r=PG", "display_name": "Emin Laletovic", "link": "https://stackoverflow.com/users/7567579/emin-laletovic"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1568028687, "post_id": 57847242, "comment_id": 102132507, "body": "just search for the <b>observer pattern</b>, there&#39;s a lot of code and articles out there describing it. It pretty much covers what @bserdar described."}], "owner": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 319, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1567996720, "creation_date": 1567996720, "question_id": 57847242, "link": "https://stackoverflow.com/questions/57847242/whats-proper-method-for-broadcast-in-go-grpc", "title": "What&#39;s proper method for broadcast in Go grpc?", "body": "<p>I'm trying to write a tcp server and multiple tcp clients.\nThe tcp server is use grpc stream to send to all tcp client.\nMy current solution is:\nOn the grpc client code, just connect to the grpc stream.\nOn the grpc stream server code::</p>\n\n<pre><code>func (s *rpcServer) DataStream(req *pb.SearchRequest, stream pb.SearchService_DataStreamServer) error {\n  for {\n    if data, ok := myMapData[req.ID]; ok {\n      stream.Send(data)\n    }\n    time.Sleep(time.Second)\n  }\n}\n</code></pre>\n\n<p>This method is based on period time update.  Is there better method if I create new data for some subscriber, then just send them?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 3, "creation_date": 1567989131, "post_id": 57846408, "comment_id": 102120522, "body": "There appears to be a Set.ToSlice() method that returns an []interface{}, however that is not a []string. You have to convert that slice to a string slice yourself. Or, you can use Set.Iterator(), iterate through the elements and build the string yourself."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1567996996, "post_id": 57846408, "comment_id": 102121632, "body": "Is there a requirement to use the mapset package?  If not, how about <a href=\"https://play.golang.org/p/bDUj2CfGEyy\" rel=\"nofollow noreferrer\">play.golang.org/p/bDUj2CfGEyy</a>?"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1568056038, "last_edit_date": 1568056038, "creation_date": 1568038252, "answer_id": 57855751, "question_id": 57846408, "link": "https://stackoverflow.com/questions/57846408/how-to-make-a-slice-from-a-mapset-set/57855751#57855751", "title": "How to make a slice from a mapset.Set?", "body": "<p>The XY problem is asking about your attempted solution rather than your actual problem: <a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">The XY Problem</a>.</p>\n\n<hr>\n\n<p><a href=\"http://www.gopl.io/\" rel=\"nofollow noreferrer\">The Go Programming Language by Alan A. A. Donovan and Brian W. Kernighan</a>, Exercise 1.4 is designed to use Go maps. </p>\n\n<p>For example,</p>\n\n<pre><code>// Modify dup3 to print the names of all files in which each duplicated line occurs.\npackage main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"strings\"\n)\n\nfunc main() {\n    // counts = [line][file]count\n    counts := make(map[string]map[string]int)\n    for _, filename := range os.Args[1:] {\n        data, err := ioutil.ReadFile(filename)\n        if err != nil {\n            fmt.Fprintf(os.Stderr, \"Exercise 1.4: %v\\n\", err)\n            continue\n        }\n        for _, line := range strings.Split(string(data), \"\\n\") {\n            files := counts[line]\n            if files == nil {\n                files = make(map[string]int)\n                counts[line] = files\n            }\n            files[filename]++\n        }\n    }\n    for line, files := range counts {\n        n := 0\n        for _, count := range files {\n            n += count\n        }\n        if n &gt; 1 {\n            fmt.Printf(\"%d\\t%s\\n\", n, line)\n            for name := range files {\n                fmt.Printf(\"%s\\n\", name)\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 1, "accepted_answer_id": 57855751, "answer_count": 1, "score": 1, "last_activity_date": 1568056038, "creation_date": 1567984313, "question_id": 57846408, "link": "https://stackoverflow.com/questions/57846408/how-to-make-a-slice-from-a-mapset-set", "title": "How to make a slice from a mapset.Set?", "body": "<p>I'm reading Donovan's \"The Go Programming Language\" book and trying to implement an exercise which prints duplicate lines from several files and the files in which they occur:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"strings\"\n\n    mapset \"github.com/deckarep/golang-set\"\n)\n\nfunc main() {\n    counts := make(map[string]int)\n    occurrences := make(map[string]mapset.Set)\n    for _, filename := range os.Args[1:] {\n        data, err := ioutil.ReadFile(filename)\n        if err != nil {\n            fmt.Fprintf(os.Stderr, \"dup3: %v\\n\", err)\n            continue\n        }\n        for _, line := range strings.Split(string(data), \"\\n\") {\n            counts[line]++\n            occurrences[line].Add(filename)\n        }\n    }\n    for line, n := range counts {\n        if n &gt; 1 {\n            fmt.Printf(\"%d\\t%s\\t%s\\n\", n, line, strings.Join(occurrences[line], \", \"))\n        }\n    }\n}\n</code></pre>\n\n<p>To accomplish the exercise, I've used the <a href=\"https://godoc.org/github.com/deckarep/golang-set\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/deckarep/golang-set</a> package. However, I'm not sure how to print out the elements of the set joined by a \", \". With this code, I get a</p>\n\n<pre><code>./hello.go:23:30: first argument to append must be slice; have interface { Add(interface {}) bool; Cardinality() int; CartesianProduct(mapset.Set) mapset.Set; Clear(); Clone() mapset.Set; Contains(...interface {}) bool; Difference(mapset.Set) mapset.Set; Each(func(interface {}) bool); Equal(mapset.Set) bool; Intersect(mapset.Set) mapset.Set; IsProperSubset(mapset.Set) bool; IsProperSuperset(mapset.Set) bool; IsSubset(mapset.Set) bool; IsSuperset(mapset.Set) bool; Iter() &lt;-chan interface {}; Iterator() *mapset.Iterator; Pop() interface {}; PowerSet() mapset.Set; Remove(interface {}); String() string; SymmetricDifference(mapset.Set) mapset.Set; ToSlice() []interface {}; Union(mapset.Set) mapset.Set }\n./hello.go:28:64: cannot use occurrences[line] (type mapset.Set) as type []string in argument to strings.Join\n</code></pre>\n\n<p>I wasn't able to easily find out how to convert the <code>Set</code> to a slice though. Any idea how I might accomplish this?</p>\n"}, {"tags": ["postgresql", "go", "pq"], "answers": [{"comments": [{"owner": {"reputation": 5931, "user_id": 1354934, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6428552a6061416e628aaef84edfd425?s=128&d=identicon&r=PG", "display_name": "user1354934", "link": "https://stackoverflow.com/users/1354934/user1354934"}, "edited": false, "score": 0, "creation_date": 1567982870, "post_id": 57846287, "comment_id": 102119746, "body": "Right.  I am wondering why the <code>Column</code> is an empty string.  If I could just get the <code>Column</code> without having to parse the <code>Detail</code> to grab the field name, then that would be preferable.  Am I doing something wrong that the <code>Column</code> is empty?"}, {"owner": {"reputation": 1485, "user_id": 12022565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c2c8a3b0ce2375f236807e8cf806043?s=128&d=identicon&r=PG&f=1", "display_name": "Islingre", "link": "https://stackoverflow.com/users/12022565/islingre"}, "reply_to_user": {"reputation": 5931, "user_id": 1354934, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6428552a6061416e628aaef84edfd425?s=128&d=identicon&r=PG", "display_name": "user1354934", "link": "https://stackoverflow.com/users/1354934/user1354934"}, "edited": false, "score": 0, "creation_date": 1567983223, "post_id": 57846287, "comment_id": 102119794, "body": "I guess <code>Column</code> is empty, because the unique constraint might affect multiple columns. <code>Constraint</code> offers the constraint name, in combination with <code>Schema</code> and <code>Table</code> you can loo up this constraint in <code>pg_constraint</code>. Field <code>conkey</code> might hold the references to the covered attributes."}, {"owner": {"reputation": 125670, "user_id": 6464308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/12PVX.jpg?s=128&g=1", "display_name": "Laurenz Albe", "link": "https://stackoverflow.com/users/6464308/laurenz-albe"}, "edited": false, "score": 0, "creation_date": 1568008539, "post_id": 57846287, "comment_id": 102123826, "body": "You mean that <code>conkey</code> <i>will</i> hold the references to the columns."}], "tags": [], "owner": {"reputation": 1485, "user_id": 12022565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c2c8a3b0ce2375f236807e8cf806043?s=128&d=identicon&r=PG&f=1", "display_name": "Islingre", "link": "https://stackoverflow.com/users/12022565/islingre"}, "is_accepted": false, "score": 2, "last_activity_date": 1567983417, "last_edit_date": 1567983417, "creation_date": 1567982715, "answer_id": 57846287, "question_id": 57846270, "link": "https://stackoverflow.com/questions/57846270/how-to-get-column-name-for-a-unique-constraint-violation/57846287#57846287", "title": "How to get column name for a unique_constraint violation?", "body": "<p>The specific error message (including the violated constraint and column/value) is in the field <code>Detail</code>.</p>\n\n<p><strong>EDIT</strong>:</p>\n\n<p>I guess <code>Column</code> is empty, because the unique constraint might affect multiple columns. <code>Constraint</code> offers the constraint name, in combination with <code>Schema</code> and <code>Table</code> you can look up this constraint in <code>pg_constraint</code>. Field <code>conkey</code> might hold the references to the covered attributes.</p>\n"}], "owner": {"reputation": 5931, "user_id": 1354934, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6428552a6061416e628aaef84edfd425?s=128&d=identicon&r=PG", "display_name": "user1354934", "link": "https://stackoverflow.com/users/1354934/user1354934"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1567983417, "creation_date": 1567982520, "last_edit_date": 1567982924, "question_id": 57846270, "link": "https://stackoverflow.com/questions/57846270/how-to-get-column-name-for-a-unique-constraint-violation", "title": "How to get column name for a unique_constraint violation?", "body": "<p>I am using the pq driver and I'm wondering why the pq.Error gives an empty Column when I face a unique constraint violation.</p>\n\n<p>I could parse <code>Detail</code> but is there any reason why <code>Column</code> would be empty?  It would be preferable if I could just get <code>email</code> from <code>Column</code> instead of parsing <code>Detail</code></p>\n\n<p>Here is what the error looks like:</p>\n\n<pre><code>Severity:\"ERROR\"\nCode:\"23505\"\nMessage:\"duplicate key value violates unique constraint \"unique_users\"\"\nDetail:\"Key (email)=(user3@email.com) already exists.\"\nHint:\"\"\nPosition:\"\"\nInternalPosition:\"\"\nInternalQuery:\"\"\nWhere:\"\"\nSchema:\"public\"\nTable:\"users\"\nColumn:\"\"\nDataTypeName:\"\"\nConstraint:\"unique_users\"\nFile:\"nbtinsert.c\"\nLine:\"534\"\nRoutine:\"_bt_check_unique\"\n</code></pre>\n\n<p>Unfortunately, the <code>Column</code> value is empty.  I'm trying to come up with error messaging for my application and I'm wondering if there is some way to get that information so I can enhance the message why the entity was not created and let the caller know the field (<code>email</code> in this case) as well.</p>\n"}, {"tags": ["macos", "go", "webstorm", "goland"], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 2, "last_activity_date": 1568006029, "creation_date": 1568006029, "answer_id": 57848185, "question_id": 57846169, "link": "https://stackoverflow.com/questions/57846169/intelijidea-goland-uses-private-var-folders/57848185#57848185", "title": "IntelijIDEA (Goland) uses /private/var/folders/", "body": "<blockquote>\n  <p>I know that os.Args[0] is the path to my program, but can I do os.Args[0] to be my working directory in Goland runner?</p>\n</blockquote>\n\n<p>No, you cannot make <code>os.Args[0]</code> to be the working directory, since as you correctly identified, it's used to locate your program on disk.</p>\n\n<p>There are two changes you can make:</p>\n\n<ul>\n<li>change your code to stop relying on <code>os.Args[0]</code> and start using <code>os.Getwd()</code> to get the working directory. Then you can edit your <code>Run Configuration</code> via <code>Run | Edit Configurations... | &lt;name of the run configuration&gt; | Working Directory</code> parameter.</li>\n<li>if you really want you binary to be in a certain directory, then you can go to <code>Run | Edit Configurations... | &lt;name of the run configuration&gt; | Output directory</code> to have the IDE run the compiler and place the executable wherever you need to.</li>\n</ul>\n\n<p>If you need to make these changes for all future Run Configurations, then edit <code>Run | Edit Configurations... | Templates | Go Build</code>, or <code>Go Test</code> and change either the <code>Working Directory</code> or the <code>Output Directory</code> fields. Existing <code>Run Configurations</code> will not be changed.</p>\n"}], "owner": {"reputation": 11, "user_id": 10533568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40e0945220bbbd49249c2aea4148882f?s=128&d=identicon&r=PG&f=1", "display_name": "KUKU", "link": "https://stackoverflow.com/users/10533568/kuku"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568006029, "creation_date": 1567981351, "question_id": 57846169, "link": "https://stackoverflow.com/questions/57846169/intelijidea-goland-uses-private-var-folders", "title": "IntelijIDEA (Goland) uses /private/var/folders/", "body": "<p>My Goland's runner (run/debug configurations) uses /private/var/folders/7b/50mzg8x17q55rxfg3b0kpj88xcm2lx/T in <code>os.Args[0]</code>. I know that <code>os.Args[0]</code> is the path to my program, but can I do <code>os.Args[0]</code> to be my working directory in Goland runner?</p>\n\n<p>P.S. Working directory in Edit configurations set properly</p>\n"}, {"tags": ["javascript", "jquery", "ajax", "go"], "comments": [{"owner": {"reputation": 10321, "user_id": 215552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26bda02894d869c95f620de4b7cd386d?s=128&d=identicon&r=PG", "display_name": "Heretic Monkey", "link": "https://stackoverflow.com/users/215552/heretic-monkey"}, "edited": false, "score": 1, "creation_date": 1567977843, "post_id": 57845548, "comment_id": 102118951, "body": "Submitting a form necessarily causes the browser to send something to the server, clearing what&#39;s on the page. Since your <code>form</code> has no <code>action</code> it submits the form to the current URL, and reloads the page. You had the right idea with <code>e.preventDefault()</code>, but of course that prevents submission of the form. You may want to <a href=\"https://developer.mozilla.org/en-US/docs/Learn/HTML/Forms/Sending_and_retrieving_form_data\" rel=\"nofollow noreferrer\">read up on what happens when you submit a form</a>."}], "answers": [{"comments": [{"owner": {"reputation": 239, "user_id": 4741225, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sVtzl.png?s=128&g=1", "display_name": "Alin", "link": "https://stackoverflow.com/users/4741225/alin"}, "edited": false, "score": 0, "creation_date": 1568020038, "post_id": 57845800, "comment_id": 102128464, "body": "+1. You have understood the issue well. If I have understood well, by deleting <code>display: none</code> then the result will be shown in the same page below the form (even before there is any result = before the form filled). It is not the thing I am looking for. I want data be shown in a new page."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 239, "user_id": 4741225, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sVtzl.png?s=128&g=1", "display_name": "Alin", "link": "https://stackoverflow.com/users/4741225/alin"}, "edited": false, "score": 1, "creation_date": 1568037655, "post_id": 57845800, "comment_id": 102137391, "body": "Then organize your template so that it either displays the form, or the results, depending on a flag, say, resultFlag. You can have {{if .resultFlag}} &lt;resultsSection&gt; {{else}} &lt;formSection{{end}} in your template, and have it generate two different pages based on state"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1567977231, "creation_date": 1567977231, "answer_id": 57845800, "question_id": 57845548, "link": "https://stackoverflow.com/questions/57845548/hide-an-element-and-show-another-element-on-submit-a-form/57845800#57845800", "title": "Hide an element and show another element on submit a form", "body": "<p>I may be totally off here, because I don't think I understand your problem completely, however it looks like  you're trying to submit this form, and then display the results section without the form. I'm guessing your Go server is somehow preparing these results based on the form values.</p>\n\n<p>If that is really the case, then what's happening is that you submit the form, your javascript hides the form and shows the empty results section, then your server prepares the results, and you display the form again. This time though, it is a completely new page and, it has no knowledge of the Javascript executed before form submission. It is a fresh new page, so it'll show the empty form, and not the results section.</p>\n\n<p>If what I understand is correct, then what you should do is to change your template so that it knows it is displaying the results, so it builds the result section without <code>display: none</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 81, "user_id": 10050825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7feaeadff9da974cce1e2dedc3edcd9d?s=128&d=identicon&r=PG&f=1", "display_name": "aks", "link": "https://stackoverflow.com/users/10050825/aks"}, "is_accepted": false, "score": 1, "last_activity_date": 1567986986, "creation_date": 1567986986, "answer_id": 57846564, "question_id": 57845548, "link": "https://stackoverflow.com/questions/57845548/hide-an-element-and-show-another-element-on-submit-a-form/57846564#57846564", "title": "Hide an element and show another element on submit a form", "body": "<p>Sounds like you should use ajax call to send the request instead of form submit and based upon the response, display the result show/hide.</p>\n"}], "owner": {"reputation": 239, "user_id": 4741225, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sVtzl.png?s=128&g=1", "display_name": "Alin", "link": "https://stackoverflow.com/users/4741225/alin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1567986986, "creation_date": 1567974699, "last_edit_date": 1567986466, "question_id": 57845548, "link": "https://stackoverflow.com/questions/57845548/hide-an-element-and-show-another-element-on-submit-a-form", "title": "Hide an element and show another element on submit a form", "body": "<p>In a web page, I would like to hide the form on submit (either by clicking or pressing enter) and shows the results. It does not work when the Go web server is run.</p>\n\n<p>When I check the HTML file (without running the Go file), it works. But, when I run the Go code, it shows it quickly and goes to the initial state.</p>\n\n<p>The HTML (Bootstrap) code is here:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n\n&lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;meta name=\"description\" content=\"\" /&gt;\n    &lt;meta name=\"google\" value=\"notranslate\"&gt;\n\n    &lt;title&gt;TEST&lt;/title&gt;\n    &lt;!-- favicon --&gt;\n    &lt;link rel=\"icon\" type=\"image/png\" href=\"../static/images/favicon.png\"&gt;\n    &lt;!-- CSS --&gt;\n    &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"../static/css/style.css\" /&gt;\n\n    &lt;!-- scripts --&gt;\n    &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/particlesjs/2.2.3/particles.min.js\"&gt;&lt;/script&gt;\n    &lt;link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css\" /&gt;\n    &lt;style&gt;\n        body {\n            background-color: #2f3b5a\n        }\n\n        .table thead th,\n        .table td,\n        .table th {\n            border: 0px;\n            text-align: center;\n            background-color: #c83660;\n            border-radius: 10px;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n\n&lt;body&gt;\n    &lt;!-- background particles --&gt;\n    &lt;canvas class=\"background\" style=\"position: absolute; top: 0; bottom: 0; left: 0; right: 0; z-index: -1;\"&gt;&lt;/canvas&gt;\n\n    &lt;div class=\"d-flex align-items-center flex-column justify-content-center text-white\" style=\"width:100%;\"&gt;\n        &lt;h1 class=\"display-4\"&gt;TOOL&lt;/h1&gt;\n\n        &lt;div class=\"container\"&gt;\n            &lt;div class=\"row\"&gt;\n                &lt;div class=\"col\"&gt;\n                &lt;/div&gt;\n                &lt;div class=\"col-6\"&gt;\n                    &lt;form class=\"forms\"&gt;\n                        &lt;div class=\"input-group\"&gt;\n                            &lt;div class=\"input-group-prepend\"&gt;\n                                &lt;select class=\"selectpicker forms\" name=\"query\"&gt;\n                                    &lt;option selected&gt;Query Type&lt;/option&gt;\n                                    &lt;option value=\"any\"&gt;Any&lt;/option&gt;\n                                    &lt;option value=\"aaaa\"&gt;A Record&lt;/option&gt;\n                                &lt;/select&gt;\n                            &lt;/div&gt;\n                            &lt;input type=\"text\" class=\"form-control forms\" name=\"host\" placeholder=\"Type here...\"&gt;\n                            &lt;div class=\"input-group-append\"&gt;\n                                &lt;button type=\"button forms\" class=\"btn\"&gt;&lt;i class=\"fas fa-search\"\n                                        aria-hidden=\"true\"&gt;&lt;/i&gt;&lt;/button&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    &lt;/form&gt;\n                    &lt;div id=\"result\" style=\"display:none;\"&gt;\n                        &lt;table class=\"table table-borderless\"&gt;\n                            &lt;thead&gt;\n                                &lt;tr&gt;\n                                    &lt;th scope=\"col\"&gt;Record&lt;/th&gt;\n                                    &lt;th scope=\"col\"&gt;Value&lt;/th&gt;\n                                &lt;/tr&gt;\n                            &lt;/thead&gt;\n                            &lt;tbody&gt;\n                                &lt;tr&gt;\n                                    &lt;td&gt;A&lt;/td&gt;\n                                    {{range .Arecord}}\n                                    &lt;td&gt;{{.}}&lt;/td&gt;\n                                    {{end}}\n                                &lt;/tr&gt;\n                            &lt;/tbody&gt;\n                        &lt;/table&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n                &lt;div class=\"col\"&gt;\n                &lt;/div&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;!--scripts loaded here--&gt;\n    &lt;script src=\"https://kit.fontawesome.com/80c543b9b1.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.13.0/umd/popper.min.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://rawgit.com/bassjobsen/affix/master/assets/js/affix.js\"&gt;&lt;/script&gt;\n\n    &lt;script&gt;\n        window.onload = function () {\n            Particles.init({\n                selector: '.background',\n                // red, blue, yellow\n                color: ['#f76262', '#216583', '#f6d365'],\n                maxParticles: 130,\n                connectParticles: true,\n                responsive: [\n                    {\n                        breakpoint: 768,\n                        options: {\n                            maxParticles: 80\n                        }\n                    }, {\n                        breakpoint: 375,\n                        options: {\n                            maxParticles: 50\n                        }\n                    }\n                ]\n            });\n        };\n\n\n\n        $(\"form\").on(\"submit\", function (e) {\n            //e.preventDefault();\n            $(\"form\").remove();\n            $(\"#result\").show(\"slow\");\n        });\n    &lt;/script&gt;\n\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>I expect removing the form on submit and shows the results table but as long as I run the code in Go, it just restarts the page (quickly shows the results but) the form value is empty.</p>\n\n<pre><code>url := r.FormValue(\"host\")\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567972998, "post_id": 57845296, "comment_id": 102117962, "body": "You can embed <code>General</code> in <code>Animal</code> and <code>Plants</code>. You&#39;ll also need to declare the common interface. <a href=\"https://play.golang.org/p/6rLQcP0NN4X\" rel=\"nofollow noreferrer\">play.golang.org/p/6rLQcP0NN4X</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568005739, "post_id": 57845296, "comment_id": 102123145, "body": "You seem to try to do &quot;classical&quot;, inheritance-based OOP in Go. This will not work. Redesign."}, {"owner": {"reputation": 15, "user_id": 3980896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/625241486e658791bcec18323a6fac9e?s=128&d=identicon&r=PG&f=1", "display_name": "wzcwts521", "link": "https://stackoverflow.com/users/3980896/wzcwts521"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568224343, "post_id": 57845296, "comment_id": 102210194, "body": "@Volker Thanks for pointing out why is not the right thing to do. Can you also provide some detail which what would be the best practice. maybe some posts from you or you have seen?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568265716, "post_id": 57845296, "comment_id": 102220903, "body": "@wzcwts521 I do not have literature available which addresses your problem, but think about it like this: Inheritance in traditional OOP (tOOP) serves two purpose a) polymorphism (you can put Dogs and Cats into a an array of Animals if Dog and Cat extend Animal) and b) code reuse (a Dog can automatically reuse the methods of an Animal). These are two completely distinct, unrelated things unhappily forced into a marriage based on inheritance."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568265884, "post_id": 57845296, "comment_id": 102220944, "body": "Polymorphism is Go is done through interfaces and only through interfaces. If you want to handle different things in a uniform way: Make the handling based on an interface and let the different things implement this interface. Not so different from tOOP. The large difference between Go and tOOP is in how you handle code reuse as there is <i>absolutely</i> <i>no</i> inheritance in Go."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568266422, "post_id": 57845296, "comment_id": 102221123, "body": "If the sole difference between your Dog and your Animal are <i>additional</i> fields and/or methods and everything &quot;Animal-related&quot; is a function of the Animal only: Embed an Animal into your Dog struct. Embedding in Go is a tiny syntactic sugar exposing the inner Animal in a Dog. You can even &quot;override&quot; a Animal method by providing it on the Dog. (Make sure you understand that this just provides reuse of code(=methods) provided by animal &quot;as is&quot; and this is different from polymorphism)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568266538, "post_id": 57845296, "comment_id": 102221167, "body": "In Go you have other types of code re-use: Write a function! Functions are fast to write and easy to test. Write that function <i>after</i> you write the code two or three times and are sure this is not a coincidence only."}, {"owner": {"reputation": 15, "user_id": 3980896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/625241486e658791bcec18323a6fac9e?s=128&d=identicon&r=PG&f=1", "display_name": "wzcwts521", "link": "https://stackoverflow.com/users/3980896/wzcwts521"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568314779, "post_id": 57845296, "comment_id": 102245174, "body": "@Volker  Thank you! This is great."}], "answers": [{"tags": [], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "is_accepted": true, "score": 1, "last_activity_date": 1567973560, "last_edit_date": 1567973560, "creation_date": 1567973053, "answer_id": 57845361, "question_id": 57845296, "link": "https://stackoverflow.com/questions/57845296/is-there-a-way-to-access-interface-like-struct-field-or-changing-typesdifferent/57845361#57845361", "title": "Is there a way to access interface like struct field or changing types(different struct) with same field", "body": "<p>Looks like you need a common interface:</p>\n\n<pre><code>type Animal interface {\n    DoSomething()\n}\n\ntype A struct {\n}\n\ntype B struct {\n}\n\nfunc (a *A) DoSomething() {\n    fmt.Println(\"A\")\n}\n\nfunc (b *B) DoSomething() {\n    fmt.Println(\"B\")\n}\n\nfunc test(some Animal) {\n    some.DoSomething()\n}\n\nfunc main() {\n    a := &amp;A{}\n    b := &amp;B{}\n\n    var all []interface{}\n    all = append(all, a, b)\n\n    for _, v := range all {\n        v.(Animal).DoSomething()\n    }\n}\n</code></pre>\n\n<p><strong>Update</strong>:</p>\n\n<p>As have said @mkopriva, if you need to have common fields in both <code>struct</code> you can create a new <code>struct</code> and embed it in others:</p>\n\n<pre><code>type Animal interface {\n    DoSomething()\n}\n\ntype Common struct {\n    Name string\n}\n\ntype A struct {\n    Common \n}\n\ntype B struct {\n    Common \n}\n\nfunc (a *Common ) DoSomething() {\n    fmt.Println(a.Name)\n}\n\nfunc test(some Animal) {\n    some.DoSomething()\n}\n\nfunc main() {\n    a := &amp;A{Common{Name: \"a\"}}\n    b := &amp;B{Common{Name: \"b\"}}\n\n    var all []interface{}\n    all = append(all, a, b)\n\n    for _, v := range all {\n        v.(Animal).DoSomething()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 3980896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/625241486e658791bcec18323a6fac9e?s=128&d=identicon&r=PG&f=1", "display_name": "wzcwts521", "link": "https://stackoverflow.com/users/3980896/wzcwts521"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 57845361, "answer_count": 1, "score": -1, "last_activity_date": 1567973560, "creation_date": 1567972442, "question_id": 57845296, "link": "https://stackoverflow.com/questions/57845296/is-there-a-way-to-access-interface-like-struct-field-or-changing-typesdifferent", "title": "Is there a way to access interface like struct field or changing types(different struct) with same field", "body": "<p>two/more different sets of data which each data requires it is own struct for different functions, and these two/more sets of data struct share the same field.\nhow can I combine these two set of data (different types), and can be called by another function which requires access filed from each sets of data. </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Plants struct {\n    Name string\n    Age  int\n}\n\ntype Animal struct {\n    Name string\n    Age  int\n}\n\ntype General struct {\n    Name string\n    Age  int\n}\n\nfunc (a *Animal) AnimalHealth() {\n    fmt.Printf(\"Animal: %s is %+v years old who is in healthy condition!\\n\", a.Name, a.Age)\n}\n\nfunc (p *Plants) PlantsHealth() {\n    fmt.Printf(\"Plants: %s is %+v years old who is in healthy condition!\\n\", p.Name, p.Age)\n}\n\nfunc (g *General) alive() {\n    fmt.Printf(\"%s is %+v alive. \\n\", g.Name, g.Age)\n}\n\nfunc main() {\n    dog := Animal{\n        Name: \"luckdog\",\n        Age:  6,\n    }\n\n    flower := Plants{\n        Name: \"sunflower\",\n        Age:  5,\n    }\n\n    dog.AnimalHealth()    // Output is required.\n    flower.PlantsHealth()  // Output is required. \n\n    var all []interface{}\n    all = append(all, dog, flower)\n    fmt.Printf(\"Print out all %s\\n\", all)\n\n    for _, v := range all {\n        fmt.Printf(\"This is iterate through all value %v\\n\", v)  //Tested *Animal data and *Plants data are combined. \n//      v.alive()   // *** Output is required, how should access fields, brain is burning.  ***\n\n    }\n}\n</code></pre>\n\n<p>make v.alive() works.</p>\n"}, {"tags": ["java", "go"], "comments": [{"owner": {"reputation": 64281, "user_id": 5772882, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/58mlb.png?s=128&g=1", "display_name": "Ole V.V.", "link": "https://stackoverflow.com/users/5772882/ole-v-v"}, "edited": false, "score": 5, "creation_date": 1567972145, "post_id": 57845231, "comment_id": 102117731, "body": "Measuring execution speed reliably is not so simple as it sounds. For some inspiratin <a href=\"https://stackoverflow.com/questions/504103/how-do-i-write-a-correct-micro-benchmark-in-java\">How do I write a correct micro-benchmark in Java?</a>"}, {"owner": {"reputation": 481, "user_id": 6713871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6d0cf46b08a63241386786e74ae4b1f?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Rollins", "link": "https://stackoverflow.com/users/6713871/chris-rollins"}, "edited": false, "score": 0, "creation_date": 1567972278, "post_id": 57845231, "comment_id": 102117775, "body": "make sure you have optimizations set on compiler options for both languages."}, {"owner": {"reputation": 126499, "user_id": 1531124, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/zw18i.png?s=128&g=1", "display_name": "GhostCat", "link": "https://stackoverflow.com/users/1531124/ghostcat"}, "reply_to_user": {"reputation": 481, "user_id": 6713871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6d0cf46b08a63241386786e74ae4b1f?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Rollins", "link": "https://stackoverflow.com/users/6713871/chris-rollins"}, "edited": false, "score": 1, "creation_date": 1567972339, "post_id": 57845231, "comment_id": 102117791, "body": "@ChrisRollins There are no optimisations that you can enable for java. Performance comes out of the JIT doing magic at runtime, and ordinary mere mortals rarely tune that thing."}, {"owner": {"reputation": 481, "user_id": 6713871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6d0cf46b08a63241386786e74ae4b1f?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Rollins", "link": "https://stackoverflow.com/users/6713871/chris-rollins"}, "edited": false, "score": 2, "creation_date": 1567972354, "post_id": 57845231, "comment_id": 102117802, "body": "Also, the performance of a simple loop does not indicate anything about the language. You should test with whichever algorithms are relevant to your work. ALSO, terminal output is extremely slow and therefore will dominate the performance measurements of a program, so you probably should not have any print statements within code you are measuring."}, {"owner": {"reputation": 481, "user_id": 6713871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6d0cf46b08a63241386786e74ae4b1f?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Rollins", "link": "https://stackoverflow.com/users/6713871/chris-rollins"}, "reply_to_user": {"reputation": 126499, "user_id": 1531124, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/zw18i.png?s=128&g=1", "display_name": "GhostCat", "link": "https://stackoverflow.com/users/1531124/ghostcat"}, "edited": false, "score": 0, "creation_date": 1567972405, "post_id": 57845231, "comment_id": 102117813, "body": "@GhostCat that&#39;s fine but you have to enable optimizations on the other language you are comparing with Java."}, {"owner": {"reputation": 33492, "user_id": 7212686, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ey8ll.png?s=128&g=1", "display_name": "azro", "link": "https://stackoverflow.com/users/7212686/azro"}, "edited": false, "score": 0, "creation_date": 1567972630, "post_id": 57845231, "comment_id": 102117866, "body": "<code>currentTimeMillis</code> is a clock, <code>nanoTime</code> is a chronometer, choose your side (if you don&#39;t use benchmark lib)"}], "answers": [{"tags": [], "owner": {"reputation": 126499, "user_id": 1531124, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/zw18i.png?s=128&g=1", "display_name": "GhostCat", "link": "https://stackoverflow.com/users/1531124/ghostcat"}, "is_accepted": false, "score": 9, "last_activity_date": 1567974272, "last_edit_date": 1567974272, "creation_date": 1567972246, "answer_id": 57845268, "question_id": 57845231, "link": "https://stackoverflow.com/questions/57845231/java8-vs-go-speed-of-execution/57845268#57845268", "title": "Java8 vs Go speed of execution", "body": "<p>First of all: your approach to benchmarking is way too naive. For the java side of things see <a href=\"https://stackoverflow.com/questions/504103/how-do-i-write-a-correct-micro-benchmark-in-java\">this</a> for example.</p>\n\n<p>Meaning: your numbers are (to a large) degree meaningless.</p>\n\n<p>Second: there is a misconception. Yes, go compiles to native code. But it is <em>not</em> \"always\" known for high performance, see <a href=\"https://www.reddit.com/r/golang/comments/7as4f7/why_is_go_so_slow/\" rel=\"nofollow noreferrer\">here</a> for example. And of course: Java performance comes out of the JIT, and as outlined by the first link, getting that to work when measuring is a bit tricky, too.</p>\n\n<p>Thus the simple technical answer: your premises are flawed. </p>\n\n<p>And the <strong>real</strong> point here: your example code prints to stdout. That <strong>printing</strong> is the most expensive operation here, and most of that time hasn't anything to do with the programming language, because in the end, we talk about \"file io\" to a system console. </p>\n\n<p>So, coming back, the real point is: your \"benchmark numbers\" are close to meaningless.</p>\n"}], "owner": {"reputation": 17, "user_id": 2596031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GXb5h.jpg?s=128&g=1", "display_name": "Phoenix", "link": "https://stackoverflow.com/users/2596031/phoenix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "closed_date": 1567974903, "answer_count": 1, "score": -3, "last_activity_date": 1567974272, "creation_date": 1567971952, "last_edit_date": 1567972245, "question_id": 57845231, "link": "https://stackoverflow.com/questions/57845231/java8-vs-go-speed-of-execution", "closed_reason": "Needs more focus", "title": "Java8 vs Go speed of execution", "body": "<p>I am learning Go and before this I have been using Java8. I wrote two programs to compare speed of execution between Java8 and Go.</p>\n\n<p>The Java program ran in 604 seconds on and Go one took 2334.598334749 seconds. Can someone help me understand why Go program is running slow even when it is said to be faster.</p>\n\n<pre><code>\u279c  ~ java -version\njava version \"1.8.0_91\"\nJava(TM) SE Runtime Environment (build 1.8.0_91-b14)\nJava HotSpot(TM) 64-Bit Server VM (build 25.91-b14, mixed mode)\n\u279c  ~ go version\ngo version go1.12.4 darwin/amd64\n</code></pre>\n\n<pre class=\"lang-java prettyprint-override\"><code>//Java\npublic class Solution {\n\n  public static void main(String[] args) {\n\n    long start = System.currentTimeMillis();\n    for (int i = 0; i &lt;= 1 * 1e8; i++) {\n      System.out.println(i);\n    }\n    long end = System.currentTimeMillis();\n    System.out.println(Duration.ofMillis(end - start).getSeconds());\n  }\n }\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code> //Golang\n package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\nfunc main() {\n\n    var start = time.Now()\n    for i := 0; i&lt;= 1 * 1e8 ;i++  {\n        fmt.Println(i)\n    }\n    fmt.Println(time.Now().Sub(start).Seconds())\n}\n</code></pre>\n"}, {"tags": ["go", "statistics", "correlation", "p-value"], "answers": [{"comments": [{"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1568395841, "post_id": 57925701, "comment_id": 102273574, "body": "Thanks for very useful information. What would be the code to determine P value from Student&#39;s t distribution as implemented in GoNum for, say t=11.2 (which is obtained with n=100 and r=0.75) ?"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1568937469, "post_id": 57925701, "comment_id": 102443629, "body": "This is exactly what I wanted. Thanks. For 1-sided P value (lesser or greater) are major changes in code required?"}], "tags": [], "owner": {"reputation": 41290, "user_id": 570918, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/27ce5101af57acecf9a5fe563b6192b1?s=128&d=identicon&r=PG", "display_name": "merv", "link": "https://stackoverflow.com/users/570918/merv"}, "is_accepted": true, "score": 1, "last_activity_date": 1568918097, "last_edit_date": 1568918097, "creation_date": 1568385514, "answer_id": 57925701, "question_id": 57844443, "link": "https://stackoverflow.com/questions/57844443/how-to-get-p-value-of-correlation-coefficient/57925701#57925701", "title": "How to get P value of correlation coefficient", "body": "<p>It looks like you'll need to <strong>calculate it manually</strong>, and there are multiple ways to do this, depending on assumptions you can make about your data.  If you really go this route, I'd strongly encourage you to also test against existing implementations - for example <a href=\"https://www.rdocumentation.org/packages/stats/versions/3.6.1/topics/cor.test\" rel=\"nofollow noreferrer\">R's <code>cor.test</code></a> - \nto ensure that you're not doing something wrong.</p>\n\n<h3>Normality Assumption</h3>\n\n<p>If the observed values are each approximately normal, then the value</p>\n\n<p><img src=\"https://i.stack.imgur.com/ODv1s.png\" alt=\"enter image description here\"></p>\n\n<p>where <code>r</code> is the calculated correlation coefficient and <code>n</code> is the number of observations, will follow Student's <em>t</em> distribution with <code>n-2</code> degrees of freedom. Hence, you can use <a href=\"https://godoc.org/gonum.org/v1/gonum/stat/distuv#StudentsT\" rel=\"nofollow noreferrer\">Student's <em>t</em> distribution as implemented in GoNum</a> to compute the p-value. This is what <code>cor.test</code> in R does.</p>\n\n<p>It should go something like (please note I've never used Go):</p>\n\n<pre><code>import (\n    \"math\"\n    \"gonum.org/v1/gonum/stat/distuv\"\n)\n\nfunc twoSidedPValue(r float64, n float64) float64 {\n\n    // compute the test stat\n    ts := r * math.Sqrt((n - 2) / (1 - r*r))\n\n    // make a Student's t with (n-2) d.f.\n    t := distuv.StudentsT{0, 1, (n-2), nil}\n\n    // compute the p-value\n    pval := 2 * t.CDF(-math.Abs(testStat))\n\n    return pval\n}\n</code></pre>\n\n<p>Testing against R's <code>cor.test</code> seems to match up.</p>\n\n<h3>Permutation Test</h3>\n\n<p>If your sampled variables are not each normal, then you can use a permutation test.  Essentially, randomize your data and see how many times a random correlation matches or exceeds your observed one. If your test is two-sided (i.e., you had no principled assumptions about the correlation outcome), use the absolute values of the correlation for the test.</p>\n\n<hr>\n\n<h2>Test Details</h2>\n\n<p>The <strong>Inference</strong> section of the Wikipedia entry, <a href=\"https://en.wikipedia.org/wiki/Pearson_correlation_coefficient#Inference\" rel=\"nofollow noreferrer\">\"Pearson correlation coefficient\"</a>, has details.</p>\n"}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 57925701, "answer_count": 1, "score": -2, "last_activity_date": 1568918097, "creation_date": 1567965398, "last_edit_date": 1568038178, "question_id": 57844443, "link": "https://stackoverflow.com/questions/57844443/how-to-get-p-value-of-correlation-coefficient", "title": "How to get P value of correlation coefficient", "body": "<p>I am trying to use Go for simple statistics. </p>\n\n<p>I am using <a href=\"https://godoc.org/gonum.org/v1/gonum/stat#Correlation\" rel=\"nofollow noreferrer\">this package</a> to get correlation coefficient.</p>\n\n<p>It works well but it does not give P value of the correlation. Other functions in this package are given above on the same page: <a href=\"https://godoc.org/gonum.org/v1/gonum/stat\" rel=\"nofollow noreferrer\">https://godoc.org/gonum.org/v1/gonum/stat</a></p>\n\n<p>Similarly, <a href=\"https://godoc.org/github.com/montanaflynn/stats\" rel=\"nofollow noreferrer\">this package</a> also has correlation function which returns coefficient but not P value.</p>\n\n<p>How can I find P value of correlation coefficient with any of these packages?</p>\n\n<p>Edit: I had posted this question at crossvalidated (stats.stackexchange.com) where it was suggested that it is a programming question.</p>\n"}, {"tags": ["go", "ip"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1567964298, "post_id": 57844245, "comment_id": 102115816, "body": "you need an external db to translate an ip to a location."}, {"owner": {"reputation": 29, "user_id": 10327276, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yiasZ.png?s=128&g=1", "display_name": "KodeSaga", "link": "https://stackoverflow.com/users/10327276/kodesaga"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567964479, "post_id": 57844245, "comment_id": 102115867, "body": "Thank you @CeriseLim&#243;n being new to Go I just needed the info if its possible get that from STL, I was not asking for any recommendations for third party library."}, {"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1567964810, "post_id": 57844245, "comment_id": 102115957, "body": "@KodeSaga FYI, <a href=\"https://en.wikipedia.org/wiki/Standard_Template_Library\" rel=\"nofollow noreferrer\">STL is a thing in C++</a>, not in Go."}, {"owner": {"reputation": 29, "user_id": 10327276, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yiasZ.png?s=128&g=1", "display_name": "KodeSaga", "link": "https://stackoverflow.com/users/10327276/kodesaga"}, "reply_to_user": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1567965316, "post_id": 57844245, "comment_id": 102116074, "body": "@mkrieger1 yup my bad I meant <a href=\"https://golang.org/pkg/#stdlib\" rel=\"nofollow noreferrer\">Go Standard Library</a>"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1567964348, "creation_date": 1567964348, "answer_id": 57844325, "question_id": 57844245, "link": "https://stackoverflow.com/questions/57844245/finding-location-and-timezone-of-an-ip-address-using-go-standard-library/57844325#57844325", "title": "Finding Location and Timezone of an IP address using Go standard library", "body": "<p>In general, no. You have to use an IP-based geolocation service, or one of the freely available geolocation libraries. The accuracy may depend on the library or service you use, and the IP address. There is also the problem of IP addresses assigned to mobile phones, etc. that move.</p>\n"}], "owner": {"reputation": 29, "user_id": 10327276, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yiasZ.png?s=128&g=1", "display_name": "KodeSaga", "link": "https://stackoverflow.com/users/10327276/kodesaga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "closed_date": 1567975974, "accepted_answer_id": 57844325, "answer_count": 1, "score": -3, "last_activity_date": 1567964696, "creation_date": 1567963789, "last_edit_date": 1567964696, "question_id": 57844245, "link": "https://stackoverflow.com/questions/57844245/finding-location-and-timezone-of-an-ip-address-using-go-standard-library", "closed_reason": "Not suitable for this site", "title": "Finding Location and Timezone of an IP address using Go standard library", "body": "<p>I am trying to find the location and timezone for any IP address using the Go standard library, but could not find any solution yet. </p>\n\n<p>I was experimenting to find the IP address of any client sending a request, figured one way by using go methods as below and cleaning their responses. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>req.Header.Get(\"x-forwarded-for\")\nreq.RemoteAddr\n</code></pre>\n\n<p>But once I get the IP. Is there any method in Go using the standard library to get the location and timezone of that IP, I can't make use of any third party API Calls or third party libraries. Any pointers will be helpful.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1567963932, "post_id": 57844174, "comment_id": 102115701, "body": "your timeout is misleading. Implement a real timeout and things should work <a href=\"https://golang.org/pkg/time/#Time.After\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#Time.After</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568037113, "post_id": 57844174, "comment_id": 102137034, "body": "Your issue is that you had some expectation about what order they would execute in. The ordering of concurrent operations is non-deterministic."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 5, "last_activity_date": 1567963941, "creation_date": 1567963941, "answer_id": 57844269, "question_id": 57844174, "link": "https://stackoverflow.com/questions/57844174/how-to-understand-goroutines-execution-in-this-example/57844269#57844269", "title": "How to understand goroutines execution in this example?", "body": "<p>There is no execution ordering guarantee between goroutines unless they communicate with each other using synchronization mechanisms such as channels. You create two goroutines, then wait until you receive a string from <code>ch</code>, or receive from <code>t</code>. There is no explicit synchronization between the two goroutines, so they can execute in any order in a single thread, or simultaneously on different threads. The select statement will read from the first channel that has something in it.</p>\n"}], "owner": {"reputation": 417, "user_id": 5962610, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-4XzgnBcMeMM/AAAAAAAAAAI/AAAAAAAACfM/IJFVK1rJYkY/photo.jpg?sz=128", "display_name": "amrit chhetri", "link": "https://stackoverflow.com/users/5962610/amrit-chhetri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1567963941, "creation_date": 1567963374, "last_edit_date": 1567963792, "question_id": 57844174, "link": "https://stackoverflow.com/questions/57844174/how-to-understand-goroutines-execution-in-this-example", "title": "How to understand goroutines execution in this example?", "body": "<p>i am trying to understand go routines and how it works. in the below example i have two go routines each sending some messege via channels.i was expecting the channel ch will send messege first but why is go readword(ch) execute after go timeout(t). if i change the order of the go routines call inside main function then readword(ch) will execute first.i am getting very confused about go routines? any help?</p>\n\n<pre><code>func readword(ch chan string) {\n\n    fmt.Println(\"Type a word, then hit Enter.\")\n    var word string\n    fmt.Scanf(\"%s\", &amp;word)\n    ch &lt;- word\n}\n\nfunc timeout(t chan bool) {\n    t &lt;- false\n}\n\nfunc main() {\n    ch := make(chan string)\n    go readword(ch)\n\n    t := make(chan bool)\n    go timeout(t)\n\n    select {\n    case word := &lt;-ch:\n        fmt.Println(\"Received\", word)\n    case &lt;-t:\n        fmt.Println(\"Timeout.\")\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "lets-encrypt"], "answers": [{"tags": [], "owner": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "is_accepted": false, "score": 0, "last_activity_date": 1567956623, "creation_date": 1567956623, "answer_id": 57843297, "question_id": 57842900, "link": "https://stackoverflow.com/questions/57842900/crypto-autocert-package-stopped-working-hangs-forever-waiting-for-acme-challeng/57843297#57843297", "title": "crypto/autocert package stopped working, hangs forever waiting for acme challenge", "body": "<p>I was able to resolve this by changing my server config from this:</p>\n\n<pre><code>s := &amp;http.Server{\n    Addr:    \":https\",\n    Handler: allowCORS(mux),\n    TLSConfig: &amp;tls.Config{\n        GetCertificate: certManager.GetCertificate,\n    },\n}\n</code></pre>\n\n<p>to this:</p>\n\n<pre><code>s := &amp;http.Server{\n    Addr:    \":https\",\n    Handler: allowCORS(mux),\n    TLSConfig: certManager.TLSConfig(),\n}\n</code></pre>\n\n<p>which made explicitly serving over HTTP redundant, so I also removed this code and its error handling:</p>\n\n<pre><code>go func() {\n    err := http.ListenAndServe(\":http\", certManager.HTTPHandler(nil))\n    if err != nil {\n        c1 &lt;- err\n    }\n}()\n</code></pre>\n\n<p>Ultimately my config looks something like this:</p>\n\n<pre><code>certManager := autocert.Manager{\n    Prompt:     autocert.AcceptTOS,\n    HostPolicy: autocert.HostWhitelist(\"example.com\"),\n    Cache:      autocert.DirCache(\"certs\"),\n}\n\ns := &amp;http.Server{\n    Addr:      \":https\",\n    Handler:   allowCORS(mux),\n    TLSConfig: certManager.TLSConfig(),\n}\n\nlog.Fatal(s.ListenAndServeTLS(\"\", \"\"))\n</code></pre>\n\n<p>And my TLS certificate works as expected</p>\n\n<p>If someone wants to explain <em>why</em> this worked I will happily upvote and mark it as the correct answer!</p>\n"}], "owner": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567956639, "creation_date": 1567953422, "last_edit_date": 1567956639, "question_id": 57842900, "link": "https://stackoverflow.com/questions/57842900/crypto-autocert-package-stopped-working-hangs-forever-waiting-for-acme-challeng", "title": "crypto/autocert package stopped working, hangs forever waiting for acme challenge", "body": "<p>I've been relying on this lib for sometime now without any issues but suddenly it is completely ignoring the cached cert, attempts to get a new cert, but then it just waits forever for the acme challenge which apparently never comes. As far as I can tell my usage is completely correct (and this has worked for the past several weeks without issue):</p>\n\n<pre><code>certManager := autocert.Manager{\n    Prompt:     autocert.AcceptTOS,\n    HostPolicy: autocert.HostWhitelist(\"example.com\"),\n    Cache:      autocert.DirCache(\"certs\"),\n}\n\nc1 := make(chan error)\n\ngo func() {\n    err := http.ListenAndServe(\":80\", certManager.HTTPHandler(nil))\n    if err != nil {\n        c1 &lt;- err\n    }\n}()\n\nerr := &lt;-c1\nif err != nil {\n    os.Stderr.WriteString(\n        fmt.Sprintf(\n            \"failed to serve certification manager for acme verification - %v\\n\",\n            err,\n        )\n    )\n}\nif err := s.ListenAndServeTLS(\"\", \"\"); err != http.ErrServerClosed {\n    os.Stderr.WriteString(fmt.Sprintf(\"Failed to start: %v\\n\", err))\n    return err\n}\n</code></pre>\n\n<p>I'm running this on AWS, I'm 100% certain that route53 is properly configured (it works over http) and the security group has all ports open for all traffic so I know that isn't the issue either.</p>\n\n<p>In the past if the challenge failed or if the certs couldn't be loaded I received some sort of useful debug information, but without any apparent change to this particular code and any meaningful error information I'm completely stuck. How can I debug this and get some meaningful explanation as to why this working code is suddenly failing? Is there a way I can know if letsencrypt is throttling me or something?</p>\n"}, {"tags": ["go", "httpclient", "http2"], "owner": {"reputation": 67, "user_id": 9590238, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Nyz7kN64rs4/AAAAAAAAAAI/AAAAAAAAAW4/d_v2XhY1eAI/photo.jpg?sz=128", "display_name": "Ashley Thomas", "link": "https://stackoverflow.com/users/9590238/ashley-thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1567967243, "creation_date": 1567947943, "last_edit_date": 1567967243, "question_id": 57842196, "link": "https://stackoverflow.com/questions/57842196/not-able-to-set-parameters-in-http-2-transport", "title": "Not able to set parameters in http/2 transport", "body": "<p>I want to have a Go HTTP/2 client for contacting a HTTP/2 supported server using h2c. For which I used Go's http2 transport, but it does not provide options like connection timeout, disable keep-alive, idle connection timeout, etc. as provided by http transport. </p>\n\n<p>I tried using ConfigureTransport function in http2 package but this doesn't work with h2c. </p>\n\n<p>Code snippet which I used is: </p>\n\n<pre><code>protos := []string{\"h2\", \"http/1.1\"}\ntransport1 := &amp;http.Transport{\n    DisableCompression: !enableCompression,\n    DisableKeepAlives:  !enableKeepAlive,\n    DialContext: (&amp;net.Dialer{\n        Timeout: dialTimeout,\n    }).DialContext,\n    IdleConnTimeout:     idleConnectionTimeout,\n    MaxIdleConnsPerHost: idleConnectionsPerHost,\n    TLSClientConfig: &amp;tls.Config{\n        NextProtos: protos,\n    },\n}\n\nif err := http2.ConfigureTransport(transport1); err != nil {\n    fmt.Println(err.Error())\n}\n\nclient := http.Client{\n    Transport: transport1,\n}\n\nresp, err := client.Get(\"http://&lt;server&gt;/hello.html\")\n</code></pre>\n\n<p>I was expecting communication over h2c to work with all the parameters specified. Am I missing something?</p>\n"}, {"tags": ["unit-testing", "go", "raspberry-pi"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1567951310, "post_id": 57841971, "comment_id": 102112620, "body": "You can declare an interface that lists the functions you want to mock as its methods and have the dependant code depend on that interface instead of the individual functions, then you need to only pass one param instead of 5-6. You can declare a struct type, have <code>isGpioPinExported</code> be a method on that struct type, and have the functions that you want to mock be individual fields of that struct type, then you don&#39;t have to pass them around when calling the method. Or you can keep doing what you&#39;re doing and use testhooks..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567951522, "post_id": 57841971, "comment_id": 102112691, "body": "... as an example: testhook <a href=\"https://github.com/golang/go/blob/5bd7e9c54f946eec95d32762e7e9e1222504bfc1/src/net/hook.go#L14\" rel=\"nofollow noreferrer\">declaration</a>, testhook <a href=\"https://github.com/golang/go/blob/e64241216dd141589144a07f7f68acd64dc108fe/src/net/tcpsock_posix.go#L58\" rel=\"nofollow noreferrer\">&quot;placement&quot;</a>, and testhook <a href=\"https://github.com/golang/go/blob/9f513254ae92e2a62c3197cf16f7f22a8ca2879a/src/net/dial_test.go#L463-L475\" rel=\"nofollow noreferrer\">setup/teardown</a>"}, {"owner": {"reputation": 81177, "user_id": 296328, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/DSpH6.jpg?s=128&g=1", "display_name": "khmarbaise", "link": "https://stackoverflow.com/users/296328/khmarbaise"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568236592, "post_id": 57841971, "comment_id": 102214877, "body": "@mkopriva See my answer. Thanks for your thoughts and suggestions."}], "answers": [{"tags": [], "owner": {"reputation": 81177, "user_id": 296328, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/DSpH6.jpg?s=128&g=1", "display_name": "khmarbaise", "link": "https://stackoverflow.com/users/296328/khmarbaise"}, "is_accepted": true, "score": 1, "last_activity_date": 1568236492, "creation_date": 1568236492, "answer_id": 57896887, "question_id": 57841971, "link": "https://stackoverflow.com/questions/57841971/mocking-fake-replacing-hardware-dependent-functions-in-unit-tests/57896887#57896887", "title": "Mocking / Fake / Replacing hardware dependent functions in Unit Tests", "body": "<p>So based on the suggestion of mkopriva I have created an interface which looks like this (now with three functions to see how this really works):</p>\n\n<pre><code>type Raspberry interface {\n    isPinExported(gpioPin int) bool\n    valueExist(gpioPin int) bool\n    directionExist(gpioPin int) bool\n}\n</code></pre>\n\n<p>Furthermore defined a structure to make the implementation for real hardware (Raspberry):</p>\n\n<pre><code>type Rasberry3Plus struct {\n}\n\nfunc (raspberry Rasberry3Plus) valueExist(gpioPin int) bool {\n    pinPath := fmt.Sprintf(\"%s%d/value\", sysClassGPIOPin, gpioPin)\n    if file, err := os.Stat(pinPath); err == nil &amp;&amp; len(file.Name()) &gt; 0 {\n        return true\n    }\n    return false\n}\n\nfunc (raspberry Rasberry3Plus) directionExist(gpioPin int) bool {\n    pinPath := fmt.Sprintf(\"%s%d/direction\", sysClassGPIOPin, gpioPin)\n    if file, err := os.Stat(pinPath); err == nil &amp;&amp; len(file.Name()) &gt; 0 {\n        return true\n    }\n    return false\n}\n\nfunc (raspberry Rasberry3Plus) isPinExported(gpioPin int) bool {\n    pinPath := fmt.Sprintf(\"%s%d\", sysClassGPIOPin, gpioPin)\n    if file, err := os.Stat(pinPath); err == nil &amp;&amp; len(file.Name()) &gt; 0 {\n        return true\n    }\n    return false\n}\n</code></pre>\n\n<p>and the function <code>IsGpioPinExported</code> which uses the above functions looks now like this (This is just an example implementation to see how the mocking testing works):</p>\n\n<pre><code>func IsGpioPinExported(raspberry Raspberry, gpioPin int) bool {\n    pinExported := raspberry.isPinExported(gpioPin)\n    valueExist := raspberry.valueExist(gpioPin)\n    directionExist := raspberry.directionExist(gpioPin)\n\n    return valueExist &amp;&amp; directionExist &amp;&amp; pinExported\n}\n</code></pre>\n\n<p>So now the tests look like this. First I have to define a type (btw: I have decided to go with Mock):</p>\n\n<pre><code>import (\n    \"github.com/stretchr/testify/assert\"\n    \"github.com/stretchr/testify/mock\"\n    \"testing\"\n)\n\ntype mockRaspberry struct {\n    mock.Mock\n}\n\nfunc (raspMock mockRaspberry) isPinExported(gpioPin int) bool {\n    args := raspMock.Called(gpioPin)\n    return args.Bool(0)\n}\nfunc (raspMock mockRaspberry) valueExist(gpioPin int) bool {\n    args := raspMock.Called(gpioPin)\n    return args.Bool(0)\n}\nfunc (raspMock mockRaspberry) directionExist(gpioPin int) bool {\n    args := raspMock.Called(gpioPin)\n    return args.Bool(0)\n}\n\nfunc Test_ValueTrue_DirectionExistTrue(t *testing.T) {\n    testObj := new(mockRaspberry)\n\n    testObj.On(\"isPinExported\", 5).Return(false)\n    testObj.On(\"valueExist\", 5).Return(true)\n    testObj.On(\"directionExist\", 5).Return(true)\n\n    exported := IsGpioPinExported(testObj, 5)\n    assert.Equal(t, false, exported)\n}\n</code></pre>\n\n<p>And now it is simple to test the loigic in function <code>IsGpioPinExported</code> with the appropriate mocked functions with wished result. And finally the main program looks like this:</p>\n\n<pre><code>func main() {\n    rasberry3Plus := gpio.Rasberry3Plus{}\n    gpio.IsGpioPinExported(rasberry3Plus, 23)\n}\n</code></pre>\n"}], "owner": {"reputation": 81177, "user_id": 296328, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/DSpH6.jpg?s=128&g=1", "display_name": "khmarbaise", "link": "https://stackoverflow.com/users/296328/khmarbaise"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 57896887, "answer_count": 1, "score": 1, "last_activity_date": 1568236492, "creation_date": 1567945696, "question_id": 57841971, "link": "https://stackoverflow.com/questions/57841971/mocking-fake-replacing-hardware-dependent-functions-in-unit-tests", "title": "Mocking / Fake / Replacing hardware dependent functions in Unit Tests", "body": "<p>I have currently the following function in one file:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>func pinExported(pin int) bool {\n    pinPath := fmt.Sprintf(\"/sys/class/gpio/gpio%d\", pin)\n    if file, err := os.Stat(pinPath); err == nil &amp;&amp; len(file.Name()) &gt; 0 {\n        return true\n    }\n    return false\n}\n</code></pre>\n\n<p>and another code part in the same file which uses the above function which looks like this:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>func isGpioPinExported(gpioPin int) bool {\n    exported := pinExported(gpioPin)\n    for !exported &amp;&amp; (timeOut &lt; timeOutForPinExportInMilliseconds) {\n        timeOut++\n        time.Sleep(1 * time.Millisecond)\n        exported = pinExported(gpioPin)\n    }\n     ...\n</code></pre>\n\n<p>So now I'm searching for an elegant way to mock/replace somehow the above <code>pinExported</code> function within my unit tests to test the logic inside <code>isGpioPinExported</code> because the function <code>pinExported</code> is hardware dependent (Raspberry PI).</p>\n\n<p>One solution could be to make the <code>pinExported</code> function a parameter of <code>isGpioPinExported</code></p>\n\n<p>So defining a function type like this:</p>\n\n<pre><code>type pinExported func(int) int\n</code></pre>\n\n<p>which means I have to define <code>isGpioPinExported</code> like this:</p>\n\n<pre><code>isGpioPinExported(pinExported pinExported, gpioPin int) bool {\n    exported := pinExported(gpioPin)\n    for !exported &amp;&amp; (timeOut &lt; timeOutForPinExportInMilliseconds) {\n    ...\n    }\n    ..\n}\n</code></pre>\n\n<p>Now I can write my unit test and define a mock/fake <code>pinExported</code> without a problem. So far so good. But I have about five or six of such functions which means it would result in putting five or six supplemental parameters to a function like <code>isGpioPinExported</code> which is simply wrong. Apart from that the question is where can I define the default implementation which are used if this is not running under test?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-dynamodb", "aws-sdk-go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567944075, "post_id": 57841681, "comment_id": 102111076, "body": "There is no way to &quot;choose&quot;. What you have to do is declare a custom type that implements the Marshaler/Unmarshaler interfaces."}], "answers": [{"comments": [{"owner": {"reputation": 686, "user_id": 433041, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9a490daadb32be545d472824bdbfbe0f?s=128&d=identicon&r=PG", "display_name": "Oleg Kovalov", "link": "https://stackoverflow.com/users/433041/oleg-kovalov"}, "edited": false, "score": 0, "creation_date": 1590309668, "post_id": 57841829, "comment_id": 109627554, "body": "For those using old Go (before 1.13), it will be enough to remove underscores (<code>_</code>) and everything will work as expected. But it&#39;s much better to update Go to the latest version."}], "tags": [], "owner": {"reputation": 51, "user_id": 12037421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ed6180e6b777453db2680b9ace6b4cc?s=128&d=identicon&r=PG&f=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/12037421/jason"}, "is_accepted": false, "score": 3, "last_activity_date": 1567944608, "creation_date": 1567944608, "answer_id": 57841829, "question_id": 57841681, "link": "https://stackoverflow.com/questions/57841681/dynamodb-marshal-and-unmarshal-golang-time-time-as-millis-since-epoch/57841829#57841829", "title": "DynamoDB Marshal and unmarshal golang time.Time as millis since epoch", "body": "<p>(As I was about to post my question I figured out the answer by looking into how <code>UnixTime</code> worked).</p>\n\n<p>To use a custom Marshaler and Unmarshaler you can create a custom type.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type MillisTime time.Time\n\nfunc (e MillisTime) MarshalDynamoDBAttributeValue(av *dynamodb.AttributeValue) error {\n    millis := timeAsMillis(time.Time(e))\n    millisStr := fmt.Sprintf(\"%d\", millis)\n    av.N = &amp;millisStr\n    return nil\n}\n\nfunc (e *MillisTime) UnmarshalDynamoDBAttributeValue(av *dynamodb.AttributeValue) error {\n    millis, err := strconv.ParseInt(*av.N, 10, 0)\n    if err != nil {\n        return err\n    }\n    *e = MillisTime(millisAsTime(millis))\n    return nil\n}\n\nfunc timeAsMillis(t time.Time) int64 {\n    nanosSinceEpoch := t.UnixNano()\n    return (nanosSinceEpoch / 1_000_000_000) + (nanosSinceEpoch % 1_000_000_000)\n}\n\nfunc millisAsTime(millis int64) time.Time {\n    seconds := millis / 1_000\n    nanos := (millis % 1_000) * 1_000_000\n    return time.Unix(seconds, nanos)\n}\n</code></pre>\n\n<p>NOTE: Example above uses the new number literal syntax introduced in go 1.13.</p>\n\n<p>You can easily marshal and unmarshal structs using <code>MarshalMap</code> and <code>UnmarshalMap</code> but the downside is that the fields in your struct type have to use MillisTime instead of <code>time.Time</code>. Conversion is not easy but is possible.</p>\n\n<p>The SDK defines a <code>UnixTime</code> type which will handle marshaling and unmarshaling between <code>time.Time</code> &lt;=> seconds since epoch.</p>\n"}], "owner": {"reputation": 51, "user_id": 12037421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ed6180e6b777453db2680b9ace6b4cc?s=128&d=identicon&r=PG&f=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/12037421/jason"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1001, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1567945399, "creation_date": 1567943492, "last_edit_date": 1567945399, "question_id": 57841681, "link": "https://stackoverflow.com/questions/57841681/dynamodb-marshal-and-unmarshal-golang-time-time-as-millis-since-epoch", "title": "DynamoDB Marshal and unmarshal golang time.Time as millis since epoch", "body": "<p>The sdk by default marshals <code>time.Time</code> values as RFC3339 strings. How can you choose to marshal and unmarshal in other ways e.g. millis since epoch?</p>\n\n<p>The SDK mentions the Marshaler and Unmarshaler interfaces but does not explain how to use them.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1567939868, "post_id": 57841244, "comment_id": 102110219, "body": "Named types can have methods, built-in in types cannot: <a href=\"https://tour.golang.org/methods/3\" rel=\"nofollow noreferrer\">tour.golang.org/methods/3</a>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1567942845, "post_id": 57841244, "comment_id": 102110841, "body": "&quot; I can&#39;t even compare s1 to s2.&quot; You can compare <code>s1</code> and <code>s2</code>. For example <a href=\"https://play.golang.org/p/tDjoLy7Yggm\" rel=\"nofollow noreferrer\">play.golang.org/p/tDjoLy7Yggm</a>"}], "answers": [{"tags": [], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "is_accepted": true, "score": 3, "last_activity_date": 1567943540, "last_edit_date": 1567943540, "creation_date": 1567942142, "answer_id": 57841520, "question_id": 57841244, "link": "https://stackoverflow.com/questions/57841244/difference-between-custom-type-and-primitive-type/57841520#57841520", "title": "Difference between custom type and primitive type", "body": "<p>It is similar to extension methods in other programming languages. You can add your own behavior to your type (and cannot in standard type):</p>\n\n<pre><code>type MyStr string\n\nfunc (s MyStr) Length() int {\n    return len(string(s))\n}\n\nfunc main() {\n    s := MyStr(\"hello\")\n    fmt.Println(s.Length())\n}\n</code></pre>\n"}], "owner": {"reputation": 1559, "user_id": 1197768, "user_type": "registered", "accept_rate": 35, "profile_image": "https://i.stack.imgur.com/oQXRV.jpg?s=128&g=1", "display_name": "sabu", "link": "https://stackoverflow.com/users/1197768/sabu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 57841520, "answer_count": 1, "score": 0, "last_activity_date": 1567943540, "creation_date": 1567939722, "last_edit_date": 1567942414, "question_id": 57841244, "link": "https://stackoverflow.com/questions/57841244/difference-between-custom-type-and-primitive-type", "title": "Difference between custom type and primitive type", "body": "<p>I have a quick doubt about Go types.</p>\n\n<pre><code>type mystr string\nvar s1 mystr = \"abc\"\nvar s2 string = \"abc\"\n</code></pre>\n\n<p>Here s1 always takes string type which is similar to s2. My question is, why defining such <em>types</em> are allowed (which are of primitive types) in Go. When I can't even compare s1 to s2 </p>\n\n<pre><code>if s1 == s2 // compilation error\n</code></pre>\n\n<p>What can be the use case to such scenario? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1567958955, "post_id": 57841141, "comment_id": 102114451, "body": "Are you by any chance writing your source files under /usr/local/go/src/strings? Looks like you have a file (reader.go) that declares a package &quot;filedirs&quot; under /usr/local/go/src/strings"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1567964462, "post_id": 57841141, "comment_id": 102115862, "body": "your setup is seriously broken. you should not have a different tree than <a href=\"https://golang.org/src/strings/\" rel=\"nofollow noreferrer\">golang.org/src/strings</a> (assuming you run latest)"}, {"owner": {"reputation": 933, "user_id": 1124976, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/3f8b88ad6b0c9b0a4d76e4085284d60a?s=128&d=identicon&r=PG", "display_name": "yumugee", "link": "https://stackoverflow.com/users/1124976/yumugee"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1567979654, "post_id": 57841141, "comment_id": 102119241, "body": "I put my project folders in /Users/yumugee/Projects/go/src/go_cookbook/  I can run the program if I remove the codes above. @bserdar"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 2, "creation_date": 1567980041, "post_id": 57841141, "comment_id": 102119310, "body": "That message above is complaining above the go stdlib source dirs. So it is possible that your setup is broken. If I were you, I&#39;d remove /usr/local/go, reinstall go, and try again."}, {"owner": {"reputation": 933, "user_id": 1124976, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/3f8b88ad6b0c9b0a4d76e4085284d60a?s=128&d=identicon&r=PG", "display_name": "yumugee", "link": "https://stackoverflow.com/users/1124976/yumugee"}, "edited": false, "score": 0, "creation_date": 1567981962, "post_id": 57841141, "comment_id": 102119621, "body": "ok, I&#39;ll try to reinstall go. thank you very much bserdar"}], "owner": {"reputation": 933, "user_id": 1124976, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/3f8b88ad6b0c9b0a4d76e4085284d60a?s=128&d=identicon&r=PG", "display_name": "yumugee", "link": "https://stackoverflow.com/users/1124976/yumugee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567981862, "creation_date": 1567938901, "last_edit_date": 1567981862, "question_id": 57841141, "link": "https://stackoverflow.com/questions/57841141/found-packages-strings-build-go-and-filedirsreader-go-in-usr-local-go-src-s", "title": "found packages strings (build.go) and filedirs(reader.go) in /usr/local/go/src/strings", "body": "<p>I almost give up, just learned go and already having problems</p>\n\n<p><a href=\"https://i.stack.imgur.com/0RKqY.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0RKqY.png\" alt=\"enter image description here\"></a></p>\n\n<p>these are lines that causes trouble</p>\n\n<pre><code>s := strings.ToUpper(tmp.String())\nif _, err := io.Copy(f2, strings.NewReader(s)); err != nil {\n    return err\n}\n</code></pre>\n\n<p>I followed tutorial from packtub. please help me how to solve it. thanks</p>\n\n<p>edit:\nthis is what I put in .bash_profile</p>\n\n<pre><code>export GOPATH=$HOME/Projects/go\nexport PATH=$PATH:$GOPATH/bin\nexport GOROOT=/usr/local/go\nexport PATH=$PATH:$GOROOT/bin\n</code></pre>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567935908, "post_id": 57840793, "comment_id": 102109426, "body": "You&#39;ve implemented the delete method on a pointer receiver type (<code>func (_m *MockDaoInterface) DeleteS3Image</code>), so you need to pass in a pointer <code>s.dao.s3 = &amp;MockDaoInterface{}</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567936150, "post_id": 57840793, "comment_id": 102109471, "body": "... also if you read the error message, the issue should become clear. <i>&quot;MockDaoInterface does not implement s3.DaoInterface (<b>DeleteS3Image method has pointer receiver</b>)&quot;</i>"}, {"owner": {"reputation": 109, "user_id": 11964380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b67e002f405c9ae7c855284e914fe2?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v5", "link": "https://stackoverflow.com/users/11964380/jpskgc-v5"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567941327, "post_id": 57840793, "comment_id": 102110506, "body": "I changed to <code>s.dao.s3 = &amp;MockDaoInterface{}</code>, and then another compile error occurs.  <code>cannot use &amp;MockDaoInterface literal (type *MockDaoInterface) as type s3.DaoInterface in assignment: \t*MockDaoInterface does not implement s3.DaoInterface (missing PostImageToS3 method)</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567941520, "post_id": 57840793, "comment_id": 102110567, "body": "again the message is clear, you need to implement all of the methods of that interface. You original example has only DeleteS3Image method declared in the interface, so that&#39;s all you need to implement in that case. However if your actual interface has more methods, then you need to implement them all to be able to use the Mock and the also the <code>*s3.S3</code> needs to implement all of them, not just Delete."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567941769, "post_id": 57840793, "comment_id": 102110616, "body": "... note also that in Go, interfaces are satisfied <i>implicitly</i>. For a type <code>T</code> to satisfy the interface <code>I</code>, type <code>T</code> <i>MUST</i> implement all of the methods declared by the interface <code>I</code>."}, {"owner": {"reputation": 109, "user_id": 11964380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b67e002f405c9ae7c855284e914fe2?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v5", "link": "https://stackoverflow.com/users/11964380/jpskgc-v5"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567942807, "post_id": 57840793, "comment_id": 102110832, "body": "Thanks for comment. Issue is resolved."}], "owner": {"reputation": 109, "user_id": 11964380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b67e002f405c9ae7c855284e914fe2?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v5", "link": "https://stackoverflow.com/users/11964380/jpskgc-v5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "closed_date": 1567935965, "answer_count": 0, "score": 0, "last_activity_date": 1567935608, "creation_date": 1567935608, "question_id": 57840793, "link": "https://stackoverflow.com/questions/57840793/cannot-use-mockdaointerface-literal-type-mockdaointerface-as-type-s3-daointerf", "closed_reason": "Duplicate", "title": "cannot use MockDaoInterface literal (type MockDaoInterface) as type s3.DaoInterface in assignment: MockDaoInterface does not implement s3.DaoInterface", "body": "<p>I'm setting unit test for api(golang).<br>\nI try to set mocking, but there is compile error.<br>\nI want to resolve this error to run test.<br></p>\n\n<pre><code>article\n  \u251c client\n  \u251c api\n  \u2502  \u251c main.go\n  \u2502  \u251c contoroller\n  \u2502  \u2502    \u251c contoroller.go\n  \u2502  \u2502    \u2514 contoroller_test.go\n  \u2502  \u251c service\n  \u2502  \u2502    \u251c service.go\n  \u2502  \u2502    \u2514 service_test.go\n  \u2502  \u251c dao\n  \u2502  \u2502    \u251c dao.go\n  \u2502  \u2502    \u2514 dao_test.go\n  \u2502  \u251c s3\n  \u2502  \u2502    \u251c s3.go\n  \u2502  \u2502    \u2514 s3_test.go\n  \u2502  \u251c go.mod \n  \u2502  \u251c go.sum\n  \u2502  \u2514 Dockerfile\n  \u251c nginx\n  \u2514 docker-compose.yml\n</code></pre>\n\n<p>Now I'm trying to set <code>dao_test.go</code>.<br>\nBut compile error occurs in <code>dao_test.go</code> at <code>SetupTest()</code>.<br></p>\n\n<p>dao_test.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package dao\n\n//import\n\ntype MockDaoInterface struct {\n}\n\nfunc (_m *MockDaoInterface) DeleteS3Image(imageName util.ImageName) error {\n    return nil\n}\n\ntype DaoSuite struct {\n    suite.Suite\n    db   *sql.DB\n    mock sqlmock.Sqlmock\n    s3   s3.DaoInterface\n    dao  *Dao\n}\n\nfunc (s *DaoSuite) SetupTest() {\n\n    var err error\n    s.db, s.mock, err = sqlmock.New()\n    s.Require().NoError(err)\n    s.dao = NewDao(s.db, s.s3)\n\n    // here error occurs \n    s.dao.s3 = MockDaoInterface{}\n}\n\nfunc (s *DaoSuite) TestDeleteArticleDao() {\n\n    // some codes\n\n    s.dao.DeleteArticleDao(\"1\")\n\n}\n</code></pre>\n\n<p>dao.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package dao\n\n// import\n\ntype Dao struct {\n    database *sql.DB\n    s3       s3.DaoInterface\n}\n\nfunc NewDao(database *sql.DB, s3 s3.DaoInterface) *Dao {\n    objs := &amp;Dao{database: database, s3: s3}\n    return objs\n}\n\nfunc (d *Dao) DeleteArticleDao(id string) {\n    d.s3.DeleteS3Image(imageName)\n}\n</code></pre>\n\n<p>s3.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package s3\n\n//import\n\ntype S3 struct {\n    APPID  string\n    SECRET string\n}\n\ntype DaoInterface interface {\n    DeleteS3Image(imageName util.ImageName) error\n}\n\nfunc NewS3(appid, secret string) *S3 {\n    objs := &amp;S3{APPID: appid, SECRET: secret}\n    return objs\n}\n\n\nfunc (objs *S3) DeleteS3Image(imageName util.ImageName) error {\n    // method\n}\n</code></pre>\n\n<p>The full source code is here(fix-test-dao):<br>\n<a href=\"https://github.com/jpskgc/article/tree/fix-test-dao\" rel=\"nofollow noreferrer\">https://github.com/jpskgc/article/tree/fix-test-dao</a></p>\n\n<p>I expect there is not compile error in <code>dao_test.go</code> at <code>SetupTest()</code>.<br>\nBut the actual is not.<br>\nI want to resolve error and make test success.<br></p>\n\n<p>Here is the error message.<br></p>\n\n<pre><code>type MockDaoInterface struct{Mock}\n\ncannot use MockDaoInterface literal (type MockDaoInterface) as type s3.DaoInterface in assignment:\n\nMockDaoInterface does not implement s3.DaoInterface (DeleteS3Image method has pointer receiver)\n</code></pre>\n"}, {"tags": ["maven", "go", "protocol-buffers"], "answers": [{"tags": [], "owner": {"reputation": 693, "user_id": 1802697, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eH3MJ.jpg?s=128&g=1", "display_name": "Igor Maznitsa", "link": "https://stackoverflow.com/users/1802697/igor-maznitsa"}, "is_accepted": false, "score": 1, "last_activity_date": 1568151184, "creation_date": 1568151184, "answer_id": 57878477, "question_id": 57840738, "link": "https://stackoverflow.com/questions/57840738/protobuf-maven-plugin-compile-to-golang/57878477#57878477", "title": "protobuf-maven-plugin compile to golang", "body": "<p>there is <a href=\"https://github.com/raydac/mvn-golang\" rel=\"nofollow noreferrer\">special plugin for maven</a> to work with golang, so that it can be used in maven project infrastructure with Java, I made some example of \"how to\" <a href=\"https://github.com/raydac/mvn-golang/tree/master/mvn-golang-examples/mvn-golang-example-protobuf\" rel=\"nofollow noreferrer\">generate Go from protobuf scripts in maven</a>  </p>\n"}], "owner": {"reputation": 503, "user_id": 3119683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/916ca706f893e505e66bfae6cbef5067?s=128&d=identicon&r=PG&f=1", "display_name": "gromi08", "link": "https://stackoverflow.com/users/3119683/gromi08"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568151184, "creation_date": 1567935180, "question_id": 57840738, "link": "https://stackoverflow.com/questions/57840738/protobuf-maven-plugin-compile-to-golang", "title": "protobuf-maven-plugin compile to golang", "body": "<p>I need to generate source files from the same .proto file to both Java and Go (golang).\nThe <code>protobuf-maven-plugin</code> has the <code>compile</code> goal for Java, but no <code>compile-go</code> goal for golang.</p>\n\n<p>Any idea how to do that?\nThanks</p>\n"}, {"tags": ["mongodb", "docker", "go", "docker-compose", "protocol-buffers"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1567934737, "post_id": 57840017, "comment_id": 102109202, "body": "Please add a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> to <a href=\"https://stackoverflow.com/posts/57840017/edit\">the question itself by editing it</a> . Should the link become invalid, the question as well as the answers might not make any sense."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1567934969, "post_id": 57840017, "comment_id": 102109244, "body": "Adding excerpts of your mongod.conf would not harm either, specifically the <code>replication</code> and <code>net</code> sections."}], "owner": {"reputation": 41, "user_id": 11992766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07bf9dadf87454587b0abffa158cfa9e?s=128&d=identicon&r=PG&f=1", "display_name": "temps hd", "link": "https://stackoverflow.com/users/11992766/temps-hd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567928427, "creation_date": 1567928427, "question_id": 57840017, "link": "https://stackoverflow.com/questions/57840017/using-mongdb-in-docker-with-go", "title": "using mongdb in docker with Go", "body": "<p>i tried to run MongoDB in docker-compose and connect my Go server with MongoDB in docker seem not to work for me, thought i already use <code>mongodb:MyContanerName:27017</code></p>\n\n<p>when i run my go server and then i tired to request on my client, the error something like this </p>\n\n<pre><code>2019/09/08 14:10:37 Unexpected error: rpc error: code = Internal desc = internal error: server selection error: server selection timeout\ncurrent topology: Type: Unknown\nServers:\nAddr: mongo:27017, Type: Unknown, State: Connected, Average RTT: 0, Last error: connection(mongo:27017[-125]) connection is closed\n</code></pre>\n\n<p>i already did docker-compose up -d for my docker, and it was running on my docker ,</p>\n\n<p>the full code is trigger here <a href=\"https://slexy.org/view/s206Zrx5GN\" rel=\"nofollow noreferrer\">golang and mongodb</a></p>\n"}, {"tags": ["go", "memory", "gdb"], "comments": [{"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 2, "creation_date": 1567925763, "post_id": 57839327, "comment_id": 102107742, "body": "Go initializes things to their zero values so you could just be seeing the 400 new empty entries in the map. Hard to say without code to demonstrate what you&#39;re seeing."}, {"owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 2, "creation_date": 1567930648, "post_id": 57839327, "comment_id": 102108472, "body": "gdb is good for C and C++. A debugger with better support for Go is delve, which is a pleasure to use. See <a href=\"https://github.com/go-delve/delve\" rel=\"nofollow noreferrer\">github.com/go-delve/delve</a>"}, {"owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 2, "creation_date": 1567931034, "post_id": 57839327, "comment_id": 102108544, "body": "Hello, welcome to stackoverflow! Have a look at <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">stackoverflow.com/help/minimal-reproducible-example</a> for how to make it easier for people to help you"}], "owner": {"reputation": 1, "user_id": 12036459, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-qeWI6DLI_so/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reWXUNNR8tZel2U4cZC2WCtQ3Y5Tw/photo.jpg?sz=128", "display_name": "Ke Wang", "link": "https://stackoverflow.com/users/12036459/ke-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567930784, "creation_date": 1567919295, "last_edit_date": 1567930784, "question_id": 57839327, "link": "https://stackoverflow.com/questions/57839327/why-gdb-shows-all-zero-values-for-a-large-map", "title": "Why GDB shows all zero values for a large map", "body": "<p>I am a newbie in GDB/Go. I try to use GDB to debug a performance problem, where increasing an (already-large, ~800K entries) map by a few items (~400 entries) suddenly speeds up processing. I guess this is related to memory. I tried to print out the map variable in GDB before and after adding those entries, as shown in the attached screenshots. In the slightly-bigger-map case, all the values printed by GDB are zero. Does anybody know what is causing this? I am guessing this is related to some memory optimizations performed by Go.</p>\n\n<p><a href=\"https://i.stack.imgur.com/YcGmX.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/YcGmX.jpg\" alt=\"GDB screenshot with a bigger map showing all zero values\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/YMgYo.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/YMgYo.jpg\" alt=\"GDB screenshot with a slightly-small map showing normal values\"></a></p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "owner": {"reputation": 361, "user_id": 4205778, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh3.googleusercontent.com/-67ocuJiNWxI/AAAAAAAAAAI/AAAAAAAAAFQ/fbNxuIQOe1M/photo.jpg?sz=128", "display_name": "Rakin Alam", "link": "https://stackoverflow.com/users/4205778/rakin-alam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1440, "favorite_count": 2, "answer_count": 0, "score": 1, "last_activity_date": 1567906325, "creation_date": 1567906325, "question_id": 57838559, "link": "https://stackoverflow.com/questions/57838559/gorm-database-colum-with-json-data", "title": "GORM database colum with json data", "body": "<p>I am trying to write an email service, where I want to store some data related to email into a Postgres DB using gorm. I have a field which needs to be stored as a JSON blob, which in request passed as a JSON object. When I am trying to migrate, it errors keep saying unsupported type map. When manually add the DB, then run gorm, it doesn't write the row to the database.</p>\n\n<p>I have seen some example where it's using <code>postgres.Json</code> as field types, but I want the field loaded from the request as map[string]string.</p>\n\n<pre><code>// Email : Base with injected fields `UUID`, `CreatedAt`, `UpdatedAt`\ntype Email struct {\n    gorm.Model\n    Status      string             `grom:\"type:varchar(32);not null\"`\n    TemplateID  string             `grom:\"type:varchar(256)\"`\n    ToEmai      string             `grom:\"type:varchar(256);not null\"`\n    FromEmail   string             `grom:\"type:varchar(256);not null\"`\n    ToName      string             `grom:\"type:varchar(256);not null\"`\n    FromName    string             `grom:\"type:varchar(256);not null\"`\n    Subject     string             `grom:\"type:varchar(256)\"`\n    Message     string             `grom:\"type:varchar\"`\n    DynamicData *map[string]string `grom:\"type:json\"`\n}\n</code></pre>\n\n<p>this is my model.</p>\n\n<p>then I do a gin request:</p>\n\n<pre><code>// SendEmail : sends an email\nfunc SendEmail(c *gin.Context) {\n    body, err := ioutil.ReadAll(c.Request.Body)\n\n    if err != nil {\n        log.Error(\"Error reading request body to get rate estimates\")\n    }\n\n    var newEmail = models.Email{\n        Status: \"PENDING\",\n    }\n\n    jsonErr := json.Unmarshal(body, &amp;newEmail)\n\n    if jsonErr != nil {\n        log.Error(jsonErr)\n    }\n\n    database.DB.Create(&amp;newEmail)\n\n    defer c.Request.Body.Close()\n\n    err = newEmail.SendSendgridEmail()\n\n    if err != nil {\n        c.JSON(http.StatusBadRequest, err)\n    } else {\n        c.JSON(http.StatusOK, \"Successfully sent email\")\n    }\n}\n</code></pre>\n\n<p>which then looks into this function</p>\n\n<pre><code>func (e Email) dynamicTemplateEmailBody() []byte {\n    newMail := mail.NewV3Mail()\n\n    emailFrom := mail.NewEmail(e.FromName, e.FromEmail)\n    newMail.SetFrom(emailFrom)\n\n    newMail.SetTemplateID(e.TemplateID)\n\n    p := mail.NewPersonalization()\n    tos := []*mail.Email{\n        mail.NewEmail(e.ToName, e.ToEmai),\n    }\n    p.AddTos(tos...)\n\n    if e.DynamicData != nil {\n        for key, value := range *e.DynamicData {\n            log.Infof(\"%s %s\", key, value)\n            p.SetDynamicTemplateData(key, value)\n        }\n    }\n\n    newMail.AddPersonalizations(p)\n    return mail.GetRequestBody(newMail)\n}\n</code></pre>\n\n<p>I would like to be able to run <code>DB.AutoMigrate(&amp;models.Email{})</code> and automatically migrate the objects, or and when I make a request to the endpoint, the row gets added to my email table.</p>\n"}, {"tags": ["go", "ffmpeg"], "answers": [{"tags": [], "owner": {"reputation": 547, "user_id": 10201437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9066621f4fa9987ca2148edc002bf057?s=128&d=identicon&r=PG&f=1", "display_name": "ConnectionLost", "link": "https://stackoverflow.com/users/10201437/connectionlost"}, "is_accepted": true, "score": 5, "last_activity_date": 1567915660, "creation_date": 1567915660, "answer_id": 57839119, "question_id": 57838025, "link": "https://stackoverflow.com/questions/57838025/get-frame-from-video-bytes/57839119#57839119", "title": "Get frame from video bytes", "body": "<p>You can make <code>ffmpeg</code> to read data from stdin rather than reading file from disk, by specifying <code>-</code> as the value of the option <code>-i</code>. Then just pass your video bytes as stdin to the command.</p>\n\n<pre><code>func ExtractImage(fileBytes []byte){\n\n    // command line args, path, and command\n    command := \"ffmpeg\"\n    frameExtractionTime := \"0:00:05.000\"\n    vframes := \"1\"\n    qv := \"2\"\n    output := \"/home/ubuntu/media/video-to-image/output-\" + time.Now().Format(time.Kitchen) + \".jpg\"\n\n    cmd := exec.Command(command,\n        \"-ss\", frameExtractionTime,\n        \"-i\", \"-\",  // to read from stdin\n        \"-vframes\", vframes,\n        \"-q:v\", qv,\n        output)\n\n    cmd.Stdin = bytes.NewBuffer(fileBytes)\n\n    // run the command and don't wait for it to finish. waiting exec is run\n    // ignore errors for examples-sake\n    _ = cmd.Start()\n    _ = cmd.Wait()\n}\n</code></pre>\n\n<p>You may need to run <code>ffmpeg -protocols</code> to determine if the <code>pipe</code> protocol (to read from stdin) is supported in your build of ffmpeg.</p>\n"}], "owner": {"reputation": 404, "user_id": 5716089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tqyYO.png?s=128&g=1", "display_name": "Kelly Flet", "link": "https://stackoverflow.com/users/5716089/kelly-flet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1156, "favorite_count": 0, "accepted_answer_id": 57839119, "answer_count": 1, "score": 2, "last_activity_date": 1567915660, "creation_date": 1567897401, "question_id": 57838025, "link": "https://stackoverflow.com/questions/57838025/get-frame-from-video-bytes", "title": "Get frame from video bytes", "body": "<p>I'm extracting a frame from a video using ffmpeg and golang. If I have a video in bytes instead of saved on disk as an .mp4, how do I tell ffmpeg to read from those bytes without having to write the file to disk, as that is much slower?</p>\n\n<p>I have this working reading from a file, but I'm not sure how to read from bytes.</p>\n\n<p>I've looked at the <code>ffmpeg</code> documentation <a href=\"https://www.ffmpeg.org/ffmpeg.html#toc-Stream-selection\" rel=\"nofollow noreferrer\">here</a> but only see output examples instead of input examples.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func ExtractImage(fileBytes []byte){\n\n    // command line args, path, and command\n    command = \"ffmpeg\"\n    frameExtractionTime := \"0:00:05.000\"\n    vframes := \"1\"\n    qv := \"2\"\n    output := \"/home/ubuntu/media/video-to-image/output-\" + time.Now().Format(time.Kitchen) + \".jpg\"\n\n    // TODO: use fileBytes instead of videoPath\n    // create the command\n    cmd := exec.Command(command,\n        \"-ss\", frameExtractionTime,\n        \"-i\", videoPath,\n        \"-vframes\", vframes,\n        \"-q:v\", qv,\n        output)\n\n    // run the command and don't wait for it to finish. waiting exec is run\n    // ignore errors for examples-sake\n    _ = cmd.Start()\n    _ = cmd.Wait()\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1567891979, "post_id": 57837595, "comment_id": 102103396, "body": "What is the question?"}, {"owner": {"reputation": 12662, "user_id": 997162, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/M5HoQ.png?s=128&g=1", "display_name": "emix", "link": "https://stackoverflow.com/users/997162/emix"}, "edited": false, "score": 0, "creation_date": 1567893370, "post_id": 57837595, "comment_id": 102103665, "body": "The question is usually inside the question, on top of the page."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 6, "last_activity_date": 1567933700, "creation_date": 1567933700, "answer_id": 57840560, "question_id": 57837595, "link": "https://stackoverflow.com/questions/57837595/how-to-display-custom-error-and-abort-in-golang-gin/57840560#57840560", "title": "How to display custom error and abort in Golang Gin", "body": "<p><a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.Abort\" rel=\"noreferrer\"><code>Abort</code></a>, as stated in the documentation, is for aborting the chain of middleware, not to stop the current handler from executing.</p>\n\n<p>The error checking is a <em>feature</em> of Go and you'll just have to do it, the same as everyone else.</p>\n\n<p>However you can simplify your error checking to some extent. For example one solution could be something like this:</p>\n\n<pre><code>func Error(c *gin.Context, err error) bool {\n    if err != nil {\n        c.Error(err)\n        c.AbortWithStatusJSON(200, gin.H{\"status\": false, \"message\": err.Error()})\n        return true // signal that there was an error and the caller should return\n    }\n    return false // no error, can continue\n}\n</code></pre>\n\n<p>And then your handler would look like this:</p>\n\n<pre><code>func MyHandler(c *gin.Context) {\n    f, err := os.Create(file)\n    if Error(c, err) {\n        return // exit\n    }\n\n    // continue\n}\n</code></pre>\n\n<hr>\n\n<p>Another approach, and in my mind the more idiomatic one, would be to change the handler to have an error return argument and then have a wrapper that takes these error-returning handlers and returns a valid gin handler, and then this returned gin handler can deal with the error value however you see fit.</p>\n\n<pre><code>// error returning handler\nfunc MyHandler(c *gin.Context) error {\n    f, err := os.Create(file)\n    if err != nil {\n        return err // exit\n    }\n\n    // do other stuff...\n\n    return nil // all good\n}\n\n// function that turns the error-returning handler into a valid gin handler\nfunc GinHandler(myhandler func(c *gin.Context) error) (ginhandler func(c *gin.Context)) {\n    return func(c *gin.Context) {\n        if err := myhandler(c); err != nil {\n            c.Error(err)\n            c.AbortWithStatusJSON(200, gin.H{\"status\": false, \"message\": err.Error()})\n        }\n    }\n}\n\n// and you would register the MyHandler like so...\nrouter := gin.Default()\nrouter.GET(\"/foobar\", GinHandler(MyHandler))\n</code></pre>\n"}], "owner": {"reputation": 378, "user_id": 2661434, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/wlA7d.png?s=128&g=1", "display_name": "Ram", "link": "https://stackoverflow.com/users/2661434/ram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2446, "favorite_count": 1, "accepted_answer_id": 57840560, "answer_count": 1, "score": 5, "last_activity_date": 1568547181, "creation_date": 1567891768, "last_edit_date": 1568547181, "question_id": 57837595, "link": "https://stackoverflow.com/questions/57837595/how-to-display-custom-error-and-abort-in-golang-gin", "title": "How to display custom error and abort in Golang Gin", "body": "<p>I want to Abort with status and json body if any errors. i don't want to use repeated if condition over and over again.</p>\n\n<pre><code>f, err := os.Create(file)\n\nif(err != nil){\n  c.JSON(200, gin.H{\"error\": true,\"message\":err.Error() })\n  return\n}\n</code></pre>\n\n<hr>\n\n<pre><code>f, err := os.Create(file)\nError(c,err)\n</code></pre>\n\n<p>but this function is not aborting</p>\n\n<pre><code>func Error(c *gin.Context,err error) {\n  if(err != nil){\n  c.JSON(200, gin.H{\"status\": false,\"message\":err.Error() })\n  c.Error(err)\n  c.Abort()\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1567894821, "post_id": 57837339, "comment_id": 102103872, "body": "thanks for the anwer, it actualy works as I first asked, but not working inside function :/ , please see updated"}], "tags": [], "owner": {"reputation": 2318, "user_id": 3113342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1377178fbcffbcf5cf1e47eef38d5a8?s=128&d=identicon&r=PG", "display_name": "Austin", "link": "https://stackoverflow.com/users/3113342/austin"}, "is_accepted": true, "score": 2, "last_activity_date": 1567923463, "last_edit_date": 1567923463, "creation_date": 1567889065, "answer_id": 57837339, "question_id": 57837224, "link": "https://stackoverflow.com/questions/57837224/how-to-assign-value-to-nested-struct-using-reflect/57837339#57837339", "title": "how to assign value to nested struct using reflect", "body": "<p>You need to select the third field of the outer struct before you select the first field of the inner struct. I.e.,</p>\n\n<pre><code>rt2 := t.Field(2)\nrt2_1 := rt2.Type.Field(0)\nfield2 := where.FieldByIndex(rt2.Index).FieldByIndex(rt2_1.Index)\nfield2.SetString(\"hello2\") // Will assign to the inner struct now.\n</code></pre>\n\n<p>Edit: The code in the edited question makes a similar mistake in that it does not fetch the field of the outer struct first. Additionally, it overrides the value of field repeatedly in a way that probably doesn't do what is intended. Something like this should work:</p>\n\n<pre><code>func findAssing(me string, rt reflect.StructField, field reflect.Value) {\n    subField := field.FieldByIndex(rt.Index)\n    if rt.Type.Kind() == reflect.Struct {\n        max := rt.Type.NumField()\n        for i := 0; i &lt; max; i++ {\n            findAssing(me, rt.Type.Field(i), subField)\n        }\n    } else {\n        subField.SetString(\"hello\")\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1567972113, "post_id": 57841451, "comment_id": 102117725, "body": "thanks for the answer but I need to know the tag inside the field in order to set a value to it, that is why I need reflect.StructField, I can&#39;t have it just but using reflect.Value,"}, {"owner": {"reputation": 21, "user_id": 9968487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1be22ffef770ab45cdcb49d715938f78?s=128&d=identicon&r=PG&f=1", "display_name": "Dimmzyy", "link": "https://stackoverflow.com/users/9968487/dimmzyy"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1567984630, "post_id": 57841451, "comment_id": 102119982, "body": "@JohnBalvinArias The requirement is not stated or implied by anything in the question. The struct field is available as t.Field(i) in the previous version of the answer. I edited the answer to make this more clear (see variable sf, a value of type reflect.StructField)."}], "tags": [], "owner": {"reputation": 21, "user_id": 9968487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1be22ffef770ab45cdcb49d715938f78?s=128&d=identicon&r=PG&f=1", "display_name": "Dimmzyy", "link": "https://stackoverflow.com/users/9968487/dimmzyy"}, "is_accepted": false, "score": 2, "last_activity_date": 1567977440, "last_edit_date": 1567977440, "creation_date": 1567941529, "answer_id": 57841451, "question_id": 57837224, "link": "https://stackoverflow.com/questions/57837224/how-to-assign-value-to-nested-struct-using-reflect/57841451#57841451", "title": "how to assign value to nested struct using reflect", "body": "<p>If your goal is recursively  set all string fields to some value, then use the following code. You don't say what the code is supposed to do, so this is just a guess.</p>\n\n<pre><code>func main() {\n    var ah myStruct1\n    setStringsInStruct(\"hello\", reflect.ValueOf(&amp;ah).Elem())\n    fmt.Printf(\"%+v\\n\", ah)\n}\n\nfunc setStringsInStruct(s string, v reflect.Value) {\n    t := v.Type()\n    for i := 0; i &lt; t.NumField(); i++ {\n        sf := t.Field(i)\n        switch sf.Type.Kind() {\n        case reflect.Struct:\n            setStringsInStruct(s, v.Field(i))\n        case reflect.String:\n            v.Field(i).SetString(s)\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/YVjMpk1qMtb\" rel=\"nofollow noreferrer\">https://play.golang.org/p/YVjMpk1qMtb</a></p>\n"}], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 57837339, "answer_count": 2, "score": 0, "last_activity_date": 1567977440, "creation_date": 1567888022, "last_edit_date": 1567899912, "question_id": 57837224, "link": "https://stackoverflow.com/questions/57837224/how-to-assign-value-to-nested-struct-using-reflect", "title": "how to assign value to nested struct using reflect", "body": "<p>***see updated field at the bottom,please**** </p>\n\n<p>I want to assign a value to a nested struct but it does not work:</p>\n\n<p>try code <a href=\"https://play.golang.org/p/M93S28TsSqi\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code> type MyStruct2 struct {\n    Value3 string\n}\ntype myStruct1 struct {\n    Value1    string\n    Value2    int\n    MyStruct2 MyStruct2\n}\n\nfunc main() {\n    var ah myStruct1 \n    t := reflect.TypeOf(ah)\n    where := reflect.ValueOf(&amp;ah).Elem()\n\n    rt0 := t.Field(0)\n    field0 := where.FieldByIndex(rt0.Index)\n    field0.SetString(\"hello\") \n\n    rt1 := t.Field(1)\n    field1 := where.FieldByIndex(rt1.Index)\n    field1.SetInt(4)\n\n    rt2 := t.Field(2)\n    rt2_1:=rt2.Type.Field(0)\n    field2 := where.FieldByIndex(rt2_1.Index)\n    field2.SetString(\"hello2\")//not assigning to struct\n\n    fmt.Printf(\"%+v\\n\",ah)\n}\n</code></pre>\n\n<p>output: {Value1:hello2 Value2:4 MyStruct2:{Value3:}}</p>\n\n<p>As you can see, it's not assigning a value to the nested struct</p>\n\n<p>//\nupdate:</p>\n\n<p>as @Austin said this is solved by using: </p>\n\n<pre><code>field2 :=where.FieldByIndex(rt2.Index).FieldByIndex(rt2_1.Index)\n</code></pre>\n\n<p>instead, but it's not working inside function:</p>\n\n<p>try code <a href=\"https://play.golang.org/p/cuhR9aIUOTf\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code>type MyStruct2 struct {\n    Value3 string\n}\ntype myStruct1 struct {\n    Value1    string\n    Value2    string\n    MyStruct2 MyStruct2\n}\n\nfunc main() {\n    var ah myStruct1\n    t := reflect.TypeOf(ah)\n    where := reflect.ValueOf(&amp;ah).Elem()\n    max := t.NumField()\n    for i := 0; i &lt; max; i++ {\n        f := t.Field(i)\n        findAssing(\"hello\", f, where)\n    }\n    fmt.Printf(\"%+v\\n\", ah)\n}\n\nfunc findAssing(me string, rt reflect.StructField, field reflect.Value) {\n    if rt.Type.Kind() == reflect.Struct {\n        max := rt.Type.NumField()\n        for i := 0; i &lt; max; i++ {\n            if rt.Type.Field(i).Type.Kind() == reflect.Struct {\n                field = field.FieldByIndex(rt.Type.Field(i).Index)\n            }\n            findAssing(me, rt.Type.Field(i), field)\n        }\n    } else {\n        field = field.FieldByIndex(rt.Index)\n        field.SetString(\"hello\")\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "websocket", "webassembly"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1567878763, "post_id": 57835979, "comment_id": 102100711, "body": "Two things: First: are you sure the sender managed to send the message before the loop terminates? Second: What&#39;s the point of the tight loop? The receiver goroutine will only have a chance to execute when you run the Sleep() statement in the loop. It might be executing when it starts waiting at &lt;-c"}, {"owner": {"reputation": 341, "user_id": 5526180, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/TXrPk.jpg?s=128&g=1", "display_name": "mahmoud fathy", "link": "https://stackoverflow.com/users/5526180/mahmoud-fathy"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1567881197, "post_id": 57835979, "comment_id": 102101274, "body": "There&#39;s no point of the loop of course , it is just a part of a bigger program and I am highlighting the specific issue. A Sleep will work btw, but it will panic if called after the &lt;-c ."}, {"owner": {"reputation": 341, "user_id": 5526180, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/TXrPk.jpg?s=128&g=1", "display_name": "mahmoud fathy", "link": "https://stackoverflow.com/users/5526180/mahmoud-fathy"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1567881283, "post_id": 57835979, "comment_id": 102101288, "body": "Yes, I am sure sender.go sends the message during the for loop , that&#39;s why I make this print statements inside the for loop"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1567881570, "post_id": 57835979, "comment_id": 102101347, "body": "I&#39;d try this without the for loop. As far as I can see, there&#39;s nothing that writes to the c channel, so &lt;-c should block. Without the for loop, that should let the receiver goroutine to execute. The receiver goroutine will not execute if you&#39;re running a tight loop in the active goroutine."}, {"owner": {"reputation": 341, "user_id": 5526180, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/TXrPk.jpg?s=128&g=1", "display_name": "mahmoud fathy", "link": "https://stackoverflow.com/users/5526180/mahmoud-fathy"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1567885500, "post_id": 57835979, "comment_id": 102102241, "body": "This for loop executes a mining operation in a blockchain example , I am writing the minimum part to reproduce the issue. I am not trying to provide meaning."}], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 3, "last_activity_date": 1567890315, "creation_date": 1567890315, "answer_id": 57837467, "question_id": 57835979, "link": "https://stackoverflow.com/questions/57835979/syscall-js-websocket-callback-does-not-respond-in-non-blocking-behaviour/57837467#57837467", "title": "syscall/js websocket callback does not respond in non-blocking behaviour", "body": "<p>First, note that if you are generating wasm Go code, it's not multi-threaded, at least not today (September 2019).  See\n<a href=\"https://stackoverflow.com/q/57114522/1256452\">How to implement multithreading in wasm created using golang?</a>  So there's only one actual execution thread.</p>\n\n<p>Then, remember that goroutines are <em>cooperatively</em> multi-tasked onto whatever threads are available.  Since there's only one thread, there's only one goroutine running at any time.  If your running goroutine does not give up the processor to other goroutines, those other goroutines won't run.</p>\n\n<p>You can give up the processor implicitly\u2014for instance, by waiting on a channel or a mutex\u2014or explictly, via <a href=\"https://golang.org/pkg/time/#Sleep\" rel=\"nofollow noreferrer\"><code>time.Sleep</code></a> or <a href=\"https://golang.org/pkg/runtime/#Gosched\" rel=\"nofollow noreferrer\"><code>runtime.Gosched</code></a>.  Without such a call, any goroutine that would notice the incoming message never gets a chance to see it, and your callback\u2014which will run in this or some third goroutine\u2014never gets called.</p>\n\n<p>(If you run natively, rather than in wasm, you will generally get more threads and will be able to have other CPUs run other tasks even while one is in a tight loop.)</p>\n"}], "owner": {"reputation": 341, "user_id": 5526180, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/TXrPk.jpg?s=128&g=1", "display_name": "mahmoud fathy", "link": "https://stackoverflow.com/users/5526180/mahmoud-fathy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567892444, "creation_date": 1567877290, "last_edit_date": 1567892444, "question_id": 57835979, "link": "https://stackoverflow.com/questions/57835979/syscall-js-websocket-callback-does-not-respond-in-non-blocking-behaviour", "title": "syscall/js websocket callback does not respond in non-blocking behaviour", "body": "<p>I have two processes running, written in Go in which one (sender.go) sends a message to another (listener.go) while being stuck in a for loop via websockets.</p>\n\n<p>The issue is that listener.go only realizes it received the message after it terminates the loop.</p>\n\n<p>I have tried several websocket libraries, I even tried using regular tcp streams, but it won't work when compiled in webassembly because browser won't support it. The syscall/js websocket seemed to be the perfect fit despite this behaviour.</p>\n\n<p>here's listener.go </p>\n\n<pre><code>func registerCallbacks(ws js.Value) {\n    ws.Call(\"addEventListener\", \"message\", js.FuncOf(func(this js.Value, args []js.Value) interface{} {\n        message := args[0].Get(\"data\").String()\n        fmt.Println(\"message received \")\n        fmt.Println(message)\n        return nil\n    }))\n}\n\n\nfunc main() {\n    c := make(chan struct{}, 0)\n    toIP := \"127.0.0.1\"\n    toPort := 8081\n    ws := js.Global().Get(\"WebSocket\").New(fmt.Sprintf(\"ws://%s:%d/ws\", toIP, toPort))\n    registerCallbacks(ws)\n    const bigNum uint64 = 100000 * 10000\n    cb := func(this js.Value, args []js.Value) interface{} {\n      for i := uint64(0); i &lt; bigNum; i++ {\n        doThings()\n        if i%10000000 == 0 {\n            fmt.Println(\"skimmed ten millions \")\n        }\n      }\n      fmt.Println(\"Exited for loop !!\")\n      return nil\n    }\n    // call cb() in script of index.html from a button\n    js.Global().Set(\"cb\", js.FuncOf(cb))\n    &lt;-c\n}\n</code></pre>\n\n<p>So is sender.go,</p>\n\n<pre><code>func main() {\n    toIP := \"127.0.0.1\"\n    toPort := 8081\n    ws := js.Global().Get(\"WebSocket\").New(fmt.Sprintf(\"ws://%s:%d/ws\", toIP, toPort))\n    time.Sleep(1 * time.Second)\n    fmt.Println(\"sending  \")\n    ws.Call(\"send\", js.ValueOf(\"msg\"))\n    fmt.Println(\"Program exit  \")\n}\n</code></pre>\n\n<p>If someone's willing to reproduce the issue here's the websocket server which receives message from sender to forward it to receiver, written in node.js, just copy and paste this, it works fine with several projects</p>\n\n<pre><code>const port = 8081;\nconst host = '127.0.0.1';\n\nvar WebSocketServer = require('websocket').server;\nvar http = require('http');\n\nvar server = http.createServer(function(request, response) {});\n\nserver.listen(port, host, () =&gt; {\n    console.log('WS Server is running on port ' + port + '.');\n});\n\nwsServer = new WebSocketServer({\n    httpServer: server\n});\n\nlet sockets = [];\n\n\nwsServer.on('request', function(request) {\n  var connection = request.accept(null, request.origin);\n  sockets.push(connection)\n  console.log(\"Connection with node initiated\")\n  connection.on('message', function(message) {\n    console.log(\"message received \"+message)\n    sockets.forEach(function(s, index, array) {\n      if (message.type === 'utf8') {\n        broadcastData = message.utf8Data\n        console.log(\"message is: \"+ broadcastData)\n        if(s!= connection) {\n          console.log('send data to ' + s.socket.remotePort + ': ' + broadcastData);\n          s.sendUTF(broadcastData)\n        }\n      }\n    });\n  });\n});\n</code></pre>\n\n<p>I am expecting listener.go to receive message before it exits the for loop</p>\n\n<p>PS: Using sleep statement is not a good help , because when this for loop runs inside a js callback, the sleep statement outputs a panic.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1567876463, "post_id": 57835861, "comment_id": 102100121, "body": "That&#39;s not a font issue, it&#39;s an encoding issue."}], "answers": [{"comments": [{"owner": {"reputation": 2016, "user_id": 5829191, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/rwxZQ.jpg?s=128&g=1", "display_name": "rozerro", "link": "https://stackoverflow.com/users/5829191/rozerro"}, "edited": false, "score": 0, "creation_date": 1567887824, "post_id": 57836124, "comment_id": 102102688, "body": "It seems you are right, you could look at the source code.  <a href=\"https://github.com/mandolyte/mdtopdf/blob/master/mdtopdf.go\" rel=\"nofollow noreferrer\">github.com/mandolyte/mdtopdf/blob/master/mdtopdf.go</a>    <code>Process(content []byte)</code>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1567879018, "last_edit_date": 1567879018, "creation_date": 1567878627, "answer_id": 57836124, "question_id": 57835861, "link": "https://stackoverflow.com/questions/57835861/converting-markdown-to-pdf-unreadable-fonts/57836124#57836124", "title": "Converting markdown to pdf - unreadable fonts", "body": "<p>It looks like you are taking Unicode and treating it as Latin-1 extended ASCII. </p>\n\n<p>For example, UTF-8 as Latin-1 extended ASCII:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    u := \"\u041a\u0442\u043e \u043d\u0435 \u043f\u043e\u043d\u0438\u043c\u0430\u0435\u0442 \u0432\u0430\u0448\u0435\u0433\u043e \u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044f, \u0435\u0434\u0432\u0430 \u043b\u0438 \u043f\u043e\u0439\u043c\u0435\u0442 \u0432\u0430\u0448\u0438 \u0441\u043b\u043e\u0432\u0430\"\n    fmt.Println(u)\n    for _, b := range []byte(u) {\n        fmt.Print(string(rune(b)))\n    }\n    fmt.Println()\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/75c4RCEc92F\" rel=\"nofollow noreferrer\">https://play.golang.org/p/75c4RCEc92F</a></p>\n\n<p>Output:</p>\n\n<pre><code>\u041a\u0442\u043e \u043d\u0435 \u043f\u043e\u043d\u0438\u043c\u0430\u0435\u0442 \u0432\u0430\u0448\u0435\u0433\u043e \u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044f, \u0435\u0434\u0432\u0430 \u043b\u0438 \u043f\u043e\u0439\u043c\u0435\u0442 \u0432\u0430\u0448\u0438 \u0441\u043b\u043e\u0432\u0430\n\u00d0\u00d1\u00d0\u00be \u00d0\u00bd\u00d0\u00b5 \u00d0\u00bf\u00d0\u00be\u00d0\u00bd\u00d0\u00b8\u00d0\u00bc\u00d0\u00b0\u00d0\u00b5\u00d1 \u00d0\u00b2\u00d0\u00b0\u00d1\u00d0\u00b5\u00d0\u00b3\u00d0\u00be \u00d0\u00bc\u00d0\u00be\u00d0\u00bb\u00d1\u00d0\u00b0\u00d0\u00bd\u00d0\u00b8\u00d1, \u00d0\u00b5\u00d0\u00b4\u00d0\u00b2\u00d0\u00b0 \u00d0\u00bb\u00d0\u00b8 \u00d0\u00bf\u00d0\u00be\u00d0\u00b9\u00d0\u00bc\u00d0\u00b5\u00d1 \u00d0\u00b2\u00d0\u00b0\u00d1\u00d0\u00b8 \u00d1\u00d0\u00bb\u00d0\u00be\u00d0\u00b2\u00d0\u00b0\n</code></pre>\n"}], "owner": {"reputation": 2016, "user_id": 5829191, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/rwxZQ.jpg?s=128&g=1", "display_name": "rozerro", "link": "https://stackoverflow.com/users/5829191/rozerro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1567924100, "creation_date": 1567876225, "last_edit_date": 1567924100, "question_id": 57835861, "link": "https://stackoverflow.com/questions/57835861/converting-markdown-to-pdf-unreadable-fonts", "title": "Converting markdown to pdf - unreadable fonts", "body": "<p>I use <a href=\"https://github.com/mandolyte/mdtopdf\" rel=\"nofollow noreferrer\">https://github.com/mandolyte/mdtopdf</a> to convet makdown int pdf file\nbut it makes fonts unreadable if they are from non-Latin characters.</p>\n\n<p>For example, source:</p>\n\n<blockquote>\n  <p>\u041a\u0442\u043e \u043d\u0435 \u043f\u043e\u043d\u0438\u043c\u0430\u0435\u0442 \u0432\u0430\u0448\u0435\u0433\u043e \u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044f, \u0435\u0434\u0432\u0430 \u043b\u0438 \u043f\u043e\u0439\u043c\u0435\u0442 \u0432\u0430\u0448\u0438 \u0441\u043b\u043e\u0432\u0430.</p>\n</blockquote>\n\n<p>result:</p>\n\n<blockquote>\n  <p>\u00d0\u0161\u00d1\u201a\u00d0\u00be \u00d0\u00bd\u00d0\u03bc \u00d0\u00bf\u00d0\u00be\u00d0\u00bd\u00d0\u00b8\u00d0\u00bc\u00d0\u00b0\u00d0\u03bc\u00d1\u201a \u00d0\u00b2\u00d0\u00b0\u00d1\u02c6\u00d0\u03bc\u00d0\u00b3\u00d0\u00be \u00d0\u00bc\u00d0\u00be\u00d0\u00bb\u00d1\u2021\u00d0\u00b0\u00d0\u00bd\u00d0\u00b8\u00d1\u2022, \u00d0\u03bc\u00d0\u00b4\u00d0\u00b2\u00d0\u00b0\n  \u00d0\u00bb\u00d0\u00b8 \u00d0\u00bf\u00d0\u00be\u00d0\u00b9\u00d0\u00bc\u00d0\u03bc\u00d1\u201a \u00d0\u00b2\u00d0\u00b0\u00d1\u02c6\u00d0\u00b8 \u00d1\u2022\u00d0\u00bb\u00d0\u00be\u00d0\u00b2\u00d0\u00b0.</p>\n</blockquote>\n\n<p>It has a styler options and required font is proved in the project folder</p>\n\n<p>How to fix that?</p>\n"}, {"tags": ["go", "struct", "interface"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567871964, "post_id": 57835317, "comment_id": 102099147, "body": "Make the <code>Resp</code> field an <code>interface{}</code> and set it to an instance of the desired type, before decoding."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1567872900, "post_id": 57835317, "comment_id": 102099327, "body": "... also note that there are no Generics in Go, at least not yet, so you can forget about that option."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567873691, "post_id": 57835317, "comment_id": 102099478, "body": "<a href=\"https://play.golang.org/p/rKzG6bxGHrw\" rel=\"nofollow noreferrer\">play.golang.org/p/rKzG6bxGHrw</a> You&#39;ll need to use <code>xml:&quot;,any&quot;</code> tag on the <code>interface{}</code> field."}], "owner": {"reputation": 2098, "user_id": 4537346, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/f1b88bba0a7ac2231221ad56d5f00837?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Thompson", "link": "https://stackoverflow.com/users/4537346/martin-thompson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567875565, "creation_date": 1567871787, "last_edit_date": 1567875565, "question_id": 57835317, "link": "https://stackoverflow.com/questions/57835317/how-to-dynamically-assign-static-types", "title": "How to dynamically assign static types", "body": "<p>I'm having a bit of trouble getting my head around the proper implementation of this. If I use the structs below which are embedded within each other and push them to a SOAP API, the response is decoded directly into the Response struct.</p>\n\n<p>The problem I have is that everything except the ResponseBody struct would be used elsewhere and it seems wrong to repeat all of these structs in every implementation of it.</p>\n\n<p>So I would like to:</p>\n\n<ul>\n<li>Keep my code as strongly typed as possible</li>\n<li>Use the generic soap structs elsewhere </li>\n<li>Assign / create the proper object at runtime.</li>\n</ul>\n\n<p>Do I use a struct? Interface? Generics? Something else?</p>\n\n<pre><code>package soapv1\n\nimport (\n    \"encoding/xml\"\n)\n\n//Response \ntype Response struct {\n    XMLName  xml.Name `xml:\"Envelope\"`\n    SoapBody *SOAPBodyResponse\n}\n\n//SOAPBodyResponse\ntype SOAPBodyResponse struct {\n    XMLName      xml.Name `xml:\"Body\"`\n    Resp         *ResponseBody\n    FaultDetails *Fault\n}\n\n//Fault \ntype Fault struct {\n    XMLName     xml.Name `xml:\"Fault\"`\n    Faultcode   string   `xml:\"faultcode\"`\n    Faultstring string   `xml:\"faultstring\"`\n}\n\n//ResponseBody\ntype ResponseBody struct {\n    XMLName     xml.Name `xml:\"loginResponse\"`\n    LoginReturn string   `xml:\"loginReturn\"`\n}\n// Some other code between here to prepare and post request\n\n// read and parse the response body\nresult := new(Response)\nerr = xml.NewDecoder(res.Body).Decode(result)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567866180, "post_id": 57834524, "comment_id": 102097756, "body": "Questions asking us to recommend or find a book, tool, software library, tutorial or other off-site resource are off-topic for Stack Overflow as they tend to attract opinionated answers and spam. Instead, describe the problem and what has been done so far to solve it."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567866900, "post_id": 57834524, "comment_id": 102097942, "body": "... btw it is possible to capture this kind of error without any additional tooling. Simply unit test your code and you should be good."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1567869153, "post_id": 57834524, "comment_id": 102098418, "body": "A non-nil error return does not necessarily imply that the other return values are dangerous, nil or invalid in some way.  It&#39;s usually the case, but not always."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1567880599, "post_id": 57834524, "comment_id": 102101156, "body": "Your code does not panic: <a href=\"https://play.golang.org/p/u6TDUJN4SwF\" rel=\"nofollow noreferrer\">play.golang.org/p/u6TDUJN4SwF</a>"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1567888768, "post_id": 57834524, "comment_id": 102102855, "body": "I think you meant to call <code>newBadA</code> in your example above."}], "answers": [{"tags": [], "owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "is_accepted": false, "score": 1, "last_activity_date": 1567871519, "creation_date": 1567871519, "answer_id": 57835281, "question_id": 57834524, "link": "https://stackoverflow.com/questions/57834524/is-it-possible-to-capture-this-nil-pointer-error/57835281#57835281", "title": "Is it possible to capture this nil pointer error", "body": "<p>It's not correct to say that you cannot use valueA even if it is nil in the case of an error being returned by newBadA. Go will happily invoke the function on the nil receiver - for example:</p>\n\n<pre><code>func (a *A) greet() string {\n   if a == nil {\n      return \"(nil)\"\n   }\n   return a.name\n}\n</code></pre>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1567905897, "creation_date": 1567865920, "last_edit_date": 1567905897, "question_id": 57834524, "link": "https://stackoverflow.com/questions/57834524/is-it-possible-to-capture-this-nil-pointer-error", "title": "Is it possible to capture this nil pointer error", "body": "<p>I had a \"nil pointer\" bug that the compiler can't find out, but I'd like to see if there is a way to find it out by statically analyze it. </p>\n\n<p>So the bug is like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype A struct {\n    name string\n}\n\nfunc newGoodA() (*A, error) {\n    return &amp;A{\n        name: \"Go\",\n    }, nil\n}\n\nfunc newBadA() (*A, error) {\n    return nil, fmt.Errorf(\"failed to create A\")\n}\n\nfunc (a *A) greet() string {\n    return \"Hello \" + a.name\n}\n\nfunc main() {\n    valueA, err := newBadA()\n    if err != nil {\n        fmt.Printf(\"Oops, failed because: %v\", valueA.greet()) // This should be forbidden, because when err is not nil, valueA shouldn't be touched\n    }\n}\n</code></pre>\n\n<p>When I run it, I had error, because <code>valueA</code> is <code>nil</code>.</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n</code></pre>\n\n<p>This is a common mistake, but the compiler can't find out. I wonder if there is any tool that can statically analyze the code and find this out.</p>\n\n<p>I feel it's possible if the rule is that:</p>\n\n<p>If a function call returns a value and an error, then the <code>if err != nil</code> logic should not touch that returned value (<code>valueA</code> in this example), because that's dangerous, and most likely to be <code>nil</code>.</p>\n\n<p>Is there any tool can do this?</p>\n"}, {"tags": ["go", "client-go"], "answers": [{"comments": [{"owner": {"reputation": 802, "user_id": 6904128, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7yIQ.jpg?s=128&g=1", "display_name": "Spazzy757", "link": "https://stackoverflow.com/users/6904128/spazzy757"}, "edited": false, "score": 0, "creation_date": 1600939892, "post_id": 60335324, "comment_id": 113249739, "body": "Just to ask, how would you now test <code>GetClientSet</code>"}, {"owner": {"reputation": 627, "user_id": 2808944, "user_type": "registered", "profile_image": "https://graph.facebook.com/604466596/picture?type=large", "display_name": "Alexander Jeyaraj", "link": "https://stackoverflow.com/users/2808944/alexander-jeyaraj"}, "reply_to_user": {"reputation": 802, "user_id": 6904128, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7yIQ.jpg?s=128&g=1", "display_name": "Spazzy757", "link": "https://stackoverflow.com/users/6904128/spazzy757"}, "edited": false, "score": 0, "creation_date": 1601027832, "post_id": 60335324, "comment_id": 113282721, "body": "This is where the pure functional programming comes handy. Instead of calling rest.InClusterConfig() you can assign that to a variable and in test you can overwrite it. I edited the answer to reflect it. The same can be applied to kubernetes.NewForConfig as well."}, {"owner": {"reputation": 802, "user_id": 6904128, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7yIQ.jpg?s=128&g=1", "display_name": "Spazzy757", "link": "https://stackoverflow.com/users/6904128/spazzy757"}, "edited": false, "score": 0, "creation_date": 1601031814, "post_id": 60335324, "comment_id": 113284377, "body": "brilliant! Thank you!"}], "tags": [], "owner": {"reputation": 627, "user_id": 2808944, "user_type": "registered", "profile_image": "https://graph.facebook.com/604466596/picture?type=large", "display_name": "Alexander Jeyaraj", "link": "https://stackoverflow.com/users/2808944/alexander-jeyaraj"}, "is_accepted": true, "score": 2, "last_activity_date": 1601028534, "last_edit_date": 1601028534, "creation_date": 1582276146, "answer_id": 60335324, "question_id": 57833499, "link": "https://stackoverflow.com/questions/57833499/how-to-write-simple-tests-for-client-go-using-a-fake-client/60335324#60335324", "title": "How to write simple tests for client-go using a fake client?", "body": "<p>You need to move the initialization part outside the GetNamespaceCreationTime function. You can pass the kubernetes.Interface as a parameter to that function.</p>\n<pre><code>    import (\n      &quot;fmt&quot;\n      &quot;k8s.io/api/core/v1&quot;\n      metav1 &quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;\n      fake &quot;k8s.io/client-go/kubernetes/fake&quot;\n      &quot;k8s.io/client-go/kubernetes&quot;\n      &quot;time&quot;\n    )\n\nvar getInclusterConfigFunc = rest.InClusterConfig\nvar getNewKubeClientFunc = dynamic.NewForConfig\n   \n    \n    func GetNamespaceCreationTime(kubeClient kubernetes.Interface, namespace string) int64 {\n    \n        ns, err := kubeClient.CoreV1().Namespaces().Get(namespace, metav1.GetOptions{})\n        if err != nil {\n            panic(err.Error())\n        }\n        fmt.Printf(&quot;%v \\n&quot;, ns.CreationTimestamp)\n        return (ns.GetCreationTimestamp().Unix())\n    }\n    \n    func GetClientSet() kubernetes.Interface {\n      config, err := getInclusterConfigFunc()\n      if err != nil {\n        log.Warnf(&quot;Could not get in-cluster config: %s&quot;, err)\n        return nil, err\n      }\n\n      client, err := getNewKubeClientFunc(config)\n      if err != nil {\n        log.Warnf(&quot;Could not connect to in-cluster API server: %s&quot;, err)\n        return nil, err\n      }\n\n      return client, err\n    }\n</code></pre>\n<p>Then your test function can instantiate the fake client and call the method.</p>\n<pre><code>    func TestGetNamespaceCreationTime(t *testing.T) {\n      kubeClient := fake.NewSimpleClientset()\n      got := GetNamespaceCreationTime(kubeClient, &quot;default&quot;)\n      want := int64(1257894000)\n    \n      nsMock := config.CoreV1().Namespaces()\n      nsMock.Create(&amp;v1.Namespace{\n        ObjectMeta: metav1.ObjectMeta{\n          Name:              &quot;default&quot;,\n          CreationTimestamp: metav1.Date(2009, time.November, 10, 23, 0, 0, 0, time.UTC),\n        },\n      })\n    \n      if got != want {\n        t.Errorf(&quot;got %q want %q&quot;, got, want)\n      }\n\nfunc fakeGetInclusterConfig() (*rest.Config, error) {\n    return nil, nil\n}\n\nfunc fakeGetInclusterConfigWithError() (*rest.Config, error) {\n    return nil, errors.New(&quot;fake error getting in-cluster config&quot;)\n}\n\nfunc TestGetInclusterKubeClient(t *testing.T) {\n    origGetInclusterConfig := getInclusterConfigFunc\n    getInclusterConfigFunc = fakeGetInclusterConfig\n    origGetNewKubeClient := getNewKubeClientFunc\n    getNewKubeClientFunc = fakeGetNewKubeClient\n\n    defer func() {\n        getInclusterConfigFunc = origGetInclusterConfig\n        getNewKubeClientFunc = origGetNewKubeClient\n    }()\n\n    client, err := GetClientSet()\n    assert.Nil(t, client, &quot;Client is not nil&quot;)\n    assert.Nil(t, err, &quot;error is not nil&quot;)\n}\n\nfunc TestGetInclusterKubeClient_ConfigError(t *testing.T) {\n    origGetInclusterConfig := getInclusterConfigFunc\n    getInclusterConfigFunc = fakeGetInclusterConfigWithError\n\n    defer func() {\n        getInclusterConfigFunc = origGetInclusterConfig\n    }()\n\n    client, err := GetInclusterKubeClient()\n    assert.Nil(t, client, &quot;Client is not nil&quot;)\n    assert.NotNil(t, err, &quot;error is nil&quot;)\n}\n</code></pre>\n"}], "owner": {"reputation": 2062, "user_id": 2898919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df96d2d1b61c5e52c46a4ad55f5794?s=128&d=identicon&r=PG&f=1", "display_name": "FL3SH", "link": "https://stackoverflow.com/users/2898919/fl3sh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2603, "favorite_count": 3, "accepted_answer_id": 60335324, "answer_count": 1, "score": 0, "last_activity_date": 1601056636, "creation_date": 1567857751, "last_edit_date": 1582279441, "question_id": 57833499, "link": "https://stackoverflow.com/questions/57833499/how-to-write-simple-tests-for-client-go-using-a-fake-client", "title": "How to write simple tests for client-go using a fake client?", "body": "<h1>Problem</h1>\n\n<p>I am looking for the correct way to test my code below, I couldn't find any examples how can I do it. Only <a href=\"https://github.com/kubernetes/client-go/blob/master/examples/fake-client/\" rel=\"nofollow noreferrer\">main_test.go</a> but it is missing main.go and for me, it isn't obvious how can I use it.\nI also went through Github <a href=\"https://github.com/kubernetes/client-go/issues?utf8=%E2%9C%93&amp;q=fake+client+\" rel=\"nofollow noreferrer\">issues</a> but I can not find anything helpful.</p>\n\n<h1>Function:</h1>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n  \"fmt\"\n  \"k8s.io/api/core/v1\"\n  metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n  fake \"k8s.io/client-go/kubernetes/fake\"\n  \"time\"\n)\n\nfunc GetNamespaceCreationTime(namespace string) int64 {\n    config, err := rest.InClusterConfig()\n    if err != nil {\n        panic(err.Error())\n    }\n    clientset, err := kubernetes.NewForConfig(config)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    ns, err := clientset.CoreV1().Namespaces().Get(namespace, metav1.GetOptions{})\n    if err != nil {\n        panic(err.Error())\n    }\n    fmt.Printf(\"%v \\n\", ns.CreationTimestamp)\n    return (ns.GetCreationTimestamp().Unix())\n}\n</code></pre>\n\n<h1>Test:</h1>\n\n<p>I think my test should look like below, but how can I use <code>config := fake.NewSimpleClientset()</code>, should I pass it into <code>GetNamespaceCreationTime</code> function?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestGetNamespaceCreationTime(t *testing.T) {\n  config := fake.NewSimpleClientset()\n  got := GetNamespaceCreationTime(\"default\")\n  want := int64(1257894000)\n\n  nsMock := config.CoreV1().Namespaces()\n  nsMock.Create(&amp;v1.Namespace{\n    ObjectMeta: metav1.ObjectMeta{\n      Name:              \"default\",\n      CreationTimestamp: metav1.Date(2009, time.November, 10, 23, 0, 0, 0, time.UTC),\n    },\n  })\n\n  if got != want {\n    t.Errorf(\"got %q want %q\", got, want)\n  }\n</code></pre>\n"}, {"tags": ["loops", "for-loop", "go", "while-loop"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1567846131, "post_id": 57832126, "comment_id": 102093481, "body": "<a href=\"https://golang.org/ref/spec#Break_statements\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Break_statements</a>"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1567849510, "last_edit_date": 1567849510, "creation_date": 1567849114, "answer_id": 57832461, "question_id": 57832126, "link": "https://stackoverflow.com/questions/57832126/how-can-i-stop-my-golang-loop-when-the-input-less-than-nine/57832461#57832461", "title": "How can I stop my golang loop when the input less than nine?", "body": "<blockquote>\n  <p>stop when one of two input is less than 9.</p>\n</blockquote>\n\n<hr>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var (\n        value1, value2 float64\n    )\n\n    for {\n        fmt.Print(\"Masukan berat belanjaan di dalam kantong : \")\n        n, err := fmt.Scan(&amp;value1, &amp;value2)\n        if n == 2 &amp;&amp; err == nil {\n            if value1 &lt; 9 || value2 &lt; 9 {\n                break\n            }\n        }\n    }\n\n    fmt.Println(\"Program Selesai\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49, "user_id": 8216283, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xfttY.jpg?s=128&g=1", "display_name": "nrxr", "link": "https://stackoverflow.com/users/8216283/nrxr"}, "is_accepted": false, "score": 1, "last_activity_date": 1567867225, "creation_date": 1567867225, "answer_id": 57834715, "question_id": 57832126, "link": "https://stackoverflow.com/questions/57832126/how-can-i-stop-my-golang-loop-when-the-input-less-than-nine/57834715#57834715", "title": "How can I stop my golang loop when the input less than nine?", "body": "<p>You need to change the sign in your code from <code>&lt;</code> to <code>&gt;</code>.</p>\n\n<p>The conditional is backwards. It should be read as \"do a for loop while value1 or value2 is greater than 9\". That's when you want the for loop to execute.</p>\n\n<p>If this is for a class, make sure you actually understand what's going on so you will learn.</p>\n"}], "owner": {"reputation": 21, "user_id": 8998670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19ddea45c812bc9aff974176e7b19688?s=128&d=identicon&r=PG&f=1", "display_name": "Lovanto", "link": "https://stackoverflow.com/users/8998670/lovanto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 275, "favorite_count": 2, "answer_count": 2, "score": 0, "last_activity_date": 1578673995, "creation_date": 1567846087, "last_edit_date": 1578673995, "question_id": 57832126, "link": "https://stackoverflow.com/questions/57832126/how-can-i-stop-my-golang-loop-when-the-input-less-than-nine", "title": "How can I stop my golang loop when the input less than nine?", "body": "<pre><code>var (\n        value1, value2 float64\n    )\nfor value1 &lt; 9 || value2 &lt; 9 || value1 &lt; 9 &amp;&amp; value2 &lt; 9 {\n    fmt.Print(\"Masukan berat belanjaan di dalam kantong : \")\n    fmt.Scan(&amp;value1, &amp;value2)\n}\n\nfmt.Println(\"Program Selesai\")\n</code></pre>\n\n<p>I want the program doing looping for showing input from user and stop when one of two input is less than 9. But the program always stop when both of value is more than or equals 9. Help me to fix it.</p>\n"}, {"tags": ["dictionary", "go", "concurrency", "mutex", "channel"], "answers": [{"comments": [{"owner": {"reputation": 1504, "user_id": 2594743, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/L4gxd.jpg?s=128&g=1", "display_name": "dulan", "link": "https://stackoverflow.com/users/2594743/dulan"}, "edited": false, "score": 0, "creation_date": 1567838456, "post_id": 57831210, "comment_id": 102092063, "body": "Very well explained, thank you sir! Creating a channel buffer solves the deadlock issue. As for the map usage, the real scenario behind this code snippet is a multi-player online game, so I do need the map as a global variable since it&#39;s been used several places unless I can think of a better way(global variable is evil I know)... Again really appreciate the help!"}, {"owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "reply_to_user": {"reputation": 1504, "user_id": 2594743, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/L4gxd.jpg?s=128&g=1", "display_name": "dulan", "link": "https://stackoverflow.com/users/2594743/dulan"}, "edited": false, "score": 0, "creation_date": 1567839601, "post_id": 57831210, "comment_id": 102092236, "body": "Globals can always be avoided by passing them down from the main function. If you still need the map, you can write it once and read without synchronisation: <a href=\"https://play.golang.org/p/ln9Q3wWkIc5\" rel=\"nofollow noreferrer\">play.golang.org/p/ln9Q3wWkIc5</a>. All the best"}], "tags": [], "owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "is_accepted": true, "score": 1, "last_activity_date": 1567837288, "last_edit_date": 1567837288, "creation_date": 1567836871, "answer_id": 57831210, "question_id": 57830889, "link": "https://stackoverflow.com/questions/57830889/golang-multiple-timers-with-mapchannelmutex/57831210#57831210", "title": "Golang multiple timers with map+channel+mutex", "body": "<p>There's a few things going on here which are going to cause problems with your script:</p>\n\n<p>cancelTimer creates a channel make(chan interface{}) which has no buffer, e.g. make(chan struct{}, 1). This means that sending to the channel will block until another goroutine attempts to receive from that same channel. So when you attempt to call cancelTimer from the main goroutine, it locks mutexLocker and then blocks on sending the cancellation, meanwhile no other goroutine can lock mutexLocker to receive from the cancellation channel, thus causing a deadlock.</p>\n\n<p>After adding a buffer, the cancelTimer call will return immediately. </p>\n\n<p>We will then run into a few other little issues. The first is that the program will immediately quit without printing anything. This happens because after launching the test goroutines and sending the cancel, the main thread has done all of its work, which tells the program it is finished. So we need to tell the main thread to wait for the goroutines, which sync.WaitGroup is very good for:</p>\n\n<pre><code>func main() {\n    var wg sync.WaitGroup\n    for i := 0; i &lt; 10; i++ {\n        wg.Add(1)\n        go func(i int) {\n            defer wg.Done()\n            timerStart(strconv.Itoa(i))\n        }(i)\n        if i%10 == 0 {\n            cancelTimer(strconv.Itoa(i))\n        }\n    }\n    wg.Wait()\n}\n</code></pre>\n\n<p>I can see you've added the mutexLocker to protect the map and later added the for loop to give each goroutine an opportunity to acquire mutexLocker to check their timers. This results in a lot of work for the computer, and more complicated code than is necessary. Instead of having timerStart look up it's index in the cancellations map, we can provide the cancellation channel as an argument:</p>\n\n<pre><code>func testTimer(i int, cancel &lt;-chan interface{}) {\n</code></pre>\n\n<p>and have the main function create the channels. You will then be a le to remove map access, mutexLocker locking, and the for loop from testTimer. If you still require the map for purposes not shown here, you can put the same channel in the map that you pass to testTimer, and if not you can remove all of that code too.</p>\n\n<p>This all ends up looking something like <a href=\"https://play.golang.org/p/iQUvc52B6Nk\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iQUvc52B6Nk</a></p>\n\n<p>Hope that helps \ud83d\udc4d</p>\n"}], "owner": {"reputation": 1504, "user_id": 2594743, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/L4gxd.jpg?s=128&g=1", "display_name": "dulan", "link": "https://stackoverflow.com/users/2594743/dulan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 696, "favorite_count": 0, "accepted_answer_id": 57831210, "answer_count": 1, "score": 0, "last_activity_date": 1567837288, "creation_date": 1567833367, "last_edit_date": 1567836798, "question_id": 57830889, "link": "https://stackoverflow.com/questions/57830889/golang-multiple-timers-with-mapchannelmutex", "title": "Golang multiple timers with map+channel+mutex", "body": "<p>So I'm implementing multiple timers using map/channel/mutex. In order for timer to cancel, I have a channel map that stores cancel info, below is the code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var timerCancelMap = make(map[string]chan interface{})\nvar mutexLocker sync.Mutex\n\nfunc cancelTimer(timerIndex string) {\n    mutexLocker.Lock()\n    defer mutexLocker.Unlock()\n    timerCancelMap[timerIndex] = make(chan interface{})\n    timerCancelMap[timerIndex] &lt;- struct{}{}\n}\n\nfunc timerStart(timerIndex string) {\n    fmt.Println(\"###### 1. start timer: \", timerIndex)\n    timerStillActive := true\n    newTimer := time.NewTimer(time.Second * 10)\n    for timerStillActive {\n        mutexLocker.Lock()\n        select {\n        case &lt;-newTimer.C:\n            timerStillActive = false\n            fmt.Println(\"OOOOOOOOO timer time's up: \", timerIndex)\n        case &lt;-timerCancelMap[timerIndex]:\n            timerCancelMap[timerIndex] = nil\n            timerStillActive = false\n            fmt.Println(\"XXXXXXXXX timer canceled: \", timerIndex)\n        default:\n        }\n        mutexLocker.Unlock()\n    }\n    fmt.Println(\"###### 2. end timer: \", timerIndex)\n}\n\nfunc main() {\n    for i := 0; i &lt; 10; i++ {\n        go timerStart(strconv.Itoa(i))\n        if i%10 == 0 {\n            cancelTimer(strconv.Itoa(i))\n        }\n    }\n}\n</code></pre>\n\n<p>Now this one gives me <code>deadlock</code>, if I remove all mutex.lock/unlock, it gives me <code>concurrent map read and map write</code>. So what am I doing wrong?</p>\n\n<p>I know sync.Map solves my problem, but the performance suffers significantly, so I kinda wanna stick with the map solution.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 78, "user_id": 1312915, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c015aa8309c8fd4417e30207e77020f7?s=128&d=identicon&r=PG", "display_name": "ermya", "link": "https://stackoverflow.com/users/1312915/ermya"}, "edited": false, "score": 0, "creation_date": 1567867923, "post_id": 57830497, "comment_id": 102098130, "body": "thank you for your answer, it is a websocket tcp proxy, so i need filter or save some packets for some of connection"}, {"owner": {"reputation": 78, "user_id": 1312915, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c015aa8309c8fd4417e30207e77020f7?s=128&d=identicon&r=PG", "display_name": "ermya", "link": "https://stackoverflow.com/users/1312915/ermya"}, "edited": false, "score": 0, "creation_date": 1567869431, "post_id": 57830497, "comment_id": 102098502, "body": "this one is working as proxy and portforward for http packet and websocket frame , depend on port ! its like tcp port forward"}], "tags": [], "owner": {"reputation": 21, "user_id": 12032967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e722c8dc4a6e1bbdd3634e20b796922?s=128&d=identicon&r=PG", "display_name": "Barak O&#39;Trump", "link": "https://stackoverflow.com/users/12032967/barak-otrump"}, "is_accepted": false, "score": 2, "last_activity_date": 1567880527, "last_edit_date": 1567880527, "creation_date": 1567827767, "answer_id": 57830497, "question_id": 57830341, "link": "https://stackoverflow.com/questions/57830341/how-to-do-websocket-portforward-with-filter-or-save-in-array-some-forwarded-pa/57830497#57830497", "title": "How to do websocket portforward with filter or save (in array) some forwarded packet in golang?", "body": "<p><strong>Edit: This is an answer original question about forwarding and filtering TCP.  @ermya has since changed the question to ask about WebSockets. This answer is not relevant to what is now a very different question.</strong></p>\n\n<p>You can filter the stream by interposing a reader or writer in the io.Copy operation.  Here's how to interpose a reader:</p>\n\n<pre><code>type myFilter struct {\n    r io.Reader\n}\n\nfunc (f myFilter) Read(p []byte) (int, error) {\n    n, err := f.r.Read(p)\n\n    // Do something with p[:n].  As an example, the following for loop shows how \n    // to uppercase ASCII letters.  Replace this for loop with the filtering of \n    // your choice.\n    for i, b := range p[:n] {\n        if 'a' &lt;= b &amp;&amp; b &lt;= 'z' {\n           p[i] = b - ('a' - 'A')\n        }\n    }\n\n    return n, err\n}\n</code></pre>\n\n<p>Filter data from net.Conn by replacing the call to <code>go forward(remote, c)</code> with:</p>\n\n<pre><code>go func() {\n    defer remote.Close()\n    defer c.Close()\n    io.Copy(remote, myFilter{c})  // interpose the filter here\n}()\n</code></pre>\n\n<p>As an aside, the naming in <code>forward</code> is confusing because <code>src</code> is actually the destination and <code>dest</code> is the source. Use this:</p>\n\n<pre><code>func forward(dest, src net.Conn) {\n  defer src.Close()\n  defer dest.Close()\n  io.Copy(dest, src)\n}      \n</code></pre>\n"}], "owner": {"reputation": 78, "user_id": 1312915, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c015aa8309c8fd4417e30207e77020f7?s=128&d=identicon&r=PG", "display_name": "ermya", "link": "https://stackoverflow.com/users/1312915/ermya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1567880527, "creation_date": 1567825378, "last_edit_date": 1567876274, "question_id": 57830341, "link": "https://stackoverflow.com/questions/57830341/how-to-do-websocket-portforward-with-filter-or-save-in-array-some-forwarded-pa", "title": "How to do websocket portforward with filter or save (in array) some forwarded packet in golang?", "body": "<p>i found a ready source code on github for portforwarding in golang</p>\n\n<p>here is the code </p>\n\n<hr>\n\n<pre><code>package main\n\nimport (\n\"io\"\n\"log\"\n\"net\"\n)\n\nvar localServerHost = \"localhost:1020\"\nvar remoteServerHost = \"192.168.10.1:1020\"\n\nfunc main() {\n\nln, err := net.Listen(\"tcp\", localServerHost)\nif err != nil {\n    log.Fatal(err)\n}\n\nlog.Println(\"Port forwarding server up and listening on \", \nlocalServerHost)\n\nfor {\n    conn, err := ln.Accept()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    go handleConnection(conn)\n }\n}\n\nfunc forward(src, dest net.Conn) {\ndefer src.Close()\ndefer dest.Close()\nio.Copy(src, dest)\n}\n\nfunc handleConnection(c net.Conn) {\n\nlog.Println(\"Connection from : \", c.RemoteAddr())\n\nremote, err := net.Dial(\"tcp\", remoteServerHost)\nif err != nil {\n    log.Fatal(err)\n}\n\nlog.Println(\"Connected to \", remoteServerHost)\ngo forward(c, remote)\ngo forward(remote, c)\n}\n</code></pre>\n\n<hr>\n\n<p>i dont have any idea now how can i put flag on  user connections, so then i can read data form user connection and save or filter some of packets depend on connection flag</p>\n\n<p>its a wrong way ?</p>\n"}, {"tags": ["unit-testing", "go", "mocking"], "comments": [{"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "edited": false, "score": 0, "creation_date": 1567830641, "post_id": 57829913, "comment_id": 102090992, "body": "the error is on <code>suite.go</code> line <code>6</code>, can you share the particular code please"}, {"owner": {"reputation": 109, "user_id": 11964380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b67e002f405c9ae7c855284e914fe2?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v5", "link": "https://stackoverflow.com/users/11964380/jpskgc-v5"}, "reply_to_user": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "edited": false, "score": 0, "creation_date": 1567831337, "post_id": 57829913, "comment_id": 102091064, "body": "<code>suite.go</code> is common package. here is <a href=\"https://github.com/stretchr/testify/blob/master/suite/suite.go#L6\" rel=\"nofollow noreferrer\">github.com/stretchr/testify/blob/master/suite/suite.go#L6</a>"}], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 11964380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b67e002f405c9ae7c855284e914fe2?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v5", "link": "https://stackoverflow.com/users/11964380/jpskgc-v5"}, "edited": false, "score": 0, "creation_date": 1567935798, "post_id": 57832673, "comment_id": 102109410, "body": "Thanks for advice. when I follow this advice, I face compile error issue in dao_test.go. Please take a look at <a href=\"https://stackoverflow.com/questions/57840793/cannot-use-mockdaointerface-literal-type-mockdaointerface-as-type-s3-daointerf\" title=\"cannot use mockdaointerface literal type mockdaointerface as type s3 daointerf\">stackoverflow.com/questions/57840793/&hellip;</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 109, "user_id": 11964380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b67e002f405c9ae7c855284e914fe2?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v5", "link": "https://stackoverflow.com/users/11964380/jpskgc-v5"}, "edited": false, "score": 0, "creation_date": 1567936067, "post_id": 57832673, "comment_id": 102109453, "body": "@jpskgc.v5 You can see in my example I&#39;ve implemented <code>DeleteS3Image</code> on a non-pointer <code>MockS3</code> therefore I can use <code>MockS3{}</code>. In your version you&#39;ve implemented the method on a pointer <code>*MockDaoInterface</code> therefore you have to use <code>&amp;MockDaoInterface{}</code>."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 0, "last_activity_date": 1567850845, "creation_date": 1567850845, "answer_id": 57832673, "question_id": 57829913, "link": "https://stackoverflow.com/questions/57829913/how-to-mock-method-to-pass-test-in-golang/57832673#57832673", "title": "How to mock method to pass test in golang", "body": "<p>In your setup you do call <code>s.dao = NewDao(s.db, s.s3)</code> however you've never initialized <code>s.s3</code> to anything, so <code>s.dao.s3</code> remains <code>nil</code> and that's why <code>d.s3.DeleteS3Image(imageName)</code> panics.</p>\n\n<hr>\n\n<p>In Go to be able to mock a method, the value on which the method is called must be an interface, not a concrete type. Put another way, it is <em>not</em> possible to mock a concrete method in Go.</p>\n\n<p>So with a type like this:</p>\n\n<pre><code>type Dao struct {\n    database *sql.DB\n    s3       *s3.S3\n}\n</code></pre>\n\n<p>you simply <em>cannot</em> mock <code>s3</code>.</p>\n\n<p>What you can do, is change the type of the <code>s3</code> field to an interface type, you already have one ready (<code>s3.DaoInterface</code>).</p>\n\n<pre><code>type Dao struct {\n    database *sql.DB\n    s3       s3.DaoInterface\n}\n</code></pre>\n\n<p>now you <em>can</em> mock the <code>s3</code> field.</p>\n\n<p>What's left is for you to implement your mock and make sure that the <code>s3</code> field is set to an instance of the mock implementation during test setup.</p>\n\n<pre><code>type MockS3 struct{}\n\nfunc (MockS3) DeleteS3Image(imageName util.ImageName) error {\n    // do whatever\n    return nil\n}\n\nfunc (s *DaoSuite) SetupTest() {\n\n    var err error\n    s.db, s.mock, err = sqlmock.New()\n    s.Require().NoError(err)\n    s.dao = NewDao(s.db, s.s3)\n    s.dao.s3 = MockS3{} // &lt;- don't forget about me\n}\n</code></pre>\n\n<p>It is up to you how you implement the mock, but if you're new to mocks I would recommend you take a look at <a href=\"https://github.com/golang/mock\" rel=\"nofollow noreferrer\">https://github.com/golang/mock</a> to help you with generating mocks.</p>\n"}], "owner": {"reputation": 109, "user_id": 11964380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b67e002f405c9ae7c855284e914fe2?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v5", "link": "https://stackoverflow.com/users/11964380/jpskgc-v5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1059, "favorite_count": 0, "accepted_answer_id": 57832673, "answer_count": 1, "score": 1, "last_activity_date": 1567850845, "creation_date": 1567817992, "last_edit_date": 1567848976, "question_id": 57829913, "link": "https://stackoverflow.com/questions/57829913/how-to-mock-method-to-pass-test-in-golang", "title": "How to mock method to pass test in golang", "body": "<p>I'm setting unit test for api(golang).<br>\nIt seems to use mocking. But I don't understand how to code to success.<br></p>\n\n<pre><code>article\n  \u251c client\n  \u251c api\n  \u2502  \u251c main.go\n  \u2502  \u251c contoroller\n  \u2502  \u2502    \u251c contoroller.go\n  \u2502  \u2502    \u2514 contoroller_test.go\n  \u2502  \u251c service\n  \u2502  \u2502    \u251c service.go\n  \u2502  \u2502    \u2514 service_test.go\n  \u2502  \u251c dao\n  \u2502  \u2502    \u251c dao.go\n  \u2502  \u2502    \u2514 dao_test.go\n  \u2502  \u251c s3\n  \u2502  \u2502    \u251c s3.go\n  \u2502  \u2502    \u2514 s3_test.go\n  \u2502  \u251c go.mod \n  \u2502  \u251c go.sum\n  \u2502  \u2514 Dockerfile\n  \u251c nginx\n  \u2514 docker-compose.yml\n</code></pre>\n\n<p>Now I'm trying to set <code>dao_test.go</code>\nBut it fails because <code>dao.go</code> calls method from <code>s3.dao</code>.</p>\n\n<p>dao_test.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package dao\n\n// import\n\ntype DaoSuite struct {\n    suite.Suite\n    db   *sql.DB\n    mock sqlmock.Sqlmock\n    dao  *Dao\n    s3   *s3.S3\n}\n\nfunc (s *DaoSuite) SetupTest() {\n\n    var err error\n    s.db, s.mock, err = sqlmock.New()\n    s.Require().NoError(err)\n    s.dao = NewDao(s.db, s.s3)\n}\n\nfunc (s *DaoSuite) TestDeleteArticleDao() {\n\n    // some method\n\n    // here test fails because DeleteArticleDao calls method from another package.\n    s.dao.DeleteArticleDao(\"1\")\n\n}\n\nfunc (s *DaoSuite) TearDownTest() {\n    s.db.Close()\n    s.Assert().NoError(s.mock.ExpectationsWereMet())\n}\n</code></pre>\n\n<p>dao.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package dao\n\n// import\n\ntype Dao struct {\n    database *sql.DB\n    s3       *s3.S3\n}\n\nfunc NewDao(database *sql.DB, s3 *s3.S3) *Dao {\n    objs := &amp;Dao{database: database, s3: s3}\n    return objs\n}\n\nfunc (d *Dao) DeleteArticleDao(id string) {\n    //generate imageName\n\n    //here calls method in package s3\n    //here test fails \n    d.s3.DeleteS3Image(imageName)\n\n}\n</code></pre>\n\n<p>s3.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package s3\n\n//import\n\ntype S3 struct {\n    APPID  string\n    SECRET string\n}\n\ntype DaoInterface interface {\n    DeleteS3Image(imageName util.ImageName) error\n}\n\nfunc NewS3(appid, secret string) *S3 {\n    objs := &amp;S3{APPID: appid, SECRET: secret}\n    return objs\n}\n\n\nfunc (objs *S3) DeleteS3Image(imageName util.ImageName) error {\n    // method\n}\n</code></pre>\n\n<p>The full source code is here(fix-test-dao):<br> \n<a href=\"https://github.com/jpskgc/article/tree/fix-test-dao\" rel=\"nofollow noreferrer\">https://github.com/jpskgc/article/tree/fix-test-dao</a></p>\n\n<p>I expect the test success in <code>dao_test.go</code>.<br>\nBut the actual is it fails because <code>dao.go</code> calls method from <code>s3 package</code>.<br>\nI want to know how to mock <code>DeleteS3Image</code> in package s3 to avoid error and success test.<br></p>\n\n<p>Here is the error when running <code>go test -v</code> at <code>dao_test.go</code>.<br></p>\n\n<pre><code>$ go test -v\n--- FAIL: TestDaoSuite (0.00s)\n    --- FAIL: TestDaoSuite/TestDeleteArticleDao (0.00s)\n        dao_test.go:221: \n                Error Trace:    dao_test.go:221\n                                                        suite.go:122\n                                                        panic.go:522\n                                                        panic.go:82\n                                                        signal_unix.go:390\n                                                        s3.go:66\n                                                        dao.go:74\n                                                        dao_test.go:156\n                Error:          Received unexpected error:\n                                there is a remaining expectation which was not matched: ExpectedBegin =&gt; expecting database transaction Begin\n                Test:           TestDaoSuite/TestDeleteArticleDao\n        suite.go:61: test panicked: runtime error: invalid memory address or nil pointer dereference\n</code></pre>\n"}, {"tags": ["java", "php", "mysql", "go", "levenshtein-distance"], "comments": [{"owner": {"reputation": 32876, "user_id": 2943403, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RDzQY.jpg?s=128&g=1", "display_name": "mickmackusa", "link": "https://stackoverflow.com/users/2943403/mickmackusa"}, "edited": false, "score": 1, "creation_date": 1567816413, "post_id": 57829709, "comment_id": 102089525, "body": "Can you give us an example of the input strings and a few entries from your db?  How often are you amending the db?  Depending on your specific needs, you may be able to develop some preliminary logic to cut down the total comparisons from 300,000 to say 50,000.  I don&#39;t know, you&#39;d have to describe a bit more."}, {"owner": {"reputation": 628808, "user_id": 139985, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=128&d=identicon&r=PG", "display_name": "Stephen C", "link": "https://stackoverflow.com/users/139985/stephen-c"}, "edited": false, "score": 0, "creation_date": 1567832855, "post_id": 57829709, "comment_id": 102091282, "body": "The performance is <i>likely</i> to depend more on your skill in coding with the language and your ability to use its performance measurement and optimization tools than the language itself."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user10400458"}, "is_accepted": false, "score": 1, "last_activity_date": 1567815726, "creation_date": 1567815726, "answer_id": 57829756, "question_id": 57829709, "link": "https://stackoverflow.com/questions/57829709/fast-comparison-with-levenshtein/57829756#57829756", "title": "fast comparison with Levenshtein", "body": "<p>Not sure if sticking with the MySQL db is a requirement, but a quick way out is to insert the comparison strings into an ElasticSearch database and simply query with a fuzzy search query (Elastic comes with its own set of APIs that you can just call, see <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-fuzzy-query.html\" rel=\"nofollow noreferrer\">https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-fuzzy-query.html</a>).</p>\n"}], "owner": {"reputation": 708, "user_id": 4888475, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/c61ad09ac48b94479de5c98d109adb36?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Tr33", "link": "https://stackoverflow.com/users/4888475/mr-tr33"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "closed_date": 1567836540, "answer_count": 1, "score": -1, "last_activity_date": 1567815726, "creation_date": 1567815064, "question_id": 57829709, "link": "https://stackoverflow.com/questions/57829709/fast-comparison-with-levenshtein", "closed_reason": "Needs more focus", "title": "fast comparison with Levenshtein", "body": "<p>I'm trying to find the best way to compare one text (max lenght: 300) against 300.000 with Levenshtein. At the end I need a webservice with a simple REST API. In the future it will be way more entries than 300.000.</p>\n\n<p>In the background I'm using a simple MySQL Database. My first thought was, to use MySQL to do the job. For that I found this: <a href=\"https://github.com/juanmirocks/Levenshtein-MySQL-UDF\" rel=\"nofollow noreferrer\">https://github.com/juanmirocks/Levenshtein-MySQL-UDF</a></p>\n\n<p>But that is way to slow and I tried to implement my idea in Java and PHP. And this is what I got in the worst case (longest text):</p>\n\n<pre><code>MySQL: 70 seconds\nJava: 45 seconds\nPHP: 17 seconds\n</code></pre>\n\n<p>Actually PHP sounds not that bad, but it is not that easy to create a webservice with it, which loads my whole table (300.000 entries) into an array and just sits there and waits for some requests to do the job. If I'm wrong, please let me know!</p>\n\n<p>Now I'm looking for <code>any</code> advice or maybe a solution. I thought about to create a webservice in Go. I don't know if it is going to be faster than PHP, but I could create easy a webservice with it.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 598, "user_id": 2756123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x71E3.jpg?s=128&g=1", "display_name": "Tom Trebicky", "link": "https://stackoverflow.com/users/2756123/tom-trebicky"}, "is_accepted": false, "score": 4, "last_activity_date": 1567815436, "creation_date": 1567815436, "answer_id": 57829740, "question_id": 57829620, "link": "https://stackoverflow.com/questions/57829620/how-to-make-counter-for-big-numbers/57829740#57829740", "title": "How to make counter for big numbers", "body": "<p>There you go</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"math/big\"\n)\n\nfunc main() {\n  n1 := new(big.Int)\n  n1.SetString(\"100000000000000000000000000000000000000000000000000000000\", 10)\n\n  n2 := new(big.Int)\n  n2.SetString(\"100000000000000000000000000000000000000000000000000000009\", 10)\n\n  one := big.NewInt(1)\n\n  for i := n1; i.Cmp(n2) &lt; 0; i.Add(i, one) {\n    //fmt.Println(i)\n  }\n}\n</code></pre>\n\n<p>Just fit the right numbers into <code>SetString</code>.</p>\n"}], "owner": {"reputation": 85, "user_id": 5009007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dafb59e4b59a4b2cf29b66517f1dbdbf?s=128&d=identicon&r=PG&f=1", "display_name": "Mad", "link": "https://stackoverflow.com/users/5009007/mad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1567815436, "creation_date": 1567813717, "question_id": 57829620, "link": "https://stackoverflow.com/questions/57829620/how-to-make-counter-for-big-numbers", "title": "How to make counter for big numbers", "body": "<p><strong>How to make counter that start from:</strong> \n10000000000000000000000000000000000000000000000000000000000000000000000000000</p>\n\n<p><strong>and stop when it gets to:</strong>\n10000000000000000000000000000000000000000000000000000000000000009999999999999</p>\n\n<p><strong>I have this code:</strong></p>\n\n<pre><code>count,one := new(big.Int), big.NewInt(1)    \ncount.SetString(\"10000000000000000000000000000000000000000000000000000000000000000000000000000\",10)\n</code></pre>\n\n<p>I know this is easy for someone but Im newbi at <strong>GoLang</strong> so don't be angry if my question is stupid for you :)</p>\n\n<p>Thanks anyway</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567808251, "post_id": 57829038, "comment_id": 102088178, "body": "Clone your fork to $GOPATH/src/github.com/ethereum/go-ethereum."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567812257, "post_id": 57829038, "comment_id": 102088895, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/14323872/using-forked-package-import-in-go\">Using forked package import in Go</a>."}, {"owner": {"reputation": 145, "user_id": 8042100, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/206151a561bad98edb69587669c7ff1f?s=128&d=identicon&r=PG", "display_name": "Stipe Matic", "link": "https://stackoverflow.com/users/8042100/stipe-matic"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567831907, "post_id": 57829038, "comment_id": 102091155, "body": "This doesn&#39;t really solve the problem, though. That would also mean that anyone who clones my fork would <i>also</i> have to clone it to the ethereum directory, and it&#39;s hard to believe that there isn&#39;t a more canonical and portable way."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567832637, "post_id": 57829038, "comment_id": 102091251, "body": "If you are creating a new package that you expect others to import, then you need to replace the old import paths (<code>github.com&#47;ethereum&#47;go-ethereum...</code>) with the import path of your new package (<code>github.com&#47;yourUserId&#47;go-ethereum...</code>). The internal import paths will work after this change.  My previous comments assumed that you are fixing bugs or doing some other work where there is no intent to create a new package."}, {"owner": {"reputation": 145, "user_id": 8042100, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/206151a561bad98edb69587669c7ff1f?s=128&d=identicon&r=PG", "display_name": "Stipe Matic", "link": "https://stackoverflow.com/users/8042100/stipe-matic"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568050727, "post_id": 57829038, "comment_id": 102143731, "body": "It&#39;s true that replacing these would work, but this would then create hurdles when merging changes to the upstream repository. I&#39;m fine with doing this, but it seems like there should be a cleaner solution in Go. Is that really not the case?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568053005, "post_id": 57829038, "comment_id": 102144658, "body": "Follow <a href=\"https://stackoverflow.com/questions/14323872/using-forked-package-import-in-go\" title=\"using forked package import in go\">stackoverflow.com/questions/14323872/&hellip;</a> if your goal is to merge changes back to the upstream."}, {"owner": {"reputation": 145, "user_id": 8042100, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/206151a561bad98edb69587669c7ff1f?s=128&d=identicon&r=PG", "display_name": "Stipe Matic", "link": "https://stackoverflow.com/users/8042100/stipe-matic"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568054854, "post_id": 57829038, "comment_id": 102145455, "body": "Sorry, should have been clearer. The idea is to merge changes from the upstream repository to my fork. It&#39;s unlikely that changes in my fork will be merged back into the upstream repo."}], "answers": [{"tags": [], "owner": {"reputation": 49, "user_id": 8216283, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xfttY.jpg?s=128&g=1", "display_name": "nrxr", "link": "https://stackoverflow.com/users/8216283/nrxr"}, "is_accepted": false, "score": 0, "last_activity_date": 1567868226, "creation_date": 1567868226, "answer_id": 57834824, "question_id": 57829038, "link": "https://stackoverflow.com/questions/57829038/cannot-get-a-fork-of-a-repository-to-build-due-to-importing-internal-packages/57834824#57834824", "title": "Cannot get a fork of a repository to build due to importing internal packages", "body": "<p>If you are forking you should change the import paths as well.</p>\n"}, {"tags": [], "owner": {"reputation": 10306, "user_id": 658497, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/AiHJI.jpg?s=128&g=1", "display_name": "Noam Manos", "link": "https://stackoverflow.com/users/658497/noam-manos"}, "is_accepted": false, "score": 0, "last_activity_date": 1568623199, "creation_date": 1568623199, "answer_id": 57953217, "question_id": 57829038, "link": "https://stackoverflow.com/questions/57829038/cannot-get-a-fork-of-a-repository-to-build-due-to-importing-internal-packages/57953217#57953217", "title": "Cannot get a fork of a repository to build due to importing internal packages", "body": "<p>By default, GOPATH is set to $HOME/gopath, and your repository source code is placed in $GOPATH/github.com/user/repo (or $GOPATH/bitbucket.org/user/repo).</p>\n\n<p>When working on a forked repo, in order to import internal packages, the path of the original repo should be added to the <a href=\"https://github.com/golang/go/wiki/SettingGOPATH\" rel=\"nofollow noreferrer\">go import path</a>. </p>\n\n<p>As an example, on Travis-CI, <a href=\"https://github.com/onsi/ginkgo/issues/599\" rel=\"nofollow noreferrer\">my forked repo failed</a> on the same problem (use of internal package not allowed). So I just set <a href=\"https://docs.travis-ci.com/user/languages/go/#go-import-path\" rel=\"nofollow noreferrer\">go_import_path in travis.yml</a> - and it passed.</p>\n"}, {"tags": [], "owner": {"reputation": 7789, "user_id": 2271269, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/d7CGe.jpg?s=128&g=1", "display_name": "Akshat Mahajan", "link": "https://stackoverflow.com/users/2271269/akshat-mahajan"}, "is_accepted": false, "score": 0, "last_activity_date": 1604025100, "creation_date": 1604025100, "answer_id": 64601948, "question_id": 57829038, "link": "https://stackoverflow.com/questions/57829038/cannot-get-a-fork-of-a-repository-to-build-due-to-importing-internal-packages/64601948#64601948", "title": "Cannot get a fork of a repository to build due to importing internal packages", "body": "<h2>Root of the Issue</h2>\n<p>It turns out this issue has nothing to do with Go modules. It is raised because importing from <a href=\"https://stackoverflow.com/questions/41060764/how-to-disable-use-of-internal-package-not-allowed\"><code>internal</code> folders is disallowed in Go if you aren't in the same tree</a>.</p>\n<h2>How to Solve It</h2>\n<p>The only way to fix this issue is to not use an import statement to the <em>source</em>'s <code>internal</code> folder, but instead replace it with an import statement to the <em>fork's</em>.</p>\n<p>If you've already used a <code>replace</code> directive the way OP has, you do not need to change <em>any</em> other import statement - just the one that's giving you trouble.</p>\n<h2>Walkthrough of the Solution</h2>\n<p>Suppose you have source <code>github.com/source/s</code> and you have made a fork <code>github.com/fork/f</code>, and you've cloned the fork locally before making changes.</p>\n<p>The <code>go.mod</code> for the fork will look like</p>\n<pre><code>module github.com/source/s\n\ngo 1.11\n\nrequire (\n...\n)\n</code></pre>\n<p>and assume the file that's throwing the <code>internal</code> error will look like</p>\n<pre><code>package main\n\nimport (\n   &quot;github.com/source/s/something&quot;\n   &quot;github.com/source/s/internal/somethingelse&quot;\n)\n...\n</code></pre>\n<p>Add a <code>replace</code> directive and change the <code>module</code> directive to mirror your fork:</p>\n<pre><code>module github.com/fork/f\n\ngo 1.11\n\nreplace github.com/source/s =&gt; github.com/fork/f\n\nrequire (\n...\n)\n</code></pre>\n<p>Now run <code>go clean -modcache</code> (to clear any older modules already imported by this module) and run <code>go mod tidy</code>. This gets everything installed cleanly, which removes any other sources of possible issues.</p>\n<p>Go to the folder containing the problematic file, and run <code>go install</code> (as the OP did). You will see an error:</p>\n<pre><code>main.go: use of internal package source/s/internal/somethingelse not allowed\n</code></pre>\n<p>Just replace the problematic file's contents with:</p>\n<pre><code>package main\n\nimport (\n   &quot;github.com/source/s/something&quot;\n   &quot;github.com/fork/f/internal/somethingelse&quot;\n)\n...\n</code></pre>\n<p>and rerun <code>go clean -modcache</code> and <code>go mod tidy</code>.</p>\n<p>Now you should be able to run <code>go install</code> with no issues, <em>and</em> have <code>replace</code> work the way you want.</p>\n<p>(Personally, this was a very frustrating issue for me to solve! I was working on modifying a fork of a core package in the Go ecosystem, and the sheer number of dependencies that would break if you tried changing import paths naively made me tear my hair out. I am now able to sleep peacefully at night knowing the answer to this question.)</p>\n"}], "owner": {"reputation": 145, "user_id": 8042100, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/206151a561bad98edb69587669c7ff1f?s=128&d=identicon&r=PG", "display_name": "Stipe Matic", "link": "https://stackoverflow.com/users/8042100/stipe-matic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 335, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1604025100, "creation_date": 1567807821, "question_id": 57829038, "link": "https://stackoverflow.com/questions/57829038/cannot-get-a-fork-of-a-repository-to-build-due-to-importing-internal-packages", "title": "Cannot get a fork of a repository to build due to importing internal packages", "body": "<p>I have made a fork of a repository (specifically, <a href=\"https://github.com/ethereum/go-ethereum\" rel=\"nofollow noreferrer\">github.com/ethereum/go-ethereum</a>) and am trying to make sure that I can build the main application (<code>cmd/geth</code>) before developing on the fork. However, due to the upstream source importing internal packages, the build does not work in my fork.</p>\n\n<p>I have tried this both using GOPATH and Go modules. In each case, when I try to run go install <code>github.com/&lt;me&gt;/go-ethereum/cmd/geth</code>) I get the following error:</p>\n\n<pre><code>cmd/geth/main.go:40:2: use of internal package github.com/ethereum/go-ethereum/internal/debug not allowed\n</code></pre>\n\n<p>In the Go module approach, I have tried adding a replace directive to use my fork instead:</p>\n\n<pre><code>replace github.com/ethereum/go-ethereum =&gt; github.com/&lt;me&gt;/go-ethereum master\n</code></pre>\n\n<p>But this leads to the same error.</p>\n\n<p>I am happy to provide more information (e.g., build output) if that would be helpful, but it seems like there is something straightforward that I am missing, rather than simply replacing all instances of <code>ethereum/go-ethereum/internal</code> with <code>&lt;me&gt;/go-ethereum/internal</code>.</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 12032526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867673cfddc3b491f21c95ce47a7ccd4?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Simon", "link": "https://stackoverflow.com/users/12032526/steve-simon"}, "edited": false, "score": 0, "creation_date": 1567968630, "post_id": 57829654, "comment_id": 102116809, "body": "Thank you very much!  Changing the struct the way you suggest allows me to get the values from the database records now!   This was a big help!"}], "tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 1, "last_activity_date": 1567814206, "creation_date": 1567814206, "answer_id": 57829654, "question_id": 57828656, "link": "https://stackoverflow.com/questions/57828656/how-to-extract-fields-from-mongodb-record-when-iterating-with-cursor-in-golang/57829654#57829654", "title": "How to extract fields from mongodb record when iterating with cursor in Golang", "body": "<p>First, in Go only fields starting with a (Unicode) upper case letter are exported. See also <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">Exported identifiers</a>. The default decoder will try to decode only to the exported fields. So you should change the struct into: </p>\n\n<pre><code>type myDbaseRec struct {\n    Aid        string  `bson:\"pon-util-aid\"`\n    IngressPct int32  `bson:\"ingress-bucket-percent\"`\n    EgressPct  int32  `bson:\"egress-bucket-percent\"`\n}\n</code></pre>\n\n<p>Also notice that the struct above for <code>IngressPct</code> and <code>EgressPct</code> have type <code>int32</code>. This is because the value in the document is represented in numbers (int/double), and not string. You may change it to other number type accordingly i.e. int16, int64, etc. </p>\n"}], "owner": {"reputation": 11, "user_id": 12032526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867673cfddc3b491f21c95ce47a7ccd4?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Simon", "link": "https://stackoverflow.com/users/12032526/steve-simon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 779, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1568046061, "creation_date": 1567804784, "last_edit_date": 1568046061, "question_id": 57828656, "link": "https://stackoverflow.com/questions/57828656/how-to-extract-fields-from-mongodb-record-when-iterating-with-cursor-in-golang", "title": "How to extract fields from mongodb record when iterating with cursor in Golang", "body": "<p>I am fairly new to golang programming and the mongodb interface.</p>\n\n<p>I've got a dbase of records created by another application.  I am trying to walk the dbase and examine specific fields of each record.   I can decode the full records as bson, but I cannot get the specific values.</p>\n\n<p>This struct defines the 3 fields I would like to extract:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type myDbaseRec struct {\n    aid        string  `bson:\"pon-util-aid\"`\n    ingressPct string  `bson:\"ingress-bucket-percent\"`\n    egressPct  string  `bson:\"egress-bucket-percent\"`\n}\n</code></pre>\n\n<p>Here is my code to iterate through the cursor after the collection.Find(ctx, queryFilter) and decode the results both as bson and as my struct:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    var myResult myDbaseRec\n    var bsonMResult bson.M\n\n    var count int\n    for cursor.Next(ctx) {\n\n        err := cursor.Decode(&amp;myResult)\n        if err != nil {\n            fmt.Println(\"cursor.Next() error:\", err)\n            panic(err)\n            // If there are no cursor.Decode errors\n        } else {\n            fmt.Println(\"\\nresult type:\", reflect.TypeOf(myResult))\n            fmt.Printf(\"result: %+v\\n\", myResult)\n\n        }\n\n        err = cursor.Decode(&amp;bsonMResult)\n        if err != nil {\n            fmt.Println(\"bson decode error:\", err)\n            panic(err)\n            // If there are no cursor.Decode errors\n        } else {\n            fmt.Println(\"\\nresult type:\", reflect.TypeOf(bsonMResult))\n            fmt.Println(\"\\nresult:\", bsonMResult)\n        }\n\n    }\n</code></pre>\n\n<p>Here is an example of one iteration of the loop.  The bson decode appears to work, but my struct is empty:</p>\n\n<pre><code>result type: internal.myDbaseRec\nresult: {aid: ingressPct: egressPct:}\n\nresult type: primitive.M\n\nresult: map[pon-util-aid:ROLT-1-MONTREAL/1/1/xp2 _id:ObjectID(\"5d70b4d1b3605301ef72228b\") \nadmitted-assured-upstream-bw:0 admitted-excess-upstream-bw:0 admitted-fixed-upstream-bw:0 \nassured-upstream-bytes:0 available-excess-upstream-bw:0 available-fixed-upstream-bw:622080 \napp_counters_key_field:ROLT-1-MONTREAL/1/1/xp2 app_export_time:1567665626 downstream-octets:52639862633214 \negress-bucket-bps:8940390198 egress-bucket-percent:91 egress-bucket-seconds:559 \nexcess-upstream-bytes:0 fixed-upstream-bytes:0 ingress-bucket-bps:8253153852 \ningress-bucket-percent:84 ingress-bucket-seconds:559 sample-time:0 upstream-octets:48549268162714]\n</code></pre>\n\n<p>I would have expected to get</p>\n\n<pre><code>result: {aid:\"ROLT-1-MONTREAL/1/1/xp2\" ingressPct:84 egressPct:91}\n</code></pre>\n\n<p>Any suggestion on how to properly find these 3 fields from each record?</p>\n\n<p>=== UPDATE:  The first comment below answered my question.</p>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 3659297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2c21d397106f78593f7ba3fdff285f5?s=128&d=identicon&r=PG&f=1", "display_name": "kshamajain99", "link": "https://stackoverflow.com/users/3659297/kshamajain99"}, "edited": false, "score": 0, "creation_date": 1567810191, "post_id": 57829266, "comment_id": 102088561, "body": "I don&#39;t think that by default maxPoolSize will be set to 0."}], "tags": [], "owner": {"reputation": 46, "user_id": 12007541, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mDKRQrMz2XGevXivJaxVl1u4LP9A9PTU8G4DgKK=k-s128", "display_name": "Dimas Prawira", "link": "https://stackoverflow.com/users/12007541/dimas-prawira"}, "is_accepted": false, "score": 0, "last_activity_date": 1567809759, "creation_date": 1567809759, "answer_id": 57829266, "question_id": 57828646, "link": "https://stackoverflow.com/questions/57828646/what-are-the-default-values-of-clientoptions-for-mongo-go-driver/57829266#57829266", "title": "What are the default values of clientOptions for mongo-go-driver?", "body": "<p>If there is not flow to set the default value then it will set to Zero Value. Zero Value is when a variable is declared, and not explicitly initialized, it will be allocated storage with a default value</p>\n\n<ol>\n<li>ConnectTimeout --> time.Duration, data type default value = 0s b.  </li>\n<li>MaxPoolSize --> uint16, data type default value = 0</li>\n<li>MaxConnIdleTime --> time.Duration, data type default value = 0s</li>\n</ol>\n\n<p>another :</p>\n\n<ol>\n<li>bool --> default value is false</li>\n<li>string --> default value is \"\"</li>\n<li>int ---> default value is 0</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 1, "last_activity_date": 1568181929, "creation_date": 1568181929, "answer_id": 57883012, "question_id": 57828646, "link": "https://stackoverflow.com/questions/57828646/what-are-the-default-values-of-clientoptions-for-mongo-go-driver/57883012#57883012", "title": "What are the default values of clientOptions for mongo-go-driver?", "body": "<p>The following default is based on <code>mongo-go-driver</code> v1.1.x and MongoDB server v4.2. You can also find out more information/behaviour on <a href=\"https://github.com/mongodb/specifications/tree/master/source\" rel=\"nofollow noreferrer\">MongoDB driver specs</a>. </p>\n\n<pre><code>ConnectTimeout         30 * time.Second\nCompressors            nil (compression will not be used)\nDialer                 net.Dialer with a 300 second keepalive time\nHeartbeatInterval      10 * time.Second\nLocalThreshold         15 * time.Millisecond\nMaxConnIdleTime        nil (no limit)\nMaxPoolSize            100\nMonitor                nil\nReadConcern            nil (server default `local`)\nReadPreference         readpref.Primary()\nRegistry               bson.DefaultRegistry\nRetryWrites            true\nServerSelectionTimeout 30 * time.Second\nDirect                 false\nSocketTimeout          nil (infinite)\nTLSConfig              nil\nWriteConcern           nil (server default `w:1`)\nZlibLevel              6 (if zlib compression enabled)\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 3659297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2c21d397106f78593f7ba3fdff285f5?s=128&d=identicon&r=PG&f=1", "display_name": "kshamajain99", "link": "https://stackoverflow.com/users/3659297/kshamajain99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 696, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1568181929, "creation_date": 1567804646, "question_id": 57828646, "link": "https://stackoverflow.com/questions/57828646/what-are-the-default-values-of-clientoptions-for-mongo-go-driver", "title": "What are the default values of clientOptions for mongo-go-driver?", "body": "<p>I was trying to search for default values for clientOptions for mongo-go-driver. </p>\n\n<p>I am trying to initiate new client in following way:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>        opts := options.ClientOptions{}\n    opts.ApplyURI(connectionURI)\n    sharedConnection, err = mongo.NewClient(&amp;opts)\n</code></pre>\n\n<p>I was wondering what will be the default values for few of the clientOptions like ConnectTimeout, MaxPoolSize, MaxConnIdleTime. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>   type ClientOptions struct {\n    ConnectTimeout         *time.Duration\n    Compressors            []string\n    Dialer                 ContextDialer\n    HeartbeatInterval      *time.Duration\n    LocalThreshold         *time.Duration\n    MaxConnIdleTime        *time.Duration\n    MaxPoolSize            *uint16\n    Monitor                *event.CommandMonitor\n    ReadConcern            *readconcern.ReadConcern\n    ReadPreference         *readpref.ReadPref\n    Registry               *bsoncodec.Registry\n    RetryWrites            *bool\n    ServerSelectionTimeout *time.Duration\n    Direct                 *bool\n    SocketTimeout          *time.Duration\n    TLSConfig              *tls.Config\n    WriteConcern           *writeconcern.WriteConcern\n    ZlibLevel              *int\n   }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567806773, "post_id": 57828645, "comment_id": 102087840, "body": "Either ignore errors when writing to the response or simply return from the handler.  Is there\u2019s an error writing to the response, then the 500 handler will also fail when writing the response."}], "answers": [{"tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": true, "score": 10, "last_activity_date": 1567806784, "creation_date": 1567806784, "answer_id": 57828909, "question_id": 57828645, "link": "https://stackoverflow.com/questions/57828645/how-to-handle-superfluous-response-writeheader-call-in-order-to-return-500/57828909#57828909", "title": "How to handle superfluous response.WriteHeader call in order to return 500", "body": "<p>There is no way to \"override\" the status code as it's sent to the browser immediately. </p>\n\n<p>You're checking for the return value of <code>http.ResponseWriter.Write()</code>. I'm not sure this is a good strategy. If writing the response failed then chances are that writing more will probably fail, too.</p>\n\n<p>Logging the failure seems more appropriate, but I would expect most failures to be dropped connections and other errors which won't require action.</p>\n"}], "owner": {"reputation": 10642, "user_id": 1251684, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iX2Jq.png?s=128&g=1", "display_name": "BentCoder", "link": "https://stackoverflow.com/users/1251684/bentcoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18084, "favorite_count": 1, "accepted_answer_id": 57828909, "answer_count": 1, "score": 5, "last_activity_date": 1567806784, "creation_date": 1567804645, "question_id": 57828645, "link": "https://stackoverflow.com/questions/57828645/how-to-handle-superfluous-response-writeheader-call-in-order-to-return-500", "title": "How to handle superfluous response.WriteHeader call in order to return 500", "body": "<p>I am aware that the <code>WriteHeader</code> method of <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"noreferrer\">http.ResponseWriter</a> can only be called once per HTTP response, can only have a single response status code and can only send the headers once. This is all perfectly fine.</p>\n\n<p>The question is, how should I refactor my code in order to override <code>201</code> and return <code>500</code> if <code>http.ResponseWriter.Write</code> returns an error? As you can see below I force panic on purpose to see how <a href=\"https://github.com/julienschmidt/httprouter/blob/master/router.go#L161\" rel=\"noreferrer\">httprouter.Router.PanicHandler</a> handles it. As expected, logs show <code>http: superfluous response.WriteHeader call from ...</code> and the response is <code>201</code> because it is too late as explained above.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package server\n\nimport (\n    \"github.com/julienschmidt/httprouter\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc Serve() {\n    rtr := httprouter.New()\n    rtr.GET(\"/\", home.Welcome)\n\n    handle500(rtr)\n\n    err := http.ListenAndServe(\":8080\", rtr)\n    if err != nil {\n        log.Fatalf(\"server crash\")\n    }\n}\n\nfunc handle500(r *httprouter.Router) {\n    r.PanicHandler = func(res http.ResponseWriter, req *http.Request, err interface{}) {\n        res.WriteHeader(http.StatusInternalServerError)\n        // http: superfluous response.WriteHeader call from line above\n    }\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package home\n\nimport (\n    \"github.com/julienschmidt/httprouter\"\n    \"net/http\"\n)\n\nfunc Welcome(res http.ResponseWriter, _ *http.Request, _ httprouter.Params) {\n    // doing a few bits and building the body\n\n    res.Header().Set(\"Content-Type\", \"application/json\")\n    res.WriteHeader(201)\n\n    _, err := res.Write(\"body goes here\")\n    if err == nil {  // I am doing this deliberately to test 500\n        panic(\"assume that something has gone wrong with res.Write and an error occurred\")\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "idioms", "leading-zero"], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 6, "last_activity_date": 1567856769, "last_edit_date": 1567856769, "creation_date": 1567800196, "answer_id": 57827950, "question_id": 57827896, "link": "https://stackoverflow.com/questions/57827896/idiomatic-way-to-concat-leading-zeros-in-go/57827950#57827950", "title": "Idiomatic way to Concat Leading Zeros in Go", "body": "<p>You can use Sprintf/Printf for that (Use Sprintf with the same format to print to a string):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    // For fixed width\n    fmt.Printf(\"%05d\", 4)\n\n    // Or if you need variable widths:\n    fmt.Printf(\"%0*d\", 5, 1234)\n}\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/fmt/</a></p>\n\n<blockquote>\n  <p>See other flags in the docs - pad with leading zeros rather than spaces</p>\n</blockquote>\n\n<p><a href=\"https://play.golang.org/p/0EM4aE2Hk6H\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0EM4aE2Hk6H</a></p>\n"}, {"comments": [{"owner": {"reputation": 175, "user_id": 11986604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpVgw.jpg?s=128&g=1", "display_name": "Milliorn", "link": "https://stackoverflow.com/users/11986604/milliorn"}, "edited": false, "score": 0, "creation_date": 1567800515, "post_id": 57827969, "comment_id": 102086099, "body": "I was going to ask the poster above how you can return that and now I see how that is done."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 2, "creation_date": 1567806981, "post_id": 57827969, "comment_id": 102087880, "body": "Consider also <code>fmt.Sprintf(&quot;%0*d&quot;, w, n)</code>, which is a lot simpler."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 2, "last_activity_date": 1567800417, "last_edit_date": 1567800417, "creation_date": 1567800284, "answer_id": 57827969, "question_id": 57827896, "link": "https://stackoverflow.com/questions/57827896/idiomatic-way-to-concat-leading-zeros-in-go/57827969#57827969", "title": "Idiomatic way to Concat Leading Zeros in Go", "body": "<p>You can do something like this:</p>\n\n<pre><code>func integerToStringOfFixedWidth(n, w int) string {\n    s := fmt.Sprintf(fmt.Sprintf(\"%%0%dd\", w), n)\n    l := len(s)\n    if l &gt; w {\n        return s[l-w:]\n    }\n    return s\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 12032967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e722c8dc4a6e1bbdd3634e20b796922?s=128&d=identicon&r=PG", "display_name": "Barak O&#39;Trump", "link": "https://stackoverflow.com/users/12032967/barak-otrump"}, "is_accepted": false, "score": 0, "last_activity_date": 1567828143, "last_edit_date": 1567828143, "creation_date": 1567818842, "answer_id": 57829965, "question_id": 57827896, "link": "https://stackoverflow.com/questions/57827896/idiomatic-way-to-concat-leading-zeros-in-go/57829965#57829965", "title": "Idiomatic way to Concat Leading Zeros in Go", "body": "<p>Use a well documented and tested package instead of writing your own paddig code.  Here's how to use <a href=\"https://godoc.org/github.com/keltia/leftpad\" rel=\"nofollow noreferrer\">github.com/keltia/leftpad</a>:</p>\n\n<pre><code>func integerToStringOfFixedWidth(n int, w int) string {\n    s, _ := leftpad.PadChar(strconv.Itoa(n), w, '0')\n    return s\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/bYmX7n08uZf\" rel=\"nofollow noreferrer\">Run this code on the Golang Playground</a>!</p>\n"}], "owner": {"reputation": 175, "user_id": 11986604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpVgw.jpg?s=128&g=1", "display_name": "Milliorn", "link": "https://stackoverflow.com/users/11986604/milliorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1567856769, "creation_date": 1567799865, "question_id": 57827896, "link": "https://stackoverflow.com/questions/57827896/idiomatic-way-to-concat-leading-zeros-in-go", "title": "Idiomatic way to Concat Leading Zeros in Go", "body": "<p>I came up with a way to pad leading zeros into a Go string.  I'm not sure if this is the way you do this in Go.  Is there a proper way to do this in Go?  This is what I came up with and can be found inside the second if block.  I tried Google to see if it had something built in without luck.</p>\n\n<pre><code>func integerToStringOfFixedWidth(n int, w int) string {\n  s := strconv.Itoa(n)\n  l := len(s)\n\n  if l &lt; w {\n    for i := l; i &lt; w; i++ {\n      s = \"0\" + s\n    }\n    return s\n  }\n  if l &gt; w {\n    return s[l-w:]\n  }\n  return s\n}\n</code></pre>\n\n<p>For n = 1234 and w = 5, the output should be\nintegerToStringOfFixedWidth(n, w) = \"01234\".</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1567797229, "post_id": 57827317, "comment_id": 102085053, "body": "If the browser can get the cookie but your code cannot, maybe your code is missing another cookie that the other server requires? If you&#39;re calling a service to get a JWT, then it makes sense that it requires some form of authentication, usually as a cookie."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1567797511, "post_id": 57827317, "comment_id": 102085153, "body": "You&#39;re making the request without the cookie set, so your handler doesn&#39;t find the cookie. If you want to send a request with a cookie, you&#39;ll have to include it in your request - there is no way for <code>http.Client</code> to guess what cookies you want and what their values should be."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567798214, "post_id": 57827317, "comment_id": 102085362, "body": "There is no code in <code>validJWT</code> that will set a cookie.  Add <code>req.Header.Set(&quot;Cookie&quot;, &lt;insert cookie header value here&gt;)</code> or possible use a cookie jar."}], "owner": {"reputation": 21, "user_id": 4852717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765bb24bcfbbe9f0da28cf973d771b38?s=128&d=identicon&r=PG&f=1", "display_name": "Eli Price", "link": "https://stackoverflow.com/users/4852717/eli-price"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1567796505, "creation_date": 1567796505, "question_id": 57827317, "link": "https://stackoverflow.com/questions/57827317/calling-rest-api-in-code-header-data-not-getting-set-so-rest-api-not-accessing", "title": "Calling REST API in code. Header data not getting set, so REST API not accessing cookies", "body": "<p>I am building a REST API for authentication. I am setting a JSON web token as a cookie and retrieving it using a HTTP GET request. When I go to the location in my browser, it returns the JSON data from the cookie. However whenever I try to do my GET call in code, the header doesn't have the cookie so it doesn't work. It steps into the function, however it always returns \"Error, unable to retrieve cookie\" when I call it in code, and works when I go to the location in my browser. </p>\n\n<pre><code>//Relevant code\n\n//Constants\n\nconst cookieName = \"testCookie\"\nconst getJWTPath = \"/getJWT/\"\nconst website = \"http://localhost\"\nconst port = \":8080\"\n\n\n//Payload JWT payload structure\n\ntype Payload struct {\n    Uid            string   `json:\"uid\"`\n    Ip             string   `json:\"ip\"`\n    FacilityAccess []string `json:\"facilityaccess\"`\n}\n\n//HTTP Handler\n\nfunc getJWT(w http.ResponseWriter, req *http.Request) {\n\n    cookie, err := req.Cookie(cookieName)\n    if err != nil {\n        json.NewEncoder(w).Encode(Exception{\"Error, unable to retrieve cookie\"})\n    } else {\n        if validateCookieJWT(cookie) {\n            //Pass JSON for payload into browser for GET result\n            // 1. Get encoded payload from cookie JWT\n            // 2. Create byte array from encoded payload\n            // 3. Generate payload structure from byte array\n            // 4. Validate payload, and return it to the browser if it is valid.\n            jwtElements := strings.Split(cookie.Value, \".\")\n            encodedPayload := jwtElements[1] //Get encoded payload from cookie JWT\n\n            payloadByte, err := base64.StdEncoding.DecodeString(encodedPayload) //Create byte array from encoded payload\n            if err != nil {\n                json.NewEncoder(w).Encode(Exception{\"error decoding encoded payload\"})\n            } else {\n                payload := Payload{}\n                err := json.Unmarshal(payloadByte, &amp;payload) //Create payload structure from payload byte array\n                if err != nil {\n                    json.NewEncoder(w).Encode(Exception{\"Error unmarshalling payloadByte\"})\n                } else {\n\n                    json.NewEncoder(w).Encode(payload) //Return payload to the browser\n                }\n            }\n        } else {\n            json.NewEncoder(w).Encode(Exception{\"Unable to validate jwt\"})\n        }\n    }\n}\n\n//Calling rest API in code, for some reason does not have cookies in request header\n\nfunc validJWT(r *http.Request) bool {\n    getJWTurl := website + port + getJWTPath\n\n    req, err := http.NewRequest(http.MethodGet, getJWTurl, nil)\n    if err != nil {\n        return false\n    }\n\n    client := &amp;http.Client{}\n\n    resp, err := client.Do(req)\n    if err != nil {\n        return false\n    }\n\n    defer resp.Body.Close()\n\n    var payload Payload\n    if err := json.NewDecoder(resp.Body).Decode(&amp;payload); err != nil {\n        return false\n    }\n\n    return payload.id != \"\"\n}\n</code></pre>\n\n<p>In the method getJWT, after I call: cookie, err:= req.Cookie(cookieName), err returns the following: \"http: named cookie not present\"</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1567795906, "post_id": 57827120, "comment_id": 102084634, "body": "Since you don&#39;t know the Category beforehand you&#39;ll have to store the metadata into a temporary value, then after the row scan is finished, inspect the Category and decide how to unmarshal the temporary value into metadata."}, {"owner": {"reputation": 1789, "user_id": 4056372, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/285fed6a5df00f048a00732292105729?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/4056372/andrew"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567798145, "post_id": 57827120, "comment_id": 102085336, "body": "I&#39;m using sqlx and to be fair I was trying to do something like an &quot;after&quot; hook, but I&#39;m not sure if it&#39;s possible to do with that. I don&#39;t really want to manually do it every time I select this type of data. Is there an example for this somewhere?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1567799827, "post_id": 57827120, "comment_id": 102085867, "body": "You could do something like this: <a href=\"https://play.golang.org/p/0VzgC6MBz7K\" rel=\"nofollow noreferrer\">play.golang.org/p/0VzgC6MBz7K</a> and to avoid writing it too many times, just abstract the steps into a function."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567799917, "post_id": 57827120, "comment_id": 102085897, "body": "... i don&#39;t use sqlx so i&#39;m not at all sure whether it will utilize the scanner interface or not."}, {"owner": {"reputation": 1789, "user_id": 4056372, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/285fed6a5df00f048a00732292105729?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/4056372/andrew"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567801229, "post_id": 57827120, "comment_id": 102086341, "body": "Yeah, sqlx can utilize the scanner interface. Where would I use <code>TempCategory</code> though? I feel like it&#39;s there but not used."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567801490, "post_id": 57827120, "comment_id": 102086423, "body": "The idea is that each time before scanning the struct, you set the Metadata field to an instance of *TempCategory, and because *TempCategory implements not only the Metadata interface but also the sql.Scanner interface sqlx should notice that and call the Scan method, then after the scan is done you pass in the Category value to the TempCategory&#39;s unmarshal method, and based on that value you unmarshal the data, passed to Scan during scanning, into the correct Category type and then return it."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567801554, "post_id": 57827120, "comment_id": 102086443, "body": "Basically a 3 step process, (1) before scan allocate and set TempCategory, (2) scan, (3) after scan unmarshal data into correct Category type"}, {"owner": {"reputation": 1789, "user_id": 4056372, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/285fed6a5df00f048a00732292105729?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/4056372/andrew"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567801936, "post_id": 57827120, "comment_id": 102086589, "body": "Gotcha, thanks! Too bad there isn&#39;t an &quot;easier&quot; way. :/"}, {"owner": {"reputation": 1789, "user_id": 4056372, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/285fed6a5df00f048a00732292105729?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/4056372/andrew"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567823175, "post_id": 57827120, "comment_id": 102090197, "body": "Just a followup question: is that possible that I implement the scanner interface for the base struct (Torrent) and somehow magically just scan (?) every field except the Metadata one, and after that&#39;s done I could do whatever based on the Category field?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567826661, "post_id": 57827120, "comment_id": 102090572, "body": "I do not think it is, but again, I don&#39;t know enough sqlx to be for sure."}], "owner": {"reputation": 1789, "user_id": 4056372, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/285fed6a5df00f048a00732292105729?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/4056372/andrew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 389, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567798784, "creation_date": 1567795181, "last_edit_date": 1567798784, "question_id": 57827120, "link": "https://stackoverflow.com/questions/57827120/golang-sql-scan-interface-scan-into-interface-field-type", "title": "Golang SQL Scan interface - scan into interface field type?", "body": "<p>So I have a struct, something like this:</p>\n\n<pre><code>type Torrent struct {\n    ID       uint64   `db:\"id\"`\n    Metadata Metadata `db:\"metadata\"`\n    Category uint8    `db:\"category\"`\n    // Many other fields\n}\n</code></pre>\n\n<p><code>Metadata</code> is an interface type, in SQL is a LONGTEXT (MariaDB's JSON type). So I have something like this:</p>\n\n<pre><code>type Metadata interface {\n  // multiple funcs\n}\n\ntype Category1 struct {} // implementing Metadata interface\ntype Category2 struct {} // implementing Metadata interface\n</code></pre>\n\n<p>What I would like to do is somehow scan the data from SQL into the exact struct based on the <code>Category</code> field. How could I achieve this?</p>\n"}, {"tags": ["go", "scanf"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 5, "creation_date": 1567789256, "post_id": 57826022, "comment_id": 102082158, "body": "Did you try this on the playground only, or locally? It should run locally. I don&#39;t think the playground supports console input."}, {"owner": {"reputation": 1378, "user_id": 6370924, "user_type": "registered", "profile_image": "https://graph.facebook.com/1728062080744924/picture?type=large", "display_name": "Meraj al Maksud", "link": "https://stackoverflow.com/users/6370924/meraj-al-maksud"}, "edited": false, "score": 3, "creation_date": 1567790303, "post_id": 57826022, "comment_id": 102082559, "body": "Please include the code within your post. Not in some links."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 4490728, "user_type": "registered", "profile_image": "https://graph.facebook.com/1075989144/picture?type=large", "display_name": "Tauki Tahmid", "link": "https://stackoverflow.com/users/4490728/tauki-tahmid"}, "is_accepted": false, "score": 0, "last_activity_date": 1567802082, "creation_date": 1567802082, "answer_id": 57828273, "question_id": 57826022, "link": "https://stackoverflow.com/questions/57826022/fmt-scanf-is-not-waiting-for-console-input/57828273#57828273", "title": "fmt.Scanf is not waiting for console input", "body": "<p>Sadly the go playground does not support console input.\nIt was even mentioned on the GitHub issue <a href=\"https://github.com/golang/go/issues/16667#issuecomment-410038280\" rel=\"nofollow noreferrer\">here</a> that they are not planning on bringing this as a feature.</p>\n\n<p>Also if you look at <a href=\"https://github.com/golang/go/issues/16667#issuecomment-239103042\" rel=\"nofollow noreferrer\">this</a> comment stating a possible solution to your problem which allows you to read from os.Stdin on the playground if you assign it to a file.</p>\n"}], "owner": {"reputation": 11, "user_id": 12031694, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-rqnkrJeBp_w/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd9KsOg_f1NdEzdEj3e7GhcGiVdZQ/photo.jpg?sz=128", "display_name": "Pradyumn Tiwari", "link": "https://stackoverflow.com/users/12031694/pradyumn-tiwari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 271, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567802082, "creation_date": 1567789084, "last_edit_date": 1567796346, "question_id": 57826022, "link": "https://stackoverflow.com/questions/57826022/fmt-scanf-is-not-waiting-for-console-input", "title": "fmt.Scanf is not waiting for console input", "body": "<p>scanf is not waiting for input. Other issue raised have : \\n left in stdin because they have pressed ENTER before scanf. In my case first thing I doing is running scanf -> no \\n leftover in my case. I am new to golang but as per my C concept I am doing nothing wrong.</p>\n\n<p>also tried fmt.Scanf(\"%d\\n\",&amp;n)  &lt;--- but it does not make sense as there are no \\n leftover for this scan.</p>\n\n<pre><code>func main() {\n    var a int = 0\n    var b int = 1\n    var c int\n    var n int \n    fmt.Scanf(\"%d\\n\",&amp;n)\n    //fmt.Printf(\"%d \\n\",n)\n    var i int\n    fmt.Printf(\"%d %d \", a, b)\n    for i = 0; i &lt; n-2; i++ {\n        c = (a + b) % 10\n        fmt.Printf(\"%d \", c)\n        a = b\n        b = c\n    }\n}\n</code></pre>\n\n<p>below is my code link in playground\n<a href=\"https://play.golang.org/p/_OWtakKsDHn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_OWtakKsDHn</a></p>\n\n<p>I am getting result : \n0 1 \nProgram exited.</p>\n"}]