[{"tags": ["go", "architecture", "boolean", "flags"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1502317733, "post_id": 45601402, "comment_id": 78162618, "body": "Not clear what you want to do here? You want it to only output this debug information conditionally based on a flag you define?"}, {"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1502319372, "post_id": 45601402, "comment_id": 78163148, "body": "kind of, I just want to be able to know if the file <code>go-ethereum&#47;core&#47;vm&#47;instructions.go</code> when we enter the part of the loop that&#39;s going to output <code>&quot;Submitted transaction&quot;</code> from the function in <code>go-ethereum&#47;internal&#47;ethapi&#47;api.go</code>, do you know how I could do that? like, maybe I could just mutually <code>include</code> the files, each one with the other, and create a global variable to declare when that loop is fired?"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1502319506, "post_id": 45601402, "comment_id": 78163198, "body": "Do you want to time your code in api.go the way instructions.go does it, or do you want to control what instructions.go outputs when it is invoked (there&#39;s no clear linkage between the two here)? I think rather than ask about the boolean flag or linking files specify exactly what you want to happen in your bit of code."}, {"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1502319803, "post_id": 45601402, "comment_id": 78163291, "body": "so I want to boolean variable, that will record the execution time and output that only in the case that we enter that <code>&quot;Submitted transaction&quot;</code> loop, do you know what I mean?"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1502320556, "post_id": 45601402, "comment_id": 78163514, "body": "Sorry, not clear. It&#39;d be a lot clearer if you had working code to try. Do you want to control whether opAdd outputs or not depending on some condition? Does opAdd get called somewhere in the api.go file? I&#39;d try to forget the how which you decided on and just specify the what very precisely."}, {"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1502320787, "post_id": 45601402, "comment_id": 78163586, "body": "aha, yes- sorry- you&#39;re right. so what I&#39;d like to do is output those opcodes only in the situation where to code that&#39;s executing is the same code that would execute <code>&quot;Submitted transaction&quot;</code>"}], "answers": [{"comments": [{"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 0, "creation_date": 1502320066, "post_id": 45601936, "comment_id": 78163375, "body": "that&#39;s not what I want to do, I want the entering of the function that outputs <code>&quot;Submitted transaction&quot;</code> to trigger the timing of the opcodes in <code>instructions.go</code>"}, {"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 0, "creation_date": 1502321185, "post_id": 45601936, "comment_id": 78163682, "body": "is this going to be accessible in <code>go-ethereum&#47;core&#47;vm&#47;instructions.go</code> if I set it in <code>ethereum&#47;internal&#47;ethapi&#47;api.go</code>?"}, {"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 0, "creation_date": 1502322448, "post_id": 45601936, "comment_id": 78163972, "body": "so, currently it crashes- but- what do you think of the edit to the OP, does it look like it makes sense? what did I do wrong?"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 1, "creation_date": 1502322659, "post_id": 45601936, "comment_id": 78164021, "body": "It could, though I think you have things inverted  - the lower level pkg should know nothing about the api one, it should have a flag, which it uses to control behaviour, which other packages can set. So instructions.go should contain and use the flag, and some other pkg sets it as appropriate. It&#39;s unusual for such a flag to be unset immediately after use as well. Hope this has helped a little, I&#39;d try it out with real code."}, {"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 0, "creation_date": 1502323108, "post_id": 45601936, "comment_id": 78164124, "body": "so I changed it around, the lower level package thing and you suggested, but it still crashed, I put a screenshot of the error also into the OP as an edit"}, {"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 0, "creation_date": 1502323432, "post_id": 45601936, "comment_id": 78164214, "body": "it says now that <code>core&#47;vm&#47;instructions.go:56: undefined: startTime</code>,  but it never crashed with that before, when I didn&#39;t have <code>startTime</code> wrapped in that way"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 0, "creation_date": 1502396219, "post_id": 45601936, "comment_id": 78205109, "body": "Given the code above, you&#39;ve wrapped starttime declaration, so it doesn&#39;t exist outside that scope. I&#39;ve given an example above."}, {"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 0, "creation_date": 1502398170, "post_id": 45601936, "comment_id": 78206033, "body": "I finally got it to work- I&#39;ve described it here: <a href=\"https://ethereum.stackexchange.com/questions/23941/filter-to-restrict-output-of-opcode-data-only-to-contracts-functions-called-by-l\" title=\"filter to restrict output of opcode data only to contracts functions called by l\">ethereum.stackexchange.com/questions/23941/&hellip;</a>"}, {"owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "edited": false, "score": 0, "creation_date": 1502398201, "post_id": 45601936, "comment_id": 78206055, "body": "but in fact- that approach- is sort of a hack- and doesn&#39;t really do what I want :/"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 2, "last_activity_date": 1502396445, "last_edit_date": 1502396445, "creation_date": 1502319957, "answer_id": 45601936, "question_id": 45601402, "link": "https://stackoverflow.com/questions/45601402/golang-pass-boolean-flag-from-function-in-file-sub-directory-a-to-function-in/45601936#45601936", "title": "Golang: pass boolean flag from function in file/sub-directory A, to function in file/sub-directory B", "body": "<p>To control whether timing information is output in instructions.go, yes you could add a boolean variable to the file instructions.go (perhaps something like):</p>\n\n<pre><code>var Debug bool\n</code></pre>\n\n<p>and wrap the logging in a check on it:</p>\n\n<pre><code>if Debug {\n   // log ellapsed execution time\nfmt.Println(\"execute opAdd consume = \",(time.Now().UnixNano() - startTime))\n}\n</code></pre>\n\n<p>and then set it somewhere (for example in your api pkg) with </p>\n\n<pre><code>import \".../core/vm\"\nvm.Debug = true \n</code></pre>\n\n<p>this is not goroutine safe so would have to be set once on startup depending on conditions or protected with a mutex. It's also pretty horrible but as a quick hack to see it work you could do this (sorry not familiar with this particular code base) . </p>\n\n<p>I'm not clear on how opAdd is triggered by your other code if it was directly called you could of course just add a parameter to the function to control the output from the calling site, this would be preferable. </p>\n\n<p>Normally this sort of thing you'd either:</p>\n\n<ol>\n<li>Pass in whether to debug or not to the function call opAdd </li>\n<li>Set a global debugging level on startup once to control whether logging takes place or at what level globally and this would affect all such tracing. </li>\n</ol>\n\n<p>They do have a log package, I don't know why it's not used here:</p>\n\n<p><a href=\"https://github.com/ethereum/go-ethereum/blob/master/log/logger.go\" rel=\"nofollow noreferrer\">https://github.com/ethereum/go-ethereum/blob/master/log/logger.go</a></p>\n\n<p>EDIT </p>\n\n<p>I would just always allocate startTime , but if you wish to avoid that, you need to declare it at the top level, compare this to your code above:</p>\n\n<pre><code>// wrap the logging in a check\nvar startTime time.Time\nif OpcodeTrigger {\n    // begin execution time tracking\n    startTime = time.Now().UnixNano();\n}\n</code></pre>\n\n<p>NB if this is concurrent at all you should be adding a mutex to the vm pkg and only mutating OpCodeTrigger with a function which wraps the access with a mu.Lock - at that point you might start to ask yourself if there are better ways to do this :)</p>\n\n<p>Better if you get stuck again to ask on a forum like forum.golangbridge.org as stackoverflow is not designed for extensive back and forth. </p>\n"}], "owner": {"reputation": 2595, "user_id": 3787253, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/U9bkB.jpg?s=128&g=1", "display_name": "smatthewenglish", "link": "https://stackoverflow.com/users/3787253/smatthewenglish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 800, "favorite_count": 0, "accepted_answer_id": 45601936, "answer_count": 1, "score": 0, "last_activity_date": 1502396445, "creation_date": 1502316620, "last_edit_date": 1502323066, "question_id": 45601402, "link": "https://stackoverflow.com/questions/45601402/golang-pass-boolean-flag-from-function-in-file-sub-directory-a-to-function-in", "title": "Golang: pass boolean flag from function in file/sub-directory A, to function in file/sub-directory B", "body": "<p>The following function lives in the folder <a href=\"https://github.com/s-matthew-english/go-ethereum/blob/goethe_0.0/core/vm/instructions.go\" rel=\"nofollow noreferrer\"><code>go-ethereum/core/vm/instructions.go</code></a>: </p>\n\n<pre><code>func opAdd(pc *uint64, evm *EVM, contract *Contract, memory *Memory, stack *Stack) ([]byte, error) {\n\n    // begin execution time tracking\n    var startTime = time.Now().UnixNano();\n\n    x, y := stack.pop(), stack.pop()\n    stack.push(math.U256(x.Add(x, y)))\n\n    evm.interpreter.intPool.put(y)\n\n    // log ellapsed execution time\n    fmt.Println(\"execute opAdd consume = \",(time.Now().UnixNano() - startTime))\n\n    return nil, nil\n}\n</code></pre>\n\n<p>it's meant to output the execution time of the opcode <code>opAdd</code> in the execution of the Ethereum virtual machine, which looks like this: </p>\n\n<p><a href=\"https://i.stack.imgur.com/9Wu3Z.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/9Wu3Z.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>However, what I'd like to do is have this information only display when it's running a programme that I've initiated locally, on my own network node. </p>\n\n<p>Here is a function in the file <a href=\"https://github.com/s-matthew-english/go-ethereum/blob/master/internal/ethapi/api.go\" rel=\"nofollow noreferrer\"><code>go-ethereum/internal/ethapi/api.go</code></a>:</p>\n\n<pre><code>// SendRawTransaction will add the signed transaction to the transaction pool.\n// The sender is responsible for signing the transaction and using the correct nonce.\nfunc (s *PublicTransactionPoolAPI) SendRawTransaction(ctx context.Context, encodedTx hexutil.Bytes) (string, error) {\n    tx := new(types.Transaction)\n    if err := rlp.DecodeBytes(encodedTx, tx); err != nil {\n        return \"\", err\n    }\n\n    if err := s.b.SendTx(ctx, tx); err != nil {\n        return \"\", err\n    }\n\n    signer := types.MakeSigner(s.b.ChainConfig(), s.b.CurrentBlock().Number())\n    if tx.To() == nil {\n        from, err := types.Sender(signer, tx)\n        if err != nil {\n            return \"\", err\n        }\n        addr := crypto.CreateAddress(from, tx.Nonce())\n        log.Info(\"Submitted contract creation\", \"fullhash\", tx.Hash().Hex(), \"contract\", addr.Hex())\n    } else {\n        log.Info(\"Submitted transaction\", \"fullhash\", tx.Hash().Hex(), \"recipient\", tx.To())\n    }\n\n    return tx.Hash().Hex(), nil\n}\n</code></pre>\n\n<p>This function only executes when one submits a transaction to the network, and outputs <code>Submitted transaction</code> in the terminal window's console.</p>\n\n<p>Is there a way that I could pass a boolean flag from <code>go-ethereum/internal/ethapi/api.go</code> to <code>go-ethereum/core/vm/instructions.go</code>, right before it outputs <code>Submitted transaction</code> so that I could execute the opcode execution time catalouging functionality? </p>\n\n<hr>\n\n<p><strong>EDIT</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/Q1mRC.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Q1mRC.png\" alt=\"enter image description here\"></a></p>\n\n<p>From the file <code>go-ethereum/internal/ethapi/api.go</code>:</p>\n\n<pre><code>// submitTransaction is a helper function that submits tx to txPool and logs a message.\nfunc submitTransaction(ctx context.Context, b Backend, tx *types.Transaction) (common.Hash, error) {\n    if err := b.SendTx(ctx, tx); err != nil {\n        return common.Hash{}, err\n    }\n    if tx.To() == nil {\n        signer := types.MakeSigner(b.ChainConfig(), b.CurrentBlock().Number())\n        from, _ := types.Sender(signer, tx)\n        addr := crypto.CreateAddress(from, tx.Nonce())\n        log.Info(\"Submitted contract creation\", \"fullhash\", tx.Hash().Hex(), \"contract\", addr.Hex())\n    } else {\n\n        // flag for opcode execution time tracking\n        vm.OpcodeTrigger = true \n\n        log.Info(\"Submitted transaction\", \"fullhash\", tx.Hash().Hex(), \"recipient\", tx.To())\n    }\n    return tx.Hash(), nil\n}\n</code></pre>\n\n<p>and from <code>go-ethereum/core/vm/instructions.go</code>:</p>\n\n<pre><code>var (\n    OpcodeTrigger bool\n    bigZero = new(big.Int)\n)\n\nfunc opAdd(pc *uint64, evm *EVM, contract *Contract, memory *Memory, stack *Stack) ([]byte, error) {\n\n    // wrap the logging in a check\n    if OpcodeTrigger {\n        // begin execution time tracking\n        var startTime = time.Now().UnixNano();\n    }\n\n    x, y := stack.pop(), stack.pop()\n    stack.push(math.U256(x.Add(x, y)))\n\n    evm.interpreter.intPool.put(y)\n\n    // wrap the logging in a check\n    if OpcodeTrigger {\n        // now set the boolean flag back to false\n        OpcodeTrigger = false\n\n        // log ellapsed execution time\n        fmt.Println(\"execute opAdd consume = \",(time.Now().UnixNano() - startTime))\n    }\n\n    return nil, nil\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1502338246, "post_id": 45601338, "comment_id": 78167738, "body": "See <a href=\"https://stackoverflow.com/questions/40823315/go-x-does-not-implement-y-method-has-a-pointer-receiver/40824044#40824044\">Go, X does not implement Y (... method has a pointer receiver)</a> for detailed explanation and possible solutions."}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 1, "last_activity_date": 1502317328, "creation_date": 1502317328, "answer_id": 45601525, "question_id": 45601338, "link": "https://stackoverflow.com/questions/45601338/group-does-not-implement-data-foomethod-method-has-pointer-receiver/45601525#45601525", "title": "Group does not implement Data (FooMethod method has pointer receiver)", "body": "<p>If you want to use a struct receiver, remove the * from before Group in the definition of your function on line 8. As a convenience they do work the other way round (defined on struct works on a pointer receiver). See effective go for an explanation. </p>\n\n<p><a href=\"https://golang.org/doc/effective_go.html#pointers_vs_values\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html#pointers_vs_values</a></p>\n\n<p>Modified version: </p>\n\n<p><a href=\"https://play.golang.org/p/ww6IYVPtIE\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ww6IYVPtIE</a></p>\n"}], "owner": {"reputation": 15582, "user_id": 1420625, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wJ6T0.png?s=128&g=1", "display_name": "sensorario", "link": "https://stackoverflow.com/users/1420625/sensorario"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "accepted_answer_id": 45601525, "answer_count": 1, "score": 0, "last_activity_date": 1502317328, "creation_date": 1502316267, "question_id": 45601338, "link": "https://stackoverflow.com/questions/45601338/group-does-not-implement-data-foomethod-method-has-pointer-receiver", "title": "Group does not implement Data (FooMethod method has pointer receiver)", "body": "<p>This is my code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Group struct {\n}\n\nfunc (g *Group) FooMethod() string {\n    return \"foo\"\n}\n\ntype Data interface {\n    FooMethod() string\n}\n\nfunc NewJsonResponse(d Data) Data {\n    return d\n}\n\nfunc main() {\n    var g Group\n    json := NewJsonResponse(g)\n    fmt.Println(\"vim-go\")\n}\n</code></pre>\n\n<p>but does not work as I expect. </p>\n\n<pre><code>$ go build main.go\n# command-line-arguments\n./main.go:22: cannot use g (type Group) as type Data in argument to NewJsonResponse:\n    Group does not implement Data (FooMethod method has pointer receiver)\n</code></pre>\n"}, {"tags": ["json", "go", "types", "marshalling", "unmarshalling"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502312136, "post_id": 45600373, "comment_id": 78160310, "body": "At first glance, it looks like your struct is causing a disconnect. <code>DomConcert  *dom.Concert</code> makes the parser look for a <code>Concert</code> object in the JSON with the name <code>&quot;DomConcert&quot;</code>. e.g. <code>{&quot;DomConcert&quot;: {...}}</code>. Is that what you intend?"}, {"owner": {"reputation": 39, "user_id": 5297926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/845566ff2643308e0292ed2490c52231?s=128&d=identicon&r=PG&f=1", "display_name": "mitchem", "link": "https://stackoverflow.com/users/5297926/mitchem"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502312485, "post_id": 45600373, "comment_id": 78160490, "body": "According to the string we were able to print out, the JSON string we are seeing is along the lines of <code>{&quot;FullConcert&quot;:{&quot;DomConcert&quot;:{...}...} ... }</code>"}, {"owner": {"reputation": 39, "user_id": 5297926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/845566ff2643308e0292ed2490c52231?s=128&d=identicon&r=PG&f=1", "display_name": "mitchem", "link": "https://stackoverflow.com/users/5297926/mitchem"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502312997, "post_id": 45600373, "comment_id": 78160708, "body": "Based off what we are seeing, the JSON string is in the expected format for the object we are passing in. However, when attempting to Unmarshal that back into a GoLang struct, it is unable to parse it properly."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502313201, "post_id": 45600373, "comment_id": 78160789, "body": "Darn, I was hoping it was that simple... It is still likely a disconnect somewhere based on the fact that it doesn&#39;t throw an error. The Unmarshaller can take care of arbitrarily nested structs, so just the deep nesting itself isn&#39;t an issue, unless of course there is a recursive issue, but then it would simply loop forever."}, {"owner": {"reputation": 39, "user_id": 5297926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/845566ff2643308e0292ed2490c52231?s=128&d=identicon&r=PG&f=1", "display_name": "mitchem", "link": "https://stackoverflow.com/users/5297926/mitchem"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502313961, "post_id": 45600373, "comment_id": 78161087, "body": "Unfortunately no, it is not simple. The marshal did its job perfectly from what I was able to read off the stringified json. The fault lies with the unmarshaler currently. I am assuming that a custom unmarshaler is required for this to work properly?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502314233, "post_id": 45600373, "comment_id": 78161216, "body": "That&#39;s possible, but it may be difficult to determine <b>for what struct</b> to write it for. Without the actual definition, the only thing I can tell you is to tinker on the playground with possible suspect pieces of the data and run tests with just those pieces of struct &amp; JSON one at a time."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 1, "creation_date": 1502318018, "post_id": 45600373, "comment_id": 78162700, "body": "You might find this tool useful if you have a sample of the valid json: <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">mholt.github.io/json-to-go</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1502318880, "post_id": 45600373, "comment_id": 78163001, "body": "@KennyGrant Oh that is all kinds of useful!"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1502355642, "post_id": 45600373, "comment_id": 78176667, "body": "These two <i>&quot;arrayToUnmarshalInto produces an empty slice&quot;</i> and <i>&quot;inspecting an individual UpdateConcert&quot;</i> don&#39;t go together, do they? Either you have an empty slice and therefore there is no individual element that you can inspect, or your slice isn&#39;t empty."}, {"owner": {"reputation": 39, "user_id": 5297926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/845566ff2643308e0292ed2490c52231?s=128&d=identicon&r=PG&f=1", "display_name": "mitchem", "link": "https://stackoverflow.com/users/5297926/mitchem"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1502367560, "post_id": 45600373, "comment_id": 78185370, "body": "@mkopriva I may be missing something here, but where are you understanding that I am inspecting a singular element? I should have defined it better; but <code>bytes, err := json.Marshal(concerts)</code> ... <code>concerts</code> is defined as <code>var concerts []UpdateConcert</code>  I also believe that the <code>fmt.Printf(str)</code> will produce the entirety of the stringified Marshalled bytes and that the <code>fmt.Printf(arrayToUnmarshalInto)</code> will print the slice of UpdateConcerts. Regardless of if the print statement is wrong or not; inspecting the elements in debug still shows that it does not work."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1502368553, "post_id": 45600373, "comment_id": 78186165, "body": "quote from your originla post: &quot;However, the arrayToUnmarshalInto produces an empty slice. And when inspecting an individual UpdateConcert struct we see only default values and nil.&quot;"}, {"owner": {"reputation": 39, "user_id": 5297926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/845566ff2643308e0292ed2490c52231?s=128&d=identicon&r=PG&f=1", "display_name": "mitchem", "link": "https://stackoverflow.com/users/5297926/mitchem"}, "edited": false, "score": 0, "creation_date": 1502368747, "post_id": 45600373, "comment_id": 78186325, "body": "Ah, I understand now. I am sorry. What I was referring to was that I had tried to both marshal and unmarshal a singular <code>UpdateConcert</code> as well as a slice of <code>UpdateConcert</code>s. The original code was intended to work for a slice of <code>UpdateConcert</code>s; but currently I cannot unmarshal either."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1502368887, "post_id": 45600373, "comment_id": 78186423, "body": "If you comment out the <code>DomConcert</code> field from the <code>FullConcert</code> type, are the other fields still empty or are they marshaled/unmarshaled properly?"}, {"owner": {"reputation": 39, "user_id": 5297926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/845566ff2643308e0292ed2490c52231?s=128&d=identicon&r=PG&f=1", "display_name": "mitchem", "link": "https://stackoverflow.com/users/5297926/mitchem"}, "edited": false, "score": 0, "creation_date": 1502369659, "post_id": 45600373, "comment_id": 78187051, "body": "The data I was testing with had no data at the <code>FullConcert</code> level, I added some data and it would appear that regardless of if the <code>DomConcert</code> is there or not, it successfully unmarshals the <code>FullConcert</code> struct. Where it looks to be failing is specifically at the <code>*dom.Concert</code> portion."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1502370198, "post_id": 45600373, "comment_id": 78187493, "body": "So when you unmarshal the data, the resulting <code>arrayToUnmarshalInto</code> is not an empty slice but the field <code>arrayToUnmarshalInto[N].FullConcert.DomConcert</code> is <code>nil</code>? Or it&#39;s not <code>nil</code> it&#39;s just that all of it&#39;s fields are not being unmarshaled? Does <code>*dom.Concert</code> implement the <code>json.Unmarshaler</code> interface?"}, {"owner": {"reputation": 39, "user_id": 5297926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/845566ff2643308e0292ed2490c52231?s=128&d=identicon&r=PG&f=1", "display_name": "mitchem", "link": "https://stackoverflow.com/users/5297926/mitchem"}, "edited": false, "score": 0, "creation_date": 1502370530, "post_id": 45600373, "comment_id": 78187779, "body": "Correct; <code>arrayToUnmarshalInto</code> is not an empty slice and <code>arrayToUnmarshalInto[N].FullConcert.DomConcert</code> is not <code>nil</code> but any field existing on <code>DomConcert</code> is either <code>&quot;&quot;</code>, <code>nil</code>, or <code>0</code>. <code>dom.Concert</code> does not implement the <code>json.Unmarshaler</code> interface. However; I am able to successfully do a <code>json.Marshal(concerts[N].FullConcert.DomConcert)</code> followed by a <code>json.Unmarshal(bytes, &amp;concert)</code> and retrieve the data."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1502372258, "post_id": 45600373, "comment_id": 78189363, "body": "I&#39;m sorry I&#39;ve ran out of ideas."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502394679, "post_id": 45600373, "comment_id": 78204310, "body": "Could we get a playground sample that reproduces the erroneous behaviour?"}, {"owner": {"reputation": 39, "user_id": 5297926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/845566ff2643308e0292ed2490c52231?s=128&d=identicon&r=PG&f=1", "display_name": "mitchem", "link": "https://stackoverflow.com/users/5297926/mitchem"}, "edited": false, "score": 0, "creation_date": 1502397870, "post_id": 45600373, "comment_id": 78205903, "body": "I have created a playground sample here: <a href=\"https://play.golang.org/p/z_dzP6FTU2\" rel=\"nofollow noreferrer\">play.golang.org/p/z_dzP6FTU2</a>"}, {"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "edited": false, "score": 1, "creation_date": 1502698164, "post_id": 45600373, "comment_id": 78297408, "body": "I don&#39;t understand the issue your playground sample is meant to be showing. It&#39;s not working because you are using private (lowercase) struct fields. Changing the fields to public (starting with an uppercase letter) makes the JSON marshal/unmarshal work as I would expect."}], "owner": {"reputation": 39, "user_id": 5297926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/845566ff2643308e0292ed2490c52231?s=128&d=identicon&r=PG&f=1", "display_name": "mitchem", "link": "https://stackoverflow.com/users/5297926/mitchem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 755, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1502312125, "creation_date": 1502311624, "last_edit_date": 1502312125, "question_id": 45600373, "link": "https://stackoverflow.com/questions/45600373/golang-unmarshal-extreme-nested-struct", "title": "GoLang Unmarshal Extreme Nested Struct", "body": "<p>Given the following structs</p>\n\n<pre><code>type UpdateConcert struct {\n    FullConcert FullConcert\n    Fields    map[string]interface{}\n}\n\ntype FullConcert struct {\n    DomConcert       *dom.Concert\n    DomSingerID string `json:\"domSingerID\"`\n    DomSingerGroupID string `json:\"domSingerGroupID\"`\n}\n</code></pre>\n\n<p>With the dom.Concert being too large to post but contains int64, int, more nested struct slices, strings, string slices, and time pointers for a total of 90 fields on the dom.Concert (not including the lower nested structs). Also, all json tags are present on both the dom.Concert as well as all nested structs on it.</p>\n\n<p>When doing: </p>\n\n<pre><code>    var arrayToUnmarshalInto []UpdateConcert\n    var bytes []byte\n    bytes, err = json.Marshal(concerts)\n    if err != nil {\n        return errors.Wrap(err, \"Failed to marshal concerts\")\n    }\n\n    byteLength := len(bytes)\n    str := string(bytes[:byteLength])\n    err = json.Unmarshal(bytes, &amp;arrayToUnmarshalInto)\n    if err != nil {\n        return errors.Wrap(err, \"Failed to unmarshal concerts\")\n    }\n    fmt.Printf(\"%v\", str)\n    fmt.Printf(\"%v\", arrayToUnmarshalInto)\n    return nil\n</code></pre>\n\n<p>While using the standard json.Marshal from the \"encoding/json\" package we can get a valid byte slice back, and when casting to a string from the byte slice we see the expected stringified JSON. However, the arrayToUnmarshalInto produces an empty slice. And when inspecting an individual UpdateConcert struct we see only default values and nil. However, when iterating over a map[string]inteface{} that we have unmarshaled into, we can successfully print all values.</p>\n\n<p>How would one go about writing a custom unmarshal for such a varied and deeply nested struct?</p>\n"}, {"tags": ["string", "go", "escaping"], "comments": [{"owner": {"reputation": 11451, "user_id": 2790047, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c5a7631a67903295da25dabb94e1f51b?s=128&d=identicon&r=PG", "display_name": "jodag", "link": "https://stackoverflow.com/users/2790047/jodag"}, "edited": false, "score": 1, "creation_date": 1502308944, "post_id": 45599637, "comment_id": 78158773, "body": "Does <code>q := fmt.Sprintf(&quot;\\\\\\&quot;%s\\&quot;\\\\&quot;, x)</code> work?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1502309433, "post_id": 45599637, "comment_id": 78159014, "body": "Or use raw string literals: <code>(`\\&quot;%s\\&quot;`)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 11451, "user_id": 2790047, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c5a7631a67903295da25dabb94e1f51b?s=128&d=identicon&r=PG", "display_name": "jodag", "link": "https://stackoverflow.com/users/2790047/jodag"}, "is_accepted": true, "score": 3, "last_activity_date": 1502309184, "last_edit_date": 1502309184, "creation_date": 1502309082, "answer_id": 45599707, "question_id": 45599637, "link": "https://stackoverflow.com/questions/45599637/how-create-string-with-escape-character/45599707#45599707", "title": "How create string with escape character?", "body": "<p>Use escape sequences preceded by <code>\\</code> to show literal special characters in a formatted string <code>\\\\</code> for <code>\\</code> and <code>\\\"</code> for <code>\"</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    x := \"hello\"\n    q := fmt.Sprintf(\"\\\\\\\"%s\\\"\\\\\", x)\n    fmt.Println(q)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": false, "score": 0, "last_activity_date": 1502310092, "creation_date": 1502310092, "answer_id": 45599990, "question_id": 45599637, "link": "https://stackoverflow.com/questions/45599637/how-create-string-with-escape-character/45599990#45599990", "title": "How create string with escape character?", "body": "<p>A more functional, flexible solution, depending on your taste:</p>\n\n<pre><code>x := \"hello\"\np := []byte{'\"', '\\\\', '\"', '\"'}\nq := append(append(p, []byte(x)...), p...)\nfmt.Printf(\"%s\", q)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/MHOsdefZYW\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MHOsdefZYW</a></p>\n"}], "owner": {"reputation": 387, "user_id": 4160072, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh4.googleusercontent.com/-87BjCfblqW4/AAAAAAAAAAI/AAAAAAAAAuU/96eymOXkgvs/photo.jpg?sz=128", "display_name": "Mohammed", "link": "https://stackoverflow.com/users/4160072/mohammed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1821, "favorite_count": 0, "accepted_answer_id": 45599707, "answer_count": 2, "score": -1, "last_activity_date": 1502310092, "creation_date": 1502308842, "last_edit_date": 1502309004, "question_id": 45599637, "link": "https://stackoverflow.com/questions/45599637/how-create-string-with-escape-character", "title": "How create string with escape character?", "body": "<p>I want to create string <code>\\\"str\\\"</code> but i want to give variable name to str.\nFor ex : \n<code>\nx := \"name\"\nq := fmt.Sprintf(\"\\\"%s\\\"\", x)\n</code>\nI want q = <code>\"\\\"name\\\"\"</code></p>\n\n<p>I tried <a href=\"https://play.golang.org/p/hi10SzmnOp\" rel=\"nofollow noreferrer\">this</a> </p>\n"}, {"tags": ["go", "tcp", "unsafe-pointers"], "comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502299282, "post_id": 45596789, "comment_id": 78153421, "body": "did you get it to work with a sample where the size is known?"}, {"owner": {"reputation": 23, "user_id": 8056311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a902dc16c39348cc4050451c42fef66d?s=128&d=identicon&r=PG&f=1", "display_name": "Ari", "link": "https://stackoverflow.com/users/8056311/ari"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502299766, "post_id": 45596789, "comment_id": 78153672, "body": "@TehSphinX , I didn&#39;t try it, and I am not sure if that is a good way even if the size was known.  In my case the size need to be calculated, and is always unknown in advance."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502300047, "post_id": 45596789, "comment_id": 78153839, "body": "just wondering if you had solved the second part already..."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1502301905, "post_id": 45596789, "comment_id": 78154938, "body": "I don&#39;t know the details, of course, but it seems like you might be better off serializing your data using protobuf or something similar. Sending the raw bytes that make up some Go type isn&#39;t portable."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1502302079, "post_id": 45596789, "comment_id": 78155034, "body": "Or <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow noreferrer\"><code>gob</code></a>, which is more efficient than protobuf but less flexible and less interoperable."}, {"owner": {"reputation": 6373, "user_id": 245428, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ca9a9d2d1f1e3bdaa4ed21d336166a7a?s=128&d=identicon&r=PG", "display_name": "xiaoyi", "link": "https://stackoverflow.com/users/245428/xiaoyi"}, "edited": false, "score": 1, "creation_date": 1502320081, "post_id": 45596789, "comment_id": 78163381, "body": "It shouldn&#39;t work. Messing around with memory in go is not a good practice. Use some serialization package to do this instead.  The performance gain from unsafe casting cannot justify the fact that this may introduce memory leak/corruption."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": -1, "last_activity_date": 1502302024, "creation_date": 1502302024, "answer_id": 45597771, "question_id": 45596789, "link": "https://stackoverflow.com/questions/45596789/fast-way-of-converting-a-slice-of-type-t-to-a-slice-of-byte-in-go/45597771#45597771", "title": "Fast way of converting a slice of type T, to a slice of byte in Go", "body": "<p>In your sample code you're creating arrays, not slices, hence the error. To create a slice of a specific length, use <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\"><code>make</code></a>, which does not require the length to be a constant. When you create an array, the length must be a constant, because you're creating an unnamed type which must be resolvable at compile time.</p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1502372100, "post_id": 45604492, "comment_id": 78189192, "body": "From the description of <a href=\"https://golang.org/pkg/reflect/#SliceHeader\" rel=\"nofollow noreferrer\"><code>reflect.SliceHeader</code></a>: &quot;It cannot be used safely or portably and its representation may change in a later release.&quot; This is a very fragile implementation, and nonsensical to anyone else who reads it - why not just use a proper encoding like <code>gob</code>?"}], "tags": [], "owner": {"reputation": 23, "user_id": 8056311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a902dc16c39348cc4050451c42fef66d?s=128&d=identicon&r=PG&f=1", "display_name": "Ari", "link": "https://stackoverflow.com/users/8056311/ari"}, "is_accepted": false, "score": 0, "last_activity_date": 1502339305, "creation_date": 1502339305, "answer_id": 45604492, "question_id": 45596789, "link": "https://stackoverflow.com/questions/45596789/fast-way-of-converting-a-slice-of-type-t-to-a-slice-of-byte-in-go/45604492#45604492", "title": "Fast way of converting a slice of type T, to a slice of byte in Go", "body": "<p>So this is what I ended up doing (posting it as an answer to my question):</p>\n\n<pre><code>import \"unsafe\"\nimport \"reflect\"   \n\nmySliceR := *(*reflect.SliceHeader)(unsafe.Pointer(&amp;mySlice))\nmySliceR.Len *= mySliceElemSize\nmySliceR.Cap *= mySliceElemSize\n\nbyteSlice := *(*[]byte)(unsafe.Pointer(&amp;mySliceR))\n</code></pre>\n\n<p>I tested it for different array sizes, and it is better than looping through individual elements (using only unsafe.Pointer) only when arrays are large enough.</p>\n"}], "owner": {"reputation": 23, "user_id": 8056311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a902dc16c39348cc4050451c42fef66d?s=128&d=identicon&r=PG&f=1", "display_name": "Ari", "link": "https://stackoverflow.com/users/8056311/ari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1502339305, "creation_date": 1502298528, "question_id": 45596789, "link": "https://stackoverflow.com/questions/45596789/fast-way-of-converting-a-slice-of-type-t-to-a-slice-of-byte-in-go", "title": "Fast way of converting a slice of type T, to a slice of byte in Go", "body": "<p>I have slices of different types, and I need to send them with TCP. The length of my slices is large, and not a constant value. Is there any way that I can convert the slices into []byte without looping through individual elements? For example, I want something like this (assuming mySlice elements are 4 Bytes here): </p>\n\n<pre><code>byteSlice := (*[4 * len(mySlice)]byte)(unsafe.Pointer(&amp;mySlice[0]))\n</code></pre>\n\n<p>but it won't work, since <code>4 * len(mySlice)</code> is not a constant.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "mocking"], "comments": [{"owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 0, "creation_date": 1502307816, "post_id": 45596695, "comment_id": 78158233, "body": "Unfortunately function signatures must match exactly to satisfy an interface, and <code>func(string) TestRows</code> is not the same as <code>func(string) *Rows</code> <i>even though</i> <code>*Rows</code> satisfies the <code>TestRows</code> interface. There are, however, database mocking libraries that solve this problem, and my suggestion is to use one of those."}, {"owner": {"reputation": 31, "user_id": 8440683, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9QDNGTPHHNM/AAAAAAAAAAI/AAAAAAAABAg/Pkw7azr9Fls/photo.jpg?sz=128", "display_name": "Vahe Grigorian", "link": "https://stackoverflow.com/users/8440683/vahe-grigorian"}, "reply_to_user": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 0, "creation_date": 1502308861, "post_id": 45596695, "comment_id": 78158727, "body": "Thanks @AlexGuerra."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 8440683, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9QDNGTPHHNM/AAAAAAAAAAI/AAAAAAAABAg/Pkw7azr9Fls/photo.jpg?sz=128", "display_name": "Vahe Grigorian", "link": "https://stackoverflow.com/users/8440683/vahe-grigorian"}, "edited": false, "score": 0, "creation_date": 1502308671, "post_id": 45597315, "comment_id": 78158641, "body": "Well, that is the definition of the <code>Query</code> method from the <code>database&#47;sql</code> package. I can&#39;t change that."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 31, "user_id": 8440683, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9QDNGTPHHNM/AAAAAAAAAAI/AAAAAAAABAg/Pkw7azr9Fls/photo.jpg?sz=128", "display_name": "Vahe Grigorian", "link": "https://stackoverflow.com/users/8440683/vahe-grigorian"}, "edited": false, "score": 0, "creation_date": 1502309016, "post_id": 45597315, "comment_id": 78158814, "body": "See my edit to the answer. The code you provided runs with this... Of course there might be other code not working because of this change. You will have to follow through adjusting that as well."}, {"owner": {"reputation": 31, "user_id": 8440683, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9QDNGTPHHNM/AAAAAAAAAAI/AAAAAAAABAg/Pkw7azr9Fls/photo.jpg?sz=128", "display_name": "Vahe Grigorian", "link": "https://stackoverflow.com/users/8440683/vahe-grigorian"}, "edited": false, "score": 0, "creation_date": 1502310653, "post_id": 45597315, "comment_id": 78159611, "body": "Thank you @TehSphinx. But, in this case <code>TestDB</code> becomes dependent on the actual implementation of the <code>*Rows</code> which is not what I want."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 31, "user_id": 8440683, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9QDNGTPHHNM/AAAAAAAAAAI/AAAAAAAABAg/Pkw7azr9Fls/photo.jpg?sz=128", "display_name": "Vahe Grigorian", "link": "https://stackoverflow.com/users/8440683/vahe-grigorian"}, "edited": false, "score": 0, "creation_date": 1502311151, "post_id": 45597315, "comment_id": 78159842, "body": "I guess then you have no other option than to use a database mocking library as suggested by @AlexGuerra"}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 0, "last_activity_date": 1502309346, "last_edit_date": 1502309346, "creation_date": 1502300378, "answer_id": 45597315, "question_id": 45596695, "link": "https://stackoverflow.com/questions/45596695/mocking-database-return-types-with-interfaces/45597315#45597315", "title": "Mocking database return types with interfaces", "body": "<p>The definition of <code>Query</code> function needs to be:</p>\n\n<pre><code>func (d *DB) Query(query string, args ...interface{}) (TestRows, error) {\n    return &amp;Rows{count: 1}, nil\n}\n</code></pre>\n\n<p>Edit:</p>\n\n<p>If as -- you pointed out -- you can't change the implementation of the <code>Query</code> function because you need to meet other interfaces, then you need to adjust your own interfaces. In this case</p>\n\n<pre><code>type TestDB interface {\n    Query(query string, args ...interface{}) (*Rows, error)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": false, "score": 1, "last_activity_date": 1502350757, "creation_date": 1502350757, "answer_id": 45607378, "question_id": 45596695, "link": "https://stackoverflow.com/questions/45596695/mocking-database-return-types-with-interfaces/45607378#45607378", "title": "Mocking database return types with interfaces", "body": "<p>I would suggest that it's a bad idea to mock the DB. You can verify that queries are being called with a particular SQL string and return fake results but this really isn't useful. These tests add little value and install a false sense of confidence. There's absolutely no link between what your test accepts and what will actually run in your DB.</p>\n\n<p>One of the real dangers is that your database schema could change but your mocks aren't updated. Then your code will fail in production but pass the tests.</p>\n\n<p>Instead, implement some sort of data abstraction layer, e.g. like a <a href=\"https://en.wikipedia.org/wiki/Data_access_object\" rel=\"nofollow noreferrer\">Data Access Object</a> (DAO). </p>\n\n<p>You can write automatic integration tests that will test your DAO against your database. This will ensure that your DAO actually works and catch any errors like a query not being updated after a schema change.</p>\n\n<p>You can then write unit tests for your other code. Anything that interacts  with the database should use a mock/stub/fake DAO depending on what the test requires.</p>\n"}], "owner": {"reputation": 31, "user_id": 8440683, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9QDNGTPHHNM/AAAAAAAAAAI/AAAAAAAABAg/Pkw7azr9Fls/photo.jpg?sz=128", "display_name": "Vahe Grigorian", "link": "https://stackoverflow.com/users/8440683/vahe-grigorian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 631, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1502350757, "creation_date": 1502298215, "last_edit_date": 1502311780, "question_id": 45596695, "link": "https://stackoverflow.com/questions/45596695/mocking-database-return-types-with-interfaces", "title": "Mocking database return types with interfaces", "body": "<p>How to correctly mock some <code>*sql.DB</code> methods for unit testing using interfaces? For example, I want to have a <code>Store</code> struct that is used as a datasource for my handlers. It has a <code>conn</code> field that is the <code>*sql.DB</code>. But in my tests I want to mock the DB, so I try to return not the actual <code>*sql.Rows</code> but an interface that the <code>*sql.Rows</code> should satisfy. Here is the code:</p>\n\n<pre><code>type TestRows interface {\n    Scan ()\n}\n\ntype TestDB interface {\n    Query (query string, args ...interface{}) (TestRows, error) \n}\n\ntype Rows struct {\n    //..\n}\n\nfunc (r *Rows) Scan () {\n    fmt.Println(\"Scanning\")\n}\n</code></pre>\n\n<p>This is the <code>*sql.DB</code></p>\n\n<pre><code>type DB struct {\n    //...\n}\n\nfunc (d *DB) Query (query string, args ...inteface{}) (*Rows, error) {\n    return &amp;Rows{/* .... */}, nil\n}\n</code></pre>\n\n<p>And when I want to instantiate the <code>Store</code>, it throws error</p>\n\n<pre><code>type Store struct {\n    conn TestDB\n}\n\nfunc main() { \n    cl := Store {conn: &amp;DB{}}\n    fmt.Println(\"Hello, playground\")\n}\n\ncannot use DB literal (type *DB) as type TestDB in field value:\n    *DB does not implement TestDB (wrong type for Query method)\n        have Query(string) (*Rows, error)\n        want Query(string) (TestRows, error)\n</code></pre>\n"}, {"tags": ["go", "refactoring"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 2, "creation_date": 1502298132, "post_id": 45596651, "comment_id": 78152749, "body": "<code>struct{}</code> is the &quot;empty struct&quot; it is a very specific type. Perhaps the &quot;empty interface&quot; <code>interface{}</code> would help more, but passing a slice of them is also tricky."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1502298196, "post_id": 45596651, "comment_id": 78152775, "body": "<code>[]OrderRevenue</code> is not <code>[]struct{}</code>.... I&#39;m not sure what else you need to know."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1502298290, "post_id": 45596651, "comment_id": 78152831, "body": "Perhaps take a look at the implementations of e.g. <code>json.Unmarshal</code>/<code>xml.Unmarshal</code> as they&#39;re performing similar functions."}], "answers": [{"tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": true, "score": 2, "last_activity_date": 1502311054, "creation_date": 1502311054, "answer_id": 45600231, "question_id": 45596651, "link": "https://stackoverflow.com/questions/45596651/function-that-accepts-generic-struct/45600231#45600231", "title": "Function that accepts generic struct", "body": "<p>This is considered the cornerstone (or more of a limitation) of Go's type system. <code>struct{}</code> is an unnamed type that is different from <code>struct{ field1 int }</code> and of course is not the same as <code>OrderRevenue{}</code>.</p>\n\n<p>Go emphasizes abstraction through interfaces, and perhaps you should try that. Here is the first take:</p>\n\n<pre><code>  type OrderRevenue interface {\n          MarshalMyself() ([]byte, error)\n  }\n\n  type Anonymous struct {}\n  func (a Anonymous) MarshalMyself() ([]byte, error) {\n          // implementation's up to you\n          return []byte{}, nil\n  }\n\n  // the function signature\n  generateResponse(rows *sqlx.Rows, structSlice []OrderRevenue, structBody Body) ([]Body, error) {\n          // ...\n  }\n</code></pre>\n\n<p>In this case you can also use empty interface <code>interface{}</code>, which all types implement, but you'll have to recursively go through the structure to do manual type assertion. The best approach in Go is to know the shape of your data in advance, at least partially.</p>\n"}], "owner": {"reputation": 1536, "user_id": 1793374, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qK8kV.png?s=128&g=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/1793374/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3790, "favorite_count": 0, "accepted_answer_id": 45600231, "answer_count": 1, "score": 0, "last_activity_date": 1502311054, "creation_date": 1502298057, "last_edit_date": 1502299375, "question_id": 45596651, "link": "https://stackoverflow.com/questions/45596651/function-that-accepts-generic-struct", "title": "Function that accepts generic struct", "body": "<p>Is it possible to have my function definition below accept any type of struct?</p>\n\n<p>I've tried to refactor like so:</p>\n\n<pre><code>// This method should accept any type of struct\n// Once I receive my response from the database,\n// I scan the rows to create a slice of type struct.\n\nfunc generateResponse(rows *sqlx.Rows, structSlice []struct{}, structBody struct{}) ([]struct{}, error) {\n    for rows.Next() {\n\n        err := rows.StructScan(&amp;structBody)\n\n        if err != nil {\n            return nil, err\n        }\n\n        structSlice = append(structSlice, structBody)\n\n    }\n\n    err := rows.Err()\n    if err != nil {\n        return nil, err\n    }\n\n    return structSlice, nil\n}\n</code></pre>\n\n<p>Assume my struct is of type <code>OrderRevenue</code>.</p>\n\n<p>When I call the function above:</p>\n\n<p><code>structSlice, err := generateResponse(rows, []OrderRevenue{}, OrderRevenue{})</code></p>\n\n<p>The error I get is:</p>\n\n<p><code>cannot use []OrderRevenue literal as type []struct{} in argument...</code></p>\n\n<p>Am I going about this the wrong way?</p>\n"}, {"tags": ["python", "go"], "answers": [{"comments": [{"owner": {"reputation": 1756, "user_id": 8219037, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/n5hMR.jpg?s=128&g=1", "display_name": "Beginner", "link": "https://stackoverflow.com/users/8219037/beginner"}, "edited": false, "score": 0, "creation_date": 1502291517, "post_id": 45594384, "comment_id": 78148536, "body": "Is there a flag for building the binary in debug mode? I don&#39;t remember specifying any option related to debugging. I mean to ask if inclusion of this script can be made optional."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1756, "user_id": 8219037, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/n5hMR.jpg?s=128&g=1", "display_name": "Beginner", "link": "https://stackoverflow.com/users/8219037/beginner"}, "edited": false, "score": 1, "creation_date": 1502292430, "post_id": 45594384, "comment_id": 78149257, "body": "@Beginner: it&#39;s not included in the binary, it&#39;s only referenced by name in the DWARF info. You can optionally disable DWARF generation with the <code>-w</code> link flag, but there&#39;s generally no reason to do so."}, {"owner": {"reputation": 1756, "user_id": 8219037, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/n5hMR.jpg?s=128&g=1", "display_name": "Beginner", "link": "https://stackoverflow.com/users/8219037/beginner"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1502293054, "post_id": 45594384, "comment_id": 78149721, "body": "@JimB - Thanks for your inputs."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 6, "last_activity_date": 1502291215, "creation_date": 1502291215, "answer_id": 45594384, "question_id": 45594286, "link": "https://stackoverflow.com/questions/45594286/what-is-the-role-of-runtime-gdb-py-in-go-language/45594384#45594384", "title": "What is the role of runtime-gdb.py in Go language?", "body": "<p>If you use the <a href=\"https://www.gnu.org/software/gdb/\" rel=\"noreferrer\">gdb</a> debugger to debug your program, loading that script improves its features for working with Go programs, such as being able to look at the values inside of maps and slices (instead of seeing them as opaque pointers) and being able to list and inspect goroutines (instead of native threads). gdb uses Python for extensions.</p>\n"}, {"tags": [], "owner": {"reputation": 633, "user_id": 59511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/037021b18e2fed97487375c7461997d2?s=128&d=identicon&r=PG", "display_name": "mhb", "link": "https://stackoverflow.com/users/59511/mhb"}, "is_accepted": false, "score": 2, "last_activity_date": 1502291284, "creation_date": 1502291284, "answer_id": 45594414, "question_id": 45594286, "link": "https://stackoverflow.com/questions/45594286/what-is-the-role-of-runtime-gdb-py-in-go-language/45594414#45594414", "title": "What is the role of runtime-gdb.py in Go language?", "body": "<p>gdb is scriptable in python. This is a script for golang support.</p>\n"}], "owner": {"reputation": 1756, "user_id": 8219037, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/n5hMR.jpg?s=128&g=1", "display_name": "Beginner", "link": "https://stackoverflow.com/users/8219037/beginner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 0, "accepted_answer_id": 45594384, "answer_count": 2, "score": 4, "last_activity_date": 1502291284, "creation_date": 1502290926, "question_id": 45594286, "link": "https://stackoverflow.com/questions/45594286/what-is-the-role-of-runtime-gdb-py-in-go-language", "title": "What is the role of runtime-gdb.py in Go language?", "body": "<p>I just created my first <a href=\"https://gobyexample.com/hello-world\" rel=\"noreferrer\">\"Hello World\"</a> program in Go language, built it and created the binary file. Upon inspecting the binary, I came across reference to this <a href=\"https://golang.org/src/runtime/runtime-gdb.py\" rel=\"noreferrer\">python script</a> inside the binary file.</p>\n\n<p>The description of this script reads</p>\n\n<blockquote>\n  <p>This script is loaded by GDB when it finds a .debug_gdb_scripts\n  section in the compiled binary. The [68]l linkers emit this with a\n  path to this file based on the path to the runtime package.</p>\n</blockquote>\n\n<p>I don't understand the meaning of this clearly. So, what is <strong><a href=\"https://golang.org/src/runtime/runtime-gdb.py\" rel=\"noreferrer\">runtime-gdb.py</a></strong> and how is it related to Go language?</p>\n"}, {"tags": ["elasticsearch", "go", "elasticsearch-bulk-api"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1502290347, "last_edit_date": 1502290347, "creation_date": 1502289430, "answer_id": 45593735, "question_id": 45593319, "link": "https://stackoverflow.com/questions/45593319/how-to-check-if-elasticsearch-bulkprocessor-service-exists/45593735#45593735", "title": "how to check if ElasticSearch BulkProcessor Service exists", "body": "<p>Register the bulk processor separately from sending the documents. The bulk processor only lives as long as your process, so to ensure you only create it once, create it when your process starts. Then elsewhere in your application, you can send documents whenever you need to.</p>\n\n<p>Alternatively, if you must do it on-demand, you can use a <a href=\"https://golang.org/pkg/sync/#Once\" rel=\"nofollow noreferrer\"><code>sync.Once</code></a> to ensure the creation only happens once.</p>\n"}], "owner": {"reputation": 1347, "user_id": 4622470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6015804f9937b6231b4b0022d70b5ddb?s=128&d=identicon&r=PG&f=1", "display_name": "Rohanil", "link": "https://stackoverflow.com/users/4622470/rohanil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1502290347, "creation_date": 1502288318, "question_id": 45593319, "link": "https://stackoverflow.com/questions/45593319/how-to-check-if-elasticsearch-bulkprocessor-service-exists", "title": "how to check if ElasticSearch BulkProcessor Service exists", "body": "<p>I am using <code>elastic</code> package for <code>golang</code>. I want to use its <code>BulkProcessor</code> for sending huge amount of documents in background. As per shown in <a href=\"https://github.com/olivere/elastic/wiki/BulkProcessor\" rel=\"nofollow noreferrer\">wiki</a>, I could create a processor. But I don't want to create it every time I send the documents. I want to know if there is processor service exists in the connection and pass data to existing processor rather than creating new. How can I achieve it?</p>\n"}, {"tags": ["c", "go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 7, "last_activity_date": 1502287799, "last_edit_date": 1502287799, "creation_date": 1502287153, "answer_id": 45592870, "question_id": 45592817, "link": "https://stackoverflow.com/questions/45592817/how-to-send-a-slice-to-a-function-in-go/45592870#45592870", "title": "How to send a slice to a function in Go?", "body": "<p>The parameters that specify a length (e.g. <code>[SharedKeyBytes]byte</code>) are arrays, not slices; therefor, you cannot pass a slice, hence the type mismatch error. You can either:</p>\n\n<ul>\n<li>Change the parameter type to slice (<code>[]byte</code>)</li>\n<li>Copy the slice to an appropriately-sized array prior to calling the function, then pass the array to the function instead of the slice (<a href=\"https://play.golang.org/p/KEr23NVvUo\" rel=\"noreferrer\">playground example</a>)</li>\n</ul>\n"}], "owner": {"reputation": 3242, "user_id": 6360938, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/ae1e709f8e8beb1d09db43a881c97610?s=128&d=identicon&r=PG&f=1", "display_name": "typos", "link": "https://stackoverflow.com/users/6360938/typos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 45592870, "answer_count": 1, "score": 0, "last_activity_date": 1502287799, "creation_date": 1502287032, "question_id": 45592817, "link": "https://stackoverflow.com/questions/45592817/how-to-send-a-slice-to-a-function-in-go", "title": "How to send a slice to a function in Go?", "body": "<p>I'm rewriting some C code in Go. And in my C code I have stuff like this:</p>\n\n<pre><code>static void sharedb(unsigned char *sharedkey, unsigned char *send,\n                    const unsigned char *received) {\n    unsigned char krq[96]; \n    unsigned char buf[64];\n    // rest removed for brevity\n\n    indcpa_enc(send, buf, received, krq + 32);\n}\n</code></pre>\n\n<p>Where <code>indcpa_enc</code> function is defined like this:</p>\n\n<pre><code>static void indcpa_enc(unsigned char *c,\n                       const unsigned char *m,\n                       const unsigned char *pk,\n                       const unsigned char *coins)\n</code></pre>\n\n<p>So, in my Go code instead of using <code>char</code> arrays I used <code>byte</code> arrays. Where I have something like this:</p>\n\n<pre><code>func SharedB(sharedKey, send, received []byte) {\n    var krq [96]byte\n    var buf [64]byte\n\n    // rest removed for brevity\n\n    INDCPAEnc(send[:], buf[:SharedKeyBytes], received[:], krq[32:32+CoinBytes])\n}\n</code></pre>\n\n<p>Where <code>INDCPAEnc</code> function is defined like this:</p>\n\n<pre><code>func INDCPAEnc(c []byte, m [SharedKeyBytes]byte, pk []byte, coins [CoinBytes]byte) \n</code></pre>\n\n<p>Though, this function call in Go gives me an array, regarding type mismatch. How can I convert a C code like above to a proper Go code? Also, should I use the pointer notation <code>*</code> for my Go function parameters as in C?</p>\n"}, {"tags": ["node.js", "docker", "go", "hapijs"], "comments": [{"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1502281527, "post_id": 45590483, "comment_id": 78140105, "body": "Your Go code for making connection and posting details?"}, {"owner": {"reputation": 361, "user_id": 2584375, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/bqYJ8.jpg?s=128&g=1", "display_name": "BadgerBadgerBadgerBadger", "link": "https://stackoverflow.com/users/2584375/badgerbadgerbadgerbadger"}, "reply_to_user": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1502382888, "post_id": 45590483, "comment_id": 78197551, "body": "@TarunLalwani I&#39;ve added the relevant go code."}, {"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1502384724, "post_id": 45590483, "comment_id": 78198650, "body": "So are you hitting the error in your go code for the first call?"}, {"owner": {"reputation": 361, "user_id": 2584375, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/bqYJ8.jpg?s=128&g=1", "display_name": "BadgerBadgerBadgerBadger", "link": "https://stackoverflow.com/users/2584375/badgerbadgerbadgerbadger"}, "reply_to_user": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1502388236, "post_id": 45590483, "comment_id": 78200778, "body": "@TarunLalwani The error log doesn&#39;t show up in the go code, it shows up in the Node code. And it has no side-effects, just the log."}, {"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1502388344, "post_id": 45590483, "comment_id": 78200827, "body": "What i meant is that use a simple Go code with no retry code or anything and see if the same issue occurs."}, {"owner": {"reputation": 136, "user_id": 2211743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eef04a11268c59dcc181bd7f0c4784bd?s=128&d=identicon&r=PG", "display_name": "ambrons", "link": "https://stackoverflow.com/users/2211743/ambrons"}, "edited": false, "score": 0, "creation_date": 1507154069, "post_id": 45590483, "comment_id": 80103100, "body": "I&#39;m seeing similar behavior with Hapi running node 6.x.  The behavior is the same as well that Hapi prints an error log, but nothing appears to be effected by it."}], "owner": {"reputation": 361, "user_id": 2584375, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/bqYJ8.jpg?s=128&g=1", "display_name": "BadgerBadgerBadgerBadger", "link": "https://stackoverflow.com/users/2584375/badgerbadgerbadgerbadger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1090, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1502382866, "creation_date": 1502281028, "last_edit_date": 1502382866, "question_id": 45590483, "link": "https://stackoverflow.com/questions/45590483/message-read-econnreset-stack-error-read-econnreset-when-calling-a-hapijs-se", "title": "message: read ECONNRESET, stack: Error: read ECONNRESET when calling a HapiJs server from a Go client inside a docker container", "body": "<ul>\n<li><strong>Node Version</strong>: 6.11.1</li>\n<li><strong>Platform</strong>: Ubuntu 14.04 inside a docker container.</li>\n<li><strong>Subsystem</strong>: http</li>\n</ul>\n\n<p>A very unique problem faced when calling an endpoint in a Node project running a hapijs server. When the endpoint is hit directly, there aren't any problems.</p>\n\n<p>But when we hit it from a <a href=\"https://github.com/Codigami/gohaqd\" rel=\"nofollow noreferrer\">gohaqd</a> instance, we get:</p>\n\n<p><code>\n170809/044343.745, [log,connection,client,error] message: write EPIPE, stack: Error: write EPIPE\n    at exports._errnoException (util.js:1018:11)\n    at WriteWrap.afterWrite (net.js:800:14)\n</code></p>\n\n<p>and more often</p>\n\n<p><code>\n170809/040643.248, [log,connection,client,error] message: read ECONNRESET, stack: Error: read ECONNRESET\n    at exports._errnoException (util.js:1018:11)\n    at TCP.onread (net.js:568:26)\n</code></p>\n\n<p>I know the error codes mean that somewhere, the app is trying to write to a closed connection. But for the life of me I can't figure out where. The logs themselves are from hapijs, <a href=\"https://github.com/hapijs/hapi/blob/3d4f0fc5859803962553af8acff45ac9f5b6df89/lib/connection.js#L94\" rel=\"nofollow noreferrer\">this line</a> if I'm not wrong, but couldn't figure out why node was trying to write to a closed connection, anyway.</p>\n\n<p>Mind, there's no side-effect from this. The app runs fine :|</p>\n\n<p>We turned on <code>NODE_DEBUG=http, net</code> and got the following results. The only thing that stuck out when reading these is that in the second the <code>write ret = true</code> line appears twice, if that means anything. Can someone help me understand what it means?</p>\n\n<p>The first one is when hitting the endpoint directly:</p>\n\n<pre><code>NET 422: onconnection\nNET 422: _read\nNET 422: Socket._read readStart\nHTTP 422: SERVER new http connection\nHTTP 422: SERVER socketOnParserExecute 333\nNET 422: onread 775\nNET 422: got data\nNET 422: _read\nHTTP 422: call onSocket 0 0\nHTTP 422: createConnection api.mixpanel.com:80: { servername: 'api.mixpanel.com',\n  path: null,\n  headers: {},\n  port: 80,\n  host: 'api.mixpanel.com',\n  _agentKey: 'api.mixpanel.com:80:' }\nNET 422: createConnection [ { servername: 'api.mixpanel.com',\n    path: null,\n    headers: {},\n    port: 80,\n    host: 'api.mixpanel.com',\n    _agentKey: 'api.mixpanel.com:80:',\n    encoding: null },\n  [Function: oncreate] ]\nNET 422: pipe false null\nNET 422: connect: find host api.mixpanel.com\nNET 422: connect: dns options { family: undefined, hints: 32 }\nHTTP 422: sockets api.mixpanel.com:80: 1\nHTTP 422: outgoing message end.\nHTTP 422: call onSocket 1 0\nHTTP 422: createConnection api.mixpanel.com:80: { servername: 'api.mixpanel.com',\n  path: null,\n  headers: {},\n  port: 80,\n  host: 'api.mixpanel.com',\n  _agentKey: 'api.mixpanel.com:80:' }\nNET 422: createConnection [ { servername: 'api.mixpanel.com',\n    path: null,\n    headers: {},\n    port: 80,\n    host: 'api.mixpanel.com',\n    _agentKey: 'api.mixpanel.com:80:',\n    encoding: null },\n  [Function: oncreate] ]\nNET 422: pipe false null\nNET 422: connect: find host api.mixpanel.com\nNET 422: connect: dns options { family: undefined, hints: 32 }\nHTTP 422: sockets api.mixpanel.com:80: 2\nHTTP 422: outgoing message end.\nHTTP 422: call onSocket 2 0\nHTTP 422: createConnection api.mixpanel.com:80: { servername: 'api.mixpanel.com',\n  path: null,\n  headers: {},\n  port: 80,\n  host: 'api.mixpanel.com',\n  _agentKey: 'api.mixpanel.com:80:' }\nNET 422: createConnection [ { servername: 'api.mixpanel.com',\n    path: null,\n    headers: {},\n    port: 80,\n    host: 'api.mixpanel.com',\n    _agentKey: 'api.mixpanel.com:80:',\n    encoding: null },\n  [Function: oncreate] ]\nNET 422: pipe false null\nNET 422: connect: find host api.mixpanel.com\nNET 422: connect: dns options { family: undefined, hints: 32 }\nHTTP 422: sockets api.mixpanel.com:80: 3\nHTTP 422: outgoing message end.\nNET 422: _read\nNET 422: _read wait for connection\nNET 422: _read\nNET 422: _read wait for connection\nNET 422: _read\nNET 422: _read wait for connection\nNET 422: afterConnect\nNET 422: _read\nNET 422: Socket._read readStart\nNET 422: afterConnect\nNET 422: _read\nNET 422: Socket._read readStart\nNET 422: afterConnect\nNET 422: _read\nNET 422: Socket._read readStart\nNET 422: onread 438\nNET 422: got data\nHTTP 422: AGENT incoming response!\nHTTP 422: AGENT isHeadResponse false\nNET 422: _read\nHTTP 422: AGENT socket.destroySoon()\nNET 422: onSocketFinish\nNET 422: oSF: not ended, call shutdown()\nNET 422: destroy undefined\nNET 422: destroy\nNET 422: close\nNET 422: close handle\nNET 422: afterShutdown destroyed=true ReadableState {\n  objectMode: false,\n  highWaterMark: 16384,\n  buffer: BufferList { head: null, tail: null, length: 0 },\n  length: 0,\n  pipes: null,\n  pipesCount: 0,\n  flowing: true,\n  ended: false,\n  endEmitted: false,\n  reading: true,\n  sync: false,\n  needReadable: true,\n  emittedReadable: false,\n  readableListening: false,\n  resumeScheduled: false,\n  defaultEncoding: 'utf8',\n  ranOut: false,\n  awaitDrain: 0,\n  readingMore: false,\n  decoder: null,\n  encoding: null }\nNET 422: emit close\nHTTP 422: CLIENT socket onClose\nHTTP 422: removeSocket api.mixpanel.com:80: writable: false\nHTTP 422: HTTP socket close\nNET 422: onread 438\nNET 422: got data\nHTTP 422: AGENT incoming response!\nHTTP 422: AGENT isHeadResponse false\nNET 422: _read\nHTTP 422: AGENT socket.destroySoon()\nNET 422: onSocketFinish\nNET 422: oSF: not ended, call shutdown()\nNET 422: destroy undefined\nNET 422: destroy\nNET 422: close\nNET 422: close handle\nNET 422: onread 486\nNET 422: got data\nHTTP 422: AGENT incoming response!\nHTTP 422: AGENT isHeadResponse false\nNET 422: _read\nHTTP 422: AGENT socket.destroySoon()\nNET 422: onSocketFinish\nNET 422: oSF: not ended, call shutdown()\nNET 422: destroy undefined\nNET 422: destroy\nNET 422: close\nNET 422: close handle\nNET 422: afterShutdown destroyed=true ReadableState {\n  objectMode: false,\n  highWaterMark: 16384,\n  buffer: BufferList { head: null, tail: null, length: 0 },\n  length: 0,\n  pipes: null,\n  pipesCount: 0,\n  flowing: true,\n  ended: false,\n  endEmitted: false,\n  reading: true,\n  sync: false,\n  needReadable: true,\n  emittedReadable: false,\n  readableListening: false,\n  resumeScheduled: false,\n  defaultEncoding: 'utf8',\n  ranOut: false,\n  awaitDrain: 0,\n  readingMore: false,\n  decoder: null,\n  encoding: null }\nNET 422: emit close\nHTTP 422: CLIENT socket onClose\nHTTP 422: removeSocket api.mixpanel.com:80: writable: false\nHTTP 422: HTTP socket close\nNET 422: afterShutdown destroyed=true ReadableState {\n  objectMode: false,\n  highWaterMark: 16384,\n  buffer: BufferList { head: null, tail: null, length: 0 },\n  length: 0,\n  pipes: null,\n  pipesCount: 0,\n  flowing: true,\n  ended: false,\n  endEmitted: false,\n  reading: true,\n  sync: false,\n  needReadable: true,\n  emittedReadable: false,\n  readableListening: false,\n  resumeScheduled: false,\n  defaultEncoding: 'utf8',\n  ranOut: false,\n  awaitDrain: 0,\n  readingMore: false,\n  decoder: null,\n  encoding: null }\nNET 422: emit close\nHTTP 422: CLIENT socket onClose\nHTTP 422: removeSocket api.mixpanel.com:80: writable: false\nHTTP 422: HTTP socket close\nHTTP 422: write ret = true\nHTTP 422: outgoing message end.\nNET 422: onread -4095\nNET 422: EOF\nNET 422: onSocketEnd ReadableState {\n  objectMode: false,\n  highWaterMark: 16384,\n  buffer: BufferList { head: null, tail: null, length: 0 },\n  length: 0,\n  pipes: null,\n  pipesCount: 0,\n  flowing: true,\n  ended: true,\n  endEmitted: false,\n  reading: false,\n  sync: false,\n  needReadable: false,\n  emittedReadable: false,\n  readableListening: false,\n  resumeScheduled: false,\n  defaultEncoding: 'utf8',\n  ranOut: false,\n  awaitDrain: 0,\n  readingMore: false,\n  decoder: null,\n  encoding: null }\nNET 422: onSocketFinish\nNET 422: oSF: ended, destroy ReadableState {\n  objectMode: false,\n  highWaterMark: 16384,\n  buffer: BufferList { head: null, tail: null, length: 0 },\n  length: 0,\n  pipes: null,\n  pipesCount: 0,\n  flowing: true,\n  ended: true,\n  endEmitted: true,\n  reading: false,\n  sync: false,\n  needReadable: false,\n  emittedReadable: false,\n  readableListening: false,\n  resumeScheduled: false,\n  defaultEncoding: 'utf8',\n  ranOut: false,\n  awaitDrain: 0,\n  readingMore: false,\n  decoder: null,\n  encoding: null }\nNET 422: destroy undefined\nNET 422: destroy\nNET 422: close\nNET 422: close handle\nNET 422: has server\nNET 422: SERVER _emitCloseIfDrained\nNET 422: SERVER handle? true   connections? 15\nNET 422: emit close\nHTTP 422: server socket close\n</code></pre>\n\n<p>The next one is when the endpoint is hit from gohaqd, which is a go client.</p>\n\n<pre><code>NET 422: onread 405\nNET 422: got data\nNET 422: _read\nNET 422: onconnection\nNET 422: _read\nNET 422: Socket._read readStart\nHTTP 422: SERVER new http connection\nHTTP 422: SERVER socketOnParserExecute 325\nNET 422: onread 775\nNET 422: got data\nNET 422: _read\nHTTP 422: call onSocket 0 0\nHTTP 422: createConnection api.mixpanel.com:80: { servername: 'api.mixpanel.com',\n  path: null,\n  headers: {},\n  port: 80,\n  host: 'api.mixpanel.com',\n  _agentKey: 'api.mixpanel.com:80:' }\nNET 422: createConnection [ { servername: 'api.mixpanel.com',\n    path: null,\n    headers: {},\n    port: 80,\n    host: 'api.mixpanel.com',\n    _agentKey: 'api.mixpanel.com:80:',\n    encoding: null },\n  [Function: oncreate] ]\nNET 422: pipe false null\nNET 422: connect: find host api.mixpanel.com\nNET 422: connect: dns options { family: undefined, hints: 32 }\nHTTP 422: sockets api.mixpanel.com:80: 1\nHTTP 422: outgoing message end.\nHTTP 422: call onSocket 1 0\nHTTP 422: createConnection api.mixpanel.com:80: { servername: 'api.mixpanel.com',\n  path: null,\n  headers: {},\n  port: 80,\n  host: 'api.mixpanel.com',\n  _agentKey: 'api.mixpanel.com:80:' }\nNET 422: createConnection [ { servername: 'api.mixpanel.com',\n    path: null,\n    headers: {},\n    port: 80,\n    host: 'api.mixpanel.com',\n    _agentKey: 'api.mixpanel.com:80:',\n    encoding: null },\n  [Function: oncreate] ]\nNET 422: pipe false null\nNET 422: connect: find host api.mixpanel.com\nNET 422: connect: dns options { family: undefined, hints: 32 }\nHTTP 422: sockets api.mixpanel.com:80: 2\nHTTP 422: outgoing message end.\nHTTP 422: call onSocket 2 0\nHTTP 422: createConnection api.mixpanel.com:80: { servername: 'api.mixpanel.com',\n  path: null,\n  headers: {},\n  port: 80,\n  host: 'api.mixpanel.com',\n  _agentKey: 'api.mixpanel.com:80:' }\nNET 422: createConnection [ { servername: 'api.mixpanel.com',\n    path: null,\n    headers: {},\n    port: 80,\n    host: 'api.mixpanel.com',\n    _agentKey: 'api.mixpanel.com:80:',\n    encoding: null },\n  [Function: oncreate] ]\nNET 422: pipe false null\nNET 422: connect: find host api.mixpanel.com\nNET 422: connect: dns options { family: undefined, hints: 32 }\nHTTP 422: sockets api.mixpanel.com:80: 3\nHTTP 422: outgoing message end.\nNET 422: _read\nNET 422: _read wait for connection\nNET 422: _read\nNET 422: _read wait for connection\nNET 422: _read\nNET 422: _read wait for connection\nNET 422: afterConnect\nNET 422: _read\nNET 422: Socket._read readStart\nNET 422: afterConnect\nNET 422: _read\nNET 422: Socket._read readStart\nNET 422: afterConnect\nNET 422: _read\nNET 422: Socket._read readStart\nNET 422: onread 438\nNET 422: got data\nHTTP 422: AGENT incoming response!\nHTTP 422: AGENT isHeadResponse false\nNET 422: _read\nHTTP 422: AGENT socket.destroySoon()\nNET 422: onSocketFinish\nNET 422: oSF: not ended, call shutdown()\nNET 422: destroy undefined\nNET 422: destroy\nNET 422: close\nNET 422: close handle\nNET 422: afterShutdown destroyed=true ReadableState {\n  objectMode: false,\n  highWaterMark: 16384,\n  buffer: BufferList { head: null, tail: null, length: 0 },\n  length: 0,\n  pipes: null,\n  pipesCount: 0,\n  flowing: true,\n  ended: false,\n  endEmitted: false,\n  reading: true,\n  sync: false,\n  needReadable: true,\n  emittedReadable: false,\n  readableListening: false,\n  resumeScheduled: false,\n  defaultEncoding: 'utf8',\n  ranOut: false,\n  awaitDrain: 0,\n  readingMore: false,\n  decoder: null,\n  encoding: null }\nNET 422: emit close\nHTTP 422: CLIENT socket onClose\nHTTP 422: removeSocket api.mixpanel.com:80: writable: false\nHTTP 422: HTTP socket close\nNET 422: onread 438\nNET 422: got data\nHTTP 422: AGENT incoming response!\nHTTP 422: AGENT isHeadResponse false\nNET 422: _read\nHTTP 422: AGENT socket.destroySoon()\nNET 422: onSocketFinish\nNET 422: oSF: not ended, call shutdown()\nNET 422: destroy undefined\nNET 422: destroy\nNET 422: close\nNET 422: close handle\nNET 422: onread 486\nNET 422: got data\nHTTP 422: AGENT incoming response!\nHTTP 422: AGENT isHeadResponse false\nNET 422: _read\nHTTP 422: AGENT socket.destroySoon()\nNET 422: onSocketFinish\nNET 422: oSF: not ended, call shutdown()\nNET 422: destroy undefined\nNET 422: destroy\nNET 422: close\nNET 422: close handle\nNET 422: afterShutdown destroyed=true ReadableState {\n  objectMode: false,\n  highWaterMark: 16384,\n  buffer: BufferList { head: null, tail: null, length: 0 },\n  length: 0,\n  pipes: null,\n  pipesCount: 0,\n  flowing: true,\n  ended: false,\n  endEmitted: false,\n  reading: true,\n  sync: false,\n  needReadable: true,\n  emittedReadable: false,\n  readableListening: false,\n  resumeScheduled: false,\n  defaultEncoding: 'utf8',\n  ranOut: false,\n  awaitDrain: 0,\n  readingMore: false,\n  decoder: null,\n  encoding: null }\nNET 422: emit close\nHTTP 422: CLIENT socket onClose\nHTTP 422: removeSocket api.mixpanel.com:80: writable: false\nHTTP 422: HTTP socket close\nNET 422: afterShutdown destroyed=true ReadableState {\n  objectMode: false,\n  highWaterMark: 16384,\n  buffer: BufferList { head: null, tail: null, length: 0 },\n  length: 0,\n  pipes: null,\n  pipesCount: 0,\n  flowing: true,\n  ended: false,\n  endEmitted: false,\n  reading: true,\n  sync: false,\n  needReadable: true,\n  emittedReadable: false,\n  readableListening: false,\n  resumeScheduled: false,\n  defaultEncoding: 'utf8',\n  ranOut: false,\n  awaitDrain: 0,\n  readingMore: false,\n  decoder: null,\n  encoding: null }\nNET 422: emit close\nHTTP 422: CLIENT socket onClose\nHTTP 422: removeSocket api.mixpanel.com:80: writable: false\nHTTP 422: HTTP socket close\nHTTP 422: write ret = true\nNET 422: afterWrite 0\nNET 422: afterWrite call cb\nHTTP 422: write ret = true\nHTTP 422: outgoing message end.\nNET 422: onread -4095\nNET 422: EOF\nNET 422: onSocketEnd ReadableState {\n  objectMode: false,\n  highWaterMark: 16384,\n  buffer: BufferList { head: null, tail: null, length: 0 },\n  length: 0,\n  pipes: null,\n  pipesCount: 0,\n  flowing: true,\n  ended: true,\n  endEmitted: false,\n  reading: false,\n  sync: false,\n  needReadable: false,\n  emittedReadable: false,\n  readableListening: false,\n  resumeScheduled: false,\n  defaultEncoding: 'utf8',\n  ranOut: false,\n  awaitDrain: 0,\n  readingMore: false,\n  decoder: null,\n  encoding: null }\nNET 422: afterWrite 0\nNET 422: afterWrite call cb\nNET 422: afterWrite -32\nNET 422: write failure { Error: write EPIPE\n    at exports._errnoException (util.js:1018:11)\n    at WriteWrap.afterWrite (net.js:800:14) code: 'EPIPE', errno: 'EPIPE', syscall: 'write' }\nNET 422: destroy\nNET 422: close\nNET 422: close handle\n170809/101228.947, [log,connection,client,error] message: write EPIPE, stack: Error: write EPIPE\n    at exports._errnoException (util.js:1018:11)\n    at WriteWrap.afterWrite (net.js:800:14)\nNET 422: has server\nNET 422: SERVER _emitCloseIfDrained\nNET 422: SERVER handle? true   connections? 15\nNET 422: emit close\nHTTP 422: server socket close\n</code></pre>\n\n<p>The go code that calls this:</p>\n\n<pre><code>// Sends a POST request to consumption endpoint with the SQS message as body\nfunc sendMessageToURL(msg string) bool {\n    var resp *http.Response\n    var err error\n\n    endpoint := url\n\n    if endpoint == \"\" {\n        m := make(map[string]string)\n        err := json.Unmarshal([]byte(msg), &amp;m)\n        if err != nil {\n            log.Printf(\"Unable to parse JSON message to get the URL: %s\", msg)\n            return false\n        }\n        endpoint = m[\"url\"]\n        if endpoint == \"\" {\n            log.Printf(\"No 'url' field found in JSON message: %s\", msg)\n            return false\n        }\n    }\n\n    for {\n        resp, err = httpClient.Post(endpoint, \"application/json\", bytes.NewBuffer([]byte(msg)))\n        if err == nil {\n            break\n        }\n        log.Printf(\"Error hitting endpoint, retrying after 1 second... Error: %s\", err.Error())\n        time.Sleep(time.Second)\n    }\n    defer resp.Body.Close()\n\n    // return true only if response is 200 OK\n    if resp.StatusCode != 200 {\n        bodyBytes, _ := ioutil.ReadAll(resp.Body)\n        log.Printf(\"Error: Non OK response: %s Status Code: '%s' for sent message: '%s'\", string(bodyBytes), resp.Status, msg)\n        return false\n    }\n\n    return true\n}\n</code></pre>\n"}, {"tags": ["go", "goland"], "answers": [{"comments": [{"owner": {"reputation": 363, "user_id": 6459288, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/yUbcq.jpg?s=128&g=1", "display_name": "matiux", "link": "https://stackoverflow.com/users/6459288/matiux"}, "edited": false, "score": 0, "creation_date": 1502281540, "post_id": 45590498, "comment_id": 78140120, "body": "Hi, I have already see that option but I have setting it on &quot;go ftm&quot; to format code.. Unfortunately it can have only one action during &quot;on save&quot;"}, {"owner": {"reputation": 527, "user_id": 1195832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc4796b90f1b852b6efce7617f8dad94?s=128&d=identicon&r=PG", "display_name": "mat007", "link": "https://stackoverflow.com/users/1195832/mat007"}, "edited": false, "score": 0, "creation_date": 1560325213, "post_id": 45590498, "comment_id": 99694212, "body": "This is really impossible to use as with Goland constantly saving the source file I&#39;m editing I&#39;m effectively fighting <code>goimports</code> all the time: if I don&#39;t type quick enough (and I mean reeeally quick) <code>goimports</code> will just delete the code as I&#39;m typing it\u2026"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1561631119, "post_id": 45590498, "comment_id": 100132161, "body": "Goland shouldn&#39;t autosave while you are typing. Or maybe you changed that setting? I think the default is: autosave after 15sec inactivity.  But I had that issue sometimes as well. Not seen it lately though. Maybe my new Notebook is too fast."}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 23, "last_activity_date": 1614006235, "last_edit_date": 1614006235, "creation_date": 1502281059, "answer_id": 45590498, "question_id": 45590236, "link": "https://stackoverflow.com/questions/45590236/running-goimports-on-save-in-goland/45590498#45590498", "title": "Running &#39;goimports&#39; on save in GoLand", "body": "<p>Adjusted due to new version of Goland:</p>\n<p>The setting has meanwhile moved to the File Watchers. Here you can add a new file watcher at the bottom and select <code>goimports</code> from the list.</p>\n<p><a href=\"https://i.stack.imgur.com/8fbiL.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/8fbiL.png\" alt=\"enter image description here\" /></a></p>\n<p>Setting this to <code>goimports</code> will do both:</p>\n<ul>\n<li>code formatting (<code>gofmt</code>)</li>\n<li>updating imports</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 8944, "user_id": 2634160, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TqRzm.png?s=128&g=1", "display_name": "Elon Than", "link": "https://stackoverflow.com/users/2634160/elon-than"}, "is_accepted": false, "score": 10, "last_activity_date": 1538489477, "creation_date": 1538489477, "answer_id": 52610188, "question_id": 45590236, "link": "https://stackoverflow.com/questions/45590236/running-goimports-on-save-in-goland/52610188#52610188", "title": "Running &#39;goimports&#39; on save in GoLand", "body": "<p>\"On Save\" tab was removed in <a href=\"https://blog.jetbrains.com/go/2017/10/18/gogland-eap-16-file-watcher-tons-of-new-inspections-smarter-navigate-to-test-and-more/\" rel=\"noreferrer\">GogLand EAP 16</a>.</p>\n\n<p>In newer versions you have to go to <code>Settings</code> -> <code>Tools</code> -> <code>File Watchers</code> and add <code>goimports</code> there.</p>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 11223953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZGOCr.jpg?s=128&g=1", "display_name": "Jordan Lam", "link": "https://stackoverflow.com/users/11223953/jordan-lam"}, "is_accepted": false, "score": 6, "last_activity_date": 1614702299, "last_edit_date": 1614702299, "creation_date": 1560408442, "answer_id": 56574779, "question_id": 45590236, "link": "https://stackoverflow.com/questions/45590236/running-goimports-on-save-in-goland/56574779#56574779", "title": "Running &#39;goimports&#39; on save in GoLand", "body": "<p>For those fighting with gofmt on Goland autosave (mat007 comment)</p>\n<p>You can double click the item in file watchers to show an edit watcher menu.</p>\n<p>Uncheck Auto-save edited files to trigger watcher and it should now only trigger on manual save:</p>\n<p><a href=\"https://i.stack.imgur.com/OEPVj.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/OEPVj.png\" alt=\"enter image description here\" /></a>\n(Goland 2020.3)</p>\n"}], "owner": {"reputation": 363, "user_id": 6459288, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/yUbcq.jpg?s=128&g=1", "display_name": "matiux", "link": "https://stackoverflow.com/users/6459288/matiux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11612, "favorite_count": 1, "accepted_answer_id": 45590498, "answer_count": 3, "score": 16, "last_activity_date": 1614702299, "creation_date": 1502280394, "last_edit_date": 1531393788, "question_id": 45590236, "link": "https://stackoverflow.com/questions/45590236/running-goimports-on-save-in-goland", "title": "Running &#39;goimports&#39; on save in GoLand", "body": "<p>I'm using GoLand IDE to code in Go.\nWhen I save a file, I'd like that the unused imports disappear (like VS code)</p>\n\n<p>I have enable \"Optimize imports\" in \"Code\" -> \"Show reformat file dialog\". But when I save the file, imports it's still present</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1502277786, "post_id": 45589270, "comment_id": 78137232, "body": "This is one reason that third party libraries should not vendor their dependencies. :(  There&#39;s not a clean solution, other than to convince the library author that their package is misbehaving."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1502285535, "post_id": 45590202, "comment_id": 78143486, "body": "A package registering a DB driver is fine <i>if the package is a DB driver</i>. That&#39;s the standard mechanism for writing DB drivers. The problem is OP is using a third-party library that has vendored dependencies, which is a bad practice for exactly this reason."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 1, "last_activity_date": 1502280627, "last_edit_date": 1502280627, "creation_date": 1502280302, "answer_id": 45590202, "question_id": 45589270, "link": "https://stackoverflow.com/questions/45589270/golang-dependencies-registering-sql-driver-in-init-causing-clash/45590202#45590202", "title": "Golang dependencies registering sql driver in init() causing clash", "body": "<p>First of all, I would ditch the dependency. If it's registering a database driver - something that dependencies <em>really should never do</em> - I predict there will be more problems with it. Also I suggest opening an issue.</p>\n\n<p>As a workaround, you can import the library depending on whether you are in a test build or not. So you will have a file called e.g. <code>mysqlimport.go</code> with nothing but</p>\n\n<pre><code>// +build !test\n\nimport _ \"github.com/go-sql-driver/mysql\"\n</code></pre>\n\n<p>This way this code will only be called when you're not testing. Although you'll have to start your tests with <code>go test -tags test</code>.</p>\n"}], "owner": {"reputation": 113, "user_id": 3187712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tndIB.jpg?s=128&g=1", "display_name": "jcmturner", "link": "https://stackoverflow.com/users/3187712/jcmturner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 485, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1502280627, "creation_date": 1502277713, "question_id": 45589270, "link": "https://stackoverflow.com/questions/45589270/golang-dependencies-registering-sql-driver-in-init-causing-clash", "title": "Golang dependencies registering sql driver in init() causing clash", "body": "<p>I have some Go tests that depend on some external code which has init() methods that registers mysql drivers. My code also needs to register mysql drivers and I therefore end up with a panic and the error \"Register called twice for driver mysql\" when running my tests.</p>\n\n<p>It seems that the repo I'm dependent on has a vendors directory with the driver in it (\"vendors/github.com/go-sql-driver/mysql\"). It seems that when I run my tests the init() methods in the driver are called and registers the mysql driver causing the clash.</p>\n\n<p>The best option I can see would be to copy the dependency to my own vendors directory and remove the mysql driver from the dependency's vendor directory. However I'm not keen on this as it involves duplicating my dependency and then modifying it by deleting files. Also, I'm only dependent on this for running tests so I'm not sure I should be moving it to my vendors directory any way.</p>\n\n<p>Is there a way to prevent init() being called on a dependency's vendor dependencies?</p>\n"}, {"tags": ["go", "case-sensitive"], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 8438882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a1d332794b4c22670ec707ddb48d8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Mayer", "link": "https://stackoverflow.com/users/8438882/adam-mayer"}, "edited": false, "score": 2, "creation_date": 1502280791, "post_id": 45587010, "comment_id": 78139438, "body": "I can&#39;t be sure of the &quot;suffix&quot; case so I will ToLower that as well, that seems to make the most sense.  if strings.HasSuffix(strings.ToLower(s), strings.ToLower(extension)) {     // do something  }"}, {"owner": {"reputation": 2382, "user_id": 6272277, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/522db908ba9addc9a647f5c8a8f8421a?s=128&d=identicon&r=PG&f=1", "display_name": "Lassi", "link": "https://stackoverflow.com/users/6272277/lassi"}, "edited": false, "score": 0, "creation_date": 1540382165, "post_id": 45587010, "comment_id": 92842920, "body": "<code>HasSuffix()</code> is better than <code>filepath.Ext()</code> even for filenames when you know the extension(s) you are interested in. Some filenames have more than one extension, e.g. <code>tar.gz</code>. <code>HasSuffix()</code> can be called in exactly the same way to handle both the single-extension and multi-extension cases."}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 9, "last_activity_date": 1502276964, "last_edit_date": 1502276964, "creation_date": 1502271612, "answer_id": 45587010, "question_id": 45586944, "link": "https://stackoverflow.com/questions/45586944/case-insensitive-hassuffix-in-go/45587010#45587010", "title": "Case insensitive HasSuffix in Go", "body": "<p>You could just use</p>\n\n<pre><code>if strings.HasSuffix(strings.ToLower(s), \"suffix\") {\n    // do something \n}\n</code></pre>\n\n<p>You can also write your own wrapper function:</p>\n\n<pre><code>func hasSuffix(s, suffix string, caseSensitive bool) bool {\n    if caseSensitive {\n        return strings.HasSuffix(s, suffix)\n    }\n    return strings.HasSuffix(strings.ToLower(s), suffix)\n}\n</code></pre>\n\n<p>For file names or paths you can use (see answer of PeterSO):</p>\n\n<pre><code>if strings.ToLower(filepath.Ext(s)) == \".fileending\" {\n    // do something\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1502281195, "last_edit_date": 1502281195, "creation_date": 1502275978, "answer_id": 45588659, "question_id": 45586944, "link": "https://stackoverflow.com/questions/45586944/case-insensitive-hassuffix-in-go/45588659#45588659", "title": "Case insensitive HasSuffix in Go", "body": "<blockquote>\n  <p>\"I am looking for specific file types from a directory listing. I would like to make this comparison case insensitive.\"</p>\n</blockquote>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"path/filepath\"\n    \"strings\"\n)\n\nfunc hasExts(path string, exts []string) bool {\n    pathExt := strings.ToLower(filepath.Ext(path))\n    for _, ext := range exts {\n        if pathExt == strings.ToLower(ext) {\n            return true\n        }\n    }\n    return false\n}\n\nfunc main() {\n    dir := `./`\n    files, err := ioutil.ReadDir(dir)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    sourceExts := []string{\".go\", \".Py\", \".c\", \".cpp\"}\n    for _, fi := range files {\n        if hasExts(fi.Name(), sourceExts) {\n            fmt.Println(fi.Name())\n        }\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>t.c\nt.go\nt.py\nt1.go\nt1.py\nt2.go\n</code></pre>\n\n<hr>\n\n<p>For a special form of <code>strings.HasSuffix</code> start by copying the code from the <a href=\"https://golang.org/src/strings/strings.go\" rel=\"nofollow noreferrer\"><code>strings</code> package</a>.</p>\n\n<pre><code>func HasSuffix(s, suffix string) bool {\n    return len(s) &gt;= len(suffix) &amp;&amp; s[len(s)-len(suffix):] == suffix\n}\n</code></pre>\n\n<p>Then modify it to suit your purpose. For example,</p>\n\n<pre><code>func hasSuffix(s, suffix string) bool {\n    return len(s) &gt;= len(suffix) &amp;&amp;\n        strings.ToLower(s[len(s)-len(suffix):]) == strings.ToLower(suffix)\n}\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 8438882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a1d332794b4c22670ec707ddb48d8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Mayer", "link": "https://stackoverflow.com/users/8438882/adam-mayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1629, "favorite_count": 1, "accepted_answer_id": 45587010, "answer_count": 2, "score": 3, "last_activity_date": 1502281195, "creation_date": 1502271424, "question_id": 45586944, "link": "https://stackoverflow.com/questions/45586944/case-insensitive-hassuffix-in-go", "title": "Case insensitive HasSuffix in Go", "body": "<p>I am looking for specific file types from a directory listing and use HasSuffix to do the comparision looking for a few specific file types. I would like to make this comparison case insensitive.</p>\n\n<p>Is there a way to add EqualFold or another case insensitive comparison to the HasSuffix function?</p>\n"}, {"tags": ["dictionary", "go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4283089"}, "edited": false, "score": 0, "creation_date": 1502269646, "post_id": 45585833, "comment_id": 78131287, "body": "<a href=\"https://github.com/TyphoonMC/TyphoonLimbo\" rel=\"nofollow noreferrer\">github.com/TyphoonMC/TyphoonLimbo</a> there is full code that i use"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4283089"}, "edited": false, "score": 0, "creation_date": 1502269740, "post_id": 45585833, "comment_id": 78131345, "body": "Okay, sorry fror my mistake, its not probably map fault.          /root/work/src/github.com/user/imoobler/utils.go:33 i have posted my source code above."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502269809, "post_id": 45585833, "comment_id": 78131399, "body": "Can you run <code>-race</code> detection?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4283089"}, "edited": false, "score": 0, "creation_date": 1502270002, "post_id": 45585833, "comment_id": 78131519, "body": "Sure, <a href=\"https://pastebin.com/4sX56En3\" rel=\"nofollow noreferrer\">pastebin.com/4sX56En3</a> full error after using -race argument"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502270550, "post_id": 45585833, "comment_id": 78131916, "body": "It seems to me like the line numers have changed to the code that is on <a href=\"https://github.com/TyphoonMC/TyphoonLimbo\" rel=\"nofollow noreferrer\">github.com/TyphoonMC/TyphoonLimbo</a>. <code>limbo.go:44</code> seems to be correct and points to this code <code>for _, player := range players {</code>. I assume the <code>players</code> map is accessed by multiple go routines. You need to control access to this <code>map</code> (via <code>Mutex</code>/<code>RWMutex</code>) or use a <code>syncmap</code> as suggested in my answer."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4283089"}, "edited": false, "score": 0, "creation_date": 1502270629, "post_id": 45585833, "comment_id": 78131987, "body": "Yea, i removed some log lines. I will try first syncmap :)"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502270709, "post_id": 45585833, "comment_id": 78132044, "body": "I will add a sample for syncmap as well"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4283089"}, "edited": false, "score": 0, "creation_date": 1502270729, "post_id": 45585833, "comment_id": 78132062, "body": "players syncmap[int]*Player = make(syncmap[int]*Player) something like that? Im begginer in golang :)"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502271140, "post_id": 45585833, "comment_id": 78132372, "body": "see my Sample above. <code>syncmap</code> is a struct and works differently than a <code>map</code>. It has functions to <code>Load</code>, <code>Store</code>, <code>Range</code> over the content"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4283089"}, "edited": false, "score": 0, "creation_date": 1502271853, "post_id": 45585833, "comment_id": 78132898, "body": "undefined: syncmap in syncmap.Map"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502271968, "post_id": 45585833, "comment_id": 78132984, "body": "go get it first with <code>go get golang.org&#47;x&#47;sync&#47;syncmap</code> and import with <code>import &quot;golang.org&#47;x&#47;sync&#47;syncmap&quot;</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4283089"}, "edited": false, "score": 0, "creation_date": 1502272824, "post_id": 45585833, "comment_id": 78133594, "body": "Okay i think i have replaced all with syncMap, now i get this: limbo.go:55: syntax error: unexpected semicolon or newline, expecting comma or ) ), current limbo.go: <a href=\"https://pastebin.com/QH92Khr6\" rel=\"nofollow noreferrer\">pastebin.com/QH92Khr6</a>"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502273221, "post_id": 45585833, "comment_id": 78133867, "body": "you are not closing <code>players.Range(</code>. See my code above. Also have a look at <code>Gogland</code>. In my opinion it is currently the best IDE for go and free as it is still in development."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4283089"}, "edited": false, "score": 0, "creation_date": 1502273505, "post_id": 45585833, "comment_id": 78134075, "body": "Okay, sorry for my &quot;stupid&quot; questions, i think i got last possible error in this case :P limbo.go:45: undefined: player <a href=\"https://pastebin.com/MZA1VrFq\" rel=\"nofollow noreferrer\">pastebin.com/MZA1VrFq</a>"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502274070, "post_id": 45585833, "comment_id": 78134534, "body": "Have a look <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">here</a>. The first variable is the player, the second is of type <code>bool</code> telling you if the type cast was successful or not: <code>player, ok := value.(player)</code>. If you are sure all values will be of type <code>player</code> anyway, you can shorten it to <code>player := value.(player)</code>. Note: wasn&#39;t the <code>player</code> struct exported? Shouldn&#39;t it be <code>value.(Player)</code>? It is supposed to be a type!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4283089"}, "edited": false, "score": 0, "creation_date": 1502278116, "post_id": 45585833, "comment_id": 78137457, "body": "players.Range(func(key, value interface{}) bool { why this doesnt return any value? :o"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502278371, "post_id": 45585833, "comment_id": 78137639, "body": "it is not supposed to (see <a href=\"https://godoc.org/golang.org/x/sync/syncmap#Map.Range\" rel=\"nofollow noreferrer\">documentation</a>). Note: the function given to the <code>Range</code> function returns a <code>bool</code>. This <code>bool</code> is used by the <code>Range</code> function to know if it should continue or not (<code>false</code> = stop, <code>true</code> = continue). The <code>Range</code> function itself does not have a return value."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4283089"}, "edited": false, "score": 0, "creation_date": 1502280384, "post_id": 45585833, "comment_id": 78139115, "body": "So how can i use function x for every y value from list?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4283089"}, "edited": false, "score": 0, "creation_date": 1502280776, "post_id": 45585833, "comment_id": 78139426, "body": "<a href=\"Https://pastebin.com/gutu2tUA\" rel=\"nofollow noreferrer\">Https://pastebin.com/gutu2tUA</a> I&#39;m doing same things like in your sample, i want to manipulate player object (which represents value from map)"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502281889, "post_id": 45585833, "comment_id": 78140404, "body": "Here a working example: <a href=\"https://play.golang.org/p/nXLB-30xI3\" rel=\"nofollow noreferrer\">playground</a>. Note: you cannot run it on playground. The syncmap package is not installed there. In your code: 1) don&#39;t <code>return false</code> if <code>ok</code> is not true. That was to show how to break the loop. You want to go through all items. 2) Save the changed player back to the map (see playground)"}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 57, "last_activity_date": 1502282846, "last_edit_date": 1502282846, "creation_date": 1502268516, "answer_id": 45585833, "question_id": 45585589, "link": "https://stackoverflow.com/questions/45585589/golang-fatal-error-concurrent-map-read-and-map-write/45585833#45585833", "title": "Golang fatal error: concurrent map read and map write", "body": "<p>Generally speaking (without having access to the code where the error occurs) you have a few options. Here are two of them:</p>\n\n<h3>sync.RWMutex</h3>\n\n<p>Control access to the map with <code>sync.RWMutex{}</code>. Use this option if you have single reads and writes, not loops over the map. See <a href=\"https://golang.org/pkg/sync/#RWMutex\" rel=\"noreferrer\">RWMutex</a></p>\n\n<p>Here a sample with access control to <code>someMap</code> via <code>someMapMutex</code>:</p>\n\n<pre><code>var (\n    someMap      = map[string]string{}\n    someMapMutex = sync.RWMutex{}\n)\n\ngo func() {\n    someMapMutex.Lock()\n    someMap[\"key\"] = \"value\"\n    someMapMutex.Unlock()\n}()\n\nsomeMapMutex.RLock()\nv, ok := someMap[\"key\"]\nsomeMapMutex.RUnlock()\nif !ok {\n    fmt.Println(\"key missing\")\n    return\n}\nfmt.Println(v)\n</code></pre>\n\n<h3>syncmap.Map</h3>\n\n<p>Use a <code>syncmap.Map{}</code> instead of a normal <code>map</code>. This map is already taking care of race issues but may be slower depending on your usage. <code>syncmap.Map{}</code>s main advantage lies with for loops. See <a href=\"https://godoc.org/golang.org/x/sync/syncmap\" rel=\"noreferrer\">syncmap</a></p>\n\n<pre><code>var (\n    someMap = syncmap.Map{}\n)\n\ngo func() {\n    someMap.Store(\"key\", \"value\")\n}()\n\nv, ok := someMap.Load(\"key\")\nif !ok {\n    fmt.Println(\"key missing\")\n    return\n}\nfmt.Println(v)\n\n// with syncmap, looping over all keys is simple without locking the whole map for the entire loop\nsomeMap.Range(func(key, value interface{}) bool {\n    // cast value to correct format\n    val, ok := value.(string)\n    if !ok {\n        // this will break iteration\n        return false\n    }\n    // do something with key/value\n    fmt.Println(key, val)\n\n    // this will continue iterating\n    return true\n})\n</code></pre>\n\n<h3>General Advice</h3>\n\n<p>You should test your server with <code>-race</code> option and then eliminate all the race conditions it throws. That way you can easier eliminate such errors before they occur.</p>\n\n<pre><code>go run -race server.go\n</code></pre>\n\n<p>See <a href=\"https://blog.golang.org/race-detector\" rel=\"noreferrer\">golang race detector</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4283089"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25366, "favorite_count": 10, "answer_count": 1, "score": 25, "last_activity_date": 1502282846, "creation_date": 1502267796, "last_edit_date": 1502275786, "question_id": 45585589, "link": "https://stackoverflow.com/questions/45585589/golang-fatal-error-concurrent-map-read-and-map-write", "title": "Golang fatal error: concurrent map read and map write", "body": "<p>I'm writing minecraft server in Go, when server is being stressed by 2000+ connections I get this crash:</p>\n\n<blockquote>\nfatal error: concurrent map read and map write/root/work/src/github.com/user/imoobler/limbo.go:78 +0x351\ncreated by main.main /root/work/src/github.com/user/imoobler/limbo.go:33 +0x368\n</blockquote>\n\n<p>My code:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net\"\n    \"bufio\"\n    \"time\"\n    \"math/rand\"\n    \"fmt\"\n)\n\nvar (\n    connCounter = 0\n)\n\nfunc main() {\n    InitConfig()\n    InitPackets()\n\n    port := int(config[\"port\"].(float64))\n    ln, err := net.Listen(\"tcp\", fmt.Sprintf(\":%d\", port))\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Println(\"Server launched on port\", port)\n    go KeepAlive()\n    for {\n        conn, err := ln.Accept()\n        if err != nil {\n            log.Print(err)\n        } else {\n            connCounter+=1\n            go HandleConnection(conn, connCounter)\n        }\n    }\n}\n\nfunc KeepAlive() {\n    r := rand.New(rand.NewSource(15768735131534))\n    keepalive := &amp;PacketPlayKeepAlive{\n        id: 0,\n    }\n    for {\n        for _, player := range players {\n            if player.state == PLAY {\n                id := int(r.Uint32())\n                keepalive.id = id\n                player.keepalive = id\n                player.WritePacket(keepalive)\n            }\n        }\n        time.Sleep(20000000000)\n    }\n}\n\nfunc HandleConnection(conn net.Conn, id int) {\n    log.Printf(\"%s connected.\", conn.RemoteAddr().String())\n\n    player := &amp;Player {\n        id: id,\n        conn: conn,\n        state: HANDSHAKING,\n        protocol: V1_10,\n        io: &amp;ConnReadWrite{\n            rdr: bufio.NewReader(conn),\n            wtr: bufio.NewWriter(conn),\n        },\n        inaddr: InAddr{\n            \"\",\n            0,\n        },\n        name: \"\",\n        uuid: \"d979912c-bb24-4f23-a6ac-c32985a1e5d3\",\n        keepalive: 0,\n    }\n\n    for {\n        packet, err := player.ReadPacket()\n        if err != nil {\n            break\n        }\n\n        CallEvent(\"packetReceived\", packet)\n    }\n\n    player.unregister()\n    conn.Close()\n    log.Printf(\"%s disconnected.\", conn.RemoteAddr().String())\n}\n</code></pre>\n\n<p>For now server is only \"limbo\".</p>\n"}, {"tags": ["go", "ipfs"], "answers": [{"comments": [{"owner": {"reputation": 3218, "user_id": 3440266, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/9d37ddb4e007bfd22023d6d5b95f0a45?s=128&d=identicon&r=PG&f=1", "display_name": "macabeus", "link": "https://stackoverflow.com/users/3440266/macabeus"}, "edited": false, "score": 0, "creation_date": 1502278850, "post_id": 45585415, "comment_id": 78137989, "body": "Yes, I already have installed the IPFS command. I can run the daemon, for example."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 2, "last_activity_date": 1502268209, "last_edit_date": 1502268209, "creation_date": 1502267274, "answer_id": 45585415, "question_id": 45585013, "link": "https://stackoverflow.com/questions/45585013/command-not-found-when-try-send-a-file-to-ipfs/45585415#45585415", "title": "&quot;Command not found&quot; when try send a file to IPFS", "body": "<p>The error has nothing to do with the various paths. The program is running and it's panicking because you have asked it to in case of an error:</p>\n\n<pre><code>mhash, err := shell.AddNoPin(bufferExample)\nif err != nil {\n    panic(err) // ends where\n}\n</code></pre>\n\n<p>The error <code>add: command not found</code> is a result of your system not being able to locate the <a href=\"https://ipfs.io/docs/commands/#ipfs-add\" rel=\"nofollow noreferrer\"><code>add</code></a> command (error is an <a href=\"https://github.com/ipfs/go-ipfs-api/blob/master/request.go#L105\" rel=\"nofollow noreferrer\">http 404</a>).</p>\n\n<p>Have you installed IPFS command on your system? If not, try after doing that.</p>\n"}, {"tags": [], "owner": {"reputation": 3218, "user_id": 3440266, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/9d37ddb4e007bfd22023d6d5b95f0a45?s=128&d=identicon&r=PG&f=1", "display_name": "macabeus", "link": "https://stackoverflow.com/users/3440266/macabeus"}, "is_accepted": true, "score": 2, "last_activity_date": 1502288748, "creation_date": 1502288748, "answer_id": 45593476, "question_id": 45585013, "link": "https://stackoverflow.com/questions/45585013/command-not-found-when-try-send-a-file-to-ipfs/45593476#45593476", "title": "&quot;Command not found&quot; when try send a file to IPFS", "body": "<p>User Magik6k answered my question in <a href=\"https://discuss.ipfs.io/t/error-command-not-found-when-im-using-go-ipfs-api/916\" rel=\"nofollow noreferrer\">another forum</a>:</p>\n\n<blockquote>\n  <p>You can't use the public IPFS gateway to add content. For this you\n  need locally running daemon and pass it's API endpoint to NewShell\n  (localhost:5001 by default).</p>\n  \n  <p>Public gateways(ipfs.io, localhost:8080) only support a limited API\n  subset, see\n  <a href=\"https://github.com/ipfs/go-ipfs/blob/master/core/commands/root.go#L1412\" rel=\"nofollow noreferrer\">https://github.com/ipfs/go-ipfs/blob/master/core/commands/root.go#L1412</a>\n  for what is available</p>\n</blockquote>\n"}], "owner": {"reputation": 3218, "user_id": 3440266, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/9d37ddb4e007bfd22023d6d5b95f0a45?s=128&d=identicon&r=PG&f=1", "display_name": "macabeus", "link": "https://stackoverflow.com/users/3440266/macabeus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 541, "favorite_count": 0, "accepted_answer_id": 45593476, "answer_count": 2, "score": 0, "last_activity_date": 1502288748, "creation_date": 1502266036, "last_edit_date": 1502288669, "question_id": 45585013, "link": "https://stackoverflow.com/questions/45585013/command-not-found-when-try-send-a-file-to-ipfs", "title": "&quot;Command not found&quot; when try send a file to IPFS", "body": "<p>I'm want to use IPFS in my project, then, I'm studying about Go IPFS API.\nThen, I wrote this very simple code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"bytes\"\n    sh \"github.com/ipfs/go-ipfs-api\"\n)\n\nfunc main() {\n    shell := sh.NewShell(\"https://ipfs.io\")\n\n    bufferExample := bytes.NewBufferString(\"Hello IPFS Shell tests\")\n    mhash, err := shell.AddNoPin(bufferExample)\n\n    if err != nil {\n        panic(err) // ends where\n    }\n\n    fmt.Println(mhash)\n}\n</code></pre>\n\n<p>But I receive the error <code>panic: add: command not found</code>, and I don't understand why. I already have IPFS in my computer (I can run the deamon, for example). I also installed the Go IPFS library with development dependencies.</p>\n\n<p>How to fix it?</p>\n"}, {"tags": ["docker", "go", "dockerfile"], "answers": [{"tags": [], "owner": {"reputation": 633, "user_id": 59511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/037021b18e2fed97487375c7461997d2?s=128&d=identicon&r=PG", "display_name": "mhb", "link": "https://stackoverflow.com/users/59511/mhb"}, "is_accepted": true, "score": 3, "last_activity_date": 1502264134, "creation_date": 1502264134, "answer_id": 45584340, "question_id": 45583641, "link": "https://stackoverflow.com/questions/45583641/unable-to-gracefully-shutdown-a-docker-process/45584340#45584340", "title": "Unable to gracefully shutdown a docker process", "body": "<p><code>go run</code> is getting the signal, not the program that is being run.</p>\n\n<p>Compile the program ahead of time and run the binary directly in docker, and it will work as expected.</p>\n"}], "owner": {"reputation": 29577, "user_id": 58129, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/MBBRu.jpg?s=128&g=1", "display_name": "Anthony Kong", "link": "https://stackoverflow.com/users/58129/anthony-kong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1000, "favorite_count": 0, "accepted_answer_id": 45584340, "answer_count": 1, "score": 3, "last_activity_date": 1502264134, "creation_date": 1502261913, "question_id": 45583641, "link": "https://stackoverflow.com/questions/45583641/unable-to-gracefully-shutdown-a-docker-process", "title": "Unable to gracefully shutdown a docker process", "body": "<p>I want to be able to shutdown a docker process gracefully. I derived the these files by following the idea in this blog post: <a href=\"https://husobee.github.io/golang/ecs/2016/05/19/ecs-graceful-go-shutdown.html\" rel=\"nofollow noreferrer\">https://husobee.github.io/golang/ecs/2016/05/19/ecs-graceful-go-shutdown.html</a></p>\n\n<p>Here are my files </p>\n\n<p>1) Dockerfile</p>\n\n<pre><code>FROM debian:jessie\nADD app /app\nRUN apt-get update --fix-missing\nRUN apt-get install -y golang\nCMD [\"go\", \"run\", \"/app/main.go\"] \n</code></pre>\n\n<p>2) app/main.go</p>\n\n<pre><code>package main\n\nimport \"os\"\nimport \"syscall\"\nimport \"fmt\"\nimport \"time\"\nimport \"os/signal\"\n\n\nfunc main() {\n    // create a \"returnCode\" channel which will be the return code of the application\n    var returnCode = make(chan int)\n\n    // finishUP channel signals the application to finish up\n    var finishUP = make(chan struct{})\n\n    // done channel signals the signal handler that the application has completed\n    var done = make(chan struct{})\n\n    // gracefulStop is a channel of os.Signals that we will watch for -SIGTERM\n    var gracefulStop = make(chan os.Signal)\n\n    // watch for SIGTERM and SIGINT from the operating system, and notify the app on\n    // the gracefulStop channel\n    signal.Notify(gracefulStop, syscall.SIGTERM)\n    signal.Notify(gracefulStop, syscall.SIGINT)\n\n    // launch a worker whose job it is to always watch for gracefulStop signals\n    go func() {\n        // wait for our os signal to stop the app\n        // on the graceful stop channel\n        // this goroutine will block until we get an OS signal\n        sig := &lt;-gracefulStop\n        fmt.Printf(\"caught sig: %+v\", sig)\n\n        // send message on \"finish up\" channel to tell the app to\n        // gracefully shutdown\n        finishUP&lt;-struct{}{}\n\n        // wait for word back if we finished or not\n        select {\n        case &lt;-time.After(30*time.Second):\n            // timeout after 30 seconds waiting for app to finish,\n            // our application should Exit(1)\n            returnCode&lt;-1\n        case &lt;-done:\n            // if we got a message on done, we finished, so end app\n            // our application should Exit(0)\n            returnCode&lt;-0\n        }\n    }()\n\n\n    // ... Do business Logic in goroutines\n\n    fmt.Println(\"waiting for finish\")\n    // wait for finishUP channel write to close the app down\n    &lt;-finishUP\n    fmt.Println(\"stopping things, might take 2 seconds\")\n\n    // ... Do business Logic for shutdown simulated by Sleep 2 seconds\n    time.Sleep(2*time.Second)\n\n    // write to the done channel to signal we are done.\n    done &lt;-struct{}{}\n    os.Exit(&lt;-returnCode)\n}\n</code></pre>\n\n<p>I build the image by running</p>\n\n<pre><code>docker build -f Dockerfile -t docker-shutdown . \n</code></pre>\n\n<p>I start a container by </p>\n\n<pre><code>docker run  docker-shutdown\n</code></pre>\n\n<p>Then I try to shut it down by</p>\n\n<pre><code>docker stop &lt;container id&gt;\n</code></pre>\n\n<p>In the console that runs 'docker run', I can see:</p>\n\n<pre><code>waiting for finish\n</code></pre>\n\n<p>and it just terminated with no further output.</p>\n\n<p>I would expect to see at least some output like</p>\n\n<pre><code> caught sig &lt;SIGNAL_VALUE&gt;\n</code></pre>\n\n<p>So why my expected behavior did not happen? I am also new to <code>go</code> so I am not sure if it may have something to do with the <code>go</code> code or the <code>CMD</code> definition in the <code>Dockerfile</code>.</p>\n\n<p>My question:</p>\n\n<p>Why the <code>go</code> process cannot catch the either <strong>TERM</strong> and <strong>KILL</strong> signals?</p>\n"}, {"tags": ["go", "ssh"], "comments": [{"owner": {"reputation": 6945, "user_id": 2288944, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/7qryD.jpg?s=128&g=1", "display_name": "armnotstrong", "link": "https://stackoverflow.com/users/2288944/armnotstrong"}, "edited": false, "score": 0, "creation_date": 1502258436, "post_id": 45582678, "comment_id": 78124434, "body": "maybe you should redirect stderr to <code>&#47;dev&#47;null</code> ?"}, {"owner": {"reputation": 1756, "user_id": 8219037, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/n5hMR.jpg?s=128&g=1", "display_name": "Beginner", "link": "https://stackoverflow.com/users/8219037/beginner"}, "reply_to_user": {"reputation": 6945, "user_id": 2288944, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/7qryD.jpg?s=128&g=1", "display_name": "armnotstrong", "link": "https://stackoverflow.com/users/2288944/armnotstrong"}, "edited": false, "score": 0, "creation_date": 1502258560, "post_id": 45582678, "comment_id": 78124487, "body": "@armnotstrong - What would be the syntax for that?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1502258656, "post_id": 45582678, "comment_id": 78124534, "body": "@Beginner what if you put &quot;redirect stderr to <code>&#47;dev&#47;null</code>&quot; to google?"}], "answers": [{"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 1, "last_activity_date": 1502262986, "creation_date": 1502262986, "answer_id": 45583982, "question_id": 45582678, "link": "https://stackoverflow.com/questions/45582678/exclude-ssh-command-execution-status-from-output/45583982#45583982", "title": "Exclude SSH Command Execution Status from Output", "body": "<p>The <code>&lt;nil&gt;</code> pinted above is the output of <code>session.Run</code>, which returns an <code>error</code> (as per <a href=\"https://godoc.org/golang.org/x/crypto/ssh#Session.Run\" rel=\"nofollow noreferrer\">docs</a>).</p>\n\n<p>The output of the command is already being displayed on your console by the following goroutine:</p>\n\n<pre><code>go io.Copy(os.Stdout, stdout)\n</code></pre>\n\n<p>You don't need to print the <code>output</code>, which is <code>nil</code> since no error occurs when <code>session.Run</code> is call complete. A better thing to do would be to check the error:</p>\n\n<pre><code>// ...\nif err := session.Run(input); err != nil {\n  // handle error\n}\n// ...\n</code></pre>\n"}], "owner": {"reputation": 1756, "user_id": 8219037, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/n5hMR.jpg?s=128&g=1", "display_name": "Beginner", "link": "https://stackoverflow.com/users/8219037/beginner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 0, "accepted_answer_id": 45583982, "answer_count": 1, "score": 0, "last_activity_date": 1502262986, "creation_date": 1502258349, "question_id": 45582678, "link": "https://stackoverflow.com/questions/45582678/exclude-ssh-command-execution-status-from-output", "title": "Exclude SSH Command Execution Status from Output", "body": "<p>I am trying to develop a SSH client using Go language. I've written the below code to get commands from user, execute them on the remote server and print the response.</p>\n\n<p>There's a small problem with the below code. Printing output on the screen prints the command execution status(nil/error status) at the end of response. How do I exclude this from my output?</p>\n\n<p><strong>SSH.go</strong></p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"io\"\nimport \"bufio\"\nimport \"os\"\nimport \"net\"\nimport \"golang.org/x/crypto/ssh\"\n\nfunc main(){\n\n    sshConfig := &amp;ssh.ClientConfig{\n        User: \"[USERNAME]\",\n        Auth: []ssh.AuthMethod{\n            ssh.Password(\"[PASSWORD]\"),\n        },\n        HostKeyCallback: func(hostname string, remote net.Addr, key ssh.PublicKey) error {\n            return nil\n        },\n    }\n\n    connection,err := ssh.Dial(\"tcp\", \"[IP]:[PORT]\", sshConfig)\n    if err != nil {\n        fmt.Println(\"Failed to connect: %s\", err)\n    }\n\n    reader := bufio.NewReader(os.Stdin)\n\n    for{\n        input, _ := reader.ReadString('\\n')\n        session,err := connection.NewSession()\n        if err != nil {\n            fmt.Println(\"Failed to create session: %s\", err)\n        }\n        stdout,err := session.StdoutPipe()\n        if err != nil {\n            fmt.Println(\"Failed to get stdout: %s\", err)\n        }\n        go io.Copy(os.Stdout, stdout)\n        output := session.Run(input);\n        fmt.Println(output)\n    }\n\n}\n</code></pre>\n\n<p><strong>Current Result</strong></p>\n\n<pre><code>hello\nProcess exited with status 127\ndf -hP /tmp\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda6       198G   13G  176G   7% /\n&lt;nil&gt;\n</code></pre>\n\n<p><strong>Expected Result</strong></p>\n\n<pre><code>hello\ndf -hP /tmp\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda6       198G   13G  176G   7% /\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1502285373, "post_id": 45580232, "comment_id": 78143346, "body": "This is also covered (in less detail) <a href=\"https://tour.golang.org/concurrency/6\" rel=\"nofollow noreferrer\">in the Go tour</a>."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 7, "last_activity_date": 1502241845, "last_edit_date": 1502241845, "creation_date": 1502241519, "answer_id": 45580232, "question_id": 45580151, "link": "https://stackoverflow.com/questions/45580151/priority-of-case-versus-default-in-golang-select-statements/45580232#45580232", "title": "Priority of case versus default in golang select statements", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"noreferrer\">Select statements</a></p>\n  \n  <p>Execution of a \"select\" statement proceeds in several steps:</p>\n  \n  <ol>\n  <li>For all the cases in the statement, the channel operands of receive operations and the channel and right-hand-side expressions of send\n  statements are evaluated exactly once, in source order, upon entering\n  the \"select\" statement. The result is a set of channels to receive\n  from or send to, and the corresponding values to send. Any side\n  effects in that evaluation will occur irrespective of which (if any)\n  communication operation is selected to proceed. Expressions on the\n  left-hand side of a RecvStmt with a short variable declaration or\n  assignment are not yet evaluated.</li>\n  <li>If one or more of the communications can proceed, a single one that can proceed is chosen via a uniform pseudo-random selection.\n  Otherwise, if there is a default case, that case is chosen. If there\n  is no default case, the \"select\" statement blocks until at least one\n  of the communications can proceed.</li>\n  <li>Unless the selected case is the default case, the respective communication operation is executed.</li>\n  <li>If the selected case is a RecvStmt with a short variable declaration or an assignment, the left-hand side expressions are\n  evaluated and the received value (or values) are assigned.</li>\n  <li>The statement list of the selected case is executed.</li>\n  </ol>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p>\"What I'm most concerned about is that the branch of a select that is\n  chosen could be non-deterministic, so that default may be chosen even\n  if one of the cases is ready. Is this possible?\"</p>\n</blockquote>\n\n<p>No. See step 2 of the <code>select</code> specification.</p>\n"}], "owner": {"reputation": 21295, "user_id": 329781, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/eea7eacef5dde692524f0ea01a7ec964?s=128&d=identicon&r=PG", "display_name": "jonderry", "link": "https://stackoverflow.com/users/329781/jonderry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1516, "favorite_count": 2, "accepted_answer_id": 45580232, "answer_count": 1, "score": 4, "last_activity_date": 1502241845, "creation_date": 1502241023, "question_id": 45580151, "link": "https://stackoverflow.com/questions/45580151/priority-of-case-versus-default-in-golang-select-statements", "title": "Priority of case versus default in golang select statements", "body": "<p>I have an application with multiple goroutines that are running <code>for</code> loops, and need a way to signal these <code>for</code> loops to break, and to test whether the timeout case occurred. I was looking into using a shared channel with <code>select</code> statements to accomplish this as follows:</p>\n\n<pre><code>// elsewhere in the code, this channel is created, and passed below\ndone := make(chan struct{})\ntime.AfterFunc(timeout, func() { close(done) })\n...\ngo func() {\nLoop:\n  for {\n    select {\n    case &lt;-done:\n      break Loop\n    default:\n      foo()\n      time.Sleep(1 * time.Second)\n    }\n  }\n  select {\n  case &lt;-done:\n    panic(\"timed out!\")\n  default:\n    // ok\n  }\n}()\n</code></pre>\n\n<p>Is this a valid way to accomplish this? What I'm most concerned about is that the branch of a <code>select</code> that is chosen could be non-deterministic, so that <code>default</code> may be chosen even if one of the <code>case</code>s is ready. Is this possible? Is there any documentation that states that a matching <code>case</code> is guaranteed to have preference over a <code>default</code>. The concern is that the for loop above could loop several times after <code>done</code> is closed and/or report success even though a timeout occurred.</p>\n"}, {"tags": ["file", "go", "path"], "comments": [{"owner": {"reputation": 14132, "user_id": 4014291, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/taWvG.jpg?s=128&g=1", "display_name": "Samuel Toh", "link": "https://stackoverflow.com/users/4014291/samuel-toh"}, "edited": false, "score": 0, "creation_date": 1502237434, "post_id": 45579312, "comment_id": 78119037, "body": "Is <code>path&#47;to&#47;http&#47;tmpl</code> an absolute path here? Meaning it starts from the root of the file system. Example <code>&#47;home&#47;faboolous&#47;abc&#47;defg&#47;tmpl</code>"}, {"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "reply_to_user": {"reputation": 14132, "user_id": 4014291, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/taWvG.jpg?s=128&g=1", "display_name": "Samuel Toh", "link": "https://stackoverflow.com/users/4014291/samuel-toh"}, "edited": false, "score": 0, "creation_date": 1502238428, "post_id": 45579312, "comment_id": 78119223, "body": "@SamuelToh no, it is not an absolute path, otherwise it couldn&#39;t be portable. It&#39;s a relative path from the root of the repo."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1502247636, "post_id": 45579312, "comment_id": 78121263, "body": "use <a href=\"https://github.com/jteeuwen/go-bindata\" rel=\"nofollow noreferrer\">go-bindata</a> to compile the templates into the go binary"}, {"owner": {"reputation": 14132, "user_id": 4014291, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/taWvG.jpg?s=128&g=1", "display_name": "Samuel Toh", "link": "https://stackoverflow.com/users/4014291/samuel-toh"}, "edited": false, "score": 0, "creation_date": 1502250685, "post_id": 45579312, "comment_id": 78122015, "body": "btw <code>go-bindata</code> is a dead project now. Have to refer to its fork for updates. Anyway, baking it into the binary has a disadvantage as this means that user cannot perform manual modification to the template files."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 1, "creation_date": 1502265652, "post_id": 45579312, "comment_id": 78128577, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/17071286/how-can-i-open-files-using-relative-paths-in-go\">How can I open files using relative paths in Go?</a>"}, {"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1502383874, "post_id": 45579312, "comment_id": 78198132, "body": "@Mark you may want to provide your suggestion as an answer; I currently believe it&#39;s the only way to really get it fail-proof"}], "answers": [{"comments": [{"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 0, "creation_date": 1502291344, "post_id": 45579987, "comment_id": 78148426, "body": "I understand this solution, thanks for suggesting. Isn&#39;t there really no way in Go to get the current directory the file is stored on?"}, {"owner": {"reputation": 14132, "user_id": 4014291, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/taWvG.jpg?s=128&g=1", "display_name": "Samuel Toh", "link": "https://stackoverflow.com/users/4014291/samuel-toh"}, "reply_to_user": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 0, "creation_date": 1502325167, "post_id": 45579987, "comment_id": 78164608, "body": "I don&#39;t think there is because the binaries of your product can be installed anywhere on the filesystem and there is no way you can predict upfront where the user is going to put them unless you explicitly ask them to install it to a place. Then you can <code>hardcore</code> the path into your code which is not nice."}, {"owner": {"reputation": 14132, "user_id": 4014291, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/taWvG.jpg?s=128&g=1", "display_name": "Samuel Toh", "link": "https://stackoverflow.com/users/4014291/samuel-toh"}, "reply_to_user": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 0, "creation_date": 1502325263, "post_id": 45579987, "comment_id": 78164625, "body": "I&#39;m thinking even if there is an API in <code>go</code> which can magically search for a file with name <code>tmpl.html</code> on a user&#39;s system, then the next problem becomes how do we verify that the tmpl file is indeed the one we are after? Because filename is not unqiue globally. Well we could do <code>checksum</code> but maybe it is a bit over kill and is definitely to make performance suffer..."}], "tags": [], "owner": {"reputation": 14132, "user_id": 4014291, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/taWvG.jpg?s=128&g=1", "display_name": "Samuel Toh", "link": "https://stackoverflow.com/users/4014291/samuel-toh"}, "is_accepted": false, "score": 0, "last_activity_date": 1502239674, "creation_date": 1502239674, "answer_id": 45579987, "question_id": 45579312, "link": "https://stackoverflow.com/questions/45579312/loading-a-needed-file-relative-vs-absolute-paths/45579987#45579987", "title": "Loading a needed file, relative vs absolute paths", "body": "<p>I think your challenge here is that people can install the program anywhere on the disk and the program will have to be smart enough to know where it is later on.</p>\n\n<p>One of the common approach that I have seen is that people typically use <code>environment variables</code> to anchor them to the application's installation path. I believe you may have seen environment variables with naming pattern of <code>*_HOME</code> like <code>JAVA_HOME</code>, <code>MAVEN_HOME</code> and their values are always filepath to the installation place. </p>\n\n<p>I guess you can do the same here. Force your users to have <code>MYAPP_HOME</code> variable define and at the start of the application make sure that it is set or else throw an error saying <code>MYAPP_HOME</code> is not set. </p>\n\n<p>Then all you need to do would be a simple lookup of the value for <code>MYAPP_HOME</code> + <code>/http/tmpl</code> to source for the template html files.</p>\n\n<p><strong>Example:</strong></p>\n\n<pre><code>package main\n\nimport \"os\"\n\nfunc main() {\n    // Assuming MYAPP_HOME has been verified that it is set\n    // Then:\n    tmlPath := os.Getenv(\"MYAPP_HOME\") + \"/http/tmpl/\"\n    errTml := tmlPath + \"err.html\"\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1502319150, "creation_date": 1502319150, "answer_id": 45601834, "question_id": 45579312, "link": "https://stackoverflow.com/questions/45579312/loading-a-needed-file-relative-vs-absolute-paths/45601834#45601834", "title": "Loading a needed file, relative vs absolute paths", "body": "<p>If you're not keen on using the current working directory, or passing the directory in, you can find the absolute executable path by calling <a href=\"https://golang.org/pkg/os/#Executable\" rel=\"nofollow noreferrer\">os.Executable</a> from the os package. </p>\n\n<pre><code>appPath, err := os.Executable()\n</code></pre>\n\n<p>The os package will generally contain os specific stuff like how to get the current working directory. It's worth looking through the pkg docs and list of packages at golang.org if your'e ever stuck, as they are pretty good typically you'll find an answer there. </p>\n\n<p><a href=\"https://golang.org/pkg/os\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os</a></p>\n\n<p>Another approach you can take here if users install with go get is to rely on the fact that your templates will be installed with the pkg under GOPATH, so you can always find them at $GOPATH/src/your/project/path/templates (or ~/go the default gopath now that it is not strictly required). </p>\n\n<p>The safest way is probably to bundle them with the binary in a virtual file system as this means you depend on nothing external and don't care where your app is hosted or even if it has access to files at all.   </p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user3555216"}, "is_accepted": false, "score": 0, "last_activity_date": 1502339059, "creation_date": 1502339059, "answer_id": 45604451, "question_id": 45579312, "link": "https://stackoverflow.com/questions/45579312/loading-a-needed-file-relative-vs-absolute-paths/45604451#45604451", "title": "Loading a needed file, relative vs absolute paths", "body": "<p>I recommend using a relative path in this case.</p>\n\n<p>According to your description, it seems like you are developing a web application. While it works fine on individual developer's machine, you need to be mindful that your application can be deployed under any directory on your production server. You cannot determine where you app is going to be deployed, but you can always determine where static files are relative to the root directory of your app.</p>\n\n<p>When you invoke your app in the command line, you should have all the required static files copied to the same relative path exactly the same with your development environment. My typical structure is:</p>\n\n<pre><code>project/\n    |- config.json\n    |- main.go\n    |- package1/\n    |- package2/\n    |- static/\n       |- templates/\n       |  |- index.html\n       |  |- base.html\n       |- css/\n       |- javascript/\n       |- image/\n</code></pre>\n\n<p>When you are ready to run your application from command line, be sure to copy your config.json and the static/ directory to the same level as your executable binary. Then all you need to do is to use relative paths in your code without any nightmares.</p>\n"}, {"tags": [], "owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "is_accepted": false, "score": 0, "last_activity_date": 1502492656, "creation_date": 1502492656, "answer_id": 45644875, "question_id": 45579312, "link": "https://stackoverflow.com/questions/45579312/loading-a-needed-file-relative-vs-absolute-paths/45644875#45644875", "title": "Loading a needed file, relative vs absolute paths", "body": "<p>For the records: as we just have two templates, we resorted to store them as strings in a go file so that they get compiled. Our html templates are very simple, so this is a reasonable way to do it.</p>\n"}], "owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3443, "favorite_count": 0, "answer_count": 4, "score": 0, "last_activity_date": 1502492656, "creation_date": 1502233732, "last_edit_date": 1502291567, "question_id": 45579312, "link": "https://stackoverflow.com/questions/45579312/loading-a-needed-file-relative-vs-absolute-paths", "title": "Loading a needed file, relative vs absolute paths", "body": "<p>We have a program people can compile on their machines. It has an HTTP interface but can also be invoked by command line.</p>\n\n<p>In order to provide some nice-looking error pages for HTTP clients, we want to provide error pages. We are using a very simple solution with go's <code>html/template</code> package.</p>\n\n<p>So in order for the program to find the templates, we currently do:</p>\n\n<pre><code>func init() {\n  prefStr := \"path/to/http/tmpl\"\n  pathPrefix,err := filepath.Abs(prefStr)\n  if err != nil {\n    log.Warn(\"Template path %s is not available!\", prefStr)\n  }\n\n  pathPrefix + \"/err.html\"\n}\n</code></pre>\n\n<p>Now when debugging the app, this usually works well - we are in the package's root directory, so <code>filepath.Abs()</code> resolves correctly, like so:\n<code>$GOPATH/github.com/user/repo/path/to/http/tmpl</code> (expanding <code>$GOPATH</code> correctly)</p>\n\n<p>But when we invoke the app via executable from the command line, this doesn't work. The command line could of course be invoked from anywhere on the filesystem, for convenience for example to provide a file in the current directory as a parameter.</p>\n\n<p>In short, running <code>/some/other/path/on/fs/our-executable filename.txt</code> results in the <code>init()</code> function above breaking due to wrong concatenation of the directory: it takes <code>/some/other/path/on/fs/</code> to create the absolute path, which is wrong. Thus it crashes with\n<code>panic: open /some/other/path/on/fs/path/to/http/tmpl/err.html: no such file or directory</code></p>\n\n<p>I've searched and so far only found this: \n<a href=\"https://stackoverflow.com/questions/17071286/how-can-i-open-files-using-relative-paths-in-go\">How can I open files using relative paths in Go?</a></p>\n\n<p>But this exactly doesn't apply for us.\nAnother solution proposes to bundle compiled go resources, but this seems rather odd as the error pages are html text.</p>\n\n<p>We've also tried\n<a href=\"https://stackoverflow.com/a/31464648/169252\">https://stackoverflow.com/a/31464648/169252</a></p>\n\n<p>but it has the same effect.</p>\n\n<p>How can we make sure that the paths are always resolved correctly? This seems rather something which shouldn't be too difficult to be done, but we haven't managed so far.</p>\n\n<p>EDIT: This is not an exact duplicate of the question <a href=\"https://stackoverflow.com/questions/17071286\">How can I open files using relative paths in Go?</a>. As already mentioned in my question text, I already had looked it up myself. It suggests to use <code>filepath.Abs()</code>. But as laid out in my question, for us this doesn't work, as if our executable is called from different places, <code>filepath.Abs()</code> doesn't return the same value, and thus doesn't work for us.</p>\n"}, {"tags": ["go", "time", "comparison"], "comments": [{"owner": {"reputation": 318, "user_id": 2507262, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/87e60b9190b4c90084a737a7b3c4b4a4?s=128&d=identicon&r=PG", "display_name": "ozfive", "link": "https://stackoverflow.com/users/2507262/ozfive"}, "edited": false, "score": 0, "creation_date": 1502230048, "post_id": 45578172, "comment_id": 78117096, "body": "This is windows specific"}], "answers": [{"comments": [{"owner": {"reputation": 318, "user_id": 2507262, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/87e60b9190b4c90084a737a7b3c4b4a4?s=128&d=identicon&r=PG", "display_name": "ozfive", "link": "https://stackoverflow.com/users/2507262/ozfive"}, "edited": false, "score": 0, "creation_date": 1502229512, "post_id": 45578444, "comment_id": 78116883, "body": "It seems as though this may work on Linux but spits out a blank output on windows. I apologize, I forgot to mention this is Windows specific."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 1, "creation_date": 1502230960, "post_id": 45578444, "comment_id": 78117357, "body": "Change the value of <code>dir</code>? That is the only *nix specific code there."}, {"owner": {"reputation": 318, "user_id": 2507262, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/87e60b9190b4c90084a737a7b3c4b4a4?s=128&d=identicon&r=PG", "display_name": "ozfive", "link": "https://stackoverflow.com/users/2507262/ozfive"}, "edited": false, "score": 0, "creation_date": 1502233659, "post_id": 45578444, "comment_id": 78118169, "body": "That was the first thing I did when I tried your code out."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 3, "last_activity_date": 1502228437, "creation_date": 1502228437, "answer_id": 45578444, "question_id": 45578172, "link": "https://stackoverflow.com/questions/45578172/golang-find-most-recent-file-by-date-and-time/45578444#45578444", "title": "Golang find most recent file by date and time", "body": "<p>You can just compare the outputs of <code>fi.ModTime().Unix()</code> and keep the largest value to find the most recently modified file.</p>\n\n<p>For example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n)\n\nfunc main() {\n    dir := \"/tmp/\"\n    files, _ := ioutil.ReadDir(dir)\n    var newestFile string\n    var newestTime int64 = 0\n    for _, f := range files {\n        fi, err := os.Stat(dir + f.Name())\n        if err != nil {\n            fmt.Println(err)\n        }\n        currTime := fi.ModTime().Unix()\n        if currTime &gt; newestTime {\n            newestTime = currTime\n            newestFile = f.Name()\n        }\n    }\n    fmt.Println(newestFile)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 318, "user_id": 2507262, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/87e60b9190b4c90084a737a7b3c4b4a4?s=128&d=identicon&r=PG", "display_name": "ozfive", "link": "https://stackoverflow.com/users/2507262/ozfive"}, "edited": false, "score": 0, "creation_date": 1502233730, "post_id": 45579190, "comment_id": 78118186, "body": "Thank you for the pointers these are all very relevant to what I am working on."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 7, "last_activity_date": 1502232753, "creation_date": 1502232753, "answer_id": 45579190, "question_id": 45578172, "link": "https://stackoverflow.com/questions/45578172/golang-find-most-recent-file-by-date-and-time/45579190#45579190", "title": "Golang find most recent file by date and time", "body": "<p>Pay attention to details and efficiency. Check for errors. You asked for files so skip directories and other things. Allow for multiple files with the same modified time stamp (for example, Windows file times have a resolution of, at best, 100-nanoseconds). You already have ModTime() so don't call os.Stat(). Use time.Time methods directly. And so on.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"time\"\n)\n\nfunc main() {\n    dir := `C:\\temp\\` // Windows directory\n    files, err := ioutil.ReadDir(dir)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        os.Exit(1)\n    }\n    var modTime time.Time\n    var names []string\n    for _, fi := range files {\n        if fi.Mode().IsRegular() {\n            if !fi.ModTime().Before(modTime) {\n                if fi.ModTime().After(modTime) {\n                    modTime = fi.ModTime()\n                    names = names[:0]\n                }\n                names = append(names, fi.Name())\n            }\n        }\n    }\n    if len(names) &gt; 0 {\n        fmt.Println(modTime, names)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 318, "user_id": 2507262, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/87e60b9190b4c90084a737a7b3c4b4a4?s=128&d=identicon&r=PG", "display_name": "ozfive", "link": "https://stackoverflow.com/users/2507262/ozfive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5660, "favorite_count": 2, "accepted_answer_id": 45579190, "answer_count": 2, "score": 3, "last_activity_date": 1502232753, "creation_date": 1502227085, "question_id": 45578172, "link": "https://stackoverflow.com/questions/45578172/golang-find-most-recent-file-by-date-and-time", "title": "Golang find most recent file by date and time", "body": "<p>I am not sure if I am doing this correctly, but ultimately I would like to find the most recent modified date of a file in a directory and return the file name. The code I have so far is as follows. Can someone please help me with a more efficient solution than this. I really have a feeling this is super hacky. What I am doing is getting the dates and removing the </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    dir := \"C:\\\\temp\\\\\"\n    files, _ := ioutil.ReadDir(dir)\n    for _, f := range files {\n        fi, _ := os.Stat(dir + f.Name())\n        s := strings.Split(fi.ModTime().Format(\"2006-01-02 15.04.05.000\"), \" \")\n\n        fdate, err := strconv.Atoi(strings.Replace(s[0], \"-\", \"\", -1))\n        if err != nil {\n            fmt.Println(err)\n        }\n\n        ftime, err := strconv.Atoi(strings.Replace(s[1], \".\", \"\", -1))\n        if err != nil {\n            fmt.Println(err)\n        }\n        fmt.Println(fi.Name(), fdate+ftime)\n    }\n\n}\n</code></pre>\n"}, {"tags": ["go", "go-echo"], "comments": [{"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1502279389, "post_id": 45577323, "comment_id": 78138350, "body": "No idea about echo, but for this cases dynamic/static I use <a href=\"https://violetear.org/\" rel=\"nofollow noreferrer\">violetear.org</a>, in where you could match a mix of both"}], "answers": [{"comments": [{"owner": {"reputation": 3438, "user_id": 1099851, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/fd0dd473d63e71afbb62555d2146e648?s=128&d=identicon&r=PG", "display_name": "hbogert", "link": "https://stackoverflow.com/users/1099851/hbogert"}, "edited": false, "score": 0, "creation_date": 1599227371, "post_id": 45591631, "comment_id": 112717592, "body": "do you mean the order of route declaration matters ? That doesn&#39;t seem to be the case, indicated by &quot; Routes can be written in any order.&quot; stated on the referenced URL"}], "tags": [], "owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "is_accepted": false, "score": -1, "last_activity_date": 1502284157, "creation_date": 1502284157, "answer_id": 45591631, "question_id": 45577323, "link": "https://stackoverflow.com/questions/45577323/are-static-url-paths-valid-after-parameters-in-labstack-echo/45591631#45591631", "title": "Are static URL paths valid after parameters in labstack/echo", "body": "<p>In Echo your routes need to be in an order to not match. See the Routing Guide here and look for Path Matching Order</p>\n\n<p><a href=\"https://echo.labstack.com/guide/routing\" rel=\"nofollow noreferrer\">https://echo.labstack.com/guide/routing</a></p>\n\n<p>Switch around your routes so your <code>/first/:parameter/second</code> doesn't match <code>/first/:parameter1/second/:parameter2/:parameter3/third/</code></p>\n"}], "owner": {"reputation": 71, "user_id": 985731, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4e1d785d85d06a428bdeb577d9ab7c6e?s=128&d=identicon&r=PG", "display_name": "William Maness", "link": "https://stackoverflow.com/users/985731/william-maness"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 967, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1521027007, "creation_date": 1502223307, "last_edit_date": 1521027007, "question_id": 45577323, "link": "https://stackoverflow.com/questions/45577323/are-static-url-paths-valid-after-parameters-in-labstack-echo", "title": "Are static URL paths valid after parameters in labstack/echo", "body": "<p>I\u2019m chasing an odd pattern matching issue in <strong>labstack/echo</strong> and would like your thoughts.</p>\n\n<p>Would the route</p>\n\n<p><code>/first/:parameter/second</code></p>\n\n<p>match the url\n<code>http://hostname/first or http://hostname/first/</code>       ?</p>\n\n<p>What about\n<code>/first/:parameter1/second/:parameter2/:parameter3/third/</code>       ?</p>\n\n<p>To my eye, they should <em>not</em> match the simple urls, but they appear to be. Is that desired behavior? Has anyone followed a parameter with a static in the url pattern?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 1, "last_activity_date": 1502227200, "creation_date": 1502227200, "answer_id": 45578207, "question_id": 45575942, "link": "https://stackoverflow.com/questions/45575942/what-is-the-preferred-way-to-implement-testing-mocks-in-go/45578207#45578207", "title": "What is the preferred way to implement testing mocks in Go?", "body": "<p>There is no \"right way\" of answering this.</p>\n\n<p>Having said this, I find the <code>interface</code> approach more general and more clear than defining a function variable and setting it for the test.</p>\n\n<p>Here are some comments on why:</p>\n\n<ul>\n<li><p>The <code>function variable</code> approach does not scale well if there are several functions you need to mock (in your example it is just one function).</p></li>\n<li><p>The <code>interface</code> makes more clear which is the behaviour being injected to the function/module as opposed to the function variable which ends up hidden in the implementation.</p></li>\n<li><p>The <code>interface</code> allows you to inject a type with a state (a struct) which might be useful for configuring the behaviour of the mock.</p></li>\n</ul>\n\n<p>You can of course rely on the \"function variable\" approach for simple cases and use the \"interface\" for more complex functionality, but if you want to be consistent and use just one approach I'd go with the \"interface\".</p>\n"}, {"tags": [], "owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "is_accepted": true, "score": 1, "last_activity_date": 1502227683, "creation_date": 1502227683, "answer_id": 45578319, "question_id": 45575942, "link": "https://stackoverflow.com/questions/45575942/what-is-the-preferred-way-to-implement-testing-mocks-in-go/45578319#45578319", "title": "What is the preferred way to implement testing mocks in Go?", "body": "<p>For testing purposes, I tend to use the mocking approach you described instead of creating new interfaces. One of the reasons being, AFAIK, there are <a href=\"https://stackoverflow.com/questions/31759184/golang-documentation-on-all-known-implementation-of-interfaces\">no direct ways to identify which structs implement an interface</a>, which is important to me if I wanted to know whether the mocks are doing the right thing.</p>\n\n<p>The main drawback of this approach is that the variable is essentially a package-level global variable (even though it's unexported). So all the drawbacks with declaring global variables apply.</p>\n\n<p>In your tests, you will definitely want to use <code>defer</code> to re-assign <code>storeFunc</code> back to its original concrete implementation once the tests completed. </p>\n\n<pre><code>var storeFunc = func *Store {\n    // concrete implementation for opening store\n}\n\n// and in the testing file\u2026\nfunc TestParse(t *testing.T) {\n    storeFuncOriginal := storeFunc\n    defer func() {\n        storeFunc = storeFuncOriginal\n    }()\n\n    storeFunc := func() {\n        // set contents of mock\u2026\n    } \n\n    parse()\n\n    // etc...\n}\n</code></pre>\n\n<p>By the way, <code>var storeFunc = func openStore() *Store</code> won't compile.</p>\n"}, {"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 0, "last_activity_date": 1502367007, "creation_date": 1502367007, "answer_id": 45613368, "question_id": 45575942, "link": "https://stackoverflow.com/questions/45575942/what-is-the-preferred-way-to-implement-testing-mocks-in-go/45613368#45613368", "title": "What is the preferred way to implement testing mocks in Go?", "body": "<p>I tackle the problem differently. Given</p>\n\n<pre><code>function Parse(s Store) map[string] string{\n  // Do stuff on the interface Store\n}\n</code></pre>\n\n<p>you have several advantages:</p>\n\n<ol>\n<li>You can use a mock or a stub Store as you see fit.</li>\n<li>Imho, the code becomes more transparent. The signature alone makes clear that a Store implementation is required. And the code does not need to be polluted with error handling for opening the Store.</li>\n<li>The code documentation can be kept more concise.</li>\n</ol>\n\n<p>However, this makes something pretty obvious: Parse is a function which can be attached to a store, which most likely makes more sense than to parse the store around.</p>\n"}], "owner": {"reputation": 6347, "user_id": 613703, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/7a530ba90b271e192e6bc9dbcce3e16e?s=128&d=identicon&r=PG", "display_name": "djt", "link": "https://stackoverflow.com/users/613703/djt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 1, "accepted_answer_id": 45578319, "answer_count": 3, "score": 1, "last_activity_date": 1522149578, "creation_date": 1502218194, "last_edit_date": 1522149578, "question_id": 45575942, "link": "https://stackoverflow.com/questions/45575942/what-is-the-preferred-way-to-implement-testing-mocks-in-go", "title": "What is the preferred way to implement testing mocks in Go?", "body": "<p>I am building a simple CLI tool in in Go that acts as a wrapper for various password stores (Chef Vault, Ansible Vault, Hashicorp Vault, etc).  This is partially as an exercise to get familiar with Go.</p>\n\n<p>In working on this, I came across a situation where I was writing tests and found I needed to create <code>interfaces</code> for many things, just to have the ability to mock dependencies.  As such, a fairly simple implementation seems to have a bunch of abstraction, for the sake of the tests.</p>\n\n<p>However, I was recently reading <a href=\"https://rads.stackoverflow.com/amzn/click/com/0134190440\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">The Go Programming Language</a> and found an example where they mocked their dependencies in the following way.</p>\n\n<pre><code>func Parse() map[string]string {\n\n    s := openStore()\n\n    // Do something with s to parse into a map\u2026\n\n    return s.contents\n}\n\nvar storeFunc = func openStore() *Store {\n    // concrete implementation for opening store\n}\n\n\n// and in the testing file\u2026\n\n\nfunc TestParse(t *testing.T) {\n    openStore := func() {\n        // set contents of mock\u2026\n    } \n\n    parse()\n\n    // etc...\n\n}\n</code></pre>\n\n<p>So for the sake of testing, we store this concrete implementation in a variable, and then we can essentially re-declare the variable in the tests and have it return what we need.</p>\n\n<p>Otherwise, I would have created an <code>interface</code> for this (despite currently only having one implementation) and inject that into the <code>Parse</code> method.  This way, we could mock it for the test.</p>\n\n<p>So my question is:  What are the advantages and disadvantages of each approach?   When is it more appropriate to create an interface for the purposes of a mock, versus storing the concrete function in a variable for re-declaration in the test?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 0, "creation_date": 1502219249, "post_id": 45574681, "comment_id": 78111808, "body": "TestFoo() just runs Foo() function. Hence when you run the test you run the query <code>SELECT * FROM books WHERE id=$1</code>, the go code doesn&#39;t even know about a table <code>book_test</code> in your database. I don&#39;t know any Ruby so may be what you&#39;re expecting is something specific to the Ruby language."}, {"owner": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 3, "creation_date": 1502219685, "post_id": 45574681, "comment_id": 78112021, "body": "Could you have two databases instead? <code>bookstore</code> and <code>bookstore_test</code> ? And in your go code, you could probably initialize the connection based on your runtime environment if you&#39;re running in production or test. (like checking for an env variable?)?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1502220390, "post_id": 45574681, "comment_id": 78112426, "body": "Mock your database, for example using <a href=\"https://github.com/stretchr/testify/blob/master/README.md#mock-package\" rel=\"nofollow noreferrer\">testify&#39;s mock</a>. Unit tests should never run against a real database. That would make it hard to test the resilience of your code against failures and adds an extra system to your tests. Test against a real database in integration tests."}, {"owner": {"reputation": 257364, "user_id": 398670, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/85f50c23bb5e9dfb061af5032bfe8e65?s=128&d=identicon&r=PG", "display_name": "Craig Ringer", "link": "https://stackoverflow.com/users/398670/craig-ringer"}, "reply_to_user": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 0, "creation_date": 1502243744, "post_id": 45574681, "comment_id": 78120362, "body": "@hbagdi Yes, but if you do that, make sure you can and do regenerate bookstore_test as part of your test run. So you know it&#39;s in revision control."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1502272375, "post_id": 45574681, "comment_id": 78133284, "body": "I recommend you to use different databases, not different tables (or schemas)  in the same database. There&#39;s no sense to test your app with another database structure. Let your app to take db name from environment variables. Thus you&#39;ll achieve all goals: you have the same app and the same db structure. So we use db <code>project</code> as a main production db, and <code>project_test</code> as db for tests."}, {"owner": {"reputation": 2074, "user_id": 688071, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1229375604/picture?type=large", "display_name": "Godzilla74", "link": "https://stackoverflow.com/users/688071/godzilla74"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1502286708, "post_id": 45574681, "comment_id": 78144538, "body": "@EugeneLisitsky yes, I agree with you, but how?  My development DB doesn&#39;t have SSL and if I attempt to create the connection with <code>db, err := sql.Open(&quot;postgres&quot;, &quot;user=pqgotest dbname=pqgotest sslmode=disable&quot;)</code> I get an error that <code>SSL mode is not enabled</code>."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user3555216"}, "is_accepted": false, "score": 0, "last_activity_date": 1502339663, "creation_date": 1502339663, "answer_id": 45604542, "question_id": 45574681, "link": "https://stackoverflow.com/questions/45574681/tdd-with-database-and-go/45604542#45604542", "title": "TDD with database and Go", "body": "<p>You should create a dev/test database which should be a complete copy of your production database. You will never want to run test directly against your production database since too many unexpected issues could happen.</p>\n\n<p>A workaround would be starting up your app first, which creates the connection to your database, then run the test. You can use IntelliJ to achieve this.</p>\n\n<p>TDD in my opinion is great for developing business logic layer code since new models and business processes can have unexpected impacts on existing ones. </p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1502367588, "creation_date": 1502367588, "answer_id": 45613571, "question_id": 45574681, "link": "https://stackoverflow.com/questions/45574681/tdd-with-database-and-go/45613571#45613571", "title": "TDD with database and Go", "body": "<p>@Godzilla74, there'are 2 solutions: enable SSL for test DB (try to check database settings or ask your system administrator) of have completely different setting for test:</p>\n\n<pre><code>func (a *App) Initialize(dbname string) {\n    var err error\n    pgsettings := os.Getenv(\"PGSETTINGS\")\n    if pgsettins == \"\" {\n      // default options if not overridden\n      pgsettins := \"postgresql://localhost:5432/bookstore?sslmode=disable\"  \n    }\n    a.DB, err = sql.Open(\"postgres\", pgsettins)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>So you can run set environment setting to any required value and run app, like so:</p>\n\n<pre><code>export PGSETTINGS=\"postgresql://localhost:5432/bookstore_test?sslmode=disable\"  \ngo run main.go\n</code></pre>\n"}], "owner": {"reputation": 2074, "user_id": 688071, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1229375604/picture?type=large", "display_name": "Godzilla74", "link": "https://stackoverflow.com/users/688071/godzilla74"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 334, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1502367588, "creation_date": 1502213670, "question_id": 45574681, "link": "https://stackoverflow.com/questions/45574681/tdd-with-database-and-go", "title": "TDD with database and Go", "body": "<p>I'm trying to wrap my head around test driven development with Go and having an issue testing my CRUD functions since they are written for my production database.  I'm coming from Ruby on Rails so I am used to using a test database, but Go doesn't seem to be too friendly in this regard. </p>\n\n<p>So, how does one go about testing CRUD with Go?</p>\n\n<blockquote>\n  <p>main.go</p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n)\n\ntype book struct {\n    id     int     `json:\"id\"`\n    isbn   string  `json:\"isbn\"`\n    title  string  `json:\"title\"`\n    author string  `json:\"author\"`\n    price  float32 `json:\"price\"`\n}\n\n// type Books []*Book\n\n// CRUD functions for Book\nfunc (b *book) getBook(db *sql.DB) error {\n    return db.QueryRow(\"SELECT * FROM books WHERE id=$1\", b.id).Scan(&amp;b)\n}\n</code></pre>\n\n<blockquote>\n  <p>app.go</p>\n</blockquote>\n\n<pre><code>func (a *App) Initialize(dbname string) {\n    var err error\n    a.DB, err = sql.Open(\"postgres\", \"postgresql://localhost:5432/bookstore?sslmode=disable\")\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<blockquote>\n  <p>my test</p>\n</blockquote>\n\n<pre><code>func TestGetBook(t *testing.T) {\n    clearTable()\n    addBook(1)\n    req, _ := http.NewRequest(\"GET\", \"/book/1\", nil)\n    response := executeRequest(req)\n    checkResponseCode(t, http.StatusOK, response.Code)\n}\n</code></pre>\n\n<p>The problem is that this keeps on looking at the <code>books</code> table in my DB, not the <code>books_test</code> table I'd like to use for testing.  How can I go about making ONLY the tests use the <code>books_test</code> DB?</p>\n"}, {"tags": ["json", "go", "structure", "httpresponse"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1502211842, "post_id": 45574106, "comment_id": 78107789, "body": "Please edit your question to include the definition of the <code>Token</code> type."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1502212339, "post_id": 45574106, "comment_id": 78108060, "body": "There&#39;s gotta be a good duplicate around here somewhere..."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 1, "creation_date": 1502212975, "post_id": 45574106, "comment_id": 78108423, "body": "Note that variable names with underscores are not <code>golang</code> conform"}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502212029, "post_id": 45574202, "comment_id": 78107899, "body": "You win this time ;)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502212059, "post_id": 45574202, "comment_id": 78107913, "body": "By almost 30 whole seconds ;)"}, {"owner": {"reputation": 1458, "user_id": 2032771, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/UNFib.jpg?s=128&g=1", "display_name": "avrono", "link": "https://stackoverflow.com/users/2032771/avrono"}, "edited": false, "score": 0, "creation_date": 1502212119, "post_id": 45574202, "comment_id": 78107940, "body": "@Adrian you were spot on ... programming in too many languages. Thanks !"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 3, "last_activity_date": 1502212045, "last_edit_date": 1502212045, "creation_date": 1502211962, "answer_id": 45574202, "question_id": 45574106, "link": "https://stackoverflow.com/questions/45574106/parsing-a-json-response-using-unmarshal/45574202#45574202", "title": "Parsing a JSON response using Unmarshal", "body": "<p>You have unexported fields in <code>Token</code> (fields starting with a lower-case letter). Because the fields are not exported, <code>json</code> cannot see them, and so cannot unmarshal into them. Please read <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">the documentation for <code>json.Unmarshal</code></a>:</p>\n\n<blockquote>\n  <p>To unmarshal JSON into a struct, Unmarshal matches incoming object\n  keys to the keys used by Marshal (either the struct field name or its\n  tag), preferring an exact match but also accepting a case-insensitive\n  match. Unmarshal will only set exported fields of the struct.</p>\n</blockquote>\n"}], "owner": {"reputation": 1458, "user_id": 2032771, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/UNFib.jpg?s=128&g=1", "display_name": "avrono", "link": "https://stackoverflow.com/users/2032771/avrono"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1917, "favorite_count": 0, "closed_date": 1502220052, "answer_count": 1, "score": -3, "last_activity_date": 1502212380, "creation_date": 1502211688, "last_edit_date": 1502212380, "question_id": 45574106, "link": "https://stackoverflow.com/questions/45574106/parsing-a-json-response-using-unmarshal", "closed_reason": "Duplicate", "title": "Parsing a JSON response using Unmarshal", "body": "<p>I am trying to parse a JSON response with the following code:</p>\n\n<pre><code>type Token struct {\n    access_token string `json:access_token`\n    token_type string `json:token_type`\n    expires_in int `json:expires_in`\n}\n\nhomeURL := \"https:/blah.com/oauth2/token\"\n\nv := url.Values{}\n\nv.Set(\"client_id\", \"xxx\")\nv.Set(\"client_secret\", \"xxx\")\nv.Set(\"grant_type\", \"xxx\")\n\ns := v.Encode()\n\nreq, err := http.NewRequest(\"POST\", homeURL, strings.NewReader(s))\n\nif err != nil {\n    fmt.Printf(\"http.NewRequest() error: %v\\n\", err)\n    return\n}\n\nreq.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\n\nvar client = http.Client{}\n\nresp, err := client.Do(req)\nif err != nil {\n    //error\n    fmt.Printf(\"http.Do() error: %v\\n\", err)\n    return\n}\ndefer resp.Body.Close()\n\nif resp.StatusCode == 200 {\n    var token Token\n    data, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        fmt.Println(\"Error parsing JSON\\n\")\n    }\n\n    errj := json.Unmarshal(data, &amp;token)\n    if errj != nil {\n        fmt.Println(\"JSON PARSING ERROR\")\n    }\n    fmt.Printf(\"read resp.Body successfully:\\n%v\\n\", string(data))\n    fmt.Printf(\"Response Headers \\n%v\\n\", resp.Header)\n    fmt.Println(token.access_token)\n\n\n} else {\n    fmt.Println(\"Request failed !\" , resp.StatusCode)\n}\n</code></pre>\n\n<p>I also tried to use </p>\n\n<pre><code>json.NewDecoder(resp.Body).Decode(&amp;token)\n</code></pre>\n\n<p>However I am unable to get the token structure populated and there are no errors. The response I am getting back looks fine</p>\n\n<p>read resp.Body successfully:</p>\n\n<p><code>{\"access_token\":\"Osq\",\"token_type\":\"Bearer\",\"expires_in\":\"1247\"}\nResponse Headers \nmap[Content-Length:[384] Connection:[keep-alive] Content-Language:[en-US] Date:[Tue, 08 Aug 2017 16:52:19 GMT] Gi-Coordination-Id:[auto_--YfYqIVya0KiAv_mLLET8g] Server:[Mashery Proxy] X-Powered-By:[ASP.NET ARR/3.0 ASP.NET] Content-Type:[application/json; charset=utf-8] Pragma:[no-cache] Cache-Control:[no-cache,no-cache] Expires:[-1]]</code></p>\n\n<p>Does anyone have any ideas on what I am doing wrong with either approach ?</p>\n\n<p>EDIT - Solution:</p>\n\n<pre><code> type Token struct {\n    Access_token string `json:access_token`\n    Token_type string `json:token_type`\n    Expires_in int `json:expires_in`\n }\n</code></pre>\n\n<p>Unmarshal needs the exported keys which need to be capitalised.</p>\n"}, {"tags": ["regex", "go"], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 4986089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a61589f0c3042ebfddda6ad4198006?s=128&d=identicon&r=PG&f=1", "display_name": "Ronyjoe", "link": "https://stackoverflow.com/users/4986089/ronyjoe"}, "edited": false, "score": 0, "creation_date": 1502213220, "post_id": 45573469, "comment_id": 78108536, "body": "My bad! I was assuming this is an issue with byte type and searching in this docs only."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 2, "last_activity_date": 1502210454, "last_edit_date": 1502210454, "creation_date": 1502209459, "answer_id": 45573469, "question_id": 45573392, "link": "https://stackoverflow.com/questions/45573392/escape-a-dollar-sign-in-a-regex-replacement-string/45573469#45573469", "title": "Escape a dollar sign in a regex replacement string", "body": "<p>You use <code>$$</code> which is exactly what the documentation tells you. </p>\n\n<p>The godoc section for <code>ReplaceAll</code> (<a href=\"https://godoc.org/regexp#Regexp.ReplaceAll\" rel=\"nofollow noreferrer\">https://godoc.org/regexp#Regexp.ReplaceAll</a>) tells you:</p>\n\n<blockquote>\n  <p>$ signs are interpreted as in Expand</p>\n</blockquote>\n\n<p>So reading the section for <code>Expand</code> has the answer. <a href=\"https://godoc.org/regexp#Regexp.Expand\" rel=\"nofollow noreferrer\">https://godoc.org/regexp#Regexp.Expand</a></p>\n\n<p>Please throughly read all relevant documentation for the package and functions you are using before posting a question.</p>\n"}], "owner": {"reputation": 19, "user_id": 4986089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a61589f0c3042ebfddda6ad4198006?s=128&d=identicon&r=PG&f=1", "display_name": "Ronyjoe", "link": "https://stackoverflow.com/users/4986089/ronyjoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1187, "favorite_count": 0, "accepted_answer_id": 45573469, "answer_count": 1, "score": -2, "last_activity_date": 1502210454, "creation_date": 1502209182, "question_id": 45573392, "link": "https://stackoverflow.com/questions/45573392/escape-a-dollar-sign-in-a-regex-replacement-string", "title": "Escape a dollar sign in a regex replacement string", "body": "<p>I have a function in which I need to replace \"byte\" with \"$ball\". This doesn't seem to work correctly.\nHere is the program snippet.</p>\n\n<pre><code>fun main() {\n\n    str := []byte(\"$apple in a byte\\n\")\n    strReplace := \"$ball\"\n\n    re := regexp.MustCompile(\"byte\")\n\n    final := re.ReplaceAll(str, []byte(strReplace))\n\n    ioutil.WriteFile(\"testfile.txt\", final, 0744)\n}\n</code></pre>\n\n<p>Expected Output in testfile.txt:\n    $apple in a $ball</p>\n\n<p>Actual Output in testfile.txt:\n    $apple in a </p>\n\n<p>Any solutions for successfully getting the desired output?</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1502204722, "post_id": 45571628, "comment_id": 78103236, "body": "It&#39;s probably blocked on reading <code>Stdin</code>, which you could check by getting a stack trace."}], "answers": [{"tags": [], "owner": {"reputation": 742, "user_id": 2706190, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/cO4py.gif?s=128&g=1", "display_name": "Bullet-tooth", "link": "https://stackoverflow.com/users/2706190/bullet-tooth"}, "is_accepted": true, "score": 2, "last_activity_date": 1502211348, "creation_date": 1502211348, "answer_id": 45573993, "question_id": 45571628, "link": "https://stackoverflow.com/questions/45571628/go-routine-not-printing-shutdown-msg-after-closing-channel-done/45573993#45573993", "title": "go routine not printing `shutdown msg` after closing channel `done`", "body": "<p>The reason is because you have created synchronous channel and you push here 1 message and then you could read it only once as well. That is because you get only 1 (random) read from <code>done</code> channel.</p>\n\n<p>The way you can shut down your goroutines is to use <code>WaitGroup</code>:<br>\nmain.go:  </p>\n\n<pre><code>var (\n    done            chan bool\n)\n\nfunc main() {\n    cameras := client.CameraConfig()\n    client.DrawUserControls(cameras)\n    operator := client.NewOperator(cameras)\n\n    done = make(chan bool, 1)\n    wg := &amp;sync.WaitGroup{}\n    wg.Add(2)\n    go operator.UserInputListener(done, wg)\n    go operator.ParseAndExecuteUserCommand(done, wg)\n\n    handleShutdown()\n    wg.Wait()\n}\n\n\nfunc handleShutdown() {\n    ch := make(chan os.Signal, 1)\n    go func() {\n        &lt;-ch //wait for application terminating\n        log.Println(\"Shutdown received.\")\n        close(done)\n    }()\n    signal.Notify(ch, os.Interrupt, syscall.SIGTERM, syscall.SIGHUP)\n}\n</code></pre>\n\n<p>client.go:  </p>\n\n<pre><code>func (o *Operator) UserInputListener(done &lt;-chan bool, wg *sync.WaitGroup) {\n    defer wg.Done()\n    for {\n        select {\n        case &lt;-done:\n            log.Println(\"Keyboard listener shutting down.\") \n            return\n        ........\n        }\n    }\n}\n\nfunc (o *Operator) ParseAndExecuteUserCommand(done &lt;-chan bool, wg *sync.WaitGroup) {\n    defer wg.Done()\n    for {\n        select {\n        case &lt;-done:\n            log.Println(\"Command operator shutting down.\") \n            return\n        ........\n        }\n    }\n}\n</code></pre>\n\n<p>Use this <a href=\"http://www.hydrogen18.com/blog/stopping-it-all-in-go.html\" rel=\"nofollow noreferrer\" title=\"link\">link</a> for details</p>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1502216164, "post_id": 45574934, "comment_id": 78110192, "body": "You can&#39;t close stdin directly, as POSIX doesn&#39;t allow closing a file descriptor which is being read from another thread."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1502283028, "post_id": 45574934, "comment_id": 78141352, "body": "It&#39;s not really an opinion to disagree with, it&#39;s a fact of unix systems. Calling <code>Close()</code> won&#39;t return an error, just it does not unblock a read in another thread. Your program just exits, but never prints &quot;stopped first goroutine&quot;, because it&#39;s still blocked in the read syscall. This for example will never exit if you don&#39;t supply some input to complete the read: <a href=\"https://play.golang.org/p/TA1MIaYZ8w\" rel=\"nofollow noreferrer\">play.golang.org/p/TA1MIaYZ8w</a>"}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 0, "last_activity_date": 1502285155, "last_edit_date": 1502285155, "creation_date": 1502214619, "answer_id": 45574934, "question_id": 45571628, "link": "https://stackoverflow.com/questions/45571628/go-routine-not-printing-shutdown-msg-after-closing-channel-done/45574934#45574934", "title": "go routine not printing `shutdown msg` after closing channel `done`", "body": "<p>The reason <code>UserInputListener</code> is not entering <code>case &lt;-done:</code> is because it is stuck waiting for some input at this line:</p>\n\n<pre><code>line, _, err := reader.ReadLine()\n</code></pre>\n\n<p>This line is blocking!</p>\n\n<h2>What is the solution for this type of problem?</h2>\n\n<p>This is not easy. </p>\n\n<h3>Read Routine</h3>\n\n<p>You could use another go routine to do the reading, send the data into a channel that you read from in the select where you also read from the <code>done</code> channel. That would properly close the <code>UserInputListener</code> but leave the other goroutine to not be closed properly. But maybe that does not matter as much...?</p>\n\n<pre><code>func (o *Operator) UserInputListener(done &lt;-chan bool) {\n    // channel with some buffer so reader doesn't have to wait (so much)\n    ch := make(chan string, 10)\n    go func() {\n        reader := bufio.NewReader(os.Stdin)\n        for {\n            line, _, err := reader.ReadLine()\n            if err != nil {\n                log.Println(err)\n                // stop on error?\n                // return\n            }\n            ch &lt;- string(line)\n        }\n    }()\n\n    for {\n        select {\n        case &lt;-done:\n            log.Println(\"Keyboard listener shutting down.\") // &lt;-- this never prints\n            return\n        case line:= &lt;-ch:\n            data := strings.Split(line, \"\")\n\n            id, err := strconv.Atoi(data[1])\n            if err != nil {\n                log.Println(err)\n                continue\n            }\n\n            switch data[0] {\n            case \"b\":\n                o.Controls &lt;- Ctrl{\n                    Identifier: id,\n                    Ctrl:       \"run\",\n                }\n            case \"t\":\n                o.Controls &lt;- Ctrl{\n                    Identifier: id,\n                    Ctrl:       \"terminate\",\n                }\n            case \"r\":\n                o.Controls &lt;- Ctrl{\n                    Identifier: id,\n                    Ctrl:       \"record\",\n                }\n            case \"s\":\n                o.Controls &lt;- Ctrl{\n                    Identifier: id,\n                    Ctrl:       \"stop\",\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<h3>Close Reader Source</h3>\n\n<p>You could also try to close whatever the <code>reader</code> is reading from. I have already used this solution in other contexts like reading from serial devices.</p>\n\n<p>This does not work with <code>os.Stdin</code> however as <a href=\"https://stackoverflow.com/users/32880/jimb\">JimB</a> pointed out to me. <code>os.StdIn.Close()</code> will block as it waits for the reader to finish. </p>\n"}], "owner": {"reputation": 393, "user_id": 3017869, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bdd06e12c2e59b5d2b9ec7328b51c190?s=128&d=identicon&r=PG&f=1", "display_name": "user3017869", "link": "https://stackoverflow.com/users/3017869/user3017869"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 45573993, "answer_count": 2, "score": 0, "last_activity_date": 1502285155, "creation_date": 1502204000, "question_id": 45571628, "link": "https://stackoverflow.com/questions/45571628/go-routine-not-printing-shutdown-msg-after-closing-channel-done", "title": "go routine not printing `shutdown msg` after closing channel `done`", "body": "<p>Two go routines reading from the same channel. The first go routine never prints its shutdown message after the <code>done</code> channel is closed, while the second go routine always does.</p>\n\n<p>Why is the message from the first go routine not printing and is the method even <code>returning</code>? </p>\n\n<p>main.go</p>\n\n<pre><code>func main() {\ndone := make(chan bool)\nc := make(chan os.Signal, 1)\n\ncameras := client.CameraConfig()\nclient.DrawUserControls(cameras)\n\noperator := client.NewOperator(cameras)\ngo operator.UserInputListener(done)\ngo operator.ParseAndExecuteUserCommand(done)\n\nsignal.Notify(c, os.Interrupt)\nfor range c {\n    close(done)\n    break\n}\n\nlog.Println(\"Interrupt signal received. Shutting client down....\")\ntime.Sleep(5 * time.Second)\n}\n</code></pre>\n\n<p>client.go</p>\n\n<pre><code>func (o *Operator) UserInputListener(done &lt;-chan bool) {\n    reader := bufio.NewReader(os.Stdin)\n    for {\n        select {\n        case &lt;-done:\n            log.Println(\"Keyboard listener shutting down.\") // &lt;-- this never prints\n            return\n        default:\n            line, _, err := reader.ReadLine()\n            if err != nil {\n                log.Println(err)\n            }\n\n            data := strings.Split(string(line), \"\")\n\n            id, err := strconv.Atoi(data[1])\n            if err != nil {\n                log.Println(err)\n                continue\n            }\n\n            switch data[0] {\n            case \"b\":\n                o.Controls &lt;- Ctrl{\n                    Identifier: id,\n                    Ctrl:       \"run\",\n                }\n            case \"t\":\n                o.Controls &lt;- Ctrl{\n                    Identifier: id,\n                    Ctrl:       \"terminate\",\n                }\n            case \"r\":\n                o.Controls &lt;- Ctrl{\n                    Identifier: id,\n                    Ctrl:       \"record\",\n                }\n            case \"s\":\n                o.Controls &lt;- Ctrl{\n                    Identifier: id,\n                    Ctrl:       \"stop\",\n                }\n            }\n        }\n    }\n}\n\nfunc (o *Operator) ParseAndExecuteUserCommand(done &lt;-chan bool) {\n    for {\n        select {\n        case &lt;-done:\n            log.Println(\"Command operator shutting down.\")\n            return\n        case ctrl := &lt;-o.Controls:\n            switch ctrl.Ctrl {\n            case \"run\":\n                o.Room[ctrl.Identifier].Run()\n            case \"terminate\":\n                o.Room[ctrl.Identifier].Close()\n            case \"record\":\n                o.Room[ctrl.Identifier].Write()\n            case \"stop\":\n                o.Room[ctrl.Identifier].Stop()\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["postgresql", "ssl", "go"], "comments": [{"owner": {"reputation": 1853, "user_id": 6232665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41eeea507e28cddc2bc1efc3b2b73c45?s=128&d=identicon&r=PG&f=1", "display_name": "zenwraight", "link": "https://stackoverflow.com/users/6232665/zenwraight"}, "edited": false, "score": 0, "creation_date": 1502208839, "post_id": 45571556, "comment_id": 78105978, "body": "There are other syntaxes too to connect to a postgres db using golang, did you tried any other ways ?"}, {"owner": {"reputation": 2074, "user_id": 688071, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1229375604/picture?type=large", "display_name": "Godzilla74", "link": "https://stackoverflow.com/users/688071/godzilla74"}, "reply_to_user": {"reputation": 1853, "user_id": 6232665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41eeea507e28cddc2bc1efc3b2b73c45?s=128&d=identicon&r=PG&f=1", "display_name": "zenwraight", "link": "https://stackoverflow.com/users/6232665/zenwraight"}, "edited": false, "score": 0, "creation_date": 1502212410, "post_id": 45571556, "comment_id": 78108092, "body": "@zenwraight yeah, I ended up going with the URL string version to get the initial stuff to work, but I need to be able to change the database name on the fly for testing <code>a.DB, err = sql.Open(&quot;postgres&quot;, &quot;postgresql:&#47;&#47;localhost:5432&#47;bookstore?sslmode=disable&quot;)</code>"}, {"owner": {"reputation": 1853, "user_id": 6232665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41eeea507e28cddc2bc1efc3b2b73c45?s=128&d=identicon&r=PG&f=1", "display_name": "zenwraight", "link": "https://stackoverflow.com/users/6232665/zenwraight"}, "edited": false, "score": 0, "creation_date": 1502216230, "post_id": 45571556, "comment_id": 78110223, "body": "Ya I was going to suggest this one only, because I had also come across the same error and then ended up using this above string only"}, {"owner": {"reputation": 14132, "user_id": 4014291, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/taWvG.jpg?s=128&g=1", "display_name": "Samuel Toh", "link": "https://stackoverflow.com/users/4014291/samuel-toh"}, "edited": false, "score": 0, "creation_date": 1502344570, "post_id": 45571556, "comment_id": 78169801, "body": "You <code>go</code> code looks correct to me. I had a similar code as well but was unable to replicate your problem. Just wondering what <code>postgres</code> version you&#39;re on?  I tried it on 9.3"}], "answers": [{"tags": [], "owner": {"reputation": 2852, "user_id": 1873778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/649320ca20cacd083cf9225990f990b0?s=128&d=identicon&r=PG", "display_name": "cogell", "link": "https://stackoverflow.com/users/1873778/cogell"}, "is_accepted": true, "score": 2, "last_activity_date": 1511464481, "creation_date": 1511464481, "answer_id": 47462132, "question_id": 45571556, "link": "https://stackoverflow.com/questions/45571556/go-postgres-connection-ssl-not-enabled/47462132#47462132", "title": "Go postgres connection SSL not enabled", "body": "<p>I was able to recreate your error with a fresh install of postgres. While the error output was </p>\n\n<p><code>pq: SSL is not enabled on the server</code> </p>\n\n<p>the real error was not having any databases created. To create a testdb let's run</p>\n\n<p><code>createdb testdb</code></p>\n\n<p>in your terminal with postgres already running in the background.</p>\n"}], "owner": {"reputation": 2074, "user_id": 688071, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1229375604/picture?type=large", "display_name": "Godzilla74", "link": "https://stackoverflow.com/users/688071/godzilla74"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3670, "favorite_count": 0, "accepted_answer_id": 47462132, "answer_count": 1, "score": 3, "last_activity_date": 1511464481, "creation_date": 1502203781, "last_edit_date": 1502204218, "question_id": 45571556, "link": "https://stackoverflow.com/questions/45571556/go-postgres-connection-ssl-not-enabled", "title": "Go postgres connection SSL not enabled", "body": "<p>I'm trying to connect to my localhost postgresql server without SSL and I'm getting this error:</p>\n\n<pre><code>pq: SSL is not enabled on the server\n</code></pre>\n\n<p>That's fine, I know how to fix it:</p>\n\n<pre><code>type App struct {\n    Router *mux.Router\n    DB     *sql.DB\n}\n\nfunc (a *App) Initialize(dbname string) {\n    connectionString := fmt.Sprintf(\"dbname=%s sslmode=disable\", dbname)\n    var err error\n    a.DB, err = sql.Open(\"postgres\", connectionString)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    defer a.DB.Close()\n}\n</code></pre>\n\n<p>However I'm still getting the error!</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1502203954, "creation_date": 1502203954, "answer_id": 45571612, "question_id": 45571318, "link": "https://stackoverflow.com/questions/45571318/use-root-url-when-using-templates/45571612#45571612", "title": "Use root URL when using templates", "body": "<p>Sure:</p>\n\n<pre><code>if r.URL.Path == \"/\" {\n    // Render default/index/whatever page\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 5770044, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a3200f1286e6f2d8891a20c15d0f4588?s=128&d=identicon&r=PG", "display_name": "FishFenly", "link": "https://stackoverflow.com/users/5770044/fishfenly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "accepted_answer_id": 45571612, "answer_count": 1, "score": 0, "last_activity_date": 1502203954, "creation_date": 1502203169, "last_edit_date": 1502203365, "question_id": 45571318, "link": "https://stackoverflow.com/questions/45571318/use-root-url-when-using-templates", "title": "Use root URL when using templates", "body": "<p>I feel like this a simple problem, but I'm an utter noob and I cant seem to find an answer.</p>\n\n<p>I'm using the following to present a specific html template based on the URL path</p>\n\n<pre><code>func handleTemplate(w http.ResponseWriter, r *http.Request) {\n    templates := populateTemplates()\n    requestedFile := r.URL.Path[1:]\n    t := templates.Lookup(requestedFile + \".html\")\n    if t != nil {\n        err := t.Execute(w, nil)\n        if err != nil {\n            log.Println(err)\n        }\n    } else {\n        w.WriteHeader(http.StatusNotFound)\n    }\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handleTemplate)\n    http.Handle(\"/img/\", http.FileServer(http.Dir(\"static\")))\n    http.Handle(\"/css/\", http.FileServer(http.Dir(\"static\")))\n    // Dev port binding\n    bind := fmt.Sprintf(\"%s:%s\", \"0.0.0.0\", \"5000\")\n    fmt.Printf(\"listening on %s...\", bind)\n    err := http.ListenAndServe(bind, nil)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>So that works great if I have a template called home.html.. I can browse to localhost/home and it will present me the right template.</p>\n\n<p>However I want the user to browse to localhost/ and be presented with a specific html template. Is that possible without a framework?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 14, "last_activity_date": 1502202702, "last_edit_date": 1502202702, "creation_date": 1502202321, "answer_id": 45571006, "question_id": 45570947, "link": "https://stackoverflow.com/questions/45570947/creating-an-array-from-the-maps-key-and-values-in-go/45571006#45571006", "title": "Creating an Array from the Map&#39;s key and values in Go", "body": "<p>Simplest way would be to just iterate the map, since in Go the syntax would allow direct access to keys and values and dump them into the array.</p>\n\n<pre><code>m := map[string]string { \"1\":\"a\", \"2\":\"b\" }\narr := []string{}\nfor k, v := range m { \n   arr = append(arr, k, v)\n}\n</code></pre>\n\n<p>One caveat here: In Go, map iteration order is randomized, as you can see here, under \"Iteration Order\":</p>\n\n<p><a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"noreferrer\">https://blog.golang.org/go-maps-in-action</a></p>\n\n<p>So if you want your resulting array to have a particular ordering, you should first dump the keys and order (as shown in that same blog entry).</p>\n\n<p>Playground (without the sorting part):</p>\n\n<p><a href=\"https://play.golang.org/p/mCe6eEy25A\" rel=\"noreferrer\">https://play.golang.org/p/mCe6eEy25A</a></p>\n"}], "owner": {"reputation": 4983, "user_id": 481863, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/696dc422fd0b7ff451d55a198be5d4f6?s=128&d=identicon&r=PG", "display_name": "Erhan Bagdemir", "link": "https://stackoverflow.com/users/481863/erhan-bagdemir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12478, "favorite_count": 0, "accepted_answer_id": 45571006, "answer_count": 1, "score": 2, "last_activity_date": 1502202702, "creation_date": 1502202169, "question_id": 45570947, "link": "https://stackoverflow.com/questions/45570947/creating-an-array-from-the-maps-key-and-values-in-go", "title": "Creating an Array from the Map&#39;s key and values in Go", "body": "<p>What is the shortest (and idiomatic) way to create an array from the keys and values of a map w/o compromising on time complexity too much?</p>\n\n<p>For instance, from the following map: </p>\n\n<pre><code>map[string]string { \"1\":\"a\", \"2\":\"b\" }\n</code></pre>\n\n<p>I need to create the following array:</p>\n\n<pre><code>[]string{\"1\",\"a\", \"2\",\"b\"}\n</code></pre>\n\n<p>I can do this in Scala with following:</p>\n\n<pre><code>val myMap = Map(\"1\" -&gt; \"a\", \"2\" -&gt; \"b\")\nmyMap.keySet ++ myMap.values\n</code></pre>\n\n<p>Thank you.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "edited": false, "score": 1, "creation_date": 1502194723, "post_id": 45567945, "comment_id": 78095335, "body": "Does <code>daemonbinary</code> have any status endpoint which you can pool until it says the deamon is ready? This way you can <code>cmd.Start()</code> and pool in a loop until the daemon is ready for rpc calls."}, {"owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "reply_to_user": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "edited": false, "score": 0, "creation_date": 1502194803, "post_id": 45567945, "comment_id": 78095408, "body": "nope, but it prints &quot;started&quot;, so it&#39;s def a possibility to capture it that way!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1502195971, "post_id": 45567945, "comment_id": 78096380, "body": "@salient: is it prints &quot;started&quot;, is that not sufficient to know when the process is started? When stopping the process, what do you mean by exit cleanly without any &quot;relations&quot; between parent and child process? What are &quot;relations&quot;"}, {"owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "edited": false, "score": 0, "creation_date": 1502196295, "post_id": 45567945, "comment_id": 78096606, "body": "yup, guess I have to figure out how to read &quot;started&quot; from that stream then :). I mean, it hangs indefinitely which leads me to believe that the (2) process and the daemon process are still related. And I even tried to start it in a separate process group."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1502199642, "post_id": 45568832, "comment_id": 78099177, "body": "Why would you output to file and then read the file rather than just reading from <code>cmd.Stdout</code> directly?"}, {"owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1502200931, "post_id": 45568832, "comment_id": 78100166, "body": "@Adrian: cmd.Stdout implements <code>io.Writer</code>, so you cannot read from it. I tried using Cmd.StdoutPipe() to retrieve the stream I could read from, but I didn&#39;t succeed, maybe because the process didn&#39;t finish it didn&#39;t flush the output? I am not sure why, but this didn&#39;t work for me."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1502201638, "post_id": 45568832, "comment_id": 78100715, "body": "StdOutPipe should deliver unbuffered output, it is the preferred method for reading a command&#39;s stdout directly, using OS pipes. You could also do it yourself using <code>io.Pipe</code> which is a Go-implemented in-memory pipe. Using an intermediary file to read the output of a command you&#39;re forking out to seems like a horribly messy workaround to a simple problem. What if it&#39;s a long-running process with a lot of output? You&#39;re giving yourself a disk space constraint for absolutely no reason."}, {"owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1502202235, "post_id": 45568832, "comment_id": 78101220, "body": "You are right, I messed up my tests by using buffer with len=0. Thanks for the comment, will update my answer."}], "tags": [], "owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "is_accepted": false, "score": 2, "last_activity_date": 1502202608, "last_edit_date": 1502202608, "creation_date": 1502196526, "answer_id": 45568832, "question_id": 45567945, "link": "https://stackoverflow.com/questions/45567945/starting-a-daemon-process-but-not-proceeding-until-daemon-startup-process-has-fi/45568832#45568832", "title": "Starting a daemon process but not proceeding until daemon startup process has finished in golang", "body": "<p>The situation you are describing sounds like something for an process control system/orchestrator like <code>docker-compose</code> or <code>supervisord</code>, which would allow you to run services in separate processes and check their state.</p>\n\n<p>If you insist on staying within Go, I would suggest to read from daemon <code>StdoutPipe</code> periodically for new content until it's there and act upon it. But I find this solution quite hacky.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os/exec\"\n    \"time\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"bash\", \"-c\", \"sleep 2 &amp;&amp; echo started &amp;&amp; sleep 5\")\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if err := cmd.Start(); err != nil {\n        log.Fatal(err)\n    }\n\n    buffer := make([]byte, 7)\n    for {\n        stdout.Read(buffer)\n        if string(buffer) == \"started\" {\n            break\n        }\n        time.Sleep(500 * time.Millisecond)\n    }\n    fmt.Println(\"Daemon started\")\n\n    yourRPCStuff()\n\n    if err = cmd.Process.Kill(); err != nil {\n        log.Fatal(\"Failed to kill daemon: \", err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 415, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1502202608, "creation_date": 1502194031, "last_edit_date": 1502201667, "question_id": 45567945, "link": "https://stackoverflow.com/questions/45567945/starting-a-daemon-process-but-not-proceeding-until-daemon-startup-process-has-fi", "title": "Starting a daemon process but not proceeding until daemon startup process has finished in golang", "body": "<p>I have two programs</p>\n\n<ol>\n<li>Calls (2)</li>\n<li>Starts a daemon process (a server) if it's not already started and then do some RPC against that server</li>\n</ol>\n\n<p>I tried to start the daemon-process in (2) with <code>cmd.Run()</code>, but that left the <code>cmd.Run()</code> in (1) running forever, probably because of the daemon child process lingering.</p>\n\n<pre><code>cmd := exec.Command(\"daemonbinary\")\ncmd.Stdout = os.Stdout\ncmd.Stderr = os.Stderr\ncmd.Run()\n\n// do other stuff and eventually exit the program would not work\n</code></pre>\n\n<p>I then figured I'd use <code>cmd.Start()</code> instead, but the problem is that I have to wait for the daemon process to actually start before I can continue.</p>\n\n<p>How can that be achieved? </p>\n\n<p>To recap, what I want to achieve is: </p>\n\n<ul>\n<li>start the daemon process in (2) if it's not already running and keep it running indefinitely </li>\n<li>only continue in (2) when that daemon process is properly started</li>\n<li>exit cleanly from (2) without any \"relations\" between the (2) process and the daemon process lingering. </li>\n</ul>\n\n<p><strong>Edit:</strong></p>\n\n<p>I tried starting it in a separate process group:</p>\n\n<pre><code>    cmd.SysProcAttr = &amp;syscall.SysProcAttr{\n        Setpgid: true,\n        Pgid:    0,\n    }\n</code></pre>\n\n<p>this did not seem to work.</p>\n\n<p><strong>Edit 2:</strong></p>\n\n<p>I just remove two lines where I had attached <code>os.Stdout</code> and <code>os.Stderr</code> and now the above seems to be working. </p>\n\n<p>Would be nice however to have that <code>stdout</code> and <code>stderr</code> while the program is running?</p>\n"}, {"tags": ["user-interface", "go"], "answers": [{"tags": [], "owner": {"reputation": 139, "user_id": 4831421, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9be5e57dbd221e6359506e49bc8baa54?s=128&d=identicon&r=PG&f=1", "display_name": "Befedo", "link": "https://stackoverflow.com/users/4831421/befedo"}, "is_accepted": true, "score": 0, "last_activity_date": 1502300029, "creation_date": 1502300029, "answer_id": 45597204, "question_id": 45567710, "link": "https://stackoverflow.com/questions/45567710/how-does-one-paint-underlying-widgets-when-using-gos-exp-shiny/45597204#45597204", "title": "How does one paint underlying widgets when using go&#39;s exp/shiny?", "body": "<p>When we look up <a href=\"https://github.com/golang/exp/blob/master/shiny/widget/widget.go#L56-L58\" rel=\"nofollow noreferrer\">here</a> we see that <code>widget.RunWindow( ... )</code> doesn't handle such external requests from the caller.</p>\n\n<p>A workaraound could be to implement an analogous function <code>MyRunWindow( ... )</code> and assign the <code>Window</code> to an global Interface. Like this:</p>\n\n<pre><code>func MyRunWindow(s screen.Screen, root node.Node, opts *RunWindowOptions) (err error) {\n    var nwo *screen.NewWindowOptions\n\n    // ... assign window options ...\n\n    if MyWindow, err = s.NewWindow(nwo); err != nil {\n        return err\n    }\n\n    // event loop, processing 'lifecycle.Event', 'input.Event', etc.\n    // and you can process own 'Events' in a type switch\n    for {\n        e := MyWindow.NextEvent()\n\n        if e = gef.Filter(e); e == nil {\n            continue\n        }\n\n        switch e := e.(type) {\n        case MyEvent:\n        // ... call on 'root' here\n        }\n    }\n</code></pre>\n\n<p>On the caller side you can use your global <code>Interface</code> like this:</p>\n\n<pre><code>MyWindow.Send(paint.Event{}) // for a needed call to root.Paint()\nMyWindow.Send(MyEvent{})     // for your own event to be processed\n</code></pre>\n"}], "owner": {"reputation": 139, "user_id": 4831421, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9be5e57dbd221e6359506e49bc8baa54?s=128&d=identicon&r=PG&f=1", "display_name": "Befedo", "link": "https://stackoverflow.com/users/4831421/befedo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 45597204, "answer_count": 1, "score": 1, "last_activity_date": 1502300029, "creation_date": 1502193332, "question_id": 45567710, "link": "https://stackoverflow.com/questions/45567710/how-does-one-paint-underlying-widgets-when-using-gos-exp-shiny", "title": "How does one paint underlying widgets when using go&#39;s exp/shiny?", "body": "<h1>Asuming the folowing widget layout:</h1>\n\n<pre><code>type myLeaf struct {\n    node.LeafEmbed\n    // some other fields\n}\n\nfunc NewMyLeaf() *myLeaf {\n    w := &amp;myLeaf{}\n    w.Wrapper = w\n    return w\n}\n\nfunc (w *myLeaf) Paint(ctx *node.PaintContext, origin image.Point) error {\n    w.Marks.UnmarkNeedsPaint()\n    // draw to ctx ...\n}\n</code></pre>\n\n<h1>Inside <code>driver.Main()</code>:</h1>\n\n<pre><code>leafA := NewMyLeaf()\nleafB := NewMyLeaf()\n\nw := widget.NewFlow(widget.AxisVertical,\n    widget.NewSheet(leafA),\n    widget.NewSheet(leafB),\n)\n\nif err := widget.RunWindow(s, w, &amp;widget.RunWindowOptions{\n    NewWindowOptions: screen.NewWindowOptions{},\n}); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>How does one execute <code>func (w *myLeaf) Paint(...) error</code> on the widget tree for each leaf (<code>myLeaf</code>) from outside <code>driver.Main()</code>?</p>\n\n<p>Also using pointers for <code>leafA</code>, <code>leafB</code> and <code>w</code> is possible.</p>\n"}, {"tags": ["sql", "azure", "go", "odbc", "vertica"], "comments": [{"owner": {"reputation": 4887, "user_id": 897295, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Kql9J.png?s=128&g=1", "display_name": "mauro", "link": "https://stackoverflow.com/users/897295/mauro"}, "edited": false, "score": 0, "creation_date": 1502194677, "post_id": 45567283, "comment_id": 78095308, "body": "please post the odbc trace"}, {"owner": {"reputation": 899, "user_id": 3260209, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/100000966234908/picture?type=large", "display_name": "Prata", "link": "https://stackoverflow.com/users/3260209/prata"}, "reply_to_user": {"reputation": 4887, "user_id": 897295, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Kql9J.png?s=128&g=1", "display_name": "mauro", "link": "https://stackoverflow.com/users/897295/mauro"}, "edited": false, "score": 0, "creation_date": 1502282514, "post_id": 45567283, "comment_id": 78140921, "body": "@mauro I have added the odbc trace"}, {"owner": {"reputation": 3017, "user_id": 949297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/S2ohb.jpg?s=128&g=1", "display_name": "Nicolas Riousset", "link": "https://stackoverflow.com/users/949297/nicolas-riousset"}, "edited": false, "score": 0, "creation_date": 1502526371, "post_id": 45567283, "comment_id": 78254833, "body": "Did you check the Vertica log ? You may find out if the issue originates on the client side, or on the server side. Especially look for a message like &quot;could not receive data from client: Connection reset by peer&quot;"}], "owner": {"reputation": 899, "user_id": 3260209, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/100000966234908/picture?type=large", "display_name": "Prata", "link": "https://stackoverflow.com/users/3260209/prata"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 242, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1502656258, "creation_date": 1502192184, "last_edit_date": 1502656258, "question_id": 45567283, "link": "https://stackoverflow.com/questions/45567283/hpe-verticaazure-market-query-gets-stuck-without-any-response-if-the-database", "title": "HPE Vertica(azure market) query gets stuck without any response if the database connection stays idle for a while", "body": "<p>I have been trying to start a server that uses vertica to store data. so I passed the database pointer to http handler func. It works initially for a minute or two but doesnt even respond after sometime.</p>\n\n<pre><code>//main func runs perfectly fine\nfunc main() {\n    //ODBC connection to vertica via DSN\n    db, err := sql.Open(\"odbc\", \"DSN=HPVerticaDSN\")\n    if err != nil {\n        panic(err)\n    }\n    defer db.Close()\n\n    if err := db.Ping(); err != nil {\n        fmt.Printf(\"ping err: %v\", err)\n    }\n\n    //start gin\n    r := gin.Default()\n    r.GET(\"/ping\", func(c *gin.Context) {\n        handler(c, db)\n    })\n    r.Run() // listen and serve on 0.0.0.0:8080\n}\n</code></pre>\n\n<p>I am running this server in linux(ubuntu)</p>\n\n<hr />\n\n<pre><code>//handler func is a http handler for '/ping' get request\nfunc handler(c *gin.Context, db *sql.DB) {\n    //start transaction\n    tx, err := db.Begin()\n    //it is here where the process gets stuck after a while\n    if err != nil {\n        log.Printf(\"tx begin error: %v\", err)\n        return\n    }\n    defer func() {\n        if err != nil {\n            log.Printf(\"error sql: %v\", err)\n            tx.Rollback()\n            return\n        }\n        err = tx.Commit()\n        if err != nil {\n            log.Printf(\"commit err: %v\", err)\n        }\n    }()\n    fmt.Println(\"start prepare statment\")\n    stmt, err := tx.Prepare(\"insert /*+direct*/ into events (id, game_id, created_at) values(?,?,?)\")\n    if err != nil {\n        log.Printf(\"Insert prepare statement: %v\", err)\n        c.JSON(500, gin.H{\n            \"message\": err.Error(),\n        })\n        return\n    }\n    fmt.Println(\"exec prepare statment start...\")\n    res, err := stmt.Exec(uuid.NewV4().String(), uuid.NewV4().String(), time.Now().Format(time.RFC3339))\n    if err != nil {\n        fmt.Printf(\"Insert record: %v\", err)\n        return\n    }\n    defer stmt.Close()\n    fmt.Println(\"exec prepare statment end\")\n    num, err := res.RowsAffected()\n    if err != nil {\n        fmt.Printf(\"Rows affected err: %v\", err)\n        return\n    }\n    if num != 1 {\n        fmt.Printf(\"Rows affected: %v, must be 1\", num)\n        err = errors.New(\"Rows affected must be 1\")\n        return\n    }\n    c.JSON(200, gin.H{\n        \"message\": \"pong\",\n    })\n}\n</code></pre>\n\n<p>I have above <strong>GO</strong> code http server running. It runs perfectly for <strong>first minute or two</strong> and after a while if I do a <strong>/ping GET request</strong> there is no response form the vertica db. It gets stuck at <strong>tx, err := db.Begin()</strong>.</p>\n\n<p>Finally it gives this error:</p>\n\n<blockquote>\n  <p>SQLSetConnectUIntPtrAttr: {HY000} [Vertica][DSI] An error occurred while attempting to retrieve the error message for key 'VPropertySetFailed' and component ID 101: Could not open error message files - Check that \"/opt/vertica/opt/vertica/lib64/en-US/VerticaMessages.xml\" or \"/opt/vertica/opt/vertica/lib64/VerticaMessages_en-US.xml\" exists and are accessible. MessageParameters=[\"could not receive data from server: Connection timed out\n  \"]</p>\n</blockquote>\n\n<hr /> \n\n<p>But if I create or open a connection inside the <strong>handler func</strong>, so that it creates a new connection on each request then <strong>it works fine</strong>.</p>\n\n<p><strong><em>ODBC trace when insert query is successful:</em></strong></p>\n\n<pre><code>[ODBC][61608][1502281990.419123][SQLSetConnectAttr.c][842]\n        Exit:[SQL_SUCCESS]\n[ODBC][61608][1502282121.643292][SQLSetConnectAttr.c][396]\n        Entry:\n            Connection = 0x7f71840008c0\n            Attribute = SQL_ATTR_AUTOCOMMIT\n            Value = (nil)\n            StrLen = -5\n[ODBC][61608][1502282121.644409][SQLSetConnectAttr.c][842]\n        Exit:[SQL_SUCCESS]\n[ODBC][61608][1502282121.644794][SQLAllocHandle.c][540]\n        Entry:\n            Handle Type = 3\n            Input Handle = 0x7f71840008c0\n[ODBC][61608][1502282121.644996][SQLAllocHandle.c][1085]\n        Exit:[SQL_SUCCESS]\n            Output Handle = 0x5564cb6408e0\n[ODBC][61608][1502282121.645018][SQLPrepareW.c][165]\n        Entry:\n            Statement = 0x5564cb6408e0\n            SQL = [insert /*+direct*/ into events (.....][length = 147 (SQL_NTS)]\n[ODBC][61608][1502282121.649229][SQLPrepareW.c][346]\n        Exit:[SQL_SUCCESS]\n[ODBC][61608][1502282121.649256][SQLNumParams.c][144]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Param Count = 0xc4201d0f0e\n[ODBC][61608][1502282121.649266][SQLNumParams.c][231]\n        Exit:[SQL_SUCCESS]\n            Count = 0xc4201d0f0e -&gt; 8\n[ODBC][61608][1502282121.649274][SQLDescribeParam.c][185]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Parameter Number = 1\n            SQL Type = 0xc4200ba600\n            Param Def = 0xc4200ba608\n            Scale = 0xc4200ba602\n            Nullable = 0xc4201d0f40\n[ODBC][61608][1502282121.649284][SQLDescribeParam.c][341]\n        Exit:[SQL_SUCCESS]                \n            SQL Type = 0x7ffd05d6ad80                \n            Param Def = 0x7ffd05d6ae70                \n            Scale = 0x7ffd05d6af60                \n            Nullable = 0x7ffd05d6b050\n[ODBC][61608][1502282121.649290][SQLDescribeParam.c][185]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Parameter Number = 2\n            SQL Type = 0xc4200ba630\n            Param Def = 0xc4200ba638\n            Scale = 0xc4200ba632\n            Nullable = 0xc4201d0f40\n[ODBC][61608][1502282121.649296][SQLDescribeParam.c][341]\n        Exit:[SQL_SUCCESS]                \n            SQL Type = 0x7ffd05d6ad80                \n            Param Def = 0x7ffd05d6ae70                \n            Scale = 0x7ffd05d6af60                \n            Nullable = 0x7ffd05d6b050\n[ODBC][61608][1502282121.649302][SQLDescribeParam.c][185]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Parameter Number = 3\n            SQL Type = 0xc4200ba660\n            Param Def = 0xc4200ba668\n            Scale = 0xc4200ba662\n            Nullable = 0xc4201d0f40\n[ODBC][61608][1502282121.649308][SQLDescribeParam.c][341]\n        Exit:[SQL_SUCCESS]                \n            SQL Type = 0x7ffd05d6ad80                \n            Param Def = 0x7ffd05d6ae70                \n            Scale = 0x7ffd05d6af60                \n            Nullable = 0x7ffd05d6b050\n[ODBC][61608][1502282121.649313][SQLDescribeParam.c][185]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Parameter Number = 4\n            SQL Type = 0xc4200ba690\n            Param Def = 0xc4200ba698\n            Scale = 0xc4200ba692\n            Nullable = 0xc4201d0f40\n[ODBC][61608][1502282121.649319][SQLDescribeParam.c][341]\n        Exit:[SQL_SUCCESS]                \n            SQL Type = 0x7ffd05d6ad80                \n            Param Def = 0x7ffd05d6ae70                \n            Scale = 0x7ffd05d6af60                \n            Nullable = 0x7ffd05d6b050\n[ODBC][61608][1502282121.649324][SQLDescribeParam.c][185]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Parameter Number = 5\n            SQL Type = 0xc4200ba6c0\n            Param Def = 0xc4200ba6c8\n            Scale = 0xc4200ba6c2\n            Nullable = 0xc4201d0f40\n[ODBC][61608][1502282121.649330][SQLDescribeParam.c][341]\n        Exit:[SQL_SUCCESS]                \n            SQL Type = 0x7ffd05d6ad80                \n            Param Def = 0x7ffd05d6ae70                \n            Scale = 0x7ffd05d6af60                \n            Nullable = 0x7ffd05d6b050\n[ODBC][61608][1502282121.649335][SQLDescribeParam.c][185]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Parameter Number = 6\n            SQL Type = 0xc4200ba6f0\n            Param Def = 0xc4200ba6f8\n            Scale = 0xc4200ba6f2\n            Nullable = 0xc4201d0f40\n[ODBC][61608][1502282121.649341][SQLDescribeParam.c][341]\n        Exit:[SQL_SUCCESS]                \n            SQL Type = 0x7ffd05d6ad80                \n            Param Def = 0x7ffd05d6ae70                \n            Scale = 0x7ffd05d6af60                \n            Nullable = 0x7ffd05d6b050\n[ODBC][61608][1502282121.649347][SQLDescribeParam.c][185]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Parameter Number = 7\n            SQL Type = 0xc4200ba720\n            Param Def = 0xc4200ba728\n            Scale = 0xc4200ba722\n            Nullable = 0xc4201d0f40\n[ODBC][61608][1502282121.649360][SQLDescribeParam.c][341]\n        Exit:[SQL_SUCCESS]                \n            SQL Type = 0x7ffd05d6ad80                \n            Param Def = 0x7ffd05d6ae70                \n            Scale = 0x7ffd05d6af60                \n            Nullable = 0x7ffd05d6b050\n[ODBC][61608][1502282121.649365][SQLDescribeParam.c][185]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Parameter Number = 8\n            SQL Type = 0xc4200ba750\n            Param Def = 0xc4200ba758\n            Scale = 0xc4200ba752\n            Nullable = 0xc4201d0f40\n[ODBC][61608][1502282121.649371][SQLDescribeParam.c][341]\n        Exit:[SQL_SUCCESS]                \n            SQL Type = 0x7ffd05d6ad80                \n            Param Def = 0x7ffd05d6ae70                \n            Scale = 0x7ffd05d6af60                \n            Nullable = 0x7ffd05d6b050\n[ODBC][61608][1502282121.650523][SQLBindParameter.c][217]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Param Number = 1\n            Param Type = 1\n            C Type = -8 SQL_C_WCHAR\n            SQL Type = -8 SQL_WCHAR\n            Col Def = 36\n            Scale = 0\n            Rgb Value = 0xc42004df40\n            Value Max = 72\n            StrLen Or Ind = 0xc4200ba628\n[ODBC][61608][1502282121.650546][SQLBindParameter.c][422]\n        Exit:[SQL_SUCCESS]\n[ODBC][61608][1502282121.650557][SQLBindParameter.c][217]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Param Number = 2\n            Param Type = 1\n            C Type = -8 SQL_C_WCHAR\n            SQL Type = -9 SQL_WVARCHAR\n            Col Def = 24\n            Scale = 0\n            Rgb Value = 0xc4201df180\n            Value Max = 48\n            StrLen Or Ind = 0xc4200ba658\n[ODBC][61608][1502282121.650569][SQLBindParameter.c][422]\n        Exit:[SQL_SUCCESS]\n[ODBC][61608][1502282121.650585][SQLBindParameter.c][217]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Param Number = 3\n            Param Type = 1\n            C Type = -8 SQL_C_WCHAR\n            SQL Type = -8 SQL_WCHAR\n            Col Def = 36\n            Scale = 0\n            Rgb Value = 0xc42004df90\n            Value Max = 72\n            StrLen Or Ind = 0xc4200ba688\n[ODBC][61608][1502282121.650593][SQLBindParameter.c][422]\n        Exit:[SQL_SUCCESS]\n[ODBC][61608][1502282121.650600][SQLBindParameter.c][217]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Param Number = 4\n            Param Type = 1\n            C Type = -8 SQL_C_WCHAR\n            SQL Type = -9 SQL_WVARCHAR\n            Col Def = 10\n            Scale = 0\n            Rgb Value = 0xc4201d3200\n            Value Max = 20\n            StrLen Or Ind = 0xc4200ba6b8\n[ODBC][61608][1502282121.650607][SQLBindParameter.c][422]\n        Exit:[SQL_SUCCESS]\n[ODBC][61608][1502282121.650614][SQLBindParameter.c][217]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Param Number = 5\n            Param Type = 1\n            C Type = 4 SQL_C_LONG\n            SQL Type = 4 SQL_INTEGER\n            Col Def = 4\n            Scale = 0\n            Rgb Value = 0xc4201d1000\n            Value Max = 0\n            StrLen Or Ind = (nil)\n[ODBC][61608][1502282121.650627][SQLBindParameter.c][422]\n        Exit:[SQL_SUCCESS]\n[ODBC][61608][1502282121.650636][SQLBindParameter.c][217]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Param Number = 6\n            Param Type = 1\n            C Type = -8 SQL_C_WCHAR\n            SQL Type = -9 SQL_WVARCHAR\n            Col Def = 11\n            Scale = 0\n            Rgb Value = 0xc4201d3240\n            Value Max = 22\n            StrLen Or Ind = 0xc4200ba718\n[ODBC][61608][1502282121.650642][SQLBindParameter.c][422]\n        Exit:[SQL_SUCCESS]\n[ODBC][61608][1502282121.650650][SQLBindParameter.c][217]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Param Number = 7\n            Param Type = 1\n            C Type = -8 SQL_C_WCHAR\n            SQL Type = 93 SQL_TYPE_TIMESTAMP\n            Col Def = 20\n            Scale = 0\n            Rgb Value = 0xc4201f0180\n            Value Max = 40\n            StrLen Or Ind = 0xc4200ba748\n[ODBC][61608][1502282121.650656][SQLBindParameter.c][422]\n        Exit:[SQL_SUCCESS]\n[ODBC][61608][1502282121.650663][SQLBindParameter.c][217]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Param Number = 8\n            Param Type = 1\n            C Type = -8 SQL_C_WCHAR\n            SQL Type = 93 SQL_TYPE_TIMESTAMP\n            Col Def = 20\n            Scale = 0\n            Rgb Value = 0xc4201f01b0\n            Value Max = 40\n            StrLen Or Ind = 0xc4200ba778\n[ODBC][61608][1502282121.650670][SQLBindParameter.c][422]\n        Exit:[SQL_SUCCESS]\n[ODBC][61608][1502282121.650676][SQLExecute.c][187]\n        Entry:\n            Statement = 0x5564cb6408e0\n[ODBC][61608][1502282121.678544][SQLExecute.c][357]\n        Exit:[SQL_SUCCESS]\n[ODBC][61608][1502282121.678624][SQLRowCount.c][173]\n        Entry:\n            Statement = 0x5564cb6408e0\n            Row Count = 0xc4201d1008\n[ODBC][61608][1502282121.678643][SQLRowCount.c][247]\n        Exit:[SQL_SUCCESS]\n            Row Count = 0xc4201d1008 -&gt; 1\n[ODBC][61608][1502282121.678845][SQLFreeHandle.c][381]\n        Entry:\n            Handle Type = 3\n            Input Handle = 0x5564cb6408e0\n[ODBC][61608][1502282121.695732][SQLFreeHandle.c][494]\n        Exit:[SQL_SUCCESS]\n[ODBC][61608][1502282121.695847][SQLEndTran.c][417]\n        Entry:                \n            Connection = 0x7f71840008c0                \n            Completion Type = 0\n[ODBC][61608][1502282121.702404][SQLEndTran.c][566]\n        Exit:[SQL_SUCCESS]\n[ODBC][61608][1502282121.702506][SQLSetConnectAttr.c][396]\n        Entry:\n            Connection = 0x7f71840008c0\n            Attribute = SQL_ATTR_AUTOCOMMIT\n            Value = 0x1\n            StrLen = -5\n[ODBC][61608][1502282121.702962][SQLSetConnectAttr.c][842]\n        Exit:[SQL_SUCCESS]\n</code></pre>\n\n<p><strong><em>ODBC trace when insert query doesnt respond:</em></strong></p>\n\n<pre><code>[ODBC][61608][1502282408.929695][SQLSetConnectAttr.c][396]\n        Entry:\n            Connection = 0x7f71840008c0\n            Attribute = SQL_ATTR_AUTOCOMMIT\n            Value = (nil)\n            StrLen = -5\n</code></pre>\n"}, {"tags": ["go", "go-cobra"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1502187610, "post_id": 45565263, "comment_id": 78090109, "body": "There are countless ways to do this. Store a state file. Use a database. Require the user to set up a config file. Store the value in a known remote location (such as S3). Store it to an attached EPROM. Burn it to a CD. Output to a punch card. And literally an infinite number of other possibilities."}, {"owner": {"reputation": 8979, "user_id": 1734279, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/6VA46.jpg?s=128&g=1", "display_name": "rai.skumar", "link": "https://stackoverflow.com/users/1734279/rai-skumar"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1502188626, "post_id": 45565263, "comment_id": 78090865, "body": "@Flimzy all those approaches are external to go. I want to set and get values through native go code."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1502188664, "post_id": 45565263, "comment_id": 78090886, "body": "You can do all of those through native Go code. You just need a Go driver for your punch card reader, and <i>voala!</i>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1502188712, "post_id": 45565263, "comment_id": 78090916, "body": "If what you&#39;re saying is you want to persist a value without using external I/O, then you&#39;re asking for the impossible. Processes are ephemeral. That&#39;s the opposite of persistent. Even your <code>os.Setenv</code> approach uses resources external to Go."}, {"owner": {"reputation": 8979, "user_id": 1734279, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/6VA46.jpg?s=128&g=1", "display_name": "rai.skumar", "link": "https://stackoverflow.com/users/1734279/rai-skumar"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1502188728, "post_id": 45565263, "comment_id": 78090926, "body": "That&#39;s something I am not aware. It will be great if you could provide a link. Thanks."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1502188759, "post_id": 45565263, "comment_id": 78090945, "body": "A link for what?"}, {"owner": {"reputation": 8979, "user_id": 1734279, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/6VA46.jpg?s=128&g=1", "display_name": "rai.skumar", "link": "https://stackoverflow.com/users/1734279/rai-skumar"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1502188842, "post_id": 45565263, "comment_id": 78091001, "body": "I will search for the link. It was for getting more details on natively setting and getting values."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1502188873, "post_id": 45565263, "comment_id": 78091019, "body": "I don&#39;t even know what you mean for &quot;natively setting and getting values.&quot; I suspect you don&#39;t either. I think you&#39;re asking the impossible."}, {"owner": {"reputation": 8979, "user_id": 1734279, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/6VA46.jpg?s=128&g=1", "display_name": "rai.skumar", "link": "https://stackoverflow.com/users/1734279/rai-skumar"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1502188922, "post_id": 45565263, "comment_id": 78091057, "body": "I got a related link here... <a href=\"https://stackoverflow.com/questions/17368392/environment-variable-is-not-set-on-terminal-session-after-setting-it-with-os-p\" title=\"environment variable is not set on terminal session after setting it with os p\">stackoverflow.com/questions/17368392/&hellip;</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1502199264, "post_id": 45565263, "comment_id": 78098868, "body": "Persistent information has to be persisted <i>somewhere</i>. Pick a specific somewhere, and then perhaps we can help you to persist it. Persisting data without a somewhere to persist it is not possible. It&#39;s a fundamental quality of computing."}], "answers": [{"tags": [], "owner": {"reputation": 27, "user_id": 6707833, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SNQ3B.png?s=128&g=1", "display_name": "Barpfotenbaer", "link": "https://stackoverflow.com/users/6707833/barpfotenbaer"}, "is_accepted": false, "score": -2, "last_activity_date": 1502195176, "creation_date": 1502195176, "answer_id": 45568340, "question_id": 45565263, "link": "https://stackoverflow.com/questions/45565263/cache-or-persist-a-value-even-if-process-ends/45568340#45568340", "title": "Cache or Persist a value even if process ends", "body": "<p>You could establish a simple listener, serving requests to other processes. It could receive and provide any kind of content.</p>\n\n<p>It's quite easy to set up an listening daemon with go, using <strong>net.Listen(\"tcp\",\":8080\")</strong>. Perhaps you could take this snippets as boilerplate:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"net\"\n    \"strings\"\n)\n\ntype textProcessor struct {\n    input *string\n}\n\nfunc (this textProcessor) Write(b []byte) (int, error) {\n    *this.input = string(b)\n    return len(strings.TrimSpace(string(b))), nil\n}\n\nfunc main() {\n    t := textProcessor{new(string)}\n\n    l, err := net.Listen(\"tcp\", \":8080\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer l.Close()\n    for {\n        // Wait for connection\n        conn, err := l.Accept()\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        io.Copy(t, conn)\n        fmt.Print(\"Echo: \", *t.input)\n        conn.Close()\n    }\n}\n</code></pre>\n\n<p>Check it out with <em>telnet localhost 8080</em> and enter some rubbish afterwards.</p>\n"}], "owner": {"reputation": 8979, "user_id": 1734279, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/6VA46.jpg?s=128&g=1", "display_name": "rai.skumar", "link": "https://stackoverflow.com/users/1734279/rai-skumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1502195176, "creation_date": 1502186365, "last_edit_date": 1502188535, "question_id": 45565263, "link": "https://stackoverflow.com/questions/45565263/cache-or-persist-a-value-even-if-process-ends", "title": "Cache or Persist a value even if process ends", "body": "<p>Writing a CLI application in GoLang and want to use URL across different sessions/commands. Implementing CLI through Cobra where I want to configure URL at the beginning and then keep using it across other commands. </p>\n\n<p>Tried to use below approach -</p>\n\n<p><code>os.Setenv(\"URL\", URL)\nos.Getenv(\"URL\")\n</code></p>\n\n<p>Above approach works only inside the same process (doesn't work if set and get processes are different).</p>\n\n<p>Any idea how can we do it ?</p>\n\n<p><strong>Update</strong>:\nI wanted to know if it's possible to be done inside Go?\nI know it can be easily done by storing it in file/db or even setting up in environment variable but exploring ways to do it in Go.</p>\n"}, {"tags": ["go", "cassandra", "gocql", "nosql"], "answers": [{"tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 0, "last_activity_date": 1502182864, "creation_date": 1502182864, "answer_id": 45563919, "question_id": 45563495, "link": "https://stackoverflow.com/questions/45563495/storing-slice-of-bytes-in-cassandra-using-gocql-driver/45563919#45563919", "title": "Storing slice of bytes in Cassandra using gocql driver", "body": "<p>Your question is very unspecific and you do not show us what you have done so far.</p>\n\n<p>Since I don't know where your actual problem lies I will just post my <code>WriteRecord</code> function I wrote a while back when testing cassandra with the gocql package:</p>\n\n<pre><code>func (cs *cassandra) WriteRecord(table string, fields []string, values ...interface{}) error {\n    var placeholder []string\n\n    for range fields {\n        placeholder = append(placeholder, \"?\")\n    }\n    querystring := fmt.Sprintf(insertstring, table, strings.Join(fields, \", \"), strings.Join(placeholder, \", \"))\n    return cassandraSession.Query(querystring, values...).Exec()\n}\n</code></pre>\n\n<p>As you can see the values are of type <code>interface{}</code>. So they can be anything including of type <code>[]byte</code>. Note that the following condition must be met: <code>len(fields) = len(values)</code></p>\n\n<p>I hope this helps you on your journey of becoming a <code>golang</code> expert :)</p>\n"}], "owner": {"reputation": 13, "user_id": 8433051, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-skZ0VOcGh5o/AAAAAAAAAAI/AAAAAAAAADI/JXKySvfCLl4/photo.jpg?sz=128", "display_name": "\u041d\u0430\u0437\u0430\u0440 \u041a\u043e\u0431\u043b\u0430\u0439", "link": "https://stackoverflow.com/users/8433051/%d0%9d%d0%b0%d0%b7%d0%b0%d1%80-%d0%9a%d0%be%d0%b1%d0%bb%d0%b0%d0%b9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 391, "favorite_count": 0, "accepted_answer_id": 45563919, "answer_count": 1, "score": 0, "last_activity_date": 1502183379, "creation_date": 1502181802, "last_edit_date": 1506103282, "question_id": 45563495, "link": "https://stackoverflow.com/questions/45563495/storing-slice-of-bytes-in-cassandra-using-gocql-driver", "title": "Storing slice of bytes in Cassandra using gocql driver", "body": "<p>How to store slice of bytes as cassandra blob type using gocql driver?</p>\n"}, {"tags": ["go", "goland"], "answers": [{"tags": [], "owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "is_accepted": false, "score": 1, "last_activity_date": 1502180784, "creation_date": 1502180784, "answer_id": 45563120, "question_id": 45559937, "link": "https://stackoverflow.com/questions/45559937/input-in-gogland-not-work/45563120#45563120", "title": "Input in Gogland not work", "body": "<p>I have the same issue for <em>Gogland-172.3757.2</em>, it is defenetly a bug.</p>\n\n<p>Try to create the new one at <a href=\"https://youtrack.jetbrains.com/issues/GO\" rel=\"nofollow noreferrer\">https://youtrack.jetbrains.com/issues/GO</a></p>\n"}, {"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 0, "last_activity_date": 1502281258, "creation_date": 1502281258, "answer_id": 45590572, "question_id": 45559937, "link": "https://stackoverflow.com/questions/45559937/input-in-gogland-not-work/45590572#45590572", "title": "Input in Gogland not work", "body": "<p>By default the application does not run in a true terminal.  See <a href=\"https://youtrack.jetbrains.com/issue/GO-4179\" rel=\"nofollow noreferrer\">https://youtrack.jetbrains.com/issue/GO-4179</a> for details.</p>\n"}], "owner": {"reputation": 3218, "user_id": 3440266, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/9d37ddb4e007bfd22023d6d5b95f0a45?s=128&d=identicon&r=PG&f=1", "display_name": "macabeus", "link": "https://stackoverflow.com/users/3440266/macabeus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 383, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1502281258, "creation_date": 1502170076, "last_edit_date": 1502177615, "question_id": 45559937, "link": "https://stackoverflow.com/questions/45559937/input-in-gogland-not-work", "title": "Input in Gogland not work", "body": "<p>I have a simple code in Go:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"os\"\n    \"fmt\"\n)\n\nfunc main() {\n    scanner := bufio.NewScanner(os.Stdin)\n    var text string\n    fmt.Print(\"Enter your text: \")\n    scanner.Scan()\n    text = scanner.Text()\n    fmt.Println(\"Your text was: \", text)\n}\n</code></pre>\n\n<p>When I run the code in my terminal or using Run mode in Gogland, work perfectly.</p>\n\n<p>But, when I run the same code in Gogland by Debug mode, even if I typed <code>Enter</code>, keeps reading the input.</p>\n\n<p><a href=\"https://i.stack.imgur.com/MkOet.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/MkOet.png\" alt=\"enter image description here\"></a></p>\n\n<p>How to fix it? Or it's a bug? I'm using the Gogland 1.0 EAP.</p>\n"}, {"tags": ["linux", "go"], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 2727738, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/jQjvX.png?s=128&g=1", "display_name": "loverszhaokai", "link": "https://stackoverflow.com/users/2727738/loverszhaokai"}, "edited": false, "score": 0, "creation_date": 1502165699, "post_id": 45559097, "comment_id": 78077782, "body": "When I set the Setpid:true, the fource processes get different PGID. When I kill the parent process, the child process also survive."}, {"owner": {"reputation": 11, "user_id": 5729136, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/goBxC.png?s=128&g=1", "display_name": "W&#225;ng H\u01ceili&#224;ng", "link": "https://stackoverflow.com/users/5729136/w%c3%a1ng-h%c7%8eili%c3%a0ng"}, "reply_to_user": {"reputation": 107, "user_id": 2727738, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/jQjvX.png?s=128&g=1", "display_name": "loverszhaokai", "link": "https://stackoverflow.com/users/2727738/loverszhaokai"}, "edited": false, "score": 0, "creation_date": 1502423518, "post_id": 45559097, "comment_id": 78212689, "body": "Pay attention to the minus sign &quot;-cmd.Process.Pid&quot;"}], "tags": [], "owner": {"reputation": 11, "user_id": 5729136, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/goBxC.png?s=128&g=1", "display_name": "W&#225;ng H\u01ceili&#224;ng", "link": "https://stackoverflow.com/users/5729136/w%c3%a1ng-h%c7%8eili%c3%a0ng"}, "is_accepted": false, "score": 1, "last_activity_date": 1502165037, "creation_date": 1502165037, "answer_id": 45559097, "question_id": 45559019, "link": "https://stackoverflow.com/questions/45559019/auto-kill-child-process-when-parent-process-is-died/45559097#45559097", "title": "Auto kill child process when parent process is died", "body": "<p>Set process group ID before running the command, and kill by -pid, pay attention to the minus sign.</p>\n\n<pre><code>// set pgid so all child processes can be killed together\ncmd.SysProcAttr = &amp;syscall.SysProcAttr{Setpgid: true}\n...\n// kill -pgid (-pid)\nsyscall.Kill(-cmd.Process.Pid, syscall.SIGKILL)\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 2727738, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/jQjvX.png?s=128&g=1", "display_name": "loverszhaokai", "link": "https://stackoverflow.com/users/2727738/loverszhaokai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 924, "favorite_count": 0, "closed_date": 1502199495, "answer_count": 1, "score": 2, "last_activity_date": 1502189033, "creation_date": 1502164506, "last_edit_date": 1502189033, "question_id": 45559019, "link": "https://stackoverflow.com/questions/45559019/auto-kill-child-process-when-parent-process-is-died", "closed_reason": "Duplicate", "title": "Auto kill child process when parent process is died", "body": "<p>How to <strong>auto kill child process</strong> when parent process is <strong>died</strong> in <strong>Golang</strong> ?</p>\n\n<p>The child process is invoked by <strong>exec.Command()</strong>.</p>\n\n<p>For example,</p>\n\n<p>The parent process pid is: 28290, there is three child process: 32062, 32473, 33455. </p>\n\n<p># ps axo pid, ppid, pgid | grep 28290</p>\n\n<p>PID      PPID  PGID</p>\n\n<p>28290     1   28289</p>\n\n<p>32062 28290 28289</p>\n\n<p>32473 28290 28289</p>\n\n<p>33455 28290 28289</p>\n\n<p>The four process have the same PGID=28289.</p>\n\n<p>When I kill the parent process 28290(<strong>kill the 28290 in linux, kill -9 28290</strong>), the child processes does not exit().</p>\n\n<p>Is there any options to auto kill the child processes?</p>\n"}, {"tags": ["ssl", "go", "reverse-proxy"], "answers": [{"tags": [], "owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "is_accepted": false, "score": 0, "last_activity_date": 1530204909, "creation_date": 1530204909, "answer_id": 51088048, "question_id": 45558963, "link": "https://stackoverflow.com/questions/45558963/how-to-use-tls-in-go-reverseproxy/51088048#51088048", "title": "How to use TLS in Go ReverseProxy?", "body": "<p>You don't have to set up your reverse proxy. What you need to do is to set up HTTP server that you attach your reverse proxy to.</p>\n\n<p>Configure TLS listener by passing two pairs of cert/keys:</p>\n\n<pre><code>abcCrt, err := tls.LoadX509KeyPair(\"a-b-c.crt\", \"a-b-c.key\")\nif err != nil {\n  panic(err)\n}\n\nxyzCrt, err := tls.LoadX509KeyPair(\"x-y-z.crt\", \"z-y-z.key\")\nif err != nil {\n  panic(err)\n}\n\ntlsConfig := &amp;tls.Config{Certificates: []tls.Certificate{abcCrt, xyzCrt}}\nln, err := tls.Listen(\"tcp\", \":443\", tlsConfig) \nif err != nil {\n  panic(err)\n}\n\nhttp.Serve(ln, proxy)\n</code></pre>\n"}], "owner": {"reputation": 988, "user_id": 6149170, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bc071a84d9b5d4ec115745e1d0922b29?s=128&d=identicon&r=PG", "display_name": "hermancain", "link": "https://stackoverflow.com/users/6149170/hermancain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1493, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1530204909, "creation_date": 1502164073, "question_id": 45558963, "link": "https://stackoverflow.com/questions/45558963/how-to-use-tls-in-go-reverseproxy", "title": "How to use TLS in Go ReverseProxy?", "body": "<p>I have sites <code>https://a-b-c.com</code> and <code>https://www.x-y-z.com</code> running behind a reverse proxy on ports <code>4444</code> and <code>5555</code> respectively.</p>\n\n<p>I had them configured to use letsencrypt tls certificates, but now I get an error when using the reverse proxy and I think I need to use a <code>&amp;tls.config{}</code> that includes their certificates but I don't know how to set it up.</p>\n\n<p>My ReverseProxy looks like:</p>\n\n<pre><code>  director := func(req *http.Request) {                        \n    log.Println(req.Host)                                      \n    switch req.Host {                                          \n    case \"a-b-c-.com\":                                 \n      req.URL.Host = \"localhost:4444\"                        \n      req.URL.Scheme = \"https\"                                 \n    case \"x-y-z.com\":                                   \n      req.URL.Host = \"localhost:5555\"                           \n      req.URL.Scheme = \"https\"                                                                                   \n  }                                                            \n  proxy := &amp;httputil.ReverseProxy{Director: director}          \n  proxy.Transport = &amp;http.Transport{                           \n    Proxy: http.ProxyFromEnvironment,                          \n    Dial: (&amp;net.Dialer{                                        \n      Timeout:   30 * time.Second,                             \n      KeepAlive: 30 * time.Second,                             \n    }).Dial,                                                   \n    TLSHandshakeTimeout: 10 * time.Second,                     \n    TLSClientConfig:     &amp;tls.Config{InsecureSkipVerify: true},\n  }                                                            \n\n  log.Fatalln(http.ListenAndServe(\":443\", proxy))              \n</code></pre>\n"}, {"tags": ["go", "go-echo"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 8427577, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bAW23.jpg?s=128&g=1", "display_name": "One-Winged_Eagle", "link": "https://stackoverflow.com/users/8427577/one-winged-eagle"}, "edited": false, "score": 0, "creation_date": 1502166288, "post_id": 45558936, "comment_id": 78077933, "body": "Tried those, they&#39;re less verbose alternatives, but their behaviour is exactly the same as the one I described: work in Postman, work really weirdly inside my application."}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "reply_to_user": {"reputation": 63, "user_id": 8427577, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bAW23.jpg?s=128&g=1", "display_name": "One-Winged_Eagle", "link": "https://stackoverflow.com/users/8427577/one-winged-eagle"}, "edited": false, "score": 0, "creation_date": 1502166650, "post_id": 45558936, "comment_id": 78078029, "body": "Okay, could you create a working application with the issue you mentioned in your question and share a github link? It&#39;s very hard to figure out whats happening at your end. Typically on the server side every request gets served. It&#39;s not like first and subsequent fails. It might be some other issue you&#39;re facing."}], "tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": false, "score": 4, "last_activity_date": 1502164148, "last_edit_date": 1502164148, "creation_date": 1502163841, "answer_id": 45558936, "question_id": 45558773, "link": "https://stackoverflow.com/questions/45558773/serving-files-with-echo/45558936#45558936", "title": "Serving files with Echo", "body": "<p>If you would like to delivery files from certain directory. You can do following ways:</p>\n\n<pre><code>e.Use(middleware.Static(\"/path/to/directory\"))\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>fs := http.FileServer(http.Dir(\"/path/to/directory\"))\ne.GET(\"/assets/*\", echo.WrapHandler(http.StripPrefix(\"/assets/\", fs)))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1004, "user_id": 6366525, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O0kfB.jpg?s=128&g=1", "display_name": "Rahmat Aligos", "link": "https://stackoverflow.com/users/6366525/rahmat-aligos"}, "is_accepted": false, "score": 0, "last_activity_date": 1502169279, "creation_date": 1502169279, "answer_id": 45559773, "question_id": 45558773, "link": "https://stackoverflow.com/questions/45558773/serving-files-with-echo/45559773#45559773", "title": "Serving files with Echo", "body": "<p>Just Add default CORS Middleware, i just test and it's work fine even i using difference domain.\nimport this package from echo framework: <code>\"github.com/labstack/echo/middleware\"</code>\nand Add this default CORS config befor your route:</p>\n\n<pre><code>e.Use(middleware.CORSWithConfig(middleware.CORSConfig{\n    AllowOrigins: []string{\"*\"},\n    AllowMethods: []string{echo.GET, echo.PUT, echo.POST, echo.DELETE},\n}))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 8427577, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bAW23.jpg?s=128&g=1", "display_name": "One-Winged_Eagle", "link": "https://stackoverflow.com/users/8427577/one-winged-eagle"}, "is_accepted": true, "score": 0, "last_activity_date": 1502175081, "creation_date": 1502175081, "answer_id": 45561202, "question_id": 45558773, "link": "https://stackoverflow.com/questions/45558773/serving-files-with-echo/45561202#45561202", "title": "Serving files with Echo", "body": "<p>Welp, seems it was my application's fault all along! My Echo api seems fine... for now!</p>\n\n<p>If someone has the same problem, perhaps this <a href=\"https://stackoverflow.com/questions/45543099/vuejs-with-axios-request-in-vuex-store-cant-make-more-than-one-request-why/#45561091\">Vuejs with axios request in vuex store: can&#39;t make more than one request, why?</a> will help.</p>\n"}], "owner": {"reputation": 63, "user_id": 8427577, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bAW23.jpg?s=128&g=1", "display_name": "One-Winged_Eagle", "link": "https://stackoverflow.com/users/8427577/one-winged-eagle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5086, "favorite_count": 1, "accepted_answer_id": 45561202, "answer_count": 3, "score": 0, "last_activity_date": 1521026879, "creation_date": 1502162598, "last_edit_date": 1521026879, "question_id": 45558773, "link": "https://stackoverflow.com/questions/45558773/serving-files-with-echo", "title": "Serving files with Echo", "body": "<p>I'm trying to serve multiple files with Echo, but it doesn't work every time.\nThe api code looks like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/labstack/echo\"\n\n    \"net/http\"\n)\n\nfunc main() {\n    e := echo.New();\n\n    e.GET(\"/\", home);\n\n    e.File(\"/data1\", \"assets/data1.csv\");\n\n    e.File(\"/data2\", \"assets/data2.csv\");\n\n    e.Logger.Fatal(e.Start(\":4243\"));\n}\n\nfunc home(c echo.Context) error {\n  return c.String(http.StatusOK, \"Are you lost?\");\n}\n</code></pre>\n\n<p>To be precise, it does work for the very first file fetching, but then keeps failing for any subsequent calls (be them file fetching or more \"classic\" calls). The error message is a tad different for each browser:</p>\n\n<p>In Chrome:</p>\n\n<blockquote>\n  <p>SyntaxError: Failed to execute 'setRequestHeader' on 'XMLHttpRequest': 'Bearer {the_entire_content_of_the_first_fetched_file}' is not a valid HTTP header field value.</p>\n</blockquote>\n\n<p>In Firefox:</p>\n\n<blockquote>\n  <p>SyntaxError: An invalid or illegal string was specified</p>\n</blockquote>\n\n<p>In Edge, simply:</p>\n\n<blockquote>\n  <p>SyntaxError</p>\n</blockquote>\n\n<p>Tried activating CORS, nothing changed.</p>\n\n<p>Looks to work pretty well with Postman. Maybe it's a problem with how I do fetch my data in my application?</p>\n\n<p>If you need perhaps a bit more information, this thread is directly related to my previous one (<a href=\"https://stackoverflow.com/questions/45543099/vuejs-with-axios-request-in-vuex-store-cant-make-more-than-one-request-why\">Vuejs with axios request in vuex store: can&#39;t make more than one request, why?</a>), but I didn't want to mix them up, as I don't know yet if I'm mistaken in my Vue code or my Echo one...</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 5, "creation_date": 1502160616, "post_id": 45558505, "comment_id": 78076696, "body": "<a href=\"https://golang.org/pkg/go/build/#hdr-Go_Path\" rel=\"nofollow noreferrer\">golang.org/pkg/go/build/#hdr-Go_Path</a>"}, {"owner": {"reputation": 1004, "user_id": 6366525, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O0kfB.jpg?s=128&g=1", "display_name": "Rahmat Aligos", "link": "https://stackoverflow.com/users/6366525/rahmat-aligos"}, "edited": false, "score": 0, "creation_date": 1502160981, "post_id": 45558505, "comment_id": 78076761, "body": "With the out of the box behavior, Go is less than ideal in repeatability, isolation, and consensus. If you follow the setup guide for golang, you\u2019ll find yourself with a single directory where you\u2019re supposed to keep all of your code. Inside of there, you create a /src directory, and a new directory for each project you\u2019re going to work on. When you install a dependency using go get, it will essentially drop the source code from that repository into `$GOPATH/src\u2019."}, {"owner": {"reputation": 3131, "user_id": 4318281, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/TFbTV.png?s=128&g=1", "display_name": "rocketspacer", "link": "https://stackoverflow.com/users/4318281/rocketspacer"}, "reply_to_user": {"reputation": 1004, "user_id": 6366525, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O0kfB.jpg?s=128&g=1", "display_name": "Rahmat Aligos", "link": "https://stackoverflow.com/users/6366525/rahmat-aligos"}, "edited": false, "score": 1, "creation_date": 1502252707, "post_id": 45558505, "comment_id": 78122536, "body": "@RahmatAligos since 1.6 resolving /vendor is enabled by default"}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 2, "last_activity_date": 1502161482, "last_edit_date": 1502161482, "creation_date": 1502161179, "answer_id": 45558589, "question_id": 45558505, "link": "https://stackoverflow.com/questions/45558505/how-does-go-import-resolving-dependencies/45558589#45558589", "title": "How does Go import resolving dependencies?", "body": "<p>A quick and easy way to see the search order and exact paths searched n a particular system is to run <code>go build err</code>.</p>\n\n<p>This produces output similar to this:</p>\n\n<pre><code>can't load package: package err: cannot find package \"err\" in any of:\n    C:\\go\\src\\err (from $GOROOT)\n    \\\\FREENAS\\Global Documents\\Projects\\Go\\src\\err (from $GOPATH)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3131, "user_id": 4318281, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/TFbTV.png?s=128&g=1", "display_name": "rocketspacer", "link": "https://stackoverflow.com/users/4318281/rocketspacer"}, "edited": false, "score": 0, "creation_date": 1539269658, "post_id": 45561196, "comment_id": 92449263, "body": "What happens in the case of nested vendor(s) ? :)"}, {"owner": {"reputation": 3131, "user_id": 4318281, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/TFbTV.png?s=128&g=1", "display_name": "rocketspacer", "link": "https://stackoverflow.com/users/4318281/rocketspacer"}, "edited": false, "score": 0, "creation_date": 1573799877, "post_id": 45561196, "comment_id": 104011280, "body": "Kudos if you can update the answer now that we have Go modules ;D"}], "tags": [], "owner": {"reputation": 2694, "user_id": 1280320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/922b107850370d90a2a8d7e6a0cfbd07?s=128&d=identicon&r=PG", "display_name": "RaviTezu", "link": "https://stackoverflow.com/users/1280320/ravitezu"}, "is_accepted": true, "score": 4, "last_activity_date": 1502175061, "creation_date": 1502175061, "answer_id": 45561196, "question_id": 45558505, "link": "https://stackoverflow.com/questions/45558505/how-does-go-import-resolving-dependencies/45561196#45561196", "title": "How does Go import resolving dependencies?", "body": "<p>Lookup order:</p>\n\n<ol>\n<li>The vendor folder.</li>\n<li>The standard packages.</li>\n<li>GOPATH folder.</li>\n</ol>\n\n<p>Run <code>go help gopath</code> to learn more on how <code>Go</code> search each directory.  </p>\n"}], "owner": {"reputation": 3131, "user_id": 4318281, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/TFbTV.png?s=128&g=1", "display_name": "rocketspacer", "link": "https://stackoverflow.com/users/4318281/rocketspacer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 531, "favorite_count": 0, "accepted_answer_id": 45561196, "answer_count": 2, "score": 1, "last_activity_date": 1539269634, "creation_date": 1502160492, "last_edit_date": 1539269634, "question_id": 45558505, "link": "https://stackoverflow.com/questions/45558505/how-does-go-import-resolving-dependencies", "title": "How does Go import resolving dependencies?", "body": "<p>In Go, when I import a dependency like:</p>\n\n<pre><code>import \"github.com/spf13/viper\"\n</code></pre>\n\n<p>Which directories will Go look into, and in which order?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14132, "user_id": 4014291, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/taWvG.jpg?s=128&g=1", "display_name": "Samuel Toh", "link": "https://stackoverflow.com/users/4014291/samuel-toh"}, "edited": false, "score": 1, "creation_date": 1502157173, "post_id": 45558049, "comment_id": 78075955, "body": "Won&#39;t it be easier to just use <code>nginx</code> to proxy the request to the process you want it to go?"}, {"owner": {"reputation": 988, "user_id": 6149170, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bc071a84d9b5d4ec115745e1d0922b29?s=128&d=identicon&r=PG", "display_name": "hermancain", "link": "https://stackoverflow.com/users/6149170/hermancain"}, "reply_to_user": {"reputation": 14132, "user_id": 4014291, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/taWvG.jpg?s=128&g=1", "display_name": "Samuel Toh", "link": "https://stackoverflow.com/users/4014291/samuel-toh"}, "edited": false, "score": 0, "creation_date": 1502157311, "post_id": 45558049, "comment_id": 78075992, "body": "No it won&#39;t, I&#39;ve done it like that."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1502157499, "post_id": 45558049, "comment_id": 78076024, "body": "What you&#39;ve described here is simpler with nginx, apache, caddy, etc. What do you need to do differently? If you do need to write a reverse proxy, what from the multitude of online examples doesn&#39;t work?"}, {"owner": {"reputation": 988, "user_id": 6149170, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bc071a84d9b5d4ec115745e1d0922b29?s=128&d=identicon&r=PG", "display_name": "hermancain", "link": "https://stackoverflow.com/users/6149170/hermancain"}, "edited": false, "score": 0, "creation_date": 1502157634, "post_id": 45558049, "comment_id": 78076048, "body": "Setting up nginx is much more of a pain because then I have to deal with the configuration and a whole other service running, not to mention all the extra attack area. I did this with Go once before and it was a one liner I just can&#39;t remember how I did it."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1502199859, "post_id": 45558049, "comment_id": 78099353, "body": "Your Go proxy will also be &quot;a whole other service running&quot;, so that&#39;s no different. Are you really suggesting that writing and maintaining an entire stable, secure, working, performant application is easier than configuring nginx?"}, {"owner": {"reputation": 988, "user_id": 6149170, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bc071a84d9b5d4ec115745e1d0922b29?s=128&d=identicon&r=PG", "display_name": "hermancain", "link": "https://stackoverflow.com/users/6149170/hermancain"}, "edited": false, "score": 0, "creation_date": 1502201785, "post_id": 45558049, "comment_id": 78100848, "body": "Yes, it is. It&#39;s a few lines of code compared to running a giant service that requires me to re-familiarize my self with the configuration syntax. Nginx is not a part of my current stack and would need to be run through Systemd, whereas I currently have a stack thats 100% Go. Why install nginx, re-learn how to configure it, and them set up the systemd service when I already know Go? Why add extra attack surface area for something I can do my self? Why needlessly complicate my stack with a huge server framework? Writing and maintaining a Go application is pretty easy imo."}], "answers": [{"tags": [], "owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "is_accepted": true, "score": 2, "last_activity_date": 1502158349, "creation_date": 1502158349, "answer_id": 45558262, "question_id": 45558049, "link": "https://stackoverflow.com/questions/45558049/how-to-pipe-forward-seamlessly-from-port-80-to-port-xxxx-with-go/45558262#45558262", "title": "How to pipe/forward seamlessly from port 80 to port XXXX with go?", "body": "<p>you can use httputil's <a href=\"https://golang.org/pkg/net/http/httputil/#ReverseProxy\" rel=\"nofollow noreferrer\">ReverseProxy</a></p>\n\n<p>here's an example code</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"net/http/httputil\"\n)\n\nfunc main() {\n    director := func(req *http.Request) {\n        switch req.Host {\n        case \"address001.com\":\n            req.URL.Host = \"localhost:4444\"\n            req.URL.Scheme = \"http\"\n        case \"address002.com\":\n            req.URL.Host = \"localhost:5555\"\n            req.URL.Scheme = \"http\"\n        default:\n            log.Println(\"error\")\n        }\n    }\n    proxy := &amp;httputil.ReverseProxy{Director: director}\n    log.Fatalln(http.ListenAndServe(\":8080\", proxy))\n}\n</code></pre>\n"}], "owner": {"reputation": 988, "user_id": 6149170, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bc071a84d9b5d4ec115745e1d0922b29?s=128&d=identicon&r=PG", "display_name": "hermancain", "link": "https://stackoverflow.com/users/6149170/hermancain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 45558262, "answer_count": 1, "score": -1, "last_activity_date": 1502158349, "creation_date": 1502156513, "question_id": 45558049, "link": "https://stackoverflow.com/questions/45558049/how-to-pipe-forward-seamlessly-from-port-80-to-port-xxxx-with-go", "title": "How to pipe/forward seamlessly from port 80 to port XXXX with go?", "body": "<p>I have a bunch of websites running on one server (single IP) and they all run on high ports so I don't need root to run them.</p>\n\n<p>When someone visits from one web address, lets say, <a href=\"http://address001.com/\" rel=\"nofollow noreferrer\">http://address001.com/</a>, I want to seamlessly pipe the data from port 4444 to the person who made this request, and if someone visits <a href=\"http://address002.com/\" rel=\"nofollow noreferrer\">http://address002.com/</a> I want to pipe the data from port 5555.</p>\n\n<p>How would I do this in Go?</p>\n\n<p>So far I have a handler function that looks like this:</p>\n\n<pre><code>func home(w http.ResponseWriter, r *http.Request) {                      \n  if strings.Contains(r.Host, \"address001\") {                    \n    // ???\n  }                                                                      \n}  \n</code></pre>\n"}, {"tags": ["go", "blockchain", "ethereum", "go-ethereum"], "answers": [{"tags": [], "owner": {"reputation": 17856, "user_id": 1439168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd72ad672b055a7d59cfb1c30d1c724f?s=128&d=identicon&r=PG", "display_name": "Miguel Mota", "link": "https://stackoverflow.com/users/1439168/miguel-mota"}, "is_accepted": false, "score": 2, "last_activity_date": 1528073831, "last_edit_date": 1528073831, "creation_date": 1527536450, "answer_id": 50572629, "question_id": 45558034, "link": "https://stackoverflow.com/questions/45558034/build-raw-ethereum-transaction-in-go-contract-function-call/50572629#50572629", "title": "Build raw Ethereum transaction in Go - contract function call", "body": "<p>Here's a simple example of how you can interact with a smart contract in Go. Assuming you have <code>solc</code> and <code>abigen</code> installed.</p>\n\n<pre><code>solc --abi Store.sol &gt; Store.abi\nsolc --bin Store.sol &gt; Store.bin\nabigen --bin=Store.bin --abi=Store.abi --pkg=store --out=Store.go\n</code></pre>\n\n<p>Store.sol</p>\n\n<pre><code>pragma solidity ^0.4.24;\n\ncontract Store {\n  event ItemSet(bytes32 key, bytes32 value);\n\n  string public version;\n  mapping (bytes32 =&gt; bytes32) public items;\n\n  constructor(string _version) public {\n    version = _version;\n  }\n\n  function setItem(bytes32 key, bytes32 value) external {\n    items[key] = value;\n    emit ItemSet(key, value);\n  }\n}\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"crypto/ecdsa\"\n    \"fmt\"\n    \"log\"\n    \"math/big\"\n\n    \"github.com/ethereum/go-ethereum/accounts/abi/bind\"\n    \"github.com/ethereum/go-ethereum/common\"\n    \"github.com/ethereum/go-ethereum/crypto\"\n    \"github.com/ethereum/go-ethereum/ethclient\"\n\n    store \"./contracts\" // for demo\n)\n\nfunc main() {\n    client, err := ethclient.Dial(\"https://rinkeby.infura.io\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    privateKey, err := crypto.HexToECDSA(\"fad9c8855b740a0b7ed4c221dbad0f33a83a49cad6b3fe8d5817ac83d38b6a19\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    publicKey := privateKey.Public()\n    publicKeyECDSA, ok := publicKey.(*ecdsa.PublicKey)\n    if !ok {\n        log.Fatal(\"error casting public key to ECDSA\")\n    }\n\n    fromAddress := crypto.PubkeyToAddress(*publicKeyECDSA)\n    nonce, err := client.PendingNonceAt(context.Background(), fromAddress)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    gasPrice, err := client.SuggestGasPrice(context.Background())\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    auth := bind.NewKeyedTransactor(privateKey)\n    auth.Nonce = big.NewInt(int64(nonce))\n    auth.Value = big.NewInt(0)     // in wei\n    auth.GasLimit = uint64(300000) // in units\n    auth.GasPrice = gasPrice\n\n    address := common.HexToAddress(\"0x147B8eb97fD247D06C4006D269c90C1908Fb5D54\")\n    instance, err := store.NewStore(address, client)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    key := [32]byte{}\n    value := [32]byte{}\n    copy(key[:], []byte(\"foo\"))\n    copy(value[:], []byte(\"bar\"))\n\n    tx, err := instance.SetItem(auth, key, value)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"tx sent: %s\", tx.Hash().Hex()) // tx sent: 0x8d490e535678e9a24360e955d75b27ad307bdfb97a1dca51d0f3035dcee3e870\n\n    result, err := instance.Items(&amp;bind.CallOpts{}, key)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(string(result[:])) // \"bar\"\n}\n</code></pre>\n\n<p>For more examples, check out the <a href=\"https://github.com/miguelmota/ethereum-development-with-go-book\" rel=\"nofollow noreferrer\">Ethereum Development with Go book</a>.</p>\n"}], "owner": {"reputation": 11, "user_id": 8431559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68ca1d4cba14aff83c98bf98c7ea92e6?s=128&d=identicon&r=PG&f=1", "display_name": "Henry Jones", "link": "https://stackoverflow.com/users/8431559/henry-jones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 871, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1528073831, "creation_date": 1502156406, "question_id": 45558034, "link": "https://stackoverflow.com/questions/45558034/build-raw-ethereum-transaction-in-go-contract-function-call", "title": "Build raw Ethereum transaction in Go - contract function call", "body": "<p>I'm modifying go-ethereum to be able to handle merged mining with a token we're creating. So every time a miner has our version of geth running and mining, if they find a block, they will receive X amount of our token via our contract. </p>\n\n<p>The contract is built to handle giving out the reward to the miner of the block. I just need to modify go-ethereum to handle adding the transaction of calling the reward function in the contract and adding it to the tx pool before submitting the block.</p>\n\n<p>In go-ethereum, I've added a new go file, <code>token_claim.go</code> in the miner package. Looking in miner.go file, it appears that I need to add in this code to build an sign the reward claim transaction in <code>/go-ethereum-1.6.7/miner/worker.go</code> around <code>line 474</code> right before sealing the block.</p>\n\n<p>Can someone provide an example of building a raw transaction in Go calling a contract function. I have the abi, bytecode, and contract address. </p>\n\n<p>Thanks</p>\n"}, {"tags": ["linux", "go", "linux-namespaces"], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 735776, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/84b3831b6fffa18ea30f703892c0ea44?s=128&d=identicon&r=PG", "display_name": "woosley. xu", "link": "https://stackoverflow.com/users/735776/woosley-xu"}, "edited": false, "score": 2, "creation_date": 1503043364, "post_id": 45675560, "comment_id": 78460142, "body": "Thanks. For the record, to achieve <code>mount --make-private &#47;</code> in golang, the mount flag is <code>syscall.MS_PRIVATE|syscall.MS_REC</code>"}], "tags": [], "owner": {"reputation": 111, "user_id": 5737938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33a93a89f9386ea2300d1cd5071cefde?s=128&d=identicon&r=PG&f=1", "display_name": "Andrii L.", "link": "https://stackoverflow.com/users/5737938/andrii-l"}, "is_accepted": true, "score": 2, "last_activity_date": 1502717085, "creation_date": 1502717085, "answer_id": 45675560, "question_id": 45557831, "link": "https://stackoverflow.com/questions/45557831/golang-mount-namespace-mounted-volume-are-not-cleared-after-the-process-exits/45675560#45675560", "title": "golang mount namespace: mounted volume are not cleared after the process exits?", "body": "<p>This happens due to mount events propagation between namespaces. The propagation type of your mount point is <code>MS_SHARED</code>.</p>\n\n<blockquote>\n  <p><code>MS_SHARED</code>: This mount point shares mount and unmount events with other mount points that are members of its \"peer group\". When a mount point is added or removed under this mount point, this change will propagate to the peer group, so that the mount or unmount will also take place under each of the peer mount points. Propagation also occurs in the reverse direction, so that mount and unmount events on a peer mount will also propagate to this mount point.</p>\n</blockquote>\n\n<p>Source - <a href=\"https://lwn.net/Articles/689856/\" rel=\"nofollow noreferrer\">https://lwn.net/Articles/689856/</a></p>\n\n<p>The <code>shared:N</code> tag in <code>/proc/self/mountinfo</code> indicates that the mount is sharing propagation events with a peer group:</p>\n\n<pre><code>$ sudo go run namespace-1.go\n[root@localhost]# mount --bind /home/andrii/test /mnt\n# The propagation type is MS_SHARED\n[root@localhost]# grep '/mnt' /proc/self/mountinfo\n264 175 254:0 /home/andrii/test /mnt rw,noatime shared:1 - ext4 \n/dev/mapper/cryptroot rw,data=ordered\n[root@localhost]# exit\n$ ls /mnt\ntest_file\n</code></pre>\n\n<p>On most Linux distributions the default propagation type is <code>MS_SHARED</code> which is set by <code>systemd</code>. See <code>NOTES</code> in <code>man 7 mount_namespaces</code>:</p>\n\n<blockquote>\n  <p>Notwithstanding the fact that the default propagation type for new \n  mount points is in many cases MS_PRIVATE, MS_SHARED is typically more \n  useful. For this reason, systemd(1) automatically remounts all mount \n  points as MS_SHARED on system startup. Thus, on most modern systems, \n  the default propagation type is in practice MS_SHARED.</p>\n</blockquote>\n\n<p>If you want a fully isolated namespace, you can make all mount points private this way:</p>\n\n<pre><code>$ sudo go run namespace-1.go\n[root@localhost]# mount --make-rprivate /\n[root@localhost]# mount --bind /home/andrii/test /mnt\n# The propagation type is MS_PRIVATE now\n[root@localhost]# grep '/mnt' /proc/self/mountinfo\n264 175 254:0 /home/andrii/test /mnt rw,noatime - ext4 \n/dev/mapper/cryptroot rw,data=ordered\n[root@localhost]# exit\n$ ls /mnt\n</code></pre>\n"}], "owner": {"reputation": 163, "user_id": 735776, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/84b3831b6fffa18ea30f703892c0ea44?s=128&d=identicon&r=PG", "display_name": "woosley. xu", "link": "https://stackoverflow.com/users/735776/woosley-xu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 839, "favorite_count": 0, "accepted_answer_id": 45675560, "answer_count": 1, "score": 1, "last_activity_date": 1502717085, "creation_date": 1502154862, "last_edit_date": 1502197269, "question_id": 45557831, "link": "https://stackoverflow.com/questions/45557831/golang-mount-namespace-mounted-volume-are-not-cleared-after-the-process-exits", "title": "golang mount namespace: mounted volume are not cleared after the process exits?", "body": "<p>code below, I thought if I starts a process with syscall.CLONE_NEWNS, every mount option inside the namespace will be cleared when the process exits. </p>\n\n<p>but it is not? </p>\n\n<pre><code>package main\nimport (\n        \"fmt\"\n        \"os\"\n        \"os/exec\"\n        \"syscall\"\n)\n\nvar command string = \"/usr/bin/bash\"\n\nfunc container_command() {\n\n        fmt.Printf(\"starting container command %s\\n\", command)\n        cmd := exec.Command(command)\n        cmd.SysProcAttr = &amp;syscall.SysProcAttr{Cloneflags: syscall.CLONE_NEWPID |\n                syscall.CLONE_NEWNS,\n        }\n        cmd.Stdin = os.Stdin\n        cmd.Stdout = os.Stdout\n        cmd.Stderr = os.Stderr\n\n        if err := cmd.Run(); err != nil {\n                fmt.Println(\"error\", err)\n                os.Exit(1)\n        }\n}\n\nfunc main() {\n        fmt.Printf(\"starting current process %d\\n\", os.Getpid())\n        container_command()\n        fmt.Printf(\"command ended\\n\")\n\n}\n</code></pre>\n\n<p>run this and mount a directory, this directory still exits after the program exits. </p>\n\n<pre><code>[root@localhost go]# go run namespace-1.go\nstarting current process 7558\nstarting container command /usr/bin/bash\n[root@ns-process go]# mount --bind /home /mnt\n[root@ns-process go]# ls /mnt\nvagrant\n[root@ns-process go]# exit\nexit\ncommand ended\n[root@localhost go]# ls /mnt\nvagrant\n[root@localhost go]#\n</code></pre>\n\n<p>if this is the desired behavior, how is the proc get mounted in container implementations? because if I mount proc inside the namespace, I will get </p>\n\n<pre><code>[root@ns-process go]# mount -t proc /proc\n[root@ns-process go]# exit\nexit\ncommand ended\n[root@localhost go]# mount\nmount: failed to read mtab: No such file or directory\n[root@localhost go]#\n</code></pre>\n\n<p>proc has to be remounted to get it back. </p>\n\n<p>update: \ndoing the same in C also gives the same result, I think this should be a intended behavior. </p>\n\n<pre><code>#define _GNU_SOURCE\n#include &lt;sys/types.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;sched.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;unistd.h&gt;\n\n#define STACK_SIZE (1024 * 1024)\nstatic char container_stack[STACK_SIZE];\n\nchar* const container_args[] = {\n    \"/bin/bash\",\n    NULL\n};\n\nint container_main(void* arg)\n{\n        printf(\"Container [%5d] - inside the container!\\n\", getpid());\n            sethostname(\"container\",10);\n            system(\"mount -t proc proc /proc\");\n            execv(container_args[0], container_args);\n            printf(\"Something's wrong!\\n\");\n            return 1;\n}\n\nint main()\n{\n    printf(\"start a container!\\n\");\n    int container_pid = clone(container_main, container_stack+STACK_SIZE,\n            CLONE_NEWUTS | CLONE_NEWPID | CLONE_NEWNS | SIGCHLD, NULL);\n    waitpid(container_pid, NULL, 0);\n    printf(\"container ended!\\n\");\n    return 0;\n}\n</code></pre>\n\n<p>command output:</p>\n\n<pre><code>[root@localhost ~]# gcc a.c\n[root@localhost ~]# ./a.out\nstart a container!\nContainer [    1] - inside the container!\n[root@container ~]# ps -ef\nUID        PID  PPID  C STIME TTY          TIME CMD\nroot         1     0  0 08:57 pts/0    00:00:00 /bin/bash\nroot        17     1  0 08:57 pts/0    00:00:00 ps -ef\n[root@container ~]# exit\nexit\ncontainer stopped!\n[root@localhost ~]# ps -ef\nError, do this: mount -t proc proc /proc\n[root@localhost ~]# cat a.c\n</code></pre>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502134984, "post_id": 45554548, "comment_id": 78069042, "body": "When you alias types, they become a new type. They are not equivalent, despite the temptation to think so."}, {"owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502135043, "post_id": 45554548, "comment_id": 78069065, "body": "yup I know, I now edited my question to ask, what&#39;s the easiest way to assign one to the other if all the field names are the same."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1502135217, "post_id": 45554548, "comment_id": 78069158, "body": "The struct types are different, so you can&#39;t convert it. You need to assign the fields individually."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1502135885, "post_id": 45554548, "comment_id": 78069511, "body": "Your &quot;unnamed types&quot; are not unnamed. You might want to read the spec."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1502138647, "post_id": 45554548, "comment_id": 78070794, "body": "@Volker yes they are, according to the spec: <a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Types</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1502170375, "post_id": 45554548, "comment_id": 78079299, "body": "@Adrian <code>UnnamedTypes</code> is a named type and thus not unnamed."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1502191307, "post_id": 45554548, "comment_id": 78092751, "body": "I believe they&#39;re referring to the types of the <i>fields</i>, since that is what is different between the two examples. Perhaps reread the question."}], "answers": [{"tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 3, "last_activity_date": 1502135228, "creation_date": 1502135228, "answer_id": 45554625, "question_id": 45554548, "link": "https://stackoverflow.com/questions/45554548/convert-named-types-to-unnamed-types/45554625#45554625", "title": "Convert named types to unnamed types", "body": "<p>Create a new struct value using the old ones.</p>\n\n<pre><code>u = UnnamedTypes{\n    i: n.i,\n    f: n.f,\n}\n</code></pre>\n\n<p>A warning though, because these specific values are slices, the slices in the two different structs are the exact same slices. Modifying one will modify the other. The same will apply to any pointers as well (including maps and interfaces). If you want them to have their own copy, you must allocate a copy.</p>\n"}], "owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1502135228, "creation_date": 1502134863, "question_id": 45554548, "link": "https://stackoverflow.com/questions/45554548/convert-named-types-to-unnamed-types", "title": "Convert named types to unnamed types", "body": "<p>Say I have a struct of UnnamedTypes:</p>\n\n<pre><code>type UnnamedTypes struct {\n    i []int\n    f []float64\n}\n</code></pre>\n\n<p>And some named types in a struct:</p>\n\n<pre><code>type I []int\ntype F []float64\n\ntype NamedTypes struct {\n    i I\n    f F\n}\n</code></pre>\n\n<p>What's the easiest way to assign NamedTypes struct to an UnnamedTypes struct?</p>\n\n<pre><code>func main() {\n    var u UnnamedTypes\n    var n NamedTypes\n\n    u.i = []int{1,2}\n    u.f = []float64{2,3}\n\n    n.i = []int{2,3}\n    n.f = []float64{4,5}\n\n    u = UnnamedTypes(n)\n}\n</code></pre>\n\n<p>fails with <code>cannot convert n (type NamedTypes) to type UnnamedTypes</code></p>\n"}, {"tags": ["go", "ansible", "jinja2"], "comments": [{"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1502135027, "post_id": 45554173, "comment_id": 78069060, "body": "You can try with different template delimiters, so escape may not be needed."}, {"owner": {"reputation": 11185, "user_id": 1055637, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8a8b9e4daac99ea95aa3e8e246716e73?s=128&d=identicon&r=PG", "display_name": "Mazzy", "link": "https://stackoverflow.com/users/1055637/mazzy"}, "reply_to_user": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1502135109, "post_id": 45554173, "comment_id": 78069101, "body": "@jeevatkm can you elaborate please?"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1502135315, "post_id": 45554173, "comment_id": 78069220, "body": "By default Go template delimiters is <code>{{ }}</code>, you have an option to change it. For example: to <code>[[ ]]</code> via <a href=\"https://golang.org/pkg/text/template/#Template.Delims\" rel=\"nofollow noreferrer\">template.Delims</a>."}, {"owner": {"reputation": 11185, "user_id": 1055637, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8a8b9e4daac99ea95aa3e8e246716e73?s=128&d=identicon&r=PG", "display_name": "Mazzy", "link": "https://stackoverflow.com/users/1055637/mazzy"}, "reply_to_user": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1502135358, "post_id": 45554173, "comment_id": 78069239, "body": "@jeevatkm it&#39;s docker"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1502135678, "post_id": 45554173, "comment_id": 78069416, "body": "I&#39;m sorry, I didn&#39;t get your point. If it&#39;s a Go template either text or html, you can choose different delimiters so that it won&#39;t get collide with other usage."}, {"owner": {"reputation": 11185, "user_id": 1055637, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8a8b9e4daac99ea95aa3e8e246716e73?s=128&d=identicon&r=PG", "display_name": "Mazzy", "link": "https://stackoverflow.com/users/1055637/mazzy"}, "reply_to_user": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1502135716, "post_id": 45554173, "comment_id": 78069428, "body": "this go template is a options tag used in <code>docker run</code> command"}], "answers": [{"comments": [{"owner": {"reputation": 11185, "user_id": 1055637, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8a8b9e4daac99ea95aa3e8e246716e73?s=128&d=identicon&r=PG", "display_name": "Mazzy", "link": "https://stackoverflow.com/users/1055637/mazzy"}, "edited": false, "score": 0, "creation_date": 1502135604, "post_id": 45554602, "comment_id": 78069384, "body": "the error is now gone but the <code>tag</code> property is rendered like this <code>u&#39;tag&#39;: u&#39;&#47;&#47;&#39;</code>"}, {"owner": {"reputation": 54590, "user_id": 2795592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85fbe4bfb6102057764f046f57f161ac?s=128&d=identicon&r=PG", "display_name": "Konstantin Suvorov", "link": "https://stackoverflow.com/users/2795592/konstantin-suvorov"}, "reply_to_user": {"reputation": 11185, "user_id": 1055637, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8a8b9e4daac99ea95aa3e8e246716e73?s=128&d=identicon&r=PG", "display_name": "Mazzy", "link": "https://stackoverflow.com/users/1055637/mazzy"}, "edited": false, "score": 0, "creation_date": 1502138809, "post_id": 45554602, "comment_id": 78070861, "body": "Just tested it with ansible 2.2.1, seems to be working as expected. What version are you on?"}, {"owner": {"reputation": 11185, "user_id": 1055637, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8a8b9e4daac99ea95aa3e8e246716e73?s=128&d=identicon&r=PG", "display_name": "Mazzy", "link": "https://stackoverflow.com/users/1055637/mazzy"}, "edited": false, "score": 0, "creation_date": 1502140086, "post_id": 45554602, "comment_id": 78071439, "body": "2.2.2.0 ansible"}, {"owner": {"reputation": 54590, "user_id": 2795592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85fbe4bfb6102057764f046f57f161ac?s=128&d=identicon&r=PG", "display_name": "Konstantin Suvorov", "link": "https://stackoverflow.com/users/2795592/konstantin-suvorov"}, "reply_to_user": {"reputation": 11185, "user_id": 1055637, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8a8b9e4daac99ea95aa3e8e246716e73?s=128&d=identicon&r=PG", "display_name": "Mazzy", "link": "https://stackoverflow.com/users/1055637/mazzy"}, "edited": false, "score": 0, "creation_date": 1502169505, "post_id": 45554602, "comment_id": 78078925, "body": "Yeah, there were regressions introduced while Ansible team has been fighting with CVEs. If you put intermediate debug, you&#39;ll notice that <code>{{...}}</code> are replaced with jinja2 comments, leaving you with just forward slashes after double templating. Try with 2.2.1 or 2.3.1"}], "tags": [], "owner": {"reputation": 54590, "user_id": 2795592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85fbe4bfb6102057764f046f57f161ac?s=128&d=identicon&r=PG", "display_name": "Konstantin Suvorov", "link": "https://stackoverflow.com/users/2795592/konstantin-suvorov"}, "is_accepted": false, "score": 2, "last_activity_date": 1502135131, "last_edit_date": 1592644375, "creation_date": 1502135131, "answer_id": 45554602, "question_id": 45554173, "link": "https://stackoverflow.com/questions/45554173/escaping-golang-template-in-jinja2-template/45554602#45554602", "title": "Escaping golang template in Jinja2 template", "body": "<p><code>when</code> statement is a Jinja2 expression itself, so Ansible tries to evaluate your string once again.</p>\n<p>You should be good with <a href=\"https://docs.ansible.com/ansible/latest/playbooks_advanced_syntax.html#unsafe-or-raw-strings\" rel=\"nofollow noreferrer\">!unsafe</a> typing in this case:</p>\n<pre><code>- name: Set default log options for Splunk\n  set_fact:\n    log_options_base:\n       tag: !unsafe &quot;{{.ImageName}}/{{.Name}}/{{.ID}}&quot;\n</code></pre>\n<p>But I haven't used this syntax trick much, so there may be some side effects, test it before production use.</p>\n<p>P.S. why do you compare dict var <code>log_options_base</code> with empty string in <code>log_options_base != &quot;&quot;</code>? May be you want <code>is defined</code> test?</p>\n"}], "owner": {"reputation": 11185, "user_id": 1055637, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8a8b9e4daac99ea95aa3e8e246716e73?s=128&d=identicon&r=PG", "display_name": "Mazzy", "link": "https://stackoverflow.com/users/1055637/mazzy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1047, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1502135131, "creation_date": 1502133236, "question_id": 45554173, "link": "https://stackoverflow.com/questions/45554173/escaping-golang-template-in-jinja2-template", "title": "Escaping golang template in Jinja2 template", "body": "<p>I have the following tasks:</p>\n\n<pre><code>- name: Set default log options for Splunk\n  set_fact:\n    log_options_base:\n       tag: \"{{ '{{' }}.ImageName{{ '}}' }}/{{ '{{' }}.Name{{ '}}' }}/{{ '{{' }}.ID{{ '}}' }}\"\n       splunk-token: \"{{ splunk_token }}\"\n       splunk-url: \"{{ splunk_url }}\"\n       splunk-format: \"json\"\n       splunk-index: \"my-dx\"\n       labels: \"{{ env }}\"\n  when:\n    - log_driver is defined\n    - log_driver == 'splunk'\n- name: Set extendend log options for Splunk\n  set_fact:\n    log_options_ext: \"{{ log_options_base | combine({ 'env': NODE_ENV }) }}\"\n  when:\n     - log_options_base != \"\"\n</code></pre>\n\n<p>Unfortunately I'm having the following issue:</p>\n\n<p><code>template error while templating string: unexpected '.'. String: {{.ImageName}}/{{.Name}}/{{.ID}}\\n\\n</code></p>\n\n<p><code>\"The conditional check 'log_options_base != \\\"\\\"' failed.</code></p>\n\n<p>The issue is definitely with the golang template but it is already escaped in my case. </p>\n\n<p>Any idea?</p>\n"}, {"tags": ["go", "stream"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1502131588, "post_id": 45553532, "comment_id": 78067386, "body": "It&#39;s possible there are issues at the server config level, limiting active connections. just fyi, I don&#39;t expect the Go code would do this so I&#39;d check your apache config or something along those lines."}, {"owner": {"reputation": 33, "user_id": 6453967, "user_type": "registered", "profile_image": "https://graph.facebook.com/1175484259149850/picture?type=large", "display_name": "dovahkiin", "link": "https://stackoverflow.com/users/6453967/dovahkiin"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1502132447, "post_id": 45553532, "comment_id": 78067784, "body": "I don&#39;t have anything like <i>apache</i> or <i>nginx</i> running. I&#39;m running On Windows 10 64 bit. Any Ideas?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1502136118, "post_id": 45553532, "comment_id": 78069625, "body": "Open IIS to find similar settings"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1502138532, "post_id": 45553532, "comment_id": 78070740, "body": "Where in the code are the pending requests are blocked?"}, {"owner": {"reputation": 33, "user_id": 6453967, "user_type": "registered", "profile_image": "https://graph.facebook.com/1175484259149850/picture?type=large", "display_name": "dovahkiin", "link": "https://stackoverflow.com/users/6453967/dovahkiin"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1502165875, "post_id": 45553532, "comment_id": 78077830, "body": "@JimB it was being blocked inside the <code>http.ServeFile</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1502191171, "post_id": 45553532, "comment_id": 78092641, "body": "Can you get a stack trace to see exactly where it&#39;s blocked?"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 6453967, "user_type": "registered", "profile_image": "https://graph.facebook.com/1175484259149850/picture?type=large", "display_name": "dovahkiin", "link": "https://stackoverflow.com/users/6453967/dovahkiin"}, "edited": false, "score": 0, "creation_date": 1502132140, "post_id": 45553694, "comment_id": 78067645, "body": "I tried 2 tabs on Chrome first, its working fine as expected, but It didn&#39;t on Firefox (While Chome is open). While those are open, I tried curl but I didn&#39;t receive anything."}, {"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "reply_to_user": {"reputation": 33, "user_id": 6453967, "user_type": "registered", "profile_image": "https://graph.facebook.com/1175484259149850/picture?type=large", "display_name": "dovahkiin", "link": "https://stackoverflow.com/users/6453967/dovahkiin"}, "edited": false, "score": 0, "creation_date": 1502180450, "post_id": 45553694, "comment_id": 78084973, "body": "Your code works fine on my system. I can have 4 concurrent connections all serving content with no problems. As I said, your code is fine. There is obviously an environment/configuration issue somewhere on your system. Why don&#39;t you trying running on a cheap VPS from someone like Digital Ocean / Vultr?"}], "tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": true, "score": 1, "last_activity_date": 1502131276, "creation_date": 1502131276, "answer_id": 45553694, "question_id": 45553532, "link": "https://stackoverflow.com/questions/45553532/http-servefile-and-http-servecontent-cannot-handle-multiple-clients/45553694#45553694", "title": "http.ServeFile and http.ServeContent cannot handle multiple clients", "body": "<p>I suspect your code is fine. All major browsers will normally limit the number of parallel active connections to a host.</p>\n\n<p>As a simple test, try streaming multiple times with something like <code>curl</code> to confirm there is actually a problem with your code. Alternatively, try running different browsers simultaneously (e.g. 2 tabs in Chrome, 2 tabs in Firefox etc)</p>\n"}], "owner": {"reputation": 33, "user_id": 6453967, "user_type": "registered", "profile_image": "https://graph.facebook.com/1175484259149850/picture?type=large", "display_name": "dovahkiin", "link": "https://stackoverflow.com/users/6453967/dovahkiin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 637, "favorite_count": 0, "accepted_answer_id": 45553694, "answer_count": 1, "score": 2, "last_activity_date": 1502131276, "creation_date": 1502130642, "question_id": 45553532, "link": "https://stackoverflow.com/questions/45553532/http-servefile-and-http-servecontent-cannot-handle-multiple-clients", "title": "http.ServeFile and http.ServeContent cannot handle multiple clients", "body": "<p><strong>Scenario</strong> <br>\nI created a simple video streamer using golang. At First, I used <code>http.ServeContent</code> to serve my videos. It was working until I <em>simultaneously</em> connected 4 tabs to my server but the first two only works and the rest aren't loading at all. I can navigate to the menu while streaming the two videos but I can't stream on the rest. I also tried it using multiple devices. Only two connections can stream. </p>\n\n<p>So, I changed <code>http.ServeContent</code> to <code>http.ServeFile</code> but its still the same but when I used <code>io.Pipes</code>, It served every request but the problem is that It can't seek.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc serveVideo(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n    title := vars[\"title\"]\n    ep := vars[\"ep\"]\n    http.ServeFile(w, r, \"video/\" + title + \"/\" ep + \".mp4\")\n}\n\nfunc main() {\n     const port string = \"8080\"\n    // Create mux router\n    r := mux.NewRouter()\n    r.HandleFunc(\"/video/{title}/{ep}\", serveVideo)\n    // let mux handle\n    http.Handle(\"/\", r)\n    if err := http.ListenAndServe(\":8080\", nil); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>I wish you could help. Thank you.</p>\n"}, {"tags": ["json", "go", "slice"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1502128450, "post_id": 45552207, "comment_id": 78065688, "body": "@Adrian , isn&#39;t that backwards? OP wants to go <b>from</b> an <code>interface{}</code>, not <b>to</b> an <code>interface{}</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1502129792, "post_id": 45552207, "comment_id": 78066429, "body": "It doesn&#39;t matter, the issue is still the same."}], "answers": [{"comments": [{"owner": {"reputation": 387, "user_id": 4160072, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh4.googleusercontent.com/-87BjCfblqW4/AAAAAAAAAAI/AAAAAAAAAuU/96eymOXkgvs/photo.jpg?sz=128", "display_name": "Mohammed", "link": "https://stackoverflow.com/users/4160072/mohammed"}, "edited": false, "score": 0, "creation_date": 1502126939, "post_id": 45552238, "comment_id": 78064849, "body": "I think this is the only way to go :)"}, {"owner": {"reputation": 1148, "user_id": 92049, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/88811849e4e502b6f1a5ffcd791d635c?s=128&d=identicon&r=PG", "display_name": "sebastian", "link": "https://stackoverflow.com/users/92049/sebastian"}, "edited": false, "score": 0, "creation_date": 1524771530, "post_id": 45552238, "comment_id": 87117662, "body": "In the first line, <code>var orig [][]interface</code> should read <code>var orig [][]interface{}</code>."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 1148, "user_id": 92049, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/88811849e4e502b6f1a5ffcd791d635c?s=128&d=identicon&r=PG", "display_name": "sebastian", "link": "https://stackoverflow.com/users/92049/sebastian"}, "edited": false, "score": 0, "creation_date": 1524773971, "post_id": 45552238, "comment_id": 87118798, "body": "correct, thanks @sebastian"}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 3, "last_activity_date": 1524773944, "last_edit_date": 1524773944, "creation_date": 1502125814, "answer_id": 45552238, "question_id": 45552207, "link": "https://stackoverflow.com/questions/45552207/convert-interface-to-string/45552238#45552238", "title": "Convert [][]interface to [][]string", "body": "<p>Simplest way is probably to make new slices and write some loops:</p>\n\n<pre><code>var orig [][]interface{}\nvar strs = make([][]string, len(orig))\nfor i := range orig {\n   strs[i] = make([]string, len(orig[i]))\n   for j := range orig[i]{\n     strs[i][j] = fmt.Sprint(orig[i][j])\n   }\n}\n</code></pre>\n"}], "owner": {"reputation": 387, "user_id": 4160072, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh4.googleusercontent.com/-87BjCfblqW4/AAAAAAAAAAI/AAAAAAAAAuU/96eymOXkgvs/photo.jpg?sz=128", "display_name": "Mohammed", "link": "https://stackoverflow.com/users/4160072/mohammed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "closed_date": 1502135898, "accepted_answer_id": 45552238, "answer_count": 1, "score": -1, "last_activity_date": 1524773944, "creation_date": 1502125685, "question_id": 45552207, "link": "https://stackoverflow.com/questions/45552207/convert-interface-to-string", "closed_reason": "Duplicate", "title": "Convert [][]interface to [][]string", "body": "<p>Is there any easy way to convert <code>[][] interface{}</code> to <code>[][]string</code> ?\nWhat I want is to to write this <code>[][] interface{}</code> to a <code>csv</code> but <code>writer</code> in <code>go</code>  accepts only <code>[][]string</code>.\nAdditional info : my <code>[][] interface{}</code> contains 4 columns 2 of them are string and 2 are <code>json.Number</code>.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["parsing", "go", "yaml"], "comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 2, "creation_date": 1502117743, "post_id": 45549682, "comment_id": 78059347, "body": "did you try <code>interface{}</code> as type for <code>val</code>?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1502120402, "post_id": 45549682, "comment_id": 78061180, "body": "Specifically, you would use <code>interface{}</code> for the type, then use a type switch (<a href=\"https://tour.golang.org/methods/16\" rel=\"nofollow noreferrer\">tour.golang.org/methods/16</a>) to utilize it."}, {"owner": {"reputation": 1271, "user_id": 5554930, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/75ec5e8612e63e54af86d7a9a7ee1e44?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/5554930/rahul"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502122240, "post_id": 45549682, "comment_id": 78062328, "body": "@RayfenWindspear, TehSphinX thanks, aren&#39;t there any disadvantages of such approach?"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 2, "creation_date": 1502125204, "post_id": 45549682, "comment_id": 78063938, "body": "I don&#39;t think there is another approach unless you change the yaml and give the variables different names. If you have a variable of type <code>interface{}</code> you will have to cast it depending on it&#39;s type later. That is a bit work but you are getting good suggestions on that below."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 1, "creation_date": 1502125358, "post_id": 45549682, "comment_id": 78064020, "body": "@TehSphinX Correct, dealing with <code>interface{}</code> values is kind of a pain, but the advantage with go is that it is statically typed, yet you can do this sort of pseudo loose typing. Gotta put in the extra effort to get it done though."}], "answers": [{"comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502125022, "post_id": 45551937, "comment_id": 78063849, "body": "To make your answer perfect could you add the lines of how to cast <code>Val</code> of type <code>interface{}</code> to variables of type <code>int</code>, <code>[]int</code>, <code>[]string</code>, etc?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502125078, "post_id": 45551937, "comment_id": 78063877, "body": "They <b>are</b> casted inside the switch statement. Inside their respective case <code>val</code> is actually of the correct type."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1502125572, "post_id": 45551937, "comment_id": 78064137, "body": "If you need to assert a single variable into something you know it should be (or you think haha), you can use a type assertion. <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">tour.golang.org/methods/15</a>"}, {"owner": {"reputation": 19745, "user_id": 574632, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bb13b2bbc97ce81108b09be9a41120a1?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/574632/steve"}, "edited": false, "score": 0, "creation_date": 1502138952, "post_id": 45551937, "comment_id": 78070935, "body": "<code>for i := range t.Array {</code> should be <code>for i := range d.Array {</code> no? Also, whats with the single char variable names in go?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 19745, "user_id": 574632, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bb13b2bbc97ce81108b09be9a41120a1?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/574632/steve"}, "edited": false, "score": 0, "creation_date": 1502139085, "post_id": 45551937, "comment_id": 78071007, "body": "@Steve thanks, I made some changes outside a code editor and that leaked through. Didn&#39;t help that there isn&#39;t a builtin <code>yaml</code> package, so I couldn&#39;t do a playground."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 3, "last_activity_date": 1502139012, "last_edit_date": 1502139012, "creation_date": 1502124479, "answer_id": 45551937, "question_id": 45549682, "link": "https://stackoverflow.com/questions/45549682/golang-and-yaml-with-dynamic-schema/45551937#45551937", "title": "Golang and yaml with dynamic schema", "body": "<p>I decided to add an answer showing a type assertion instead of the <code>reflect</code> package. You can decide which is best for your application. I personally prefer the builtin functions over the complexity of the <code>reflect</code> package.</p>\n\n<pre><code>var data = `\narray:\n  - name: myvar\n    val: 1\n  - name: mymap\n    val: [1, 2]\n`\n\ntype Data struct {\n    Array []struct {\n        Name string\n        Val  interface{}\n    }\n}\n\nfunc main() {\n    d := Data{}\n    err := yaml.Unmarshal([]byte(data), &amp;d)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    for i := range d.Array {\n        switch val := d.Array[i].(type) {\n        case int:\n            fmt.Println(val) // is integer\n        case []int:\n            fmt.Println(val) // is []int\n        case []string:\n            fmt.Println(val) // is []string\n            //  .... you get the idea\n        default:\n            log.Fatalf(\"Type unaccounted for: %+v\\n\", d.Array[i])\n        }\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 1271, "user_id": 5554930, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/75ec5e8612e63e54af86d7a9a7ee1e44?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/5554930/rahul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1512, "favorite_count": 0, "accepted_answer_id": 45551937, "answer_count": 1, "score": 1, "last_activity_date": 1502139012, "creation_date": 1502117047, "question_id": 45549682, "link": "https://stackoverflow.com/questions/45549682/golang-and-yaml-with-dynamic-schema", "title": "Golang and yaml with dynamic schema", "body": "<p>I have a YAML structure with dynamic schema e.g. I can have the following yaml:</p>\n\n<pre><code>array:\n  - name: myvar\n    val: 1\n  - name: mymap\n    val: [ 1, 2]\n</code></pre>\n\n<p>Goyaml maps yaml to Go struct, which should declare definite type. Here, <code>val</code> is either a signle number, or an array or even a map.</p>\n\n<p>Which is the best solution for this situation?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1502109872, "post_id": 45547169, "comment_id": 78053888, "body": "I think you can achieve this with a custom marshaler. I don&#39;t think Go has the ability to do this built into it by default, you will have to write your own logic. The <code>encoding&#47;json</code> package allows a custom marshaller on your structs. Take a look <a href=\"https://golang.org/pkg/encoding/json/#example__customMarshalJSON\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1502110705, "post_id": 45547169, "comment_id": 78054462, "body": "Take a look at <a href=\"https://stackoverflow.com/questions/40559250/golang-dynamic-creating-member-of-struct/40568896#40568896\">https://stackoverflow.com/questions/40559250/golang-dynamic-&zwnj;&#8203;creating-member-of-s&zwnj;&#8203;truct/40568896</a>. The example is for <code>Unmarshal</code> but the idea is the same, i.e. save your object to <code>map[string]interface{}</code> then use <code>json.Marshal</code> to serialize the object to JSON."}], "answers": [{"comments": [{"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "edited": false, "score": 0, "creation_date": 1502111133, "post_id": 45547634, "comment_id": 78054755, "body": "&gt;&gt; What exactly is your target type supposed to be?  I don&#39;t need a type.  I need json as string to POST it to external web service. Thanks."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "edited": false, "score": 0, "creation_date": 1502111235, "post_id": 45547634, "comment_id": 78054820, "body": "you always have a type and if it is <code>interface{}</code>. You question is not quite clear on this. Your target seems to be string but what is your source?"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "edited": false, "score": 0, "creation_date": 1502111305, "post_id": 45547634, "comment_id": 78054864, "body": "The source is the database.  I need to read a data from database and make POST requests to REST server."}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "edited": false, "score": 1, "creation_date": 1502111961, "post_id": 45547634, "comment_id": 78055358, "body": "Thanks. Looks like your answer is what I need. I will create map dynamically and next serialize it to JSON like in your code."}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 1, "last_activity_date": 1502111066, "creation_date": 1502111066, "answer_id": 45547634, "question_id": 45547169, "link": "https://stackoverflow.com/questions/45547169/serialize-to-json-dynamic-structure/45547634#45547634", "title": "Serialize to JSON dynamic structure", "body": "<p>What exactly is your target type supposed to be? It can't be a struct since you do not know the fields beforehand.</p>\n\n<p>The only fitting type to me seems to be a <code>map</code> of type <code>map[string]interface{}</code>: with it any nested structure can be achieved:</p>\n\n<pre><code>a := map[string]interface{}{\n    \"item.field1\": \"val1\",\n    \"item.field2\": \"val2\",\n    \"item.fieldN\": \"valN\",\n    \"custom_fields\": map[string]interface{}{\n        \"fields.field1\": \"cval1\",\n        \"fields.field2\": \"cval2\",\n    },\n}\nb, err := json.Marshal(a)\n</code></pre>\n\n<p>See playground sample <a href=\"https://play.golang.org/p/kw_OZWTMGS\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>Filling this structure from a database as you hinted at should probably be a custom script (not using json).</p>\n\n<p>Note: <code>custom_fields</code> can also be of other types depending on what type the value column is in the database. If the value column is a string use <code>map[string]string</code>.</p>\n"}], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 804, "favorite_count": 0, "accepted_answer_id": 45547634, "answer_count": 1, "score": -2, "last_activity_date": 1502111166, "creation_date": 1502109620, "last_edit_date": 1502111166, "question_id": 45547169, "link": "https://stackoverflow.com/questions/45547169/serialize-to-json-dynamic-structure", "title": "Serialize to JSON dynamic structure", "body": "<p>All examples of working with JSON describe how to serialize to <code>JSON</code> simple or user types (like a struct).</p>\n\n<p>But I have a different case: a) I don't know the fields of my type/object b) every object will have different types.</p>\n\n<p>Here is my case in pseudocode:</p>\n\n<pre><code>while `select * from item` do\n  while `select fieldname, fieldvalue from fields where fields.itemid = item.id` do\n    ...\n</code></pre>\n\n<p>For each entity in my database I get field names and field values.  In the result I need to get something like this:</p>\n\n<pre><code>{\n  \"item.field1\": value,\n  ...\n  \"item.fieldN\": value,\n  \"custom_fields\": {\n     \"fields.field1\": value,\n      ...\n     \"fields.fieldK\": value\n  }\n}\n</code></pre>\n\n<p>What is the best way to do it in Go? Is there any useful libraries or functions in standard library ?</p>\n\n<p><strong>Update:</strong> The source of data is the database. In the result i need to get JSON as string to POST it to external web service. So, the program just read data from database and make POST requests to REST service.</p>\n"}, {"tags": ["go", "hdfs"], "answers": [{"tags": [], "owner": {"reputation": 361, "user_id": 7229120, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5af5b05b1499d40493fb6ed087bf12b6?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron", "link": "https://stackoverflow.com/users/7229120/aaron"}, "is_accepted": false, "score": 2, "last_activity_date": 1502275770, "last_edit_date": 1502275770, "creation_date": 1502156498, "answer_id": 45558047, "question_id": 45546246, "link": "https://stackoverflow.com/questions/45546246/why-does-hdfs-throw-unexpected-eof-error-using-golang/45558047#45558047", "title": "Why does HDFS throw unexpected EOF error using golang?", "body": "<p>I've found the reason. I was using the WEBHDFS Port (50070) instead of the Hadoop IPC Port (9000).</p>\n"}], "owner": {"reputation": 361, "user_id": 7229120, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5af5b05b1499d40493fb6ed087bf12b6?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron", "link": "https://stackoverflow.com/users/7229120/aaron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 406, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1502280636, "creation_date": 1502106681, "last_edit_date": 1502280636, "question_id": 45546246, "link": "https://stackoverflow.com/questions/45546246/why-does-hdfs-throw-unexpected-eof-error-using-golang", "title": "Why does HDFS throw unexpected EOF error using golang?", "body": "<pre><code>package main\nimport (\n    \"fmt\"\n    \"github.com/colinmarc/hdfs\"\n)\nfunc main() { \n    client, err := hdfs.New(\"192.168.0.38:50070\")\n    fs, err := client.ReadDir(\"/\")\n    fmt.Println(err)\n    fmt.Println(fs)\n}\n</code></pre>\n\n<p>err is unexpected EOF\nAnd I found that the error occurs in </p>\n\n<pre><code>func (c *NamenodeConnection) readResponse(method string, resp proto.Message) error {\n...\n    _, err = io.ReadFull(c.conn, packet)\n...\n}\n</code></pre>\n\n<p>I'm using hadoop 2.7.3</p>\n"}, {"tags": ["go", "private"], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1502102126, "post_id": 45544335, "comment_id": 78049232, "body": "His example is: <code>reflect.ValueOf(&amp;http.Server{}).MethodByName(&quot;newConn&quot;).Call&zwnj;&#8203;([]reflect.Value{})</code> One line, it compiles. Though you are right, it is unclear what he is trying to accomplish. And he shouldn&#39;t be doing this sort of thing anyway."}, {"owner": {"reputation": 11, "user_id": 8428029, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-uv7FJA8Bo54/AAAAAAAAAAI/AAAAAAAAAB8/_nyvjUDVmfg/photo.jpg?sz=128", "display_name": "\ud568\uce58\ud5cc", "link": "https://stackoverflow.com/users/8428029/%ed%95%a8%ec%b9%98%ed%97%8c"}, "edited": false, "score": 0, "creation_date": 1502104318, "post_id": 45544335, "comment_id": 78050477, "body": "I can&#39;t post second question in 90 mins. So will be posted concrete question later.  I&#39;m trying to serve http in child process using already accepted socket file descriptor that has been passed by parent process. (Multi process server)  The parent process is a C++ server and accepting inet connection.  The child process is a forked C++ process on start and running go program.  I have succeeded to create net.Conn about passed file descriptor integer.  But I couldn&#39;t find proper http serve method using file descriptor (or net.Conn) in go http server."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 11, "user_id": 8428029, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-uv7FJA8Bo54/AAAAAAAAAAI/AAAAAAAAAB8/_nyvjUDVmfg/photo.jpg?sz=128", "display_name": "\ud568\uce58\ud5cc", "link": "https://stackoverflow.com/users/8428029/%ed%95%a8%ec%b9%98%ed%97%8c"}, "edited": false, "score": 0, "creation_date": 1502107071, "post_id": 45544335, "comment_id": 78052209, "body": "@\ud568\uce58\ud5cc <code>http.Serve</code> takes a <a href=\"https://golang.org/pkg/net/#Listener\" rel=\"nofollow noreferrer\">golang.org/pkg/net/#Listener</a> , which is an interface that has 3 methods wrapped around a <code>net.Conn</code>. If you create a struct that implements this interface using your <code>net.Conn</code>, you can pass it to <code>http.Serve</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 11, "user_id": 8428029, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-uv7FJA8Bo54/AAAAAAAAAAI/AAAAAAAAAB8/_nyvjUDVmfg/photo.jpg?sz=128", "display_name": "\ud568\uce58\ud5cc", "link": "https://stackoverflow.com/users/8428029/%ed%95%a8%ec%b9%98%ed%97%8c"}, "edited": false, "score": 0, "creation_date": 1502181514, "post_id": 45544335, "comment_id": 78085668, "body": "@\ud568\uce58\ud5cc Don&#39;t post a new question. Edit this one."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1502100775, "last_edit_date": 1502100775, "creation_date": 1502100324, "answer_id": 45544335, "question_id": 45544252, "link": "https://stackoverflow.com/questions/45544252/how-to-invoke-unexported-class-method-in-go/45544335#45544335", "title": "How to invoke unexported class&#39; method in go", "body": "<p><strong>TLDR</strong> You don't. That's the whole point of not exporting things; to prevent direct access to them.</p>\n\n<p>Having said that, this question sounds a lot like an <a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">XY Problem</a>.  Perhaps if you can explain what you're trying to accomplish, we can suggest an alternative approach.</p>\n\n<p><strong>Longer answer</strong></p>\n\n<p>This can be possible with reflection (as you're attempting). This should only be done in the absolute rarest of situations, if even then.</p>\n\n<p>To help with that, please include a complete, reproducible example. The code you've included doesn't compile, so it's impossible to debug.</p>\n"}], "owner": {"reputation": 11, "user_id": 8428029, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-uv7FJA8Bo54/AAAAAAAAAAI/AAAAAAAAAB8/_nyvjUDVmfg/photo.jpg?sz=128", "display_name": "\ud568\uce58\ud5cc", "link": "https://stackoverflow.com/users/8428029/%ed%95%a8%ec%b9%98%ed%97%8c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 703, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1502100775, "creation_date": 1502100097, "last_edit_date": 1502100294, "question_id": 45544252, "link": "https://stackoverflow.com/questions/45544252/how-to-invoke-unexported-class-method-in-go", "title": "How to invoke unexported class&#39; method in go", "body": "<p>I want to invoke http.Server's newConn method in net/http/server.go</p>\n\n<pre><code>func (srv *Server) newConn(rwc net.Conn) *conn {\n    c := &amp;conn{\n        server: srv,\n        rwc:    rwc,\n    }\n    if debugServerConnections {\n        c.rwc = newLoggingConn(\"server\", c.rwc)\n    }\n    return c\n}\n</code></pre>\n\n<p>Tried to access using reflect but errors occured</p>\n\n<pre><code>conn := ...\nserver := &amp;http.Server{}\n\ninputs := make([]reflect.Value, 1)\ninputs[0] = reflect.ValueOf(conn)\nc := reflect.ValueOf(server).MethodByName(\"newConn\").Call(inputs)\n</code></pre>\n\n<pre><code>panic: reflect: call of reflect.Value.Call on zero Value\n\ngoroutine 17 [running, locked to thread]:\nreflect.flag.mustBe(0x0, 0x13)\n    /usr/local/go/src/reflect/value.go:201 +0xae\nreflect.Value.Call(0x0, 0x0, 0x0, 0xc420047d10, 0x1, 0x1, 0x0, 0x0, 0xc4200e82c0)\n    /usr/local/go/src/reflect/value.go:300 +0x38\n</code></pre>\n\n\n\n<p>Is there any solution?</p>\n"}, {"tags": ["go", "google-api", "gmail-api", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 363, "user_id": 6459288, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/yUbcq.jpg?s=128&g=1", "display_name": "matiux", "link": "https://stackoverflow.com/users/6459288/matiux"}, "edited": false, "score": 0, "creation_date": 1502101970, "post_id": 45544387, "comment_id": 78049155, "body": "Thanks, I have tried but I don&#39;t understand how can I go ahead... the program, blocks after elaborating 10 labels"}, {"owner": {"reputation": 363, "user_id": 6459288, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/yUbcq.jpg?s=128&g=1", "display_name": "matiux", "link": "https://stackoverflow.com/users/6459288/matiux"}, "edited": false, "score": 0, "creation_date": 1502102427, "post_id": 45544387, "comment_id": 78049407, "body": "Ops sorry, I had forgotten the &quot;for gmailLabels := range chIn {&quot; in first goroutine. Now it process all the labels but I get this error: panic: runtime error: index out of range [recovered] \tpanic: runtime error: index out of range"}, {"owner": {"reputation": 363, "user_id": 6459288, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/yUbcq.jpg?s=128&g=1", "display_name": "matiux", "link": "https://stackoverflow.com/users/6459288/matiux"}, "edited": false, "score": 0, "creation_date": 1502102750, "post_id": 45544387, "comment_id": 78049602, "body": "Sorry but I&#39;m sleeping: D Actually everything works very well! However there are two things that I don&#39;t understand 1) what do you mean with &quot;The channels have a small buffer to decrease synchronisation time.&quot; 2) why do you have created the two buffers with size of 20?"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 363, "user_id": 6459288, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/yUbcq.jpg?s=128&g=1", "display_name": "matiux", "link": "https://stackoverflow.com/users/6459288/matiux"}, "edited": false, "score": 0, "creation_date": 1502107795, "post_id": 45544387, "comment_id": 78052609, "body": "Size 20 of the channels is the &#39;small buffer&#39;. If you have an unbuffered channel, the sending/receiving side has to wait for the other side to receive/send. If you have buffers, you eliminate some waiting time. Only if the buffer is full, the sending side has to wait and if the buffer is empty the receiving side has to wait."}, {"owner": {"reputation": 363, "user_id": 6459288, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/yUbcq.jpg?s=128&g=1", "display_name": "matiux", "link": "https://stackoverflow.com/users/6459288/matiux"}, "edited": false, "score": 0, "creation_date": 1502108808, "post_id": 45544387, "comment_id": 78053205, "body": "Thanks, you were very clear. I tried to raise the value in the loop: &quot;for i := 0; i &lt; 50; i++ {&quot;. Still works well and it takes less time"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 363, "user_id": 6459288, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/yUbcq.jpg?s=128&g=1", "display_name": "matiux", "link": "https://stackoverflow.com/users/6459288/matiux"}, "edited": false, "score": 0, "creation_date": 1502109850, "post_id": 45544387, "comment_id": 78053868, "body": "Perfect. Yes, you can play around with how many go routines you start and also with the buffer sizes. If you use 50 goroutines I suggest you increase the buffers to be at least as large."}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 1, "last_activity_date": 1502102680, "last_edit_date": 1502102680, "creation_date": 1502100491, "answer_id": 45544387, "question_id": 45544133, "link": "https://stackoverflow.com/questions/45544133/how-to-limit-goroutine/45544387#45544387", "title": "how to limit goroutine", "body": "<p>How about only starting e.g. 10 goroutines and pass the values in from one for loop in another go routine. The channels have a small buffer to decrease synchronisation time.</p>\n\n<pre><code>chIn := make(chan label.Label, 20)\nchOut := make(chan label.Label, 20)\n\nfor i:=0;i&lt;10;i++ {\n    go func(gClient *gmail.Client, chIn chan label.Label, chOut chan&lt;- label.Label) {\n\n        for gmailLabels := range chIn {\n            d, err := s.gClient.Service.Users.Labels.Get(s.gClient.User, l.Id).Do()\n\n            if err != nil {\n                panic(err)\n            }\n\n            // Performs some operation with the label `d`\n            preparedLabel := ....\n\n            chOut &lt;- preparedLabel\n\n        }\n\n    }(s.gClient, chIn, chOut)\n\n}\n\ngo func(chIn chan label.Label) {\n    defer close(chIn)\n    for _, l := range r.Labels {\n        chIn &lt;- l\n    }\n}(chIn)\n\nfor i := 0; i &lt; len(r.Labels); i++ {\n    lab := &lt;-chOut\n    fmt.Printf(\"Processed %v\\n\", lab.LabelID)\n}\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>Here a <a href=\"https://play.golang.org/p/R4b296QOrk\" rel=\"nofollow noreferrer\">playground sample</a>.</p>\n"}], "owner": {"reputation": 363, "user_id": 6459288, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/yUbcq.jpg?s=128&g=1", "display_name": "matiux", "link": "https://stackoverflow.com/users/6459288/matiux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 817, "favorite_count": 0, "accepted_answer_id": 45544387, "answer_count": 1, "score": 1, "last_activity_date": 1502102680, "creation_date": 1502099680, "question_id": 45544133, "link": "https://stackoverflow.com/questions/45544133/how-to-limit-goroutine", "title": "how to limit goroutine", "body": "<p>I'm developing a gmail client based on google api.</p>\n\n<p>I have a list of labels obtained through this call</p>\n\n<pre><code>r, err := s.gClient.Service.Users.Labels.List(s.gClient.User).Do()\n</code></pre>\n\n<p>Then, for every label I need to get details</p>\n\n<pre><code>for _, l := range r.Labels {\n    d, err := s.gClient.Service.Users.Labels.Get(s.gClient.User, l.Id).Do()\n}\n</code></pre>\n\n<p>I'd like to handle the loop in a more powerful way so I have implemented a goroutine in the loop:</p>\n\n<pre><code>ch := make(chan label.Label)\n\nfor _, l := range r.Labels {\n\n    go func(gmailLabels *gmailclient.Label, gClient *gmail.Client, ch chan&lt;- label.Label) {\n\n        d, err := s.gClient.Service.Users.Labels.Get(s.gClient.User, l.Id).Do()\n\n        if err != nil {\n            panic(err)\n        }\n\n        // Performs some operation with the label `d`\n        preparedLabel := ....\n\n        ch &lt;- preparedLabel\n\n    }(l, s.gClient, ch)\n}\n\nfor i := 0; i &lt; len(r.Labels); i++ {\n    lab := &lt;-ch\n    fmt.Printf(\"Processed %v\\n\", lab.LabelID)\n}\n</code></pre>\n\n<p>The problem with this code is that gmail api has a rate limit, so, I get this error:</p>\n\n<pre><code>panic: googleapi: Error 429: Too many concurrent requests for user, rateLimitExceeded\n</code></pre>\n\n<p>What is  the correct way to handle this situation?</p>\n"}, {"tags": ["docker", "go", "docker-api"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 8427369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93ff2e776bfd0b90269413638a93ac16?s=128&d=identicon&r=PG&f=1", "display_name": "Insignianode", "link": "https://stackoverflow.com/users/8427369/insignianode"}, "edited": false, "score": 0, "creation_date": 1502099986, "post_id": 45542612, "comment_id": 78047998, "body": "I am not using glide. Is there anyway without it? I can&#39;t find the vendor directory like mentioned above...the directory in my system is C:\\Projects\\Go\\pkg\\windows_amd64\\github.com\\docker\\docker\\ve&zwnj;&#8203;ndor\\github.com\\dock&zwnj;&#8203;er and the directory has go-connections folder in it.Suggestion please.."}, {"owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "reply_to_user": {"reputation": 41, "user_id": 8427369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93ff2e776bfd0b90269413638a93ac16?s=128&d=identicon&r=PG&f=1", "display_name": "Insignianode", "link": "https://stackoverflow.com/users/8427369/insignianode"}, "edited": false, "score": 0, "creation_date": 1502102118, "post_id": 45542612, "comment_id": 78049228, "body": "Actually, <code>docker</code> use vendoring. Can you try to delete the <code>vendor</code> directory ? - the error references to it - <code>cannot use &quot;github.com&#47;docker&#47;go-connections&#47;nat&quot;.PortSet literal (type &quot;github.com&#47;docker&#47;go-connections&#47;nat&quot;.PortSet) as type &quot;github.com&#47;docker&#47;docker&#47;vendor&#47;github.com&#47;docker&#47;go-connec&zwnj;&#8203;tions&#47;nat&quot;.PortSet in field value</code>"}, {"owner": {"reputation": 41, "user_id": 8427369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93ff2e776bfd0b90269413638a93ac16?s=128&d=identicon&r=PG&f=1", "display_name": "Insignianode", "link": "https://stackoverflow.com/users/8427369/insignianode"}, "edited": false, "score": 1, "creation_date": 1502102623, "post_id": 45542612, "comment_id": 78049520, "body": "I deleted the vendor directory and I ended up getting errors below  src\\github.com\\docker\\docker\\pkg\\system\\syscall_windows.go:6&zwnj;&#8203;:2: cannot find package &quot;github.com/Sirupsen/logrus&quot; in any of:         C:\\Go\\src\\github.com\\Sirupsen\\logrus (from $GOROOT)         C:\\Projects\\Go\\src\\github.com\\Sirupsen\\logrus (from $GOPATH) src\\github.com\\docker\\docker\\client\\container_commit.go:8:2: cannot find package &quot;github.com/docker/distribution/reference&quot; in any of:         C:\\Go\\src\\github.com\\docker\\distribution\\reference (from $GOROOT)    and similar more like this and please guide me to fix it."}, {"owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "reply_to_user": {"reputation": 41, "user_id": 8427369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93ff2e776bfd0b90269413638a93ac16?s=128&d=identicon&r=PG&f=1", "display_name": "Insignianode", "link": "https://stackoverflow.com/users/8427369/insignianode"}, "edited": false, "score": 0, "creation_date": 1502103770, "post_id": 45542612, "comment_id": 78050164, "body": "Sorry... :( You can restore the <code>vendor</code> directory from <code>https:&#47;&#47;github.com&#47;moby&#47;moby&#47;vendor</code> (moby is the new repository for docker), or probably from your clone copy. How did you install this docker package firstplace ?"}, {"owner": {"reputation": 364, "user_id": 4612655, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh6.googleusercontent.com/-txR3dQaOfQ8/AAAAAAAAAAI/AAAAAAAABdM/yn6Q-bQh5YQ/photo.jpg?sz=128", "display_name": "Justin A", "link": "https://stackoverflow.com/users/4612655/justin-a"}, "edited": false, "score": 0, "creation_date": 1511284215, "post_id": 45542612, "comment_id": 81791658, "body": "@ShmulikKlein I have the exact same issue and I installed the packages via &quot;go get -u &quot;"}], "tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": false, "score": 1, "last_activity_date": 1502096346, "last_edit_date": 1502096346, "creation_date": 1502094926, "answer_id": 45542612, "question_id": 45542071, "link": "https://stackoverflow.com/questions/45542071/setting-ports-for-container-in-docker-for-docker-golang-api/45542612#45542612", "title": "setting ports for container in docker for docker golang api", "body": "<p>This is a Golang issue with how <code>vendor/</code> works.</p>\n\n<p>Remove the nested vendor directory:</p>\n\n<pre><code>rm -rf vendor/github.com/docker/docker/vendor\n</code></pre>\n\n<p>If you are using <code>glide</code>, you should use <code>glide install -v</code> when installing the dependency.</p>\n\n<p>For more details, check this reported <a href=\"https://github.com/moby/moby/issues/28269\" rel=\"nofollow noreferrer\">issue</a></p>\n"}, {"comments": [{"owner": {"reputation": 1941, "user_id": 1267370, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/32MVo.jpg?s=128&g=1", "display_name": "mooseman", "link": "https://stackoverflow.com/users/1267370/mooseman"}, "edited": false, "score": 0, "creation_date": 1510851643, "post_id": 47334888, "comment_id": 81621972, "body": "You need more explanation for how this solves their problem."}], "tags": [], "owner": {"reputation": 1, "user_id": 8952966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/634712854130073a247c6ce9be9adbf0?s=128&d=identicon&r=PG", "display_name": "leseb", "link": "https://stackoverflow.com/users/8952966/leseb"}, "is_accepted": false, "score": -1, "last_activity_date": 1510850291, "creation_date": 1510850291, "answer_id": 47334888, "question_id": 45542071, "link": "https://stackoverflow.com/questions/45542071/setting-ports-for-container-in-docker-for-docker-golang-api/47334888#47334888", "title": "setting ports for container in docker for docker golang api", "body": "<p>My solution for OSX:</p>\n\n<pre><code>mv /Users/&lt;user&gt;/go/src/github.com/docker/docker/vendor/github.com/docker/go-connections/{nat,nat.old}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 8427369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93ff2e776bfd0b90269413638a93ac16?s=128&d=identicon&r=PG&f=1", "display_name": "Insignianode", "link": "https://stackoverflow.com/users/8427369/insignianode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1354, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1515100102, "creation_date": 1502092984, "last_edit_date": 1502099134, "question_id": 45542071, "link": "https://stackoverflow.com/questions/45542071/setting-ports-for-container-in-docker-for-docker-golang-api", "title": "setting ports for container in docker for docker golang api", "body": "<p>I am looking forward to do something below like this using docker golang api</p>\n\n<p>cmd : docker run -t -i -p 8989:8080 \"image-name\" /bin/bash</p>\n\n<p>Also I am using golang sdk <a href=\"https://github.com/moby/moby/client\" rel=\"nofollow noreferrer\">https://github.com/moby/moby/client</a> or <a href=\"https://godoc.org/github.com/moby/moby/client\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/moby/moby/client</a> and my docker api version is 1.30 (Client &amp; Server both)</p>\n\n<p>Here is the piece of code I am using</p>\n\n<pre><code> package main\n\n import (\n       \"fmt\"\n\n       \"github.com/docker/docker/client\"\n       \"github.com/docker/docker/api/types\"\n       \"github.com/docker/docker/api/types/container\"\n       \"golang.org/x/net/context\"\n       \"github.com/docker/go-connections/nat\"\n    //\"github.com/docker/docker/vendor/github.com/docker/go-connections/nat\"\n)\n\nfunc check(err error) {\n   if err != nil {\n       panic(err)\n   }\n}\n\n\nfunc main(){\n    ctx := context.Background()\ncli, err := client.NewEnvClient()\ncheck(err)\n\n\nconfig := &amp;container.Config{\nImage : image-name,\nExposedPorts: nat.PortSet{\n    \"8080/tcp\": struct{}{},\n},\nCmd : [] string {\"sh\",\"-c\",\"while true; do sleep always; done\",\"/bin/bash\"},\n}\n\nhost_config := &amp;container.HostConfig{\n     PortBindings: nat.PortMap{\n     \"8080/tcp\": []nat.PortBinding{\n         {\n             HostIP: \"0.0.0.0\",\n             HostPort: \"8989\",\n         },\n      },\n   },\n}\n\n\n  resp, err := cli.ContainerCreate(ctx,config,host_config, nil,\"\")\n  check(err)\n\n\n  if err := cli.ContainerStart(ctx, resp.ID, types.ContainerStartOptions{}); \n      err != nil {\n        panic(err)\n  }\n\n\n}\n</code></pre>\n\n<p>After Compiling this code I get the following error</p>\n\n<pre><code># command-line-arguments\nsrc\\main\\createcontainer1.go:53: cannot use \"github.com/docker/go-connections/nat\".PortSet literal (type \"github.com/docker/go-connections/nat\".PortSet) as type \"github.com/docker/docker/vendor/github.com/docker/go-connections/nat\".PortSet in field value\n\nsrc\\main\\createcontainer1.go:65: cannot use \"github.com/docker/go-connections/nat\".PortMap literal (type \"github.com/docker/go-connections/nat\".PortMap) as type \"github.com/docker/docker/vendor/github.com/docker/go-connections/nat\".PortMap in field value\n</code></pre>\n\n<p>If somebody knows what could be the problem and how to fix it.\nPlease answer to it as I am beginner with docker.  </p>\n"}, {"tags": ["rest", "post", "go", "webserver"], "answers": [{"comments": [{"owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 1, "creation_date": 1502092605, "post_id": 45541764, "comment_id": 78043634, "body": "<a href=\"https://golang.org/pkg/os/#OpenFile\" rel=\"nofollow noreferrer\">golang.org/pkg/os/#OpenFile</a> allows you to make more accurate mode management than other functions."}, {"owner": {"reputation": 601, "user_id": 1196540, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Ye9NT.jpg?s=128&g=1", "display_name": "vladimir", "link": "https://stackoverflow.com/users/1196540/vladimir"}, "edited": false, "score": 0, "creation_date": 1502092826, "post_id": 45541764, "comment_id": 78043765, "body": "ok, but how I can get file which I am sending to the server? because I can create file, but it&#39;s not the same which I am sending..."}], "tags": [], "owner": {"reputation": 46, "user_id": 8405576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2d8ddd45b366115240860dbe58f6269?s=128&d=identicon&r=PG", "display_name": "Fredrik M&#229;rlind", "link": "https://stackoverflow.com/users/8405576/fredrik-m%c3%a5rlind"}, "is_accepted": true, "score": 3, "last_activity_date": 1502094800, "last_edit_date": 1502094800, "creation_date": 1502091948, "answer_id": 45541764, "question_id": 45541656, "link": "https://stackoverflow.com/questions/45541656/golang-send-file-via-post-request/45541764#45541764", "title": "GoLang send file via POST request", "body": "<p><code>os.Open</code> will open a file, since the file doesn't exist you will get an error.\nUse <code>os.Create</code> instead it will create a new file and open it. (ref: <a href=\"https://golang.org/pkg/os/#Open\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#Open</a>)</p>\n\n<blockquote>\n  <p><strong>func Open</strong></p>\n  \n  <p><code>func Open(name string) (*File, error)</code> </p>\n  \n  <p>Open opens the named file for\n  reading. If successful, methods on the returned file can be used for\n  reading; the associated file descriptor has mode O_RDONLY. If there is\n  an error, it will be of type *PathError.</p>\n  \n  <p><strong>func Create</strong></p>\n  \n  <p><code>func Create(name string) (*File, error)</code></p>\n  \n  <p>Create creates the named file with mode 0666 (before umask),\n  truncating it if it already exists. If successful, methods on the\n  returned File can be used for I/O; the associated file descriptor has\n  mode O_RDWR. If there is an error, it will be of type *PathError.</p>\n</blockquote>\n\n<p><strong>EDIT</strong></p>\n\n<p>Made a new handler as an example:\nAnd also using OpenFile as mentioned by: <a href=\"https://stackoverflow.com/questions/45541656/golang-send-file-via-post-request/45541764?noredirect=1#comment78043634_45541764\">GoLang send file via POST request</a></p>\n\n<pre><code>func Upload(w http.ResponseWriter, r *http.Request) {\n    io.WriteString(w, \"Upload files\\n\")\n\n    file, handler, err := r.FormFile(\"file\")\n    if err != nil {\n        panic(err) //dont do this\n    }\n    defer file.Close()\n\n    // copy example\n    f, err := os.OpenFile(handler.Filename, os.O_WRONLY|os.O_CREATE, 0666)\n    if err != nil {\n        panic(err) //please dont\n    }\n    defer f.Close()\n    io.Copy(f, file)\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 4, "last_activity_date": 1502094163, "creation_date": 1502094163, "answer_id": 45542394, "question_id": 45541656, "link": "https://stackoverflow.com/questions/45541656/golang-send-file-via-post-request/45542394#45542394", "title": "GoLang send file via POST request", "body": "<p>The <code>multipart.Writer</code> <em>generates multipart messages</em>, this is not something you want to use for receiving a file from a client and saving it to disk.</p>\n\n<p>Assuming you're uploading the file from a client, e.g. a browser, with <code>Content-Type: application/x-www-form-urlencoded</code> you should use <a href=\"https://golang.org/pkg/net/http/#Request.FormFile\" rel=\"nofollow noreferrer\">FormFile</a> instead of <code>r.Form.Get</code> which returns a <code>*multipart.File</code> value that contains the content of the file the client sent and which you can use to write that content to disk with <code>io.Copy</code> or what not.</p>\n"}], "owner": {"reputation": 601, "user_id": 1196540, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Ye9NT.jpg?s=128&g=1", "display_name": "vladimir", "link": "https://stackoverflow.com/users/1196540/vladimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16765, "favorite_count": 2, "accepted_answer_id": 45541764, "answer_count": 2, "score": 7, "last_activity_date": 1502193418, "creation_date": 1502091615, "last_edit_date": 1502193418, "question_id": 45541656, "link": "https://stackoverflow.com/questions/45541656/golang-send-file-via-post-request", "title": "GoLang send file via POST request", "body": "<p>I am new in GoLang language, and I want to create REST API WebServer for file uploading...</p>\n\n<p>So I am stuck in main function (file uploading) via POST request to my server...</p>\n\n<p>I have this line for calling upload function</p>\n\n<pre><code>router.POST(\"/upload\", UploadFile)\n</code></pre>\n\n<p>and this is my upload function:</p>\n\n<pre><code>func UploadFile( w http.ResponseWriter, r *http.Request, _ httprouter.Params ) {\n    io.WriteString(w, \"Upload files\\n\")\n    postFile( r.Form.Get(\"file\"), \"/uploads\" )\n}\n\nfunc postFile(filename string, targetUrl string) error {\n    bodyBuf := &amp;bytes.Buffer{}\n    bodyWriter := multipart.NewWriter(bodyBuf)\n\n    // this step is very important\n    fileWriter, err := bodyWriter.CreateFormFile(\"file\", filename)\n    if err != nil {\n        fmt.Println(\"error writing to buffer\")\n        return err\n    }\n\n    // open file handle\n    fh, err := os.Open(filename)\n    if err != nil {\n        fmt.Println(\"error opening file\")\n        return err\n    }\n\n    //iocopy\n    _, err = io.Copy(fileWriter, fh)\n    if err != nil {\n        panic(err)\n    }\n\n    bodyWriter.FormDataContentType()\n    bodyWriter.Close()\n\n    return err\n\n}\n</code></pre>\n\n<p>but I can't see any uploaded files in my <code>/upload/</code> directory...</p>\n\n<p>So what am I doing wrong?</p>\n\n<p>P.S I am getting second error => <code>error opening file</code>, so I think something wrong in file uploading or getting file from <code>UploadFile</code> function, am I right? If yes, than how I can teancfer or get file from this function to <code>postFile</code> function?</p>\n"}, {"tags": ["string", "parsing", "go"], "answers": [{"comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 1, "creation_date": 1502095584, "post_id": 45539166, "comment_id": 78045269, "body": "Just a note: you could create the <code>Record</code> first and pass <code>&amp;rec.ID</code> and <code>&amp;rec.CliendID</code>, etc. to <code>fmt.Sscanf(...)</code> directly. You have fewer allocations that way."}, {"owner": {"reputation": 489, "user_id": 1401162, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/34ccb916234d4117540155fed4e4ce1c?s=128&d=identicon&r=PG&f=1", "display_name": "Vipercold", "link": "https://stackoverflow.com/users/1401162/vipercold"}, "edited": false, "score": 0, "creation_date": 1502135231, "post_id": 45539166, "comment_id": 78069162, "body": "@akond thank you for your response, i&#39;ll try this solution !"}, {"owner": {"reputation": 489, "user_id": 1401162, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/34ccb916234d4117540155fed4e4ce1c?s=128&d=identicon&r=PG&f=1", "display_name": "Vipercold", "link": "https://stackoverflow.com/users/1401162/vipercold"}, "edited": false, "score": 0, "creation_date": 1502138007, "post_id": 45539166, "comment_id": 78070535, "body": "@akond this line sometimes can be bigger than this single line.. i don&#39;t know if it will work in this scenario."}], "tags": [], "owner": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "is_accepted": true, "score": 5, "last_activity_date": 1502077960, "creation_date": 1502077960, "answer_id": 45539166, "question_id": 45538573, "link": "https://stackoverflow.com/questions/45538573/whats-a-good-way-to-parse-a-string-based-on-position-using-golang/45539166#45539166", "title": "What&#39;s a good way to parse a string based on position using golang?", "body": "<pre><code>var a, b int\nn, err := fmt.Sscanf(\"1003450020170804890000000022344\", \"%4d%3d\", &amp;a, &amp;b)\nif err != nil {\n   // ...\n}\n\nfmt.Println(a) // 1003\nfmt.Println(b) // 450\n</code></pre>\n\n<p>Then you could create a structure with these.</p>\n"}, {"tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": false, "score": 1, "last_activity_date": 1502078258, "creation_date": 1502078258, "answer_id": 45539197, "question_id": 45538573, "link": "https://stackoverflow.com/questions/45538573/whats-a-good-way-to-parse-a-string-based-on-position-using-golang/45539197#45539197", "title": "What&#39;s a good way to parse a string based on position using golang?", "body": "<p>A parse function is simple and probably sufficient, rather than declaring ancillary data structures.</p>\n\n<p>Eg, something along the lines of:</p>\n\n<pre><code>func NewRecord(line string) (*Record, error) {\n\n    if len(line) &lt; 14 {\n        return nil, fmt.Errorf(\"line is too short: %d\", len(line))\n    }\n\n    return &amp;Record{\n        Id:   line[0:4],\n        Name: line[4:14],\n    }, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 489, "user_id": 1401162, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/34ccb916234d4117540155fed4e4ce1c?s=128&d=identicon&r=PG&f=1", "display_name": "Vipercold", "link": "https://stackoverflow.com/users/1401162/vipercold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "accepted_answer_id": 45539166, "answer_count": 2, "score": 2, "last_activity_date": 1502078258, "creation_date": 1502072595, "question_id": 45538573, "link": "https://stackoverflow.com/questions/45538573/whats-a-good-way-to-parse-a-string-based-on-position-using-golang", "title": "What&#39;s a good way to parse a string based on position using golang?", "body": "<p>I'm designing an simple application using go to read a few file formats representing customers file formats. My first idea is to read each file line and then parse it to an struct. So far so good, but i need to split each field based on it's index. For example:</p>\n\n<pre><code>line := \"1003450020170804890000000022344\"\n</code></pre>\n\n<p>Id starts on position 1 to position 4 = 1003\nCustomerId is position 5 to 7 and all other fields related to that structure.</p>\n\n<p>I would like to know if there's something more efficient to read a format and apply to this file line, i thought to  create some struct for each field and have the start and end fields, but it sounds weird to me.</p>\n\n<pre><code>type Record struct {\nId       int\nDate     time.Time\nValue    float64\nClientId int32\n}\n\ntype RecordId struct {\n  Start  int\n  Finish int\n  Value  int\n}\n\ntype ClientId struct {\n  Start  int\n  Finish int\n  Value  int32\n}\n</code></pre>\n\n<p>I don't know if i'm on the way, maybe there's something more elegant that will work better on this case.</p>\n"}, {"tags": ["testing", "go", "mocking", "testify", "table-driven"], "answers": [{"comments": [{"owner": {"reputation": 751, "user_id": 3657373, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/baHlx.jpg?s=128&g=1", "display_name": "nitimalh", "link": "https://stackoverflow.com/users/3657373/nitimalh"}, "edited": false, "score": 0, "creation_date": 1502109575, "post_id": 45542325, "comment_id": 78053685, "body": "Thanks for the detailed response. What you are saying makes complete sense. In your opinion would a package like ginkgo or goconvey be a better option? Or is it possible to do this with idiomatic Go ?"}, {"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "reply_to_user": {"reputation": 751, "user_id": 3657373, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/baHlx.jpg?s=128&g=1", "display_name": "nitimalh", "link": "https://stackoverflow.com/users/3657373/nitimalh"}, "edited": false, "score": 0, "creation_date": 1502109851, "post_id": 45542325, "comment_id": 78053870, "body": "Personally I quite like <code>goconvey</code>, the web UI is useful for automatically running tests and the structured approach with nested Conveys made testing easier (until Go brought the idea of sub tests into V1.7). However, these are just tools, you can do all this with native Go. The important thing is how you design your code &amp; where you target your tests. I rarely use anything other than native Go when constructing a small stub/fake."}], "tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": true, "score": 6, "last_activity_date": 1502093892, "creation_date": 1502093892, "answer_id": 45542325, "question_id": 45537444, "link": "https://stackoverflow.com/questions/45537444/table-driven-tests-with-testify-mock/45542325#45542325", "title": "Table driven tests with testify mock", "body": "<p>Writing unit tests is relatively easy. <strong>Writing good unit tests is hard</strong>. This isn't helped because we are introduced to unit testing with trivial code examples that don't mimic real life usage.</p>\n\n<p>Try to avoid mocking unless you need to verify the invocations of a dependency. Prefer using stubs, fakes or real implementations. Knowing when to use each is a matter of experience and where the difficulty comes in. Also, think about your design. If you are finding it difficult to unit test, this could be because you need to redesign.</p>\n\n<p>Unit tests take time to write and maintain. You will always be quicker writing code without unit tests. However, we write unit tests to give us some assurance that our code works correctly and confidence to re-factor. </p>\n\n<p>Hence it's important to try to write the test against the behaviour (black box) instead of the implementation (white-box). This isn't always possible but unit tests that are tied to the implementation are fragile, discourage refactoring and can also sometimes mask unexpected behaviour.</p>\n\n<p>Some unit testing resources worth reading:</p>\n\n<ol>\n<li><a href=\"https://martinfowler.com/articles/mocksArentStubs.html\" rel=\"noreferrer\">Mocks Aren't Stubs</a></li>\n<li><a href=\"https://testing.googleblog.com/\" rel=\"noreferrer\">Testing on the Toilet Blog</a></li>\n<li><a href=\"https://www.infoq.com/presentations/tdd-original\" rel=\"noreferrer\">TDD - Where it all went wrong</a></li>\n</ol>\n\n<p>As way as an example, think of writing a unit test for a simple email address validator. We want to write a function that will take a string and return true/false based on whether a valid email address was supplied.</p>\n\n<p>A trivial example implementation would be:</p>\n\n<pre><code>var re = regexp.MustCompile(\"[regular expression]\")\nfunc ValidateEmail(s string) bool {\n   return re.MatchString(s)\n}\n</code></pre>\n\n<p>We would then write a table driven test with the various inputs, e.g. <code>\"\"</code>, <code>good@example.com</code>, <code>bad</code> etc and verify the result was correct.</p>\n\n<p>Now this is a bit of a trivial example but illustrates my point. One may argue that this is easy because the function has no dependencies but it does! We are relying on the regexp implementation and the regular expression we are passing it.</p>\n\n<p>This is testing the desired behaviour, not how we implement it. We don't care how it validates an email address, simply that it does. If we were to tweak the regular expression or completely change the implementation then none of this would <em>break</em> the tests unless the result was incorrect.</p>\n\n<p>Very few would suggest that we should isolate the dependency and test the validation function by mocking the regexp and ensuring that it is called with the regular expression we expect. This would be far more fragile but also less useful, i.e. how would we know the regular expression is actually going to work?</p>\n\n<hr>\n\n<p>For your specific example, you could easily avoid mocking &amp; use a trivial fake to test both normal results and the error cases. This would be something like:</p>\n\n<pre><code>// Used to test error result, \nvar errFail = errors.New(\"Failed\")\n\n// Fake type\ntype fakeD func(input int) (int, error)\n\n// Implements Dinterface\nfunc (f fakeD) DoSomethingWithD(input int) (int, error) {\n    return f(input)\n}\n\n// Fake implementation. Returns error on input 5, otherwise input * input\nvar fake fakeD = func(input int) (int, error) {\n    if input == 5 {\n        return nil, errFail\n    }\n    return input * input, nil\n}\n</code></pre>\n\n<p>Then simply use <code>fake</code> as your dependency and run your table based tests as normal. </p>\n"}], "owner": {"reputation": 751, "user_id": 3657373, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/baHlx.jpg?s=128&g=1", "display_name": "nitimalh", "link": "https://stackoverflow.com/users/3657373/nitimalh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2219, "favorite_count": 0, "accepted_answer_id": 45542325, "answer_count": 1, "score": 4, "last_activity_date": 1502093892, "creation_date": 1502060598, "last_edit_date": 1502062991, "question_id": 45537444, "link": "https://stackoverflow.com/questions/45537444/table-driven-tests-with-testify-mock", "title": "Table driven tests with testify mock", "body": "<p>Are there any examples of writing clean table driven tests using testify. A table driven test for input and expected output works well but having to test the output from a dependency seems to be really hard to do.</p>\n\n<p>The below example uses one mocked interface and requires me to write a whole new test function to verify the function under test handles dependency errors properly. \nI am only looking for suggestions to make writing unit tests with the testify mock package more streamlined. </p>\n\n<pre><code>package packageone\n\nimport (\n    \"errors\"\n    \"musings/packageone/mocks\"\n    \"testing\"\n)\n//Regular Table driven test\nfunc TestTstruct_DoSomething(t *testing.T) {\n    testObj := new(mocks.Dinterface)\n\n    passes := []struct {\n        Input  int\n        Output int\n    }{{0, 0}, {1, 1}, {2, 4}, {100, 10000}}\n\n    for _, i := range passes {\n        testObj.On(\"DoSomethingWithD\", i.Input).Return(i.Output, nil)\n    }\n\n    type fields struct {\n        DC Dinterface\n    }\n    type args struct {\n        i int\n    }\n    tests := []struct {\n        name    string\n        fields  fields\n        args    args\n        wantRes int\n        wantErr bool\n    }{\n        {\"Pass#0\", fields{testObj}, args{passes[0].Input}, passes[0].Output, false},\n        {\"Pass#1\", fields{testObj}, args{passes[1].Input}, passes[1].Output, false},\n        {\"Pass#2\", fields{testObj}, args{passes[2].Input}, passes[2].Output, false},\n        {\"Pass#3\", fields{testObj}, args{passes[3].Input}, passes[3].Output, false},\n        {\"Fail#4\", fields{testObj}, args{-1}, 0, true},\n    }\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            r := &amp;Tstruct{\n                DC: tt.fields.DC,\n            }\n            gotRes, err := r.DoSomething(tt.args.i)\n            if (err != nil) != tt.wantErr {\n                t.Errorf(\"Tstruct.DoSomething() error = %v, wantErr %v\", err, tt.wantErr)\n                return\n            }\n            if gotRes != tt.wantRes {\n                t.Errorf(\"Tstruct.DoSomething() = %v, want %v\", gotRes, tt.wantRes)\n            }\n        })\n    }\n}\n\n//Separate Unit test for dependency returning errors.\nfunc TestTstruct_ErrMock_DoSomething(t *testing.T) {\n    testObj := new(mocks.Dinterface)\n    testObj.On(\"DoSomethingWithD\", 1).Return(0, errors.New(\"\"))\n\n    type fields struct {\n        DC Dinterface\n    }\n    type args struct {\n        i int\n    }\n    tests := []struct {\n        name    string\n        fields  fields\n        args    args\n        wantRes int\n        wantErr bool\n    }{\n        {\"Test#1\", fields{testObj}, args{1}, 0, true},\n    }\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            r := &amp;Tstruct{\n                DC: tt.fields.DC,\n            }\n            gotRes, err := r.DoSomething(tt.args.i)\n            if (err != nil) != tt.wantErr {\n                t.Errorf(\"Tstruct.DoSomething() error = %v, wantErr %v\", err, tt.wantErr)\n                return\n            }\n            if gotRes != tt.wantRes {\n                t.Errorf(\"Tstruct.DoSomething() = %v, want %v\", gotRes, tt.wantRes)\n            }\n        })\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "arrays", "pointers", "go"], "comments": [{"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1502093579, "post_id": 45537320, "comment_id": 78044161, "body": "You have to use indexes in the array instead of pointers. What you get with this is boundary check of indexed access. This makes your Go program safer than the C code, though bit slower too. You may also use slices, which can make your code more readable."}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 2, "last_activity_date": 1502060542, "creation_date": 1502060542, "answer_id": 45537434, "question_id": 45537320, "link": "https://stackoverflow.com/questions/45537320/converting-c-array-and-pointer-code-to-go/45537434#45537434", "title": "Converting C array and pointer code to Go", "body": "<p>You want to be slicing <code>r</code> and <code>a</code>, which you can do in the following way:</p>\n\n<pre><code>func func1(r []byte) {\n    for i := 0; i &lt; CONSTANT; i++ {\n        func2(r[i*OTHER_CONSTANT:])\n    }\n}\nfunc func2(a []byte) {\n    for i := 0; i &lt; CONSTANT; i += 8 {\n        // do some stuff\n        a = a[3:]\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 1, "last_activity_date": 1502060599, "creation_date": 1502060599, "answer_id": 45537445, "question_id": 45537320, "link": "https://stackoverflow.com/questions/45537320/converting-c-array-and-pointer-code-to-go/45537445#45537445", "title": "Converting C array and pointer code to Go", "body": "<p>Go does not have pointer arithmetic:</p>\n\n<p><a href=\"https://golang.org/doc/faq#no_pointer_arithmetic\" rel=\"nofollow noreferrer\">https://golang.org/doc/faq#no_pointer_arithmetic</a></p>\n\n<p>So you should just work with indexes that point to positions on the array, and slices to get parts of the array:</p>\n\n<pre><code>func func1(r []byte) {\n    rIndex := 0\n    for i := 0; i &lt; CONSTANT; i++ {\n        func2(r[rIndex + i*OTHER_CONSTANT:])\n    }\n}\n</code></pre>\n\n<p>And:</p>\n\n<pre><code>func func2(a []byte) {\n    aIndex := 0\n    for i := 0; i &lt; CONSTANT; i += 8 {\n        // do some stuff\n        aIndex += 3\n        // use a[aIndex] when needed\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3242, "user_id": 6360938, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/ae1e709f8e8beb1d09db43a881c97610?s=128&d=identicon&r=PG&f=1", "display_name": "typos", "link": "https://stackoverflow.com/users/6360938/typos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 45537434, "answer_count": 2, "score": 1, "last_activity_date": 1502060599, "creation_date": 1502059490, "question_id": 45537320, "link": "https://stackoverflow.com/questions/45537320/converting-c-array-and-pointer-code-to-go", "title": "Converting C array and pointer code to Go", "body": "<p>I'm trying to rewrite a C code in Go, and what I notice is that the code that I try to rewrite follows a lot one common pattern. Many of the functions accept <code>unsigned char</code> arrays, passed as pointer, and either when calling the functions or at some other part of the function we add some value to the <code>char</code> pointer, as doing arithmetic. Here is a simple example just for demonstration purposes.</p>\n\n<pre><code>static void func1(unsigned char *r) {\n    int i;\n    for (i = 0; i &lt; CONSTANT; i++)\n        func2(r + i * OTHER_CONSTANT);\n}\n\nstatic void func2(const unsigned char *a) {\n    unsigned int i;\n    for (i = 0; i &lt; CONSTANT; i += 8) {\n        // do some stuff\n        a += 3;\n    }\n}\n</code></pre>\n\n<p>What is a proper way to convert something like this to Go? I started to use <code>byte</code> slices in order to represent the <code>char</code> arrays, but I don't know how to exactly transfer those arithmetic expression with <code>char</code> into arithmetic with ranges/indexes in Go. I ended up having something like this:</p>\n\n<pre><code>func func1(r []byte) {\n    for i := 0; i &lt; CONSTANT; i++ {\n        func2(r + i*OTHER_CONSTANT) // This just doesn't work\n    }\n}\nfunc func2(a []byte) {\n    for i := 0; i &lt; CONSTANT; i += 8 {\n        // do some stuff\n        a += 3 // This doesn't work\n    }\n}\n</code></pre>\n\n<p>Any idea how to convert something like above from C to Go?</p>\n"}, {"tags": ["http", "go", "request"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1502058312, "post_id": 45537134, "comment_id": 78034390, "body": "It looks like you&#39;re using an OAuth2 system. Perhaps you should use the authorization code grant, rather than implicit."}, {"owner": {"reputation": 85, "user_id": 7187541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f72e78bb26a0fdd1eaa3141a8565b187?s=128&d=identicon&r=PG", "display_name": "SimplySerenity", "link": "https://stackoverflow.com/users/7187541/simplyserenity"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1502069532, "post_id": 45537134, "comment_id": 78036574, "body": "@TimCooper Maybe I should have been a little clearer the app is actually run locally on the users computer, and just opens an http server to capture the redirect with the token."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1502079443, "post_id": 45537134, "comment_id": 78038638, "body": "&quot;So I&#39;m receiving a request to my server that looks a little something like this <code>http:&#47;&#47;localhost:8080&#47;#access_token</code>&quot;. No your are not. Fragments are not sent and thus not received."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1502124837, "post_id": 45537134, "comment_id": 78063759, "body": "Fix the client to send the stuff after the <code>#</code> after a <code>?</code> instead. It&#39;s not really a server side problem, just a bad client failing to use HTTP appropriately."}], "answers": [{"tags": [], "owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "is_accepted": true, "score": 6, "last_activity_date": 1502057917, "creation_date": 1502057917, "answer_id": 45537161, "question_id": 45537134, "link": "https://stackoverflow.com/questions/45537134/parse-a-url-with-in-go/45537161#45537161", "title": "Parse a url with # in GO", "body": "<p>Anchor part is not even (generally) sent by a client to the server.</p>\n\n<p>Eg, browsers don't send it.</p>\n"}, {"comments": [{"owner": {"reputation": 85, "user_id": 7187541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f72e78bb26a0fdd1eaa3141a8565b187?s=128&d=identicon&r=PG", "display_name": "SimplySerenity", "link": "https://stackoverflow.com/users/7187541/simplyserenity"}, "edited": false, "score": 2, "creation_date": 1502070099, "post_id": 45537414, "comment_id": 78036686, "body": "Thank you for your response, but unfortunately (at least as far as I can tell) I don&#39;t actually have access to the full URL from the server request.   I have a function that is being called on any request to &quot;/&quot;, but the URL fragments seem to be completely empty when the function is called."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 85, "user_id": 7187541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f72e78bb26a0fdd1eaa3141a8565b187?s=128&d=identicon&r=PG", "display_name": "SimplySerenity", "link": "https://stackoverflow.com/users/7187541/simplyserenity"}, "edited": false, "score": 0, "creation_date": 1502110983, "post_id": 45537414, "comment_id": 78054639, "body": "@SimplySerenity that&#39;s to be expected. The anchor portion of a URL is client-side only and should not be sent to the server."}, {"owner": {"reputation": 349, "user_id": 351590, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5abf2171b593d81df74739f84ab6bb3d?s=128&d=identicon&r=PG", "display_name": "Yusuf", "link": "https://stackoverflow.com/users/351590/yusuf"}, "edited": false, "score": 1, "creation_date": 1602489967, "post_id": 45537414, "comment_id": 113726032, "body": "This helped me in the case of a <a href=\"https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow#logindialog\" rel=\"nofollow noreferrer\">manual login flow</a> for a Desktop app, where I&#39;m using a <a href=\"https://github.com/webview/webview\" rel=\"nofollow noreferrer\">webview</a> to open the login url and then parsing the fragment in the redirect. Thank you!"}], "tags": [], "owner": {"reputation": 628, "user_id": 3827248, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DafxY.jpg?s=128&g=1", "display_name": "Alberto Souza", "link": "https://stackoverflow.com/users/3827248/alberto-souza"}, "is_accepted": false, "score": 3, "last_activity_date": 1502060319, "creation_date": 1502060319, "answer_id": 45537414, "question_id": 45537134, "link": "https://stackoverflow.com/questions/45537134/parse-a-url-with-in-go/45537414#45537414", "title": "Parse a url with # in GO", "body": "<p>For parse urls use the golang <strong>net/url</strong> package: <a href=\"https://golang.org/pkg/net/url/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/url/</a></p>\n\n<p>OBS: You should use the Authorization header for send auth tokens.</p>\n\n<p>Example code with extracted data from your example url:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"net\"\n  \"net/url\"\n)\n\nfunc main() {\n    // Your url with hash\n    s := \"http://localhost:8080/#access_token=tokenhere&amp;scope=scopeshere\"\n    // Parse the URL and ensure there are no errors.\n    u, err := url.Parse(s)\n    if err != nil {\n        panic(err)\n    }\n\n    // ---&gt; here is where you will get the url hash #\n    fmt.Println(u.Fragment)\n    fragments, _ := url.ParseQuery(u.Fragment)\n    fmt.Println(\"Fragments:\", fragments)\n    if fragments[\"access_token\"] != nil {\n      fmt.Println(\"Access token:\", fragments[\"access_token\"][0])\n    } else {\n      fmt.Println(\"Access token not found\")\n    }\n\n\n    // ---&gt; Others data get from URL:\n     fmt.Println(\"\\n\\nOther data:\\n\")\n    // Accessing the scheme is straightforward.\n    fmt.Println(\"Scheme:\", u.Scheme)\n    // The `Host` contains both the hostname and the port,\n    // if present. Use `SplitHostPort` to extract them.\n    fmt.Println(\"Host:\", u.Host)\n    host, port, _ := net.SplitHostPort(u.Host)\n    fmt.Println(\"Host without port:\", host)\n    fmt.Println(\"Port:\",port)\n    // To get query params in a string of `k=v` format,\n    // use `RawQuery`. You can also parse query params\n    // into a map. The parsed query param maps are from\n    // strings to slices of strings, so index into `[0]`\n    // if you only want the first value.\n    fmt.Println(\"Raw query:\", u.RawQuery)\n    m, _ := url.ParseQuery(u.RawQuery)\n    fmt.Println(m)\n}\n\n// part of this code was get from: https://gobyexample.com/url-parsing\n</code></pre>\n"}], "owner": {"reputation": 85, "user_id": 7187541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f72e78bb26a0fdd1eaa3141a8565b187?s=128&d=identicon&r=PG", "display_name": "SimplySerenity", "link": "https://stackoverflow.com/users/7187541/simplyserenity"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5790, "favorite_count": 0, "accepted_answer_id": 45537161, "answer_count": 2, "score": 4, "last_activity_date": 1502224980, "creation_date": 1502057678, "last_edit_date": 1502224980, "question_id": 45537134, "link": "https://stackoverflow.com/questions/45537134/parse-a-url-with-in-go", "title": "Parse a url with # in GO", "body": "<p>So I'm receiving a request to my server that looks a little something like this</p>\n\n<pre><code>http://localhost:8080/#access_token=tokenhere&amp;scope=scopeshere\n</code></pre>\n\n<p>and I can't seem to find a way to parse the token from the url.</p>\n\n<p>If the # were a ? I could just parse it a standard query param.</p>\n\n<p>I tried to just getting everything after the / and even the full URL, but with no luck.</p>\n\n<p>Any help is greatly appreciated.</p>\n\n<p>edit: </p>\n\n<p>So I've solved the issue now, and the correct answer is you can't really do it in GO. So I made a simple package that will do it on the browser side and then send the token back to the server. </p>\n\n<p>Check it out if you're trying to do local twitch API stuff in GO:</p>\n\n<p><a href=\"https://github.com/SimplySerenity/twitchOAuth\" rel=\"nofollow noreferrer\">https://github.com/SimplySerenity/twitchOAuth</a></p>\n"}, {"tags": ["nginx", "go", "web-deployment"], "answers": [{"tags": [], "owner": {"reputation": 2060, "user_id": 3625058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PEy9i.jpg?s=128&g=1", "display_name": "matanco", "link": "https://stackoverflow.com/users/3625058/matanco"}, "is_accepted": false, "score": 1, "last_activity_date": 1502052949, "creation_date": 1502052949, "answer_id": 45536561, "question_id": 45536166, "link": "https://stackoverflow.com/questions/45536166/deploying-multiple-go-applications-using-nginx/45536561#45536561", "title": "Deploying multiple Go applications using Nginx", "body": "<p>Well is really easy.</p>\n\n<p>follow this guide:</p>\n\n<p><a href=\"https://www.digitalocean.com/community/tutorials/how-to-use-martini-to-serve-go-applications-behind-an-nginx-server-on-ubuntu\" rel=\"nofollow noreferrer\">https://www.digitalocean.com/community/tutorials/how-to-use-martini-to-serve-go-applications-behind-an-nginx-server-on-ubuntu</a></p>\n\n<p>After you achieved one application working with martini+nginx just add another <code>server</code> block for the other app.</p>\n\n<p>In case you need more information about server blocks:</p>\n\n<p><a href=\"https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-14-04-lts\" rel=\"nofollow noreferrer\">https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-14-04-lts</a></p>\n"}, {"comments": [{"owner": {"reputation": 873, "user_id": 5303460, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7370b6d79ff8a15cedc2c69fc9c71e3b?s=128&d=identicon&r=PG", "display_name": "Tural Asgar", "link": "https://stackoverflow.com/users/5303460/tural-asgar"}, "edited": false, "score": 0, "creation_date": 1502103737, "post_id": 45541753, "comment_id": 78050147, "body": "Shall I write the same server ip to both domain? And if so then Nginx will realize which domain comes from and accordingly it will map?"}, {"owner": {"reputation": 873, "user_id": 5303460, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7370b6d79ff8a15cedc2c69fc9c71e3b?s=128&d=identicon&r=PG", "display_name": "Tural Asgar", "link": "https://stackoverflow.com/users/5303460/tural-asgar"}, "edited": false, "score": 0, "creation_date": 1502108977, "post_id": 45541753, "comment_id": 78053306, "body": "And when I copy the code you have given I got this error.  <code>Job for nginx.service failed because the control process exited with error code. See &quot;systemctl status nginx.service&quot; and &quot;journalctl -xe&quot; for details.</code>"}, {"owner": {"reputation": 363, "user_id": 5040388, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-smIq4fgpQ34/AAAAAAAAAAI/AAAAAAAAABE/e5qpViT4k8Y/photo.jpg?sz=128", "display_name": "tetafro", "link": "https://stackoverflow.com/users/5040388/tetafro"}, "reply_to_user": {"reputation": 873, "user_id": 5303460, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7370b6d79ff8a15cedc2c69fc9c71e3b?s=128&d=identicon&r=PG", "display_name": "Tural Asgar", "link": "https://stackoverflow.com/users/5303460/tural-asgar"}, "edited": false, "score": 1, "creation_date": 1502112968, "post_id": 45541753, "comment_id": 78056079, "body": "Both DNS must have the same IP. Requests that came to the turalasgar.pro will go to <a href=\"http://localhost:8080\" rel=\"nofollow noreferrer\">localhost:8080</a>. Requests that came to the engossip.com will go to <a href=\"http://localhost:8081\" rel=\"nofollow noreferrer\">localhost:8081</a>."}, {"owner": {"reputation": 363, "user_id": 5040388, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-smIq4fgpQ34/AAAAAAAAAAI/AAAAAAAAABE/e5qpViT4k8Y/photo.jpg?sz=128", "display_name": "tetafro", "link": "https://stackoverflow.com/users/5040388/tetafro"}, "reply_to_user": {"reputation": 873, "user_id": 5303460, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7370b6d79ff8a15cedc2c69fc9c71e3b?s=128&d=identicon&r=PG", "display_name": "Tural Asgar", "link": "https://stackoverflow.com/users/5303460/tural-asgar"}, "edited": false, "score": 1, "creation_date": 1502113432, "post_id": 45541753, "comment_id": 78056393, "body": "@tural-\u018fsg\u0259rov maybe you forgot to replace <code>...</code> with the actual config values? You can find the docs <a href=\"https://www.nginx.com/resources/admin-guide/reverse-proxy/\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 873, "user_id": 5303460, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7370b6d79ff8a15cedc2c69fc9c71e3b?s=128&d=identicon&r=PG", "display_name": "Tural Asgar", "link": "https://stackoverflow.com/users/5303460/tural-asgar"}, "edited": false, "score": 0, "creation_date": 1502175554, "post_id": 45541753, "comment_id": 78081884, "body": "Thank you very much for your help."}], "tags": [], "owner": {"reputation": 363, "user_id": 5040388, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-smIq4fgpQ34/AAAAAAAAAAI/AAAAAAAAABE/e5qpViT4k8Y/photo.jpg?sz=128", "display_name": "tetafro", "link": "https://stackoverflow.com/users/5040388/tetafro"}, "is_accepted": true, "score": 6, "last_activity_date": 1502091918, "creation_date": 1502091918, "answer_id": 45541753, "question_id": 45536166, "link": "https://stackoverflow.com/questions/45536166/deploying-multiple-go-applications-using-nginx/45541753#45541753", "title": "Deploying multiple Go applications using Nginx", "body": "<p>It's called reverse proxy. Each application uses it's own port to listen. And then you just point to them in nginx config:</p>\n\n<pre><code>server {\n    listen 80;\n    server_name turalasgar.pro;\n    location / {\n        proxy_pass http://localhost:8080;\n        ...\n    }\n}\n\nserver {\n    listen 80;\n    server_name engossip.com;\n    location / {\n        proxy_pass http://localhost:8081;\n        ...\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2616, "user_id": 7315571, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-C8dAsYpg5v8/AAAAAAAAAAI/AAAAAAAAABk/uIO80hOS1vk/photo.jpg?sz=128", "display_name": "Prinkal Kumar", "link": "https://stackoverflow.com/users/7315571/prinkal-kumar"}, "is_accepted": false, "score": 0, "last_activity_date": 1618486908, "creation_date": 1618486908, "answer_id": 67107775, "question_id": 45536166, "link": "https://stackoverflow.com/questions/45536166/deploying-multiple-go-applications-using-nginx/67107775#67107775", "title": "Deploying multiple Go applications using Nginx", "body": "<p>Above solutions I tried but didn't work for me</p>\n<blockquote>\n<p><a href=\"https://gist.github.com/soheilhy/8b94347ff8336d971ad0\" rel=\"nofollow noreferrer\">https://gist.github.com/soheilhy/8b94347ff8336d971ad0</a></p>\n</blockquote>\n<pre><code>server {\nlisten       ...;\n...\nlocation / {\n    proxy_pass http://127.0.0.1:8080;\n}\n\nlocation /blog {\n    rewrite ^/blog(.*) /$1 break;\n    proxy_pass http://127.0.0.1:8181;\n}\n\nlocation /mail {\n    rewrite ^/mail(.*) /$1 break;\n    proxy_pass http://127.0.0.1:8282;\n}\n...\n</code></pre>\n<p>}</p>\n"}], "owner": {"reputation": 873, "user_id": 5303460, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7370b6d79ff8a15cedc2c69fc9c71e3b?s=128&d=identicon&r=PG", "display_name": "Tural Asgar", "link": "https://stackoverflow.com/users/5303460/tural-asgar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1806, "favorite_count": 1, "accepted_answer_id": 45541753, "answer_count": 3, "score": 0, "last_activity_date": 1618486908, "creation_date": 1502050198, "question_id": 45536166, "link": "https://stackoverflow.com/questions/45536166/deploying-multiple-go-applications-using-nginx", "title": "Deploying multiple Go applications using Nginx", "body": "<p>The are two web applications (websites) written on Go. One is turalasgar.pro (here I am using Go built-in server). Another is engossip.com (for now it displays the same ip as former). I have a vps. I know I should use Nginx, but have no idea how? I have heard of Caddy. Please, I need only nginx server, not Caddy. What I need is run two (or more) applications by using my same vps. How should I configure Nginx configuration? Whether by listening to different ports or to the same port. Practical advices and examples highly appreciated.</p>\n"}, {"tags": ["angularjs", "http", "post", "go", "call"], "answers": [{"comments": [{"owner": {"reputation": 2574, "user_id": 11262373, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/168c8af27935ff2587e1a3e9804b5958?s=128&d=identicon&r=PG&f=1", "display_name": "BT101", "link": "https://stackoverflow.com/users/11262373/bt101"}, "edited": false, "score": 0, "creation_date": 1502051737, "post_id": 45536307, "comment_id": 78032775, "body": "Thank you Dario it was the problem indeed."}], "tags": [], "owner": {"reputation": 5420, "user_id": 1407939, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/be9333ffe4ada8a5de0b658f764439da?s=128&d=identicon&r=PG", "display_name": "Dario", "link": "https://stackoverflow.com/users/1407939/dario"}, "is_accepted": true, "score": 0, "last_activity_date": 1502051340, "creation_date": 1502051340, "answer_id": 45536307, "question_id": 45536116, "link": "https://stackoverflow.com/questions/45536116/angular-http-post-call-passing-data-issue-to-go-backend/45536307#45536307", "title": "Angular $http post call passing data issue to GO backend", "body": "<p>You are sending some json data with the wrong <code>Content-Type</code>.\nI see 2 options, either change <code>Content-Type</code> in your header to:</p>\n\n<p><code>'Content-type' : 'application/json'</code></p>\n\n<p>or transform your payload to:</p>\n\n<pre><code>data: \"email=check@onet.pl&amp;nick=borysxoxo&amp;password=admin12312&amp;password_confirmation=admin12312\"\n</code></pre>\n"}], "owner": {"reputation": 2574, "user_id": 11262373, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/168c8af27935ff2587e1a3e9804b5958?s=128&d=identicon&r=PG&f=1", "display_name": "BT101", "link": "https://stackoverflow.com/users/11262373/bt101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 302, "favorite_count": 0, "accepted_answer_id": 45536307, "answer_count": 1, "score": 0, "last_activity_date": 1502051340, "creation_date": 1502049794, "last_edit_date": 1592644375, "question_id": 45536116, "link": "https://stackoverflow.com/questions/45536116/angular-http-post-call-passing-data-issue-to-go-backend", "title": "Angular $http post call passing data issue to GO backend", "body": "<p>I am trying to get access to backend written in GO which in 99% is good (problem does not lay there).</p>\n<p>For now I just created simplest call which stay in controller (it will be in service in future) to register new user. Although I hardcoded data which I am passing the response says 403 forbidden. In powerShell shows reason of 403:</p>\n<blockquote>\n<p>RegistrationForm parse - email: , nick:</p>\n<p>Validation failed for email - blank</p>\n</blockquote>\n<p>It looks like I am not passing my data correctly because email is blank. Please take a look at my code:</p>\n<pre><code>$ctrl.fake_registerSubmit = function() {\n\n    $http({\n        url: 'http://localhost:3000/v1/sign_up',\n        headers: {\n           'Content-Type': 'application/x-www-form-urlencoded'\n         },\n        method: 'POST',\n        data: {\n            email: 'check@onet.pl',\n            nick: 'borysxoxo',\n            password: 'admin12312',\n            password_confirmation: 'admin12312'\n        }\n    })\n\n    .then(function successCall(response, post) {\n        console.log('user added');\n\n    }, function errorCall(respone) {\n        console.log('error callback');\n        console.log(respone);\n    })\n\n};\n</code></pre>\n<p>This screenshot presents API documentation which I am trying to access:</p>\n<p><a href=\"https://i.stack.imgur.com/Cy4AD.png\" rel=\"nofollow noreferrer\">link</a></p>\n<p>What am I doing wrong? Is there other way to pass data?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 1, "creation_date": 1502042985, "post_id": 45534941, "comment_id": 78030143, "body": "Looks like US is the default."}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 5362, "user_id": 2430669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2656586be6c90ef0666a391f1114628b?s=128&d=identicon&r=PG", "display_name": "Micha&#235;l Roy", "link": "https://stackoverflow.com/users/2430669/micha%c3%abl-roy"}, "edited": false, "score": 1, "creation_date": 1502044899, "post_id": 45534941, "comment_id": 78030712, "body": "that&#39;s my question...I don&#39;t see where in the code it says that and why they do that."}], "answers": [{"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 0, "last_activity_date": 1502048736, "last_edit_date": 1502048736, "creation_date": 1502047878, "answer_id": 45535827, "question_id": 45534941, "link": "https://stackoverflow.com/questions/45534941/why-is-the-region-for-an-empty-language-us/45535827#45535827", "title": "Why is the region for an empty language &quot;US&quot;?", "body": "<p>If you look at the source code for the method <a href=\"https://github.com/golang/text/blob/master/language/language.go#L452\" rel=\"nofollow noreferrer\">tag{}.Region()</a> you'll see that if region is not specified it tries to add tags and sets the likelihood to low. <a href=\"https://github.com/golang/text/blob/2bf8f2a19ec09c670e931282edfe6567f6be21c9/language/match.go\" rel=\"nofollow noreferrer\">addTags()</a> If you look at the implementation for addTags() you'll see</p>\n\n<pre><code>if t.lang == 0 {\n  t.lang = _en // default language\n}\n</code></pre>\n\n<p>where the default language is set to English. Cheers.</p>\n"}, {"tags": [], "owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "is_accepted": false, "score": 0, "last_activity_date": 1502050301, "last_edit_date": 1502050301, "creation_date": 1502048934, "answer_id": 45535975, "question_id": 45534941, "link": "https://stackoverflow.com/questions/45534941/why-is-the-region-for-an-empty-language-us/45535975#45535975", "title": "Why is the region for an empty language &quot;US&quot;?", "body": "<p>If tag's language is not defined (zero by default), then it just get the first value from <code>likelyLang</code> <a href=\"https://github.com/golang/text/blob/master/language/match.go#L220\" rel=\"nofollow noreferrer\">array</a>.</p>\n\n<pre><code>    x := likelyLang[t.lang]\n    ...\n    if x.region != 0 {\n        t.setUndefinedScript(scriptID(x.script))\n        t.setUndefinedRegion(regionID(x.region))\n    }\n</code></pre>\n\n<p>And it has <a href=\"https://github.com/golang/text/blob/master/language/tables.go#L1002\" rel=\"nofollow noreferrer\">_US</a> (0x134) region code (surprise). After that it copies region to the input tag.</p>\n\n<p>P.S. @reticentroot's answer is about the same. Didn't see it during investigation.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 45535827, "answer_count": 2, "score": 2, "last_activity_date": 1502491655, "creation_date": 1502041877, "last_edit_date": 1502491655, "question_id": 45534941, "link": "https://stackoverflow.com/questions/45534941/why-is-the-region-for-an-empty-language-us", "title": "Why is the region for an empty language &quot;US&quot;?", "body": "<p>I am using the official/unofficial language package and have this:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n\n    \"golang.org/x/text/language\"\n)\n\nfunc main() {\n    reg, _ := language.Tag{}.Region()\n    log.Println(reg.Canonicalize()) // US\n}\n</code></pre>\n\n<p>I was expecting \"ZZ\". Why is it \"US\"? I can't find anything in the documentation.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "edited": false, "score": 0, "creation_date": 1609618594, "post_id": 45534897, "comment_id": 115880597, "body": "This was arguably the best design decision of the Go language in my opinion. So many bugs avoided"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 22, "last_activity_date": 1502053372, "last_edit_date": 1502053372, "creation_date": 1502041639, "answer_id": 45534897, "question_id": 45534885, "link": "https://stackoverflow.com/questions/45534885/non-bool-value-in-if-condition-in-go/45534897#45534897", "title": "non-bool value in if condition in Go", "body": "<p>If statements in Go <a href=\"https://golang.org/ref/spec#If_statements\" rel=\"noreferrer\">must have type of <code>bool</code></a>, which you can achieve by using a <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"noreferrer\">comparison operator</a>, the result of which is a bool:</p>\n\n<pre><code>if level&amp;1 != 0 {\n    // do something\n} else {\n    // do something else\n}\n</code></pre>\n"}], "owner": {"reputation": 3242, "user_id": 6360938, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/ae1e709f8e8beb1d09db43a881c97610?s=128&d=identicon&r=PG&f=1", "display_name": "typos", "link": "https://stackoverflow.com/users/6360938/typos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4797, "favorite_count": 1, "accepted_answer_id": 45534897, "answer_count": 1, "score": 10, "last_activity_date": 1502053372, "creation_date": 1502041589, "question_id": 45534885, "link": "https://stackoverflow.com/questions/45534885/non-bool-value-in-if-condition-in-go", "title": "non-bool value in if condition in Go", "body": "<p>I have an if statement in Go which looks like this:</p>\n\n<pre><code>if level &amp; 1 {\n    // do something\n} else {\n    // do something else\n}\n</code></pre>\n\n<p>The <code>level</code> variable in my cause is of type <code>uint</code>. But when I do bitwise AND with 1, the result is not a boolean. This is a valid syntax for C, but apparently it doesn't work in Go. Any idea how to work around this?</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 365, "user_id": 2130607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6423be6ad9f861ddba9f1f1016cf2b4?s=128&d=identicon&r=PG", "display_name": "Kebeng", "link": "https://stackoverflow.com/users/2130607/kebeng"}, "edited": false, "score": 2, "creation_date": 1502041434, "post_id": 45534750, "comment_id": 78029664, "body": "the S3 struct and File struct has diferent return obj type, try to make both of them return the same type obj by using interface as the return. and don&#39;t forget use pointer when returning struct as an interface."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1502041492, "post_id": 45534750, "comment_id": 78029680, "body": "Go does not have covariance."}, {"owner": {"reputation": 836, "user_id": 3165535, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f693f2c6c6f0a65f824bb6ff36edfb04?s=128&d=identicon&r=PG", "display_name": "xxorde", "link": "https://stackoverflow.com/users/3165535/xxorde"}, "reply_to_user": {"reputation": 365, "user_id": 2130607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6423be6ad9f861ddba9f1f1016cf2b4?s=128&d=identicon&r=PG", "display_name": "Kebeng", "link": "https://stackoverflow.com/users/2130607/kebeng"}, "edited": false, "score": 0, "creation_date": 1502046294, "post_id": 45534750, "comment_id": 78031101, "body": "@Kebeng I do not mind to get a copy of the object here so a pointer is not necessary. And making them the &quot;same type&quot; is the point here."}], "answers": [{"tags": [], "owner": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "is_accepted": false, "score": 2, "last_activity_date": 1502053915, "creation_date": 1502053915, "answer_id": 45536682, "question_id": 45534750, "link": "https://stackoverflow.com/questions/45534750/golang-api-interface-what-am-i-missing/45536682#45536682", "title": "golang API interface, what am I missing?", "body": "<p>I like what you're doing here and I've actually worked on projects that involved very similar design challenges, so I hope my suggestions can help you out some.</p>\n\n<p>In order to satisfy the interface, you'd need to update your code from...</p>\n\n<pre><code>// New returns a new S3\nfunc (S3) New() (newS3 S3) {\n    newS3 = S3{}\n    return newS3\n}\n</code></pre>\n\n<p>to this</p>\n\n<pre><code>// New returns a new S3\nfunc (S3) New() (newS3 Storage) {\n    newS3 = S3{}\n    return newS3\n}\n</code></pre>\n\n<p>This means you will receive an instance of Storage back, so to speak. If you want to then access anything from S3 without having to use <a href=\"https://tour.golang.org/methods/16\" rel=\"nofollow noreferrer\">type assertion</a>, it would be best to expose that S3 function/method in the interface.</p>\n\n<p>So let's say you want a way to List your objects in your S3 client. A good approach to supporting this would be to update Storage interface to include List, and update S3 so it has its own implementation of List:</p>\n\n<pre><code>// Storage is an interface to describe storage backends\ntype Storage interface {\n    New() (newStorage Storage)\n    List() ([]entry, error) // or however you would prefer to trigger List\n}\n\n...\n\n// New returns a new S3\nfunc (S3) List() ([] entry, error) {\n    // initialize \"entry\" slice\n    // do work, looping through pages or something\n    // return entry slice and error if one exists\n}\n</code></pre>\n\n<p>When it comes time to add support for Google Cloud Storage, Rackspace Cloud Files, Backblaze B2, or any other object storage provider, each of them will also need to implement List() ([] entry, error) as well - which is good! Once you've used this List function in the way you need, adding more clients/providers will be more like developing plugins than actually writing/architecting code (since your design is complete by that point).</p>\n\n<p>The real key with satisfying interfaces is to have the signature match exactly and think of interfaces as a list of common functions/methods that you'd want every storage provider type to handle in order to meet your goals.</p>\n\n<p>If you have any questions or if anything I've written is unclear, please comment and I'll be happy to clarify or adjust my post :)</p>\n"}, {"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 3, "last_activity_date": 1502062316, "creation_date": 1502062316, "answer_id": 45537620, "question_id": 45534750, "link": "https://stackoverflow.com/questions/45534750/golang-api-interface-what-am-i-missing/45537620#45537620", "title": "golang API interface, what am I missing?", "body": "<p>This code does not make sense at all. You are either implementing a factory pattern which is tied to a struct which is of the type the factory is going to produce or you are reinventing the wheel in a wrong way by reimplementing the already existing <a href=\"https://golang.org/pkg/builtin/#new\" rel=\"nofollow noreferrer\"><strong><code>new</code></strong></a> keyword and tie it to a struct which is <code>nil</code> the time you would use it.</p>\n\n<p>You can either get rid of the helper function and simply use</p>\n\n<pre><code>s := new(S3)\nf := new (File)\n</code></pre>\n\n<p>Or you could use a static Factory function like:</p>\n\n<pre><code>// Do NOT tie your Factory to your type\nfunction New() S3 {\n  return S3{}\n}\n</code></pre>\n\n<p>Or, which seems to better suit your use case, create a factory interface, implement it and have its <code>New()</code> function return a <code>Storage</code> instance:</p>\n\n<pre><code>type StorageFactory interface {\n  New() Storage\n}\n\ntype S3Factory struct {}\n\nfunction (f *S3Factory) New() Storage {\n  return S3{}\n}\n</code></pre>\n\n<p>There are various ways of registering your factory. You could use a global var and init </p>\n\n<pre><code>import \"example.com/foo/storage/s3\"\n\ntype FactoryGetter func() StorageFactory\ntype FactoryRegistry map[string] FactoryGetter\n\n// Registry will be updated by an init function in the storage provider packages\nvar Registry FactoryRegistry\n\nfunc init(){\n  Registry = make(map[string] FactoryGetter)\n}\n\n// For the sake of shortness, a const. Make it abflag, for example\nconst storageProvider = \"s3\"\n\nfunc main(){\n  f := Registry[storageProvider]()\n  s := f.New()\n  s.List()\n}\n</code></pre>\n\n<p>And somewhere in the S3 package </p>\n\n<pre><code>func init() {\n  Registry[\"s3\"] = function(){ return S3Factory{}}\n}\n</code></pre>\n\n<p>You could even think of making the Factories taking params. </p>\n"}], "owner": {"reputation": 836, "user_id": 3165535, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f693f2c6c6f0a65f824bb6ff36edfb04?s=128&d=identicon&r=PG", "display_name": "xxorde", "link": "https://stackoverflow.com/users/3165535/xxorde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 736, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1502062316, "creation_date": 1502040832, "question_id": 45534750, "link": "https://stackoverflow.com/questions/45534750/golang-api-interface-what-am-i-missing", "title": "golang API interface, what am I missing?", "body": "<p>I want to create an interface to make it easy to add new storage backends.</p>\n\n<pre><code>package main\n\n// Storage is an interface to describe storage backends\ntype Storage interface {\n    New() (newStorage Storage)\n}\n\n// File is a type of storage that satisfies the interface Storage\ntype File struct {\n}\n\n// New returns a new File\nfunc (File) New() (newFile Storage) {\n    newFile = File{}\n    return newFile\n}\n\n// S3 is a type of storage that satisfies the interface Storage\ntype S3 struct {\n}\n\n// New returns a new S3\nfunc (S3) New() (newS3 S3) {\n    newS3 = S3{}\n    return newS3\n}\n\nfunc main() {\n    // List of backends to choose from\n    var myStorage map[string]Storage\n    myStorage[\"file\"] = File{}\n    myStorage[\"s3\"] = S3{}\n\n    // Using one of the backends on demand\n    myStorage[\"file\"].New()\n    myStorage[\"s3\"].New()\n}\n</code></pre>\n\n<p>But it seems not possible to define and satisfy a function that should return an object that satisfies the interface itself as well.</p>\n\n<p>File.New() returns an object of type Storage which satisfies Storage.</p>\n\n<p>S3.New() returns an object of type S3.\nS3 should satisfies the interface Storage as well but I get this:</p>\n\n<pre><code>./main.go:32: cannot use S3 literal (type S3) as type Storage in assignment:\n    S3 does not implement Storage (wrong type for New method)\n        have New() S3\n        want New() Storage\n</code></pre>\n\n<p>What am I doing wrong?\nI hope I am missing something basic here.</p>\n"}, {"tags": ["go", "ethereum", "go-ethereum"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1676174"}, "is_accepted": false, "score": 1, "last_activity_date": 1511809056, "last_edit_date": 1592644375, "creation_date": 1511809056, "answer_id": 47517961, "question_id": 45534151, "link": "https://stackoverflow.com/questions/45534151/go-ethereum-failed-to-retrieve-account-nonce/47517961#47517961", "title": "go-ethereum: failed to retrieve account nonce", "body": "<p>For anyone else wondering about this, I encountered this error while testing with the Truffle develop framework. For me, this problem was because the Truffle JSON-RPC server was returning hex values with leading zeros like &quot;0x04&quot;, which violates the spec here:</p>\n<p><a href=\"https://github.com/ethereum/wiki/wiki/JSON-RPC#hex-value-encoding\" rel=\"nofollow noreferrer\">https://github.com/ethereum/wiki/wiki/JSON-RPC#hex-value-encoding</a></p>\n<blockquote>\n<p>When encoding QUANTITIES (integers, numbers): encode as hex, prefix with &quot;0x&quot;, the most compact representation (slight exception: zero should be represented as &quot;0x0&quot;).</p>\n<p>WRONG: 0x0400 (no leading zeroes allowed)</p>\n</blockquote>\n<p>That said, for Truffle, there's already a pull request here: <a href=\"https://github.com/trufflesuite/ganache-core/pull/32\" rel=\"nofollow noreferrer\">https://github.com/trufflesuite/ganache-core/pull/32</a></p>\n<p>If you're using another JSON-RPC server, you'd have to verify for yourself that it's actually following this spec.</p>\n"}], "owner": {"reputation": 14627, "user_id": 3535728, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/rCSt6.jpg?s=128&g=1", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/3535728/sebastian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 489, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1511809056, "creation_date": 1502037022, "last_edit_date": 1502037859, "question_id": 45534151, "link": "https://stackoverflow.com/questions/45534151/go-ethereum-failed-to-retrieve-account-nonce", "title": "go-ethereum: failed to retrieve account nonce", "body": "<p>I create <a href=\"https://github.com/ethereum/go-ethereum/wiki/Native-DApps:-Go-bindings-to-Ethereum-contracts\" rel=\"nofollow noreferrer\">go bindings</a> for my smart contract but have an issue when executing a transaction. It only works when I explicitly specify the <code>txOpts.Nonce</code> (see commented line). When I leave the line commented I get this error: </p>\n\n<pre><code>Failed to execute transaction: failed to retrieve account nonce: json: cannot unmarshal hex number with leading zero digits into Go value of type hexutil.Uint64`\n</code></pre>\n\n<p>Here is the relevant code:</p>\n\n<pre><code>txOpts := bind.NewKeyedTransactor(key)\n\n//txOpts.Nonce = big.NewInt(&lt;nonce&gt;)\n\ntx, err := token.MyContract(txOpts, big.NewInt(1))\nif err != nil {\n    log.Fatalf(\"Failed to execute transaction: %v\", err)\n}\n</code></pre>\n\n<p>The <a href=\"https://godoc.org/github.com/ethereum/go-ethereum/accounts/abi/bind#TransactOpts\" rel=\"nofollow noreferrer\">documentation</a> tells it would retrieve the pending nonce from <code>txOpts.From</code> when <code>txOpts.Nonce</code> is <code>nil</code>.</p>\n"}, {"tags": ["android", "go", "jvm", "ipc"], "owner": {"reputation": 988, "user_id": 6149170, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bc071a84d9b5d4ec115745e1d0922b29?s=128&d=identicon&r=PG", "display_name": "hermancain", "link": "https://stackoverflow.com/users/6149170/hermancain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 25, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1502034500, "creation_date": 1502034500, "question_id": 45533760, "link": "https://stackoverflow.com/questions/45533760/is-it-possible-to-trigger-a-notification-on-android-from-outside-the-jvm", "title": "Is it possible to trigger a notification on Android from outside the JVM?", "body": "<p>I know Go pretty well but I don't know Java or anything about Android. I have compiled a Go program and run it via command line on Android and ideally I would like to run it in the background and have it send me a notification using the official notification system without  using a third party app.</p>\n\n<p>Is this possible? Could it be done with some type of inter process communication?</p>\n"}, {"tags": ["go", "kubernetes"], "comments": [{"owner": {"reputation": 18733, "user_id": 371954, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tVhKq.jpg?s=128&g=1", "display_name": "Janos Lenart", "link": "https://stackoverflow.com/users/371954/janos-lenart"}, "edited": false, "score": 1, "creation_date": 1502029653, "post_id": 45532809, "comment_id": 78025995, "body": "Perhaps this is not the answer you are hoping for but why not just add a label <code>location=x</code> and use <code>kubectl get node -L location</code> ?"}, {"owner": {"reputation": 311, "user_id": 1320418, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AxbMq.jpg?s=128&g=1", "display_name": "puja", "link": "https://stackoverflow.com/users/1320418/puja"}, "edited": false, "score": 0, "creation_date": 1502096915, "post_id": 45532809, "comment_id": 78046099, "body": "Like the comment before me, your use case is why there&#39;s node labels. You can label your nodes and the labels will be shown also when you to <code>kubectl describe node</code>. Adding the location in code, would have you add it each time there&#39;s a new version of k8s out, as this kind of change won&#39;t get merged upstream. If you look at how cloud nodes are automatically labeled in k8s cloud-provider the labels also include location/region"}, {"owner": {"reputation": 3, "user_id": 8402670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c5c94d117ab14de10abfed80ebd89b7?s=128&d=identicon&r=PG&f=1", "display_name": "\u9673\u51a0\u7dad", "link": "https://stackoverflow.com/users/8402670/%e9%99%b3%e5%86%a0%e7%b6%ad"}, "edited": false, "score": 0, "creation_date": 1502110685, "post_id": 45532809, "comment_id": 78054443, "body": "It&#39;s because devices in this cluster may move at any time, so I want to read the GPS on devices and update the location value automatically"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 8402670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c5c94d117ab14de10abfed80ebd89b7?s=128&d=identicon&r=PG&f=1", "display_name": "\u9673\u51a0\u7dad", "link": "https://stackoverflow.com/users/8402670/%e9%99%b3%e5%86%a0%e7%b6%ad"}, "edited": false, "score": 0, "creation_date": 1502193994, "post_id": 45554648, "comment_id": 78094765, "body": "Thanks for the answer"}, {"owner": {"reputation": 5321, "user_id": 4215254, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-qImNt9WhVK4/AAAAAAAAAAI/AAAAAAAAAHs/gQPWlTrkinQ/photo.jpg?sz=128", "display_name": "Eric Tune", "link": "https://stackoverflow.com/users/4215254/eric-tune"}, "reply_to_user": {"reputation": 3, "user_id": 8402670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c5c94d117ab14de10abfed80ebd89b7?s=128&d=identicon&r=PG&f=1", "display_name": "\u9673\u51a0\u7dad", "link": "https://stackoverflow.com/users/8402670/%e9%99%b3%e5%86%a0%e7%b6%ad"}, "edited": false, "score": 0, "creation_date": 1502325451, "post_id": 45554648, "comment_id": 78164677, "body": "You may wish to accept this answer if it was useful"}], "tags": [], "owner": {"reputation": 5321, "user_id": 4215254, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-qImNt9WhVK4/AAAAAAAAAAI/AAAAAAAAAHs/gQPWlTrkinQ/photo.jpg?sz=128", "display_name": "Eric Tune", "link": "https://stackoverflow.com/users/4215254/eric-tune"}, "is_accepted": true, "score": 0, "last_activity_date": 1502135276, "creation_date": 1502135276, "answer_id": 45554648, "question_id": 45532809, "link": "https://stackoverflow.com/questions/45532809/add-location-in-kubernetes-node-infomation-and-let-kubectl-print-it-out/45554648#45554648", "title": "Add location in kubernetes node infomation and let kubectl print it out", "body": "<p>Write a program that runs on each node which reads the nodes location and then updates the node's label or (annotation) in the kubernetes node API. </p>\n\n<p>You don't need to modify the kubernetes source to accomplish this.  If you modify the kubernetes source, it will be harder to pickup future changes and you won't be able to use standard releases..</p>\n"}], "owner": {"reputation": 3, "user_id": 8402670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c5c94d117ab14de10abfed80ebd89b7?s=128&d=identicon&r=PG&f=1", "display_name": "\u9673\u51a0\u7dad", "link": "https://stackoverflow.com/users/8402670/%e9%99%b3%e5%86%a0%e7%b6%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 45554648, "answer_count": 1, "score": -1, "last_activity_date": 1502135276, "creation_date": 1502028360, "question_id": 45532809, "link": "https://stackoverflow.com/questions/45532809/add-location-in-kubernetes-node-infomation-and-let-kubectl-print-it-out", "title": "Add location in kubernetes node infomation and let kubectl print it out", "body": "<p>I want to add location information in kubernetes nodes' information and let kubectl command \"describe node\" print out the location of the node. However, I can't print out the value of Location. \nThe output is look like the image.\n<a href=\"https://i.stack.imgur.com/chrQd.png\" rel=\"nofollow noreferrer\">output of current code</a>\nWhat did I do wrong or what should I do but I missed it?\nAny help will be very much appreciated</p>\n\n<p>I already added new variable</p>\n\n<pre><code>Location string `json:\"location\"`  \n</code></pre>\n\n<p>in kubernetes/vendor/github.com/google/cadvisor/info/v1/machine.go</p>\n\n<p>and modified corresponding file that set and pass the value of Location.</p>\n\n<p>I also added new variable </p>\n\n<pre><code>Location string `json:\"location\"`\n</code></pre>\n\n<p>in /home/william/kubernetes/pkg/api/types.go</p>\n\n<p>and</p>\n\n<pre><code>Location string `json:\"location\" protobuf:\"bytes,2,opt,name=location\"`\n</code></pre>\n\n<p>in /home/william/kubernetes/pkg/api/v1/types.go</p>\n\n<p>I added </p>\n\n<pre><code>out.Location = in.Location\n</code></pre>\n\n<p>in function autoConvert_v1_NodeSystemInfo_To_api_NodeSystemInfo in /home/william/kubernetes/pkg/api/v1/zz_generated.conversion.go</p>\n\n<pre><code>func autoConvert_v1_NodeSystemInfo_To_api_NodeSystemInfo(in *NodeSystemInfo, out *api.NodeSystemInfo, s conversion.Scope) error {\n    out.MachineID = in.MachineID\n    out.SystemUUID = in.SystemUUID\n    out.Location = in.Location\n    out.BootID = in.BootID\n    out.KernelVersion = in.KernelVersion\n    out.OSImage = in.OSImage\n    out.ContainerRuntimeVersion = in.ContainerRuntimeVersion\n    out.KubeletVersion = in.KubeletVersion\n    out.KubeProxyVersion = in.KubeProxyVersion\n    out.OperatingSystem = in.OperatingSystem\n    out.Architecture = in.Architecture\n    return nil\n}\n</code></pre>\n\n<p>and add </p>\n\n<pre><code>fmt.Fprintf(out, \" Location:\\t%s\\n\", node.Status.NodeInfo.Location)\n</code></pre>\n\n<p>in function describeNode in /home/william/kubernetes/pkg/kubectl/describe.go</p>\n\n<pre><code>func describeNode(node *api.Node, nodeNonTerminatedPodsList *api.PodList, events *api.EventList, canViewPods bool) (string, error) {\nreturn tabbedString(func(out io.Writer) error {\n    fmt.Fprintf(out, \"Name:\\t%s\\n\", node.Name)\n    fmt.Fprintf(out, \"Role:\\t%s\\n\", findNodeRole(node))\n    printLabelsMultiline(out, \"Labels\", node.Labels)\n    printTaintsInAnnotationMultiline(out, \"Taints\", node.Annotations)\n    fmt.Fprintf(out, \"CreationTimestamp:\\t%s\\n\", node.CreationTimestamp.Time.Format(time.RFC1123Z))\n    fmt.Fprintf(out, \"Phase:\\t%v\\n\", node.Status.Phase)\n    if len(node.Status.Conditions) &gt; 0 {\n        fmt.Fprint(out, \"Conditions:\\n  Type\\tStatus\\tLastHeartbeatTime\\tLastTransitionTime\\tReason\\tMessage\\n\")\n        fmt.Fprint(out, \"  ----\\t------\\t-----------------\\t------------------\\t------\\t-------\\n\")\n        for _, c := range node.Status.Conditions {\n            fmt.Fprintf(out, \"  %v \\t%v \\t%s \\t%s \\t%v \\t%v\\n\",\n                c.Type,\n                c.Status,\n                c.LastHeartbeatTime.Time.Format(time.RFC1123Z),\n                c.LastTransitionTime.Time.Format(time.RFC1123Z),\n                c.Reason,\n                c.Message)\n        }\n    }\n    addresses := make([]string, 0, len(node.Status.Addresses))\n    for _, address := range node.Status.Addresses {\n        addresses = append(addresses, address.Address)\n    }\n\n    printResourceList := func(resourceList api.ResourceList) {\n        resources := make([]api.ResourceName, 0, len(resourceList))\n        for resource := range resourceList {\n            resources = append(resources, resource)\n        }\n        sort.Sort(SortableResourceNames(resources))\n        for _, resource := range resources {\n            value := resourceList[resource]\n            fmt.Fprintf(out, \" %s:\\t%s\\n\", resource, value.String())\n        }\n    }\n\n    fmt.Fprintf(out, \"Addresses:\\t%s\\n\", strings.Join(addresses, \",\"))\n    if len(node.Status.Capacity) &gt; 0 {\n        fmt.Fprintf(out, \"Capacity:\\n\")\n        printResourceList(node.Status.Capacity)\n    }\n    if len(node.Status.Allocatable) &gt; 0 {\n        fmt.Fprintf(out, \"Allocatable:\\n\")\n        printResourceList(node.Status.Allocatable)\n    }\n\n    fmt.Fprintf(out, \"System Info:\\n\")\n    fmt.Fprintf(out, \" Machine ID:\\t%s\\n\", node.Status.NodeInfo.MachineID)\n    fmt.Fprintf(out, \" System UUID:\\t%s\\n\", node.Status.NodeInfo.SystemUUID)\n    fmt.Fprintf(out, \" Location:\\t%s\\n\", node.Status.NodeInfo.Location)\n    fmt.Fprintf(out, \" Boot ID:\\t%s\\n\", node.Status.NodeInfo.BootID)\n    fmt.Fprintf(out, \" Kernel Version:\\t%s\\n\", node.Status.NodeInfo.KernelVersion)\n    fmt.Fprintf(out, \" OS Image:\\t%s\\n\", node.Status.NodeInfo.OSImage)\n    fmt.Fprintf(out, \" Operating System:\\t%s\\n\", node.Status.NodeInfo.OperatingSystem)\n    fmt.Fprintf(out, \" Architecture:\\t%s\\n\", node.Status.NodeInfo.Architecture)\n    fmt.Fprintf(out, \" Container Runtime Version:\\t%s\\n\", node.Status.NodeInfo.ContainerRuntimeVersion)\n    fmt.Fprintf(out, \" Kubelet Version:\\t%s\\n\", node.Status.NodeInfo.KubeletVersion)\n    fmt.Fprintf(out, \" Kube-Proxy Version:\\t%s\\n\", node.Status.NodeInfo.KubeProxyVersion)\n\n    if len(node.Spec.PodCIDR) &gt; 0 {\n        fmt.Fprintf(out, \"PodCIDR:\\t%s\\n\", node.Spec.PodCIDR)\n    }\n    if len(node.Spec.ExternalID) &gt; 0 {\n        fmt.Fprintf(out, \"ExternalID:\\t%s\\n\", node.Spec.ExternalID)\n    }\n    if canViewPods &amp;&amp; nodeNonTerminatedPodsList != nil {\n        if err := describeNodeResource(nodeNonTerminatedPodsList, node, out); err != nil {\n            return err\n        }\n    } else {\n        fmt.Fprintf(out, \"Pods:\\tnot authorized\\n\")\n    }\n    if events != nil {\n        DescribeEvents(events, out)\n    }\n    return nil\n})\n}\n</code></pre>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-storage"], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 1, "last_activity_date": 1502010132, "creation_date": 1502010132, "answer_id": 45530379, "question_id": 45530143, "link": "https://stackoverflow.com/questions/45530143/how-to-prevent-malformed-uploads/45530379#45530379", "title": "How to prevent malformed uploads?", "body": "<p>You could try the following checks before and after you upload the bytes:</p>\n\n<ul>\n<li>store len(b) of bytes</li>\n<li>store sha256 hash of bytes</li>\n</ul>\n\n<p>Verify that both of these are the same when reading back from the cloud storage directly afterwards. This could impact performance of course but it would ensure that you are getting out what you put into GCS. </p>\n\n<p>That isn't the only place you could see corruption though - if the client stopped transmitting or transmitted bad data to your server, this wouldn't detect it. If so checking for integrity in some other way before upload might be your best bet. If your files are of a known type you could also check for integrity that way by verifying that it really is a valid jpg file for example.   </p>\n\n<p>It might be best by trying to reproduce and finding out exactly where the corruption occurs first to verify your assumption that GCS should have returned an error and instead silently corrupted the data given to it. </p>\n"}], "owner": {"reputation": 641, "user_id": 1339834, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/f5b9f3c0513c1cef0e0d04cde53599dc?s=128&d=identicon&r=PG", "display_name": "stepanbujnak", "link": "https://stackoverflow.com/users/1339834/stepanbujnak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1502010132, "creation_date": 1502008406, "question_id": 45530143, "link": "https://stackoverflow.com/questions/45530143/how-to-prevent-malformed-uploads", "title": "How to prevent malformed uploads?", "body": "<p>I have a fairly simple code for uploading files to Google Cloud Storage using Golang.</p>\n\n<pre><code>func upload(object *storage.ObjectHandle, b []byte) error {\n    w := object.NewWriter(context.Background())\n\n    if _, err = w.Write(b); err != nil {\n        return err\n    }\n    return w.Close()\n}\n</code></pre>\n\n<p>I have uploaded multitudes of files without any problems, but yesterday I noticed that one of the files was damaged. I'm fairly certain that the file was damaged during the upload as I name the files based on MD5 hash of its contents. I believe the Google Cloud Storage should've returned an error when calling the <code>w.Close()</code> but it didn't. What's the best way to make sure that the upload always fails when the transfer is interrupted/damaged?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 365, "user_id": 2130607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6423be6ad9f861ddba9f1f1016cf2b4?s=128&d=identicon&r=PG", "display_name": "Kebeng", "link": "https://stackoverflow.com/users/2130607/kebeng"}, "edited": false, "score": 0, "creation_date": 1502022673, "post_id": 45527050, "comment_id": 78024028, "body": "That&#39;s quite interesting. But when i try to swap a value using multiple assignment here <a href=\"https://play.golang.org/p/76Q8OSGfr4\" rel=\"nofollow noreferrer\">play.golang.org/p/76Q8OSGfr4</a>, it just works and looks like go copy the value into another location during operation."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 365, "user_id": 2130607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6423be6ad9f861ddba9f1f1016cf2b4?s=128&d=identicon&r=PG", "display_name": "Kebeng", "link": "https://stackoverflow.com/users/2130607/kebeng"}, "edited": false, "score": 1, "creation_date": 1502027481, "post_id": 45527050, "comment_id": 78025308, "body": "@Kebeng: Yes, implicit in the quoted text above is that the values of the evaluated right-side expressions are stored temporarily until they are assigned to the left-side variables."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 20, "last_activity_date": 1502039261, "last_edit_date": 1502039261, "creation_date": 1501973652, "answer_id": 45527050, "question_id": 45526926, "link": "https://stackoverflow.com/questions/45526926/does-multiple-assignment-have-order/45527050#45527050", "title": "Does multiple assignment have order?", "body": "<p>Yes. From the <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"noreferrer\">language spec</a>:</p>\n\n<blockquote>\n  <p>The assignment proceeds in two phases. First, the operands of index expressions and pointer indirections (including implicit pointer indirections in selectors) on the left and the expressions on the right are all evaluated in the usual order. Second, the assignments are carried out in left-to-right order.</p>\n</blockquote>\n\n<p>So in your example, <code>child</code> and <code>child.child</code> will be evaluated first, then assigned to <code>parent</code> and <code>child</code> respectively. </p>\n"}], "owner": {"reputation": 2820, "user_id": 1804543, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/u2EW6.jpg?s=128&g=1", "display_name": "WhatABeautifulWorld", "link": "https://stackoverflow.com/users/1804543/whatabeautifulworld"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1430, "favorite_count": 1, "accepted_answer_id": 45527050, "answer_count": 1, "score": 12, "last_activity_date": 1565691023, "creation_date": 1501972425, "last_edit_date": 1565691023, "question_id": 45526926, "link": "https://stackoverflow.com/questions/45526926/does-multiple-assignment-have-order", "title": "Does multiple assignment have order?", "body": "<p>I know golang supports multiple assignment, for instance,</p>\n\n<pre><code>a, b = c, d\n</code></pre>\n\n<p>I want to know if the assignment following the left->right order? For instance, if I play with trees:</p>\n\n<pre><code>parent, child = child, child.child\n</code></pre>\n\n<p>Does it guarantee both parent and child are assigned one level deeper in the tree?</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 4, "creation_date": 1501967809, "post_id": 45526476, "comment_id": 78013189, "body": "Doesn&#39;t the return type of <code>Greet</code> have to be exactly <code>Greeting</code> for the type to fit the <code>Greeter</code> interface?"}, {"owner": {"reputation": 901, "user_id": 216212, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d97f111919acb6094edf9cf8b9f231a3?s=128&d=identicon&r=PG", "display_name": "Arthur Corenzan", "link": "https://stackoverflow.com/users/216212/arthur-corenzan"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1501968040, "post_id": 45526476, "comment_id": 78013237, "body": "@user2357112 As far as I know yes it has. But as I mentioned above, in my case the interface and the struct are in separate packages. So where I define the method <code>Greet() *Hello</code> I don&#39;t have access to the interface."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501968315, "post_id": 45526476, "comment_id": 78013290, "body": "The method definitions have to match perfectly for the interface to be satisfied. Even if you did <code>type Mystring string</code> then tried to return a <code>Mystring</code> from the <code>String()</code> method, it wouldn&#39;t satisfy the interface for <code>Greeting</code>."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1501968954, "post_id": 45526476, "comment_id": 78013439, "body": "Just adding my voice to the chorus. In order to satisfy the <code>Greeter</code> interface, the return type of <code>Greet</code> must be <code>Greeting</code>."}, {"owner": {"reputation": 901, "user_id": 216212, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d97f111919acb6094edf9cf8b9f231a3?s=128&d=identicon&r=PG", "display_name": "Arthur Corenzan", "link": "https://stackoverflow.com/users/216212/arthur-corenzan"}, "edited": false, "score": 0, "creation_date": 1501973664, "post_id": 45526476, "comment_id": 78014356, "body": "Okay, cool. Now that we&#39;ve stipulated that about interfaces I ask: what changes, if any, could be done so I can make a method in another package return a value that is accepted by a function defined here, without importing each other?"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1501976550, "post_id": 45526476, "comment_id": 78014816, "body": "Only one should have to import the other one. Why don&#39;t you want to do that?"}, {"owner": {"reputation": 901, "user_id": 216212, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d97f111919acb6094edf9cf8b9f231a3?s=128&d=identicon&r=PG", "display_name": "Arthur Corenzan", "link": "https://stackoverflow.com/users/216212/arthur-corenzan"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1501976949, "post_id": 45526476, "comment_id": 78014886, "body": "@AndySchweig My reasoning is this: the second package is just an adapter and it should have no knowledge of any of the things it connects, as long as its types adhere to the their interfaces. Perhaps this approach is ill conceived? Oh and also because when I did and then I imported this adapter into the <code>_test</code> file Go whined about interfaces mismatch again saying that type <code>T</code> is not the same as <code>package.T</code> only they&#39;re the same, but one is referenced outside the package, hence the package qualifier."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1501981930, "post_id": 45526476, "comment_id": 78015727, "body": "Can the connector package define the necessary interfaces so that the other packages that use it just have to import the connector package?"}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 13, "last_activity_date": 1501984206, "creation_date": 1501984206, "answer_id": 45527888, "question_id": 45526476, "link": "https://stackoverflow.com/questions/45526476/in-go-can-i-return-a-struct-that-meets-an-interface-without-access-to-that-inter/45527888#45527888", "title": "In Go can I return a struct that meets an interface without access to that interface?", "body": "<p>As stated in the comments, problem here is once your interface has this signature:</p>\n\n<pre><code>type Greeter interface {\n    Greet() Greeting\n}\n</code></pre>\n\n<p>The any valid implementation must use exactly <code>Greeting</code> as the return type.</p>\n\n<p>But, as the documentation shows, you don't need to give the interface a name:</p>\n\n<p><a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"noreferrer\">https://golang.org/ref/spec#Interface_types</a></p>\n\n<p>In order to be able to implement what you need, you might declare the interface directly in the return value, without giving it a name.</p>\n\n<pre><code>// Greeter greets with anything that has a String() method\ntype Greeter interface {\n    Greet() interface{ String() string }\n}\n</code></pre>\n\n<p>Then your <code>Greet()</code> function for <code>Hello</code> can do this:</p>\n\n<pre><code>// Hello greets by returning itself...\nfunc (h *Hello) Greet() interface{ String() string } {\n   return h\n}\n</code></pre>\n\n<p>Find here a modified playground showing the working example:</p>\n\n<p><a href=\"https://play.golang.org/p/HteA_9jFd4\" rel=\"noreferrer\">https://play.golang.org/p/HteA_9jFd4</a></p>\n"}], "owner": {"reputation": 901, "user_id": 216212, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d97f111919acb6094edf9cf8b9f231a3?s=128&d=identicon&r=PG", "display_name": "Arthur Corenzan", "link": "https://stackoverflow.com/users/216212/arthur-corenzan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3731, "favorite_count": 6, "accepted_answer_id": 45527888, "answer_count": 1, "score": 8, "last_activity_date": 1531592307, "creation_date": 1501967561, "last_edit_date": 1531592307, "question_id": 45526476, "link": "https://stackoverflow.com/questions/45526476/in-go-can-i-return-a-struct-that-meets-an-interface-without-access-to-that-inter", "title": "In Go can I return a struct that meets an interface without access to that interface?", "body": "<p>I think the best way to explain this is by example, so here it is: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\n// Greeter greets with a Greeting.\ntype Greeter interface {\n    Greet() Greeting\n}\n\n// A Greeting has a string representation.\ntype Greeting interface {\n    String() string\n}\n\ntype Hello struct {}\n\n// Hello greets by returning itself...\nfunc (h *Hello) Greet() *Hello {\n    return h\n}\n\n// ...because Hello also has a string representation.\nfunc (h *Hello) String() string {\n    return \"Hello\"\n}\n\n// But Go says Hello doesn't implement Greeter.\nfunc main() {\n    var g interface{} = &amp;Hello{}\n    g, ok := g.(Greeter)\n    fmt.Println(ok)\n}\n</code></pre>\n\n<p>This prints <code>false</code>. You can run and play with it: <a href=\"https://play.golang.org/p/A_2k_ku_Q2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/A_2k_ku_Q2</a></p>\n\n<p>In my real case the struct <code>Hello</code> and the interfaces for <code>Greeter</code> and <code>Greeting</code> are in <strong>different packages</strong> that do not import each other and I wanted to keep it that way. I'm perhaps missing some understanding of interfaces in Go but after reading so much about it I still can't put my finger on it. Would you guys have any pointers for me? Maybe another approach for the problem? Thanks!</p>\n"}, {"tags": ["linux", "windows", "go"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 1, "creation_date": 1502049309, "post_id": 45526086, "comment_id": 78032102, "body": "you might want to start your search with things like keyloggers.  Here&#39;s a package that works with linux..similar logic can be used for macs <a href=\"https://github.com/gearmover/keylogger\" rel=\"nofollow noreferrer\">github.com/gearmover/keylogger</a>.  Windows is out of my realm is knowledge, but i&#39;m sure some googling and searching on stack will yield results.  <a href=\"https://play.golang.org/p/wHJ-8D2nKT\" rel=\"nofollow noreferrer\">play.golang.org/p/wHJ-8D2nKT</a>"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 1, "creation_date": 1502061278, "post_id": 45526086, "comment_id": 78034961, "body": "Thank you, I never thought to examine keyloggers... The one you linked has enough info I can get Linux working, now I just need something for Windows... (Interestingly the linked key logger produces unknown scan code errors for the media keys, but that is just because it&#39;s mappings are incomplete.)"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 1, "creation_date": 1502077679, "post_id": 45526086, "comment_id": 78038260, "body": "Yeah probably a mapping issue.  You probably came across this one already for windows, but if not here&#39;s one for windows. <a href=\"https://github.com/SaturnsVoid/Windows-KeyLogger\" rel=\"nofollow noreferrer\">github.com/SaturnsVoid/Windows-KeyLogger</a>"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1502105732, "post_id": 45526086, "comment_id": 78051350, "body": "I kinda feel like an idiot now. The one Windows keyboard polling function I actually knew about will do what I want... For some reason I thought it was more limited... Oh well. Anyway, if no one answers by the time I get this working I&#39;ll write up a self answer crediting certain helpful commenters :)"}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 0, "last_activity_date": 1505215121, "last_edit_date": 1505215121, "creation_date": 1502111403, "answer_id": 45547741, "question_id": 45526086, "link": "https://stackoverflow.com/questions/45526086/read-media-keys-from-go-program/45547741#45547741", "title": "Read media keys from Go program", "body": "<p>With the help of several commenters, I now have it all figured out.</p>\n\n<p>The Linux version is as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \u201cbytes\u201d\n    \u201cencoding/binary\u201d\n    \u201cfmt\u201d\n    \u201cos\u201d\n    \u201cos/exec\u201d\n    \u201csyscall\u201d\n)\n\n// parses through the /proc/bus/input/devices file for keyboard devices.\n// Copied from `github.com/gearmover/keylogger` with trivial modification.\nfunc dumpDevices() ([]string, error) {\n    cmd := exec.Command(\u201c/bin/sh\u201d, \u201c-c\u201d, \u201c/bin/grep -E \u2018Handlers|EV=\u2019 /proc/bus/input/devices | /bin/grep -B1 \u2018EV=120013\u2019 | /bin/grep -Eo \u2018event[0-9]+\u2019\u201d)\n\n    output, err := cmd.Output()\n    if err != nil {\n        return nil, err\n    }\n\n    buf := bytes.NewBuffer(output)\n\n    var devices []string\n\n    for line, err := buf.ReadString(\u2018\\n\u2019); err == nil; {\n        devices = append(devices, \u201c/dev/input/\u201d+line[:len(line)-1])\n\n        line, err = buf.ReadString(\u2018\\n\u2019)\n    }\n\n    return devices, nil\n}\n\n// Using MS names, just because I don\u2019t feel like looking up the Linux versions.\nvar keys = map[uint16]string{\n    0xa3: \u201cVK_MEDIA_NEXT_TRACK\u201d,\n    0xa5: \u201cVK_MEDIA_PREV_TRACK\u201d,\n    0xa6: \u201cVK_MEDIA_STOP\u201d,\n    0xa4: \u201cVK_MEDIA_PLAY_PAUSE\u201d,\n}\n\n// Most of the code here comes from `github.com/gearmover/keylogger`.\nfunc main() {\n    // drop privileges when executing other programs\n    syscall.Setgid(65534)\n    syscall.Setuid(65534)\n\n    // dump our keyboard devices from /proc/bus/input/devices\n    devices, err := dumpDevices()\n    if err != nil {\n        fmt.Println(err)\n    }\n    if len(devices) == 0 {\n        fmt.Println(\u201cNo input devices found\u201d)\n        return\n    }\n\n    // bring back our root privs\n    syscall.Setgid(0)\n    syscall.Setuid(0)\n\n    // Open the first keyboard device.\n    input, err := os.OpenFile(devices[0], os.O_RDONLY, 0600)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer input.Close()\n\n    // Log media keys\n    var buffer = make([]byte, 24)\n    for {\n        // read the input events as they come in\n        n, err := input.Read(buffer)\n        if err != nil {\n            return\n        }\n\n        if n != 24 {\n            fmt.Println(\u201cWeird Input Event Size: \u201c, n)\n            continue\n        }\n\n        // parse the input event according to the &lt;linux/input.h&gt; header struct\n        binary.LittleEndian.Uint64(buffer[0:8]) // Time stamp stuff I could care less about\n        binary.LittleEndian.Uint64(buffer[8:16])\n        etype := binary.LittleEndian.Uint16(buffer[16:18])        // Event Type. Always 1 for keyboard events\n        code := binary.LittleEndian.Uint16(buffer[18:20])         // Key scan code\n        value := int32(binary.LittleEndian.Uint32(buffer[20:24])) // press(1), release(0), or repeat(2)\n\n        if etype == 1 &amp;&amp; value == 1 &amp;&amp; keys[code] != \u201c\u201d {\n            // In a real application I would send a message here.\n            fmt.Println(keys[code])\n        }\n    }\n}\n</code></pre>\n\n<p>And the Windows version:</p>\n\n<pre><code>package main\n\nimport (\n    \u201cfmt\u201d\n    \u201csyscall\u201d\n    \u201ctime\u201d\n)\n\nvar user32 = syscall.NewLazyDLL(\u201cuser32.dll\u201d)\nvar procGAKS = user32.NewProc(\u201cGetAsyncKeyState\u201d)\n\n// Key codes from MSDN\nvar keys = [4]uint{\n    0xb0, // VK_MEDIA_NEXT_TRACK\n    0xb1, // VK_MEDIA_PREV_TRACK\n    0xb2, // VK_MEDIA_STOP\n    0xb3, // VK_MEDIA_PLAY_PAUSE\n}\n\nvar names = [4]string{\n    \u201cVK_MEDIA_NEXT_TRACK\u201d,\n    \u201cVK_MEDIA_PREV_TRACK\u201d,\n    \u201cVK_MEDIA_STOP\u201d,\n    \u201cVK_MEDIA_PLAY_PAUSE\u201d,\n}\n\nfunc main() {\n    fmt.Println(\u201cRunning\u2026\u201d)\n\n    // Since I don\u2019t want to trigger dozens of times for each key I need to track state.\n    // I could check the bits of GAKS\u2019 return value, but that is not reliable.\n    down := [4]bool{false, false, false, false}\n\n    for {\n        time.Sleep(1 * time.Millisecond)\n        for i, key := range keys {\n            // val is not a simple boolean!\n            // 0 means \u201cnot pressed\u201d (also certain errors)\n            // If LSB is set the key was just pressed (this may not be reliable)\n            // If MSB is set the key is currently down.\n            val, _, _ := procGAKS.Call(uintptr(key))\n\n            // Turn a press into a transition and track key state.\n            goingdown := false\n            if int(val) != 0 &amp;&amp; !down[i] {\n                goingdown = true\n                down[i] = true\n            }\n            if int(val) == 0 &amp;&amp; down[i] {\n                down[i] = false\n            }\n            if goingdown {\n                // In a real application I would send a message here.\n                fmt.Println(names[i])\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>The only \"issue\" is that the Linux version must be run as root. For me this is not a problem. If running as root is a problem I think there is a way that involves X11...</p>\n"}], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "accepted_answer_id": 45547741, "answer_count": 1, "score": 1, "last_activity_date": 1505215121, "creation_date": 1501964639, "question_id": 45526086, "link": "https://stackoverflow.com/questions/45526086/read-media-keys-from-go-program", "title": "Read media keys from Go program", "body": "<p>I am writing a media cross-platform distributed media player for use on my own network.</p>\n\n<p>The current version has three/four parts:</p>\n\n<ol>\n<li>A NAS holding the audio files.</li>\n<li>A metadata server holding information about the files.</li>\n<li>A HTML/JS client that allows manipulation of the metadata server and queuing media for the:</li>\n<li>A player deamon.</li>\n</ol>\n\n<p>My problem lies with part 4. The player has no UI, nor does it need one. It will be controlled via network commands from the client and by listening to the media keys on its current host.</p>\n\n<p>The player daemon needs to work on both Windows and Linux, but I can't seem to figure out a way (any way) to read these keys on either OS. Most of the way I know to read the keyboard will not read these keys at all.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1501961345, "post_id": 45525539, "comment_id": 78011400, "body": "Include <code>parseTime=True</code> in your MySQL connection string and try."}, {"owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "reply_to_user": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1501961537, "post_id": 45525539, "comment_id": 78011454, "body": "<code>charset=utf8&amp;parseTime=true</code> is already there"}, {"owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "edited": false, "score": 0, "creation_date": 1501961648, "post_id": 45525539, "comment_id": 78011487, "body": "Can you please share your DB&#39;s schema ?"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1501961753, "post_id": 45525539, "comment_id": 78011517, "body": "Then it is MySQL DB Timezone setting issue not a Go issue. Can you please check your Db setting."}, {"owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "edited": false, "score": 0, "creation_date": 1501961984, "post_id": 45525539, "comment_id": 78011589, "body": "Just if it helps - I am using <code>fragmenta</code> CMS with <code>mysql</code>."}, {"owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "edited": false, "score": 0, "creation_date": 1501962866, "post_id": 45525539, "comment_id": 78011827, "body": "@JohnCargo Can you please share the code which builds the query ?"}, {"owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "reply_to_user": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "edited": false, "score": 0, "creation_date": 1501963401, "post_id": 45525539, "comment_id": 78011986, "body": "@ShmulikKlein , Updated my question with all relevant code and link to solve the error."}, {"owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "reply_to_user": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "edited": false, "score": 0, "creation_date": 1501963871, "post_id": 45525539, "comment_id": 78012104, "body": "@ShmulikKlein does this help now ?"}, {"owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "reply_to_user": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1501963888, "post_id": 45525539, "comment_id": 78012110, "body": "@Jeevatkm does this help now ?"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1501965841, "post_id": 45525539, "comment_id": 78012673, "body": "I had a look on provide CMS codebase. I surely feel this is MySQL setting for <code>error code 1292</code>, refer to this <a href=\"https://dba.stackexchange.com/a/48745\">post</a> and do your setting according to your MySQL version.  Quick way to check this fire <code>INSERT</code> query in your SQL editor, you will see."}], "answers": [{"comments": [{"owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "edited": false, "score": 0, "creation_date": 1501966435, "post_id": 45526245, "comment_id": 78012820, "body": "Even after changing it to <code>time.Now().UTC()</code> - it doesn&#39;t change anything."}, {"owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "reply_to_user": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "edited": false, "score": 0, "creation_date": 1501969418, "post_id": 45526245, "comment_id": 78013532, "body": "Can you please turn the <code>Debug</code> flag on <a href=\"https://github.com/fragmenta/query/blob/master/query.go#L22\" rel=\"nofollow noreferrer\">github.com/fragmenta/query/blob/master/query.go#L22</a> and tell what is the generated query ?"}, {"owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "edited": false, "score": 0, "creation_date": 1501969914, "post_id": 45526245, "comment_id": 78013633, "body": "It&#39;s in debug mode by default and gives same error as i have mentioned in question <code>File:src&#47;pages&#47;actions&#47;setup.go:65 Error:Error 1292: Incorrect datetime value: &#39;2017-08-05 21:51:07.723 +0000&#39; for column &#39;created_at&#39; at row 1</code>"}, {"owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "reply_to_user": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "edited": false, "score": 0, "creation_date": 1501970212, "post_id": 45526245, "comment_id": 78013700, "body": "The boolean that I mentioned should print out the generated query for you"}, {"owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "edited": false, "score": 0, "creation_date": 1501970365, "post_id": 45526245, "comment_id": 78013732, "body": "Nope! it has not any - it only gives error message with file name and line number."}], "tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": false, "score": 2, "last_activity_date": 1501970802, "last_edit_date": 1501970802, "creation_date": 1501965759, "answer_id": 45526245, "question_id": 45525539, "link": "https://stackoverflow.com/questions/45525539/mysql-timestamp-error-with-time-now-golang/45526245#45526245", "title": "mysql timestamp error with time.Now() golang", "body": "<p>You are trying to insert it using a string <a href=\"https://github.com/fragmenta/fragmenta-cms/blob/master/src/lib/resource/query.go#L36\" rel=\"nofollow noreferrer\">query.go:36</a>:</p>\n\n<pre><code>now := query.TimeString(time.Now().UTC())\n</code></pre>\n\n<p>that is generated by the package that you are using <a href=\"https://github.com/fragmenta/query/blob/master/adapters/database.go#L59\" rel=\"nofollow noreferrer\">database.go:59</a>:</p>\n\n<pre><code>return t.Format(\"2006-01-02 15:04:05.000 -0700\")\n</code></pre>\n\n<p>MySQL expects it to be in the pattern of <code>yyyy-MM-dd hh:mm:ss</code>, use the following snippet to apply the pattern to you current <code>Time.time</code> object: </p>\n\n<pre><code>now := time.Now().UTC().Format(\"2006-01-02 03:04:05\")\n</code></pre>\n\n<p>Anyway, why not to use the SQL function <code>NOW()</code> when inserting the record ?</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1501993878, "last_edit_date": 1501993878, "creation_date": 1501980085, "answer_id": 45527603, "question_id": 45525539, "link": "https://stackoverflow.com/questions/45525539/mysql-timestamp-error-with-time-now-golang/45527603#45527603", "title": "mysql timestamp error with time.Now() golang", "body": "<p>There is a bug in <a href=\"https://github.com/fragmenta/query\" rel=\"nofollow noreferrer\"><code>https://github.com/fragmenta/query</code></a>. The <code>TimeString</code> method in <code>query/adapters/database.go</code> is not valid for all DBMS adapters.</p>\n\n<pre><code>// TimeString - given a time, return the standard string representation\nfunc (db *Adapter) TimeString(t time.Time) string {\n    return t.Format(\"2006-01-02 15:04:05.000 -0700\")\n}\n</code></pre>\n\n<p>It's not valid for a MySQL timestamp: <a href=\"https://dev.mysql.com/doc/refman/5.7/en/datetime.html\" rel=\"nofollow noreferrer\">MySQL 5.7 Reference Manual, 11.3.1 The DATE, DATETIME, and TIMESTAMP Types</a>. The MySQL <code>TimeString</code> method in <code>query/adapters/database_mysql.go</code> should be:</p>\n\n<pre><code>// TimeString - given a time, return the MySQL standard string representation\nfunc (db *MysqlAdapter) TimeString(t time.Time) string {\n    return t.Format(\"2006-01-02 15:04:05.999999\")\n}\n</code></pre>\n"}], "owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4452, "favorite_count": 1, "accepted_answer_id": 45527603, "answer_count": 2, "score": 4, "last_activity_date": 1501993878, "creation_date": 1501960428, "last_edit_date": 1501963359, "question_id": 45525539, "link": "https://stackoverflow.com/questions/45525539/mysql-timestamp-error-with-time-now-golang", "title": "mysql timestamp error with time.Now() golang", "body": "<p>How to save <code>time.Now()</code> in mysql table, column name as <code>created_at timestamp null</code>.</p>\n\n<p>I am getting error : </p>\n\n<pre><code>Error:Error 1292: Incorrect datetime value: '2017-08-05 19:06:14.190 +0000' for column 'created_at' at row 1\n</code></pre>\n\n<h2>More Information as asked :- ( I am using <code>fragmenta</code> cms, so all reference code with their line number is given below )</h2>\n\n<p>Table schema :-</p>\n\n<pre><code>mysql&gt; describe users;\n+----------------------+--------------+------+-----+---------+----------------+\n| Field                | Type         | Null | Key | Default | Extra          |\n+----------------------+--------------+------+-----+---------+----------------+\n| id                   | int(11)      | NO   | PRI | NULL    | auto_increment |\n| created_at           | timestamp    | YES  |     | NULL    |                |\n| updated_at           | timestamp    | YES  |     | NULL    |                |\n| status               | int(11)      | YES  |     | NULL    |                |\n| role                 | int(11)      | YES  |     | NULL    |                |\n| name                 | varchar(250) | YES  |     | NULL    |                |\n| email                | varchar(250) | YES  |     | NULL    |                |\n| title                | varchar(250) | YES  |     | NULL    |                |\n| summary              | text         | YES  |     | NULL    |                |\n| text                 | text         | YES  |     | NULL    |                |\n| image_id             | int(11)      | YES  |     | NULL    |                |\n| password_hash        | varchar(250) | YES  |     | NULL    |                |\n| password_reset_token | text         | YES  |     | NULL    |                |\n| password_reset_at    | timestamp    | YES  |     | NULL    |                |\n+----------------------+--------------+------+-----+---------+----------------+\n</code></pre>\n\n<p>Code that is running it to save :-</p>\n\n<p>At line no. 62 here ( <a href=\"https://github.com/fragmenta/fragmenta-cms/blob/master/src/pages/actions/setup.go#L62\" rel=\"nofollow noreferrer\">https://github.com/fragmenta/fragmenta-cms/blob/master/src/pages/actions/setup.go#L62</a> ) </p>\n\n<p>It calls code \n<code>\nuser := users.New()\n</code></p>\n\n<p>in Line no. 51 at file here ( <a href=\"https://github.com/fragmenta/fragmenta-cms/blob/master/src/users/query.go#L51\" rel=\"nofollow noreferrer\">https://github.com/fragmenta/fragmenta-cms/blob/master/src/users/query.go#L51</a> ) </p>\n\n<p><code>New()</code> function is setup.</p>\n\n<p>Which is like :-</p>\n\n<pre><code>func New() *User {\n    user := &amp;User{}\n    user.CreatedAt = time.Now()\n    user.UpdatedAt = time.Now()\n    user.TableName = TableName\n    user.KeyName = KeyName\n    user.Status = status.Draft\n    return user\n}\n</code></pre>\n\n<p>and their connecting / mysql opening pattern is located here ( <a href=\"https://github.com/fragmenta/query/blob/master/adapters/database_mysql.go#L23\" rel=\"nofollow noreferrer\">https://github.com/fragmenta/query/blob/master/adapters/database_mysql.go#L23</a> ) .</p>\n"}, {"tags": ["go", "synchronization", "web-crawler", "go-echo"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1501958931, "post_id": 45525332, "comment_id": 78010714, "body": "This is probably what you are looking for. I&#39;ll see if I can find a good example of its usage. <a href=\"https://godoc.org/context#example-WithCancel\" rel=\"nofollow noreferrer\">godoc.org/context#example-WithCancel</a> EDIT: oops, linked to the old <code>net&#47;context</code> package. It&#39;s fixed now. It has a mini example"}, {"owner": {"reputation": 151, "user_id": 1686794, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/f9138e85ed6235b9ca86e25f81c769df?s=128&d=identicon&r=PG&f=1", "display_name": "heartofrevel", "link": "https://stackoverflow.com/users/1686794/heartofrevel"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501959256, "post_id": 45525332, "comment_id": 78010800, "body": "I&#39;m using echo framework for server, I don&#39;t think echo has any function like this."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501960005, "post_id": 45525332, "comment_id": 78011016, "body": "OK then, you can roll your own kill channel. In this case I&#39;ll make a few assumptions in my answer, but I think it will work just fine."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501961364, "post_id": 45525332, "comment_id": 78011406, "body": "BTW, you realize that you are concurrently writing to a <code>slice</code>, which is VERY BAD. It&#39;s a separate issue which I am selectively ignoring in my answer because it&#39;s a separate issue..."}, {"owner": {"reputation": 151, "user_id": 1686794, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/f9138e85ed6235b9ca86e25f81c769df?s=128&d=identicon&r=PG&f=1", "display_name": "heartofrevel", "link": "https://stackoverflow.com/users/1686794/heartofrevel"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501967164, "post_id": 45525332, "comment_id": 78013031, "body": "@RayfenWindspear any alternative, should i create a slice with large capacity and add by index?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501967657, "post_id": 45525332, "comment_id": 78013150, "body": "You have no idea how large to make it. Instead of passing the <code>slice</code>, make a <code>channel</code> to pass to the crawler to put values into. Then immediately before your first crawl, set up a single goroutine that reads from the <code>channel</code> into the <code>slice</code>. Then after <code>wg.Wait</code> close the channel and it is safe to use the <code>slice</code>. Be sure to close this channel too if the request is cancelled."}, {"owner": {"reputation": 151, "user_id": 1686794, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/f9138e85ed6235b9ca86e25f81c769df?s=128&d=identicon&r=PG&f=1", "display_name": "heartofrevel", "link": "https://stackoverflow.com/users/1686794/heartofrevel"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501975348, "post_id": 45525332, "comment_id": 78014653, "body": "@RayfenWindspear but then again, i will be getting the value from channel and appending it to slice. And I need to check if the current url is in the urllist before adding it to it.  Also i cannot maintain a global variable as it will be then same for every request made."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502045083, "post_id": 45525332, "comment_id": 78030759, "body": "Given that you need to check if the URL is in the slice, and then write to it, a channel isn&#39;t what you need. You will need a mutex to lock the slice when it is being read/written. You can either do this yourself, or find a lib with a concurrent safe slice. I highly suggest a library so you don&#39;t have to worry about not getting it quite right. It is easy to miss a single spot and have things go haywire."}, {"owner": {"reputation": 151, "user_id": 1686794, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/f9138e85ed6235b9ca86e25f81c769df?s=128&d=identicon&r=PG&f=1", "display_name": "heartofrevel", "link": "https://stackoverflow.com/users/1686794/heartofrevel"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502053635, "post_id": 45525332, "comment_id": 78033336, "body": "@RayfenWindspear No i wanted to know, if there is any alternative to appending to slice."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502054233, "post_id": 45525332, "comment_id": 78033469, "body": "If you know how many items there are, yes you could allocate then use index only. Pre-allocation then writing only by index is safe. However, yours is a recursive solution, and also by the problem&#39;s very nature, you won&#39;t know how many links you will pull. So you are basically stuck using concurrency safeties."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501963336, "post_id": 45525909, "comment_id": 78011966, "body": "Ohh, that&#39;s what you mean... I totally spaced that. My original comment had the answer, I just forgot a real legit <code>context</code> was in the request XD."}, {"owner": {"reputation": 125, "user_id": 2292060, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/RLQ5N.png?s=128&g=1", "display_name": "Haytham.Breaka", "link": "https://stackoverflow.com/users/2292060/haytham-breaka"}, "edited": false, "score": 0, "creation_date": 1580297373, "post_id": 45525909, "comment_id": 106049086, "body": "Correct answer but I would like to add something in case anyone was searching like me and the context still didn&#39;t get cancelled when he cancels the request itself from the client side. Please make sure that the request body is empty or closed. ref: <a href=\"https://stackoverflow.com/questions/57246852/go-http-context-not-able-to-capture-cancellation-signal-when-request-has-body-c\" title=\"go http context not able to capture cancellation signal when request has body c\">stackoverflow.com/questions/57246852/&hellip;</a>"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 9, "last_activity_date": 1502097076, "last_edit_date": 1502097076, "creation_date": 1501963305, "answer_id": 45525909, "question_id": 45525332, "link": "https://stackoverflow.com/questions/45525332/close-all-goroutines-when-http-request-is-cancelled/45525909#45525909", "title": "Close all goroutines when HTTP request is cancelled", "body": "<p>The echo context exposes the HTTP request, which has a context tied to the server request already.  Just get that context, and check it for cancellation, and/or pass it along to methods that take a context.</p>\n\n<pre><code>ctx := c.Request().Context()\nselect {\ncase &lt;-ctx.Done():\n    return ctx.Err()\ndefault:\n    // Continue handling the request\n}\n\n// and pass along to the db or whatever else:\nrows, err := db.QueryContext(ctx, ...)\n</code></pre>\n\n<p>If the client aborts the connection, the Request-scoped context will automatically be cancelled.</p>\n\n<p>If you want to add your own cancellation conditions, (timeouts, or whatever) you can do that, too:</p>\n\n<pre><code>req := c.Request()\nctx, cancel := context.WithCancel(req.Context())\nreq.WithContext(ctx)\ndefer cancel()\n// do stuff, which may conditionally call cancel() to cancel the context early\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 1686794, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/f9138e85ed6235b9ca86e25f81c769df?s=128&d=identicon&r=PG&f=1", "display_name": "heartofrevel", "link": "https://stackoverflow.com/users/1686794/heartofrevel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1609, "favorite_count": 1, "accepted_answer_id": 45525909, "answer_count": 1, "score": 0, "last_activity_date": 1502097076, "creation_date": 1501958775, "last_edit_date": 1501963025, "question_id": 45525332, "link": "https://stackoverflow.com/questions/45525332/close-all-goroutines-when-http-request-is-cancelled", "title": "Close all goroutines when HTTP request is cancelled", "body": "<p><br />\nI am making a web crawler. I'm passing the url through a crawler function and parsing it to get all the links in the anchor tag, then I am invoking same crawler function for all those urls using seperate goroutine for every url.\n<br/>\nBut if if send a request and cancel it before I get the response, all the groutines for that particular request are still running.<br />\nNow what I want is that when I cancel the request all the goroutines that got invoked due to that request stops.\n<br />\nPlease guide.<br />\nFollowing is my code for the <strong>crawler</strong> function.</p>\n\n<pre><code>func crawler(c echo.Context, urlRec string, feed chan string, urlList *[]string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    URL, _ := url.Parse(urlRec)\n    response, err := http.Get(urlRec)\n    if err != nil {\n        log.Print(err)\n        return\n    }\n\n    body := response.Body\n    defer body.Close()\n\n    tokenizer := html.NewTokenizer(body)\n    flag := true\n    for flag {\n        tokenType := tokenizer.Next()\n        switch {\n        case tokenType == html.ErrorToken:\n            flag = false\n            break\n        case tokenType == html.StartTagToken:\n            token := tokenizer.Token()\n\n            // Check if the token is an &lt;a&gt; tag\n            isAnchor := token.Data == \"a\"\n            if !isAnchor {\n                continue\n            }\n\n            ok, urlHref := getReference(token)\n            if !ok {\n                continue\n            }\n\n            // Make sure the url begines in http**\n            hasProto := strings.Index(urlHref, \"http\") == 0\n            if hasProto {\n                if !urlInURLList(urlHref, urlList) {\n                    if strings.Contains(urlHref, URL.Host) {\n                        *urlList = append(*urlList, urlHref)\n                        // fmt.Println(urlHref)\n                        // c.String(http.StatusOK, urlHref+\"\\n\")Documents\n                        if !checkExt(filepath.Ext(urlHref)) {\n                            wg.Add(1)\n                            go crawler(c, urlHref, feed, urlList, wg)\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>And following is my POST request handler</p>\n\n<pre><code>func scrapePOST(c echo.Context) error {\n    var urlList []string\n    urlSession := urlFound{}\n    var wg sync.WaitGroup\n    urlParam := c.FormValue(\"url\")\n    feed := make(chan string, 1000)\n    wg.Add(1)\n    go crawler(c, urlParam, feed, &amp;urlList, &amp;wg)\n    wg.Wait()\n    var count = 0\n    for _, url := range urlList {\n        if filepath.Ext(url) == \".jpg\" || filepath.Ext(url) == \".jpeg\" || filepath.Ext(url) == \".png\" {\n            urlSession.Images = append(urlSession.Images, url)\n        } else if filepath.Ext(url) == \".doc\" || filepath.Ext(url) == \".docx\" || filepath.Ext(url) == \".pdf\" || filepath.Ext(url) == \".ppt\" {\n            urlSession.Documents = append(urlSession.Documents, url)\n        } else {\n            urlSession.Links = append(urlSession.Links, url)\n        }\n        count = count + 1\n    }\n    urlSession.Count = count\n    // jsonResp, _ := json.Marshal(urlSession)\n    // fmt.Print(urlSession)\n    return c.JSON(http.StatusOK, urlSession)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2345, "user_id": 4511585, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/IC7eZ.jpg?s=128&g=1", "display_name": "albttx", "link": "https://stackoverflow.com/users/4511585/albttx"}, "edited": false, "score": 2, "creation_date": 1501953665, "post_id": 45524553, "comment_id": 78009182, "body": "did you look at : <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a> ?"}, {"owner": {"reputation": 109, "user_id": 8191837, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5f3395549c1d406659b0e8eafaf26fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Amirgem", "link": "https://stackoverflow.com/users/8191837/amirgem"}, "reply_to_user": {"reputation": 2345, "user_id": 4511585, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/IC7eZ.jpg?s=128&g=1", "display_name": "albttx", "link": "https://stackoverflow.com/users/4511585/albttx"}, "edited": false, "score": 0, "creation_date": 1501954134, "post_id": 45524553, "comment_id": 78009336, "body": "yes I did, from what I gather if I would use an MVC pattern I would have to create a package for a controller and models right? But arent packages supposed to be for use in multiple systems?"}, {"owner": {"reputation": 2345, "user_id": 4511585, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/IC7eZ.jpg?s=128&g=1", "display_name": "albttx", "link": "https://stackoverflow.com/users/4511585/albttx"}, "edited": false, "score": 0, "creation_date": 1501954366, "post_id": 45524553, "comment_id": 78009409, "body": "<a href=\"https://github.com/gernest/utron\" rel=\"nofollow noreferrer\">github.com/gernest/utron</a> might be a nice exemple"}, {"owner": {"reputation": 109, "user_id": 8191837, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5f3395549c1d406659b0e8eafaf26fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Amirgem", "link": "https://stackoverflow.com/users/8191837/amirgem"}, "reply_to_user": {"reputation": 2345, "user_id": 4511585, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/IC7eZ.jpg?s=128&g=1", "display_name": "albttx", "link": "https://stackoverflow.com/users/4511585/albttx"}, "edited": false, "score": 0, "creation_date": 1501955456, "post_id": 45524553, "comment_id": 78009705, "body": "thanks, I&#39;ll give it a look. An issue I was having yesterday was that I managed to build my own small framework and ran perfectly with go run main.go but not while deploying to google cloud platform or testing with dev_appserver.py so I&#39;m rebuilding it all over again"}], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 8191837, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5f3395549c1d406659b0e8eafaf26fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Amirgem", "link": "https://stackoverflow.com/users/8191837/amirgem"}, "edited": false, "score": 1, "creation_date": 1502085789, "post_id": 45525915, "comment_id": 78040373, "body": "that&#39;s an interesting way of putting it, I was going with a whole other approach by having my handlers in an independent package that share structs and database services and just import that into my main"}], "tags": [], "owner": {"reputation": 3311, "user_id": 61363, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30ed41f682f716613fe62a0831f522dd?s=128&d=identicon&r=PG", "display_name": "del-boy", "link": "https://stackoverflow.com/users/61363/del-boy"}, "is_accepted": false, "score": 2, "last_activity_date": 1501963356, "creation_date": 1501963356, "answer_id": 45525915, "question_id": 45524553, "link": "https://stackoverflow.com/questions/45524553/does-golang-foment-no-file-structure/45525915#45525915", "title": "Does golang foment no file structure?", "body": "<p>You are partially right. Go does not enforce anything regarding file and package structure, except that it forbids circular dependencies. IMHO, this is a good thing, since you have freedom to choose what best suites you. </p>\n\n<p>However, it puts burden on you to decide what is the best. I have tried few approaches and depending on what I am doing (e.g. library, command line tool, service) I believe different approaches are best.</p>\n\n<p>If you are creating only command line tool, let root package (root of your repository) be <code>main</code>. If it is small tool, that is all you need. It might happen that you command line tool grows, so you might want to separate some stuff to their own that can, but does not have to be, in same repository.</p>\n\n<p>If you are creating library, do the same, except that package name will be name of your library, not <code>main</code>.</p>\n\n<p>If you need combination (something that is useful both as the library and command line tool), I would go with putting library code (everything public for the library) in VCS root, with potential sub-packages and <code>cmd/toolname</code> for your binary.</p>\n\n<p>When it comes to web services, I found it is most practical to follow <a href=\"https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1\" rel=\"nofollow noreferrer\">these</a> guidelines. It is best to read entire blog post, but in short - define your domain in VCS root, create <code>cmd/app</code> (or multiple) as command line entry point and create one package per dependency (e.g. memcache, database, http, etc). Your sub-packages never depend on each other explicitly, they only share domain definitions from root. It takes some getting used to and I am still adapting it to my use case, but so far it looks promising. </p>\n"}, {"comments": [{"owner": {"reputation": 109, "user_id": 8191837, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5f3395549c1d406659b0e8eafaf26fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Amirgem", "link": "https://stackoverflow.com/users/8191837/amirgem"}, "edited": false, "score": 0, "creation_date": 1502085544, "post_id": 45532051, "comment_id": 78040293, "body": "your structure actually gave me an idea since right now I&#39;m having issues with long codes for simple things, connecting, querying, storying into a slice and sending that to the template in a single file that ALSO contains my structs is playing with my ocd, I&#39;m trying to find a nice way to separate those into either a structs package (models for example) or using a service to call the database and have that handle the querying and storage into a slice"}, {"owner": {"reputation": 11, "user_id": 3592666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/405a50bac8c1992ede4eedbd06c2ff27?s=128&d=identicon&r=PG&f=1", "display_name": "Ibraheam", "link": "https://stackoverflow.com/users/3592666/ibraheam"}, "reply_to_user": {"reputation": 109, "user_id": 8191837, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5f3395549c1d406659b0e8eafaf26fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Amirgem", "link": "https://stackoverflow.com/users/8191837/amirgem"}, "edited": false, "score": 0, "creation_date": 1502298534, "post_id": 45532051, "comment_id": 78152994, "body": "I suggest you put these models in the root of the project together with the interface definition, and for each package that needs to provide a certain service it should implement it (Satisfies the interface to be precise)"}], "tags": [], "owner": {"reputation": 11, "user_id": 3592666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/405a50bac8c1992ede4eedbd06c2ff27?s=128&d=identicon&r=PG&f=1", "display_name": "Ibraheam", "link": "https://stackoverflow.com/users/3592666/ibraheam"}, "is_accepted": false, "score": 1, "last_activity_date": 1502049575, "last_edit_date": 1502049575, "creation_date": 1502022556, "answer_id": 45532051, "question_id": 45524553, "link": "https://stackoverflow.com/questions/45524553/does-golang-foment-no-file-structure/45532051#45532051", "title": "Does golang foment no file structure?", "body": "<p>As @del-boy said it depends on what you want to do, I went over this problem multiple times but what suited me more when developing a golang web app is to divide your packages by dependencies </p>\n\n<pre><code>- myproject \n-- cmd \n--- main.go\n-- http\n--- http.go\n-- postgres\n--- postgres.go\n-- mongodb\n--- mongodb.go\nmyproject.go\n</code></pre>\n\n<p><strong>myproject.go</strong> will contain the <strong>Interfaces</strong> and <strong>Structs</strong> that contain the main domain or business models</p>\n\n<p>For example you can have inside <strong>myproject.go</strong></p>\n\n<pre><code>type User struct {\nMongoID    bson.ObjectId `bson:\"_id,omitempty\"`\nPostgresID string\nUsername       string \n}\n</code></pre>\n\n<p>and an Interface like this</p>\n\n<pre><code>type UserService interface { \nGetUser(username string) (*User, error)\n}\n</code></pre>\n\n<p>Now in your <strong>http</strong> package you will handle exposing your api endpoints</p>\n\n<pre><code> //Handler represents an HTTP API interface for our app.\ntype Handler struct {\n    Router         *chi.Mux // you can use whatever router you like\n    UserService    myproject.UserService\n}\n\nfunc (h *Handler) ServeHTTP(w http.ResponseWriter, r *Request){\n//this just a wrapper for the Router ServeHTTP\nh.Router.ServeHTTP(w,r)\n}\n\nfunc (h *Handler) someHandler(w http.ResponseWriter, r *Request){\n//get the username from the request\n// \nuser := h.UserService.GetUser(username)\n}\n</code></pre>\n\n<p>in your postgres.go you can have a <strong>struct</strong> that implements <strong>UserService</strong> </p>\n\n<pre><code>type PostgresUserService struct {\nDB *sql.DB\n}\n</code></pre>\n\n<p>and then you implement the service</p>\n\n<pre><code>func (s *PostgresUserService) GetUser(username string) {\n//implement the method\n}\n</code></pre>\n\n<p>and the same thing can be done with mongodb</p>\n\n<pre><code>type MongoUserService struct {\nSession *mgo.Session\n}\n\nfunc (s *MongoUserService) GetUser(username string) {\n    //implement the method\n    }\n</code></pre>\n\n<p>Now in your cmd/main.go you can have something like this </p>\n\n<pre><code>func main(){\npostgresDB, err := postgres.Connect()\nmongoSession, err := mongo.Connect()\n\npostgresService := postgres.PostgresUserService{DB: postgresDB}\nmongoService := mongo.MongoUserService{Session: mongoSession}\n\n//then pass your services to your http handler\n// based on the underlying service your api will act based on the underlying service you passed \nmyHandler := http.Handler{}\nmyHandler.UserService = postgresService\n\n\n}\n</code></pre>\n\n<p>assuming you changed your underlying store you only have to change it in here and you will not change anything </p>\n\n<p>This design is heavily inspired from this <a href=\"https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1\" rel=\"nofollow noreferrer\">blog</a>, I hope you find it helpful</p>\n"}], "owner": {"reputation": 109, "user_id": 8191837, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5f3395549c1d406659b0e8eafaf26fcc?s=128&d=identicon&r=PG&f=1", "display_name": "Amirgem", "link": "https://stackoverflow.com/users/8191837/amirgem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1502049575, "creation_date": 1501953456, "question_id": 45524553, "link": "https://stackoverflow.com/questions/45524553/does-golang-foment-no-file-structure", "title": "Does golang foment no file structure?", "body": "<p>I've been looking into golang in order to build a web app, I like the language and everything, but I'm having trouble wrapping my head around the concept of structure in golang. It seems it pretty much forces me to have no file structure, no folders, no division, no separation of concerns. Is there any way to organize the .go files in a way that I'm not seeing? So far file structuring has been a headache and it's the only bad experience I've had with the language. Thank you!</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 1001, "user_id": 3998255, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/90363a3d7d1cb72cb2369e1fb1221216?s=128&d=identicon&r=PG&f=1", "display_name": "crazyGamer", "link": "https://stackoverflow.com/users/3998255/crazygamer"}, "edited": false, "score": 2, "creation_date": 1501938635, "post_id": 45522272, "comment_id": 78004742, "body": "Honestly, how big of a problem is it to add just the struct name in the construction code? <i>You would not want to restructure your classes based on how much you have to type, rather on what&#39;s right for the application.</i>"}, {"owner": {"reputation": 3, "user_id": 8298651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8ff81391d34f5f1391e011d996ab416?s=128&d=identicon&r=PG&f=1", "display_name": "peter", "link": "https://stackoverflow.com/users/8298651/peter"}, "reply_to_user": {"reputation": 1001, "user_id": 3998255, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/90363a3d7d1cb72cb2369e1fb1221216?s=128&d=identicon&r=PG&f=1", "display_name": "crazyGamer", "link": "https://stackoverflow.com/users/3998255/crazygamer"}, "edited": false, "score": 0, "creation_date": 1501938729, "post_id": 45522272, "comment_id": 78004767, "body": "Well, I am creating a package and I would like it to be as streamlined as possible."}, {"owner": {"reputation": 3, "user_id": 8298651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8ff81391d34f5f1391e011d996ab416?s=128&d=identicon&r=PG&f=1", "display_name": "peter", "link": "https://stackoverflow.com/users/8298651/peter"}, "reply_to_user": {"reputation": 1001, "user_id": 3998255, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/90363a3d7d1cb72cb2369e1fb1221216?s=128&d=identicon&r=PG&f=1", "display_name": "crazyGamer", "link": "https://stackoverflow.com/users/3998255/crazygamer"}, "edited": false, "score": 0, "creation_date": 1501938887, "post_id": 45522272, "comment_id": 78004816, "body": "@crazyGamer emitting the word <code>ForSale</code> and changing <code>ForSaleFilter</code> to <code>ForSale</code> seems to work."}, {"owner": {"reputation": 1001, "user_id": 3998255, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/90363a3d7d1cb72cb2369e1fb1221216?s=128&d=identicon&r=PG&f=1", "display_name": "crazyGamer", "link": "https://stackoverflow.com/users/3998255/crazygamer"}, "edited": false, "score": 1, "creation_date": 1501939062, "post_id": 45522272, "comment_id": 78004867, "body": "There is a difference between the two approaches, beyond cosmetics - what you have done now is <b>composition</b>, which is one of the object-oriented patterns of Go for supporting inheritance in a way. If that better serves the purpose of your module, it is a good approach."}, {"owner": {"reputation": 3, "user_id": 8298651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8ff81391d34f5f1391e011d996ab416?s=128&d=identicon&r=PG&f=1", "display_name": "peter", "link": "https://stackoverflow.com/users/8298651/peter"}, "reply_to_user": {"reputation": 1001, "user_id": 3998255, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/90363a3d7d1cb72cb2369e1fb1221216?s=128&d=identicon&r=PG&f=1", "display_name": "crazyGamer", "link": "https://stackoverflow.com/users/3998255/crazygamer"}, "edited": false, "score": 0, "creation_date": 1501939610, "post_id": 45522272, "comment_id": 78005033, "body": "maybe you could explain what the difference is for the answer?"}, {"owner": {"reputation": 1001, "user_id": 3998255, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/90363a3d7d1cb72cb2369e1fb1221216?s=128&d=identicon&r=PG&f=1", "display_name": "crazyGamer", "link": "https://stackoverflow.com/users/3998255/crazygamer"}, "edited": false, "score": 0, "creation_date": 1501939862, "post_id": 45522272, "comment_id": 78005108, "body": "In your case, type embedding seems to cause no harm. For a better understanding, I would recommend reading <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">this</a> section. Main uses: implicitly implement interfaces, reduce book-keeping, convenience, alternative to inheritence."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501958788, "post_id": 45522272, "comment_id": 78010668, "body": "You know you can put each field on it&#39;s own line right? It makes it a lot easier to read."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 1001, "user_id": 3998255, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/90363a3d7d1cb72cb2369e1fb1221216?s=128&d=identicon&r=PG&f=1", "display_name": "crazyGamer", "link": "https://stackoverflow.com/users/3998255/crazygamer"}, "edited": false, "score": 0, "creation_date": 1502102723, "post_id": 45522272, "comment_id": 78049586, "body": "@crazyGamer Embedding structs is <b>not the same</b> as inheritance. Go doesn&#39;t have inheritance because it isn&#39;t object oriented."}, {"owner": {"reputation": 1001, "user_id": 3998255, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/90363a3d7d1cb72cb2369e1fb1221216?s=128&d=identicon&r=PG&f=1", "display_name": "crazyGamer", "link": "https://stackoverflow.com/users/3998255/crazygamer"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1502184884, "post_id": 45522272, "comment_id": 78088102, "body": "@RayfenWindspear: I completely agree, I <b>never said they are  the same</b>, I just said the closest to that in Go is embedding - see this line from <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">Effective Go</a>: &quot;Go does not provide the typical, type-driven notion of subclassing, but it does have the ability to \u201cborrow\u201d pieces of an implementation by embedding types within a struct or interface.&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 8382108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65a0602db58e2dbccc8452a2565d0c00?s=128&d=identicon&r=PG", "display_name": "Ahui", "link": "https://stackoverflow.com/users/8382108/ahui"}, "is_accepted": false, "score": 0, "last_activity_date": 1501948943, "last_edit_date": 1501948943, "creation_date": 1501948203, "answer_id": 45523754, "question_id": 45522272, "link": "https://stackoverflow.com/questions/45522272/initialize-struct-with-substructs/45523754#45523754", "title": "initialize struct with substructs", "body": "<p>Declare a variable for basic types, or for a struct that contains only basic types, the variable is also initialized in Go.</p>\n\n<p>Thus, after declaration, it can be used immediately.</p>\n\n<pre><code>var filter Filter\nfilter.ForSale.Search = \"cool stuff\"\n</code></pre>\n\n<p>or</p>\n\n<pre><code>filter := Filter{}\nfilter.ForSale.Search = \"cool stuff\"\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 8298651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8ff81391d34f5f1391e011d996ab416?s=128&d=identicon&r=PG&f=1", "display_name": "peter", "link": "https://stackoverflow.com/users/8298651/peter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1501948943, "creation_date": 1501938449, "question_id": 45522272, "link": "https://stackoverflow.com/questions/45522272/initialize-struct-with-substructs", "title": "initialize struct with substructs", "body": "<p>I am trying to create a struct with values of other structs. For example a <code>Filter</code>:</p>\n\n<pre><code>type ForSaleFilter struct {\n        Search string\n}\ntype JobFilter struct {\n        JobType string\n}\ntype Filter struct {\n        ForSale ForSaleFilter\n        Jobs JobFilter\n\n}\n</code></pre>\n\n<p>I can't seem to figure out a better way to create the struct than this long line of code: </p>\n\n<p><code>filter := Filter{ForSale: ForSaleFilter{Search: \"cool stuff\"}}</code></p>\n\n<p>Is there a better way I can create this? Something like </p>\n\n<p><code>filter := Filter{ForSale{Search: \"cool stuff\"}}</code></p>\n\n<p>would be ideal. Maybe I could restructure my structs to do this?</p>\n"}, {"tags": ["windows", "go", "gomobile"], "answers": [{"comments": [{"owner": {"reputation": 309, "user_id": 8394326, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10213751014238196/picture?type=large", "display_name": "Traor&#233; Moussa", "link": "https://stackoverflow.com/users/8394326/traor%c3%a9-moussa"}, "edited": false, "score": 0, "creation_date": 1501962452, "post_id": 45522450, "comment_id": 78011716, "body": "Where is the path to downloaded packages ? I thought it would be in $GOPATH/bin as the go command"}, {"owner": {"reputation": 2107, "user_id": 1968354, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5bf273b96c177d846813c35f7d1d214d?s=128&d=identicon&r=PG", "display_name": "NeatNerd", "link": "https://stackoverflow.com/users/1968354/neatnerd"}, "reply_to_user": {"reputation": 309, "user_id": 8394326, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10213751014238196/picture?type=large", "display_name": "Traor&#233; Moussa", "link": "https://stackoverflow.com/users/8394326/traor%c3%a9-moussa"}, "edited": false, "score": 0, "creation_date": 1501962570, "post_id": 45522450, "comment_id": 78011750, "body": "depends if u ran <code>go build</code>, otherwise it is in src/golang.org - etc"}, {"owner": {"reputation": 309, "user_id": 8394326, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10213751014238196/picture?type=large", "display_name": "Traor&#233; Moussa", "link": "https://stackoverflow.com/users/8394326/traor%c3%a9-moussa"}, "edited": false, "score": 0, "creation_date": 1501962896, "post_id": 45522450, "comment_id": 78011836, "body": "There is nothing like src/golang.org :/"}], "tags": [], "owner": {"reputation": 2107, "user_id": 1968354, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5bf273b96c177d846813c35f7d1d214d?s=128&d=identicon&r=PG", "display_name": "NeatNerd", "link": "https://stackoverflow.com/users/1968354/neatnerd"}, "is_accepted": false, "score": 0, "last_activity_date": 1501939585, "creation_date": 1501939585, "answer_id": 45522450, "question_id": 45521671, "link": "https://stackoverflow.com/questions/45521671/how-can-i-install-go-mobile-and-have-it-work-on-windows/45522450#45522450", "title": "How can I install go mobile and have it work on windows?", "body": "<p>Have you added the path to gomobile location to your PATH variable?</p>\n\n<p>Check if it is included with batch command</p>\n\n<pre><code>set PATH\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 309, "user_id": 8394326, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10213751014238196/picture?type=large", "display_name": "Traor&#233; Moussa", "link": "https://stackoverflow.com/users/8394326/traor%c3%a9-moussa"}, "is_accepted": true, "score": 1, "last_activity_date": 1501966765, "creation_date": 1501966765, "answer_id": 45526372, "question_id": 45521671, "link": "https://stackoverflow.com/questions/45521671/how-can-i-install-go-mobile-and-have-it-work-on-windows/45526372#45526372", "title": "How can I install go mobile and have it work on windows?", "body": "<p>So I figured the PATH where the go executable is differs from GOPATH. To find what my GOPATH was, I used the command </p>\n\n<p><code>go env GOPATH</code></p>\n"}], "owner": {"reputation": 309, "user_id": 8394326, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10213751014238196/picture?type=large", "display_name": "Traor&#233; Moussa", "link": "https://stackoverflow.com/users/8394326/traor%c3%a9-moussa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1080, "favorite_count": 0, "accepted_answer_id": 45526372, "answer_count": 2, "score": 1, "last_activity_date": 1501966765, "creation_date": 1501934572, "last_edit_date": 1501962579, "question_id": 45521671, "link": "https://stackoverflow.com/questions/45521671/how-can-i-install-go-mobile-and-have-it-work-on-windows", "title": "How can I install go mobile and have it work on windows?", "body": "<p>I am having issues installing gomobile on windows with the command : \n<code>go get golang.org/x/mobile/cmd/gomobile</code></p>\n\n<p>It doesn't give me any error but it doesn't seem to be doing anything. When trying to execute gomobile afterwards I get the error: </p>\n\n<p><code>'gomobile' is not recognized as an internal or external command,\noperable program or batch file.</code></p>\n"}, {"tags": ["mysql", "sql", "multithreading", "go"], "answers": [{"comments": [{"owner": {"reputation": 299, "user_id": 1548418, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a553af9b3cbd96986a0405e29936b6bc?s=128&d=identicon&r=PG", "display_name": "user1548418", "link": "https://stackoverflow.com/users/1548418/user1548418"}, "edited": false, "score": 0, "creation_date": 1501933685, "post_id": 45521249, "comment_id": 78003347, "body": "Thanks, I just wanted to make sure my understanding is correct."}], "tags": [], "owner": {"reputation": 79883, "user_id": 205608, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/61eE0.png?s=128&g=1", "display_name": "O. Jones", "link": "https://stackoverflow.com/users/205608/o-jones"}, "is_accepted": true, "score": 3, "last_activity_date": 1501932128, "last_edit_date": 1501932128, "creation_date": 1501931565, "answer_id": 45521249, "question_id": 45520813, "link": "https://stackoverflow.com/questions/45520813/thread-safety-of-sql-result-lastinsertid/45521249#45521249", "title": "Thread safety of sql.Result.LastInsertId()", "body": "<p>The MySQL client-server protocol returns the value of <code>LAST_INSERT_ID()</code> in response packets to queries performing an <code>INSERT</code> operation. Generally the client APIs give that back to client code using methods like <code>sql.Result.LastInsertId()</code> in the SQL API. No round-trip query is required.</p>\n\n<p>So the answer to your question is \"the first INSERT.\"</p>\n\n<p>To be clear, MySQL connections aren't thread safe in the broad sense. Instead, they are serially reusable resources. Multi-threaded client environments make them appear thread-safe by managing the serial reuse. You have described how that works for <code>golang</code> in your question.</p>\n"}], "owner": {"reputation": 299, "user_id": 1548418, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a553af9b3cbd96986a0405e29936b6bc?s=128&d=identicon&r=PG", "display_name": "user1548418", "link": "https://stackoverflow.com/users/1548418/user1548418"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 412, "favorite_count": 0, "accepted_answer_id": 45521249, "answer_count": 1, "score": 1, "last_activity_date": 1501932128, "creation_date": 1501928584, "last_edit_date": 1501928758, "question_id": 45520813, "link": "https://stackoverflow.com/questions/45520813/thread-safety-of-sql-result-lastinsertid", "title": "Thread safety of sql.Result.LastInsertId()", "body": "<p>The SQL docs say that <code>LAST_INSERT_ID()</code> works on \"per-connection\" basis, that is, the last insert ID value will not be overwritten by <code>INSERT</code> statements executed through other connections.</p>\n\n<p>AFAIU, in Go (unlike PHP for example) we don't create separate DB connections on each client request. Instead, we are told to create just one instance of <code>sql.DB</code> object, which manages a pool of SQL connections under the hood. Consequently, they say, there is no guarantee that two consecutive SQL statements in a Go program (even in the same thread) will be executed through the same DB connection. Therefore, the opposite could be the case \u2013 two different threads could execute two different SQL statements on the same (reused) DB connection.</p>\n\n<p>The question is: could this automatic connection management inside <code>sql.DB</code> affect the thread safety of <code>sql.Result.LastInsertId()</code>?</p>\n\n<p>Consider the following case: Right after the <code>INSERT</code> statement in one thread, the <code>sql.DB</code> object reuses the connection in another thread and the other thread executes another <code>INSERT</code> statement on that same (reused) connection. Afterwards, the first thread queries the <code>sql.Result.LastInsertId()</code>. </p>\n\n<p>Will this return row ID of the second <code>INSERT</code> or the first <code>INSERT</code>? Is the last insert ID cached at the moment of the statement execution, or is it causing a separate statement to be sent to the DB connection? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 466, "user_id": 8307258, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8i2o.jpg?s=128&g=1", "display_name": "Rados\u0142aw Za\u0142uska", "link": "https://stackoverflow.com/users/8307258/rados%c5%82aw-za%c5%82uska"}, "edited": false, "score": 1, "creation_date": 1501924584, "post_id": 45520191, "comment_id": 78001062, "body": "Go 1.9 (to be released in August 2017 - pre release is no available) will ship <a href=\"https://beta.golang.org/pkg/math/bits/#OnesCount\" rel=\"nofollow noreferrer\">beta.golang.org/pkg/math/bits/#OnesCount</a> and other bit manipulation functions. As we can read from <a href=\"https://beta.golang.org/doc/go1.9#math-bits\" rel=\"nofollow noreferrer\">documentation</a>  It will be optimized per architecture."}], "answers": [{"tags": [], "owner": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "is_accepted": true, "score": 2, "last_activity_date": 1501924939, "creation_date": 1501924939, "answer_id": 45520296, "question_id": 45520191, "link": "https://stackoverflow.com/questions/45520191/how-count-how-many-one-bit-have-in-byte-in-golang/45520296#45520296", "title": "How count how many one bit have in byte, in Golang?", "body": "<p>Given that the input is a single byte probably a lookup table is the best option... only takes 256 bytes and you get code like</p>\n\n<pre><code>var count = bitcount[input];\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 989, "user_id": 5016244, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/bdZPE.jpg?s=128&g=1", "display_name": "Theophile Dano", "link": "https://stackoverflow.com/users/5016244/theophile-dano"}, "is_accepted": false, "score": 2, "last_activity_date": 1501925770, "last_edit_date": 1501925770, "creation_date": 1501925322, "answer_id": 45520356, "question_id": 45520191, "link": "https://stackoverflow.com/questions/45520191/how-count-how-many-one-bit-have-in-byte-in-golang/45520356#45520356", "title": "How count how many one bit have in byte, in Golang?", "body": "<p>Given that this function will be available in the package<a href=\"https://github.com/golang/go/blob/release-branch.go1.9/src/math/bits/bits.go\" rel=\"nofollow noreferrer\"><code>math/bits</code></a> in the next Go release (1.9 this August) here is the code for a 32-bit integer.</p>\n\n<pre><code>// OnesCount32 returns the number of one bits (\"population count\") in x.\nfunc OnesCount32(x uint32) int {\n    return int(pop8tab[x&gt;&gt;24] + pop8tab[x&gt;&gt;16&amp;0xff] + pop8tab[x&gt;&gt;8&amp;0xff] + pop8tab[x&amp;0xff])\n}\n</code></pre>\n\n<p>Where the <code>pop8tab</code> is defined <a href=\"https://github.com/golang/go/blob/83bc4a2feed1c7dc37026278364772483fe73618/src/math/bits/bits_tables.go#L28\" rel=\"nofollow noreferrer\">here</a>. And for your question in particular : 8bits</p>\n\n<pre><code>func OnesCount8(x uint8) int {\n    return int(pop8tab[x])\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "is_accepted": false, "score": 1, "last_activity_date": 1502092508, "creation_date": 1502092508, "answer_id": 45541924, "question_id": 45520191, "link": "https://stackoverflow.com/questions/45520191/how-count-how-many-one-bit-have-in-byte-in-golang/45541924#45541924", "title": "How count how many one bit have in byte, in Golang?", "body": "<p>It is also possible to count bits with binary operations. See this <a href=\"https://graphics.stanford.edu/~seander/bithacks.html#CountBitsSetParallel\" rel=\"nofollow noreferrer\">bit twiddling hacks</a>.</p>\n\n<pre><code>func bitSetCount(v byte) byte {\n    v = (v &amp; 0x55) + ((v&gt;&gt;1) &amp; 0x55)\n    v = (v &amp; 0x33) + ((v&gt;&gt;2) &amp; 0x33)\n    return (v + (v&gt;&gt;4)) &amp; 0xF\n}\n</code></pre>\n\n<p>You'll have to benchmark to see if this is faster than the lookup table which is the simplest to implement.</p>\n"}, {"tags": [], "owner": {"reputation": 1714, "user_id": 7404323, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/jYEFn.png?s=128&g=1", "display_name": "sailfish009", "link": "https://stackoverflow.com/users/7404323/sailfish009"}, "is_accepted": false, "score": 1, "last_activity_date": 1502092925, "creation_date": 1502092925, "answer_id": 45542046, "question_id": 45520191, "link": "https://stackoverflow.com/questions/45520191/how-count-how-many-one-bit-have-in-byte-in-golang/45542046#45542046", "title": "How count how many one bit have in byte, in Golang?", "body": "<p>there is POPCNT golang version:</p>\n\n<p><a href=\"https://github.com/tmthrgd/go-popcount\" rel=\"nofollow noreferrer\">https://github.com/tmthrgd/go-popcount</a></p>\n"}], "owner": {"reputation": 312, "user_id": 3043018, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/GJ4VU.jpg?s=128&g=1", "display_name": "Inkeliz", "link": "https://stackoverflow.com/users/3043018/inkeliz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2398, "favorite_count": 1, "accepted_answer_id": 45520296, "answer_count": 4, "score": 0, "last_activity_date": 1502092925, "creation_date": 1501924230, "last_edit_date": 1501924704, "question_id": 45520191, "link": "https://stackoverflow.com/questions/45520191/how-count-how-many-one-bit-have-in-byte-in-golang", "title": "How count how many one bit have in byte, in Golang?", "body": "<p>Suppose I have two variables, that only use 6 bits:</p>\n\n<pre><code>var a byte = 31  // 00011111\nvar b byte = 50  // 00110010\n</code></pre>\n\n<p>The first (<code>a</code>) have more one bits than the <code>b</code>, however the <code>b</code> is greater than <code>a</code> of course, <em>so is not possible use <code>a &gt; b</code>.</em></p>\n\n<p>To achieve what I need, I do one loop:</p>\n\n<pre><code>func countOneBits(byt byte) int {\n    var counter int\n    var divider byte\n\n    for divider = 32; divider &gt;= 1; divider &gt;&gt;= 1 {\n        if byt &amp; divider == divider {\n            counter++\n        }\n\n    }\n\n    return counter\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/yri7YSpnYx\" rel=\"nofollow noreferrer\">This works,</a> I can use <code>countOneBits(a) &gt; countOneBits(b)</code>...</p>\n\n<hr>\n\n<p>But I don't think is the best solution for this case, I don't think this need a loop and because of it I'm here.</p>\n\n<p><strong>Have a better alternative (in performance aspect) to count how many <code>1</code> have in six bits?</strong> </p>\n"}, {"tags": ["google-app-engine", "go"], "owner": {"reputation": 802, "user_id": 2018909, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/10ebdad579fc333db3830e893baf977e?s=128&d=identicon&r=PG", "display_name": "srini", "link": "https://stackoverflow.com/users/2018909/srini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 183, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1501922513, "creation_date": 1501922513, "question_id": 45519967, "link": "https://stackoverflow.com/questions/45519967/appengine-dev-appserver-py-did-not-use-the-correct-gopath", "title": "appengine dev_appserver.py did not use the correct GOPATH", "body": "<p>Per this <a href=\"https://blog.golang.org/the-app-engine-sdk-and-workspaces-gopath\" rel=\"nofollow noreferrer\">go blog</a>, the appengine SDK is supposed to be able to detect <code>GOPATH</code>, but looks like that is not the case. Instead it is considering some path in the appengine SDK installation dir as the <code>GOPATH</code>. Any thoughts on how to make the appengine work with the existing GOPATH, without having to change it?</p>\n\n<pre><code>dev_appserver.py app.yaml\n\n\n................\n\nCan't find package \"github.com/gorilla/context\" in $GOPATH: cannot find package \"github.com/gorilla/context\" in any of:\n/Users/muly_ae/Applications/google-cloud-sdk/platform/google_appengine/goroot-1.6/src/github.com/gorilla/context (from $GOROOT)\n/Users/muly_ae/Applications/google-cloud-sdk/platform/google_appengine/gopath/src/github.com/gorilla/context (from $GOPATH)\n</code></pre>\n\n<p>Here is my Go env:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/muly_ae/go\"\nGORACE=\"\"\nGOROOT=\"/usr/local/Cellar/go/1.8.3/libexec\"\nGOTOOLDIR=\"/usr/local/Cellar/go/1.8.3/libexec/pkg/tool/darwin_amd64\"\nGCCGO=\"gccgo\"\nCC=\"clang\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -gno-record-gcc-switches -fno-common\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\nPKG_CONFIG=\"pkg-config\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\n</code></pre>\n"}, {"tags": ["pointers", "go", "struct", "interface"], "answers": [{"tags": [], "owner": {"reputation": 466, "user_id": 8307258, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8i2o.jpg?s=128&g=1", "display_name": "Rados\u0142aw Za\u0142uska", "link": "https://stackoverflow.com/users/8307258/rados%c5%82aw-za%c5%82uska"}, "is_accepted": true, "score": 0, "last_activity_date": 1501924262, "last_edit_date": 1501924262, "creation_date": 1501923460, "answer_id": 45520100, "question_id": 45519669, "link": "https://stackoverflow.com/questions/45519669/pointer-to-interface-in-method-args/45520100#45520100", "title": "Pointer to interface in method args?", "body": "<p>Let me explain:</p>\n\n<p>First of all in this function:</p>\n\n<pre><code>func (predator Cat) eatingVictim(victim *Mouse) {\n    fmt.Println(predator.name + \"'s eating victim \" + victim.name)\n    predator.hungry = false\n    victim.alive = false\n}\n</code></pre>\n\n<p>You want to pass Herbivore. This is a bad solution because you will not\nuse methods from Herbivore interface here. Better approach is to define\nanother interface.</p>\n\n<pre><code>type Animal interface {\n    GetName() string\n    SetAlive(bool)\n}\n</code></pre>\n\n<p>And implement it for Mouse (and Cat if you wish):</p>\n\n<pre><code>func (m *Mouse) GetName() string {\n    return m.name\n}\n\nfunc (m *Mouse) SetAlive(alive bool) {\n    m.alive = alive\n}\n</code></pre>\n\n<p>Then change interface Predator to:</p>\n\n<pre><code>type Predator interface {\n    eatingVictim(victim Animal)\n}\n</code></pre>\n\n<p>and implement it for Cat</p>\n\n<pre><code>func (predator *Cat) eatingVictim(victim Animal) {\n    fmt.Println(predator.name + \"'s eating victim \" + victim.GetName())\n    predator.hungry = false\n    victim.SetAlive(false)\n}\n</code></pre>\n\n<p>I need to mention  that if you want your original structs to\nbe modified then you need to pass a pointer to struct, not a struct as\nreceiver argument:</p>\n\n<p>Here Mouse struct will not be modified. Only a copy of it.</p>\n\n<pre><code>func (herbivore Mouse) eatingGrass() {\n    fmt.Println(herbivore.name + \"'s eating a grass.. ^___^\")\n    herbivore.hungry = false\n}\n</code></pre>\n\n<p>And here is the fixed version:</p>\n\n<pre><code>func (herbivore *Mouse) eatingGrass() {\n    fmt.Println(herbivore.name + \"'s eating a grass.. ^___^\")\n    herbivore.hungry = false\n}\n</code></pre>\n\n<p>If you want better explanation for this - then visit\n<a href=\"https://www.writeingo.com/blog/method-receiver-types-in-go/\" rel=\"nofollow noreferrer\">my blog post</a></p>\n\n<p>The last thing - as best practice - if you used Struct pointer in one of the methods of your\ntype then all of them should take a pointer to it.</p>\n\n<p>Final solution:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Predator interface {\n    eatingVictim(victim Animal)\n}\n\ntype Herbivore interface {\n    eatingGrass()\n}\n\ntype Animal interface {\n    GetName() string\n    SetAlive(bool)\n}\n\ntype Cat struct {\n    name   string\n    hungry bool\n    alive  bool\n}\n\ntype Mouse struct {\n    name   string\n    hungry bool\n    alive  bool\n}\n\nfunc (herbivore *Mouse) eatingGrass() {\n    fmt.Println(herbivore.name + \"'s eating a grass.. ^___^\")\n    herbivore.hungry = false\n}\n\nfunc (m *Mouse) GetName() string {\n    return m.name\n}\n\nfunc (m *Mouse) SetAlive(alive bool) {\n    m.alive = alive\n}\n\nfunc (predator *Cat) eatingVictim(victim Animal) {\n    fmt.Println(predator.name + \"'s eating victim \" + victim.GetName())\n    predator.hungry = false\n    victim.SetAlive(false)\n}\n\nfunc main() {\n    cat := Cat{\"cat\", true, true}\n    mouse := Mouse{\"mouse\", true, true}\n\n    fmt.Println(cat)\n    fmt.Println(mouse)\n\n    mouse.eatingGrass()\n    cat.eatingVictim(&amp;mouse)\n\n    fmt.Println(cat)\n    fmt.Println(mouse)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 0, "last_activity_date": 1501923500, "creation_date": 1501923500, "answer_id": 45520106, "question_id": 45519669, "link": "https://stackoverflow.com/questions/45519669/pointer-to-interface-in-method-args/45520106#45520106", "title": "Pointer to interface in method args?", "body": "<p>First you need to add a <code>Name()</code> and a <code>SetAlive()</code> method to the interface and make <code>eatingGrass</code> exported:</p>\n\n<pre><code>type Herbivore interface {\n    Name()string\n    SetAlive(bool)\n    EatingGrass()\n}\n</code></pre>\n\n<p>Then you need to implement <code>Name()</code> for mouse:</p>\n\n<pre><code>func (herbivore *Mouse) Name()string {\n    return Mouse.name\n}\n</code></pre>\n\n<p>Then do the same for SetAlive.</p>\n\n<p>Now you can use the interface:</p>\n\n<pre><code>func (predator Cat) eatingVictim(h Herbivore) {\n    fmt.Println(predator.name + \"'s eating victim \" + h.Name())\n    predator.hungry = false\n    h.SetAlive(false)\n}\n</code></pre>\n\n<p>Note: You should implement all the functions for the <code>*Mouse</code>. Because when you set some values of the struct you should implement the method for the pointer and not the struct. Otherwise you can have bugs.</p>\n\n<p>When implementing it is also better to define the varibale like this:</p>\n\n<pre><code>func (m *Mouse) Name() string {\n  return m.name\n}\n</code></pre>\n"}], "owner": {"reputation": 157, "user_id": 3866810, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/KXSc1.png?s=128&g=1", "display_name": "zett", "link": "https://stackoverflow.com/users/3866810/zett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 45520100, "answer_count": 2, "score": 0, "last_activity_date": 1501925211, "creation_date": 1501919972, "last_edit_date": 1501925211, "question_id": 45519669, "link": "https://stackoverflow.com/questions/45519669/pointer-to-interface-in-method-args", "title": "Pointer to interface in method args?", "body": "<p><a href=\"https://gist.github.com/v-gachkovsky/0c036a85402e74c94d8410d0444a7e6a\" rel=\"nofollow noreferrer\">Gist with code</a></p>\n\n<p>How can I use interface Herbivore instead *Mouse in line 30?</p>\n\n<p>I want to pass to method <code>eatingVictim</code> different structs which implements Herbivore interface, not only Mouse</p>\n"}, {"tags": ["go", "tcp"], "comments": [{"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1501915438, "post_id": 45519075, "comment_id": 77998981, "body": "<code>ioutil.ReadFile</code> returns the byte slice. So just write as is <code>conn.Write(dat)</code> or write without pad <code>conn.Write([]byte(&quot;&quot; + string(dat)))</code>."}, {"owner": {"reputation": 4969, "user_id": 95175, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/91958ffd49486ecc65236951c7d44aa1?s=128&d=identicon&r=PG", "display_name": "Jamis Charles", "link": "https://stackoverflow.com/users/95175/jamis-charles"}, "reply_to_user": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1501917851, "post_id": 45519075, "comment_id": 77999498, "body": "@jeevatkm I&#39;ve tried both. I believe the first returns empty. The second returns <code>%</code>."}, {"owner": {"reputation": 466, "user_id": 8307258, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8i2o.jpg?s=128&g=1", "display_name": "Rados\u0142aw Za\u0142uska", "link": "https://stackoverflow.com/users/8307258/rados%c5%82aw-za%c5%82uska"}, "edited": false, "score": 2, "creation_date": 1501925814, "post_id": 45519075, "comment_id": 78001354, "body": "Why are you using curl if your protocol is not HTTP?. Use Netcat (nc localhost port) and it will be working."}, {"owner": {"reputation": 4969, "user_id": 95175, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/91958ffd49486ecc65236951c7d44aa1?s=128&d=identicon&r=PG", "display_name": "Jamis Charles", "link": "https://stackoverflow.com/users/95175/jamis-charles"}, "reply_to_user": {"reputation": 466, "user_id": 8307258, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8i2o.jpg?s=128&g=1", "display_name": "Rados\u0142aw Za\u0142uska", "link": "https://stackoverflow.com/users/8307258/rados%c5%82aw-za%c5%82uska"}, "edited": false, "score": 0, "creation_date": 1501941172, "post_id": 45519075, "comment_id": 78005464, "body": "@RadekZa\u0142uska Doh! That did it. Please write the answer and I will accept it. Thx."}], "answers": [{"tags": [], "owner": {"reputation": 466, "user_id": 8307258, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8i2o.jpg?s=128&g=1", "display_name": "Rados\u0142aw Za\u0142uska", "link": "https://stackoverflow.com/users/8307258/rados%c5%82aw-za%c5%82uska"}, "is_accepted": true, "score": 2, "last_activity_date": 1501943224, "creation_date": 1501943224, "answer_id": 45523001, "question_id": 45519075, "link": "https://stackoverflow.com/questions/45519075/in-golang-why-is-conn-write-tcp-response-empty/45523001#45523001", "title": "In Golang, why is conn.Write tcp response empty?", "body": "<p>Don't use Curl if you are not using HTTP protocol. Curl is expecting certain format of the message that is compatible with HTTP protocol.\nIf you send text \"true\", that is for sure not valid HTTP Header.</p>\n\n<p>To test TCP server use Netcat instead:</p>\n\n<pre><code>nc localhost port\n</code></pre>\n"}], "owner": {"reputation": 4969, "user_id": 95175, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/91958ffd49486ecc65236951c7d44aa1?s=128&d=identicon&r=PG", "display_name": "Jamis Charles", "link": "https://stackoverflow.com/users/95175/jamis-charles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 408, "favorite_count": 0, "accepted_answer_id": 45523001, "answer_count": 1, "score": -1, "last_activity_date": 1501943224, "creation_date": 1501915112, "question_id": 45519075, "link": "https://stackoverflow.com/questions/45519075/in-golang-why-is-conn-write-tcp-response-empty", "title": "In Golang, why is conn.Write tcp response empty?", "body": "<p>I have a tcp server that reads a file that sends the file content to the client.</p>\n\n<p>The 'status.txt' file contains only a boolean.</p>\n\n<p>When I curl, this shows <code>true</code> (with leading space).</p>\n\n<pre><code>dat, err := ioutil.ReadFile(\"./status.txt\")\nconn.Write([]byte(\" \" + string(dat)))\n</code></pre>\n\n<p>Whereas this code results in <code>curl: (52) Empty reply from server</code>. </p>\n\n<pre><code>conn.Write([]byte(string(dat)))\n</code></pre>\n\n<p>Any clue why this happens? I don't want to have to pad my response string.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 3, "creation_date": 1501913259, "post_id": 45518424, "comment_id": 77998450, "body": "You cannot do it, refer to <a href=\"https://stackoverflow.com/a/21268855\">SO Post</a>. Possible duplicate."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1501920811, "post_id": 45518424, "comment_id": 78000146, "body": "Disallowed by the language."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 3849740, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KBVzM.jpg?s=128&g=1", "display_name": "innomon", "link": "https://stackoverflow.com/users/3849740/innomon"}, "is_accepted": false, "score": -2, "last_activity_date": 1551503851, "last_edit_date": 1551503851, "creation_date": 1551489100, "answer_id": 54954326, "question_id": 45518424, "link": "https://stackoverflow.com/questions/45518424/embedding-anonymous-structs/54954326#54954326", "title": "Embedding anonymous structs", "body": "<p>Try the following:</p>\n\n<pre><code>type TestObj1 struct {\n    ExO ExtraObj `json:\"extras\"`\n}\n\ntype ExtraObj struct {\n    Foo string `json:\"foo\"`\n}\n</code></pre>\n\n<p>I did not test it myself, but should work.</p>\n"}], "owner": {"reputation": 323, "user_id": 6621535, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4hxqL.png?s=128&g=1", "display_name": "Vikram", "link": "https://stackoverflow.com/users/6621535/vikram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1229, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1551503851, "creation_date": 1501909411, "question_id": 45518424, "link": "https://stackoverflow.com/questions/45518424/embedding-anonymous-structs", "title": "Embedding anonymous structs", "body": "<p>I'm trying to figure out how to embed an anonymous struct within another struct, for json parsing purposes. </p>\n\n<p>I have an \"extras\" map that contains different attributes dependent on various factors. This map is a field of a larger json blob. I'd like to fully model out the various possibilities of the \"extras\" map so I can avoid using type assertions. I would like to have the \"extras\" structs be separate from the base struct (the rest of the json). I know I can do something like this:</p>\n\n<pre><code>type TestObj1 struct {\n    ExtraObj `json:\"extras\"`\n}\n\ntype ExtraObj struct {\n    Foo string `json:\"foo\"`\n}\n</code></pre>\n\n<p>This works great, because the json parses exactly how I would expect, and I can directly access <code>Foo</code> like so <code>testObj1.Foo</code>. The problem with this method is that now I have 2 different structs per possible \"extras\" variation, instead of 1. So then I could try something like this:</p>\n\n<pre><code>type TestObj2 struct {\n    Extras struct {\n        Foo string `json:\"foo\"`\n    } `json:\"extras\"`\n}\n</code></pre>\n\n<p>This also parses the json as expected, and gets rid of the need for 2 structs per variation. But the problem is, to access <code>Foo</code>, I need to go through <code>Extras</code> like so <code>testObj2.Extras.Foo</code>. I was hoping for a best of both worlds solution like so:</p>\n\n<pre><code>type TestObj3 struct {\n    struct {\n        Foo string `json:\"foo\"`\n    } `json:\"extras\"`\n}\n</code></pre>\n\n<p>But this is a compile error. A quick <a href=\"https://play.golang.org/p/965iYHBEdn\" rel=\"nofollow noreferrer\">playground link</a> I put together for this.</p>\n\n<p>Is there any way to accomplish something like this, or is it not possible in the language? Your help is greatly appreciated!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 989, "user_id": 5016244, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/bdZPE.jpg?s=128&g=1", "display_name": "Theophile Dano", "link": "https://stackoverflow.com/users/5016244/theophile-dano"}, "edited": false, "score": 0, "creation_date": 1501925639, "post_id": 45517523, "comment_id": 78001309, "body": "<code>for true { print(&quot;.&quot;) }</code>"}], "answers": [{"tags": [], "owner": {"reputation": 1304, "user_id": 5125201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bff70a4545b368f2aca2a97de7b234b2?s=128&d=identicon&r=PG", "display_name": "Ammar Bandukwala", "link": "https://stackoverflow.com/users/5125201/ammar-bandukwala"}, "is_accepted": false, "score": 4, "last_activity_date": 1501898566, "creation_date": 1501898566, "answer_id": 45517539, "question_id": 45517523, "link": "https://stackoverflow.com/questions/45517523/how-to-get-a-go-program-to-block-forever/45517539#45517539", "title": "How to get a Go program to block forever", "body": "<p>Those methods would work if you spawned another goroutine (which was doing stuff other than blocking)</p>\n\n<p>The immediate fix to your problem would be:</p>\n\n<p><code>time.Sleep(math.MaxInt64)\n</code></p>\n\n<p>which would sleep for ~300 years</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1501901510, "creation_date": 1501901510, "answer_id": 45517723, "question_id": 45517523, "link": "https://stackoverflow.com/questions/45517523/how-to-get-a-go-program-to-block-forever/45517723#45517723", "title": "How to get a Go program to block forever", "body": "<p>For example, the <code>main</code> goroutine blocks forever,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc forever() {\n    for {\n        fmt.Println(time.Now().UTC())\n        time.Sleep(time.Second)\n    }\n}\n\nfunc main() {\n    go forever()\n    select {} // block forever\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2017-08-05 02:50:10.138353286 +0000 UTC\n2017-08-05 02:50:11.138504194 +0000 UTC\n2017-08-05 02:50:12.138618149 +0000 UTC\n2017-08-05 02:50:13.138753477 +0000 UTC\n2017-08-05 02:50:14.13888856 +0000 UTC\n2017-08-05 02:50:15.139027355 +0000 UTC\n...\n...\n...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 16513, "user_id": 95642, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/36cf75fa7751ef674df65ab65cecd255?s=128&d=identicon&r=PG", "display_name": "Drew LeSueur", "link": "https://stackoverflow.com/users/95642/drew-lesueur"}, "edited": false, "score": 1, "creation_date": 1501949212, "post_id": 45519172, "comment_id": 78007843, "body": "Thank you! One thing I noticed was that with your example it was using 99% CPU. But if I put a <code>time.Sleep(1 * time.Second)</code> in the <code>for</code> loop, then it doesn&#39;t use all that CPU."}], "tags": [], "owner": {"reputation": 51, "user_id": 8382108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65a0602db58e2dbccc8452a2565d0c00?s=128&d=identicon&r=PG", "display_name": "Ahui", "link": "https://stackoverflow.com/users/8382108/ahui"}, "is_accepted": false, "score": 1, "last_activity_date": 1501916037, "creation_date": 1501916037, "answer_id": 45519172, "question_id": 45517523, "link": "https://stackoverflow.com/questions/45517523/how-to-get-a-go-program-to-block-forever/45519172#45519172", "title": "How to get a Go program to block forever", "body": "<p>For the question \"How to get a Go program to block forever\" there's already answers that use a for loop or <code>time.Sleep</code>.</p>\n\n<p>But I want to answer \"How to get a Go program to block forever <em>with a channel never receives a value</em>\".</p>\n\n<pre><code>package main\n\nfunc main() {\n    ch := make(chan bool)\n\n    go func(c chan bool) {\n        for {\n        }\n        c &lt;- true // Because c never receives true,\n    }(ch)\n\n    &lt;-ch // thus ch waits forever.\n}\n</code></pre>\n\n<p>I think the sample code above can help to understand why and when a Go program will block by a channel.</p>\n"}], "owner": {"reputation": 16513, "user_id": 95642, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/36cf75fa7751ef674df65ab65cecd255?s=128&d=identicon&r=PG", "display_name": "Drew LeSueur", "link": "https://stackoverflow.com/users/95642/drew-lesueur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 2, "accepted_answer_id": 45517723, "answer_count": 3, "score": 1, "last_activity_date": 1501916037, "creation_date": 1501898321, "question_id": 45517523, "link": "https://stackoverflow.com/questions/45517523/how-to-get-a-go-program-to-block-forever", "title": "How to get a Go program to block forever", "body": "<p>I am trying to get my Go program to block forever,  but nothing is working.</p>\n\n<p>Here are some things I have tried:</p>\n\n<pre><code>package main\n\nfunc main() {\n    select{}\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>package main\n\nfunc main() {\n    ch := make(chan bool)\n    &lt;-ch\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>package main\n\nimport \"sync\"\n\nfunc main() {\n    var wg sync.WaitGroup\n    wg.Add(1)\n    wg.Wait()\n}\n</code></pre>\n\n<p>Each time I get the same error: <code>fatal error: all goroutines are asleep - deadlock!</code></p>\n\n<p>I thought I have done this before easily. Am I able to get the go program to block forever?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1501883684, "post_id": 45515809, "comment_id": 77993328, "body": "You can have multiple goroutines read from a value, but how do you use it for anything is it&#39;s never written? The rule is simple, you need synchronization if there are concurrent writes, or concurrent reads and writes for <i>any</i> value."}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501884142, "post_id": 45515809, "comment_id": 77993471, "body": "I use an SQL driver to do actual writing. But the <code>bus</code> variable is essentially a factory full of methods that are wrappers over the actual SQL implementations, and the SQL driver handles it&#39;s own concurrency rules so I don&#39;t have to worry about that."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501886829, "post_id": 45515809, "comment_id": 77994196, "body": "If all you are doing is reading and writing from a DB, then no, you won&#39;t need a mutex. But if any of the internal variables are written to in the process, then they (or the whole bus) will need to be locked. For example, if you happened to have an internal counter for how many reads are done through the bus, then that would need a mutex."}, {"owner": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1529074652, "post_id": 45515809, "comment_id": 88758236, "body": "@RayfenWindspear what if package variable is an pointer like <code>var catList []*model.Cat</code> then inside other function, i use gorm to fill data, <code>catList, _ = model.Cat{}.All()</code> does it need to be locked?"}], "answers": [{"tags": [], "owner": {"reputation": 3311, "user_id": 61363, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30ed41f682f716613fe62a0831f522dd?s=128&d=identicon&r=PG", "display_name": "del-boy", "link": "https://stackoverflow.com/users/61363/del-boy"}, "is_accepted": true, "score": 5, "last_activity_date": 1501894064, "creation_date": 1501894064, "answer_id": 45517192, "question_id": 45515809, "link": "https://stackoverflow.com/questions/45515809/golang-is-a-mutex-required-for-a-package-scoped-variable-with-read-only-access/45517192#45517192", "title": "Golang: is a mutex required for a package-scoped variable with read-only access?", "body": "<p>If all you do is reading the content of variable - then no, you do not need mutex. However, if you ever mutate its state, then you need to protect it. </p>\n\n<p>Two concurrent writes or concurrent write and read can cause problems. If your writes are rare, you might want to use <a href=\"https://golang.org/pkg/sync/#RWMutex\" rel=\"noreferrer\">RWMutex</a>. It will allow multiple readers to access, but not together with a writer.</p>\n\n<p>Also, check out <a href=\"https://blog.golang.org/race-detector\" rel=\"noreferrer\">race detector</a>. It is best effort detector, so it does not guarantee that you do not have race condition, but it can detect some use cases. Also note that you need to cause race in order for race detector to detect it, so writing tests that use your <code>bus</code> concurrently or simulating real conditions has to be done.</p>\n"}], "owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 649, "favorite_count": 0, "accepted_answer_id": 45517192, "answer_count": 1, "score": 0, "last_activity_date": 1501894064, "creation_date": 1501882482, "question_id": 45515809, "link": "https://stackoverflow.com/questions/45515809/golang-is-a-mutex-required-for-a-package-scoped-variable-with-read-only-access", "title": "Golang: is a mutex required for a package-scoped variable with read-only access?", "body": "<p>If I have a package-scoped variable like this:</p>\n\n<pre><code>var (\n    bus *Bus // THIS VARIABLE\n)\n\n// Bus represents a repository bus. This contains all of the repositories.\ntype Bus struct {\n    UserRepository *UserRepository\n    // ...\n}\n</code></pre>\n\n<p>...and I give access to the <code>bus</code> variable on my repositories so that they can access each other, do I need to use any sort of mutex if they can be used concurrently?</p>\n\n<p>Quick pseudocode of what would happen:</p>\n\n<pre><code>// Router\nrouter.GET(\"/user/:id\", c.FindUser)\n\n// Controller\nfunc (c *UserController) FindUser(w http.ResponesWriter, r *http.Request) {\n    w.Write([]byte(c.UserService.FindUser(r.Get(\"id\"))))\n}\n\n// Service\nfunc (s UserService) FindUser(id int) *domain.User {\n    return s.UserRepository.FindByID(id) \n}\n\n// Repository\nfunc (r UserRepository) FindByID(id int) *domain.User {\n    // This is where the package-scope `bus` variable will be used\n}\n</code></pre>\n\n<p>In the <code>FindByID</code> function, I may use the package-scoped <code>bus</code> variable, which of course can be accessed concurrently since it will be called whenever an HTTP request triggers it, and those are all handled concurrently.</p>\n"}, {"tags": ["go", "switch-statement"], "comments": [{"owner": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "edited": false, "score": 0, "creation_date": 1501881621, "post_id": 45515604, "comment_id": 77992661, "body": "What have you tried? This is not a difficult problem and I&#39;m betting that by taking a quick stab at it you can find the answer."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1501881748, "post_id": 45515604, "comment_id": 77992700, "body": "The <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\">Spec: Switch statements</a> has examples like this."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1501892455, "post_id": 45515604, "comment_id": 77995362, "body": "It&#39;s also <a href=\"https://tour.golang.org/flowcontrol/9\" rel=\"nofollow noreferrer\">in the tour</a>."}], "answers": [{"comments": [{"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "edited": false, "score": 0, "creation_date": 1520005039, "post_id": 45516325, "comment_id": 85150376, "body": "I&#39;m torn between the blatant non-attempt at them trying to figure it out for themselves vs the Stack Exchange sometimes-mantra of &quot;bring it to SO so you don&#39;t have to go through the doc&quot;"}], "tags": [], "owner": {"reputation": 989, "user_id": 5016244, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/bdZPE.jpg?s=128&g=1", "display_name": "Theophile Dano", "link": "https://stackoverflow.com/users/5016244/theophile-dano"}, "is_accepted": true, "score": 8, "last_activity_date": 1501885744, "creation_date": 1501885744, "answer_id": 45516325, "question_id": 45515604, "link": "https://stackoverflow.com/questions/45515604/golang-switch-statement/45516325#45516325", "title": "Golang switch statement", "body": "<p>Even though you could figure it out yourself by reading the <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"noreferrer\">doc</a> here is what you should write:</p>\n\n<pre><code>switch a.Type {\ncase \"v1\":\n    // ...\n    // no need to 'break' in go\ncase \"v2\":\n    // ...\ndefault:\n    // usual 'else' clause statements\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2680, "user_id": 5556676, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/873efb3aa94e7f6805c489dcc0ebb57f?s=128&d=identicon&r=PG&f=1", "display_name": "init_js", "link": "https://stackoverflow.com/users/5556676/init-js"}, "edited": false, "score": 0, "creation_date": 1553846506, "post_id": 55277910, "comment_id": 97545017, "body": "stumbled upon this, looking for something else. I like this answer, except that it&#39;s really not the same as any other language. The cases in golang can be full fledge expressions, it&#39;s not just integers that you can switch on, and there is no fallthrough between <code>case</code>s."}], "tags": [], "owner": {"reputation": 21, "user_id": 10057286, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Jz-eIalw71Y/AAAAAAAAAAI/AAAAAAAAE_s/hYwa3nHf0U8/photo.jpg?sz=128", "display_name": "Hardik Bohra", "link": "https://stackoverflow.com/users/10057286/hardik-bohra"}, "is_accepted": false, "score": -1, "last_activity_date": 1553162661, "creation_date": 1553162661, "answer_id": 55277910, "question_id": 45515604, "link": "https://stackoverflow.com/questions/45515604/golang-switch-statement/55277910#55277910", "title": "Golang switch statement", "body": "<p>This is same like any other programming language, just syntax is little bit changed.</p>\n\n<p>you can use switch case as follow : </p>\n\n<pre><code>switch a.Type {\ncase \"v1\":\n    if err := apiClient.v1(\"I am version one\"); err != nil {\n        log.Printf(\" Error: Sending type v1\")\n        return err\n    }\ncase \"v2\":\n    if err := apiClient.v1(\"I am version 2\"); err != nil {\n        log.Printf(\" Error: Sending type v2\")\n        return err\n    }\ndefault:\n    return errors.New(fmt.Sprintf(\" Error: Invalid mertype...This Type\"))\n}\n</code></pre>\n\n<p>Even you can combine multiple cases into one too.\nlike :</p>\n\n<pre><code>switch a.Type {\ncase \"v1\":\n    if err := apiClient.v1(\"I am version one\"); err != nil {\n        log.Printf(\" Error: Sending type v1\")\n        return err\n    }\ncase \"v2\":\n    if err := apiClient.v1(\"I am version 2\"); err != nil {\n        log.Printf(\" Error: Sending type v2\")\n        return err\n    }\ncase \"v3\", \"v4\":\n    if err := apiClient.v1(\"I am version 3 or 4\"); err != nil {\n        log.Printf(\" Error: Sending type v3 or v4\")\n        return err\n    }\ndefault:\n    return errors.New(fmt.Sprintf(\" Error: Invalid mertype...This Type\"))\n}\n</code></pre>\n"}], "owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2366, "favorite_count": 0, "accepted_answer_id": 45516325, "answer_count": 2, "score": -3, "last_activity_date": 1553162661, "creation_date": 1501881304, "last_edit_date": 1501881714, "question_id": 45515604, "link": "https://stackoverflow.com/questions/45515604/golang-switch-statement", "title": "Golang switch statement", "body": "<p>I am new to golang and switched from python to golang. How can I convert this if else statement in a \"switch\"</p>\n\n<pre><code>type Client struct {\n    Type  string `json:\"type\"`\n} \n</code></pre>\n\n<p>Then I am initializing this struct like this:</p>\n\n<pre><code>a:= Client{\"v1\"}\n\nif a.Type == \"v1\" {\n    if err := apiClient.v1(\"I am version one\"); err != nil {\n        log.Printf(\" Error: Sending type v1\")\n        return err\n    }\n} else if a.Type == \"v2\" {\n    if err := apiClient.v2(\"I am version 2\"); err != nil {\n        log.Printf(\" Error: Sending type v2\\n\")\n        return err\n    }\n}  else {\n        return errors.New(fmt.Sprintf(\" Error: Invalid mertype...This Type\"))\n    }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501879431, "post_id": 45515182, "comment_id": 77991776, "body": "Some of that projects documentation seems to be broken, but have you tried running <code>make update-deps</code> as shown in the README?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501880090, "post_id": 45515182, "comment_id": 77992085, "body": "All those dependencies are vendored. Are you certain you&#39;re working in your GOPATH?"}], "answers": [{"comments": [{"owner": {"reputation": 3625, "user_id": 599728, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/1aJnG.jpg?s=128&g=1", "display_name": "Joan", "link": "https://stackoverflow.com/users/599728/joan"}, "edited": false, "score": 0, "creation_date": 1501919175, "post_id": 45515497, "comment_id": 77999800, "body": "This is what I did except that I named the first <code>kubernetes-model</code>, <code>Go</code>. Is it important? I just edited the question with the exact steps I&#39;ve done."}, {"owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "reply_to_user": {"reputation": 3625, "user_id": 599728, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/1aJnG.jpg?s=128&g=1", "display_name": "Joan", "link": "https://stackoverflow.com/users/599728/joan"}, "edited": false, "score": 0, "creation_date": 1501929829, "post_id": 45515497, "comment_id": 78002374, "body": "No, it is not important. But I see in your log next path: <code>&#47;Users&#47;joangoyeau&#47;Code&#47;go&#47;src&#47;github.com&#47;openshift&#47;origin&#47;pk&zwnj;&#8203;g&#47;authorization&#47;api&#47;&zwnj;&#8203;v1 (from $GOPATH)</code> where <code>go</code> directory is lower-cased, but in your <code>export GOPATH=&quot;$HOME&#47;Go&quot;</code> it is camel-cased."}], "tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": false, "score": 0, "last_activity_date": 1501880721, "creation_date": 1501880721, "answer_id": 45515497, "question_id": 45515182, "link": "https://stackoverflow.com/questions/45515182/go-cannot-find-package/45515497#45515497", "title": "Go cannot find package", "body": "<p>You should clone repository and set proper GOPATH for it.<br>\nThe folders structure must be:  </p>\n\n<pre><code>kubernetes-model\n                \\ src\n                     \\github.com\n                                \\fabric8io\n                                          \\kubernetes-model\n                                                           \\ &lt;project files here&gt;\n\nexport GOPATH=&lt;location of first 'kubernetes-model' folder in this chain&gt;\n</code></pre>\n\n<p>This export will make <code>vendor</code> directory of project visible for <code>go</code></p>\n"}], "owner": {"reputation": 3625, "user_id": 599728, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/1aJnG.jpg?s=128&g=1", "display_name": "Joan", "link": "https://stackoverflow.com/users/599728/joan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1050, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1501919087, "creation_date": 1501879269, "last_edit_date": 1501919087, "question_id": 45515182, "link": "https://stackoverflow.com/questions/45515182/go-cannot-find-package", "title": "Go cannot find package", "body": "<p>I'm trying to checkout this Go project <a href=\"https://github.com/fabric8io/kubernetes-model\" rel=\"nofollow noreferrer\">https://github.com/fabric8io/kubernetes-model</a> and build according to the readme:</p>\n\n<pre><code>&gt; mkdir -p \"$HOME/Go/src/github.com/fabric8io\"\n&gt; export GOPATH=\"$HOME/Go\"\n&gt; cd \"$HOME/Go/src/github.com/fabric8io\"\n&gt; git clone https://github.com/fabric8io/kubernetes-model\n&gt; cd kubernetes-model\n&gt; brew install go\n&gt; brew install godep\n&gt; make\nCGO_ENABLED=0 GO15VENDOREXPERIMENT=1 go build -a ./cmd/generate/generate.go\ncmd/generate/generate.go:27:2: cannot find package \"github.com/openshift/origin/pkg/authorization/api/v1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/github.com/openshift/origin/pkg/authorization/api/v1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/github.com/openshift/origin/pkg/authorization/api/v1 (from $GOPATH)\ncmd/generate/generate.go:28:2: cannot find package \"github.com/openshift/origin/pkg/build/api/v1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/github.com/openshift/origin/pkg/build/api/v1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/github.com/openshift/origin/pkg/build/api/v1 (from $GOPATH)\ncmd/generate/generate.go:29:2: cannot find package \"github.com/openshift/origin/pkg/deploy/api/v1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/github.com/openshift/origin/pkg/deploy/api/v1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/github.com/openshift/origin/pkg/deploy/api/v1 (from $GOPATH)\ncmd/generate/generate.go:30:2: cannot find package \"github.com/openshift/origin/pkg/image/api/v1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/github.com/openshift/origin/pkg/image/api/v1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/github.com/openshift/origin/pkg/image/api/v1 (from $GOPATH)\ncmd/generate/generate.go:31:2: cannot find package \"github.com/openshift/origin/pkg/oauth/api/v1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/github.com/openshift/origin/pkg/oauth/api/v1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/github.com/openshift/origin/pkg/oauth/api/v1 (from $GOPATH)\ncmd/generate/generate.go:32:2: cannot find package \"github.com/openshift/origin/pkg/project/api/v1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/github.com/openshift/origin/pkg/project/api/v1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/github.com/openshift/origin/pkg/project/api/v1 (from $GOPATH)\ncmd/generate/generate.go:33:2: cannot find package \"github.com/openshift/origin/pkg/route/api/v1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/github.com/openshift/origin/pkg/route/api/v1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/github.com/openshift/origin/pkg/route/api/v1 (from $GOPATH)\ncmd/generate/generate.go:34:2: cannot find package \"github.com/openshift/origin/pkg/template/api/v1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/github.com/openshift/origin/pkg/template/api/v1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/github.com/openshift/origin/pkg/template/api/v1 (from $GOPATH)\ncmd/generate/generate.go:35:2: cannot find package \"github.com/openshift/origin/pkg/user/api/v1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/github.com/openshift/origin/pkg/user/api/v1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/github.com/openshift/origin/pkg/user/api/v1 (from $GOPATH)\ncmd/generate/generate.go:36:2: cannot find package \"k8s.io/apiextensions-server/pkg/apis/apiextensions/v1beta1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/k8s.io/apiextensions-server/pkg/apis/apiextensions/v1beta1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/k8s.io/apiextensions-server/pkg/apis/apiextensions/v1beta1 (from $GOPATH)\ncmd/generate/generate.go:37:2: cannot find package \"k8s.io/kubernetes/pkg/api/resource\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/k8s.io/kubernetes/pkg/api/resource (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/k8s.io/kubernetes/pkg/api/resource (from $GOPATH)\ncmd/generate/generate.go:38:2: cannot find package \"k8s.io/kubernetes/pkg/api/unversioned\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/k8s.io/kubernetes/pkg/api/unversioned (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/k8s.io/kubernetes/pkg/api/unversioned (from $GOPATH)\ncmd/generate/generate.go:39:2: cannot find package \"k8s.io/kubernetes/pkg/api/v1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/k8s.io/kubernetes/pkg/api/v1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/k8s.io/kubernetes/pkg/api/v1 (from $GOPATH)\ncmd/generate/generate.go:40:2: cannot find package \"k8s.io/kubernetes/pkg/apis/apps/v1beta1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/k8s.io/kubernetes/pkg/apis/apps/v1beta1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/k8s.io/kubernetes/pkg/apis/apps/v1beta1 (from $GOPATH)\ncmd/generate/generate.go:41:2: cannot find package \"k8s.io/kubernetes/pkg/apis/autoscaling/v1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/k8s.io/kubernetes/pkg/apis/autoscaling/v1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/k8s.io/kubernetes/pkg/apis/autoscaling/v1 (from $GOPATH)\ncmd/generate/generate.go:43:2: cannot find package \"k8s.io/kubernetes/pkg/apis/batch/v1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/k8s.io/kubernetes/pkg/apis/batch/v1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/k8s.io/kubernetes/pkg/apis/batch/v1 (from $GOPATH)\ncmd/generate/generate.go:42:2: cannot find package \"k8s.io/kubernetes/pkg/apis/batch/v2alpha1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/k8s.io/kubernetes/pkg/apis/batch/v2alpha1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/k8s.io/kubernetes/pkg/apis/batch/v2alpha1 (from $GOPATH)\ncmd/generate/generate.go:44:2: cannot find package \"k8s.io/kubernetes/pkg/apis/extensions/v1beta1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/k8s.io/kubernetes/pkg/apis/extensions/v1beta1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/k8s.io/kubernetes/pkg/apis/extensions/v1beta1 (from $GOPATH)\ncmd/generate/generate.go:45:2: cannot find package \"k8s.io/kubernetes/pkg/client/unversioned/clientcmd/api/v1\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/k8s.io/kubernetes/pkg/client/unversioned/clientcmd/api/v1 (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/k8s.io/kubernetes/pkg/client/unversioned/clientcmd/api/v1 (from $GOPATH)\ncmd/generate/generate.go:46:2: cannot find package \"k8s.io/kubernetes/pkg/watch/json\" in any of:\n    /usr/local/Cellar/go/1.8.3/libexec/src/k8s.io/kubernetes/pkg/watch/json (from $GOROOT)\n    /Users/joangoyeau/Code/go/src/k8s.io/kubernetes/pkg/watch/json (from $GOPATH)\nmake: *** [build] Error 1\n</code></pre>\n\n<p>I'm not sur what I'm supposed to do with this as I'm used to build tools that download automatically dependencies.</p>\n\n<p>EDIT: I also tried:</p>\n\n<pre><code>&gt; make update-deps\nmake: *** No rule to make target `update-deps'.  Stop.\n&gt; make [tag=v0.5.2] update-deps\nmake: *** No rule to make target `update-deps'.  Stop.\n&gt; make tag=v0.5.2 update-deps\nmake: *** No rule to make target `update-deps'.  Stop.\n</code></pre>\n"}, {"tags": ["go", "mutability"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1501861293, "post_id": 45510787, "comment_id": 77982642, "body": "Post all code here directly. Never solely link to code. If the link goes down, your question becomes near useless to future readers."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501862100, "post_id": 45510787, "comment_id": 77983066, "body": "And as far as the code itself code, maybe add some annotations/explanation so people can tell what it is you&#39;re actually trying to do? It&#39;s not particularly readable as-is."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 4875164, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/844745b1c4c2b59c2e00fac63c3da412?s=128&d=identicon&r=PG", "display_name": "martin", "link": "https://stackoverflow.com/users/4875164/martin"}, "edited": false, "score": 0, "creation_date": 1501877631, "post_id": 45511137, "comment_id": 77990984, "body": "I can&#39;t upvote this because of lack of reputation, but thanks. Anyone who can, please upvote the answer. @mkopriva"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 21, "user_id": 4875164, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/844745b1c4c2b59c2e00fac63c3da412?s=128&d=identicon&r=PG", "display_name": "martin", "link": "https://stackoverflow.com/users/4875164/martin"}, "edited": false, "score": 1, "creation_date": 1501887204, "post_id": 45511137, "comment_id": 77994300, "body": "@martin, you may not be able to up vote, but if this was the answer to the question you can mark it as the correct answer."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1501862392, "creation_date": 1501862392, "answer_id": 45511137, "question_id": 45510787, "link": "https://stackoverflow.com/questions/45510787/i-cant-mutate-this-struct-i-and-i-dont-understand-why/45511137#45511137", "title": "I can&#39;t mutate this struct I and I don&#39;t understand why", "body": "<p>Unmask takes a pointer to a pointer, let's say pointer X to pointer Y, pointer Y points to the string value. Unmask then <strong>changes</strong> the pointer to which X is pointing to, Y is unchanged and points still to the same old string.</p>\n\n<p>You can do this:</p>\n\n<pre><code>func UnMask(n **string, k string) {\n    **n = k\n}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>func UnMask(n *string, k string) {\n    *n = k\n}\n// ....\nUnMask(n1, \"Joe\") // drop the '&amp;'\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 4875164, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/844745b1c4c2b59c2e00fac63c3da412?s=128&d=identicon&r=PG", "display_name": "martin", "link": "https://stackoverflow.com/users/4875164/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 45511137, "answer_count": 1, "score": -2, "last_activity_date": 1501862930, "creation_date": 1501861223, "last_edit_date": 1501862930, "question_id": 45510787, "link": "https://stackoverflow.com/questions/45510787/i-cant-mutate-this-struct-i-and-i-dont-understand-why", "title": "I can&#39;t mutate this struct I and I don&#39;t understand why", "body": "<p>Consider the following gist <a href=\"https://play.golang.org/p/yNKmDmY5b-\" rel=\"nofollow noreferrer\">linked here</a>:</p>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype StateTransition struct {\n    msg Message\n}\n\ntype Message interface {\n    To() *string\n}\n\ntype Transaction struct {\n    data txdata\n}\n\ntype txdata struct {\n    Recipient *string\n}\n\nfunc (t Transaction) To() (*string) {\n    return t.data.Recipient\n}\n\n\nfunc UnMask(n **string, k string) {\n    *n = &amp;k\n} \n\nfunc main() {\n    toField := \"Bob\"\n    toPtr := &amp;toField\n    txd := txdata{toPtr}\n    tx := Transaction{txd}\n    st := StateTransition{tx}\n    n1 := st.msg.To()\n    fmt.Printf(\"Hello, %s \\n\", *n1)\n    UnMask(&amp;n1, \"Joe\")\n    fmt.Printf(\"Hello, %s \\n\", *n1)\n    n2 := st.msg.To()\n    fmt.Printf(\"Hello, %s \\n\", *n2)\n}\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre><code>Hello, Bob \nHello, Joe \nHello, Bob \n</code></pre>\n\n<p><strong>Expected Output</strong></p>\n\n<pre><code>Hello, Bob\nHello, Joe\nHello, Joe\n</code></pre>\n\n<p>The result is the sequence \"Bob, Joe, Bob\" is printed whereas my intuition says that it should be \"Bob, Joe, Joe\" (this is also what i <em>want</em> it to print). Can someone experienced in go please explain to me enough about combining pointers, structs, and interfaces as they relate to this problem to give me some understanding about why I'm wrong, and how to fix it?</p>\n"}, {"tags": ["go", "httpserver"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1501860071, "post_id": 45510348, "comment_id": 77981941, "body": "What other &quot;errors like these&quot; are you referring to? Do you specifically want to intercept the <code>Accept</code> calls, and if you did, what would you even do with said error besides log it and retry?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1501863839, "post_id": 45510348, "comment_id": 77984034, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/43547565/any-way-to-get-a-stack-trace-for-http-response-writeheader-on-hijacked-connect\">Any way to get a stack trace for &#39;http: response.WriteHeader on hijacked connection&#39; errors?</a>"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1501917527, "post_id": 45510348, "comment_id": 77999429, "body": "I&#39;d even go a step further than JimB and say that this log entry did <i>exactly</i> whatvit was supposed to do: have you check wether you close all files and presumably check the maximum number of open file descriptors provided for the user running the process  by the OS. Root cause solved is what I call mission accomplished."}, {"owner": {"reputation": 774, "user_id": 4838452, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/415db9ee399cfd4f383700942b45f977?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Klauer", "link": "https://stackoverflow.com/users/4838452/alexander-klauer"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1502100029, "post_id": 45510348, "comment_id": 78048025, "body": "@JimB yes, intercepting <code>Accept()</code> is what I want. Upon catching one of these, I would terminate the program. In my case, that&#39;s better than retrying because the error is likely to persist. Termination is a good workaround until the actual bug causing these errors is fixed."}, {"owner": {"reputation": 774, "user_id": 4838452, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/415db9ee399cfd4f383700942b45f977?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Klauer", "link": "https://stackoverflow.com/users/4838452/alexander-klauer"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1502100073, "post_id": 45510348, "comment_id": 78048050, "body": "@MarkusWMahlberg Correct, but until the root cause is eliminated, I need a workaround."}], "answers": [{"tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": false, "score": 2, "last_activity_date": 1501861451, "creation_date": 1501861451, "answer_id": 45510847, "question_id": 45510348, "link": "https://stackoverflow.com/questions/45510348/how-to-handle-low-level-net-http-errors/45510847#45510847", "title": "How to handle low-level net/http errors?", "body": "<p>net/http logs all errors to <a href=\"https://golang.org/pkg/net/http/#Server\" rel=\"nofollow noreferrer\">server.ErrorLog</a>. You can use that to intercept the log messages, but it is not obvious how much data you can pull from those logs programatically.</p>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1501872016, "post_id": 45513018, "comment_id": 77988144, "body": "The question isn&#39;t about errors returned from <code>Server()</code>, but errors that are only logged."}, {"owner": {"reputation": 1054, "user_id": 6444852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78e304c11f81effb074bc80f7a5597e3?s=128&d=identicon&r=PG", "display_name": "Constantin S. Pan", "link": "https://stackoverflow.com/users/6444852/constantin-s-pan"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1501880460, "post_id": 45513018, "comment_id": 77992230, "body": "What happens in that case is that <code>http.ListenAndServe()</code> creates the default <code>http.Server</code> and runs <code>server.Serve()</code> providing a default <code>net.Listener</code>. Then, if an <code>accept error</code> happens (inside Listener), it just gets printed by the server. What I have proposed is that you define your own Listener, which just wraps around the default <code>net.Listener</code> and performs your custom logic on errors. I should probably edit my answer to make that clear."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1501924494, "post_id": 45513018, "comment_id": 78001039, "body": "That helps with <code>error</code>s; this question isn&#39;t about <code>error</code>s."}, {"owner": {"reputation": 774, "user_id": 4838452, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/415db9ee399cfd4f383700942b45f977?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Klauer", "link": "https://stackoverflow.com/users/4838452/alexander-klauer"}, "edited": false, "score": 0, "creation_date": 1502100136, "post_id": 45513018, "comment_id": 78048090, "body": "This is actually the correct answer. Sorry for causing confusion due to my mentioning the logs."}], "tags": [], "owner": {"reputation": 1054, "user_id": 6444852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78e304c11f81effb074bc80f7a5597e3?s=128&d=identicon&r=PG", "display_name": "Constantin S. Pan", "link": "https://stackoverflow.com/users/6444852/constantin-s-pan"}, "is_accepted": true, "score": 1, "last_activity_date": 1501869908, "creation_date": 1501869908, "answer_id": 45513018, "question_id": 45510348, "link": "https://stackoverflow.com/questions/45510348/how-to-handle-low-level-net-http-errors/45513018#45513018", "title": "How to handle low-level net/http errors?", "body": "<p>If you look at how <code>(*http.Server).Serve()</code> is implemented <a href=\"https://golang.org/src/net/http/server.go?m=text\" rel=\"nofollow noreferrer\">here</a>, it is clear that you can just define your own class that implements <code>net.Listener</code> and give it to the <code>Serve()</code> function, instead of using <code>ListenAndServe()</code>, which puts a default listener there. Make it <code>panic</code> on error and later <code>recover</code> from that panic in your code, or implement any other error handling logic.</p>\n"}], "owner": {"reputation": 774, "user_id": 4838452, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/415db9ee399cfd4f383700942b45f977?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Klauer", "link": "https://stackoverflow.com/users/4838452/alexander-klauer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 45513018, "answer_count": 2, "score": 1, "last_activity_date": 1502099871, "creation_date": 1501859895, "last_edit_date": 1502099871, "question_id": 45510348, "link": "https://stackoverflow.com/questions/45510348/how-to-handle-low-level-net-http-errors", "title": "How to handle low-level net/http errors?", "body": "<p>With my golang net/http server, I occasionally get errors like</p>\n\n<p><code>2017/08/04 15:06:25 http: Accept error: accept tcp 127.0.0.1:80: accept4: too many open files; retrying in 1s</code></p>\n\n<p>on stderr. There might be a bug with a missing <code>Close()</code> somewhere, but this is <em>not</em> what my question is about.</p>\n\n<p>What I would like to know is whether there is an easy way to catch these or similar errors programmatically in go? <strike>I only know about this error because it's logged. <code>ListenAndServe()</code> does not return an error. Is there some other way to get notified of errors like these?</strike> Specifically: how do I access the errors of the underlying listener? <code>ListenAndServe()</code> does not return errors from the underlying listener (at least not all of them).</p>\n\n<p>(edited)</p>\n"}, {"tags": ["http", "go", "memory", "server", "garbage-collection"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1501859051, "last_edit_date": 1501859051, "creation_date": 1501857768, "answer_id": 45509642, "question_id": 45509538, "link": "https://stackoverflow.com/questions/45509538/freeing-unused-memory/45509642#45509642", "title": "Freeing unused memory?", "body": "<p>First I recommend to read the following questions / answers:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/42345060/freeosmemory-in-production/42345554#42345554\">FreeOSMemory() in production</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/37382600/golang-cannot-free-memory-once-occupied-by-bytes-buffer/37383604#37383604\">Golang - Cannot free memory once occupied by bytes.Buffer</a></p>\n\n<p>You may trigger a gc to free unused objects with <a href=\"https://golang.org/pkg/runtime/#GC\" rel=\"noreferrer\"><code>runtime.GC()</code></a> and you may urge your Go runtime to release memory back to OS with <a href=\"https://golang.org/pkg/runtime/debug/#FreeOSMemory\" rel=\"noreferrer\"><code>debug.FreeOSMemory()</code></a>, but all these are just fire fighting. A well-written Go app should never have to call these.</p>\n\n<p>What you should do is prevent the runtime having to allocate large amount of memory.</p>\n\n<p>How may you achieve this? Some means (you can even combine these solutions):</p>\n\n<ul>\n<li><p>Limit serving the requests requiring large memory, more about it: <a href=\"https://stackoverflow.com/questions/37529511/process-management-for-the-go-webserver/37531953#37531953\">Process Management for the Go Webserver</a>; also <a href=\"https://stackoverflow.com/questions/38170852/is-this-an-idiomatic-worker-thread-pool-in-go/38172204#38172204\">Is this an idiomatic worker thread pool in Go?</a></p></li>\n<li><p>Use memory / buffer pools, do not allocate big arrays / slices all the time, more about it: <a href=\"https://stackoverflow.com/questions/38505830/how-to-implement-memory-pooling-in-golang/38506367#38506367\">How to implement Memory Pooling in Golang</a></p></li>\n<li><p>Create / change your processing units not to operate on byte slices but on <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"noreferrer\"><code>io.Reader</code></a>s, so you don't need to read all content into memory, you can just pass <code>resp.Body</code> on. Note that even if multiple units have to read / inspect the body, it is still possible to only read and process it once, and not keep it in memory. Means may be <a href=\"https://golang.org/pkg/io/#Pipe\" rel=\"noreferrer\"><code>io.Pipe()</code></a>, <a href=\"https://golang.org/pkg/io/#TeeReader\" rel=\"noreferrer\"><code>io.TeeReader()</code></a> or custom solutions.</p></li>\n</ul>\n"}], "owner": {"reputation": 291, "user_id": 6637202, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/252ead8b84f69ed7e89b11f50cd53d23?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/6637202/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1022, "favorite_count": 0, "accepted_answer_id": 45509642, "answer_count": 1, "score": 3, "last_activity_date": 1524403397, "creation_date": 1501857389, "last_edit_date": 1524403397, "question_id": 45509538, "link": "https://stackoverflow.com/questions/45509538/freeing-unused-memory", "title": "Freeing unused memory?", "body": "<p>I'm using the following function for downloading files smaller than 20MB. It read the entire content to memory as another function has to perform work on the bytes before it can be written to disk.</p>\n\n<pre><code>func getURL(url string) ([]byte, error) {\n    resp, err := http.Get(url)\n        if err != nil {\n            return nil, fmt.Errorf(\"getURL: %s\", err)\n    }\n    defer resp.Body.Close()\n\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n            return nil, fmt.Errorf(\"getURL: %s\", err)\n    }\n\n    return body, nil\n}\n</code></pre>\n\n<p>This works fine, but all memory is consumed on the system.</p>\n\n<p>Is it possible to release memory used by <code>body</code> after it has been processed by another function, so memory use won't be larger than the bytes currently being processed?</p>\n"}, {"tags": ["go", "thrift"], "comments": [{"owner": {"reputation": 31, "user_id": 2982256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6276fa745217ab968c1db63a9bd4770?s=128&d=identicon&r=PG&f=1", "display_name": "user2982256", "link": "https://stackoverflow.com/users/2982256/user2982256"}, "edited": false, "score": 0, "creation_date": 1501857139, "post_id": 45509414, "comment_id": 77979900, "body": "and metric_system.thrift file looks like this: struct MyStruct { \t1: i64 myInt, }  service MyStructProvider { \tMyStruct getMyStruct(), }"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501858250, "post_id": 45509414, "comment_id": 77980709, "body": "When posting about an issue, it&#39;s helpful to include the relevant code in your question."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1501858217, "creation_date": 1501858217, "answer_id": 45509817, "question_id": 45509414, "link": "https://stackoverflow.com/questions/45509414/golang-with-thrift-does-not-implement-thrift-tprocessorfunction-wrong-type-for/45509817#45509817", "title": "golang with thrift does not implement thrift.TProcessorFunction (wrong type for Process method)", "body": "<p>The error says it all, the <code>Process</code> method you've implemented does not meet the interface requirement. You're missing the first argument, a <code>context.Context</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7779149, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qPnxwdpQge8/AAAAAAAAAAI/AAAAAAAAACg/RRBo2FRd8e0/photo.jpg?sz=128", "display_name": "Tao", "link": "https://stackoverflow.com/users/7779149/tao"}, "is_accepted": false, "score": 0, "last_activity_date": 1502193612, "last_edit_date": 1502193612, "creation_date": 1502193024, "answer_id": 45567586, "question_id": 45509414, "link": "https://stackoverflow.com/questions/45509414/golang-with-thrift-does-not-implement-thrift-tprocessorfunction-wrong-type-for/45567586#45567586", "title": "golang with thrift does not implement thrift.TProcessorFunction (wrong type for Process method)", "body": "<p>switch your git branch to 0.10.0</p>\n\n<p><code>$GOPATH:git.apache.org/thrift.git/lib/go/thrift</code></p>\n\n<p><code>thrift.git git:(master) \u2717 git branch -a\n  master\n  remotes/origin/0.1.x\n* remotes/origin/0.10.0\n  remotes/origin/0.2.x\n  remotes/origin/0.3.x\n  remotes/origin/0.4.x\n  remotes/origin/0.5.x\n  remotes/origin/0.6.x\n  remotes/origin/0.7.x\n  remotes/origin/0.8.x\n  remotes/origin/0.9.1\n  remotes/origin/0.9.2\n  remotes/origin/0.9.3\n  remotes/origin/0.9.x\n  remotes/origin/HEAD -&gt; origin/master\n  remotes/origin/master\n  remotes/origin/py-compiler\n</code> </p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 8503729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2aa3ee6318118b1fd92c336afb4074a5?s=128&d=identicon&r=PG&f=1", "display_name": "Ken", "link": "https://stackoverflow.com/users/8503729/ken"}, "is_accepted": false, "score": 0, "last_activity_date": 1503469539, "creation_date": 1503469539, "answer_id": 45832091, "question_id": 45509414, "link": "https://stackoverflow.com/questions/45509414/golang-with-thrift-does-not-implement-thrift-tprocessorfunction-wrong-type-for/45832091#45832091", "title": "golang with thrift does not implement thrift.TProcessorFunction (wrong type for Process method)", "body": "<p>I sloved this problem by using the master branch of thrift to genergate go code.\n<a href=\"https://github.com/apache/thrift/tree/master\" rel=\"nofollow noreferrer\">https://github.com/apache/thrift/tree/master</a></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 8498766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18828b2e1e440746250aa8af01270006?s=128&d=identicon&r=PG&f=1", "display_name": "wenqiang", "link": "https://stackoverflow.com/users/8498766/wenqiang"}, "is_accepted": false, "score": 0, "last_activity_date": 1503544439, "last_edit_date": 1503544439, "creation_date": 1503541597, "answer_id": 45851994, "question_id": 45509414, "link": "https://stackoverflow.com/questions/45509414/golang-with-thrift-does-not-implement-thrift-tprocessorfunction-wrong-type-for/45851994#45851994", "title": "golang with thrift does not implement thrift.TProcessorFunction (wrong type for Process method)", "body": "<p>the reason is your thrift version is different \uff0c maybe you compile the thrift protocol using 0.9.2 version\uff0c but include the  thrift library file is 1.0.0 version</p>\n"}], "owner": {"reputation": 31, "user_id": 2982256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6276fa745217ab968c1db63a9bd4770?s=128&d=identicon&r=PG&f=1", "display_name": "user2982256", "link": "https://stackoverflow.com/users/2982256/user2982256"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1098, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1503544439, "creation_date": 1501857035, "last_edit_date": 1501866521, "question_id": 45509414, "link": "https://stackoverflow.com/questions/45509414/golang-with-thrift-does-not-implement-thrift-tprocessorfunction-wrong-type-for", "title": "golang with thrift does not implement thrift.TProcessorFunction (wrong type for Process method)", "body": "<p>I am getting this error:</p>\n\n<pre><code># metric_system\n./metric_system.go:227: cannot use myStructProviderProcessorGetMyStruct literal (type *myStructProviderProcessorGetMyStruct) as type thrift.TProcessorFunction in assignment:\n    *myStructProviderProcessorGetMyStruct does not implement thrift.TProcessorFunction (wrong type for Process method)\n        have Process(int32, thrift.TProtocol, thrift.TProtocol) (bool, thrift.TException)\n        want Process(context.Context, int32, thrift.TProtocol, thrift.TProtocol) (bool, thrift.TException)\n./metric_system.go:235: not enough arguments in call to processor.Process\n    have (int32, thrift.TProtocol, thrift.TProtocol)\n    want (context.Context, int32, thrift.TProtocol, thrift.TProtocol)\n</code></pre>\n\n<p>when I am building simple go app using golang 1.8.3 and thrift 0.10.0\nTo reproduce:</p>\n\n<pre><code>2038  thrift -r --gen go metric_system.thrift \n2040  cp -r gen-go/* src\n2041  cd src\n 2042  go build\n</code></pre>\n\n<p>folder structure</p>\n\n<pre><code>./metric_system.thrift\n./.settings\n./.settings/language.settings.xml\n./src\n./src/metric_system\n./src/metric_system/my_struct_provider-remote\n./src/metric_system/my_struct_provider-remote/my_struct_provider-remote.go\n./src/metric_system/metric_system.go\n./src/metric_system/GoUnusedProtection__.go\n./src/metric_system/metric_system-consts.go\n./src/main.go\n./.cproject\n./pkg\n./pkg/linux_amd64\n./.project\n./bin\n./gen-go\n./gen-go/metric_system\n./gen-go/metric_system/my_struct_provider-remote\n./gen-go/metric_system/my_struct_provider-remote/my_struct_provider-remote.go\n./gen-go/metric_system/metric_system.go\n./gen-go/metric_system/GoUnusedProtection__.go\n./gen-go/metric_system/metric_system-consts.go\n</code></pre>\n\n<p>metric_system.thrift file: </p>\n\n<pre><code>struct MyStruct { \n    1: i64 myInt, \n}\n\nservice MyStructProvider { MyStruct getMyStruct() }\n</code></pre>\n\n<p>Any help appreciated</p>\n"}, {"tags": ["mongodb", "go", "struct", "mgo"], "comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1501854947, "post_id": 45508642, "comment_id": 77978201, "body": "How could you find <code>&quot;cat&quot;</code> when you only inserted <code>&quot;dog&quot;</code>? I mean it &quot;might&quot; be there already, but as a self contained example your code seems to contradict itself and is looking for something different than you actually insert. So if you are writing to the correct source, then where is <code>&quot;dog&quot;</code>? Should this not indicate that you are actually writing to somewhere different?"}, {"owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1501855246, "post_id": 45508642, "comment_id": 77978489, "body": "Good question. I already have cat inserted. I tried inserting dog and then reading all to see if mgo inserts differently than robomongo. But the dog didn&#39;t even get inserted. Check out the picture I attached."}], "answers": [{"comments": [{"owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "edited": false, "score": 0, "creation_date": 1501856346, "post_id": 45508761, "comment_id": 77979364, "body": "Thanks I&#39;ll check this when I get home tonight"}, {"owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "edited": false, "score": 0, "creation_date": 1501857621, "post_id": 45508761, "comment_id": 77980237, "body": "Also, can you explain what is doing the exporting? I&#39;ve done a lot of node and with node you just type export. is it the bson and json tags here what makes it exported?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "edited": false, "score": 2, "creation_date": 1501857837, "post_id": 45508761, "comment_id": 77980411, "body": "@camccar Identifiers that start with capital letter are exported, it means they are accessible from all packages. Identifiers that do not start with capital letters are not exported, and are only accessible from the declaring package."}, {"owner": {"reputation": 10209, "user_id": 1637673, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/102059d423f2265e737117ce0947e7ee?s=128&d=identicon&r=PG", "display_name": "Mithril", "link": "https://stackoverflow.com/users/1637673/mithril"}, "edited": false, "score": 0, "creation_date": 1515575513, "post_id": 45508761, "comment_id": 83347296, "body": "Good tips! thanks, I have same problem . I wonder if there is a way to make mgo automatically use the fields of a struct , no matter a field is capital or not."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 10209, "user_id": 1637673, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/102059d423f2265e737117ce0947e7ee?s=128&d=identicon&r=PG", "display_name": "Mithril", "link": "https://stackoverflow.com/users/1637673/mithril"}, "edited": false, "score": 0, "creation_date": 1515575564, "post_id": 45508761, "comment_id": 83347328, "body": "@Mithril Fields must be exported, else the <code>mgo</code> package would not have access to them. This is a language restriction, not <code>mgo</code>&#39;s restriction."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1501860593, "last_edit_date": 1501860593, "creation_date": 1501855127, "answer_id": 45508761, "question_id": 45508642, "link": "https://stackoverflow.com/questions/45508642/golang-mgo-getting-empty-objects/45508761#45508761", "title": "Golang mgo getting empty objects", "body": "<p>You must export fields of structs, else they are ignored by the <code>mgo</code> package. Change fields of <code>users</code> to <code>User</code> and <code>Data</code>.</p>\n\n<pre><code>type users struct {\n    User string `bson:\"user\" json:\"user\"`\n    Data string `bson:\"data\" json:\"data\"` \n}\n</code></pre>\n\n<p>By default when a struct value is transformed / stored / retrieved from MongoDB, the field name is used. If you want to use different names, you may use <a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go/30889373#30889373\">tags</a> to tell what names should the fields map to.</p>\n"}], "owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2445, "favorite_count": 0, "accepted_answer_id": 45508761, "answer_count": 1, "score": 4, "last_activity_date": 1554157007, "creation_date": 1501854773, "last_edit_date": 1554157007, "question_id": 45508642, "link": "https://stackoverflow.com/questions/45508642/golang-mgo-getting-empty-objects", "title": "Golang mgo getting empty objects", "body": "<p>I'm trying to learn Go API development. I have a MongoDB instance running in a Docker container. I'm trying to follow a few guides but am failing on simple queries. I don't fully understand the use of BSON and JSON tags here. I do know what those terms mean. So here is my code.</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"time\"\n\n    \"gopkg.in/mgo.v2/bson\"\n)\n\nconst (\n    hosts      = \"localhost:27017\"\n    database   = \"my_database\"\n    username   = \"dev1\"\n    password   = \"password123\"\n    collection = \"users\"\n)\n\ntype users struct {\n    user string `bson:\"user\" json:\"user\"`\n    data string\n}\n\nfunc main() {\n\n    fmt.Println(\"Starting Application!\")\n\n    info := &amp;mgo.DialInfo{\n        Addrs:    []string{hosts},\n        Timeout:  60 * time.Second,\n        Database: database,\n        Username: username,\n        Password: password,\n    }\n\n    session, err1 := mgo.DialWithInfo(info)\n    if err1 != nil {\n        panic(err1)\n    }\n    defer session.Close()\n\n    col := session.DB(database).C(collection)\n\n    var user users\n    var books []users\n    var username = \"cat\"\n\n    col.Insert(&amp;users{user: \"dog\", data: \"blah\"})\n    err3 := col.Find(bson.M{\"user\": username}).One(&amp;user)\n    fmt.Println(user)\n    fmt.Println(err3)\n    count, err2 := col.Count()\n    if err2 != nil {\n        panic(err2)\n    }\n    fmt.Println(fmt.Sprintf(\"Messages count: %d\", count))\n\n    fmt.Println(user)\n    col.Find(bson.M{}).All(&amp;books)\n    fmt.Println(books)\n}\n</code></pre>\n\n<p>Basically I'm getting empty objects on the print line but am getting the correct Message count. I inserted the objects with robomongo if that helps.</p>\n\n<p><a href=\"https://i.stack.imgur.com/4HPlB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4HPlB.png\" alt=\"Objects in Collection\"></a></p>\n"}, {"tags": ["ssl", "go", "openssl", "ecdsa"], "comments": [{"owner": {"reputation": 619, "user_id": 4906754, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-6H5ncna-QvM/AAAAAAAAAAI/AAAAAAAAAAA/Baiv26Xi0eE/photo.jpg?sz=128", "display_name": "Fernando Costa", "link": "https://stackoverflow.com/users/4906754/fernando-costa"}, "edited": false, "score": 0, "creation_date": 1593226329, "post_id": 45508442, "comment_id": 110713037, "body": "I&#39;m facing a similar problem, but when the public key of the target server is parsed. Therefore, I cannot generate a new certificate."}], "answers": [{"tags": [], "owner": {"reputation": 1950, "user_id": 4731259, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/SolGq.jpg?s=128&g=1", "display_name": "Azize", "link": "https://stackoverflow.com/users/4731259/azize"}, "is_accepted": false, "score": 0, "last_activity_date": 1502115198, "last_edit_date": 1502115198, "creation_date": 1502113988, "answer_id": 45548648, "question_id": 45508442, "link": "https://stackoverflow.com/questions/45508442/golang-https-with-ecdsa-certificate-from-openssl/45548648#45548648", "title": "Golang HTTPS with ECDSA certificate from OpenSSL", "body": "<p>I couldn't figured out what is the problem between OpenSSL and Go.</p>\n\n<p>But my main problem is, how to generate ECDSA certificate to use with Go code!</p>\n\n<p>Using <code>CFSSL</code> (<a href=\"https://cfssl.org/\" rel=\"nofollow noreferrer\">https://cfssl.org/</a>) I can generate ECDSA certificate and sign it with my internal CA certificate generated from OpenSSL. The certificate generated from <code>CFSSL</code> works fine with my Go code, so for me it solves my main problem!</p>\n\n<p>I don't know if there is a format problem between OpenSSL and Go, but as <code>CFSSL</code> is written in Go, the certificate generated on it works fine in my code and in browser.</p>\n"}, {"comments": [{"owner": {"reputation": 1950, "user_id": 4731259, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/SolGq.jpg?s=128&g=1", "display_name": "Azize", "link": "https://stackoverflow.com/users/4731259/azize"}, "edited": false, "score": 0, "creation_date": 1517301493, "post_id": 48496424, "comment_id": 84028711, "body": "I don&#39;t know if it was an issue with my old Go version or with OpenSSL, but now even my old code works. Now I am using the latest Go version: <code>1.9.3</code>"}], "tags": [], "owner": {"reputation": 1, "user_id": 8486655, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-tN_WzzP_bY0/AAAAAAAAAAI/AAAAAAAACyk/MkjqRlUrMHs/photo.jpg?sz=128", "display_name": "Chandrakanth Narreddy", "link": "https://stackoverflow.com/users/8486655/chandrakanth-narreddy"}, "is_accepted": false, "score": 0, "last_activity_date": 1517211151, "creation_date": 1517211151, "answer_id": 48496424, "question_id": 45508442, "link": "https://stackoverflow.com/questions/45508442/golang-https-with-ecdsa-certificate-from-openssl/48496424#48496424", "title": "Golang HTTPS with ECDSA certificate from OpenSSL", "body": "<p>Here is an example of OpenSSL generated ECDSA keys working with Go.</p>\n\n<p><a href=\"https://play.golang.org/p/MS_FQ8cqqA8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MS_FQ8cqqA8</a>.</p>\n\n<p>As clarified in this issue - <a href=\"https://github.com/golang/go/issues/23591\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/23591</a>, go does not recognize EC keys that are generated with the <code>-param_enc explicit</code> flag in Openssl.</p>\n\n<p><code># openssl ecparam -name prime256v1 -genkey -noout -out priv2.pem</code></p>\n\n<p><code># openssl req -new -x509 -key priv2.pem -out EC_server2.pem -days 365</code></p>\n\n<p>Hope this solves your problem.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 10712008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dae6d120bdc51fc8a466c21275ca9e28?s=128&d=identicon&r=PG&f=1", "display_name": "elinax", "link": "https://stackoverflow.com/users/10712008/elinax"}, "is_accepted": false, "score": 0, "last_activity_date": 1560572924, "creation_date": 1560572924, "answer_id": 56607337, "question_id": 45508442, "link": "https://stackoverflow.com/questions/45508442/golang-https-with-ecdsa-certificate-from-openssl/56607337#56607337", "title": "Golang HTTPS with ECDSA certificate from OpenSSL", "body": "<p>Run:</p>\n\n<pre><code>go run `go env GOROOT`/src/crypto/tls/generate_cert.go --host=localhost --ecdsa-curve=P256\n</code></pre>\n\n<p>This will generate <code>cert.pem</code> and <code>key.pem</code> in the current directory.</p>\n"}], "owner": {"reputation": 1950, "user_id": 4731259, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/SolGq.jpg?s=128&g=1", "display_name": "Azize", "link": "https://stackoverflow.com/users/4731259/azize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1264, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1560572924, "creation_date": 1501854219, "question_id": 45508442, "link": "https://stackoverflow.com/questions/45508442/golang-https-with-ecdsa-certificate-from-openssl", "title": "Golang HTTPS with ECDSA certificate from OpenSSL", "body": "<p>I don't know if this is the correct place to ask it, but I will try.</p>\n\n<p>I am trying to run <code>http.ListenAndServeTLS</code> with ECDSA certificate generated from OpenSSL.</p>\n\n<p>It fail with this error message: <code>tls: failed to parse private key</code></p>\n\n<p>Go understand <code>elliptic.P256()</code>, in the code it has this comment <code>See FIPS 186-3, section D.2.3</code>.</p>\n\n<p>In this link: <a href=\"http://www.ietf.org/rfc/rfc5480.txt\" rel=\"nofollow noreferrer\">http://www.ietf.org/rfc/rfc5480.txt</a>, it says it is also called <code>secp256r1</code>.</p>\n\n<p>As you can see below, OpenSSL undestand this as <code>prime256v1</code>.</p>\n\n<pre><code>$ openssl ecparam -name secp256r1 -text -noout\nusing curve name prime256v1 instead of secp256r1\nASN1 OID: prime256v1\nNIST CURVE: P-256\n</code></pre>\n\n<p>So what is wrong?\nHow can I generate ECDSA certificate from OpenSSL and use it on my Go code?</p>\n\n<p>Using <code>generate_cert.go</code> to generate a P256 ECDSA certificate, my code works, but if I try to read the key file with OpenSSL it fail also.</p>\n\n<pre><code>$ openssl ecparam -text -noout -in key.pem \nunable to load elliptic curve parameters\n140377431725720:error:0906D06C:PEM routines:PEM_read_bio:no start line:pem_lib.c:701:Expecting: EC PARAMETERS\n</code></pre>\n"}, {"tags": ["go", "struct", "nested"], "comments": [{"owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "edited": false, "score": 0, "creation_date": 1501865578, "post_id": 45508189, "comment_id": 77984934, "body": "i tried the way explained that and it&#39;s still not working and it displays <code>cannot use struct {C interface} literal (type struct{C interface{}} as type struct{C interface{}}) *some weird error* in field value</code>"}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "edited": false, "score": 0, "creation_date": 1501857453, "post_id": 45508226, "comment_id": 77980115, "body": "Thanks @captncraig , but it&#39;s not working, i have improved the question, have a look at it again."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 0, "last_activity_date": 1501853563, "creation_date": 1501853563, "answer_id": 45508226, "question_id": 45508189, "link": "https://stackoverflow.com/questions/45508189/how-to-initialise-the-nested-structure-in-go/45508226#45508226", "title": "How to initialise the nested structure in go?", "body": "<p>The problem is that <code>B</code> is an anonymous embedded struct. In order to define a struct literal as a member of another struct, you need to give the type. The easiest thing to do is actually define struct types for your anonymous types.</p>\n\n<p>You could make it work by doing this really ugly thing though (assuming C and D are defined somewhere):</p>\n\n<pre><code>x := &amp;A{\n        B: struct{C interface{}}{\n             C : map[string]interface{}{\n                 D: 123,\n                 E: xyx,\n             },\n        },\n} \n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 341, "favorite_count": 0, "closed_date": 1501854133, "answer_count": 1, "score": -2, "last_activity_date": 1501865310, "creation_date": 1501853449, "last_edit_date": 1501865310, "question_id": 45508189, "link": "https://stackoverflow.com/questions/45508189/how-to-initialise-the-nested-structure-in-go", "closed_reason": "Duplicate", "title": "How to initialise the nested structure in go?", "body": "<p>My structure is like this</p>\n\n<pre><code>type A struct{\n        B struct{\n           C interface{} `json:\"c\"`\n     }\n}\ntype C struct{\n        D  string  `json:\"d\"`\n        E  string  `json:\"e\"`\n}\n</code></pre>\n\n<p>use of this struct is like this way,</p>\n\n<pre><code>func someFunc(){\n  var x A\n  anotherFunc(&amp;x)\n}\n\nfunc anotherFunc(obj interface{}){\n// resp.Body has this {D: \"123\", E: \"xyx\"} \n return json.NewDecoder(resp.Body).Decode(obj)\n}\n</code></pre>\n\n<p>and i have to initialise it for the unit testing and i am doing this,</p>\n\n<pre><code>x := &amp;A{\n        B: {\n             C : map[string]interface{}{\n                 D: 123,\n                 E: xyx,\n             },\n        },\n} \n</code></pre>\n\n<p>but getting error <code>missing type in composite literal</code>, what am i doing wrong?</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 46, "user_id": 3144840, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/usgFv.png?s=128&g=1", "display_name": "mzupan", "link": "https://stackoverflow.com/users/3144840/mzupan"}, "is_accepted": false, "score": 0, "last_activity_date": 1501862220, "creation_date": 1501862220, "answer_id": 45511074, "question_id": 45507585, "link": "https://stackoverflow.com/questions/45507585/populate-slice-of-objects-together-with-referenced-objects/45511074#45511074", "title": "Populate slice of objects together with referenced objects", "body": "<p>If I understand you correctly, you want to eagerly load the CurrentState when fetching your Orders.</p>\n\n<p>In this case, I would suggest taking a look at the Preload-API at <a href=\"http://jinzhu.me/gorm/crud.html#preloading-eager-loading\" rel=\"nofollow noreferrer\">http://jinzhu.me/gorm/crud.html#preloading-eager-loading</a></p>\n"}], "owner": {"reputation": 391, "user_id": 5816516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf4bab28a115e763c471b44d7edc99d0?s=128&d=identicon&r=PG", "display_name": "Oleh Holovko", "link": "https://stackoverflow.com/users/5816516/oleh-holovko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1527757219, "creation_date": 1501851780, "last_edit_date": 1527757219, "question_id": 45507585, "link": "https://stackoverflow.com/questions/45507585/populate-slice-of-objects-together-with-referenced-objects", "title": "Populate slice of objects together with referenced objects", "body": "<p>Imagine I have 2 structs:</p>\n\n<pre><code>type Order struct {\n     ID             int64 `gorm:\"primary_key\"`\n     CurrentStateID int64 \n     CurrentState   *OrderState\n}\ntype OrderState struct {\n   ID      int64\n   .... // other fields\n}\n</code></pre>\n\n<p>Now I want to make a search given a slice of <code>orderIDs</code> and have a slice of <code>Order</code> with filled <code>CurrentState</code> fields. </p>\n\n<p>My current solution is really ugly as I firstly fetch all orders without states, then arrange state ids into a slice and make a search by them. After that, I iterate in a for loop over orders and match orders and states together. Like</p>\n\n<pre><code>var (\n    states []*State\n    orders []*Orders\n)\n//searches are done here\nfor _, order := range orders {\n    for _, state := range states {\n        if order.CurrentStateID == state.ID {\n             order.CurrentState = state \n             break\n         }\n     }\n}\n</code></pre>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 606, "user_id": 4257143, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q195EKev0qQ/AAAAAAAAAAI/AAAAAAAAAxM/R2bEEt98Yrc/photo.jpg?sz=128", "display_name": "Doug Henderson", "link": "https://stackoverflow.com/users/4257143/doug-henderson"}, "edited": false, "score": 0, "creation_date": 1501886161, "post_id": 45506424, "comment_id": 77994012, "body": "Initially, theByteVar has len() of 0 and cap() of 128. Len() of 0 means it is empty. If not empty, you can then use a for/range to test for non-zero and break on first occurrence when it is not empty."}, {"owner": {"reputation": 606, "user_id": 4257143, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q195EKev0qQ/AAAAAAAAAAI/AAAAAAAAAxM/R2bEEt98Yrc/photo.jpg?sz=128", "display_name": "Doug Henderson", "link": "https://stackoverflow.com/users/4257143/doug-henderson"}, "edited": false, "score": 1, "creation_date": 1501886296, "post_id": 45506424, "comment_id": 77994041, "body": "But, you seem to be confused about slices and arrays. Make sure to understand the difference. For an array you will need to iterate over all elements to test for non-zero."}, {"owner": {"reputation": 927, "user_id": 1208557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cfea2437a796a38fd79e25a648a3ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Jinxmcg", "link": "https://stackoverflow.com/users/1208557/jinxmcg"}, "reply_to_user": {"reputation": 606, "user_id": 4257143, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q195EKev0qQ/AAAAAAAAAAI/AAAAAAAAAxM/R2bEEt98Yrc/photo.jpg?sz=128", "display_name": "Doug Henderson", "link": "https://stackoverflow.com/users/4257143/doug-henderson"}, "edited": false, "score": 0, "creation_date": 1502109742, "post_id": 45506424, "comment_id": 78053787, "body": "It seems len returns 128 as well so I cannot check for empty. <a href=\"https://play.golang.org/p/plx-vt0XjC\" rel=\"nofollow noreferrer\">play.golang.org/p/plx-vt0XjC</a>"}], "answers": [{"comments": [{"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 4, "creation_date": 1501850530, "post_id": 45506459, "comment_id": 77974927, "body": "One advantage to this is that if done properly, you&#39;ll take advantage of CPU L1 cache optimizations, such as Intel&#39;s static read prediction. This is why the Go language has you just iterate over items in a collection instead of using some fancy built-in abstracted extension. As long as you keep your structs aligned, and you are using L1 smartly that is.  For example, if swapping bytes often, you may want to store the bits in int64 instead: so you would have less L1 cache invalidation."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 5, "last_activity_date": 1501848831, "last_edit_date": 1501848831, "creation_date": 1501848515, "answer_id": 45506459, "question_id": 45506424, "link": "https://stackoverflow.com/questions/45506424/how-to-check-if-byte-is-all-zeros-in-go/45506459#45506459", "title": "How to check if []byte is all zeros in go", "body": "<p>Comparing it with another slice containing only zeros, that requires reading (and comparing) 2 slices.</p>\n\n<p>Using a single for loop will be more efficient here:</p>\n\n<pre><code>for _, v := range theByteVar {\n    if v != 0 {\n        doSomething(theByteVar)\n        break\n    }\n}\n</code></pre>\n\n<p>If you do need to use it in multiple places, wrap it in a utility function:</p>\n\n<pre><code>func allZero(s []byte) bool {\n    for _, v := range s {\n        if v != 0 {\n            return false\n        }\n    }\n    return true\n}\n</code></pre>\n\n<p>And then using it:</p>\n\n<pre><code>if !allZero(theByteVar) {\n    doSomething(theByteVar)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": true, "score": 3, "last_activity_date": 1501868452, "creation_date": 1501868452, "answer_id": 45512643, "question_id": 45506424, "link": "https://stackoverflow.com/questions/45506424/how-to-check-if-byte-is-all-zeros-in-go/45512643#45512643", "title": "How to check if []byte is all zeros in go", "body": "<p>You can possibly use bytes.Equal or bytes.Contains to compare with a zero initialized byte slice, see <a href=\"https://play.golang.org/p/mvUXaTwKjP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/mvUXaTwKjP</a>, I haven't checked for performance, but hopefully it's been optimized. You might want to try out other solutions and compare the performance numbers, if needed.</p>\n"}, {"tags": [], "owner": {"reputation": 64, "user_id": 7540446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31e63eed9ff667bc813acddfe85548fc?s=128&d=identicon&r=PG&f=1", "display_name": "Scherzando", "link": "https://stackoverflow.com/users/7540446/scherzando"}, "is_accepted": false, "score": 3, "last_activity_date": 1596597489, "last_edit_date": 1596597489, "creation_date": 1596592292, "answer_id": 63257307, "question_id": 45506424, "link": "https://stackoverflow.com/questions/45506424/how-to-check-if-byte-is-all-zeros-in-go/63257307#63257307", "title": "How to check if []byte is all zeros in go", "body": "<p>Another solution borrows an idea from C. It could be achieved by using the <code>unsafe</code> package in Go.</p>\n<p>The idea is simple, instead of checking each byte from []byte, we can check the value of <code>byte[i:i+8]</code>, which is a <code>uint64</code> value, in each steps. By doing this we can check 8 bytes instead of checking only one byte in each iteration.</p>\n<p>Below codes are not best practice but only show the idea.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>const (\n    len8 int = 0xFFFFFFF8\n)\n\nfunc IsAllBytesZero(data []byte) bool {\n    n := len(data)\n\n    // Magic to get largest length which could be divided by 8. \n    nlen8 := n &amp; len8\n    i := 0\n\n    for ; i &lt; nlen8; i += 8 {\n        b := *(*uint64)(unsafe.Pointer(uintptr(unsafe.Pointer(&amp;data[0])) + 8*uintptr(i)))\n        if b != 0 {\n            return false\n        }\n    }\n\n    for ; i &lt; n; i++ {\n        if data[i] != 0 {\n            return false\n        }\n    }\n\n    return true\n}\n</code></pre>\n<h1>Benchmark</h1>\n<h2>Testcases:</h2>\n<p>Only test for worst cases (all elements are zero)</p>\n<h2>Methods:</h2>\n<ul>\n<li>IsAllBytesZero: <code>unsafe</code> package solution</li>\n<li>NaiveCheckAllBytesAreZero: a loop to iterate the whole byte array and check it.</li>\n<li>CompareAllBytesWithFixedEmptyArray: using <code>bytes.Compare</code> solution with pre-allocated fixed size empty byte array.</li>\n<li>CompareAllBytesWithDynamicEmptyArray: using <code>bytes.Compare</code> solution without pre-allocated fixed size empty byte array.</li>\n</ul>\n<h2>Results</h2>\n<pre><code>BenchmarkIsAllBytesZero10-8                                 254072224            4.68 ns/op\nBenchmarkIsAllBytesZero100-8                                132266841            9.09 ns/op\nBenchmarkIsAllBytesZero1000-8                               19989015            55.6 ns/op\nBenchmarkIsAllBytesZero10000-8                               2344436           507 ns/op\nBenchmarkIsAllBytesZero100000-8                              1727826           679 ns/op\nBenchmarkNaiveCheckAllBytesAreZero10-8                      234153582            5.15 ns/op\nBenchmarkNaiveCheckAllBytesAreZero100-8                     30038720            38.2 ns/op\nBenchmarkNaiveCheckAllBytesAreZero1000-8                     4300405           291 ns/op\nBenchmarkNaiveCheckAllBytesAreZero10000-8                     407547          2666 ns/op\nBenchmarkNaiveCheckAllBytesAreZero100000-8                     43382         27265 ns/op\nBenchmarkCompareAllBytesWithFixedEmptyArray10-8             415171356            2.71 ns/op\nBenchmarkCompareAllBytesWithFixedEmptyArray100-8            218871330            5.51 ns/op\nBenchmarkCompareAllBytesWithFixedEmptyArray1000-8           56569351            21.0 ns/op\nBenchmarkCompareAllBytesWithFixedEmptyArray10000-8           6592575           177 ns/op\nBenchmarkCompareAllBytesWithFixedEmptyArray100000-8           567784          2104 ns/op\nBenchmarkCompareAllBytesWithDynamicEmptyArray10-8           64215448            19.8 ns/op\nBenchmarkCompareAllBytesWithDynamicEmptyArray100-8          32875428            35.4 ns/op\nBenchmarkCompareAllBytesWithDynamicEmptyArray1000-8          8580890           140 ns/op\nBenchmarkCompareAllBytesWithDynamicEmptyArray10000-8         1277070           938 ns/op\nBenchmarkCompareAllBytesWithDynamicEmptyArray100000-8         121256         10355 ns/op\n</code></pre>\n<h1>Summary</h1>\n<p>Assumed that we're talking about the condition in sparse zero byte array. According to the benchmark, if performance is an issue, the naive check solution would be a bad idea. And, if you don't want to use <code>unsafe</code> package in your project, then consider using <code>bytes.Compare</code> solution with pre-allocated empty array as an alternative.</p>\n<p>An interesting point could be pointed out is that the performance comes from <code>unsafe</code> package varies a lot, but it basically outperform all other solution mentioned above. I think it was relevant to the CPU cache mechanism.</p>\n"}], "owner": {"reputation": 927, "user_id": 1208557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cfea2437a796a38fd79e25a648a3ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Jinxmcg", "link": "https://stackoverflow.com/users/1208557/jinxmcg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8939, "favorite_count": 0, "accepted_answer_id": 45512643, "answer_count": 3, "score": 6, "last_activity_date": 1596597489, "creation_date": 1501848359, "last_edit_date": 1502113191, "question_id": 45506424, "link": "https://stackoverflow.com/questions/45506424/how-to-check-if-byte-is-all-zeros-in-go", "title": "How to check if []byte is all zeros in go", "body": "<p>Is there a way to check if a byte slice is empty or 0 without checking each element or using reflect?</p>\n\n<pre><code>theByteVar := make([]byte, 128)\n\nif \"theByteVar is empty or zeroes\" {\n   doSomething()\n}\n</code></pre>\n\n<p>One solution which seems weird that I found was to keep an empty byte array for comparison.</p>\n\n<pre><code>theByteVar := make([]byte, 128)\nemptyByteVar := make([]byte, 128)\n\n// fill with anything\ntheByteVar[1] = 2\n\nif reflect.DeepEqual(theByteVar,empty) == false {\n   doSomething(theByteVar)\n}\n</code></pre>\n\n<p>For sure there must be a better/quicker solution.</p>\n\n<p>Thanks</p>\n\n<p>UPDATE did some comparison for 1000 loops and the reflect way is the worst by far...</p>\n\n<pre><code>Equal Loops: 1000 in true in 19.197\u00b5s\nContains Loops: 1000 in true in 34.507\u00b5s\nAllZero Loops: 1000 in true in 117.275\u00b5s\nReflect Loops: 1000 in true in 14.616277ms\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 1, "creation_date": 1501848513, "post_id": 45505723, "comment_id": 77973484, "body": "Well you don&#39;t actually need <code>$in</code>, and it&#39;s a common misconception that you do but the &quot;array&quot; is of &quot;arguments&quot; and not &quot;target&quot; and MongoDB does not care if the actual data is in an array or not.  Check you actually have the correct collection and that your content in <code>groupName</code> is actually what you think it is. The only reasons for not returning anything are either you are looking in the wrong place or looking for the wrong thing. The query syntax itself is fine."}, {"owner": {"reputation": 1002, "user_id": 1403418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/584798ec6087016edd377e84f96f36cf?s=128&d=identicon&r=PG&f=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/1403418/dan"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1501851672, "post_id": 45505723, "comment_id": 77975734, "body": "I set the query to nil and I get Sources back so the collection is correct."}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1501851852, "post_id": 45505723, "comment_id": 77975860, "body": "Well that still leaves the input, or your interpretation thereof. So what happens when you try to match on <code>&quot;Name&quot;</code> or <code>&quot;UserName&quot;</code> or basically any other field that is not an array? Are you possibly defining <code>groupName</code> as <code>[]string</code> instead of just <code>string</code>. These are the things that will be your actual problem. There is nothing wrong with MongoDB or the driver."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501853003, "post_id": 45505723, "comment_id": 77976678, "body": "<code>q := bson.M{&quot;Groups&quot;: groupName}</code> is the correct query for your case. Have you tried your queries in the mongo shell?"}], "answers": [{"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 0, "last_activity_date": 1502155012, "creation_date": 1502155012, "answer_id": 45557848, "question_id": 45505723, "link": "https://stackoverflow.com/questions/45505723/querying-for-in-string-array-in-mgo/45557848#45557848", "title": "Querying for in string array in mgo", "body": "<p>Make sure to double check the capitalisation of your document field names. For example, if in your documents you have</p>\n\n<pre><code>{ \"Groups\": [\"test1\", \"test2\"] }\n</code></pre>\n\n<p>You also need to query using capital <code>G</code> as below: </p>\n\n<pre><code>query := bson.M{\"Groups\": groupName}\n</code></pre>\n\n<p>I think the issue here is that you have lower case <code>groups</code> in your document. </p>\n\n<p>Your <code>mgo</code> <a href=\"https://gobyexample.com/structs\" rel=\"nofollow noreferrer\">Struct</a> however is capital <code>Groups</code>, which <code>mgo</code> will automatically map to lower case <code>groups</code> document field. Thus querying using lower case <code>groups</code> field name will not return any match (but query all does). If this is the case, you need to query using: </p>\n\n<pre><code>query := bson.M{\"groups\": groupName}\n</code></pre>\n\n<p>If however, your document field names are in first letter capital, then you also need to specify <a href=\"https://godoc.org/labix.org/v2/mgo/bson#Marshal\" rel=\"nofollow noreferrer\">marshalling mapping</a> as below: </p>\n\n<pre><code>type Source struct {\n    Name     string   `bson:\"Name\"`\n    DBType   uint     `bson:\"DBType\"`\n    UserName string   `bson:\"UserName\"`\n    Password string   `bson:\"Password\"`\n    Host     string   `bson:\"Host\"`\n    Port     string   `bson:\"Port\"`\n    DBName   string   `bson:\"DBName\"`\n    Options  string   `bson:\"Options\"`\n    Groups   []string `bson:\"Groups\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 1002, "user_id": 1403418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/584798ec6087016edd377e84f96f36cf?s=128&d=identicon&r=PG&f=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/1403418/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1837, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1512428759, "creation_date": 1501846283, "last_edit_date": 1512428759, "question_id": 45505723, "link": "https://stackoverflow.com/questions/45505723/querying-for-in-string-array-in-mgo", "title": "Querying for in string array in mgo", "body": "<p>I have an element that looks like this:</p>\n\n<pre><code>{\"Name\":\"test name\",\"DBType\":0,\"UserName\":\"test user\",\"Password\":\"\",\"Host\":\"test host\",\"Port\":\"123\",\"DBName\":\"test schema\",\"Options\":\"test options\",\"Groups\":[\"test1\"]}\n</code></pre>\n\n<p>I want to be able to query the cataloug of Datasources for those which are assigned to a particular group.</p>\n\n<p>My code for this is:</p>\n\n<pre><code>var d []Source\nq := bson.M{\"Groups\": bson.M{\"$in\": [1]string{groupName}}}\nfindErr := c.Find(q).All(&amp;d)\n</code></pre>\n\n<p>However - I get no error and no results.</p>\n\n<p>I've also tried</p>\n\n<pre><code>q := bson.M{\"Groups\": groupName}\n</code></pre>\n\n<p>with the same result.</p>\n\n<pre><code>//Source describes a data source\ntype Source struct {\n    Name string\n    DBType      uint\n    UserName    string\n    Password    string\n    Host        string\n    Port        string\n    DBName      string\n    Options     string\n    Groups      []string\n}\n</code></pre>\n\n<p>I'm stuck - I am puzzled!  Any help appreciated.</p>\n\n<p>Update - I tried</p>\n\n<pre><code>{\"Name\":\"test name\"}\n</code></pre>\n\n<p>and this returns 0 items.  Yet if I set to nil I get stuff.</p>\n"}, {"tags": ["sql-server", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1501864597, "post_id": 45504854, "comment_id": 77984395, "body": "Are you using MySQL (as mentioned in your question) or SQL server, as mentioned in your tag and your code?"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 1, "creation_date": 1501868022, "post_id": 45504854, "comment_id": 77986243, "body": "As stated in the error, you&#39;re facing authentication issue. Check the library documentation for connection string and resolve your login issue. Then your query would work."}, {"owner": {"reputation": 9, "user_id": 7932485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4b5a2f4be96a4d6a1e895f77c8e2448?s=128&d=identicon&r=PG&f=1", "display_name": "ju4ns3rr4n0", "link": "https://stackoverflow.com/users/7932485/ju4ns3rr4n0"}, "edited": false, "score": 0, "creation_date": 1501868785, "post_id": 45504854, "comment_id": 77986612, "body": "The user and password are ok, because when I use python the connection is ok. I don&#39;t understand because in go don&#39;t work. When I connect with sql.Open there isn&#39;t error. The error is in conn.Query."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1501887416, "post_id": 45504854, "comment_id": 77994353, "body": "One thing that you shouldn&#39;t assume is that just because you&#39;ve done it one way with one language is that its going to work the same way with another language.  Forgot about how it works in python and debug why it doesn&#39;t work in Go. Also check that your server is running."}], "owner": {"reputation": 9, "user_id": 7932485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4b5a2f4be96a4d6a1e895f77c8e2448?s=128&d=identicon&r=PG&f=1", "display_name": "ju4ns3rr4n0", "link": "https://stackoverflow.com/users/7932485/ju4ns3rr4n0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 259, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1501864568, "creation_date": 1501843653, "last_edit_date": 1501864568, "question_id": 45504854, "link": "https://stackoverflow.com/questions/45504854/select-in-golang", "title": "Select in Golang", "body": "<p>I want to connect a <code>MSSQL</code> database, in python I get connecting to this database but in <code>Go</code> I can not.</p>\n\n<p>When I exec this code I receive this error:</p>\n\n<blockquote>\n  <p>2017/08/04 12:25:39 Select failed:Login error: EOF</p>\n</blockquote>\n\n<p>why?</p>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"flag\"\n    \"fmt\"\n    \"log\"\n\n    _ \"github.com/denisenkom/go-mssqldb\"\n)\n\nvar (\n    debug         = flag.Bool(\"debug\", false, \"enable debugging\")\n    password      = flag.String(\"password\", \"********\", \"the database password\")\n    port     *int = flag.Int(\"port\", 1433, \"the database port\")\n    server        = flag.String(\"server\", \"sql2008v\\\\2k8\", \"the database server\")\n    user          = flag.String(\"user\", \"usuario\", \"the database user\")\n)\n\nfunc main() {\n    flag.Parse()\n\n    if *debug {\n        fmt.Printf(\" password:%s\\n\", *password)\n        fmt.Printf(\" port:%d\\n\", *port)\n        fmt.Printf(\" server:%s\\n\", *server)\n        fmt.Printf(\" user:%s\\n\", *user)\n    }\n\n    connString := fmt.Sprintf(\"server=%s;user id=%s;password=%s;port=%d\", *server, *user, *password, *port)\n    if *debug {\n        fmt.Printf(\" connString:%s\\n\", connString)\n    }\n    conn, err := sql.Open(\"mssql\", connString)\n    if err != nil {\n        log.Fatal(\"Open connection failed:\", err.Error())\n    }\n\n    defer conn.Close()\n\n    rows, err := conn.Query(\"SELECT TOP (1000) *  FROM [jiradb].[jiraschema].[jiraissue]\")\n    if err != nil {\n        log.Fatal(\"Select failed:\", err.Error())\n    }\n    defer rows.Close()\n\n    fmt.Printf(\"bye\\n\")\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 7560407, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e8f634ea6fd3f2d6f1073ea99d808855?s=128&d=identicon&r=PG&f=1", "display_name": "boubker elamri", "link": "https://stackoverflow.com/users/7560407/boubker-elamri"}, "edited": false, "score": 0, "creation_date": 1501842163, "post_id": 45504288, "comment_id": 77969212, "body": "my string has the length of 84"}, {"owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "reply_to_user": {"reputation": 23, "user_id": 7560407, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e8f634ea6fd3f2d6f1073ea99d808855?s=128&d=identicon&r=PG&f=1", "display_name": "boubker elamri", "link": "https://stackoverflow.com/users/7560407/boubker-elamri"}, "edited": false, "score": 1, "creation_date": 1501842360, "post_id": 45504288, "comment_id": 77969342, "body": "It would be helpful if you could add the error you are getting and line number in the question."}, {"owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "reply_to_user": {"reputation": 23, "user_id": 7560407, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e8f634ea6fd3f2d6f1073ea99d808855?s=128&d=identicon&r=PG&f=1", "display_name": "boubker elamri", "link": "https://stackoverflow.com/users/7560407/boubker-elamri"}, "edited": false, "score": 1, "creation_date": 1501842961, "post_id": 45504288, "comment_id": 77969740, "body": "@boubkerelamri You need to add the corresponding line numbers in code snippet as well. Or you could just add a <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">play.golang.org</a> link to give a  Minimal, Complete, and Verifiable example. <a href=\"https://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>"}, {"owner": {"reputation": 23, "user_id": 7560407, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e8f634ea6fd3f2d6f1073ea99d808855?s=128&d=identicon&r=PG&f=1", "display_name": "boubker elamri", "link": "https://stackoverflow.com/users/7560407/boubker-elamri"}, "edited": false, "score": 0, "creation_date": 1501843455, "post_id": 45504288, "comment_id": 77970079, "body": "i didn&#39;t understand sorry"}], "tags": [], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "is_accepted": false, "score": 2, "last_activity_date": 1501842275, "last_edit_date": 1501842275, "creation_date": 1501842109, "answer_id": 45504288, "question_id": 45504146, "link": "https://stackoverflow.com/questions/45504146/slice-bounds-out-of-range-error-and-i-dont-have-any-slice-variable/45504288#45504288", "title": "slice bounds out of range error and i don&#39;t have any slice variable", "body": "<p>A string is a slice of characters in Go. That is why you are able to slice the string like <code>record[56:58]</code>. </p>\n\n<p>You need to check the length of the string before slicing it to avoid panics.</p>\n\n<p>Something like </p>\n\n<pre><code>if len(string)&lt;requiredLen{\n  return\n}\na := string[requiredLen-2:requiredLen]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 23, "user_id": 7560407, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e8f634ea6fd3f2d6f1073ea99d808855?s=128&d=identicon&r=PG&f=1", "display_name": "boubker elamri", "link": "https://stackoverflow.com/users/7560407/boubker-elamri"}, "edited": false, "score": 0, "creation_date": 1501842336, "post_id": 45504304, "comment_id": 77969323, "body": "header has a length of 64 and record 84 and the i just want to take the data from a part of it"}, {"owner": {"reputation": 165, "user_id": 6475160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17a70867403bef59444d9b8722651424?s=128&d=identicon&r=PG&f=1", "display_name": "Qubert", "link": "https://stackoverflow.com/users/6475160/qubert"}, "edited": false, "score": 0, "creation_date": 1501883916, "post_id": 45504304, "comment_id": 77993396, "body": "You could add bounds checking inside of each function that takes a slice of a string input, this will likely help you find your error. For example inside of getDate() add a check to see if date does indeed have a length of at least 14, otherwise if you make a mistake and run on a null date, or a short date, you will see that error. There are slices everywhere in your code, and unchecked/checked late errors (eg not checking err until after you use durt in getQuantDate...) Fix your error checking and you&#39;ll find the mistake."}], "tags": [], "owner": {"reputation": 271, "user_id": 6695631, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YoG2L3Z5hLg/AAAAAAAAAAI/AAAAAAAADUg/38OMkEFD6Zw/photo.jpg?sz=128", "display_name": "Konrad Zapa\u0142owicz", "link": "https://stackoverflow.com/users/6695631/konrad-zapa%c5%82owicz"}, "is_accepted": false, "score": 2, "last_activity_date": 1501842161, "creation_date": 1501842161, "answer_id": 45504304, "question_id": 45504146, "link": "https://stackoverflow.com/questions/45504146/slice-bounds-out-of-range-error-and-i-dont-have-any-slice-variable/45504304#45504304", "title": "slice bounds out of range error and i don&#39;t have any slice variable", "body": "<p>Well, whenever you write code like</p>\n\n<pre><code>x := y[a:b]\n</code></pre>\n\n<p>you are effectively slicing. I suggest you check the length of the \"header\" and \"record\" before you do any processing on it.</p>\n\n<p>Hope it helps.</p>\n"}], "owner": {"reputation": 23, "user_id": 7560407, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e8f634ea6fd3f2d6f1073ea99d808855?s=128&d=identicon&r=PG&f=1", "display_name": "boubker elamri", "link": "https://stackoverflow.com/users/7560407/boubker-elamri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1967, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1501842480, "creation_date": 1501841677, "last_edit_date": 1501842480, "question_id": 45504146, "link": "https://stackoverflow.com/questions/45504146/slice-bounds-out-of-range-error-and-i-dont-have-any-slice-variable", "title": "slice bounds out of range error and i don&#39;t have any slice variable", "body": "<p>i'm working on a project and i had an error taht say slice bounds out of range but the lines that are concerned with this error don't seem to be a slive variable:</p>\n\n<pre><code>bt.blockDateTime =bt.getDate(bt.getDateBlockHeader(header[10:22]))\nserviceType := hex2decimal(record[56:58])\n</code></pre>\n\n<p>and here are the function that i have created that i have used :</p>\n\n<pre><code>func(bt *Hc34) getDateBlockHeader(input string) string{\n        year := input[0:2]\n        quant:= hex2decimal(input[3:6])\n        hour := input[6:len(input)];\n        /*if err!=nil{\n            panic(err)\n        }*/\n        return \"20\" + year + bt.getQuantDate(quant) + \"\" + hour\n    }\nfunc(bt *Hc34) getDate(date string) string{\n        year := date[0:4]\n        month := date[4:6]\n        day := date[6:8]\n        hour := date[8:10]\n        minute := date[10:12]\n        second := date[12:14]\n        return year + \"-\" + month + \"-\" + day + \" \" + hour + \":\" + minute + \":\" + second;\n    }\nfunc(bt *Hc34) getQuantDate(quant int) string{\n        nanoDayOfYear:=strconv.FormatInt(int64(quant)*24*60*60*1000*1000*1000, 10) + \"ns\"\n        durt,err:=time.ParseDuration(nanoDayOfYear)\n        t := time.Date(2009, time.January, 01, 00, 0, 0, 0, time.UTC)\n        t=t.Add(durt)\n        if err!=nil{\n\n            panic(err)\n        }\n        return string(t.Month())+\"\"+string(t.Day())\n\n    }\nfunc hex2decimal(hexStr string) int{\n    integer,_:=strconv.ParseInt(hexStr,0,64)\n    return int(integer)\n\n}\n</code></pre>\n\n<p>here is the error lines:\npanic: runtime error: slice bounds out of range</p>\n\n<pre><code>goroutine 1 [running]:\ngithub.com/bob96/hc34/beater.(*Hc34).hc34decoderfunc(0xc420238380, 0xc4202cc000, 0x2d128)\n    /home/hp/src/github.com/bob96/hc34/beater/hc34.go:190 +0xb60\ngithub.com/bob96/hc34/beater.(*Hc34).hc34DataHolderfunc(0xc420238380, 0xc42016e3c0, 0x5e)\n    /home/hp/src/github.com/bob96/hc34/beater/hc34.go:141 +0xd3\ngithub.com/bob96/hc34/beater.(*Hc34).Run(0xc420238380, 0xc420176000, 0xc4201760a8, 0xb)\n    /home/hp/src/github.com/bob96/hc34/beater/hc34.go:105 +0x109\ngithub.com/bob96/hc34/vendor/github.com/elastic/beats/libbeat/beat.(*Beat).launch(0xc420176000, 0x9a84e8, 0x0, 0x0)\n    /home/hp/src/github.com/bob96/hc34/vendor/github.com/elastic/beats/libbeat/beat/beat.go:211 +0x706\ngithub.com/bob96/hc34/vendor/github.com/elastic/beats/libbeat/beat.Run(0x9855d5, 0x4, 0x0, 0x0, 0x9a84e8, 0xc4200001a0, 0xc4200001a0)\n    /home/hp/src/github.com/bob96/hc34/vendor/github.com/elastic/beats/libbeat/beat/beat.go:136 +0x65\nmain.main()\n    /home/hp/src/github.com/bob96/hc34/main.go:12 +0x54\n</code></pre>\n\n<p>can some one help me please it will be a bless!</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 1, "creation_date": 1501841668, "post_id": 45504011, "comment_id": 77968889, "body": "<a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/sum/\" rel=\"nofollow noreferrer\">docs.mongodb.com/manual/reference/operator/aggregation/sum</a> and <a href=\"http://godoc.org/labix.org/v2/mgo#Collection.Pipe\" rel=\"nofollow noreferrer\">godoc.org/labix.org/v2/mgo#Collection.Pipe</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1501866996, "post_id": 45504011, "comment_id": 77985704, "body": "Where is your code showing your attempt? What didn&#39;t work when you tried?"}], "answers": [{"comments": [{"owner": {"reputation": 446, "user_id": 5673058, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/0f2272ce2edb5a5387b7ac15bf3ee1c8?s=128&d=identicon&r=PG&f=1", "display_name": "djkah11", "link": "https://stackoverflow.com/users/5673058/djkah11"}, "edited": false, "score": 0, "creation_date": 1501884497, "post_id": 45504143, "comment_id": 77993563, "body": "It is answer for my question. I have problems with understanding mongo, this simple answer have helped me."}], "tags": [], "owner": {"reputation": 526, "user_id": 1078108, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zGXL1.jpg?s=128&g=1", "display_name": "Bartosz Mikulski", "link": "https://stackoverflow.com/users/1078108/bartosz-mikulski"}, "is_accepted": true, "score": 1, "last_activity_date": 1501841663, "creation_date": 1501841663, "answer_id": 45504143, "question_id": 45504011, "link": "https://stackoverflow.com/questions/45504011/how-to-sum-the-values-of-fields/45504143#45504143", "title": "How to sum the values of fields?", "body": "<pre><code>db.collection.aggregate([\n  {$match:\n    {'actionName': 'clear'},\n  {$group:\n     {_id: \"$actionName\",\n     total_count:{ $sum: \"$countUse\"}}}\n])\n</code></pre>\n"}], "owner": {"reputation": 446, "user_id": 5673058, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/0f2272ce2edb5a5387b7ac15bf3ee1c8?s=128&d=identicon&r=PG&f=1", "display_name": "djkah11", "link": "https://stackoverflow.com/users/5673058/djkah11"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 45504143, "answer_count": 1, "score": -3, "last_activity_date": 1501841663, "creation_date": 1501841292, "question_id": 45504011, "link": "https://stackoverflow.com/questions/45504011/how-to-sum-the-values-of-fields", "title": "How to sum the values of fields?", "body": "<p>I have structs like this</p>\n\n<pre><code>  {\n        \"actionName\": \"add_new_paint_layer\",\n        \"countUse\": 1,\n        \"sources\": \"smth\"\n    },\n    {\n        \"actionName\": \"clear\",\n        \"countUse\": 1,\n        \"sources\": \"smth\"\n    },\n   {\n        \"actionName\": \"clear\",\n        \"countUse\": 5,\n        \"sources\": \"smth\"\n    },\n</code></pre>\n\n<p>How to sum \"countUse\" for actionName \"clear\"?</p>\n"}, {"tags": ["go", "error-handling", "synchronization", "exit", "goroutine"], "comments": [{"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1501834133, "post_id": 45500836, "comment_id": 77963587, "body": "It&#39;s okay if you want to just shutdown the whole program. If you would like to isolate the effect to just closing to the spawned goroutines, you can use a channel to indicate all the goroutines to stop execution. Only change is that the goroutines will finish the execution of the current work() being executed before exiting."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1501838312, "post_id": 45500836, "comment_id": 77966356, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/6807590/how-to-stop-a-goroutine\">how to stop a goroutine</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1501841508, "post_id": 45500836, "comment_id": 77968804, "body": "@Flimzy This is not a duplicate as in the marked duplicate only one goroutine (the controlling goroutine) may initiate cancel, but in this question multiple goroutines (any of the workers) may do so. Techniques applied there cannot be applied here directly (without additional work)."}, {"owner": {"reputation": 185, "user_id": 7126092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1dde6979c03150ddb8275e5321d925d?s=128&d=identicon&r=PG&f=1", "display_name": "\u8fbd\u5317\u72e0\u4eba", "link": "https://stackoverflow.com/users/7126092/%e8%be%bd%e5%8c%97%e7%8b%a0%e4%ba%ba"}, "edited": false, "score": 0, "creation_date": 1582475639, "post_id": 45500836, "comment_id": 106782131, "body": "BTW, I think it should be <code>wg.Add(2)</code> since the for loop would be executed for at most twice."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 36, "last_activity_date": 1501841244, "last_edit_date": 1501841244, "creation_date": 1501837454, "answer_id": 45502591, "question_id": 45500836, "link": "https://stackoverflow.com/questions/45500836/close-multiple-goroutine-if-an-error-occurs-in-one-in-go/45502591#45502591", "title": "Close multiple goroutine if an error occurs in one in go", "body": "<p>You may use the <a href=\"https://golang.org/pkg/context/\" rel=\"noreferrer\"><code>context</code></a> package which was created for things like this (<em>\"carries deadlines, cancelation signals...\"</em>).</p>\n\n<p>You create a context capable of publishing cancelation signals with <a href=\"https://golang.org/pkg/context/#WithCancel\" rel=\"noreferrer\"><code>context.WithCancel()</code></a> (parent context may be the one returned by <a href=\"https://golang.org/pkg/context/#Background\" rel=\"noreferrer\"><code>context.Background()</code></a>). This will return you a <code>cancel()</code> function which may be used to cancel (or more precisely <em>signal</em> the cancel intent) to the worker goroutines.<br>\nAnd in the worker goroutines you have to check if such intent has been initiated, by checking if the channel returned by <code>Context.Done()</code> is closed, easiest done by attempting to receive from it (which proceeds immediately if it is closed). And to do a non-blocking check (so you can continue if it is not closed), use the <code>select</code> statement with a <code>default</code> branch.</p>\n\n<p>I will use the following <code>work()</code> implementation, which simulates a 10% failure chance, and simulates 1 second of work:</p>\n\n<pre><code>func work(i int) (int, error) {\n    if rand.Intn(100) &lt; 10 { // 10% of failure\n        return 0, errors.New(\"random error\")\n    }\n    time.Sleep(time.Second)\n    return 100 + i, nil\n}\n</code></pre>\n\n<p>And the <code>doAllWork()</code> may look like this:</p>\n\n<pre><code>func doAllWork() error {\n    var wg sync.WaitGroup\n\n    ctx, cancel := context.WithCancel(context.Background())\n    defer cancel() // Make sure it's called to release resources even if no errors\n\n    for i := 0; i &lt; 2; i++ {\n        wg.Add(1)\n        go func(i int) {\n            defer wg.Done()\n\n            for j := 0; j &lt; 10; j++ {\n                // Check if any error occurred in any other gorouties:\n                select {\n                case &lt;-ctx.Done():\n                    return // Error somewhere, terminate\n                default: // Default is must to avoid blocking\n                }\n                result, err := work(j)\n                if err != nil {\n                    fmt.Printf(\"Worker #%d during %d, error: %v\\n\", i, j, err)\n                    cancel()\n                    return\n                }\n                fmt.Printf(\"Worker #%d finished %d, result: %d.\\n\", i, j, result)\n            }\n        }(i)\n    }\n    wg.Wait()\n\n    return ctx.Err()\n}\n</code></pre>\n\n<p>This is how it can be tested:</p>\n\n<pre><code>func main() {\n    rand.Seed(time.Now().UnixNano() + 1) // +1 'cause Playground's time is fixed\n    fmt.Printf(\"doAllWork: %v\\n\", doAllWork())\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/od8ShySgMM\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Worker #0 finished 0, result: 100.\nWorker #1 finished 0, result: 100.\nWorker #1 finished 1, result: 101.\nWorker #0 finished 1, result: 101.\nWorker #0 finished 2, result: 102.\nWorker #1 finished 2, result: 102.\nWorker #1 finished 3, result: 103.\nWorker #1 during 4, error: random error\nWorker #0 finished 3, result: 103.\ndoAllWork: context canceled\n</code></pre>\n\n<p>If there would be no errors, e.g. when using the following <code>work()</code> function:</p>\n\n<pre><code>func work(i int) (int, error) {\n    time.Sleep(time.Second)\n    return 100 + i, nil\n}\n</code></pre>\n\n<p>The output would be like (try it on the <a href=\"https://play.golang.org/p/gZKXSAa4F-\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Worker #0 finished 0, result: 100.\nWorker #1 finished 0, result: 100.\nWorker #1 finished 1, result: 101.\nWorker #0 finished 1, result: 101.\nWorker #0 finished 2, result: 102.\nWorker #1 finished 2, result: 102.\nWorker #1 finished 3, result: 103.\nWorker #0 finished 3, result: 103.\nWorker #0 finished 4, result: 104.\nWorker #1 finished 4, result: 104.\nWorker #1 finished 5, result: 105.\nWorker #0 finished 5, result: 105.\nWorker #0 finished 6, result: 106.\nWorker #1 finished 6, result: 106.\nWorker #1 finished 7, result: 107.\nWorker #0 finished 7, result: 107.\nWorker #0 finished 8, result: 108.\nWorker #1 finished 8, result: 108.\nWorker #1 finished 9, result: 109.\nWorker #0 finished 9, result: 109.\ndoAllWork: &lt;nil&gt;\n</code></pre>\n\n<p><strong>Notes:</strong></p>\n\n<p>Basically we just used the <code>Done()</code> channel of the context, so it seems we could just as easily (if not even easier) use a <code>done</code> channel instead of the <code>Context</code>, closing the channel to do what <code>cancel()</code> does in the above solution.</p>\n\n<p>This is not true. <strong>This can only be used if only one goroutine may close the channel, but in our case any of the workers may do so.</strong> And attempting to close an already closed channel panics (see details here: <a href=\"https://stackoverflow.com/questions/39015602/how-does-a-non-initialized-channel-behave/39016004#39016004\">How does a non initialized channel behave?</a>). So you would have to ensure some kind of synchronization / exclusion around the <code>close(done)</code>, which will make it less readable and even more complex. Actually this is exactly what the <code>cancel()</code> function does under the hood, hidden / abstracted away from your eyes, so <code>cancel()</code> may be called multiple times to make your code / use of it simpler.</p>\n\n<h3>How to get and return the error(s) from the workers?</h3>\n\n<p>For this you may use an error channel:</p>\n\n<pre><code>errs := make(chan error, 2) // Buffer for 2 errors\n</code></pre>\n\n<p>And inside the workers when an error is encountered, send it on the channel instead of printing it:</p>\n\n<pre><code>result, err := work(j)\nif err != nil {\n    errs &lt;- fmt.Errorf(\"Worker #%d during %d, error: %v\\n\", i, j, err)\n    cancel()\n    return\n}\n</code></pre>\n\n<p>And after the loop, if there was an error, return that (and <code>nil</code> otherwise):</p>\n\n<pre><code>// Return (first) error, if any:\nif ctx.Err() != nil {\n    return &lt;-errs\n}\nreturn nil\n</code></pre>\n\n<p>Output this time (try this on the <a href=\"https://play.golang.org/p/J2wMOuxiTm\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Worker #0 finished 0, result: 100.\nWorker #1 finished 0, result: 100.\nWorker #1 finished 1, result: 101.\nWorker #0 finished 1, result: 101.\nWorker #0 finished 2, result: 102.\nWorker #1 finished 2, result: 102.\nWorker #1 finished 3, result: 103.\nWorker #0 finished 3, result: 103.\ndoAllWork: Worker #1 during 4, error: random error\n</code></pre>\n\n<p>Note that I used a buffered channel with a buffer size equal to the number of workers, which ensures sending on it is always non-blocking. This also gives you the possibility to receive and process all errors, not just one (e.g. the first). Another option could be to use a buffered channel to hold only 1, and do a non-blocking send on it, which could look like this:</p>\n\n<pre><code>errs := make(chan error, 1) // Buffered only for the first error\n\n// ...and inside the worker:\n\nresult, err := work(j)\nif err != nil {\n    // Non-blocking send:\n    select {\n    case errs &lt;- fmt.Errorf(\"Worker #%d during %d, error: %v\\n\", i, j, err):\n    default:\n    }\n    cancel()\n    return\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1397, "user_id": 4940278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06NHi.jpg?s=128&g=1", "display_name": "Luna Lovegood", "link": "https://stackoverflow.com/users/4940278/luna-lovegood"}, "edited": false, "score": 0, "creation_date": 1585197806, "post_id": 58877770, "comment_id": 107679604, "body": "however, the go routine spin using this context do not accept argument :("}], "tags": [], "owner": {"reputation": 2274, "user_id": 7567579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ab9644beeb1d324d1247b2951d28927?s=128&d=identicon&r=PG", "display_name": "Emin Laletovic", "link": "https://stackoverflow.com/users/7567579/emin-laletovic"}, "is_accepted": false, "score": 0, "last_activity_date": 1573823404, "creation_date": 1573823404, "answer_id": 58877770, "question_id": 45500836, "link": "https://stackoverflow.com/questions/45500836/close-multiple-goroutine-if-an-error-occurs-in-one-in-go/58877770#58877770", "title": "Close multiple goroutine if an error occurs in one in go", "body": "<p>Another way to go here is to use <code>errgroup.WithContext</code>. You can check it out in this <a href=\"https://play.golang.org/p/shuXuUzCAZx\" rel=\"nofollow noreferrer\">example</a>.</p>\n\n<p>In short, <code>g.Wait()</code> waits for the first error to happen or for all to finish without errors. When error happens in any of the goroutines (timeout in the provided example), it cancels the execution in other goroutines through <code>ctx.Done()</code> channel.</p>\n"}, {"comments": [{"owner": {"reputation": 51, "user_id": 3098673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2894188389cfc3333b5619f511ced4bf?s=128&d=identicon&r=PG&f=1", "display_name": "semafor", "link": "https://stackoverflow.com/users/3098673/semafor"}, "edited": false, "score": 0, "creation_date": 1601389764, "post_id": 60548027, "comment_id": 113389047, "body": "Hi, I have a question for you, I modified your example a little <a href=\"https://play.golang.org/p/ky2DkCZBkyR\" rel=\"nofollow noreferrer\">play.golang.org/p/ky2DkCZBkyR</a>, and if I understand correctly all goroutines (2,3) should be canceled as soon as goroutine (4) returns the error. But it&#39;s not happened, goroutines (2,3) still works until their end. What am I missing?"}, {"owner": {"reputation": 1122, "user_id": 4970650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/496526a825adf2e6587a19d3a6d391f7?s=128&d=identicon&r=PG", "display_name": "Cirelli94", "link": "https://stackoverflow.com/users/4970650/cirelli94"}, "reply_to_user": {"reputation": 51, "user_id": 3098673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2894188389cfc3333b5619f511ced4bf?s=128&d=identicon&r=PG&f=1", "display_name": "semafor", "link": "https://stackoverflow.com/users/3098673/semafor"}, "edited": false, "score": 0, "creation_date": 1601485325, "post_id": 60548027, "comment_id": 113425450, "body": "Hi @semafor ! You made me think about this :) thank you! I edited my answer, I hope it&#39;s correct now and more clear! Let me know if you understand now!"}], "tags": [], "owner": {"reputation": 1122, "user_id": 4970650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/496526a825adf2e6587a19d3a6d391f7?s=128&d=identicon&r=PG", "display_name": "Cirelli94", "link": "https://stackoverflow.com/users/4970650/cirelli94"}, "is_accepted": false, "score": 5, "last_activity_date": 1601485271, "last_edit_date": 1601485271, "creation_date": 1583419808, "answer_id": 60548027, "question_id": 45500836, "link": "https://stackoverflow.com/questions/45500836/close-multiple-goroutine-if-an-error-occurs-in-one-in-go/60548027#60548027", "title": "Close multiple goroutine if an error occurs in one in go", "body": "<p>A more clear way to go here is to use <code>errgroup</code> (<a href=\"https://pkg.go.dev/golang.org/x/sync/errgroup\" rel=\"nofollow noreferrer\">documentation</a>).</p>\n<p>Package <code>errgroup</code> provides synchronization, error propagation, and Context cancelation for groups of goroutines working on subtasks of a common task.</p>\n<p>You can check it out in this example (<a href=\"https://play.golang.org/p/6MygrEstlN3\" rel=\"nofollow noreferrer\">playground</a>):</p>\n<pre><code>    var g errgroup.Group\n    var urls = []string{\n        &quot;http://www.golang.org/&quot;,\n        &quot;http://www.google.com/&quot;,\n        &quot;http://www.somestupidname.com/&quot;,\n    }\n\n    for _, url := range urls {\n        // Launch a goroutine to fetch the URL.\n        url := url // https://golang.org/doc/faq#closures_and_goroutines\n        \n       g.Go(func() error {\n            // Fetch the URL.\n            resp, err := http.Get(url)\n            if err == nil {\n                resp.Body.Close()\n            }\n            return err\n        })\n    }\n   \n    // Wait for all HTTP fetches to complete.\n    if err := g.Wait(); err == nil {\n        fmt.Println(&quot;Successfully fetched all URLs.&quot;)\n    \n    } else {\n\n        // After all have run, at least one of them has returned an error!\n       // But all have to finish their work!\n       // If you want to stop others goroutines when one fail, go ahead reading!\n        fmt.Println(&quot;Unsuccessfully fetched URLs.&quot;)\n    }\n</code></pre>\n<p>But attention: <code>The first call to return a non-nil error cancels the group</code> phrase in the <a href=\"https://pkg.go.dev/golang.org/x/sync/errgroup#Group.Go\" rel=\"nofollow noreferrer\"><code>Go</code> documentation</a> is a little bit misleading.</p>\n<p>In fact, <code>errgroup.Group</code> <strong>if</strong> created with a context (<code>WithContext</code> function), will call the cancel function of the context returned by <code>WithContext</code> when a goroutine in the group will return an error, otherwise nothing will be done (<a href=\"https://github.com/golang/sync/blob/30421366ff76/errgroup/errgroup.go#L60\" rel=\"nofollow noreferrer\">read the source code here!</a>).</p>\n<p>So, if you want to close your different goroutines, you must use the context returned my <code>WithContext</code> and manage it by yourself inside them, <code>errgroup</code> will just close that context!\n<a href=\"https://play.golang.org/p/cuTRglqUuLt\" rel=\"nofollow noreferrer\">Here you can find an example.</a></p>\n<p>To summarize, <code>errgroup</code> can be used in different ways, as shown by the <a href=\"https://pkg.go.dev/golang.org/x/sync/errgroup#pkg-examples\" rel=\"nofollow noreferrer\">examples</a>.</p>\n<ol>\n<li><p>&quot;just errors&quot;, as the above example:\n<code>Wait</code> wait that all goroutines end, and then returns the first non-nil error if any from them, or return <code>nil</code>.</p>\n</li>\n<li><p>In parallel:\nYou have to create the group with the <a href=\"https://pkg.go.dev/golang.org/x/sync/errgroup#WithContext\" rel=\"nofollow noreferrer\"><code>WithContext</code> function</a> and use the context to manage the context closing.\n<a href=\"https://play.golang.org/p/cuTRglqUuLt\" rel=\"nofollow noreferrer\">I created a playground example here with some sleeps!</a>\nYou have to manually close each goroutines, but using the context you can end them when one close the context.</p>\n</li>\n<li><p>Pipelines (see more in the <a href=\"https://pkg.go.dev/golang.org/x/sync/errgroup#pkg-examples\" rel=\"nofollow noreferrer\">examples</a>).</p>\n</li>\n</ol>\n"}], "owner": {"reputation": 7779, "user_id": 6858274, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/323d5de87d97a689b73a663375e079eb?s=128&d=identicon&r=PG&f=1", "display_name": "felix", "link": "https://stackoverflow.com/users/6858274/felix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9079, "favorite_count": 4, "accepted_answer_id": 45502591, "answer_count": 3, "score": 16, "last_activity_date": 1601485271, "creation_date": 1501832257, "last_edit_date": 1593730348, "question_id": 45500836, "link": "https://stackoverflow.com/questions/45500836/close-multiple-goroutine-if-an-error-occurs-in-one-in-go", "title": "Close multiple goroutine if an error occurs in one in go", "body": "<p>consider this function :</p>\n<pre><code>func doAllWork() error {\n\n    var wg sync.WaitGroup\n\n    for i := 0; i &lt; 2; i++ {\n\n        wg.add(1)\n        go func() {\n\n            defer wg.Done()\n            for j := 0; j &lt; 10; j++ {\n                result, err := work(j)\n                if err != nil {\n                    // can't use `return err` here\n                    // what sould I put instead ? \n                    os.Exit(0)\n                }\n            }\n        }()\n    }\n    wg.Wait()\n\n    return nil\n}\n</code></pre>\n<p>In each goroutine, the function <code>work()</code> is called 10 times. If one call to <code>work()</code> returns an error in any of the running goroutines, I want all the goroutines to stop immediately, and the program to exit.\nIs it ok to use <code>os.Exit()</code> here ? How should I handle this ?</p>\n<hr />\n<p><strong>Edit</strong>: this question is different from <a href=\"https://stackoverflow.com/questions/6807590/how-to-stop-a-goroutine\">how to stop a goroutine</a> as here I need to close all goroutines if an error occurs in one</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1501838260, "post_id": 45500781, "comment_id": 77966326, "body": "First tip: Don&#39;t translate Java (or any other language) to Go. Write new code, using Go idioms."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1501840281, "post_id": 45500781, "comment_id": 77967854, "body": "@Flimzy in this particular case &quot;go idioms&quot; means &quot;copy-paste&quot;?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1501840502, "post_id": 45500781, "comment_id": 77968025, "body": "@zerkms: I don&#39;t have any idea what you mean. I also don&#39;t really know what you&#39;re trying to do, since you haven&#39;t included any functional code--only data types and definitions. So it&#39;s really hard to prescribe a Go idiom to an unknown problem."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1501840610, "post_id": 45500781, "comment_id": 77968122, "body": "@Flimzy from what I see in the OP&#39;s question: they have a service that generates responses that have common metadata fields + typed but different payload (see the <code>content</code> field). In JAVA they can easily deserialise it in type safe manner using mechanism of generics. So OP asked how to do that in Go idiomatically. Since the most straightforward solution to copy-paste it for every payload type looks inefficient."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1501840763, "post_id": 45500781, "comment_id": 77968254, "body": "@zerkms: If that&#39;s the case, then it&#39;s probably a duplicate of <a href=\"https://stackoverflow.com/q/33436730/13860\">stackoverflow.com/q/33436730/13860</a>"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1501840789, "post_id": 45500781, "comment_id": 77968274, "body": "@Flimzy The fields are known. The type of payload comes directly in the metadata. See <code>type</code> field (plus presumably it is known compile time for every service call). The problem OP observes is that there are different type of responses each of which has the same metadata but different payloads. And they are stuck because Go does not have generics, so it&#39;s not immediately obvious how you solve it without copy-pasting the similar but slightly different structure types."}], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1501840455, "post_id": 45503575, "comment_id": 77967986, "body": "So how would you do that for the very structure OP provided? Your reference on playground is straightforward and not relevant to the problem OP observes."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1501841448, "post_id": 45503575, "comment_id": 77968753, "body": "Now it&#39;s much better indeed."}, {"owner": {"reputation": 1159, "user_id": 8383919, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aRJwN.png?s=128&g=1", "display_name": "Auskennfuchs", "link": "https://stackoverflow.com/users/8383919/auskennfuchs"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1501842932, "post_id": 45503575, "comment_id": 77969714, "body": "Thanks. Also I was curious and tried it in the playground. And it works as intended. Link&#39;s added."}, {"owner": {"reputation": 457, "user_id": 6171578, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9e035177e9539ce163b0197a777b34f7?s=128&d=identicon&r=PG&f=1", "display_name": "botscripter", "link": "https://stackoverflow.com/users/6171578/botscripter"}, "edited": false, "score": 0, "creation_date": 1501848534, "post_id": 45503575, "comment_id": 77973493, "body": "My main question is how I can extract this as library. The content should be provided by the consumer of the library and not directly in the code. I wanna provide this like a framework. The java generic part should be variable for each project where service-result is used."}, {"owner": {"reputation": 1159, "user_id": 8383919, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aRJwN.png?s=128&g=1", "display_name": "Auskennfuchs", "link": "https://stackoverflow.com/users/8383919/auskennfuchs"}, "edited": false, "score": 0, "creation_date": 1501852770, "post_id": 45503575, "comment_id": 77976520, "body": "You can add some functions to the <code>ServiceResult</code> struct and use them in all derived structs.  I also added an alternative solution to my answer which is the closest to your Java implementation I think."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 457, "user_id": 6171578, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9e035177e9539ce163b0197a777b34f7?s=128&d=identicon&r=PG&f=1", "display_name": "botscripter", "link": "https://stackoverflow.com/users/6171578/botscripter"}, "edited": false, "score": 0, "creation_date": 1501918522, "post_id": 45503575, "comment_id": 77999648, "body": "@NikolaStankovic you cannot have it so generic as java provides. There simply is no mechanism in golang for that."}], "tags": [], "owner": {"reputation": 1159, "user_id": 8383919, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aRJwN.png?s=128&g=1", "display_name": "Auskennfuchs", "link": "https://stackoverflow.com/users/8383919/auskennfuchs"}, "is_accepted": true, "score": 2, "last_activity_date": 1501852671, "last_edit_date": 1501852671, "creation_date": 1501840128, "answer_id": 45503575, "question_id": 45500781, "link": "https://stackoverflow.com/questions/45500781/solution-for-generic-in-go/45503575#45503575", "title": "Solution for Generic in Go", "body": "<p>You can add the json-mapping directly to the structure definition and use the encoder, decoder to marshal and unmarshal it. It's all built in and easier than in other languages, imho.</p>\n\n<pre><code>type ServiceResponse struct {\n    Value string`json:\"nameInJsonResponse\"`\n}\n</code></pre>\n\n<p>here is a good example from the playground: <a href=\"https://play.golang.org/p/4L2wMVv7tW\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4L2wMVv7tW</a> </p>\n\n<p>For your particular case it should be something like this:</p>\n\n<pre><code>type ServiceResult struct {\n    Status ServiceResultStatus`json:\"status\"`\n    Type string`json:\"type\"`\n    Hash string`json:\"hash\"`\n    Destination string`json:\"destination\"`\n    Metadata map[string]Metadata metadata`json:\"metadata\"`\n}\n\ntype ExplizitServiceResult struct {\n    ServiceResult\n    Content SomeStruct`json:\"content\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/FFfiq6LxVt\" rel=\"nofollow noreferrer\">https://play.golang.org/p/FFfiq6LxVt</a></p>\n\n<p>If you don't want to derive every user struct from the ServiceResult you can define the content as <code>interface{}</code> so every struct can be inserted. I've updated my example for this. Maybe this is the easiest solution to your problem.\n<a href=\"https://play.golang.org/p/LNgreqrnnw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LNgreqrnnw</a></p>\n"}], "owner": {"reputation": 457, "user_id": 6171578, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9e035177e9539ce163b0197a777b34f7?s=128&d=identicon&r=PG&f=1", "display_name": "botscripter", "link": "https://stackoverflow.com/users/6171578/botscripter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 45503575, "answer_count": 1, "score": -3, "last_activity_date": 1501852671, "creation_date": 1501832067, "last_edit_date": 1501838225, "question_id": 45500781, "link": "https://stackoverflow.com/questions/45500781/solution-for-generic-in-go", "title": "Solution for Generic in Go", "body": "<p>I want to make a useful library for JSON responses. In Java I've this already. I started now new with Go and have no idea how to transform my Java code. I've read that Go doesn't have anything like generics, but how can I solve my problem?</p>\n\n<p>I'm talking about the following part of code:</p>\n\n<pre><code>@Data\npublic class ServiceResult&lt;T extends Serializable&gt; implements Serializable {\n\n    private ServiceResultStatus status;\n    private String type;\n    private T content;\n    private String hash;\n    private String destination;\n    private HashMap&lt;String, Metadata&gt; metadata = new HashMap&lt;&gt;();\n\n...\n</code></pre>\n\n<p>The idea of service-result is to provide an structural pattern for RESTful web services. If you need more information, here is the link to my repo on Github: <a href=\"https://github.com/Viascom/service-result\" rel=\"nofollow noreferrer\">https://github.com/Viascom/service-result</a></p>\n\n<p>A service-result looks at the end like this:</p>\n\n<pre><code>{\n  \"status\": \"successful\",\n  \"type\": \"ch.viascom.example.models.response.GetTasksResponse\",\n  \"content\": [\n    {\n      \"id\": \"3e99c7fb-0ed7-11e7-a7a5-0050569c3e5a\",\n      \"name\": \"Example Task\"\n    }\n  ],\n  \"hash\": \"7bf9c04d1e9f8fe7995e4b8beeac1a4c830e7ea\",\n  \"destination\": \"ch.viascom.example.handler.TaskHandler\",\n  \"metadata\": {\n\n  }\n}\n</code></pre>\n"}]