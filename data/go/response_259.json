[{"tags": ["pointers", "go", "variable-assignment", "assignment-operator"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1577323787, "last_edit_date": 1577323787, "creation_date": 1577321859, "answer_id": 59482927, "question_id": 59482606, "link": "https://stackoverflow.com/questions/59482606/modifying-data-via-pointers/59482927#59482927", "title": "Modifying data via pointers", "body": "<p>Simplify. For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc f(q *int) {\n    fmt.Println(*q, q, &amp;q, \"f\")\n    *q = 14\n    fmt.Println(*q, q, &amp;q, \"f\")\n}\n\nfunc main() {\n    var i int = 27\n    var p *int = &amp;i\n    fmt.Println(*p, p, &amp;p, i, \"main\")\n    f(p)\n    fmt.Println(*p, p, &amp;p, i, \"main\")\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>27 0x40e020 0x40c138 27 main\n27 0x40e020 0x40c148 f\n14 0x40e020 0x40c148 f\n14 0x40e020 0x40c138 14 main\n</code></pre>\n\n<p>Errors:</p>\n\n<pre><code>/*\nfunc g(r *int) {\n    // cannot use 14 (type int) as type *int in assignment\n    r = 14\n    // cannot assign to &amp;r\n    &amp;r = 14\n    // cannot use 14 (type int) as type *int in assignment\n    *(&amp;r) = 14\n}\n*/\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Hwe3anFBTfD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Hwe3anFBTfD</a></p>\n\n<hr>\n\n<p>In Go, all arguments are passed by value, as if by assignment. A pointer <code>p</code> to an int <code>i</code> is passed by value (<code>q = p</code>) to function <code>f</code>. The pointer <code>q</code>, a copy of <code>p</code>, is used to modify the value of <code>i</code>, <code>*q = 14</code>, <code>*q</code> dereferences type <code>*int</code> to type <code>int</code>.</p>\n\n<hr>\n\n<p>The function <code>g</code> compiler error messages explain why the statements are illegal. For example, <code>*&amp;r = 14</code> is <code>*(&amp;r) = 14</code> is <code>r = 14</code>, <code>cannot use 14 (type int) as type *int in assignment</code>, <code>r</code> is type <code>*int</code>. </p>\n\n<hr>\n\n<p>References:</p>\n\n<p><a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">A Tour of Go</a></p>\n\n<p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n"}, {"tags": [], "owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "is_accepted": false, "score": 2, "last_activity_date": 1577323669, "last_edit_date": 1577323669, "creation_date": 1577322811, "answer_id": 59482986, "question_id": 59482606, "link": "https://stackoverflow.com/questions/59482606/modifying-data-via-pointers/59482986#59482986", "title": "Modifying data via pointers", "body": "<p>Considering <code>*&amp;p</code> firstly lets simplify the example (removing all of the irrelevant stuff)</p>\n\n<pre><code>var pt int = 27\np := &amp;pt // because &amp;pt is passed as the argument into updatePointer\n*p = 14  // This assigns 14 to whatever p points to (i.e. pt)\nprintln(reflect.TypeOf(&amp;pt) == reflect.TypeOf(*&amp;p))\n</code></pre>\n\n<p><code>*&amp;</code> does nothing (and I can see no reason to use it in a real application); the statement gets the address of p (the <code>&amp;p</code> bit) and then gets what the result points at (<code>p</code>). So this an be rewritten </p>\n\n<pre><code>println(reflect.TypeOf(&amp;pt) == reflect.TypeOf(p))\n</code></pre>\n\n<p><code>p</code> is pointing to <code>pt</code> so <code>p == &amp;pt</code> (by definition this means that <code>*p == pt</code>). This means they are the same thing so will, of course, have the same type.</p>\n\n<p>So why does <code>*p = 14</code> work? You said that \"*p which is an int() value NOT a memory address is able to modify its value\" but that is not quite what <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">the spec</a> says:</p>\n\n<blockquote>\n  <p>For an operand x of pointer type *T, the pointer indirection *x\n  denotes the variable of type T pointed to by x. If x is nil, an\n  attempt to evaluate *x will cause a run-time panic.</p>\n</blockquote>\n\n<p>So what <code>*p = 14</code> is saying is set the variable that p points to to 14.</p>\n\n<p>Now lets look at your second question:</p>\n\n<pre><code>// Why can't I do the following?\n\nfunc updatePointer(p *int){\n    p = 14\n    //OR\n    &amp;p = 14\n    //OR\n    *&amp;p = 14\n}\n</code></pre>\n\n<p>So p is a pointer to an integer (thats what <code>*int</code> means). Saying <code>p = 14</code> is an attempt to set the pointer (not the int) to the value 14. 14 is an int not a pointer hence the compiler error <code>cannot use 14 (type int) as type *int in assignment</code>.</p>\n\n<p><code>&amp;p = 14</code> is saying set the address of p to 14. <code>p</code> is a <code>*int</code> so getting the address will give you a <code>**int</code> (a pointer to a pointer to an int). The compiler error you will get is <code>cannot assign to &amp;p</code> and this is because the result of <code>&amp;p</code> is not <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">addressable</a>. You could get around that by saying</p>\n\n<pre><code>x := &amp;p\nx = 14\n</code></pre>\n\n<p>and this will give you the error you might expect based upon what I said above: <code>cannot use 14 (type int) as type **int in assignment</code>.</p>\n\n<p><code>*&amp;p = 14</code> is basically the same as saying <code>p=14</code> (it gets the address of p and then gets whatever the result points at whis will be p).</p>\n\n<p>Pointers can get quite confusing (especially in contrived examples) and <a href=\"https://www.geeksforgeeks.org/pointers-in-golang/\" rel=\"nofollow noreferrer\">this article</a> may help you understand.</p>\n"}], "owner": {"reputation": 153, "user_id": 3051040, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/50791649b689432db71eb363eaecc9db?s=128&d=identicon&r=PG&f=1", "display_name": "user3051040", "link": "https://stackoverflow.com/users/3051040/user3051040"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1577350632, "creation_date": 1577317330, "last_edit_date": 1577350632, "question_id": 59482606, "link": "https://stackoverflow.com/questions/59482606/modifying-data-via-pointers", "title": "Modifying data via pointers", "body": "<p><a href=\"https://play.golang.org/p/DOhYaiH53Ek\" rel=\"nofollow noreferrer\">https://play.golang.org/p/DOhYaiH53Ek</a></p>\n\n<p>I do not understand the <code>*&amp;p</code> operation nor how a pointer <code>*p</code> which is an <code>int() value NOT a memory address</code> is able to modify its <code>value</code> i.e. <code>valueX = valueY</code>. I know that I must be misunderstanding something, but this code literally appears to be self-conflicting.</p>\n\n<pre><code>//point\n\npackage main\n\nimport \"reflect\"\n\nvar pt int = 27\n\nfunc main() {\n    println(reflect.TypeOf(pt))\n    println(\"pt = \", pt)   //value of pt\n    println(\"&amp;pt = \", &amp;pt) //memory address of pt\n    updatePointer(&amp;pt)\n    println(\"pt = \", pt) //value of pt\n}\n\nfunc updatePointer(p *int) { //requires memory address of an int\n    println(\"&amp;p = \", &amp;p)                                //memory address of p\n    println(\"p = \", p)                                  //memory address of pt\n    println(\"*p before = \", *p)                         //value of pt\n    println(*p == 27)                                   //true\n    *p = 14                                             //27 = 14??????????\n    println(\"*p =\", *p)                                 //value of pt\n    println(reflect.TypeOf(&amp;pt) == reflect.TypeOf(*&amp;p)) //true!!!?????\n    println(\"*&amp;p = \", *&amp;p)                              //memory address which p's memory address evals to???? 0x800 (p) -&gt; 0x900 (pt) = 0x800 (p)?\n}\n\n/*\nWhy can't I do the following?\n\nfunc updatePointer(p *int){\n    p = 14\n    //OR\n    &amp;p = 14\n    //OR\n    *&amp;p = 14\n}\n*/\n</code></pre>\n"}, {"tags": ["ajax", "go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1577298857, "post_id": 59479839, "comment_id": 105138616, "body": "What happens if you send the request &quot;by hand&quot;\u2014say, by running <code>curl -siN http:&#47;&#47;127.0.0.1:8888 -X POST --data &#39;&#39;</code> (yeah, you may start with empty data)? In general, this is the approach to solving probems like these: decompose it into smaller pieces and deal with each of them in turn\u2014repeating the decomposition recursively. If/when you&#39;ve made sure the server works, fire up devtools in your browser and see what gets sent on the wire\u2014if anything."}, {"owner": {"reputation": 307, "user_id": 3935209, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/xDm8d.jpg?s=128&g=1", "display_name": "V&#237;ctor M", "link": "https://stackoverflow.com/users/3935209/v%c3%adctor-m"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1577298866, "post_id": 59479839, "comment_id": 105138617, "body": "When you say, &quot;this doesn&#39;t work&quot;. Did you try to start the server without an error? As @kostix said. <code>ListenAndServe</code> function returns an error if it can&#39;t start"}, {"owner": {"reputation": 443, "user_id": 2030161, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5ac7f2629ce011b40f114725b337640a?s=128&d=identicon&r=PG", "display_name": "MaxZ", "link": "https://stackoverflow.com/users/2030161/maxz"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1577338894, "post_id": 59479839, "comment_id": 105144176, "body": "@kostix Thank you for your suggestions; however, I don&#39;t parse the root, but &quot;/receive&quot;, which I guess you did not look at the server.go code I provided... in any case, when I added that, the console output was:  HTTP/1.1 200 OK Date: Thu, 26 Dec 2019 05:38:26 GMT Content-Length: 13 Content-Type: text/plain; charset=utf-8"}, {"owner": {"reputation": 443, "user_id": 2030161, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5ac7f2629ce011b40f114725b337640a?s=128&d=identicon&r=PG", "display_name": "MaxZ", "link": "https://stackoverflow.com/users/2030161/maxz"}, "reply_to_user": {"reputation": 307, "user_id": 3935209, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/xDm8d.jpg?s=128&g=1", "display_name": "V&#237;ctor M", "link": "https://stackoverflow.com/users/3935209/v%c3%adctor-m"}, "edited": false, "score": 0, "creation_date": 1577339170, "post_id": 59479839, "comment_id": 105144235, "body": "@Victor M  After testing via curl, the server does receive the data, as such somehow the AJAX component does not seem to send any data to the server. I don&#39;t know how to fix the AJAX code so that it sends out the data correctly and then receives data back from the server..."}, {"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1577340051, "post_id": 59479839, "comment_id": 105144437, "body": "What is printed to your servers&#39; stdout when you copy the received request body to the console, e.g. <code>io.Copy(os.Stdout, r.Body)</code> ?"}, {"owner": {"reputation": 307, "user_id": 3935209, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/xDm8d.jpg?s=128&g=1", "display_name": "V&#237;ctor M", "link": "https://stackoverflow.com/users/3935209/v%c3%adctor-m"}, "edited": false, "score": 0, "creation_date": 1577351551, "post_id": 59479839, "comment_id": 105147488, "body": "I have downloaded your code and try it in my localhost. When I tried to click on the button it responds a 404 server error. So I have changed the url using the <code>http</code> protocol and it worked. Can you try it? Also, if you try on local, you should take care of CORS"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1577353004, "post_id": 59479839, "comment_id": 105147964, "body": "@MikeyJ, the exact path in the URL is irrelevant: I tried to explain how to attack a problem at hand. The answer by Brits show this point rather clearly as well."}], "answers": [{"tags": [], "owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "is_accepted": false, "score": 2, "last_activity_date": 1577348682, "creation_date": 1577348682, "answer_id": 59485751, "question_id": 59479839, "link": "https://stackoverflow.com/questions/59479839/an-html-doc-makes-ajax-request-server-receives-and-then-sends-data-back/59485751#59485751", "title": "An HTML doc makes AJAX request, server receives and then sends data back", "body": "<p><code>127.0.0.1:8888/receive</code> is not a valid URL (the AJAX call in your Javascript was failing with <code>SyntaxError: Failed to execute 'open' on 'XMLHttpRequest': Invalid URL\"</code> but you were not catching the error). Adding an <code>error</code> function to the AJAX call makes it easier to find this kind of issue (as does the browsers dev tools). </p>\n\n<p>The following works for me using <code>http://127.0.0.1:8888/receive</code> (note that I am serving the javascript from the go application to simplify things and avoid <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\" rel=\"nofollow noreferrer\">CORS</a> issues - you may receive additional errors when serving the page from Apache but at least you should be able to see what is going wrong in the browser console).</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nconst html = `&lt;html&gt;\n&lt;head&gt;\n  &lt;script src='//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js'&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n  &lt;script&gt;\n    $(document).ready(function () {\n      $('#button1').click(function () {\n        $.ajax({\n          url: 'http://127.0.0.1:8888/receive',\n          type: 'post',\n          dataType: 'html',\n          data : { post_data: 'hello world'},\n          error : function(err) {\n            console.log(err);\n          },\n          success : function(data) {\n            $('#div1').html(data);\n          },\n        });\n      });\n    });\n  &lt;/script&gt;\n\n  &lt;div id='div1'&gt;\n    &lt;h3&gt;before&lt;/h3&gt;\n  &lt;/div&gt;\n\n  &lt;input id='button1' type='button' value='AJAX POST to golang server'&gt;\n\n&lt;/body&gt;\n&lt;/html&gt;`\n\nfunc receiveAjax(w http.ResponseWriter, r *http.Request) {\n    if r.Method == \"POST\" {\n        data := r.FormValue(\"post_data\")\n        fmt.Println(\"Receive ajax post data string \", data)\n        w.Write([]byte(\"&lt;h2&gt;after&lt;h2&gt;\"))\n    }\n}\n\nfunc main() {\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) { w.Write([]byte(html)) })\n    mux.HandleFunc(\"/receive\", receiveAjax)\n\n    http.ListenAndServe(\":8888\", mux)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 307, "user_id": 3935209, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/xDm8d.jpg?s=128&g=1", "display_name": "V&#237;ctor M", "link": "https://stackoverflow.com/users/3935209/v%c3%adctor-m"}, "is_accepted": false, "score": 0, "last_activity_date": 1577355433, "creation_date": 1577355433, "answer_id": 59486945, "question_id": 59479839, "link": "https://stackoverflow.com/questions/59479839/an-html-doc-makes-ajax-request-server-receives-and-then-sends-data-back/59486945#59486945", "title": "An HTML doc makes AJAX request, server receives and then sends data back", "body": "<p>Maybe this could work for you. As @Brits pointed, you should take care of CORS in jQuery, also, check for the errors in the javascript and golang code.</p>\n\n<ul>\n<li><p>index.html file</p>\n\n<pre><code>&lt;html&gt;\n&lt;head&gt;\n    &lt;script src='//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js'&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n&lt;script&gt;\n    $(document).ready(function () {\n        $('#button1').click(function () {\n            $.ajax({\n                url: 'http://127.0.0.1:8888/receive',\n                type: 'post',\n                dataType: 'html',\n                contentType: 'application/x-www-form-urlencoded',\n                crossDomain: true,\n                data: {post_data: 'hello world'},\n                success: function (data) {\n                    console.log(data);\n                    $('#div1').html(data);\n                }\n            });\n        });\n    });\n&lt;/script&gt;\n\n&lt;div id='div1'&gt;\n    &lt;h3&gt;before&lt;/h3&gt;\n&lt;/div&gt;\n\n&lt;input id='button1' type='button' value='AJAX POST to golang server'&gt;\n\n&lt;/body&gt;\n</code></pre>\n\n<p></p></li>\n<li><p>server.go file</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc receiveAjax(w http.ResponseWriter, r *http.Request) {\n    if r.Method == \"POST\" {\n        data := r.FormValue(\"post_data\")\n        fmt.Println(\"Receive ajax post data string \", data)\n        w.Header().Add(\"Content-Type\", \"application/html\")\n        w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n        w.Header().Set(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS, PUT, DELETE\")\n        w.Header().Set(\"Access-Control-Allow-Headers\", \"Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization\")\n        w.Write([]byte(\"&lt;h2&gt;after&lt;h2&gt;\"))\n    }\n}\n\nfunc main() {\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/receive\", receiveAjax)\n\n    http.ListenAndServe(\":8888\", mux)\n}\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 443, "user_id": 2030161, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5ac7f2629ce011b40f114725b337640a?s=128&d=identicon&r=PG", "display_name": "MaxZ", "link": "https://stackoverflow.com/users/2030161/maxz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1577355433, "creation_date": 1577288760, "last_edit_date": 1577298718, "question_id": 59479839, "link": "https://stackoverflow.com/questions/59479839/an-html-doc-makes-ajax-request-server-receives-and-then-sends-data-back", "title": "An HTML doc makes AJAX request, server receives and then sends data back", "body": "<p>The idea is to have an index.html, which is served via Apache web server, to send data to an IP address and port (AJAX) and waits for a response that it then displays; a \"data\" server, written in GO, awaits to receive data, then sends some data back via AJAX.</p>\n\n<p>But somehow this does not work and does not generate output:</p>\n\n<p><strong>index.html:</strong></p>\n\n<pre><code>&lt;html&gt;\n  &lt;head&gt;\n    &lt;script src='//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js'&gt;&lt;/script&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n\n    &lt;script&gt;\n      $(document).ready(function () {\n        $('#button1').click(function () {\n          $.ajax({\n            url: '127.0.0.1:8888/receive',\n            type: 'post',\n            dataType: 'html',\n            data : { post_data: 'hello world'},\n            success : function(data) {\n              $('#div1').html(data);\n            },\n          });\n        });\n      });\n    &lt;/script&gt;\n\n    &lt;div id='div1'&gt;\n      &lt;h3&gt;before&lt;/h3&gt;\n    &lt;/div&gt;\n\n    &lt;input id='button1' type='button' value='AJAX POST to golang server'&gt;\n\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p><strong>server.go:</strong></p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"net/http\"\n)\n\nfunc receiveAjax(w http.ResponseWriter, r *http.Request) {\n if r.Method == \"POST\" {\n   data := r.FormValue(\"post_data\")\n   fmt.Println(\"Receive ajax post data string \", data)\n   w.Write([]byte(\"&lt;h2&gt;after&lt;h2&gt;\"))\n }\n}\n\nfunc main() {\n mux := http.NewServeMux()\n mux.HandleFunc(\"/receive\", receiveAjax)\n\n http.ListenAndServe(\":8888\", mux)\n}\n</code></pre>\n"}, {"tags": ["templates", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577280072, "post_id": 59478613, "comment_id": 105134521, "body": "You can&#39;t, at least not in any sensible way. Why don&#39;t you add a <code>Name</code> field to the <code>DataDB</code> type? For example: <a href=\"https://play.golang.com/p/akpFiMJuKJo\" rel=\"nofollow noreferrer\">play.golang.com/p/akpFiMJuKJo</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1577280219, "post_id": 59478613, "comment_id": 105134558, "body": "... otherwise you would have to take <code>Msg</code> string, parse the two values apart and then use them in the template. Or you would have to write a template function that takes a string, splits it, and then outputs one of the values based on some indicator, like an index for example."}, {"owner": {"reputation": 27, "user_id": 11193096, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_3VQ9fq8_YY/AAAAAAAAAAI/AAAAAAAACMc/riulW5dPSek/photo.jpg?sz=128", "display_name": "Justin Obanor", "link": "https://stackoverflow.com/users/11193096/justin-obanor"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577280955, "post_id": 59478613, "comment_id": 105134757, "body": "@mkopriva I used just two fields in my strict, because I\u2019m meant to execute a query to the db with just two columns. That\u2019s why I used just an id, and a message of type string with two values. Is there a way to parse the two values in my string?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577281209, "post_id": 59478613, "comment_id": 105134830, "body": "If you know the format of the message, and it&#39;s constant across all the rows in the db table, then yes. For example if the message is always two values separated by a space character and the values themselves don&#39;t contain space then just use <code>strings.Split(msg, &quot; &quot;)</code> and the result will be a slice containing both values which you can then access by indexing into the slice."}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 11193096, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_3VQ9fq8_YY/AAAAAAAAAAI/AAAAAAAACMc/riulW5dPSek/photo.jpg?sz=128", "display_name": "Justin Obanor", "link": "https://stackoverflow.com/users/11193096/justin-obanor"}, "edited": false, "score": 0, "creation_date": 1577280614, "post_id": 59478823, "comment_id": 105134673, "body": "the reason there are only two fields in my strict, is because I\u2019m supposed to have a database with just an id and a message. If you separate the message, how can I execute the db then? I used a string so I can pass 2 values in the message."}, {"owner": {"reputation": 178, "user_id": 2487677, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/bYuWK.jpg?s=128&g=1", "display_name": "KyleHodgetts", "link": "https://stackoverflow.com/users/2487677/kylehodgetts"}, "reply_to_user": {"reputation": 27, "user_id": 11193096, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_3VQ9fq8_YY/AAAAAAAAAAI/AAAAAAAACMc/riulW5dPSek/photo.jpg?sz=128", "display_name": "Justin Obanor", "link": "https://stackoverflow.com/users/11193096/justin-obanor"}, "edited": false, "score": 0, "creation_date": 1577280923, "post_id": 59478823, "comment_id": 105134751, "body": "In that case then as @mkopriva commented under the OP, you will need to split the <code>.Msg</code> field in the template using a template function. From the question, I&#39;m guessing you would need to split on the space character.  You can acheive this by passing in a <code>FuncMap</code> to your templates <code>Func</code> method  Func method: <a href=\"https://godoc.org/text/template#Template.Funcs\" rel=\"nofollow noreferrer\">godoc.org/text/template#Template.Funcs</a> Template Func Map: <a href=\"https://godoc.org/text/template#FuncMap\" rel=\"nofollow noreferrer\">godoc.org/text/template#FuncMap</a>"}, {"owner": {"reputation": 27, "user_id": 11193096, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_3VQ9fq8_YY/AAAAAAAAAAI/AAAAAAAACMc/riulW5dPSek/photo.jpg?sz=128", "display_name": "Justin Obanor", "link": "https://stackoverflow.com/users/11193096/justin-obanor"}, "edited": false, "score": 0, "creation_date": 1577280984, "post_id": 59478823, "comment_id": 105134768, "body": "I used just two fields in my strict, because I\u2019m meant to execute a query to the db with just two columns. That\u2019s why I used just an id, and a message of type string with two values. Is there a way to parse the two values in my string?"}, {"owner": {"reputation": 178, "user_id": 2487677, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/bYuWK.jpg?s=128&g=1", "display_name": "KyleHodgetts", "link": "https://stackoverflow.com/users/2487677/kylehodgetts"}, "reply_to_user": {"reputation": 27, "user_id": 11193096, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_3VQ9fq8_YY/AAAAAAAAAAI/AAAAAAAACMc/riulW5dPSek/photo.jpg?sz=128", "display_name": "Justin Obanor", "link": "https://stackoverflow.com/users/11193096/justin-obanor"}, "edited": false, "score": 0, "creation_date": 1577281049, "post_id": 59478823, "comment_id": 105134793, "body": "Then you should split the result string of your query from the <code>msg</code> column"}], "tags": [], "owner": {"reputation": 178, "user_id": 2487677, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/bYuWK.jpg?s=128&g=1", "display_name": "KyleHodgetts", "link": "https://stackoverflow.com/users/2487677/kylehodgetts"}, "is_accepted": false, "score": 0, "last_activity_date": 1577280287, "creation_date": 1577280287, "answer_id": 59478823, "question_id": 59478613, "link": "https://stackoverflow.com/questions/59478613/how-to-parse-a-template-that-has-variables-from-a-formatted-string/59478823#59478823", "title": "How to parse a template that has variables from a formatted string?", "body": "<p>First of all, your <code>DataDB</code> struct doesn't have a name field, so you won't be able to reference it in your template.</p>\n\n<p>Update your template to be the following:</p>\n\n<pre><code>type DataDB struct {\n    ID  int\n    Name string\n    Msg string\n}\n</code></pre>\n\n<p>and then set a name in your declaration</p>\n\n<p><code>justin := DataDB{ID: 1, Name: name, Msg: msg}</code></p>\n\n<p>Now you can reference the <code>.Name</code> field in your template</p>\n\n<pre><code>tpl, err := template.New(\"msgs\").Parse(`\n    {{range .}}\n    Hello {{.Name}}, my name is {{.Msg}}\n    {{end}}\n`)\n</code></pre>\n\n<p>Finally, when referencing fields in templates, the fields need to be exported, so they should all start with an upper case letter. See my version of the DataDB struct above.</p>\n\n<p>EDIT, you don't need the <code>fmt.Sprintf(...)</code> now.</p>\n\n<p><a href=\"https://play.golang.org/p/U6Bn-azNrK5\" rel=\"nofollow noreferrer\">Go playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 61409, "user_id": 485343, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e18b024a122df74275dd2c4486e8a2b4?s=128&d=identicon&r=PG", "display_name": "rustyx", "link": "https://stackoverflow.com/users/485343/rustyx"}, "is_accepted": false, "score": 0, "last_activity_date": 1577553974, "creation_date": 1577553974, "answer_id": 59513229, "question_id": 59478613, "link": "https://stackoverflow.com/questions/59478613/how-to-parse-a-template-that-has-variables-from-a-formatted-string/59513229#59513229", "title": "How to parse a template that has variables from a formatted string?", "body": "<p>It seems your <code>Msg</code> contains <code>Name + \" \" + Message</code>, so you need to <strong>split</strong> it on <code>\" \"</code>.</p>\n\n<p>Go templates are logicless. But you can use helper functions to add logic.</p>\n\n<p>For example:</p>\n\n<pre><code>type DataDB struct {\n    ID  int\n    Msg string\n}\n\nfunc (d *DataDB) Name() string {\n    return strings.SplitN(d.Msg, \" \", 2)[0]\n}\n\nfunc (d *DataDB) Message() string {\n    res := strings.SplitN(d.Msg, \" \", 2)\n    if len(res) &lt; 2 {\n        return \"\"\n    }\n    return res[1]\n}\n</code></pre>\n\n<p>And use them in the template like this:</p>\n\n<pre><code>{{range .}}\n    Hello {{.Name}}, my name is {{.Message}}\n{{end}}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/LQS21Jc5kA-\" rel=\"nofollow noreferrer\">Working example</a></p>\n\n<hr>\n\n<p>Note: the code above is slightly inefficient because it does the splitting twice, so it might be better to create a separate <code>struct</code> just for display purposes and fill it before rendering the template.</p>\n"}], "owner": {"reputation": 27, "user_id": 11193096, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_3VQ9fq8_YY/AAAAAAAAAAI/AAAAAAAACMc/riulW5dPSek/photo.jpg?sz=128", "display_name": "Justin Obanor", "link": "https://stackoverflow.com/users/11193096/justin-obanor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1577553974, "creation_date": 1577278614, "question_id": 59478613, "link": "https://stackoverflow.com/questions/59478613/how-to-parse-a-template-that-has-variables-from-a-formatted-string", "title": "How to parse a template that has variables from a formatted string?", "body": "<p>I have a struct with two fields. The Msg string will be fmt.Sprintf(\"%s %s\"), and I need to parse templates to those two variables in the string</p>\n\n<pre><code>type DataDB struct {\n    ID  int\n    Msg string\n}\n</code></pre>\n\n<p>Trying to parse template here, and the expected result should be -\nHello Justin, my name is abc</p>\n\n<pre><code>    var name = \"justin\"\n    var msg = \"abc\"\n\n    justin := DataDB{ID: 1, Msg: fmt.Sprintf(\"%s %s\", name, msg)}\n    s := []DataDB{justin}\n\n    tpl, err := template.New(\"msgs\").Parse(` {{range .}}\n     Hello {{.name}}, my name is {{.msg}}\n     {{end}}\n     `)\n    if err != nil {\n        panic(err)\n    }\n    tpl.Execute(os.Stdout, s)\n\n</code></pre>\n"}, {"tags": ["python", "python-3.x", "go", "compression", "gzip"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 2, "creation_date": 1577289047, "post_id": 59478554, "comment_id": 105136562, "body": "Wild guess due to a lack of details in your question: you&#39;ve used <code>print</code> to output the compressed result in Python instead of <code>write</code>. <code>print</code> make a printable string out of the binary value, i.e <code>b&#39;\\x1f\\x8b\\x08...</code>. This of course is not valid gzip."}, {"owner": {"reputation": 380, "user_id": 9607338, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "abheet22", "link": "https://stackoverflow.com/users/9607338/abheet22"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1577335599, "post_id": 59478554, "comment_id": 105143606, "body": "Haven&#39;t mentioned print in python statement. @Steffen I need to publish the compressed data to kafka, please help in that direction."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1577338994, "post_id": 59478554, "comment_id": 105144193, "body": "<i>&quot;I need to publish the compressed data to kafka, please help in that direction.&quot;</i> - This is a completely different question and should be asked as a new one. But maybe have a look at <a href=\"https://cwiki.apache.org/confluence/display/KAFKA/Compression\" rel=\"nofollow noreferrer\">the Kafka documentation</a> how compressed input is expected. Or just use <a href=\"https://pypi.org/project/kafka-python/\" rel=\"nofollow noreferrer\">kafka-python</a>."}], "answers": [{"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": false, "score": 3, "last_activity_date": 1577280197, "creation_date": 1577280197, "answer_id": 59478809, "question_id": 59478554, "link": "https://stackoverflow.com/questions/59478554/different-byte-array-for-same-string-in-golang-and-python/59478809#59478809", "title": "Different byte array for same string in golang and python", "body": "<p>I've tried to reproduce, with this code (python3) to generate the file <code>out.bin</code>:</p>\n\n<pre><code>import gzip\nimport json\n\nwith open('out.bin', 'wb') as f:\n    f.write(gzip.compress(json.dumps(\"hello\").encode(), -1))\n\nprint(json.dumps(\"hello\"))\n</code></pre>\n\n<p>and this code to read the file and decompress it (which uses your <code>Decompression</code> function:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"compress/gzip\"\n    \"fmt\"\n    \"io/ioutil\"\n)\n\nfunc Decompression(compData []byte) ([]byte, error) {\n    gr, err := gzip.NewReader(bytes.NewBuffer(compData))\n    if err != nil {\n        return compData, err\n    }\n    defer gr.Close()\n    data, err := ioutil.ReadAll(gr)\n    if err != nil {\n        return nil, err\n    }\n    return data, err\n}\n\nfunc main() {\n    d, err := ioutil.ReadFile(\"out.bin\")\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"raw data: %q\\n\", string(d))\n    data, err := Decompression(d)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"decompressed: %q\\n\", string(data))\n}\n</code></pre>\n\n<p>The combination works without error. Maybe you didn't save the file correctly from Python somehow? Can you run my go code on your data file and show the raw bytes?</p>\n"}], "owner": {"reputation": 380, "user_id": 9607338, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "abheet22", "link": "https://stackoverflow.com/users/9607338/abheet22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1577280197, "creation_date": 1577278135, "question_id": 59478554, "link": "https://stackoverflow.com/questions/59478554/different-byte-array-for-same-string-in-golang-and-python", "title": "Different byte array for same string in golang and python", "body": "<p>I am working on compressing a string using python gzip module and uncompressing the same in golang.</p>\n\n<p>Module to compress string in python:</p>\n\n<pre><code>gzip.compress(json.dumps(\"hello\").encode(),-1)\n</code></pre>\n\n<p>Module for decompressing the same in golang:</p>\n\n<pre><code>func Decompression(compData []byte) ([]byte, error) {\n    gr, err := gzip.NewReader(bytes.NewBuffer(compData))\n    if err != nil {\n        return compData, err\n    }\n    defer gr.Close()\n    data, err := ioutil.ReadAll(gr)\n    if err != nil {\n        return nil, err\n    }\n    return data, err\n}\n</code></pre>\n\n<p>Getting error : <code>Gzip:invalid header</code></p>\n\n<p>Using the same compression level while compressing and decompressing.</p>\n\n<p>Can anyone please point-out the mistake I am doing? </p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1577278426, "post_id": 59478542, "comment_id": 105134114, "body": "Is your code hosting on your custom site? If so, you should have your site returns a meta tag for <code>go get</code> for your package containing repo information. See more at: <a href=\"https://golang.org/cmd/go/#hdr-Remote_import_paths\" rel=\"nofollow noreferrer\">golang.org/cmd/go/#hdr-Remote_import_paths</a>"}, {"owner": {"reputation": 1185, "user_id": 3441222, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c1ef99d243c541138c9084f434bc98bf?s=128&d=identicon&r=PG&f=1", "display_name": "RedCollarPanda", "link": "https://stackoverflow.com/users/3441222/redcollarpanda"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1577279565, "post_id": 59478542, "comment_id": 105134393, "body": "leaf bebop, I have a private gitlab server. HTTPS - connection is forbidden - only ssh"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1577280894, "post_id": 59478542, "comment_id": 105134744, "body": "Yes, I am aware of that. What I ask you is to implement Go&#39;s Remote Import Protocol, which is specified by the link. The problem is not you can not get the code with git, but rather the step before it: knowing where to get the code from, which is governed by <code>go get</code>, by using Remote Import Protocol."}], "answers": [{"tags": [], "owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "is_accepted": false, "score": 0, "last_activity_date": 1597155076, "creation_date": 1597155076, "answer_id": 63359976, "question_id": 59478542, "link": "https://stackoverflow.com/questions/59478542/goland-modules-with-private-gitlab-ssh/63359976#63359976", "title": "Goland modules with private gitlab (ssh)", "body": "<p>What version of Go are you using? If it's Go 1.13 or later, the default is to download modules through proxy.golang.org. You can change that for a particular set of packages using the <code>GOPRIVATE</code> environment variable.</p>\n<p>Here is a quote from <code>go help module-private</code>, which I highly recommend reading in full. Once a module is fetched directly, it should use the same <code>git</code>/<code>ssh</code> logic as before modules.</p>\n<blockquote>\n<p>The GOPRIVATE environment variable controls which modules the go command\nconsiders to be private (not available publicly) and should therefore not use the\nproxy or checksum database. The variable is a comma-separated list of\nglob patterns (in the syntax of Go's path.Match) of module path prefixes.\nFor example,</p>\n<p>GOPRIVATE=*.corp.example.com,rsc.io/private</p>\n<p>causes the go command to treat as private any module with a path prefix\nmatching either pattern, including git.corp.example.com/xyzzy, rsc.io/private,\nand rsc.io/private/quux.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 332, "user_id": 14797322, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ExHOE.jpg?s=128&g=1", "display_name": "Micah Parks", "link": "https://stackoverflow.com/users/14797322/micah-parks"}, "is_accepted": false, "score": 2, "last_activity_date": 1607613884, "creation_date": 1607613884, "answer_id": 65237389, "question_id": 59478542, "link": "https://stackoverflow.com/questions/59478542/goland-modules-with-private-gitlab-ssh/65237389#65237389", "title": "Goland modules with private gitlab (ssh)", "body": "<p>I've dealt with Go modules and a private GitLab before. Our private GitLab has groups and subgroups. The piece you are likely missing is <code>~/.netrc</code> and you may have an improper global git configuration.</p>\n<p>I've made a GitHub gist for this. You can find it here: <a href=\"https://gist.github.com/MicahParks/1ba2b19c39d1e5fccc3e892837b10e21\" rel=\"nofollow noreferrer\">https://gist.github.com/MicahParks/1ba2b19c39d1e5fccc3e892837b10e21</a></p>\n<p>You can find the gist pasted below:</p>\n<h1>Problem</h1>\n<p>The <code>go</code> command line tool needs to be able to fetch dependencies from your private GitLab, but authenticaiton is required.</p>\n<p>This assumes your private GitLab is hosted at <code>privategitlab.company.com</code>.</p>\n<h1>Environment variables</h1>\n<p>The following environment variables are recommended:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>export GO111MODULE=on\nexport GOPRIVATE=privategitlab.company.com\n</code></pre>\n<p>The above lines might fit best in your shell startup, like a <code>~/.bashrc</code>.</p>\n<h3>Explanation</h3>\n<p><code>GO111MODULE=on</code> tells Golang command line tools you are using modules. I have not tested this with projects not using\nGolang modules on a private GitLab.</p>\n<p><code>GOPRIVATE=privategitlab.company.com</code> tells Golang command line tools to not use public internet resources for the hostnames\nlisted (like the public module proxy).</p>\n<h1>Get a personal access token from your private GitLab</h1>\n<p>To future proof these instructions, please follow <a href=\"https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html#creating-a-personal-access-token\" rel=\"nofollow noreferrer\">this guide from the GitLab docs</a>.\nI know that the <code>read_api</code> scope is required for Golang command line tools to work, and I may suspect <code>read_repository</code> as\nwell, but have not confirmed this.</p>\n<h1>Set up the <code>~/.netrc</code></h1>\n<p>In order for the Golang command line tools to authenticate to GitLab, a <code>~/.netrc</code> file is best to use.</p>\n<p>To create the file if it does not exist, run the following commands:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>touch ~/.netrc\nchmod 600 ~/.netrc\n</code></pre>\n<p>Now edit the contents of the file to match the following:</p>\n<pre><code>machine privategitlab.company.com login USERNAME_HERE password TOKEN_HERE\n</code></pre>\n<p>Where <code>USERNAME_HERE</code> is replaced with your GitLab username and <code>TOKEN_HERE</code> is replaced with the access token aquired in the\nprevious section.</p>\n<h1>Common mistakes</h1>\n<p>Do <strong>not</strong> set up a global git configuration with something along the lines of this:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>git config --global url.&quot;git@privategitlab.company.com:&quot;.insteadOf &quot;https://privategitlab.company.com&quot;\n</code></pre>\n<p>I beleive at the time of writing this, the SSH git is not fully supported by Golang command line tools and this may cause\nconflicts with the <code>~/.netrc</code>.</p>\n<h1>Bonus: SSH config file</h1>\n<p>For regular use of the <code>git</code> tool, not the Golang command line tools, it's convient to have a <code>~/.ssh/config</code> file set up.\nIn order to do this, run the following commands:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>mkdir ~/.ssh\nchmod 700 ~/.ssh\ntouch ~/.ssh/config\nchmod 600 ~/.ssh/config\n</code></pre>\n<p>Please note the permissions on the files and directory above are essentail for SSH to work in it's default configuration on\nmost Linux systems.</p>\n<p>Then, edit the <code>~/.ssh/config</code> file to match the following:</p>\n<pre><code>Host privategitlab.company.com\n  Hostname privategitlab.company.com\n  User USERNAME_HERE\n  IdentityFile ~/.ssh/id_rsa\n</code></pre>\n<p>Please note the spacing in the above file matters and will invalidate the file if it is incorrect.</p>\n<p>Where <code>USERNAME_HERE</code> is your GitLab username and <code>~/.ssh/id_rsa</code> is the path to your SSH <em>private</em> key in your file system.\nYou've already uploaded its <em>public</em> key to GitLab. Here are <a href=\"https://docs.gitlab.com/ee/ssh/README.html#adding-an-ssh-key-to-your-gitlab-account\" rel=\"nofollow noreferrer\">some instructions</a>.</p>\n"}], "owner": {"reputation": 1185, "user_id": 3441222, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c1ef99d243c541138c9084f434bc98bf?s=128&d=identicon&r=PG&f=1", "display_name": "RedCollarPanda", "link": "https://stackoverflow.com/users/3441222/redcollarpanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 932, "favorite_count": 3, "answer_count": 2, "score": 5, "last_activity_date": 1607613884, "creation_date": 1577278069, "question_id": 59478542, "link": "https://stackoverflow.com/questions/59478542/goland-modules-with-private-gitlab-ssh", "title": "Goland modules with private gitlab (ssh)", "body": "<p>Good day! I try to migrate from glide to go modules (private gitlab repos)\nand checkout code via ssh</p>\n\n<p>I have a simple project with an import from private gitlab repo.</p>\n\n<p>go.mod looks like:</p>\n\n<pre><code>module my.private.package/modtest\n\ngo 1.12\n\nrequire my.private.package/statistics v1.0.0\n</code></pre>\n\n<p>when I try to build my app or run test I get:</p>\n\n<pre><code>go: my.private.package/statistics@v1.0.0: unrecognized import path \"my.private.package/statistics\" (parse https://my.private.package/statistics?go-get=1: no go-import meta tags ())\ngo: error loading module requirements\n</code></pre>\n\n<p>I Tried to add settings to git config:</p>\n\n<pre><code>[url \"ssh://git@my.gitlab.server:9999\"]\n        insteadOf = https://my.private.package\n</code></pre>\n\n<p>But still getting this error.</p>\n\n<p>Is there any way to make it work?\nThank you. </p>\n"}, {"tags": ["sql-server", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577275401, "post_id": 59478170, "comment_id": 105133463, "body": "the second version seems to contain a lots of whitespace in the keys, which you remove in the loop, hence indexing into the map with the changed key should get you <i>nothing</i>."}, {"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577275551, "post_id": 59478170, "comment_id": 105133497, "body": "oh yes, now I see it too. I didn&#39;t pay attention to that at all. Why is it bringing the stuff with so much whitespace? lol, I bet trimming this will fix the issue, its still weird."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577275720, "post_id": 59478170, "comment_id": 105133542, "body": "my guess is, but i could be wrong, that you&#39;re using some constant length text type in the sqlserver db for the abbreviation column, something like <code>char(6)</code> in other dbs (don&#39;t know if sqlserver has something like that, never used it)."}, {"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577275755, "post_id": 59478170, "comment_id": 105133552, "body": "and as side weirdness, I created the sqlite3 DB by fetching from the SQL server and inserting the values. So they should be 100% the same."}, {"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577275844, "post_id": 59478170, "comment_id": 105133572, "body": "@mkopriva, makes sense, it says nvarchar(32) or nvarchar(6), I have both tables."}, {"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577275894, "post_id": 59478170, "comment_id": 105133591, "body": "if you check this out, it&#39;s always 3 extra white spaces exactly."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577275897, "post_id": 59478170, "comment_id": 105133593, "body": "the values in the columns and types of the columns could be the same, however the behaviour of types does not have to behave the same, some databases follow the sql standard more closely then others."}, {"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577276031, "post_id": 59478170, "comment_id": 105133627, "body": "so looks like, SQLite is not bringing the extra padding but SQL server does, `    ABBREVIATION nvarchar(6) NULL, that is the column. exactly 3 white spaces. At least it should be easy to fix even though it&#39;s annoying. `"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577276209, "post_id": 59478170, "comment_id": 105133656, "body": "You could use a &quot;dynamically sized&quot; text type, like postgresql&#39;s <code>text</code>, or use the correct size <code>nvarchar(3)</code> if all your abbreviations are 3 characters long. Or if changing the column types is out of question do <code>fx[strings.TrimSpace(abbr)] = rate</code> inside the <code>getFX</code> function."}, {"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577276497, "post_id": 59478170, "comment_id": 105133712, "body": "yes, the target table has nvarchar(32) and i think there is no way for me to change it. It&#39;s some corporate DB. I was planning exactly to do this in getFX. If you want to, submit an answer and I give you creds."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1577277768, "creation_date": 1577277768, "answer_id": 59478499, "question_id": 59478170, "link": "https://stackoverflow.com/questions/59478170/map-returns-0-for-existing-keys-if-sqlserver-driver-is-used/59478499#59478499", "title": "map returns 0 for existing keys if sqlserver driver is used", "body": "<p>As discussed in the comments, the sqlserver version is retrieving the <code>Abbreviation</code>  with a lot of whitespace while in the sqlite version the abbr strings contain no whitespace. The whitespace seems to be caused by how the column's type is implemented by the sqlserver.</p>\n\n<p>So you either have to change the column types so that they are more compatible with each other, or you can \"normalize\" the scanned abbr string to ensure that it is always formatted in the same way regardless of the RDBMS.</p>\n\n<p>For example:</p>\n\n<pre><code>fx[strings.TrimSpace(abbr)] = rate\n</code></pre>\n"}], "owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 59478499, "answer_count": 1, "score": 0, "last_activity_date": 1577277768, "creation_date": 1577274981, "last_edit_date": 1577275465, "question_id": 59478170, "link": "https://stackoverflow.com/questions/59478170/map-returns-0-for-existing-keys-if-sqlserver-driver-is-used", "title": "map returns 0 for existing keys if sqlserver driver is used", "body": "<p>I have this code which works as intended as long as I use sqlite3 driver. When I switch to sqlserver, somehow, the map which clearly contains values returns 0 for each key.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>log.Println(current)\nfor abbr, rate := range fetched.Quotes {\n    abbr = abbr[3:len(abbr)]\n    log.Println(abbr, current[abbr])\n    if c, ok := current[abbr]; ok {\n    // programm does not reach this with sqlsever driver      \n    }\n}\n</code></pre>\n\n<p>I added these log statements to test. </p>\n\n<p><strong>sqlite  (<a href=\"https://github.com/mattn/go-sqlite3\" rel=\"nofollow noreferrer\">https://github.com/mattn/go-sqlite3</a>)</strong> </p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>map[AED:3.67 ARS:44.31 AUD:1.46 BGN:1.77 BRL:3.83 CAD:1.31 CHF:0.99 CNY:6.9 COP:3326.15 CRC:571.81 CZK:23 DOP:51.1 EGP:16.28 EUR:0.9 GBP:0.82 HKD:7.83 HUF:287.01 IDR:14179 INR:69.2 JMD:135.63 JOD:0.71 JPY:107.7 KRW:1162.6 MUR:36.25 MXN:18.85 MYR:4.13 NZD:1.5 PHP:51.71 PLN:3.83 QAR:3.64 RON:4.28 SAR:3.75 SDG:45.09 SEK:9.5 SGD:1.35 THB:30.66 TND:2.88 TWD:31.05 USD:1 UYU:34.65 VND:23291.5]\n2019/12/25 11:42:58 XAU 0\n2019/12/25 11:42:58 XCD 0\n2019/12/25 11:42:58 CHF 0.99\n2019/12/25 11:42:58 ZAR 0\n2019/12/25 11:42:58 AED 3.67\n2019/12/25 11:42:58 BDT 0\n2019/12/25 11:42:58 DKK 0\n2019/12/25 11:42:58 MXN 18.85\n...\n</code></pre>\n\n<p><strong>sqlserver (<a href=\"https://github.com/denisenkom/go-mssqldb\" rel=\"nofollow noreferrer\">https://github.com/denisenkom/go-mssqldb</a>)</strong> </p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>2019/12/25 11:44:12 map[AED   :3.67 ARS   :44.31 AUD   :1.46 BGN   :1.77 BRL   :3.83 CAD   :1.31 CHF   :0.99 CNY   :6.9 COP   :3326.15 CRC   :571.81 CZK   :23 DOP   :51.1 EGP\n  :16.28 EUR   :0.9 GBP   :0.82 HKD   :7.83 HUF   :287.01 IDR   :14179 INR   :69.2 JMD   :135.63 JOD   :0.71 JPY   :107.7 KRW   :1162.6 MUR   :36.25 MXN   :18.85 MYR   :4.13 NZD   :1.5 PHP   :51.71 PLN   :3.83 QAR   :3.64 RON   :4.28 SAR   :3.75 SDG   :45.09 SEK   :9.5 SGD   :1.35 THB   :30.66 TND   :2.88 TWD   :31.05 USD   :1 UYU   :34.65 VND   :23291.5]\n2019/12/25 11:44:12 KHR 0\n2019/12/25 11:44:12 MDL 0\n2019/12/25 11:44:12 AED 0\n2019/12/25 11:44:12 MXN 0\n2019/12/25 11:44:12 VUV 0\n2019/12/25 11:44:12 MWK 0\n2019/12/25 11:44:12 DOP 0\n...\n</code></pre>\n\n<p>So for some strange reason, this map which contains the keys as logged does return 0 for everything.</p>\n\n<p>Here are the 2 functions that I use to fetch and query</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func getFX(db *sql.DB) (fx map[string]float64, err error) {\n    var (\n        abbr string\n        rate float64\n    )\n    rows, err := db.Query(\"SELECT Abbreviation, Conversion_Rate FROM CURRENCY_TEST\")\n    if err != nil {\n        return fx, err\n    }\n    defer rows.Close()\n    fx = map[string]float64{}\n    for rows.Next() {\n        err := rows.Scan(&amp;abbr, &amp;rate)\n        if err != nil {\n            return fx, err\n        }\n        fx[abbr] = rate\n    }\n    err = rows.Err()\n    if err != nil {\n        return fx, err\n    }\n    return fx, nil\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func _fetchFX(dummy string, dummy1 string) (Fetched, error) {\n    jsn, _ := ioutil.ReadFile(\"data/current.json\")\n    payload := Fetched{}\n    err := json.Unmarshal(jsn, &amp;payload)\n    return payload, err\n}\n</code></pre>\n\n<p>If anyone has an idea why this is happening, please share your wisdom.</p>\n"}, {"tags": ["go", "golint"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1577273449, "post_id": 59477983, "comment_id": 105132979, "body": "When the linter returns nothing, that usually means it found no problems. Do you have reason to think it should find a problem?"}, {"owner": {"reputation": 95, "user_id": 1511608, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/60311e94ae13368d9f01c6c5e71f1f51?s=128&d=identicon&r=PG", "display_name": "Rustery", "link": "https://stackoverflow.com/users/1511608/rustery"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1577273607, "post_id": 59477983, "comment_id": 105133017, "body": "Yep. My mentor send his linter execution and there was some messages like  <code>$ golint hamming.go hamming.go:17:15: should drop = 0 from declaration of var hd; it is the zero value </code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1577273664, "post_id": 59477983, "comment_id": 105133035, "body": "Well I can confirm locally that neither <code>golint</code> nor <code>golaingci-lint</code> find any problem with that file, using default configuration."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1577273814, "post_id": 59477983, "comment_id": 105133074, "body": "@Volker: That&#39;s a matter of opinion, and &quot;best practice&quot; (if one exists) is usually context-specific, which you can&#39;t expect a linter to always get right."}, {"owner": {"reputation": 95, "user_id": 1511608, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/60311e94ae13368d9f01c6c5e71f1f51?s=128&d=identicon&r=PG", "display_name": "Rustery", "link": "https://stackoverflow.com/users/1511608/rustery"}, "edited": false, "score": 0, "creation_date": 1577274106, "post_id": 59477983, "comment_id": 105133155, "body": "Yes, it&#39;s true. But I&#39;m some confused now. I have thought maybe linting non-main functions can&#39;t be done, but I don&#39;t know..."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1577274128, "post_id": 59477983, "comment_id": 105133162, "body": "What are you confused about?"}, {"owner": {"reputation": 95, "user_id": 1511608, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/60311e94ae13368d9f01c6c5e71f1f51?s=128&d=identicon&r=PG", "display_name": "Rustery", "link": "https://stackoverflow.com/users/1511608/rustery"}, "edited": false, "score": 0, "creation_date": 1577274481, "post_id": 59477983, "comment_id": 105133249, "body": "I just don&#39;t know what to do next. Yes I can fix now that <code>int</code> problem, but I can&#39;t know what mentor&#39;s linter find next time."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577310506, "post_id": 59477983, "comment_id": 105140547, "body": "Ask your mentor. That&#39;s what mentors are for. Apparently he gave you a slightly incorrect assignment."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 1511608, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/60311e94ae13368d9f01c6c5e71f1f51?s=128&d=identicon&r=PG", "display_name": "Rustery", "link": "https://stackoverflow.com/users/1511608/rustery"}, "edited": false, "score": 0, "creation_date": 1577447483, "post_id": 59493537, "comment_id": 105173170, "body": "Thank you, @peter! I am agree with you. I have already passed my exercise and told my mentor that golint is not a gold standard and that my tools can be different  than his."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1577435135, "last_edit_date": 1577435135, "creation_date": 1577395003, "answer_id": 59493537, "question_id": 59477983, "link": "https://stackoverflow.com/questions/59477983/golint-execution-returns-nothing/59493537#59493537", "title": "golint execution returns nothing", "body": "<p>In Go, the minimal checks might be the Go tools, <code>go fmt</code>, <code>go vet</code>, and <code>golint</code>.</p>\n\n<p>Here is a minimum, reproducible example (see <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">How to create a Minimal, Reproducible Example</a>) that shows that your <code>hamming.go</code> program passes all current checks.</p>\n\n<p><a href=\"https://godoc.org/golang.org/x/lint/golint\" rel=\"nofollow noreferrer\">Command golint</a></p>\n\n<pre><code>$ go version\ngo version devel +075c20cea8 Thu Dec 26 13:53:31 2019 +0000 linux/amd64\n$ go fmt hamming.go\n$ go vet hamming.go\n$ go get -u golang.org/x/lint/golint\ngo: downloading golang.org/x/lint v0.0.0-20191125180803-fdd1cda4f05f\ngo: found golang.org/x/lint/golint in golang.org/x/lint v0.0.0-20191125180803-fdd1cda4f05f\ngo: downloading golang.org/x/tools v0.0.0-20191125144606-a911d9008d1f\ngo: golang.org/x/tools upgrade =&gt; v0.0.0-20191226230302-065ed046f11a\ngo: downloading golang.org/x/tools v0.0.0-20191226230302-065ed046f11a\n$ golint hamming.go\n$ cat hamming.go\n// Package hamming is Exercism.io exercise\npackage hamming\n\nimport \"errors\"\n\n// Distance \u2014 Calculating Hamming Distance for two DNA strands\nfunc Distance(a, b string) (int, error) {\n\n    if len(a) != len(b) {\n        return 0, errors.New(\"Strands should be equal size\")\n    }\n\n    if len(a) == 0 || len(b) == 0 {\n        return 0, nil\n    }\n\n    var hd int = 0\n\n    for i := 0; i &lt; len(a); i++ {\n        if a[i] != b[i] {\n            hd++\n        }\n    }\n\n    return hd, nil\n}\n$\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>Comment: My mentor send his linter execution and there was some messages like </p>\n\n<pre><code>$ golint hamming.go hamming.go:17:15: \nshould drop = 0 from declaration of var hd; it is the zero value \n</code></pre>\n  \n  <p>\u2013 Rustery</p>\n</blockquote>\n\n<p>Your mentor is using an old, obsolete version of <code>golint</code>. For the current version, they should run</p>\n\n<pre><code>go get -u golang.org/x/lint/golint\n</code></pre>\n\n<hr>\n\n<p>Has your mentor explained the limited purpose of <code>golint</code>? For example, \"Golint is not perfect, and has both false positives and false negatives. Do not treat its output as a gold standard.\"</p>\n\n<blockquote>\n  <p><a href=\"https://github.com/golang/lint/blob/master/README.md\" rel=\"nofollow noreferrer\">Golint is a linter for Go source code.</a></p>\n  \n  <p><strong>Purpose</strong></p>\n  \n  <p>Golint differs from gofmt. Gofmt reformats Go source code, whereas\n  golint prints out style mistakes.</p>\n  \n  <p>Golint differs from govet. Govet is concerned with correctness,\n  whereas golint is concerned with coding style. Golint is in use at\n  Google, and it seeks to match the accepted style of the open source Go\n  project.</p>\n  \n  <p>The suggestions made by golint are exactly that: suggestions. Golint\n  is not perfect, and has both false positives and false negatives. Do\n  not treat its output as a gold standard. We will not be adding pragmas\n  or other knobs to suppress specific warnings, so do not expect or\n  require code to be completely \"lint-free\". In short, this tool is not,\n  and will never be, trustworthy enough for its suggestions to be\n  enforced automatically, for example as part of a build process. Golint\n  makes suggestions for many of the mechanically checkable items listed\n  in Effective Go and the CodeReviewComments wiki page.</p>\n</blockquote>\n\n<hr>\n\n<p>Here is my attempt at a solution:</p>\n\n<pre><code>package hamming\n\nimport \"errors\"\n\n// Distance returns the Hamming distance for two DNA strings of equal length.\n// DNA strings are constructed from the alphabet {A, C, G, T}.\nfunc Distance(a, b string) (int, error) {\n    if len(a) != len(b) {\n        return 0, errors.New(\"strings should be of equal length\")\n    }\n\n    d := 0\n    for i := 0; i &lt; len(a); i++ {\n        if a[i] != b[i] {\n            d++\n        }\n    }\n    return d, nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1382, "user_id": 4125888, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MEJMY.jpg?s=128&g=1", "display_name": "Antoniazzi", "link": "https://stackoverflow.com/users/4125888/antoniazzi"}, "is_accepted": false, "score": 1, "last_activity_date": 1607229100, "creation_date": 1607229100, "answer_id": 65164689, "question_id": 59477983, "link": "https://stackoverflow.com/questions/59477983/golint-execution-returns-nothing/65164689#65164689", "title": "golint execution returns nothing", "body": "<p>You should define the confidence level (<strong>min_confidence</strong> argument).</p>\n<p>E.g: <code>golint -min_confidence 0 your_file_to_test</code></p>\n<p>See the golint usage:</p>\n<pre><code>golint -h\nUsage of golint:\n    golint [flags] # runs on package in current directory\n    golint [flags] [packages]\n    golint [flags] [directories] # where a '/...' suffix includes all sub-directories\n    golint [flags] [files] # all must belong to a single package\nFlags:\n  -min_confidence float\n        minimum confidence of a problem to print it (default 0.8)\n  -set_exit_status\n        set exit status to 1 if any issues are found\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 1511608, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/60311e94ae13368d9f01c6c5e71f1f51?s=128&d=identicon&r=PG", "display_name": "Rustery", "link": "https://stackoverflow.com/users/1511608/rustery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 795, "favorite_count": 1, "accepted_answer_id": 59493537, "answer_count": 2, "score": 0, "last_activity_date": 1607229100, "creation_date": 1577273322, "last_edit_date": 1577273424, "question_id": 59477983, "link": "https://stackoverflow.com/questions/59477983/golint-execution-returns-nothing", "title": "golint execution returns nothing", "body": "<p>I'm coding exercise for exercism.io. And my mentor said that my code should be checked by some go linters, and he suggested me to try golint and golangci-lint. \nI installed golint via <code>go get -u golang.org/x/lint/golint</code>, and started it: </p>\n\n<pre><code>rustam:hamming $ golint hamming.go \nrustam:hamming $ \n</code></pre>\n\n<p>but it returns nothing.\nAlso if I use golangci-lint there is same result \u2014\u00a0just nothing. And I have no idea why.</p>\n\n<p>There is my code, full of style mistakes: </p>\n\n<pre><code>// Package hamming is Exercism.io exercise\npackage hamming\n\nimport \"errors\"\n\n// Distance \u2014 Calculating Hamming Distance for two DNA strands\nfunc Distance(a, b string) (int, error) {\n\n    if len(a) != len(b) {\n        return 0, errors.New(\"Strands should be equal size\")\n    }\n\n    if len(a) == 0 || len(b) == 0 {\n        return 0, nil\n    }\n\n    var hd int = 0\n\n    for i := 0; i &lt; len(a); i++ {\n        if a[i] != b[i] {\n            hd++\n        }\n    }\n\n    return hd, nil\n}\n</code></pre>\n\n<p>And there is my go env:</p>\n\n<pre><code>rustam:hamming $ go env\nGO111MODULE=\"\"\nGOARCH=\"amd64\"\nGOBIN=\"/Users/rustam/go/bin\"\nGOCACHE=\"/Users/rustam/Library/Caches/go-build\"\nGOENV=\"/Users/rustam/Library/Application Support/go/env\"\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGONOPROXY=\"\"\nGONOSUMDB=\"\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/rustam/go\"\nGOPRIVATE=\"\"\nGOPROXY=\"https://proxy.golang.org,direct\"\nGOROOT=\"/usr/local/Cellar/go/1.13.4/libexec\"\nGOSUMDB=\"sum.golang.org\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/local/Cellar/go/1.13.4/libexec/pkg/tool/darwin_amd64\"\nGCCGO=\"gccgo\"\nAR=\"ar\"\nCC=\"clang\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/4j/4rjv22zs1pb68wssv5gn2wfw0000gn/T/go-build148685464=/tmp/go-build -gno-record-gcc-switches -fno-common\"\n</code></pre>\n\n<p>and my ~/.bash_profile </p>\n\n<pre><code>export GOPATH=$HOME/go\nexport GOBIN=$HOME/go/bin\nexport PATH=$PATH:$GOPATH/bin\n</code></pre>\n\n<p>I'd appreciate it if you could point out my mistakes.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1577271500, "post_id": 59477648, "comment_id": 105132532, "body": "No, you cannot do that, at least not with an interface with a <code>ShowAll</code> method."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577272680, "post_id": 59477648, "comment_id": 105132798, "body": "Your comments are completely inaccurate. Example: <code>func GetAll() map[string]UserModel {&#47;* return array of UserModel *&#47;}</code> -- No, it does not return an array of <code>UserModel</code>, it returns a map of <code>string</code> to <code>UserModel</code>."}, {"owner": {"reputation": 99, "user_id": 12509159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f7477f3d8c89db03438fe0f77ef298f?s=128&d=identicon&r=PG&f=1", "display_name": "kohhop", "link": "https://stackoverflow.com/users/12509159/kohhop"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1577273787, "post_id": 59477648, "comment_id": 105133064, "body": "@leafbebop , if ShowAll() will a procedure (return nothing) it&#39;ll be work, but for function - doesn&#39;t work. Do you have another way to solve my question?"}, {"owner": {"reputation": 99, "user_id": 12509159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f7477f3d8c89db03438fe0f77ef298f?s=128&d=identicon&r=PG&f=1", "display_name": "kohhop", "link": "https://stackoverflow.com/users/12509159/kohhop"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577273831, "post_id": 59477648, "comment_id": 105133075, "body": "@Flimzy, I corrected mo code"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1577274248, "post_id": 59477648, "comment_id": 105133190, "body": "@kohhop - your code still won&#39;t work, since <code>switch</code> statement shall be companied by <code>case</code> keyword and <code>Intfc</code> is not a value. As for your question, it is not clear unless you specify how you want your code look like (say, an API signature), it is unclear what approaches you should use. May be have a look on <code>reflect</code> package."}], "answers": [{"tags": [], "owner": {"reputation": 99, "user_id": 12509159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f7477f3d8c89db03438fe0f77ef298f?s=128&d=identicon&r=PG&f=1", "display_name": "kohhop", "link": "https://stackoverflow.com/users/12509159/kohhop"}, "is_accepted": true, "score": 0, "last_activity_date": 1578043093, "last_edit_date": 1578043093, "creation_date": 1577991456, "answer_id": 59568605, "question_id": 59477648, "link": "https://stackoverflow.com/questions/59477648/dynamic-return-type-in-interface/59568605#59568605", "title": "Dynamic return type in interface", "body": "<p>I did it!\n@leafbebop, @Flimzy and someone else look to <a href=\"https://github.com/arturturundaev/simpleCRUDproject\" rel=\"nofollow noreferrer\">https://github.com/arturturundaev/simpleCRUDproject</a></p>\n"}], "owner": {"reputation": 99, "user_id": 12509159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f7477f3d8c89db03438fe0f77ef298f?s=128&d=identicon&r=PG&f=1", "display_name": "kohhop", "link": "https://stackoverflow.com/users/12509159/kohhop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 59568605, "answer_count": 1, "score": -1, "last_activity_date": 1578043093, "creation_date": 1577271149, "last_edit_date": 1577273978, "question_id": 59477648, "link": "https://stackoverflow.com/questions/59477648/dynamic-return-type-in-interface", "title": "Dynamic return type in interface", "body": "<p>There is the next code:</p>\n\n<p><strong>UserModel.go</strong></p>\n\n<pre><code>type UserModel struct{login, password}\nvar EntityArr = map[string]UserModel{}\nfunc GetAll() map[string]UserModel {\n    uuidString := uuid.New().String()\n    user := Entity{Login: \"myLogin\", Password: \"MyPassword\"}\n    EntityArr[uuidString] = user\n\n    return EntityArr\n}\n</code></pre>\n\n<p><strong>PostModel.go</strong></p>\n\n<pre><code>type PostModel struct{title, description}\nfunc GetAll() map[string]PostModel {/* like in UserModel */}\n</code></pre>\n\n<p><strong>UserController.go</strong></p>\n\n<pre><code>type ControllerUser struct{}\nfunc GetAll()map[string]UserModel { rertun UserModel.GetAll() } \n</code></pre>\n\n<p><strong>PostController.go</strong></p>\n\n<pre><code>type ControllerPost struct{}\nfunc GetAll()map[string]PostModel { rertun PostModel.GetAll() }\n</code></pre>\n\n<p>I try to dynamic detect necessary controller:</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>var currentController = Intfc\nswitch entity {\n  \"user\" : currentController = UserController.ControllerUser{}\n  \"post\" : currentController = PostController.ControllerPost{}\n}\ncurrentController.GetAll()\n</code></pre>\n\n<p>To do this I need a common interface</p>\n\n<p><strong>Interface.go</strong></p>\n\n<pre><code>type Intfc interface {\n    ShowAll() ???\n}\n</code></pre>\n\n<p>What type of return data the function (in interface) returns?</p>\n"}, {"tags": ["go", "exception"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 3, "creation_date": 1577263852, "post_id": 59476512, "comment_id": 105130916, "body": "The problem appears to be in the <code>FindTest</code> function, which you did not show us."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1577267756, "post_id": 59476512, "comment_id": 105131709, "body": "Such &quot;heisenbugs&quot; are typically indicative of some unsynchronized concurrent access to memory: when program runs under a debugger, <i>timings</i> of various operations may well be different form those under &quot;normal&quot; circumstances\u2014especally if you literally suspend one (or more) of the goroutines by using break points in the debugger."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1577267847, "post_id": 59476512, "comment_id": 105131726, "body": "Unfortunately, since it&#39;s Windows\u2122, you may also experience an antivirus software intervening in interesting ways."}, {"owner": {"reputation": 11, "user_id": 12594599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b30e46af2f12508f9ede54763f6713f?s=128&d=identicon&r=PG&f=1", "display_name": "\u5927\u9ed1\u732b", "link": "https://stackoverflow.com/users/12594599/%e5%a4%a7%e9%bb%91%e7%8c%ab"}, "edited": false, "score": 0, "creation_date": 1577322293, "post_id": 59476512, "comment_id": 105142070, "body": "<code>func  FindTest (result *[]Student,data []Student,flag []bool ,level ,parent int ,index *int){ \tif level&gt;4{ \t\treturn \t} \tfor i:=0;i&lt; len(data)&amp;&amp;flag[i]==false;i++{ \t\tif data[i].Level==level&amp;&amp;data[i].Parent==parent&amp;&amp;flag[i]==false&zwnj;&#8203;{ \t\t\t(*result)[*index]=data[i] \t\t\tfmt.Println(*index,data[i]) \t\t\t*index++ \t\t\tflag[i]=true \t\t\tFindTest(result,data,flag,level+1,data[i].Id,index) \t\t} \t} }</code>"}, {"owner": {"reputation": 493, "user_id": 8364553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d203cf51ae3926dca4c2c3afcf24948?s=128&d=identicon&r=PG&f=1", "display_name": "p1gd0g", "link": "https://stackoverflow.com/users/8364553/p1gd0g"}, "edited": false, "score": 0, "creation_date": 1577332944, "post_id": 59476512, "comment_id": 105143239, "body": "@\u5927\u9ed1\u732b Your code works well in my ENV. \u8fd9\u662f\u7b97\u6cd5\u9898\u5417\uff0c\u8fd8\u662f\u4e1a\u52a1\uff1f"}, {"owner": {"reputation": 602, "user_id": 818944, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c4caeda8ef836969be3503e716756881?s=128&d=identicon&r=PG", "display_name": "EnterSB", "link": "https://stackoverflow.com/users/818944/entersb"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1577334041, "post_id": 59476512, "comment_id": 105143387, "body": "@kostix which antivirus software can make this issue? curious"}, {"owner": {"reputation": 11, "user_id": 12594599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b30e46af2f12508f9ede54763f6713f?s=128&d=identicon&r=PG&f=1", "display_name": "\u5927\u9ed1\u732b", "link": "https://stackoverflow.com/users/12594599/%e5%a4%a7%e9%bb%91%e7%8c%ab"}, "reply_to_user": {"reputation": 493, "user_id": 8364553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d203cf51ae3926dca4c2c3afcf24948?s=128&d=identicon&r=PG&f=1", "display_name": "p1gd0g", "link": "https://stackoverflow.com/users/8364553/p1gd0g"}, "edited": false, "score": 0, "creation_date": 1577334849, "post_id": 59476512, "comment_id": 105143504, "body": "@p1gd0g \u4e1a\u52a1\u5462\u6240\u4ee5\u6bd4\u8f83\u5173\u5fc3\u662f\u4e0d\u662f\u51fd\u6570\u7684\u95ee\u9898"}, {"owner": {"reputation": 493, "user_id": 8364553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d203cf51ae3926dca4c2c3afcf24948?s=128&d=identicon&r=PG&f=1", "display_name": "p1gd0g", "link": "https://stackoverflow.com/users/8364553/p1gd0g"}, "edited": false, "score": 0, "creation_date": 1577342770, "post_id": 59476512, "comment_id": 105145029, "body": "\u65e0\u6cd5\u590d\u73b0\u65e0\u4ece\u4e0b\u624b\u3002\u53ef\u4ee5\u8bd5\u4e00\u4e0b\u8fd9\u79cd\u5199\u6cd5\u80fd\u4e0d\u80fd\u7b26\u5408\u4f60\u7684\u8981\u6c42\u3002<a href=\"https://play.golang.org/p/lZ6y2uiV8y-\" rel=\"nofollow noreferrer\">play.golang.org/p/lZ6y2uiV8y-</a>"}], "owner": {"reputation": 11, "user_id": 12594599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b30e46af2f12508f9ede54763f6713f?s=128&d=identicon&r=PG&f=1", "display_name": "\u5927\u9ed1\u732b", "link": "https://stackoverflow.com/users/12594599/%e5%a4%a7%e9%bb%91%e7%8c%ab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1577339897, "creation_date": 1577262284, "last_edit_date": 1577339897, "question_id": 59476512, "link": "https://stackoverflow.com/questions/59476512/very-strange-problem-functions-that-run-normally-will-not-report-an-error-but-wi", "title": "Very strange problem functions that run normally will not report an error but will report an error when started in debug mode", "body": "<p>Direct runs are error free\nWhen debugging a program\nThe second time you enter the recursive function, an error is reported\nDo not skip methods to get into methods\nThis is my function okay\nVery strange question</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Student struct {\n    Name string\n    //\u6392\u5e8f\n    Sort int\n    //parent\n    Parent int\n    //level\n    Level int\n    Id    int\n}\nfunc main() {\n    var data []Student = []Student{\n        {Name: \"\u5bb6\u7528\u7535\u5668\", Sort: 1, Parent: 0, Level: 1, Id: 1},\n        {Name: \"\u7535\u8111\u529e\u516c\", Sort: 2, Parent: 0, Level: 1, Id: 2},\n        {Name: \"\u7537\u88c5\", Sort: 3, Parent: 0, Level: 1, Id: 3},\n        {Name: \"\u624b\u673a\", Sort: 1, Parent: 2, Level: 2, Id: 4},\n        {Name: \"\u6570\u7801\", Sort: 2, Parent: 1, Level: 2, Id: 5},\n        {Name: \"\u6c7d\u8f66\", Sort: 3, Parent: 1, Level: 2, Id: 6},\n        {Name: \"\u7537\u88c52\", Sort: 1, Parent: 3, Level: 2, Id: 7},\n        {Name: \"\u7537\u88c52\u4e0b\u5c42\u76ae\u88e4\", Sort: 1, Parent: 7, Level: 3, Id: 8},\n        {Name: \"\u6c7d\u8f662\u4e0b\u5c42\u62d6\u62c9\u673a\", Sort: 1, Parent: 6, Level: 3, Id: 9},\n    }\n    result := make([]Student, len(data))\n    flag := make([]bool, len(data))\n\n    index := 0\n    FindTest(&amp;result, data, flag, 1, 0, &amp;index)\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/ugnAh.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ugnAh.jpg\" alt=\"enter image description here\"></a>\nHere is error log:</p>\n\n<pre><code>//exception\n0 {\u5bb6\u7528\u7535\u5668 1 0 1 1}\nException 0xc000001d 0x0 0x0 0x4bb723\nPC=0x4bb723\n\nmain.FindTest(0xc000089d58, 0xc000089da0, 0x9, 0x9, 0xc00000a0d0, 0x9, 0x9, 0x2, 0x1, 0xc000089d40)\n    F:/golang/gostu/ptr/chan2.go:36 +0x573\nmain.FindTest(0xc000089d58, 0xc000089da0, 0x9, 0x9, 0xc00000a0d0, 0x9, 0x9, 0x1, 0x0, 0xc000089d40)\n    F:/golang/gostu/ptr/chan2.go:47 +0x465\nmain.main()\n    F:/golang/gostu/ptr/chan2.go:32 +0x184\nrax     0xc000089b10\nrbx     0xc000089880\nrcx     0xc000036000\nrdi     0xc00008e008\nrsi     0x19\nrbp     0xc000089ce0\nrsp     0xc000089bb8\nr8      0x83fd88\nr9      0xc0000896e0\n</code></pre>\n"}, {"tags": ["go", "assert"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 12220474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73f713f59f3269371f6ec43a0b9e008?s=128&d=identicon&r=PG&f=1", "display_name": "Mansi", "link": "https://stackoverflow.com/users/12220474/mansi"}, "edited": false, "score": 0, "creation_date": 1577261077, "post_id": 59476133, "comment_id": 105130339, "body": "$ go get gotest.tools/v3 package gotest.tools/v3: cannot find package &quot;gotest.tools/v3&quot; in any of:         c:\\go\\src\\gotest.tools\\v3 (from $GOROOT)         C:\\Users\\abc\\go\\src\\gotest.tools\\v3 (from $GOPATH)"}, {"owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "reply_to_user": {"reputation": 63, "user_id": 12220474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73f713f59f3269371f6ec43a0b9e008?s=128&d=identicon&r=PG&f=1", "display_name": "Mansi", "link": "https://stackoverflow.com/users/12220474/mansi"}, "edited": false, "score": 1, "creation_date": 1577262662, "post_id": 59476133, "comment_id": 105130658, "body": "OK - looks like you are not using a modules. I would strongly suggest that you consider using them (see <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/Modules</a> - running <code>go mod init github.com&#47;user&#47;stringutil</code> inside the project folder will enable this). If you don&#39;t want to use modules then I can take another look (but I use modules for all of my projects now)."}, {"owner": {"reputation": 63, "user_id": 12220474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73f713f59f3269371f6ec43a0b9e008?s=128&d=identicon&r=PG&f=1", "display_name": "Mansi", "link": "https://stackoverflow.com/users/12220474/mansi"}, "edited": false, "score": 0, "creation_date": 1577263375, "post_id": 59476133, "comment_id": 105130821, "body": "I am not using module. Without using module is it possible?"}, {"owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "reply_to_user": {"reputation": 63, "user_id": 12220474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73f713f59f3269371f6ec43a0b9e008?s=128&d=identicon&r=PG&f=1", "display_name": "Mansi", "link": "https://stackoverflow.com/users/12220474/mansi"}, "edited": false, "score": 0, "creation_date": 1577264225, "post_id": 59476133, "comment_id": 105130993, "body": "You can but need to go back to an older version. I have added extra details to my answer."}, {"owner": {"reputation": 63, "user_id": 12220474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73f713f59f3269371f6ec43a0b9e008?s=128&d=identicon&r=PG&f=1", "display_name": "Mansi", "link": "https://stackoverflow.com/users/12220474/mansi"}, "edited": false, "score": 0, "creation_date": 1577265131, "post_id": 59476133, "comment_id": 105131166, "body": "IT worked for me. Used &quot;gotest.tools/v3/assert&quot;. Then did - go mod init github.com/user/stringutil and go get gotest.tools/v3."}], "tags": [], "owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "is_accepted": true, "score": 0, "last_activity_date": 1577264719, "last_edit_date": 1592644375, "creation_date": 1577258658, "answer_id": 59476133, "question_id": 59475661, "link": "https://stackoverflow.com/questions/59475661/not-able-to-generate-coverage/59476133#59476133", "title": "Not able to generate coverage", "body": "<p>From <a href=\"https://github.com/gotestyourself/gotest.tools\" rel=\"nofollow noreferrer\">the usage instructions</a>:</p>\n<blockquote>\n<p>With Go modules enabled (go1.11+)</p>\n<p>get gotest.tools/v3</p>\n<p>import &quot;gotest.tools/v3/assert&quot;</p>\n</blockquote>\n<p>So instead of importing <code>gotest.tools/assert</code> you need to import <code>gotest.tools/v3/assert</code>. This will bring in the latest version of the package (I am assuming you are using modules; this is the default with the latest version of go unless you are working in GOPATH and dont have a go.mod).</p>\n<p>Importing <code>gotest.tools/assert</code> will bring in an old non module aware version. This is discussed in some detail in <a href=\"https://github.com/gotestyourself/gotest.tools/issues/166\" rel=\"nofollow noreferrer\">an issue</a> which includes the comment</p>\n<blockquote>\n<p>gotest.tools/assert is only a valid import for the v3 version of the package, which is long out of date</p>\n</blockquote>\n<p>As your comments indicate that you are not using modules I have had another look. It appears that the comment in the above issue is incorrect and the master of this project now includes support for modules. Unfortunately this has broken its use with projects that do not support modules. You could get an older release (would need to use git) or use modules in your project (the approach I recommend).</p>\n<p>To get the older release change to the gotest.tools folder (<code>C:\\Users\\abc\\go\\src\\gotest.tools</code> in your case) and run <code>git checkout v2.3.0</code> (2.3.0 probably works but you may need to go back to 2.2.0). Note that this means you will be using an older version of the package.</p>\n"}], "owner": {"reputation": 63, "user_id": 12220474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73f713f59f3269371f6ec43a0b9e008?s=128&d=identicon&r=PG&f=1", "display_name": "Mansi", "link": "https://stackoverflow.com/users/12220474/mansi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 59476133, "answer_count": 1, "score": 0, "last_activity_date": 1577272014, "creation_date": 1577253952, "last_edit_date": 1577272014, "question_id": 59475661, "link": "https://stackoverflow.com/questions/59475661/not-able-to-generate-coverage", "title": "Not able to generate coverage", "body": "<p>I have something like below in my test file</p>\n\n<pre><code>package stringutil\n\nimport (\n    \"testing\"\n    \"gotest.tools/assert\"\n)\n</code></pre>\n\n<p>When I try to test it I get error</p>\n\n<pre><code>$ go test github.com/user/stringutil\n# github.com/user/stringutil\npackage github.com/user/stringutil (test)\n        imports gotest.tools/assert\n        imports gotest.tools/v3/assert/cmp: code in directory C:\\Users\\abc\\go\\src\\gotest.tools\\assert\\cmp expects import \"gotest.tools/assert/cmp\"\nFAIL    github.com/user/stringutil [setup failed]\nFAIL\n</code></pre>\n\n<p>then I added \"gotest.tools/assert/cmp\" in import. </p>\n\n<pre><code>package stringutil\n\nimport (\n    \"testing\"\n    \"gotest.tools/assert\"\n    \"gotest.tools/assert/cmp\"\n)\n</code></pre>\n\n<p>When I tried testing it I got next error</p>\n\n<pre><code>$ go test github.com/user/stringutil\n# github.com/user/stringutil\npackage github.com/user/stringutil (test)\n        imports gotest.tools/assert\n        imports gotest.tools/v3/internal/format: code in directory C:\\Users\\abc\\go\\src\\gotest.tools\\internal\\format expects import \"gotest.tools/internal/format\"\nFAIL    github.com/user/stringutil [setup failed]\nFAIL\n</code></pre>\n\n<p>Then I added \"gotest.tools/internal/format\" in import</p>\n\n<pre><code>package stringutil\n\nimport (\n    \"testing\"\n    \"gotest.tools/assert\"\n    \"gotest.tools/assert/cmp\"\n    \"gotest.tools/internal/format\"\n)\n</code></pre>\n\n<p>Now I got another error while testing it</p>\n\n<pre><code>$ go test github.com/user/stringutil\n# github.com/user/stringutil\npackage github.com/user/stringutil (test)\n        imports gotest.tools/assert\n        imports gotest.tools/v3/assert/cmp\n        imports gotest.tools/v3/internal/format\n        imports gotest.tools/v3/internal/difflib: code in directory C:\\Users\\abc\\go\\src\\gotest.tools\\internal\\difflib expects import \"gotest.tools/internal/difflib\"\nFAIL    github.com/user/stringutil [setup failed]\nFAIL\n</code></pre>\n\n<p>then I added \"gotest.tools/internal/difflib\" in import</p>\n\n<pre><code>package stringutil\n\nimport (\n    \"testing\"\n    \"gotest.tools/assert\"\n    \"gotest.tools/assert/cmp\"\n    \"gotest.tools/internal/format\"\n    \"gotest.tools/internal/difflib\"\n)\n</code></pre>\n\n<p>Now I got different error</p>\n\n<pre><code>$ go test github.com/user/stringutil\n# github.com/user/stringutil\npackage github.com/user/stringutil (test)\n        imports gotest.tools/internal/difflib: use of internal package gotest.tools/internal/difflib not allowed\nFAIL    github.com/user/stringutil [setup failed]\nFAIL\n</code></pre>\n\n<p>If I do not use assert My test works</p>\n\n<pre><code>$ go test github.com/user/stringutil\nok      github.com/user/stringutil      0.435s\n</code></pre>\n\n<p>Looks like there is a issue with assert?</p>\n"}, {"tags": ["http", "go", "mux"], "answers": [{"tags": [], "owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "is_accepted": true, "score": 5, "last_activity_date": 1577261440, "creation_date": 1577261440, "answer_id": 59476432, "question_id": 59475580, "link": "https://stackoverflow.com/questions/59475580/http-fileserver-only-serves-index-html/59476432#59476432", "title": "http.FileServer only serves index.html", "body": "<p>To demonstrate why this does not work consider the following test app:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\ntype testHandler struct{}\n\nfunc (h *testHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    fmt.Printf(\"Got request for %s\\n\", r.URL)\n}\n\nfunc main() {\n    r := mux.NewRouter()\n    hndlr := testHandler{}\n    r.Handle(\"/\", &amp;hndlr)\n\n    // run on port 8080\n    if err := http.ListenAndServe(\":8080\", r); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>If you run this and access <code>http://127.0.0.1:8080/</code> in your browser it will log <code>Got request for /</code>. However if you access  <code>http://127.0.0.1:8080/foo</code> you will get a 404 error and nothing will be logged. This is because <code>r.Handle(\"/\", &amp;hndlr)</code> will only match on <code>/</code> and not anything below it.</p>\n\n<p>If you change this to <code>r.PathPrefix(\"/\").Handler(&amp;hndlr)</code> then it will work as you expect (the router will pass all paths to the handler). So to fix your example change <code>r.Handle(\"/\", http.FileServer(http.Dir(\"web\")))</code> to <code>r.PathPrefix(\"/\").Handler( http.FileServer(http.Dir(\"web\")))</code>.</p>\n\n<p>Note: Because this is passing all paths to <code>FileServer</code> there is really no need to use Gorilla Mux; I have left this in on the assumption that you will be using it to add some other routes.</p>\n"}], "owner": {"reputation": 866, "user_id": 1938859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bkqyI.jpg?s=128&g=1", "display_name": "Kyle", "link": "https://stackoverflow.com/users/1938859/kyle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 59476432, "answer_count": 1, "score": 0, "last_activity_date": 1577261440, "creation_date": 1577253049, "question_id": 59475580, "link": "https://stackoverflow.com/questions/59475580/http-fileserver-only-serves-index-html", "title": "http.FileServer only serves index.html", "body": "<p>My code for a simple file server:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"net/http\"\n    \"os\"\n\n    \"github.com/gorilla/handlers\"\n    \"github.com/gorilla/mux\"\n)\n\nfunc main() {\n    r := mux.NewRouter()\n\n    // default file handler\n    r.Handle(\"/\", http.FileServer(http.Dir(\"web\")))\n\n    // run on port 8080\n    if err := http.ListenAndServe(\":8080\", handlers.LoggingHandler(os.Stdout, r)); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>My directory structure is:</p>\n\n<pre><code>cmd/server/main.go\nweb/index.html\nweb/favicon.ico\nweb/favicon.png\nweb/css/main.css\n</code></pre>\n\n<p><code>index.html</code> asks for <code>main.css</code>. so when I run <code>go run cmd/server/main.go</code> I get the following output:</p>\n\n<pre><code>127.0.0.1 - - [24/Dec/2019:22:45:26 -0X00] \"GET / HTTP/1.1\" 304 0\n127.0.0.1 - - [24/Dec/2019:22:45:26 -0X00] \"GET /css/main.css HTTP/1.1\" 404 19\n</code></pre>\n\n<p>I'm able to see the <code>index.html</code> page, but without the CSS. When I request any other file (e.g. <code>favicon.ico</code>) I also get a 404. Why does my <code>FileServer</code> only serve <code>index.html</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 112, "user_id": 8245053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9wWDm.png?s=128&g=1", "display_name": "FuXiang Shu", "link": "https://stackoverflow.com/users/8245053/fuxiang-shu"}, "edited": false, "score": 1, "creation_date": 1577252646, "post_id": 59475034, "comment_id": 105129020, "body": "Your code seems to be working, <a href=\"https://play.golang.org/p/yPYZsyW8DGBMay\" rel=\"nofollow noreferrer\">I tested it on Playground</a>. May I know what error message did you get?"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1577247338, "last_edit_date": 1577247338, "creation_date": 1577246671, "answer_id": 59475138, "question_id": 59475034, "link": "https://stackoverflow.com/questions/59475034/golang-unpack-variadic-arguments/59475138#59475138", "title": "Golang unpack variadic arguments", "body": "<blockquote>\n  <p>unpack variadic arguments</p>\n</blockquote>\n\n<hr>\n\n<p>For your example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc run(a, b string, list ...int) {\n    fmt.Println(list)\n    for i, e := range list {\n        fmt.Println(i, e)\n    }\n}\n\nfunc call(list ...int) {\n    fmt.Println(list)\n    var x, y string\n    run(x, y, list...) // use \"list...\" is allowed\n}\n\nfunc main() {\n    a := []int{1, 2, 3}\n    fmt.Println(a)\n    call(a...)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/NI0L-nVVUxm\" rel=\"nofollow noreferrer\">https://play.golang.org/p/NI0L-nVVUxm</a></p>\n\n<p>Output:</p>\n\n<pre><code>[1 2 3]\n[1 2 3]\n[1 2 3]\n0 1\n1 2\n2 3\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577374078, "post_id": 59482001, "comment_id": 105154995, "body": "This answer provides no explanation."}, {"owner": {"reputation": 104, "user_id": 6246590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed25f9b404bdde9d5a903a6d283da514?s=128&d=identicon&r=PG&f=1", "display_name": "echmel", "link": "https://stackoverflow.com/users/6246590/echmel"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577395985, "post_id": 59482001, "comment_id": 105161343, "body": "if you are able to read this code you can understand everything. Just compare snippet of question and this one ;)"}], "tags": [], "owner": {"reputation": 104, "user_id": 6246590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed25f9b404bdde9d5a903a6d283da514?s=128&d=identicon&r=PG&f=1", "display_name": "echmel", "link": "https://stackoverflow.com/users/6246590/echmel"}, "is_accepted": false, "score": 0, "last_activity_date": 1577789755, "last_edit_date": 1577789755, "creation_date": 1577309721, "answer_id": 59482001, "question_id": 59475034, "link": "https://stackoverflow.com/questions/59475034/golang-unpack-variadic-arguments/59482001#59482001", "title": "Golang unpack variadic arguments", "body": "<p>you didn't declare variables x and y. Create them or just use quotes. \n<a href=\"https://play.golang.org/p/gZnMALrM4Uh\" rel=\"nofollow noreferrer\">https://play.golang.org/p/gZnMALrM4Uh</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc run(a, b string, list ...int) {\nfmt.Println(list)\n}\n\nfunc call(list ...int) {\n    run(\"x\", \"y\", list...) // ok\n}\n\nfunc main() {\n    a := []int{1, 2, 3}\n    call(a...)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1577374526, "creation_date": 1577374526, "answer_id": 59490452, "question_id": 59475034, "link": "https://stackoverflow.com/questions/59475034/golang-unpack-variadic-arguments/59490452#59490452", "title": "Golang unpack variadic arguments", "body": "<p>Variadic arguments can only be expanded if the slice you're passing to the variadic function is <em>taking the place of</em> the variadic argument. You cannot combine individual arguments and an expanded slice in a single variadic argument for this reason. When you use expansion, the function receives the \"expanded\" slice itself as its variadic parameter - it's semantic sugar that can be confusing, because these calls are not equivalent:</p>\n\n<pre><code>foo := []string{\"alpha\",\"beta\"}\nbar(foo...) // bar receives the foo slice as its variadic parameter\nbar(foo[0], foo[1]) // bar receives a new slice with these elements copied to it\n</code></pre>\n\n<p>You can find more details <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"nofollow noreferrer\">in the spec</a>, though the example they use makes some of the explanation unclear, because their example variadic function has multiple parameters. The section beginning \"If the final argument is assignable\" refers to the \"final argument\" not in a generic \"final argument to a variadic function\" sense, but in a specific \"final argument to the function in the example\" sense.</p>\n"}], "owner": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 1, "answer_count": 3, "score": -1, "last_activity_date": 1577789755, "creation_date": 1577245232, "question_id": 59475034, "link": "https://stackoverflow.com/questions/59475034/golang-unpack-variadic-arguments", "title": "Golang unpack variadic arguments", "body": "<p>How to unpack a variadic argument by <code>...</code> in golang:</p>\n\n<pre><code>func run(a, b string, list ...int) {\n}\n\nfunc call(list ...int) {\n    run(x, y, list...) // use \"list...\" is not allowed \n}\n\nfunc main() {\n    a := []int{1, 2, 3}\n    call(a...)\n}\n</code></pre>\n\n<p>Why this is illegal? As i have known, the <code>list</code> argument is a slice which can be unpacked by <code>...</code>.</p>\n"}, {"tags": ["go", "backend"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1577271426, "post_id": 59474814, "comment_id": 105132518, "body": "There are no &quot;outer&quot; packages in Go. And there are no &quot;inner&quot; or &quot;parent&quot; or whatnot packages. All packages are equal. (Nitpick for the true pedantics: stdlib, internal and vendor have additional rules). if you want to use anything from a package you must import it and no, you cannot have circular imports in which case you <b>must</b> redesign."}], "answers": [{"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1577244675, "post_id": 59474876, "comment_id": 105128167, "body": "The OP says: &quot;In b.go, I want to use the function from a.go. in a.go also use function from b.go. I think I would get circular import.&quot; How do you answer the OP&#39;s question?"}, {"owner": {"reputation": 140, "user_id": 9952547, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PGBKA3QEMQ4/AAAAAAAAAAI/AAAAAAAAAAA/0WypEKXas0w/photo.jpg?sz=128", "display_name": "trjade", "link": "https://stackoverflow.com/users/9952547/trjade"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1577259551, "post_id": 59474876, "comment_id": 105130086, "body": "From what @peterSO said, does that mean it is impossible to do? Should I change to structure of the code instead? Do you have any suggestion? I&#39;m confused right now :("}, {"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "edited": false, "score": 0, "creation_date": 1577268408, "post_id": 59474876, "comment_id": 105131852, "body": "If is a public repo, please provide the link. Unfortunately, circular dependencies are not allowed until Go2"}], "tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": -2, "last_activity_date": 1577283715, "last_edit_date": 1577283715, "creation_date": 1577242837, "answer_id": 59474876, "question_id": 59474814, "link": "https://stackoverflow.com/questions/59474814/using-function-from-file-in-outer-package/59474876#59474876", "title": "Using function from file in outer package", "body": "<p>Unfortunately, circular dependencies are not allowed until Go2. What you are trying to do can be made with the current Go version. You can refactor the code in order to create a package C that contains the data structures and the methods that have to be exported. \nRemember that you need to use the <code>go mod init YOUR_MODEL_NAME</code> and then you can call the method (remember that have to be exported) from the other file using <code>import YOUR_MODEL_NAME/package_name</code>. And remember that every folder can contain only one package.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6425674, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-SB2a6NG-fqw/AAAAAAAAAAI/AAAAAAAAABk/gbotcgk3iNc/photo.jpg?sz=128", "display_name": "Fenr An", "link": "https://stackoverflow.com/users/6425674/fenr-an"}, "is_accepted": false, "score": 0, "last_activity_date": 1578380665, "last_edit_date": 1578380665, "creation_date": 1577265542, "answer_id": 59476896, "question_id": 59474814, "link": "https://stackoverflow.com/questions/59474814/using-function-from-file-in-outer-package/59476896#59476896", "title": "Using function from file in outer package", "body": "<p>Maybe, a.go and pkg2 is flat, so, why don't you change your file view, like:</p>\n\n<p><code>\n-samplego\n--pkg\n--src\n---github.com\n----pkg1\n-----a.go\n-----b.go\n</code></p>\n\n<p>If you want keep your file structure, you should use mod, wait me some time.\n<code>\n-samplego\n--pkg\n--src\n---github.com\n----pkg1\n-----a.go\n-----pkg2\n-------b.go\n</code>\ncommand below:\n<code>bash\ncd $(SAMPLEGO_PATH) // change path to samplego exists\ngo mod init samplego\n</code>\nIn b.go, import \"samplego/src/github.com/pkg1\", then import functions from a.go by pkg1.function;\nIn a.go, import \"samplego/src/github.com/pkg1/pkg2\", then import functions from b.go  by pkg2.function;</p>\n"}], "owner": {"reputation": 140, "user_id": 9952547, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PGBKA3QEMQ4/AAAAAAAAAAI/AAAAAAAAAAA/0WypEKXas0w/photo.jpg?sz=128", "display_name": "trjade", "link": "https://stackoverflow.com/users/9952547/trjade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1578380665, "creation_date": 1577241990, "question_id": 59474814, "link": "https://stackoverflow.com/questions/59474814/using-function-from-file-in-outer-package", "title": "Using function from file in outer package", "body": "<p>I'm a Golang beginner here and struggling with how to use function from the outer package</p>\n\n<p>Here I have the source code as this tree below</p>\n\n<pre><code>-samplego\n--pkg\n--src\n---github.com\n----pkg1\n-----a.go\n-----pkg2\n-------b.go\n</code></pre>\n\n<p>In b.go, I want to use the function from a.go but the compiler told me that the function is undefined even if I declare the function as public(with first character as capital letter).</p>\n\n<p>I wonder If I have to import anything from a.go before using it but I think I would get circular import because in a.go also use function from b.go.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1577223766, "post_id": 59473316, "comment_id": 105125566, "body": "If it&#39;s always AAPL, use a wrapper struct to hold the quote (<a href=\"https://play.golang.com/p/02F2gYgGuIa\" rel=\"nofollow noreferrer\">play.golang.com/p/02F2gYgGuIa</a>). If the object key holding the quote is not always known upfront, use a map (<a href=\"https://play.golang.com/p/2iTXmp82eY-\" rel=\"nofollow noreferrer\">play.golang.com/p/2iTXmp82eY-</a>)."}, {"owner": {"reputation": 1, "user_id": 11887611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b67d5506169facd93caf213e48a5573?s=128&d=identicon&r=PG&f=1", "display_name": "Andy W.", "link": "https://stackoverflow.com/users/11887611/andy-w"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577227657, "post_id": 59473316, "comment_id": 105126176, "body": "@mkopriva Thanks; the second option helps a bit as the object key is not known and varies by quote (AAPL, AMZN, IBM, etc.) I&#39;ll see if I can get this to work in a custom UnmarshalJSON. I&#39;m looking to make a wrapper around the API."}, {"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "edited": false, "score": 0, "creation_date": 1577234480, "post_id": 59473316, "comment_id": 105127050, "body": "Use this solution: <a href=\"https://stackoverflow.com/questions/59338416/cast-json-that-contains-interface-in-properly-struct\" title=\"cast json that contains interface in properly struct\">stackoverflow.com/questions/59338416/&hellip;</a>"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577240123, "post_id": 59473316, "comment_id": 105127674, "body": "Note that you probably want <code>float</code> for the open, high, and low prices as well. Or maybe <code>string</code>, or a decimal-based floating point numeric package..."}, {"owner": {"reputation": 1, "user_id": 11887611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b67d5506169facd93caf213e48a5573?s=128&d=identicon&r=PG&f=1", "display_name": "Andy W.", "link": "https://stackoverflow.com/users/11887611/andy-w"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577302070, "post_id": 59473316, "comment_id": 105139197, "body": "Ok. Thanks for the suggestions. I had to Alias the quote class in the custom unmarshal func to avoid a loop then use a copier library to copy the struct but used @mkopriva suggestion. Not pretty but it works. I wasn&#39;t able to make any of the other suggestions work. Here is how I was able to get it to work: <a href=\"https://play.golang.com/p/zYTTMqjrLmS\" rel=\"nofollow noreferrer\">play.golang.com/p/zYTTMqjrLmS</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577302295, "post_id": 59473316, "comment_id": 105139233, "body": "@AndyW. no need for importing the extra package, just use conversion and assignment <a href=\"https://play.golang.com/p/StSQDFuvTAa\" rel=\"nofollow noreferrer\">play.golang.com/p/StSQDFuvTAa</a>."}, {"owner": {"reputation": 1, "user_id": 11887611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b67d5506169facd93caf213e48a5573?s=128&d=identicon&r=PG&f=1", "display_name": "Andy W.", "link": "https://stackoverflow.com/users/11887611/andy-w"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577302993, "post_id": 59473316, "comment_id": 105139322, "body": "Ah! Perfect! Thanks, @mkopriva"}], "answers": [{"tags": [], "owner": {"reputation": 473, "user_id": 976170, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/91c916c704b8e609eaf3c3b47f16e041?s=128&d=identicon&r=PG&f=1", "display_name": "Vahan", "link": "https://stackoverflow.com/users/976170/vahan"}, "is_accepted": false, "score": 0, "last_activity_date": 1577221673, "creation_date": 1577221673, "answer_id": 59473411, "question_id": 59473316, "link": "https://stackoverflow.com/questions/59473316/custom-json-struct-unmarshal/59473411#59473411", "title": "Custom JSON struct Unmarshal", "body": "<p>I think  you  are looking for json:\"-\".</p>\n\n<p><a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/#Marshal</a></p>\n\n<p>As a special case, if the field tag is \"-\", the field is always omitted. Note that a field with name \"-\" can still be generated using the tag \"-,\".</p>\n"}], "owner": {"reputation": 1, "user_id": 11887611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b67d5506169facd93caf213e48a5573?s=128&d=identicon&r=PG&f=1", "display_name": "Andy W.", "link": "https://stackoverflow.com/users/11887611/andy-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577221673, "creation_date": 1577220789, "question_id": 59473316, "link": "https://stackoverflow.com/questions/59473316/custom-json-struct-unmarshal", "title": "Custom JSON struct Unmarshal", "body": "<p>I'm using an API that returns the result as the name of the object and I am trying to unmarshal just the fields of the struct. Here is an example of the JSON:</p>\n\n<pre><code>{\n  \"AAPL\": {\n   \"symbol\": \"AAPL\",\n    \"description\": \"Apple Inc. - Common Stock\",\n    \"lastPrice\": 284.45,\n    \"openPrice\": 284.69,\n    \"highPrice\": 284.89,\n    \"lowPrice\": 282.9197,\n  }\n}\n</code></pre>\n\n<p>You can see it is using \"AAPL\" as the name of the struct and I'm not sure how to unmarshal it. I'm looking to unmarshal into this struct:</p>\n\n<pre><code>type Quote struct {\n    Symbol                    string  `json:\"symbol\"`\n    Description               string  `json:\"description\"`\n    LastPrice                 float64 `json:\"lastPrice\"`\n    OpenPrice                 int     `json:\"openPrice\"`\n    HighPrice                 int     `json:\"highPrice\"`\n    LowPrice                  int     `json:\"lowPrice\"`\n}\n</code></pre>\n\n<p>I assume I need to write a custom unmarshal func</p>\n\n<pre><code>func (q *Quote) UnmarshalJSON(b []byte) error {\n...\n}\n</code></pre>\n\n<p>I'm not sure of the contents. Any assistance is appreciated!</p>\n"}, {"tags": ["go", "apache-kafka", "kafka-consumer-api", "sarama"], "answers": [{"tags": [], "owner": {"reputation": 498, "user_id": 7280962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8181c2901a87288eef3d3a62589b0bd4?s=128&d=identicon&r=PG", "display_name": "Nicholas Martinez", "link": "https://stackoverflow.com/users/7280962/nicholas-martinez"}, "is_accepted": true, "score": 2, "last_activity_date": 1577454002, "creation_date": 1577454002, "answer_id": 59501641, "question_id": 59472560, "link": "https://stackoverflow.com/questions/59472560/sarama-kafka-consumergroup-function-return/59501641#59501641", "title": "Sarama Kafka consumergroup function return", "body": "<p>Here is the solution to my problem. I had goroutines blocking the main function(s) and they needed to be broken out. If the code below doesn't make any sense, here is a link to the program I was modifying: <a href=\"https://github.com/buger/goreplay\" rel=\"nofollow noreferrer\">https://github.com/buger/goreplay</a>. If I can get a response from the owner I plan on cleaning up the code and submitting a pull request, or possibly publishing a fork. </p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"encoding/json\"\n    \"strings\"\n\n    \"os\"\n\n    \"log\"\n\n    \"github.com/Shopify/sarama\"\n)\n\n// KafkaInput is used for recieving Kafka messages and\n// transforming them into HTTP payloads.\ntype KafkaInput struct {\n    sarama.ConsumerGroup\n    config   *KafkaConfig\n    consumer Consumer\n    messages chan *sarama.ConsumerMessage\n}\n\n// Consumer represents a Sarama consumer group consumer\ntype Consumer struct {\n    ready    chan bool\n    messages chan *sarama.ConsumerMessage\n}\n\nvar (\n    brokers  = \"\"\n    version  = \"\"\n    group    = \"\"\n    topics   = \"\"\n    assignor = \"\"\n    oldest   = true\n    verbose  = false\n)\n\n// NewKafkaInput creates instance of kafka consumer client.\nfunc NewKafkaInput(address string, config *KafkaConfig) *KafkaInput {\n    /**\n     * Construct a new Sarama configuration.\n     * The Kafka cluster version has to be defined before the consumer/producer is initialized.\n     */\n    c := sarama.NewConfig()\n    // Configuration options go here\n\n    log.Printf(\"KafkaConfig: %s\", config.host)\n    log.Printf(\"KafkaConfig: %s\", config.group)\n    log.Printf(\"KafkaConfig: %s\", config.topic)\n\n    log.Println(\"Starting a new Sarama consumer\")\n\n    if verbose {\n        sarama.Logger = log.New(os.Stdout, \"[sarama] \", log.LstdFlags)\n    }\n\n    version, err := sarama.ParseKafkaVersion(\"2.1.1\")\n    if err != nil {\n        log.Panicf(\"Error parsing Kafka version: %v\", err)\n    }\n\n    c.Version = version\n\n    if oldest {\n        c.Consumer.Offsets.Initial = sarama.OffsetOldest\n    }\n\n    group, err := sarama.NewConsumerGroup(strings.Split(config.host, \",\"), config.group, c)\n\n    /**\n     * Setup a new Sarama consumer group\n     */\n    consumer := Consumer{\n        ready:    make(chan bool),\n        messages: make(chan *sarama.ConsumerMessage, 256),\n    }\n\n    i := &amp;KafkaInput{\n        ConsumerGroup: group,\n        config:        config,\n        messages:      make(chan *sarama.ConsumerMessage, 256),\n        consumer:      consumer,\n    }\n\n    go i.loop([]string{config.topic})\n    i.messages = consumer.messages\n    return i\n}\n\n//ConsumeClaim and stuff\nfunc (i *KafkaInput) ConsumeClaim(s sarama.ConsumerGroupSession, c sarama.ConsumerGroupClaim) error {\n    for msg := range c.Messages() {\n        s.MarkMessage(msg, \"\")\n        i.Push(msg)\n    }\n    return nil\n}\n\nfunc (i *KafkaInput) loop(topic []string) {\n    ctx := context.Background()\n    for {\n        if err := i.Consume(ctx, []string{i.config.topic}, i); err != nil {\n            return\n        }\n    }\n}\n\n// Push Messages\nfunc (i *KafkaInput) Push(m *sarama.ConsumerMessage) {\n    if i.consumer.messages != nil {\n        log.Printf(\"MSGPUSH: %s\", m)\n        i.consumer.messages &lt;- m\n    }\n}\n\nfunc (i *KafkaInput) Read(data []byte) (int, error) {\n\n    message := &lt;-i.messages\n    log.Printf(\"Msg: %s\", string(message.Value))\n    if !i.config.useJSON {\n        copy(data, message.Value)\n        return len(message.Value), nil\n    }\n\n    var kafkaMessage KafkaMessage\n    json.Unmarshal(message.Value, &amp;kafkaMessage)\n\n    buf, err := kafkaMessage.Dump()\n    if err != nil {\n        log.Println(\"Failed to decode access log entry:\", err)\n        return 0, err\n    }\n\n    copy(data, buf)\n\n    return len(buf), nil\n\n}\n\nfunc (i *KafkaInput) String() string {\n    return \"Kafka Input: \" + i.config.host + \"/\" + i.config.topic\n}\n\n// Setup is run at the beginning of a new session, before ConsumeClaim\nfunc (i *KafkaInput) Setup(s sarama.ConsumerGroupSession) error {\n    return nil\n}\n\n// Cleanup is run at the end of a session, once all ConsumeClaim goroutines have exited\nfunc (i *KafkaInput) Cleanup(s sarama.ConsumerGroupSession) error {\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 498, "user_id": 7280962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8181c2901a87288eef3d3a62589b0bd4?s=128&d=identicon&r=PG", "display_name": "Nicholas Martinez", "link": "https://stackoverflow.com/users/7280962/nicholas-martinez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2345, "favorite_count": 1, "accepted_answer_id": 59501641, "answer_count": 1, "score": 2, "last_activity_date": 1586942932, "creation_date": 1577213808, "last_edit_date": 1577242605, "question_id": 59472560, "link": "https://stackoverflow.com/questions/59472560/sarama-kafka-consumergroup-function-return", "title": "Sarama Kafka consumergroup function return", "body": "<p>I am very new to Go Lang and attempting to make some adjustments to an open source library that consumes messages from Kafka using the Sarama library. The original code can be found <a href=\"https://github.com/buger/goreplay/blob/896dbe312ae2bb339add05237a3b35b870074146/input_kafka.go\" rel=\"nofollow noreferrer\">here.</a> </p>\n\n<p>The original package implements a PartitionConsumer that works just fine if one doesn't need read consistency across multiple consumers consuming the same topic, however, that does not work for me. </p>\n\n<p>I have done some work within the same application to implement the sarama NewConsumerGroup package using some examples I have found online. </p>\n\n<p>Below is the code I currently have running:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    // \"flag\"\n    \"os\"\n    \"os/signal\"\n    \"sync\"\n    \"syscall\"\n\n    \"encoding/json\"\n    \"log\"\n    \"strings\"\n\n    \"github.com/Shopify/sarama\"\n    // \"github.com/Shopify/sarama/mocks\"\n)\n\n// KafkaInput is used for recieving Kafka messages and\n// transforming them into HTTP payloads.\ntype KafkaInput struct {\n    config    *KafkaConfig\n    // consumers []sarama.PartitionConsumer\n    messages  chan *sarama.ConsumerMessage\n}\n\nvar (\n    brokers  = \"\"\n    version  = \"\"\n    group    = \"\"\n    topics   = \"\"\n    assignor = \"\"\n    oldest   = true\n    verbose  = false\n)\n\n// Consumer represents a Sarama consumer group consumer\ntype Consumer struct {\n    ready chan bool\n}\n\n// NewKafkaInput creates instance of kafka consumer client.\nfunc NewKafkaInput(address string, config *KafkaConfig) *KafkaInput {\n    /**\n     * Construct a new Sarama configuration.\n     * The Kafka cluster version has to be defined before the consumer/producer is initialized.\n     */\n    c := sarama.NewConfig()\n    // Configuration options go here\n\n    log.Println(\"Starting a new Sarama consumer\")\n\n    if verbose {\n        sarama.Logger = log.New(os.Stdout, \"[sarama] \", log.LstdFlags)\n    }\n\n    version, err := sarama.ParseKafkaVersion(\"2.1.1\")\n    if err != nil {\n        log.Panicf(\"Error parsing Kafka version: %v\", err)\n    }\n\n    c.Version = version\n\n    if oldest {\n        c.Consumer.Offsets.Initial = sarama.OffsetOldest\n    }\n\n    /**\n     * Setup a new Sarama consumer group\n     */\n    consumer := Consumer{ready: make(chan bool)}\n\n    ctx, cancel := context.WithCancel(context.Background())\n    client, err := sarama.NewConsumerGroup(strings.Split(config.host, \",\"), config.group, c)\n\n    if err != nil {\n        log.Panicf(\"Error creating consumer group client: %v\", err)\n    }\n\n    wg := &amp;sync.WaitGroup{}\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        for {\n            if err := client.Consume(ctx, []string{config.topic}, &amp;consumer); err != nil {\n                log.Panicf(\"Error from consumer: %v\", err)\n            }\n\n            // check if context was cancelled, signaling that the consumer should stop\n            if ctx.Err() != nil {\n                return\n            }\n\n            consumer.ready = make(chan bool)\n        }\n\n    }()\n\n    &lt;-consumer.ready // Await till the consumer has been set up\n    log.Println(\"Sarama consumer up and running!...\")\n\n    sigterm := make(chan os.Signal, 1)\n    signal.Notify(sigterm, syscall.SIGINT, syscall.SIGTERM)\n    select {\n    case &lt;-ctx.Done():\n        log.Println(\"terminating: context cancelled\")\n    case &lt;-sigterm:\n        log.Println(\"terminating: via signal\")\n    }\n    cancel()\n    wg.Wait()\n    if err = client.Close(); err != nil {\n        log.Panicf(\"Error closing client: %v\", err)\n    }\n\n    i := &amp;KafkaInput{\n        config: config,\n        // consumers: make([]sarama.PartitionConsumer, len(partitions)),\n        // messages:  make(chan *sarama.ConsumerMessage, 256),\n        messages: make(chan *sarama.ConsumerMessage, 256),\n    }\n\n\n    return i\n}\n\n// ConsumeClaim must start a consumer loop of ConsumerGroupClaim's Messages().\nfunc (consumer *Consumer) ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) error {\n    // NOTE:\n    // Do not move the code below to a goroutine.\n    // The `ConsumeClaim` itself is called within a goroutine, see:\n    // https://github.com/Shopify/sarama/blob/master/consumer_group.go#L27-L29\n    for message := range claim.Messages() {\n\n        log.Printf(\"Message claimed: value = %s, timestamp = %v, topic = %s\", string(message.Value), message.Timestamp, message.Topic)\n        session.MarkMessage(message, \"\")\n    }\n\n    return nil\n}\n\n// ErrorHandler should receive errors\nfunc (i *KafkaInput) ErrorHandler(consumer sarama.PartitionConsumer) {\n    for err := range consumer.Errors() {\n        log.Println(\"Failed to read access log entry:\", err)\n    }\n}\n\n// Read Comment\n\nfunc (i *KafkaInput) Read(data []byte) (int, error) {\n    message := &lt;-i.messages\n\n    if !i.config.useJSON {\n        copy(data, message.Value)\n        return len(message.Value), nil\n    }\n\n    var kafkaMessage KafkaMessage\n    json.Unmarshal(message.Value, &amp;kafkaMessage)\n\n    buf, err := kafkaMessage.Dump()\n    if err != nil {\n        log.Println(\"Failed to decode access log entry:\", err)\n        return 0, err\n    }\n\n    copy(data, buf)\n\n    return len(buf), nil\n\n}\n\nfunc (i *KafkaInput) String() string {\n    return \"Kafka Input: \" + i.config.host + \"/\" + i.config.topic\n}\n\n// Setup is run at the beginning of a new session, before ConsumeClaim\nfunc (consumer *Consumer) Setup(sarama.ConsumerGroupSession) error {\n    // Mark the consumer as ready\n    close(consumer.ready)\n    return nil\n}\n\n// Cleanup is run at the end of a session, once all ConsumeClaim goroutines have exited\nfunc (consumer *Consumer) Cleanup(sarama.ConsumerGroupSession) error {\n    return nil\n}\n</code></pre>\n\n<p>The KafkaConfig carries the groupID and Topic for the consumer. When I run this program the consumer fires up and reads from the proper topic using the correct group and prints it to the STDOUT using the ConsumerClaim created in this function:</p>\n\n<pre><code>func (consumer *Consumer) ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) error {\n\n    for message := range claim.Messages() {\n\n        log.Printf(\"Message claimed: value = %s, timestamp = %v, topic = %s\", string(message.Value), message.Timestamp, message.Topic)\n        session.MarkMessage(message, \"\")\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>What I believe I need however is for the <code>NewKafkaInput</code> function to return <code>*KafkaInput</code> with the messages from the claim added to the struct (forgive me if I am using the wrong terminology here, this is my first Go rodeo). </p>\n\n<pre><code>... \ni := &amp;KafkaInput{\n        config: config,\n        // consumers: make([]sarama.PartitionConsumer, len(partitions)),\n        // messages:  make(chan *sarama.ConsumerMessage, 256),\n        messages: make(chan *sarama.ConsumerMessage, 256),\n    }\n\n\n    return i\n}\n</code></pre>\n\n<p>In the original example that is done here: </p>\n\n<pre><code>func NewKafkaInput(address string, config *KafkaConfig) *KafkaInput {\n\n    ...\n\n    go func(consumer sarama.PartitionConsumer) {\n                defer consumer.Close()\n\n                for message := range consumer.Messages() {\n                    i.messages &lt;- message\n                }\n            }(consumer)\n\n    ...\n\n}\n</code></pre>\n\n<p>I have spent days toying around with moving functions in and out of the <code>NewKafakInput</code> function, attempting to add messages to the <code>KafakInput</code> struct outside the function and everything in between. I just can't get it to work. The <code>NewKafakInput</code> function needs to return the <code>*KafkaInput</code> with any messages so that this function can complete: </p>\n\n<pre><code>func (i *KafkaInput) Read(data []byte) (int, error) {\n    message := &lt;-i.messages\n\n    if !i.config.useJSON {\n        copy(data, message.Value)\n        return len(message.Value), nil\n    }\n\n    var kafkaMessage KafkaMessage\n    json.Unmarshal(message.Value, &amp;kafkaMessage)\n\n    buf, err := kafkaMessage.Dump()\n    if err != nil {\n        log.Println(\"Failed to decode access log entry:\", err)\n        return 0, err\n    }\n\n    copy(data, buf)\n\n    return len(buf), nil\n\n}\n</code></pre>\n\n<p>Its entirely possible I have made a complete mess of this thing as well, but any help and input is appreciated. </p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "visual-studio-code"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 12592444, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xpmAEZG9t9Y/AAAAAAAAAAI/AAAAAAAAAz8/sdpNMfDpwvs/photo.jpg?sz=128", "display_name": "Csaba Andras", "link": "https://stackoverflow.com/users/12592444/csaba-andras"}, "edited": false, "score": 0, "creation_date": 1577256712, "post_id": 59472655, "comment_id": 105129562, "body": "The package is installed as a module. I do see <code>github.com&#47;eiannone&#47;keyboard</code> if I run <code>go list -m all</code>. I see it under <code>$GOPATH&#47;pkg&#47;mod&#47;...</code>. Additionally, my program works if I run it manually with <code>go run</code> or in VSCode with debugging.  It fails only if I run it without debugging in VSCode."}], "tags": [], "owner": {"reputation": 97, "user_id": 7905035, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BcWAF.jpg?s=128&g=1", "display_name": "immukul", "link": "https://stackoverflow.com/users/7905035/immukul"}, "is_accepted": false, "score": 0, "last_activity_date": 1577214550, "creation_date": 1577214550, "answer_id": 59472655, "question_id": 59472423, "link": "https://stackoverflow.com/questions/59472423/vscode-golang-module-works-only-in-debug-mode-module-directory-problem/59472655#59472655", "title": "VSCode golang module works only in debug mode / module directory problem?", "body": "<p>The reason you get the 'cannot find package' error is because of the package that you are trying to use aren't present inside the GOROOT and also not in the GOPATH. In order to remove the error, do try to make use of go get command followed by the link of the GitHub package.</p>\n\n<pre><code>go get github.com/eiannone/keyboard\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 12592444, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xpmAEZG9t9Y/AAAAAAAAAAI/AAAAAAAAAz8/sdpNMfDpwvs/photo.jpg?sz=128", "display_name": "Csaba Andras", "link": "https://stackoverflow.com/users/12592444/csaba-andras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 331, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577214550, "creation_date": 1577212741, "question_id": 59472423, "link": "https://stackoverflow.com/questions/59472423/vscode-golang-module-works-only-in-debug-mode-module-directory-problem", "title": "VSCode golang module works only in debug mode / module directory problem?", "body": "<p>I have a small golang project with go modules and I have a dependency for github.com/eiannone/keyboard.</p>\n\n<p>If I start my main file with F5 (Start Debugging) it works. If I start it with CTR-F5 (run without debugging) it says it cannot find the package:</p>\n\n<pre><code>data/work/advent/d13/main.go:9:2: cannot find package \"github.com/eiannone/keyboard\" in any of:\n    /usr/local/go/src/github.com/eiannone/keyboard (from $GOROOT)\n    /home/user/work/go/src/github.com/eiannone/keyboard (from $GOPATH)\n</code></pre>\n\n<p>I can reproduce the same error message from console: Issuing <code>go run d13/main.go</code> works if I'm int the module directory (data/work/advent), but fails with the same error message if I issue the command from a different directory.</p>\n\n<p>Is it possible to set the directory to be used in launch.json?</p>\n\n<p>Or is there something else going on?</p>\n"}, {"tags": ["windows", "docker", "go"], "comments": [{"owner": {"reputation": 973, "user_id": 10473393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89a640df85b84e87172df633f941f921?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Santos", "link": "https://stackoverflow.com/users/10473393/alexander-santos"}, "edited": false, "score": 0, "creation_date": 1577206239, "post_id": 59471545, "comment_id": 105121615, "body": "Are you using docker toolbox?"}, {"owner": {"reputation": 41, "user_id": 5473689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dfbb1300e24cf0a795fc328d08bc3fd?s=128&d=identicon&r=PG&f=1", "display_name": "Janis Lange", "link": "https://stackoverflow.com/users/5473689/janis-lange"}, "reply_to_user": {"reputation": 973, "user_id": 10473393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89a640df85b84e87172df633f941f921?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Santos", "link": "https://stackoverflow.com/users/10473393/alexander-santos"}, "edited": false, "score": 0, "creation_date": 1577206295, "post_id": 59471545, "comment_id": 105121631, "body": "Yes I am using."}, {"owner": {"reputation": 973, "user_id": 10473393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89a640df85b84e87172df633f941f921?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Santos", "link": "https://stackoverflow.com/users/10473393/alexander-santos"}, "edited": false, "score": 0, "creation_date": 1577206509, "post_id": 59471545, "comment_id": 105121686, "body": "I think docker toolbox separates the env to the VIrtual Box&#39;s image. So you may need gcc inside this image, maybe installing gcc by docker solves that. (I am not sure if that is really the problem, you can try echoing $PATH inside docker) I know that Docker Toolbox has a limitation to only access shared drives on Virtual Box (Only C:\\Users allowed by default), i am not sure if pointing to gcc it will help you."}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 3, "creation_date": 1577206564, "post_id": 59471545, "comment_id": 105121697, "body": "Docker is an isolation system (and in your case also is running inside a VM), so it doesn&#39;t know about and can&#39;t use software installed on your host.  If you need gcc for some reason it needs to be installed in your image.  A <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> including application source code would be helpful; I&#39;d expect a basic Go application wouldn&#39;t need this."}, {"owner": {"reputation": 1285, "user_id": 4227700, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/BKZJV.jpg?s=128&g=1", "display_name": "northsideknight", "link": "https://stackoverflow.com/users/4227700/northsideknight"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1577206818, "post_id": 59471545, "comment_id": 105121763, "body": "I agree with @DavidMaze, I don&#39;t think alpine comes with gcc.  So I believe you have two options: install gcc with apk add build-base OR don&#39;t use CGO, so set the environment variable CGO_ENABLED=0"}, {"owner": {"reputation": 41, "user_id": 5473689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dfbb1300e24cf0a795fc328d08bc3fd?s=128&d=identicon&r=PG&f=1", "display_name": "Janis Lange", "link": "https://stackoverflow.com/users/5473689/janis-lange"}, "edited": false, "score": 0, "creation_date": 1577207480, "post_id": 59471545, "comment_id": 105121902, "body": "&quot;apk add build-base&quot; worked. Thanks alot."}], "answers": [{"tags": [], "owner": {"reputation": 1532, "user_id": 467285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87173a37d2b301a20a55ac042aaf6444?s=128&d=identicon&r=PG", "display_name": "valo", "link": "https://stackoverflow.com/users/467285/valo"}, "is_accepted": false, "score": 10, "last_activity_date": 1589549849, "creation_date": 1589549849, "answer_id": 61820640, "question_id": 59471545, "link": "https://stackoverflow.com/questions/59471545/when-trying-to-build-docker-image-i-get-gcc-executable-file-not-found-in-p/61820640#61820640", "title": "When trying to build docker image, I get &quot;&quot;gcc&quot;: executable file not found in $PATH&quot;", "body": "<p>I encountered the same problem when building a go app using an alpine image. Installing gcc fixed the problem. Here is how your Dockerfile should look like:</p>\n\n<pre><code>FROM golang:alpine\nRUN apk add build-base\nRUN mkdir /app\nWORKDIR /app\nADD . /app\nRUN go build -o main .\nEXPOSE 8080\nCMD [ \"app/main\" ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 11822233, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-VuFe9JAd5QM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf11pdzF0Dwd1mcVz6nM7_M6Eha1g/photo.jpg?sz=128", "display_name": "Jim", "link": "https://stackoverflow.com/users/11822233/jim"}, "is_accepted": false, "score": 2, "last_activity_date": 1600054066, "last_edit_date": 1600054066, "creation_date": 1600010699, "answer_id": 63872435, "question_id": 59471545, "link": "https://stackoverflow.com/questions/59471545/when-trying-to-build-docker-image-i-get-gcc-executable-file-not-found-in-p/63872435#63872435", "title": "When trying to build docker image, I get &quot;&quot;gcc&quot;: executable file not found in $PATH&quot;", "body": "<p>Add the gcc tools fixed the problem.</p>\n<pre><code>RUN apk add build-base\n</code></pre>\n<p>Also you can the this:</p>\n<pre><code>RUN apk --no-cache add make git gcc libtool musl-dev ca-certificates dumb-init \n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 5473689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dfbb1300e24cf0a795fc328d08bc3fd?s=128&d=identicon&r=PG&f=1", "display_name": "Janis Lange", "link": "https://stackoverflow.com/users/5473689/janis-lange"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2356, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1616309840, "creation_date": 1577206081, "last_edit_date": 1577206104, "question_id": 59471545, "link": "https://stackoverflow.com/questions/59471545/when-trying-to-build-docker-image-i-get-gcc-executable-file-not-found-in-p", "title": "When trying to build docker image, I get &quot;&quot;gcc&quot;: executable file not found in $PATH&quot;", "body": "<p>I have gcc on windows. </p>\n\n<pre><code>C:\\Users\\jkrov&gt;gcc --version\ngcc (MinGW.org GCC-8.2.0-5) 8.2.0\nCopyright (C) 2018 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n</code></pre>\n\n<p>My docker file:</p>\n\n<pre><code>FROM golang:alpine\nRUN mkdir /app\nWORKDIR /app\nADD . /app\nRUN go build -o main .\nEXPOSE 8080\nCMD [ \"app/main\" ]\n</code></pre>\n\n<p>When I try to build image I get error:</p>\n\n<pre><code>exec: \"gcc\": executable file not found in $PATH\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 111, "user_id": 7133719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bfaf34da0c8c293498e38ba2d862231?s=128&d=identicon&r=PG&f=1", "display_name": "Tugrul Bayrak", "link": "https://stackoverflow.com/users/7133719/tugrul-bayrak"}, "edited": false, "score": 1, "creation_date": 1577211161, "post_id": 59471501, "comment_id": 105122846, "body": "I am not from Go ecosystem deeply. I am familiar with this term from Java ecosystem. I would say that, it is for performance issues. There are two terms. Eager loading and Lazy loading. Lazy Loading means related entities are not loaded, until we need them. Eager Loading is the process where a query for one type of entity also loads related entities as a part of the query. It uses more memory. But less computation for other calls. Hope it is clear."}], "answers": [{"tags": [], "owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "is_accepted": true, "score": 7, "last_activity_date": 1577363065, "last_edit_date": 1577363065, "creation_date": 1577362627, "answer_id": 59488366, "question_id": 59471501, "link": "https://stackoverflow.com/questions/59471501/what-does-preload-function-do-in-gorm/59488366#59488366", "title": "What does Preload function do in gorm?", "body": "<p>The link you provided shows what it does. You just have to actually read the information on the page.</p>\n\n<p>First of all, this doesn't really do anything:</p>\n\n<pre><code>db.Preload(\"Username\")\n</code></pre>\n\n<p>On the other hand, the following:</p>\n\n<pre><code>db.Preload(\"Orders\").Find(&amp;users)\n</code></pre>\n\n<p>Does do something. First it populates <code>users</code> and then it populates <code>[]user.Orders</code>. On the comments on the page you linked you will find this, which shows what it does by query:</p>\n\n<pre><code>db.Preload(\"Orders\").Find(&amp;users)\n//// SELECT * FROM users;\n//// SELECT * FROM orders WHERE user_id IN (1,2,3,4);\n</code></pre>\n\n<p>So what does this really do? I can give you the technical answer, which you can easily find out by googling <strong>eager loading</strong> or I can give you an answer by example which I feel is simpler.</p>\n\n<p>So let me explain this by example.</p>\n\n<p>Say you have users, where each user can have multiple orders. This is a one to many relationship which can be defined like:</p>\n\n<pre><code>type User struct {\n  gorm.Model\n  Username string\n  Orders []Order\n}\n</code></pre>\n\n<p>When you populate your <code>users</code> slice like:</p>\n\n<pre><code>db.Find(&amp;users)\n//// SELECT * FROM users;\n</code></pre>\n\n<p>If you need to get all the orders for each user you can easily access <code>user.Orders</code> but this would be empty anyway because it didn't get populated.</p>\n\n<p>If we populate <code>users</code> slice like:</p>\n\n<pre><code>db.Preload(\"Orders\").Find(&amp;users)\n</code></pre>\n\n<p>The <code>user.Orders</code> will be populated by the orders of that user. This is an abstraction that makes dealing with relationships easier.</p>\n\n<p>The ugly alternative would be:</p>\n\n<pre><code>db.Find(&amp;users)\n\nfor user := range users {\n  db.Where(\"user_id\", user.id).Find(&amp;user.Orders)\n}\n</code></pre>\n\n<p>It will also make more request to the database than necessary. (which is not good)</p>\n\n<p>If your users has Posts and Comments and Orders then you can define and query it like this:</p>\n\n<pre><code>type User struct {\n  gorm.Model\n  Username string\n  Orders []Order\n  Comments []Comment\n  Posts []Post\n}\n\ndb.Preload(\"Orders\").Preload(\"Comments\").Preload(\"Posts\").Find(&amp;users)\n</code></pre>\n\n<p>With just the code above you can now have access to the users data in different tables in the database.</p>\n\n<p>I hope that helps.</p>\n"}], "owner": {"reputation": 167, "user_id": 5730790, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh5.googleusercontent.com/-pAdEv0dhFBk/AAAAAAAAAAI/AAAAAAAAAD8/Bn-xjC-R-Eo/photo.jpg?sz=128", "display_name": "Harsh Agarwal", "link": "https://stackoverflow.com/users/5730790/harsh-agarwal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1229, "favorite_count": 2, "accepted_answer_id": 59488366, "answer_count": 1, "score": 5, "last_activity_date": 1577363065, "creation_date": 1577205814, "last_edit_date": 1577206849, "question_id": 59471501, "link": "https://stackoverflow.com/questions/59471501/what-does-preload-function-do-in-gorm", "title": "What does Preload function do in gorm?", "body": "<p>The link <a href=\"http://gorm.io/docs/preload.html\" rel=\"noreferrer\">http://gorm.io/docs/preload.html</a> talks about preloading in GORM, but I am unable to understand what this function does.</p>\n\n<pre><code>type User struct {\n  gorm.Model\n  Username string\n  Orders Order\n}\ntype Order struct {\n  gorm.Model\n  UserID uint\n  Price float64\n}\n\n\ndb.Preload(\"Username\")\n\ndb.Preload(\"Orders\").Find(&amp;users)\n\n</code></pre>\n\n<p>Can someone explain what will these 2 statements do? What will be the output ?</p>\n\n<p>Is it that <code>preload</code> is used to cache the results?</p>\n"}, {"tags": ["go", "redis"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1577204359, "post_id": 59471198, "comment_id": 105121153, "body": "I think it should read <code>&amp;redis.FailoverOptions{ MasterName: &quot;mymaster&quot;, SentinelAddrs: &quot;XXX.XXX.XXX.XXX:26379&quot;,&quot;XXX.XXX.XXX.XXX:26379&quot;,&quot;XXX.XXX.XXX&zwnj;&#8203;.XXX:26379&quot;, }</code> instead"}], "answers": [{"comments": [{"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "reply_to_user": {"reputation": 27, "user_id": 11632274, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mZyqECysHqM/AAAAAAAAAAI/AAAAAAAAAQs/VNtn47df1q4/photo.jpg?sz=128", "display_name": "Shurilla", "link": "https://stackoverflow.com/users/11632274/shurilla"}, "edited": false, "score": 0, "creation_date": 1577266678, "post_id": 59472151, "comment_id": 105131492, "body": "@Shurilla That is not the way you thank anyone. If the post is helpful, Stackoverflow has a system to give upvote and accept the answer."}], "tags": [], "owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "is_accepted": true, "score": 0, "last_activity_date": 1577210701, "creation_date": 1577210701, "answer_id": 59472151, "question_id": 59471198, "link": "https://stackoverflow.com/questions/59471198/how-to-connect-to-redis-sentinel/59472151#59472151", "title": "How to connect to Redis (Sentinel)", "body": "<p>The error says that you have used the wrong formatted string slice.</p>\n\n<p>See the <a href=\"https://godoc.org/github.com/go-redis/redis#FailoverOptions\" rel=\"nofollow noreferrer\">FailoverOption{}</a> from <strong>\"go-redis\"</strong> pkg. It says the <code>.SentinelAddrs</code> is of <code>[]string</code> type.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>rdb:=redis.NewFailoverClient(&amp;redis.FailoverOptions(\n    MasterName: \"mymaster\",\n    SentinelAddrs: []string{\"XXX.XXX.XXX.XXX:26379\",\"XXX.XXX.XXX.XXX:26379\",\"XXX.XXX.XXX.XXX:26379\"},\n))\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 11632274, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mZyqECysHqM/AAAAAAAAAAI/AAAAAAAAAQs/VNtn47df1q4/photo.jpg?sz=128", "display_name": "Shurilla", "link": "https://stackoverflow.com/users/11632274/shurilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 573, "favorite_count": 0, "accepted_answer_id": 59472151, "answer_count": 1, "score": -2, "last_activity_date": 1577216089, "creation_date": 1577203658, "last_edit_date": 1577216089, "question_id": 59471198, "link": "https://stackoverflow.com/questions/59471198/how-to-connect-to-redis-sentinel", "title": "How to connect to Redis (Sentinel)", "body": "<p>My code with which I try to connect to REDIS SENTINEL. Since I'm new to golang wanted to clarify what's wrong with me? REDIS SENTINEL is configured and works correctly.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/go-redis/redis\"\n)\n\nfunc main() {\n    rdb:=redis.NewFailoverClient(&amp;redis.FailoverOptions(\n            MasterName: \"mymaster\",\n            SentinelAddrs: \"XXX.XXX.XXX.XXX:26379\",\"XXX.XXX.XXX.XXX:26379\",\"XXX.XXX.XXX.XXX:26379\",\n    ))\n    rdb.Ping()\n}\n</code></pre>\n\n<p>Run:</p>\n\n<pre><code>$ go run redis.go\n**# command-line-arguments**\n&gt;./redif.go:11:12: syntax error: unexpected :, expecting comma or )**\n</code></pre>\n"}, {"tags": ["go", "func"], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 0, "last_activity_date": 1577198376, "creation_date": 1577198376, "answer_id": 59470320, "question_id": 59470073, "link": "https://stackoverflow.com/questions/59470073/use-flag-value-in-new-package/59470320#59470320", "title": "Use flag value in new package", "body": "<p>As a direct answer - you can use exported global variables for the flag values. These can be used from other packages.</p>\n\n<p>E.g:</p>\n\n<pre><code>var Verbose = flag.Bool(\"v\", false, \"show verbose progress message\")\n</code></pre>\n\n<p>If this is defined globally in package <code>foo</code>, then <code>foo.Verbose</code> can be used from other packages that import <code>foo</code>.</p>\n\n<hr>\n\n<p>Stylistically, exported global variables should be used sparingly, and exporting one from the main package to use in another package is a particular code smell. You're making your package's behavior dependent on global state elsewhere, making it fragile and harder to test. It would be much better for your package to have some sort of configuration <code>struct</code> and fill it in when it's used from main, potentially using main's flags.</p>\n"}], "owner": {"reputation": 11, "user_id": 12143826, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mDrLSukpKvVZ8UNJAWv5IbwPPujeH_lsGWZG3os=k-s128", "display_name": "Igor Migal", "link": "https://stackoverflow.com/users/12143826/igor-migal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577198376, "creation_date": 1577196970, "question_id": 59470073, "link": "https://stackoverflow.com/questions/59470073/use-flag-value-in-new-package", "title": "Use flag value in new package", "body": "<p>I write on Golang. I create flag and use it in main package. But now I whant use it in new package. How can I do this? \n<code>myFlag   = flagSet.Int(\"MyFlag\", 0, \"Test\")</code> - this I wrote in Main package.\nI whant change variable in new package from console. But I don't know what write in new package for use this flag.</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 18299, "user_id": 2191572, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/TWbVr.png?s=128&g=1", "display_name": "MonkeyZeus", "link": "https://stackoverflow.com/users/2191572/monkeyzeus"}, "edited": false, "score": 0, "creation_date": 1577193690, "post_id": 59469348, "comment_id": 105117843, "body": "Did the ECMAScript regex ever work properly? According to my calculations it would match <code>RR ee Pp OOOO s t</code> without issues."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1577193778, "post_id": 59469348, "comment_id": 105117867, "body": "The <code>\\s</code> will work for you. You just did not use the raw string literal."}, {"owner": {"reputation": 19159, "user_id": 3600709, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/731c8c4c0029d3414563333de16b8977?s=128&d=identicon&r=PG&f=1", "display_name": "ctwheels", "link": "https://stackoverflow.com/users/3600709/ctwheels"}, "edited": false, "score": 0, "creation_date": 1577200426, "post_id": 59469348, "comment_id": 105119937, "body": "Use <code>[r\ud83c\uddf7]+</code> rather than <code>(r|\ud83c\uddf7)+</code> - the latter is inefficient. The same applies to any alternations for single character matches: <code>[ \\n]*</code>, <code>[\ud83c\uddeae]+</code>, etc."}], "answers": [{"tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": false, "score": 0, "last_activity_date": 1577193253, "creation_date": 1577193253, "answer_id": 59469382, "question_id": 59469348, "link": "https://stackoverflow.com/questions/59469348/converting-a-regex-from-js-flavor-to-golang-flavor/59469382#59469382", "title": "Converting a Regex from JS flavor to Golang flavor?", "body": "<p>Your example doesn't match because your regex doesn't include an uppercase \"O\"</p>\n\n<p>You can use this expression that includes it:</p>\n\n<pre><code>((r|\ud83c\uddf7)+)(( |\\n)*)((\ud83c\uddea|e)+)(( |\\n)*)((p|\ud83c\uddf5)+)(( |\\n)*)((\ud83c\uddf4|o|O)+)(( |\\n)*)((\ud83c\uddf8|s)+)(( |\\n)*)((t|\ud83c\uddf9)+)\n</code></pre>\n\n<p>In your Go code, make sure to use these quotes with it: </p>\n\n<pre><code>`((r|\ud83c\uddf7)+)(( |\\n)*)((\ud83c\uddea|e)+)(( |\\n)*)((p|\ud83c\uddf5)+)(( |\\n)*)((\ud83c\uddf4|o|O)+)(( |\\n)*)((\ud83c\uddf8|s)+)(( |\\n)*)((t|\ud83c\uddf9)+)`\n</code></pre>\n\n<p>Also <a href=\"https://regex101.com/r/sdEUdd/1\" rel=\"nofollow noreferrer\">see here</a> </p>\n"}, {"tags": [], "owner": {"reputation": 82895, "user_id": 372239, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/2twLb.jpg?s=128&g=1", "display_name": "Toto", "link": "https://stackoverflow.com/users/372239/toto"}, "is_accepted": false, "score": 1, "last_activity_date": 1577193352, "creation_date": 1577193352, "answer_id": 59469402, "question_id": 59469348, "link": "https://stackoverflow.com/questions/59469348/converting-a-regex-from-js-flavor-to-golang-flavor/59469402#59469402", "title": "Converting a Regex from JS flavor to Golang flavor?", "body": "<p>Is this working for you?</p>\n\n<pre><code>[r\ud83c\uddf7]\\s*[\ud83c\uddeae]\\s*[p\ud83c\uddf5]\\s*[\ud83c\uddf4o]\\s*[\ud83c\uddf8s]\\s*[t\ud83c\uddf9]\n</code></pre>\n\n<p>With case insensitive flag</p>\n\n<p><a href=\"https://regex101.com/r/Rg410I/2\" rel=\"nofollow noreferrer\">Demo &amp; explanation</a></p>\n"}], "owner": {"reputation": 1, "user_id": 12590630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e217eb60a4614325751b842e339b1de?s=128&d=identicon&r=PG&f=1", "display_name": "A simple user", "link": "https://stackoverflow.com/users/12590630/a-simple-user"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 290, "favorite_count": 0, "closed_date": 1577193917, "answer_count": 2, "score": -2, "last_activity_date": 1577193352, "creation_date": 1577193072, "question_id": 59469348, "link": "https://stackoverflow.com/questions/59469348/converting-a-regex-from-js-flavor-to-golang-flavor", "closed_reason": "Duplicate", "title": "Converting a Regex from JS flavor to Golang flavor?", "body": "<p>I am trying to convert a certain regex from ECMAScript flavor to Golang flavor, here it is : </p>\n\n<pre><code>((r|\ud83c\uddf7)+)(( |\\n)*)((\ud83c\uddea|e)+)(( |\\n)*)((p|\ud83c\uddf5)+)(( |\\n)*)((\ud83c\uddf4|o)+)(( |\\n)*)((\ud83c\uddf8|s)+)(( |\\n)*)((t|\ud83c\uddf9)+)\n</code></pre>\n\n<p>Basically the point is to match messages like \"r   \ud83c\uddea p O s t\".\nI've tried to replace \" \" by \"\\s\" but it's still not working. Any idea please?</p>\n"}, {"tags": ["go", "beego"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577195638, "post_id": 59468547, "comment_id": 105118476, "body": "<code>val, err := mg.Data[&quot;json&quot;] = map[string]string{ ...</code> is not valid Go, please show code that actually can reproduce the error."}, {"owner": {"reputation": 1323, "user_id": 1698509, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/edf0ad119c6130a8f08ce129c3d67f1c?s=128&d=identicon&r=PG", "display_name": "Guilherme", "link": "https://stackoverflow.com/users/1698509/guilherme"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577195721, "post_id": 59468547, "comment_id": 105118507, "body": "This is the code. Is a api, when i try to access, i get that error"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577196077, "post_id": 59468547, "comment_id": 105118627, "body": "If this is the code then start by fixing the invalid Go code, then, after you have something that can actually compile, you can start debugging whatever other issues you may have."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577196203, "post_id": 59468547, "comment_id": 105118665, "body": "If you are using some &quot;tool&quot; that fixes your invalid code for you before compiling and running the app, then please include that in your question, and also include the command you&#39;re using to run that tool."}, {"owner": {"reputation": 1323, "user_id": 1698509, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/edf0ad119c6130a8f08ce129c3d67f1c?s=128&d=identicon&r=PG", "display_name": "Guilherme", "link": "https://stackoverflow.com/users/1698509/guilherme"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577196606, "post_id": 59468547, "comment_id": 105118781, "body": "I am not familiar with golang. I am trying to make this change on a legacy system. Could you suggest me a way to change this?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577197317, "post_id": 59468547, "comment_id": 105119007, "body": "The code is broken in such a way that it is hard for me to understand what you&#39;re <i>trying</i> to do and therefore I am unable to provide suggestions to what you <i>should</i> do. All I can say is that what you have there is not valid Go code and it will not compile using the standard <code>go build</code> command. Try runnig <a href=\"https://play.golang.com/p/z5yRjmu87Bp\" rel=\"nofollow noreferrer\">this code example</a> and you&#39;ll see that it won&#39;t compile. Not only is <code>val, err := mg.Data[&quot;json&quot;] = map[string]string{ ...</code> invalid syntax, but you&#39;re also missing commas, which are required in Go, in the map&#39;s composite literal."}], "answers": [{"tags": [], "owner": {"reputation": 164, "user_id": 1957835, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/65d3b38093aa7662cbe0cce12e0d62c4?s=128&d=identicon&r=PG", "display_name": "ahmetlutfu", "link": "https://stackoverflow.com/users/1957835/ahmetlutfu"}, "is_accepted": false, "score": 2, "last_activity_date": 1578176491, "creation_date": 1578176491, "answer_id": 59595351, "question_id": 59468547, "link": "https://stackoverflow.com/questions/59468547/beego-endpoint-cant-find-templatefile-but-im-not-using-template/59595351#59595351", "title": "Beego endpoint can&#39;t find templatefile... but i&#39;m not using template", "body": "<p>You should use ServeJSON() with current controller. </p>\n\n<pre><code>func (c *MigrationController) GetOne() {\n     defer c.ServeJSON()\n     ...\n}\n</code></pre>\n"}], "owner": {"reputation": 1323, "user_id": 1698509, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/edf0ad119c6130a8f08ce129c3d67f1c?s=128&d=identicon&r=PG", "display_name": "Guilherme", "link": "https://stackoverflow.com/users/1698509/guilherme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1602675901, "creation_date": 1577188904, "last_edit_date": 1602675901, "question_id": 59468547, "link": "https://stackoverflow.com/questions/59468547/beego-endpoint-cant-find-templatefile-but-im-not-using-template", "title": "Beego endpoint can&#39;t find templatefile... but i&#39;m not using template", "body": "<p>I'm having trouble to create a endpoint on a Beego application</p>\n<p>So, I just put some object information on the returned JSON:</p>\n<pre><code>// GetOne ...\n// @Title GetOne\n// @Description get Migration by id\n// @Param   id      path    string  true        &quot;The key for staticblock&quot;\n// @Success 200 {object} models.Migration\n// @Failure 403 :id is empty\n// @router /:id [get]\nfunc (c *MigrationController) GetOne() {\n    val, err := mg.Data[&quot;json&quot;] = map[string]string{\n        &quot;MigrationId&quot;: c.MigrationId\n        &quot;Status&quot;: c.Status\n        &quot;Created&quot;: c.Created\n        &quot;Updated&quot;: c.Updated\n    }\n\n    if err != nil {\n        log.Debug(&quot;Fail - GetOne: %v&quot;, err)\n    } else {\n        mg.ServeJSON()\n    }\n</code></pre>\n<p>When I tried to call the endpoint, I get this</p>\n<pre><code>Handler crashed with error can't find templatefile in the path:views/migrationcontroller/getone.tpl\n</code></pre>\n<p>I'm not using these templates anywhere in the whole code...</p>\n<p>I'm not familiar with this framework, someone can help me?</p>\n"}, {"tags": ["json", "parsing", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1577194708, "post_id": 59468005, "comment_id": 105118166, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/28228393/json-unmarshal-returning-blank-structure\">json.Unmarshal returning blank structure</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3236289"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1577195886, "post_id": 59468005, "comment_id": 105118563, "body": "not worked @Peter <a href=\"https://play.golang.org/p/7d62N3BVan9\" rel=\"nofollow noreferrer\">play.golang.org/p/7d62N3BVan9</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3236289"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1577200626, "post_id": 59468005, "comment_id": 105120004, "body": "solved i add solution"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3236289"}, "edited": false, "score": 1, "creation_date": 1577188241, "post_id": 59468343, "comment_id": 105116001, "body": "Well,i want to parse [&quot;Presence&quot;,{&quot;id&quot;:&quot;905356870666@c.us&quot;,&quot;type&quot;:&quot;unavailable&quot;,&quot;&zwnj;&#8203;deny&quot;:true}] not you provided to me {&quot;Presence&quot;:{&quot;id&quot;:&quot;905356870666@c.us&quot;,&quot;type&quot;:&quot;unavailable&quot;,&quot;&zwnj;&#8203;deny&quot;:true}}  so your comment doesn&#39;t mean anything to me because i receive this json from whatsapp socket  please answer the question accourding to json array of : [&quot;Presence&quot;,{&quot;id&quot;:&quot;905356870666@c.us&quot;,&quot;type&quot;:&quot;unavailable&quot;,&quot;&zwnj;&#8203;deny&quot;:true}]"}, {"owner": {"reputation": 111, "user_id": 7133719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bfaf34da0c8c293498e38ba2d862231?s=128&d=identicon&r=PG&f=1", "display_name": "Tugrul Bayrak", "link": "https://stackoverflow.com/users/7133719/tugrul-bayrak"}, "edited": false, "score": 0, "creation_date": 1577188569, "post_id": 59468343, "comment_id": 105116113, "body": "@user3236289 your Json is not a valid Json. Also answer  is true. To unmarshall Json, export your struct fields. So use capital letters. Also do not use &quot;mapstructure&quot;. And  why &quot;jsonHandler&quot; struct has name and dat fields. They are not related with Json data. Maybe you should explain deeply."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3236289"}, "edited": false, "score": 0, "creation_date": 1577191462, "post_id": 59468343, "comment_id": 105117127, "body": "my json is correct not wrong format.it comes from whatsapp socket okay? here parsed version of my json <a href=\"https://www.dropbox.com/s/0asnrkkinhfh2ke/Screenshot%202019-12-24%2015.43.44.png?dl=0\" rel=\"nofollow noreferrer\">dropbox.com/s/0asnrkkinhfh2ke/&hellip;</a>"}, {"owner": {"reputation": 98, "user_id": 10993848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hEwPt.jpg?s=128&g=1", "display_name": "Shivang Goswami", "link": "https://stackoverflow.com/users/10993848/shivang-goswami"}, "edited": false, "score": 0, "creation_date": 1577197573, "post_id": 59468343, "comment_id": 105119111, "body": "@user3236289 Depending on your use case, Any direct method won&#39;t be applicable  in this scenario.Either you have to parse data into json.RawMessage(as shown by @alessiosavi) or an interface{} and then implement a custom logic. Using custom unmarshaler is also a good option. kindly go through this article <a href=\"https://engineering.bitnami.com/articles/dealing-with-json-with-non-homogeneous-types-in-go.html\" rel=\"nofollow noreferrer\">link</a> by Marko Mikulicic. You will have some clarity about the possible solutions."}], "tags": [], "owner": {"reputation": 98, "user_id": 10993848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hEwPt.jpg?s=128&g=1", "display_name": "Shivang Goswami", "link": "https://stackoverflow.com/users/10993848/shivang-goswami"}, "is_accepted": false, "score": 1, "last_activity_date": 1577198284, "last_edit_date": 1577198284, "creation_date": 1577187969, "answer_id": 59468343, "question_id": 59468005, "link": "https://stackoverflow.com/questions/59468005/parse-error-from-converting-json-string-to-struct/59468343#59468343", "title": "Parse Error from Converting Json String to Struct", "body": "<p>Go Playground Link: <a href=\"https://play.golang.org/p/qe0jyFVNTH1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qe0jyFVNTH1</a></p>\n\n<blockquote>\n  <p>Few Problem are present in this:<br><br>\n      1. Json Package can't refer the Unexported Structure Elements.So please use Deny instead of deny in the following snippet.This is applicable to all variables declared inside the structure<br><br>\n      2. The json fields tag are incorrect. eg.<code>mapstructure:\"id\"</code> should be <code>json:\"id\"</code><br><br>\n      3. The json to be parsed contains two distinct elements i.e string \"Presence\" and nested json object.It can't be parsed as a single element.It is better to declare \"Presence\" as a key and nested json as the value. <br><br>\n      4. The deny variable should be bool rather than string</p>\n</blockquote>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3236289"}, "edited": false, "score": 0, "creation_date": 1577195621, "post_id": 59469456, "comment_id": 105118466, "body": "we are simply parse <code>[&quot;Presence&quot;,{&quot;id&quot;:&quot;905356870666@c.us&quot;,&quot;type&quot;:&quot;unavailable&quot;,&quot;&zwnj;&#8203;deny&quot;:true}]</code>  bro these codes too complicated and too much for this json... there must be a short way (2,3 lines codes) to do that by experiencing 7 years of software developer"}], "tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": 1, "last_activity_date": 1577193670, "creation_date": 1577193670, "answer_id": 59469456, "question_id": 59468005, "link": "https://stackoverflow.com/questions/59468005/parse-error-from-converting-json-string-to-struct/59469456#59469456", "title": "Parse Error from Converting Json String to Struct", "body": "<p>Try with this one: <a href=\"https://play.golang.com/p/UICf_uNNFdC\" rel=\"nofollow noreferrer\">https://play.golang.com/p/UICf_uNNFdC</a></p>\n\n<p>I've commented a lot in order to enhance code readability. Be sure to handle error properly and remove debug print.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"strings\"\n)\n\ntype Presence struct {\n    Presence string\n    ID       string `json:\"id\"`\n    Type     string `json:\"type\"`\n    Deny     bool   `json:\"deny\"`\n}\n\ntype JsonHandler struct {\n    Name string   `json:\"name\"`\n    Dat  Presence `json:\"dat\"`\n}\n\nfunc main() {\n    var (\n        // Used for unmarshal a given json\n        packedData []json.RawMessage\n        err        error\n        // Data that does not have a related json key\n        name []byte\n        // Used for extract the raw data that will be unmarshalled into the Presence struct\n        temp []byte\n        // Nested json\n        jsonPresence Presence\n        handler      JsonHandler\n    )\n\n    s := `[\"Presence\",{\"id\":\"905356870666@c.us\",\"type\":\"unavailable\",\"deny\":true}]`\n\n    log.Println(\"Dealing with -&gt; \" + s)\n\n    // Unmarshall into a raw json message\n    err = json.Unmarshal([]byte(s), &amp;packedData)\n    if err != nil {\n        panic(err)\n    }\n\n    // Extract the presence\n    log.Println(\"Presence: \", string(packedData[0]))\n    // Extract the nested json\n    log.Println(\"Packed: \", string(packedData[1]))\n\n    // NOTE: 0 refers to the first value of the JSON\n    name, err = packedData[0].MarshalJSON()\n    if err != nil {\n        panic(err)\n    }\n    log.Println(\"Value that does not have a key: \" + string(name))\n    handler.Name = strings.Replace(string(name), \"\\\"\", \"\", -1)\n\n    // NOTE: 1 refers to the second value of the JSON, the entire JSON\n    // Unmarshal the nested Json into byte\n    temp, err = packedData[1].MarshalJSON()\n    if err != nil {\n        panic(err)\n    }\n\n    // Unmarshal the raw byte into the struct\n    err = json.Unmarshal(temp, &amp;jsonPresence)\n    if err != nil {\n        panic(err)\n    }\n\n    log.Println(\"ID:\", jsonPresence.ID)\n    log.Println(\"Type:\", jsonPresence.Type)\n    log.Println(\"Deny:\", jsonPresence.Deny)\n\n    handler.Dat = jsonPresence\n\n    log.Println(\"Data unmarshalled: \", handler)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "edited": false, "score": 0, "creation_date": 1577234230, "post_id": 59470710, "comment_id": 105127026, "body": "+1 very clean! Have you tested the performance of the two solution? I think that this one is more optimized than my solution in terms of speed."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user3236289"}, "is_accepted": false, "score": 1, "last_activity_date": 1577200602, "creation_date": 1577200602, "answer_id": 59470710, "question_id": 59468005, "link": "https://stackoverflow.com/questions/59468005/parse-error-from-converting-json-string-to-struct/59470710#59470710", "title": "Parse Error from Converting Json String to Struct", "body": "<p>Wow,solved problem by adding only these codes</p>\n\n<p>Here Go Lang Link : <a href=\"https://play.golang.org/p/doHNWK58Cae\" rel=\"nofollow noreferrer\">https://play.golang.org/p/doHNWK58Cae</a></p>\n\n<pre><code>func (n *JsonHandler) UnmarshalJSON(buf []byte) error {\n    tmp := []interface{}{&amp;n.Name, &amp;n.Dat}\n    wantLen := len(tmp)\n    if err := json.Unmarshal(buf, &amp;tmp); err != nil {\n        return err\n    }\n    if g, e := len(tmp), wantLen; g != e {\n        return fmt.Errorf(\"wrong number of fields in Notification: %d != %d\", g, e)\n    }\n    return nil\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3236289"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1577200602, "creation_date": 1577186234, "question_id": 59468005, "link": "https://stackoverflow.com/questions/59468005/parse-error-from-converting-json-string-to-struct", "title": "Parse Error from Converting Json String to Struct", "body": "<p>i cannot parse the json value i am sending a playground link\nAny idea about that? here is the link and codes</p>\n\n<p><a href=\"https://play.golang.org/p/qhZpS_-618s\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qhZpS_-618s</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    //mapstructure \"github.com/mitchellh/mapstructure\"\n\n)\n\ntype presence struct{\n    id string \n    m_type string \n    deny string \n}\ntype jsonHandler struct {\n    name string \n    dat map[string]interface{}\n\n}   \n\nfunc main() {\n    s := `[\"Presence\",{\"id\":\"905356870666@c.us\",\"type\":\"unavailable\",\"deny\":true}]`\n    data := jsonHandler{}\n    json.Unmarshal([]byte(s), &amp;data)\n    fmt.Printf(\"Operation: %s\", data.name)\n\n\n}\n</code></pre>\n\n<p>Output : \nOperation: \nProgram exited.</p>\n"}, {"tags": ["android", "go", "build", "android-source"], "answers": [{"tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": true, "score": 3, "last_activity_date": 1578210807, "creation_date": 1578210807, "answer_id": 59597983, "question_id": 59467685, "link": "https://stackoverflow.com/questions/59467685/native-library-is-not-getting-loaded-to-apex-defaults-from-golang-conditional-im/59597983#59597983", "title": "native library is not getting loaded to apex_defaults from golang conditional implementation?", "body": "<p>Reflection in Go can only access exported struct fields, which are the ones that start with an uppercase letter. In your <code>First</code> struct, <code>native_shared_libs</code> is unexported and cannot be accessed using reflection.</p>\n\n<p>Since the build process uses reflection to access the <code>props</code> struct, it cannot find information from it. You can change it like this:</p>\n\n<pre><code>type props struct {\n    Multilib struct {\n        First struct {\n           Native_shared_libs  []string\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 7976, "user_id": 1944896, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/sEsnw.jpg?s=128&g=1", "display_name": "TheLittleNaruto", "link": "https://stackoverflow.com/users/1944896/thelittlenaruto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 2, "accepted_answer_id": 59597983, "answer_count": 1, "score": 6, "last_activity_date": 1578210807, "creation_date": 1577184783, "last_edit_date": 1577947305, "question_id": 59467685, "link": "https://stackoverflow.com/questions/59467685/native-library-is-not-getting-loaded-to-apex-defaults-from-golang-conditional-im", "title": "native library is not getting loaded to apex_defaults from golang conditional implementation?", "body": "<p>So I wrote a go file which will dynamically append one library to apex_defaults-> multilib -> first -> native_shared_libs; full code of <code>Android.bp</code> can be checked <a href=\"https://android.googlesource.com/platform/frameworks/av/+/refs/heads/master/apex/Android.bp#21\" rel=\"nofollow noreferrer\">here</a>. However I can not see the compiled .so file in my out directory like other lib .so files generated. </p>\n\n<p><strong>Long Explanation:</strong></p>\n\n<p>I want to add a library named \"libabcxtractor\" to the array <a href=\"https://android.googlesource.com/platform/frameworks/av/+/refs/heads/master/apex/Android.bp#21\" rel=\"nofollow noreferrer\">native_shared_libs</a>; for that matter I wrote a <code>.go</code> file(as recommended by Google) with some condition which looks like this:</p>\n\n<pre><code>package my_apex\n\nimport (\n    \"android/soong/android\"\n    \"android/soong/apex\"\n    \"fmt\"\n    \"strings\"\n)\n\n\n\nfunc globalFlags(ctx android.BaseContext) []string {\n        var native_shared_libs []string\n        if(strings.Contains(ctx.AConfig().DeviceName(), \"my_apex_device\")){\n                fmt.Println(\"Some log to verify condition is getting executed......\")\n                native_shared_libs = append(native_shared_libs, \"libabcextractor\")\n        }\n\n        return native_shared_libs\n}\n\nfunc myApexFlagsDefaults(ctx android.LoadHookContext) {\n    type props struct {\n                Multilib struct {\n                        First struct {\n                                native_shared_libs  []string\n                        }\n                }\n        }\n        p := &amp;props{}\n        p.Multilib.First.native_shared_libs = globalFlags(ctx)\n        ctx.AppendProperties(p)\n}\n\nfunc myApexFlagsDefaultsFactory() android.Module {\n        module := apex.DefaultsFactory()\n        android.AddLoadHook(module, myApexFlagsDefaults)\n        return module\n}\n\nfunc init() {\n        fmt.Println(\"Registering module type....\")\n        android.RegisterModuleType(\"my_apex_defaults\", myApexFlagsDefaultsFactory)\n}\n</code></pre>\n\n<p>To enable above go condition to get picked at build time, I have updated my <code>Android.bp</code> file as below:</p>\n\n<pre><code>bootstrap_go_package {\n   name: \"soong-my_apex\",\n   pkgPath: \"frameworks/av/apex/build\",\n   deps: [ \"soong-apex\" ],\n   srcs: [ \"my_apex.go\", ],\n   pluginFor: [\"soong_build\"],\n}\n\nmy_apex_defaults {\n   name: \"my_apex\",\n}\n\napex_defaults {\n    name: \"com.android.media-defaults\",\n    java_libs: [\"updatable-media\"],\n    defaults: [\"my_apex\",] //THIS IS TO INCLUDE GO IMPLEMENTATION \n    multilib: {\n</code></pre>\n\n<p>When executing make command I can see it enters the conditional statement; the logs are getting printed. I further investigated by verifying whether my <code>.go</code> file gets compiled by checking the path <code>out/soong/.bootstrap/soong-my_apex/pkg/frameworks/av/apex/build.a</code>. It's there. However <code>\".so\"</code> file for <code>libabcextractor</code> is not being generated. Any help on this would be great. </p>\n\n<p><strong>Edit:</strong>\n<code>libabcextractor</code> is a vendor library which resides in Prebuilts path. If I try with any other library which is part of AOSP code and is in the existing <code>native_static_libs</code> array already, it is not working for them as well. From here on I am unable to debug further because of unavailability of proper documentations. </p>\n"}, {"tags": ["go", "memory", "goroutine", "allocator"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1577180794, "post_id": 59466727, "comment_id": 105113259, "body": "How memory is managed is not specified by the language may change from compiler to compiler and even be different in each version."}, {"owner": {"reputation": 184, "user_id": 5539494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/de5558aed62a14232df48682aff5f875?s=128&d=identicon&r=PG&f=1", "display_name": "ks2bmallik", "link": "https://stackoverflow.com/users/5539494/ks2bmallik"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1577188647, "post_id": 59466727, "comment_id": 105116143, "body": "@Volker correctly pointed it out. These things are susceptible to change. Still, you can read this article (based on go 1.13), I found it quite informative <a href=\"https://medium.com/a-journey-with-go/go-memory-management-and-allocation-a7396d430f44\" rel=\"nofollow noreferrer\">medium.com/a-journey-with-go/&hellip;</a>"}, {"owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "edited": false, "score": 0, "creation_date": 1577190885, "post_id": 59466727, "comment_id": 105116917, "body": "It&#39;s stored either in stack or in heap. Stack belongs to goroutine while mcache belongs to os thread&#39;s processor. Where it may be placed? We can&#39;t to predict with a 100% confidence, use escape analyzer. Also read this: <a href=\"https://golang.org/s/go11sched\" rel=\"nofollow noreferrer\">golang.org/s/go11sched</a>"}], "answers": [{"tags": [], "owner": {"reputation": 19, "user_id": 7534405, "user_type": "registered", "profile_image": "https://graph.facebook.com/672123036300792/picture?type=large", "display_name": "Mayur Wadekar", "link": "https://stackoverflow.com/users/7534405/mayur-wadekar"}, "is_accepted": false, "score": 0, "last_activity_date": 1580654911, "last_edit_date": 1580654911, "creation_date": 1580653844, "answer_id": 60027079, "question_id": 59466727, "link": "https://stackoverflow.com/questions/59466727/difference-or-relationship-between-stack-memory-and-mcache-in-go/60027079#60027079", "title": "Difference or relationship between stack memory and mcache in go?", "body": "<p>this might be helpful <a href=\"https://go101.org/article/memory-block.html\" rel=\"nofollow noreferrer\">https://go101.org/article/memory-block.html</a>.</p>\n\n<p>Also you can see what exact allocation is happening in memory using </p>\n\n<pre><code>go build -gcflags=-m your_file.go\n</code></pre>\n\n<p>Only things which used dynamically those only assigned to the heap.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc f() *int {\n    var x int\n    return &amp;x\n}\n\nfunc main() {\n    fmt.Println(f())\n}\n</code></pre>\n\n<hr>\n\n<p>go build -gcflags=-m encyptionDecryption.go </p>\n\n<pre><code>./encyptionDecryption.go:5:6: can inline f\n./encyptionDecryption.go:11:15: inlining call to f\n./encyptionDecryption.go:7:9: &amp;x escapes to heap\n./encyptionDecryption.go:6:6: moved to heap: x\n./encyptionDecryption.go:11:15: f() escapes to heap\n./encyptionDecryption.go:11:15: &amp;x escapes to heap\n./encyptionDecryption.go:11:15: moved to heap: x\n./encyptionDecryption.go:11:13: main ... argument does not escape\n</code></pre>\n\n<p>This is escape analysis. You can read more <a href=\"https://www.ardanlabs.com/blog/2017/05/language-mechanics-on-escape-analysis.html\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 105, "user_id": 7186181, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/86f319915cf11a0539484fd0ddb94f50?s=128&d=identicon&r=PG&f=1", "display_name": "cuihaikuo", "link": "https://stackoverflow.com/users/7186181/cuihaikuo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1580654911, "creation_date": 1577180288, "question_id": 59466727, "link": "https://stackoverflow.com/questions/59466727/difference-or-relationship-between-stack-memory-and-mcache-in-go", "title": "Difference or relationship between stack memory and mcache in go?", "body": "<p>Now I'm learning go memory management, when allocating a small object, the allocator will look in the  corresponding mspan in mcache, and we also know goroutine has a stack memory, so does that mean the spans in mcache belongs to stack memory(not heap)?  What happened in memory if we define a varible in a func like <code>a := 1</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 2, "creation_date": 1577178603, "post_id": 59466359, "comment_id": 105112433, "body": "Just rename the temp file instead of copying."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1577178798, "post_id": 59466359, "comment_id": 105112517, "body": "Has the data you replace the same byte length as the new data ? If yes, you could indeed overwrite the data. Otherwise you can&#39;t avoid creating the new file."}, {"owner": {"reputation": 51, "user_id": 8872904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d13838c5a48a6d8ec08992527ba7a5dc?s=128&d=identicon&r=PG&f=1", "display_name": "Amit", "link": "https://stackoverflow.com/users/8872904/amit"}, "edited": false, "score": 0, "creation_date": 1577178809, "post_id": 59466359, "comment_id": 105112523, "body": "There are some more complexities like concurrency and all. SO I can not keep deleting and renaming"}, {"owner": {"reputation": 51, "user_id": 8872904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d13838c5a48a6d8ec08992527ba7a5dc?s=128&d=identicon&r=PG&f=1", "display_name": "Amit", "link": "https://stackoverflow.com/users/8872904/amit"}, "reply_to_user": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1577178907, "post_id": 59466359, "comment_id": 105112554, "body": "@chmike yes data will of same length after replacing. But still how do I write back to same file"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1577179543, "post_id": 59466359, "comment_id": 105112801, "body": "to answer your question, you got to explain and demonstrate what <code>changeTheData</code> is performing."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1577179926, "post_id": 59466359, "comment_id": 105112943, "body": "&quot;I am not able to find a way to do that.&quot; Yes, simply because this is not possible. In general you cannot &quot;change&quot; the middle of a file."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1577205998, "post_id": 59466359, "comment_id": 105121556, "body": "@Volker but you can overwrite the data in the middle of a file"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1577271191, "post_id": 59466359, "comment_id": 105132466, "body": "@chmike You must read carefully: &quot;In general&quot;! If you are dealing with fixed sized records of course you can overwrite a record. But in general---read &quot;non fixed sized records&quot; (and the file extension of &quot;.txt&quot; hints at this) you cannot and that is what I said."}], "answers": [{"tags": [], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "is_accepted": true, "score": 4, "last_activity_date": 1577182876, "last_edit_date": 1577182876, "creation_date": 1577182165, "answer_id": 59467131, "question_id": 59466359, "link": "https://stackoverflow.com/questions/59466359/buffered-read-write-same-file-in-go/59467131#59467131", "title": "buffered read write same file in go", "body": "<p>The solution is to open the file twice, first for reading and second for overwriting the content. </p>\n\n<p>See the code below. </p>\n\n<p>Note that I use <code>reader.ReadString('\\n')</code>instead of <code>ReadLine</code>. Note also that I write to the output before testing the error. This is because the last line that is not ended by '\\n' is returned together with the <code>\u00eco.EOF</code>error. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    inFile, _ := os.Open(\"file.txt\")\n    defer inFile.Close()\n\n    outFile, _ := os.OpenFile(\"file.txt\", os.O_RDWR, 0777)\n    defer outFile.Close()\n\n    reader := bufio.NewReaderSize(inFile, 10*1024)\n\n    for {\n        line, err := reader.ReadString('\\n')\n        outFile.WriteString(changeData(line))\n        if err != nil {\n            if err != io.EOF {\n                fmt.Println(\"error:\", err)\n            }\n            break\n        }\n    }\n}\n</code></pre>\n\n<p>I tested the code with this <code>changeData</code>function that change lower case letters to upper case letters, and upper case letters to lower case letters. We can then test the changes by calling the functions repeatedly.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func changeData(data string) string {\n    o := make([]rune, 0, len(data))\n    for _, r := range data {\n        if unicode.IsLetter(r) {\n            if unicode.IsUpper(r) {\n                o = append(o, unicode.ToLower(r))\n            } else {\n                o = append(o, unicode.ToUpper(r))\n            }\n        } else {\n            o = append(o, r)\n        }\n    }\n    return string(o)\n}\n</code></pre>\n\n<p>This code will overwrite every line of the file. Whether the line is modified depends on what <code>changeData</code>does. </p>\n\n<p>If you want to avoid overwriting every lines because, for instance, most lines don't need to be changed, you then have to seek to the location you want to overwrite data. </p>\n"}], "owner": {"reputation": 51, "user_id": 8872904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d13838c5a48a6d8ec08992527ba7a5dc?s=128&d=identicon&r=PG&f=1", "display_name": "Amit", "link": "https://stackoverflow.com/users/8872904/amit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "accepted_answer_id": 59467131, "answer_count": 1, "score": 0, "last_activity_date": 1577182876, "creation_date": 1577178453, "last_edit_date": 1577179402, "question_id": 59466359, "link": "https://stackoverflow.com/questions/59466359/buffered-read-write-same-file-in-go", "title": "buffered read write same file in go", "body": "<p>I am trying to read a very large file line by line and the replace something in line and write back to same file. I am not able to find a way to do that.\nCurrently I have created a temp file and save the replaced line in temp file and at last copy the temp file content in original file. But I have to do two reads and two writes. I want to avoid that. Any ideas. </p>\n\n<p>below is what I have tried:</p>\n\n<pre><code>file, _ := os.Open(\"somelargesay1GbFile.txt\")\ndefer file.Close()\n\noutFile, _ := os.OpenFile(\"temp.txt\", os.O_RDWR|os.O_CREATE|os.O_TRUNC, 0777)\ndefer outFile.Close()\n\nreader := bufio.NewReaderSize(file, 10*1024)\n\nfor {\n    bytesread, isprefix, err := reader.ReadLine()\n\n    if err != nil {\n        if err == io.EOF {\n\n            data := changeTheData(string(bytesread))\n\n            outFile.WriteString(data)\n\n            if !isprefix {\n                outFile.WriteString(\"\\r\\n\")\n            }\n        } else {\n            log.Fatal(err)\n        }\n        break\n    }\n\n    data := changeTheData(string(bytesread))\n    outFile.WriteString(data)\n    if !isprefix {\n        outFile.WriteString(\"\\r\\n\")\n    }\n}\n</code></pre>\n\n<p>Finally I delete the file <code>somelargesay1GbFile.txt</code> and rename it to <code>temp.txt</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 67968, "user_id": 584192, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YBSIc.png?s=128&g=1", "display_name": "Samuel Liew", "link": "https://stackoverflow.com/users/584192/samuel-liew"}, "edited": false, "score": 0, "creation_date": 1577324530, "post_id": 59465996, "comment_id": 105142323, "body": "Comments are not for extended discussion; this conversation has been <a href=\"https://chat.stackoverflow.com/rooms/204854/discussion-on-question-by-user12517276-go-net-http-leaks-memory-in-high-load\">moved to chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 12517276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/951163384744b61f2b75608198e13910?s=128&d=identicon&r=PG&f=1", "display_name": "user12517276", "link": "https://stackoverflow.com/users/12517276/user12517276"}, "edited": false, "score": 0, "creation_date": 1577350133, "post_id": 59482829, "comment_id": 105147036, "body": "So what should I do? I have attached screenshot of server top command. The actual code is split into several file which read user data from post and add few fields to it then post to client using goroutine and returns response from anyone. I am also using <code>tidwall gjson&#47;sjson</code> to read and write to post data. Should this be causing high cpu resulting in mempry leaks?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 73, "user_id": 12517276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/951163384744b61f2b75608198e13910?s=128&d=identicon&r=PG&f=1", "display_name": "user12517276", "link": "https://stackoverflow.com/users/12517276/user12517276"}, "edited": false, "score": 0, "creation_date": 1577354160, "post_id": 59482829, "comment_id": 105148369, "body": "it is always possible to buy more hardware, although it is bad for the planet.."}, {"owner": {"reputation": 73, "user_id": 12517276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/951163384744b61f2b75608198e13910?s=128&d=identicon&r=PG&f=1", "display_name": "user12517276", "link": "https://stackoverflow.com/users/12517276/user12517276"}, "edited": false, "score": 0, "creation_date": 1577356081, "post_id": 59482829, "comment_id": 105149034, "body": "its $750 server, if I am not able to run 3k qps it will be waste of resources, there is something wrong in code for sure and I am not able to resolve it, I have added the screenshot without calling any of client url with same amount of load as with url, cpu and memory both was stable. Memory leaks happens only when calling url and latency goes up."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 73, "user_id": 12517276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/951163384744b61f2b75608198e13910?s=128&d=identicon&r=PG&f=1", "display_name": "user12517276", "link": "https://stackoverflow.com/users/12517276/user12517276"}, "edited": false, "score": 0, "creation_date": 1577357114, "post_id": 59482829, "comment_id": 105149380, "body": "A program is always as good as its writer, nothing more. you should refactor your work to consume less memory and make the program faster. However, that wont be addressed within this post that must remains as concise, restricted and clear as possible. Now in my personal opinion,you are not trying hard to understand and keep using the same understanding as before the demonstration i produced. So i failed somewhere, in this conditions, i don&#39;t feel like i am going to be able to help you furthermore."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 73, "user_id": 12517276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/951163384744b61f2b75608198e13910?s=128&d=identicon&r=PG&f=1", "display_name": "user12517276", "link": "https://stackoverflow.com/users/12517276/user12517276"}, "edited": false, "score": 0, "creation_date": 1577357562, "post_id": 59482829, "comment_id": 105149504, "body": "maybe you can read this <a href=\"https://github.com/dgryski/go-perfbook\" rel=\"nofollow noreferrer\">github.com/dgryski/go-perfbook</a>"}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 5, "last_activity_date": 1577362442, "last_edit_date": 1577362442, "creation_date": 1577320589, "answer_id": 59482829, "question_id": 59465996, "link": "https://stackoverflow.com/questions/59465996/go-net-http-leaks-memory-in-high-load/59482829#59482829", "title": "Go net/http leaks memory in high load", "body": "<p>this code is not leaking. </p>\n\n<p>To demonstrate, lets update it ** slightly so the post is reproducible.</p>\n\n<p><strong>main.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"crypto/tls\"\n    _ \"expvar\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"math/rand\"\n    \"net\"\n    \"net/http\"\n    _ \"net/http/pprof\"\n    \"os\"\n    \"runtime\"\n    \"strconv\"\n    \"sync\"\n    \"time\"\n\n    \"github.com/gorilla/mux\"\n)\n\nvar (\n    //http client\n    Client *http.Client\n\n    //http Transport\n    Transport *http.Transport\n)\n\n\nfunc init() {\n\n    go http.ListenAndServe(\"localhost:6060\", nil)\n\n    //Get Any command line argument passed\n    args := os.Args[1:]\n    numCPU := runtime.NumCPU()\n    if len(args) &gt; 1 {\n        numCPU, _ = strconv.Atoi(args[0])\n    }\n\n    Transport = &amp;http.Transport{\n        TLSClientConfig: &amp;tls.Config{\n            InsecureSkipVerify: true,\n        },\n        DialContext: (&amp;net.Dialer{\n            //Timeout: time.Duration() * time.Millisecond,\n            KeepAlive: 30 * time.Second,\n        }).DialContext,\n        //ForceAttemptHTTP2:     true,\n        DisableKeepAlives: false,\n        //MaxIdleConns:      0,\n        //IdleConnTimeout:   0,\n        //TLSHandshakeTimeout: time.Duration(300) * time.Millisecond,\n        //ExpectContinueTimeout: 1 * time.Second,\n    }\n\n    Client = &amp;http.Client{\n        // Timeout:   time.Duration(300) * time.Millisecond,\n        Transport: Transport,\n    }\n\n    runtime.GOMAXPROCS(numCPU)\n\n    rand.Seed(time.Now().UTC().UnixNano())\n}\n\nfunc main() {\n\n    router := mux.NewRouter().StrictSlash(true)\n    router.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        _, _ = fmt.Fprintf(w, \"Hello!!!\")\n    })\n\n    router.HandleFunc(\"/{name}\", func(w http.ResponseWriter, r *http.Request) {\n        vars := mux.Vars(r)\n\n        prepareRequest(w, r, vars[\"name\"])\n\n    }).Methods(\"POST\", \"GET\")\n\n    // Register pprof handlers\n    // router.HandleFunc(\"/debug/pprof/\", pprof.Index)\n    // router.HandleFunc(\"/debug/pprof/cmdline\", pprof.Cmdline)\n    // router.HandleFunc(\"/debug/pprof/profile\", pprof.Profile)\n    // router.HandleFunc(\"/debug/pprof/symbol\", pprof.Symbol)\n    // router.HandleFunc(\"/debug/pprof/trace\", pprof.Trace)\n\n    routerMiddleWare := http.TimeoutHandler(router, 500*time.Millisecond, \"Timeout\")\n\n    srv := &amp;http.Server{\n        Addr: \"localhost:8080\",\n        /*ReadTimeout:  500 * time.Millisecond,\n          WriteTimeout: 500 * time.Millisecond,\n          IdleTimeout:  10 * time.Second,*/\n        Handler: routerMiddleWare,\n    }\n\n    log.Fatal(srv.ListenAndServe())\n}\n\nfunc prepareRequest(w http.ResponseWriter, r *http.Request, name string) {\n\n    // go func() {\n    //  make(chan []byte) &lt;- make([]byte, 10024)\n    // }()\n\n    //other part of the code and call to goroutine\n    var urls []string\n    urls = append(urls,\n        \"http://localhost:7000/\",\n        \"http://localhost:7000/\",\n    )\n    results, s, c := callUrls(urls)\n    finalCall(w, results, s, c)\n\n}\n\ntype Response struct {\n    Status int\n    Url    string\n    Body   string\n}\n\nfunc callUrls(urls []string) ([]*Response, []string, []string) {\n    var wg sync.WaitGroup\n    wg.Add(len(urls))\n    ch := make(chan func() (*Response, string, string), len(urls))\n    for _, url := range urls {\n        go func(url string) {\n            //decide if request is valid for client to make http call using country/os\n            isValid := true //assuming url to be called\n            if isValid {\n                //make post call\n                //request body have many more paramter, just sample included.\n                //instead of creating new request, time.Sleep for 300ms doesn't cause any memory leak.\n                req, err := http.NewRequest(\"POST\", url, bytes.NewBuffer([]byte(`{\"body\":\"param\"}`)))\n                if err != nil {\n                    wg.Done()\n                    ch &lt;- func() (*Response, string, string) {\n                        return &amp;Response{Status: 500, Url: url, Body: \"\"}, err.Error(), \"500\"\n                    }\n                    return\n                }\n                req.Header.Set(\"Content-Type\", \"application/json\")\n                req.Header.Set(\"Connection\", \"Keep-Alive\")\n                //req.Close = true\n\n                response, err := Client.Do(req)\n\n                if err != nil {\n                    wg.Done()\n                    ch &lt;- func() (*Response, string, string) {\n                        return &amp;Response{Status: 500, Url: url, Body: \"\"}, err.Error(), \"500\"\n                    }\n                    return\n                }\n\n                defer response.Body.Close()\n                body, _ := ioutil.ReadAll(response.Body)\n                io.Copy(ioutil.Discard, response.Body)\n\n                //Close the body, forced this\n                //Also tried without defer, and only wothout following line\n                response.Body.Close()\n\n                //do something with response body replace a few string etc.\n                //and return\n                wg.Done()\n                ch &lt;- func() (*Response, string, string) {\n                    return &amp;Response{Status: 200, Url: url, Body: string(body)}, \"success\", \"200\"\n                }\n\n            } else {\n                wg.Done()\n                ch &lt;- func() (*Response, string, string) {\n                    return &amp;Response{Status: 500, Url: url, Body: \"\"}, \"invalid\", \"500\"\n                }\n            }\n\n        }(url)\n    }\n    wg.Wait()\n    var (\n        results []*Response\n        msg     []string\n        status  []string\n    )\n    for {\n        r, x, y := (&lt;-ch)()\n        if r != nil {\n\n            results = append(results, r)\n            msg = append(msg, x)\n            status = append(status, y)\n        }\n        if len(results) == len(urls) {\n            return results, msg, status\n        }\n\n    }\n}\n\nfunc finalCall(w http.ResponseWriter, results []*Response, msg []string, status []string) {\n    fmt.Println(\"response\", \"response body\", results, msg, status)\n}\n</code></pre>\n\n<p><strong>k/main.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"net/http\"\n\nfunc main() {\n    y := make([]byte, 100)\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        w.WriteHeader(http.StatusOK)\n        w.Write(y)\n    })\n    http.ListenAndServe(\":7000\", nil)\n}\n</code></pre>\n\n<p>Install additional visualization tool, and use <code>ab</code> to simulate some load, it will do the job for that intuitive demonstration.</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go get -u github.com/divan/expvarmon\ngo run main.go &amp;\ngo run k/main.go &amp;\nab -n 50000 -c 2500 http://localhost:8080/y\n# in a different window, for live preview\nexpvarmon -ports=6060 -i 500ms\n</code></pre>\n\n<p>At that point you read the output of <code>expvarmon</code>, if it was live you have something like</p>\n\n<p><a href=\"https://i.stack.imgur.com/5Buxs.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5Buxs.png\" alt=\"app is loaded\"></a></p>\n\n<p>you can see the stuff waving, the gc is being actively working.</p>\n\n<p>the app is loaded, the memory is being consumed, wait for the server to release its conn and the gc to clean them</p>\n\n<p><a href=\"https://i.stack.imgur.com/hvWjM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hvWjM.png\" alt=\"app is gced\"></a></p>\n\n<p>You can see the <code>memstats.Alloc</code>, <code>memstats.HeapAlloc</code>, <code>memstats.HeapInuse</code> are now reduced, as expected when the gc does his job and that no leak exists.</p>\n\n<p>If you were to check for <code>go tool pprof -inuse_space -web http://localhost:6060/debug/pprof/heap</code>, right after <code>ab</code> ran</p>\n\n<p><a href=\"https://i.stack.imgur.com/GD6ti.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/GD6ti.png\" alt=\"pprof inuse_space\"></a></p>\n\n<p>It shows that the app is using <code>177Mb</code> of memory.</p>\n\n<p>Most of it <code>102Mb</code> is being used by <code>net/http.Transport.getConn</code>.</p>\n\n<p>Your handler is accouting for <code>1Mb</code>, the rest is various things required.</p>\n\n<p>If you were to take the screenshot after the server has released and the gc too, you would see an even smaller graph. not demonstrated here.</p>\n\n<p>Now let us generate a leak and see it using both tools again.</p>\n\n<p>In the code uncomment in,</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nfunc prepareRequest(w http.ResponseWriter, r *http.Request, name string) {\n\n    go func() {\n        make(chan []byte) &lt;- make([]byte, 10024)\n    }()\n//...\n</code></pre>\n\n<p>restart apps (press <code>q</code> in <code>expvarmon</code>, although it is not required)</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go get -u github.com/divan/expvarmon\ngo run main.go &amp;\ngo run k/main.go &amp;\nab -n 50000 -c 2500 http://localhost:8080/y\n# in a different window, for live preview\nexpvarmon -ports=6060 -i 500ms\n</code></pre>\n\n<p>it shows</p>\n\n<p><a href=\"https://i.stack.imgur.com/QBZyx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QBZyx.png\" alt=\"leaky app before gc\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/oOzZC.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/oOzZC.png\" alt=\"leaky app after gc\"></a></p>\n\n<p>In <code>expvarmon</code> you can see the same behavior, only the numbers has changed, and at rest state, after it has been gced, it still consumed a lot of memory, a lot more than a void golang http server to take a comparison point.</p>\n\n<p>Again, screenshot the heap, it shows that your handler is now consuming most of the memory ~<code>450Mb</code>, notice the arrows, it shows that there is for <code>452mb</code> of <code>10kb</code> allocations, and <code>4.50Mb</code> of <code>96b</code>. They respectively correspond to the <code>[]byte</code> slice being pushed to the <code>chan []byte</code>.</p>\n\n<p><a href=\"https://i.stack.imgur.com/22wvG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/22wvG.png\" alt=\"leaky app pprof\"></a></p>\n\n<p>Finally, you can check your stack traces to look for dead goroutines, and thus leaking memory, open <a href=\"http://localhost:6060/debug/pprof/goroutine?debug=1\" rel=\"nofollow noreferrer\">http://localhost:6060/debug/pprof/goroutine?debug=1</a></p>\n\n<pre><code>goroutine profile: total 50012\n\n50000 @ 0x43098f 0x4077fa 0x4077d0 0x4074bb 0x76b85d 0x45d281\n#   0x76b85c    main.prepareRequest.func1+0x4c  /home/mh-cbon/gow/src/test/oom/main.go:101\n\n4 @ 0x43098f 0x42c09a 0x42b686 0x4c3a3b 0x4c484b 0x4c482c 0x57d94f 0x590d79 0x6b4c67 0x5397cf 0x53a51d 0x53a754 0x6419ef 0x6af18d 0x6af17f 0x6b5f33 0x6ba4fd 0x45d281\n#   0x42b685    internal/poll.runtime_pollWait+0x55     /home/mh-cbon/.gvm/gos/go1.12.7/src/runtime/netpoll.go:182\n#   0x4c3a3a    internal/poll.(*pollDesc).wait+0x9a     /home/mh-cbon/.gvm/gos/go1.12.7/src/internal/poll/fd_poll_runtime.go:87\n// more...\n</code></pre>\n\n<p>It tells us that the programs is hosting <code>50 012</code> goroutines, then it lists them grouped by file positions, where the first number is the count of instances running, <code>50 000</code> in the first group of this example. It is followed by the stack trace that lead to the goroutine to exist.</p>\n\n<p>You can see there is a bunch of system thing, that in your case, you should not worry much about it.</p>\n\n<p>You got to look for those that you believe you should not be live if your program was working as you think it should.</p>\n\n<p><strong>However</strong>, overall your code is not satisfying and could be, and probably, should be improved with a thorough review about its allocations and overall design conception.</p>\n\n<p>** This is a summary of the changes applied to the original source code.</p>\n\n<ul>\n<li>It adds a new program <code>k/main.go</code> to act as a backend server.</li>\n<li>It adds <code>_ \"expvar\"</code> import statement</li>\n<li>It starts the std api HTTP server instance that pprof registers onto during <code>init</code> phase with <code>go http.ListenAndServe(\"localhost:6060\", nil)</code></li>\n<li>The client timeout is disabled <code>Timeout:   time.Duration(300) * time.Millisecond,</code>, otherwise the load test does not return 200s</li>\n<li>The server address is set to <code>Addr: \"localhost:8080\",</code></li>\n<li>The <code>urls</code> values created within <code>prepareRequest</code> are set to a static list of len=2</li>\n<li>It adds error checking for <code>req, err := http.NewRequest(\"POST\", url, bytes.NewBuffer([]byte(</code>{\"body\":\"param\"}<code>)))</code></li>\n<li>It disalbles error checking in <code>io.Copy(ioutil.Discard, response.Body)</code></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 73, "user_id": 12517276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/951163384744b61f2b75608198e13910?s=128&d=identicon&r=PG&f=1", "display_name": "user12517276", "link": "https://stackoverflow.com/users/12517276/user12517276"}, "is_accepted": true, "score": 0, "last_activity_date": 1579213795, "creation_date": 1579213795, "answer_id": 59778749, "question_id": 59465996, "link": "https://stackoverflow.com/questions/59465996/go-net-http-leaks-memory-in-high-load/59778749#59778749", "title": "Go net/http leaks memory in high load", "body": "<p>I have solved it by replacing <code>net/http</code> package with <code>fasthttp</code>. Earlier I haven't used it because I was not able find timeout method on fasthttp client but I see that there is indeed a method <code>DoTimeout</code> for fasthttp client which timedout the request after specified duration.</p>\n\n<p>Here the updated code:</p>\n\n<p>in <strong>vars.go</strong> <code>ClientFastHttp *fasthttp.Client</code></p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"./common\"\n    \"crypto/tls\"\n    \"fmt\"\n    \"github.com/gorilla/mux\"\n    \"github.com/valyala/fasthttp\"\n    \"log\"\n    \"math/rand\"\n    \"net\"\n    \"net/http\"\n    \"net/http/pprof\"\n    \"os\"\n    \"runtime\"\n    \"strconv\"\n    \"sync\"\n    \"time\"\n)\n\nfunc init() {\n\n    //Get Any command line argument passed\n    args := os.Args[1:]\n    numCPU := runtime.NumCPU()\n    if len(args) &gt; 1 {\n        numCPU, _ = strconv.Atoi(args[0])\n    }\n\n    common.Transport = &amp;http.Transport{\n        TLSClientConfig: &amp;tls.Config{\n            InsecureSkipVerify: true,\n        },\n        DialContext: (&amp;net.Dialer{\n            //Timeout: time.Duration() * time.Millisecond,\n            KeepAlive: 30 * time.Second,\n        }).DialContext,\n        //ForceAttemptHTTP2:     true,\n        DisableKeepAlives: false,\n        //MaxIdleConns:      0,\n        //IdleConnTimeout:   0,\n        //TLSHandshakeTimeout: time.Duration(300) * time.Millisecond,\n        //ExpectContinueTimeout: 1 * time.Second,\n    }\n\n    common.Client = &amp;http.Client{\n        Timeout:   time.Duration(300) * time.Millisecond,\n        Transport: common.Transport,\n    }\n\n    runtime.GOMAXPROCS(numCPU)\n\n    rand.Seed(time.Now().UTC().UnixNano())\n}\n\nfunc main() {\n\n    router := mux.NewRouter().StrictSlash(true)\n    router.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        _, _ = fmt.Fprintf(w, \"Hello!!!\")\n    })\n\n    router.HandleFunc(\"/{name}\", func(w http.ResponseWriter, r *http.Request) {\n        vars := mux.Vars(r)\n\n        prepareRequest(w, r, vars[\"name\"])\n\n    }).Methods(\"POST\")\n\n    // Register pprof handlers\n    router.HandleFunc(\"/debug/pprof/\", pprof.Index)\n    router.HandleFunc(\"/debug/pprof/cmdline\", pprof.Cmdline)\n    router.HandleFunc(\"/debug/pprof/profile\", pprof.Profile)\n    router.HandleFunc(\"/debug/pprof/symbol\", pprof.Symbol)\n    router.HandleFunc(\"/debug/pprof/trace\", pprof.Trace)\n\n    routerMiddleWare := http.TimeoutHandler(router, 500*time.Millisecond, \"Timeout\")\n\n    srv := &amp;http.Server{\n        Addr: \"0.0.0.0:\" + \"80\",\n        /*ReadTimeout:  500 * time.Millisecond,\n        WriteTimeout: 500 * time.Millisecond,\n        IdleTimeout:  10 * time.Second,*/\n        Handler: routerMiddleWare,\n    }\n\n    log.Fatal(srv.ListenAndServe())\n}\n\nfunc prepareRequest(w http.ResponseWriter, r *http.Request, name string) {\n\n    //other part of the code and call to goroutine\n    var urls []string\n    results, s, c := callUrls(urls)\n    finalCall(w, results, s, c)\n\n}\n\ntype Response struct {\n    Status int\n    Url    string\n    Body   string\n}\n\nfunc callUrls(urls []string) ([]*Response, []string, []string) {\n    var wg sync.WaitGroup\n    wg.Add(len(urls))\n    ch := make(chan func() (*Response, string, string), len(urls))\n    for _, url := range urls {\n        go func(url string) {\n            //decide if request is valid for client to make http call using country/os\n            isValid := true //assuming url to be called\n            if isValid {\n                //make post call\n                //request body have many more paramter, just sample included.\n                //instead of creating new request, time.Sleep for 300ms doesn't cause any memory leak.\n                req := fasthttp.AcquireRequest()\n                req.SetRequestURI(url)\n                req.Header.Set(\"Content-Type\", \"application/json\")\n                req.Header.Set(\"Connection\", \"Keep-Alive\")\n                req.Header.SetMethod(\"POST\")\n                req.SetBody([]byte(`{\"body\":\"param\"}`))\n\n                resp := fasthttp.AcquireResponse()\n\n                defer fasthttp.ReleaseRequest(req)   // &lt;- do not forget to release\n                defer fasthttp.ReleaseResponse(resp) // &lt;- do not forget to release\n\n                //err := clientFastHttp.Do(req, response)\n                //endregion\n                t := time.Duration(300)\n\n                err := common.ClientFastHttp.DoTimeout(req, resp, t*time.Millisecond)\n\n                body := resp.Body()\n\n                if err != nil {\n                    wg.Done()\n                    ch &lt;- func() (*Response, string, string) {\n                        return &amp;Response{Status: 500, Url: url, Body: \"\"}, \"error\", \"500\"\n                    }\n                    return\n                }\n\n                /*defer response.Body.Close()\n                body, _ := ioutil.ReadAll(response.Body)\n                _, err = io.Copy(ioutil.Discard, response.Body)\n\n                //Close the body, forced this\n                //Also tried without defer, and only wothout following line\n                response.Body.Close()*/\n\n                //do something with response body replace a few string etc.\n                //and return\n                wg.Done()\n                ch &lt;- func() (*Response, string, string) {\n                    return &amp;Response{Status: 200, Url: url, Body: string(body)}, \"success\", \"200\"\n                }\n\n            } else {\n                wg.Done()\n                ch &lt;- func() (*Response, string, string) {\n                    return &amp;Response{Status: 500, Url: url, Body: \"\"}, \"invalid\", \"500\"\n                }\n            }\n\n        }(url)\n    }\n    wg.Wait()\n    var (\n        results []*Response\n        msg     []string\n        status  []string\n    )\n    for {\n        r, x, y := (&lt;-ch)()\n        if r != nil {\n\n            results = append(results, r)\n            msg = append(msg, x)\n            status = append(status, y)\n        }\n        if len(results) == len(urls) {\n            return results, msg, status\n        }\n\n    }\n}\n\nfunc finalCall(w http.ResponseWriter, results []*Response, msg []string, status []string) {\n    fmt.Println(\"response\", \"response body\", results, msg, status)\n}\n\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 12517276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/951163384744b61f2b75608198e13910?s=128&d=identicon&r=PG&f=1", "display_name": "user12517276", "link": "https://stackoverflow.com/users/12517276/user12517276"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2515, "favorite_count": 3, "accepted_answer_id": 59778749, "answer_count": 2, "score": 6, "last_activity_date": 1579213795, "creation_date": 1577176345, "last_edit_date": 1577356206, "question_id": 59465996, "link": "https://stackoverflow.com/questions/59465996/go-net-http-leaks-memory-in-high-load", "title": "Go net/http leaks memory in high load", "body": "<p>I am developing an API that calls client URL using the <code>net/http</code> package. There are between 1 and 8 URLs called for each request (POST call) in goroutines concurrently based on user country/os. The app works with low qps of around 1000-1500 requests, but scaling the app to 3k requests there is a sudden increase in the memory even if only 1 client URL is called an app stops responding after a few minute(Response time well above 50sec). I am using Go native <code>net/http</code> package along with <code>gorilla/mux</code> router. Other question on this issue says to close the response body but I have done that using</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>        req, err := http.NewRequest(\"POST\", \"client_post_url\", bytes.NewBuffer(requestBody))\n        req.Header.Set(\"Content-Type\", \"application/json\")\n        req.Header.Set(\"Connection\", \"Keep-Alive\")\n        response, err := common.Client.Do(req)\n        status := 0\n        if err != nil {//handle and return}\n        defer response.Body.Close() //used with/without io.Copy\n        status = response.StatusCode\n        body, _ := ioutil.ReadAll(response.Body)\n        _, err = io.Copy(ioutil.Discard, response.Body)\n</code></pre>\n\n<p>I need to reuse connection hence I have made http client and transport global variable initialized in init method like this. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    common.Transport = &amp;http.Transport{\n        TLSClientConfig: &amp;tls.Config{\n            InsecureSkipVerify: true,\n        },\n        DialContext: (&amp;net.Dialer{\n            //Timeout: time.Duration(300) * time.Millisecond,\n            KeepAlive: 30 * time.Second,\n        }).DialContext,\n        //ForceAttemptHTTP2:     true,\n        DisableKeepAlives: false,\n        //MaxIdleConns:      0,\n        //IdleConnTimeout:   0,\n        //TLSHandshakeTimeout: time.Duration(300) * time.Millisecond,\n        //ExpectContinueTimeout: 1 * time.Second,\n    }\n\n    common.Client = &amp;http.Client{\n        Timeout:   time.Duration(300) * time.Millisecond,\n        Transport: common.Transport,\n    }\n</code></pre>\n\n<p>I have read that using keep alive causes the memory to leak, I have tried a few combination for disabling keep-alive/close request flag on request. But nothing seems to work. Also If I don't make any http call and use <code>time.Sleep(300 * time.Millisecond)</code> in goroutine calling each url concurrently app does work without any leak. \nSo I am sure It has something to do with client/http package that under high load connection are not released or not used properly.</p>\n\n<p>What should be my approach to achieve this?\nIs creating a custom server and custom handler type to accept request and route requests will worked as mentioned in C10K approach in several article?\nI can share the sample code with all details if required. Above just added that the part where I feel the issue lies.</p>\n\n<p>this is a representative code</p>\n\n<p><strong>main.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"./common\"\n    \"bytes\"\n    \"crypto/tls\"\n    \"fmt\"\n    \"github.com/gorilla/mux\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"math/rand\"\n    \"net\"\n    \"net/http\"\n    \"net/http/pprof\"\n    \"os\"\n    \"runtime\"\n    \"strconv\"\n    \"sync\"\n    \"time\"\n)\n\nfunc init() {\n\n    //Get Any command line argument passed\n    args := os.Args[1:]\n    numCPU := runtime.NumCPU()\n    if len(args) &gt; 1 {\n        numCPU, _ = strconv.Atoi(args[0])\n    }\n\n    common.Transport = &amp;http.Transport{\n        TLSClientConfig: &amp;tls.Config{\n            InsecureSkipVerify: true,\n        },\n        DialContext: (&amp;net.Dialer{\n            //Timeout: time.Duration() * time.Millisecond,\n            KeepAlive: 30 * time.Second,\n        }).DialContext,\n        //ForceAttemptHTTP2:     true,\n        DisableKeepAlives: false,\n        //MaxIdleConns:      0,\n        //IdleConnTimeout:   0,\n        //TLSHandshakeTimeout: time.Duration(300) * time.Millisecond,\n        //ExpectContinueTimeout: 1 * time.Second,\n    }\n\n    common.Client = &amp;http.Client{\n        Timeout:   time.Duration(300) * time.Millisecond,\n        Transport: common.Transport,\n    }\n\n    runtime.GOMAXPROCS(numCPU)\n\n    rand.Seed(time.Now().UTC().UnixNano())\n}\n\nfunc main() {\n\n    router := mux.NewRouter().StrictSlash(true)\n    router.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        _, _ = fmt.Fprintf(w, \"Hello!!!\")\n    })\n\n    router.HandleFunc(\"/{name}\", func(w http.ResponseWriter, r *http.Request) {\n        vars := mux.Vars(r)\n\n        prepareRequest(w, r, vars[\"name\"])\n\n    }).Methods(\"POST\")\n\n    // Register pprof handlers\n    router.HandleFunc(\"/debug/pprof/\", pprof.Index)\n    router.HandleFunc(\"/debug/pprof/cmdline\", pprof.Cmdline)\n    router.HandleFunc(\"/debug/pprof/profile\", pprof.Profile)\n    router.HandleFunc(\"/debug/pprof/symbol\", pprof.Symbol)\n    router.HandleFunc(\"/debug/pprof/trace\", pprof.Trace)\n\n    routerMiddleWare := http.TimeoutHandler(router, 500*time.Millisecond, \"Timeout\")\n\n    srv := &amp;http.Server{\n        Addr: \"0.0.0.0:\" + \"80\",\n        /*ReadTimeout:  500 * time.Millisecond,\n        WriteTimeout: 500 * time.Millisecond,\n        IdleTimeout:  10 * time.Second,*/\n        Handler: routerMiddleWare,\n    }\n\n    log.Fatal(srv.ListenAndServe())\n}\n\nfunc prepareRequest(w http.ResponseWriter, r *http.Request, name string) {\n\n    //other part of the code and call to goroutine\n    var urls []string\n    results, s, c := callUrls(urls)\n    finalCall(w, results, s, c)\n\n}\n\ntype Response struct {\n    Status int\n    Url    string\n    Body   string\n}\n\nfunc callUrls(urls []string) ([]*Response, []string, []string) {\n    var wg sync.WaitGroup\n    wg.Add(len(urls))\n    ch := make(chan func() (*Response, string, string), len(urls))\n    for _, url := range urls {\n        go func(url string) {\n            //decide if request is valid for client to make http call using country/os\n            isValid := true //assuming url to be called\n            if isValid {\n                //make post call\n                //request body have many more paramter, just sample included.\n                //instead of creating new request, time.Sleep for 300ms doesn't cause any memory leak.\n                req, err := http.NewRequest(\"POST\", url, bytes.NewBuffer([]byte(`{\"body\":\"param\"}`)))\n                req.Header.Set(\"Content-Type\", \"application/json\")\n                req.Header.Set(\"Connection\", \"Keep-Alive\")\n                //req.Close = true\n\n                response, err := common.Client.Do(req)\n\n                if err != nil {\n                    wg.Done()\n                    ch &lt;- func() (*Response, string, string) {\n                        return &amp;Response{Status: 500, Url: url, Body: \"\"}, \"error\", \"500\"\n                    }\n                    return\n                }\n\n                defer response.Body.Close()\n                body, _ := ioutil.ReadAll(response.Body)\n                _, err = io.Copy(ioutil.Discard, response.Body)\n\n                //Close the body, forced this\n                //Also tried without defer, and only wothout following line\n                response.Body.Close()\n\n                //do something with response body replace a few string etc.\n                //and return\n                wg.Done()\n                ch &lt;- func() (*Response, string, string) {\n                    return &amp;Response{Status: 200, Url: url, Body: string(body)}, \"success\", \"200\"\n                }\n\n            } else {\n                wg.Done()\n                ch &lt;- func() (*Response, string, string) {\n                    return &amp;Response{Status: 500, Url: url, Body: \"\"}, \"invalid\", \"500\"\n                }\n            }\n\n        }(url)\n    }\n    wg.Wait()\n    var (\n        results []*Response\n        msg     []string\n        status  []string\n    )\n    for {\n        r, x, y := (&lt;-ch)()\n        if r != nil {\n\n            results = append(results, r)\n            msg = append(msg, x)\n            status = append(status, y)\n        }\n        if len(results) == len(urls) {\n            return results, msg, status\n        }\n\n    }\n}\n\nfunc finalCall(w http.ResponseWriter, results []*Response, msg []string, status []string){\n    fmt.Println(\"response\", \"response body\", results, msg, status)\n}\n</code></pre>\n\n<p><strong>vars.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package common\nimport (\n    \"net/http\"\n)\n\nvar (\n    //http client\n    Client *http.Client\n\n    //http Transport\n    Transport *http.Transport\n)\n</code></pre>\n\n<p>pprof: Profiled app with 4 client url on average of around 2500qps.</p>\n\n<p><a href=\"https://i.stack.imgur.com/Q0Sae.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Q0Sae.png\" alt=\"enter image description here\"></a></p>\n\n<p>Top command:\n<a href=\"https://i.stack.imgur.com/v6CT8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/v6CT8.png\" alt=\"enter image description here\"></a>\nAfter 2minutes:\n<a href=\"https://i.stack.imgur.com/hUmKJ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hUmKJ.png\" alt=\"enter image description here\"></a></p>\n\n<p>Without calling client url, by keeping <code>isValid = false</code> and <code>time.Sleep(300* time.Millisecond)</code> no leaks happens.\n<a href=\"https://i.stack.imgur.com/AYxaW.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/AYxaW.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1577176330, "post_id": 59465957, "comment_id": 105111687, "body": "Strings in Go are <i>immutable</i> by design, you can&#39;t modify the contents of a string. You can, however, create a new string from other strings."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1577176340, "post_id": 59465957, "comment_id": 105111690, "body": "Are you trying to do some sort of steganography? What do you actually want to achieve? I am asking since I smell a <a href=\"http://xyproblem.info\" rel=\"nofollow noreferrer\">XY problem</a> here. Oh, and welcome to SO!"}, {"owner": {"reputation": 1, "user_id": 12589680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca814ad5629d49d749b29b7351ee6e4?s=128&d=identicon&r=PG&f=1", "display_name": "Enkhbold Munkhbold", "link": "https://stackoverflow.com/users/12589680/enkhbold-munkhbold"}, "edited": false, "score": 0, "creation_date": 1577176430, "post_id": 59465957, "comment_id": 105111716, "body": "i wanted to generate specific tokens for each users connecting to my web. and it doesn&#39;t really have to be a string it can be a []byte don&#39;t really matter, i just want to get a result which i can use to hash"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577176991, "post_id": 59465957, "comment_id": 105111890, "body": "Slices in Go, byte or not, are mutable. You can modify the contents of a slice using index expression with assignment. Can you show what you&#39;ve tried to modify a slice and include the errors you&#39;ve got back, if any?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577177132, "post_id": 59465957, "comment_id": 105111928, "body": "Also take a look at <a href=\"https://github.com/golang/go/wiki/SliceTricks#insert\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/SliceTricks#insert</a>, maybe it has something close to what you&#39;re looking for."}, {"owner": {"reputation": 1, "user_id": 12589680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca814ad5629d49d749b29b7351ee6e4?s=128&d=identicon&r=PG&f=1", "display_name": "Enkhbold Munkhbold", "link": "https://stackoverflow.com/users/12589680/enkhbold-munkhbold"}, "edited": false, "score": 0, "creation_date": 1577177421, "post_id": 59465957, "comment_id": 105112032, "body": "i did &quot;padded[i] = byte(string1[i])&quot; in the //insert into padded&#39;s empty spaces   part and got  &quot;cannot assign to padded[i]&quot; error on the console"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1577177480, "post_id": 59465957, "comment_id": 105112051, "body": "To overwrite parts or all of a slice use <a href=\"https://golang.org/pkg/builtin/#copy\" rel=\"nofollow noreferrer\">copy</a>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577178429, "post_id": 59465957, "comment_id": 105112383, "body": "@EnkhboldMunkhbold as already mentioned <i>strings are immutable</i>, that means you simply cannot do <code>padded[i] = ...</code> if padded is of type <code>string</code>. Change <code>padded</code>&#39;s type to <code>[]byte</code>, then you can do what you&#39;re trying to do."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1577178674, "post_id": 59465957, "comment_id": 105112466, "body": "@EnkhboldMunkhbold <a href=\"https://play.golang.com/p/iawP2LYj9I-\" rel=\"nofollow noreferrer\">play.golang.com/p/iawP2LYj9I-</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 12589680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca814ad5629d49d749b29b7351ee6e4?s=128&d=identicon&r=PG&f=1", "display_name": "Enkhbold Munkhbold", "link": "https://stackoverflow.com/users/12589680/enkhbold-munkhbold"}, "is_accepted": false, "score": 0, "last_activity_date": 1577179546, "creation_date": 1577179546, "answer_id": 59466570, "question_id": 59465957, "link": "https://stackoverflow.com/questions/59465957/is-it-possible-to-embed-some-value-onto-another-string-in-go/59466570#59466570", "title": "Is it possible to embed some value onto another string in Go?", "body": "<p>this works:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    //declarations\n    user_id := \"1\"\n    given_id := \"1\"\n    ip_address := \"192.168.1.1\"\n\n    pad1 := fmt.Sprintf(\"%-8s\", user_id)\n    pad2 := fmt.Sprintf(\"%-8s\", given_id)\n    pad3 := fmt.Sprintf(\"%-16s\", ip_address)\n\n    mak := string(pad1 + pad2 + pad3)\n    bytemak := []byte(mak)\n\n    token := []byte(\"32characterstringgives128bitlong\")\n\n    for i := range token {\n        if mak[i] == 32 {\n            bytemak[i] = byte(token[i])\n        }\n    }\n    fmt.Println(string(bytemak))\n}\n</code></pre>\n\n<p>result:\n<code>12charac1erstrin192.168.1.1tlong</code></p>\n"}], "owner": {"reputation": 1, "user_id": 12589680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca814ad5629d49d749b29b7351ee6e4?s=128&d=identicon&r=PG&f=1", "display_name": "Enkhbold Munkhbold", "link": "https://stackoverflow.com/users/12589680/enkhbold-munkhbold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1577179546, "creation_date": 1577176105, "last_edit_date": 1577177980, "question_id": 59465957, "link": "https://stackoverflow.com/questions/59465957/is-it-possible-to-embed-some-value-onto-another-string-in-go", "title": "Is it possible to embed some value onto another string in Go?", "body": "<p>Is it possible to embed some value inside a string? or copy some part of a string onto another in Go?\nsomething like this: </p>\n\n<p>Given these:</p>\n\n<pre><code>user_id := \"100\"\ngiven_id := \"12\"\nip_address := \"192.168.1.1\"\n</code></pre>\n\n<p>i put inside     <code>string1 := \"32characterstringgives128bitlong\"</code></p>\n\n<p>and get something like this:</p>\n\n<pre><code>newString := \"100harac12rstrin192.168.1.1tlong\"\n</code></pre>\n\n<p>I want to clarify, I don't want to check or see if the string is contained in the other string. I want to insert some values or string into a specific part of another string. </p>\n\n<p>So far i tried <code>copy()</code>and dividing into <code>[]byte</code> array to change the individual characters</p>\n\n<pre><code>pad1 := fmt.Sprintf(\"%-8\", user_id)\npad2 := fmt.Sprintf(\"%-8\", given_id)\npad3 := fmt.Sprintf(\"%-16\", ip_address)\n\npadded := string(pad1 + pad2 + pad3)\n</code></pre>\n\n<p>to get:<code>\"1       1       192.168.1.1     \"</code> \nwhich is 32 byte long and i would then add in the corresponding string value in the spaces like so:</p>\n\n<pre><code>for i := range string1 {\n    if padded[i] == 32 {\n        padded[i] = byte(string1[i]) //insert into padded's empty spaces\n    }\n}\n</code></pre>\n\n<p>the IDs and IP addresses could be longer or shorter than my example. so IDs could be like\nid#1 = 1 and id#50 = 1001 and ip addresses could be like \n192.168.1.1 or 192.168.100.110 so i cant just append them together. That is why wanted to know if there was a way to change out specific parts of a string with other stuff</p>\n"}, {"tags": ["go", "gophish"], "answers": [{"tags": [], "owner": {"reputation": 27, "user_id": 5404964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3878f3338587a4d47d58ff4e5c7d55ee?s=128&d=identicon&r=PG&f=1", "display_name": "3aSsoMa", "link": "https://stackoverflow.com/users/5404964/3assoma"}, "is_accepted": false, "score": 0, "last_activity_date": 1577200000, "creation_date": 1577200000, "answer_id": 59470600, "question_id": 59465706, "link": "https://stackoverflow.com/questions/59465706/problem-creating-a-new-route-in-gohpish-tool/59470600#59470600", "title": "Problem creating a new route in Gohpish tool", "body": "<p>The problem was in the import package, it has some errors</p>\n\n<p>make sure they are all working perfectly </p>\n"}], "owner": {"reputation": 27, "user_id": 5404964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3878f3338587a4d47d58ff4e5c7d55ee?s=128&d=identicon&r=PG&f=1", "display_name": "3aSsoMa", "link": "https://stackoverflow.com/users/5404964/3assoma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 26, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577200000, "creation_date": 1577174735, "last_edit_date": 1577175159, "question_id": 59465706, "link": "https://stackoverflow.com/questions/59465706/problem-creating-a-new-route-in-gohpish-tool", "title": "Problem creating a new route in Gohpish tool", "body": "<p>To whomever familiar with this tool <a href=\"https://github.com/gophish/gophish\" rel=\"nofollow noreferrer\">Gophish</a>, I'm trying to create a new route, to add a new feature.</p>\n\n<p>The proccess to do so as i noticed from reading the code, u have to add a list item to <code>[nav.html][1]</code>:</p>\n\n<pre><code>&lt;li&gt;\n     &lt;a href=\"/newItem\"&gt;newItem&lt;/a&gt;\n&lt;/li&gt;\n</code></pre>\n\n<p>Then create your html page and put it in the <a href=\"https://github.com/gophish/gophish/tree/master/templates\" rel=\"nofollow noreferrer\">templates</a> folder\nThen edit <code>[route.go][1]</code> file with the following:</p>\n\n<ul>\n<li>Edit <code>registerRoutes</code> function to add this line \n<code>router.HandleFunc(\"/newItem\", mid.Use(as.newItem, mid.RequireLogin))</code>\nthen create <code>newItem</code> function</li>\n</ul>\n\n<pre><code>func (as *AdminServer) SmiShing(w http.ResponseWriter, r *http.Request) {\n    params := newTemplateParams(r)\n    params.Title = \"NewItem\"\n    getTemplate(w, \"newItem\").ExecuteTemplate(w, \"base\", params)\n}\n</code></pre>\n\n<p>And this should be it. But it seems like i'm missing something</p>\n\n<p>Also when i try to delete one of the exciting routes in <code>router.HandleFunc</code> nothing changes and the route still exists when a run the tool.</p>\n\n<p>So, does it have something to do with databases, or what is it that i'm missing?</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 98, "user_id": 10993848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hEwPt.jpg?s=128&g=1", "display_name": "Shivang Goswami", "link": "https://stackoverflow.com/users/10993848/shivang-goswami"}, "is_accepted": false, "score": 3, "last_activity_date": 1577173808, "creation_date": 1577173808, "answer_id": 59465560, "question_id": 59464147, "link": "https://stackoverflow.com/questions/59464147/passing-c-structures-from-main-golang-code-to-function-in-a-different-golang-pac/59465560#59465560", "title": "Passing C structures from main golang code to function in a different golang package", "body": "<p>According to go docs <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">https://golang.org/cmd/cgo/</a>,</p>\n\n<blockquote>\n  <p>\"Cgo translates C types into equivalent unexported Go types. Because the translations are unexported, a Go package should not expose C types in its exported API: a C type used in one Go package is different from the same C type used in another.\"</p>\n</blockquote>\n\n<p>A github issue regarding this can be found here:\n<a href=\"https://github.com/golang/go/issues/13467\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/13467</a></p>\n\n<p><strong>As of now,it is advised,not to expose C types in an exported API</strong></p>\n"}], "owner": {"reputation": 11, "user_id": 12588682, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DsQpgxPelGA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcvxvT9NIh6Tlg1beNWCUFTZtseSA/photo.jpg?sz=128", "display_name": "Pushpendra Sinha", "link": "https://stackoverflow.com/users/12588682/pushpendra-sinha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1577173808, "creation_date": 1577164890, "question_id": 59464147, "link": "https://stackoverflow.com/questions/59464147/passing-c-structures-from-main-golang-code-to-function-in-a-different-golang-pac", "title": "Passing C structures from main golang code to function in a different golang package", "body": "<p>I am trying to pass C structure from the main golang code to different package and getting the typecast error. </p>\n\n<h2>Code snippet</h2>\n\n<p>C header file test.h</p>\n\n<pre><code>#include&lt;stdio.h&gt;\nstruct err_struct {\n        int   errnum;\n};\n</code></pre>\n\n<p>Golang package test</p>\n\n<pre><code>package test\n//#include&lt;test.h&gt;\nimport \"C\"\nfunc ConvertCtoGoError(err_struct *C.struct_err_struct) {\n   //some code\n}\n</code></pre>\n\n<p>golang main code</p>\n\n<pre><code>package main\nimport (\n        \"./lib\"\n        \"fmt\"\n       )   \n/*\n#include\"lib/test.h\"\n\nstruct err_struct initialize_structure() \n{\n    struct err_struct err;\n    err.errnum = 102;\n    return err;\n\n}\n */\nimport \"C\" \nfunc main() {\n    go_struct:= C.initialize_structure()\n    new_struct:= test.ConvertCtoGoError(&amp;go_struct)\n\n}  \n</code></pre>\n\n<p>While compiling the main code I am getting the following error:\ncannot convert &amp;go_struct (type *_Ctype_struct_err_struct) to type *test._Ctype_struct_err_struct</p>\n\n<p>When I try to typecast the variable it is giving the following error :\n cannot refer to unexported name test._Ctype_struct_dd_err_struct\n cannot convert &amp;go_struct (type *_Ctype_struct_err_struct) to type *test._Ctype_struct_err_struct</p>\n\n<p>Please help me in solving this</p>\n"}, {"tags": ["multithreading", "go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 7441922, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-zlRWOJV9Txc/AAAAAAAAAAI/AAAAAAAAAQo/4kx1cM0Wkok/photo.jpg?sz=128", "display_name": "Stairdeck", "link": "https://stackoverflow.com/users/7441922/stairdeck"}, "edited": false, "score": 1, "creation_date": 1577191327, "post_id": 59463985, "comment_id": 105117075, "body": "I need output from all threads at same time, and even test var is not updated. Output like 3 lines of Iteration num: 0, one line per thread in my example"}, {"owner": {"reputation": 96, "user_id": 11670343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VrFDk.png?s=128&g=1", "display_name": "Roshan Patil", "link": "https://stackoverflow.com/users/11670343/roshan-patil"}, "reply_to_user": {"reputation": 61, "user_id": 7441922, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-zlRWOJV9Txc/AAAAAAAAAAI/AAAAAAAAAQo/4kx1cM0Wkok/photo.jpg?sz=128", "display_name": "Stairdeck", "link": "https://stackoverflow.com/users/7441922/stairdeck"}, "edited": false, "score": 0, "creation_date": 1577294812, "post_id": 59463985, "comment_id": 105137799, "body": "I have updated my answer as per your requirement. For every single send on the test channel will be received by all listening threads. Hopefully, this solves your problem."}], "tags": [], "owner": {"reputation": 96, "user_id": 11670343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VrFDk.png?s=128&g=1", "display_name": "Roshan Patil", "link": "https://stackoverflow.com/users/11670343/roshan-patil"}, "is_accepted": false, "score": 2, "last_activity_date": 1577294891, "last_edit_date": 1577294891, "creation_date": 1577163295, "answer_id": 59463985, "question_id": 59463846, "link": "https://stackoverflow.com/questions/59463846/how-to-read-channel-without-waiting-setting-in-another-goroutine/59463985#59463985", "title": "How to read channel without waiting setting in another goroutine?", "body": "<p>A demon is created which push all the messages from test channel to all other listening routines.</p>\n\n<pre><code>var test = make(chan string)\n\nvar mapChan = make(map[int]chan string)\nvar count = 3\n\nfunc main() {\n    go initChan()\n    go deamon()\n    for i := 0; i &lt; count; i++ {\n        mapChan[i] = make(chan string)\n        go readChan(i)\n    }\n\n    var input string\n    fmt.Scanln(&amp;input)\n}\n\nfunc deamon() {\n    for {\n        message := &lt;-test\n        for i := 0; i &lt; count; i++ {\n            mapChan[i] &lt;- message\n        }\n    }\n}\n\nfunc initChan() {\n    for i := 0; i &lt; 100; i++ {\n        test &lt;- \"Iteration num: \" + strconv.Itoa(i)\n        time.Sleep(time.Second * 1)\n    }\n}\n\nfunc readChan(i int) {\n    for {\n        select {\n\n        case message := &lt;-mapChan[i]:\n            log.Println(message)\n        default:\n            // Do for not when written on channel\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2105, "user_id": 5821408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f6ca899d084f02ac63e71e9e8711046?s=128&d=identicon&r=PG&f=1", "display_name": "shmsr", "link": "https://stackoverflow.com/users/5821408/shmsr"}, "edited": false, "score": 0, "creation_date": 1577167391, "post_id": 59464293, "comment_id": 105109216, "body": "@Stairdeck If I refer your question, then my solution fits fine. Channel is read and it&#39;s processed (eg. Printing to stdout) whereas the other goroutine responsible for sending to channel isn&#39;t blocked."}, {"owner": {"reputation": 61, "user_id": 7441922, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-zlRWOJV9Txc/AAAAAAAAAAI/AAAAAAAAAQo/4kx1cM0Wkok/photo.jpg?sz=128", "display_name": "Stairdeck", "link": "https://stackoverflow.com/users/7441922/stairdeck"}, "edited": false, "score": 0, "creation_date": 1577192293, "post_id": 59464293, "comment_id": 105117420, "body": "No, I need output from all threads at same time, and even test var is not updated. Output like 3 lines of Iteration num: 0, one line per thread in my example."}, {"owner": {"reputation": 2105, "user_id": 5821408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f6ca899d084f02ac63e71e9e8711046?s=128&d=identicon&r=PG&f=1", "display_name": "shmsr", "link": "https://stackoverflow.com/users/5821408/shmsr"}, "reply_to_user": {"reputation": 61, "user_id": 7441922, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-zlRWOJV9Txc/AAAAAAAAAAI/AAAAAAAAAQo/4kx1cM0Wkok/photo.jpg?sz=128", "display_name": "Stairdeck", "link": "https://stackoverflow.com/users/7441922/stairdeck"}, "edited": false, "score": 0, "creation_date": 1577205122, "post_id": 59464293, "comment_id": 105121329, "body": "You can build this check the output. I&#39;ve edited the answer, I think this solves your question. @Stairdeck"}], "tags": [], "owner": {"reputation": 2105, "user_id": 5821408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f6ca899d084f02ac63e71e9e8711046?s=128&d=identicon&r=PG&f=1", "display_name": "shmsr", "link": "https://stackoverflow.com/users/5821408/shmsr"}, "is_accepted": false, "score": 0, "last_activity_date": 1577205087, "last_edit_date": 1577205087, "creation_date": 1577166004, "answer_id": 59464293, "question_id": 59463846, "link": "https://stackoverflow.com/questions/59463846/how-to-read-channel-without-waiting-setting-in-another-goroutine/59464293#59464293", "title": "How to read channel without waiting setting in another goroutine?", "body": "<p>If I correctly understand your question, this solution might help. I used one buffered channel of size 1 so that goroutine which is the sender is never blocked which is in the case of unbuffered channels. You can read more about channels: <a href=\"https://www.ardanlabs.com/blog/2017/10/the-behavior-of-channels.html\" rel=\"nofollow noreferrer\">Behaviour of channles</a></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"strconv\"\n    \"sync\"\n    \"time\"\n)\n\n// Buffered channel with size 1 guarantees delayed delivery of data\n// As soon as the goroutine sends to the channel, the reciever goroutine dequeus it\n// Then the reciver goroutines does the work, but the sender goroutine isn't blocked\n// As the size is again 0 after the reciever recieved it but might haven't processed it yet\nvar test = make(chan string, 1)\n\nfunc main() {\n    var wg sync.WaitGroup\n    wg.Add(2)\n    // Waits for other goroutines to complete before the main goroutine returns\n    defer wg.Wait()\n    go initChan(&amp;wg)\n    go readChan(&amp;wg)\n}\n\nfunc initChan(wg *sync.WaitGroup) {\n    defer wg.Done()\n    for i := 0; i &lt; 100; i++ {\n        // Sends continuously\n        test &lt;- \"Iteration num: \" + strconv.Itoa(i)\n        time.Sleep(time.Second * 5)\n    }\n    close(test)\n}\n\nfunc readChan(wg *sync.WaitGroup) {\n    defer wg.Done()\n    var message string\n    var ok bool\n    // Reciever deques the value as soon as it recieves it\n    // But might take time to proceed\n    for {\n        select {\n        case message, ok = &lt;-test:\n            // If channel is closed\n            if ok == false {\n                return\n            }\n            log.Println(message)\n        default:\n            log.Println(message)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 7441922, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-zlRWOJV9Txc/AAAAAAAAAAI/AAAAAAAAAQo/4kx1cM0Wkok/photo.jpg?sz=128", "display_name": "Stairdeck", "link": "https://stackoverflow.com/users/7441922/stairdeck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1584813899, "creation_date": 1577161937, "question_id": 59463846, "link": "https://stackoverflow.com/questions/59463846/how-to-read-channel-without-waiting-setting-in-another-goroutine", "title": "How to read channel without waiting setting in another goroutine?", "body": "<p>I have a problem with channel using in goroutine.</p>\n\n<pre><code>var test = make(chan string)\n\nfunc main() {\n    go initChan()\n\n    for i := 0; i &lt; 2; i++ {\n        go readChan()\n    }\n\n    var input string\n    fmt.Scanln(&amp;input)\n}\n\nfunc initChan() {\n    for i := 0; i &lt; 100; i++ {\n        test &lt;- \"Iteration num: \" + strconv.Itoa(i)\n        time.Sleep(time.Second * 5)\n    }\n}\n\nfunc readChan() {\n    for {\n        message := &lt;- test\n        log.Println(message)\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>2019/12/24 08:21:17 Iteration num: 0\n2019/12/24 08:21:22 Iteration num: 1\n2019/12/24 08:21:27 Iteration num: 2\n2019/12/24 08:21:32 Iteration num: 3\n2019/12/24 08:21:37 Iteration num: 4\n2019/12/24 08:21:42 Iteration num: 5\n................................\n</code></pre>\n\n<p>I need threads reading without waiting for update of test var.\nNow every readChan() is waiting for initChan() to update test var.</p>\n\n<p>Is it to possible to make readChan() threads work in one time without waiting initChan() for every thread?</p>\n"}, {"tags": ["mysql", "database", "postgresql", "go", "web-applications"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1577167356, "post_id": 59463335, "comment_id": 105109205, "body": "<a href=\"https://golang.org/pkg/database/sql/#Open\" rel=\"nofollow noreferrer\">golang.org/pkg/database/sql/#Open</a> <i>&quot;The returned DB is safe for concurrent use by multiple goroutines and maintains its own pool of idle connections. Thus, the Open function should be called just once. It is rarely necessary to close a DB. &quot;</i>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577178441, "post_id": 59463335, "comment_id": 105112385, "body": "You should absolutely <i>not</i> open and close each time. Whether you have a single connection or not is more an application question. Some applications need multiple connections (i.e. to different databases, or with different credentials)"}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 12389279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3100c67eb7442b536eb25e356e98af58?s=128&d=identicon&r=PG&f=1", "display_name": "Totto", "link": "https://stackoverflow.com/users/12389279/totto"}, "edited": false, "score": 0, "creation_date": 1577159331, "post_id": 59463527, "comment_id": 105107766, "body": "how to use connection pool?"}], "tags": [], "owner": {"reputation": 71, "user_id": 9966157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EDT6X.jpg?s=128&g=1", "display_name": "Kippa", "link": "https://stackoverflow.com/users/9966157/kippa"}, "is_accepted": false, "score": 0, "last_activity_date": 1577158307, "creation_date": 1577158307, "answer_id": 59463527, "question_id": 59463335, "link": "https://stackoverflow.com/questions/59463335/should-i-always-have-1-global-database-connection-open-in-a-go-web-app-or-shoul/59463527#59463527", "title": "Should I always have 1 global database connection open in a Go web app? Or should I open and close it each time?", "body": "<p>You should use a sql connection pool to manage your connections. Golang database/sql package provide a mechanism for managing connection pool. Configuring your maxIdle param in database/sql package, so you can manage your free connection pool for the purpose of reusing when new connecting request is coming. The connection pool will open a new connection automatically when there is no free connection in the pool.</p>\n"}, {"tags": [], "owner": {"reputation": 96, "user_id": 11670343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VrFDk.png?s=128&g=1", "display_name": "Roshan Patil", "link": "https://stackoverflow.com/users/11670343/roshan-patil"}, "is_accepted": false, "score": 0, "last_activity_date": 1577162661, "creation_date": 1577162661, "answer_id": 59463933, "question_id": 59463335, "link": "https://stackoverflow.com/questions/59463335/should-i-always-have-1-global-database-connection-open-in-a-go-web-app-or-shoul/59463933#59463933", "title": "Should I always have 1 global database connection open in a Go web app? Or should I open and close it each time?", "body": "<p>You should create a global connection object per app. This connection object is configured with connection pooling. Every connection object holds a certain number of connections as per configuration is given.</p>\n\n<p>If you create and delete this for every request it will create and destroy the connection pool for every request.</p>\n\n<p>Just create a global object of connection with required configurations using Singleton Pattern and it will internally manage connection pooling for you.</p>\n\n<p>Also, handle the graceful shutdown of your app. When you get a signal for app termination action make sure you close the global connection object properly. Like this:- </p>\n\n<pre><code>    shutdown := make(chan os.Signal, 1)\n    signal.Notify(shutdown, syscall.SIGINT, syscall.SIGTERM, syscall.SIGKILL)\n    &lt;-shutdown\n    connection.Close()\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 12389279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3100c67eb7442b536eb25e356e98af58?s=128&d=identicon&r=PG&f=1", "display_name": "Totto", "link": "https://stackoverflow.com/users/12389279/totto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 246, "favorite_count": 0, "closed_date": 1577178205, "answer_count": 2, "score": 0, "last_activity_date": 1577162661, "creation_date": 1577156256, "question_id": 59463335, "link": "https://stackoverflow.com/questions/59463335/should-i-always-have-1-global-database-connection-open-in-a-go-web-app-or-shoul", "closed_reason": "Duplicate", "title": "Should I always have 1 global database connection open in a Go web app? Or should I open and close it each time?", "body": "<p>A <strong>web</strong> application in Go. Let's say it's a blog. Say there're 1000 sessions a day. </p>\n\n<p>Should I create a global database connection and have it active all the time? Or should I open and close it each time there's a need to query a database? What's a general rule?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 937, "user_id": 9865393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a15ecf4e958739db800a19140aabe80e?s=128&d=identicon&r=PG&f=1", "display_name": "Luiz Ferraz", "link": "https://stackoverflow.com/users/9865393/luiz-ferraz"}, "edited": false, "score": 1, "creation_date": 1577149205, "post_id": 59462691, "comment_id": 105106307, "body": "How unnecessarily complex... The reason the index is not matching is that even though you are creating the goroutines in the same order and guarding against concurrency you have <code>MAX</code> (9000) goroutines waiting, and you don&#39;t control the order that they resume, the index is representing the order of execution, not creation"}, {"owner": {"reputation": 937, "user_id": 9865393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a15ecf4e958739db800a19140aabe80e?s=128&d=identicon&r=PG&f=1", "display_name": "Luiz Ferraz", "link": "https://stackoverflow.com/users/9865393/luiz-ferraz"}, "edited": false, "score": 2, "creation_date": 1577149290, "post_id": 59462691, "comment_id": 105106318, "body": "By the way, you code is fully sequential, just not deterministic."}, {"owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "reply_to_user": {"reputation": 937, "user_id": 9865393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a15ecf4e958739db800a19140aabe80e?s=128&d=identicon&r=PG&f=1", "display_name": "Luiz Ferraz", "link": "https://stackoverflow.com/users/9865393/luiz-ferraz"}, "edited": false, "score": 0, "creation_date": 1577149566, "post_id": 59462691, "comment_id": 105106354, "body": "unless i keep <code>MAX = 1</code>, I observe what I reported above - this defeats having go-routines prep and populate my <code>map</code>. I do need to process the lines before they are loaded into the map,  using go-routines speeds up my dictionary creation, and this is an important requirement for the real problem."}, {"owner": {"reputation": 937, "user_id": 9865393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a15ecf4e958739db800a19140aabe80e?s=128&d=identicon&r=PG&f=1", "display_name": "Luiz Ferraz", "link": "https://stackoverflow.com/users/9865393/luiz-ferraz"}, "edited": false, "score": 0, "creation_date": 1577149860, "post_id": 59462691, "comment_id": 105106403, "body": "Add the access to the map in a single goroutine and the others just prep the data (i suppose there is some data manipulation, because if is just a passthrough like the example goroutines will actually make it slower with the overhead). I will an example as an answer"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577152522, "post_id": 59462691, "comment_id": 105106802, "body": "As I said in my answer, your semaphore <code>sem</code> doesn&#39;t work because you made it deeply buffered. When you set <code>MAX = 1</code> you make it one entry deep and then it works: it forces each of your spun-off goroutines to wait until the previous one finishes before it can start."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1577180410, "post_id": 59462691, "comment_id": 105113104, "body": "the concurrent code is plain wrong, run it with the <code>-race</code> flag...."}], "answers": [{"comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1577182230, "post_id": 59462846, "comment_id": 105113801, "body": "@mh-cbon: I&#39;m not sure myself but I think the OP didn&#39;t like the very short description of why <code>sem</code> wasn&#39;t serializing the counter."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 0, "last_activity_date": 1577150984, "last_edit_date": 1577150984, "creation_date": 1577150369, "answer_id": 59462846, "question_id": 59462691, "link": "https://stackoverflow.com/questions/59462691/load-a-map-with-and-without-go-routines/59462846#59462846", "title": "Load a map with and without go-routines", "body": "<p>Your semaphore <code>sem</code> is not working because you made it deeply buffered.</p>\n\n<p>In general, this is the wrong way to set up a map for this kind of task, because reading the file will be the slow part.  If you have a more complex task\u2014e.g., read a line, think a lot about it, set up something\u2014you'll want this as your pseudocode structure:</p>\n\n<pre><code>type workType struct {\n    index int\n    line  string\n}\n\nvar wg sync.WaitGroup\nwg.Add(nWorkers)\n// I made this buffered originally but there's no real point, so\n// fixing that in an edit\nwork := make(chan workType)\nfor i := 0; i &lt; nWorkers; i++ {\n    go readAndDoWork(work, &amp;wg)\n}\n\nfor i := 1; fscanner.Scan(); i++ {\n    work &lt;- workType{index: i, line: fscanner.Text()}\n}\nclose(work)\nwg.Wait()\n\n... now your dictionary is ready ...\n</code></pre>\n\n<p>with the workers doing this:</p>\n\n<pre><code>func readAndDoWork(ch chan workType, wg *sync.WorkGroup) {\n    for item := range ch {\n        ... do computation ...\n        insertIntoDict(item.index, result)\n    }\n    wg.Done()\n}\n</code></pre>\n\n<p>with <code>insertIntoDict</code> grabbing the mutex (to protect the map from index to result) and writing into the dictionary.  (You can just inline this if you prefer.)</p>\n\n<p>The idea here is to set up some number of workers\u2014probably based on the number of CPUs available\u2014each of which grabs the next work item and handles it.  The main goroutine just parcels out work, then closes the work channel\u2014this will cause all the workers to see end of input\u2014and then waits for them to signal that they're done computing.</p>\n\n<p>(If you like, you can create one more goroutine that reads worker-computed results and puts them into the map.  That way you don't need a mutex for the map itself.)</p>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1577180579, "post_id": 59462868, "comment_id": 105113182, "body": "in the last go func, simply range over the channel, the loop will exit as soon as the channel is closed."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1577180850, "post_id": 59462868, "comment_id": 105113286, "body": "the wait conditions are incorrect. you should not be waiting over the input processing, but rather than over the output processing. <code>defer close(out)</code> should happen when <code>wg.Wait</code> releases. the range over out can be inlined into main, and if you are only printing results, there is no need in saving to memory upfront. This code is doing a lots of wg.Add/wg.Done, this is inefficient. declaring workers upfront helps in mitigating contentions."}], "tags": [], "owner": {"reputation": 937, "user_id": 9865393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a15ecf4e958739db800a19140aabe80e?s=128&d=identicon&r=PG&f=1", "display_name": "Luiz Ferraz", "link": "https://stackoverflow.com/users/9865393/luiz-ferraz"}, "is_accepted": false, "score": -1, "last_activity_date": 1577150678, "creation_date": 1577150678, "answer_id": 59462868, "question_id": 59462691, "link": "https://stackoverflow.com/questions/59462691/load-a-map-with-and-without-go-routines/59462868#59462868", "title": "Load a map with and without go-routines", "body": "<p>As I mentioned in the comments, you cannot control the order the goroutines are executed, so the index should not be changed from inside of them.</p>\n\n<p>Here is a example where the interaction with the map is in a single goroutine and your processing in the others:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"sync\"\n)\n\nvar (\n    fileName = \"some.dat\"\n    MAX      = 9000\n)\n\nfunc checkerr(err error) {\n    if err != nil {\n        fmt.Println(err)\n        log.Fatal(err)\n    }\n}\n\ntype result struct {\n    index int\n    data string\n}\n\nfunc main() {\n    ourDict := make(map[int]string)\n    f, err := os.Open(fileName)\n    checkerr(err)\n    defer f.Close()\n\n    fscanner := bufio.NewScanner(f)\n\n    var wg sync.WaitGroup\n    sem := make(chan struct{}, MAX) // Use empty structs for semaphores as they have no allocation\n    defer close(sem)\n    out := make(chan result)\n    defer close(out)\n    indexPos := 1\n\n    for fscanner.Scan() {\n        text := fscanner.Text()\n        wg.Add(1)\n        sem &lt;- struct{}{}\n\n        go func(index int, data string) {\n            // Defer the release of your resources, otherwise if any error occur in your goroutine\n            // you'll have a deadlock\n            defer func() {\n                wg.Done()\n                &lt;-sem\n            }()\n            // Process your data\n            out &lt;- result{index, data}\n        }(indexPos, text) // Pass in the data that will change on the iteration, go optimizer will move it around better\n\n        indexPos++\n    }\n\n    // The goroutine is the only one to write to the dict, so no race condition\n    go func() {\n        for {\n            if entry, ok := &lt;-out; ok {\n                ourDict[entry.index] = entry.data\n            } else {\n                return // Exit goroutine when channel closes\n            }\n        }\n    }()\n\n    wg.Wait()\n\n    for i, v := range ourDict {\n        fmt.Printf(\"%d: %s\\n\", i, v)\n    }\n\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577152559, "post_id": 59463029, "comment_id": 105106808, "body": "Passing the index will help, yes, because you used to protect it with the mutex (for the duration of the use-and-increment only, meaning, other goroutines incremented it before yours) but now you have a per-goroutine index. But what do you think the variable <code>sem</code> is doing for you?"}, {"owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577153277, "post_id": 59463029, "comment_id": 105106896, "body": "sem is to limit concurrency to MAX goroutines. <a href=\"https://stackoverflow.com/a/25306439/9488865\">stackoverflow.com/a/25306439/9488865</a>"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577160184, "post_id": 59463029, "comment_id": 105107872, "body": "Right - so when you have it set to 9000, you spin off up to 9000 parallel goroutines. That&#39;s not really productive: the number of CPUs you have available is going to limit the amount of real work you can do. When you set it to 1, you limit yourself to 1 goroutine, and then the fact that <code>indexPos</code> itself is shared between <i>all</i> the goroutines, there&#39;s only 1 gorouting using it. With the updated code, you make a copy of <code>indexPos</code> in each goroutine."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1577160300, "post_id": 59463029, "comment_id": 105107888, "body": "Note that there is a cost (smallish) to creating a new goroutine, and a cost (smallish) to sending and receiving on a channel. It&#39;s generally better to spin up your n-cpus-available workers once, then feed each one work over a channel, than it is to spin up a one-time worker for each job, then make it speak over a semaphore channel to limit how many can actually run at a time."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1577180930, "post_id": 59463029, "comment_id": 105113318, "body": "refer to torek answer, it will give you better results than this hard and complex code."}], "tags": [], "owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "is_accepted": false, "score": -1, "last_activity_date": 1577179548, "last_edit_date": 1577179548, "creation_date": 1577152511, "answer_id": 59463029, "question_id": 59462691, "link": "https://stackoverflow.com/questions/59462691/load-a-map-with-and-without-go-routines/59463029#59463029", "title": "Load a map with and without go-routines", "body": "<p>Ok I've figured this out. Giving the goroutine a value by copy to hang on to, seems to work. </p>\n\n<p>Changed:</p>\n\n<pre><code>for fscanner.Scan() {\n    text := fscanner.Text()\n    wg.Add(1)\n    sem &lt;- 1\n    go func() {\n        mu.Lock()\n        defer mu.Unlock()\n        ourDict[indexPos] = text\n        indexPos++\n        &lt;- sem\n        wg.Done()\n    }()\n\n}\n</code></pre>\n\n<p>to </p>\n\n<pre><code>for fscanner.Scan() {\n        text := fscanner.Text()\n        wg.Add(1)\n        sem &lt;- 1\n        go func(mypos int) {\n                mu.Lock()\n                defer mu.Unlock()\n                ourDict[mypos] = text\n                &lt;-sem\n                wg.Done()\n        }(indexPos)\n        indexPos++\n}\n</code></pre>\n\n<p>Full code: <a href=\"https://play.golang.org/p/dkHaisPHyHz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/dkHaisPHyHz</a></p>\n\n<p>Using a pool of workers, </p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"sync\"\n)\n\nconst (\n    MAX      = 10\n    fileName = \"some.dat\"\n)\n\ntype gunk struct {\n    line string\n    id   int\n}\n\nfunc main() {\n    ourDict := make(map[int]string)\n    wg := sync.WaitGroup{}\n    mu := sync.RWMutex{}\n\n    cha := make(chan gunk)\n\n    for i := 0; i &lt; MAX; i++ {\n        wg.Add(1)\n        go func(id int) {\n            defer wg.Done()\n            for {\n                textin, ok := &lt;-cha\n                if !ok {\n                    return\n                }\n                mu.Lock()\n                ourDict[textin.id] = textin.line\n                mu.Unlock()\n            }\n        }(i)\n    }\n\n    f, err := os.Open(fileName)\n    checkerr(err)\n    defer f.Close()\n    fscanner := bufio.NewScanner(f)\n    indexPos := 1\n\n    for fscanner.Scan() {\n        text := fscanner.Text()\n        thisgunk := gunk{line: text, id: indexPos}\n        cha &lt;- thisgunk\n        indexPos++\n    }\n\n    close(cha)\n    wg.Wait()\n    for i, v := range ourDict {\n        fmt.Printf(\"%d: %s\\n\", i, v)\n    }\n\n}\n\nfunc checkerr(err error) {\n    if err != nil {\n        fmt.Println(err)\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 59462846, "answer_count": 3, "score": -1, "last_activity_date": 1577179548, "creation_date": 1577148347, "last_edit_date": 1577150721, "question_id": 59462691, "link": "https://stackoverflow.com/questions/59462691/load-a-map-with-and-without-go-routines", "title": "Load a map with and without go-routines", "body": "<p>Here's an interesting situation I ran into. I need to read from a file, and populate a map based on what we found, after some data manipulation using go-routines. Here's the simplified problem statement and example:</p>\n\n<p>Generate the data required by running <code>gen_data.sh</code> </p>\n\n<pre><code>#!/bin/bash \n\nrm some.dat || : \nfor i in `seq 1 10000`; do \n    echo \"$i `date` tx: $RANDOM rx:$RANDOM\" &gt;&gt; some.dat\ndone\n</code></pre>\n\n<p>If I read those lines in <code>some.dat</code> into a <code>map[int]string</code> without go-routines using <code>loadtoDict.go</code>, it retains alignment. (as in the 1st and 2nd words are the same, see o/p below.)</p>\n\n<p>In real-life I do need to process the lines (expensive) before they are loaded into the map, using go-routines speeds up my dictionary creation, and this is an important requirement for the real problem.   </p>\n\n<p><strong>loadtoDict.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n)\n\nvar (\n    fileName = \"some.dat\"\n)\n\nfunc checkerr(err error) {\n    if err != nil {\n        fmt.Println(err)\n        log.Fatal(err)\n    }\n}\n\nfunc main() {\n    ourDict := make(map[int]string)\n    f, err := os.Open(fileName)\n    checkerr(err)\n    defer f.Close()\n\n    fscanner := bufio.NewScanner(f)\n\n    indexPos := 1\n\n    for fscanner.Scan() {\n        text := fscanner.Text()\n        //fmt.Println(\"text\", text)\n        ourDict[indexPos] = text\n        indexPos++\n\n    }\n\n    for i, v := range ourDict {\n        fmt.Printf(\"%d: %s\\n\", i, v)\n    }\n\n}\n</code></pre>\n\n<p>Running:</p>\n\n<pre><code>$ ./loadtoDict\n...\n8676: 8676 Mon Dec 23 15:52:24 PST 2019 tx: 17718 rx:1133\n2234: 2234 Mon Dec 23 15:52:20 PST 2019 tx: 13170 rx:15962\n3436: 3436 Mon Dec 23 15:52:21 PST 2019 tx: 17519 rx:5419\n6177: 6177 Mon Dec 23 15:52:23 PST 2019 tx: 5731 rx:5449\n</code></pre>\n\n<p>notice how the 1st and 2nd words are \"aligning\". However, if I use  go-routines to load my map, this  goes awry:</p>\n\n<p><strong>async_loadtoDict.go</strong> </p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"sync\"\n)\n\nvar (\n    fileName = \"some.dat\"\n    mu       = &amp;sync.RWMutex{}\n    MAX = 9000\n)\n\nfunc checkerr(err error) {\n    if err != nil {\n        fmt.Println(err)\n        log.Fatal(err)\n    }\n}\n\nfunc main() {\n    ourDict := make(map[int]string)\n    f, err := os.Open(fileName)\n    checkerr(err)\n    defer f.Close()\n\n    fscanner := bufio.NewScanner(f)\n\n    indexPos := 1\n    var wg sync.WaitGroup\n    sem := make(chan int, MAX)\n    defer close(sem)\n\n    for fscanner.Scan() {\n        text := fscanner.Text()\n        wg.Add(1)\n        sem &lt;- 1\n        go func() {\n            mu.Lock()\n            defer mu.Unlock()\n            ourDict[indexPos] = text\n            indexPos++\n            &lt;- sem\n            wg.Done()\n        }()\n\n    }\n\n    wg.Wait()\n\n    for i, v := range ourDict {\n        fmt.Printf(\"%d: %s\\n\", i, v)\n    }\n\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>$ ./async_loadtoDict \n...\n11: 22 Mon Dec 23 15:52:19 PST 2019 tx: 25688 rx:7602\n5716: 6294 Mon Dec 23 15:52:23 PST 2019 tx: 28488 rx:3572\n6133: 4303 Mon Dec 23 15:52:21 PST 2019 tx: 24286 rx:1565\n7878: 9069 Mon Dec 23 15:52:25 PST 2019 tx: 16863 rx:24234\n8398: 7308 Mon Dec 23 15:52:23 PST 2019 tx: 4321 rx:20642\n9566: 3489 Mon Dec 23 15:52:21 PST 2019 tx: 14447 rx:12630\n2085: 2372 Mon Dec 23 15:52:20 PST 2019 tx: 14375 rx:24151\n</code></pre>\n\n<p>This is despite guarding the  ingestion <code>ourDict[indexPos]</code> with mutex. I'd like my map index align with the ingestion attempt. </p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 112, "user_id": 8245053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9wWDm.png?s=128&g=1", "display_name": "FuXiang Shu", "link": "https://stackoverflow.com/users/8245053/fuxiang-shu"}, "edited": false, "score": 1, "creation_date": 1577149289, "post_id": 59462554, "comment_id": 105106317, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/17912893/missing-type-in-composite-literal\">Missing type in composite literal</a>"}], "answers": [{"tags": [], "owner": {"reputation": 19, "user_id": 5261858, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cYHsfBiYeeg/AAAAAAAAAAI/AAAAAAAAClE/qxHUpb97kP0/photo.jpg?sz=128", "display_name": "Ankit Shah", "link": "https://stackoverflow.com/users/5261858/ankit-shah"}, "is_accepted": false, "score": 1, "last_activity_date": 1577154458, "creation_date": 1577154458, "answer_id": 59463169, "question_id": 59462554, "link": "https://stackoverflow.com/questions/59462554/how-to-make-a-http-post-data-request/59463169#59463169", "title": "How to make a HTTP post data request", "body": "<p>Assuming you are using <code>\"net/http\"</code>, The Post function expects <code>url</code>, <code>content-type</code> and <code>body</code> in that order. Link : <a href=\"https://golang.org/pkg/net/http/#Client.Post\" rel=\"nofollow noreferrer\">net/http#post</a>\nThus, for your particular case, it should look something like this </p>\n\n<pre><code>    url := \"https://test.com/\"\n    contentType := \"application/json\"\n    param := []byte(`{\"email\": user, \"msg_type\": \"text\",\"content\": {  \"text\" :  \"msg\"  }, }`)\n    resp, err := http.Post(url, contentType, bytes.NewBuffer(param))\n    defer resp.Body.Close()\n\n    if err != nil {\n        //handle error\n    } else {\n\n        body, _ := ioutil.ReadAll(resp.Body)\n        log.Println(body)\n    }\n</code></pre>\n\n<p>If you want to add custom headers, you may use <a href=\"https://golang.org/pkg/net/http/#NewRequest\" rel=\"nofollow noreferrer\">newRequest</a> which gives you <code>req</code> and then you can add or set custom headers .</p>\n\n<pre><code>req.Headers.Set(existingHeaderWithNewValue)\nreq.Headers.Add(customHeader)\n\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9644076, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QMWFqMwIeeg/AAAAAAAAAAI/AAAAAAAAABE/8bA6fAM5Qgs/photo.jpg?sz=128", "display_name": "Roger Wang", "link": "https://stackoverflow.com/users/9644076/roger-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "closed_date": 1577178168, "answer_count": 1, "score": -1, "last_activity_date": 1577178141, "creation_date": 1577146910, "last_edit_date": 1577178141, "question_id": 59462554, "link": "https://stackoverflow.com/questions/59462554/how-to-make-a-http-post-data-request", "closed_reason": "Duplicate", "title": "How to make a HTTP post data request", "body": "<pre><code>func send_msg(msg string, user string) {\n    url := \"https://test.com/\"\n\n    token := \"Bearer \" + get_token()\n\n    header := req.Header{\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": token,\n    }\n\n    // this string param can not use variable user and msg.\n    // param := `{\n    //  \"email\": \"jjjj@gmail.com\",\n    //  \"msg_type\": \"text\",\n    //  \"content\": { \"text\": \"aaaaaaaaaaaaa\" }\n    // }`\n\n    // this req.Param param error\uff1amissing type in composite literal\n    param := req.Param{\n        \"email\": user,\n        \"msg_type\": \"text\",\n        \"content\": {  \"text\" :  msg  }, \n    }\n    r,_ := req.Post(url, header,  param)\n    resp := r.String()\n    log.Println(resp)\n\n}\n</code></pre>\n\n<p>This req.Param param error\uff1amissing type in composite literal</p>\n\n<p>This string param can not use variable user and msg.</p>\n\n<p>How can I use variable param?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1577138069, "post_id": 59461527, "comment_id": 105104286, "body": "I&#39;ll let someone who can speak from specification rather than intuition add a proper answer, but my intuition is that the <code>defer</code> is executed after <code>return err</code> already happened; so changing <code>err</code> no longer has any effect -- the copy to be returned was already copied to the stack, so modifying the local variable you declared with <code>var err error</code> no longer does anything useful. Whereas in the named-return case, <code>&amp;err</code> refers to the copy on the stack."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1577138780, "post_id": 59461527, "comment_id": 105104453, "body": "@CharlesDuffy exactly. the behavior is <code>Deferred function calls are executed in Last In First Out order after the surrounding function returns.</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577178113, "post_id": 59461527, "comment_id": 105112276, "body": "Nothing <i>hides</i> a panic. It&#39;s just that to store the recovered value, you need a named return variable."}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1577139847, "post_id": 59461751, "comment_id": 105104711, "body": "that did not help in understanding the actual behavior. Charles Duffy explanations kind of makes sense, however it seems like there is subtle implementation difference that remains hard to figure out."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1577140545, "post_id": 59461751, "comment_id": 105104865, "body": "@mh-cbon Added more details."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1577141778, "post_id": 59461751, "comment_id": 105105160, "body": "definitely helped. To rephrase, <code>NormalReturns</code> does not return the locally defined <code>err</code> variable because it does not reach the return statement which would copy it to the result values, it instead returns the zero values because the panic broke the flow. However, in <code>NamedReturns</code> when the return happens, because this is a named variable, it returns that variable value, which can be modified by the defer etc. thank you"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1577141872, "post_id": 59461751, "comment_id": 105105177, "body": "@mh-cbon Yes, I also highlighted that part in my answer."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577141922, "post_id": 59461751, "comment_id": 105105186, "body": "@icza i may be misreading something here, but the bold part and the the paragraph after it seem to suggest that if the return statement was reached the deferred function has the ability to modify the returned value even though it&#39;s not a named result parameter? Is that actually the case?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577142071, "post_id": 59461751, "comment_id": 105105214, "body": "@mkopriva That paragraph tells that if the return parameters are not named and a <code>return</code> is not reached, the values actually returned will always be the zero values (the deferred functions can&#39;t modify something unnamed)."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577142337, "post_id": 59461751, "comment_id": 105105267, "body": "@icza ah yes, my bad, I did indeed misunderstood the point there. Thanks."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1577142995, "post_id": 59461751, "comment_id": 105105393, "body": "playing with  <a href=\"https://play.golang.org/p/Iz-omlTTPu0\" rel=\"nofollow noreferrer\">play.golang.org/p/Iz-omlTTPu0</a> following mkopriva comment, and <code>the deferred function may access and modify the result parameters before they are returned</code> poorly makes sense anymore..  I suggest to slightly modify that quotes to use <b>named result parameters</b>. or to quote more of it <code>For instance, if the deferred function is a function literal and the surrounding function has named result parameters that are in scope within the literal...</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1577143641, "post_id": 59461751, "comment_id": 105105484, "body": "@mh-cbon Extended the quote."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 6, "last_activity_date": 1577143648, "last_edit_date": 1577143648, "creation_date": 1577138862, "answer_id": 59461751, "question_id": 59461527, "link": "https://stackoverflow.com/questions/59461527/why-can-a-normal-return-hide-a-panic-that-a-named-return-correctly-provides-to-t/59461751#59461751", "title": "Why can a normal return hide a panic that a named return correctly provides to the caller?", "body": "<blockquote>\n  <p>I thought named returns was just a code readability feature that declares and initializes returns for you, but it seems there's more to it. What am I missing?</p>\n</blockquote>\n\n<p>If you name the result parameters, their actual value at the time of returning to the caller will determine the returned values. Meaning you can change their values like other local variables, and if the expression list of the <code>return</code> statement is empty, their last assigned values will be used. Also if there are deferred functions, they can modify the values of the named result parameters <em>after</em> the <code>return</code> statement and <em>before</em> the function returns to its caller, and those modifications will be preserved. It also allows to modify return values in case of a panic, see <a href=\"https://stackoverflow.com/questions/33167282/how-to-return-a-value-in-a-go-function-that-panics/33167433#33167433\">How to return a value in a Go function that panics?</a></p>\n\n<p><a href=\"https://golang.org/ref/spec#Return_statements\" rel=\"noreferrer\">Spec: Return statements:</a></p>\n\n<blockquote>\n  <p>Regardless of how they [the  return values] are declared, all the result values are initialized to the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"noreferrer\">zero values</a> for their type upon entry to the function. A \"return\" statement that specifies results sets the result parameters before any deferred functions are executed.</p>\n</blockquote>\n\n<p>And <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"noreferrer\">Spec: Defer statements:</a></p>\n\n<blockquote>\n  <p>For instance, if the deferred function is a <a href=\"https://golang.org/ref/spec#Function_literals\" rel=\"noreferrer\">function literal</a> and the surrounding function has <a href=\"https://golang.org/ref/spec#Function_types\" rel=\"noreferrer\">named result parameters</a> that are in scope within the literal, the deferred function may access and modify the result parameters before they are returned.</p>\n</blockquote>\n\n<p>In <code>NormalReturns()</code>: The return value is initialized to its zero value (which is <code>nil</code> for all interface types, including the builtin <a href=\"https://golang.org/pkg/builtin/#error\" rel=\"noreferrer\"><code>error</code></a> type), <strong>and since the <code>return</code> statement is not reached (due to a panic in <code>panicIf42()</code>), it will stay <code>nil</code></strong>. It doesn't matter if the local variable <code>err</code> is changed, that is not the result variable. It's just an ordinary variable. It will have no effect on the value returned</p>\n\n<p>In general, if a function does not have named result variables, and if this function does not reach a <code>return</code> statement (e.g. due to a panic), it cannot have return values other than (meaning different from) the zero values of the result types.</p>\n\n<p>In <code>NamedReturns()</code> the deferred <code>catch()</code> will modify the named result variable <code>err</code>. The changes are \"preserved\": whatever the named result variables hold will be returned when the function ends (which happens after calling deferred functions, if there are any). So even though the <code>return</code> statement is not reached here either, the <code>catch()</code> function changes the <code>err</code> result variable, and whatever is assigned to it will be used as the value returned.</p>\n\n<p>More on the topic:</p>\n\n<p><a href=\"https://blog.golang.org/defer-panic-and-recover\" rel=\"noreferrer\">Go blog: Defer, Panic and Recover:</a></p>\n\n<blockquote>\n  <p>Deferred functions may read and assign to the returning function's named return values.</p>\n</blockquote>\n\n<p>And also in <a href=\"https://golang.org/doc/effective_go.html#recover\" rel=\"noreferrer\">Effective Go: Recover:</a></p>\n\n<blockquote>\n  <p>If <code>doParse</code> panics, the recovery block will set the return value to <code>nil</code>\u2014deferred functions can modify named return values.</p>\n</blockquote>\n"}], "owner": {"reputation": 701, "user_id": 792613, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/684a5ad42c336c5dea38bd051de4236a?s=128&d=identicon&r=PG", "display_name": "vedran", "link": "https://stackoverflow.com/users/792613/vedran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 2, "closed_date": 1577182095, "answer_count": 1, "score": 6, "last_activity_date": 1577143648, "creation_date": 1577136761, "last_edit_date": 1577137942, "question_id": 59461527, "link": "https://stackoverflow.com/questions/59461527/why-can-a-normal-return-hide-a-panic-that-a-named-return-correctly-provides-to-t", "closed_reason": "Duplicate", "title": "Why can a normal return hide a panic that a named return correctly provides to the caller?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n)\n\nfunc catch(err *error) {\n    if r := recover(); r != nil {\n        *err = fmt.Errorf(\"recovered panic: %v\", r)\n    }\n}\n\nfunc panicIf42(n int) {\n    if n == 42 {\n        panic(\"42!\")\n    }\n}\n\nfunc NormalReturns(n int) error {\n    var err error\n    defer catch(&amp;err)\n    panicIf42(n)\n    return err\n}\n\nfunc NamedReturns(n int) (err error) {\n    defer catch(&amp;err)\n    panicIf42(n)\n    return\n}\n\nfunc main() {\n    err := NamedReturns(42)\n    log.Printf(\"NamedReturns error: %v\", err)\n    err = NormalReturns(42)\n    log.Printf(\"NormalReturns error: %v\", err)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>2009/11/10 23:00:00 NamedReturns error: recovered panic: 42!\n2009/11/10 23:00:00 NormalReturns error: &lt;nil&gt;\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/0e0Vhz7fe4E\" rel=\"nofollow noreferrer\">Playground link</a></p>\n\n<p>NormalReturns returns a nil error, but I would expect both NamedReturns and NormalReturns to return a non-nil error.</p>\n\n<p>I thought named returns was just a code readability feature that declares and initializes returns for you, but it seems there's more to it. What am I missing?</p>\n"}, {"tags": ["go", "time", "epoch"], "answers": [{"tags": [], "owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "is_accepted": false, "score": 1, "last_activity_date": 1577134522, "creation_date": 1577134522, "answer_id": 59461204, "question_id": 59460747, "link": "https://stackoverflow.com/questions/59460747/how-to-convert-gmt-date-to-unix-time-in-golang/59461204#59461204", "title": "How to convert GMT date to UNIX time in golang?", "body": "<p>That looks like <a href=\"https://golang.org/pkg/time/#pkg-constants\" rel=\"nofollow noreferrer\">time.RFC1123</a>. If not, refer to the same section to create your own layout reference string.</p>\n"}, {"tags": [], "owner": {"reputation": 112, "user_id": 8245053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9wWDm.png?s=128&g=1", "display_name": "FuXiang Shu", "link": "https://stackoverflow.com/users/8245053/fuxiang-shu"}, "is_accepted": true, "score": 1, "last_activity_date": 1577148662, "creation_date": 1577148662, "answer_id": 59462715, "question_id": 59460747, "link": "https://stackoverflow.com/questions/59460747/how-to-convert-gmt-date-to-unix-time-in-golang/59462715#59462715", "title": "How to convert GMT date to UNIX time in golang?", "body": "<p>The layout of the date is <code>RFC1123</code>. Parse it with <code>time.Parse()</code> then convert it to Unix with <code>time.Time.Unix()</code>.</p>\n\n<pre><code>t, _ := time.Parse(time.RFC1123, \"Mon, 23 Dec 2019 18:52:45 GMT\")\ntUnix:= t.Unix()\nfmt.Printf(\"%s in Unix is %d\",t,tUnix)\n// Output: 2019-12-23 18:52:45 +0000 GMT in Unix is 1577127165\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/CYVDEq_Zy72\" rel=\"nofollow noreferrer\">Try it online</a></p>\n"}], "owner": {"reputation": 908, "user_id": 3589567, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CKIds.png?s=128&g=1", "display_name": "Alejandro Blasco", "link": "https://stackoverflow.com/users/3589567/alejandro-blasco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 1, "accepted_answer_id": 59462715, "answer_count": 2, "score": -3, "last_activity_date": 1577148662, "creation_date": 1577131359, "last_edit_date": 1577132446, "question_id": 59460747, "link": "https://stackoverflow.com/questions/59460747/how-to-convert-gmt-date-to-unix-time-in-golang", "title": "How to convert GMT date to UNIX time in golang?", "body": "<p>I need to convert a GMT date like (<code>Mon, 23 Dec 2019 18:52:45 GMT</code>) to time.Time.Unix in Go</p>\n\n<p>I've tried to parse it before and then convert it to Unix format. But it's not so clean what are the predefined layouts in time.Parse\n<a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/#Parse</a></p>\n\n<p>How to do that?</p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "edited": false, "score": 0, "creation_date": 1577131449, "post_id": 59460105, "comment_id": 105102626, "body": "Please provide a bit more detail; a Minimal, Reproducible Example would help (currently its difficult to say much because you have only provided a snippet so its difficult to know what the call to c.Reader, for example, does). One issue is that your goroutine will never exit so I suspect that you may be ending up with multiple instances reading from the websocket (whether this is the case depends upon where c is defined and whether the goroutine is restarted after processing an error)."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577136192, "post_id": 59460105, "comment_id": 105103811, "body": "As the error implies, a message must be read fully before the next message can be read. Use the first version of the code or change the second version to slurp up the message to a []byte and send that []byte to the channel."}, {"owner": {"reputation": 33, "user_id": 5765516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ccd5858dbb5c2a7ed1c88e197266796?s=128&d=identicon&r=PG&f=1", "display_name": "Max Gaffney", "link": "https://stackoverflow.com/users/5765516/max-gaffney"}, "edited": false, "score": 0, "creation_date": 1577136573, "post_id": 59460105, "comment_id": 105103917, "body": "Thank you for your time and suggestions.  Brits I agree a smaller, reproducible example would be better for you to debug and probably for me as well. I&#39;ll work on that.  I do not want the goroutine to ever exit, it is a websocket feed constantly being sent messages.   Cerise I&#39;ve attempted to save/copy the message to a []byte or string and was running into panics in buffer.go. I&#39;ll see what I can do when whipping up a reproducible example"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 5765516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ccd5858dbb5c2a7ed1c88e197266796?s=128&d=identicon&r=PG&f=1", "display_name": "Max Gaffney", "link": "https://stackoverflow.com/users/5765516/max-gaffney"}, "edited": false, "score": 0, "creation_date": 1577141557, "post_id": 59462032, "comment_id": 105105108, "body": "CERISE!  Thanks!  Will dig into the Read vs Reader and bytes.NewReader to cement my understanding of the issue."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1577141136, "creation_date": 1577141136, "answer_id": 59462032, "question_id": 59460105, "link": "https://stackoverflow.com/questions/59460105/websockets-in-go-routine-error-previous-message-not-read-to-completion/59462032#59462032", "title": "Websockets in go routine: error previous message not read to completion", "body": "<p>As the error implies, a message must be read fully before the next message can be read. Use the first version of the code or change the second version to slurp up the message to a []byte and send that []byte to the channel. </p>\n\n<p>Assuming that you are using the nhooyr.io/websocket package, the second version will look something like this:</p>\n\n<pre><code>for {\n    // Read returns the entire message as a []byte\n    msgType, msg, err := c.Read(ctx)\n\n    // bytes.NewReader creates an io.Reader on a []byte\n    res := wsResponse{Msg: bytes.NewReader(msg), Err: err, MsgType: msgType}\n    wsChan &lt;- res\n    if res.Err {\n        // Always exit the loop on error. Otherwise, the goroutine will run forever.\n        return\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 5765516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ccd5858dbb5c2a7ed1c88e197266796?s=128&d=identicon&r=PG&f=1", "display_name": "Max Gaffney", "link": "https://stackoverflow.com/users/5765516/max-gaffney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 59462032, "answer_count": 1, "score": 0, "last_activity_date": 1577178056, "creation_date": 1577127510, "last_edit_date": 1592644375, "question_id": 59460105, "link": "https://stackoverflow.com/questions/59460105/websockets-in-go-routine-error-previous-message-not-read-to-completion", "title": "Websockets in go routine: error previous message not read to completion", "body": "<p>I've recently begun exploring Go and am really enjoying it.  I've run into an issue when attempting to detect a timeout in a websocket connection.  I am listening to the websocket connection indefinitely and when I don't get a response in X seconds I attempt to reconnect.  To accomplish this I've had to revise my for loop to include a select.  I then created a type  and a channel to listen for websocket responses.  However this has led to errors in my websocket connection saying failed to get reader: previous message not read to completion.</p>\n<p>I replaced code taken from project to be stand alone.  Below is full script with both loops (working and non working available)</p>\n<pre><code>package main\n\nimport (\n    &quot;bytes&quot;\n    &quot;context&quot;\n    &quot;fmt&quot;\n    &quot;io&quot;\n    &quot;time&quot;\n\n    &quot;nhooyr.io/websocket&quot;\n)\n\nfunc main() {\n    ctx := context.Background()\n    c, _, err := websocket.Dial(ctx, &quot;wss://stream.binance.com:9443/ws/btcusdt@trade&quot;, nil)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    type wsResponse struct {\n        Msg     io.Reader\n        Err     error\n        MsgType websocket.MessageType\n    }\n\n    // THIS LOOP WORKS\n    // for {\n    //  _, msg, err := c.Reader(ctx)\n    //  buf := new(bytes.Buffer)\n    //  buf.ReadFrom(msg)\n    //  fmt.Println(buf.String())\n    //  if err != nil {\n    //      fmt.Println(err)\n    //      return\n    //  }\n    // }\n\n    // The following goroutine and loop produces errors\n    wsChan := make(chan wsResponse)\n    go func() {\n        for {\n            msgType, msg, err := c.Reader(ctx)\n            res := wsResponse{Msg: msg, Err: err, MsgType: msgType}\n            //fmt.Printf(&quot;%+v\\n&quot;, res)\n            wsChan &lt;- res\n        }\n    }()\n\n    ticker := time.NewTicker(30 * time.Second)\n    for {\n        select {\n        case res := &lt;-wsChan:\n            ticker.Stop()\n            if res.Err != nil {\n                fmt.Println(res.Err)\n                break\n            }\n            buf := new(bytes.Buffer)\n            buf.ReadFrom(res.Msg)\n            s := buf.String()\n            fmt.Println(s)\n            ticker = time.NewTicker(5 * time.Second)\n        case &lt;-ticker.C:\n            fmt.Println(&quot;timeout error&quot;)\n            break\n        }\n    }\n}\n\n</code></pre>\n<p>Logs are printing:</p>\n<blockquote>\n<p>{&quot;e&quot;:&quot;trade&quot;,&quot;E&quot;:1577140149102,&quot;s&quot;:&quot;BTCUSDT&quot;,&quot;t&quot;:220054947,&quot;p&quot;:&quot;7304.40000000&quot;,&quot;q&quot;:&quot;0.07153400&quot;,&quot;b&quot;:933798088,&quot;a&quot;:933798124,&quot;T&quot;:1577140149099,&quot;m&quot;:true,&quot;M&quot;:true}</p>\n<p>failed to get reader: previous message not read to completion</p>\n<p>{&quot;e&quot;:&quot;trade&quot;,&quot;E&quot;:1577140149107,&quot;s&quot;:&quot;BTCUSDT&quot;,&quot;t&quot;:220054948,&quot;p&quot;:&quot;7304.95000000&quot;,&quot;q&quot;:&quot;0.28826900&quot;,&quot;b&quot;:933798126,&quot;a&quot;:933798125,&quot;T&quot;:1577140149104,&quot;m&quot;:false,&quot;M&quot;:true}</p>\n<p>failed to get reader: previous message not read to completion</p>\n</blockquote>\n<p>So its working but its still returning errors.  The reader function source is here. <a href=\"https://github.com/nhooyr/websocket/blob/master/conn.go#L390\" rel=\"nofollow noreferrer\">https://github.com/nhooyr/websocket/blob/master/conn.go#L390</a>.  Suppose I could just raise an issue there.</p>\n"}, {"tags": ["go", "ethernet"], "answers": [{"tags": [], "owner": {"reputation": 111, "user_id": 9278374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9a4980b308a75e207765cd6c2b94345?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Anonymous", "link": "https://stackoverflow.com/users/9278374/michael-anonymous"}, "is_accepted": false, "score": 1, "last_activity_date": 1577173063, "creation_date": 1577173063, "answer_id": 59465446, "question_id": 59460097, "link": "https://stackoverflow.com/questions/59460097/trouble-receiving-ethernet-frames-with-go/59465446#59465446", "title": "Trouble Receiving Ethernet Frames with Go", "body": "<p>Found my problem. </p>\n\n<p>When you set up the socket to listen on, you have to specify the Ethernet Frame Type. \nIn C, this would link back to the frame types in linux/if_ether.h . </p>\n\n<p>If I specify a frame type 0x0003, it works for the BACnet/Ethernet frame and I am able to see the frames come in.</p>\n"}], "owner": {"reputation": 111, "user_id": 9278374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9a4980b308a75e207765cd6c2b94345?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Anonymous", "link": "https://stackoverflow.com/users/9278374/michael-anonymous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1577173063, "creation_date": 1577127453, "question_id": 59460097, "link": "https://stackoverflow.com/questions/59460097/trouble-receiving-ethernet-frames-with-go", "title": "Trouble Receiving Ethernet Frames with Go", "body": "<p>I'm working with an older protocol that is Ethernet based (specifically BACnet/Ethernet) so I'm writing an application to send and receive Ethernet frames using Go. I'm using a package from github that so far is pretty good and following the guide located <a href=\"https://mdlayher.com/blog/network-protocol-breakdown-ethernet-and-go/\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>I'm working on a Linux platform, specifically a Debian distro. 4.14 Kernal. </p>\n\n<p>I can send frames just fine and verify with Wireshark that they're being sent. I also so the remote devices reply to my frame on Wireshark. However my listen function is not processing the reply in any way. There's no output of any kind or error. </p>\n\n<p>I've followed the example in the linked article but I'll include the source below. This code isn't mine, I dont take credit for it. It belongs to Matt Layher</p>\n\n<p>Why is my application not receiving the reply?</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"github.com/mdlayher/ethernet\"\n    \"github.com/mdlayher/raw\"\n    \"net\"\n)\n\nfunc main {\n// Select the eth0 interface to use for Ethernet traffic.\nifi, err := net.InterfaceByName(\"eth0\")\nif err != nil {\n    log.Fatalf(\"failed to open interface: %v\", err)\n}\n\n// Open a raw socket using same EtherType as our frame.\nc, err := raw.ListenPacket(ifi, 0xcccc)\nif err != nil {\n    log.Fatalf(\"failed to listen: %v\", err)\n}\ndefer c.Close()\n\n// Accept frames up to interface's MTU in size.\nb := make([]byte, ifi.MTU)\nvar f ethernet.Frame\n\n// Keep reading frames.\nfor {\n    n, addr, err := c.ReadFrom(b)\n    if err != nil {\n        log.Fatalf(\"failed to receive message: %v\", err)\n    }\n\n    // Unpack Ethernet frame into Go representation.\n    if err := (&amp;f).UnmarshalBinary(b[:n]); err != nil {\n        log.Fatalf(\"failed to unmarshal ethernet frame: %v\", err)\n    }\n\n    // Display source of message and message itself.\n    log.Printf(\"[%s] %s\", addr.String(), string(f.Payload))\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9968, "user_id": 114900, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ZGjf9.jpg?s=128&g=1", "display_name": "msanford", "link": "https://stackoverflow.com/users/114900/msanford"}, "edited": false, "score": 0, "creation_date": 1577126412, "post_id": 59459304, "comment_id": 105101092, "body": "This is not a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> as it&#39;s not <i>complete</i>. I assume you&#39;re trying to use <a href=\"https://github.com/gin-gonic/gin/issues/1850\" rel=\"nofollow noreferrer\">Gin</a> or some framework? Please post your whole file, including the imports."}], "answers": [{"tags": [], "owner": {"reputation": 2105, "user_id": 5821408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f6ca899d084f02ac63e71e9e8711046?s=128&d=identicon&r=PG&f=1", "display_name": "shmsr", "link": "https://stackoverflow.com/users/5821408/shmsr"}, "is_accepted": false, "score": 0, "last_activity_date": 1577126133, "creation_date": 1577126133, "answer_id": 59459839, "question_id": 59459304, "link": "https://stackoverflow.com/questions/59459304/why-cannot-load-golang-protobuf-proto/59459839#59459839", "title": "Why cannot load golang/protobuf/proto", "body": "<p>Execute the following steps:</p>\n\n<ol>\n<li><code>go get github.com/golang/protobuf</code></li>\n<li><code>go run main.go</code></li>\n</ol>\n"}], "owner": {"reputation": 1, "user_id": 12586321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RqFiOox3wGE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3res9wZ1NdI72X6voQAjnV3Vbiktbw/photo.jpg?sz=128", "display_name": "neo", "link": "https://stackoverflow.com/users/12586321/neo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1577133982, "creation_date": 1577122914, "last_edit_date": 1577133982, "question_id": 59459304, "link": "https://stackoverflow.com/questions/59459304/why-cannot-load-golang-protobuf-proto", "title": "Why cannot load golang/protobuf/proto", "body": "<pre><code>const (\n    Address = \":50051\"\n)\nfunc main() {\n    listen, err := net.Listen(\"tcp\", Address)\n    if err != nil {\n        log.Fatalf(\"failed to listen: %v\", err)\n    }\n    log.Printf(\"listen on: %s\\n\", Address)\n}\n</code></pre>\n\n<p>when I run: <code>go run main.go</code>\nI get this error:</p>\n\n<pre><code>build command-line-arguments: cannot load github.com/golang/protobuf/proto: module github.com/golang/protobuf/proto: Get https://proxy.golang.org/github.com/golang/protobuf/proto/@v/list: dial tcp 216.58.200.241:443: connectex: A connection attempt failed because the connected party did not properly respond after a period of time, or established \nconnection failed because connected host has failed to respond.\n</code></pre>\n"}, {"tags": ["postgresql", "docker", "go", "docker-compose", "go-gin"], "comments": [{"owner": {"reputation": 905, "user_id": 725371, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/4yB1k.jpg?s=128&g=1", "display_name": "Oras", "link": "https://stackoverflow.com/users/725371/oras"}, "edited": false, "score": 0, "creation_date": 1577185834, "post_id": 59459167, "comment_id": 105115166, "body": "have you tried using ports in postgress service definition?     ``` image: postgres:latest     restart: always     ports:       - 5432:5432"}, {"owner": {"reputation": 11, "user_id": 4781442, "user_type": "registered", "profile_image": "https://graph.facebook.com/827742510596520/picture?type=large", "display_name": "Anurag Bhardwaj", "link": "https://stackoverflow.com/users/4781442/anurag-bhardwaj"}, "reply_to_user": {"reputation": 905, "user_id": 725371, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/4yB1k.jpg?s=128&g=1", "display_name": "Oras", "link": "https://stackoverflow.com/users/725371/oras"}, "edited": false, "score": 0, "creation_date": 1577251903, "post_id": 59459167, "comment_id": 105128931, "body": "@Oras, I have. but I don&#39;t think I need to. compose create a bridge n/w by default. Also, I am able to <code>ping postgres</code> from web app successfully"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 4781442, "user_type": "registered", "profile_image": "https://graph.facebook.com/827742510596520/picture?type=large", "display_name": "Anurag Bhardwaj", "link": "https://stackoverflow.com/users/4781442/anurag-bhardwaj"}, "edited": false, "score": 1, "creation_date": 1577273889, "post_id": 59477546, "comment_id": 105133090, "body": "I tend to differ for your opinion on ports. It seems to me we expose ports only when we need to connect outside the network. since <code>docker-compose</code> gives default bridge network, we do not it to expose ports.  <code>depends_on</code> is just to enforce for container dependencies.  Thanks for your response. Happy holidays!"}, {"owner": {"reputation": 10239, "user_id": 896358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df545d088c90710377af844a60d1f7ac?s=128&d=identicon&r=PG", "display_name": "ROOT", "link": "https://stackoverflow.com/users/896358/root"}, "reply_to_user": {"reputation": 11, "user_id": 4781442, "user_type": "registered", "profile_image": "https://graph.facebook.com/827742510596520/picture?type=large", "display_name": "Anurag Bhardwaj", "link": "https://stackoverflow.com/users/4781442/anurag-bhardwaj"}, "edited": false, "score": 0, "creation_date": 1577274316, "post_id": 59477546, "comment_id": 105133206, "body": "I agree with you, I checked and I see my point is not valid here, but maybe for your case you will need to have a custom <code>entrypoint</code> to check for the database availability in your app container and if its up. Merry Christmas! to you."}], "tags": [], "owner": {"reputation": 10239, "user_id": 896358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df545d088c90710377af844a60d1f7ac?s=128&d=identicon&r=PG", "display_name": "ROOT", "link": "https://stackoverflow.com/users/896358/root"}, "is_accepted": false, "score": 0, "last_activity_date": 1577270392, "last_edit_date": 1592644375, "creation_date": 1577270392, "answer_id": 59477546, "question_id": 59459167, "link": "https://stackoverflow.com/questions/59459167/docker-golang-gin-postgres/59477546#59477546", "title": "Docker golang gin postgres", "body": "<p>Seems to be some missing ports to be exposed as mentioned by @Oras ports: <code>5432:5432</code> just add it to exclude ports from the issue, also from the error you have, it seems that your docker app container <strong>depends on</strong> the database container so you need to have a way to wait until your database container is up and  your app container can connect it, check <code>depends_on</code> for docker compose:</p>\n<p><a href=\"https://docs.docker.com/compose/compose-file/\" rel=\"nofollow noreferrer\">https://docs.docker.com/compose/compose-file/</a></p>\n<pre><code>version: '3'\nservices:\nweb:\n  build: .\n  ports:\n    - &quot;3000:3000&quot;\n  depends_on:\n    postgres\n  restart_policy:\n    condition: on-failure\n  postgres:\n    image: &quot;postgres&quot;\n    ports:\n      - &quot;3000:3000&quot;\n    environment:\n      POSTGRES_USER: 'anurag'\n      POSTGRES_PASSWORD: 'anu_12345'\n      POSTGRES_DB: 'bankingapp'\n</code></pre>\n<blockquote>\n<p>There are several things to be aware of when using depends_on:</p>\n<ol>\n<li><p>depends_on does not wait for db and redis to be \u201cready\u201d before starting web - only until they have been started. If you need to wait for a service to be ready, see Controlling startup order for more on this problem and strategies for solving it.</p>\n</li>\n<li><p>Version 3 no longer supports the condition form of depends_on.</p>\n</li>\n<li><p>The depends_on option is ignored when deploying a stack in swarm mode with a version 3 Compose file.</p>\n</li>\n</ol>\n</blockquote>\n<p>and based on the the above note you may still face the issue for but the restart policy will restart the app container and you will connect to the database.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 4781442, "user_type": "registered", "profile_image": "https://graph.facebook.com/827742510596520/picture?type=large", "display_name": "Anurag Bhardwaj", "link": "https://stackoverflow.com/users/4781442/anurag-bhardwaj"}, "is_accepted": true, "score": 0, "last_activity_date": 1577273652, "creation_date": 1577273652, "answer_id": 59478020, "question_id": 59459167, "link": "https://stackoverflow.com/questions/59459167/docker-golang-gin-postgres/59478020#59478020", "title": "Docker golang gin postgres", "body": "<p>I found the answer.\nJust need to rebuild image or load using mount.\nThe code was not refreshed.</p>\n\n<p>Sorry to bother.</p>\n"}], "owner": {"reputation": 11, "user_id": 4781442, "user_type": "registered", "profile_image": "https://graph.facebook.com/827742510596520/picture?type=large", "display_name": "Anurag Bhardwaj", "link": "https://stackoverflow.com/users/4781442/anurag-bhardwaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 546, "favorite_count": 0, "accepted_answer_id": 59478020, "answer_count": 2, "score": 0, "last_activity_date": 1577273652, "creation_date": 1577122050, "last_edit_date": 1577268928, "question_id": 59459167, "link": "https://stackoverflow.com/questions/59459167/docker-golang-gin-postgres", "title": "Docker golang gin postgres", "body": "<p>I am trying to set up a docker for golang app with Postgres.\nThe go app works fine in a container if I remove/comment Postgres. And similarly, I am able to spin up Postgres container and log into it. I am able do docker-compose up.\nBut when I make a API call, like for eg: <code>localhost:3000/api/admin/users</code>. It gives and error:</p>\n\n<pre><code>error: {\n        \"error\": \"+dial tcp 127.0.0.1:5432: connect: connection refused\"\n    }\n</code></pre>\n\n<p>The Postgres connection string is like this: </p>\n\n<pre><code>connStr := fmt.Sprintf(\"host=postgres user=anurag password=anu_12345 dbname=bankingapp sslmode=disable\")\n</code></pre>\n\n<p>db, err := sql.Open(\"postgres\", connStr)</p>\n\n<p>Dockerfile</p>\n\n<pre><code>FROM golang:1.13\n\n\nWORKDIR /go/src/banking-app\nCOPY . .\n\nRUN go get -d -v ./...\nRUN go install -v ./...\n\nCMD [\"go\" , \"run\", \"main.go\"]\n\n\n</code></pre>\n\n<p>docker-compose.yml</p>\n\n<pre><code>version: '3'\nservices:\n  web:\n    build: .\n    ports:\n      - \"3000:3000\"\n  postgres:\n    image: \"postgres\"\n    environment:\n      POSTGRES_USER: 'anurag'\n      POSTGRES_PASSWORD: 'anu_12345'\n      POSTGRES_DB: 'bankingapp'\n\n\n</code></pre>\n"}, {"tags": ["bash", "go", "autocomplete", "stdout", "stdin"], "comments": [{"owner": {"reputation": 6031, "user_id": 10871900, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-noQwojQppnY/AAAAAAAAAAI/AAAAAAAAACs/59RU8UyHFSk/photo.jpg?sz=128", "display_name": "dan1st", "link": "https://stackoverflow.com/users/10871900/dan1st"}, "edited": false, "score": 0, "creation_date": 1577122180, "post_id": 59458992, "comment_id": 105099603, "body": "Just use <code>\\t</code> instead of the tabulator?"}, {"owner": {"reputation": 313, "user_id": 6801592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0MC40.png?s=128&g=1", "display_name": "snwfdhmp", "link": "https://stackoverflow.com/users/6801592/snwfdhmp"}, "edited": false, "score": 0, "creation_date": 1578330453, "post_id": 59458992, "comment_id": 105395619, "body": "That can helps <a href=\"https://www.tldp.org/LDP/abs/html/tabexpansion.html\" rel=\"nofollow noreferrer\">tldp.org/LDP/abs/html/tabexpansion.html</a>"}], "owner": {"reputation": 1, "user_id": 10714485, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-rATIx-dRmMw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jJdho9s2JFhFICiSyKoRA0LjXDIQ/mo/photo.jpg?sz=128", "display_name": "Antoine Toussaint", "link": "https://stackoverflow.com/users/10714485/antoine-toussaint"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1577122073, "creation_date": 1577121018, "last_edit_date": 1577122073, "question_id": 59458992, "link": "https://stackoverflow.com/questions/59458992/capture-auto-complete-from-bash-in-go", "title": "Capture auto-complete from bash in go", "body": "<p>I am trying to write a wrapper around bash so I can record input, output as well as decorate the standard in/out.</p>\n\n<p>I am using <code>exec.Command(\"bash\")</code> and using <code>cmd.Stdin</code> and <code>cmd.Stdout</code> to interact from the go application with the bash process but I don't know how to handle the auto-completion from bash.</p>\n\n<p><strong>How do I send the <code>&lt;TAB&gt;</code> to bash and get back the updated input line / output?</strong></p>\n\n<p>Ideally, I would want to be able to run a unit test that would look like that:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>shell := capture.NewShell(\"~\")\nout := shell.In([]byte(`cd Docum&lt;TAB&gt;`))\nassert.Equal(t, \"cd Documents\", string(out))\n</code></pre>\n\n<p>Any help, guidance or link to relevant documentation would be super appreciated.</p>\n\n<p>Thank you very much!</p>\n"}, {"tags": ["sockets", "go"], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 6075468, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jxEN7.jpg?s=128&g=1", "display_name": "JinLing", "link": "https://stackoverflow.com/users/6075468/jinling"}, "edited": false, "score": 0, "creation_date": 1577119757, "post_id": 59458713, "comment_id": 105098704, "body": "Thank you so much, this help me a lot."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 2, "last_activity_date": 1577119602, "creation_date": 1577119602, "answer_id": 59458713, "question_id": 59458635, "link": "https://stackoverflow.com/questions/59458635/why-connection-read-return-the-length-of-buffer-not-really-send/59458713#59458713", "title": "why connection Read return the length of buffer, not really send?", "body": "<p>You didn't send 7 bytes, you sent 2048. You're passing the <code>buffer</code> to <code>conn.Write</code>, and it writes all 2048 bytes of it. To send only the number of bytes read, you should only send the part that has the data you read:</p>\n\n<pre><code> _, err = conn.Write(buffer[:nbytes])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1577123035, "last_edit_date": 1577123035, "creation_date": 1577121871, "answer_id": 59459133, "question_id": 59458635, "link": "https://stackoverflow.com/questions/59458635/why-connection-read-return-the-length-of-buffer-not-really-send/59459133#59459133", "title": "why connection Read return the length of buffer, not really send?", "body": "<p>To avoid this problem, use this safe <code>buf</code> idiom for a <code>Read</code>. In this example, it will write the number of bytes read.</p>\n\n<pre><code>buf := make([]byte, 2048)\nfor {\n    n, err := conn.Read(buf[:cap(buf)])\n    buf = buf[:n]\n    if err != nil {\n        // handle error\n    }\n    _, err = w.Write(buf)\n}\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 6075468, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jxEN7.jpg?s=128&g=1", "display_name": "JinLing", "link": "https://stackoverflow.com/users/6075468/jinling"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 1, "answer_count": 2, "score": -1, "last_activity_date": 1577123035, "creation_date": 1577119197, "question_id": 59458635, "link": "https://stackoverflow.com/questions/59458635/why-connection-read-return-the-length-of-buffer-not-really-send", "title": "why connection Read return the length of buffer, not really send?", "body": "<p>I am writing a pair of socket server and client in Golang. </p>\n\n<p>Here is my code for client:</p>\n\n<pre><code>func handler(conn net.Conn) {\n    defer conn.Close()\n    buffer := make([]byte, 2048)\n    reader := bufio.NewReader(os.Stdin)\n    for {\n        nbytes, err := reader.Read(buffer)\n        if err != nil {\n            if err == io.EOF {\n                break\n            }\n            log.Fatal(err)\n        }\n        log.Printf(\"client: send %d bytes -&gt; %s\", nbytes, buffer)\n\n        _, err = conn.Write(buffer)\n        if err != nil {\n            log.Fatal(err)\n        }\n    }\n}\n</code></pre>\n\n<p>code for server:</p>\n\n<pre><code>func serverHandler(conn net.Conn) {\n    defer conn.Close()\n    buffer := make([]byte, 2048)\n    for {\n        nbytes, err := conn.Read(buffer)\n        if err != nil {\n            if err == io.EOF {\n                break\n            }\n            log.Print(\"Error reading: \", err.Error())\n        }\n        log.Printf(\"server: %d bytes received -&gt; %s\", nbytes, buffer)\n\n        writer := bufio.NewWriter(os.Stdout)\n        _, err = writer.Write(buffer)\n        if err != nil {\n            log.Print(\"Error writing: \", err.Error())\n        }\n        writer.Flush()\n    }\n}\n</code></pre>\n\n<p>Here is some output:</p>\n\n<pre><code>./server 12345\n2019/12/24 00:35:31 Listen on localhost:12345\n2019/12/24 00:35:38 client from: 127.0.0.1:51352\n2019/12/24 00:35:48 server: 2048 bytes received -&gt; hello?\n\n\n./client localhost 12345\nhello?\n2019/12/24 00:35:48 client: send 7 bytes -&gt; hello?\n</code></pre>\n\n<p>As you can see, client sent 7 bytes, but the server received 2048 bytes. what is the problem of server's code?</p>\n"}, {"tags": ["json", "api", "vue.js", "go", "axios"], "comments": [{"owner": {"reputation": 1627, "user_id": 1537514, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/q15DM.jpg?s=128&g=1", "display_name": "mutiemule", "link": "https://stackoverflow.com/users/1537514/mutiemule"}, "edited": false, "score": 2, "creation_date": 1577129079, "post_id": 59458571, "comment_id": 105101925, "body": "What do you mean by when you test the API on Chrome? Use Postman/Postwoman/Insomnia to test the API. If you&#39;re able to get data from JSONPlaceholder, it means the issue is with your API most likely."}], "answers": [{"comments": [{"owner": {"reputation": 1645, "user_id": 4854993, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/zlGYW.jpg?s=128&g=1", "display_name": "Kevin Bryan", "link": "https://stackoverflow.com/users/4854993/kevin-bryan"}, "edited": false, "score": 0, "creation_date": 1577206574, "post_id": 59460418, "comment_id": 105121702, "body": "when I use console.log() on vue I get <code>error: Unexpected console statement</code>"}, {"owner": {"reputation": 1627, "user_id": 1537514, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/q15DM.jpg?s=128&g=1", "display_name": "mutiemule", "link": "https://stackoverflow.com/users/1537514/mutiemule"}, "reply_to_user": {"reputation": 1645, "user_id": 4854993, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/zlGYW.jpg?s=128&g=1", "display_name": "Kevin Bryan", "link": "https://stackoverflow.com/users/4854993/kevin-bryan"}, "edited": false, "score": 0, "creation_date": 1577727748, "post_id": 59460418, "comment_id": 105239149, "body": "@KevinBryan you have to add the variable you want to log inside <code>log()</code> e.g <code>console.log(var)</code>"}], "tags": [], "owner": {"reputation": 1627, "user_id": 1537514, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/q15DM.jpg?s=128&g=1", "display_name": "mutiemule", "link": "https://stackoverflow.com/users/1537514/mutiemule"}, "is_accepted": false, "score": 1, "last_activity_date": 1577129526, "creation_date": 1577129526, "answer_id": 59460418, "question_id": 59458571, "link": "https://stackoverflow.com/questions/59458571/vue-not-returning-data-when-consuming-api/59460418#59460418", "title": "Vue not returning data when consuming API", "body": "<p>I suspect the issue could be with your API.</p>\n\n<p>Test the API on <a href=\"https://www.getpostman.com/\" rel=\"nofollow noreferrer\">Postman</a> / <a href=\"https://postwoman.io/\" rel=\"nofollow noreferrer\">Postwoman</a> / <a href=\"https://insomnia.rest/\" rel=\"nofollow noreferrer\">Insomnia</a> to see the response.\nIf the API returns data on the API testing tool, it should function well when consumed on axios.</p>\n\n<p>See below example:</p>\n\n\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"true\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>var app = new Vue({\r\n       el: '#app',\r\n\r\n       data: {\r\n        response: '',\r\n       },     \r\n \r\n       methods:{\r\n        runApi:function(){\r\n            axios.get('https://jsonplaceholder.typicode.com/todos/1').then(response=&gt;{\r\n                this.response = response.data;\r\n                console.log(this.response);\r\n                \r\n            }).catch(function(error){\r\n                console.log('error : ',error);\r\n            })  \r\n        }\r\n       },\r\n\r\n       mounted:function(){\r\n           this.runApi();        \r\n        }\r\n    })</code></pre>\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;script src=\"https://unpkg.com/axios/dist/axios.min.js\"&gt;&lt;/script&gt;\r\n&lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.17/vue.js\"&gt;&lt;/script&gt;\r\n\r\n\r\n&lt;div id=\"app\"&gt;\r\n&lt;p&gt;\r\n{{ response }}\r\n&lt;/p&gt;\r\n&lt;/div&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}], "owner": {"reputation": 1645, "user_id": 4854993, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/zlGYW.jpg?s=128&g=1", "display_name": "Kevin Bryan", "link": "https://stackoverflow.com/users/4854993/kevin-bryan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1578284767, "creation_date": 1577118827, "last_edit_date": 1578284767, "question_id": 59458571, "link": "https://stackoverflow.com/questions/59458571/vue-not-returning-data-when-consuming-api", "title": "Vue not returning data when consuming API", "body": "<p>I created my own backend api, when I test the api on chrome it works correctly but when I consume the api using axios it doesn't return any data. I'm using vue.</p>\n\n<pre><code>axios.get('http://192.168.149.12:8888/api/user/5120')\n            .then(res =&gt; {\n                this.data = res; \n            }) \n            .catch(err =&gt; {\n                this.data = err;\n            });\n</code></pre>\n\n<p>response: </p>\n\n<pre><code>{ \"data\": \"\", \"status\": 200, \"statusText\": \"OK\", \"headers\": { \"content-length\": \"0\" }, \"config\": { \"url\": \"http://192.168.149.12:8888/api/user/5120\", \"method\": \"get\", \"headers\": { \"Accept\": \"application/json, text/plain, */*\" }, \"transformRequest\": [ null ], \"transformResponse\": [ null ], \"timeout\": 0, \"xsrfCookieName\": \"XSRF-TOKEN\", \"xsrfHeaderName\": \"X-XSRF-TOKEN\", \"maxContentLength\": -1 }, \"request\": {} }\n</code></pre>\n\n<p>as you can see the data is empty, but when I try to use some public api such as JSONPlaceholder it works perfectly. </p>\n\n<p>This is the format of my json api:</p>\n\n<pre><code>{\n\"user\": {\n  \"example\": false,\n  \"example1\": \"/zTxHf9iIOCqRbxvl8W5QYKrsMLq.jpg\"\n }\n}\n</code></pre>\n\n<p><strong>EDIT (I found the problem)</strong></p>\n\n<p>Whenever the user make an API request I check if the session is valid</p>\n\n<pre><code>userCookie, err := r.Cookie(\"session-id\")\n    if err != nil {\n        fmt.Println(err)\n        if strings.HasPrefix(r.URL.Path, \"/login\") {\n            Login(w, r, db) //login and create session\n        }\n   } else {\n     //Authenticate Session Then if Valid proceed to my APIs\n   }\n</code></pre>\n\n<p>So when I consume an API directly on the browser's search bar it works because it detects the session(cookie), but when I consume it on Vue/axios it doesn't detect the cookie and it gives me this error:</p>\n\n<pre><code>http: named cookie not present\nexit status 1\n</code></pre>\n\n<p>When I create a session I set the cookie <code>Path: \"/\"</code> so the session cookie is also generated to my Vue page even though my server and front end have different ports. <strong>So how can I make the server detect my session cookie on my Vue page?</strong></p>\n"}, {"tags": ["go"], "owner": {"reputation": 31, "user_id": 7700345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebd8c0ed47a5987732fb0de2c3537f44?s=128&d=identicon&r=PG&f=1", "display_name": "JAZM", "link": "https://stackoverflow.com/users/7700345/jazm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1577121737, "creation_date": 1577112930, "last_edit_date": 1577121737, "question_id": 59457298, "link": "https://stackoverflow.com/questions/59457298/ld-exe-cannot-find-lscrap-sys-when-i-try-to-compile-go-scrap", "title": "ld.exe: cannot find -lscrap_sys when I try to compile go-scrap", "body": "<p>I've been trying to compile the <a href=\"https://github.com/cretz/go-scrap\" rel=\"nofollow noreferrer\">go-scrap</a> program on windows, but I've always got the following error</p>\n\n<blockquote>\n  <p>C:/Program\n  Files/mingw-w64/x86_64-8.1.0-posix-seh-rt_v6-rev0/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/8.1.0/../../../../x86_64-w64-mingw32/bin/ld.exe:\n  cannot find -lscrap_sys collect2.exe: error: ld returned 1 exit status</p>\n</blockquote>\n\n<p>From what I understand, the <code>lscrap</code> library on windows is needed.</p>\n\n<p>Does anyone know what are the correct steps to compile the go-scrap program on windows correctly?</p>\n"}, {"tags": ["go", "proxy"], "comments": [{"owner": {"reputation": 3030, "user_id": 41704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03b9985a245e9ce334a3183a23469fce?s=128&d=identicon&r=PG", "display_name": "Anton", "link": "https://stackoverflow.com/users/41704/anton"}, "edited": false, "score": 0, "creation_date": 1577153106, "post_id": 59456936, "comment_id": 105106875, "body": "Have you tried casting the <code>Dialer</code> returned by the <code>SOCKS5</code> function to a <code>ContextDialer</code>?"}, {"owner": {"reputation": 13, "user_id": 12042846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a257bf497bc4f3239d7fbf6c993eb3ae?s=128&d=identicon&r=PG&f=1", "display_name": "qwatros", "link": "https://stackoverflow.com/users/12042846/qwatros"}, "reply_to_user": {"reputation": 3030, "user_id": 41704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03b9985a245e9ce334a3183a23469fce?s=128&d=identicon&r=PG", "display_name": "Anton", "link": "https://stackoverflow.com/users/41704/anton"}, "edited": false, "score": 0, "creation_date": 1578575879, "post_id": 59456936, "comment_id": 105488483, "body": "Can you show an example?"}], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 1, "last_activity_date": 1577113063, "creation_date": 1577113063, "answer_id": 59457330, "question_id": 59456936, "link": "https://stackoverflow.com/questions/59456936/socks5-proxy-client-with-context-support/59457330#59457330", "title": "socks5 proxy client with context support", "body": "<p>Under the hood of <code>golang.org/x/net/proxy.SOCKS5</code> it uses <code>golang.org/x/net/internal/socks.Dialer</code>, which has an exported method <code>DialContext</code>, and since Go 1.7, <code>http.Transport</code> supports a custom <code>DialContext</code> as a field. So you can cast the dialer to an interface with method <code>DialContext</code> and set it to a custom transport.</p>\n\n<pre><code>dc := dialer.(interface {\n    DialContext(ctx context.Context, network, addr string) (net.Conn, error)\n})\nhttpTransport.DialContext = dc.DialContext\n</code></pre>\n\n<p>playground: <a href=\"https://play.golang.org/p/tSi9IZ-2Zqg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tSi9IZ-2Zqg</a></p>\n\n<p>Note: while this is valid Go code, some would argue it relies on implementation details that the package does not want to export (hidden in <code>internal</code>). I think it is best to send an issue to Go team to ask for export it; if it is too much an issue for you, you can either copy the code and preserve it from changing, or use <code>http.Client.Timeout</code> or write start every <code>http.Do</code> concurrently and wraps a <code>select</code> over it for context like dealing with any blocking operation.</p>\n"}], "owner": {"reputation": 13, "user_id": 12042846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a257bf497bc4f3239d7fbf6c993eb3ae?s=128&d=identicon&r=PG&f=1", "display_name": "qwatros", "link": "https://stackoverflow.com/users/12042846/qwatros"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 572, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577153009, "creation_date": 1577111144, "last_edit_date": 1577153009, "question_id": 59456936, "link": "https://stackoverflow.com/questions/59456936/socks5-proxy-client-with-context-support", "title": "socks5 proxy client with context support", "body": "<p>Is it possible to use a context with the <code>Dialer</code> returned by the <code>SOCKS5</code> function from net/proxy library?</p>\n\n<p>If a SOCKS5 proxy <code>Dialer</code> blocks while establishing the connection, an HTTP client using the proxy <code>Dialer</code> could get stuck without a way to abort the connection.</p>\n"}, {"tags": ["json", "go", "apache-kafka"], "comments": [{"owner": {"reputation": 32481, "user_id": 2270041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cn7rq.jpg?s=128&g=1", "display_name": "Matteo", "link": "https://stackoverflow.com/users/2270041/matteo"}, "edited": false, "score": 1, "creation_date": 1577109652, "post_id": 59456589, "comment_id": 105094321, "body": "The field of the struct should be uppercase, so use <code>Field1</code> instead of <code>field1</code>"}, {"owner": {"reputation": 32481, "user_id": 2270041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cn7rq.jpg?s=128&g=1", "display_name": "Matteo", "link": "https://stackoverflow.com/users/2270041/matteo"}, "edited": false, "score": 0, "creation_date": 1577109710, "post_id": 59456589, "comment_id": 105094349, "body": "<code>The json package only accesses the exported fields of struct types (those that begin with an uppercase letter). Therefore only the the exported fields of a struct will be present in the JSON output.</code> <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">blog.golang.org/json-and-go</a>"}, {"owner": {"reputation": 11, "user_id": 12585214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f985b634cc68b7ecc6fa21a96df59264?s=128&d=identicon&r=PG&f=1", "display_name": "x1y1z1", "link": "https://stackoverflow.com/users/12585214/x1y1z1"}, "reply_to_user": {"reputation": 32481, "user_id": 2270041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cn7rq.jpg?s=128&g=1", "display_name": "Matteo", "link": "https://stackoverflow.com/users/2270041/matteo"}, "edited": false, "score": 0, "creation_date": 1577110002, "post_id": 59456589, "comment_id": 105094479, "body": "thanks , I changed fields names to uppercase. It works."}], "owner": {"reputation": 11, "user_id": 12585214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f985b634cc68b7ecc6fa21a96df59264?s=128&d=identicon&r=PG&f=1", "display_name": "x1y1z1", "link": "https://stackoverflow.com/users/12585214/x1y1z1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 660, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1596160224, "creation_date": 1577109507, "last_edit_date": 1577382857, "question_id": 59456589, "link": "https://stackoverflow.com/questions/59456589/golang-consume-json-message-from-kafka", "title": "GoLang consume json message from kafka", "body": "<p>I am running kafka localy with the following command :</p>\n\n<p><code>./bin/kafka-console-producer.sh --broker-list localhost:9092 --topic testTop</code></p>\n\n<p>after that, I send this message to the consumer in the command line:</p>\n\n<pre><code>{\n   \"field1\":\"value1\",\n   \"keys\":{\n      \"fieldId\":\"fd\",\n      \"fieldId2\":\"fd2\",\n      \"personId\":\"pr1\",\n      \"rand\":\"lkfdnvlkdsjf\"\n   }\n}\n</code></pre>\n\n<p>the message is consumed by golang client and the code unmarhsales it by struct:</p>\n\n<pre><code>type Message struct {\n    field1 string          `json:\"field1\"`\n    keys  struct {\n        fieldId string `json:\"fieldId\"`\n        fieldId2  string `json:\"fieldId2\"`\n        personId  string `json:\"personId\"`\n        rand     string `json:\"rand\"`\n    } `json:\"keys\"`\n}\n</code></pre>\n\n<p>if I unmarshal using interface: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>   var m map[string]interface{} \n     json.Unmarshal(msg.Value, &amp;m)\n</code></pre>\n\n<p>it returns :</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>     map[field1:value1 keys:map[fieldId:fd fieldId2:fd2 personId:pr1 rand:lkfdnvlkdsjf]]\n</code></pre>\n\n<p>but if I use unmarshaling with a struct pointer: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>m := Message{}  \njson.Unmarshal(msg.Value, &amp;m)\n</code></pre>\n\n<p>the output is not full like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    {value1 {   }}\n</code></pre>\n\n<p>is there a way to unmarshal the message correctly with struct pointer? </p>\n"}, {"tags": ["go", "mime-types", "content-type", "go-gin"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 2, "creation_date": 1577107687, "post_id": 59455946, "comment_id": 105093437, "body": "Yes it is good."}], "answers": [{"comments": [{"owner": {"reputation": 2211, "user_id": 788833, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/WJfHU.png?s=128&g=1", "display_name": "dmigo", "link": "https://stackoverflow.com/users/788833/dmigo"}, "edited": false, "score": 0, "creation_date": 1577112220, "post_id": 59456633, "comment_id": 105095458, "body": "Could you also add an answer to the main part of the question, so that I could accept the answer?"}, {"owner": {"reputation": 5875, "user_id": 2702398, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/87402651ed56717034035915b95c1ae0?s=128&d=identicon&r=PG&f=1", "display_name": "oakad", "link": "https://stackoverflow.com/users/2702398/oakad"}, "reply_to_user": {"reputation": 2211, "user_id": 788833, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/WJfHU.png?s=128&g=1", "display_name": "dmigo", "link": "https://stackoverflow.com/users/788833/dmigo"}, "edited": false, "score": 0, "creation_date": 1577115380, "post_id": 59456633, "comment_id": 105096810, "body": "I don&#39;t know what your application is about. In general, it seems you&#39;re talking about standard &quot;Accept-Charset&quot;/406 mechanism, which you can read about elsewhere."}, {"owner": {"reputation": 2211, "user_id": 788833, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/WJfHU.png?s=128&g=1", "display_name": "dmigo", "link": "https://stackoverflow.com/users/788833/dmigo"}, "edited": false, "score": 0, "creation_date": 1577117013, "post_id": 59456633, "comment_id": 105097475, "body": "Not exactly. <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/headers/Accept-Charset\" rel=\"nofollow noreferrer\">Accept-Charset</a> tells what charset does the client expect to get in the response. I&#39;d rather validate that client sends everything as charset=utf-8 in request."}], "tags": [], "owner": {"reputation": 5875, "user_id": 2702398, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/87402651ed56717034035915b95c1ae0?s=128&d=identicon&r=PG&f=1", "display_name": "oakad", "link": "https://stackoverflow.com/users/2702398/oakad"}, "is_accepted": true, "score": 2, "last_activity_date": 1577114799, "last_edit_date": 1577114799, "creation_date": 1577109752, "answer_id": 59456633, "question_id": 59455946, "link": "https://stackoverflow.com/questions/59455946/gin-gonic-content-type-restriction/59456633#59456633", "title": "Gin-Gonic Content-Type restriction", "body": "<p>Nothing prevents you from simply looking at the <code>\"Content-Type\"</code> http header directly, to the tune of <code>ctx.Request.Header.Get(\"Content-Type\")</code>.</p>\n\n<p>The helper <code>ContentType</code> method is provided by <code>gin-gonic</code> especially for the rather common case of querying the \"unadulterated\" mime type of incoming data without too much hassle.</p>\n"}], "owner": {"reputation": 2211, "user_id": 788833, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/WJfHU.png?s=128&g=1", "display_name": "dmigo", "link": "https://stackoverflow.com/users/788833/dmigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 729, "favorite_count": 0, "accepted_answer_id": 59456633, "answer_count": 1, "score": 1, "last_activity_date": 1577117042, "creation_date": 1577106645, "last_edit_date": 1577117042, "question_id": 59455946, "link": "https://stackoverflow.com/questions/59455946/gin-gonic-content-type-restriction", "title": "Gin-Gonic Content-Type restriction", "body": "<p>There is a service written in golang, using <a href=\"https://gin-gonic.com/\" rel=\"nofollow noreferrer\">gin-gonic</a> framework.</p>\n\n<p>I only ever want to support <code>application/json</code> as a mime-type and it would be great if it always be in UTF-8. The business logic of the service might break if it will get values in different encodings.</p>\n\n<p>Is it a good idea to write a custom middleware that checks if <code>Content-Type</code> header has value <code>\"application/json; charset=utf-8\"</code> and returns some 4xx status in case it is not?</p>\n\n<p>UPDATE:\nJust found out that <a href=\"https://gowalker.org/github.com/gin-gonic/gin#Context_ContentType\" rel=\"nofollow noreferrer\">ctx.ContentType()</a> doesn't return <code>charset</code> part of the header. Is there a way to get it?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 6283, "user_id": 434792, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/11d0482f7d0ebdbe1d42c81f7817db5d?s=128&d=identicon&r=PG", "display_name": "michaelbn", "link": "https://stackoverflow.com/users/434792/michaelbn"}, "edited": false, "score": 2, "creation_date": 1577112184, "post_id": 59456487, "comment_id": 105095439, "body": "Thanks, but its reasonable to expect other variations as well"}, {"owner": {"reputation": 111, "user_id": 7133719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bfaf34da0c8c293498e38ba2d862231?s=128&d=identicon&r=PG&f=1", "display_name": "Tugrul Bayrak", "link": "https://stackoverflow.com/users/7133719/tugrul-bayrak"}, "reply_to_user": {"reputation": 6283, "user_id": 434792, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/11d0482f7d0ebdbe1d42c81f7817db5d?s=128&d=identicon&r=PG", "display_name": "michaelbn", "link": "https://stackoverflow.com/users/434792/michaelbn"}, "edited": false, "score": 0, "creation_date": 1577112587, "post_id": 59456487, "comment_id": 105095610, "body": "Then your problem is about encoding and decoding.  That&#39;s why you can not get correct character. If you encode your string to correct format, you will solve it. check my other question here, hope it helps: <a href=\"https://stackoverflow.com/questions/59173628/reading-bytes-over-tcp-and-encoding-to-iso-8859-9-in-go/59190743#59190743\" title=\"reading bytes over tcp and encoding to iso 8859 9 in go\">stackoverflow.com/questions/59173628/&hellip;</a>  and charmap package : <a href=\"https://godoc.org/golang.org/x/text/encoding/charmap\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/text/encoding/charmap</a>"}], "tags": [], "owner": {"reputation": 111, "user_id": 7133719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bfaf34da0c8c293498e38ba2d862231?s=128&d=identicon&r=PG&f=1", "display_name": "Tugrul Bayrak", "link": "https://stackoverflow.com/users/7133719/tugrul-bayrak"}, "is_accepted": false, "score": 0, "last_activity_date": 1577109048, "creation_date": 1577109048, "answer_id": 59456487, "question_id": 59455808, "link": "https://stackoverflow.com/questions/59455808/golang-decode-string-with-literal-xnn/59456487#59456487", "title": "Golang decode string with literal \\xnn", "body": "<p>If you want to replace just this substring \"\\xE2\\x80\\x99\", strings.Replace function may solve your problem.</p>\n\n<pre><code>result := strings.Replace(text, \"\\xE2\\x80\\x99\", \"'\", -1)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6283, "user_id": 434792, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/11d0482f7d0ebdbe1d42c81f7817db5d?s=128&d=identicon&r=PG", "display_name": "michaelbn", "link": "https://stackoverflow.com/users/434792/michaelbn"}, "edited": false, "score": 0, "creation_date": 1577168845, "post_id": 59457421, "comment_id": 105109552, "body": "Nice idea! the source is an iPhone wifi hotspot broadcast as seen by the output of <code>iwlist wlan0 scan</code>"}, {"owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "reply_to_user": {"reputation": 6283, "user_id": 434792, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/11d0482f7d0ebdbe1d42c81f7817db5d?s=128&d=identicon&r=PG", "display_name": "michaelbn", "link": "https://stackoverflow.com/users/434792/michaelbn"}, "edited": false, "score": 0, "creation_date": 1577271488, "post_id": 59457421, "comment_id": 105132530, "body": "<code>strconv.Unquote</code> threw me off at first (giving <code>invalid syntax</code> as its error) because I had forgotten the surrounding quotes. Nevermind the URL encoding roundtrip. I&#39;ve updated the example."}], "tags": [], "owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "is_accepted": true, "score": 2, "last_activity_date": 1577271261, "last_edit_date": 1577271261, "creation_date": 1577113491, "answer_id": 59457421, "question_id": 59455808, "link": "https://stackoverflow.com/questions/59455808/golang-decode-string-with-literal-xnn/59457421#59457421", "title": "Golang decode string with literal \\xnn", "body": "<p>It looks like it's been escaped twice, but the surrounding quotes have been left out. <code>\\xE2\\x80\\x99</code> is a UTF-8 sequence.</p>\n\n<p>With the quotes intact, <code>strconv.Unquote</code> can unnest it.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    const text = \"\\\"Joe Doe\\\\xE2\\\\x80\\\\x99s iPhone\\\"\"\n\n    s, _ := strconv.Unquote(text)\n\n    fmt.Println(s)\n}\n</code></pre>\n\n<pre><code>Joe Doe\u2019s iPhone\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Y6zROgm3H9s\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Y6zROgm3H9s</a></p>\n"}], "owner": {"reputation": 6283, "user_id": 434792, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/11d0482f7d0ebdbe1d42c81f7817db5d?s=128&d=identicon&r=PG", "display_name": "michaelbn", "link": "https://stackoverflow.com/users/434792/michaelbn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 59457421, "answer_count": 2, "score": 1, "last_activity_date": 1577271261, "creation_date": 1577105994, "last_edit_date": 1577108170, "question_id": 59455808, "link": "https://stackoverflow.com/questions/59455808/golang-decode-string-with-literal-xnn", "title": "Golang decode string with literal \\xnn", "body": "<p>How can I convert the string <code>Joe Doe\\xE2\\x80\\x99s iPhone</code> to <code>Joe Doe\u2019s iPhone</code></p>\n\n<p>The string source is <code>regexp</code> processing the output of <code>iwlist wlan0 scan</code></p>\n\n<p>Under the hood it is:</p>\n\n<pre><code>const text  = \"Joe Doe\\\\xE2\\\\x80\\\\x99s iPhone\"\n</code></pre>\n\n<p>Thought of refeed it as literal or use packages like <code>strconv</code> but none worked.</p>\n"}, {"tags": ["unit-testing", "go", "dependency-injection"], "comments": [{"owner": {"reputation": 189551, "user_id": 5233410, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XAODw.png?s=128&g=1", "display_name": "Nkosi", "link": "https://stackoverflow.com/users/5233410/nkosi"}, "edited": false, "score": 2, "creation_date": 1577105717, "post_id": 59455474, "comment_id": 105092570, "body": "It is a matter of clean design as the problem code is currently tightly coupled to 3rd party external dependencies"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1577109135, "post_id": 59455474, "comment_id": 105094061, "body": "You can&#39;t mock or inject a package, that&#39;s not how packages work. You can mock or inject types and functions, but not packages - there is no &quot;package value&quot; you could pass."}, {"owner": {"reputation": 163, "user_id": 703524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b4c1b9fad936821590633abb2f4e816?s=128&d=identicon&r=PG", "display_name": "Wei Huang", "link": "https://stackoverflow.com/users/703524/wei-huang"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577144342, "post_id": 59455474, "comment_id": 105105593, "body": "@Adrian Okay, then what my intent was to mock the types and functions in a package. Any ideas for my questions?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577371697, "post_id": 59455474, "comment_id": 105154172, "body": "To Q1: yes, you need to DI each one. If you have one function with many dependencies, that&#39;s a code smell indicating it should be refactored. To Q2: unclear what you&#39;re asking. If your prod code isn&#39;t testable as-is, then you&#39;ll have to modify it to test it, right?"}], "answers": [{"tags": [], "owner": {"reputation": 98, "user_id": 2211841, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/0ac526bc38a8299955e0942f14c99ab3?s=128&d=identicon&r=PG", "display_name": "host.13", "link": "https://stackoverflow.com/users/2211841/host-13"}, "is_accepted": false, "score": 0, "last_activity_date": 1584562147, "creation_date": 1584562147, "answer_id": 60746840, "question_id": 59455474, "link": "https://stackoverflow.com/questions/59455474/is-didependency-injection-necessary-for-mocking-dependencies-in-golang/60746840#60746840", "title": "Is DI(dependency injection) necessary for mocking dependencies in golang?", "body": "<p>Try use vars of func types and inject them. It is easier, lesser code and interfaces are not needed. See <a href=\"https://github.com/untillpro/godif\" rel=\"nofollow noreferrer\">godif</a></p>\n"}], "owner": {"reputation": 163, "user_id": 703524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b4c1b9fad936821590633abb2f4e816?s=128&d=identicon&r=PG", "display_name": "Wei Huang", "link": "https://stackoverflow.com/users/703524/wei-huang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 276, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1584562147, "creation_date": 1577104480, "question_id": 59455474, "link": "https://stackoverflow.com/questions/59455474/is-didependency-injection-necessary-for-mocking-dependencies-in-golang", "title": "Is DI(dependency injection) necessary for mocking dependencies in golang?", "body": "<p>When I try to unit test a function as below, where <code>extern_pkg</code> is an external package to be mocked:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import \"extern_pkg\"\n\nfunc MyFunc() {\n  ...\n  extern_pkg.F()\n}\n\nfunc main() {\n  MyFunc()\n}\n</code></pre>\n\n<p>I read a few blogs, and they all seem to achieve this by modifying prod code with dependency injection. For example, as below:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type exter interface {\n  F()\n}\n\nfunc MyFunc(e exter) {\n  ...\n  e.F()\n}\n\ntype extpkg struct{}\n\nfunc (extpkg) F() {extern_pkg.F()}\n\nfunc main() {\n  epkg := extpkg{}\n  MyFunc(epkg)\n}\n</code></pre>\n\n<p>Then in test code, create a mock object that satisfies <code>exter</code> interface, and pass to <code>MyFunc</code> as parameter.</p>\n\n<p>My question is:</p>\n\n<ol>\n<li>If the <code>MyFunc</code> function contains many external packages to mock, do I need to DI each one as function parameters? Is it also true for any global variables the function depends on?</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var global_var\n\nfunc MyFunc() {\n  ...\n  extern_pkg1.F()\n  ...\n  extern_pkg2.G()\n  ...\n  extern_pkg3.H()\n  ...\n  global_var\n}\n</code></pre>\n\n<ol start=\"2\">\n<li>Is there way to avoid modifying prod code?</li>\n</ol>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "difference"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577100787, "post_id": 59453741, "comment_id": 105090564, "body": "Your title doesn&#39;t match the question at all."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 11034316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4c7bd9af9159a86a01c85a1aa6813d4?s=128&d=identicon&r=PG&f=1", "display_name": "Prathish", "link": "https://stackoverflow.com/users/11034316/prathish"}, "edited": false, "score": 0, "creation_date": 1577099392, "post_id": 59453900, "comment_id": 105090044, "body": "Thank you @Manh.  math.abs worked for  me."}], "tags": [], "owner": {"reputation": 15500, "user_id": 8486518, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QUM0SNPJsXo/AAAAAAAAAAI/AAAAAAAAABU/3rAlBsd0Qlg/photo.jpg?sz=128", "display_name": "M\u1ea1nh Quy\u1ebft Nguy\u1ec5n", "link": "https://stackoverflow.com/users/8486518/m%e1%ba%a1nh-quy%e1%ba%bft-nguy%e1%bb%85n"}, "is_accepted": true, "score": 3, "last_activity_date": 1577100762, "last_edit_date": 1577100762, "creation_date": 1577097699, "answer_id": 59453900, "question_id": 59453741, "link": "https://stackoverflow.com/questions/59453741/calculate-difference-between-two-numbers-and-get-the-absolute-value/59453900#59453900", "title": "Calculate difference between two numbers and get the absolute value", "body": "<p>Your title is misleading. It should be states without <code>negative</code> instead of <code>- operator</code>.</p>\n\n<p>Basically what you want to get is the absolute different between two numbers</p>\n\n<p>You have two options:</p>\n\n<ul>\n<li>Use if/else condition to return the positive result if the result is negative</li>\n<li>Use <a href=\"https://golang.org/pkg/math/#Abs\" rel=\"nofollow noreferrer\"><code>math.Abs</code></a> (need to convert from/to float)</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 557, "user_id": 3443964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a5db881730f94c9ff8f04a8456ffa8c?s=128&d=identicon&r=PG", "display_name": "Alik Khilazhev", "link": "https://stackoverflow.com/users/3443964/alik-khilazhev"}, "is_accepted": false, "score": 2, "last_activity_date": 1577097781, "creation_date": 1577097781, "answer_id": 59453929, "question_id": 59453741, "link": "https://stackoverflow.com/questions/59453741/calculate-difference-between-two-numbers-and-get-the-absolute-value/59453929#59453929", "title": "Calculate difference between two numbers and get the absolute value", "body": "<p>Just implement your own method</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func diff(a, b int) int {\n   if a &lt; b {\n      return b - a\n   }\n   return a - b\n}\n</code></pre>\n\n<p>and use it like this: </p>\n\n<pre><code>dollarValue := diff(240000, 480000)\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 11034316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4c7bd9af9159a86a01c85a1aa6813d4?s=128&d=identicon&r=PG&f=1", "display_name": "Prathish", "link": "https://stackoverflow.com/users/11034316/prathish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 935, "favorite_count": 0, "closed_date": 1577105284, "accepted_answer_id": 59453900, "answer_count": 2, "score": -4, "last_activity_date": 1577101426, "creation_date": 1577097074, "last_edit_date": 1577101426, "question_id": 59453741, "link": "https://stackoverflow.com/questions/59453741/calculate-difference-between-two-numbers-and-get-the-absolute-value", "closed_reason": "Needs details or clarity", "title": "Calculate difference between two numbers and get the absolute value", "body": "<p>I want to find the difference between two numbers in Go and the result should not be in \"-\".</p>\n\n<p>Please find my code below:</p>\n\n<pre><code>    dollarValue := 240000 - 480000  \n</code></pre>\n\n<p>The result is \"-240000\". But my expected output is just \"240000\". Can anybody help on how to calculate the difference between these two numbers.</p>\n"}, {"tags": ["tensorflow", "go"], "comments": [{"owner": {"reputation": 3, "user_id": 12583843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YcSGe.jpg?s=128&g=1", "display_name": "ChuckieZhu", "link": "https://stackoverflow.com/users/12583843/chuckiezhu"}, "edited": false, "score": 0, "creation_date": 1577092225, "post_id": 59452621, "comment_id": 105087064, "body": "i can found tensorflow path in GOPATH(my GOPATH is /home/go_work)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577095010, "post_id": 59452621, "comment_id": 105088239, "body": "Much better, thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 2105, "user_id": 5821408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f6ca899d084f02ac63e71e9e8711046?s=128&d=identicon&r=PG&f=1", "display_name": "shmsr", "link": "https://stackoverflow.com/users/5821408/shmsr"}, "is_accepted": true, "score": 5, "last_activity_date": 1587199247, "last_edit_date": 1587199247, "creation_date": 1577097081, "answer_id": 59453744, "question_id": 59452621, "link": "https://stackoverflow.com/questions/59452621/i-found-that-there-is-an-error-import-path-in-saved-model-go/59453744#59453744", "title": "I found that there is an error import path in saved_model.go", "body": "<p>You can look at the similar issue on Github: <a href=\"https://github.com/tensorflow/tensorflow/issues/23257\" rel=\"nofollow noreferrer\">23257</a></p>\n\n<p>So, there's no proper fix out there which is documented, until then you can try this out. I resolved my error using the following way:</p>\n\n<ol>\n<li>Run <code>go get github.com/tensorflow/tensorflow/tensorflow/go</code></li>\n</ol>\n\n<pre><code>package github.com/tensorflow/tensorflow/tensorflow/go/genop/internal/proto/github.com/tensorflow/tensorflow/tensorflow/go/core: cannot find package \"github.com/tensorflow/tensorflow/tensorflow/go/genop/internal/proto/github.com/tensorflow/tensorflow/tensorflow/go/core\" in any of:\n    /usr/local/Cellar/go/1.13.5/libexec/src/github.com/tensorflow/tensorflow/tensorflow/go/genop/internal/proto/github.com/tensorflow/tensorflow/tensorflow/go/core (from $GOROOT)\n    /Users/subhamsarkar/go/src/github.com/tensorflow/tensorflow/tensorflow/go/genop/internal/proto/github.com/tensorflow/tensorflow/tensorflow/go/core (from $GOPATH)\n</code></pre>\n\n<ol start=\"2\">\n<li>Above get surely fails to find the said package, but the repo is already cloned to your <code>GOPATH</code></li>\n<li><code>cd $GOPATH/src/github.com/tensorflow/tensorflow/tensorflow/go</code></li>\n<li><code>git checkout r1.11</code></li>\n</ol>\n\n<p>Now again run,</p>\n\n<ol start=\"5\">\n<li><code>go get github.com/tensorflow/tensorflow/tensorflow/go</code></li>\n</ol>\n\n<blockquote>\n  <p>Reason: <a href=\"https://github.com/tensorflow/tensorflow/issues/23257#issuecomment-433751410\" rel=\"nofollow noreferrer\">Discussion</a></p>\n</blockquote>\n\n<p>Also, I believe you have installed the <code>TensorFlow C library</code> which is required for the <code>TensorFlow Go package</code>.</p>\n\n<p><em>Note</em>: I tested on </p>\n\n<blockquote>\n  <p><strong>OS</strong>: MacOSX 10.15.2<br>\n  <strong>Go version</strong>: go1.13.5 darwin/amd64</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "is_accepted": false, "score": 1, "last_activity_date": 1617287836, "creation_date": 1617287836, "answer_id": 66906554, "question_id": 59452621, "link": "https://stackoverflow.com/questions/59452621/i-found-that-there-is-an-error-import-path-in-saved-model-go/66906554#66906554", "title": "I found that there is an error import path in saved_model.go", "body": "<p>Since this issue isn't getting fixed, I decided to maintain a fork: <a href=\"https://github.com/galeone/tensorflow\" rel=\"nofollow noreferrer\">https://github.com/galeone/tensorflow</a></p>\n<pre><code>go get github.com/galeone/tensorflow/tensorflow/go@r2.4-go\n</code></pre>\n<p>You can also use <a href=\"https://github.com/galeone/tfgo\" rel=\"nofollow noreferrer\">tfgo</a> that depends on the fork and it allows a simplified usage of the Go bindings:</p>\n<pre><code>go get github.com/galeone/tfgo\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 12583843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YcSGe.jpg?s=128&g=1", "display_name": "ChuckieZhu", "link": "https://stackoverflow.com/users/12583843/chuckiezhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 0, "accepted_answer_id": 59453744, "answer_count": 2, "score": -1, "last_activity_date": 1617287836, "creation_date": 1577092098, "last_edit_date": 1577092925, "question_id": 59452621, "link": "https://stackoverflow.com/questions/59452621/i-found-that-there-is-an-error-import-path-in-saved-model-go", "title": "I found that there is an error import path in saved_model.go", "body": "<p>problem: </p>\n\n<p>in github:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"runtime\"\n    \"unsafe\"\n\n    \"github.com/golang/protobuf/proto\"\n\n    tfpb \"github.com/tensorflow/tensorflow/tensorflow/go/genop/internal/proto/github.com/tensorflow/tensorflow/tensorflow/go/core\"\n)\n</code></pre>\n\n<p>what's this(tfpb \"github.com/tensorflow/tensorflow/tensorflow/go/genop/internal/proto/github.com/tensorflow/tensorflow/tensorflow/go/core\") ?\nI cannot find it in anywhere , so can my program\nHow can I solve this problem</p>\n\n<p>there is details:\ntoday I try to install tensorflow for Go and execute it, I use this cmd:</p>\n\n<p><code>go get github.com/tensorflow/tensorflow/tensorflow/go</code></p>\n\n<p>then i test tf for go:</p>\n\n<p><code>go test github.com/tensorflow/tensorflow/tensorflow/go</code></p>\n\n<p>(according with this site: <a href=\"https://www.tensorflow.org/install/lang_go\" rel=\"nofollow noreferrer\">tensorflow</a>)</p>\n\n<p>but i got this message:</p>\n\n<blockquote>\n  <p>cannot find package \"github.com/tensorflow/tensorflow/tensorflow/go/genop/internal/proto/github.com/tensorflow/tensorflow/tensorflow/go/core\" in any of:\n  /home/go/src/github.com/tensorflow/tensorflow/tensorflow/go/genop/internal/proto/github.com/tensorflow/tensorflow/tensorflow/go/core (from $GOROOT)</p>\n  \n  <h2>/home/go_work/src/github.com/tensorflow/tensorflow/tensorflow/go/genop/internal/proto/github.com/tensorflow/tensorflow/tensorflow/go/core (from $GOPATH)</h2>\n</blockquote>\n\n<p>then i visit github then i cannot find this path , How can I solve this problem\uff1f\nthanks for you guys.!</p>\n"}, {"tags": ["go", "import", "package", "survival", "end-of-life"], "comments": [{"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "reply_to_user": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "edited": false, "score": 0, "creation_date": 1577081628, "post_id": 59450493, "comment_id": 105083929, "body": "@KamolHasan glad u too :D :D Sadly we have juniors that have tried to develop programming ;anguage, without knowing even internet.. True dev shouldn&#39;t be like that, it should at least investigate!.. I think we should launch a bugreport on potential oxygen bug in go packaging dev community,."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 3, "creation_date": 1577082599, "post_id": 59450493, "comment_id": 105084180, "body": "Use domain imports with help of go module by using <code>replace</code> verb or a goproxy (which can be based on filesystem without help of git) instead of local import (don&#39;t know why that would kill you); copy everything into the standard library and re-compile go compiler; hack the go compiler source to allow local imports; grab an older version of go compiler that allows local imports; write a go tool to parse the source of your code and pack every imports into a single package with added prefix to their namespace; pick one. Without knowing what to tradeoff, there are almost endless possibilities."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1577082818, "post_id": 59450493, "comment_id": 105084228, "body": "Or simply put it into <code>GOPATH</code> and set <code>GO11MODULE=off</code>. Haven&#39;t tried it for long time, don&#39;t know if it works with current or incoming version of official Go compiler."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1577085397, "post_id": 59450493, "comment_id": 105085002, "body": "@xakepp35 use go module would be the least time consuming to me, including time taken to learn it. The only faster hacking I can think of is to compile <code>oxygenapi</code> into a c-shared mode (<code>.so</code> or <code>.dll</code>) and load it using c or cgo. But frankly, I don&#39;t see what&#39;s so difficult using go mod, the document is provided with the compiler."}, {"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1577085623, "post_id": 59450493, "comment_id": 105085072, "body": "@leafbebop yes, as you&#39;ve guessed, its all about hacking. so does go has something like dynamic|shared linking, as you&#39;ve stated (compile it to something, then link..) if so, please could you suppose minimal required amount of actions, required for team to survive?"}, {"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1577085666, "post_id": 59450493, "comment_id": 105085085, "body": "our imaginary team must call function from <code>main</code> to go module , lets it be called <code>oxygenapi.ResumeOxygenSupply()</code> so they can survive. Anyone who is talking about <i>local imports vs global vs whatsoever</i> - he is alredy dead -  so not worth even listening to!. How can we our lucky lintening group?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1577086007, "post_id": 59450493, "comment_id": 105085197, "body": "@xakepp35 so you need to learn about how to hacking it with c-shared? Learn go module - it is simpler. But since time cost for  learning go module is lethal, I can only wish you luck."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1577087262, "post_id": 59450493, "comment_id": 105085555, "body": "@xakepp35 if it&#39;s a one time use, c-shared mode is endurable, but for everyday use, it is almost using another language and without type safety and other go guarantees. So really, just learn go module, it only take 20 minutes or so."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1577087671, "post_id": 59450493, "comment_id": 105085659, "body": "@xakepp35 for this case, you just need <code>go mod init &quot;tm.p&#47;x&quot; and change import to </code>import &quot;tm.p/x/oxygenapi&quot;` and that&#39;s all."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1577098623, "post_id": 59450493, "comment_id": 105089739, "body": "Read The Friendly Doc ?"}, {"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1577149273, "post_id": 59450493, "comment_id": 105106314, "body": "Hey, sorry for my vast imagination (actually i feel its best i have, so its only a figure of speech) but this question has exact point of how to do local imports, and it throws out answers like &quot;dont use local imports&quot;, so its really not only a a good question, but can be kind of a developement hint, modelling some situation to a degree of reality. god knows how would it go further, and we have to develop at the best edge of our efforts. prohibiting local imports makes language internet-dependent, so unusable under certain circumstances (even where it could and should be used!)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577179329, "post_id": 59450493, "comment_id": 105112712, "body": "&quot;this question has exact point of how to do local imports&quot; -- Yes, and you already know the answer is that local imports are not supported in Go, because that question is a <a href=\"https://stackoverflow.com/q/59437314/13860\">duplicate of this one</a> you asked earlier."}, {"owner": {"reputation": 88, "user_id": 2517239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/093425b54d55413832db7fdd671d2d74?s=128&d=identicon&r=PG", "display_name": "jimkokko5", "link": "https://stackoverflow.com/users/2517239/jimkokko5"}, "edited": false, "score": 0, "creation_date": 1605279792, "post_id": 59450493, "comment_id": 114609963, "body": "Thank you for this question. Thank you."}], "answers": [{"comments": [{"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1577149499, "post_id": 59451608, "comment_id": 105106345, "body": "Probably, yes. Just have to research links you&#39;ve provided. Answer is accepted due to great links amount and possibility to research information. Luckily we haven&#39;tnuclear war destroyed internet for now ;-)"}, {"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1577150784, "post_id": 59451608, "comment_id": 105106556, "body": "There is a check somewhere, checking for a dot in import name. How could we eliminate it? Its not a compiler/importer error, its more like an error in minds! Go could get rid of it! How could we aid this?"}], "tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": true, "score": 6, "last_activity_date": 1614927079, "last_edit_date": 1614927079, "creation_date": 1577086410, "answer_id": 59451608, "question_id": 59450493, "link": "https://stackoverflow.com/questions/59450493/imagine-youve-survived-nuclear-war-and-you-have-to-reconfigure-golang-program/59451608#59451608", "title": "Imagine you&#39;ve survived nuclear war, and you have to RECONFIGURE golang program to use local modules at any cost", "body": "<p>Of course it is possible to use Go completely offline, the domains in package names are just names.</p>\n<p>You should set up a Go module using <code>go mod init somename</code>, where somename is a name you can pick. Usually this is a domain name; however, the command doesn't check if it even exists.</p>\n<p>After that, you should be able to import your submodule with the path <code>somename/oxygenapi</code> (from <code>main.go</code>).</p>\n<p>As soon as you downloaded your dependencies using <code>go mod vendor</code>, your build process can use <code>go build -mod vendor</code> to build the program - without connecting to the internet, ever. Also see:</p>\n<ul>\n<li><a href=\"https://github.com/golang/go/wiki/Modules#how-do-i-use-vendoring-with-modules-is-vendoring-going-away\" rel=\"nofollow noreferrer\">How do I use vendoring with modules? Is vendoring going away?</a></li>\n<li><a href=\"https://tip.golang.org/cmd/go/#hdr-Make_vendored_copy_of_dependencies\" rel=\"nofollow noreferrer\">Make vendored copy of dependencies</a></li>\n<li><a href=\"https://tip.golang.org/cmd/go/#hdr-Modules_and_vendoring\" rel=\"nofollow noreferrer\">Modules and vendoring</a></li>\n</ul>\n<p>You can find out more on <a href=\"https://github.com/golang/go/wiki\" rel=\"nofollow noreferrer\">the Go wiki</a>, and more specialized for your use case there is <a href=\"https://github.com/golang/go/wiki/Modules#do-modules-work-with-relative-imports-like-import-subdir\" rel=\"nofollow noreferrer\">this answer</a> on why your setup doesn't work right now.</p>\n<p>There is also <a href=\"https://stackoverflow.com/q/58697521\">this question</a> on how to use packages locally/offline, which makes it possible to move a project directory to another pc without go-getting anything on the other machine.</p>\n"}, {"tags": [], "owner": {"reputation": 2042, "user_id": 11424673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ecf0fd0aa656482af8bc20d0d22c88?s=128&d=identicon&r=PG&f=1", "display_name": "Hymns For Disco", "link": "https://stackoverflow.com/users/11424673/hymns-for-disco"}, "is_accepted": false, "score": 2, "last_activity_date": 1577089722, "creation_date": 1577089722, "answer_id": 59452161, "question_id": 59450493, "link": "https://stackoverflow.com/questions/59450493/imagine-youve-survived-nuclear-war-and-you-have-to-reconfigure-golang-program/59452161#59452161", "title": "Imagine you&#39;ve survived nuclear war, and you have to RECONFIGURE golang program to use local modules at any cost", "body": "<p>Interesting question...\nLets remember that <code>go get</code> is a go tool that is a tightly bound part of the established Go ecosystem, but its not <em>really</em> part of the Go language.  As with most languages, you can't use any code in your go program unless you have a local copy of it.  When compiling a Go program, you may use other code that maybe you didn't necessarily write, or came into possession of in a rather hand-wavy kind of way (go get), but in essence it's just a source code file located somewhere on your machine same as any code that you may have written yourself.  So any program that is valid to build on your local machine, will still be valid regardless of whether you have an internet connection, or if the internet still exists.</p>\n\n<p>You've used the word \"reconfigure\", which is a bit strange here.  Just because you have an import path that resembles a web address doesn't mean that's its ephemeral in the context of your local machine, unless the nuclear war also caused parts of your file-space to be corrupt, in which case I wish you luck.</p>\n"}], "owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "delete_vote_count": 2, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 2, "closed_date": 1577090170, "accepted_answer_id": 59451608, "answer_count": 2, "score": -10, "last_activity_date": 1614927079, "creation_date": 1577078601, "last_edit_date": 1577150434, "question_id": 59450493, "link": "https://stackoverflow.com/questions/59450493/imagine-youve-survived-nuclear-war-and-you-have-to-reconfigure-golang-program", "closed_reason": "Needs more focus", "title": "Imagine you&#39;ve survived nuclear war, and you have to RECONFIGURE golang program to use local modules at any cost", "body": "<p>Question focus is at the end of title. Tried best of my imagination.</p>\n\n<p>Imagine you've survived nuclear war, and you're only survivors team, in your automated vault, which operational logic is occasionally written in golang.</p>\n\n<p>Now your vault have some problem withc oxygen supply (within vault), due to a (now well known) code bug. And as a programmer, you should <strong>definetely</strong> fix it! You will surely have a problems, defining what <code>github.com/...</code> or <code>mydomain.com</code> is, there is no internet anymore, neither you want to bother with domains locally!</p>\n\n<p>You have following folder structure:</p>\n\n<pre><code>vault/\n    main.go\n    oxygenapi/\n        oxygenapi.go\n</code></pre>\n\n<p>Inside <code>main.go</code> you do have:</p>\n\n<pre><code>package main\n\nimport \"./oxygenapi\"\n\n...\n</code></pre>\n\n<p>And <code>oxygenapi.go</code> just starts with:</p>\n\n<pre><code>package oxygenapi\n\n...\n</code></pre>\n\n<p>Normally, wou wont like to simulate local <code>git</code> server (git sources were burned, during nuclear war, there is no single source of them, and you had everything on git, just some local copy of your working source tree)</p>\n\n<p>You now just want import system to work, because it is related to oxygen supply. You have no time! And now, imagine that it's vital to revive it as soon as possible!</p>\n\n<p>But you cant recompile it anymore, because no internet exists anymore. It gives following error: </p>\n\n<pre><code>D:\\vault&gt; go run .\nbuild _/D_/vault/oxygenapi: cannot find module for path _/D_/vault/oxygenapi\n</code></pre>\n\n<p>SHOULD I\"VE WRITE IT IN C? PASCAL? VISUAL BASIC? why we ever choosed go?.. Should this language survive?</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "edited": false, "score": 0, "creation_date": 1577087757, "post_id": 59449568, "comment_id": 105085682, "body": "what have you tried so far?"}], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 10643528, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "huangapple", "link": "https://stackoverflow.com/users/10643528/huangapple"}, "edited": false, "score": 0, "creation_date": 1577268850, "post_id": 59466643, "comment_id": 105131954, "body": "what is the mongodb driver addr?  i be limit this driver <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo\" rel=\"nofollow noreferrer\">godoc.org/go.mongodb.org/mongo-driver/mongo</a>"}, {"owner": {"reputation": 79, "user_id": 10643528, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "huangapple", "link": "https://stackoverflow.com/users/10643528/huangapple"}, "edited": false, "score": 0, "creation_date": 1577269023, "post_id": 59466643, "comment_id": 105131991, "body": "this is fetch then update, it is 1+n number command? mongo is not like mysql one command to do it ?"}, {"owner": {"reputation": 98, "user_id": 10993848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hEwPt.jpg?s=128&g=1", "display_name": "Shivang Goswami", "link": "https://stackoverflow.com/users/10993848/shivang-goswami"}, "reply_to_user": {"reputation": 79, "user_id": 10643528, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "huangapple", "link": "https://stackoverflow.com/users/10643528/huangapple"}, "edited": false, "score": 0, "creation_date": 1577269109, "post_id": 59466643, "comment_id": 105132017, "body": "Yes this is for the same mongo go driver you have mentioned in your query"}, {"owner": {"reputation": 98, "user_id": 10993848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hEwPt.jpg?s=128&g=1", "display_name": "Shivang Goswami", "link": "https://stackoverflow.com/users/10993848/shivang-goswami"}, "reply_to_user": {"reputation": 79, "user_id": 10643528, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "huangapple", "link": "https://stackoverflow.com/users/10643528/huangapple"}, "edited": false, "score": 0, "creation_date": 1577296909, "post_id": 59466643, "comment_id": 105138195, "body": "Either connect to a mongo shell via go program and execute the query. Using mongo go driver, a for each method along with find is not available last time I checked. May be you can create a jira ticket in the mongo go portal and they will introduce this features in the further updates."}], "tags": [], "owner": {"reputation": 98, "user_id": 10993848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hEwPt.jpg?s=128&g=1", "display_name": "Shivang Goswami", "link": "https://stackoverflow.com/users/10993848/shivang-goswami"}, "is_accepted": false, "score": 0, "last_activity_date": 1577179946, "creation_date": 1577179946, "answer_id": 59466643, "question_id": 59449568, "link": "https://stackoverflow.com/questions/59449568/how-to-update-the-specified-number-of-documents-in-mongo-driver-go-just-like-mys/59466643#59466643", "title": "How to update the specified number of documents in mongo-driver-go just like mysql `update table set filed = dxx limit 50 `", "body": "<p>Using Mongo DB Shell, We can use this query:<br>\n    <code>db.collection.find().limit(NUMBER_OF_ITEMS_YOU_WANT_TO_UPDATE).forEach( \n    function (element) { \n    element.newField = newData; \n    db.collection.save(element); \n    });</code></p>\n\n<p>To implement the same thing using mongo go driver,<br></p>\n\n<blockquote>\n  <p>1.Fetch the required records with Collection.find() Method using limit in find options<br>\n  2.Use the cursor of find query and Append the required Update queries in []mongo.WriteModel <br>\n  3.Execute collection.BulkWrite() Method with []mongo.WriteModel Slice as input and use the BulkWriteResult returned.</p>\n</blockquote>\n"}], "owner": {"reputation": 79, "user_id": 10643528, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "huangapple", "link": "https://stackoverflow.com/users/10643528/huangapple"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1577179946, "creation_date": 1577068000, "question_id": 59449568, "link": "https://stackoverflow.com/questions/59449568/how-to-update-the-specified-number-of-documents-in-mongo-driver-go-just-like-mys", "title": "How to update the specified number of documents in mongo-driver-go just like mysql `update table set filed = dxx limit 50 `", "body": "<p>How to update the specified number of documents in Mongo just like mysql </p>\n\n<pre><code>update table set filed = dxx limit 50\n</code></pre>\n\n<p>use this go version mongo-driver\n <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo\" rel=\"nofollow noreferrer\">https://godoc.org/go.mongodb.org/mongo-driver/mongo</a></p>\n"}, {"tags": ["rest", "go", "get"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577109429, "post_id": 59449478, "comment_id": 105094220, "body": "It depends entirely on the API you&#39;re accessing, REST has no opinion on the matter. REST just says requests are stateless and resources are identified by URI."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 8202235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/405d5f5ba422f628fd2d7aa84827eb05?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Jones", "link": "https://stackoverflow.com/users/8202235/patrick-jones"}, "edited": false, "score": 0, "creation_date": 1577397627, "post_id": 59450341, "comment_id": 105161729, "body": "Thanks for the feedback!  This may seem like a silly question, but since I was learning REST entirely on my own it was hard to know how literally to interpret some of the different provisions."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1577099573, "last_edit_date": 1577099573, "creation_date": 1577077158, "answer_id": 59450341, "question_id": 59449478, "link": "https://stackoverflow.com/questions/59449478/specifying-data-structure-in-a-rest-query/59450341#59450341", "title": "Specifying data structure in a REST query", "body": "<p>I believe you are reading REST principles incorrectly. </p>\n\n<p>REST is an architecture, not a protocol with strict rules. The key points are that it is stateless and that it represents the underlying resources similar to how the web operates.</p>\n\n<p>REST describes resources (<code>datum</code>, in your case), how you can access and modify those resources, and how those resources should describe what other resources can be accessed relative to that resource. This is similar to how web browsing works: each page has a unique URI, and the page may contain data (fields of <code>datum</code>), and links to other pages you can reach from that page.</p>\n\n<p>So in your case, the fields of <code>datum</code> is analogous to the contents of a web page. If you have other resources reachable from the <code>datum</code>, then you have to provide those as URIs to the caller, and the caller can follow them. That doesn't mean that you have to give up type safety and deal with all kinds of data. Again, this is not a protocol. If the information submitted is not in the expected format, you should return an error. Since your communication format is JSON, your data types are limited to a string, number, and boolean. You are expecting an integer for ID, and if the client sends you a string (even if it is something like \"123\"), it is an error. Use the first struct, if unmarshaling the input returns an error, return that to the caller.</p>\n"}], "owner": {"reputation": 11, "user_id": 8202235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/405d5f5ba422f628fd2d7aa84827eb05?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Jones", "link": "https://stackoverflow.com/users/8202235/patrick-jones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1577099743, "creation_date": 1577066855, "last_edit_date": 1577099743, "question_id": 59449478, "link": "https://stackoverflow.com/questions/59449478/specifying-data-structure-in-a-rest-query", "title": "Specifying data structure in a REST query", "body": "<p>I'm trying to write a basic REST-style query for a database in Go.  I've never worked with REST before, so I'm a bit unclear as to how deeply the principle about being able to handle any kind of data is supposed to go.  Does it violate the principle to make assumptions about the data/data types I'm getting from the database in the code for the client? Should I write the former or the latter <em>struct</em> to unpack the JSON data into?</p>\n\n<pre><code>type datum struct {\n    ID      int16 `json:\"src_id\"`\n    Time    int64 `json:\"timestamp\"`\n    Lat     float64 `json:\"latitude\"`\n    Long    float64 `json:\"longitude\"`\n    Thermo  float64 `json:\"ir_thermo_temperature_filtered\"`\n    Humid   float64 `json:\"relative_humidity\"`\n    AirTemp float64 `json:\"air_temp\"`\n    Wind    float64 `json:\"wind_speed_world_filtered\"`\n}\n\ntype datum struct {\n    ID      interface{} `json:\"src_id\"`\n    Time    interface{} `json:\"timestamp\"`\n    Lat     interface{} `json:\"latitude\"`\n    Long    interface{} `json:\"longitude\"`\n    Thermo  interface{} `json:\"ir_thermo_temperature_filtered\"`\n    Humid   interface{} `json:\"relative_humidity\"`\n    AirTemp interface{} `json:\"air_temp\"`\n    Wind    interface{} `json:\"wind_speed_world_filtered\"`\n}\n</code></pre>\n\n<p>My thinking is that maybe the latter struct violates REST principles because it makes assumptions about the data types that you'd be receiving from the server, so it isn't properly uniform.  I'm hoping I'm not correct, but I can see that conclusion could come from a strict reading of the REST principles.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1577066360, "post_id": 59449142, "comment_id": 105081564, "body": "Because of daylight saving time, the difference in local times varies. Therefore, without a date, there is no answer to your question."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1577107097, "post_id": 59449142, "comment_id": 105093153, "body": "An example of the difference in local times because of differences in daylight saving time transition dates: <a href=\"https://play.golang.org/p/FmaWx7pzNIi\" rel=\"nofollow noreferrer\">play.golang.org/p/FmaWx7pzNIi</a>"}], "answers": [{"comments": [{"owner": {"reputation": 401, "user_id": 8002010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6796fea327cab9ac13e660bf3a9b67b?s=128&d=identicon&r=PG&f=1", "display_name": "rvl007", "link": "https://stackoverflow.com/users/8002010/rvl007"}, "edited": false, "score": 0, "creation_date": 1577062992, "post_id": 59449224, "comment_id": 105081123, "body": "Its possible to convert time.Now to the desired location. But when you have time hh:mm:ss in string and converting that to time.Time and then parsing in the desired location is difficult. Thats what I am looking for"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 401, "user_id": 8002010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6796fea327cab9ac13e660bf3a9b67b?s=128&d=identicon&r=PG&f=1", "display_name": "rvl007", "link": "https://stackoverflow.com/users/8002010/rvl007"}, "edited": false, "score": 0, "creation_date": 1577063159, "post_id": 59449224, "comment_id": 105081145, "body": "time.Now().In(location) should work. I don&#39;t understand the rest of the question, is that not what you describe above already?"}, {"owner": {"reputation": 401, "user_id": 8002010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6796fea327cab9ac13e660bf3a9b67b?s=128&d=identicon&r=PG&f=1", "display_name": "rvl007", "link": "https://stackoverflow.com/users/8002010/rvl007"}, "edited": false, "score": 0, "creation_date": 1577063390, "post_id": 59449224, "comment_id": 105081172, "body": "I don&#39;t want to convert time.Now() which is possible according to the answer provided, but I want to convert time in <code>07:00:00 Australia&#47;Melbourne</code> format. Edited the question. I hope it&#39;s clear"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 401, "user_id": 8002010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6796fea327cab9ac13e660bf3a9b67b?s=128&d=identicon&r=PG&f=1", "display_name": "rvl007", "link": "https://stackoverflow.com/users/8002010/rvl007"}, "edited": false, "score": 0, "creation_date": 1577063693, "post_id": 59449224, "comment_id": 105081217, "body": "AFAIK, there is no way to parse/format location information. What you did already is the simplest way I know. Time format works with offsets or time zones, not locations."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1577066638, "post_id": 59449224, "comment_id": 105081594, "body": "@BurakSerdar: For the difference in local times, which varies, your answer makes no sense."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1577068402, "post_id": 59449224, "comment_id": 105081804, "body": "@peterSO the solution gives the differences as of local now, doesn&#39;t it?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1577071197, "post_id": 59449224, "comment_id": 105082199, "body": "@BurakSerdar: As you said: &quot;things <b>seem</b> to work.&quot; The worst kind of bug. When is it useful to know the answer for the date a millisecond or so before the calculation was performed? When is it not useful? What are the consequnces if it&#39;s wrong? Details matter."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1577073058, "post_id": 59449224, "comment_id": 105082436, "body": "@peterSO, the solution uses local times for two different locations. If you take the current date in one of those locations, add the given time, and get the time in the second location, the difference is valid, is it not? <code>Time.In(loc)</code> looks the the DST for the locations."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577083734, "post_id": 59449224, "comment_id": 105084479, "body": "There is a problem that occurs around transition times. The time &quot;01:23:45&quot; occurs twice in two different hours in time zone &quot;America/New_York&quot; on one particular fall day (eg Nov 3 2019) (and no times at all in one one-day period in spring). Given that time string, and the string &quot;America/New_York&quot;, you cannot tell whether the 1-AM was the one that was in EST, or the subsequent one an hour later in EDT. If you don&#39;t mind this ambiguity, the remainder of the problem is solvable."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1577105255, "post_id": 59449224, "comment_id": 105092361, "body": "@BurakSerdar: No. As I said, the difference can and does vary. The daylight saving time transition (start, end) dates don&#39;t match in this case and others. <a href=\"https://en.wikipedia.org/wiki/Daylight_saving_time_by_country\" rel=\"nofollow noreferrer\">Daylight saving time by country</a>. The synchronized and unsynchronized time difference are not the same."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1577106962, "post_id": 59449224, "comment_id": 105093094, "body": "@BurakSerdar: An example: When it  is 07 in Melbourne, is it 15 or 16 in New York? <a href=\"https://play.golang.org/p/FmaWx7pzNIi\" rel=\"nofollow noreferrer\">play.golang.org/p/FmaWx7pzNIi</a>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577107598, "post_id": 59449224, "comment_id": 105093404, "body": "@torek: &quot;the remainder of the problem is solvable.&quot; See my comments."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1577118635, "post_id": 59449224, "comment_id": 105098202, "body": "@peterSO Right, it&#39;s solveable except for the ambiguity. If you have a time zone database (which Go does, it has the Olson DB), you can tell, given the location, day of year, and time of day, whether some DST shift is in effect and if so, how big the DST shift is ... <i>except</i> for certain ambiguous hours that occur twice. The transition times and their shifts are all findable from the data in the Olson DB. Actually <i>solving</i> this is kind of a pain and pointless if you&#39;re willing to put up with huge amounts of time-slop, and since you <i>can&#39;t</i> solve it for the ambiguous times... <i>shrug</i>"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577118738, "post_id": 59449224, "comment_id": 105098249, "body": "The <i>right</i> way to do this is to have the time stamps themselves in universal time in the first place and/or to have them record whether some DST shift is in effect locally. That removes the ambiguity, hence the need for huge amounts of time-slop, and also removes the need to grub through the DB to see if the supplied time was ambiguous in the first place."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1577062763, "creation_date": 1577062763, "answer_id": 59449224, "question_id": 59449142, "link": "https://stackoverflow.com/questions/59449142/time-in-string-to-time-time/59449224#59449224", "title": "Time in string to time.Time", "body": "<p>With this time arithmetic, you are getting into negative time values. It looks like the results are not well-defined for negative times. If you take the current date as the baseline, things seem to work. After parsing the time:</p>\n\n<pre><code>now:=time.Now()\nparsedTime=time.Date(now.Year(),now.Month(),now.Day(),parsedTime.Hour(),parsedTime.Minute(),parsedTime.Second(),parsedTime.Nanosecond(),loc)\namericaLocation, _ := time.LoadLocation(\"America/New_York\")\nresultTime := parsedTime.In(americaLocation)\n</code></pre>\n"}], "owner": {"reputation": 401, "user_id": 8002010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6796fea327cab9ac13e660bf3a9b67b?s=128&d=identicon&r=PG&f=1", "display_name": "rvl007", "link": "https://stackoverflow.com/users/8002010/rvl007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "closed_date": 1577081763, "answer_count": 1, "score": -2, "last_activity_date": 1577063260, "creation_date": 1577061773, "last_edit_date": 1577063260, "question_id": 59449142, "link": "https://stackoverflow.com/questions/59449142/time-in-string-to-time-time", "closed_reason": "Needs details or clarity", "title": "Time in string to time.Time", "body": "<p>I have a time string in the format of <code>07:00:00 Australia/Melbourne</code> and I want to convert it to respective <code>America/New_York</code> time. I have tried below code:</p>\n\n<pre><code>func parseLocation(timeStr string, location string) {\n    loc, err := time.LoadLocation(location)\n    if err != nil {\n        log.Fatal(err)\n    }\n    var parsedTime time.Time\n    hour, err := strconv.Atoi(timeStr[:2])\n    if err != nil {\n        log.Errorf(\"error converting to int %v\", err)\n    }\n    if hour &gt;= 10 {\n        parsedTime, err = time.ParseInLocation(\"15:04:05\", timeStr, loc)\n    } else {\n        parsedTime, err = time.ParseInLocation(\"03:04:05\", timeStr, loc)\n    }\n    if err != nil {\n        log.Errorf(\"error parsing %v\", err)\n    }\n    americaLocation, _ := time.LoadLocation(\"America/New_York\")\n    resultTime := parsedTime.In(americaLocation)\n    return resultTime\n}\n\nfunc main(){\n    x := strings.Split(\"07:00:00 Australia/Melbourne\", \" \")\n    parseLocation(x[0], x[1])\n}\n</code></pre>\n\n<p>Converting hh:mm:ss in time.Time gives me <code>0000-01-01 07:00:00 +0000 UTC</code> which I need to convert it to other timezone which ends up giving vague output.</p>\n\n<p>I want to parse the time format in the form <code>\"07:00:00\"</code> in time.Time format. Any suggestion for doing it in better way will be much appreciated. Thanks!</p>\n"}, {"tags": ["windows", "go", "dll"], "comments": [{"owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "edited": false, "score": 1, "creation_date": 1577060277, "post_id": 59448942, "comment_id": 105080710, "body": "Personally I wouldn&#39;t call an exported function from a Go executable from VBA. VBA has its own COM-friendly threading model, but the Go runtime has its own, conflicting, ideas about how threads should work. I don&#39;t know what guarantees Go makes about C-style exports from a Go program, but I think the best way to interop with a Go program from VBA is to run it as a separate process and communicate via stdin/stdout or system-provided pipes using a standard serialization format (e.g. JSON)."}, {"owner": {"reputation": 569, "user_id": 617258, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f4efef7ac4c9b1822ed23a16a8a1a416?s=128&d=identicon&r=PG&f=1", "display_name": "RomnieEE", "link": "https://stackoverflow.com/users/617258/romnieee"}, "reply_to_user": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "edited": false, "score": 0, "creation_date": 1577061758, "post_id": 59448942, "comment_id": 105080939, "body": "Thanks for the comments. I couldn&#39;t remember where dlls I&#39;ve had declared in VBA in the past were put. (I thought that this way might better find the dependencies... .) The relevance of VBA is flexible for me. I make tools for personal or desk use in VBA. I was thinking about trying to utilize concurrency via a dll in VBA (since it&#39;s single-threaded). But ultimately I did mean my functions to be deployed on an enterprise level. I&#39;m on the modeling side. Managers (non-technical) are pushing me towards R or python. I wanted a compiled proof of concept."}, {"owner": {"reputation": 569, "user_id": 617258, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f4efef7ac4c9b1822ed23a16a8a1a416?s=128&d=identicon&r=PG&f=1", "display_name": "RomnieEE", "link": "https://stackoverflow.com/users/617258/romnieee"}, "reply_to_user": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "edited": false, "score": 0, "creation_date": 1577062456, "post_id": 59448942, "comment_id": 105081043, "body": "I should say that the ultimate enterprise environment is centered on Oracle and Oracle R. (And there&#39;s potential support for Python with IT reluctant about it.) I don&#39;t know how infrastructure works at that level (I work at the algorithm level, not the system level). My notion was just to translate my VBA model (monte carlo) into a compiled form, and that Go looked a lot less daunting to take up than C++. And then argue later about how to deploy it. And avoid R and Python."}, {"owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "edited": false, "score": 0, "creation_date": 1577063752, "post_id": 59448942, "comment_id": 105081227, "body": "The system will load a module referenced by file-name (rather than file-path) by checking every directory listed in the <code>PATH</code> environment variable of the host process - by default on Windows this includes <code>C:\\Windows\\System32</code> - but it is very, very bad practice to place files in that directory just to ensure modules can be loaded by file-name alone."}, {"owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "edited": false, "score": 0, "creation_date": 1577063752, "post_id": 59448942, "comment_id": 105081228, "body": "The system will load a module referenced by file-name (rather than file-path) by checking every directory listed in the <code>PATH</code> environment variable of the host process - by default on Windows this includes <code>C:\\Windows\\System32</code> - but it is very, very bad practice to place files in that directory just to ensure modules can be loaded by file-name alone."}], "owner": {"reputation": 569, "user_id": 617258, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f4efef7ac4c9b1822ed23a16a8a1a416?s=128&d=identicon&r=PG&f=1", "display_name": "RomnieEE", "link": "https://stackoverflow.com/users/617258/romnieee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 187, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1577059289, "creation_date": 1577059067, "last_edit_date": 1577059289, "question_id": 59448942, "link": "https://stackoverflow.com/questions/59448942/call-go-function-from-vba-via-dll", "title": "Call Go function from VBA via DLL", "body": "<p>I'm brand new to Go and am not experienced in compilation issues or with C++. So starting from zero, I'm trying to compile a dll in Go and call a function in VBA. I'm developing the Go in Linux, and switching computers to try it in Windows. The VBA part may not be essential. It does serve as a way for me to test the dll call. </p>\n\n<p>Here's the simple Go code: </p>\n\n<pre><code>  package main\n\n  import (\n      \"C\"\n      \"fmt\"\n  )\n\n  func main() {\n      var x int\n      x = Test()\n      fmt.Println(x)\n  }\n\n  func Test() int {\n      return 666\n  }\n</code></pre>\n\n<p>It works for <code>go build</code>, <code>go install</code>, and calling <code>main</code> from the console. </p>\n\n<p>I compile with these two commands, which both run without error, in this order. Should I be running both of them? (I'm way out of my depth here.) The target system is Windows 10, 64 bit with Office 365 ProPlus (but is Excel fundamentally 32 bit?): </p>\n\n<p><code>env GOOS=windows GOARCH=386 CGO_ENABLED=1 CC=i686-w64-mingw32-gcc go build -buildmode=c-shared -o hello.dll hello.go</code></p>\n\n<p><code>env GOOS=windows GOARCH=amd64 CGO_ENABLED=1 CC=x86_64-w64-mingw32-gcc go build -buildmode=c-shared -o hello.dll hello.go</code></p>\n\n<p>I copy the file, <code>hello.dll</code>, to <code>System32</code> and in VBA I declare: </p>\n\n<p><code>Public Declare Function Test Lib \"C:\\Windows\\System32\\hello.dll\" () as Long</code></p>\n\n<p>I get the error of Run-time error '53': File Not Found, which I understand may be caused by a missing dependency. </p>\n\n<p>So I run Dependency Walker. This shows me a top level of HELLO.DLL and 4 levels under it of KERNEL32.DLL, MSVCRT.DLL, WINMM.DLL, WS2_32.DLL. And it gives: </p>\n\n<pre><code>Error: At least  one required implicit or forwarded depende3ncy was not found. \nWarning: At least one delay-load dependency module was not found.\nWarning: At least one module has an unresovled import due to a missing export function in a a delay-load dependent module.\n</code></pre>\n\n<p>There's a huge number of yellow question marks. And dozens of Modules with Error opening file, with names like <code>API-MS-WIN-CORE-...</code> and <code>EXT-MS-WIN-NTUSER-...</code> as well as <code>HVSIFILETRUST.DLL</code> and <code>IESHIMS.DLL</code> and <code>EMCLIENT.DLL</code> </p>\n\n<p>So I've got a few moving parts in my lap and I'm way out of my depth. I'm hoping I'm just missing a simple step (maybe put the dll in a different folder??). If this should be an ambitious or difficult task, I should probably let it go. </p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 2, "creation_date": 1577047990, "post_id": 59447794, "comment_id": 105078501, "body": "I hope this helps: <a href=\"https://stackoverflow.com/questions/13119786/syntax-error-at-end-of-input-in-postgresql\" title=\"syntax error at end of input in postgresql\">stackoverflow.com/questions/13119786/&hellip;</a>"}, {"owner": {"reputation": 559, "user_id": 6843968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/837570a6eefe9402a0ea7df116184025?s=128&d=identicon&r=PG&f=1", "display_name": "MounirOnGithub", "link": "https://stackoverflow.com/users/6843968/mounirongithub"}, "reply_to_user": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 1, "creation_date": 1577050018, "post_id": 59447794, "comment_id": 105078872, "body": "It helped a lot ! A query was executed with the returned <code>*sql.DB</code> value and the error came from the query ; I was using <code>?</code> prepared statement instead of <code>$1, ...</code>"}], "owner": {"reputation": 559, "user_id": 6843968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/837570a6eefe9402a0ea7df116184025?s=128&d=identicon&r=PG&f=1", "display_name": "MounirOnGithub", "link": "https://stackoverflow.com/users/6843968/mounirongithub"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2954, "favorite_count": 0, "closed_date": 1577057507, "answer_count": 0, "score": 0, "last_activity_date": 1577046290, "creation_date": 1577046290, "question_id": 59447794, "link": "https://stackoverflow.com/questions/59447794/why-getting-error-syntax-error-at-end-of-input", "closed_reason": "Duplicate", "title": "Why getting error syntax error at end of input", "body": "<p>I'm trying to connect to PostgreSQL database and get an error saying <code>pq: syntax error at end of input</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package utils\n\n// DBConnect connection to PG database\nfunc DBConnect() *sql.DB {\n    // env := LoadEnvVariables()\n\n    connStr := \"postgres://user:password@127.0.0.1/lybl?sslmode=disable\"\n    fmt.Println(connStr)\n\n    db, err := sql.Open(\"postgres\", connStr)\n    if err != nil {\n        log.Fatal(err)\n        return nil\n    }\n\n    return db\n}\n</code></pre>\n\n<p>Don't know what I'm missing here</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 4, "creation_date": 1577049087, "post_id": 59447432, "comment_id": 105078717, "body": "there is an industry convention to avoid creating arbitrary http verbs ... checkout <a href=\"https://softwareengineering.stackexchange.com/questions/193821/are-there-any-problems-with-implementing-custom-http-methods\" title=\"are there any problems with implementing custom http methods\">softwareengineering.stackexchange.com/questions/193821/&hellip;</a>   to quote from RFC 1925 <a href=\"http://www.faqs.org/rfcs/rfc1925.html\" rel=\"nofollow noreferrer\">faqs.org/rfcs/rfc1925.html</a>    - &quot;In protocol design, perfection has been reached not when there is nothing left to add, but when there is nothing left to take away.&quot;"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1577052888, "post_id": 59447432, "comment_id": 105079464, "body": "&quot;There is an issue with http package and HTTP custom verbs?&quot; Package net/http deals with HTTP, not some self-invented abomination of HTTP so that is to be expected."}, {"owner": {"reputation": 434, "user_id": 10346052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fQG4B.jpg?s=128&g=1", "display_name": "shayan rok rok", "link": "https://stackoverflow.com/users/10346052/shayan-rok-rok"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1577104064, "post_id": 59447432, "comment_id": 105091859, "body": "@Volker There are various web services using custom methods and there is no restriction on not using custom methods. But I expected raised error, not ignoring the form parameters implicitly."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577109907, "post_id": 59447432, "comment_id": 105094428, "body": "Not sure where you&#39;re expecting an error to be raised, as you&#39;re not checking any of your errors."}, {"owner": {"reputation": 434, "user_id": 10346052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fQG4B.jpg?s=128&g=1", "display_name": "shayan rok rok", "link": "https://stackoverflow.com/users/10346052/shayan-rok-rok"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577118275, "post_id": 59447432, "comment_id": 105098011, "body": "@Adrian As I said, I&#39;m new to Golang. So I forgot for a  moment that error handling in Golang is different from other languages like Python."}], "answers": [{"comments": [{"owner": {"reputation": 434, "user_id": 10346052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fQG4B.jpg?s=128&g=1", "display_name": "shayan rok rok", "link": "https://stackoverflow.com/users/10346052/shayan-rok-rok"}, "edited": false, "score": 0, "creation_date": 1577044358, "post_id": 59447497, "comment_id": 105077691, "body": "This works but it seems like a hack. Isn&#39;t there any official way to do that? Like any method? I wonder why <code>ParseForm</code> doesn&#39;t support custom verbs."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577110025, "post_id": 59447497, "comment_id": 105094488, "body": "No, if there was an &quot;official way&quot; the workaround wouldn&#39;t be necessary. If you have concerns about the <code>net&#47;http</code> implementation, take it up with the maintainers (e.g. on the golang-nuts mailing list)."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 2, "last_activity_date": 1577043605, "creation_date": 1577043605, "answer_id": 59447497, "question_id": 59447432, "link": "https://stackoverflow.com/questions/59447432/parse-the-body-of-request-with-custom-verb-golang/59447497#59447497", "title": "Parse the body of request with custom verb Golang", "body": "<p><a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Request</a></p>\n\n<blockquote>\n  <p>Form contains the parsed form data, including both the URL field's query parameters and the PATCH, POST, or PUT form data.\n  This field is only available after ParseForm is called.\n  The HTTP client ignores Form and uses Body instead.</p>\n</blockquote>\n\n<p>And if we look at <a href=\"https://golang.org/src/net/http/request.go?s=40015:40270#L1228\" rel=\"nofollow noreferrer\">the code</a> for <code>ParseForm</code> we see:</p>\n\n<pre><code>if r.PostForm == nil {\n    if r.Method == \"POST\" || r.Method == \"PUT\" || r.Method == \"PATCH\" {\n        r.PostForm, err = parsePostForm(r)\n    }\n    if r.PostForm == nil {\n        r.PostForm = make(url.Values)\n    }\n}\n</code></pre>\n\n<p>The easy way to do it would be to make it think it's a POST request (and then set it back afterwards, in case you need the real method later):</p>\n\n<pre><code>  method := r.Method\n  r.PostForm == nil // this line may necessary\n  r.Method = http.MethodPost\n  r.ParseForm()\n  r.Method = method\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 135, "user_id": 7222662, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d4jMb.png?s=128&g=1", "display_name": "tsak", "link": "https://stackoverflow.com/users/7222662/tsak"}, "is_accepted": false, "score": 3, "last_activity_date": 1577043660, "creation_date": 1577043660, "answer_id": 59447501, "question_id": 59447432, "link": "https://stackoverflow.com/questions/59447432/parse-the-body-of-request-with-custom-verb-golang/59447501#59447501", "title": "Parse the body of request with custom verb Golang", "body": "<p>The answer is in <code>ParseForm</code>'s source in <code>net/http/request.go</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>        if r.Method == \"POST\" || r.Method == \"PUT\" || r.Method == \"PATCH\" {\n            r.PostForm, err = parsePostForm(r)\n        }\n</code></pre>\n\n<p>It will only parse a POST body if method is either POST, PUT or PATCH.</p>\n\n<p>You can force this by adding <code>r.Method = \"POST\"</code> before calling <code>r.ParseForm</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    r.Method = \"POST\"\n    r.ParseForm()\n</code></pre>\n"}], "owner": {"reputation": 434, "user_id": 10346052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fQG4B.jpg?s=128&g=1", "display_name": "shayan rok rok", "link": "https://stackoverflow.com/users/10346052/shayan-rok-rok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 59447497, "answer_count": 2, "score": 0, "last_activity_date": 1577043660, "creation_date": 1577043036, "question_id": 59447432, "link": "https://stackoverflow.com/questions/59447432/parse-the-body-of-request-with-custom-verb-golang", "title": "Parse the body of request with custom verb Golang", "body": "<p>I'm so new to Golang and want to create API using <code>http</code> package. So I tried the snippet code below:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\ntype server struct{}\n\n\nfunc (s *server) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.WriteHeader(http.StatusOK)\n\n    r.ParseForm()\n    fmt.Println(r.Header[\"Content-Type\"][0])\n    fmt.Printf(\"The URL is: %s\\n\", r.Form)\n}\n\nfunc main() {\n    s := &amp;server{}\n\n    http.Handle(\"/\", s)\n    http.ListenAndServe(\":8080\", nil)\n}\n\n</code></pre>\n\n<p>The request is:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>curl localhost:8080 -d url=google.com -i\n</code></pre>\n\n<p>And the output:</p>\n\n<pre><code>application/x-www-form-urlencoded\nThe URL is: map[url:[google.com]]\n</code></pre>\n\n<p>Everything is ok till using the custom verb like:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>curl localhost:8080 -d url=google.com -i -X CREATE\n</code></pre>\n\n<p>And the output:</p>\n\n<pre><code>application/x-www-form-urlencoded\nThe URL is: map[]\n</code></pre>\n\n<p>There is an issue with <code>http</code> package and HTTP custom verbs?</p>\n\n<p>Or something wrong in my code?</p>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 12876, "user_id": 377446, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0479a8c7ebd088dbcf459147ba3b2569?s=128&d=identicon&r=PG", "display_name": "Karl", "link": "https://stackoverflow.com/users/377446/karl"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1577033298, "post_id": 59446129, "comment_id": 105075044, "body": "But the map key is a byte array, and users of this library need to know it&#39;s a byte array when they get their result. And blindly converting a byte array to a string will create invalid characters."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1577033662, "post_id": 59446129, "comment_id": 105075135, "body": "Your requirements are unclear. If you have a literal byte array, just use that as your key. If you have something else (which it sounds like), then you can&#39;t preserve the original type anyway, so it doesn&#39;t seem like a loss."}, {"owner": {"reputation": 12876, "user_id": 377446, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0479a8c7ebd088dbcf459147ba3b2569?s=128&d=identicon&r=PG", "display_name": "Karl", "link": "https://stackoverflow.com/users/377446/karl"}, "edited": false, "score": 0, "creation_date": 1577033837, "post_id": 59446129, "comment_id": 105075213, "body": "I&#39;m writing an unmarshaler, and need to pass the unmarshaled data back to the user. If the marshaled data was {[0x81, 0xff, 0x41, 0x11] = true}, then I need the unmarshaled result to also be in the same structure. In this case, the byte array [81 ff 41 11] needs to be the key in the map I&#39;m returning from the unmarshal function."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577033984, "post_id": 59446129, "comment_id": 105075254, "body": "Are you (un)marshaling to a standard format, or creating your own?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577034273, "post_id": 59446129, "comment_id": 105075348, "body": "In any case, I don&#39;t believe that such keys can be expressed using standard Go types. You&#39;ll need to come up with a creative work-around. Or if you control the format, maybe you can come up with a more Go-friendly format."}, {"owner": {"reputation": 12876, "user_id": 377446, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0479a8c7ebd088dbcf459147ba3b2569?s=128&d=identicon&r=PG", "display_name": "Karl", "link": "https://stackoverflow.com/users/377446/karl"}, "edited": false, "score": 0, "creation_date": 1577035959, "post_id": 59446129, "comment_id": 105075797, "body": "Doesn&#39;t matter. When unmarshalling data, the idea is to preserve types, and converting to string loses that information. Creating a custom string type to differentiate &quot;real&quot; strings from &quot;actually a byte array&quot; strings is a hack that just adds extra headaches for the end user, having to keep checking for that type and manually convert on every use."}], "answers": [{"comments": [{"owner": {"reputation": 12876, "user_id": 377446, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0479a8c7ebd088dbcf459147ba3b2569?s=128&d=identicon&r=PG", "display_name": "Karl", "link": "https://stackoverflow.com/users/377446/karl"}, "edited": false, "score": 0, "creation_date": 1577033583, "post_id": 59446200, "comment_id": 105075114, "body": "This won&#39;t preserve the type. Unmarshaling a byte array needs to result in an actual byte array, not a string."}, {"owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "reply_to_user": {"reputation": 12876, "user_id": 377446, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0479a8c7ebd088dbcf459147ba3b2569?s=128&d=identicon&r=PG", "display_name": "Karl", "link": "https://stackoverflow.com/users/377446/karl"}, "edited": false, "score": 1, "creation_date": 1577033803, "post_id": 59446200, "comment_id": 105075194, "body": "@Karl It&#39;s unclear from the comment how the values relate to unmarshalling.  Edit the question to show the unmarshalling scenario."}], "tags": [], "owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "is_accepted": false, "score": 3, "last_activity_date": 1577033678, "last_edit_date": 1577033678, "creation_date": 1577033408, "answer_id": 59446200, "question_id": 59446129, "link": "https://stackoverflow.com/questions/59446129/how-do-i-convert-a-byte-slice-of-unknown-size-to-a-byte-array/59446200#59446200", "title": "How do I convert a byte slice of unknown size to a byte array?", "body": "<p>Use <code>string</code> instead of a fixed size array of bytes. A string can hold an arbitrary sequence of bytes.</p>\n\n<pre><code>func getHashable(value interface{}) interface{} {\n    rfl := reflect.ValueOf(value)\n    if rfl.Kind() == reflect.Slice &amp;&amp; rfl.Type().Elem().Kind() == reflect.Uint8 {\n        value = string(rfl.Bytes())\n    }\n    return value\n}\n</code></pre>\n\n<p>If you are only need to handle <code>[]byte</code> and not named types for <code>[]byte</code>, use type assertions instead of reflection:</p>\n\n<pre><code>func getHashable(value interface{}) interface{} {\n    switch value := value.(type) {\n    case []byte:\n         return string(value)\n    default:\n         return value\n    }\n}\n</code></pre>\n\n<p>If the user of the map needs to distinguish string keys from keys created form []byte, define a string type to distinguish those values:</p>\n\n<pre><code>type convertedSlice string\n</code></pre>\n\n<p>Replace use of <code>string()</code> conversion in the code above with <code>convertedSlice()</code>.</p>\n\n<p>The application can check for converted keys with:</p>\n\n<pre><code>_, ok := key.(convertedSlice) // ok is true if key is converted slice.\n</code></pre>\n\n<p>and convert the keys back to []byte with:</p>\n\n<pre><code>cv, ok := key.(convertedSice)\nif ok {\n   key = []byte(cv)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 12876, "user_id": 377446, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0479a8c7ebd088dbcf459147ba3b2569?s=128&d=identicon&r=PG", "display_name": "Karl", "link": "https://stackoverflow.com/users/377446/karl"}, "edited": false, "score": 0, "creation_date": 1577034971, "post_id": 59446341, "comment_id": 105075555, "body": "Oh wow that&#39;s a beautiful monstrosity! OK, if that&#39;s the only way I can unmarshal a map key that turns out to be a byte array, I&#39;ll have to think about whether to just say &quot;unsupported&quot;..."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1577057981, "post_id": 59446341, "comment_id": 105080322, "body": "Note that the fundamental problem is that the map&#39;s keys have to implement <code>==</code> / <code>!=</code>.  Arrays do, but arrays have compile-time-fixed-sizes. This &quot;beautiful monstrosity&quot; (I like that term!) gives you an interface object that implements the equality comparisons, along with runtime-created, runtime-blessed pseudo-arrays that read back as arrays when going through the <code>reflect</code> code (so in that sense they <i>are</i> arrays) that nonethless have no compile-time existence (so in that sense they <i>aren&#39;t</i> arrays)."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577083445, "post_id": 59446341, "comment_id": 105084386, "body": "@torek you are absolutely right. But I would like to add is while this is awkward to use (the user may have a hard coded array as a key though), it is unlikely to shoot yourself in feet when use. It is not unsafe, just bad code."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 3, "last_activity_date": 1577035065, "last_edit_date": 1577035065, "creation_date": 1577034559, "answer_id": 59446341, "question_id": 59446129, "link": "https://stackoverflow.com/questions/59446129/how-do-i-convert-a-byte-slice-of-unknown-size-to-a-byte-array/59446341#59446341", "title": "How do I convert a byte slice of unknown size to a byte array?", "body": "<p>While use a <code>string</code> is clearly the better way, if the code you don't control uses a byte array as key, here is how you can turn the byte slice into an array as an interface using reflect.</p>\n\n<pre><code>varr := reflect.New(reflect.ArrayOf(len(slice), reflect.TypeOf(uint8(0))))\nreflect.Copy(varr.Elem(), reflect.ValueOf(slice))\n\nreturn varr.Elem().Interface()\n</code></pre>\n\n<p>Please consider other options before using this.</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/CXsxZwgjiRR\" rel=\"nofollow noreferrer\">https://play.golang.org/p/CXsxZwgjiRR</a></p>\n"}], "owner": {"reputation": 12876, "user_id": 377446, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0479a8c7ebd088dbcf459147ba3b2569?s=128&d=identicon&r=PG", "display_name": "Karl", "link": "https://stackoverflow.com/users/377446/karl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "accepted_answer_id": 59446341, "answer_count": 2, "score": 0, "last_activity_date": 1577035065, "creation_date": 1577032899, "last_edit_date": 1577034285, "question_id": 59446129, "link": "https://stackoverflow.com/questions/59446129/how-do-i-convert-a-byte-slice-of-unknown-size-to-a-byte-array", "title": "How do I convert a byte slice of unknown size to a byte array?", "body": "<p>I need to unmarshal some data, and in one case, the marshaled data represents a map with a byte array as a key.</p>\n\n<p>Slices are not allowed as map keys, however arrays are. But the problem here is that arrays can't be created with a non-constant size as far as I can tell.</p>\n\n<p>Example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc getHashable(value interface{}) interface{} {\n    rfl := reflect.ValueOf(value)\n    if rfl.Kind() == reflect.Slice &amp;&amp; rfl.Type().Elem().Kind() == reflect.Uint8 {\n        slice, ok := value.([]uint8)\n        if !ok {\n            panic(fmt.Errorf(\"Could not coerce to []uint8\"))\n        }\n        var arr [len(slice)]uint8 // This fails\n        copy(arr, slice)\n        value = arr\n    }\n    return value\n}\n\nfunc unmarshalMap(serialized []byte) map[interface{}]interface{} {\n    result := make(map[interface{}]interface{})\n    for len(serialized) &gt; 0 {\n        var value interface{}\n        key, bytesConsumed := deserializeValue(serialized)\n        serialized = serialized[bytesConsumed:]\n        value, bytesConsumed = deserializeValue(serialized)\n        serialized = serialized[bytesConsumed:]\n        result[getHashable(key)] = value\n    }\n}\n</code></pre>\n\n<p>If deserializeValue() returns a []byte, then it can't be stored as a key in the result map. An array would work, but I can't create an array because I don't know what size I'll need until runtime, and it only allows compile time constants.</p>\n\n<p>A simplified version <a href=\"https://play.golang.org/p/wkYGs3S-uSD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/wkYGs3S-uSD</a> fails with the error</p>\n\n<pre><code>./prog.go:15:12: non-constant array bound len(slice)\n</code></pre>\n\n<p>How can I use an array of bytes that I've unmarshaled as a key in a map in Go?</p>\n"}, {"tags": ["go", "path"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1577041223, "post_id": 59445346, "comment_id": 105077038, "body": "<code>$HOME</code> should always be there and point to a directory, where by convention you can either create a dotfile or dotdirectory for your config. Problem solved."}, {"owner": {"reputation": 45, "user_id": 11925738, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yzgOjEUh5dY/AAAAAAAAAAI/AAAAAAAAAsE/jID9yJ_grj0/photo.jpg?sz=128", "display_name": "Sepehr Noori", "link": "https://stackoverflow.com/users/11925738/sepehr-noori"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1577187480, "post_id": 59445346, "comment_id": 105115741, "body": "this actually helped @MarkusWMahlberg"}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 11925738, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yzgOjEUh5dY/AAAAAAAAAAI/AAAAAAAAAsE/jID9yJ_grj0/photo.jpg?sz=128", "display_name": "Sepehr Noori", "link": "https://stackoverflow.com/users/11925738/sepehr-noori"}, "edited": false, "score": 0, "creation_date": 1577184280, "post_id": 59445699, "comment_id": 105114582, "body": "this will go down in the production when the working directory changes"}], "tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": false, "score": 0, "last_activity_date": 1577029751, "creation_date": 1577029751, "answer_id": 59445699, "question_id": 59445346, "link": "https://stackoverflow.com/questions/59445346/how-to-set-my-config-file-in-viper-present-outside-of-my-working-repository/59445699#59445699", "title": "how to set my config file in viper present outside of my working repository", "body": "<p>You can use <code>..</code> to go to parent directory, and then from there go to <code>config</code> folder.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>workingdir, err := os.Getwd()\nif err != nil {\n    logger.Error(err)\n}\nviper.SetConfigFile(workingdir + \"/../config/local.yaml\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1577033248, "last_edit_date": 1577033248, "creation_date": 1577032825, "answer_id": 59446125, "question_id": 59445346, "link": "https://stackoverflow.com/questions/59445346/how-to-set-my-config-file-in-viper-present-outside-of-my-working-repository/59446125#59446125", "title": "how to set my config file in viper present outside of my working repository", "body": "<p>Use \"..\" to specify  a parent of a directory.</p>\n\n<p>Because relative paths are rooted at the working directory, there's no need to get the working directory in the application code.  </p>\n\n<p>Use the following to specify the path to the configuration file:</p>\n\n<pre><code> viper.SetConfigFile(\"../config/local.yaml\")\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 45, "user_id": 11925738, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yzgOjEUh5dY/AAAAAAAAAAI/AAAAAAAAAsE/jID9yJ_grj0/photo.jpg?sz=128", "display_name": "Sepehr Noori", "link": "https://stackoverflow.com/users/11925738/sepehr-noori"}, "edited": false, "score": 0, "creation_date": 1577184323, "post_id": 59454611, "comment_id": 105114595, "body": "this actually works but this is a big project and setting viper in main.go is not gonna work"}, {"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "reply_to_user": {"reputation": 45, "user_id": 11925738, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yzgOjEUh5dY/AAAAAAAAAAI/AAAAAAAAAsE/jID9yJ_grj0/photo.jpg?sz=128", "display_name": "Sepehr Noori", "link": "https://stackoverflow.com/users/11925738/sepehr-noori"}, "edited": false, "score": 1, "creation_date": 1587596321, "post_id": 59454611, "comment_id": 108577648, "body": "@SepehrNoori this has nothing to do with main.go"}, {"owner": {"reputation": 673, "user_id": 5515674, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9bkPW.jpg?s=128&g=1", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/5515674/chetan-kumar"}, "reply_to_user": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "edited": false, "score": 0, "creation_date": 1587629317, "post_id": 59454611, "comment_id": 108587297, "body": "@TheFool yeah correct (Y), the above solution can be implemented in any file and through any function. But, generally we setup our viper at the start before everything goes on. It&#39;s a good practice."}], "tags": [], "owner": {"reputation": 673, "user_id": 5515674, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9bkPW.jpg?s=128&g=1", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/5515674/chetan-kumar"}, "is_accepted": false, "score": 1, "last_activity_date": 1577100727, "creation_date": 1577100727, "answer_id": 59454611, "question_id": 59445346, "link": "https://stackoverflow.com/questions/59445346/how-to-set-my-config-file-in-viper-present-outside-of-my-working-repository/59454611#59454611", "title": "how to set my config file in viper present outside of my working repository", "body": "<p>Don't keep your config file out of your working directory, always make a new folder in your main package like conf and put your file into it.</p>\n\n<p>So, the directory structure will be </p>\n\n<blockquote>\n  <p>my_app/conf/config.yml</p>\n</blockquote>\n\n<p>Then set the config file into viper through init function of your main.go</p>\n\n<pre><code>//main.go\nfunc init() {\n  setUpViper()\n}\n\nfunc setUpViper() {\n  viper.AddConfigPath(\"./conf\")\n  viper.SetConfigName(\"config\")\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 11925738, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yzgOjEUh5dY/AAAAAAAAAAI/AAAAAAAAAsE/jID9yJ_grj0/photo.jpg?sz=128", "display_name": "Sepehr Noori", "link": "https://stackoverflow.com/users/11925738/sepehr-noori"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1664, "favorite_count": 1, "answer_count": 3, "score": 1, "last_activity_date": 1577104733, "creation_date": 1577026801, "last_edit_date": 1577104733, "question_id": 59445346, "link": "https://stackoverflow.com/questions/59445346/how-to-set-my-config-file-in-viper-present-outside-of-my-working-repository", "title": "how to set my config file in viper present outside of my working repository", "body": "<p>I need to set a path to my config file. The problem is, for example, my config file is in <code>my_app/config</code> but my working directory is in <code>my_app/workingdir</code> and I should not set an absolute path or a path from my working dir because in production the absolute path and working directory will change. For test I know I can set the path from my code location, but I need a cleaner way.</p>\n\n<pre><code>    workingdir, err := os.Getwd()\n    if err != nil {\n        logger.Error(err)\n    }\n    viper.SetConfigFile(workingdir + \"/config/local.yaml\")\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 9276, "user_id": 2409793, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/QDLY9.png?s=128&g=1", "display_name": "pkaramol", "link": "https://stackoverflow.com/users/2409793/pkaramol"}, "edited": false, "score": 1, "creation_date": 1577025105, "post_id": 59444996, "comment_id": 105072884, "body": "so if I understand correctly, in the above terms, the <code>client</code> is the <code>main</code> (which will be listening via its <code>select</code>), right? and we make the channel buffered 1 so that in case that <code>main</code> (for some reason) <b>fails</b> to read from <code>serverErrors</code>, the goroutine executing the <code>listenAndServe</code> can return"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 9276, "user_id": 2409793, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/QDLY9.png?s=128&g=1", "display_name": "pkaramol", "link": "https://stackoverflow.com/users/2409793/pkaramol"}, "edited": false, "score": 1, "creation_date": 1577025243, "post_id": 59444996, "comment_id": 105072904, "body": "Correct. Just like a synchronous call, the caller can ignore errors. For an asynchronous call, the caller should be able to do the same without incurring the leak of a go-routine."}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 3, "last_activity_date": 1577052535, "last_edit_date": 1577052535, "creation_date": 1577024270, "answer_id": 59444996, "question_id": 59444908, "link": "https://stackoverflow.com/questions/59444908/using-buffered-channel-for-errors-in-go-when-listening-and-serving/59444996#59444996", "title": "Using buffered channel for errors in go when listening and serving", "body": "<p>Short answer:</p>\n\n<p>For any channel (buffered or not), channel reads block if nothing is written to the channel.</p>\n\n<p>For non-buffered channels, channel <em>writes</em> will block if no one is listening.</p>\n\n<p>It is a common technique with error-channels (since only one item will ever be written to the channel), to make it a buffered channel of size 1. It ensures the write will happen without blocking - and the writer goroutine can continue on its way and return.</p>\n\n<p>Therefore the service does not relying on the client caller reading from the error channel to perform its cleanup.</p>\n\n<p>Note: to reclaim a channel re GC, it only has to go out of scope - it does not need to be fully drained. Nor does it need to be closed. Once it goes out of scope from the both ends, it will be GC'ed.</p>\n"}, {"comments": [{"owner": {"reputation": 2105, "user_id": 5821408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f6ca899d084f02ac63e71e9e8711046?s=128&d=identicon&r=PG&f=1", "display_name": "shmsr", "link": "https://stackoverflow.com/users/5821408/shmsr"}, "edited": false, "score": 0, "creation_date": 1577038355, "post_id": 59446752, "comment_id": 105076417, "body": "Note: In most of the real-world programs, the send and receive operations are usually performed by different goroutines. It is a mistake (not recommended) to use buffered channels within a single goroutine as a queue. That&#39;s why in my answer I stated my answer using more than one goroutine."}], "tags": [], "owner": {"reputation": 2105, "user_id": 5821408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f6ca899d084f02ac63e71e9e8711046?s=128&d=identicon&r=PG&f=1", "display_name": "shmsr", "link": "https://stackoverflow.com/users/5821408/shmsr"}, "is_accepted": false, "score": 1, "last_activity_date": 1577044113, "last_edit_date": 1577044113, "creation_date": 1577037423, "answer_id": 59446752, "question_id": 59444908, "link": "https://stackoverflow.com/questions/59444908/using-buffered-channel-for-errors-in-go-when-listening-and-serving/59446752#59446752", "title": "Using buffered channel for errors in go when listening and serving", "body": "<p>If you refer the code for <code>ListenAndServe()</code>, you'll notice the following comments on how it works. Quoting from there itself:</p>\n\n<blockquote>\n  <p>// ListenAndServe always returns a non-nil error. After Shutdown or Close,<br>\n  // the returned error is ErrServerClosed.</p>\n</blockquote>\n\n<p>Also,</p>\n\n<blockquote>\n  <p>// When Shutdown is called, Serve, ListenAndServe, and<br>\n  // ListenAndServeTLS immediately return ErrServerClosed. Make sure the<br>\n  // program doesn't exit and waits instead for Shutdown to return.</p>\n</blockquote>\n\n<hr>\n\n<p>Your select block is waiting for <code>Shutdown</code> (error) considering that you're gracefully handling the server's shutdown and doesn't let the goroutine exit before it gracefully closes.</p>\n\n<p>In the case of <code>func (srv *Server) Close()</code> <em>(eg. Most use <code>defer srv.Close()</code>, right?)</em>:</p>\n\n<blockquote>\n  <p>// Close immediately closes all active net.Listeners and any<br>\n  // connections in state StateNew, StateActive, or StateIdle. For a  </p>\n  \n  <p>// Close returns any error returned from closing the Server's<br>\n  // underlying Listener(s).<br>\n  // graceful shutdown, use Shutdown.</p>\n</blockquote>\n\n<p>So, the same explanation as above carries of using the select block.</p>\n\n<hr>\n\n<p>Now, let's categorize channels as <code>buffered</code> and <code>unbuffered</code>, and if we do care about the guarantee of delivery of the signal (communication with the channel), then unbuffered one ensures it. Whereas, if the buffered channel (size = 1) which is in your case, then it ensures delivery but might be delayed.</p>\n\n<p>Let's elaborate <code>unbuffered channels</code>:</p>\n\n<pre><code>A send operation on an unbuffered channel blocks the sending goroutine until another \ngoroutine executes a corresponding receive on that same channel, at which point the value \nis transmitted and both goroutines may continue\n\nConversely, if received on the channel earlier (&lt;-chan) than send operation, then the \nreceiving goroutine is blocked until the corresponding send operation occurs on the \nsame channel on another goroutine.\n</code></pre>\n\n<blockquote>\n  <p>Aforementioned points for unbuffered channels indicate synchronous nature. </p>\n</blockquote>\n\n<p>Remember, <code>func main()</code> is also a goroutine.</p>\n\n<p>Let's elaborate <code>buffered channels</code>:</p>\n\n<pre><code>A send operation on a buffered channel pushes an element at the back of the queue, \nand a receive operation pops an element from the front of the queue. \n 1. If the channel is full, the send operation blocks its goroutine until space is made available by another goroutine's receive. \n 2. If the channel is empty, a receive operation blocks until a value is sent by another goroutine.\n</code></pre>\n\n<blockquote>\n  <p>So in your case size of the channel is 1. The other sender goroutine can send in a non-blocking manner as the receiver channel of the other goroutine dequeues it as soon as it receives. But, if you remember, I mentioned <em>delayed delivery</em> for the channel with <em>size 1</em> as we don't how much time it'll take for the receiver channel goroutine to return.</p>\n</blockquote>\n\n<p>Hence, to block the sender goroutine, <code>select block</code> is used. And from the referenced code's documentation, you can see</p>\n\n<blockquote>\n  <p>// Make sure the program doesn't exit and waits instead for Shutdown to return.</p>\n</blockquote>\n\n<p>Also, for more clarity, you can refer: <a href=\"https://www.ardanlabs.com/blog/2017/10/the-behavior-of-channels.html\" rel=\"nofollow noreferrer\">Behaviour of channels</a>\nThe author explains it with pure clarity.</p>\n"}], "owner": {"reputation": 9276, "user_id": 2409793, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/QDLY9.png?s=128&g=1", "display_name": "pkaramol", "link": "https://stackoverflow.com/users/2409793/pkaramol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 59444996, "answer_count": 2, "score": 3, "last_activity_date": 1577057529, "creation_date": 1577023594, "last_edit_date": 1577057529, "question_id": 59444908, "link": "https://stackoverflow.com/questions/59444908/using-buffered-channel-for-errors-in-go-when-listening-and-serving", "title": "Using buffered channel for errors in go when listening and serving", "body": "<p>I am going through a tutorial on building web servers using <code>go</code>.</p>\n\n<p>The author, instead of directly using the <code>http.ListenAndServe()</code> method, he creates the <code>http.Server</code> struct.</p>\n\n<p>He then proceeds by:</p>\n\n<ul>\n<li><p>creating a buffered channel for listening for errors</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>serverErrors := make(chan errors, 1)\n</code></pre></li>\n<li><p>spawning the http listening goroutine that binds to that channel</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>go func(){\n    fmt.Println(\"starting...\")\n    serverErrors &lt;- api.ListenAndServe()\n}()\n</code></pre></li>\n</ul>\n\n<p>The reason behind using a buffered channel is according to the instructor </p>\n\n<blockquote>\n  <p>so that the goroutine can exit if we do not collect this error</p>\n</blockquote>\n\n<p>There is indeed below in a program a <code>select</code> block where the errors coming from this channel are being collected.</p>\n\n<p>Can anyone pls help me understand how the goroutine gets to exit if we don't collect the error?</p>\n\n<p>What would be the practical difference had we used an unbuffered channel?</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc", "proto", "grpc-go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577023069, "post_id": 59444650, "comment_id": 105072429, "body": "Proper capitalization is &quot;gRPC&quot;, not &quot;GrPC&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 1, "last_activity_date": 1577023782, "last_edit_date": 1577023782, "creation_date": 1577023480, "answer_id": 59444887, "question_id": 59444650, "link": "https://stackoverflow.com/questions/59444650/should-grpc-server-and-client-be-in-the-same-repository/59444887#59444887", "title": "Should gRPC server and client be in the same repository?", "body": "<blockquote>\n  <p>should all of these components exist in the same repository and be\n  separated only by the go packages?</p>\n</blockquote>\n\n<p>The various gRPC components do not need to all live in the same repo.</p>\n\n<blockquote>\n  <p>Should the service be its own repository and serve as a dependency to\n  anyone wished to implement server/client libraries for the service?</p>\n</blockquote>\n\n<p>I use the following repo organization:</p>\n\n<ul>\n<li>myapp-proto (common repo; git tagged and used by both client and\nserver)</li>\n<li>myapp-client</li>\n<li>myapp-service1</li>\n<li>myapp-service2</li>\n<li>myapp-service3</li>\n</ul>\n\n<p>For example, several gRPC services which pull data from various datasources (REST APIs, MySQL, LDAP etc.) - each of these server gRPC services live in their own repos. There is a single gRPC client package that also lives in it's own repo. And to keep change-control sane, the common <code>proto</code> definitions (and generated go code) lives in a separate single repo.</p>\n\n<p>The above setup leverages <a href=\"https://git-scm.com/book/en/v2/Git-Basics-Tagging\" rel=\"nofollow noreferrer\">git version tagging</a> and <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">go modules</a> to ensure the client and all the servers are using the compatible versions of the gRPC messages/services. Adding methods/fields to the gRPC <code>proto</code> can be done independent of the client/server pieces - and phased in when mature.</p>\n"}, {"tags": [], "owner": {"reputation": 1181, "user_id": 818341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60f45a2e41581efd75e909a55943eb91?s=128&d=identicon&r=PG&f=1", "display_name": "Arash", "link": "https://stackoverflow.com/users/818341/arash"}, "is_accepted": false, "score": 0, "last_activity_date": 1577029766, "creation_date": 1577029766, "answer_id": 59445703, "question_id": 59444650, "link": "https://stackoverflow.com/questions/59444650/should-grpc-server-and-client-be-in-the-same-repository/59445703#59445703", "title": "Should gRPC server and client be in the same repository?", "body": "<p>In my experience what has worked best is to keep the proto definition and generated files with the server. I typically put them in <code>{SERVER}/pkg/grpc</code> and then import them in client <code>{CLIENT}/internal/services/{SERVER}/grpc</code> or something similar depending on your project structure. </p>\n"}], "owner": {"reputation": 301, "user_id": 7339571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e21bc535e040bdec2b964497da77116?s=128&d=identicon&r=PG&f=1", "display_name": "TheDude", "link": "https://stackoverflow.com/users/7339571/thedude"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 837, "favorite_count": 0, "closed_date": 1577053286, "answer_count": 2, "score": 0, "last_activity_date": 1577029766, "creation_date": 1577021755, "last_edit_date": 1577023029, "question_id": 59444650, "link": "https://stackoverflow.com/questions/59444650/should-grpc-server-and-client-be-in-the-same-repository", "closed_reason": "Opinion-based", "title": "Should gRPC server and client be in the same repository?", "body": "<p>I am playing around with a gRPC server using Go,\nI understand that one of the benefits of gRPC/Protobuf is that you can use it to create a client library easily by using the same messages/service API that are being used in the server code.</p>\n\n<p>If I am implementing a client library for my service, it obviously needs to import the service code and API, so I would eventually have a service, a server, and a client components. In production grade code - should all of these components exist in the same repository and be separated only by the go packages? Should the service be its own repository and serve as a dependency to anyone wished to implement server/client libraries for the service?</p>\n"}, {"tags": ["string", "go", "type-conversion"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1577017039, "post_id": 59444103, "comment_id": 105071168, "body": "First, there is no casting at all in Go, only type conversion. Second, your question doesn&#39;t make sense... you&#39;re trying to cast/convert something to nothing? Can you show the actual example you&#39;re dealing with?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1577017487, "post_id": 59444103, "comment_id": 105071248, "body": "After re-reading a few times, I&#39;m pretty sure the answer to your question is a simple &quot;no.&quot; But it also seems a lot like an XY Problem. If you can explain the larger goal, maybe a solution can be found."}, {"owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "edited": false, "score": 0, "creation_date": 1577017713, "post_id": 59444103, "comment_id": 105071289, "body": "String is a 2 word struct, byte is just a byte, how are you going to cast it, if first field of string is a pointer? You can cast byte slice into string, yes, because their structures are same (except cap field). And then, &quot;&quot; equals nil pointer (uninitiated byte slice), where 0 is already something contained in"}, {"owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577031837, "post_id": 59444103, "comment_id": 105074641, "body": "@Flimzy - what\u2019s the difference between casting and type conversion? In both cases, you have a value of some type and change its type?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577032196, "post_id": 59444103, "comment_id": 105074746, "body": "@Shuzheng: <a href=\"https://techdifferences.com/difference-between-type-casting-and-type-conversion.html\" rel=\"nofollow noreferrer\">techdifferences.com/&hellip;</a>"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577057203, "post_id": 59444103, "comment_id": 105080192, "body": "I&#39;m not sure I totally agree with the techdifferences.com article. Each language tends to define its own terms around types, casts, conversions, and so on: it&#39;s a bit awkward to try to lump them all into one global definition. It&#39;s generally true that a &quot;cast&quot; is an explicit request for some kind of conversion, regardless of the programming language. In that sense, int(float32(1.2)) could contain two &quot;casts&quot;. It&#39;s just that Go doesn&#39;t <i>call</i> them that. See <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">the spec</a> for details."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577109667, "post_id": 59444103, "comment_id": 105094327, "body": "Converting a non-empty <code>[]byte</code> to a <code>string</code> yields a non-empty <code>string</code>. That should not come as a surprise."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1577023045, "last_edit_date": 1577023045, "creation_date": 1577017899, "answer_id": 59444220, "question_id": 59444103, "link": "https://stackoverflow.com/questions/59444103/is-it-possible-to-cast-a-byte-into-the-empty-string-using-string-in-go/59444220#59444220", "title": "Is it possible to cast a byte into the empty string using `string()` in Go?", "body": "<p>The empty string <code>\"\"</code> has 0 bytes. If you have one byte and you convert that to <code>string</code>, the result string will have a single <code>rune</code> that equals to that 1 byte (which may even be encoded to multiple bytes in UTF-8). <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">Spec: Conversions:</a></p>\n\n<blockquote>\n  <p>Converting a signed or unsigned integer value to a string type yields a string containing the UTF-8 representation of the integer.</p>\n</blockquote>\n\n<p>So obviously you can't convert a byte to a string having 0 bytes, whatever that byte is. Converting the \"most promising candidate\": <code>byte(0)</code> would result in a string with a single <code>0</code> byte: <code>\"\\x00\"</code> or <code>[]byte{0}</code> (try it on the <a href=\"https://play.golang.org/p/JCK-uu1ecGg\" rel=\"nofollow noreferrer\">Go Playground</a>).</p>\n\n<p>Also note that in your example you're converting an <code>int</code> (type of <code>nullByte</code> is <code>int</code>), but the same quoted part of the spec applies.</p>\n"}], "owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 59444220, "answer_count": 1, "score": -2, "last_activity_date": 1577023045, "creation_date": 1577016919, "last_edit_date": 1577018194, "question_id": 59444103, "link": "https://stackoverflow.com/questions/59444103/is-it-possible-to-cast-a-byte-into-the-empty-string-using-string-in-go", "title": "Is it possible to cast a byte into the empty string using `string()` in Go?", "body": "<p>Is it possible to cast a byte into the empty string in Go? I've tried with <code>string(0)</code>, but the result is a <code>string</code> of length 1:</p>\n\n<pre><code>emptyString := \"\"\nnullByte := 0\nfmt.Printf(\"%T, %v - %T, %v\", emptyString, len(emptyString), string(nullByte), len(string(nullByte)))\n</code></pre>\n\n<p><strong>Output</strong>:</p>\n\n<pre><code>string, 0 - string, 1\n</code></pre>\n\n<p>The reason I want to do this, is that I got a function that takes a <code>byte</code> and casts it into a <code>string</code>, and I want to supply the empty string  to this function.</p>\n"}, {"tags": ["sql", "postgresql", "go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1577015387, "last_edit_date": 1577015387, "creation_date": 1577013604, "answer_id": 59443757, "question_id": 59443420, "link": "https://stackoverflow.com/questions/59443420/connection-leak-in-lib-pq-postgres-driver/59443757#59443757", "title": "Connection leak in lib/pq postgres driver", "body": "<p>There are a couple problems with your code as written. The direct answer to your question of avoiding connection leaks is to close the <code>rows</code> iterator <a href=\"https://golang.org/pkg/database/sql/#Rows.Close\" rel=\"nofollow noreferrer\">as mentioned in the documentation</a>. The normal way to call it is in a <code>defer</code> statement:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    rows, err := db.Query(\n        \"select 1 from things where id = $1\",\n        thing,\n    )\n    if err != nil {\n        return nil, fmt.Errorf(\"can't select thing (%d): %w\", thing, err)\n    }\n    defer rows.Close()\n\n    found := false\n\n    for rows.Next() {\n        found = true\n        break\n    }\n</code></pre>\n\n<p>Second, since all you ever care about is a single result, there's no reason to fetch a multi-row result set at all, which will implicitly solve the connection leak issue, as well. See <a href=\"https://stackoverflow.com/a/16467634/13860\">this post</a> for a discussion on the quickest way to check for existence in Postgres. If we adapt that here:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    row, err := db.QueryRow(\n        \"select EXISTS(SELECT 1 from things where id = $1)\",\n        thing,\n    )\n    if err != nil {\n        return nil, fmt.Errorf(\"can't select thing (%d): %w\", thing, err)\n    }\n    var found bool\n    if err := row.Scan(&amp;found); err != nil {\n        return nil, fmt.Errorf(\"Failed to scan result: %w\", err)\n    }\n</code></pre>\n"}], "owner": {"reputation": 12147, "user_id": 4378400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wsSe.jpg?s=128&g=1", "display_name": "Yury Fedorov", "link": "https://stackoverflow.com/users/4378400/yury-fedorov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "accepted_answer_id": 59443757, "answer_count": 1, "score": 0, "last_activity_date": 1577015387, "creation_date": 1577010466, "question_id": 59443420, "link": "https://stackoverflow.com/questions/59443420/connection-leak-in-lib-pq-postgres-driver", "title": "Connection leak in lib/pq postgres driver", "body": "<p>Given that <code>db</code> is of type <code>*sql.DB</code> (uging <code>lib/pq</code> driver), the following code causes connection leak:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    rows, err := db.Query(\n        \"select 1 from things where id = $1\",\n        thing,\n    )\n    if err != nil {\n        return nil, fmt.Errorf(\"can't select thing (%d): %w\", thing, err)\n    }\n\n    found := false\n\n    for rows.Next() {\n        found = true\n        break\n    }\n</code></pre>\n\n<p>Calling this code repeatedly increases the number of open connections, until exhausted:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>select sum(numbackends) from pg_stat_database;\n// 5\n// 6\n// 7\n// ...\n// 80\n</code></pre>\n\n<p>How do I fix it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1577002761, "post_id": 59442587, "comment_id": 105068523, "body": "<a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Proxy-Authorization\" rel=\"nofollow noreferrer\">developer.mozilla.org/en-US/docs/Web/HTTP/Headers/&hellip;</a>"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1577010734, "post_id": 59442587, "comment_id": 105069915, "body": "There is no question here but only a statement that your proxy requires authentication. Obviously you don&#39;t provide any. And we cannot know what the proper authentication for your specific proxy is. Apart from that an IP address of <code>123.44.333.42</code> makes no sense - the <code>333</code> is definitely wrong there (should be at most <code>255</code>)."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1577020793, "post_id": 59442587, "comment_id": 105071906, "body": "@SteffenUllrich I think it is safe to assume that we are looking at an obfuscated IP."}], "owner": {"reputation": 3221, "user_id": 2245634, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/OHoy2.jpg?s=128&g=1", "display_name": "Amit\u0101bha", "link": "https://stackoverflow.com/users/2245634/amit%c4%81bha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1577006924, "creation_date": 1577002057, "last_edit_date": 1577006924, "question_id": 59442587, "link": "https://stackoverflow.com/questions/59442587/proxy-auth-required-with-http-post-request-through-proxy", "title": "Proxy auth required with HTTP post request through proxy", "body": "<p>I have proxyString <code>123.44.333.42:51244</code>\nand want to request url through the proxy</p>\n\n<pre><code>proxyString := \"123.44.333.42:51244\"\nproxyURL, err := url.Parse(\"http://\"+proxyStr)\n    if err != nil {\n        panic(err)\n    }\n    ////adding the proxy settings to the Transport object\n    transport := &amp;http.Transport{\n        Proxy: http.ProxyURL(proxyURL),\n    }\nclient := &amp;http.Client{\n        Transport: transport,\n        CheckRedirect: func(req *http.Request, via []*http.Request) error {\n            return http.ErrUseLastResponse\n        }}\n        resp, contents := getContent(client, person.personHref)\n</code></pre>\n\n<p>get errror <code>Proxy Authentication Required</code></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1547, "user_id": 5041045, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10152917569140069/picture?type=large", "display_name": "Simon Ernesto Cardenas Zarate", "link": "https://stackoverflow.com/users/5041045/simon-ernesto-cardenas-zarate"}, "edited": false, "score": 0, "creation_date": 1577007191, "post_id": 59442602, "comment_id": 105069225, "body": "it worked perfectly, although using &quot;last&quot; as string instead of rune also works. May I ask why did you decide to use rune instead?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 1547, "user_id": 5041045, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10152917569140069/picture?type=large", "display_name": "Simon Ernesto Cardenas Zarate", "link": "https://stackoverflow.com/users/5041045/simon-ernesto-cardenas-zarate"}, "edited": false, "score": 0, "creation_date": 1577039034, "post_id": 59442602, "comment_id": 105076572, "body": "What do you mean by &quot;last as string works&quot;? A rune is int32, a string is a slice of bytes. Details are explained here: <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">blog.golang.org/strings</a>"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1577039105, "last_edit_date": 1577039105, "creation_date": 1577002215, "answer_id": 59442602, "question_id": 59442559, "link": "https://stackoverflow.com/questions/59442559/how-to-compare-a-character-with-the-next-one-in-the-same-string/59442602#59442602", "title": "How to compare a character with the next one in the same string", "body": "<p>You can do the same thing you did in Python:</p>\n\n<pre><code>word := \"helloujjkk\"\nfor i:=0;i&lt;len(word)-1;i++ {\n    if word[i]==word[i+1] {\n       fmt.Println(string(word[i]))\n    }\n}\n</code></pre>\n\n<p>However, this will break if your word contains multibyte characters. String indexing in Go treats the string as an array of bytes, so <code>word[i]</code> is the i'th byte of the string. This is not necessarily the i'th character.</p>\n\n<p>A better solution would be to keep the last character read from the string:</p>\n\n<pre><code>var last rune\nfor i,c:=range word {\n   if i&gt;0 &amp;&amp; c==last {\n      fmt.Println(string(c))\n   }\n   last=c\n   }\n}\n</code></pre>\n\n<p>A range over a string will iterate the runes of the string, not the bytes. So this version is correct even if the string contains multibyte characters.</p>\n"}], "owner": {"reputation": 1547, "user_id": 5041045, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10152917569140069/picture?type=large", "display_name": "Simon Ernesto Cardenas Zarate", "link": "https://stackoverflow.com/users/5041045/simon-ernesto-cardenas-zarate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 59442602, "answer_count": 1, "score": 1, "last_activity_date": 1577039105, "creation_date": 1577001744, "last_edit_date": 1577006941, "question_id": 59442559, "link": "https://stackoverflow.com/questions/59442559/how-to-compare-a-character-with-the-next-one-in-the-same-string", "title": "How to compare a character with the next one in the same string", "body": "<p>I am struggling a bit on how to operate with strings. Furthermore, apparently there is no \"while\" loops, there are only \"for\" loops, which doesn't allow me to achieve what I want.\nBasically, given the string:\n\"helloujjkk\" I want to compare all characters with the next one, and to verify if they match.\nExample, for \"helloujjkk\", I want to return \"l\",\"j\", and \"k\" because those characters are followed by the same character.\nThe way I did this in Python was like this:</p>\n\n<pre><code>hello=\"helloujjkk\"\ni=0\nwhile i &lt; len(hello)-1:\n    if hello[i] == hello[i+1]:\n        print hello[i]\n    i +=1\n</code></pre>\n\n<p>So far, this is the way I am iterating over the string:</p>\n\n<pre><code>word := \"helloujjkk\"\nfor _,character := range word {\n     fmt.Println(string(character))\n}\n</code></pre>\n\n<p>but I haven't found how can I find the \"next\" character in the string.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1576989588, "post_id": 59441587, "comment_id": 105066932, "body": "Have you tried to change <code>cmd.Dir</code> to your path, i.e., `cmd.Dir =/root/go/src/bin/binaryfile/Stubs/&quot;?"}, {"owner": {"reputation": 3, "user_id": 9135432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9511346eb71ac2872012ee7a0190f0ee?s=128&d=identicon&r=PG&f=1", "display_name": "Douglas choi", "link": "https://stackoverflow.com/users/9135432/douglas-choi"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1577055572, "post_id": 59441587, "comment_id": 105079917, "body": "no I didn&#39;t. what do you mean your i.e.?  should i change the tree structure. ( ps.   makensis is binary file&#39;s name.)"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 9135432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9511346eb71ac2872012ee7a0190f0ee?s=128&d=identicon&r=PG&f=1", "display_name": "Douglas choi", "link": "https://stackoverflow.com/users/9135432/douglas-choi"}, "edited": false, "score": 0, "creation_date": 1577078621, "post_id": 59442542, "comment_id": 105083283, "body": "It&#39;s running. Thank you. What does the source code  mean  that?"}, {"owner": {"reputation": 853, "user_id": 3912286, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NcDhR.jpg?s=128&g=1", "display_name": "h3yduck", "link": "https://stackoverflow.com/users/3912286/h3yduck"}, "reply_to_user": {"reputation": 3, "user_id": 9135432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9511346eb71ac2872012ee7a0190f0ee?s=128&d=identicon&r=PG&f=1", "display_name": "Douglas choi", "link": "https://stackoverflow.com/users/9135432/douglas-choi"}, "edited": false, "score": 0, "creation_date": 1577448537, "post_id": 59442542, "comment_id": 105173535, "body": "You are welcome! It seems like you have two <code>GOROOT</code>s: <code>&#47;root&#47;go</code> and <code>&#47;usr&#47;local&#47;go</code>. Your system setting points to <code>&#47;usr&#47;local&#47;go</code>, but what you really want to use is <code>&#47;root&#47;go</code> in this case. Setting <code>cmd.Env</code> overrides the system setting."}], "tags": [], "owner": {"reputation": 853, "user_id": 3912286, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NcDhR.jpg?s=128&g=1", "display_name": "h3yduck", "link": "https://stackoverflow.com/users/3912286/h3yduck"}, "is_accepted": true, "score": 0, "last_activity_date": 1577007429, "last_edit_date": 1577007429, "creation_date": 1577001498, "answer_id": 59442542, "question_id": 59441587, "link": "https://stackoverflow.com/questions/59441587/how-to-set-the-location-of-the-files-referenced-by-a-binary-file/59442542#59442542", "title": "How to set the location of the files referenced by a binary file", "body": "<p>You can try overriding the subprocess's <code>GOROOT</code> like this:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>cmd.Env = []string{\"GOROOT=/root/go/\"}`\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 9135432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9511346eb71ac2872012ee7a0190f0ee?s=128&d=identicon&r=PG&f=1", "display_name": "Douglas choi", "link": "https://stackoverflow.com/users/9135432/douglas-choi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 59442542, "answer_count": 1, "score": -2, "last_activity_date": 1577055381, "creation_date": 1576988380, "last_edit_date": 1577055381, "question_id": 59441587, "link": "https://stackoverflow.com/questions/59441587/how-to-set-the-location-of-the-files-referenced-by-a-binary-file", "title": "How to set the location of the files referenced by a binary file", "body": "<p>When \"makensis\" binaryfile excutes test.nsi, The \"makensis\" binary file must refer to  \"zlib-x86-ansi\" file in Stubs directory. but It searches GOROOT directory. so It cuases error. How can I fix it?</p>\n\n<pre><code>GOROOT = /usr/local/go/\n/root/go/src/bin/makensis\n            /Stubs/zlib-x86-ansi\n            /nsis/test.nsi\n</code></pre>\n\n<pre><code>        cmd := exec.Command(\"/root/go/src/bin/makensis\",\"/root/go/src/nsis/test.nsi\")\n        cmd.Dir = \"/root/go/src/bin/\"\n\n        var out bytes.Buffer\n        var stderr bytes.Buffer\n        cmd.Stdout = &amp;out\n        cmd.Stderr = &amp;stderr                                                                                                                                                                                                                                                          \n        err := cmd.Run()\n        if err != nil {\n        log.Println(fmt.Sprint(err) + \": \" + stderr.String())\n        return err\n\n</code></pre>\n\n<pre><code>exit status 1: Error: \"/usr/local/go/src/Stubs/zlib-x86-ansi\"\n</code></pre>\n"}, {"tags": ["go", "vim", "direnv"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1577006513, "post_id": 59441573, "comment_id": 105069114, "body": "Please add the output of  <code>$ env</code> to your question <a href=\"https://stackoverflow.com/posts/59441573/edit\">by editing it</a>."}, {"owner": {"reputation": 3641, "user_id": 4400820, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-zJIsBHmva1w/AAAAAAAAAAI/AAAAAAAAAFA/VyUtonEauos/photo.jpg?sz=128", "display_name": "D. Ben Knoble", "link": "https://stackoverflow.com/users/4400820/d-ben-knoble"}, "edited": false, "score": 0, "creation_date": 1577024631, "post_id": 59441573, "comment_id": 105072795, "body": "I have to admit it looks a little strange that those paths link to <code>&#47;root</code>\u2014you\u2019re not developing code logged in as the root user are you?"}, {"owner": {"reputation": 3641, "user_id": 4400820, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-zJIsBHmva1w/AAAAAAAAAAI/AAAAAAAAAFA/VyUtonEauos/photo.jpg?sz=128", "display_name": "D. Ben Knoble", "link": "https://stackoverflow.com/users/4400820/d-ben-knoble"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1577024946, "post_id": 59441573, "comment_id": 105072857, "body": "@MarkusWMahlberg or <code>printenv GOPATH</code> would surely be enough? Maybe `env | grep &#39;GO.*&#39;"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 3641, "user_id": 4400820, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-zJIsBHmva1w/AAAAAAAAAAI/AAAAAAAAAFA/VyUtonEauos/photo.jpg?sz=128", "display_name": "D. Ben Knoble", "link": "https://stackoverflow.com/users/4400820/d-ben-knoble"}, "edited": false, "score": 0, "creation_date": 1577040987, "post_id": 59441573, "comment_id": 105076987, "body": "@D.BenKnoble Either would do, ofc. Trying to keep it simple for OP, and people to answer know what to look for, anyway."}, {"owner": {"reputation": 17, "user_id": 10446590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74ab1aeb273899b0a5b1f41c080af487?s=128&d=identicon&r=PG&f=1", "display_name": "happy coding", "link": "https://stackoverflow.com/users/10446590/happy-coding"}, "reply_to_user": {"reputation": 3641, "user_id": 4400820, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-zJIsBHmva1w/AAAAAAAAAAI/AAAAAAAAAFA/VyUtonEauos/photo.jpg?sz=128", "display_name": "D. Ben Knoble", "link": "https://stackoverflow.com/users/4400820/d-ben-knoble"}, "edited": false, "score": 0, "creation_date": 1577623163, "post_id": 59441573, "comment_id": 105209849, "body": "@D.BenKnoble i was logged in as root"}, {"owner": {"reputation": 3641, "user_id": 4400820, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-zJIsBHmva1w/AAAAAAAAAAI/AAAAAAAAAFA/VyUtonEauos/photo.jpg?sz=128", "display_name": "D. Ben Knoble", "link": "https://stackoverflow.com/users/4400820/d-ben-knoble"}, "edited": false, "score": 0, "creation_date": 1577626360, "post_id": 59441573, "comment_id": 105210621, "body": "@happycoding ahhh! Why? (That\u2019s a Bad Idea\u2122\ufe0f)"}], "owner": {"reputation": 17, "user_id": 10446590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74ab1aeb273899b0a5b1f41c080af487?s=128&d=identicon&r=PG&f=1", "display_name": "happy coding", "link": "https://stackoverflow.com/users/10446590/happy-coding"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 169, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1577024884, "creation_date": 1576988118, "last_edit_date": 1577024884, "question_id": 59441573, "link": "https://stackoverflow.com/questions/59441573/use-direnv-then-the-gopls-error-said-cant-import-fmt", "title": "use direnv then the gopls error said can&#39;t import fmt", "body": "<p>I started using <code>direnv</code> recently. </p>\n\n<p>I created a <code>.envrc</code> file in my project\u2019s root directory.</p>\n\n<p>There is only one line in <code>.envrc</code>:</p>\n\n<pre><code>export GOPATH=$(pwd)\n</code></pre>\n\n<p>I use vim with coc &amp; gopls to write go, but when I open <code>main.go</code> coc shows this error</p>\n\n<pre><code>Error [compiler] could not import os (no package for import os)\n</code></pre>\n\n<p>This is my project structure</p>\n\n<pre><code>.\n\u251c\u2500\u2500 .envrc\n\u251c\u2500\u2500 bin -&gt; /root/go/bin\n\u251c\u2500\u2500 out\n\u251c\u2500\u2500 pkg -&gt; /root/go/pkg\n\u2514\u2500\u2500 src\n    \u251c\u2500\u2500 github.com -&gt; /root/go/src/github.com\n    \u251c\u2500\u2500 golang.org -&gt; /root/go/src/golang.org\n    \u2514\u2500\u2500 monkey\n        \u251c\u2500\u2500 lexer\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 lexer.go\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 lexer_test.go\n        \u251c\u2500\u2500 main.go\n        \u251c\u2500\u2500 out\n        \u251c\u2500\u2500 repl\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 repl.go\n        \u2514\u2500\u2500 token\n            \u2514\u2500\u2500 token.go\n\n</code></pre>\n"}, {"tags": ["ubuntu", "go", "service"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1576982202, "post_id": 59440913, "comment_id": 105066249, "body": "Are you planning to build the go app on this instance? Once the go app is built, GOPATH is meaningless unless the app explicitly uses it."}, {"owner": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1576984536, "post_id": 59440913, "comment_id": 105066461, "body": "No, the app is built on my local dev machine and scp to the vps. Although the app is in my local GOPATH I have since converted it to use modules. Can I just remove that line and call it a day?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1576985046, "post_id": 59440913, "comment_id": 105066500, "body": "As I said, the binary doesn&#39;t need GOPATH unless for some reason it is explicitly checking it, which is unlikely. So, it should just work without GOPATH."}], "answers": [{"tags": [], "owner": {"reputation": 502, "user_id": 4896540, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87995a686ab93aa90a57360c43ea00b6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4896540/alex"}, "is_accepted": true, "score": 1, "last_activity_date": 1576990873, "creation_date": 1576990873, "answer_id": 59441731, "question_id": 59440913, "link": "https://stackoverflow.com/questions/59440913/creating-a-service-for-using-go-modules/59441731#59441731", "title": "Creating a service for using go modules", "body": "<p>No need for <code>GOPATH</code>. Just set <code>ExecStart</code> and <code>WorkingDirectory</code> (in case it makes sense).</p>\n\n<p><a href=\"https://fabianlee.org/2017/05/21/golang-running-a-go-binary-as-a-systemd-service-on-ubuntu-16-04/\" rel=\"nofollow noreferrer\">https://fabianlee.org/2017/05/21/golang-running-a-go-binary-as-a-systemd-service-on-ubuntu-16-04/</a></p>\n"}], "owner": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 59441731, "answer_count": 1, "score": 0, "last_activity_date": 1577007057, "creation_date": 1576975721, "last_edit_date": 1577007057, "question_id": 59440913, "link": "https://stackoverflow.com/questions/59440913/creating-a-service-for-using-go-modules", "title": "Creating a service for using go modules", "body": "<p>I'm trying to deploy a Go application on an Ubuntu VPS instance on DO. I need to create a service but the only examples I can find include the use of <code>GOPATH</code> like in <a href=\"https://medium.com/@tabvn/deploy-golang-application-on-digital-ocean-server-ubuntu-16-04-b7bf5340ccd9\" rel=\"nofollow noreferrer\">this tutorial</a>.</p>\n\n<p>Since the advent of modules I should not need to use <code>GOPATH</code> and <code>Go</code> is not installed on my server.</p>\n\n<p>How can I change this code to create a service to run a Go app without <code>GOPATH</code>?</p>\n\n<pre><code>[Unit]\nDescription= instance to serve api\nRequires=mysql.service\nAfter=network.target\nAfter=mysql.service[Service]\nUser=root\nGroup=www-data\nEnvironment=GOPATH=/srv/api/\nExecStart=/srv/api/myapp[Install]\nWantedBy=multi-user.target\n</code></pre>\n\n<p>edit: This file works</p>\n\n<pre><code>[Unit]\nDescription= instance to serve api\nConditionPathExists=/srv/api/myapp-api\nRequires=mysql.service\nAfter=network.target\nAfter=mysql.service\n\n[Service]\nType=simple\nAmbientCapabilities=CAP_SYS_RAWIO\nUser=nobody\nGroup=www-data\nLimitNOFILE=1024\n\nWorkingDirectory=/srv/api\nExecStart=/srv/api/myapp-api\n\nStandardOutput=syslog\nStandardError=syslog\nSyslogIdentifier=myapp-api\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n"}, {"tags": ["go", "mutex", "channel", "goroutine"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1576974881, "post_id": 59440713, "comment_id": 105065473, "body": "Work with discrete points in time.  For each point in time, loop over all nodes to find senders.  If more than one, discard sent data.  If exactly one, deliver to all nodes in receive mode.  Mutexes, channels and what not are not required."}], "answers": [{"comments": [{"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "edited": false, "score": 0, "creation_date": 1576993367, "post_id": 59441467, "comment_id": 105067320, "body": "Yes, this is a good idea, provided that fobidden actions, such as send data simultaneusly, does not happen."}], "tags": [], "owner": {"reputation": 96, "user_id": 11670343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VrFDk.png?s=128&g=1", "display_name": "Roshan Patil", "link": "https://stackoverflow.com/users/11670343/roshan-patil"}, "is_accepted": true, "score": 1, "last_activity_date": 1576986186, "creation_date": 1576986186, "answer_id": 59441467, "question_id": 59440713, "link": "https://stackoverflow.com/questions/59440713/emulate-radio-communication-using-channel-or-mutex/59441467#59441467", "title": "emulate radio communication using channel or mutex", "body": "<p>Why don't you create a <strong>publisher and subscriber</strong> module using Golang Channels. </p>\n\n<p>Create a centralized queuing system where all your sender and receiver nodes register themself. If any node sends the data it will go to that module and from the sender's list, it picks the senders channel and starts writing on it. The same applies to receivers also.</p>\n\n<p>You have to create one channel per node and register it to a central pub/sub module. This will definitely solve your problem.</p>\n"}], "owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 1, "accepted_answer_id": 59441467, "answer_count": 1, "score": 1, "last_activity_date": 1577007104, "creation_date": 1576972620, "last_edit_date": 1577007104, "question_id": 59440713, "link": "https://stackoverflow.com/questions/59440713/emulate-radio-communication-using-channel-or-mutex", "title": "emulate radio communication using channel or mutex", "body": "<p>I need to emulate a radio communication network composed of N nodes, with these properties:</p>\n\n<ol>\n<li>nodes either send then receive data, or receive then send data, but not at the same time.</li>\n<li>data sent over-the-air are received by all nodes which are in receive mode at that time.</li>\n<li>if two or more nodes sends data simultaneously, data are lost.</li>\n<li>there is no time synchronization among nodes.</li>\n</ol>\n\n<p>In Go, if I use a channel to emulate the transmission media, data are serialized, and only one receiver gets the data, not all of them. </p>\n\n<p>Also, I cannot think of a way to \"ruin\" the data if two sender try to send at the same time. Whether I use a mutex or not, one of the sender will successfully get its message sent.</p>\n"}, {"tags": ["list", "pointers", "go", "struct", "linked-list"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1576969275, "post_id": 59440401, "comment_id": 105064569, "body": "<code>l = *l.Next</code> is the line that gives you troubles. So just don&#39;t dereference if <code>l.Next</code> is nil."}], "answers": [{"tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": false, "score": 2, "last_activity_date": 1576969793, "creation_date": 1576969793, "answer_id": 59440519, "question_id": 59440401, "link": "https://stackoverflow.com/questions/59440401/what-is-the-correct-way-to-check-nil-pointer-de-reference/59440519#59440519", "title": "What is the correct way to check nil pointer de-reference?", "body": "<p>The fact that you have a value receiver doesn't change the fact that you have pointer fields. And you don't need to coerce their form to receiver's form (value/pointer). They can remain pointers. No need to dereference (explicitly).</p>\n\n<pre><code>func (l ListNode) display() {\n    curNode := &amp;l\n    for curNode != nil {\n        fmt.Printf(\"%v -&gt;\", curNode.Val)\n        curNode = curNode.Next\n    }\n    fmt.Println()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1525, "user_id": 3794944, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/535b1fee1a0aa4a92c0c762d1c0d9628?s=128&d=identicon&r=PG&f=1", "display_name": "Funsaized", "link": "https://stackoverflow.com/users/3794944/funsaized"}, "edited": false, "score": 0, "creation_date": 1577212549, "post_id": 59440588, "comment_id": 105123218, "body": "thanks! the above two display examples make sense... one question though. I don&#39;t see why the for &amp;l != nil statement is pointless. I&#39;m not checking the variable value of <code>l</code>, but rather the address of <code>l</code>, which changes in each iteration of the loop, right?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 1525, "user_id": 3794944, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/535b1fee1a0aa4a92c0c762d1c0d9628?s=128&d=identicon&r=PG&f=1", "display_name": "Funsaized", "link": "https://stackoverflow.com/users/3794944/funsaized"}, "edited": false, "score": 0, "creation_date": 1577213205, "post_id": 59440588, "comment_id": 105123385, "body": "No, address of <code>l</code> never changes. <code>l</code> is the copy of the <code>ListNode</code>, it has a value, and <code>&amp;l</code> always points to that value. When you do <code>l=*l.Next</code> you rewrite the contents of that copy with the contents of the next node."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1576970727, "creation_date": 1576970727, "answer_id": 59440588, "question_id": 59440401, "link": "https://stackoverflow.com/questions/59440401/what-is-the-correct-way-to-check-nil-pointer-de-reference/59440588#59440588", "title": "What is the correct way to check nil pointer de-reference?", "body": "<p>There is no point in testing the address of a value receiver to see if it is nil like this:</p>\n\n<pre><code> for &amp;l != nil {\n</code></pre>\n\n<p>Here, <code>l</code> is a variable with a value, and it can never be nil. </p>\n\n<p>If you get a pointer receiver, this will do it, and will work even when <code>l</code> is nil:</p>\n\n<pre><code>func (l *ListNode) display() {\n   for trc:=l; trc!=nil; trc=trc.Next {\n        fmt.Printf(\"%v -&gt;\", trc.Val)\n    }\n}\n</code></pre>\n\n<p>If you get a value receiver:</p>\n\n<pre><code>func (l ListNode) display() {\n   for trc:=&amp;l; trc!=nil; trc=trc.Next {\n        fmt.Printf(\"%v -&gt;\", trc.Val)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 148157, "user_id": 35364, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/f11512869fe2f8d87a2f2b687b76686c?s=128&d=identicon&r=PG", "display_name": "hasen", "link": "https://stackoverflow.com/users/35364/hasen"}, "is_accepted": false, "score": 0, "last_activity_date": 1576990947, "creation_date": 1576990947, "answer_id": 59441738, "question_id": 59440401, "link": "https://stackoverflow.com/questions/59440401/what-is-the-correct-way-to-check-nil-pointer-de-reference/59441738#59441738", "title": "What is the correct way to check nil pointer de-reference?", "body": "<p>This is a pointer deterrence:</p>\n\n<pre><code>v = *ptr\n</code></pre>\n\n<p>This will crash if ptr is nil. You check for nil <em>before</em> dereferencing.</p>\n\n<pre><code>if ptr != nil {\n    v = *ptr\n    // ...... \n}\n</code></pre>\n"}], "owner": {"reputation": 1525, "user_id": 3794944, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/535b1fee1a0aa4a92c0c762d1c0d9628?s=128&d=identicon&r=PG&f=1", "display_name": "Funsaized", "link": "https://stackoverflow.com/users/3794944/funsaized"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "accepted_answer_id": 59440588, "answer_count": 3, "score": 0, "last_activity_date": 1576990947, "creation_date": 1576968375, "last_edit_date": 1576968892, "question_id": 59440401, "link": "https://stackoverflow.com/questions/59440401/what-is-the-correct-way-to-check-nil-pointer-de-reference", "title": "What is the correct way to check nil pointer de-reference?", "body": "<p>To illustrate the question:</p>\n\n<p>Say you've got the following struct with a method display (value receiver) that is meant to print the contents:</p>\n\n<pre><code>type ListNode struct {\n    Val  int\n    Next *ListNode\n}\n\n\nfunc (l ListNode) display() {\n    for &amp;l != nil {\n        fmt.Printf(\"%v -&gt;\", l.Val)\n        l = *l.Next\n    }\n    fmt.Println()\n}\n\nfunc main() {\n    num1 := ListNode{2, &amp;ListNode{4, &amp;ListNode{3, nil}}}\n\n    num1.display()\n}\n\n</code></pre>\n\n<p>The above execution will error on the final loop since I've tried to de-reference nil with this output:</p>\n\n<pre><code>2 -&gt;4 -&gt;3 -&gt;panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x109ae6f]\n</code></pre>\n\n<p>However, changing the function to a pointer receiver, it elegantly becomes:</p>\n\n<pre><code>func (l *ListNode) display() {\n    for l != nil {\n        fmt.Printf(\"%v -&gt;\", l.Val)\n        l = l.Next\n    }\n    fmt.Println()\n}\n</code></pre>\n\n<p>with a happy output of:</p>\n\n<pre><code>2 -&gt;4 -&gt;3 -&gt;\n</code></pre>\n\n<p>As a \"newbie\" to go, I figured since the <code>display()</code> function is read only, it would be best to write the function with a value receiver, but run into this issue. Is there a more elegant solution with a value receiver I'm missing or a better way to de-reference in the original function?</p>\n"}, {"tags": ["go", "path", "uri", "segment"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1576951397, "creation_date": 1576951397, "answer_id": 59438604, "question_id": 59438561, "link": "https://stackoverflow.com/questions/59438561/how-to-obtain-the-last-path-segment-of-a-url/59438604#59438604", "title": "How to obtain the last path segment of a URL", "body": "<p>Use <a href=\"https://godoc.org/path#Base\" rel=\"noreferrer\">path.Base</a> to get the last element of a path:  <code>path.Base(myUrl.Path)</code> </p>\n\n<p><a href=\"https://play.golang.org/p/_zw3n_TXv0s\" rel=\"noreferrer\">Run it on the playground</a>.</p>\n"}], "owner": {"reputation": 21112, "user_id": 296427, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/8692a55fc3524ed4e7cb85b0b3b4693c?s=128&d=identicon&r=PG", "display_name": "pixel", "link": "https://stackoverflow.com/users/296427/pixel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1583, "favorite_count": 0, "accepted_answer_id": 59438604, "answer_count": 1, "score": 2, "last_activity_date": 1576955386, "creation_date": 1576951014, "last_edit_date": 1576955386, "question_id": 59438561, "link": "https://stackoverflow.com/questions/59438561/how-to-obtain-the-last-path-segment-of-a-url", "title": "How to obtain the last path segment of a URL", "body": "<p>I have following url:</p>\n\n<pre><code>targetUrl := \"http://google.com/foo/bar?a=1&amp;b=2\"\nmyUrl, err := url.Parse(targetUrl)\n</code></pre>\n\n<p>I wonder how I can obtain last path segment (<code>bar</code>) from <code>myUrl.Path</code>?</p>\n"}, {"tags": ["go", "buffalo"], "answers": [{"comments": [{"owner": {"reputation": 187, "user_id": 176290, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wSmd0.jpg?s=128&g=1", "display_name": "Ivo Dimitrov", "link": "https://stackoverflow.com/users/176290/ivo-dimitrov"}, "edited": false, "score": 1, "creation_date": 1581072204, "post_id": 60053920, "comment_id": 106316154, "body": "Thank you. I had the same issue and it&#39;s weird but it looks like you can&#39;t create project &quot;test_project&quot; \ud83d\ude43"}, {"owner": {"reputation": 70, "user_id": 1197085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/305732ea94c5e5f59691869381158347?s=128&d=identicon&r=PG", "display_name": "Thorsten Eggert", "link": "https://stackoverflow.com/users/1197085/thorsten-eggert"}, "reply_to_user": {"reputation": 187, "user_id": 176290, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wSmd0.jpg?s=128&g=1", "display_name": "Ivo Dimitrov", "link": "https://stackoverflow.com/users/176290/ivo-dimitrov"}, "edited": false, "score": 2, "creation_date": 1581160583, "post_id": 60053920, "comment_id": 106342880, "body": "Yes, my failed try was test_site ... (-: And I was not able to find the info in the net, only the source offered the answer."}, {"owner": {"reputation": 2656, "user_id": 1733043, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d663194dc8a3e9f9fb127f66cfc9a068?s=128&d=identicon&r=PG", "display_name": "ArunKolhapur", "link": "https://stackoverflow.com/users/1733043/arunkolhapur"}, "edited": false, "score": 1, "creation_date": 1592991222, "post_id": 60053920, "comment_id": 110620557, "body": "This is so stupid. I want to create a project with name <code>developer_console</code> which is not allowed."}, {"owner": {"reputation": 90, "user_id": 2561989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb9c8167660ab75048a0f24a7a3a0d0?s=128&d=identicon&r=PG", "display_name": "paganotoni", "link": "https://stackoverflow.com/users/2561989/paganotoni"}, "edited": false, "score": 1, "creation_date": 1595183647, "post_id": 60053920, "comment_id": 111379792, "body": "Hey \ud83d\udc4b, This one should have been fixed in v0.16.11. Thanks for pointing it out. This might have been residual technical debt from one of our original CLI&#39;s implementation."}], "tags": [], "owner": {"reputation": 70, "user_id": 1197085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/305732ea94c5e5f59691869381158347?s=128&d=identicon&r=PG", "display_name": "Thorsten Eggert", "link": "https://stackoverflow.com/users/1197085/thorsten-eggert"}, "is_accepted": true, "score": 2, "last_activity_date": 1580807243, "creation_date": 1580807243, "answer_id": 60053920, "question_id": 59438153, "link": "https://stackoverflow.com/questions/59438153/go-buffalo-erro0000-error-name-buffalodevn-is-not-allowed-try-a-different-a/60053920#60053920", "title": "Go Buffalo: ERRO[0000] Error: name buffalodevn is not allowed, try a different application name", "body": "<p>I found your question since I had the same problem and searched for a solution... Then I had a look into the source and found:</p>\n\n<pre><code>fb := append(opts.ForbiddenNames, \"buffalo\", \"test\", \"dev\")\n</code></pre>\n\n<p>So it seems the name is not allowed to contain \"buffalo\", \"test\" or \"dev\".</p>\n"}], "owner": {"reputation": 79, "user_id": 11878194, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XWnWs.jpg?s=128&g=1", "display_name": "Alex Merced", "link": "https://stackoverflow.com/users/11878194/alex-merced"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 60053920, "answer_count": 1, "score": 0, "last_activity_date": 1580807243, "creation_date": 1576947767, "question_id": 59438153, "link": "https://stackoverflow.com/questions/59438153/go-buffalo-erro0000-error-name-buffalodevn-is-not-allowed-try-a-different-a", "title": "Go Buffalo: ERRO[0000] Error: name buffalodevn is not allowed, try a different application name", "body": "<p>When trying to start a new buffalo project in my Go Path I get this error, in my search I don't see any references to this error in the docs or in other questions on different forums. I've tried different names in different forms but I always get the same error and I can't figure out why. (tried names without buffalo)</p>\n\n<pre><code>ERRO[0000] Error: name buffalodevn is not allowed, try a different application name\n</code></pre>\n\n<p>when I run Buffalo Info</p>\n\n<pre><code>-&gt; Go: Checking installation\n\u2713 The `go` executable was found on your system at: /usr/local/go/bin/go\n\n-&gt; Go: Checking minimum version requirements\n\u2713 Your version of Go, 1.13.4, meets the minimum requirements.\n\n-&gt; Go: Checking GOPATH\n\u2713 You are using Go Modules, so no need to worry about the GOPATH.\n\n-&gt; Go: Checking Package Management\n\u2713 You are using Go Modules (`go`) for package management.\n\n-&gt; Go: Checking PATH\n\u2713 Your PATH contains /home/alexmerced/go/bin.\n\n-&gt; Node: Checking installation\n\u2713 The `node` executable was found on your system at: /usr/bin/node\n\n-&gt; Node: Checking minimum version requirements\n\u2713 Your version of Node, v12.13.1, meets the minimum requirements.\n\n-&gt; NPM: Checking installation\n\u2713 The `npm` executable was found on your system at: /usr/bin/npm\n\n-&gt; NPM: Checking minimum version requirements\n\u2713 Your version of NPM, 6.13.4, meets the minimum requirements.\n\n-&gt; Yarn: Checking installation\n\u2718 The `yarnpkg` executable could not be found on your system.\nFor help setting up your Yarn environment please follow the instructions for you platform at:\n\nhttps://yarnpkg.com/en/docs/install\n\n-&gt; PostgreSQL: Checking installation\n\u2718 The `postgres` executable could not be found on your system.\nFor help setting up your Postgres environment please follow the instructions for you platform at:\n\nhttps://www.postgresql.org/download/\n\n-&gt; MySQL: Checking installation\n\u2718 The `mysql` executable could not be found on your system.\nFor help setting up your MySQL environment please follow the instructions for you platform at:\n\nhttps://www.mysql.com/downloads/\n\n-&gt; SQLite3: Checking installation\n\u2713 The `sqlite3` executable was found on your system at: /usr/bin/sqlite3\n\n-&gt; SQLite3: Checking minimum version requirements\n\u2713 Your version of SQLite3, 3.29.0, meets the minimum requirements.\n\n-&gt; Cockroach: Checking installation\n\u2718 The `cockroach` executable could not be found on your system.\nFor help setting up your Cockroach environment please follow the instructions for you platform at:\n\nhttps://www.cockroachlabs.com/docs/stable/\n\n-&gt; Buffalo (CLI): Checking installation\n\u2713 The `buffalo` executable was found on your system at: /usr/local/bin/buffalo\n\n-&gt; Buffalo (CLI): Checking minimum version requirements\n\u2713 Your version of Buffalo (CLI), v0.15.3, meets the minimum requirements.\n\n-&gt; Buffalo: Application Details\nPwd         /home/alexmerced\nRoot        /home/alexmerced\nGoPath      /home/alexmerced/go\nPackagePkg  alexmerced\nActionsPkg  alexmerced/actions\nModelsPkg   alexmerced/models\nGriftsPkg   alexmerced/grifts\nWithModules true\nName        alexmerced\nBin         bin/alexmerced\nVCS         \nWithPop     false\nWithSQLite  false\nWithDep     false\nWithWebpack false\nWithNodeJs  false\nWithYarn    false\nWithDocker  false\nWithGrifts  false\nAsWeb       true\nAsAPI       false\nInApp       false\nPackageJSON {map[]}\n</code></pre>\n"}, {"tags": ["go", "import", "package"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1576941307, "post_id": 59437314, "comment_id": 105058879, "body": "<a href=\"https://stackoverflow.com/questions/38517593/relative-imports-in-go\">Do not use relative imports</a>."}, {"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 1, "creation_date": 1576941693, "post_id": 59437314, "comment_id": 105058959, "body": "You can use a module file that defines the name of your module and its submodules"}, {"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "reply_to_user": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1576941836, "post_id": 59437314, "comment_id": 105058997, "body": "@xarantolus How? Given above sample program, what actions should I perform?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1576955124, "post_id": 59437314, "comment_id": 105061931, "body": "@xakepp35: What is non-sense? Using the Go as intended?"}, {"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 1, "creation_date": 1577004487, "post_id": 59437314, "comment_id": 105068809, "body": "@xakepp35 you should run <code>go mod init your.domain&#47;somename</code> in your package root (<code>myapp</code>), it will create a file called <code>go.mod</code>. Now you can import <code>your.domain&#47;somename&#47;myapi</code> to access your package. When you move the root folder somewhere else, you can still build it. You could even build it without downloading packages on another pc by <a href=\"https://stackoverflow.com/q/58697521\">vendoring your dependencies</a>"}, {"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "reply_to_user": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1577077108, "post_id": 59437314, "comment_id": 105083007, "body": "@xarantolus <code>gcc</code> is always on the system, so in my imaginary nuclear disaster, i can fallback using it. So here goes my that upper question.. Can golang be like so? Local only! Or.. would it require constant internet connection, thus unusable by profesional devs?"}, {"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1577085601, "post_id": 59437314, "comment_id": 105085068, "body": "After you set up the module (the name is usually a domain, but the build process won&#39;t try to connect to it; it&#39;s just a name), you can run <code>go mod vendor</code> in your root directory to download all dependencies. As I explained in <a href=\"https://stackoverflow.com/a/58700267\">this answer</a>, it is possible to use go completely offline after you downloaded your dependencies"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577089957, "post_id": 59437314, "comment_id": 105086312, "body": "@xakepp35: Bad analogy. A better analogy would be when someone asks &quot;How do I use a bazooka to kill a fly?&quot; and the answer is &quot;Don&#39;t use a bazooka to kill a fly.&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1577076125, "post_id": 59445036, "comment_id": 105082831, "body": "Thanks for expla, i&#39;ve upvoted your effort. For me, as a man of 20y of programming experience, golang is like C with some influences. Like Borland&#39;s one(Currently, Embarcadero) modules experience. And C.. But that was a real good thing(if you&#39;ve used to know things like Delphi 7, or latter RAD) - that allowed us not to bother with global stuff. It&#39;s like you may define some local module, that is just within your subfolder, and use it with ease."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577090470, "post_id": 59445036, "comment_id": 105086484, "body": "If you&#39;ve survived a nuclear war, and you&#39;re using Go, you&#39;ll still use Go as it&#39;s designed."}], "tags": [], "owner": {"reputation": 21, "user_id": 10717157, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-0s1zCPxzqFk/AAAAAAAAAAI/AAAAAAAAAOc/969780Fb2dg/photo.jpg?sz=128", "display_name": "Darker Bit", "link": "https://stackoverflow.com/users/10717157/darker-bit"}, "is_accepted": false, "score": 2, "last_activity_date": 1577024516, "creation_date": 1577024516, "answer_id": 59445036, "question_id": 59437314, "link": "https://stackoverflow.com/questions/59437314/golang-cannot-find-module-for-local-path/59445036#59445036", "title": "golang cannot find module for local path", "body": "<p>Go uses something called Module Paths. These are paths that identify your packages. They are not necessarily related to the file system.</p>\n\n<p>An example of a module path is <code>github.com/hajimehoshi/ebiten</code>.</p>\n\n<p>If you're using Go modules, this is also the path Go automatically downloads it from.</p>\n\n<p>If you're using $GOPATH, the path into the source of the module would be <code>go/src/github.com/hajimehoshi/ebiten</code>.</p>\n\n<p>Initialize your module with a new module path using <code>go mod init &lt;module path&gt;</code>. Generally this will be your GitHub repository, without the <code>https://</code>. This will allow for both your and others code to be able accessible using that module path. <code>myapi</code> should then be accessible via <code>import \"github.com/username/repo/myapi\"</code>.</p>\n\n<p>If you still wish to use the old $GOPATH method, simply place your code inside <code>go/src/&lt;module path&gt;</code>. The method of accessing <code>myapi</code> is equivalent.</p>\n\n<p>Read <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">Using Go Modules</a> and <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to write Go code</a> for more information.</p>\n"}], "owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8079, "favorite_count": 1, "closed_date": 1577090923, "answer_count": 1, "score": 1, "last_activity_date": 1577024516, "creation_date": 1576941168, "question_id": 59437314, "link": "https://stackoverflow.com/questions/59437314/golang-cannot-find-module-for-local-path", "closed_reason": "Duplicate", "title": "golang cannot find module for local path", "body": "<p>I want to push out some of API, from main package into separate package:</p>\n\n<pre><code>myapp/\n    main.go\n    myapi/\n        myapi.go\n</code></pre>\n\n<p>Inside <code>main.go</code> i have</p>\n\n<pre><code>package main\n\nimport \"./myapi\"\n\n...\n</code></pre>\n\n<p>And <code>myapi.go</code> just starts with:</p>\n\n<pre><code>package myapi\n\n...\n</code></pre>\n\n<p>When I am trying to run main, it seems like it can't find my <code>myapi</code> <code>#include</code>. It gives me following error: </p>\n\n<pre><code>D:\\go\\myapp&gt; go run .\nbuild _/D_/go/myapp/myapi: cannot find module for path _/D_/go/myapp/myapi\n</code></pre>\n\n<p>I came from C/C++ world, and it's extremely unobvious, how to include from subfolder in golang. Could you help me with this?</p>\n"}, {"tags": ["string", "go", "golang-migrate"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1576940056, "last_edit_date": 1576940056, "creation_date": 1576936125, "answer_id": 59436714, "question_id": 59436609, "link": "https://stackoverflow.com/questions/59436609/how-to-convert-a-charatindex-of-string-to-ascii-equivalent-int-value/59436714#59436714", "title": "How to convert a charAtIndex of string to ASCII equivalent int value", "body": "<p>If you can be certain your strings are not empty and their first rune is in the range of <code>0..127</code>, you may simply do:</p>\n\n<pre><code>strArr[strA[0]] = strA\nstrArr[strB[0]] = strB\n</code></pre>\n\n<p>Because indexing strings indexes their UTF-8 encoded bytes (this is how Go stores strings in memory), and runes in the range of <code>0..127</code> map to bytes 1-to-1, so the first byte is the value of the first <code>rune</code>.</p>\n\n<p>Of course if <code>strA</code> or <code>strB</code> would be empty or their first rune would not fall in the range of <code>0..127</code>, the above code would panic.</p>\n\n<p>You can avoid the panic by checking the string and its first byte prior, e.g.:</p>\n\n<pre><code>func set(s string) {\n    if s == \"\" || s[0] &gt; 127 {\n        return\n    }\n    strArr[s[0]] = s\n}\n</code></pre>\n\n<p>This <code>set()</code> function indexes the <code>s</code> string twice (first when checking if the first rune / byte is in the valid range, next when indexing the <code>strArr</code>). We may store the result of the first indexing and reuse that in the second case, which may or may not give a performance improvement:</p>\n\n<pre><code>func set2(s string) {\n    if s != \"\" {\n        return\n    }\n    if first := s[0]; first &lt;= 127 {\n        strArr[first] = s\n    }\n}\n</code></pre>\n\n<p>Try the examples on the <a href=\"https://play.golang.org/p/FswM4Au7d5y\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 395, "user_id": 3868505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e199a2eeabd37f2dec3368e7f6c091a2?s=128&d=identicon&r=PG&f=1", "display_name": "amarjeetAnand", "link": "https://stackoverflow.com/users/3868505/amarjeetanand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 59436714, "answer_count": 1, "score": 0, "last_activity_date": 1576940056, "creation_date": 1576935223, "last_edit_date": 1576938234, "question_id": 59436609, "link": "https://stackoverflow.com/questions/59436609/how-to-convert-a-charatindex-of-string-to-ascii-equivalent-int-value", "title": "How to convert a charAtIndex of string to ASCII equivalent int value", "body": "<p>I have a set of strings (ASCII), that I want to assign to a string array (of cap 128).\nThe position of the string in the array is decided by the ASCII value of the first char of the string.\nLike..</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>strArr := [128]string{}\nstrA := \"A string\"\nstrB := \"B string\"\nstrArr[65] = strA // since strA started with 'A' &amp; ASCII('A') = 65\nstrArr[66] = strB // since strB started with 'B' &amp; ASCII('B') = 66\n</code></pre>\n\n<p>There is one solution of using <code>utf8</code> package, like ...<br></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>r, _ := utf8.DecodeRuneInString(strA)\nstrArr[r] = strA\n</code></pre>\n\n<h2>Is it possible to time optimise this solution?</h2>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 871354, "user_id": 157247, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/4HovX.jpg?s=128&g=1", "display_name": "T.J. Crowder", "link": "https://stackoverflow.com/users/157247/t-j-crowder"}, "edited": false, "score": 0, "creation_date": 1576930766, "post_id": 59436082, "comment_id": 105056682, "body": "<a href=\"https://stackoverflow.com/questions/tagged/javascript\">javascript</a> is for questions about JavaScript. This is a question about Go. The fact the string comes from JavaScript is neither here nor there."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1576933780, "post_id": 59436082, "comment_id": 105057233, "body": "<a href=\"https://golang.org/pkg/time/#Time.UnmarshalJSON\" rel=\"nofollow noreferrer\">RFC3339 is the correct format</a>. That being said, you shouldn&#39;t use strings to represent times in Go. Use time.Time throughout; it works with JSON and databases: <a href=\"https://play.golang.org/p/hV0Hbvh3bou\" rel=\"nofollow noreferrer\">play.golang.org/p/hV0Hbvh3bou</a>. If should never have to parse dates by hand when dealing with JSON and databases."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1576949652, "post_id": 59436082, "comment_id": 105060775, "body": "See <a href=\"https://play.golang.org/p/wqn5yxRbTOe\" rel=\"nofollow noreferrer\">play.golang.org/p/wqn5yxRbTOe</a>.  The example value <code>&quot;2019-12-21T12:09:56.807Z&quot;</code> is successfully parsed with  <code>time.RFC3339</code>.  Is <code>vm.TransactionDate</code> the value you expect?"}, {"owner": {"reputation": 1163, "user_id": 5481865, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/36eb3783cb07bbdff9581179614bcf5e?s=128&d=identicon&r=PG&f=1", "display_name": "FailedUnitTest", "link": "https://stackoverflow.com/users/5481865/failedunittest"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1576992502, "post_id": 59436082, "comment_id": 105067219, "body": "@Peter you were correct, I was overthinking it. I just bound the JSON data directly to type time.Time and that worked out just fine."}], "owner": {"reputation": 1163, "user_id": 5481865, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/36eb3783cb07bbdff9581179614bcf5e?s=128&d=identicon&r=PG&f=1", "display_name": "FailedUnitTest", "link": "https://stackoverflow.com/users/5481865/failedunittest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576939097, "creation_date": 1576930367, "last_edit_date": 1576939097, "question_id": 59436082, "link": "https://stackoverflow.com/questions/59436082/formatting-date-time-for-unmarshaling", "title": "Formatting date/time for unmarshaling", "body": "<p>I am building a basic CRUD app in Go+Gin. One of the fields of my model is <code>time.Time</code></p>\n\n<p>I am trying to write JavaScript code which would generate a compatible date/time format for Go unmarshaling, but I am failing to find the correct variation. </p>\n\n<p>This is my model:</p>\n\n<pre><code>type Transaction struct {\n    gorm.Model\n    UserID          string\n    TransactionDate time.Time\n    Balance         uint\n    Type            bool // 0 is debit, 1 is credit\n}\n</code></pre>\n\n<p>I try to unmarshal using this: </p>\n\n<pre><code>func (vm *TransactionViewModel) GetModel() Transaction {\n    transactionDate, e := time.Parse(time.RFC3339, vm.TransactionDate)\n    if e != nil {\n        panic(fmt.Sprintf(\"Failed to parse Transaction Date: %v\", vm.TransactionDate))\n    }\n    return Transaction{\n        Model:           gorm.Model{},\n        UserID:          vm.UserID,\n        TransactionDate: transactionDate,\n        Balance:         vm.Balance,\n        Type:            vm.Type,\n    }\n}\n</code></pre>\n\n<p>I am using this JavaScript to generate my Date: <code>(new Date()).toISOString()</code>\nwhich results in: \"2019-12-21T12:09:56.807Z\"</p>\n\n<p>The above approach, causes panic every time. I have tried using time.RFC3339 and <code>time.RFC3339Nano</code> formats. </p>\n\n<p>Does anyone have experience using dates between JS -> Go? What format have you used?</p>\n"}, {"tags": ["go", "command-line-interface", "command-line-arguments"], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1576934078, "post_id": 59435877, "comment_id": 105057301, "body": "&quot;The flag package does not support limiting the valid / accepted set of values for flags.&quot; One can stick the validation logic into an implementation of the <a href=\"https://golang.org/pkg/flag/#Value\" rel=\"nofollow noreferrer\">flag.Value interface</a>, though, producing good error messages: <a href=\"https://play.golang.org/p/eXhFj1DYCzC\" rel=\"nofollow noreferrer\">play.golang.org/p/eXhFj1DYCzC</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1576928600, "creation_date": 1576928600, "answer_id": 59435877, "question_id": 59435838, "link": "https://stackoverflow.com/questions/59435838/how-to-limit-the-range-of-values-acceptable-in-string-flag/59435877#59435877", "title": "How to limit the range of values acceptable in string flag?", "body": "<p>The <a href=\"https://golang.org/pkg/flag/\" rel=\"nofollow noreferrer\">flag</a> package does not support limiting the valid / accepted set of values for flags.</p>\n\n<p>What you can do is perform flag value validation, and this is a good practice in general: check the value at the start of your application and halt with an error message if the provided value is invalid (according to your arbitrary rules).</p>\n\n<p>See related question: <a href=\"https://stackoverflow.com/questions/31786215/can-command-line-flags-in-go-be-set-to-mandatory/31786364#31786364\">Can command line flags in Go be set to mandatory?</a></p>\n"}], "owner": {"reputation": 11, "user_id": 10144740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/790c1b79f64f39ea5f0389dec7552a4c?s=128&d=identicon&r=PG&f=1", "display_name": "Sloth", "link": "https://stackoverflow.com/users/10144740/sloth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 384, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1576928769, "creation_date": 1576928249, "last_edit_date": 1576928769, "question_id": 59435838, "link": "https://stackoverflow.com/questions/59435838/how-to-limit-the-range-of-values-acceptable-in-string-flag", "title": "How to limit the range of values acceptable in string flag?", "body": "<p>I declare a string flag with a default value like this:</p>\n\n<pre><code>animalFlag := flag.String(\"typeOfAnimal\", \"Cat\", \"Type of animal\")\n</code></pre>\n\n<p>I want to force that user could only give a specific string (like <code>\"Dog\"</code>, <code>\"Lion\"</code>) and not some random string like <code>\"Rose\"</code>.\nHow do I enforce this in Go?</p>\n"}, {"tags": ["windows", "go", "wget"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1576928066, "post_id": 59435802, "comment_id": 105056127, "body": "The <code>wget</code> command is not available on Windows by default."}, {"owner": {"reputation": 66625, "user_id": 229602, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/50063ac5c0d377349bb613953cf61be4?s=128&d=identicon&r=PG", "display_name": "Noufal Ibrahim", "link": "https://stackoverflow.com/users/229602/noufal-ibrahim"}, "edited": false, "score": 0, "creation_date": 1576928123, "post_id": 59435802, "comment_id": 105056139, "body": "My guess is that there&#39;s something wrong in your command string. Perhaps you should construct it upfront and print it out to see if it is what you want before running it?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576928136, "post_id": 59435802, "comment_id": 105056143, "body": "there are error, you are not checking for them appropriately."}, {"owner": {"reputation": 1, "user_id": 9700770, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Caleb Adams", "link": "https://stackoverflow.com/users/9700770/caleb-adams"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1576929738, "post_id": 59435802, "comment_id": 105056456, "body": "@icza I have wget installed."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1576929838, "post_id": 59435802, "comment_id": 105056481, "body": "Thinking a bit outside the box here, but why the heck introduce a dependency on <code>wget</code> for something you could <i>easily</i> implement in Go?"}, {"owner": {"reputation": 1, "user_id": 9700770, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Caleb Adams", "link": "https://stackoverflow.com/users/9700770/caleb-adams"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1576935053, "post_id": 59435802, "comment_id": 105057496, "body": "@MarkusWMahlberg It&#39;s actually not my script and I don&#39;t really write in Go, it&#39;s just an option I&#39;m forced to use. I&#39;ll explore handling downloading and moving the file in Go. Thanks for the suggestions!"}], "answers": [{"comments": [{"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1576936002, "post_id": 59436689, "comment_id": 105057686, "body": "You may also want to change the second <code>&quot;temp&#47;&quot; + filename</code> to <code>&quot;temp&#47;&quot; + filepath</code>"}], "tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": false, "score": 0, "last_activity_date": 1576935905, "creation_date": 1576935905, "answer_id": 59436689, "question_id": 59435802, "link": "https://stackoverflow.com/questions/59435802/exec-command-does-not-execute-on-windows-golang/59436689#59436689", "title": "exec.command does not execute on windows (golang)", "body": "<p>If you really want to keep this solution (the disadvantages have already been pointed out in the comments) you'll need to separate each argument to <code>cmd.exe</code>, so everywhere you would put a space you have a separate argument:</p>\n\n<pre><code>cmd := exec.Command(\"cmd\", \"/K\", \"wget\", url, \"-O\", \"temp/\" + filepath, \"&amp;&amp;\", \"echo\", \"Done downloading, moving...\", \"&amp;&amp;\", \"del\", \"-y\", filename, \"&amp;&amp;\", \"mv\", \"temp/\" + filename, filename)\n</code></pre>\n\n<p>Also see <a href=\"https://stackoverflow.com/a/57766699\">this answer</a> to a similar question</p>\n"}], "owner": {"reputation": 1, "user_id": 9700770, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Caleb Adams", "link": "https://stackoverflow.com/users/9700770/caleb-adams"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 327, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576967860, "creation_date": 1576927939, "last_edit_date": 1576967860, "question_id": 59435802, "link": "https://stackoverflow.com/questions/59435802/exec-command-does-not-execute-on-windows-golang", "title": "exec.command does not execute on windows (golang)", "body": "<p>I'm trying to make wget download a file into a temp directory then move it to the appropriate path. I'm trying to use the code below:</p>\n\n<pre><code>    // run shell `wget &lt;URL&gt; -O &lt;FILEPATH&gt;`\n    cmd := exec.Command(\"cmd /K wget\", url, \"-O\", \"temp/\" + filepath, \"&amp;&amp; echo Done downloading, moving... '&amp;&amp;' del -y\", filename,\"'&amp;&amp;' mv temp/\", filename, filename)\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n    return cmd.Run()\n}\n</code></pre>\n\n<p>but when called, it doesn't output anything. No errors, nothing.</p>\n"}, {"tags": ["go", "hystrix", "netflix", "fault-tolerance"], "answers": [{"tags": [], "owner": {"reputation": 158, "user_id": 10245760, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RNQ3BJ-mSGQ/AAAAAAAAAAI/AAAAAAAAAAw/B-wcw98aIqQ/photo.jpg?sz=128", "display_name": "Karl Anthony Baluyot", "link": "https://stackoverflow.com/users/10245760/karl-anthony-baluyot"}, "is_accepted": false, "score": 1, "last_activity_date": 1598407301, "creation_date": 1598407301, "answer_id": 63589449, "question_id": 59435420, "link": "https://stackoverflow.com/questions/59435420/golangs-hystrix-library-circuit-open-without-timeout-error/63589449#63589449", "title": "golang&#39;s hystrix library &quot;circuit open&quot; without &quot;timeout&quot; error", "body": "<p>Might be because of the <code>requestVolumeThreshold</code> which by default is set to 20.</p>\n<p>Per documentation from the hystrix golang client,</p>\n<pre><code>// DefaultVolumeThreshold is the minimum number of requests needed before a circuit can be tripped due to health\nDefaultVolumeThreshold = 20\n</code></pre>\n<p>You can set it with,</p>\n<pre><code>// Settings returns the hystrix command config\nfunc (c Config) Settings() hystrix.CommandConfig {\n   return hystrix.CommandConfig{\n      Timeout:                8000,\n      RequestVolumeThreshold: 1000, // FIXME: all calls must be paginated\n   }\n}\n</code></pre>\n<p>Adjusting it to a certain number greater than the default fixed my error.</p>\n"}], "owner": {"reputation": 1101, "user_id": 5261216, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cC2sAyNVGuk/AAAAAAAAAAI/AAAAAAAAAJo/2r_RFyBF1Xo/photo.jpg?sz=128", "display_name": "Sharath BJ", "link": "https://stackoverflow.com/users/5261216/sharath-bj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1598407301, "creation_date": 1576924454, "last_edit_date": 1576931606, "question_id": 59435420, "link": "https://stackoverflow.com/questions/59435420/golangs-hystrix-library-circuit-open-without-timeout-error", "title": "golang&#39;s hystrix library &quot;circuit open&quot; without &quot;timeout&quot; error", "body": "<p>we use hystrix for our golang application, here we are getting <strong>hystrix: circuit open</strong> error even though there is no <strong>hystrix: timeout</strong></p>\n\n<p><em>hystrix configuration:</em></p>\n\n<pre><code>hystrix.ConfigureCommand(cmd, hystrix.CommandConfig{\n        Timeout:               timeout,\n        MaxConcurrentRequests: 1000,\n        ErrorPercentThreshold: 5,\n        SleepWindow:           15 * 60 * 1000, //15 Minutes\n    })\n</code></pre>\n\n<p>in the hystrix fallback section,we log the error messages information. we can clearly see that we have got only <strong>hystrix: circuit open</strong> error without any other error</p>\n\n<p><a href=\"https://i.stack.imgur.com/Hwwac.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Hwwac.png\" alt=\"irregular circuit open\"></a></p>\n\n<p>and sometimes it behaves very randomly, in below image we can see there is no correlation between <strong>hystrix: timeout</strong> and <strong>hystrix: circuit open</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/f1TOZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/f1TOZ.png\" alt=\"no relation b/w circuit open and timeout\"></a></p>\n\n<p><em>sudo/sample hystrix code:</em></p>\n\n<pre><code>func crawl(vendor string, req *http.Request, timeout int) (result []byte) {\n\n    hystrix.Do(vendor, func() error {\n\n        resp, err := httpClient.Do(req)\n        if err != nil {\n            log.Errorln(\"Error sending post request: \", err)\n        } else {\n            defer resp.Body.Close()\n        }\n        respBody, errResp := ioutil.ReadAll(resp.Body)\n        if errResp != nil {\n            log.WithFields(log.Fields{\"RequestID\": requestID}).Errorln(\"Error reading parser response\", errResp, resp.Status)\n        }\n\n        if resp.StatusCode == 200 {\n            result = respBody\n        } else {\n            log.Errorln(\" SERVER SIDE ERROR\", resp.StatusCode, obj)\n        }\n\n        return nil\n    }, func(err error) error {\n        logApiTimeouts(vendor, err)\n        log.WithFields(log.Fields{\"RequestID\": requestID}).Errorln(\"Hystrix Error:\", err, obj)\n        return nil\n    })\n}\n</code></pre>\n\n<p>has anybody came across this error and how to fix this?</p>\n"}, {"tags": ["unit-testing", "http", "go", "mocking"], "comments": [{"owner": {"reputation": 20013, "user_id": 61410, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/f6dec0a61dbb283bf3e2a658d6710180?s=128&d=identicon&r=PG", "display_name": "tester", "link": "https://stackoverflow.com/users/61410/tester"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576918462, "post_id": 59434749, "comment_id": 105054522, "body": "@leafbebop this is helpful, but it requires me to modify the signature of CallExample to accept a URL as an argument. The <code>mockServerURL = ts.URL</code> confuses me. How would I just make <code>ts.URL</code> equal to <code>http:&#47;&#47;example.com&#47;foo</code>?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1576918861, "post_id": 59434749, "comment_id": 105054595, "body": "@tester, you don&#39;t. You have to make the base URL configurable. If you can&#39;t change the signature of CallExample, write a new function callExample(string) (which you can test) and change CallExample to simply call it with &quot;<a href=\"http://example.com\" rel=\"nofollow noreferrer\">example.com</a>&quot;."}], "owner": {"reputation": 20013, "user_id": 61410, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/f6dec0a61dbb283bf3e2a658d6710180?s=128&d=identicon&r=PG", "display_name": "tester", "link": "https://stackoverflow.com/users/61410/tester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 29, "favorite_count": 0, "closed_date": 1576918974, "answer_count": 0, "score": 0, "last_activity_date": 1576919971, "creation_date": 1576917694, "last_edit_date": 1576919971, "question_id": 59434749, "link": "https://stackoverflow.com/questions/59434749/how-to-set-up-an-http-get-fake-response", "closed_reason": "Duplicate", "title": "How to set up an HTTP GET fake response", "body": "<p>Given a function that makes an HTTP GET in Go:</p>\n\n<pre><code>package main\n\nimport (\n   \"net/http\"\n   \"io/ioutil\"\n)\n\nfunc CallExample() {\n  resp, _ := http.Get(\"http://example.com/foo\")\n  body, _ := ioutil.ReadAll(resp.Body)\n  return body\n}\n</code></pre>\n\n<p>How do I set up a test that calls this function (<code>CallExample</code>) while avoiding making the actual HTTP GET request?</p>\n\n<pre><code>package main\n\nimport (\n  \"testing\"\n)\n\nfunc TestCallExample(t *testing.T) {\n  // What setup do I need here to fake a response from http://example.com/foo?\n  got := CallExample()\n  want := \"foo\"\n  if got != want {\n    t.Errorf(\"Got %s, Want %s\", got, want)\n  }\n}\n</code></pre>\n\n<p>I understand there is a <code>import \"net/http/httptest\"</code> library, but it is unclear how to use it to intercept the GET and fake a response. Something to setup with <code>httptest.NewRecorder()</code>? It would also be much appreciated if you could show an example where you fake 200/404/500 status codes and different response bodies. Thanks.</p>\n\n<p><strong>Solution:</strong></p>\n\n<p>Had to modify <code>CallExample</code> to accept a <code>url</code> from the <code>httptest.NewServer()</code>'s <code>Server.URL</code>.</p>\n\n<pre><code>func CallExample(url string) (string) {\n  resp, _ := http.Get(url)\n  body, _ := ioutil.ReadAll(resp.Body)\n  return string(body)\n}\n\nfunc TestCallExample(t *testing.T) {\n  ts := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"foo\")\n  })) \n  defer ts.Close()\n\n  got := CallExample(ts.URL)\n  want := \"foo\"\n  if got != want {\n    t.Errorf(\"Got %s, Want %s\", got, want)\n  }\n}\n</code></pre>\n"}, {"tags": ["string", "go", "substring"], "comments": [{"owner": {"reputation": 3311, "user_id": 1377101, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/784e2ea3644631d338aca027d9085a9d?s=128&d=identicon&r=PG", "display_name": "igr", "link": "https://stackoverflow.com/users/1377101/igr"}, "edited": false, "score": 0, "creation_date": 1576924264, "post_id": 59434585, "comment_id": 105055481, "body": "Did you consider Golang templates ? <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">golang.org/pkg/text/template</a>"}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576923088, "post_id": 59434683, "comment_id": 105055287, "body": "it is more appropriate to shuffle once upfront. It prevents value duplication and avoids some more <a href=\"https://tip.golang.org/src/math/rand/rand.go?#L293\" rel=\"nofollow noreferrer\">locks</a> in <a href=\"https://tip.golang.org/src/math/rand/rand.go?#L327\" rel=\"nofollow noreferrer\">rand.Intn</a>. <a href=\"https://play.golang.org/p/y02T_v68FZh\" rel=\"nofollow noreferrer\">play.golang.org/p/y02T_v68FZh</a>"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576923492, "post_id": 59434683, "comment_id": 105055357, "body": "@mh-cbon you are right, I missed that part in question."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1576926253, "last_edit_date": 1576926253, "creation_date": 1576917017, "answer_id": 59434683, "question_id": 59434585, "link": "https://stackoverflow.com/questions/59434585/how-to-efficiently-replace-words-in-a-string-with-a-random-replacement-words/59434683#59434683", "title": "How to efficiently replace words in a string with a random replacement words?", "body": "<p>Standard package <code>regexp</code> has a <code>*Regexp.ReplaceAllStringFunc</code> is just for this:</p>\n\n<p>From doc:</p>\n\n<blockquote>\n  <p>ReplaceAllStringFunc returns a copy of src in which all matches of the Regexp have been replaced by the return value of function repl applied to the matched substring. The replacement returned by repl is substituted directly, without using Expand. </p>\n</blockquote>\n\n<p>To replace it without repetitive replacement, you can use <code>rand.Shuffle</code> to shuffle <code>replacement</code> and then use content of it one by one.</p>\n\n<p>For example:</p>\n\n<pre><code>rand.Shuffle(len(rep), reflect.Swapper(rep))\nvar err error\nres := pattern.ReplaceAllStringFunc(s, func(x string) string {\n    if len(rep) == 0 {\n        err = errors.New(\"Not enough replacements for string.\")\n        return \"&lt;not enough replacement&gt;\"\n    }\n    s, rep = rep[0], rep[1:]\n    return s\n})\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/_FuFqT5rHJc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_FuFqT5rHJc</a></p>\n"}], "owner": {"reputation": 13, "user_id": 12574670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c51440a78ec2900424fcff0008f1924a?s=128&d=identicon&r=PG&f=1", "display_name": "diaser", "link": "https://stackoverflow.com/users/12574670/diaser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 0, "closed_date": 1576926383, "accepted_answer_id": 59434683, "answer_count": 1, "score": 1, "last_activity_date": 1576926253, "creation_date": 1576915950, "question_id": 59434585, "link": "https://stackoverflow.com/questions/59434585/how-to-efficiently-replace-words-in-a-string-with-a-random-replacement-words", "closed_reason": "Duplicate", "title": "How to efficiently replace words in a string with a random replacement words?", "body": "<p>I need to create function that replaces placeholders for words in a string with predefined unique replacements. Newly generated string should not contain repetitive replacement words and they should be picked randomly. Assume that replacement array contains enough words.\nExample: </p>\n\n<pre><code>replacement := []string{\"Cat\", \"Dog\"}\ns := \"{replacement} text {replacement}\"\nresult := \"Cat text Dog\"\n</code></pre>\n\n<p>I was thinking about doing something like this:</p>\n\n<ol>\n<li>While words contain replacement placeholders pick a random unique replacement word and replace it with a picked word.</li>\n<li>Continue the above until all replacements placeholders are replaced with a replacement.</li>\n</ol>\n"}, {"tags": ["go", "websocket", "gorilla"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user12574700"}, "edited": false, "score": 0, "creation_date": 1576924457, "post_id": 59434800, "comment_id": 105055517, "body": "thankyou for <code>websocket.BinaryMessage</code> constant; last question; i fail to save a valid file from <code>message</code>; the exact code are still same in question"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1576945060, "post_id": 59434800, "comment_id": 105059692, "body": "@DEFFPALKON  Did you fix the problem with the bufio.Writer as described in this answer?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user12574700"}, "edited": false, "score": 0, "creation_date": 1576964327, "post_id": 59434800, "comment_id": 105063701, "body": "i use the second code; and now i transfer json; not bin anymore @cerise-limon"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1576964519, "last_edit_date": 1576964519, "creation_date": 1576918221, "answer_id": 59434800, "question_id": 59434554, "link": "https://stackoverflow.com/questions/59434554/gorilla-websocket-send-and-read-bytes-data/59434800#59434800", "title": "gorilla/websocket send and read bytes data", "body": "<p>The bufio.Writer must be flushed to write any buffered data to the underlying writer (the bytes.Buffer in this case). If the bufio.Writer is not flushed, then some of the image data may be lost and the image will appear to be corrupted.</p>\n\n<p>See the <a href=\"https://godoc.org/bufio#Writer\" rel=\"nofollow noreferrer\">bufio.Writer documentation</a> for more information on flushing the writer.</p>\n\n<p>Here's the fix:</p>\n\n<pre><code>var b bytes.Buffer\nempty := bufio.NewWriter(&amp;b)\npng.Encode(empty, img)\nempty.Flush()    // &lt;-- add this call\n</code></pre>\n\n<p>Because there's no need to buffer data when writing to a byte.Buffer, the code can be improved by eliminating the bufio.Writer:</p>\n\n<pre><code>var b bytes.Buffer\npng.Encode(&amp;b, img)\n</code></pre>\n\n<p>Use <a href=\"https://godoc.org/github.com/gorilla/websocket#BinaryMessage\" rel=\"nofollow noreferrer\">websocket.BinaryMessage</a> to send binary messages. See the <a href=\"https://godoc.org/github.com/gorilla/websocket#hdr-Data_Messages\" rel=\"nofollow noreferrer\">Data Message</a> section of the documentation for more information on message types.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user12574700"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 592, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1576964519, "creation_date": 1576915537, "question_id": 59434554, "link": "https://stackoverflow.com/questions/59434554/gorilla-websocket-send-and-read-bytes-data", "title": "gorilla/websocket send and read bytes data", "body": "<p>i'm trying to send bytes of image data via gorilla/websocket, my current code is : </p>\n\n<pre><code>var b bytes.Buffer\nempty := bufio.NewWriter(&amp;b)\npng.Encode(empty, img)\n\nerr = c.WriteMessage(websocket.TextMessage, b.Bytes())\n</code></pre>\n\n<p>my code for receiving message : </p>\n\n<pre><code>_, message, err := c.ReadMessage()\nif err != nil {\n    log.Println(\"read:\", err)\n    return\n}\n// log.Printf(\"recv: %s\", message)\nioutil.WriteFile(\"./nani.png\", []byte(message), 0644)\n</code></pre>\n\n<p>then the saved file are corrupted, how do i write/read message as binary/bytes</p>\n"}, {"tags": ["go", "sms", "aws-sdk", "go-gin"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1576921295, "post_id": 59434387, "comment_id": 105054989, "body": "<a href=\"https://en.m.wikipedia.org/wiki/Time-based_One-time_Password_algorithm\" rel=\"nofollow noreferrer\">en.m.wikipedia.org/wiki/Time-based_One-time_Password_algorit&zwnj;&#8203;hm</a>"}], "answers": [{"comments": [{"owner": {"reputation": 353, "user_id": 10641015, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rb6K-6eC5TI/AAAAAAAAAAI/AAAAAAAAAGw/E-daD0VOiz0/photo.jpg?sz=128", "display_name": "jadejoe", "link": "https://stackoverflow.com/users/10641015/jadejoe"}, "edited": false, "score": 0, "creation_date": 1576998397, "post_id": 59435106, "comment_id": 105067929, "body": "thanks, the comment I was going to store the information in MySQL Do you know how to generate the auth code ?? I&#39;d like you to let me know if there is something that is helpful"}, {"owner": {"reputation": 184, "user_id": 5539494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/de5558aed62a14232df48682aff5f875?s=128&d=identicon&r=PG&f=1", "display_name": "ks2bmallik", "link": "https://stackoverflow.com/users/5539494/ks2bmallik"}, "reply_to_user": {"reputation": 353, "user_id": 10641015, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rb6K-6eC5TI/AAAAAAAAAAI/AAAAAAAAAGw/E-daD0VOiz0/photo.jpg?sz=128", "display_name": "jadejoe", "link": "https://stackoverflow.com/users/10641015/jadejoe"}, "edited": false, "score": 0, "creation_date": 1577012972, "post_id": 59435106, "comment_id": 105070332, "body": "I guess MySQL can also serve fine. For the token generation, I guess you can just use the <code>crypto</code> package to generate random numbers securely. See <a href=\"https://play.golang.org/p/BWQIEf0Pptj\" rel=\"nofollow noreferrer\">play.golang.org/p/BWQIEf0Pptj</a>"}, {"owner": {"reputation": 184, "user_id": 5539494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/de5558aed62a14232df48682aff5f875?s=128&d=identicon&r=PG&f=1", "display_name": "ks2bmallik", "link": "https://stackoverflow.com/users/5539494/ks2bmallik"}, "reply_to_user": {"reputation": 353, "user_id": 10641015, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rb6K-6eC5TI/AAAAAAAAAAI/AAAAAAAAAGw/E-daD0VOiz0/photo.jpg?sz=128", "display_name": "jadejoe", "link": "https://stackoverflow.com/users/10641015/jadejoe"}, "edited": false, "score": 0, "creation_date": 1577013245, "post_id": 59435106, "comment_id": 105070398, "body": "You can use padding to fill the remaining digits if the length is less than six. I would suggest don&#39;t use constant padding, rather use the same function to generate digits with <code>upper</code> as 10."}, {"owner": {"reputation": 353, "user_id": 10641015, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rb6K-6eC5TI/AAAAAAAAAAI/AAAAAAAAAGw/E-daD0VOiz0/photo.jpg?sz=128", "display_name": "jadejoe", "link": "https://stackoverflow.com/users/10641015/jadejoe"}, "edited": false, "score": 0, "creation_date": 1577055659, "post_id": 59435106, "comment_id": 105079933, "body": "Do I need such a table to create a function like otp? Including information such as code access token expire"}, {"owner": {"reputation": 184, "user_id": 5539494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/de5558aed62a14232df48682aff5f875?s=128&d=identicon&r=PG&f=1", "display_name": "ks2bmallik", "link": "https://stackoverflow.com/users/5539494/ks2bmallik"}, "reply_to_user": {"reputation": 353, "user_id": 10641015, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rb6K-6eC5TI/AAAAAAAAAAI/AAAAAAAAAGw/E-daD0VOiz0/photo.jpg?sz=128", "display_name": "jadejoe", "link": "https://stackoverflow.com/users/10641015/jadejoe"}, "edited": false, "score": 0, "creation_date": 1577188489, "post_id": 59435106, "comment_id": 105116076, "body": "It depends on your use-case. You can easily use an in-memory map to store the data and avoid using any external storage (like tables or so). It will help to achieve lower latency but can result in scalability and performance issues, as you have to use a concurrent hashmap (or similar data structure). Also, garbage collection will be more frequent.  In your case, I will suggest to keep it simple, and go with a tabular approach (SQL based) and use indexes for faster scans. I think it should work just fine."}], "tags": [], "owner": {"reputation": 184, "user_id": 5539494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/de5558aed62a14232df48682aff5f875?s=128&d=identicon&r=PG&f=1", "display_name": "ks2bmallik", "link": "https://stackoverflow.com/users/5539494/ks2bmallik"}, "is_accepted": false, "score": 2, "last_activity_date": 1576921269, "creation_date": 1576921269, "answer_id": 59435106, "question_id": 59434387, "link": "https://stackoverflow.com/questions/59434387/authentication-code-with-expiration-date-code/59435106#59435106", "title": "Authentication code with expiration date code", "body": "<p>Are you using any key-value store in your current architecture? If so, then you can use that to maintain the TTL for the generated auth code. </p>\n\n<p>eg. In Redis, you can directly set the TTL for the keys. In other stores, where TTL is not supported inherently, you can just store the Unix timestamp of time till which the token is valid.</p>\n"}], "owner": {"reputation": 353, "user_id": 10641015, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rb6K-6eC5TI/AAAAAAAAAAI/AAAAAAAAAGw/E-daD0VOiz0/photo.jpg?sz=128", "display_name": "jadejoe", "link": "https://stackoverflow.com/users/10641015/jadejoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1597436176, "creation_date": 1576913951, "last_edit_date": 1597436176, "question_id": 59434387, "link": "https://stackoverflow.com/questions/59434387/authentication-code-with-expiration-date-code", "title": "Authentication code with expiration date code", "body": "<p>I have made go gin project</p>\n<p>Using a technique such as twilio to send a 6-digit expiration date verification code to the user using the SMS sending function of aws sns.</p>\n<p>When I try to implement a user-created function with a phone number and a six-digit authentication code, I don't come up with a good idea to implement a function that gives an expiration date to the authentication code.</p>\n<p>Anyone have a good idea Do you know such a library?</p>\n<p>Here is my source code I have created the logic up to creating a 6-digit authentication number</p>\n<pre><code>func GenerateAuthCode(max int) string {\n    var table = [...]byte{'1', '2', '3', '4', '5', '6', '7', '8', '9', '0'}\n    b := make([]byte, max)\n    n, err := io.ReadAtLeast(rand.Reader, b, max)\n    if n != max {\n        return err.Error()\n    }\n    for i := 0; i &lt; len(b); i++ {\n        b[i] = table[int(b[i])%len(table)]\n    }\n    return string(b)\n}\n</code></pre>\n<p>I want to generate in this logic</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 131, "user_id": 9353289, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-7zRvzDBVsKY/AAAAAAAAAAI/AAAAAAAALJU/mLo07MckG9M/photo.jpg?sz=128", "display_name": "Sufiyan Parkar", "link": "https://stackoverflow.com/users/9353289/sufiyan-parkar"}, "is_accepted": false, "score": -4, "last_activity_date": 1576911509, "creation_date": 1576911509, "answer_id": 59434160, "question_id": 59434011, "link": "https://stackoverflow.com/questions/59434011/if-check-for-struct-type-golang/59434160#59434160", "title": "if check for struct type golang", "body": "<p>Golang doesn't support the comparison of objects using the <code>=</code> operator. Use <code>reflect.DeepEqual</code> instead.</p>\n\n<pre><code>if !reflect.DeepEqaul(d[0], card{\"Spades\", \"A\"}) { \n    #Your logic\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1576912201, "last_edit_date": 1576912201, "creation_date": 1576911884, "answer_id": 59434197, "question_id": 59434011, "link": "https://stackoverflow.com/questions/59434011/if-check-for-struct-type-golang/59434197#59434197", "title": "if check for struct type golang", "body": "<p>The <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">section of the specification on composite literals</a> says:</p>\n\n<blockquote>\n  <p>A parsing ambiguity arises when a composite literal using the TypeName form of the LiteralType appears as an operand between the keyword and the opening brace of the block of an \"if\", \"for\", or \"switch\" statement, and the composite literal is not enclosed in parentheses, square brackets, or curly braces. In this rare case, the opening brace of the literal is erroneously parsed as the one introducing the block of statements. To resolve the ambiguity, the composite literal must appear within parentheses.</p>\n</blockquote>\n\n<p>Add parentheses to resolve the ambiguity:</p>\n\n<pre><code>if d[0] != (card{\"Spades\", \"A\"}) { \n    fmt.Println(\"hello\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/7H02gB4MznK\" rel=\"nofollow noreferrer\">Run in the playground</a>.</p>\n"}], "owner": {"reputation": 63, "user_id": 12137011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d269717815ec9a667569028c45c9844?s=128&d=identicon&r=PG&f=1", "display_name": "Amigo", "link": "https://stackoverflow.com/users/12137011/amigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 59434197, "answer_count": 2, "score": -1, "last_activity_date": 1576912201, "creation_date": 1576910054, "question_id": 59434011, "link": "https://stackoverflow.com/questions/59434011/if-check-for-struct-type-golang", "title": "if check for struct type golang", "body": "<p>How can I use a temporary struct type for if statements in Golang?</p>\n\n<pre><code>struct card {\n    suit string\n    rank string\n}\nd := newDeck() //basically a list of cards\n\nc := card{\"Spades\", \"A\"}\n\nif d[0] != c { //works\n\n}\n\nif d[0] != card{\"Spades\", \"A\"} { //doesn't work\n}\n</code></pre>\n\n<p>Is it always necessary to declare variables to compare struct types, or is there a way to make it shorter like the last line of the code?</p>\n"}, {"tags": ["go", "graphql", "dgraph"], "answers": [{"tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": false, "score": 3, "last_activity_date": 1576905176, "creation_date": 1576905176, "answer_id": 59433656, "question_id": 59432610, "link": "https://stackoverflow.com/questions/59432610/how-do-you-convert-specific-array-values-in-a-json-response-to-be-just-the-first/59433656#59433656", "title": "How do you convert specific array values in a JSON response to be just the first value in the array?", "body": "<p>You can do this with a custom Unmarshal as described here:</p>\n\n<p><a href=\"http://choly.ca/post/go-json-marshalling/\" rel=\"nofollow noreferrer\">http://choly.ca/post/go-json-marshalling/</a></p>\n\n<p>You use an alias by embedding the original <code>User</code> in an anonymous type that has a slice of <code>Settings</code> inside it that you Umarshal into like so:</p>\n\n<pre><code>func (u *User) UnmarshalJSON(data []byte) error {\n    type Alias User\n    aux := &amp;struct {\n        Settings []*Settings `json:\"settings\"`\n        *Alias\n    }{\n        Alias: (*Alias)(u),\n    }\n    if err := json.Unmarshal(data, &amp;aux); err != nil {\n        return err\n    }\n    u.Settings = aux.Settings[0]\n    return nil\n}\n</code></pre>\n\n<p>A full working example is here (you need the same trick for the <code>AccountSettings</code>):</p>\n\n<p><a href=\"https://play.golang.org/p/FQWakX8B7OF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/FQWakX8B7OF</a></p>\n"}], "owner": {"reputation": 3009, "user_id": 4975090, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/95acff6227d6efe0c2f5fcb265ed9639?s=128&d=identicon&r=PG&f=1", "display_name": "sdfsdf", "link": "https://stackoverflow.com/users/4975090/sdfsdf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576906498, "creation_date": 1576887678, "last_edit_date": 1576906498, "question_id": 59432610, "link": "https://stackoverflow.com/questions/59432610/how-do-you-convert-specific-array-values-in-a-json-response-to-be-just-the-first", "title": "How do you convert specific array values in a JSON response to be just the first value in the array?", "body": "<p>(Note, Dgraph isn't required for this problem; it's just the tool I am using where I am encountering the problem)</p>\n\n<p>Let's say you have some structs</p>\n\n<pre><code>type AccountSettings struct {\n    Uid      string `json:\"uid\"`\n    DType    string `json:\"dgraph.type\"`\n    Name     string `json:\"name\"`\n    Username string `json:\"username\"`\n}\n\ntype Settings struct {\n    Uid     string          `json:\"uid\"`\n    DType   string          `json:\"dgraph.type\"`\n    Account AccountSettings `json:\"account\"`\n}\n\ntype Tag struct {\n    Uid   string `json:\"uid\"`\n    DType string `json:\"dgraph.type\"`\n    Label Label  `json:\"label\"`\n}\n\ntype User struct {\n    Uid      string   `json:\"uid\"`\n    DType    string   `json:\"dgraph.type\"`\n    Settings Settings `json:\"settings\"`\n    Tags     []Tag    `json:\"tags\"`\n}\n</code></pre>\n\n<p>and you create a user and add it to your Dgraph database</p>\n\n<pre><code>user = User{\n    DType: \"User\",\n    Settings: Settings{\n        DType: \"Settings\",\n        Account: SettingsAccount{\n            DType: \"SettingsAccount\",\n            Name: \"Billy Bob\"\n            Username: \"billyboy123\"\n        },\n        Tags: []Tag{{\n            DType: \"Tag\",\n            Label: \"admin\"\n        }, {\n            DType: \"Tag\",\n            Label: \"user\"\n        }}\n    },\n}\n</code></pre>\n\n<p>And then you query your Dgraph database like (assuming you have the uid of the user node)</p>\n\n<pre><code>{\n  user(func: uid(\"0x1234\")) {\n    uid\n    settings {\n      account {\n        name\n        username\n      }\n    }\n    tags {\n      label\n    }\n  }\n}\n</code></pre>\n\n<p>the response will come back as</p>\n\n<pre><code>{\n  \"data\": {\n    \"user\": [\n      {\n        \"uid\": \"0x1234\"\n        \"settings\": [\n          {\n            \"account\": [\n              {\n                \"name\": \"Billy Bob\",\n                \"username\": \"billyboy123\"\n              }\n            ]\n          }\n        ]\n        \"tags\": [\n          {\n            label: \"admin\"\n          },\n          {\n            label: \"user\"\n          },\n        ]\n      }\n    ]\n  }\n}\n</code></pre>\n\n<p>So the problem is that the JSON response of Dgraph will return fields of struct types as arrays (presumably because there could potentially be multiple nodes pointing to a single other node), but since it's an array, you can't immediately marshal it with the <code>User</code> struct (because <code>User.Settings</code> is of type <code>Settings</code>, not <code>[]Settings</code>).</p>\n\n<p>What would you do in order to marshal the Dgraph JSON response with the <code>User</code> struct (or any other kind of struct)?</p>\n\n<p>It's important to note that the <code>settings</code> array in the JSON response should just be the first element in that array, but the <code>tags</code> array should still remain an array because that's what's specified in the <code>User</code> struct.</p>\n"}, {"tags": ["go", "deadlock", "goroutine"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1576888532, "post_id": 59432608, "comment_id": 105051072, "body": "I think that the core problem is that no one is closing the channel, so your range loop is stuck after consuming all the data from the channel."}], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 2, "last_activity_date": 1577187805, "last_edit_date": 1577187805, "creation_date": 1576889146, "answer_id": 59432718, "question_id": 59432608, "link": "https://stackoverflow.com/questions/59432608/a-case-of-all-goroutines-are-asleep-deadlock-i-cant-figure-out-why/59432718#59432718", "title": "A case of `all goroutines are asleep - deadlock!` I can&#39;t figure out why", "body": "<p>In your complete example on the Go Playground, you:</p>\n\n<ul>\n<li><p>Create a channel (line 39, <code>results := make(chan langs)</code>) and a wait-group (line 40, <code>var wait sync.WaitGroup</code>).  So far so good.</p></li>\n<li><p>Loop: in the loop, sometimes spin off a task:</p>\n\n<pre><code>            if ...various conditions... {\n                wait.Add(1)\n                go parseTerm(results, &amp;wait, text)\n            }\n</code></pre></li>\n<li><p>In the loop, sometimes do a non-blocking read from the channel (as shown in your question).  No problem here either.  But...</p></li>\n<li><p>At the end of the loop, use:</p>\n\n<pre><code>for res := range results {\n    ...\n}\n</code></pre>\n\n<p><em>without</em> ever calling <code>close(results)</code> in exactly one place, after all writers finish.  This loop uses a <em>blocking</em> read from the channel.  As long as some writer goroutine is still running, the blocking read can block without having the whole system stop, but when the last writer finishes writing and exits, there are no remaining writer goroutines.  Any <em>other</em> remaining goroutines might rescue you, but there are none.</p></li>\n</ul>\n\n<p>Since you use the <code>var wait</code> correctly (adding 1 in the right place, and calling <code>Done()</code> in the right place in the writer), the solution is to add one more goroutine, which will be the one to rescue you:</p>\n\n<pre><code>go func() {\n    wait.Wait()\n    close(results)\n}()\n</code></pre>\n\n<p>You should spin off this rescuer goroutine just before entering the <code>for res := range results</code> loop.  (If you spin it off any earlier, it might see the <code>wait</code> variable count down to zero too soon, just before it gets counted up again by spinning off another <code>parseTerm</code>.)</p>\n\n<p>This anonymous function will block in the <code>wait</code> variable's <code>Wait()</code> function until the last writer goroutine has called the final <code>wait.Done()</code>, which will unblock <em>this</em> goroutine.  Then this goroutine will call <code>close(results)</code>, which will arrange for the <code>for</code> loop in your <code>main</code> goroutine to finish, unblocking that goroutine.  When this goroutine (the rescuer) returns and thus terminates, there are no more rescuers, but we no longer need any.</p>\n\n<p>(This main code then calls <code>wait.Wait()</code> unnecessarily:  Since the <code>for</code> didn't terminate until the <code>wait.Wait()</code> in the <em>new</em> goroutine already unblocked, we know that this next <code>wait.Wait()</code> will return immediately.  So we can drop this second call, although leaving it in is harmless.)</p>\n"}, {"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": false, "score": 1, "last_activity_date": 1576889366, "creation_date": 1576889366, "answer_id": 59432730, "question_id": 59432608, "link": "https://stackoverflow.com/questions/59432608/a-case-of-all-goroutines-are-asleep-deadlock-i-cant-figure-out-why/59432730#59432730", "title": "A case of `all goroutines are asleep - deadlock!` I can&#39;t figure out why", "body": "<p>The problem is that nothing is closing the results channel, yet the range loop only exits when it closes. I've simplified your code to illustrate this and propsed a solution - basically consume the data in a goroutine:</p>\n\n<pre><code>// This is our producer\nfunc foo(i int, ch chan int, wg *sync.WaitGroup) {\n    defer wg.Done()\n    ch &lt;- i\n    fmt.Println(i, \"done\")\n}\n// This is our consumer - it uses a different WG to signal it's done\nfunc consumeData(ch chan int, wg *sync.WaitGroup) {\n    defer wg.Done()\n    for x := range ch {\n        fmt.Println(x)\n    }\n    fmt.Println(\"ALL DONE\")\n}\n\nfunc main() {\n    ch := make(chan int)\n    wg := sync.WaitGroup{}\n    // create the producers\n    for i := 0; i &lt; 10; i++ {\n        wg.Add(1)\n        go foo(i, ch, &amp;wg)\n    }\n    // create the consumer on a different goroutine, and sync using another WG\n    consumeWg := sync.WaitGroup{}\n    consumeWg.Add(1)\n    go consumeData(ch,&amp;consumeWg)\n\n    wg.Wait()  // &lt;&lt;&lt;&lt; means that the producers are done\n    close(ch) // &lt;&lt; Signal the consumer to exit\n    consumeWg.Wait() // &lt;&lt; Wait for the consumer to exit\n}\n</code></pre>\n"}], "owner": {"reputation": 10223, "user_id": 221650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/68a2471aa6fae5bfec71d8d09afbb2f1?s=128&d=identicon&r=PG&f=1", "display_name": "Petruza", "link": "https://stackoverflow.com/users/221650/petruza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 1, "accepted_answer_id": 59432718, "answer_count": 2, "score": 0, "last_activity_date": 1577187805, "creation_date": 1576887657, "last_edit_date": 1576888003, "question_id": 59432608, "link": "https://stackoverflow.com/questions/59432608/a-case-of-all-goroutines-are-asleep-deadlock-i-cant-figure-out-why", "title": "A case of `all goroutines are asleep - deadlock!` I can&#39;t figure out why", "body": "<p><strong><em>TL;DR:</em> A typical case of <code>all goroutines are asleep, deadlock!</code> but can't figure it out</strong></p>\n\n<p>I'm parsing the Wiktionary XML dump to build a DB of words. I defer the parsing of each article's text to a goroutine hoping that it will speed up the process.<br>\nIt's 7GB and is processed in under 2 minutes in my machine when doing it serially, but if I can take advantage of all cores, why not.  </p>\n\n<p>I'm new to threading in general, I'm getting a <code>all goroutines are asleep, deadlock!</code> error.<br>\nWhat's wrong here?  </p>\n\n<p>This may not be performant at all, as it uses an unbuffered channel, so all goroutines effectively end up executing serially, but my idea is to learn and understand threading and to benchmark how long it takes with different alternatives:  </p>\n\n<ul>\n<li>unbuffered channel</li>\n<li>different sized buffered channel</li>\n<li>only calling as many goroutines at a time as there are <code>runtime.NumCPU()</code></li>\n</ul>\n\n<p>The summary of my code in pseudocode:  </p>\n\n<pre><code>while tag := xml.getNextTag() {\n    wg.Add(1)\n    go parseTagText(chan, wg, tag.text)\n\n    // consume a channel message if available\n    select {\n    case msg := &lt;-chan:\n        // do something with msg            \n    default:\n    }\n}\n// reading tags finished, wait for running goroutines, consume what's left on the channel\nfor msg := range chan {\n    // do something with msg\n}\n// Sometimes this point is never reached, I get a deadlock\nwg.Wait()\n\n----\n\nfunc parseTagText(chan, wg, tag.text) {\n    defer wg.Done()\n    // parse tag.text\n    chan &lt;- whatever // just inform that the text has been parsed\n}\n</code></pre>\n\n<p>Complete code:<br>\n<a href=\"https://play.golang.org/p/0t2EqptJBXE\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0t2EqptJBXE</a></p>\n"}, {"tags": ["go", "google-cloud-functions", "serverless-framework", "google-cloud-run"], "comments": [{"owner": {"reputation": 233128, "user_id": 807126, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpNqK.jpg?s=128&g=1", "display_name": "Doug Stevenson", "link": "https://stackoverflow.com/users/807126/doug-stevenson"}, "edited": false, "score": 2, "creation_date": 1576886358, "post_id": 59432459, "comment_id": 105050759, "body": "I&#39;ve never seen that message before, but Cloud Functions is definitely not intended to be used for computationally demanding operations.  Neither is Cloud Run for that matter.  I&#39;d look into Compute Engine for that."}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "reply_to_user": {"reputation": 233128, "user_id": 807126, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpNqK.jpg?s=128&g=1", "display_name": "Doug Stevenson", "link": "https://stackoverflow.com/users/807126/doug-stevenson"}, "edited": false, "score": 1, "creation_date": 1576889625, "post_id": 59432459, "comment_id": 105051243, "body": "The same here, Iespecially that CF is only given one virtual cpu"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1576948395, "post_id": 59432459, "comment_id": 105060450, "body": "What&#39;s the workload? What are you doing in that GCF?"}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "edited": false, "score": 0, "creation_date": 1576949324, "post_id": 59432459, "comment_id": 105060690, "body": "Simple data transformation and compression"}], "answers": [{"tags": [], "owner": {"reputation": 1514, "user_id": 12415339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e85de3f73b6e84dc630e925520171d19?s=128&d=identicon&r=PG&f=1", "display_name": "Happy-Monad", "link": "https://stackoverflow.com/users/12415339/happy-monad"}, "is_accepted": false, "score": 3, "last_activity_date": 1577177622, "creation_date": 1577177622, "answer_id": 59466215, "question_id": 59432459, "link": "https://stackoverflow.com/questions/59432459/cloud-function-cpumilliseconds-quota-exceeded/59466215#59466215", "title": "Cloud Function CPUMilliSeconds quota exceeded", "body": "<p>One of the quota limits of Google Cloud Functions is <a href=\"https://cloud.google.com/functions/quotas#rate_limits\" rel=\"nofollow noreferrer\">GHz-seconds</a> which means the total amount of CPU seconds consumed by all running functions, the error you see is raised when you're reach that quota during a 100s time frame. Since your function is carrying a computationally intensive workload it's easier to reach the limit.</p>\n\n<p>As for how to control CPU usage the only way would be to delay your requests to keep your usage below these limits. The alternative would be giving less <a href=\"https://cloud.google.com/functions/pricing#compute_time\" rel=\"nofollow noreferrer\">memory</a> to the function which in turn will be counterproductive because your functions will span longer time and you might run in the same trouble anyway.</p>\n\n<p>As Doug pointed out Cloud Functions are not intended for your use case and neither Cloud Run. GCE instances are better for computationally intensive operations as there are no memory limitations but the amount you have provided, they also allow to run containerized code in an Container Optimized OS.</p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 602, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577177622, "creation_date": 1576885671, "last_edit_date": 1576948198, "question_id": 59432459, "link": "https://stackoverflow.com/questions/59432459/cloud-function-cpumilliseconds-quota-exceeded", "title": "Cloud Function CPUMilliSeconds quota exceeded", "body": "<p>I've noticed a substantial number in my golang Cloud Function errors:</p>\n\n<pre><code>Error: quota exceeded (Quota exceeded for quota group 'CPUMilliSeconds' and limit 'CPU allocation in function invocations for us-central1 per 100 seconds' of service\n</code></pre>\n\n<p>What strange, is that  I have no more than 60 invocations per second with 30 active instances cloud function running at the peak.</p>\n\n<p>I understand that is that you can have a max of 1,000 concurrent instances, which in my case 30 is far cry to hit CPU limit.</p>\n\n<p><a href=\"https://cloud.google.com/functions/quotas\" rel=\"nofollow noreferrer\">Cloud function quota here</a></p>\n\n<p>What is the best way to control Cloud Function CPU execution ?</p>\n\n<p>Would you recommend using CloudRun instead of Cloud Functions for some more CPU \"demanding task\"?</p>\n"}, {"tags": ["docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 2, "creation_date": 1576875579, "post_id": 59431256, "comment_id": 105048469, "body": "Your volume declaration mounts ./myapp to /app. Whatever you had in /app directory is hidden under this mount. Is there a reason why you&#39;re mounting that directory?"}, {"owner": {"reputation": 189, "user_id": 1940417, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c6f81055ad1d6f8d327c2db0b9c0a0c7?s=128&d=identicon&r=PG", "display_name": "Duoduo", "link": "https://stackoverflow.com/users/1940417/duoduo"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1576875977, "post_id": 59431256, "comment_id": 105048584, "body": "I want using docker to building go program, and modify source easily."}, {"owner": {"reputation": 183, "user_id": 5171751, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9bTLX773Hxo/AAAAAAAAAAI/AAAAAAAAGfQ/MXAVX_WDkUA/photo.jpg?sz=128", "display_name": "Joel Magnuson", "link": "https://stackoverflow.com/users/5171751/joel-magnuson"}, "edited": false, "score": 0, "creation_date": 1576877455, "post_id": 59431256, "comment_id": 105048920, "body": "@Duoduo The <code>build:</code> line in the yml only gives <code>docker-compose build</code> its context for running <code>docker build .</code> (this builds your docker <i>image</i>, not your code). If you want to build your code in a container I would suggest using a watcher. You don&#39;t even need a Dockerfile or <code>build:</code> context, just mount in your source code from <code>.&#47;myapp</code>. See <a href=\"https://github.com/canthefason/go-watcher\" rel=\"nofollow noreferrer\">github.com/canthefason/go-watcher</a>."}], "answers": [{"tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": false, "score": 0, "last_activity_date": 1576879251, "creation_date": 1576879251, "answer_id": 59431794, "question_id": 59431256, "link": "https://stackoverflow.com/questions/59431256/why-the-file-created-in-dockerfile-run-not-on-host-i-already-mount-host-dir-for/59431794#59431794", "title": "Why the file created in dockerfile RUN not on host, I already mount host dir for service", "body": "<p>A <code>docker-compose build</code> step runs to completion, ignoring everything else in your <code>docker-compose.yml</code> file.  The resulting image is then executed taking these options into account.  So the sequence you show does two things:</p>\n\n<ol>\n<li>Build the image, <code>COPY</code>ing its source code in, and producing a <code>/app/main</code> binary inside the image; nothing on the host system is affected.</li>\n<li>Run a container based on that image, but mounting the current <code>./myapp</code> directory and its contents over <code>/app</code> in the container, hiding anything there.</li>\n</ol>\n\n<p>In this sequence of steps nothing ever gets copied out of the container, you are only ever pushing things into Docker space.  If you'd like to run the binary you built, delete the <code>volumes:</code> mount to let the image in the binary run.</p>\n\n<p>In comments you suggest your goal is to just build the Go program and get a binary out.  You don't want Docker for that; the Go <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">Getting Started</a> page has instructions for how to install a Go toolchain, and you can just <code>go install</code> your program.</p>\n"}], "owner": {"reputation": 189, "user_id": 1940417, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c6f81055ad1d6f8d327c2db0b9c0a0c7?s=128&d=identicon&r=PG", "display_name": "Duoduo", "link": "https://stackoverflow.com/users/1940417/duoduo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576879251, "creation_date": 1576875348, "question_id": 59431256, "link": "https://stackoverflow.com/questions/59431256/why-the-file-created-in-dockerfile-run-not-on-host-i-already-mount-host-dir-for", "title": "Why the file created in dockerfile RUN not on host, I already mount host dir for service", "body": "<p>I am using docker-compose to run my golang app.</p>\n\n<p>Here is my Dockerfile</p>\n\n<pre><code>FROM golang:1.13\nWORKDIR /app\nCOPY go.mod ./\nRUN go mod download\nCOPY . .\nRUN go build -o main .\nCMD [\"/app/main\"]\n\n</code></pre>\n\n<p>and my docker-compose.yml</p>\n\n<pre><code>version: '3.7'\nservices:\n    app:\n        build: ./myapp\n        container_name: myapp\n        volumes:\n            - ./myapp:/app\n</code></pre>\n\n<p>When I run <code>docker-compose build</code> The <code>main</code> file not appear on <code>myapp</code> dir.</p>\n\n<p><code>docker-compose up myapp</code> not work, because <code>main</code> file not found.\nBut <code>docker run mypp</code> can work. How can i build main.go in dockerfile and stay the <code>main</code> in my host?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1576875523, "post_id": 59431234, "comment_id": 105048454, "body": "you should also note that your <code>for range</code> is probably incorrect, as you&#39;re skipping every other element passed through the channel"}, {"owner": {"reputation": 9276, "user_id": 2409793, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/QDLY9.png?s=128&g=1", "display_name": "pkaramol", "link": "https://stackoverflow.com/users/2409793/pkaramol"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1576876305, "post_id": 59431234, "comment_id": 105048660, "body": "thanks. any suggestions on how to fix this?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1576876429, "post_id": 59431234, "comment_id": 105048689, "body": "Don&#39;t receive a second time in the loop, use the range expression. See the <a href=\"https://tour.golang.org/concurrency/4\" rel=\"nofollow noreferrer\">Tour of Go</a>"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 5, "last_activity_date": 1576875393, "creation_date": 1576875393, "answer_id": 59431262, "question_id": 59431234, "link": "https://stackoverflow.com/questions/59431234/go-vet-complaining-about-loop-variable-being-captured-by-func-literal/59431262#59431262", "title": "go vet complaining about loop variable being captured by func literal", "body": "<p>This is the line:</p>\n\n<pre><code>fmt.Printf(\"employee %d received signal %d\\n\", i, rcv)\n</code></pre>\n\n<p>Here, use <code>emp</code> instead of <code>i</code>. You're passing in the loop variable as <code>emp</code> to the goroutine, but you seem to have forgotten to use it.</p>\n"}], "owner": {"reputation": 9276, "user_id": 2409793, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/QDLY9.png?s=128&g=1", "display_name": "pkaramol", "link": "https://stackoverflow.com/users/2409793/pkaramol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "closed_date": 1576887973, "answer_count": 1, "score": -3, "last_activity_date": 1603704986, "creation_date": 1576875201, "last_edit_date": 1603704986, "question_id": 59431234, "link": "https://stackoverflow.com/questions/59431234/go-vet-complaining-about-loop-variable-being-captured-by-func-literal", "closed_reason": "Not suitable for this site", "title": "go vet complaining about loop variable being captured by func literal", "body": "<p>One of the common newbies' mistakes documented in go github's <a href=\"https://github.com/golang/go/wiki/CommonMistakes#using-goroutines-on-loop-iterator-variables\" rel=\"nofollow noreferrer\">page</a>, is neglecting to pass a loop variable as a parameter to the goroutine (in which the program's output could show unexpected results:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>   for _, val := range values {\n      go func() {\n/* here is where go-vet complains loop variable v captured by func literal*/\n          fmt.Println(val) \n      }()\n   }\n\n</code></pre>\n<blockquote>\n<p>there is a very good chance that when you run this code you will see\nthe last element printed for every iteration instead of each value in\nsequence, because the goroutines will probably not begin executing\nuntil after the loop.</p>\n</blockquote>\n<p>So the proposed solution is (as said) to pass the actual loop var as goroutine parameter:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>for _, val := range values {\n    go func(val interface{}) {\n        fmt.Println(val)\n    }(val)\n}\n\n</code></pre>\n<p>So what does <code>go-vet</code> nag about in the below example?</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    ch := make(chan int)\n\n    for i := 0; i &lt; 2; i++ {\n        go func(emp int) {\n            for range ch {\n                rcv := &lt;-ch\n         /*  loop variable i captured by func literal */\n                fmt.Printf(&quot;employee %d received signal %d\\n&quot;, i, rcv)\n            }\n        }(i)\n    }\n\n}\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 63, "user_id": 1231789, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/6a63c09e02a1a6f6d97a9344cb9c739f?s=128&d=identicon&r=PG", "display_name": "prasad mandore", "link": "https://stackoverflow.com/users/1231789/prasad-mandore"}, "edited": false, "score": 0, "creation_date": 1583375972, "post_id": 59427868, "comment_id": 107097865, "body": "Did you figure this out?"}], "owner": {"reputation": 41, "user_id": 12571605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0d620a70ed2561217c4419fd37096a5?s=128&d=identicon&r=PG&f=1", "display_name": "hackertime2.0", "link": "https://stackoverflow.com/users/12571605/hackertime2-0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1576856443, "creation_date": 1576856443, "question_id": 59427868, "link": "https://stackoverflow.com/questions/59427868/join-table-with-non-primary-key-in-gorm", "title": "Join table with non-primary key in GORM", "body": "<p>I am trying to retrieve the information of an author based on a field in <code>BookData</code> that is not a primary key. Below you can see I have <code>AuthorId</code> in my <code>BookData</code> table and I am trying to get the author based on that <code>AuthorId</code> even though it is not the primary key. It seems GORM does not support this type of join, is there a way to do this?</p>\n\n<p>You can also see below that I am able to properly get the <code>PublisherProperty</code> information because it's foreign key is <code>BookData</code>'s primary key. I am just wondering how to do it if it not the primary key. Thanks in advance!</p>\n\n<pre><code>type BookData struct {\n    Id                string              `gorm:\"primary_key;column:book_id\"`\n    AuthorId          string              `gorm:\"column:author_id\"`\n    Author            AuthorData          `gorm:\"foreignkey:AuthorId\"`\n    PublisherProperty []PublisherProperty `gorm:\"foreignkey:Id\"`\n}\n\ntype AuthorData struct {\n    Id    string `gorm:\"primary_key;column:author_id\"`\n    Name  string `gorm:\"column:author_name\"`\n}\n\n\ntype PublisherProperty struct {\n    Id           string `gorm:\"primary_key;column:book_id\"`\n    PublisherId  string `gorm:\"primary_key;column:publisher_id\"`\n    PublisherTxt string `gorm:\"column:publisher_txt\"`\n}\n\n</code></pre>\n"}, {"tags": ["haskell", "go", "ffi"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1576854472, "post_id": 59427395, "comment_id": 105040842, "body": "<a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">golang.org/cmd/cgo</a>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 10, "creation_date": 1576861063, "post_id": 59427395, "comment_id": 105043646, "body": "You will have to go through C, their common denominator. There are tutorials for calling Haskell from C, and calling C from Go."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1576872067, "post_id": 59427395, "comment_id": 105047386, "body": "I know it isn&#39;t always an option, but if you can avoid sharing an address space and instead use IPC in some way then you&#39;ll save yourself some pain."}], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 4, "last_activity_date": 1576895657, "creation_date": 1576895657, "answer_id": 59433103, "question_id": 59427395, "link": "https://stackoverflow.com/questions/59427395/how-can-i-call-a-haskell-function-from-golang/59433103#59433103", "title": "How can I call a Haskell function from Golang?", "body": "<p>As already mentioned in the comments, you need to go through C.</p>\n\n<p>Good news: the python binding you have goes through C already. It means that haskell code exposes all the necessary API as C functions, you just need to find out how the API looks like and call it using <code>cgo</code>. You probably don't need to know anything about haskell.</p>\n\n<p>Assuming you have access to the source code, you should look for <code>*.c</code> and <code>*.h</code> files (often located in a <code>cbits</code> folder). If you don't know C, then ask your teammates to help.</p>\n\n<p>If you don't have access to the code, then you may try to guess the C API using the python binding. Though it'll be quite hard.</p>\n"}], "owner": {"reputation": 5488, "user_id": 3015734, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/31ccee0370328a7c894902c0a70373f7?s=128&d=identicon&r=PG", "display_name": "Tgsmith61591", "link": "https://stackoverflow.com/users/3015734/tgsmith61591"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 395, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1577155072, "creation_date": 1576854385, "last_edit_date": 1577155072, "question_id": 59427395, "link": "https://stackoverflow.com/questions/59427395/how-can-i-call-a-haskell-function-from-golang", "title": "How can I call a Haskell function from Golang?", "body": "<p>I am a python developer making the shift to Golang, so I'm sorry for the noob question. I am responsible for taking some Haskell code, for which we have python bindings, and making it callable from Go. I have a shared object file, <code>_foo.so</code>, that I want to somehow import into Go and call a la:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    f \"_foo.so\"\n)\n\nfunc DoBar() {\n    return f.Bar()\n}\n</code></pre>\n\n<p>Is this possible? I don't even have the first idea of where to begin, but I'm hoping that pseudo code gets the idea across.</p>\n"}, {"tags": ["go", "cookies", "webview"], "owner": {"reputation": 11, "user_id": 12570981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7d9497c78ea1a0e65322a97d2779dde?s=128&d=identicon&r=PG&f=1", "display_name": "codeman", "link": "https://stackoverflow.com/users/12570981/codeman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1578059499, "creation_date": 1576848167, "last_edit_date": 1578059499, "question_id": 59425959, "link": "https://stackoverflow.com/questions/59425959/how-do-i-retrieve-cookies-from-a-go-webview", "title": "How do I retrieve cookies from a Go webview?", "body": "<p>I'm writing a Go component, and I want to provide personal user login upon startup. This should ideally be done through a webview, which is pulled up when the program starts. This webview should connect to an identity server that is independent of my program. If a login is successful, a cookie containing access + refresh tokens are set in the response. At this point, I want the webview to close, and the tokens to be extracted from the cookies for use in the Go program.</p>\n\n<p>I have tried to achieve this with the webview library <a href=\"https://github.com/zserge/webview\" rel=\"nofollow noreferrer\">zserge/webview</a>. However, I have not found a way to extract cookies using this library. The builtin library <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">net/http</a> has functionality for retrieving cookies - however, the zserge/webview library does not seem to make use of the builtin net/http library.</p>\n"}, {"tags": ["go", "cgo", "gccgo"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1576913335, "last_edit_date": 1576913335, "creation_date": 1576843894, "answer_id": 59425068, "question_id": 59423016, "link": "https://stackoverflow.com/questions/59423016/string-to-char-array/59425068#59425068", "title": "string to char (*array)[]", "body": "<blockquote>\n  <p>string to char (*array)[]</p>\n\n<pre><code>cgo-gcc-prolog: error: array size is negative\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>Use a shim. For example,</p>\n\n<p><code>so.go</code>:</p>\n\n<pre><code>// string to char (*array)[]\n\npackage main\n\n/*\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\nvoid notify(char (*message)[]) {\n    printf(\"notify | argv: %1$p %1$s\\n\", *message);\n}\n\nvoid shimmy(char *message[]) {\n    printf(\"shimmy | argv: %1$p %1$s\\n\", *message);\n    notify((char (*)[])*message);\n}\n*/\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    message := \"My Message :)\"\n    cs := C.CString(message)\n    defer C.free(unsafe.Pointer(cs))\n    fmt.Printf(\"main   | argv: %p %s\\n\", cs, C.GoString(cs))\n    C.shimmy(&amp;cs)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run so.go\nmain   | argv: 0x19cb820 My Message :)\nshimmy | argv: 0x19cb820 My Message :)\nnotify | argv: 0x19cb820 My Message :)\n$ \n\n$ go version\ngo version devel +4d5bb9c609 Fri Dec 20 23:07:52 2019 +0000 linux/amd64\n$ go env CC\ngcc\n$ gcc --version\ngcc (Ubuntu 9.2.1-9ubuntu2) 9.2.1 20191008\n$ \n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 12569565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36f77af3a793598645991675f035e4ad?s=128&d=identicon&r=PG&f=1", "display_name": "0xdeadfeed", "link": "https://stackoverflow.com/users/12569565/0xdeadfeed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 1, "accepted_answer_id": 59425068, "answer_count": 1, "score": 3, "last_activity_date": 1576913335, "creation_date": 1576835033, "last_edit_date": 1576837522, "question_id": 59423016, "link": "https://stackoverflow.com/questions/59423016/string-to-char-array", "title": "string to char (*array)[]", "body": "<pre><code>//file.go\n\nfunc main() {\n\n  message := \"My Message :)\"\n  // I've tried this slice before.\n  // tmpslice := (*[1 &lt;&lt; 30]*C.char)(unsafe.Pointer(argv))[:length:length] \n  argv := make([]*C.char, len(message))\n  for i, s := range str {\n    cs := C.CString(string(s))\n    defer C.free(unsafe.Pointer(cs))\n    argv[i] = cs\n  }\n\n  C.notifyWebhook(&amp;argv)\n\n}\n</code></pre>\n\n<pre><code>  //file.c\n  void notiftWebhook(char (*message)[]) {\n  printf(\"notiftWebhook executed | argv: %s \\n\", *message);\n  char url[500];\n  char data[200];\n\n\n  int user_id = 0xdeadfeed;\n\n  snprintf(url,500,\"https://webhook.site/a6a8d1ae-6766-4d90-a4c8-87a9599bfbf0\",token);\n  snprintf(data,200,\"user_id=%d&amp;text=%s\",user_id,*message);\n  CURL *curl;\n  //CURLcode res;\n\n  //static const char *postthis = \"moo mooo moo moo\";\n\n  curl_global_init(CURL_GLOBAL_ALL);\n  curl = curl_easy_init();\n  if(curl) {\n    curl_easy_setopt(curl, CURLOPT_URL, url);\n    curl_easy_setopt(curl, CURLOPT_POSTFIELDS,data);\n    curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_data);\n    curl_easy_perform(curl);\n  }\n  curl_global_cleanup();\n}\n</code></pre>\n\n<p><strong>Compiler returned:</strong> </p>\n\n<blockquote>\n  <p>cgo-gcc-prolog:129:19: error: array size is negative</p>\n</blockquote>\n\n<p>I wrote a webhook function but trigger notifyWebhook function and send the wrong argument.\nWhy? Where do I make mistakes? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26911, "user_id": 225262, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/10f7602ff38f6486cb1580052746fc05?s=128&d=identicon&r=PG", "display_name": "satoru", "link": "https://stackoverflow.com/users/225262/satoru"}, "edited": false, "score": 1, "creation_date": 1576834293, "post_id": 59422822, "comment_id": 105032069, "body": "You should add a link to the struct definition."}, {"owner": {"reputation": 496, "user_id": 5977709, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Wp5WfpAAGHo/AAAAAAAAAAI/AAAAAAAAASc/-Lw55LJlMJ8/photo.jpg?sz=128", "display_name": "Dusan Gligoric", "link": "https://stackoverflow.com/users/5977709/dusan-gligoric"}, "reply_to_user": {"reputation": 26911, "user_id": 225262, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/10f7602ff38f6486cb1580052746fc05?s=128&d=identicon&r=PG", "display_name": "satoru", "link": "https://stackoverflow.com/users/225262/satoru"}, "edited": false, "score": 0, "creation_date": 1576834521, "post_id": 59422822, "comment_id": 105032164, "body": "github doesent like me &gt; (Sorry about that, but we can\u2019t show files that are this big right now.) its line 78405 of <a href=\"https://github.com/aws/aws-sdk-go/blob/master/service/ec2/api.go\" rel=\"nofollow noreferrer\">github.com/aws/aws-sdk-go/blob/master/service/ec2/api.go</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1576836311, "post_id": 59422822, "comment_id": 105032949, "body": "It&#39;s for code generation and/or reflection. This is a duplicate, i&#39;ll try to find the previous question."}, {"owner": {"reputation": 496, "user_id": 5977709, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Wp5WfpAAGHo/AAAAAAAAAAI/AAAAAAAAASc/-Lw55LJlMJ8/photo.jpg?sz=128", "display_name": "Dusan Gligoric", "link": "https://stackoverflow.com/users/5977709/dusan-gligoric"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576836519, "post_id": 59422822, "comment_id": 105033046, "body": "this code is generated so that makes a lot of sense, please do, ty @mkopriva"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1576836535, "post_id": 59422822, "comment_id": 105033052, "body": "@DusanGligoric found it <a href=\"https://stackoverflow.com/questions/50387103/go-struct-tags-with-underscore-before-function-names\" title=\"go struct tags with underscore before function names\">stackoverflow.com/questions/50387103/&hellip;</a>"}], "owner": {"reputation": 496, "user_id": 5977709, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Wp5WfpAAGHo/AAAAAAAAAAI/AAAAAAAAASc/-Lw55LJlMJ8/photo.jpg?sz=128", "display_name": "Dusan Gligoric", "link": "https://stackoverflow.com/users/5977709/dusan-gligoric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 1, "closed_date": 1576836742, "answer_count": 0, "score": 0, "last_activity_date": 1576834750, "creation_date": 1576834201, "last_edit_date": 1576834750, "question_id": 59422822, "link": "https://stackoverflow.com/questions/59422822/struct-type-first-line-struct", "closed_reason": "Duplicate", "title": "Struct type first line: _ struct{}", "body": "<p>I see this line of code at the begin of any struct type all over the <code>github.com/aws/aws-sdk-go/service/ec2</code>:</p>\n\n<pre><code>type InstanceState struct {\n    _ struct{} `type:\"structure\"` &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;\n...\n}\n</code></pre>\n\n<p>Can someone tell me how this is being used and what does it do exactly?</p>\n\n<p>update: looking at <a href=\"https://github.com/aws/aws-sdk-go/blob/master/service/ec2/api.go\" rel=\"nofollow noreferrer\">https://github.com/aws/aws-sdk-go/blob/master/service/ec2/api.go</a> line 78405(cannot link to git as file is too big for github to show)</p>\n"}, {"tags": ["arrays", "pointers", "go", "iteration"], "answers": [{"comments": [{"owner": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "edited": false, "score": 0, "creation_date": 1576835105, "post_id": 59422892, "comment_id": 105032404, "body": "Can you explain a little more about what it means to &quot;evaluate a range expression&quot;."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "edited": false, "score": 0, "creation_date": 1576835289, "post_id": 59422892, "comment_id": 105032488, "body": "@ChrisDrew The expression here is simple, it&#39;s just the variable <code>B</code>. Evaluating a variable is simply reading its value. The expression could be anything more complex of course, e.g. calling other functions."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576843615, "post_id": 59422892, "comment_id": 105036069, "body": "is it possible to see the  copy in action using assembler output ? i naively ask as i don&#39;t realize how much instructions, nor what they look like, i am referring to."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1576883192, "post_id": 59422892, "comment_id": 105050176, "body": "@mh-cbon Please see edited answer, the last &quot;Under the hood&quot; part. The compiler generates such code that the result of the range expression is assigned to a temporary variable."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1576912888, "last_edit_date": 1576912888, "creation_date": 1576834515, "answer_id": 59422892, "question_id": 59422791, "link": "https://stackoverflow.com/questions/59422791/updating-golang-array-while-iterating-it/59422892#59422892", "title": "Updating golang array while iterating it", "body": "<p><strong>TLDR;</strong> Whatever you range over, a copy is made of it (<em>this is the general \"rule\", but there is an exception, see below</em>). <a href=\"https://golang.org/ref/spec#Array_types\" rel=\"nofollow noreferrer\">Arrays</a> are rare in Go, usually <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">slices</a> are used. Slice values (<a href=\"https://golang.org/pkg/reflect/#SliceHeader\" rel=\"nofollow noreferrer\">slice headers</a>) contain a pointer to an underlying array, so copying a slice header is fast, efficient, and it does not copy the slice elements, not like arrays. Ranging over a pointer to array is similar to ranging over a slice in this regard.</p>\n\n<hr>\n\n<p><a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow noreferrer\">Spec: For statements:</a></p>\n\n<blockquote>\n  <p><strong>The range expression <code>x</code> is evaluated once before beginning the loop</strong>, with one exception: if at most one iteration variable is present and <code>len(x)</code> is constant, the range expression is not evaluated.</p>\n</blockquote>\n\n<p>Arrays are values, they do not contain pointers to data located outside of the array's memory (unlike slices). <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">The Go Blog: Go Slices: usage and internals:</a></p>\n\n<blockquote>\n  <p>Go's arrays are values. <strong>An array variable denotes the entire array</strong>; it is not a pointer to the first array element (as would be the case in C). This means that when you assign or pass around an array value you will make a copy of its contents. (To avoid the copy you could pass a pointer to the array, but then that's a pointer to an array, not an array.) One way to think about arrays is as a sort of struct but with indexed rather than named fields: a fixed-size composite value.</p>\n</blockquote>\n\n<p>Evaluating an array is a copy of the entire array, it is a copy of all the elements. <a href=\"https://golang.org/ref/spec#Variables\" rel=\"nofollow noreferrer\">Spec: Variables:</a></p>\n\n<blockquote>\n  <p><strong>A variable's value is retrieved by referring to the variable in an <a href=\"https://golang.org/ref/spec#Expressions\" rel=\"nofollow noreferrer\">expression</a></strong>; it is the most recent value <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"nofollow noreferrer\">assigned</a> to the variable.</p>\n</blockquote>\n\n<p>In your first example the range expression is just a <em>pointer</em> to the array, so only this pointer is copied (but not the pointed array), so when you do <code>A[1] = 0</code> (which is a shorthand for <code>(*A)[1] = 0</code>), you modify the original array, and the iteration variable gets elements from the pointed array.</p>\n\n<p>In your second example the range expression is the array, so the array (with all its elements) is copied, and inside it <code>B[1] = 0</code> still modifies the original array (<code>B</code> is a variable, not the result of the evaluation of the range expression), but <code>v</code> is an element of the copy (<code>v</code> is populated from the copied array in each iteration).</p>\n\n<h2>Under the hood</h2>\n\n<p>So how is this \"copy\" realized? The compiler generates code for the <code>for range</code> that copies (assigns) the result of the range expression to a temporary variable (if needed, because it might not always be needed: <em>\"if at most one iteration variable is present and <code>len(x)</code> is constant, the range expression is not evaluated\"</em>).</p>\n\n<p>This code can be inspected in the <a href=\"https://github.com/golang/go/blob/b234fdb5cd13ae43bda389e4eb3ce7cee3cfc420/src/cmd/compile/internal/gc/range.go#L213\" rel=\"nofollow noreferrer\"><code>cmd/compile/internal/gc/range.go</code></a> file.</p>\n\n<p>See related article: <a href=\"https://garbagecollected.org/2017/02/22/go-range-loop-internals/\" rel=\"nofollow noreferrer\">Go Range Loop Internals</a></p>\n"}, {"tags": [], "owner": {"reputation": 1851, "user_id": 3005781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/doo82.jpg?s=128&g=1", "display_name": "Henry Harutyunyan", "link": "https://stackoverflow.com/users/3005781/henry-harutyunyan"}, "is_accepted": false, "score": 2, "last_activity_date": 1576835365, "last_edit_date": 1592644375, "creation_date": 1576835365, "answer_id": 59423118, "question_id": 59422791, "link": "https://stackoverflow.com/questions/59422791/updating-golang-array-while-iterating-it/59423118#59423118", "title": "Updating golang array while iterating it", "body": "<p>The spec says</p>\n<blockquote>\n<p>The range expression x is evaluated once before beginning the loop, with one exception: if at most one iteration variable is present and len(x) is constant, the range expression is not evaluated.</p>\n<p>Function calls on the left are evaluated once per iteration. For each iteration, iteration values are produced as follows if the respective iteration variables are present</p>\n</blockquote>\n<p>The thing here is that given your loop takes more than one variable, the range expression is evaluated only once at the beginning of the iteration. Thus the value of the <code>B[1]</code> assigned to the <code>v</code> won't change.</p>\n<p>In the case with reference, you see the modified value since the expression evaluates the reference to the <code>B[1]</code>, which is not modified and prints the value of that referenced variable, which is actually modified.</p>\n"}], "owner": {"reputation": 2440, "user_id": 804479, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/20a5b0dc33b08417d7f6f6d1a17c97ca?s=128&d=identicon&r=PG&f=1", "display_name": "aleb", "link": "https://stackoverflow.com/users/804479/aleb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 1, "accepted_answer_id": 59422892, "answer_count": 2, "score": 3, "last_activity_date": 1576912888, "creation_date": 1576834101, "last_edit_date": 1576834705, "question_id": 59422791, "link": "https://stackoverflow.com/questions/59422791/updating-golang-array-while-iterating-it", "title": "Updating golang array while iterating it", "body": "<p>When iterating an array with range, if the array is updated the updated positions do not make it into the future loop runs. The following prints \"1 2\" instead of \"1 0\"</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var A = &amp;[2]int{1, 2}\n    for i, v := range A {\n        if i == 0 {\n            A[1] = 0\n        }\n        fmt.Print(v, \" \")\n    }\n\n    fmt.Println()\n\n    var B = [2]int{1, 2}\n    for i, v := range B {\n        if i == 0 {\n            B[1] = 0\n        }\n        fmt.Print(v, \" \")\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/0zZY6vjxwut\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0zZY6vjxwut</a></p>\n\n<p>It looks like the array is copied before it's iterated.</p>\n\n<p>What part of the spec describes this behavior?\nSee \"For statements with range clause\" at <a href=\"https://golang.org/ref/spec#For_range\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#For_range</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 8, "creation_date": 1576828065, "post_id": 59421516, "comment_id": 105029583, "body": "The goroutine feature is there to use.  Execute the request in a goroutine."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 2, "creation_date": 1576828180, "post_id": 59421516, "comment_id": 105029625, "body": "A go routine is the way to go. It is much simpler and convenient to use than callbacks."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1576830737, "post_id": 59421516, "comment_id": 105030540, "body": "Everything in Go is automatically &quot;non blocking&quot; if you call it in a goroutine."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1576838254, "post_id": 59421516, "comment_id": 105033858, "body": "this question lacks of useful sense in the world of go."}, {"owner": {"reputation": 45, "user_id": 12041033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0aa05b2111005d4ad77a20946e8799e9?s=128&d=identicon&r=PG&f=1", "display_name": "yushizhao", "link": "https://stackoverflow.com/users/12041033/yushizhao"}, "edited": false, "score": 0, "creation_date": 1576895306, "post_id": 59421516, "comment_id": 105051788, "body": "Thank you all! I am now feel confident in using the goroutine solutions!"}], "answers": [{"comments": [{"owner": {"reputation": 394, "user_id": 1432640, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2d9cff10dc7e3124d701b6eddbae341b?s=128&d=identicon&r=PG", "display_name": "stillwaiting", "link": "https://stackoverflow.com/users/1432640/stillwaiting"}, "edited": false, "score": 1, "creation_date": 1599594477, "post_id": 59422255, "comment_id": 112820127, "body": "Can someone please explain me this article then <a href=\"https://medium.com/@nate510/don-t-use-go-s-default-http-client-4804cb19f779\" rel=\"nofollow noreferrer\">medium.com/@nate510/&hellip;</a> ? If the response is valid, how can long connections to a dependent service cause saturation?"}, {"owner": {"reputation": 1122, "user_id": 1380744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f755d90d01af6a2602d2ae29e3d75dac?s=128&d=identicon&r=PG", "display_name": "o_nix", "link": "https://stackoverflow.com/users/1380744/o-nix"}, "reply_to_user": {"reputation": 394, "user_id": 1432640, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2d9cff10dc7e3124d701b6eddbae341b?s=128&d=identicon&r=PG", "display_name": "stillwaiting", "link": "https://stackoverflow.com/users/1432640/stillwaiting"}, "edited": false, "score": 0, "creation_date": 1615169040, "post_id": 59422255, "comment_id": 117600299, "body": "@stillwaiting imagine an enormous number of blocked goroutines waiting for HTTP response from the external service forever. I mean, it would be not about resources, as the blocked ones are cheap, but about the app&#39;s liveness."}, {"owner": {"reputation": 394, "user_id": 1432640, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2d9cff10dc7e3124d701b6eddbae341b?s=128&d=identicon&r=PG", "display_name": "stillwaiting", "link": "https://stackoverflow.com/users/1432640/stillwaiting"}, "reply_to_user": {"reputation": 1122, "user_id": 1380744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f755d90d01af6a2602d2ae29e3d75dac?s=128&d=identicon&r=PG", "display_name": "o_nix", "link": "https://stackoverflow.com/users/1380744/o-nix"}, "edited": false, "score": 0, "creation_date": 1615274163, "post_id": 59422255, "comment_id": 117633448, "body": "Not sure I follow, @o_nix (and thanks for the response :) )... If the enormous number of blocked goroutines is not about resources and it is cheap, then why the app won&#39;t be &quot;live&quot;...  Quote (from article): &quot;Because API calls were being made to serve user requests, this caused the goroutines serving user requests to hang as well. Once enough users hit the sprockets page, the app fell over, most likely due to resource limits being reached.&quot; End quote.  This sounds like the starvation of the resources. Is it a mistake in the article, or I still miss something?"}, {"owner": {"reputation": 1122, "user_id": 1380744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f755d90d01af6a2602d2ae29e3d75dac?s=128&d=identicon&r=PG", "display_name": "o_nix", "link": "https://stackoverflow.com/users/1380744/o-nix"}, "reply_to_user": {"reputation": 394, "user_id": 1432640, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2d9cff10dc7e3124d701b6eddbae341b?s=128&d=identicon&r=PG", "display_name": "stillwaiting", "link": "https://stackoverflow.com/users/1432640/stillwaiting"}, "edited": false, "score": 0, "creation_date": 1615306237, "post_id": 59422255, "comment_id": 117647546, "body": "@stillwaiting OK, my bad, should&#39;ve read the article more precisely, sorry. :) You are right, in this specific case, it was about resources as there is still no magic: more sleeping goroutines requested - more resources consumed. However, this answer emphasizes that you should be fine with requesting a big number of goroutines because they are not threads, as threads are consuming resources way much faster. I assumed a different situation: they were proxying the requests, and the requests just were hanging up because of indefinitely sleeping goroutines."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 6, "last_activity_date": 1576833930, "last_edit_date": 1576833930, "creation_date": 1576831634, "answer_id": 59422255, "question_id": 59421516, "link": "https://stackoverflow.com/questions/59421516/is-there-a-non-blocking-http-client/59422255#59422255", "title": "Is there a non-blocking http client?", "body": "<p>Other languages have such features because when they block waiting for request they block the thread they are using. This is the case for Java, Python or NodeJS. Therefore to make them useful, the developers needed to implement such long-standing blocking operations with callbacks. The root cause of that is the usage of the C library beneath that blocks threads on input-output operations.</p>\n\n<p>Go does not use C library (only in some cases, but it can be turned off) and makes system calls by itself. While doing this the thread that executes current goroutine parks it and executes another goroutine. Therefore you can  have enormous number of blocked goroutines without running out of threads. Goroutines are cheap with regard to memory, threads are operating system entities.</p>\n\n<p>In Go using goroutines is better. There is no need for creating asynchronous client because of the above. </p>\n\n<p>For comparison in Java you would quickly end up with multiple threads. The next step would be pooling them as they are costly. Pooling means limiting the concurrency.</p>\n"}, {"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 0, "last_activity_date": 1576834116, "creation_date": 1576834116, "answer_id": 59422797, "question_id": 59421516, "link": "https://stackoverflow.com/questions/59421516/is-there-a-non-blocking-http-client/59422797#59422797", "title": "Is there a non-blocking http client?", "body": "<p>Yip, built into the standard library, just not usable by a simple function call out of the box.</p>\n\n<p>Take this example</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"log\"\n    \"net/http\"\n    \"sync\"\n    \"time\"\n)\n\nvar url string\nvar timeout time.Duration\n\nfunc init() {\n    flag.StringVar(&amp;url, \"url\", \"http://www.stackoverflow.com\", \"url to GET\")\n    flag.DurationVar(&amp;timeout, \"timeout\", 5*time.Second, \"timeout for the GET operation\")\n}\n\nfunc main() {\n    flag.Parse()\n\n    // We use the channel as our means to\n    // hand the response over\n    rc := make(chan *http.Response)\n\n    // We need a waitgroup because all goroutines exit when main exits\n    var wg sync.WaitGroup\n\n    // We are spinning up an async request\n    // Increment the counter for our WaitGroup.\n    // What we are basically doing here is to tell the WaitGroup\n    // \"Hey, there is one more task you have to wait for!\"\n    wg.Add(1)\n\n    go func() {\n        // Notify the WaitGroup that one task is done as soon\n        // as we exit the goroutine.\n        defer wg.Done()\n\n        log.Printf(\"Doing GET request on \\\"%s\\\"\", url)\n        resp, err := http.Get(url)\n\n        if err != nil {\n            log.Printf(\"GET for %s: %s\", url, err)\n        }\n\n        // We send the reponse downstream\n        rc &lt;- resp\n\n        // Now, the goroutine exits, the defered call to wg.Done()\n        // is executed.\n    }()\n\n    // And here we do our async processing.\n    // Note that you could have done the processing in the first goroutine\n    // as well, since http.Get would be a blocking operation and any subsequent\n    // code in the goroutine would have been excuted only after the Get returned.\n    // However, I put te processing into its own goroutine for demonstration purposes.\n    wg.Add(1)\n    go func() {\n\n        // As above\n        defer wg.Done()\n\n        log.Println(\"Doing something else\")\n\n        // Setting up a timer for a timeout.\n        // Note that this could be done using a request with a context, as well.\n        to := time.NewTimer(timeout).C\n\n        select {\n        case &lt;-to:\n            log.Println(\"Timeout reached\")\n            // Exiting the goroutine, the deferred call to wg.Done is executed\n            return\n        case r := &lt;-rc:\n            if r == nil {\n                log.Printf(\"Got no useful response from GETting \\\"%s\\\"\", url)\n                // Exiting the goroutine, the deferred call to wg.Done is executed\n                return\n            }\n            log.Printf(\"Got response with status code %d (%s)\", r.StatusCode, r.Status)\n            log.Printf(\"Now I can do something useful with the response\")\n\n        }\n    }()\n\n    // Now we have set up all of our tasks,\n    // we are waiting until all of them are done...\n    wg.Wait()\n    log.Println(\"All tasks done, exiting\")\n}\n</code></pre>\n\n<p>If you look at this closely, we have all building blocks to make GETting an URL and processing the response async. We can start to abstract this a bit:</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\nvar url string\nvar timeout time.Duration\n\nfunc init() {\n    flag.StringVar(&amp;url, \"url\", \"http://www.stackoverflow.com\", \"url to GET\")\n    flag.DurationVar(&amp;timeout, \"timeout\", 5*time.Second, \"timeout for the GET operation\")\n}\n\ntype callbackFunc func(*http.Response, error) error\n\nfunc getWithCallBack(u string, callback callbackFunc) chan error {\n\n    // We create a channel which we can use to notify the caller of the\n    // result of the callback.\n    c := make(chan error)\n    go func() {\n        c &lt;- callback(http.Get(u))\n    }()\n    return c\n}\n\nfunc main() {\n    flag.Parse()\n\n    c := getWithCallBack(url, func(resp *http.Response, err error) error {\n\n        if err != nil {\n            // Doing something useful with the err.\n            // Add additional cases as needed.\n            switch err {\n            case http.ErrNotSupported:\n                log.Printf(\"GET not supported for \\\"%s\\\"\", url)\n            }\n            return err\n        }\n        log.Printf(\"GETting \\\"%s\\\": Got response with status code %d (%s)\", url, resp.StatusCode, resp.Status)\n        return nil\n    })\n\n    if err := &lt;-c; err != nil {\n        log.Printf(\"Error GETting \\\"%s\\\": %s\", url, err)\n    }\n    log.Println(\"All tasks done, exiting\")\n}\n</code></pre>\n\n<p>And there you Go (pun intended): Async processing of GET requests.</p>\n"}, {"tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": false, "score": 1, "last_activity_date": 1576834645, "last_edit_date": 1576834645, "creation_date": 1576834135, "answer_id": 59422806, "question_id": 59421516, "link": "https://stackoverflow.com/questions/59421516/is-there-a-non-blocking-http-client/59422806#59422806", "title": "Is there a non-blocking http client?", "body": "<p>As others have stated, goroutines are the way to go (pun intended).</p>\n\n<p>Minimal Example:</p>\n\n<pre><code>type nonBlocking struct {\n    Response *http.Response\n    Error    error\n}\n\nconst numRequests = 2\n\nfunc main() {\n\n    nb := make(chan nonBlocking, numRequests)\n    wg := &amp;sync.WaitGroup{}\n\n    for i := 0; i &lt; numRequests; i++ {\n        wg.Add(1)\n        go Request(nb)\n    }\n\n    go HandleResponse(nb, wg)\n\n    wg.Wait()\n\n}\n\nfunc Request(nb chan nonBlocking) {\n\n    resp, err := http.Get(\"http://example.com\")\n    nb &lt;- nonBlocking{\n        Response: resp,\n        Error:    err,\n    }\n}\n\nfunc HandleResponse(nb chan nonBlocking, wg *sync.WaitGroup) {\n\n    for get := range nb {\n\n        if get.Error != nil {\n            log.Println(get.Error)\n        } else {\n            log.Println(get.Response.Status)\n        }\n        wg.Done()\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 12041033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0aa05b2111005d4ad77a20946e8799e9?s=128&d=identicon&r=PG&f=1", "display_name": "yushizhao", "link": "https://stackoverflow.com/users/12041033/yushizhao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1135, "favorite_count": 0, "closed_date": 1576838287, "accepted_answer_id": 59422255, "answer_count": 3, "score": -2, "last_activity_date": 1576834645, "creation_date": 1576827702, "last_edit_date": 1576831102, "question_id": 59421516, "link": "https://stackoverflow.com/questions/59421516/is-there-a-non-blocking-http-client", "closed_reason": "Not suitable for this site", "title": "Is there a non-blocking http client?", "body": "<p>Many languages have their own high-level non-blocking HTTP client, for example, python's aiohttp. Namely, they send out HTTP requests; do not wait for response; When response arrives they make some kind of callbacks. </p>\n\n<p>My questions are</p>\n\n<ol>\n<li>is there a Go package for that?</li>\n<li>or we just create a goroutine in which we use normal HTTP clients?</li>\n<li>which way is better?</li>\n</ol>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 739, "user_id": 3390851, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/HEm4K.jpg?s=128&g=1", "display_name": "Katiyman", "link": "https://stackoverflow.com/users/3390851/katiyman"}, "edited": false, "score": 0, "creation_date": 1576823503, "post_id": 59420699, "comment_id": 105028230, "body": "Check out this link    <a href=\"https://stackoverflow.com/questions/25129345/unmarshal-ignore-empty-fields\" title=\"unmarshal ignore empty fields\">stackoverflow.com/questions/25129345/&hellip;</a>"}, {"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "edited": false, "score": 0, "creation_date": 1576825682, "post_id": 59420699, "comment_id": 105028807, "body": "can you share the code of update operations"}, {"owner": {"reputation": 41, "user_id": 9353071, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-pttOO1UIjeQ/AAAAAAAAAAI/AAAAAAAAAM0/92883RGnX5I/photo.jpg?sz=128", "display_name": "Iqbal Afrianto", "link": "https://stackoverflow.com/users/9353071/iqbal-afrianto"}, "edited": false, "score": 0, "creation_date": 1576825823, "post_id": 59420699, "comment_id": 105028843, "body": "Thanks!! you have to specify omitempty on the sturct and convert it  <code>var payloadInterface map[string]interface{} \tinrec, _ := json.Marshal(payload)  \tjson.Unmarshal(inrec, &amp;payloadInterface)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 9353071, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-pttOO1UIjeQ/AAAAAAAAAAI/AAAAAAAAAM0/92883RGnX5I/photo.jpg?sz=128", "display_name": "Iqbal Afrianto", "link": "https://stackoverflow.com/users/9353071/iqbal-afrianto"}, "is_accepted": false, "score": 1, "last_activity_date": 1576827474, "creation_date": 1576827474, "answer_id": 59421472, "question_id": 59420699, "link": "https://stackoverflow.com/questions/59420699/update-only-by-payload/59421472#59421472", "title": "Update only by payload", "body": "<p>You have to specify omitempty on the struct</p>\n\n<pre><code>type PayloadUpdateProfile struct {\n    FullName    string       `json:\"fullName,omitempty\" bson:\"fullName,omitempty\"`\n    FirstName   string       `json:\"firstName,omitempty\" bson:\"firstName,omitempty\"`\n    LastName    string       `json:\"lastName,omitempty\" bson:\"lastName,omitempty\"`\n}\n</code></pre>\n\n<p>Bind the payload into the struct as usual</p>\n\n<pre><code>var payload profile.PayloadUpdateProfile\nerr := c.Bind(&amp;payload)\n</code></pre>\n\n<p>then convert it </p>\n\n<pre><code>var payloadInterface map[string]interface{}\n    inrecPayload, _ := json.Marshal(payload)\n\n    json.Unmarshal(inrec, &amp;payloadInterface)\n\nUpdateMethod(ctx, filter, payloadInterface)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "is_accepted": false, "score": 0, "last_activity_date": 1576834506, "creation_date": 1576834506, "answer_id": 59422890, "question_id": 59420699, "link": "https://stackoverflow.com/questions/59420699/update-only-by-payload/59422890#59422890", "title": "Update only by payload", "body": "<blockquote>\n  <p>You can do things like this:</p>\n</blockquote>\n\n<pre><code>    type updatePayload struct {\n    FullName    string `json:\"fullName\" bson:\"fullName\"`\n    FirstName   string `json:\"firstName\" bson:\"firstName\"`\n    LastName    string `json:\"lastName\" bson:\"lastName\"`\n    Location    string `json:\"location\" bson:\"location\"`\n    Gender      string `json:\"gender\" bson:\"gender\"`\n    State       string `json:\"state\" bson:\"state\"`\n    Subdistrict string `json:\"subdistrict\" bson:\"subdistrict\"`\n    Address     string `json:\"homeAddress\" bson:\"homeAddress\"`\n    Profession  string `json:\"provession\" bson:\"provession\"`\n    Settings    struct {\n        Email bool `json:\"email\" bson:\"email\"`\n        SMS   bool `json:\"sms\" bson:\"sms\"`\n        GCM   bool `json:\"gcm\" bson:\"gcm\"`\n    } `json:\"settings\" bson:\"settings\"`\n    Coordinates struct {\n        Type        string    `json:\"type\" bson:\"type\"`\n        Coordinates []float64 `json:\"coordinates\" bson:\"coordinates\"`\n    } `json:\"coordinates\" bson:\"coordinates\"`\n}\n\nfunc (payload *updatePayload) prepareUpdateQuery() (bson.M, error) {\n    updateQuery := make(bson.M)\n    if len(payload.FirstName) != 0 {\n        updateQuery[\"firstName\"] = payload.FirstName\n    }\n\n    if len(payload.LastName) != 0 {\n        updateQuery[\"lastName\"] = payload.LastName\n    }\n    // do same like above for other fields \n\n    updateQ := make(bson.M)\n    updateQ[\"$set\"] = updateQuery\n    return updateQ, nil\n}\n</code></pre>\n\n<blockquote>\n  <p>have the method on updatePayload struct and after decoding the api payload , call this method and generate the update query for those fields only which has data from api payload. Once update query is made pass that update query to mongodb update wrapper function . </p>\n</blockquote>\n"}], "owner": {"reputation": 41, "user_id": 9353071, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-pttOO1UIjeQ/AAAAAAAAAAI/AAAAAAAAAM0/92883RGnX5I/photo.jpg?sz=128", "display_name": "Iqbal Afrianto", "link": "https://stackoverflow.com/users/9353071/iqbal-afrianto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1576834506, "creation_date": 1576822910, "last_edit_date": 1576830785, "question_id": 59420699, "link": "https://stackoverflow.com/questions/59420699/update-only-by-payload", "title": "Update only by payload", "body": "<p>I am making rest API using go and echo, and I'm working on updating data. At first I was using struct to store the payload and then do the update to mongodb </p>\n\n<pre><code>type updatePayload struct {\n    FullName    string `json:\"fullName\" bson:\"fullName\"`\n    FirstName   string `json:\"firstName\" bson:\"firstName\"`\n    LastName    string `json:\"lastName\" bson:\"lastName\"`\n    Location    string `json:\"location\" bson:\"location\"`\n    Gender      string `json:\"gender\" bson:\"gender\"`\n    State       string `json:\"state\" bson:\"state\"`\n    Subdistrict string `json:\"subdistrict\" bson:\"subdistrict\"`\n    Address     string `json:\"homeAddress\" bson:\"homeAddress\"`\n    Profession  string `json:\"provession\" bson:\"provession\"`\n    Settings    struct {\n        Email bool `json:\"email\" bson:\"email\"`\n        SMS   bool `json:\"sms\" bson:\"sms\"`\n        GCM   bool `json:\"gcm\" bson:\"gcm\"`\n    } `json:\"settings\" bson:\"settings\"`\n    Coordinates struct {\n        Type        string    `json:\"type\" bson:\"type\"`\n        Coordinates []float64 `json:\"coordinates\" bson:\"coordinates\"`\n    } `json:\"coordinates\" bson:\"coordinates\"`\n}\n</code></pre>\n\n<p>The update is working but if I'm not send all the parameters like only send one field , the rest of the fields is updated to, only it was an empty string \"\"</p>\n\n<p>is there any way I can only update the field that was specified on the request payload.</p>\n"}, {"tags": ["go", "stream"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1576802379, "post_id": 59417897, "comment_id": 105024430, "body": "zip is an archive format, so have to add a file before you can write content. Use <a href=\"https://golang.org/pkg/archive/zip/#Writer.Create\" rel=\"nofollow noreferrer\">Create</a> or <a href=\"https://golang.org/pkg/archive/zip/#Writer.CreateHeader\" rel=\"nofollow noreferrer\">CreateHeader</a>."}], "answers": [{"comments": [{"owner": {"reputation": 966, "user_id": 1834377, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c0c01a667b3332390a8953ac36cc9381?s=128&d=identicon&r=PG", "display_name": "jk-kim", "link": "https://stackoverflow.com/users/1834377/jk-kim"}, "edited": false, "score": 1, "creation_date": 1576860321, "post_id": 59418584, "comment_id": 105043347, "body": "First example playground was what I needed.  thanks!"}], "tags": [], "owner": {"reputation": 5298, "user_id": 12606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1086eadc88de1e47fbffca9a73fd82?s=128&d=identicon&r=PG", "display_name": "Stuart Carnie", "link": "https://stackoverflow.com/users/12606/stuart-carnie"}, "is_accepted": true, "score": 4, "last_activity_date": 1609377548, "last_edit_date": 1609377548, "creation_date": 1576802303, "answer_id": 59418584, "question_id": 59417897, "link": "https://stackoverflow.com/questions/59417897/encode-as-csv-then-zip-in-golang/59418584#59418584", "title": "encode as CSV then ZIP in golang", "body": "<p><code>zip</code> produces a structured zip file with a directory structure, which means you need to create and add each file independently.</p>\n<p>An <a href=\"https://play.golang.org/p/pN5Z04_lavM\" rel=\"nofollow noreferrer\">example playground</a> demonstrates how to add your CSV file. It also demonstrates opening the compressed zip file and enumerating the files.</p>\n<hr />\n<p>If you want to <code>gzip</code> the file as a single compressed stream, like:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>$ gzip somefile.csv\n</code></pre>\n<p>to produce <code>somefile.csv.gz</code></p>\n<p>Then you can do the following as demostrated by this <a href=\"https://play.golang.org/p/gOj2TiAds0S\" rel=\"nofollow noreferrer\">playground</a></p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;bytes&quot;\n    &quot;compress/gzip&quot;\n    &quot;encoding/csv&quot;\n    &quot;fmt&quot;\n    &quot;io/ioutil&quot;\n)\n\nfunc main() {\n    var buf bytes.Buffer\n\n    zipWriter := gzip.NewWriter(&amp;buf)\n    csvwriter := csv.NewWriter(zipWriter)\n\n    csvwriter.Write([]string{&quot;a&quot;, &quot;b\\&quot;fwr&quot;, &quot;c&quot;})\n    csvwriter.Write([]string{&quot;a&quot;, &quot;e&quot;, &quot;ww&quot;})\n    csvwriter.Flush()\n    zipWriter.Flush()\n    zipWriter.Close()\n\n    fmt.Println(buf.Bytes())\n    zipReader, _ := gzip.NewReader(bytes.NewReader(buf.Bytes()))\n    d, err := ioutil.ReadAll(zipReader)\n    if err != nil {\n        fmt.Println(&quot;err&quot;, err)\n    }\n    fmt.Println(string(d))\n}\n</code></pre>\n"}], "owner": {"reputation": 966, "user_id": 1834377, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c0c01a667b3332390a8953ac36cc9381?s=128&d=identicon&r=PG", "display_name": "jk-kim", "link": "https://stackoverflow.com/users/1834377/jk-kim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 580, "favorite_count": 0, "accepted_answer_id": 59418584, "answer_count": 1, "score": 3, "last_activity_date": 1609377548, "creation_date": 1576796123, "last_edit_date": 1576830873, "question_id": 59417897, "link": "https://stackoverflow.com/questions/59417897/encode-as-csv-then-zip-in-golang", "title": "encode as CSV then ZIP in golang", "body": "<p>How do I CSV encode and then zip? </p>\n\n<p>Is there a way to chain a writer to another?  Must I create a new buffer in between writers?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var buf bytes.Buffer\n\nzipWriter := zip.NewWriter(&amp;buf)\ncsvwriter := csv.NewWriter(zipWriter) // &lt;--- zip writer doesn't implement `io.writer`\n\ncsvwriter.Write([]string{\"a\", \"b\\\"fwr\", \"c\"})\ncsvwriter.Write([]string{\"a\", \"e\", \"ww\"})\ncsvwriter.Flush()\n\nprintln(buf.String())\n</code></pre>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 5619, "user_id": 1723695, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/dx9jj.jpg?s=128&g=1", "display_name": "Kirill", "link": "https://stackoverflow.com/users/1723695/kirill"}, "edited": false, "score": 0, "creation_date": 1576869186, "post_id": 59417246, "comment_id": 105046400, "body": "Try running the image without &quot;detach&quot; option (<code>-d</code> flag). Also, you don&#39;t need <code>-it</code> here. Just run <code>docker run -p 8080:8080 --name goserver goserver</code> to see logs and error messages"}], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 9825979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2463398de4c8409be4a16fba6f84700?s=128&d=identicon&r=PG&f=1", "display_name": "ReverendRonja", "link": "https://stackoverflow.com/users/9825979/reverendronja"}, "edited": false, "score": 0, "creation_date": 1576855265, "post_id": 59418470, "comment_id": 105041163, "body": "why am i still getting connection refused after making those changes?"}], "tags": [], "owner": {"reputation": 415, "user_id": 8943292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/277e703f6aa238e6b710b115b2a8d215?s=128&d=identicon&r=PG&f=1", "display_name": "andre", "link": "https://stackoverflow.com/users/8943292/andre"}, "is_accepted": false, "score": 1, "last_activity_date": 1576802877, "last_edit_date": 1576802877, "creation_date": 1576801202, "answer_id": 59418470, "question_id": 59417246, "link": "https://stackoverflow.com/questions/59417246/cant-get-docker-container-to-run-on-localhosts-it-says-connection-reset/59418470#59418470", "title": "Can&#39;t get Docker container to run on localhosts it says &quot;connection reset&quot;?", "body": "<p>your <code>WORKDIR</code> is wrong, based on how you are setting your <code>CMD</code></p>\n\n<p>change your <code>WORKDIR</code> to <code>SRC_DIR</code> instead of <code>GOBIN</code> and it will work</p>\n\n<p>You could also run <code>go install main.go</code> on your Dockerfile</p>\n\n<p><code>go install</code> will create the executable and move it to the bin folder</p>\n\n<p>here is an example of a working Dockerfile:</p>\n\n<pre><code>FROM golang:1\n\nENV SRC_DIR=/go/src/\nENV GOBIN=/go/bin\n\nWORKDIR $SRC_DIR\n\n# Add the source code:\nADD . $SRC_DIR\n\nRUN go get github.com/gorilla/mux;\nRUN go install main.go\n\nWORKDIR $GOBIN\nENTRYPOINT [\"./main\"]\n\nEXPOSE 8080\n</code></pre>\n\n<p>What was happening is: your <code>CMD</code> was failing because the <code>WORKDIR</code> was pointing to the bin folder. </p>\n\n<p>A few side notes:</p>\n\n<p>Don't do: <code>RUN cd</code>, as per: <a href=\"https://stackoverflow.com/questions/17891981/docker-run-cd-does-not-work-as-expected\">Docker : RUN cd ... does not work as expected</a></p>\n"}, {"comments": [{"owner": {"reputation": 67, "user_id": 9825979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2463398de4c8409be4a16fba6f84700?s=128&d=identicon&r=PG&f=1", "display_name": "ReverendRonja", "link": "https://stackoverflow.com/users/9825979/reverendronja"}, "edited": false, "score": 0, "creation_date": 1577110121, "post_id": 59430608, "comment_id": 105094528, "body": "Now that I am seeing the docker daemon&#39;s errors ( is that right) by using the -d flag I get this one error.  &quot;template parsing error: open templates/home.html: no such file or directory&quot;"}, {"owner": {"reputation": 5619, "user_id": 1723695, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/dx9jj.jpg?s=128&g=1", "display_name": "Kirill", "link": "https://stackoverflow.com/users/1723695/kirill"}, "reply_to_user": {"reputation": 67, "user_id": 9825979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2463398de4c8409be4a16fba6f84700?s=128&d=identicon&r=PG&f=1", "display_name": "ReverendRonja", "link": "https://stackoverflow.com/users/9825979/reverendronja"}, "edited": false, "score": 1, "creation_date": 1577116767, "post_id": 59430608, "comment_id": 105097373, "body": "@ReverendRonja it looks like your example in this question of <code>main.go</code> is differ from actual file. Make sure that you have same <code>main.go</code> in the project directory as in this question. I created example repository to reproduce your issue, you can follow steps from the <code>README</code> to build and run the server: <a href=\"https://github.com/g4s8/so59417246\" rel=\"nofollow noreferrer\">github.com/g4s8/so59417246</a>"}], "tags": [], "owner": {"reputation": 5619, "user_id": 1723695, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/dx9jj.jpg?s=128&g=1", "display_name": "Kirill", "link": "https://stackoverflow.com/users/1723695/kirill"}, "is_accepted": true, "score": 2, "last_activity_date": 1576871177, "creation_date": 1576871177, "answer_id": 59430608, "question_id": 59417246, "link": "https://stackoverflow.com/questions/59417246/cant-get-docker-container-to-run-on-localhosts-it-says-connection-reset/59430608#59430608", "title": "Can&#39;t get Docker container to run on localhosts it says &quot;connection reset&quot;?", "body": "<p>You're starting your image in detached (<code>-d</code>) mode - this is why you don't see error messages. There are few issues with the <code>Dockerfile</code>, it should be fixed with @andre answer, but most probably you forgot to rebuild the image and didn't see the effect.</p>\n\n<p>I'm submitting this answer to suggest some improvements of your <code>Dockerfile</code>:</p>\n\n<pre><code># first stage - builds the binary from sources\nFROM golang:1.12.14-alpine3.10 as build\n\n# using build as current directory\nWORKDIR /build\n\n# Add the source code:\nCOPY main.go ./\n\n# install build deps\nRUN apk --update --no-cache add git\n\n# downloading dependencies and\n# building server binary\nRUN go get github.com/gorilla/mux &amp;&amp; \\\n  go build -o server .\n\n# second stage - using minimal image to run the server\nFROM alpine:3.10\n\n# using /app as current directory\nWORKDIR /app\n\n# copy server binary from `build` layer\nCOPY --from=build /build/server server\n\n# binary to run\nCMD \"/app/server\"\n\nEXPOSE 8080\n</code></pre>\n\n<p>I've split your <code>Dockerfile</code> into two stages: build and run. Build stage is responsible for building the server binary, run stage is responsible for running it. See <a href=\"https://docs.docker.com/develop/develop-images/multistage-build/\" rel=\"nofollow noreferrer\">https://docs.docker.com/develop/develop-images/multistage-build/</a> <br/>\nThen I combined multiple <code>RUN</code>s into single one: <code>go get github.com/gorilla/mux &amp;&amp; go build -o server .</code> to avoid creating redundant layers. <br/>\nI fixed <code>WORKDIR</code>s and give them readable semantical names.</p>\n\n<p>Don't forget to rebuild it with <code>docker build . -t goserver</code> and run it with</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>docker run -p 8080:8080 --name goserver goserver\n</code></pre>\n\n<p>If everything is fine, and you're ready to (and you need to) start in the detach mode, then add <code>-d</code> flag.</p>\n\n<p>Also, you may want to check <code>Dockerfile</code> <a href=\"https://docs.docker.com/develop/develop-images/dockerfile_best-practices/\" rel=\"nofollow noreferrer\">best practices</a>.</p>\n"}], "owner": {"reputation": 67, "user_id": 9825979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2463398de4c8409be4a16fba6f84700?s=128&d=identicon&r=PG&f=1", "display_name": "ReverendRonja", "link": "https://stackoverflow.com/users/9825979/reverendronja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 59430608, "answer_count": 2, "score": 0, "last_activity_date": 1576871177, "creation_date": 1576791887, "last_edit_date": 1576817906, "question_id": 59417246, "link": "https://stackoverflow.com/questions/59417246/cant-get-docker-container-to-run-on-localhosts-it-says-connection-reset", "title": "Can&#39;t get Docker container to run on localhosts it says &quot;connection reset&quot;?", "body": "<p>Can't get Docker container to run on localhosts it says \"connection reset\" when going to localhost:8080. \nHere is what I do know so bear with me:</p>\n\n<ol>\n<li>The code runs locally when I run it and I am able to see the <a href=\"http://localhost:8080\" rel=\"nofollow noreferrer\">http://localhost:8080</a> page</li>\n<li>The Docker build command completes with no errors</li>\n</ol>\n\n<p>Error when curling the server:</p>\n\n<blockquote>\n  <p>curl -X GET <a href=\"http://localhost:8080\" rel=\"nofollow noreferrer\">http://localhost:8080</a><br>\n  curl: (52) Empty reply from server</p>\n</blockquote>\n\n<p><code>docker run -d -p 8080:8080 --name goserver -it goserver</code></p>\n\n<p>The Dockerfile:</p>\n\n<pre><code> FROM golang:1.9.2\n ENV SRC_DIR=/go/src/\n ENV GOBIN=/go/bin\n\n WORKDIR $GOBIN\n\n # Add the source code:\n ADD . $SRC_DIR\n\n RUN cd /go/src/;\n\n RUN go get github.com/gorilla/mux;\n\n CMD [\"go\",\"run\",\"main.go\"]\n\n\n #ENTRYPOINT [\"./main\"]\n\n EXPOSE 8080\n</code></pre>\n\n<p>Here is the go code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc main() {\n    r := mux.NewRouter()\n\n    r.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprintf(w, \"&lt;h1&gt;This is the homepage. Try /hello and /hello/Sammy\\n&lt;/h1&gt;\")\n    })\n\n    r.HandleFunc(\"/hello\", func(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprintf(w, \"&lt;h1&gt;Hello from Docker!\\n&lt;/h1&gt;\")\n    })\n\n    r.HandleFunc(\"/hello/{name}\", func(w http.ResponseWriter, r *http.Request) {\n        vars := mux.Vars(r)\n        title := vars[\"name\"]\n\n        fmt.Fprintf(w, \"&lt;h1&gt;Hello, %s!\\n&lt;/h1&gt;\", title)\n    })\n\n    http.ListenAndServe(\":8080\", r)\n}\n\n\n</code></pre>\n"}, {"tags": ["javascript", "vue.js", "go", "encryption", "aes"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1576791970, "post_id": 59417017, "comment_id": 105021869, "body": "Converting the IV to a string directly as if it were utf8 text is probably a mistake; you should use the raw IV bytes when you encrypt, and you should pass it encoded safely (eg base64) in your JSON payload. Beyond that it&#39;s hard to say exactly where the issue lies - I&#39;d recommend adding a bunch of logging to both the client and server sides to see what isn&#39;t matching up (e.g. is the iv you generated what the server saw? Is the key? Is the encrypted text hex value? What about the raw bytes before/after hex encoding/decoding?)"}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 10438705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/448ef964bc1090e2a49cc8b4fac6ca2f?s=128&d=identicon&r=PG&f=1", "display_name": "Neha", "link": "https://stackoverflow.com/users/10438705/neha"}, "edited": false, "score": 0, "creation_date": 1576859560, "post_id": 59425873, "comment_id": 105043044, "body": "Thank you, it helped! :)"}], "tags": [], "owner": {"reputation": 17201, "user_id": 9014097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2dJaU.png?s=128&g=1", "display_name": "Topaco", "link": "https://stackoverflow.com/users/9014097/topaco"}, "is_accepted": true, "score": 1, "last_activity_date": 1576847742, "creation_date": 1576847742, "answer_id": 59425873, "question_id": 59417017, "link": "https://stackoverflow.com/questions/59417017/how-to-decrypt-a-ciphertext-in-go-which-is-encrypted-in-vuejs-using-aes-js-packa/59425873#59425873", "title": "How to decrypt a ciphertext in Go which is encrypted in vuejs using aes-js package", "body": "<p>There are several flaws in both codes that prevent the execution. However, since both are running on your system, these seem to be copy/paste errors:</p>\n\n<ul>\n<li>The key is too short. AES requires a key size of 16, 24 or 32 bytes. </li>\n<li>There are naming conflicts in the Go-code regarding <code>iv</code> and <code>cipher</code>.</li>\n</ul>\n\n<p>After these fixes, the programs are executed, but the decryption fails. The problem is caused by different CFB variants: In the aes-js-code, CFB8 is used and in the Go-code, CFB128. Here the digits denote the number of bits that are shifted in the shift register <a href=\"https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Cipher_Feedback_(CFB)\" rel=\"nofollow noreferrer\">[1]</a>. </p>\n\n<p>Go <em>only</em> supports CFB128, at least without deeper modifications <a href=\"https://parsiya.net/blog/2018-12-22-aes-cfb128-pycrypto-vs.-go/#go\" rel=\"nofollow noreferrer\">[2]</a><a href=\"https://stackoverflow.com/questions/23897809/different-results-in-go-and-pycrypto-when-using-aes-cfb\">[3]</a>. </p>\n\n<p>aes-js uses CFB8 by default. However, the CFB variant can also be defined <em>explicitly</em> with the third parameter of the cfb constructor. A change to CFB128 is possible with <a href=\"https://github.com/ricmoo/aes-js#cfb---cipher-feedback\" rel=\"nofollow noreferrer\">[4]</a>:</p>\n\n<pre><code>var segmentSize = 16;\nvar aesCfb = new aesjs.ModeOfOperation.cfb(keyBytes, ivBytes, segmentSize);\n</code></pre>\n\n<p>Note that the value must be specified in bytes, i.e. 1 corresponds to CFB8 and 16 to CFB128.</p>\n\n<p>CFB is a stream cipher, so that a plaintext of <em>arbitrary</em> length can be encrypted <em>without</em> padding and the length of the ciphertext equals that of the plaintext <a href=\"https://en.wikipedia.org/wiki/Stream_cipher\" rel=\"nofollow noreferrer\">[5]</a>. Unfortunately there seems to be a bug in aes-js <a href=\"https://github.com/ricmoo/aes-js/issues/29\" rel=\"nofollow noreferrer\">[6]</a> which requires that the length of the plaintext is an integer multiple of the segment size, i.e. 16 bytes in the case of CFB128. Otherwise, the following error message is displayed:</p>\n\n<pre><code>invalid plaintext size (must be segmentSize bytes)\n</code></pre>\n\n<p>I.e., if the plaintexts used don't already have this length, the bug requires explicit padding, although a stream cipher wouldn't actually require padding.</p>\n\n<p>Against the background of these problems, you may want to use either a different mode or different libraries.</p>\n\n<p>Besides:</p>\n\n<ul>\n<li>The IV isn't the cause of the problem: In the current example, with <code>CryptoJS.lib.WordArray.random(8)</code> a <code>WordArray</code> with random 8 bytes is created and encoded as a hexadecimal string with a length of 16 bytes using <code>toString()</code>. This hexadecimal string is Utf8-encoded and is therefore identical in both codes. Nevertheless, the remarks on the IV in the comment are of course correct. </li>\n<li>The aes-js bug is possibly related to an identical bug in the outdated Python library <em>PyCrypto</em>, which is fixed in the successor <em>PyCryptodome</em> <a href=\"https://bugs.launchpad.net/pycrypto/+bug/503200\" rel=\"nofollow noreferrer\">[7]</a>. </li>\n<li>In <a href=\"https://crypto.stackexchange.com/questions/2476/cipher-feedback-mode\">[8]</a> the CFB mode is discussed, the 2nd answer focuses on the different CFB variants <a href=\"https://crypto.stackexchange.com/a/15032\">[9]</a>. </li>\n</ul>\n"}], "owner": {"reputation": 95, "user_id": 10438705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/448ef964bc1090e2a49cc8b4fac6ca2f?s=128&d=identicon&r=PG&f=1", "display_name": "Neha", "link": "https://stackoverflow.com/users/10438705/neha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 726, "favorite_count": 0, "accepted_answer_id": 59425873, "answer_count": 1, "score": 2, "last_activity_date": 1576847742, "creation_date": 1576790501, "question_id": 59417017, "link": "https://stackoverflow.com/questions/59417017/how-to-decrypt-a-ciphertext-in-go-which-is-encrypted-in-vuejs-using-aes-js-packa", "title": "How to decrypt a ciphertext in Go which is encrypted in vuejs using aes-js package", "body": "<p>Code in Vuejs - </p>\n\n<pre><code>var message = \"Hello World\"\nvar keyBytes = aesjs.utils.utf8.toBytes(\"akey123\")\nvar iv = CryptoJS.lib.WordArray.random(8).toString()\nvar ivBytes =  aesjs.utils.utf8.toBytes(iv)\nvar messageBytes = aesjs.utils.utf8.toBytes(message);\nvar aesCfb = new aesjs.ModeOfOperation.cfb(keyBytes, ivBytes);\nvar encryptedBytes = aesCfb.encrypt(messageBytes);\nvar encryptedHex = aesjs.utils.hex.fromBytes(encryptedBytes);\n</code></pre>\n\n<p>Data that I send to GO - <code>{\"iv\": iv, \"cipher\": encryptedHex}</code></p>\n\n<p>Code in GO</p>\n\n<pre><code>func DecryptCipher(iv, cipher string) {\n    key := []byte(\"akey123\")\n    iv := []byte(iv)\n    cipherText, _ := hex.DecodeString(cipher)\n\n    block, err := aes.NewCipher(key)\n    if err != nil {\n        log.Println(err)\n    }\n\n    cfb := cipher.NewCFBDecrypter(block, iv)\n    cfb.XORKeyStream(cipherText, cipherText)\n    fmt.Println(\"data\", string(cipherText))\n}\n</code></pre>\n\n<p>Expected Output: \"Hello World\"\nActual Output: @\ufffdSa 1\ufffd\ufffd\ufffdIg{\ufffd</p>\n\n<p>Can someone please help me and tell me what is it that I am missing in the code above.\nThank you in advance!</p>\n"}]