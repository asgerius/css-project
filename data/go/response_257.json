[{"tags": ["go", "cryptography", "pem", "ecdsa"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1576107035, "post_id": 59295606, "comment_id": 104795625, "body": "Use <a href=\"https://golang.org/pkg/crypto/x509/#MarshalPKIXPublicKey\" rel=\"nofollow noreferrer\">x509.MarshalPKIXPublicKey</a> and <a href=\"https://golang.org/pkg/encoding/pem/\" rel=\"nofollow noreferrer\">the encoding/pem package</a>."}], "answers": [{"comments": [{"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1576364493, "post_id": 59296879, "comment_id": 104877353, "body": "It&#39;s nice that you try and show code for the comment of Peter, but why then show the private key instead of the public key?"}], "tags": [], "owner": {"reputation": 1, "user_id": 6422939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FxLGT.png?s=128&g=1", "display_name": "Shellcheff", "link": "https://stackoverflow.com/users/6422939/shellcheff"}, "is_accepted": false, "score": -1, "last_activity_date": 1576117824, "creation_date": 1576117824, "answer_id": 59296879, "question_id": 59295606, "link": "https://stackoverflow.com/questions/59295606/how-to-convert-ecdsa-public-key-to-pem-files/59296879#59296879", "title": "How to convert ECDSA Public Key to PEM Files", "body": "<p>You can check  this functions </p>\n\n<p><a href=\"https://github.com/gtank/cryptopasta/blob/master/marshal.go\" rel=\"nofollow noreferrer\">https://github.com/gtank/cryptopasta/blob/master/marshal.go</a></p>\n\n<p>That seems to be encoding using pem\nSpecially here</p>\n\n<p>Using </p>\n\n<pre><code>import (\n\"crypto/ecdsa\"\n\"crypto/x509\"\n\"encoding/base64\"\n\"encoding/pem\"\n\"errors\"\n\"fmt\"\n)\n\n\n\n\n // EncodePrivateKey encodes an ECDSA private key to PEM format.\n  func EncodePrivateKey(key *ecdsa.PrivateKey) ([]byte, error) {\n     derKey, err := x509.MarshalECPrivateKey(key)\n          if err != nil {\n             return nil, err\n      }\n\n    keyBlock := &amp;pem.Block{\n    Type:  \"EC PRIVATE KEY\",\n    Bytes: derKey,\n}\n\nreturn pem.EncodeToMemory(keyBlock), nil\n}\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 6221255, "user_type": "registered", "profile_image": "https://graph.facebook.com/10205863862735003/picture?type=large", "display_name": "Trevor Aron", "link": "https://stackoverflow.com/users/6221255/trevor-aron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 700, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1576117824, "creation_date": 1576106658, "last_edit_date": 1576108260, "question_id": 59295606, "link": "https://stackoverflow.com/questions/59295606/how-to-convert-ecdsa-public-key-to-pem-files", "title": "How to convert ECDSA Public Key to PEM Files", "body": "<p>I'm using the golang ecdsa package: <a href=\"https://golang.org/pkg/crypto/ecdsa/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/crypto/ecdsa/</a></p>\n\n<p>I have public key structs (<a href=\"https://golang.org/pkg/crypto/ecdsa/#PublicKey\" rel=\"nofollow noreferrer\">https://golang.org/pkg/crypto/ecdsa/#PublicKey</a>) and I'm trying to convert them to PEM files for use in other application.</p>\n\n<p>Anyone know how to do this?</p>\n"}, {"tags": ["go", "struct", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1576102656, "post_id": 59294918, "comment_id": 104794321, "body": "You don&#39;t need to pass pointers to a channel. Pass the channel itself."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1576102749, "post_id": 59294918, "comment_id": 104794348, "body": "&quot;as UpdatePeople is writing to it in a separate go routine&quot; - UpdatePeople doesn&#39;t do anything with the channel. That&#39;s why the read operation blocks the main goroutine (there&#39;s nothing in the channel)"}], "answers": [{"comments": [{"owner": {"reputation": 173, "user_id": 12332609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d500467f5015deddf88133b9a0083c75?s=128&d=identicon&r=PG&f=1", "display_name": "David Walton", "link": "https://stackoverflow.com/users/12332609/david-walton"}, "edited": false, "score": 0, "creation_date": 1576104604, "post_id": 59295133, "comment_id": 104794932, "body": "Thank you icio.  That&#39;s so simple and elegant.  This make a lot of sense and almost works for my use case.   using your example, if I need to wrap the gofunc with FindPeople in a for loop, I think I end up with with a panic.  do I need to then make an slice of chans for each go routine ?"}, {"owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "reply_to_user": {"reputation": 173, "user_id": 12332609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d500467f5015deddf88133b9a0083c75?s=128&d=identicon&r=PG&f=1", "display_name": "David Walton", "link": "https://stackoverflow.com/users/12332609/david-walton"}, "edited": false, "score": 0, "creation_date": 1576106059, "post_id": 59295133, "comment_id": 104795373, "body": "Yes, if you try to close the channel multiple times the program will panic. If you want to launch multiple independent FindPeople, we need to wait for them all to complete before closing our chan people. We can use a sync.WaitGroup for this as so: <a href=\"https://play.golang.org/p/0aZPqhZ9W0O\" rel=\"nofollow noreferrer\">play.golang.org/p/0aZPqhZ9W0O</a>"}, {"owner": {"reputation": 173, "user_id": 12332609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d500467f5015deddf88133b9a0083c75?s=128&d=identicon&r=PG&f=1", "display_name": "David Walton", "link": "https://stackoverflow.com/users/12332609/david-walton"}, "edited": false, "score": 0, "creation_date": 1576109381, "post_id": 59295133, "comment_id": 104796199, "body": "wow thanks that really helps me &quot;get it&quot; :-)   Finally..would it be crazy to then want to put WritePerson(p) into a go routine as well ? ultimately i&#39;m looking for speed plus the ability to run both those as go routines in the background but Im not sure if that&#39;s the right way to do things."}, {"owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "reply_to_user": {"reputation": 173, "user_id": 12332609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d500467f5015deddf88133b9a0083c75?s=128&d=identicon&r=PG&f=1", "display_name": "David Walton", "link": "https://stackoverflow.com/users/12332609/david-walton"}, "edited": false, "score": 1, "creation_date": 1576450995, "post_id": 59295133, "comment_id": 104893642, "body": "You could, but its not guaranteed to make things faster. If you&#39;re writing to a database, a good starting point might be to think about how many concurrent writes your system would support - perhaps related to the number of connections your process can open to the server. My last example would be a single concurrent write per process. If we were to support up to 3 writes simultaneously we might use the same worker pattern as we did for the finders: <a href=\"https://play.golang.org/p/B8eOzko2Pb2\" rel=\"nofollow noreferrer\">play.golang.org/p/B8eOzko2Pb2</a>"}], "tags": [], "owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "is_accepted": false, "score": 1, "last_activity_date": 1576103558, "creation_date": 1576103558, "answer_id": 59295133, "question_id": 59294918, "link": "https://stackoverflow.com/questions/59294918/golang-pass-struct-between-two-goroutines-concurrently/59295133#59295133", "title": "golang pass struct between two goroutines concurrently", "body": "<p>As Sergio pointed out, the Main goroutine is blocking because its waiting read from the psns channel, but nothing is writing to it. There's a good piece of advice when writing Go to only write synchronous functions, and another that the function responsible for creating a channel controls when it is closed. As such, I've restructured what you wrote a little with these in mind: <a href=\"https://play.golang.org/p/vicGN40pGVQ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vicGN40pGVQ</a>. This program will slowly find Person objects, send them over the channel, and write each Person as it goes. Let us know if your use-case differs :) Hope that helps.</p>\n"}], "owner": {"reputation": 173, "user_id": 12332609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d500467f5015deddf88133b9a0083c75?s=128&d=identicon&r=PG&f=1", "display_name": "David Walton", "link": "https://stackoverflow.com/users/12332609/david-walton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1022, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576103558, "creation_date": 1576102427, "question_id": 59294918, "link": "https://stackoverflow.com/questions/59294918/golang-pass-struct-between-two-goroutines-concurrently", "title": "golang pass struct between two goroutines concurrently", "body": "<p>I have two functions, What I would like to do is have a channel outside these two functions and have the first run in a go routine and update the channel and then the second function should read the items in the channel as they come in and do something else. When all the items in the channel are finished the go routines should exit gracefully </p>\n\n<p>Could someone ELI5 how I can get two go routines reading from the same channel ? is that even possible ? </p>\n\n<p>Something like the below...</p>\n\n<pre><code>\npackage main\n\nimport (\n    \"fmt\"\n)\n\ntype Person struct {\n    index int\n    name  string\n    age   int\n}\n\nfunc UpdatePeople(psn *chan Person, grNo int) {\n\n    for i := 0; i &lt; 5; i++ {\n        psn := Person{\n            index: 1,\n            name:  \"Shaun\",\n            age:   23,\n        }\n        fmt.Printf(\"Person: %v --- GoRoutineNumber: %v\\n\", psn, grNo)\n    }\n\n}\n\nfunc WritePeople(psn *chan Person) {\n\n    for i := 0; i &lt; 5; i++ {\n        psn := Person{\n            index: 1,\n            name:  \"Shaun\",\n            age:   23,\n        }\n        fmt.Println(\"Writing People to DB\", psn)\n    }\n\n}\n\nfunc main() {\n\n    //make channel of Person struct\n    psnChan := make(chan Person)\n\n    //I have a variable length in my program so lets say it's 6 in this case\n\n    for i := 0; i &lt; 6; i++ {\n\n        /// I want to start a go routine here that writes to pointer of psnChan\n        go UpdatePeople(&amp;psnChan, i)\n\n    }\n\n    // I then want to read in from the channel as UpdatePeople is writing to it in a separate go routine\n    for {\n\n        _, received := &lt;-psnChan\n        if received == false {\n            fmt.Println(\"Break out of 2nd loop\")\n            close(psnChan)\n            break\n        } else {\n\n          go    WritePeople(&amp;psnChan)\n\n        }\n\n    }\n    fmt.Println(\"Finished\")\n}\n\n\n\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ExJf3lY0VV8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ExJf3lY0VV8</a></p>\n\n<p>The above deadlocks but is the simplest way I can explain without pasting in a lot of code. </p>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 0, "creation_date": 1576103045, "post_id": 59294893, "comment_id": 104794455, "body": "what does upgrader.Upgrade() do?"}, {"owner": {"reputation": 11, "user_id": 12521121, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-5_jaaHK8OIw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reU5ykNBK4ZQX-mvefij9rdBL1mWg/photo.jpg?sz=128", "display_name": "Norman Stale", "link": "https://stackoverflow.com/users/12521121/norman-stale"}, "reply_to_user": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 0, "creation_date": 1576103384, "post_id": 59294893, "comment_id": 104794559, "body": "&quot;The Upgrader.Upgrade method upgrades the HTTP server connection to the WebSocket protocol as described in the WebSocket RFC. A summary of the process is this: The client sends an HTTP request requesting that the server upgrade the connection used for the HTTP request to the WebSocket protocol. The server inspects the request and if all is good the server sends an HTTP response agreeing to upgrade the connection. From that point on, the client and server use the WebSocket protocol over the network connection.&quot;"}, {"owner": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 0, "creation_date": 1576104047, "post_id": 59294893, "comment_id": 104794771, "body": "is there more error output? Are you sure you&#39;re calling this endpoint with a websocket connection?"}, {"owner": {"reputation": 11, "user_id": 12521121, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-5_jaaHK8OIw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reU5ykNBK4ZQX-mvefij9rdBL1mWg/photo.jpg?sz=128", "display_name": "Norman Stale", "link": "https://stackoverflow.com/users/12521121/norman-stale"}, "reply_to_user": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 0, "creation_date": 1576104231, "post_id": 59294893, "comment_id": 104794823, "body": "Full Error: <a href=\"https://hastebin.com/bidegadaze.coffeescript\" rel=\"nofollow noreferrer\">hastebin.com/bidegadaze.coffeescript</a> (To long to comment)  Index.html: <a href=\"https://hastebin.com/uholerigep.coffeescript\" rel=\"nofollow noreferrer\">hastebin.com/uholerigep.coffeescript</a>  Main.go: <a href=\"https://hastebin.com/gopakolofu.cpp\" rel=\"nofollow noreferrer\">hastebin.com/gopakolofu.cpp</a>"}, {"owner": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 0, "creation_date": 1576104265, "post_id": 59294893, "comment_id": 104794836, "body": "...if you don&#39;t call the endpoint with a websocket the Upgrade() will return an error and the ws will be nil. You then use ws in the reader, which will fail because it&#39;s nil"}, {"owner": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 0, "creation_date": 1576104320, "post_id": 59294893, "comment_id": 104794849, "body": "the error you posted describes it exactly &quot;websocket: the client is not using the websocket protocol: &#39;upgrade&#39; token not found in &#39;Connection&#39; header&quot; the nil pointer is just the result of using the ws variable which is nil"}, {"owner": {"reputation": 11, "user_id": 12521121, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-5_jaaHK8OIw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reU5ykNBK4ZQX-mvefij9rdBL1mWg/photo.jpg?sz=128", "display_name": "Norman Stale", "link": "https://stackoverflow.com/users/12521121/norman-stale"}, "reply_to_user": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 0, "creation_date": 1576104404, "post_id": 59294893, "comment_id": 104794873, "body": "I was just visiting the page normally from GET, shouldn&#39;t it open a websocket after opening the page or am I mistaken"}, {"owner": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 0, "creation_date": 1576104742, "post_id": 59294893, "comment_id": 104794976, "body": "you should try the example client/server from gorilla, I don&#39;t know too much about websockets though <a href=\"https://github.com/gorilla/websocket/tree/master/examples/echo\" rel=\"nofollow noreferrer\">github.com/gorilla/websocket/tree/master/examples/echo</a>"}, {"owner": {"reputation": 11, "user_id": 12521121, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-5_jaaHK8OIw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reU5ykNBK4ZQX-mvefij9rdBL1mWg/photo.jpg?sz=128", "display_name": "Norman Stale", "link": "https://stackoverflow.com/users/12521121/norman-stale"}, "reply_to_user": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 0, "creation_date": 1576105045, "post_id": 59294893, "comment_id": 104795066, "body": "I&#39;ll look into it, thanks!"}], "owner": {"reputation": 11, "user_id": 12521121, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-5_jaaHK8OIw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reU5ykNBK4ZQX-mvefij9rdBL1mWg/photo.jpg?sz=128", "display_name": "Norman Stale", "link": "https://stackoverflow.com/users/12521121/norman-stale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 126, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1576102318, "creation_date": 1576102318, "question_id": 59294893, "link": "https://stackoverflow.com/questions/59294893/runtime-error-while-trying-to-connect-to-websocket-with-the-gorilla-library", "title": "Runtime error while trying to connect to websocket with the gorilla library", "body": "<p>I'm working with Gorilla Websocket however I get this error, it occurs after trying to visit the websocket page from localhost</p>\n\n<p>Also gives ERR_EMPTY_RESPONSE when trying to visit the page</p>\n\n<p>If more information is needed let me know, as its my first time posting :)</p>\n\n<p><strong>Error</strong></p>\n\n<pre><code>2019/12/11 16:41:35 Client Connected...\n2019/12/11 16:41:35 http: panic serving [::1]:37714: runtime error: invalid memory address or nil pointer dereference\ngoroutine 4 [running]:\nnet/http.(*conn).serve.func1(0xc420018820)\n        /opt/go/src/net/http/server.go:1721 +0xd0\npanic(0x65f180, 0x7e3280)\n        /opt/go/src/runtime/panic.go:489 +0x2cf\ngithub.com/gorilla/websocket.(*Conn).NextReader(0x0, 0xc42008a0f0, 0xc42001a6c0, 0x28, 0x40, 0x28)\n        /opt/gopkg/src/github.com/gorilla/websocket/conn.go:971 +0x26\ngithub.com/gorilla/websocket.(*Conn).ReadMessage(0x0, 0xc4200c2680, 0x14, 0x28, 0x40, 0x7ecca0, 0x14)\n        /opt/gopkg/src/github.com/gorilla/websocket/conn.go:1064 +0x2f\nmain.reader(0x0)\n        /home/go/api/main2.go:23 +0x40\nmain.wsEndpoint(0x7c0ec0, 0xc4200e4000, 0xc42000a800)\n        /home/go/api/main2.go:45 +0xeb\n</code></pre>\n\n<p><strong>Go Code</strong></p>\n\n<pre><code>var upgrader = websocket.Upgrader{\n    ReadBufferSize: 1024,\n    WriteBufferSize: 1024,\n    CheckOrigin: func(r *http.Request) bool { return true },\n}\n\nfunc homePage(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Home Page\")\n}\n\nfunc reader(conn *websocket.Conn) {\n    for {\n        messageType, p, err := conn.ReadMessage()\n        if err != nil {\n            log.Println(err)\n            return\n        }\n        log.Println(string(p))\n\n        if err := conn.WriteMessage(messageType, p); err != nil {\n            log.Println(err)\n        }\n    }\n}\n\nfunc wsEndpoint(w http.ResponseWriter, r *http.Request) {\n\n    ws, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        log.Println(err)\n    }\n\n    log.Println(\"Client Connected...\")\n\n    reader(ws)\n\n}\n\nfunc setupRoutes() {\n    http.HandleFunc(\"/\", homePage)\n    http.HandleFunc(\"/ws\", wsEndpoint)\n}\n\nfunc main() {\n    fmt.Println(\"Websocket server started\")\n    setupRoutes()\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n"}, {"tags": ["go", "thread-safety", "mutex", "race-condition", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 1157, "user_id": 2653567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/RNYoa.png?s=128&g=1", "display_name": "HMLDude", "link": "https://stackoverflow.com/users/2653567/hmldude"}, "edited": false, "score": 0, "creation_date": 1576135137, "post_id": 59294979, "comment_id": 104802265, "body": "Here is a link to a question on the syntax issue I&#39;m currently facing. <a href=\"https://stackoverflow.com/questions/59299470/working-with-slices-and-golang-sync-map-structure\" title=\"working with slices and golang sync map structure\">stackoverflow.com/questions/59299470/&hellip;</a>"}, {"owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "reply_to_user": {"reputation": 1157, "user_id": 2653567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/RNYoa.png?s=128&g=1", "display_name": "HMLDude", "link": "https://stackoverflow.com/users/2653567/hmldude"}, "edited": false, "score": 0, "creation_date": 1576451322, "post_id": 59294979, "comment_id": 104893703, "body": "If my post solves your syntax problems, then please accept the answer and I will look at your next question."}], "tags": [], "owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "is_accepted": true, "score": 8, "last_activity_date": 1576102776, "creation_date": 1576102776, "answer_id": 59294979, "question_id": 59294816, "link": "https://stackoverflow.com/questions/59294816/converting-standard-golang-map-into-a-sync-map-to-avoid-race-condition/59294979#59294979", "title": "Converting Standard Golang Map into a Sync.Map to Avoid Race Condition", "body": "<p><a href=\"https://pkg.go.dev/sync?tab=doc#Map\" rel=\"noreferrer\"><code>sync.Map</code></a> is not a Go <code>map</code>, and so you cannot using the <code>a_map[\"key\"]</code> syntax with it. Rather, it is a <code>struct</code> with methods providing the usual map operations. The syntax for using it is:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var m sync.Map\nm.Store(\"example\", []int{1, 2, 3})\nfmt.Println(m.Load(\"example\")) // [1 2 3] true\n</code></pre>\n\n<p>-- <a href=\"https://play.golang.org/p/7rbEG_x0mrC\" rel=\"noreferrer\">https://play.golang.org/p/7rbEG_x0mrC</a></p>\n\n<p>Depending on the source of your concurrency, you may require similar synchronisation of the []int values under each key, which sync.Map will not give you. sync.Map only provides load/store synchronisation per key. Drop a comment if so, and we can try to help you out further.</p>\n"}], "owner": {"reputation": 1157, "user_id": 2653567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/RNYoa.png?s=128&g=1", "display_name": "HMLDude", "link": "https://stackoverflow.com/users/2653567/hmldude"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4107, "favorite_count": 0, "accepted_answer_id": 59294979, "answer_count": 1, "score": 1, "last_activity_date": 1576102776, "creation_date": 1576101974, "question_id": 59294816, "link": "https://stackoverflow.com/questions/59294816/converting-standard-golang-map-into-a-sync-map-to-avoid-race-condition", "title": "Converting Standard Golang Map into a Sync.Map to Avoid Race Condition", "body": "<p>I have the following line of code:</p>\n\n<pre><code>var a_map = make(map[string] []int)\n</code></pre>\n\n<p>Part of my code, which is utilizing the a_map variable occasionally throws the following error:</p>\n\n<pre><code>fatal error: concurrent map read and map write\n</code></pre>\n\n<p>In an attempt to create a more robust solution, one that is free from such an error, I would like to use a sync.Map as opposed to a generic map. I was inspired to do so by the only answer provided to this stack overflow <a href=\"https://stackoverflow.com/questions/45585589/golang-fatal-error-concurrent-map-read-and-map-write\">question</a>. However, I am unclear as to the proper syntax for doing so.</p>\n\n<p>For my first attempt I utilized the following line of code:</p>\n\n<pre><code>var a_map = make(sync.Map[string] []int)\n</code></pre>\n\n<p>Which resulted in the following error:</p>\n\n<pre><code>...syntax error: unexpected ], expecting expression\n</code></pre>\n\n<p>Then I tried:</p>\n\n<pre><code> sync_map := new(sync.Map)\n var a_map = make(sync_map[string] []int)\n</code></pre>\n\n<p>Which resulted in the same error:</p>\n\n<pre><code>...syntax error: unexpected ], expecting expression\n</code></pre>\n"}, {"tags": ["windows", "go", "testing", "compilation"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1576102025, "post_id": 59294439, "comment_id": 104794118, "body": "Hard to say without the actual code..."}, {"owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "edited": false, "score": 0, "creation_date": 1576104053, "post_id": 59294439, "comment_id": 104794772, "body": "Does your test import the apimonitor package? <code>go test -count 1</code> is the canonical way to re-run cached tests."}, {"owner": {"reputation": 9, "user_id": 6543666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3bfa01001e2c4488b83cb22a29fdccb?s=128&d=identicon&r=PG&f=1", "display_name": "Fotis Louk", "link": "https://stackoverflow.com/users/6543666/fotis-louk"}, "reply_to_user": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "edited": false, "score": 0, "creation_date": 1576138459, "post_id": 59294439, "comment_id": 104803518, "body": "@icio apimonitor is my main package."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1576107286, "last_edit_date": 1576107286, "creation_date": 1576106177, "answer_id": 59295545, "question_id": 59294439, "link": "https://stackoverflow.com/questions/59294439/go-test-compiles-successfully-but-go-build-doesnt/59295545#59295545", "title": "Go test compiles successfully, but go build doesn&#39;t", "body": "<blockquote>\n  <p><a href=\"https://golang.org/cmd/go/\" rel=\"nofollow noreferrer\">Command go</a></p>\n  \n  <p><a href=\"https://golang.org/cmd/go/#hdr-Compile_packages_and_dependencies\" rel=\"nofollow noreferrer\">Compile packages and dependencies</a></p>\n  \n  <p>The build flags are shared by the build, clean, get, install, list,\n  run, and test commands: </p>\n\n<pre><code>-a\n  force rebuilding of packages that are already up-to-date.\n-n\n  print the commands but do not run them.\n-v\n  print the names of packages as they are compiled.\n-x\n  print the commands.\n</code></pre>\n  \n  <p><a href=\"https://golang.org/cmd/go/#hdr-Remove_object_files_and_cached_files\" rel=\"nofollow noreferrer\">Remove object files and cached files</a></p>\n  \n  <p>Usage:</p>\n\n<pre><code>go clean [clean flags] [build flags] [packages]\n</code></pre>\n  \n  <p>The <code>-cache</code> flag causes clean to remove the entire go build cache.</p>\n  \n  <p>The <code>-testcache</code> flag causes clean to expire all test results in the go\n  build cache.</p>\n  \n  <p><a href=\"https://golang.org/cmd/go/#hdr-Testing_flags\" rel=\"nofollow noreferrer\">Testing flags</a></p>\n  \n  <p>When '<code>go test</code>' runs in package list mode, '<code>go test</code>' caches successful\n  package test results to avoid unnecessary repeated running of tests.\n  To disable test caching, use any test flag or argument other than the\n  cacheable flags. The idiomatic way to disable test caching explicitly\n  is to use <code>-count=1</code>.</p>\n</blockquote>\n"}], "owner": {"reputation": 9, "user_id": 6543666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3bfa01001e2c4488b83cb22a29fdccb?s=128&d=identicon&r=PG&f=1", "display_name": "Fotis Louk", "link": "https://stackoverflow.com/users/6543666/fotis-louk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1576138765, "creation_date": 1576100070, "last_edit_date": 1576138765, "question_id": 59294439, "link": "https://stackoverflow.com/questions/59294439/go-test-compiles-successfully-but-go-build-doesnt", "title": "Go test compiles successfully, but go build doesn&#39;t", "body": "<p>I am trying to test a main package in go (in Windows) and the test seems to be cached, although I delete completely the cache (<code>go clean -cache</code>).</p>\n\n<p>To test this I changed a file (<code>parseinput.go</code>), so that it produces an error during compilation (undefined variable). The result is, that main package cannot be built:</p>\n\n<pre><code>go\\src\\xxx\\apimonitor&gt; go build\n# xxx/apimonitor\n.\\inputparser.go:15:2: undefined: err\n.\\inputparser.go:16:19: undefined: err\n</code></pre>\n\n<p>,but tests still complete successfully (<code>go test</code> or even <code>go test -a</code>):</p>\n\n<pre><code>go\\src\\xxx\\apimonitor&gt; go test\nPASS\nok      xxx/apimonitor  0.786s\n</code></pre>\n\n<p>Any clues as to why this keeps happening and why test does not recompile? Any other place where this package might be cached from previous builds?</p>\n\n<hr>\n\n<p><strong>Update</strong></p>\n\n<p>After adding some print statements, it seems that test (<code>go test</code>) compiles <strong>successfully</strong> <code>inputparser.go</code> (despite that <code>err</code> variable is undefined), but build fails (as depicted above). That's what led me to believe that test was cached. Here is a sample of the source that fails in build:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func parseStoreInput(strArray []string) (inputStoreTransactionHash, error) {\n    var parsedIn inputStoreTransactionHash\n    if !validateInput(strArray, 1, true) {\n        return parsedIn, errors.New(\"Expecting an escaped JSON string as input\")\n    }\n    err = json.Unmarshal([]byte(strArray[0]), &amp;parsedIn)\n    return parsedIn, err\n}\n</code></pre>\n\n<p>Any clues/documentation as to why this might be happening?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576099497, "post_id": 59294175, "comment_id": 104793194, "body": "Possible bug in that library? Have you contacted the library&#39;s author(s)?"}, {"owner": {"reputation": 45, "user_id": 1180321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f131cd1eb5c33b707a4f14a489101725?s=128&d=identicon&r=PG", "display_name": "killerx", "link": "https://stackoverflow.com/users/1180321/killerx"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576173833, "post_id": 59294175, "comment_id": 104822949, "body": "Not yet, I assumed it might be related to some bug in my code. The authors are Go lang authors, will open an issue on github"}], "owner": {"reputation": 45, "user_id": 1180321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f131cd1eb5c33b707a4f14a489101725?s=128&d=identicon&r=PG", "display_name": "killerx", "link": "https://stackoverflow.com/users/1180321/killerx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576099021, "creation_date": 1576098829, "last_edit_date": 1576099021, "question_id": 59294175, "link": "https://stackoverflow.com/questions/59294175/golang-org-x-exp-shiny-screen-weird-transition-when-uploading-scaled-texture-in", "title": "golang.org/x/exp/shiny/screen: Weird transition when uploading scaled texture in Ubuntu and macOS", "body": "<p>I am trying to write a CHIP-8 emulator in Go using <code>golang.org/x/shiny/screen</code> for displaying video buffer onto the screen. </p>\n\n<p>The original resolution of the emulator screen is 32x64 pixels. So, I enlarge the graphical view of the emulator screen by scaling the existing buffer by some factor and then publishing it on the screen. </p>\n\n<p>Here's the code snippet for the same:</p>\n\n<pre><code>case paint.Event:\n            log.Print(\"Paint event, re-painting the buffer..\")\n\n            tex, _ := s.NewTexture(dim)\n            defer tex.Release()\n\n            tex.Upload(image.Point{}, drawBuff, drawBuff.Bounds())\n\n            scaledDim := image.Rectangle{\n                image.Point{0, 0},\n                image.Point{EmuWidth * EmuScale, EmuHeight * EmuScale}}\n\n            window.Scale(scaledDim, tex, drawBuff.Bounds(), draw.Over, &amp;screen.DrawOptions{})\n            window.Publish()\n</code></pre>\n\n<p>Problem: This code works as intended on Windows but behaves weirdly on Ubuntu and macOS (gifs attached).</p>\n\n<p><a href=\"https://i.stack.imgur.com/1iMZc.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/1iMZc.gif\" alt=\"on windows\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/cf2kf.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/cf2kf.gif\" alt=\"on Ubuntu\"></a></p>\n"}, {"tags": ["go", "google-bigquery"], "comments": [{"owner": {"reputation": 115571, "user_id": 5221944, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/iqXab.png?s=128&g=1", "display_name": "Mikhail Berlyant", "link": "https://stackoverflow.com/users/5221944/mikhail-berlyant"}, "edited": false, "score": 2, "creation_date": 1576097466, "post_id": 59293704, "comment_id": 104792376, "body": "have you tried &quot;type Client struct {Client_ID string `json:&quot;client_id&quot;`}&quot; instead of &quot;&quot;type Client struct {ClientID string `json:&quot;client_id&quot;`}&quot;&quot;  ? i think the problem was in selecting client_id while field in struct is ClientID"}, {"owner": {"reputation": 71, "user_id": 1660694, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GAhHi.jpg?s=128&g=1", "display_name": "thenamewasmilo", "link": "https://stackoverflow.com/users/1660694/thenamewasmilo"}, "reply_to_user": {"reputation": 115571, "user_id": 5221944, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/iqXab.png?s=128&g=1", "display_name": "Mikhail Berlyant", "link": "https://stackoverflow.com/users/5221944/mikhail-berlyant"}, "edited": false, "score": 0, "creation_date": 1576098092, "post_id": 59293704, "comment_id": 104792626, "body": "Interesting, will try that now... I don&#39;t think this was the case though in MySQL."}], "owner": {"reputation": 71, "user_id": 1660694, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GAhHi.jpg?s=128&g=1", "display_name": "thenamewasmilo", "link": "https://stackoverflow.com/users/1660694/thenamewasmilo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576096628, "creation_date": 1576096628, "question_id": 59293704, "link": "https://stackoverflow.com/questions/59293704/weird-behavior-with-bigquery-and-go", "title": "Weird behavior with BigQuery and Go?", "body": "<p>So I am doing a pretty simple query:</p>\n\n<pre><code>SELECT client_id FROM clients\n</code></pre>\n\n<p>And loading the results in a struct:</p>\n\n<pre><code>type Client struct {\n  ClientID string `json:\"client_id\"`\n}\n</code></pre>\n\n<p>However ClientID is never assigned.</p>\n\n<p>If I change things to:</p>\n\n<pre><code>SELECT client_id AS client FROM clients\n\ntype Client struct {\n  Client string `json:\"client\"`\n}\n</code></pre>\n\n<p>Client will be assigned.</p>\n\n<p>Why?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1576100809, "post_id": 59293655, "comment_id": 104793726, "body": "It seems like you can use collection.<a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo#Collection.InsertMany\" rel=\"nofollow noreferrer\"><code>InsertMany</code></a> (instead of InsertOne) to insert multible documents. Instead of using the parameter <code>o</code>, you would need to give it <code>o.Orders</code>"}, {"owner": {"reputation": 526, "user_id": 10938976, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ca1cAmQBhz0/AAAAAAAAAAI/AAAAAAAAADY/lNE8E2NmHk8/photo.jpg?sz=128", "display_name": "Raf Rasenberg", "link": "https://stackoverflow.com/users/10938976/raf-rasenberg"}, "reply_to_user": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1576130262, "post_id": 59293655, "comment_id": 104800605, "body": "I tried this but I can not give <code>o.Orders</code> parameter. Golang says: <code>cannot use o.Orders type ....... as type []interface {} in argument to collection.InsertManygo</code>. What could be the problem?"}, {"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1576172112, "post_id": 59293655, "comment_id": 104822163, "body": "You will need to convert the types manually, as casting also doesn&#39;t work in this case. <a href=\"https://play.golang.org/p/LnzX_nJEewq\" rel=\"nofollow noreferrer\">Here</a> is an example on how to do it, replace <code>values</code> with <code>o.Orders</code>"}], "owner": {"reputation": 526, "user_id": 10938976, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ca1cAmQBhz0/AAAAAAAAAAI/AAAAAAAAADY/lNE8E2NmHk8/photo.jpg?sz=128", "display_name": "Raf Rasenberg", "link": "https://stackoverflow.com/users/10938976/raf-rasenberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 23, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576096448, "creation_date": 1576096448, "question_id": 59293655, "link": "https://stackoverflow.com/questions/59293655/how-to-save-multi-json-api-response-to-mongodb-using-golang", "title": "How to save multi JSON API response to MongoDB using Golang", "body": "<p>I am fetching data from an api which comes in this format (10+ individual orders):</p>\n\n<pre><code>{\n    \"orders\": [\n        {\n            \"orderId\": \"2738183220\",\n            \"dateTimeOrderPlaced\": \"2019-12-11T20:19:19+01:00\",\n            \"orderItems\": [\n                {\n                    \"orderItemId\": \"BFC0000347027892\",\n                    \"ean\": \"8720165489992\",\n                    \"cancelRequest\": false,\n                    \"quantity\": 1\n                }\n            ]\n        },\n        {\n            \"orderId\": \"2737526230\",\n            \"dateTimeOrderPlaced\": \"2019-12-11T17:18:42+01:00\",\n            \"orderItems\": [\n                {\n                    \"orderItemId\": \"BFC0000346926381\",\n                    \"ean\": \"8719326639581\",\n                    \"cancelRequest\": false,\n                    \"quantity\": 1\n                }\n            ]\n        }\n    ]\n}\n</code></pre>\n\n<p>I have this struct for that:</p>\n\n<pre><code>type OpenOrder struct {\n    Orders []struct {\n        OrderID             string    `json:\"orderId\"`\n        DateTimeOrderPlaced time.Time `json:\"dateTimeOrderPlaced\"`\n        OrderItems          []struct {\n            OrderItemID   string `json:\"orderItemId\"`\n            Ean           string `json:\"ean\"`\n            CancelRequest bool   `json:\"cancelRequest\"`\n            Quantity      int    `json:\"quantity\"`\n        } `json:\"orderItems\"`\n    } `json:\"orders\"`\n}\n</code></pre>\n\n<p>But I am confused after looking at this for too long. How can I save this into MongoDB with Golang where so it will get saved as single documents? So one document is:</p>\n\n<pre><code>{\n            \"orderId\": \"2738183220\",\n            \"dateTimeOrderPlaced\": \"2019-12-11T20:19:19+01:00\",\n            \"orderItems\": [\n                {\n                    \"orderItemId\": \"BFC0000347027892\",\n                    \"ean\": \"8720165489992\",\n                    \"cancelRequest\": false,\n                    \"quantity\": 1\n                }\n            ]\n}\n</code></pre>\n\n<p>I wrote this code:</p>\n\n<pre><code>func GetOpenOrder(x string) {\n\n    apiURL := \"https://api.bol.com/retailer/orders?fulfilment-method=\" + x\n\n    req, err := http.NewRequest(\"GET\", apiURL, nil)\n    req.Header.Add(\"Authorization\", \"Bearer \"+auth.GetToken())\n    req.Header.Add(\"Accept\", \"application/vnd.retailer.v3+json\")\n\n    client := &amp;http.Client{}\n    resp, err := client.Do(req)\n    if err != nil {\n        panic(err)\n    }\n\n    // Read the response body\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    err = json.Unmarshal(body, &amp;o)\n    if err != nil {\n        fmt.Println(string(body))\n    }\n\n    c := auth.GetClient()\n    collection := c.Database(\"goprac\").Collection(\"openorders\")\n    ctx, _ := context.WithTimeout(context.Background(), 5*time.Second)\n    result, _ := collection.InsertOne(ctx, o)\n    fmt.Println(result)\n\n}\n</code></pre>\n\n<p>But right now the whole JSON response gets saved in one document. Can someone please point me in the correct direction? I have been searching SO for the last hour and found some similar questions, but still did not get the answer.</p>\n"}, {"tags": ["string", "go", "uppercase", "lowercase"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1576095943, "post_id": 59293525, "comment_id": 104791752, "body": "Use <code>strings.ToUpper&#47;Lower</code> and compare the output to the input."}], "answers": [{"comments": [{"owner": {"reputation": 2186, "user_id": 4143840, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7f2e835583e38a4f4c69f6f947496410?s=128&d=identicon&r=PG&f=1", "display_name": "jersey bean", "link": "https://stackoverflow.com/users/4143840/jersey-bean"}, "edited": false, "score": 0, "creation_date": 1576184862, "post_id": 59293612, "comment_id": 104827293, "body": "See my comment to @JimB solution.  Its more efficient than this solution."}], "tags": [], "owner": {"reputation": 2186, "user_id": 4143840, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7f2e835583e38a4f4c69f6f947496410?s=128&d=identicon&r=PG&f=1", "display_name": "jersey bean", "link": "https://stackoverflow.com/users/4143840/jersey-bean"}, "is_accepted": false, "score": 7, "last_activity_date": 1576096196, "creation_date": 1576096196, "answer_id": 59293612, "question_id": 59293525, "link": "https://stackoverflow.com/questions/59293525/how-to-check-if-a-string-is-all-upper-or-lower-case-in-go/59293612#59293612", "title": "How to check if a string is all upper or lower case in Go?", "body": "<p>One solution is to use strings.ToUpper()/ToLower() and compare with the original string.  This works for the punctuation case as well.  </p>\n\n<p>Here's the solution:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    s := \"UPPERCASE\"\n    fmt.Println(strings.ToUpper(s) == s)\n\n    s = \"lowercase\"\n    fmt.Println(strings.ToUpper(s) == s)\n\n    s = \"lowercase\"\n    fmt.Println(strings.ToLower(s) == s)\n\n    s = \"I'M YELLING AT YOU!\"\n    fmt.Println(strings.ToUpper(s) == s)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2186, "user_id": 4143840, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7f2e835583e38a4f4c69f6f947496410?s=128&d=identicon&r=PG&f=1", "display_name": "jersey bean", "link": "https://stackoverflow.com/users/4143840/jersey-bean"}, "edited": false, "score": 0, "creation_date": 1576184813, "post_id": 59293875, "comment_id": 104827278, "body": "So I guess I&#39;ll state the obvious.  I think your point is that using strings.ToUpper is a O(n) operation and is costly for really long strings (as n grows large).  So your solution uses unicode.IsUpper and will short circuit as soon as your find a character which is not upper case.  Good answer!"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 16, "last_activity_date": 1576097469, "creation_date": 1576097469, "answer_id": 59293875, "question_id": 59293525, "link": "https://stackoverflow.com/questions/59293525/how-to-check-if-a-string-is-all-upper-or-lower-case-in-go/59293875#59293875", "title": "How to check if a string is all upper or lower case in Go?", "body": "<p>You can of course compare the upper and lower cased strings in their entirety, or you can short-circuit the comparisons on the first failure, which would be more efficient when comparing long strings. </p>\n\n<pre><code>func IsUpper(s string) bool {\n    for _, r := range s {\n        if !unicode.IsUpper(r) &amp;&amp; unicode.IsLetter(r) {\n            return false\n        }\n    }\n    return true\n}\n\nfunc IsLower(s string) bool {\n    for _, r := range s {\n        if !unicode.IsLower(r) &amp;&amp; unicode.IsLetter(r) {\n            return false\n        }\n    }\n    return true\n}\n</code></pre>\n"}], "owner": {"reputation": 2186, "user_id": 4143840, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7f2e835583e38a4f4c69f6f947496410?s=128&d=identicon&r=PG&f=1", "display_name": "jersey bean", "link": "https://stackoverflow.com/users/4143840/jersey-bean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7090, "favorite_count": 3, "accepted_answer_id": 59293875, "answer_count": 2, "score": 7, "last_activity_date": 1601758495, "creation_date": 1576095868, "last_edit_date": 1576095998, "question_id": 59293525, "link": "https://stackoverflow.com/questions/59293525/how-to-check-if-a-string-is-all-upper-or-lower-case-in-go", "title": "How to check if a string is all upper or lower case in Go?", "body": "<p>What is an easy way in Golang to check if all characters in a string are upper case or lower case?  </p>\n\n<p>Also, how to handle a case where the string has punctuation?</p>\n\n<p>See these examples:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unicode\"\n)\n\nfunc main() {\n    s := \"UPPERCASE\"\n    fmt.Println(s.IsUpper())  // Should print true\n\n    s = \"lowercase\"\n    fmt.Println(s.IsUpper())  // Should print false\n\n    s = \"lowercase\"\n    fmt.Println(s.IsLower())  // Should print true\n\n    s = \"I'M YELLING AT YOU!\"\n    fmt.Println(s.IsUpper())  // Should print true\n}\n</code></pre>\n\n<p>Note: s.IsUpper() and s.IsLower() doesn't really exist, but would be nice to find an equivalent.  </p>\n"}, {"tags": ["linux", "go", "vim"], "answers": [{"comments": [{"owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "edited": false, "score": 0, "creation_date": 1576092359, "post_id": 59292645, "comment_id": 104790140, "body": "Thank you very much. Will you show how you retrieved that help text with options? Also, what exactly is <code>syntax&#47;go.vim</code>? Is it a Vim source file that was compiled into the final executable or?"}, {"owner": {"reputation": 305833, "user_id": 68587, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7d9fd158e03cbde94f7e0b33b78222af?s=128&d=identicon&r=PG", "display_name": "John Kugelman", "link": "https://stackoverflow.com/users/68587/john-kugelman"}, "reply_to_user": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "edited": false, "score": 0, "creation_date": 1576099104, "post_id": 59292645, "comment_id": 104793018, "body": "On my system it&#39;s <code>&#47;usr&#47;share&#47;vim&#47;vim80&#47;syntax&#47;go.vim</code>. That help text is a block comment at the top of the file."}, {"owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "edited": false, "score": 0, "creation_date": 1576139297, "post_id": 59292645, "comment_id": 104803865, "body": "Is the &quot;<code>g</code>&quot; part of the option name e.g. <code>g:go_highlight_array_whitespace_error</code>? Also, do you know how to see, which &quot;mode&quot; Vim is currently in to see what syntax highlightning it&#39;s using for the current file? Also, do you know where to see &quot;mode-to-file extension&quot; mappings?"}], "tags": [], "owner": {"reputation": 305833, "user_id": 68587, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7d9fd158e03cbde94f7e0b33b78222af?s=128&d=identicon&r=PG", "display_name": "John Kugelman", "link": "https://stackoverflow.com/users/68587/john-kugelman"}, "is_accepted": false, "score": 3, "last_activity_date": 1576147703, "last_edit_date": 1576147703, "creation_date": 1576091996, "answer_id": 59292645, "question_id": 59292417, "link": "https://stackoverflow.com/questions/59292417/how-to-disable-highlightning-of-whitespace-when-editing-go-source-files-in-vim/59292645#59292645", "title": "How to disable highlightning of whitespace when editing Go source files in Vim?", "body": "<p>It's not highlighting nor any plugin. It's <em>syntax coloring</em> for so-called \"whitespace errors\" \u2014 trailing whitespace that shouldn't be there. It's coming from the built-in <code>syntax/go.vim</code>.</p>\n\n<p>You can customize the highlighting by setting various global <code>go_*</code> variables. The block comment at the top of <code>go.vim</code> explains them:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>\" Options:\n\"   There are some options for customizing the highlighting; the recommended\n\"   settings are the default values, but you can write:\n\"     let OPTION_NAME = 0\n\"   in your ~/.vimrc file to disable particular options. You can also write:\n\"     let OPTION_NAME = 1\n\"   to enable particular options. At present, all options default to on.\n\"\n\"   - g:go_highlight_array_whitespace_error\n\"     Highlights white space after \"[]\".\n\"   - g:go_highlight_chan_whitespace_error\n\"     Highlights white space around the communications operator that don't\n\"     follow the standard style.\n\"   - g:go_highlight_extra_types\n\"     Highlights commonly used library types (io.Reader, etc.).\n\"   - g:go_highlight_space_tab_error\n\"     Highlights instances of tabs following spaces.\n\"   - g:go_highlight_trailing_whitespace_error\n\"     Highlights trailing white space.\n</code></pre>\n\n<p>Notes:</p>\n\n<ul>\n<li><code>g:</code> sets the options globally.</li>\n<li>Use <code>:set syntax</code> to check the current language.</li>\n<li>See <code>filetype.vim</code> for filename to language mappings.</li>\n</ul>\n"}], "owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576147703, "creation_date": 1576091063, "last_edit_date": 1576091736, "question_id": 59292417, "link": "https://stackoverflow.com/questions/59292417/how-to-disable-highlightning-of-whitespace-when-editing-go-source-files-in-vim", "title": "How to disable highlightning of whitespace when editing Go source files in Vim?", "body": "<p>How can I disable highlightning of whitespace when editing Go source files in Vim?</p>\n\n<p>Also, why does Vim  highlight whitespace for Go source files, when it doesn't do it for Python source files - is highlighting of whitespace enabled depending on the file extension, e.g. <code>.go</code> or <code>.py</code>?</p>\n\n<p><a href=\"https://i.stack.imgur.com/9Tj7y.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/9Tj7y.png\" alt=\" \"></a></p>\n\n<p><strong>Vim version:</strong></p>\n\n<pre><code>nlykkei:~$ vim --version\nVIM - Vi IMproved 8.1 (2018 May 18, compiled Sep 16 2019 18:46:24)\nIncluded patches: 1-503, 505-680, 682-1312\nCompiled by root@apple.com\nNormal version without GUI.  Features included (+) or not (-):\n+acl               +extra_search      -mouse_netterm     -tag_old_static\n-arabic            -farsi             +mouse_sgr         -tag_any_white\n+autocmd           +file_in_path      -mouse_sysmouse    -tcl\n+autochdir         +find_in_path      -mouse_urxvt       -termguicolors\n-autoservername    +float             +mouse_xterm       +terminal\n-balloon_eval      +folding           +multi_byte        +terminfo\n-balloon_eval_term -footer            +multi_lang        +termresponse\n-browse            +fork()            -mzscheme          +textobjects\n+builtin_terms     -gettext           +netbeans_intg     +textprop\n+byte_offset       -hangul_input      +num64             +timers\n+channel           +iconv             +packages          +title\n+cindent           +insert_expand     +path_extra        -toolbar\n-clientserver      +job               -perl              +user_commands\n-clipboard         +jumplist          +persistent_undo   -vartabs\n+cmdline_compl     -keymap            +postscript        +vertsplit\n+cmdline_hist      +lambda            +printer           +virtualedit\n+cmdline_info      -langmap           -profile           +visual\n+comments          +libcall           +python/dyn        +visualextra\n-conceal           +linebreak         -python3           +viminfo\n+cryptv            +lispindent        +quickfix          +vreplace\n+cscope            +listcmds          +reltime           +wildignore\n+cursorbind        +localmap          -rightleft         +wildmenu\n+cursorshape       -lua               +ruby/dyn          +windows\n+dialog_con        +menu              +scrollbind        +writebackup\n+diff              +mksession         +signs             -X11\n+digraphs          +modify_fname      +smartindent       -xfontset\n-dnd               +mouse             +startuptime       -xim\n-ebcdic            -mouseshape        +statusline        -xpm\n-emacs_tags        -mouse_dec         -sun_workshop      -xsmp\n+eval              -mouse_gpm         +syntax            -xterm_clipboard\n+ex_extra          -mouse_jsbterm     +tag_binary        -xterm_save\n   system vimrc file: \"$VIM/vimrc\"\n     user vimrc file: \"$HOME/.vimrc\"\n 2nd user vimrc file: \"~/.vim/vimrc\"\n      user exrc file: \"$HOME/.exrc\"\n       defaults file: \"$VIMRUNTIME/defaults.vim\"\n  fall-back for $VIM: \"/usr/share/vim\"\nCompilation: gcc -c -I. -Iproto -DHAVE_CONFIG_H   -DMACOS_X_UNIX  -g -O2 -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=1\nLinking: gcc   -L/usr/local/lib -o vim        -lm -lncurses  -liconv -framework Cocoa\n</code></pre>\n"}, {"tags": ["go", "base64"], "comments": [{"owner": {"reputation": 11104, "user_id": 7329832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96a4e398a7a3d75e8cffbc635860e01a?s=128&d=identicon&r=PG&f=1", "display_name": "jps", "link": "https://stackoverflow.com/users/7329832/jps"}, "edited": false, "score": 1, "creation_date": 1576091658, "post_id": 59292393, "comment_id": 104789837, "body": "the decoded result is 33% larger than the encoded string, see <a href=\"https://stackoverflow.com/questions/59026008/will-base64-encoded-value-exceed-65-535-characters/59050780#59050780\">here</a>"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 4, "last_activity_date": 1576091301, "creation_date": 1576091301, "answer_id": 59292484, "question_id": 59292393, "link": "https://stackoverflow.com/questions/59292393/using-gos-base64-stdencoding-decode-method-how-to-choose-the-size-of-the-des/59292484#59292484", "title": "Using Go&#39;s base64.StdEncoding.Decode() method: how to choose the size of the destination byte slice?", "body": "<p>You should use <code>base64.DecodedLen</code> to find the maximum size you need to decode the input, and then use the <code>n</code> returned from <code>Decode</code> to find out how long it really wrote to that slice.</p>\n"}, {"tags": [], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "is_accepted": false, "score": 0, "last_activity_date": 1576092750, "creation_date": 1576092750, "answer_id": 59292807, "question_id": 59292393, "link": "https://stackoverflow.com/questions/59292393/using-gos-base64-stdencoding-decode-method-how-to-choose-the-size-of-the-des/59292807#59292807", "title": "Using Go&#39;s base64.StdEncoding.Decode() method: how to choose the size of the destination byte slice?", "body": "<p>Following <a href=\"https://stackoverflow.com/users/7329832/jps\">jps</a>'s comment and reading up at <a href=\"https://en.wikipedia.org/wiki/Base64\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Base64</a>, since the input is encoded in 8-bit bytes but the output is in 6-bit (radix-64) ones, the output needs to be 8/6 = 4/3 times the size of the input. So this should work:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/base64\"\n    \"fmt\"\n)\n\nfunc main() {\n    str := \"c29tZSBkYXRhIHdpdGggACBhbmQg77u/\"\n    dst := make([]byte, len(str)*len(str)/base64.StdEncoding.DecodedLen(len(str)))\n    _, err := base64.StdEncoding.Decode(dst, []byte(str))\n    if err != nil {\n        fmt.Println(\"error:\", err)\n        return\n    }\n    fmt.Printf(\"%s\\n\", dst)\n}\n</code></pre>\n\n<p>based on the implementation of <code>DecodedLen()</code> which under normal circumstances returns the length of the input times 3/4:</p>\n\n<pre><code>// DecodedLen returns the maximum length in bytes of the decoded data\n// corresponding to n bytes of base64-encoded data.\nfunc (enc *Encoding) DecodedLen(n int) int {\n    if enc.padChar == NoPadding {\n        // Unpadded data may end with partial block of 2-3 characters.\n        return n * 6 / 8\n    }\n    // Padded base64 should always be a multiple of 4 characters in length.\n    return n / 4 * 3\n}\n</code></pre>\n\n<p>In the end, though, I ended up just converting the input to a string and using <code>DecodeString()</code> since that already embodies this logic.</p>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 683, "favorite_count": 0, "accepted_answer_id": 59292484, "answer_count": 2, "score": 2, "last_activity_date": 1576092750, "creation_date": 1576090954, "question_id": 59292393, "link": "https://stackoverflow.com/questions/59292393/using-gos-base64-stdencoding-decode-method-how-to-choose-the-size-of-the-des", "title": "Using Go&#39;s base64.StdEncoding.Decode() method: how to choose the size of the destination byte slice?", "body": "<p>I'd like to use <code>Decode</code> (<a href=\"https://golang.org/pkg/encoding/base64/#Encoding.Decode\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/base64/#Encoding.Decode</a>) to decode a slice of bytes and was wondering, given this method signature,</p>\n\n<pre><code>func (enc *Encoding) Decode(dst, src []byte) (n int, err error)\n</code></pre>\n\n<p>how to choose the size of the <code>dst</code> slice of bytes to be just big enough to capture the output. For example, this snippet (adapted from <a href=\"https://golang.org/pkg/encoding/base64/#Encoding.DecodeString\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/base64/#Encoding.DecodeString</a>)</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/base64\"\n    \"fmt\"\n)\n\nfunc main() {\n    str := \"c29tZSBkYXRhIHdpdGggACBhbmQg77u/\"\n    dst := make([]byte, 1024)\n    _, err := base64.StdEncoding.Decode(dst, []byte(str))\n    if err != nil {\n        fmt.Println(\"error:\", err)\n        return\n    }\n    fmt.Printf(\"%s\\n\", dst)\n}\n</code></pre>\n\n<p>prints</p>\n\n<pre><code>some data with  and \ufeff\n</code></pre>\n\n<p>However, if I choose the size of <code>dst</code> too small (e.g. <code>0</code>), I get an <code>index out of range</code> panic:</p>\n\n<pre><code>panic: runtime error: index out of range\n\ngoroutine 1 [running]:\nencoding/base64.(*Encoding).decodeQuantum(0xc000084000, 0x1193018, 0x0, 0x0, 0xc000080f30, 0x20, 0x20, 0x4, 0x10, 0x10, ...)\n    /usr/local/Cellar/go@1.12/1.12.12/libexec/src/encoding/base64/base64.go:352 +0x567\nencoding/base64.(*Encoding).Decode(0xc000084000, 0x1193018, 0x0, 0x0, 0xc000080f30, 0x20, 0x20, 0xc000080f38, 0x105779d, 0x10b16e0)\n    /usr/local/Cellar/go@1.12/1.12.12/libexec/src/encoding/base64/base64.go:500 +0x5aa\nmain.main()\n    /Users/kurt/Documents/Scratch/base64_decode.go:11 +0xb4\nexit status 2\n</code></pre>\n\n<p>How can I choose the size of <code>dst</code> based on the size of <code>src</code> to reliably decode the input?</p>\n"}, {"tags": ["dictionary", "pointers", "go", "hashmap"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1576083394, "post_id": 59290522, "comment_id": 104786069, "body": "See <a href=\"https://stackoverflow.com/questions/9619479/go-what-determines-the-iteration-order-for-map-keys\">Go: what determines the iteration order for map keys?</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1576083851, "post_id": 59290522, "comment_id": 104786286, "body": "They are unordered for the same reason that maps/dictionaries/hashes in most languages are unordered: speed. The majority of cases don&#39;t need them ordered, which would make ordering them in all cases wasteful of CPU resources. This was (I think) a sensible tradeoff by the designers, but if you want to know why they chose that... you would have to ask them, not the community at large."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1576083944, "post_id": 59290522, "comment_id": 104786344, "body": "&quot;why it&#39;s order different every time I looping over map?&quot; so that people would not rely on any particular ordering, as the ordering is not guaranteed in any way by the language. &quot;Where actual values are stored in memory?&quot; yes, in memory, wherever the map has been allocated - this question is kind of unclear."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1576094307, "last_edit_date": 1576094307, "creation_date": 1576090305, "answer_id": 59292254, "question_id": 59290522, "link": "https://stackoverflow.com/questions/59290522/gos-maps-under-the-hood/59292254#59292254", "title": "Go&#39;s maps under the hood", "body": "<blockquote>\n  <ul>\n  <li><strong>Why are they unordered?</strong></li>\n  </ul>\n</blockquote>\n\n<p>Because this gives <em>greater freedom</em> to the runtime to implement the map type. Although we know Go's (current) implementation is a hashmap, the language specification allows to use any map implementation like hash map, tree map etc. Also not having to remember the order, this allows the runtime to do its job more effectively and using less memory.</p>\n\n<p>Adrian's comment nicely summarizes that order is rarely needed, and it would be a waste to always maintain order. When you do need order, you may use a data structure that provides the ordering. For examples, see <a href=\"https://stackoverflow.com/questions/39450120/map-in-order-range-loop/39450454#39450454\">Map in order range loop</a>.</p>\n\n<blockquote>\n  <p>And since key's hashes are located in ordered array inside bucket, why it's order different every time I looping over map?</p>\n</blockquote>\n\n<p>The Go authors intentionally made map's iteration order randomized (so we mortals don't get dependent on a fixed order). For more, see <a href=\"https://stackoverflow.com/questions/55925822/in-golang-why-are-iterations-over-maps-random/55925880#55925880\">In Golang, why are iterations over maps random?</a></p>\n\n<p>Also see related: <a href=\"https://stackoverflow.com/questions/28930416/why-cant-go-iterate-maps-in-insertion-order/28931555#28931555\">Why can&#39;t Go iterate maps in insertion order?</a></p>\n\n<blockquote>\n  <ul>\n  <li><strong>Where actual values are stored in memory?</strong></li>\n  </ul>\n</blockquote>\n\n<p>The \"where\" is specified by <code>hmap.buckets</code>. This is a pointer value, it points to an array in memory, an array holding the buckets.</p>\n\n<pre><code>buckets    unsafe.Pointer // array of 2^B Buckets. may be nil if count==0.\n</code></pre>\n\n<p>So <code>hmap.buckets</code> points to a contiguous memory segment holding buckets. A bucket is \"modeled\" by <code>bmap</code>, but this is not its actual memory layout. A bucket starts with an array holding top hash bytes of keys being in the bucket (<code>tophash [bucketCnt]uint8</code>), and this array is <strong>followed by <code>bucketCnt</code> keys of the bucket, which is then followed by <code>bucketCnt</code> values of the bucket</strong>. Lastly there is an overflow pointer.</p>\n\n<p>Think of the bucket like this <em>conceptual</em> type, which \"visualizes\" where keys and values are located in memory:</p>\n\n<pre><code>type conceptualBucket struct {\n    tophash     [bucketCnt]uint8\n    keys        [bucketCnt]keyType\n    values      [bucketCnt]valueType\n    overflowPtr uintptr\n}\n</code></pre>\n\n<p>Note: <code>bucketCnt</code> is a compile time constant being <code>8</code>, it is the maximum number of key/elem pairs a bucket can hold.</p>\n\n<p>Of course this \"picture\" is inaccurate, but it gives the idea where / how keys and values are stored.</p>\n"}], "owner": {"reputation": 121, "user_id": 10485585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4f290d6cb7512a1e8adc10a5780e89e?s=128&d=identicon&r=PG&f=1", "display_name": "zzell", "link": "https://stackoverflow.com/users/10485585/zzell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 553, "favorite_count": 0, "accepted_answer_id": 59292254, "answer_count": 1, "score": 5, "last_activity_date": 1576094307, "creation_date": 1576083041, "last_edit_date": 1576090324, "question_id": 59290522, "link": "https://stackoverflow.com/questions/59290522/gos-maps-under-the-hood", "title": "Go&#39;s maps under the hood", "body": "<p>After reading Dave Cheney's <a href=\"https://dave.cheney.net/2018/05/29/how-the-go-runtime-implements-maps-efficiently-without-generics\" rel=\"nofollow noreferrer\">blogpost</a> about Go's maps there is still few things unclear to me.</p>\n\n<p>TLDR:</p>\n\n<ul>\n<li><strong>Why are they unordered?</strong></li>\n<li><strong>Where actual values are stored in memory?</strong></li>\n</ul>\n\n<p>After digging in <a href=\"https://github.com/golang/go/blob/master/src/runtime/map.go\" rel=\"nofollow noreferrer\">runtime</a> package I found out that underlying map structure is following:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// A header for a Go map.\ntype hmap struct {\n    // Note: the format of the hmap is also encoded in cmd/compile/internal/gc/reflect.go.\n    // Make sure this stays in sync with the compiler's definition.\n    count     int // # live cells == size of map.  Must be first (used by len() builtin)\n    flags     uint8\n    B         uint8  // log_2 of # of buckets (can hold up to loadFactor * 2^B items)\n    noverflow uint16 // approximate number of overflow buckets; see incrnoverflow for details\n    hash0     uint32 // hash seed\n\n    buckets    unsafe.Pointer // array of 2^B Buckets. may be nil if count==0.\n    oldbuckets unsafe.Pointer // previous bucket array of half the size, non-nil only when growing\n    nevacuate  uintptr        // progress counter for evacuation (buckets less than this have been evacuated)\n\n    extra *mapextra // optional fields\n}\n</code></pre>\n\n<p><code>buckets</code> - is array of buckets where indexes is low-order bits of key's hash, where the bucket is:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// A bucket for a Go map.\ntype bmap struct {\n    // tophash generally contains the top byte of the hash value\n    // for each key in this bucket. If tophash[0] &lt; minTopHash,\n    // tophash[0] is a bucket evacuation state instead.\n    tophash [bucketCnt]uint8\n    // Followed by bucketCnt keys and then bucketCnt elems.\n    // NOTE: packing all the keys together and then all the elems together makes the\n    // code a bit more complicated than alternating key/elem/key/elem/... but it allows\n    // us to eliminate padding which would be needed for, e.g., map[int64]int8.\n    // Followed by an overflow pointer.\n}\n</code></pre>\n\n<p>..well it's just array of <code>uint8</code> where every item is first byte of key's hash. And key-value pairs are stores as <code>key/key value/value</code> (eight pairs per bucket). But where exactly? Considering that map may contain value of (almost) any type. There should be some kind of pointer to place in memory where array of values stored, but <code>bmap</code> doesn't have such info.</p>\n\n<p>And since key's hashes are located in ordered array inside bucket, why it's order different every time I looping over map? </p>\n"}, {"tags": ["dictionary", "go", "race-condition"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1576083898, "post_id": 59290446, "comment_id": 104786313, "body": "You&#39;re not showing the full output of the race detector, which will show you <i>exactly</i> where the conflicting reads and writes are happening."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1576082877, "creation_date": 1576082877, "answer_id": 59290485, "question_id": 59290446, "link": "https://stackoverflow.com/questions/59290446/data-race-condition-detected-in-sync-map-golang/59290485#59290485", "title": "Data race condition detected in sync.Map - Golang", "body": "<p>The race is on <code>i</code>.  Fix by passing the value to the function instead of referring to the single local variable:</p>\n\n<pre><code>func TestRaceCondition(t *testing.T) {\n    var map sync.Map\n    for i := 0; i &lt; 10; i++ {\n        go func(i int) {\n            map.Store(strconv.Itoa(i), nil)\n        }(i)\n    }\n}\n</code></pre>\n\n<p>Another option is to declare a another variable <code>i</code> inside the loop:</p>\n\n<pre><code>func TestRaceCondition(t *testing.T) {\n    var map sync.Map\n    for i := 0; i &lt; 10; i++ {\n        i := i  // each goroutine sees a unique i variable.\n        go func() {\n            map.Store(strconv.Itoa(i), nil)\n        }()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 549, "user_id": 4241138, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1bc0dce889ef7262130cc5a2dd67a454?s=128&d=identicon&r=PG&f=1", "display_name": "Robin", "link": "https://stackoverflow.com/users/4241138/robin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 59290485, "answer_count": 1, "score": -2, "last_activity_date": 1576083000, "creation_date": 1576082705, "last_edit_date": 1576083000, "question_id": 59290446, "link": "https://stackoverflow.com/questions/59290446/data-race-condition-detected-in-sync-map-golang", "title": "Data race condition detected in sync.Map - Golang", "body": "<p>I run a test using the <code>-race</code> go tool argument, outputting</p>\n\n<pre><code>--- FAIL: TestRaceCondition (0.00s)\n    testing.go:853: race detected during execution of test\n</code></pre>\n\n<pre><code>func TestRaceCondition(t *testing.T) {\n    var map sync.Map\n    for i := 0; i &lt; 10; i++ {\n        go func() {\n            map.Store(strconv.Itoa(i), nil)\n        }()\n    }\n}\n</code></pre>\n\n<p>I don't understand, because, according to the <a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\">doc</a>,</p>\n\n<blockquote>\n  <p>Map [...] is safe for concurrent use by multiple goroutines without\n  additional locking or coordination.</p>\n</blockquote>\n"}, {"tags": ["amazon-web-services", "http", "go", "aws-sdk", "amazon-glacier"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1576081616, "post_id": 59289680, "comment_id": 104785159, "body": "Because the last byte of a payload worth of <code>N</code> bytes has index <code>N-1</code>?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1576081624, "post_id": 59289680, "comment_id": 104785164, "body": "See <a href=\"https://tools.ietf.org/html/rfc7233#section-2.1\" rel=\"nofollow noreferrer\">this</a> for more: &#171;The first-byte-pos value in a byte-range-spec gives the byte-offset of the first byte in a range.  The last-byte-pos value gives the byte-offset of the last byte in the range; that is, the byte positions specified are inclusive. Byte offsets start at zero.&#187;"}, {"owner": {"reputation": 880, "user_id": 1985823, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0e977c6558ec5d27dfbd1b3385a3ae4e?s=128&d=identicon&r=PG", "display_name": "slooker", "link": "https://stackoverflow.com/users/1985823/slooker"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1576082322, "post_id": 59289680, "comment_id": 104785507, "body": "Apparently that was it.  It&#39;s always something simple.  Thank you @kostix"}], "owner": {"reputation": 880, "user_id": 1985823, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0e977c6558ec5d27dfbd1b3385a3ae4e?s=128&d=identicon&r=PG", "display_name": "slooker", "link": "https://stackoverflow.com/users/1985823/slooker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576081699, "creation_date": 1576080014, "last_edit_date": 1576081699, "question_id": 59289680, "link": "https://stackoverflow.com/questions/59289680/aws-glacier-why-is-my-content-range-incompatible-with-my-content-length-using", "title": "AWS Glacier - Why is my Content-Range incompatible with my Content-Length using the Golang AWS SDK?", "body": "<p>I'm trying to upload a file to Glacier using this code:</p>\n\n<pre><code>    fmt.Println(len(dat))\n    uploadPartInput := &amp;glacier.UploadMultipartPartInput{\n        AccountId: aws.String(\"-\"),\n        // Body:      aws.ReadSeekCloser(bytes.NewReader(dat[:6000000])),\n        Body:      aws.ReadSeekCloser(bytes.NewReader(dat)),\n        Range:     aws.String(\"bytes 0-12962984/*\"),\n        UploadId:  initiateResult.UploadId,\n        VaultName: aws.String(\"some-test-vibrant-glacier-vault\"),\n    }\n    _, err = glacierClient.UploadMultipartPart(uploadPartInput)\n    if err != nil {\n        log.Fatal(err)\n    }\n</code></pre>\n\n<p>This outputs the following:</p>\n\n<pre><code>12962984\n2019/12/11 10:57:10 InvalidParameterValueException: Content-Range: bytes 0-12962984/* is incompatible with Content-Length: 12962984\n</code></pre>\n\n<p>Can anyone tell me why my content-length is incompatible with my content-range?</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": true, "score": 1, "last_activity_date": 1576072810, "creation_date": 1576072810, "answer_id": 59287454, "question_id": 59287355, "link": "https://stackoverflow.com/questions/59287355/json-cannot-unmarshal-object-into-go-value-of-type-error-with-certain-values/59287454#59287454", "title": "json: cannot unmarshal object into Go value of type error with certain values", "body": "<p>You're trying to unmarshal into a slice of your struct, not an object.</p>\n\n<p>You should pass a <code>GistResponse</code>, not a <code>[]GistResponse</code>. If you need further help, you should also post the complete example that contains the code you use for unmarshalling</p>\n"}], "owner": {"reputation": 85, "user_id": 5830058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3403dfb12675665b91c409730c65b615?s=128&d=identicon&r=PG&f=1", "display_name": "Olive.b", "link": "https://stackoverflow.com/users/5830058/olive-b"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 382, "favorite_count": 0, "closed_date": 1576074381, "accepted_answer_id": 59287454, "answer_count": 1, "score": -5, "last_activity_date": 1576072810, "creation_date": 1576072537, "question_id": 59287355, "link": "https://stackoverflow.com/questions/59287355/json-cannot-unmarshal-object-into-go-value-of-type-error-with-certain-values", "closed_reason": "Duplicate", "title": "json: cannot unmarshal object into Go value of type error with certain values", "body": "<p>Can I decode certain values from json to a struct? I am getting a response like this  <a href=\"https://developer.github.com/v3/gists/#response-5\" rel=\"nofollow noreferrer\">https://developer.github.com/v3/gists/#response-5</a> when creating a gist and I created a struct like so:</p>\n\n<pre><code>type GistResponse struct {\n    HTMLURL string `json:\"html_url\"`\n    Public  bool   `json:\"public\"`\n}\n</code></pre>\n\n<p>But when I try to decode the json response the above struct I get a :</p>\n\n<pre><code>json: cannot unmarshal object into Go value of type []main.GistResponse\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["google-chrome", "go", "chromedp"], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 11220971, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-KXbUmIxUpoc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcv_SD6e5bVK1E8B-saocAoAQjiVw/mo/photo.jpg?sz=128", "display_name": "nigun", "link": "https://stackoverflow.com/users/11220971/nigun"}, "is_accepted": false, "score": 0, "last_activity_date": 1576496332, "last_edit_date": 1576496332, "creation_date": 1576441364, "answer_id": 59347742, "question_id": 59287313, "link": "https://stackoverflow.com/questions/59287313/load-up-existing-chrome-user-profile-data-with-chromedp/59347742#59347742", "title": "Load up existing Chrome user profile &amp; data with chromedp", "body": "<p>i set these flags<br>\nthen a new profile was created<br>\nthen i synced it with my google account<br>\nand every time i run chromedp with <code>sudo</code><br>\nit syncs with my account<br>\nEdit: You can set <code>UserDataDir</code> in a non hidden folder<br>\n (e.g. <code>/home/user/Profile 1/</code>)<br>\nand you won't need to use <code>subo</code></p>\n\n<p><code>chromedp.Flag(\"profile-directory\",\"Profile 1\"),\nchromedp.UserDataDir(\"/home/user/.config/chromium/Profile 1\"),\nchromedp.Flag(\"disable-sync\", false),</code></p>\n"}], "owner": {"reputation": 1954, "user_id": 10048799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43e3b78b616247e7b5a2fcfde299bcfb?s=128&d=identicon&r=PG&f=1", "display_name": "kaleidawave", "link": "https://stackoverflow.com/users/10048799/kaleidawave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 333, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576496332, "creation_date": 1576072381, "question_id": 59287313, "link": "https://stackoverflow.com/questions/59287313/load-up-existing-chrome-user-profile-data-with-chromedp", "title": "Load up existing Chrome user profile &amp; data with chromedp", "body": "<p>When I load up a chromedp context I want it to use my default Chrome session. Keeping all session data and things. So when I load up Dropbox, Discord, Twitter, YouTube... etc I should already logged in and can readily interact with them through chromedp.</p>\n\n<p>I understand there may be security concerns so this action may be impossible. I am only building this tool for personal use and to automate some generic web tasks. I could of course copy all my cookies, auth headers  over to the program or physically add logging in using given credentials but it would be easier if I could just specify one flag to deal with using existing detail. I am almost certain that this functionality is in puppeteer?</p>\n\n<p>I have tried adding <code>chromedp.Flag(\"profile-directory\", `\"Default\"`)</code>. But it produces a blank window (see below) rather than doing following any Actions. Removing this line will make it function as expected but in an anonymous session.</p>\n\n<p><img src=\"https://i.stack.imgur.com/WNNXS.png\" alt=\"\"></p>\n"}, {"tags": ["arrays", "dictionary", "go", "struct"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 4, "creation_date": 1576069370, "post_id": 59286147, "comment_id": 104778032, "body": "It looks like <code>m</code> should be <code>map[string][]*models.Event</code>. You should also either append to the slices, or assign the entire slice: <code>m[day] = events</code>. It&#39;s hard to tell if this is the intended data structure or not from your code though."}, {"owner": {"reputation": 280, "user_id": 1349371, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b82c43d4ab1590b48b58b62ce4c3ca1c?s=128&d=identicon&r=PG&f=1", "display_name": "Onur G&#246;ker", "link": "https://stackoverflow.com/users/1349371/onur-g%c3%b6ker"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1576071133, "post_id": 59286147, "comment_id": 104779048, "body": "It works as you said. Thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 280, "user_id": 1349371, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b82c43d4ab1590b48b58b62ce4c3ca1c?s=128&d=identicon&r=PG&f=1", "display_name": "Onur G&#246;ker", "link": "https://stackoverflow.com/users/1349371/onur-g%c3%b6ker"}, "is_accepted": true, "score": 0, "last_activity_date": 1576071354, "creation_date": 1576071354, "answer_id": 59287021, "question_id": 59286147, "link": "https://stackoverflow.com/questions/59286147/how-can-i-assign-a-struct-type-value-using-a-map/59287021#59287021", "title": "How can I assign a Struct Type value using a map?", "body": "<p>As Marc defined, I updated the codeblock as below. Now it works perfect!</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>//Get func\r\nfunc (c *EventController) Get() {\r\n\r\n\tdays := [7]string{\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\", \"Sunday\"}\r\n\r\n\tm := make(map[string][]*models.Event)\r\n\r\n\tfor _, day := range days {\r\n\t\to := orm.NewOrm()\r\n\r\n\t\tvar events []*models.Event\r\n\t\tnum, err := o.QueryTable(\"events\").Filter(\"day__name__exact\", day).RelatedSel().All(&amp;events)\r\n\r\n\t\tfmt.Print(\"Day: \", day, \" Count:\", num, \"\\n\")\r\n\r\n\t\tif err != nil {\r\n\t\t\tfmt.Printf(\"%d posts read\\n\", num)\r\n\t\t}\r\n\r\n\t\tm[day] = events\r\n\t}\r\n\r\n\tc.Data[\"json\"] = m\r\n\r\n\t// c.TplName = \"events.tpl\"\r\n\tc.ServeJSON()\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}], "owner": {"reputation": 280, "user_id": 1349371, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b82c43d4ab1590b48b58b62ce4c3ca1c?s=128&d=identicon&r=PG&f=1", "display_name": "Onur G&#246;ker", "link": "https://stackoverflow.com/users/1349371/onur-g%c3%b6ker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 59287021, "answer_count": 1, "score": -3, "last_activity_date": 1576072007, "creation_date": 1576068314, "last_edit_date": 1576072007, "question_id": 59286147, "link": "https://stackoverflow.com/questions/59286147/how-can-i-assign-a-struct-type-value-using-a-map", "title": "How can I assign a Struct Type value using a map?", "body": "<p>I want to create a multidimensional array as below:</p>\n\n<pre><code>[string][int] = Struct\n</code></pre>\n\n<p>I wrote the following codeblock. When I try to assign a Struct type to map, I get the following error:</p>\n\n<blockquote>\n  <p>cannot use event (type *models.Event) as type map[int]models.Event in assignment go</p>\n</blockquote>\n\n<p>Here comes the code block:</p>\n\n<pre><code>//Get func\nfunc (c *EventController) Get() {\n    days := [7]string{\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\", \"Sunday\"}\n\n    m := make(map[string][]map[int]models.Event)\n\n    for _, day := range days {\n        var i = 0\n        o := orm.NewOrm()\n        qs := o.QueryTable(\"events\")\n        qs.OrderBy(\"id\")\n        qs.Filter(\"days__name\", day)\n\n        var events []*models.Event\n        num, err := o.QueryTable(\"events\").RelatedSel().All(&amp;events)\n\n        if err == nil {\n            fmt.Printf(\"%d events read\\n\", num)\n\n            for _, event := range events {\n                m[day][i] = event\n                i++\n            }\n        } else {\n            fmt.Println(err)\n        }\n    }\n\n    c.Data[\"json\"] = m\n\n    // c.TplName = \"events.tpl\"\n    c.ServeJSON()\n}\n\n</code></pre>\n\n<p>What is wrong in here?</p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1576075407, "post_id": 59285222, "comment_id": 104781561, "body": "nit-pick, the <code>done</code> channel usually is of type <code>chan struct{}</code>. An empty struct is, by the language spec, defined to be 0 bytes in size, and it makes it clear that the channel is used for signalling, and not actual data communication. A channel of type <code>&lt;-chan interface{}</code> could be mistaken for a channel you use to pass on data you&#39;re <i>&quot;done&quot;</i> with (eg is ready to be stored or something)"}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 7821299, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zdDzz.png?s=128&g=1", "display_name": "totofgo", "link": "https://stackoverflow.com/users/7821299/totofgo"}, "edited": false, "score": 0, "creation_date": 1576077260, "post_id": 59286074, "comment_id": 104782587, "body": "Thank you publysher. ! this is a perfect answer"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 41, "user_id": 7821299, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zdDzz.png?s=128&g=1", "display_name": "totofgo", "link": "https://stackoverflow.com/users/7821299/totofgo"}, "edited": false, "score": 0, "creation_date": 1576113956, "post_id": 59286074, "comment_id": 104797100, "body": "@totofgo you should accept the answer to close it out."}], "tags": [], "owner": {"reputation": 9874, "user_id": 1636314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/656293120862f84aa3319979ca1bdb8c?s=128&d=identicon&r=PG", "display_name": "publysher", "link": "https://stackoverflow.com/users/1636314/publysher"}, "is_accepted": true, "score": 2, "last_activity_date": 1576068096, "creation_date": 1576068096, "answer_id": 59286074, "question_id": 59285222, "link": "https://stackoverflow.com/questions/59285222/why-is-my-done-channel-closing-randomly/59286074#59286074", "title": "Why is my &quot;done&quot; channel closing randomly?", "body": "<p>You have four go-routines running:</p>\n\n<ol>\n<li><code>gen</code>, your generator, writing to an unbuffered output channel until <code>done</code></li>\n<li><code>pipeA</code>, reading from <code>gen</code>, writing to an unbuffered output channel until <code>done</code></li>\n<li><code>pipeB</code>, reading from <code>pipeA</code>, writing to an unbuffered output channel until <code>done</code></li>\n<li><code>main</code>, reading from <code>pipeB</code> until <code>done</code></li>\n</ol>\n\n<p>Now when you close <code>done</code>, it totally depends on the order in which the go-routines see that. </p>\n\n<p>If <code>main</code> is the first to see that <code>done</code> is closed, it will break the for-loop and stop consuming from <code>pipeB</code>. But if <code>pipeB</code> is still trying to write to the output channel (<code>ret &lt;- tmp</code>), it will block there; so it will never get to the <code>&lt;- done</code> part. </p>\n\n<p>There are two options to fix this:</p>\n\n<ol>\n<li>Only listen to <code>done</code> in your generator, and have the other go-routines use <code>for n := range in { }</code>. </li>\n<li>Put your sending logic in a <code>select</code> as well so your generator and pipes can detect when <code>done</code> is closed. </li>\n</ol>\n\n<p>Alternatively, you might want to use buffered output channels, but even then this problem can still occur. </p>\n"}], "owner": {"reputation": 41, "user_id": 7821299, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zdDzz.png?s=128&g=1", "display_name": "totofgo", "link": "https://stackoverflow.com/users/7821299/totofgo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 1, "accepted_answer_id": 59286074, "answer_count": 1, "score": 0, "last_activity_date": 1576068096, "creation_date": 1576065168, "last_edit_date": 1576067535, "question_id": 59285222, "link": "https://stackoverflow.com/questions/59285222/why-is-my-done-channel-closing-randomly", "title": "Why is my &quot;done&quot; channel closing randomly?", "body": "<p>I built the following go code.</p>\n\n<p>The idea is to build a done channel and a generator that generates a channel of int.\nLink them in a 2 stage pipe \nchanNumbers := pipeb(done, pipea(done, gen(done)))</p>\n\n<p>After some seconds, cancel the done channel.\nI expect to see the generator and two stage of the pipe to cancel and return, but the text \"PipeX is terminating now\" only appears randomly and I really do not understand why.\nWould someone have an idea?</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc gen(done &lt;-chan interface{}) &lt;-chan int {\n    ret := make(chan int)\n    cx := 0\n\n    go func() {\n        for {\n            select {\n            case &lt;-done:\n                fmt.Println(\"**Generator Terminates now\")\n                time.Sleep(2 * time.Second)\n                fmt.Println(\"**Generator has terminated now\")\n                close(ret)\n                return\n            case ret &lt;- cx:\n                fmt.Printf(\"Gen : we push %d \\n\", cx)\n                cx = cx + 1\n            }\n        }\n    }()\n    fmt.Println(\"Generator has created and returned its channel\")\n    return ret\n}\n\nfunc pipea(done &lt;-chan interface{}, in &lt;-chan int) &lt;-chan int {\n    ret := make(chan int)\n\n    go func() {\n        for {\n            select {\n            case &lt;-done:\n                fmt.Println(\"**pipeA terminates\")\n                time.Sleep(2 * time.Second)\n                fmt.Println(\"**pipeA has terminated now\")\n                close(ret)\n                return\n            case tmp, ok := (&lt;-in):\n                if ok {\n                    fmt.Printf(\"pipeA : we push %d \\n\", tmp)\n                    ret &lt;- tmp\n                } else {\n                    in = nil\n                }\n            }\n        }\n    }()\n    return ret\n}\n\nfunc pipeb(done &lt;-chan interface{}, in &lt;-chan int) &lt;-chan int {\n    ret := make(chan int)\n\n    go func() {\n        for {\n            select {\n            case &lt;-done:\n                fmt.Println(\"**pipeB terminates\")\n                time.Sleep(2 * time.Second)\n                fmt.Println(\"**pipeB has terminated now\")\n                close(ret)\n                return\n            case tmp, ok := (&lt;-in):\n                if ok {\n                    fmt.Printf(\"pipeB : we push %d \\n\", tmp)\n                    ret &lt;- tmp\n                } else {\n                    in = nil\n                }\n            }\n        }\n    }()\n    return ret\n}\n\nfunc main() {\n    done := make(chan interface{})\n\n    chanNumbers := pipeb(done, pipea(done, gen(done)))\n    go func() {\n        time.Sleep(2 * time.Second)\n        close(done)\n    }()\n\nforloop:\n    for {\n        select {\n        case n := &lt;-chanNumbers:\n            fmt.Printf(\"Received in main element : %d\\n\", n)\n        case &lt;-done:\n            break forloop\n        }\n    }\n\n    //end of the main program\n    fmt.Println(\"Sleeping some seconds before termiating\")\n    time.Sleep(8 * time.Second)\n    fmt.Println(\"exit...\")\n}\n</code></pre>\n"}, {"tags": ["go", "hyperledger-fabric", "hyperledger-fabric-sdk-go"], "answers": [{"tags": [], "owner": {"reputation": 711, "user_id": 4910839, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9UZjl.png?s=128&g=1", "display_name": "PAVAN", "link": "https://stackoverflow.com/users/4910839/pavan"}, "is_accepted": false, "score": 1, "last_activity_date": 1576125312, "creation_date": 1576125312, "answer_id": 59297779, "question_id": 59284916, "link": "https://stackoverflow.com/questions/59284916/how-to-get-the-data-stored-in-the-ledger-via-txnid-in-fabric-sdk-go/59297779#59297779", "title": "How to get the data stored in the ledger via TxnID in fabric-sdk-go?", "body": "<p>Download the fabric sample from <code>https://github.com/hyperledger/fabric-samples</code> </p>\n\n<p>Q1: In the Balance Transfer project. At the bottom of the <code>app.js</code>, all methods are already implemented.</p>\n\n<ol>\n<li>Query Get Block by BlockNumber</li>\n<li>Query Get Transaction by Transaction ID</li>\n<li>Query Get Block by Hash</li>\n<li>The query for Channel Information</li>\n<li>The query for Channel instantiated chaincodes</li>\n<li>Query to fetch all Installed/instantiated chaincodes</li>\n<li>Query to fetch channels</li>\n</ol>\n\n<p>All the functions are defined in <code>Query.js</code>, please refer to this project.</p>\n\n<p>Q2: All requested data will be coming as JSON, so no need to parse.</p>\n\n<p>Q3: Even fF you want to decode any .pb file, you a use configtxlator tool, Please make sure that you have configtxlater binary available. For decoding .pb file use following command\nFor Envelope</p>\n\n<blockquote>\n  <p>configtxlator proto_decode --input your_file.pb --type common.Envelope</p>\n</blockquote>\n\n<p>For Block file</p>\n\n<blockquote>\n  <p>configtxlator proto_decode --input config_block.pb --type common.Block | jq .data.data[0].payload.data.config > config.json</p>\n</blockquote>\n"}], "owner": {"reputation": 908, "user_id": 5618126, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe250e74add86bd1f29f48095ab66451?s=128&d=identicon&r=PG&f=1", "display_name": "metadata", "link": "https://stackoverflow.com/users/5618126/metadata"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576825646, "creation_date": 1576064056, "last_edit_date": 1576825646, "question_id": 59284916, "link": "https://stackoverflow.com/questions/59284916/how-to-get-the-data-stored-in-the-ledger-via-txnid-in-fabric-sdk-go", "title": "How to get the data stored in the ledger via TxnID in fabric-sdk-go?", "body": "<p>I have stored a data let's say <code>ABC</code> in the Ledger and got <code>X123</code> as a Transaction hash in response. Now, I want to use this transaction hash <code>X123</code> to fetch the data <code>ABC</code> from the ledger. I found <a href=\"https://github.com/hyperledger/fabric-sdk-go/blob/v1.0.0-alpha5/pkg/client/ledger/ledger.go\" rel=\"nofollow noreferrer\">this package</a> which provides the method <code>QueryTransaction(txn_hash)</code> and states that <code>QueryTransaction queries the ledger for processed transaction by transaction ID</code> </p>\n\n<p>My questions are:</p>\n\n<ol>\n<li>Is this a correct method to do the above operation? If no, Please suggest some methods. </li>\n<li><p>If yes, Do I have to use some parsing logic to correctly format it?</p></li>\n<li><p>Do we have parsing logic or decoder in <code>go-sdk</code> like <code>BlockDecoder</code> is there in <code>node-sdk</code>?</p></li>\n</ol>\n\n<p>the screenshot of the response that I'm getting using this method. </p>\n\n<p><a href=\"https://i.stack.imgur.com/Vk6Cj.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Vk6Cj.png\" alt=\"QueryTransaction response\"></a></p>\n"}, {"tags": ["http", "go", "request"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1576062529, "post_id": 59284377, "comment_id": 104774518, "body": "Your first code snippet provides a context with the request value stored in it, allowing <code>otherFunc</code> to access the request through the context. The second snippet just provides the context of the request, there the <code>otherFunc</code> can&#39;t access the request. The two examples are therefore different doing two different things. Which one you should use depends on what <code>otherFunc</code> needs the context to be."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1576062533, "post_id": 59284377, "comment_id": 104774520, "body": "You actually do pass the context from the request."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1576074332, "post_id": 59284377, "comment_id": 104780930, "body": "Relevant: <a href=\"https://dave.cheney.net/2017/01/26/context-is-for-cancelation\" rel=\"nofollow noreferrer\">dave.cheney.net/2017/01/26/context-is-for-cancelation</a>"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1576062681, "creation_date": 1576062681, "answer_id": 59284522, "question_id": 59284377, "link": "https://stackoverflow.com/questions/59284377/should-i-create-new-context-in-each-incoming-request/59284522#59284522", "title": "Should I create new context in each incoming request?", "body": "<p>Your two examples do entirely different things.</p>\n\n<pre><code>func myHandler(w http.ResponseWriter, r *http.Request) {\n  ctx := context.WithValue(context.Background(), \"request\", r)\n  otherFunc(ctx)\n}\n</code></pre>\n\n<p>This creates a new context, and stores the request as a value. There is rarely, if ever, any reason to do exactly this. A far more idiomatic solution would be just to pass the request to <code>otherFunc</code> like so:</p>\n\n<pre><code>func myHandler(w http.ResponseWriter, r *http.Request) {\n  otherFunc(r)\n}\n</code></pre>\n\n<p>If you really do need to pass the request as a context value, you should probably do it with the current request's context, like so:</p>\n\n<pre><code>func myHandler(w http.ResponseWriter, r *http.Request) {\n  ctx := context.WithValue(r.Context(), \"request\", r)\n  otherFunc(ctx)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 475, "user_id": 2650745, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f7f5a60a4cc07e1843cf9e00e4b322d2?s=128&d=identicon&r=PG&f=1", "display_name": "Xoroxoxoxoxoso", "link": "https://stackoverflow.com/users/2650745/xoroxoxoxoxoso"}, "edited": false, "score": 0, "creation_date": 1576063907, "post_id": 59284584, "comment_id": 104775272, "body": "In the article, you pointed to, the author is creating a new context in the <code>handleSearch</code> <a href=\"https://blog.golang.org/context/server/server.go\" rel=\"nofollow noreferrer\">function</a>. This context is created from <code>context.Background()</code>.  I must be missing something but why not to derive a new context from the request&#39;s context?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 475, "user_id": 2650745, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f7f5a60a4cc07e1843cf9e00e4b322d2?s=128&d=identicon&r=PG&f=1", "display_name": "Xoroxoxoxoxoso", "link": "https://stackoverflow.com/users/2650745/xoroxoxoxoxoso"}, "edited": false, "score": 2, "creation_date": 1576064504, "post_id": 59284584, "comment_id": 104775559, "body": "@Xoroxoxoxoxoso You&#39;re not missing anything, that&#39;s how you should do it &quot;today&quot;. The blog article was published in 2014, and context support was only added to <code>http.Request</code> in Go 1.7 which was released in 2016. So in 2014 <code>Request.Context()</code> did not exist."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1576073797, "post_id": 59284584, "comment_id": 104780595, "body": "@icza is correct; before <code>http.Request</code> gained support for contexts, one could use <a href=\"https://golang.org/pkg/net/http/#CloseNotifier\" rel=\"nofollow noreferrer\"><code>CloseNotifier</code></a>. The context was first developed as a separate package, but turned out to be so useful it <a href=\"https://golang.org/doc/go1.7#context\" rel=\"nofollow noreferrer\">got integrated into the standard library in 1.7</a>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 475, "user_id": 2650745, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f7f5a60a4cc07e1843cf9e00e4b322d2?s=128&d=identicon&r=PG&f=1", "display_name": "Xoroxoxoxoxoso", "link": "https://stackoverflow.com/users/2650745/xoroxoxoxoxoso"}, "edited": false, "score": 0, "creation_date": 1576851420, "post_id": 59284584, "comment_id": 105039473, "body": "@Xoroxoxoxoxoso, you might find <a href=\"https://github.com/anexia-it/talk-needctx\" rel=\"nofollow noreferrer\">these examples from a recent Go Graz meetup talk</a> useful."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 4, "last_activity_date": 1576063275, "last_edit_date": 1576063275, "creation_date": 1576062926, "answer_id": 59284584, "question_id": 59284377, "link": "https://stackoverflow.com/questions/59284377/should-i-create-new-context-in-each-incoming-request/59284584#59284584", "title": "Should I create new context in each incoming request?", "body": "<p>You might be missing the <em>main</em> point of contexts \u2014 supposedly due to poor HOWTOs you're dealing with.</p>\n\n<p>The possiblility of carrying around arbitrary values in contexts is actually a misfeature of this type, regretted by its designers because it creates an anti-pattern (a proper way to deal with context-as-some-state is to have a set of values explicitly passed around).</p>\n\n<p>The chief reason contexts exist is because they provide tree-like propagation of a signal (cancellation or \"done\" in the case of contexts).\nSo the original idea behind contexts is like follows:</p>\n\n<ol>\n<li><p>The \"root\" context object is created for an incoming request.</p></li>\n<li><p>Each \"task\" which is needed to be executed on behalf of the request is associated with its own context, derived from that of the request.</p></li>\n<li><p>Those tasks may produce other tasks and so on.</p>\n\n<p>As you can see, a hierarchy of \"units of works\" is formed, \u2014 linked to the object which is the reason for these units to exist and execute.</p></li>\n<li><p>When the incoming request is cancelled (the client's socket got disconnected, for example), the context object associated with it is cancelled as well, and then all the linked tasks receive it as it's propagated from the root of the resulting context tree down to its leaves \u2014 making sure all the tasks being executed <em>for</em> the request are (eventually) cancelled.</p>\n\n<p>Of course, in order for this to work, each \"task\" \u2014 which is usually a goroutine doing something \u2014 is required to \"listen\" from the context passed to it for that \"done\" signal.</p></li>\n</ol>\n\n<p>Contexts also support timeout out of the box, so you might create a context which cancels itself after some fixed time interval passes.</p>\n\n<p>So, back to the examples in your question.</p>\n\n<p>The first example ignores the request's context completely and creates a from-scratch context ostensibly with the sole reason to carry stuff in it (bad).</p>\n\n<p>The second example might use the context for its intended purpose (but we do not know as we cannot see that <code>otherFunc</code>).</p>\n\n<p>I would advise you to read <a href=\"https://blog.golang.org/context\" rel=\"nofollow noreferrer\">https://blog.golang.org/context</a>, and the articles on concurrency patters in Go linked there.</p>\n"}], "owner": {"reputation": 475, "user_id": 2650745, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f7f5a60a4cc07e1843cf9e00e4b322d2?s=128&d=identicon&r=PG&f=1", "display_name": "Xoroxoxoxoxoso", "link": "https://stackoverflow.com/users/2650745/xoroxoxoxoxoso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 59284584, "answer_count": 2, "score": 0, "last_activity_date": 1576063275, "creation_date": 1576062230, "question_id": 59284377, "link": "https://stackoverflow.com/questions/59284377/should-i-create-new-context-in-each-incoming-request", "title": "Should I create new context in each incoming request?", "body": "<p>For the past few days, I've been reading about Go and one concept that I keep returning to are contexts.</p>\n\n<p>I think I understand the motivation behind creating such a structure. The thing that I don't understand is a particular use case when using a context in the incoming HTTP request.</p>\n\n<p>Let's say we have a following <code>httpHandlerFunc</code>. Inside that handler, we call a function that requires a context to be passed. I often saw this solution</p>\n\n<pre><code>func myHandler(w http.ResponseWriter, r *http.Request) {\n  ctx := context.WithValue(context.Background(), \"request\", r)\n  otherFunc(ctx)\n}\n</code></pre>\n\n<p>My question is, why don't we just pass a context from the request, like so</p>\n\n<pre><code>func myHandler(w http.ResponseWriter, r *http.Request) {\n  otherFunc(r.Context())\n}\n</code></pre>\n\n<p>Doesn't it make more sense to pass the context of the request since we want the context to flow through our program? I thought that creating a background context is something we want to do only in the root parent, like <code>init()</code> function.</p>\n"}, {"tags": ["go", "grpc"], "owner": {"reputation": 385, "user_id": 8249447, "user_type": "registered", "profile_image": "https://graph.facebook.com/2019240481630479/picture?type=large", "display_name": "Tr\u1ea7n Xu&#226;n Huy", "link": "https://stackoverflow.com/users/8249447/tr%e1%ba%a7n-xu%c3%a2n-huy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1091, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1576061005, "creation_date": 1576061005, "question_id": 59283985, "link": "https://stackoverflow.com/questions/59283985/time-time-is-not-proto-message-missing-method-protomessage", "title": "*time.Time is not proto.Message: missing method ProtoMessage", "body": "<p>I have a grpc server.\ngrpc is working fine but there is an error that prevents response from http server.</p>\n\n<p>this is the <code>a.proto</code> file</p>\n\n<pre><code>syntax = \"proto3\";\n// option go_package here\n\nimport \"google/api/annotations.proto\";\nimport \"protoc-gen-swagger/options/annotations.proto\";\nimport \"google/protobuf/timestamp.proto\";\nimport \"github.com/gogo/protobuf/gogoproto/gogo.proto\";\nimport \"github.com/mwitkow/go-proto-validators/validator.proto\";\n\noption (grpc.gateway.protoc_gen_swagger.options.openapiv2_swagger) = {\n    info: {\n        version: \"0.0.1\";\n    };\n\n// Enable custom Marshal method.\noption (gogoproto.marshaler_all) = true;\n// Enable custom Unmarshal method.\noption (gogoproto.unmarshaler_all) = true;\n// Enable custom Size method (Required by Marshal and Unmarshal).\noption (gogoproto.sizer_all) = true;\n// Enable registration with golang/protobuf for the grpc-gateway.\noption (gogoproto.goproto_registration) = true;\n// Enable generation of XXX_MessageName methods for grpc-go/status.\noption (gogoproto.messagename_all) = true;\noption (gogoproto.gogoproto_import) = true;\n\nservice MyService {\n    rpc GetByUrl (GetRequest) returns (GetResponse) {\n        option (google.api.http) = {\n            get: \"/v0/me/{url}\"\n        };\n    }\n}\n\nmessage GetResponse {\n    uint32 id = 1 [\n                  (gogoproto.customname) = \"Id\", (validator.field) = {\n            int_gt: 0\n            human_error: \"id must be a positive integer\"\n        }];\n\n    string url = 2 [(validator.field) = {\n            string_not_empty: true\n        }];\n\n    google.protobuf.Timestamp created_at = 3 [(gogoproto.stdtime) = true];\n    google.protobuf.Timestamp updated_at = 4 [(gogoproto.stdtime) = true];\n}\n\nmessage GetRequest {\n    string url = 1 [(validator.field) = {\n            string_not_empty: true\n        }];\n}\n</code></pre>\n\n<p>The grpc response : </p>\n\n<p><code>id:1 url:\"new.com\" created_at:&lt;seconds:1576053167 &gt; updated_at:&lt;seconds:1576053167 &gt;</code></p>\n\n<p>But the http server gives an error: </p>\n\n<pre><code>panic serving 127.0.0.1:54172: interface conversion: *time.Time is not proto.Message: missing method ProtoMessage\n</code></pre>\n\n<p>I already referred to <a href=\"https://github.com/gogo/protobuf/issues/212\" rel=\"nofollow noreferrer\">https://github.com/gogo/protobuf/issues/212</a></p>\n"}, {"tags": ["go", "concurrency", "channel"], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 7393681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bff443c258f65507a9f81f47e54d282c?s=128&d=identicon&r=PG&f=1", "display_name": "Fradifrad", "link": "https://stackoverflow.com/users/7393681/fradifrad"}, "edited": false, "score": 0, "creation_date": 1576059939, "post_id": 59283546, "comment_id": 104773044, "body": "ok, so &quot;send-only&quot; and &quot;receive-only&quot; describes the action I can do with the channel, and not the actions the channel can do. I got it now. Thank you so much !"}, {"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 0, "creation_date": 1576068627, "post_id": 59283546, "comment_id": 104777614, "body": "Technically speaking you could create &quot;send-only&quot; or &quot;receive-only&quot; channel. But I have never seen a reasonable using. Each channel have two ends, and make sense every time use both. However when you see <code>func() &lt;- chan int</code> and can decode it, you will understand - I could receive from returned channel. And when you see <code>func() chan &lt;- int</code> you know - your are responsible for sending data to channel and close it at proper time. Of course - the same for variable <code>var c &lt;- chan int</code> vs <code>var c chan &lt;- int</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 0, "creation_date": 1576074631, "post_id": 59283546, "comment_id": 104781101, "body": "@lofcek actually you can&#39;t create a send-only or receive-only channel, that would make no sense. You <i>can</i> have a send-only or receieve-only <i>reference</i> to a channel, so that you can declare at compile time which reference is the sender and which is the receiver; which makes the point of it pretty clear: it&#39;s not that the channel only has senders or only has receivers, it&#39;s just that it&#39;s clear which is which."}, {"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576141239, "post_id": 59283546, "comment_id": 104804792, "body": "@Adrian - you could do it .. Compiler allows you to write <code>ro := make(&lt;-chan int)</code> or <code>so := make(chan &lt;-int)</code>. But as I have already told - you take no advantage of such channels."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576164713, "post_id": 59283546, "comment_id": 104818107, "body": "The only use I can see for such a channel would be an interminable block (same as <code>select{}</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1576060039, "last_edit_date": 1576060039, "creation_date": 1576059666, "answer_id": 59283546, "question_id": 59283469, "link": "https://stackoverflow.com/questions/59283469/how-to-be-not-confused-about-a-channel-direction-in-go/59283546#59283546", "title": "How to be not confused about a channel direction in Go?", "body": "<p>The <em>channel</em> cannot send nor receive data. <em>You</em> can send data <em>on</em> the channel, and you can receive data <em>from</em> the channel. And then the direction is exactly what its name says.</p>\n\n<p>Also note that the \"arrow\" visualizes the direction. If it points toward the channel (toward the <code>chan</code>) like <code>c chan&lt;- int</code>, it's a send-only. If it points away from the channel (outward of the <code>chan</code>) like <code>c &lt;-chan int</code>, it's a receive-only.</p>\n\n<p>Same goes for actually sending anything on it (<a href=\"https://golang.org/ref/spec#Send_statements\" rel=\"nofollow noreferrer\">Send statement</a>) like <code>c &lt;- 1</code>, or receiving something from it (<a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"nofollow noreferrer\">Receive operator</a>) like <code>a = &lt;-c</code>.</p>\n"}], "owner": {"reputation": 25, "user_id": 7393681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bff443c258f65507a9f81f47e54d282c?s=128&d=identicon&r=PG&f=1", "display_name": "Fradifrad", "link": "https://stackoverflow.com/users/7393681/fradifrad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 59283546, "answer_count": 1, "score": 0, "last_activity_date": 1576060039, "creation_date": 1576059439, "question_id": 59283469, "link": "https://stackoverflow.com/questions/59283469/how-to-be-not-confused-about-a-channel-direction-in-go", "title": "How to be not confused about a channel direction in Go?", "body": "<p>I'm a newbie in Go, so sorry if my question seems stupid. </p>\n\n<p>I have a really hard time to get the channel syntax and vocabulary in Golang, especially when it's about direction. </p>\n\n<p>When I read that <code>c chan&lt;- int</code> is a \"send-only\" channel, I understand that this channel can only send data. But it seems to be the contrary, and that we can only put stuff into this chan. </p>\n\n<p>Same thing for the \"receive-only\" channel <code>c &lt;-chan int</code> : for me it's a channel that can only receive data, but it seems this kind of channel can only send data and not receive some.</p>\n\n<p>See, I'm really confused, so if you have a better way to explain it, or a good mnemonic way to understand it, I'll thank you for the rest of my days!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1576059158, "post_id": 59283314, "comment_id": 104772629, "body": "The <code>json:&quot;Alias,omitempty&quot;</code> tag and option is for the <code>encoding&#47;json</code> package. The <code>fmt</code> package doesn&#39;t care about that, it prints all fields."}, {"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1576059344, "post_id": 59283314, "comment_id": 104772712, "body": "How about other packages, like gorm for example.  Will it try to insert 0 for that key into the database?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1576059369, "post_id": 59283314, "comment_id": 104772728, "body": "Further, <code>omitempty</code> is only useful for JSON <i>encoding</i>. It has no effect at all for decoding."}, {"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "edited": false, "score": 0, "creation_date": 1576059435, "post_id": 59283314, "comment_id": 104772763, "body": "Ok thanks guys. If someone wants to write an answer, I will accept it."}], "answers": [{"comments": [{"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "edited": false, "score": 0, "creation_date": 1576060102, "post_id": 59283470, "comment_id": 104773130, "body": "ok thanks,  would I need to dereference the pointer then, If I want to insert it with gorm?"}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "reply_to_user": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "edited": false, "score": 1, "creation_date": 1576060195, "post_id": 59283470, "comment_id": 104773178, "body": "I&#39;m not familiar with gorm but I think it should handle pointers well."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576074751, "post_id": 59283470, "comment_id": 104781168, "body": "If you want to control what gorm does, you&#39;ll need to use its tags. It doesn&#39;t care about <code>json</code> tags, which are for the json package."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 3, "last_activity_date": 1576059443, "creation_date": 1576059443, "answer_id": 59283470, "question_id": 59283314, "link": "https://stackoverflow.com/questions/59283314/how-to-omit-empty-json-fields-using-json-decoder/59283470#59283470", "title": "How to omit empty json fields using json.decoder", "body": "<p>You need to define Empty as <code>*int</code> so it will be replaced with nil when there is no value. Then it will not be saved in the database.</p>\n"}], "owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 288, "favorite_count": 0, "accepted_answer_id": 59283470, "answer_count": 1, "score": 0, "last_activity_date": 1576059443, "creation_date": 1576058956, "last_edit_date": 1576059347, "question_id": 59283314, "link": "https://stackoverflow.com/questions/59283314/how-to-omit-empty-json-fields-using-json-decoder", "title": "How to omit empty json fields using json.decoder", "body": "<p>I try to understand why both functions return the same output.\nAs far as I understood, the point of omit empty is to not add that key to the result struct.</p>\n\n<p>I wrote this example, I was expecting the first output not to have the \"Empty\" key, but for some reason its value still shows as 0.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"strings\"\n)\n\ntype agentOmitEmpty struct {\n    Alias   string `json:\"Alias,omitempty\"`\n    Skilled bool   `json:\"Skilled,omitempty\"`\n    FinID   int32  `json:\"FinId,omitempty\"`\n    Empty   int    `json:\"Empty,omitempty\"`\n}\n\ntype agent struct {\n    Alias   string `json:\"Alias\"`\n    Skilled bool   `json:\"Skilled\"`\n    FinID   int32  `json:\"FinId\"`\n    Empty   int    `json:\"Empty\"`\n}\n\nfunc main() {\n    jsonString := `{\n        \"Alias\":\"Robert\",\n        \"Skilled\":true,\n        \"FinId\":12345\n    }`\n\n    fmt.Printf(\"output with omit emtpy: %v\\n\", withEmpty(strings.NewReader(jsonString)))\n    // output with omit emtpy: {Robert true 12345 0}\n\n    fmt.Printf(\"output regular: %v\\n\", withoutEmpty(strings.NewReader(jsonString)))\n    // output without omit: {Robert true 12345 0}\n}\n\nfunc withEmpty(r *strings.Reader) agentOmitEmpty {\n    dec := json.NewDecoder(r)\n    body := agentOmitEmpty{}\n    err := dec.Decode(&amp;body)\n    if err != nil {\n        panic(err)\n    }\n    return body\n}\n\nfunc withoutEmpty(r *strings.Reader) agent {\n    dec := json.NewDecoder(r)\n    body := agent{}\n    err := dec.Decode(&amp;body)\n    if err != nil {\n        panic(err)\n    }\n    return body\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1576055146, "post_id": 59282099, "comment_id": 104770365, "body": "You claimed <code>Content JsonContent `json:&quot;content&quot;`</code> is a <code>JsonContent</code>, while it&#39;s an array of them, hence <code>[]JsonContent</code>"}, {"owner": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 1, "creation_date": 1576055198, "post_id": 59282099, "comment_id": 104770399, "body": "as you can see in the example json, the content field is actually an array. In your go struct it&#39;s not. You have to change the struct to Content []JsonContent <code>json:&quot;content&quot;</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1576055400, "post_id": 59282099, "comment_id": 104770523, "body": "The title of your question explains the problem: You cannot unmarshal an array into a struct. You must unmarshal an array into an array or slice."}, {"owner": {"reputation": 59, "user_id": 12517042, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mD8Ngkz6mhhuF4ZEWIQsf1D2qmtXTV5XsEYnf4Y=k-s128", "display_name": "TraineeGuy", "link": "https://stackoverflow.com/users/12517042/traineeguy"}, "edited": false, "score": 0, "creation_date": 1576059199, "post_id": 59282099, "comment_id": 104772650, "body": "I understand, i&#39;m very new to Golang, just coming over from Python. I&#39;m a trainee trying to learn :)"}], "answers": [{"tags": [], "owner": {"reputation": 59, "user_id": 12517042, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mD8Ngkz6mhhuF4ZEWIQsf1D2qmtXTV5XsEYnf4Y=k-s128", "display_name": "TraineeGuy", "link": "https://stackoverflow.com/users/12517042/traineeguy"}, "is_accepted": true, "score": 0, "last_activity_date": 1576055477, "creation_date": 1576055477, "answer_id": 59282220, "question_id": 59282099, "link": "https://stackoverflow.com/questions/59282099/unable-to-unmarshal-json-data-to-structs-in-go-cannot-unmarshal-array-into-go-s/59282220#59282220", "title": "Unable to unmarshal json data to structs in go (cannot unmarshal array into Go struct field)", "body": "<p>The solution has been found by the two lovely people \"zerkms\", \"tclass\".</p>\n\n<p>You claimed Content JsonContent <code>json:\"content\"</code> is a JsonContent, while it's an array of them, hence []JsonContent</p>\n\n<p>as you can see in the example json, the content field is actually an array. In your go struct it's not. You have to change the struct to Content []JsonContent json:\"content\"</p>\n\n<p>Thank you guys so much! </p>\n"}], "owner": {"reputation": 59, "user_id": 12517042, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mD8Ngkz6mhhuF4ZEWIQsf1D2qmtXTV5XsEYnf4Y=k-s128", "display_name": "TraineeGuy", "link": "https://stackoverflow.com/users/12517042/traineeguy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 59282220, "answer_count": 1, "score": -3, "last_activity_date": 1576055477, "creation_date": 1576055035, "last_edit_date": 1576055345, "question_id": 59282099, "link": "https://stackoverflow.com/questions/59282099/unable-to-unmarshal-json-data-to-structs-in-go-cannot-unmarshal-array-into-go-s", "title": "Unable to unmarshal json data to structs in go (cannot unmarshal array into Go struct field)", "body": "<p>I am using an API to receive all job ads from a certain organization, the JSON data I receive is very large and I would like to use this data in Go, however I am experiencing problems unmarshaling into structs so I can use it further. It may be a very simple solution that is blind for me because I this problem is causing some headache. The API key in the code is public therefore there is no problem sharing it with Stackoverflow.</p>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\ntype JsonData struct {\n    Content JsonContent `json:\"content\"`\n    TotalElements int `json:\"totalElements\"`\n    PageNumber int `json:\"pageNumber\"`\n    PageSize int `json:\"pageSize\"`\n    TotalPages int `json:\"totalPages\"`\n    First bool `json:\"first\"`\n    Last bool `json:\"last\"`\n    Sort string `json:\"sort\"`\n}\ntype JsonContent struct {\n    Uuid string `json:\"uuid\"`\n    Published string `json:\"published\"`\n    Expires string `json:\"expires\"`\n    Updated string `json:\"updated\"`\n    WorkLoc WorkLocations `json:\"workLocations\"`\n    Title string `json:\"title\"`\n    Description string `json:\"description\"`\n    SourceUrl string `json:\"sourceurl\"`\n    Source string `json:\"source\"`\n    ApplicationDue string `json:\"applicationDue\"`\n    OccupationCat OccupationCategories `json:\"occupationCategories\"`\n    JobTitle string `json:\"jobtitle\"`\n    Link string `json:\"link\"`\n    Employ Employer `json:\"employer\"`\n    EngagementType string `json:\"engagementtype\"`\n    Extent string `json:\"extent\"`\n    StartTime string `json:\"starttime\"`\n    PositionCount interface{} `json:\"positioncount\"`\n    Sector string `json:\"sector\"`\n}\ntype WorkLocations struct {\n    Country string `json:\"country\"`\n    Address string `json:\"address\"`\n    City string `json:\"city\"`\n    PostalCode string `json:\"postalCode\"`\n    County string `json:\"county\"`\n    Municipal string `json:\"municipal\"`\n}\ntype OccupationCategories struct {\n    Level1 string `json:\"level1\"`\n    Level2 string `json:\"level2\"`\n}\ntype Employer struct {\n    Name string `json:\"name\"`\n    Orgnr string `json:\"orgnr\"`\n    Description string `json:\"description\"`\n    Homepage interface{} `json:\"homepage\"`\n}\nfunc main() {\n    var datas JsonData\n    url := \"https://arbeidsplassen.nav.no/public-feed/api/v1/ads?page=1&amp;size=5000&amp;published=%2A&amp;county=Oslo\"\n\n    // Create a Bearer string by appending string access token\n    var bearer = \"Bearer \" + \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJwdWJsaWMudG9rZW4udjFAbmF2Lm5vIiwiYXVkIjoiZmVlZC1hcGktdjEiLCJpc3MiOiJuYXYubm8iLCJpYXQiOjE1NTc0NzM0MjJ9.jNGlLUF9HxoHo5JrQNMkweLj_91bgk97ZebLdfx3_UQ\"\n\n    // Create a new request using http\n    req, err := http.NewRequest(\"GET\", url, nil)\n\n    // add authorization header to the req\n    req.Header.Add(\"Authorization\", bearer)\n\n    // Send req using http Client\n    client := &amp;http.Client{}\n\n    resp, err := client.Do(req)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    body, _ := ioutil.ReadAll(resp.Body)\n    fmt.Println(string(body))\n\n    err = json.Unmarshal(body, &amp;datas)\n    if err != nil {\n        log.Fatal(err)\n    }\n    // fmt.Println(datas.TotalPages)\n}\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>2019/12/11 09:52:35 json: cannot unmarshal array into Go struct field JsonData.content of type main.JsonContent\n</code></pre>\n\n<p>example of one 'uuid':</p>\n\n<pre><code>{\"content\":[{\"uuid\":\"e2b6dcd2-434e-479d-a9bc-12d1e5c54a92\",\"published\":\"2019-12-10T12:05:46.613949Z\",\"expires\":\"2020-01-17T21:59:00Z\",\"updated\":\"2019-12-10T12:05:46.676935Z\",\"workLocations\":[{\"country\":\"NORGE\",\"address\":\"Filipstad Brygge 2\",\"city\":\"OSLO\",\"postalCode\":\"0252\",\"county\":\"OSLO\",\"municipal\":\"OSLO\"}],\"title\":\"Business Controller til analyse- og prosjektarbeid\",\"description\":\"&lt;p&gt;For v\u00e5r kunde s\u00f8ker vi en analytisk person, som har god system- og forretningsforst\u00e5else. Dette er et engasjement med oppstart i desember/januar, med varighet p\u00e5 10-14 m\u00e5neder.&lt;/p&gt;\\n&lt;p&gt;Som Business Controller i denne rollen vil man jobbe variert. Den rette kandidaten vil arbeide tett sammen med leder for \u00f8konomiavdelingen og opp mot andre avdelinger i selskapet. Arbeidet vil inneb\u00e6re analyser, rapportering, budsjettering og prosjektarbeid. Dette kan ogs\u00e5 inneb\u00e6re arbeid innen M&amp;amp;A og med l\u00f8nnsomhets- og kostnadsanalyser. Videre vil det v\u00e6re oppf\u00f8lging av n\u00f8kkeltallsinformasjon, m\u00e5nedlig rapportering og budsjettarbeid.&lt;/p&gt;\\n&lt;p&gt;Vi ser etter deg som har jobbet fra 1-3 \u00e5r i tilsvarende stilling og/eller bakgrunn fra revisjon. Videre har du master grad i finans/\u00f8konomi/revisjon eller tilsvarende.&lt;/p&gt;\\n&lt;p&gt;Vi kan tilby en spennende mulighet hos v\u00e5r kunde, som har et godt arbeidsmilj\u00f8 og vet \u00e5 verdsette dyktige medarbeidere.&lt;/p&gt;\\n&lt;p&gt;Virker dette interessant ber vi deg s\u00f8ke via www.financepeople.no. Ved sp\u00f8rsm\u00e5l kan du kontakte FinancePeople ved Kristoffer Skogsrud Bugge p\u00e5 telefon &amp;#43;47 91 17 17 29 eller p\u00e5 mail kristoffer&amp;#64;financepeople.no&lt;/p&gt;\\n\",\"sourceurl\":\"https://www.finn.no/164952298\",\"source\":\"FINN\",\"applicationDue\":\"Vi behandler s\u00f8knader fortl\u00f8pende\",\"occupationCategories\":[{\"level1\":\"Kontor og \u00f8konomi\",\"level2\":\"Bank finans forsikring\"}],\"jobtitle\":\"Business Controller\",\"link\":\"https://arbeidsplassen.nav.no/stillinger/stilling/e2b6dcd2-434e-479d-a9bc-12d1e5c54a92\",\"employer\":{\"name\":\"For kunde\",\"orgnr\":\"997058682\",\"description\":\"&lt;p&gt;FinancePeople AS er et spesialisert rekrutterings- og konsulentselskap innenfor \u00f8konomi, regnskap og finans. V\u00e5re r\u00e5dgivere er \u00f8konomer med relevant erfaring innenfor v\u00e5re fokusomr\u00e5der. Gjennom v\u00e5re prosesser vektlegger vi h\u00f8y kvalitet og verdiskaping - b\u00e5de for v\u00e5re kunder og kandidater. For mer informasjon, se v\u00e5r hjemmeside www.financepeople.no.&lt;/p&gt;\\n\",\"homepage\":\"http://www.financepeople.no\"},\"engagementtype\":\"Engasjement\",\"extent\":\"Heltid\",\"starttime\":\"Desember 2019\",\"positioncount\":null,\"sector\":\"Privat\"},{\"uuid\":\"968cbdaf-6bad-4b0e-8e37-8fdec9a967cb\",\"published\":\"2019-12-10T12:04:42.861718Z\",\"expires\":\"2019-12-21T23:00:00Z\",\"updated\":\"2019-12-10T12:04:43.359474Z\",\"workLocations\":[{\"country\":\"NORGE\",\"address\":null,\"city\":\"OSLO\",\"postalCode\":\"0161\",\"county\":\"OSLO\",\"municipal\":\"OSLO\"}],\"title\":\"Er du sykepleier med erfaring fra legevakt eller akuttmottak?\",\"description\":\"&lt;p&gt;Da er du den vi s\u00f8ker til legevakt i Akershus.&lt;br /&gt;\\nSnarlig tiltredelse i 3-delt turnus. Du m\u00e5 ha erfaring fra legevakt eller akuttmottak, lang erfaring fra sykehus kan evt kompensere for dette.&lt;/p&gt;\\n&lt;p&gt;Du f\u00e5r sjansen til \u00e5 jobbe p\u00e5 et spennende arbeidssted og til \u00e5 f\u00e5 brukt din kompetanse, samtidig som du utvikler deg videre og tilegner deg relevant erfaring.&lt;/p&gt;\\n&lt;p&gt;Ved \u00e5 jobbe gjennom Randstad care f\u00e5r du mulighet til \u00e5 ha en fleksibel jobb med gode betingelser og et trygt og lovregulert arbeidsforhold.&lt;/p&gt;\\n&lt;p&gt;&lt;strong&gt;Kvalifikasjoner:&lt;/strong&gt;&lt;/p&gt;\\n&lt;p&gt;Norsk autorisasjon som sykepleier\\nEvne til \u00e5 jobbe selvstendig og samtidig ha gode samarbeidsevner.&lt;/p&gt;\\n&lt;p&gt;Erfaring fra legevakt eller akuttmottak (lang sykehuserfaring kan kompensere for dette)&lt;/p&gt;\\n&lt;p&gt;Gyldig politiattest&lt;/p&gt;\\n&lt;p&gt;Snakker et skandinavisk spr\u00e5k&lt;/p&gt;\\n&lt;p&gt;&lt;strong&gt;Vi tilbyr:&lt;/strong&gt;&lt;/p&gt;\\n&lt;p&gt;En fast kontaktperson som f\u00f8lger deg gjennom oppdraget.&lt;/p&gt;\\n&lt;p&gt;Vi gir l\u00f8nn over tariff. Du vil f\u00e5 12 % feriepenger og selvsagt alle tillegg for ubekvem arbeidstid som du har krav p\u00e5, men i tillegg gir vi ekstra 100 % overtid etter 35,5t.&lt;/p&gt;\\n&lt;p&gt;Vi dekker bolig og reiseutgifter til pendlerbolig om du bor et stykke unna&lt;/p&gt;\\n&lt;p&gt;Vi har gode pensjons- og forsikringsordninger.&lt;/p&gt;\\n&lt;p&gt;Hos blir du ivaretatt slik du b\u00f8r, og vi strekker oss langt for \u00e5 fylle dine \u00f8nsker.&lt;/p&gt;\\n&lt;p&gt;&lt;strong&gt;\u00d8nsker du mer informasjon om jobbmuligheter hos oss? Ta kontakt med Pia Eyde &amp;#43;47 99 52 01 36 eller s\u00f8k p\u00e5 stillingen n\u00e5 ved \u00e5 sende CV til care&amp;#64;randstad.no.&lt;/strong&gt;&lt;/p&gt;\\n\",\"sourceurl\":\"https://www.finn.no/165150463\",\"source\":\"FINN\",\"applicationDue\":\"22.12.2019\",\"occupationCategories\":[{\"level1\":\"Helse og sosial\",\"level2\":\"Sykepleier\"}],\"jobtitle\":\"Sykepleier\",\"link\":\"https://arbeidsplassen.nav.no/stillinger/stilling/968cbdaf-6bad-4b0e-8e37-8fdec9a967cb\",\"employer\":{\"name\":\"Randstad care\",\"orgnr\":\"980567583\",\"description\":\"&lt;p&gt;Randstad Care AS er et av de st\u00f8rste vikarbyr\u00e5ene for helsepersonell i Norden. Vi formidler sykepleiere til alle offentlige sykehus i Norge gjennom samarbeidsavtaler med de fire Helseforetakene. I tillegg har vi oppdrag for ulike kommuner og private helseakt\u00f8rer rundt om i landet. Som del av den nordiske Randstadorganisasjonen, formidler vi ogs\u00e5 oppdrag i Sverige. Med engasjement og lydh\u00f8rhet \u00f8nsker vi \u00e5 bidra med \u00e5 finne og utvikle bemanningsl\u00f8sninger innen v\u00e5r bransje.&lt;/p&gt;\\n\",\"homepage\":null},\"engagementtype\":\"Vikariat\",\"extent\":\"Heltid\",\"starttime\":\"Snarest\",\"positioncount\":\"2\",\"sector\":\"Privat\"},{\"uuid\":\"b28d365c-942b-4267-a3ae-048438a1c0fd\",\"published\":\"2019-12-10T12:02:54.46225Z\",\"expires\":\"2019-12-17T23:00:00Z\",\"updated\":\"2019-12-10T12:02:54.545309Z\",\"workLocations\":[{\"country\":\"NORGE\",\"address\":\"Drammensveien 60\",\"city\":\"OSLO\",\"postalCode\":\"0271\",\"county\":\"OSLO\",\"municipal\":\"OSLO\"}],\"title\":\"Veileder/sosialkonsulent\",\"description\":\"&lt;p&gt;Org. nr: - Stillingsident: 4166085237 Presentasjon av stillingen:&lt;/p&gt;\\n&lt;p&gt;Oppf\u00f8lging, veiledning og saksbehandling&lt;/p&gt;\\n&lt;p&gt;(Vikariatet inng\u00e5r i helseavklaringsprosjektet ved kontoret)&lt;/p&gt;\\n&lt;h3&gt;Arbeidsoppgaver&lt;/h3&gt;\\n&lt;p&gt;Arbeidsrettet oppf\u00f8lging og avklaring, bruke tiltak og virkemidler&lt;/p&gt;\\n&lt;p&gt;Saksbehandle s\u00f8knader om sosialhjelp og klager&lt;/p&gt;\\n&lt;p&gt;Gi r\u00e5d og veiledning etter lov om sosiale tjenester i NAV&lt;/p&gt;\\n&lt;p&gt;F\u00f8lge opp egen brukerportef\u00f8lje&lt;/p&gt;\\n&lt;p&gt;Samarbeide med kollegaer, leger/behandlere, tiltaksarrang\u00f8rer, andre tjenester i bydel, m.fl.&lt;/p&gt;\\n&lt;p&gt;Noe arbeid i vaktordning&lt;/p&gt;\\n&lt;p&gt;V\u00e6re god representant for NAV Frogner&lt;/p&gt;\\n&lt;p&gt;Gi brukere god service&lt;/p&gt;\\n&lt;h3&gt;Kvalifikasjoner&lt;/h3&gt;\\n&lt;p&gt;Bachelor i sosialt arbeid (minimum)&lt;/p&gt;\\n&lt;p&gt;Erfaring med tilsvarende oppgaver fra NAV-kontor gjennom lengre tid&lt;/p&gt;\\n&lt;p&gt;Dokumenterte resultater fra tidligere arbeid&lt;/p&gt;\\n&lt;p&gt;Gode ferdigheter i relevante fagsystemer&lt;/p&gt;\\n&lt;p&gt;Sterk i b\u00e5de muntlig og skriftlig kommunikasjon&lt;/p&gt;\\n&lt;p&gt;God forst\u00e5else for offentlig forvaltning&lt;/p&gt;\\n&lt;p&gt;Personlig egnethet&lt;/p&gt;\\n&lt;h3&gt;Personlige egenskaper&lt;/h3&gt;\\n&lt;p&gt;Du er p\u00e5g\u00e5ende og fleksibel, litt ut\u00e5lmodig, men utholdende. God med ulike mennesker, liker samtaler og samarbeid med andre. Du har ryddighet i eget arbeid, og er en systematiker med rom ogs\u00e5 for dine kollegaer og ditt arbeidsmilj\u00f8. Du ser etter l\u00f8sninger, er god p\u00e5 v\u00e5rt samfunnsoppdrag og v\u00e5re oppgaver, men t\u00f8r \u00e5 reflektere selvstendig og \u00e5 v\u00e6re kritisk.&lt;/p&gt;\\n&lt;h3&gt;Vi tilbyr&lt;/h3&gt;\\n&lt;ul&gt;&lt;li&gt;\\n&lt;p&gt;Spennende og krevende arbeidsdager i et godt og engasjert milj\u00f8&lt;/p&gt;\\n&lt;p&gt;Gode lokaler med treningsmuligheter&lt;/p&gt;\\n&lt;/li&gt;&lt;li&gt;\\n&lt;p&gt;God pensjonsordning&lt;/p&gt;\\n&lt;p&gt;L\u00f8nnsplassering i Oslo kommune l\u00f8nnstrinn 34 - 43 (kr. 479 600 - 561 600) avhengig av ansiennitet&lt;/p&gt;\\n&lt;p&gt;Faglig og personlig utvikling&lt;/p&gt;\\n&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;/ul&gt;\\n&lt;h3&gt;Kontaktinformasjon&lt;/h3&gt;\\n&lt;p&gt;Geir Olav Maribo, 21802180&lt;/p&gt;\\n&lt;h3&gt;Arbeidssted&lt;/h3&gt;\\n&lt;p&gt;Drammensveien 60&lt;br /&gt;\\n0271 OSLO&lt;/p&gt;\\n&lt;p&gt;S\u00f8k p\u00e5 stillingen:&lt;a href=\\\"https://candidate.webcruiter.com/cv?advertid&amp;#61;4166085237&amp;amp;language&amp;#61;nb&amp;amp;link_source_id&amp;#61;17\\\" rel=\\\"nofollow\\\"&gt;Klikk her&lt;/a&gt;&lt;/p&gt;\\n&lt;h3&gt;N\u00f8kkelinformasjon:&lt;/h3&gt;\\n&lt;p&gt;Arbeidsgiver:Oslo kommune&lt;/p&gt;\\n&lt;p&gt;Referansenr.:4166085237&lt;br /&gt;\\nStillingsprosent: 100%&lt;br /&gt;\\nFast&lt;br /&gt;\\nStartdato: 02.01.2020&lt;br /&gt;\\nS\u00f8knadsfrist: 18.12.2019&lt;/p&gt;\\n\",\"sourceurl\":null,\"source\":\"XML_STILLING\",\"applicationDue\":\"2019-12-18T00:00\",\"occupationCategories\":[{\"level1\":\"Utdanning\",\"level2\":\"SFO, barne- og fritidsleder\"}],\"jobtitle\":null,\"link\":\"https://arbeidsplassen.nav.no/stillinger/stilling/b28d365c-942b-4267-a3ae-048438a1c0fd\",\"employer\":{\"name\":\"Avdeling Oppf\u00f8lging 1, Oslo kommune, Bydel Frogner\",\"orgnr\":\"974589230\",\"description\":\"&lt;p&gt;Bydel Frogner er en sentrumsbydel vest i Oslo med urbane kvaliteter og naturomr\u00e5der som Bygd\u00f8y og Frognerparken. Bydelen grenser til bydelene Ullern, Vestre Aker, Nordre Aker og St. Hanshaugen, samt Oslofjorden og sentrum.&lt;/p&gt;\\n&lt;p&gt;Bydel Frogner skal tilby sine rett i underkant av 60 000 innbyggere gode og tilgjengelige tjenester. Samtidig skal bydelen v\u00e6re en offensiv p\u00e5driver i samfunns- og infrastrukturutviklingen, legge til rette for et aktivt lokalengasjement og sikre gode urbane kvaliteter. Tjenestene v\u00e5re har fokus p\u00e5 forebyggende arbeid og tidlig intervensjon, kvalitet og forutsigbarhet , gjennom god og tydelig kommunikasjon.&lt;/p&gt;\\n&lt;p&gt;For mer informasjon om oss, g\u00e5 inn p\u00e5 Oslo kommunes nettside og Bydel Frogner se &lt;a href=\\\"http://www.bydel-frogner.oslo.kommune.no/\\\" rel=\\\"nofollow\\\"&gt;www.bydel-frogner.oslo.kommune.no&lt;/a&gt; . Vi er ogs\u00e5 til stede p\u00e5 Facebook og Instagram&lt;/p&gt;\\n&lt;p&gt;Arbeidsplassene i Oslo kommune skal preges av mangfold, og v\u00e5re ansatte skal gjenspeile byens befolkning. Vi oppfordrer alle som er kvalifisert til \u00e5 s\u00f8ke jobb hos oss uansett alder, funksjonsevne, kj\u00f8nn, seksuell orientering, religion eller etnisk bakgrunn. Oslo kommune legger vekt p\u00e5 \u00e5 tilrettelegge arbeidsforholdene dersom du har behov for det.&lt;/p&gt;\\n\",\"homepage\":null},\"engagementtype\":\"Vikariat\",\"extent\":\"Heltid\",\"starttime\":\"2020-01-02T00:00\",\"positioncount\":\"2\",\"sector\":\"Offentlig\"}\n</code></pre>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1576051800, "post_id": 59281024, "comment_id": 104768767, "body": "What is <code>logger</code> in the posted code?  The string <code>&quot;\\347\\276\\216\\345\\233\\275\\&quot;</code> contains the octal escapes for <code>&quot;\u7f8e\u56fd&quot;</code>."}, {"owner": {"reputation": 19, "user_id": 12516624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-x18K5JJnVuI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfyPrRF3LOfsuMIpU9KX4UkrQvSng/photo.jpg?sz=128", "display_name": "LAMKEI", "link": "https://stackoverflow.com/users/12516624/lamkei"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1576052307, "post_id": 59281024, "comment_id": 104769008, "body": "var logger = logrus.New()"}], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 3, "last_activity_date": 1576053767, "last_edit_date": 1576053767, "creation_date": 1576053149, "answer_id": 59281616, "question_id": 59281024, "link": "https://stackoverflow.com/questions/59281024/get-struct-string-in-log-file/59281616#59281616", "title": "get struct string in log file", "body": "<p>The default logrus <a href=\"https://godoc.org/github.com/sirupsen/logrus#Formatter\" rel=\"nofollow noreferrer\">formatter</a> writes <a href=\"https://github.com/sirupsen/logrus/blob/master/README.md\" rel=\"nofollow noreferrer\">JSON with ASCII</a> encoding. You need to implement your own formatter and use UTF-8. See <a href=\"https://godoc.org/github.com/sirupsen/logrus#SetFormatter\" rel=\"nofollow noreferrer\">Logger.SetFormatter</a>.</p>\n\n<p>As I looked into the source code I didn't see any setting that can be set to change the encoding.</p>\n"}, {"tags": [], "owner": {"reputation": 19, "user_id": 12516624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-x18K5JJnVuI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfyPrRF3LOfsuMIpU9KX4UkrQvSng/photo.jpg?sz=128", "display_name": "LAMKEI", "link": "https://stackoverflow.com/users/12516624/lamkei"}, "is_accepted": false, "score": 0, "last_activity_date": 1576057013, "creation_date": 1576057013, "answer_id": 59282695, "question_id": 59281024, "link": "https://stackoverflow.com/questions/59281024/get-struct-string-in-log-file/59282695#59282695", "title": "get struct string in log file", "body": "<pre><code>func convertOctonaryUtf8(in string) string {\n    s := []byte(in)\n    reg := regexp.MustCompile(`\\\\[0-7]{3}`)\n\n    out := reg.ReplaceAllFunc(s,\n        func(b []byte) []byte {\n            i, _ := strconv.ParseInt(string(b[1:]), 8, 0)\n            return []byte{byte(i)}\n        })\n    return string(out)\n}\n</code></pre>\n\n<p>the func get the \"\\347\\276\\216\\345\\233\\275\\\" mean</p>\n"}], "owner": {"reputation": 19, "user_id": 12516624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-x18K5JJnVuI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfyPrRF3LOfsuMIpU9KX4UkrQvSng/photo.jpg?sz=128", "display_name": "LAMKEI", "link": "https://stackoverflow.com/users/12516624/lamkei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1576057013, "creation_date": 1576050561, "last_edit_date": 1576052512, "question_id": 59281024, "link": "https://stackoverflow.com/questions/59281024/get-struct-string-in-log-file", "title": "get struct string in log file", "body": "<p>I have a script to print the same log like:</p>\n\n<pre><code>type Country stuct{\n  cityName string\n}\n\nvar c Country\n</code></pre>\n\n<p>and I</p>\n\n<pre><code>var logger = logrus.New()\nlogger.Debug(c)\n</code></pre>\n\n<p>but in the log file, it looks like:</p>\n\n<pre><code>country_name:\\\"\\\\347\\\\276\\\\216\\\\345\\\\233\\\\275\\\" \n</code></pre>\n\n<p>I want to know what <code>\\\\347\\\\276\\\\216\\\\345\\\\233\\\\275\\</code>  means and how to read the true meanwhile my script read the log file.</p>\n"}, {"tags": ["go", "json-api"], "comments": [{"owner": {"reputation": 5849, "user_id": 657703, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/208ba006821bf4ab078692204d23ceee?s=128&d=identicon&r=PG", "display_name": "\u042f\u0440\u043e\u0441\u043b\u0430\u0432 \u0420\u0430\u0445\u043c\u0430\u0442\u0443\u043b\u043b\u0438\u043d", "link": "https://stackoverflow.com/users/657703/%d0%af%d1%80%d0%be%d1%81%d0%bb%d0%b0%d0%b2-%d0%a0%d0%b0%d1%85%d0%bc%d0%b0%d1%82%d1%83%d0%bb%d0%bb%d0%b8%d0%bd"}, "edited": false, "score": 1, "creation_date": 1576050241, "post_id": 59280462, "comment_id": 104768083, "body": "You need to provide the exact code you are using.  and the exact server-response in a serialized format. I think your issue lies in passig the stings / * string / buffer formats arround and you need to treat  apples as apples."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1576053580, "post_id": 59280462, "comment_id": 104769581, "body": "Whatever jsonapi.Marshal is, it&#39;s pretty clear that it&#39;s particular about its argument. You&#39;re passing a pointer to a slice. Have you tried passing &quot;a struct pointer or slice of struct pointers&quot; as the error says?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576075203, "post_id": 59280462, "comment_id": 104781434, "body": "Please update your question to include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">Minimal, Reproducible Example</a>."}], "owner": {"reputation": 17, "user_id": 12491532, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCoi_qyxGVc5zpHULHlbt5jRZpN7Elf_7FsP_sVKg=k-s128", "display_name": "koushik madhavan", "link": "https://stackoverflow.com/users/12491532/koushik-madhavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1576048240, "creation_date": 1576048119, "last_edit_date": 1576048240, "question_id": 59280462, "link": "https://stackoverflow.com/questions/59280462/getting-an-error-while-passing-array-of-objects-to-jsonapi-marshal", "title": "Getting an error while passing array of objects to jsonapi.marshal", "body": "<pre class=\"lang-golang prettyprint-override\"><code>type Response struct {\n    EmpID string                     `json:\"EmpID\" jsonapi:\"primary,Employee\"`\n    OwnerID   string                 `json:\"OwnerId\" jsonapi:\"attr,owner_id\"`\n    Start     string                 `json:\"Start\" jsonapi:\"attr,start\"`\n    End       string                 `json:\"End\" jsonapi:\"attr,end\"`\n    Metadata  map[string]interface{} `json:\"metadata\" jsonapi:\"attr,Metadata\"`\n}\n\nresponse :=[]*Response\n\nresponse = **// data here //**\n\nresult := &amp;response\n</code></pre>\n\n<p>Now, if i do , jsonapi.Marshal(result)</p>\n\n<p><strong>error</strong> : models should be a struct pointer or slice of struct pointers error</p>\n\n<p>I tried creating a new struct and placed the array struct inside this. Something like this.</p>\n\n<pre><code>type ArrayResponse struct {\nNewResponse *[]Response  `jsonapi:\"attr,NewResponse\"`\n}\n</code></pre>\n\n<p>Im getting all the data inside the attributes since i have mentioned attr in the above struct. But ideally, is there a way to get the array of objects to get marshalled in jsonapi, without doing this.\nI need the response in the below json api format.</p>\n\n<pre><code>{  \n\"data\":[  \n  {  \n     \"type\":\"filetype\",\n     \"id\":\"c33e05b7-8f55-4ee1-8d61-5b5da9110b2f\",\n     \"attributes\":{  \n        \"created_at\":\"2017-07-02T09:11:10.005351Z\",\n        \"updated_at\":\"2017-07-02T09:11:10.005374Z\",\n        \"created_by\":\"USER_ID\",\n        \"url_page\":null,\n        \"resource_urls\":null,\n        \"attachment_type_id\":\"1\",\n        \"url_type_id\":\"1\",\n        \"url_version\":null\n     },\n     \"relationships\":{  \n        \"item\":{  \n           \"data\":{  \n              \"type\":\"items\",\n              \"id\":\"f0c2e244-ec02-4a75-bd36-da1f703136e7\"\n           }\n        }\n     }\n  },\n  {  \n     \"type\":\"filetype\",\n     \"id\":\"cc06bbb5-b4f8-4351-90f3-01df3f3f2116\",\n     \"attributes\":{  \n        \"created_at\":\"2017-08-02T09:11:10.005351Z\",\n        \"updated_at\":\"2017-08-02T09:11:10.005374Z\",\n        \"created_by\":\"USER_ID\",\n        \"url_page\":null,\n        \"resource_urls\":null,\n        \"attachment_type_id\":\"1\",\n        \"url_type_id\":\"1\",\n        \"url_version\":null\n     },\n     \"relationships\":{  \n        \"item\":{  \n           \"data\":{  \n              \"type\":\"items\",\n              \"id\":\"b0300df2-365e-44b4-bfc4-f3170dca2289\"\n           }\n        }\n     }\n  }\n]}\n</code></pre>\n"}, {"tags": ["json", "go", "marshalling", "unmarshalling"], "answers": [{"tags": [], "owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "is_accepted": false, "score": 2, "last_activity_date": 1576046855, "creation_date": 1576046855, "answer_id": 59280194, "question_id": 59280101, "link": "https://stackoverflow.com/questions/59280101/parse-json-correctly-in-go/59280194#59280194", "title": "Parse JSON correctly in Go", "body": "<p>Unfortunately, you have to assert types every time you access the parsed data:</p>\n\n<pre><code>date := result[\"Info\"].(map[string]interface{})[\"Date\"]\n</code></pre>\n\n<p>Now <code>date</code> is <code>map[string]interface{}</code>, but its statically known type is still <code>interface{}</code>.</p>\n\n<p>That means you either need to assume the type in advance or have some kind of a <a href=\"https://tour.golang.org/methods/16\" rel=\"nofollow noreferrer\">type switch</a> if the structure may vary.</p>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 4509038, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b9vmMoy8F1A/AAAAAAAAAAI/AAAAAAAAAoQ/_OQY2viEAB4/photo.jpg?sz=128", "display_name": "Sayak Sen", "link": "https://stackoverflow.com/users/4509038/sayak-sen"}, "edited": false, "score": 0, "creation_date": 1576048603, "post_id": 59280196, "comment_id": 104767483, "body": "And how do I loop through each date in json_data? Thanks in Advance."}, {"owner": {"reputation": 2261, "user_id": 2809530, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/f7E46.jpg?s=128&g=1", "display_name": "Channa", "link": "https://stackoverflow.com/users/2809530/channa"}, "reply_to_user": {"reputation": 21, "user_id": 4509038, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b9vmMoy8F1A/AAAAAAAAAAI/AAAAAAAAAoQ/_OQY2viEAB4/photo.jpg?sz=128", "display_name": "Sayak Sen", "link": "https://stackoverflow.com/users/4509038/sayak-sen"}, "edited": false, "score": 0, "creation_date": 1576049329, "post_id": 59280196, "comment_id": 104767725, "body": "As @Markus W Mahlberg mentioned, You should consider changing your Date object as follows before doing that. Otherwise it would not be easy task to do. &quot;Date&quot;:[{         &quot;date&quot;:&quot;02/11/2019&quot;,         &quot;vid_id1&quot;:&quot;id1&quot;,         &quot;vid_id2&quot;:&quot;SonwZ6MF5BE&quot;,         &quot;vid_id3&quot;:&quot;SonwZ6MF5BE&quot;         }, &quot;date&quot;:&quot;03/11/2019&quot;,         &quot;vid_id1&quot;:&quot;id2&quot;,         &quot;vid_id2&quot;:&quot;SonwZ6MF5BE&quot;,         &quot;vid_id3&quot;:&quot;SonwZ6MF5BE&quot;         } ]"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 21, "user_id": 4509038, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b9vmMoy8F1A/AAAAAAAAAAI/AAAAAAAAAoQ/_OQY2viEAB4/photo.jpg?sz=128", "display_name": "Sayak Sen", "link": "https://stackoverflow.com/users/4509038/sayak-sen"}, "edited": false, "score": 0, "creation_date": 1576049524, "post_id": 59280196, "comment_id": 104767792, "body": "@SayakSen Something like <a href=\"https://play.golang.org/p/fYRqZOxq7LT\" rel=\"nofollow noreferrer\">play.golang.org/p/fYRqZOxq7LT</a>"}, {"owner": {"reputation": 21, "user_id": 4509038, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b9vmMoy8F1A/AAAAAAAAAAI/AAAAAAAAAoQ/_OQY2viEAB4/photo.jpg?sz=128", "display_name": "Sayak Sen", "link": "https://stackoverflow.com/users/4509038/sayak-sen"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1576050060, "post_id": 59280196, "comment_id": 104768009, "body": "Yes, Date Object was giving me pain in the ass anyway. Thanks alot @MarkusWMahlberg for the suggested data model. Would follow that itself. And thanks alot."}], "tags": [], "owner": {"reputation": 2261, "user_id": 2809530, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/f7E46.jpg?s=128&g=1", "display_name": "Channa", "link": "https://stackoverflow.com/users/2809530/channa"}, "is_accepted": true, "score": 1, "last_activity_date": 1576046866, "creation_date": 1576046866, "answer_id": 59280196, "question_id": 59280101, "link": "https://stackoverflow.com/questions/59280101/parse-json-correctly-in-go/59280196#59280196", "title": "Parse JSON correctly in Go", "body": "<p>you can't access inner properties with <code>result[][]</code>. You need to do something like follows,</p>\n\n<pre><code>info:= result[\"Info\"]\nv := info.(map[string]interface{})\njson_data = v[\"Date\"]\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 4509038, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b9vmMoy8F1A/AAAAAAAAAAI/AAAAAAAAAoQ/_OQY2viEAB4/photo.jpg?sz=128", "display_name": "Sayak Sen", "link": "https://stackoverflow.com/users/4509038/sayak-sen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 59280196, "answer_count": 2, "score": -1, "last_activity_date": 1576046908, "creation_date": 1576046439, "last_edit_date": 1576046908, "question_id": 59280101, "link": "https://stackoverflow.com/questions/59280101/parse-json-correctly-in-go", "title": "Parse JSON correctly in Go", "body": "<p>From last 2 days I'm somehow stuck with JSON and Go. My aim is very simple, one Go program that can read a JSON file, output it correctly and append some items to that JSON and then rewrite it back to disk.</p>\n\n<p>Saved JSON File.</p>\n\n<pre><code>{\n\"Category\": [\"food\",\"music\"],\n\"Time(min)\": \"351\",\n\"Channel\": {\n    \"d2d\": 10,\n    \"mkbhd\": 8,\n    \"coding Train\": 24\n},\n\"Info\": {\n    \"Date\":{\n        \"date\":[\"vid_id1\",\"vid_id2\",\"vid_id3\"],\n        \"02/11/2019\":[\"id1\",\"id2\",\"id3\"],\n        \"03/11/2019\":[\"SonwZ6MF5BE\",\"8mP5xOg7ijs\",\"sc2ysHjSaXU\"]\n        },\n    \"Videos\":{\n        \"videos\": [\"Title\",\"Category\",\"Channel\",\"length\"],\n        \"sc2ysHjSaXU\":[\"Bob Marley - as melhores - so saudade\",\"Music\",\"So Saudade\",\"82\"],\n        \"SonwZ6MF5BE\":[\"Golang REST API With Mux\",\"Science &amp; Technology\",\"Traversy Media\",\"44\"],\n        \"8mP5xOg7ijs\":[\"Top 15 Funniest Friends Moments\",\"Entertainment\",\"DjLj11\",\"61\"]\n    }\n  }\n}\n</code></pre>\n\n<p>I have successfully parsed the JSON in Go but then when I try to get JSON[\"Info\"][\"Date\"] it throws interface error. I can't make a specific struct because all the items will dynamically change whenever the code/API gets called.</p>\n\n<p>The Code that I'm using to parse the data </p>\n\n<pre><code>// Open our jsonFile\njsonFile, err := os.Open(\"yt.json\")\nif err != nil {fmt.Println(err)}\nfmt.Println(\"Successfully Opened yt.json\")\ndefer jsonFile.Close()\nbyteValue, _ := ioutil.ReadAll(jsonFile)\nvar result map[string]interface{}\njson.Unmarshal([]byte(byteValue), &amp;result)\n\n\njson_data := result[\"Category\"] //returns correct ans\njson_data := result[\"Info\"][\"Date\"] // returns error - type interface {} does not support indexing\n</code></pre>\n\n<p>Any help/lead is highly appreciated. Thanks a-lot in advance.</p>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 8251, "user_id": 2912665, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XrRhd.jpg?s=128&g=1", "display_name": "CinCout", "link": "https://stackoverflow.com/users/2912665/cincout"}, "edited": false, "score": 0, "creation_date": 1576045991, "post_id": 59279991, "comment_id": 104766541, "body": "shouldn&#39;t <code>shipmentList</code> be of type <code>int</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 526, "user_id": 10938976, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ca1cAmQBhz0/AAAAAAAAAAI/AAAAAAAAADY/lNE8E2NmHk8/photo.jpg?sz=128", "display_name": "Raf Rasenberg", "link": "https://stackoverflow.com/users/10938976/raf-rasenberg"}, "edited": false, "score": 0, "creation_date": 1576046216, "post_id": 59280040, "comment_id": 104766621, "body": "Thankyou, this works beautifully!"}], "tags": [], "owner": {"reputation": 26911, "user_id": 225262, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/10f7602ff38f6486cb1580052746fc05?s=128&d=identicon&r=PG", "display_name": "satoru", "link": "https://stackoverflow.com/users/225262/satoru"}, "is_accepted": false, "score": 1, "last_activity_date": 1576046275, "last_edit_date": 1576046275, "creation_date": 1576046098, "answer_id": 59280040, "question_id": 59279991, "link": "https://stackoverflow.com/questions/59279991/how-to-use-golangs-append-to-an-array-in-a-loop/59280040#59280040", "title": "How to use golang&#39;s append to an array in a loop", "body": "<p>You are appending in the right way. What's wrong is how you are converting integers to strings, you are doing it the <code>Python</code> way. Please take a look at <a href=\"https://golang.org/pkg/strconv/#Itoa\" rel=\"nofollow noreferrer\">strconv.Itoa</a> for the <code>Go</code> equivalent.</p>\n"}], "owner": {"reputation": 526, "user_id": 10938976, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ca1cAmQBhz0/AAAAAAAAAAI/AAAAAAAAADY/lNE8E2NmHk8/photo.jpg?sz=128", "display_name": "Raf Rasenberg", "link": "https://stackoverflow.com/users/10938976/raf-rasenberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "closed_date": 1576046159, "answer_count": 1, "score": -3, "last_activity_date": 1576046275, "creation_date": 1576045871, "question_id": 59279991, "link": "https://stackoverflow.com/questions/59279991/how-to-use-golangs-append-to-an-array-in-a-loop", "closed_reason": "Duplicate", "title": "How to use golang&#39;s append to an array in a loop", "body": "<p>So I have this struct: </p>\n\n<pre><code>type AllShipments struct {\n    Shipments []struct {\n        ShipmentID    int       `json:\"shipmentId\"`\n        ShipmentDate  time.Time `json:\"shipmentDate\"`\n        ShipmentItems []struct {\n            OrderItemID string `json:\"orderItemId\"`\n            OrderID     string `json:\"orderId\"`\n        } `json:\"shipmentItems\"`\n        Transport struct {\n            TransportID int `json:\"transportId\"`\n        } `json:\"transport\"`\n    } `json:\"shipments\"`\n}\n</code></pre>\n\n<p>I want to get a list containing only the shipmentID values, because I need it to make API calls to get specific details of a single shipment. Then later I can loop over it in my API calls.</p>\n\n<p>In Python I did this:</p>\n\n<pre><code># Create shipments dataframe\ndf_shipments = json_normalize(full_df['shipments'], 'shipmentItems', columns)\n\n# Turn into list so we can loop over the shipmentId property in our API call to get more detailed information\nship_list = df_shipments['shipmentId'].tolist()\n</code></pre>\n\n<p>Very powerfull, with two lines of code. But a lot of magic going on. I want to do the same with Golang. From the docs and some searching I came up with this idea:</p>\n\n<pre><code>var shipmentList []string\nfor _, v := range t.Shipments {\n    shipmentList = append(shipmentList, string(v.ShipmentID))\n}\n</code></pre>\n\n<p>Then the <code>shipmentList</code> should return me an array containing all the shipmentID's. But I get this output: <code>[\ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd \ufffd]</code></p>\n\n<p>Can someone maybe clarify what is going on and why I get this result? And how to get the expected result I want?</p>\n"}, {"tags": ["go", "eager-loading", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 5849, "user_id": 657703, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/208ba006821bf4ab078692204d23ceee?s=128&d=identicon&r=PG", "display_name": "\u042f\u0440\u043e\u0441\u043b\u0430\u0432 \u0420\u0430\u0445\u043c\u0430\u0442\u0443\u043b\u043b\u0438\u043d", "link": "https://stackoverflow.com/users/657703/%d0%af%d1%80%d0%be%d1%81%d0%bb%d0%b0%d0%b2-%d0%a0%d0%b0%d1%85%d0%bc%d0%b0%d1%82%d1%83%d0%bb%d0%bb%d0%b8%d0%bd"}, "is_accepted": false, "score": 2, "last_activity_date": 1576051712, "creation_date": 1576051712, "answer_id": 59281294, "question_id": 59277855, "link": "https://stackoverflow.com/questions/59277855/is-gorm-preload-function-a-good-practice-in-terms-of-performance/59281294#59281294", "title": "Is Gorm Preload function a good practice in terms of performance?", "body": "<p>I have no idea what you are talking about;</p>\n\n<p>but generally; the computational cost is different for joins / vs lookups.</p>\n\n<p>given two tables: kake and topping:</p>\n\n<p>kake (name str)\ntopping (name str)</p>\n\n<p>if you join, you will have a much larger set (disk input-output, memory) than in if you do matches;</p>\n\n<p>because you need to calculate ALL PERMUTATIONS.</p>\n\n<h2>table snapshot</h2>\n\n<p>cake:</p>\n\n<pre><code>1|napoleon\n2|chocolate\n3|cheese\n</code></pre>\n\n<p>topping:</p>\n\n<pre><code>1|butter\n2|frosting\n3|cacao\n4|white cacao\n5|goat chese\n6|cow chese\n7|chinese chese\n...|nuts\n...|avocado\n...|white chocolate\n11:cherry-flavor\n</code></pre>\n\n<h2>query logic</h2>\n\n<p>with a general join you will have results 3 x 11 - all cakes times all toppings.</p>\n\n<p>this may seem trivial, but it is not when the tables have 1000+ records.</p>\n\n<p>with \"preload\" you will have;</p>\n\n<pre><code>get all topings for napoleon =&gt; only frosting\nget all topings for chocolate  =&gt; only cacao\nget all toppings for cheese =&gt; only cow chese and only chinise chese\n</code></pre>\n\n<p>then; given my napoleon + chocolate + cheese,</p>\n\n<p>you can avoid: butter, cherry flavor</p>\n\n<p>so you select only the relevant related records.</p>\n\n<p>this is not simple.\nit causes other problems.\nbut generally, performance is better if you can say:</p>\n\n<p>I need all x,y,z and never a,b,c. </p>\n\n<p>I hope this makes sense.</p>\n"}], "owner": {"reputation": 2509, "user_id": 1629278, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/a759fb62eff73d12b00073f20148ccbc?s=128&d=identicon&r=PG", "display_name": "Rafael Reyes", "link": "https://stackoverflow.com/users/1629278/rafael-reyes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1576568297, "creation_date": 1576029288, "last_edit_date": 1576568297, "question_id": 59277855, "link": "https://stackoverflow.com/questions/59277855/is-gorm-preload-function-a-good-practice-in-terms-of-performance", "title": "Is Gorm Preload function a good practice in terms of performance?", "body": "<p>Why Preload function in Gorm is a \u201cgood practice\u201d since it retrieves all the records of a given table (eager loading) every time it is called? </p>\n\n<p>I saw a lot of people referencing the Preload as a good solution when working with relations and I don\u2019t understand why. </p>\n"}, {"tags": ["go", "redis", "lua", "luasocket"], "comments": [{"owner": {"reputation": 20428, "user_id": 1847592, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/OvYt2.png?s=128&g=1", "display_name": "Egor Skriptunoff", "link": "https://stackoverflow.com/users/1847592/egor-skriptunoff"}, "edited": false, "score": 1, "creation_date": 1576031344, "post_id": 59277745, "comment_id": 104762912, "body": "Piepan uses GopherLua (Lua VM written in Go), and GopherLua is unable to load DLL Lua modules.  The most realistic workaround is to find some Go library (which works with redis) and modify Piepan (to expose this library to Lua scripts)."}, {"owner": {"reputation": 826, "user_id": 12514997, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-D0DMePIuN54/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfTuS0cLrP5FwvEomVqlA9RnDolUQ/photo.jpg?sz=128", "display_name": "Allister", "link": "https://stackoverflow.com/users/12514997/allister"}, "reply_to_user": {"reputation": 20428, "user_id": 1847592, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/OvYt2.png?s=128&g=1", "display_name": "Egor Skriptunoff", "link": "https://stackoverflow.com/users/1847592/egor-skriptunoff"}, "edited": false, "score": 0, "creation_date": 1576033553, "post_id": 59277745, "comment_id": 104763376, "body": "@EgorSkriptunoff Okay, thank you for the clear diagnosis and prescription! I was like 40% certain the dll was irreconcilable with piepan but wanted to put out a question in case there was a solution."}], "owner": {"reputation": 826, "user_id": 12514997, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-D0DMePIuN54/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfTuS0cLrP5FwvEomVqlA9RnDolUQ/photo.jpg?sz=128", "display_name": "Allister", "link": "https://stackoverflow.com/users/12514997/allister"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1576031353, "creation_date": 1576028285, "last_edit_date": 1576031353, "question_id": 59277745, "link": "https://stackoverflow.com/questions/59277745/workaround-for-an-api-not-allowing-require-a-specific-library-luasocket-and-no", "title": "Workaround for an API not allowing require a specific library (luasocket) and not able to include it via moving DLL", "body": "<p>I am using an API called <a href=\"https://github.com/layeh/piepan\" rel=\"nofollow noreferrer\">Piepan</a>, which allows me to write Lua scripts for Mumble bots. For context, it is written in Golang using an alternative mumble implementation called <a href=\"https://github.com/layeh/gumble/\" rel=\"nofollow noreferrer\">Gumble</a>. Piepan scripts are executed via cmd prompt through a piepan.exe.\nI can require most libraries, like <a href=\"https://github.com/kikito/inspect.lua\" rel=\"nofollow noreferrer\">inspect.lua</a>, and I can easily require luasocket in non-piepan scripts (scripts executed via lua.exe), but if I try to require luasocket (or what I really want, a <a href=\"https://github.com/nrk/redis-lua\" rel=\"nofollow noreferrer\">redis library</a> that depends on luasocket), I get an error. This is less of an error and more of a missing feature from the API, which the creator <a href=\"https://github.com/layeh/piepan/issues/37\" rel=\"nofollow noreferrer\">acknowledges</a>. The creator suggests to someone else with this problem that they simply use Gumble, but I cannot do that as I am only a Lua programmer.</p>\n\n<p>Here's the code of me just trying to require luasocket:</p>\n\n<pre><code>local socket = require (\"include-test.socket\")\n</code></pre>\n\n<p>(I've also tried include-test.socket.core and just socket.core)</p>\n\n<p>In accordance with this <a href=\"https://stackoverflow.com/questions/47117239/how-to-require-lua-socket\">stackoverflow</a> answer, I moved my files to resemble the user's own directory, so it looks like this:</p>\n\n<pre><code>Piepan folder\n-piepan exe and dlls (not luasocket dlls)\n-include-test (folder)\n--Script for piepan\n--socket.lua\n--socket folder\n---core.dll\n</code></pre>\n\n<p>Despite the directory looking how I imagine it should based on other users' Q/As, I get this error:</p>\n\n<pre><code>.\\include-test\\socket.lua:13: module socket.core not found:\n    no field package.preload['socket.core']\n    Lstat : The system cannot find the path specified.\n    GetFileAttributesEx .\\socket\\core.lua: The system cannot find the path specified.\n    GetFileAttributesEx C:\\Users\\Michael\\piepan\\lua\\socket\\core.lua: The system cannot find the path specified.\n    GetFileAttributesEx C:\\Users\\Michael\\piepan\\lua\\socket\\core\\init.lua: The system cannot find the path specified.\n    GetFileAttributesEx C:\\Program Files (x86)\\Lua\\5.1\\lua\\socket\\core.luac: The system cannot find the path specified.,\n</code></pre>\n\n<p>I've also tried including the following line, inspired by this <a href=\"https://stackoverflow.com/questions/6244380/luasocket-socket-core-dll-required-location\">stackoverflow</a> answer.</p>\n\n<pre><code>package.cpath = package.cpath .. ';include-test/?.dll'\n</code></pre>\n\n<p>to no avail.</p>\n\n<p>I am looking for any available solution, whether that be moving around dlls or compiling the original Piepan w/ extra files as needed. \n(To clarify, I need a workaround that allows me to require the redis library within the same script I run through piepan. Using an outside script with the redis library to then, say, launch piepan and do something there, is not helpful to me.)</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 19682, "user_id": 790070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8SPP4.jpg?s=128&g=1", "display_name": "Timothy Jones", "link": "https://stackoverflow.com/users/790070/timothy-jones"}, "edited": false, "score": 1, "creation_date": 1576018465, "post_id": 59276378, "comment_id": 104759994, "body": "I don&#39;t think this is correct. If the size of <code>int</code> is less than 64 bits, the check will only fail if <code>capacity</code> is over the maximum value of <code>int</code>."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 19682, "user_id": 790070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8SPP4.jpg?s=128&g=1", "display_name": "Timothy Jones", "link": "https://stackoverflow.com/users/790070/timothy-jones"}, "edited": false, "score": 0, "creation_date": 1576018769, "post_id": 59276378, "comment_id": 104760078, "body": "Right that was what i meant to say i will fix the answer"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1576018806, "last_edit_date": 1576018806, "creation_date": 1576017470, "answer_id": 59276378, "question_id": 59276302, "link": "https://stackoverflow.com/questions/59276302/is-this-a-compiler-trick-in-go/59276378#59276378", "title": "Is this a compiler trick in Go?", "body": "<p>It <em>looks</em> like it is to prevent allocating a very large buffer for architectures smaller than 64 bits. That equivalence check will fail if int is smaller than 64 bits on the architecture and capacity is larger than int limit.</p>\n"}, {"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 4, "last_activity_date": 1576017747, "creation_date": 1576017747, "answer_id": 59276420, "question_id": 59276302, "link": "https://stackoverflow.com/questions/59276302/is-this-a-compiler-trick-in-go/59276420#59276420", "title": "Is this a compiler trick in Go?", "body": "<p>The capacity argument to <code>io.ReadAll</code> has type <code>int64</code>.  The argument to <code>*bytes.Buffer</code>'s <code>Grow</code> is <code>int</code>.  So we have to narrow the input <code>int64</code> to (perhaps) 32 bits.  The result may not be the same value as the original <code>int64</code> value.  If not, we skip the call (though I might argue that we should try to grow the buffer to the maximum <code>int</code> value, or\u2014probably better\u2014just return an error directly).</p>\n"}], "owner": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1576018806, "creation_date": 1576016921, "question_id": 59276302, "link": "https://stackoverflow.com/questions/59276302/is-this-a-compiler-trick-in-go", "title": "Is this a compiler trick in Go?", "body": "<p>There is a function in the Go language (<a href=\"https://github.com/golang/go/blob/master/src/io/ioutil/ioutil.go#L18-L38\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/io/ioutil/ioutil.go#L18-L38</a>). Specifically this branch seems redundant to me:</p>\n\n<pre><code>if int64(int(capacity)) == capacity {\n    buf.Grow(int(capacity))\n}\n</code></pre>\n\n<p><code>capacity</code> is never modified and the function doesn't seem to be recursive. Is this something to trick the compiler?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1576015738, "post_id": 59276020, "comment_id": 104759094, "body": "Because <a href=\"https://golang.org/pkg/net/http/#Request.WithContext\" rel=\"nofollow noreferrer\"><code>WithContext</code></a> returns a copy of <code>r</code>, and although that copy is just a <i>shallow</i> one, its Context is set to the provided argument and therefore each such copy has its own Context. The <code>r</code> copy from <code>contentType</code> is not passed to anywhere else therefore its context won&#39;t be accessible anywhere else."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576076009, "post_id": 59276020, "comment_id": 104781874, "body": "Related: <a href=\"https://dave.cheney.net/2017/01/26/context-is-for-cancelation\" rel=\"nofollow noreferrer\">dave.cheney.net/2017/01/26/context-is-for-cancelation</a>"}], "answers": [{"tags": [], "owner": {"reputation": 612, "user_id": 5679246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/979dd4cb6efdef48f055d51bc144ef3e?s=128&d=identicon&r=PG&f=1", "display_name": "ataboo", "link": "https://stackoverflow.com/users/5679246/ataboo"}, "is_accepted": true, "score": 1, "last_activity_date": 1576039577, "creation_date": 1576039577, "answer_id": 59279042, "question_id": 59276020, "link": "https://stackoverflow.com/questions/59276020/go-httprouter-custom-middleware/59279042#59279042", "title": "Go httprouter custom middleware", "body": "<p>I find middleware most useful if they are chained with reference to the next one.  A middleware later in the stack can rely on values set by previous ones so they're order dependent.  Sometimes, they can decide to stop the stack under a condition.</p>\n\n<p>How about chaining them like this?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    router := httprouter.New()\n    router.GET(\"/test\", setTestYou(contentType(name)))\n    log.Print(\"App running on 8080\")\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n\nfunc setTestYou(next httprouter.Handle) httprouter.Handle {\n    return func(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\n        r = r.WithContext(context.WithValue(r.Context(), \"test\", \"You\"))\n        log.Print(\"Set context to YOU\")\n\n        if next != nil {\n            next(w, r, p)\n        }\n    }\n}\n\nfunc contentType(next httprouter.Handle) httprouter.Handle {\n    return func(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\n        if r.Header.Get(\"Content-type\") != \"application/json\" {\n            // break here instead of continuing the chain\n            w.Status = 400\n            return\n        }\n\n        r = r.WithContext(context.WithValue(r.Context(), \"test\", \"Me\"))\n        log.Print(\"Set context to ME\")\n        header := w.Header()\n        header.Set(\"Content-type\", \"application/json\")\n\n        if next != nil {\n            next(w, r, p)\n        }\n    }\n}\n\nfunc name(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\n    log.Printf(\"Context: %s\", r.Context().Value(\"test\"))\n}\n</code></pre>\n\n<p>Since they're passing the request/context into the next one, the changes will stick.</p>\n"}], "owner": {"reputation": 75, "user_id": 3896400, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d23d6c19e76f366ea17fa3735b06fddb?s=128&d=identicon&r=PG&f=1", "display_name": "user3896400", "link": "https://stackoverflow.com/users/3896400/user3896400"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 59279042, "answer_count": 1, "score": 0, "last_activity_date": 1576039577, "creation_date": 1576015330, "question_id": 59276020, "link": "https://stackoverflow.com/questions/59276020/go-httprouter-custom-middleware", "title": "Go httprouter custom middleware", "body": "<p>I'm relatively new as a go programmer and I'm trying to build a custom middleware for my server. The problem is that it's behavior it's not as I expected it to be. Can someone please explain why my context is not set to <em>ME</em>?</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/julienschmidt/httprouter\"\n)\n\nfunc main() {\n    router := httprouter.New()\n    router.GET(\"/test\", middlewareChain(contentType, name))\n    log.Print(\"App running on 8080\")\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n\nfunc middlewareChain(h ...httprouter.Handle) httprouter.Handle {\n    return func(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\n        r = r.WithContext(context.WithValue(r.Context(), \"test\", \"You\"))\n        log.Print(\"Set context to YOU\")\n        for _, handler := range h {\n            handler(w, r, p)\n        }\n    }\n}\n\nfunc contentType(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\n    r = r.WithContext(context.WithValue(r.Context(), \"test\", \"Me\"))\n    log.Print(\"Set context to ME\")\n    header := w.Header()\n    header.Set(\"Content-type\", \"application/json\")\n}\n\nfunc name(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\n    log.Printf(\"Context: %s\", r.Context().Value(\"test\"))\n}\n</code></pre>\n\n<p><a href=\"https://imgur.com/4ILu7fk\" rel=\"nofollow noreferrer\">https://imgur.com/4ILu7fk</a><a href=\"https://i.stack.imgur.com/OVP7U.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/OVP7U.png\" alt=\"Result\"></a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 2, "creation_date": 1576016707, "post_id": 59275952, "comment_id": 104759436, "body": "if it&#39;s your own binary you can just look in the go.mod file"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576076185, "post_id": 59275952, "comment_id": 104781976, "body": "Or use <code>go list</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1081, "user_id": 963287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fTJWz.jpg?s=128&g=1", "display_name": "Rodolfo Carvalho", "link": "https://stackoverflow.com/users/963287/rodolfo-carvalho"}, "edited": false, "score": 0, "creation_date": 1610634998, "post_id": 59276408, "comment_id": 116199290, "body": "This is a good starting point, but worth noting that it prints out module dependencies, not packages as the OP asked. So, for example, it will not say that package <code>runtime&#47;debug</code> and <code>fmt</code> are part of the binary."}], "tags": [], "owner": {"reputation": 647, "user_id": 9773285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e95570197a5ef8f4a067a3669c09143?s=128&d=identicon&r=PG&f=1", "display_name": "Mark A", "link": "https://stackoverflow.com/users/9773285/mark-a"}, "is_accepted": false, "score": 5, "last_activity_date": 1576017674, "creation_date": 1576017674, "answer_id": 59276408, "question_id": 59275952, "link": "https://stackoverflow.com/questions/59275952/is-it-possible-to-know-which-go-packages-are-installed-in-a-binary/59276408#59276408", "title": "Is it possible to know which go packages are installed in a binary", "body": "<p>Yes! The <code>ReadBuildInfo</code> function in the <a href=\"https://golang.org/pkg/runtime/debug/\" rel=\"noreferrer\">runtime/debug</a> package can give you this information.</p>\n\n<p>According to the docs this function</p>\n\n<blockquote>\n  <p>returns the build information embedded in the running binary. The information is available only in binaries built with module support.</p>\n</blockquote>\n\n<p>So, for example, if your project has these files:</p>\n\n<p><em>go.mod</em></p>\n\n<pre><code>module buildinfo\n\ngo 1.12\n\nrequire github.com/gorilla/mux v1.7.3\n</code></pre>\n\n<p><em>main.go</em></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime/debug\"\n\n    _ \"github.com/gorilla/mux\"\n)\n\nfunc main() {\n    buildInfo, ok := debug.ReadBuildInfo()\n    if !ok {\n        panic(\"Can't read BuildInfo\")\n    }\n    fmt.Println(\"Dependencies:\")\n    for _, dep := range buildInfo.Deps {\n        fmt.Printf(\"  %s %s\\n\", dep.Path, dep.Version)\n    }\n}\n</code></pre>\n\n<p>When run it will output:</p>\n\n<pre><code>Dependencies:\n  github.com/gorilla/mux v1.7.3\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5849, "user_id": 657703, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/208ba006821bf4ab078692204d23ceee?s=128&d=identicon&r=PG", "display_name": "\u042f\u0440\u043e\u0441\u043b\u0430\u0432 \u0420\u0430\u0445\u043c\u0430\u0442\u0443\u043b\u043b\u0438\u043d", "link": "https://stackoverflow.com/users/657703/%d0%af%d1%80%d0%be%d1%81%d0%bb%d0%b0%d0%b2-%d0%a0%d0%b0%d1%85%d0%bc%d0%b0%d1%82%d1%83%d0%bb%d0%bb%d0%b8%d0%bd"}, "is_accepted": false, "score": 0, "last_activity_date": 1576052819, "last_edit_date": 1576052819, "creation_date": 1576052437, "answer_id": 59281455, "question_id": 59275952, "link": "https://stackoverflow.com/questions/59275952/is-it-possible-to-know-which-go-packages-are-installed-in-a-binary/59281455#59281455", "title": "Is it possible to know which go packages are installed in a binary", "body": "<p>given the github-ecosystem, it is most trivial to inspect a binary for included resources;</p>\n\n<p>just inspect the binary for modules;</p>\n\n<pre><code>$ strings  ~/bin/txeh | grep github  \n/usr/bin/env go run ~/src/github.com/txn2/txeh/util/txeh.go \"$@\"\n\n\n$ strings  ~/bin/tt | grep github \ngithub.com/araddon/dateparse.init.ializers\ngithub.com/araddon/dateparse.init\n/home/jaroslav/src/github.com/tox2ik/ttrack/src/tt/main.go\n/home/jaroslav/src/github.com/araddon/dateparse/parseany.go\ngithub.com/araddon/dateparse.ErrAmbiguousMMDD\ngithub.com/araddon/dateparse.initdone.\ngithub.com/araddon/dateparse.init.ializers\ngithub.com/araddon/dateparse.init\n</code></pre>\n\n<p>or if you do not know the origin:</p>\n\n<pre><code>strings  ~/bin/tt | grep -e '\\.go\\&gt;' -C2 | sort -ur\n\n/usr/lib/go/src/os/exec_posix.go\n/usr/lib/go/src/syscall/asm_linux_amd64.s\n/usr/lib/go/src/internal/bytealg/count_native.go\n/usr/lib/go/src/runtime/sigqueue.go\n/usr/lib/go/src/os/wait_waitid.go\n/usr/lib/go/src/internal/cpu/cpu.go\n/usr/lib/go/src/runtime/mgclarge.go\n/usr/lib/go/src/internal/bytealg/index_amd64.go\n/usr/lib/go/src/strings/builder.go\n/usr/lib/go/src/runtime/signal_unix.go\n/usr/lib/go/src/runtime/utf8.go\n/usr/lib/go/src/runtime/signal_linux_amd64.go\n/usr/lib/go/src/os/stat_linux.go\n/usr/lib/go/src/runtime/mbarrier.go\n/usr/lib/go/src/runtime/netpoll.go\n/usr/lib/go/src/runtime/mcache.go\n/usr/lib/go/src/runtime/mcentral.go\n.elfdata\n/usr/lib/go/src/syscall/exec_unix.go\n/usr/lib/go/src/runtime/cpuflags_amd64.go\n(...)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1487, "user_id": 276311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2badde067ffa52cab3d6b1dfbebb4bc5?s=128&d=identicon&r=PG", "display_name": "Adriano P", "link": "https://stackoverflow.com/users/276311/adriano-p"}, "is_accepted": false, "score": 0, "last_activity_date": 1615250419, "creation_date": 1615250419, "answer_id": 66539219, "question_id": 59275952, "link": "https://stackoverflow.com/questions/59275952/is-it-possible-to-know-which-go-packages-are-installed-in-a-binary/66539219#66539219", "title": "Is it possible to know which go packages are installed in a binary", "body": "<p>You can use <code>go version [-m] [file ...]</code></p>\n<p>Go version reports the Go version used to build each of the named\nexecutable files.</p>\n<p>Output example:</p>\n<pre><code>$ go version -m dlv\ndlv: go1.14.2\n        path    github.com/go-delve/delve/cmd/dlv\n        mod     github.com/go-delve/delve       v1.4.0  h1:O+1dw1XBZXqhC6fIPQwGxLlbd2wDRau7NxNhVpw02ag=\n        dep     github.com/cosiner/argv v0.0.0-20170225145430-13bacc38a0a5      h1:rIXlvz2IWiupMFlC45cZCXZFvKX/ExBcSLrDy2G0Lp8=\n        dep     github.com/mattn/go-isatty      v0.0.3  h1:ns/ykhmWi7G9O+8a448SecJU3nSMBXJfqQkl0upE1jI=\n        dep     github.com/peterh/liner v0.0.0-20170317030525-88609521dc4b      h1:8uaXtUkxiy+T/zdLWuxa/PG4so0TPZDZfafFNNSaptE=\n        dep     github.com/sirupsen/logrus      v0.0.0-20180523074243-ea8897e79973      h1:3AJZYTzw3gm3TNTt30x0CCKD7GOn2sdd50Hn35fQkGY=\n        dep     github.com/spf13/cobra  v0.0.0-20170417170307-b6cb39589372      h1:eRfW1vRS4th8IX2iQeyqQ8cOUNOySvAYJ0IUvTXGoYA=\n        dep     github.com/spf13/pflag  v0.0.0-20170417173400-9e4c21054fa1      h1:7bozMfSdo41n2NOc0GsVTTVUiA+Ncaj6pXNpm4UHKys=\n        dep     go.starlark.net v0.0.0-20190702223751-32f345186213      h1:lkYv5AKwvvduv5XWP6szk/bvvgO6aDeUujhZQXIFTes=\n        dep     golang.org/x/arch       v0.0.0-20190927153633-4e8777c89be4      h1:QlVATYS7JBoZMVaf+cNjb90WD/beKVHnIxFKT4QaHVI=\n        dep     golang.org/x/crypto     v0.0.0-20190308221718-c2843e01d9a2      h1:VklqNMn3ovrHsnt90PveolxSbWFaJdECFbxSq0Mqo2M=\n        dep     golang.org/x/sys        v0.0.0-20190626221950-04f50cda93cb      h1:fgwFCsaw9buMuxNd6+DQfAuSFqbNiQZpcgJQAgJsK6k=\n        dep     gopkg.in/yaml.v2        v2.2.1  h1:mUhvW9EsL+naU5Q3cakzfE91YhliOondGd6ZrsDBHQE=\n\n</code></pre>\n"}], "owner": {"reputation": 5193, "user_id": 5996587, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d15f53deb1b5f2cab3534565c91c5394?s=128&d=identicon&r=PG&f=1", "display_name": "codec", "link": "https://stackoverflow.com/users/5996587/codec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1615250419, "creation_date": 1576014904, "question_id": 59275952, "link": "https://stackoverflow.com/questions/59275952/is-it-possible-to-know-which-go-packages-are-installed-in-a-binary", "title": "Is it possible to know which go packages are installed in a binary", "body": "<p>I have my go workspace where I develop and then I build a binary and copy it onto a kuberenetes pod and run it. Is it possible to know what go packages are used/installed in the binary?</p>\n"}, {"tags": ["if-statement", "go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1576013801, "creation_date": 1576013801, "answer_id": 59275725, "question_id": 59275702, "link": "https://stackoverflow.com/questions/59275702/nil-check-and-error-check-in-single-if-statement/59275725#59275725", "title": "nil check and error check in single if statement", "body": "<p>Conditions must appear on the right-hand side of the <code>;</code> if it is present, <a href=\"https://golang.org/ref/spec#If_statements\" rel=\"nofollow noreferrer\">per the documentation</a>. It is a shorthand for simple cases like error checks and map lookups. What you're doing would require two <code>if</code> statements.</p>\n"}], "owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 59275725, "answer_count": 1, "score": -2, "last_activity_date": 1576013801, "creation_date": 1576013676, "question_id": 59275702, "link": "https://stackoverflow.com/questions/59275702/nil-check-and-error-check-in-single-if-statement", "title": "nil check and error check in single if statement", "body": "<p>I was attempting to do a nil check and then a method error check in a single if statement. Since the OR operator won't check any other conditions if the first one is true, I figured I could do something like this, to avoid nil pointer crashes and handle errors together:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if (uc.registry == nil) || (serviceName, err = uc.registry.GetServiceName(itemKind, key); err != nil) {}\n</code></pre>\n\n<p>This gives a syntax error, as it seems to try comparing the result of the first condition with the string value of <code>serviceName</code>.</p>\n\n<p>Is it possible to do this?</p>\n"}, {"tags": ["go", "snowflake-cloud-data-platform"], "comments": [{"owner": {"reputation": 3972, "user_id": 1142368, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/818d73588151e0f0adcc4f2d1c6a268b?s=128&d=identicon&r=PG", "display_name": "Jacobm001", "link": "https://stackoverflow.com/users/1142368/jacobm001"}, "edited": false, "score": 0, "creation_date": 1576041363, "post_id": 59275368, "comment_id": 104765130, "body": "This is a really broad question that delves deeply into thread management."}, {"owner": {"reputation": 209, "user_id": 336518, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/07bd246c9e6e0a8fc001c9eb6a5ee776?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/336518/paul"}, "reply_to_user": {"reputation": 3972, "user_id": 1142368, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/818d73588151e0f0adcc4f2d1c6a268b?s=128&d=identicon&r=PG", "display_name": "Jacobm001", "link": "https://stackoverflow.com/users/1142368/jacobm001"}, "edited": false, "score": 0, "creation_date": 1576088975, "post_id": 59275368, "comment_id": 104788710, "body": "My question was related more into the capabilities of the gosnowflake driver. But looks like they haven&#39;t implemented it yet <a href=\"https://github.com/snowflakedb/gosnowflake/blob/1605e50f6382eea57ec3fd3d66fcbd31604548df/connection.go#L208\" rel=\"nofollow noreferrer\">github.com/snowflakedb/gosnowflake/blob/&hellip;</a>"}, {"owner": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 1, "creation_date": 1576103308, "post_id": 59275368, "comment_id": 104794536, "body": "but you could just start different go routines with a query in parallel and you can also cancel them after some time with a context <a href=\"https://github.com/snowflakedb/gosnowflake/blob/master/doc.go#L165\" rel=\"nofollow noreferrer\">github.com/snowflakedb/gosnowflake/blob/master/doc.go#L165</a>"}, {"owner": {"reputation": 209, "user_id": 336518, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/07bd246c9e6e0a8fc001c9eb6a5ee776?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/336518/paul"}, "reply_to_user": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 0, "creation_date": 1576171423, "post_id": 59275368, "comment_id": 104821833, "body": "@tclass yes, indeed that is the approach we will follow after some conversations here, I already tested it using a cancel context and calling the cancel function in the case of the timeout and it properly cancels the query on the Snowflake side. This originally was not the option as we wanted to follow the original approach when using Athena that involved kicking off the queries, getting their ids and having another process that will control the completion of the queries and cancel them if necessary or collect the results."}], "owner": {"reputation": 209, "user_id": 336518, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/07bd246c9e6e0a8fc001c9eb6a5ee776?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/336518/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 171, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576012050, "creation_date": 1576012050, "question_id": 59275368, "link": "https://stackoverflow.com/questions/59275368/asynchronous-cursor-execution-in-snowflake-using-golang", "title": "Asynchronous cursor execution in Snowflake using GoLang", "body": "<p>I need the ability to run multiple queries asynchronously and be able to cancel them if they are over a custom timeout period. I have been able to find solutions in python by using the cursor to start the query execution with no_results set to true but the snowflake driver thru the sql interface doesn't allow such operation. </p>\n\n<p>Any recommendations? Thanks</p>\n"}, {"tags": ["mongodb", "go", "decode", "bson"], "answers": [{"comments": [{"owner": {"reputation": 7279, "user_id": 415559, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/TDc9T.jpg?s=128&g=1", "display_name": "barrypicker", "link": "https://stackoverflow.com/users/415559/barrypicker"}, "edited": false, "score": 0, "creation_date": 1576013903, "post_id": 59275347, "comment_id": 104758425, "body": "Oh, the sweet, sweet data!"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1576011958, "creation_date": 1576011958, "answer_id": 59275347, "question_id": 59275278, "link": "https://stackoverflow.com/questions/59275278/cant-decode-embedded-documents-nested-from-mongodb/59275347#59275347", "title": "Can&#39;t decode embedded documents (nested) from MongoDB", "body": "<p>You are missing \"practice\":</p>\n\n<pre><code>type doc struct {\n  Practice practice_t `bson:\"practice\"`\n}\n</code></pre>\n\n<p>The database document has to structurally match the document you're unmarshaling. You showed the database document is an object with a <code>practice</code> field. Then you must have a struct with a field tagged with <code>practice</code>.</p>\n"}], "owner": {"reputation": 333, "user_id": 4354167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c3c887376cc20bf41e0b64f0c0a8a66?s=128&d=identicon&r=PG&f=1", "display_name": "onVal", "link": "https://stackoverflow.com/users/4354167/onval"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 653, "favorite_count": 0, "accepted_answer_id": 59275347, "answer_count": 1, "score": 0, "last_activity_date": 1576011958, "creation_date": 1576011616, "last_edit_date": 1576011848, "question_id": 59275278, "link": "https://stackoverflow.com/questions/59275278/cant-decode-embedded-documents-nested-from-mongodb", "title": "Can&#39;t decode embedded documents (nested) from MongoDB", "body": "<p>I need to get a document from MongoDB and put it into a struct with custom type.</p>\n\n<pre><code>type translate_t struct {\n    Sources     []string    `bson:\"sources\"`\n    Targets     []string    `bson:\"targets\"`\n}\n\ntype practice_t struct {\n    Id              primitive.ObjectID  `bson:\"_id\"`\n    Translate       translate_t         `bson:\"translate\"`\n}\n</code></pre>\n\n<p>The data in the database is as expected.</p>\n\n<pre><code>\"practice\": {\n    \"translate\": {\n         \"sources\": [\"data\", \"more data\"]\n         \"target\": [\"even\", \"more\", \"data\"]\n    }       \n}\n</code></pre>\n\n<p>What I do (very basic):</p>\n\n<pre><code>var item practice_t\nerr = collection.FindOne(ctx, filter).Decode(&amp;item)\nlog.Printf(\"item:%+v\", item)\n</code></pre>\n\n<p>The log prints this:</p>\n\n<pre><code>{Id:ObjectId(\"5deeblablabla\"), Translate:{Sources:[] Targets:[]}} //where is my sweet data?\n</code></pre>\n\n<p>Now, I want to point out that <strong>all the other items</strong> (not nested with custom struct) <strong>get decoded properly</strong>. So, it seems to me that the Decode() function doesn't like custom structs...\nThis looks like a very common task, so am I missing anything?\nI've been reading about overriding the default Decoder or something like that, but that seems way too much work for something this simple.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "edited": false, "score": 0, "creation_date": 1576012685, "post_id": 59275305, "comment_id": 104757987, "body": "thank you. Do you think this is a good way to implement a timeout here?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "edited": false, "score": 0, "creation_date": 1576012985, "post_id": 59275305, "comment_id": 104758100, "body": "No. Take a look at context.WithTimeout. Also take a look at time.Tick."}, {"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "edited": false, "score": 0, "creation_date": 1576013811, "post_id": 59275305, "comment_id": 104758396, "body": "Ok thanks, I was looking at context.  The examples always define a function that takes this as argument though. I was experimenting with passing it to the goroutine. Anyway, thanks for the hint. I will look into these 2 things."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "edited": false, "score": 1, "creation_date": 1576014023, "post_id": 59275305, "comment_id": 104758463, "body": "Tick might work better for you. There is context in http.Request. Also, you can create a context and pass it to a lenghty computation as well."}, {"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "edited": false, "score": 0, "creation_date": 1576019808, "post_id": 59275305, "comment_id": 104760341, "body": "I ended up using context, here is the snippet if you/someone is interested. I am happy with that.  <a href=\"https://play.golang.org/p/GY9UFYwVQgg\" rel=\"nofollow noreferrer\">play.golang.org/p/GY9UFYwVQgg</a>"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1576011748, "creation_date": 1576011748, "answer_id": 59275305, "question_id": 59275255, "link": "https://stackoverflow.com/questions/59275255/does-a-goroutine-sending-to-an-unbuffered-channel-without-receivers-block-foreve/59275305#59275305", "title": "does a goroutine sending to an unbuffered channel without receivers block forever, after the function that spawns the goroutine returns?", "body": "<p>In your scenario, the goroutine will leak (it will continue to exist). The proper way of terminating the goroutine if nobody is listening to that channel is to use a nonblocking write:</p>\n\n<pre><code> go func() {\n            time.Sleep(time.Second)\n            select {\n               case ack &lt;- false:\n               default:\n            }\n        }()\n</code></pre>\n\n<p>This way, if nobody was listening after the timeout, it'll select the <code>default</code>, and terminate the goroutine.</p>\n"}], "owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30, "favorite_count": 0, "accepted_answer_id": 59275305, "answer_count": 1, "score": 0, "last_activity_date": 1576011748, "creation_date": 1576011516, "question_id": 59275255, "link": "https://stackoverflow.com/questions/59275255/does-a-goroutine-sending-to-an-unbuffered-channel-without-receivers-block-foreve", "title": "does a goroutine sending to an unbuffered channel without receivers block forever, after the function that spawns the goroutine returns?", "body": "<p>please consider the following handler,</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>http.HandleFunc(\"/task\", func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Access-Control-Allow-Origin\", *cors)\n        if r.Method != http.MethodPost {\n            http.Error(w, \"only POST method is allowed\", http.StatusMethodNotAllowed)\n            return\n        }\n        ack := make(chan bool)\n        go func() {\n            time.Sleep(time.Second)\n            ack &lt;- false\n        }()\n        server.BroadcastToRoom(r.FormValue(\"alias\"), \"task\", task{TaskID: \"1\"}, func() {\n            ack &lt;- true\n        })\n        if a := &lt;-ack; !a {\n            w.WriteHeader(http.StatusNoContent)\n        } else {\n            w.WriteHeader(http.StatusCreated)\n        }\n    })\n</code></pre>\n\n<p>The <code>BroadcastToRoom</code> takes a callback as argument. In this callback (that might never happen) \nI send a boolean to the acknowledge channel. If not acknowledged after 1 second it times out.</p>\n\n<p>I am experimenting with methods to implement the timeout. I wrote this goroutine and it works. \nHowever, according to <a href=\"https://play.golang.org/p/Xusa-cwcZJ\" rel=\"nofollow noreferrer\">this playground</a> a goroutine keeps running after the function that spawns it returns.</p>\n\n<p>So I think because the goroutine keeps running and tries to send a value to an unbuffered channel without receivers, the goroutine will block forever. I could fix this by using a buffer size of 1, I guess. </p>\n\n<p>I would like to know if my assumption is true. If so, is there a better way to stop it than using buffer size of 1 and let it silently finish?</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1576004795, "post_id": 59273747, "comment_id": 104754749, "body": "You need to index into the slice to access its elements. Please take the <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">Go Tour</a>, slices and other basics are covered there."}], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 3, "last_activity_date": 1576004877, "creation_date": 1576004877, "answer_id": 59273844, "question_id": 59273747, "link": "https://stackoverflow.com/questions/59273747/how-to-access-a-nested-field-in-struct-in-golang/59273844#59273844", "title": "How to access a nested field in struct in Golang", "body": "<p><code>t.Shipments</code> is a slice - so to access any of it's elements you must pass an index - and then you can access that element's fields e.g.</p>\n\n<pre><code>if len(t.Shipments) &gt; 0 {\n    fmt.Println(v.Shipments[0].ShipmentDate)\n}\n</code></pre>\n\n<p>or to range over the slice:</p>\n\n<pre><code>for i, v := range t.Shipments {\n    fmt.Println(i, v.ShipmentDate)\n}\n</code></pre>\n"}], "owner": {"reputation": 526, "user_id": 10938976, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ca1cAmQBhz0/AAAAAAAAAAI/AAAAAAAAADY/lNE8E2NmHk8/photo.jpg?sz=128", "display_name": "Raf Rasenberg", "link": "https://stackoverflow.com/users/10938976/raf-rasenberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 59273844, "answer_count": 1, "score": -1, "last_activity_date": 1576004877, "creation_date": 1576004407, "question_id": 59273747, "link": "https://stackoverflow.com/questions/59273747/how-to-access-a-nested-field-in-struct-in-golang", "title": "How to access a nested field in struct in Golang", "body": "<p>Let's say I have this structblock:</p>\n\n<pre><code>type AllShipments struct {\n    Shipments []struct {\n        ShipmentID    int       `json:\"shipmentId\"`\n        ShipmentDate  time.Time `json:\"shipmentDate\"`\n        ShipmentItems []struct {\n            OrderItemID string `json:\"orderItemId\"`\n            OrderID     string `json:\"orderId\"`\n        } `json:\"shipmentItems\"`\n        Transport struct {\n            TransportID int `json:\"transportId\"`\n        } `json:\"transport\"`\n    } `json:\"shipments\"`\n}\n</code></pre>\n\n<p>I use:</p>\n\n<pre><code>func main() {\n    var t AllShipments\n    .....\n    .....\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    err = json.Unmarshal(body, &amp;t)\n    if err != nil {\n        fmt.Println(string(body))\n    }\n\n    prettyJSON, err := json.MarshalIndent(t, \"\", \"    \")\n    if err != nil {\n        log.Fatal(\"Failed to generate json\", err)\n    }\n    fmt.Printf(\"%s\\n\", string(prettyJSON))\n</code></pre>\n\n<p>How to get for example only the json field \"shipmentDate\", I tried <code>t.Shipments.ShipmentDate</code> but that did not work. <code>t.Shipments</code> did work to filter out the first array. So what is the best way to do that? I know I can disable the other json fields with <code>\"json:-\"</code> but that is not what I am looking for. Just a way to access that field</p>\n"}, {"tags": ["go", "elasticsearch"], "comments": [{"owner": {"reputation": 2176, "user_id": 4858238, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-lZEqaD_gXyU/AAAAAAAAAAI/AAAAAAAAAgE/FW2SovS7XC0/photo.jpg?sz=128", "display_name": "IanGabes", "link": "https://stackoverflow.com/users/4858238/iangabes"}, "edited": false, "score": 1, "creation_date": 1576036715, "post_id": 59273327, "comment_id": 104764080, "body": "I haven&#39;t quite migrated to 7.5 yet so maybe its a thing im not aware of, but i am unaware of the field data type <code>completion</code>, from the <code>suggest_field</code> property. You are getting an invalid mapping error, and I think this is causing it."}, {"owner": {"reputation": 1429, "user_id": 3255061, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/67905c5234c8238498c0482115662138?s=128&d=identicon&r=PG&f=1", "display_name": "user3255061", "link": "https://stackoverflow.com/users/3255061/user3255061"}, "reply_to_user": {"reputation": 2176, "user_id": 4858238, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-lZEqaD_gXyU/AAAAAAAAAAI/AAAAAAAAAgE/FW2SovS7XC0/photo.jpg?sz=128", "display_name": "IanGabes", "link": "https://stackoverflow.com/users/4858238/iangabes"}, "edited": false, "score": 1, "creation_date": 1576066681, "post_id": 59273327, "comment_id": 104776613, "body": "Thanks for your help. I was also not able to find such a field data type in the docs, however, even after removing the whole field the same error still occors."}, {"owner": {"reputation": 1429, "user_id": 3255061, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/67905c5234c8238498c0482115662138?s=128&d=identicon&r=PG&f=1", "display_name": "user3255061", "link": "https://stackoverflow.com/users/3255061/user3255061"}, "reply_to_user": {"reputation": 2176, "user_id": 4858238, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-lZEqaD_gXyU/AAAAAAAAAAI/AAAAAAAAAgE/FW2SovS7XC0/photo.jpg?sz=128", "display_name": "IanGabes", "link": "https://stackoverflow.com/users/4858238/iangabes"}, "edited": false, "score": 0, "creation_date": 1576100087, "post_id": 59273327, "comment_id": 104793426, "body": "Not sure what I did wrong, apparently it works when removing the mentioned field - the reason was the &quot;payloads&quot;: true though, as stated in my answer. Thanks a lot for your help anyways!"}], "answers": [{"tags": [], "owner": {"reputation": 1429, "user_id": 3255061, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/67905c5234c8238498c0482115662138?s=128&d=identicon&r=PG&f=1", "display_name": "user3255061", "link": "https://stackoverflow.com/users/3255061/user3255061"}, "is_accepted": true, "score": 1, "last_activity_date": 1576100030, "creation_date": 1576100030, "answer_id": 59294427, "question_id": 59273327, "link": "https://stackoverflow.com/questions/59273327/golang-elasticsearch-olivere-root-mapping-definition-has-unsupported-parameters/59294427#59294427", "title": "Golang Elasticsearch Olivere: Root mapping definition has unsupported parameters", "body": "<p>The reason was </p>\n\n<p><code>\"payloads\": true</code></p>\n\n<p>as the creator of the library pointed out <a href=\"https://github.com/olivere/elastic/issues/1249#issuecomment-564606769\" rel=\"nofollow noreferrer\">in his answer</a> to my Github issue. After removing \"payloads\": true, it works.  He even created a <a href=\"https://gist.github.com/olivere/3e2a833bbdcc2154c1686bb7fca6b958\" rel=\"nofollow noreferrer\">gist</a> with the solution.</p>\n\n<p>Be aware that you'll get a similar error message when you're running on elastic V6, but accidentally use the golang client for V7.</p>\n"}], "owner": {"reputation": 1429, "user_id": 3255061, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/67905c5234c8238498c0482115662138?s=128&d=identicon&r=PG&f=1", "display_name": "user3255061", "link": "https://stackoverflow.com/users/3255061/user3255061"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 59294427, "answer_count": 1, "score": 1, "last_activity_date": 1576100030, "creation_date": 1576002431, "question_id": 59273327, "link": "https://stackoverflow.com/questions/59273327/golang-elasticsearch-olivere-root-mapping-definition-has-unsupported-parameters", "title": "Golang Elasticsearch Olivere: Root mapping definition has unsupported parameters", "body": "<p>I'm trying to create an index using <a href=\"https://github.com/olivere/elastic\" rel=\"nofollow noreferrer\">Olivere's elastic search client for the Go language</a> version 7. \nThere is an example how to achieve that on the repo's <a href=\"https://github.com/olivere/elastic/wiki/CreateIndex\" rel=\"nofollow noreferrer\">wiki page</a>. I believe I'm following these steps:</p>\n\n<pre><code>client, err := elastic.NewClient()\nif err != nil {\n    // Handle error\n    panic(err)\n}\n\n// Create a new index.\nmapping := `{\n    \"settings\":{\n        \"number_of_shards\":1,\n        \"number_of_replicas\":0\n    },\n    \"mappings\":{\n        \"properties\":{\n            \"tags\":{\n                \"type\":\"keyword\"\n            },\n            \"location\":{\n                \"type\":\"geo_point\"\n            },\n            \"suggest_field\":{\n                \"type\":\"completion\",\n                \"payloads\":true\n            }\n        }\n    }\n}`\n\nctx := context.Background()\ncreateIndex, err := client.CreateIndex(\"twitter\").BodyString(mapping).Do(ctx)\nif err != nil {\n    // Handle error\n    panic(err)\n}\nif !createIndex.Acknowledged {\n    // Not acknowledged\n}\n</code></pre>\n\n<p>And yet I get an error:</p>\n\n<pre><code>Failed to parse mapping [properties]: Root mapping definition has unsupported parameters: [location : {type=geo_point}] [suggest_field : {payloads=true, type=completion}] [tags : {type=keyword}] [type=mapper_parsing_exception]\n</code></pre>\n\n<p>I'm aware that <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/6.5/removal-of-types.html\" rel=\"nofollow noreferrer\">mapping types have been removed in Elasticsearch V7</a>, but can't see how this should produce the mentioned error.</p>\n\n<p>I also <a href=\"https://github.com/olivere/elastic/issues/1249\" rel=\"nofollow noreferrer\">reported</a> this issue in the corresponding repo.</p>\n"}, {"tags": ["go", "post", "web-scraping"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 1, "creation_date": 1575997203, "post_id": 59272053, "comment_id": 104751465, "body": "I would expect the captcha to be tied to the current session cookie or similar. You instead assume that the captcha is valid without any such context."}, {"owner": {"reputation": 89, "user_id": 10414882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fb7e0ce8eda2553909afb013c208821?s=128&d=identicon&r=PG&f=1", "display_name": "anisbhsl", "link": "https://stackoverflow.com/users/10414882/anisbhsl"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1575997602, "post_id": 59272053, "comment_id": 104751648, "body": "@SteffenUllrich I was thinking the same at first. However, it turns out that the form accepts any captcha image provided by the same captcha URL. I tried with attach session cookie along the request header but no luck."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1575998205, "post_id": 59272053, "comment_id": 104751936, "body": "@anisbhsl the request by the page is made using javascript, and the result is some xml split into two responses where the second one contains the redirect link which points to <code>result.brak</code>. However the redirect is in the xml, so it will not be followed automatically by Go&#39;s client nor by the browser. It is the javascript on the page that reads the xml and follows the redirect. Also note that the results are associated with the session id and not through some &quot;restful&quot; interface."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1575998211, "post_id": 59272053, "comment_id": 104751940, "body": "@anisbhsl  So from what I can tell you&#39;ll need the session first, then you can make the post request, if the server is happy they will associate the result with your session and send back the xml which is irrelevant to you, you only need to care about  the status code you get back, which should be <code>200</code>... after that you need to make another request, <i>with the same session</i>, to the <code>result.brak</code> url to get the contents of the result page."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575999856, "post_id": 59272053, "comment_id": 104752650, "body": "@anisbhsl just to correct my first comment, when successful you get back <i>just one</i> response that contains the xml with the redirect link. What <i>I</i> though were two partial responses to a single request were actually two responses to two separate requests. The rest stands."}, {"owner": {"reputation": 89, "user_id": 10414882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fb7e0ce8eda2553909afb013c208821?s=128&d=identicon&r=PG&f=1", "display_name": "anisbhsl", "link": "https://stackoverflow.com/users/10414882/anisbhsl"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576000294, "post_id": 59272053, "comment_id": 104752854, "body": "@mkopriva I tried with your first comment by sending post request to <code>search.brak</code> with session attached and make another request to <code>result.brak</code>. But I am getting same old response. Could you please elaborate your new approach ? I am quiet stuck on this thing."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576000672, "post_id": 59272053, "comment_id": 104753012, "body": "@anisbhsl the approach is the same. You should first take a look at how the page communicates with the server by opening the network tab in your browser&#39;s console and going through the steps, then based on what the page does you should design your solution in Go, effectively emulating the page."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576001002, "post_id": 59272053, "comment_id": 104753131, "body": "@anisbhsl one thing you can see from the network tab is that a successful search will return a response body like this <code>&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;&lt;partial-response&gt;&lt;redirect url=&quot;&#47;bravsearch&#47;result.brak&quot;&gt;&lt;&#47;redirect&gt;&lt;&#47;partial-response&gt;</code>&zwnj;&#8203;. So what you can do is to make the POST request, then inspect the response from that and ensure that its contents are the same as the above xml, and if they are then you can make the GET request to the result page. But if the response body is different from that it probably means that the request wasn&#39;t accepted by the server."}, {"owner": {"reputation": 89, "user_id": 10414882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fb7e0ce8eda2553909afb013c208821?s=128&d=identicon&r=PG&f=1", "display_name": "anisbhsl", "link": "https://stackoverflow.com/users/10414882/anisbhsl"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576001181, "post_id": 59272053, "comment_id": 104753186, "body": "@mkopriva thank you! I will try with response body."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576001240, "post_id": 59272053, "comment_id": 104753214, "body": "@anisbhsl also when you&#39;re inspecting the network tab take notice of <i>all</i> the parameters and headers sent in the request by the page. For example the page is sending a lot more parameters than what you&#39;re sending from the Go code, those parameter could be critical for the request to be accepted by the server. Same goes for the headers."}], "owner": {"reputation": 89, "user_id": 10414882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fb7e0ce8eda2553909afb013c208821?s=128&d=identicon&r=PG&f=1", "display_name": "anisbhsl", "link": "https://stackoverflow.com/users/10414882/anisbhsl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 116, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576002162, "creation_date": 1575996732, "last_edit_date": 1576002162, "question_id": 59272053, "link": "https://stackoverflow.com/questions/59272053/cannot-make-post-request-to-web-form-using-golang-http-postform", "title": "Cannot make POST request to web form using Golang http.PostForm", "body": "<p>I have a website(search.brak) to scrape. For this, captcha text is required and I have used a service for that purpose. However while trying to make POST request with <code>http.PostForm</code> I am not receiving the result as expected. </p>\n\n<p>Code is as follows:</p>\n\n<pre><code>form := url.Values{}\n        form.Set(\"searchForm:ddAnrede_label\", \"\")\n        form.Set(\"searchForm:ddTitel_label\", \"\")\n        form.Set(\"searchForm:txtName\", \"\")\n        form.Set(\"searchForm:txtProfTitle\", \"\")\n        form.Set(\"searchForm:txtSpecialization_label\", \"\")\n        form.Set(\"searchForm:txtOfficeName\", \"\")\n        form.Set(\"searchForm:txtStrasse\", \"\")\n        form.Set(\"searchForm:txtPostal\", \"\")\n        form.Set(\"searchForm:txtOrt\", \"\")           //city\n        form.Set(\"searchForm:ddRAKammer_label\", \"\") //member of bar\n        form.Set(\"searchForm:txtVorname\", \"john\")\n        form.Set(\"searchForm:txtCaptcha\", captchaSolution)\n</code></pre>\n\n<p>To make POST request, I am using</p>\n\n<pre><code>res,err:=http.PostForm(\"https://www.bea-brak.de/bravsearch/search.brak\", form)\nif err!=nil{\n   panic(err)\n}\ndataInBytes, _ = ioutil.ReadAll(res.Body)\npageContent = string(dataInBytes)\n_ = ioutil.WriteFile(\"test.html\", dataInBytes, 0777)\n</code></pre>\n\n<p>However, this is returning me the same page(search.brak), not the result page(result.brak). </p>\n\n<p>[[NOTE]] This scraping is for educational purposes only! </p>\n"}, {"tags": ["go", "kubernetes-helm", "dep"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1575992150, "post_id": 59269928, "comment_id": 104748528, "body": "What happens if you do <code>dep ensure -add k8s.io&#47;helm</code> instead?"}, {"owner": {"reputation": 177, "user_id": 10088028, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bKX6V.jpg?s=128&g=1", "display_name": "Harry Uglow", "link": "https://stackoverflow.com/users/10088028/harry-uglow"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1575994384, "post_id": 59269928, "comment_id": 104749883, "body": "@Flimzy <code>v3.0.1: Could not introduce k8s.io&#47;helm@v3.0.1, as its subpackage k8s.io&#47;helm does not contain usable Go code (*build.NoGoError).. (Package is required by (root).)</code>"}], "owner": {"reputation": 177, "user_id": 10088028, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bKX6V.jpg?s=128&g=1", "display_name": "Harry Uglow", "link": "https://stackoverflow.com/users/10088028/harry-uglow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 306, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1575989514, "creation_date": 1575989514, "question_id": 59269928, "link": "https://stackoverflow.com/questions/59269928/use-dep-to-add-helm-3-as-go-dependency", "title": "Use dep to add Helm 3 as Go dependency", "body": "<p>I want to install Helm charts from a Go application. As suggested by the <a href=\"https://pkg.go.dev/helm.sh/helm/v3@v3.0.1/pkg/chartutil?tab=doc\" rel=\"nofollow noreferrer\">docs</a> I am loading the chart with </p>\n\n<pre><code>chart, err := loader.Load(filename)\n</code></pre>\n\n<p>However when trying to add this dependency with <code>dep ensure -add k8s.io/helm/pkg/chart/loader</code> I get the error:</p>\n\n<pre><code>Solving failure: No versions of k8s.io/helm met constraints:\n        v3.0.1: unable to deduce repository and source type for \"helm.sh/helm/v3/internal/ignore\": unable to read metadata: unable to parse go-import metadata: XML syntax error on line 1: expected /&gt; in element\n</code></pre>\n\n<p>How can I import this package?</p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1575988799, "post_id": 59269400, "comment_id": 104746491, "body": "See also, <a href=\"https://stackoverflow.com/questions/51941132/how-to-kill-goroutines\" title=\"how to kill goroutines\">stackoverflow.com/questions/51941132/how-to-kill-goroutines</a>, <a href=\"https://stackoverflow.com/questions/41148357/force-kill-goroutine-after-timeout\" title=\"force kill goroutine after timeout\">stackoverflow.com/questions/41148357/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/43035331/how-to-cancel-goroutines-after-certain-amount-of-time\" title=\"how to cancel goroutines after certain amount of time\">stackoverflow.com/questions/43035331/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/48763833/cancel-currently-running-function-goroutine\" title=\"cancel currently running function goroutine\">stackoverflow.com/questions/48763833/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/28240133/cancel-a-blocking-operation-in-go\" title=\"cancel a blocking operation in go\">stackoverflow.com/questions/28240133/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/51223062/goroutine-timeout\">stackoverflow.com/questions/51223062/goroutine-timeout</a>, <a href=\"https://stackoverflow.com/questions/41148357/force-kill-goroutine-after-timeout\" title=\"force kill goroutine after timeout\">stackoverflow.com/questions/41148357/&hellip;</a>, and so on"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1575989881, "post_id": 59269400, "comment_id": 104747224, "body": "@JimB some of those have no answers at all, making them useless references, they just serve to prove the point that this is a common question, which isn&#39;t actually helpful. Also none of those answer <i>this</i> question - they answer the title maybe, but not the actual post."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1575990032, "post_id": 59269400, "comment_id": 104747306, "body": "@Adrian: which is why I didn&#39;t close this as a duplicate ;) They do serve as a reference (though I admit I didn&#39;t read through them all, which is why I posted a plethora of choices), as they may have comments, links to other questions, or rephrasing of the question, any of which might help enlighten someone lacking a basic understanding of concurrency patterns in go. OP can choose to read through other related problems and solutions, or not. It also serves to fill out the &quot;Linked&quot; sections in the questions, to help others traverse through related issues."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 12512177, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a6d2ef1969858cac2a5a1f6dd23144f?s=128&d=identicon&r=PG&f=1", "display_name": "John Milner", "link": "https://stackoverflow.com/users/12512177/john-milner"}, "edited": false, "score": 0, "creation_date": 1575988271, "post_id": 59269453, "comment_id": 104746134, "body": "is <code>i := &lt;- c</code> excatly identical to <code>i := range c</code>? I think the second one receives messages even after closing the channel but the first one doesn&#39;t."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1, "user_id": 12512177, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a6d2ef1969858cac2a5a1f6dd23144f?s=128&d=identicon&r=PG&f=1", "display_name": "John Milner", "link": "https://stackoverflow.com/users/12512177/john-milner"}, "edited": false, "score": 0, "creation_date": 1575988413, "post_id": 59269453, "comment_id": 104746229, "body": "That&#39;s true, sorry - getting ahead of myself. Fixed!"}, {"owner": {"reputation": 1, "user_id": 12512177, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a6d2ef1969858cac2a5a1f6dd23144f?s=128&d=identicon&r=PG&f=1", "display_name": "John Milner", "link": "https://stackoverflow.com/users/12512177/john-milner"}, "edited": false, "score": 0, "creation_date": 1575988872, "post_id": 59269453, "comment_id": 104746541, "body": "Thank you. The word first and second in my comment are misused too!"}, {"owner": {"reputation": 1, "user_id": 12512177, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a6d2ef1969858cac2a5a1f6dd23144f?s=128&d=identicon&r=PG&f=1", "display_name": "John Milner", "link": "https://stackoverflow.com/users/12512177/john-milner"}, "edited": false, "score": 0, "creation_date": 1575989081, "post_id": 59269453, "comment_id": 104746678, "body": "So for my final assurance, is <code>i,ok := &lt;- channel</code> (and checking <code>ok</code>) style of reading channels identical to <code>i := range channel</code>?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1, "user_id": 12512177, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a6d2ef1969858cac2a5a1f6dd23144f?s=128&d=identicon&r=PG&f=1", "display_name": "John Milner", "link": "https://stackoverflow.com/users/12512177/john-milner"}, "edited": false, "score": 0, "creation_date": 1575989579, "post_id": 59269453, "comment_id": 104747016, "body": "I&#39;m not sure what you mean by &quot;identical&quot; - they&#39;re equivalent, the differences are basically what you see here and noted in your comment. It does the same thing in a different way, it&#39;s more verbose but it allows you to use <code>select</code>."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1575988410, "last_edit_date": 1575988410, "creation_date": 1575988053, "answer_id": 59269453, "question_id": 59269400, "link": "https://stackoverflow.com/questions/59269400/stop-a-blocking-goroutine/59269453#59269453", "title": "Stop a blocking goroutine", "body": "<p>You can't kill a goroutine from outside - you can't even reference a specific goroutine; nor can you abort a blocking operation. You can, however, move the <code>for</code> to the outside:</p>\n\n<pre><code>go func() {\n   for  {\n       select {\n       case close := &lt;-closeChan:\n          return 0\n       case i,ok := &lt;-c:\n         // do stuff\n         if !ok {\n             // channel is closed &amp; empty\n             return 0\n         }\n       }\n   }\n}()\n</code></pre>\n\n<p>This will loop forever, and each iteration it will wait for a message on both channels; whichever gets a message first will be processed, then the loop repeats. This is a very common pattern in Go.</p>\n"}], "owner": {"reputation": 1, "user_id": 12512177, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a6d2ef1969858cac2a5a1f6dd23144f?s=128&d=identicon&r=PG&f=1", "display_name": "John Milner", "link": "https://stackoverflow.com/users/12512177/john-milner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "closed_date": 1575993848, "accepted_answer_id": 59269453, "answer_count": 1, "score": -3, "last_activity_date": 1575988410, "creation_date": 1575987912, "question_id": 59269400, "link": "https://stackoverflow.com/questions/59269400/stop-a-blocking-goroutine", "closed_reason": "Duplicate", "title": "Stop a blocking goroutine", "body": "<p>How can I kill a goroutine which is blocking. An idea is that returning from the host function would be a solution but I'm not sure if this kills the goroutine or not.</p>\n\n<pre><code>func myFunc() int {\n   c := make(&lt;-chan int)\n   go func(){\n      for i := range c {\n      // do stuff\n      }\n   }()\n   return 0 // does this kills the inner goroutine?\n}\n</code></pre>\n\n<p>Is there a more nice solution? For example it would be nice that something like this work but because of the blocking for it doesn't:</p>\n\n<pre><code>func myFunc() int {\n   c := make(&lt;-chan int)\n   closeChan := make(chan int)\n   go func() {\n      select {\n      case close := &lt;-closeChan:\n         return 0\n      default:\n         for i := range c {\n            // do stuff\n         }\n      }\n   }()\n   closeChan&lt;-0\n   // other stuff\n}\n</code></pre>\n"}, {"tags": ["string", "loops", "go", "command-line-interface", "slice"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1576000183, "last_edit_date": 1576000183, "creation_date": 1575988460, "answer_id": 59269583, "question_id": 59269259, "link": "https://stackoverflow.com/questions/59269259/is-there-a-better-way-of-achieving-horizontal-scrolling-text-effect-imitating-a/59269583#59269583", "title": "Is there a better way of achieving horizontal scrolling text effect imitating a limited character display?", "body": "<p>First I would not change the buffer. It's a good idea to append the first 16 chars to the end of it to easily get the \"rolling over\" effect, but it's much easier and cheaper to just reset the position to <code>0</code> when you reach its end.</p>\n\n<p>Next, you don't need to operate on a byte slice. Just operate on a <code>string</code>. Strings can be indexed and sliced, just like slices, and slicing a <code>string</code> doesn't even make a copy (doesn't have to), it returns a new string (header) which shares the backing array of the string data. Don't forget that indexing and slicing <code>string</code>s uses byte index (not <code>rune</code> index) which is fine for ASCII texts (their characters are mapped to bytes one-to-one in UTF-8), but would not work with multi-byte special characters.  Your example text is fine.</p>\n\n<p>Also don't use <a href=\"https://golang.org/pkg/fmt/#Printf\" rel=\"nofollow noreferrer\"><code>fmt.Printf()</code></a> to print a text, that expects a format <code>string</code> (treats its first argument as a format string). Instead just use <a href=\"https://golang.org/pkg/fmt/#Print\" rel=\"nofollow noreferrer\"><code>fmt.Print()</code></a>.</p>\n\n<p>All in all, your solution can be reduced to this which is much-much better performance-wise, and it's much cleaner and simpler:</p>\n\n<pre><code>func main() {\n    fmt.Print(\"\\033[2J\") // clear screen\n    s := text + text[:chars]\n\n    for i := 0; ; i = (i + 1) % len(text) {\n        fmt.Print(\"\\033[H\") // move cursor back to first position\n        fmt.Print(s[i : i+chars])\n        time.Sleep(time.Second / 2)\n    }\n}\n</code></pre>\n\n<p>Also note that when position reaches <code>len(text)</code>, we reset it to <code>0</code>, so the text before that starts with the last char of <code>text</code> and uses <code>chars-1</code> from the beginning. So it's also enough to append <code>chars-1</code> instead of <code>chars</code>:</p>\n\n<pre><code>s := text + text[:chars-1]\n</code></pre>\n"}], "owner": {"reputation": 2141, "user_id": 6324817, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9baf1005a3a4e85afefc2dc6dfdd8dff?s=128&d=identicon&r=PG&f=1", "display_name": "cinnaroll45", "link": "https://stackoverflow.com/users/6324817/cinnaroll45"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 59269583, "answer_count": 1, "score": 2, "last_activity_date": 1576000183, "creation_date": 1575987417, "last_edit_date": 1575988975, "question_id": 59269259, "link": "https://stackoverflow.com/questions/59269259/is-there-a-better-way-of-achieving-horizontal-scrolling-text-effect-imitating-a", "title": "Is there a better way of achieving horizontal scrolling text effect imitating a limited character display?", "body": "<p>I'm trying to imitate a 16-character display on the command line which loops over a long string infinitely similar to a stock exchange ticker.</p>\n\n<p>Right now, I'm first printing the first 16 byte slice of the ASCII string and moving over 1 byte at a time:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nconst (\n    chars = 16\n    text  = \"There are many variations of passages of Lorem Ipsum available!!!\"\n)\n\nfunc main() {\n    fmt.Print(\"\\033[2J\") // clear screen\n    buf := []byte(text)\n\n    i := chars\n    for {\n        fmt.Print(\"\\033[H\") // move cursor back to first position\n        fmt.Printf(string(buf[i-chars : i]))\n        i++\n\n        if i == len(buf)+1 {\n            i = chars\n        }\n\n        time.Sleep(time.Second / 4)\n\n        // visualization of what's happening:\n        // fmt.Printf(\"\\t\\t Character:%d of Length:%d | Slice: %d:%d \\n\", i, len(buf), i-chars, i)\n    }\n}\n\n</code></pre>\n\n<p>When I reach the end of the text, I reset the counter inside loop and start printing again from the first slice. Instead of doing this, I want to get to a \"roll over\" effect where the head of the slice seamlessly connects to the tail of the slice.</p>\n\n<p>The problem is, I cannot use an empty buffer and append the head to the tail within the loop because it will just grow endlessly. </p>\n\n<p>So instead of doing that, I decided to append the first 16 bytes of the string to it's tail before the loop and shrink the slice -16 bytes right away. But since that -16 bytes still exist in the backing array, I can expand/shrink from the loop:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    fmt.Print(\"\\033[2J\") // clear screen\n    buf := []byte(text)\n    buf = append(buf, buf[:chars]...)\n    buf = buf[:len(buf)-chars]\n\n    var expanded bool\n    i := chars\n    for {\n        fmt.Print(\"\\033[H\") // move cursor back to first position\n        fmt.Printf(string(buf[i-chars : i]))\n        i++\n\n        if i+1 == len(buf)-chars &amp;&amp; !expanded {\n            buf = buf[:len(buf)+chars]\n            expanded = true\n        }\n\n        if i+1 == len(buf) {\n            i = chars\n            buf = buf[:len(buf)-chars]\n            expanded = false\n        }\n\n        time.Sleep(time.Second / 2)\n\n        // visualization of what's happening:\n        //fmt.Printf(\"\\t\\t Character:%d of Length:%d | Slice: %d:%d | Cap: %d\\n\", i, len(buf), i-chars, i, cap(buf))\n    }\n}\n</code></pre>\n\n<p>This gets me to where I want, but I'm rather new to Go so I want to know if there's a better way to achieve the same result?</p>\n"}, {"tags": ["sql", "go", "jsonpath"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575989335, "post_id": 59269214, "comment_id": 104746848, "body": "What was the error for the second attempt? Same as for the first one?"}, {"owner": {"reputation": 11, "user_id": 12512125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4d730e1edcf2d69a72e92456ad86ee5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladislav", "link": "https://stackoverflow.com/users/12512125/vladislav"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575990063, "post_id": 59269214, "comment_id": 104747325, "body": "No. Second error is <code>pq: syntax error, unexpected $end at end of jsonpath input</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575990206, "post_id": 59269214, "comment_id": 104747414, "body": "hmm could that be an order-of-execution issue? What happens if you enforce the order by wrapping the jsonpath string with the concat into parentheses? e.g. <code>@? (&#39;$.items...&#39; || $1 || &#39;)&#39;)::jsonpath</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575990560, "post_id": 59269214, "comment_id": 104747598, "body": "If that doesn&#39;t work, try using the <code>json_path_*</code> functions, I believe <code>json_path_exists</code> would work for your case here, and to pass the parameter you would construct the <code>vars jsonb</code> argument using the <code>jsonb_build_object</code> function."}, {"owner": {"reputation": 11, "user_id": 12512125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4d730e1edcf2d69a72e92456ad86ee5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladislav", "link": "https://stackoverflow.com/users/12512125/vladislav"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575992795, "post_id": 59269214, "comment_id": 104748929, "body": "@mkopriva First variant is doesn&#39;t work too. What is <code>json_path_exists</code> function? I can&#39;t see this in PostgreSQL documentation."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575992983, "post_id": 59269214, "comment_id": 104749045, "body": "Sorry it&#39;s json<b>b</b>_path_exists, you can find it here: <a href=\"https://www.postgresql.org/docs/current/functions-json.html\" rel=\"nofollow noreferrer\">postgresql.org/docs/current/functions-json.html</a>"}, {"owner": {"reputation": 11, "user_id": 12512125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4d730e1edcf2d69a72e92456ad86ee5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladislav", "link": "https://stackoverflow.com/users/12512125/vladislav"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1575993423, "post_id": 59269214, "comment_id": 104749300, "body": "@mkopriva thanks for your answers. But I resolved this problem by another way: <code>WHERE order_info @? CONCAT(&#39;$.items[*] ? (@.ProductID == &#39;,$1::text,&#39;)&#39;)::jsonpath</code>"}], "owner": {"reputation": 11, "user_id": 12512125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4d730e1edcf2d69a72e92456ad86ee5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladislav", "link": "https://stackoverflow.com/users/12512125/vladislav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1575987247, "creation_date": 1575987247, "question_id": 59269214, "link": "https://stackoverflow.com/questions/59269214/postgresql-argument-placeholder-in-jsonpath-expression", "title": "Postgresql argument placeholder in jsonpath expression", "body": "<p>I try to pass argument <strong>$1</strong> to jsonpath-expression:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT 1 FROM %s.orders AS O WHERE order_info @? '$.items[*] ? (@.ProductID == $1)' \n</code></pre>\n\n<p>but it doesn't work. Postgresql is saying:</p>\n\n<pre><code>pq: got 1 parameters but the statement requires 0\n</code></pre>\n\n<p>I tried to concat jsonpath-expression:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT 1 FROM %s.orders AS O WHERE order_info @? '$.items[*] ? (@.ProductID == ' || $1 || ')' \n</code></pre>\n\n<p>But it also doesn't work. I use <code>sql</code> Golang package and lib/pq driver.</p>\n\n<p>How I can pass argument to jsonpath expression?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "cookies", "axios"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1575985525, "post_id": 59268428, "comment_id": 104744550, "body": "1. Deliberately set the Path of the Cookie. 2. Make sure you are allowed to set a domain cookie: Domain cookies are simply ignored if not made properly, e.g. If your Server run under a different name than &quot;company.com&quot;."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1575992590, "post_id": 59268428, "comment_id": 104748796, "body": "1a. The path is usually set to &quot;/&quot;."}], "owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1575984831, "creation_date": 1575984831, "question_id": 59268428, "link": "https://stackoverflow.com/questions/59268428/why-the-web-browser-is-not-setting-the-cookie", "title": "why the web browser is not setting the cookie?", "body": "<p>I have the following scenario:</p>\n\n<ul>\n<li>A REST API application running on api.company.com</li>\n<li>A frontend application running on frontend.company.com that makes requests to api.company.com for getting resources to display in the frontend.  </li>\n</ul>\n\n<p>I'm setting a cookie in a call and it seems to work properly on postman.<br>\nThe relevant part of the code where I set the cookie is the following one (in GO):</p>\n\n<pre><code>expire := time.Now().Add(24 * time.Hour)\ncookie := http.Cookie{\n    Name:    \"Token\",\n    Value:   \"value\",\n    Expires: expire,\n    Domain: \"company.com\",\n}\nhttp.SetCookie(w, &amp;cookie)\nw.Write([]byte(\"The response\")\n</code></pre>\n\n<p>Once I've tried with postman and saw that the backend was working as expected and was sending the cookie I also made the request in the frontend using the <code>axios</code> library.<br>\nThe relevant part in the code:  </p>\n\n<pre><code>http.post(resource, {\n    field1,\n    field2\n}, \n{\n    withCredentials: true,\n    cancelToken: cancelToken.token,\n    headers: {\n      Authorization: 'token',\n    },\n</code></pre>\n\n<p>})</p>\n\n<p>I get the answer as expected, \"The response\" string,  but the cookie is not set bt the web browser.<br>\nOpening the Chrome console and going to the Network tab I can see that the cookie is sent by the backend but for some reason is refused by the web browser.<br>\nI think is not related to the domain since is company.com nor by the expiration, since is set for tomorrow.<br>\nThe headers in the response are the following:  </p>\n\n<pre><code>Access-Control-Allow-Credentials: true\nAccess-Control-Allow-Methods: HEAD, GET, POST, PUT, PATCH, DELETE\nAccess-Control-Allow-Origin: *\nAccess-Control-Expose-Headers: Token, NewToken\nConnection: keep-alive\nContent-Encoding: gzip\nContent-Length: 280\nContent-Type: application/json\nDate: Tue, 10 Dec 2019 13:12:06 GMT\nSet-Cookie: Token=\"value value\"; Domain=api.company.com; Expires=Wed, 11 Dec 2019 13:12:06 GMT\nStatus: 200\nVary: Origin\n</code></pre>\n\n<p>What I'm doing wrong?</p>\n"}, {"tags": ["git", "go", "gitlab", "versioning", "go-modules"], "answers": [{"comments": [{"owner": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "edited": false, "score": 0, "creation_date": 1575990358, "post_id": 59268703, "comment_id": 104747492, "body": "I started reading the v2 doc - does it really require to make an additional copy of the entire project in <code>&#47;v2&#47;</code>..?!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "edited": false, "score": 0, "creation_date": 1575990735, "post_id": 59268703, "comment_id": 104747695, "body": "@Kludge: no, it just requires the <code>&#47;v2</code> in the module name and import paths."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "edited": false, "score": 0, "creation_date": 1575991323, "post_id": 59268703, "comment_id": 104748050, "body": "@Kludge That&#39;s just one versioning strategy from the versioned module&#39;s point of view. It has the benefit of being compatible with older systems that do not support modules. But it&#39;s not a requirement. If you&#39;re using modules, a simple (semver2 compatible) version tag should suffice."}, {"owner": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1575991416, "post_id": 59268703, "comment_id": 104748107, "body": "@JimB, that&#39;s what I&#39;ve done and now I&#39;m getting <code>cannot find module providing package gitlab.mydomain.com&#47;namespace&#47;A&#47;v2&#47;somepackage</code>, when importing from B"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "edited": false, "score": 0, "creation_date": 1575991466, "post_id": 59268703, "comment_id": 104748137, "body": "@Kludge Did you rename you module to <code>gitlab.mydomain.com&#47;namespace&#47;A&#47;v2</code>?"}, {"owner": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "edited": false, "score": 0, "creation_date": 1575992577, "post_id": 59268703, "comment_id": 104748789, "body": "@icza, &quot;If you&#39;re using modules, a simple (semver2 compatible) version tag should suffice&quot; - how?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "edited": false, "score": 0, "creation_date": 1575992840, "post_id": 59268703, "comment_id": 104748955, "body": "@Kludge By that I mean you may simply add a tag to your repisitory named <code>v2.0.0</code> and the go tool will recognize that point (commit) to use when you require <code>v2.0.0</code>. The <code>v2</code> folder copy (from the blog post) is a versioning strategy that also works with tools that don&#39;t know modules."}, {"owner": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "edited": false, "score": 0, "creation_date": 1575993017, "post_id": 59268703, "comment_id": 104749069, "body": "@icza, But this is exactly what I&#39;ve done in the first place... and then the <code>v2.0.0</code> got overridden by <code>v0.0.0-&lt;timestamp&gt;-&lt;revision&gt;</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "edited": false, "score": 0, "creation_date": 1575993453, "post_id": 59268703, "comment_id": 104749313, "body": "@Kludge: are you certain you&#39;re importing <code>&#47;v2</code> as well? That&#39;s the go1.12 behavior for trying to import a v2.0.0 package with the original import path. Have you tried go1.13 which is a little more strict with the package handling, which may highlight the error?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "edited": false, "score": 0, "creation_date": 1575993546, "post_id": 59268703, "comment_id": 104749373, "body": "@Kludge As JimB wrote: you have to change your import path to end vith <code>&#47;v2</code>, else the go tool will rewrite the required module to <code>v0</code> or <code>v1</code>."}, {"owner": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "edited": false, "score": 0, "creation_date": 1575993750, "post_id": 59268703, "comment_id": 104749480, "body": "I am certain regarding <code>&#47;v2</code>, I&#39;ll re-check though. Meanwhile I managed to work around this with <code>v2.0.0+incompatible</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "edited": false, "score": 1, "creation_date": 1575993838, "post_id": 59268703, "comment_id": 104749533, "body": "@Kludge And does your imported package (module) have a <code>go.mod</code> file?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "edited": false, "score": 2, "creation_date": 1575993866, "post_id": 59268703, "comment_id": 104749543, "body": "@Kludge It would help a lot if you could show us your concrete repos so we don&#39;t have to ask / guess everything."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "edited": false, "score": 1, "creation_date": 1575994282, "post_id": 59268703, "comment_id": 104749829, "body": "@Kludge See <a href=\"https://stackoverflow.com/questions/57355929/what-incompatible-in-go-mod-mean-will-it-make-harm\">What incompatible in go.mod mean, will it make harm?</a>"}, {"owner": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1576065231, "post_id": 59268703, "comment_id": 104775913, "body": "Still trying to make it work properly. So it finds <code>&#47;v2</code> but it cannot find its sub-packages. Just to be clear: I replaced all occurrences of the import to contain <code>&#47;v2</code>  @icza, @JimB"}, {"owner": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "edited": false, "score": 0, "creation_date": 1576065389, "post_id": 59268703, "comment_id": 104776001, "body": "<code>module gitlab.mydomain.com&#47;namespace&#47;A&#47;v2@latest found (v2.0.0, replaced by ..&#47;A&#47;v2&#47;), but does not contain package gitlab.mydomain.com&#47;namespace&#47;A&#47;v2&#47;somepackage</code> (I&#39;m using <code>replace</code> to work locally)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1575986286, "last_edit_date": 1575986286, "creation_date": 1575985759, "answer_id": 59268703, "question_id": 59268347, "link": "https://stackoverflow.com/questions/59268347/go-modules-replaces-an-explicit-version-with-v0-0-0-timestamp-revision-in-go/59268703#59268703", "title": "Go modules replaces an explicit version with v0.0.0-&lt;timestamp&gt;-&lt;revision&gt; in go.mod", "body": "<p>Starting with major version <code>2</code> (<code>v2</code> and beyond), you have to modify the import path, you have to add the major version as a suffix to the import path. You must import the package as:</p>\n\n<pre><code>import \"gitlab.mydomain.com/namespace/A/v2\"\n</code></pre>\n\n<p>And this must also appear in <code>go.mod</code> like:</p>\n\n<pre><code>require gitlab.mydomain.com/namespace/A/v2 v2.0.0\n</code></pre>\n\n<p>Since major versions represent incompatible changes in Semver, their import path must also differ (the same import path denotes the same dependency). This is the <a href=\"https://research.swtch.com/vgo-import\" rel=\"nofollow noreferrer\">import compatibility rule</a>:</p>\n\n<blockquote>\n  <p>If an old package and a new package have the same import path,<br>\n  the new package must be backwards compatible with the old package.</p>\n</blockquote>\n\n<p>Read more about it in <a href=\"https://github.com/golang/go/wiki/Modules#why-must-major-version-numbers-appear-in-import-paths\" rel=\"nofollow noreferrer\">Go Modules Wiki: Why must major version numbers appear in import paths?</a></p>\n\n<p>And also in blog post: <a href=\"https://blog.golang.org/v2-go-modules\" rel=\"nofollow noreferrer\">The Go Blog: Go Modules: v2 and Beyond</a></p>\n"}], "owner": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1575986286, "creation_date": 1575984561, "question_id": 59268347, "link": "https://stackoverflow.com/questions/59268347/go-modules-replaces-an-explicit-version-with-v0-0-0-timestamp-revision-in-go", "title": "Go modules replaces an explicit version with v0.0.0-&lt;timestamp&gt;-&lt;revision&gt; in go.mod", "body": "<p>I recently added a feature to my Go project which might break other projects that uses it. I decided to bump a major version to this project, \"A\", by adding a matching git tag <code>2.0.0</code> (it was previously <code>1.x.x</code>).\nIn my other project which requires it, \"B\", I updated its <code>go.mod</code> file like so:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>module gitlab.mydomain.com/namespace/B\n\ngo 1.12\n\nrequire (\n    gitlab.mydomain.com/namespace/A v2.0.0\n)\n</code></pre>\n\n<p>As you can see, I specifically mentioned <code>v2.0.0</code>, but once I run B, the version of A is being overridden with <code>v0.0.0-&lt;timestamp&gt;-&lt;revision&gt;</code>.</p>\n\n<p>I made sure that the tag exists in the remote.</p>\n\n<p>What am I missing here?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1575980781, "post_id": 59267178, "comment_id": 104741804, "body": "What did you expect instead?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1575980968, "post_id": 59267178, "comment_id": 104741939, "body": "Read the two official blog post which describe how slices work."}, {"owner": {"reputation": 550, "user_id": 3518621, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf3b0c525ec4ad5c29864f230486dea2?s=128&d=identicon&r=PG&f=1", "display_name": "cslrnr", "link": "https://stackoverflow.com/users/3518621/cslrnr"}, "edited": false, "score": 1, "creation_date": 1575981167, "post_id": 59267178, "comment_id": 104742057, "body": "why do you think that the output is not correct, Please explain"}, {"owner": {"reputation": 21, "user_id": 5740826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62028ee077ea7738682a28f578b3a5f1?s=128&d=identicon&r=PG&f=1", "display_name": "Satyajit", "link": "https://stackoverflow.com/users/5740826/satyajit"}, "reply_to_user": {"reputation": 550, "user_id": 3518621, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf3b0c525ec4ad5c29864f230486dea2?s=128&d=identicon&r=PG&f=1", "display_name": "cslrnr", "link": "https://stackoverflow.com/users/3518621/cslrnr"}, "edited": false, "score": 0, "creation_date": 1576029126, "post_id": 59267178, "comment_id": 104762500, "body": "hi @cslrnr I have modified the qstsn with the correct answer. actually 8 is overwritten with 9"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 5740826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62028ee077ea7738682a28f578b3a5f1?s=128&d=identicon&r=PG&f=1", "display_name": "Satyajit", "link": "https://stackoverflow.com/users/5740826/satyajit"}, "edited": false, "score": 0, "creation_date": 1576029604, "post_id": 59267859, "comment_id": 104762587, "body": "Thank you @leaf bebop. I got the trick."}, {"owner": {"reputation": 21, "user_id": 5740826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62028ee077ea7738682a28f578b3a5f1?s=128&d=identicon&r=PG&f=1", "display_name": "Satyajit", "link": "https://stackoverflow.com/users/5740826/satyajit"}, "edited": false, "score": 0, "creation_date": 1576030899, "post_id": 59267859, "comment_id": 104762816, "body": "and also thank you for these useful links ..."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 2, "last_activity_date": 1575982966, "creation_date": 1575982966, "answer_id": 59267859, "question_id": 59267178, "link": "https://stackoverflow.com/questions/59267178/go-slice-not-behaving-as-expected/59267859#59267859", "title": "go slice not behaving as expected", "body": "<p>This is becuase of how <code>append</code> works. In Go, slice is a header that keeps 3 property: <code>Len</code>, <code>Cap</code>, and <code>Ptr</code>. <code>Len</code> is the length of the slice it self, <code>Cap</code> is the capacity of the undrlying array of the slice (the memory), and <code>Ptr</code> is the pointer to the array.</p>\n\n<p>When <code>append</code> appends to a slice where there are no more space in the underlying array, it allocates a new underlying array with some more space than needed and copies the content of the orignal slice into it and then adds the new element. </p>\n\n<p>And When <code>append</code> appends to a slice where <code>Cap</code> > <code>Len</code>, i.e. where there are still sufficent space in the already allocated memory, <code>append</code> keeps the underlying array and copies the element to add to the <code>a[Len+1]</code> (where a is the underlying array).  This will cause problem when two or more slice share the underlying memory.</p>\n\n<p>A rule of thumb is to frequently check the need of copying a slice to avoid undesired sharing of underlying array.</p>\n\n<p>To fix the problem, change <code>result = append(result, append(v2,v1))</code> to <code>result = append(result, append([]int{}, append(v2, v1)...))</code>.</p>\n\n<p>See also: <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">https://blog.golang.org/slices</a></p>\n\n<p>Note 1: <code>append([]int{},append(v2,v1...))</code> is a shortcut of <code>copy</code> and <code>apply</code>. More tricks for slice can be found at: <a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/SliceTricks</a> .</p>\n\n<p>Note 2: In Go, nil is a valid value for slice. so you can get rid of the seperation of split in <code>cartesianMain</code> by setting <code>res</code> to <code>[]int{nil}</code>.</p>\n\n<p>Note 3: For better performance and less allocations, it is a good practise to set the capacity (or length) for known slice. In <code>cartesianProduct</code>, you can use <code>result := make([][]int, 0, len(a)*len(b))</code>.</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/rLqDGWoTLKS\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rLqDGWoTLKS</a></p>\n"}], "owner": {"reputation": 21, "user_id": 5740826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62028ee077ea7738682a28f578b3a5f1?s=128&d=identicon&r=PG&f=1", "display_name": "Satyajit", "link": "https://stackoverflow.com/users/5740826/satyajit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "closed_date": 1575988814, "accepted_answer_id": 59267859, "answer_count": 1, "score": -3, "last_activity_date": 1576030211, "creation_date": 1575980675, "last_edit_date": 1576030211, "question_id": 59267178, "link": "https://stackoverflow.com/questions/59267178/go-slice-not-behaving-as-expected", "closed_reason": "Needs details or clarity", "title": "go slice not behaving as expected", "body": "<p>I was trying to get hands-on in slice and I observed that its not behaving as expected.</p>\n\n<p>I was trying to get the cartesian product of n arrays of diff size. The output is not correct.</p>\n\n<p>here is my code</p>\n\n<pre><code>\nfunc main() {\n   sl1 := []int{1,2,3}\n   sl2 := []int{4}\n   sl3 := []int{5,6}\n   sl4 := []int{8,9}\n   sl := [][]int{sl1,sl2,sl3,sl4}\n   res := cartesianMain(sl)\n   fmt.Println(res)\n}\n\nfunc cartesianMain(a [][]int)  [][]int {\n   res := [][]int{}\n   for i:=0;i&lt;len(a[0]) ;i++{\n       res = append(res,[]int{a[0][i]})\n   }\n   for i:= 1;i&lt;len(a) ;i++{\n       res = cartesianProduct(res,a[i])\n   }\n   return res;\n}\nfunc cartesianProduct(a [][]int, b []int) [][]int {\n   result := [][]int{}\n   for _,v1 := range b {\n       for _,v2 := range a {\n           result = append(result, append(v2,v1))\n       }\n   }\nreturn result\n}\n</code></pre>\n\n<p>actual output:</p>\n\n<pre><code>[[1 4 5 9] [2 4 5 9] [3 4 5 9] [1 4 6 9] [2 4 6 9] [3 4 6 9] [1 4 5 9] [2 4 5 9] [3 4 5 9] [1 4 6 9] [2 4 6 9] [3 4 6 9]]\n</code></pre>\n\n<p>expected output:\nif you see the sl4's 1st element 8 is over written by 9.\ncorrect answer will be :</p>\n\n<pre><code>[[1 4 5 8] [2 4 5 8] [3 4 5 8] [1 4 6 8] [2 4 6 8] [3 4 6 8] [1 4 5 9] [2 4 5 9] [3 4 5 9] [1 4 6 9] [2 4 6 9] [3 4 6 9]]\n</code></pre>\n"}, {"tags": ["go", "heroku", "bots", "heroku-api"], "comments": [{"owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1575964413, "post_id": 59261507, "comment_id": 104733247, "body": "is says what&#39;s the problem <code>Web process failed to bind to $PORT within 60 seconds of launch</code>. You have to open the port and the run your bot."}, {"owner": {"reputation": 699, "user_id": 7415288, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YuSYGCmX1uQ/AAAAAAAAAAI/AAAAAAAAAHw/R-tlnuQVc0Q/photo.jpg?sz=128", "display_name": "Marat Mkhitaryan", "link": "https://stackoverflow.com/users/7415288/marat-mkhitaryan"}, "edited": false, "score": 1, "creation_date": 1575965735, "post_id": 59261507, "comment_id": 104733843, "body": "You are using web dynos, so you need to bind $PORT env variable by http server or something. To fix it just create a simple web server, and make it bind to the os.Getenv(&quot;PORT&quot;)"}], "answers": [{"tags": [], "owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "is_accepted": false, "score": 0, "last_activity_date": 1575964584, "creation_date": 1575964584, "answer_id": 59262580, "question_id": 59261507, "link": "https://stackoverflow.com/questions/59261507/twitter-bot-with-go-crashes-in-heroku/59262580#59262580", "title": "Twitter bot with go crashes in Heroku", "body": "<p>A bit more complex answer from the comment. Heroku has a health-check system which sends requests to your app to check if it answers. If you won't open the port within 60 sec it will kill the application. You can read more about it here: <a href=\"https://devcenter.heroku.com/articles/dynos#web-dynos\" rel=\"nofollow noreferrer\">https://devcenter.heroku.com/articles/dynos#web-dynos</a></p>\n"}, {"comments": [{"owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1575971297, "post_id": 59264297, "comment_id": 104736729, "body": "it goes to sleep after a while because that&#39;s how heroku works - if there&#39;s no traffic it will send your app to sleep for resource optimization"}, {"owner": {"reputation": 669, "user_id": 10684466, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EzF7l.jpg?s=128&g=1", "display_name": "tdranv", "link": "https://stackoverflow.com/users/10684466/tdranv"}, "reply_to_user": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1575979410, "post_id": 59264297, "comment_id": 104741053, "body": "Okay, any idea how to have it wake up every hour? Maybe Heroku Scheduler :? I tried using <code>gocron</code> and Every().Hour() syntax, but it still went to sleep. Your help is much appreciated :)"}], "tags": [], "owner": {"reputation": 669, "user_id": 10684466, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EzF7l.jpg?s=128&g=1", "display_name": "tdranv", "link": "https://stackoverflow.com/users/10684466/tdranv"}, "is_accepted": false, "score": 0, "last_activity_date": 1575993686, "last_edit_date": 1575993686, "creation_date": 1575971113, "answer_id": 59264297, "question_id": 59261507, "link": "https://stackoverflow.com/questions/59261507/twitter-bot-with-go-crashes-in-heroku/59264297#59264297", "title": "Twitter bot with go crashes in Heroku", "body": "<p>Thanks guys!</p>\n\n<p>I fixed it by adding:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>go http.ListenAndServe(\":\"+os.Getenv(\"PORT\"), nil)\n</code></pre>\n\n<p>Only problem now is that the app goes to sleep after a while (maybe because I am using <code>time.Sleep()</code>. I will make sure to figure this one as well and post the answer here :)</p>\n\n<p>Fixed!\nJust used the Scheduler add-on that Heroku provides. Removed all timed functions. :)</p>\n"}], "owner": {"reputation": 669, "user_id": 10684466, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EzF7l.jpg?s=128&g=1", "display_name": "tdranv", "link": "https://stackoverflow.com/users/10684466/tdranv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1575993686, "creation_date": 1575959704, "question_id": 59261507, "link": "https://stackoverflow.com/questions/59261507/twitter-bot-with-go-crashes-in-heroku", "title": "Twitter bot with go crashes in Heroku", "body": "<p>I've put together this twitter bot and it is very simple. Gathers some data from an external API, works on it and tweets it out.</p>\n\n<p>I tried several different ways to have the bot tweet out on the hour and now I have this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    fmt.Println(\"------ Starting bot ------\")\n\n    func() {\n        for range time.Tick(time.Second) {\n            fmt.Println(\"checking for\", time.Now().Format(\"15:04:05\"))\n\n            if time.Now().Format(\"04\") == \"00\" {\n\n              // call the function that calls the external API and does all the work\n\n            }\n        }\n    }()\n\n}\n</code></pre>\n\n<p>There are improvements that can be made on it for sure, but it runs locally so I'm happy with it for now. The problem is that when i deploy it on Heroku it runs for like a minute and creshes. Here are the logs:</p>\n\n<pre><code>2019-12-10T06:26:47.622145+00:00 app[web.1]: checking for 06:26:47\n2019-12-10T06:26:48.622122+00:00 app[web.1]: checking for 06:26:48\n2019-12-10T06:26:49.622554+00:00 app[web.1]: checking for 06:26:49\n2019-12-10T06:26:50.622181+00:00 app[web.1]: checking for 06:26:50\n2019-12-10T06:26:51.622207+00:00 app[web.1]: checking for 06:26:51\n2019-12-10T06:26:52.622019+00:00 app[web.1]: checking for 06:26:52\n2019-12-10T06:26:53.181083+00:00 heroku[web.1]: State changed from starting to crashed\n2019-12-10T06:26:53.075003+00:00 heroku[web.1]: Error R10 (Boot timeout) -&gt; Web process failed to bind to $PORT within 60 seconds of launch\n2019-12-10T06:26:53.075113+00:00 heroku[web.1]: Stopping process with SIGKILL\n2019-12-10T06:26:53.162250+00:00 heroku[web.1]: Process exited with status 137\n</code></pre>\n\n<p>Any idea how to tackle this?</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1575957852, "post_id": 59261043, "comment_id": 104730819, "body": "According to that json, it should be {{.data.title}}, not {{.title}}"}, {"owner": {"reputation": 418, "user_id": 5207458, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/s8Teq.jpg?s=128&g=1", "display_name": "Pardha.Saradhi", "link": "https://stackoverflow.com/users/5207458/pardha-saradhi"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575958610, "post_id": 59261043, "comment_id": 104731061, "body": "correction. Fixing it. I am passing only the data part @BurakSerdar"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1575959515, "post_id": 59261043, "comment_id": 104731327, "body": "Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 418, "user_id": 5207458, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/s8Teq.jpg?s=128&g=1", "display_name": "Pardha.Saradhi", "link": "https://stackoverflow.com/users/5207458/pardha-saradhi"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1575962648, "post_id": 59261043, "comment_id": 104732508, "body": "@MarkusWMahlberg added"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1575963848, "post_id": 59261043, "comment_id": 104733008, "body": "As the error states, the value does not have the key <code>key</code>.  I think you intended to write <code>{{range $key, $value := .lead}}</code> and use the values <code>{{$key}}</code> and <code>{{$value}}</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "is_accepted": true, "score": 2, "last_activity_date": 1575963868, "creation_date": 1575963868, "answer_id": 59262425, "question_id": 59261043, "link": "https://stackoverflow.com/questions/59261043/cant-evaluate-field-key-in-type-interface-accessing-keys-in-go-template/59262425#59262425", "title": "&quot;can&#39;t evaluate field key in type interface&quot; accessing Keys in Go template", "body": "<p>It looks like your range function is wrong. I checked <a href=\"https://stackoverflow.com/questions/21302520/iterating-through-map-in-template\">this answer</a> and updated your code accordingly. It worked. Here is the <a href=\"https://play.golang.org/p/CJeM5Z7RVZn\" rel=\"nofollow noreferrer\">playground link</a>.</p>\n\n<p>The only difference is , I updated your range template to:</p>\n\n<pre><code>&lt;tbody&gt;\n{{ range $key,$value := .lead }}\n&lt;tr&gt;&lt;td&gt;&lt;strong&gt;{{ $key }}&lt;/strong&gt;&lt;/td&gt;\n&lt;td&gt;{{ $value }}&lt;/td&gt;&lt;/tr&gt;\n{{ end }}\n&lt;/tbody&gt;\n</code></pre>\n"}], "owner": {"reputation": 418, "user_id": 5207458, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/s8Teq.jpg?s=128&g=1", "display_name": "Pardha.Saradhi", "link": "https://stackoverflow.com/users/5207458/pardha-saradhi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 59262425, "answer_count": 1, "score": -2, "last_activity_date": 1576002514, "creation_date": 1575957310, "last_edit_date": 1576002514, "question_id": 59261043, "link": "https://stackoverflow.com/questions/59261043/cant-evaluate-field-key-in-type-interface-accessing-keys-in-go-template", "title": "&quot;can&#39;t evaluate field key in type interface&quot; accessing Keys in Go template", "body": "<p>My template:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;{{ .title }}&lt;/title&gt;&lt;link rel=\"stylesheet\" href=\"/stylesheets/style.css\"/&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;New Id On My Website&lt;/p&gt;&lt;table&gt;&lt;tbody&gt;{{/* key, val */}}{{ range .lead }}&lt;tr&gt;&lt;td&gt;&lt;strong&gt;{{ .key }}&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{{ .val }}&lt;/td&gt;&lt;/tr&gt;{{ end }}&lt;/tbody&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;\n</code></pre>\n\n<p>This is my data. </p>\n\n<pre><code> {\n    \"lead\": {\n          \"MOBILE\": \"1212121212121\"\n      },\n     \"title\" : \"New ID\"\n    }\n</code></pre>\n\n<p>If I execute this template with the data, it gives the following error.</p>\n\n<pre><code>template: tmpl:1:222: executing \"tmpl\" at &lt;.key&gt;: can't evaluate field key in type interface {}\n</code></pre>\n\n<p>My code :</p>\n\n<pre><code>var tmplBytes bytes.Buffer\nerr = tmpl.Execute(&amp;tmplBytes, vars)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Here vars is the JSON in the form of <code>map[string]interface{}</code></p>\n\n<p><a href=\"https://play.golang.org/p/PHryO8IaOHc\" rel=\"nofollow noreferrer\">Reproducible example</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1575965213, "post_id": 59260640, "comment_id": 104733624, "body": "The problem with the code in the playground is of the same nature as your original problem: <code>blueHost</code> is a copy of <code>destination_list[2]</code>. You could have avoided both problems by using pointers. See <a href=\"https://play.golang.org/p/uImzdBb7D9Z\" rel=\"nofollow noreferrer\">here</a>, now <code>host3</code> is 105 and also your previous version of <code>increment</code> works as you would expect."}, {"owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575999948, "post_id": 59260640, "comment_id": 104752688, "body": "@mkopriva - please add as answer so I can mark it as accepted answer. thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1575955042, "creation_date": 1575955042, "answer_id": 59260675, "question_id": 59260640, "link": "https://stackoverflow.com/questions/59260640/iterating-a-list-of-structs-and-changing-member-variables/59260675#59260675", "title": "iterating a list of structs and changing member variables", "body": "<p>It doesn't work, because you're copying, and modifying the copy:</p>\n\n<pre><code>dest := destination_list[i]\ndest.incrementSBytes(33)\n</code></pre>\n\n<p>Above, you first copy the array element to <code>dest</code>, and then modify <code>dest</code>. Array element never changes. Instead try this:</p>\n\n<pre><code>destination_list[i].incrementsSBytes(33)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2105, "user_id": 5821408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f6ca899d084f02ac63e71e9e8711046?s=128&d=identicon&r=PG&f=1", "display_name": "shmsr", "link": "https://stackoverflow.com/users/5821408/shmsr"}, "is_accepted": false, "score": 2, "last_activity_date": 1575958321, "creation_date": 1575958321, "answer_id": 59261214, "question_id": 59260640, "link": "https://stackoverflow.com/questions/59260640/iterating-a-list-of-structs-and-changing-member-variables/59261214#59261214", "title": "iterating a list of structs and changing member variables", "body": "<p>All the magic lies in the <code>range</code>, it creates a copy of that element and hence the modification wasn't visible.</p>\n\n<p>Read more about it: <a href=\"https://stackoverflow.com/questions/15945030/change-values-while-iterating\">Change values while iterating</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype destination struct {\n    Name          string\n    SBytesSent    int64\n    ABytesSent    int64\n    LastSeenAlive int64\n    Mutex         *sync.Mutex\n}\n\ntype destinations []destination\n\nvar (\n    destination_list destinations\n    myHosts          = []string{\"host1\", \"host2\", \"host3\"}\n)\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    for i := range myHosts {\n        newDest := myHosts[i]\n        newd := destination{Name: newDest}\n        newd.Mutex = &amp;sync.Mutex{}\n        destination_list = append(destination_list, newd)\n    }\n    i := 0\n    for {\n        increment()\n        status()\n        i++\n        if i == 3 {\n            break\n        }\n    }\n\n}\n\nfunc (self *destination) incrementSBytes(a int) {\n    self.Mutex.Lock()\n    defer self.Mutex.Unlock()\n    self.SBytesSent += int64(a)\n    fmt.Printf(\"new val %d\\n\", self.SBytesSent)\n}\n\nfunc (self *destination) Status() {\n    fmt.Printf(\"my val %d\\n\", self.SBytesSent)\n}\n\nfunc increment() {\n    for i:=0; i&lt;len(destination_list); i++ {\n        destination_list[i].incrementSBytes(33)\n    }\n}\n\nfunc status() {\n    for i:=0; i&lt;len(destination_list); i++ {\n        destination_list[i].Status()\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Hello, playground\nnew val 33\nnew val 33\nnew val 33\nmy val 33\nmy val 33\nmy val 33\nnew val 66\nnew val 66\nnew val 66\nmy val 66\nmy val 66\nmy val 66\nnew val 99\nnew val 99\nnew val 99\nmy val 99\nmy val 99\nmy val 99\n</code></pre>\n"}], "owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 59260675, "answer_count": 2, "score": -2, "last_activity_date": 1575960466, "creation_date": 1575954796, "last_edit_date": 1575960466, "question_id": 59260640, "link": "https://stackoverflow.com/questions/59260640/iterating-a-list-of-structs-and-changing-member-variables", "title": "iterating a list of structs and changing member variables", "body": "<p>Please consider the code <a href=\"https://play.golang.org/p/aO07_PoQLuh\" rel=\"nofollow noreferrer\">https://play.golang.org/p/aO07_PoQLuh</a></p>\n\n<p>I've a list of structs, which I read from to get an idea of the members I've generated enroute. </p>\n\n<p>For each struct, I've a method to raise a counter, however I am missing the sauce here. As you can see from the o/p, I've incremented <code>SBytesSent</code>, but when I read the list of struct and inspect it, it is at 0.</p>\n\n<p>What's the best way to handle this? Thanks!</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype destination struct {\n    Name          string\n    SBytesSent    int64\n    ABytesSent    int64\n    LastSeenAlive int64\n    Mutex         *sync.Mutex\n}\n\ntype destinations []destination\n\nvar (\n    destination_list destinations\n    myHosts          = []string{\"host1\", \"host2\", \"host3\"}\n)\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    for i, _ := range myHosts {\n        newDest := myHosts[i]\n        newd := destination{Name: newDest}\n        newd.Mutex = &amp;sync.Mutex{}\n        destination_list = append(destination_list, newd)\n    }\n    i := 0\n    for {\n        increment()\n        status()\n        i += 1\n        if i == 3 {\n            break\n        }\n    }\n\n}\n\nfunc (self *destination) incrementSBytes(a int) {\n    self.Mutex.Lock()\n    defer self.Mutex.Unlock()\n    self.SBytesSent += int64(a)\n    fmt.Printf(\"new val %d\\n\", self.SBytesSent)\n}\n\nfunc (self *destination) Status() {\n    fmt.Printf(\"my val %d\\n\", self.SBytesSent)\n}\n\nfunc increment() {\n    for i, _ := range destination_list {\n        dest := destination_list[i]\n        dest.incrementSBytes(33)\n    }\n}\n\nfunc status() {\n    for i, _ := range destination_list {\n        dest := destination_list[i]\n        dest.Status()\n    }\n}\n</code></pre>\n\n<p><strong>Edit 1</strong></p>\n\n<p>Please see <a href=\"https://play.golang.org/p/5uqqc3OKYDs\" rel=\"nofollow noreferrer\">https://play.golang.org/p/5uqqc3OKYDs</a> - I've incremented <code>host3</code> to <code>6</code> - yet towards the end they all show <code>99</code>. How can I make host3 retain the previous increment and show <code>99 + 6 = 105</code>? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1575959551, "post_id": 59260449, "comment_id": 104731339, "body": "You might want to read <a href=\"http://stackoverflow.com/help/how-to-ask\">How do I ask a good question</a>, which enhances the probability for getting a useful answer <i>drastically</i>. You might find <a href=\"https://en.m.wikipedia.org/wiki/Eric_S._Raymond\" rel=\"nofollow noreferrer\">ESR</a>&#39;s excellent essay <a href=\"http://catb.org/~esr/faqs/smart-questions.html\" rel=\"nofollow noreferrer\">How To Ask Questions The Smart Way</a> helpful, too - despite its &quot;harsh&quot; title."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1575970545, "post_id": 59260449, "comment_id": 104736290, "body": "You are not closing the response bodies when ioutil.ReadAll fails."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1575988570, "post_id": 59260449, "comment_id": 104746333, "body": "Are you setting <code>MaxIdleConnsPerHost</code>? Is it set high enough to accommodate your expected level of concurrency? Are you connecting to multiple hosts, or just one? Do you have appropriate timeouts set to kill slow requests? Are you throttling requests at an acceptable rate? How are you using <code>proxy</code>? These are the types of things you need to show to have a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 27, "user_id": 7780924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02b86315cd4059320dbbedf005cdd8b3?s=128&d=identicon&r=PG&f=1", "display_name": "rmp", "link": "https://stackoverflow.com/users/7780924/rmp"}, "edited": false, "score": 0, "creation_date": 1576069255, "post_id": 59260449, "comment_id": 104777950, "body": "Thanks guys, MaxIdleConnsPerHost has default value of 2, i have changed it to higher value and also changed MaxIdleConns. So now no. of outgoing connections from my client are limited and reused."}], "owner": {"reputation": 27, "user_id": 7780924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02b86315cd4059320dbbedf005cdd8b3?s=128&d=identicon&r=PG&f=1", "display_name": "rmp", "link": "https://stackoverflow.com/users/7780924/rmp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 276, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1575953498, "creation_date": 1575953498, "question_id": 59260449, "link": "https://stackoverflow.com/questions/59260449/reverse-proxy-in-golang-opening-too-many-connections-towards-server-at-higher-ra", "title": "Reverse proxy in golang opening too many connections towards server at higher rates", "body": "<p>I have the following code</p>\n\n<pre><code>type transport struct {\n    http.RoundTripper\n}\nfunc (t *transport) RoundTrip(req *http.Request) (resp *http.Response, err error) {\n    resp, err = t.RoundTripper.RoundTrip(req)\n    if err != nil {\n        return nil, err\n    }\n    b, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        return nil, err\n    }\n    err = resp.Body.Close()\n    if err != nil {\n        return nil, err\n    }\n    // modify response\n    return resp, nil\n}\n\n// ...\nproxy := httputil.NewSingleHostReverseProxy(target)\nproxy.Transport = &amp;transport{http.DefaultTransport}\n</code></pre>\n\n<p>I have tried setting MaxConnsPerHost, this parameter works with value 2 alone, any other value it doesnt work</p>\n"}, {"tags": ["go", "chromedp"], "owner": {"reputation": 33, "user_id": 6160900, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-hJEazWpghxQ/AAAAAAAAAAI/AAAAAAAAAAw/HQLhUXhmMdM/photo.jpg?sz=128", "display_name": "lnmput", "link": "https://stackoverflow.com/users/6160900/lnmput"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 236, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1575953460, "creation_date": 1575953460, "question_id": 59260441, "link": "https://stackoverflow.com/questions/59260441/how-to-click-each-button-of-the-page-in-turn-use-chromedp-by-go", "title": "How to click each button of the page in turn use chromedp by GO", "body": "<p>There is a page with a lot of buttons. I want to jump through them in order to get the content of the page and search for elements in it. What should I do?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nfunc GetOrders(result *[]tools.Order) chromedp.Tasks {\n\n    var currentUrL string\n\n    var nodes []*cdp.Node\n\n\n    return chromedp.Tasks{\n\n        chromedp.Navigate(Url),\n\n        //chromedp.Evaluate(\"document.querySelector('#J_Static2Quick').click();\", &amp;res),\n\n        chromedp.Location(&amp;currentUrL),\n\n        chromedp.Nodes(\".js-order-container\", &amp;nodes, chromedp.ByQueryAll),\n\n        chromedp.ActionFunc(func(ctx context.Context) error {\n\n\n\n            count := len(nodes)\n            fmt.Println(\"count:\", count)\n\n            for _, v := range nodes {\n\n                // todo search button and  click\n\n            }\n\n            return  nil\n        }),\n\n\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "monkeypatching"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1575959768, "post_id": 59260100, "comment_id": 104731425, "body": "Is <code>find-identity</code>actually executable?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1575991094, "post_id": 59260100, "comment_id": 104747919, "body": "The <code>mprotect</code> syscall is failing for some reason. Read the <a href=\"https://github.com/bouk/monkey#notes\" rel=\"nofollow noreferrer\">package notes</a> which may be relevant here. IMHO I would highly suggest trying to find a testing strategy that doesn&#39;t use this package."}, {"owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1576003628, "post_id": 59260100, "comment_id": 104754275, "body": "@MarkusWMahlberg Sorry for the lack of context here; the full command is actually <code>&#47;usr&#47;bin&#47;security find-identity &#47;Library&#47;Keychains&#47;System.keychain</code>, which is executable on MacOS systems."}], "answers": [{"tags": [], "owner": {"reputation": 181, "user_id": 3555925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dcdd47d40261809897421580a47ae87?s=128&d=identicon&r=PG", "display_name": "Paco", "link": "https://stackoverflow.com/users/3555925/paco"}, "is_accepted": false, "score": 0, "last_activity_date": 1595138470, "creation_date": 1595138470, "answer_id": 62976834, "question_id": 59260100, "link": "https://stackoverflow.com/questions/59260100/gos-monkey-patchinstancemethod-returns-a-permission-denied-error/62976834#62976834", "title": "Go&#39;s monkey.PatchInstanceMethod returns a &quot;permission denied&quot; error?", "body": "<p><code>mprotect</code> syscall fails on MacOS Catalina, more explanation on it: <a href=\"https://stackoverflow.com/questions/60654834/using-mprotect-to-make-text-segment-writable-on-macos/61924409#61924409\">Using mprotect to make text segment writable on macOS</a></p>\n<p>If you are using a go monkey library in go test. Then you can not run go test directly. Actually go test do the followings:</p>\n<ul>\n<li>compile the test functions into a temporary binary file</li>\n<li>execute the binary</li>\n<li>delete the temporary binary file</li>\n</ul>\n<p>To work around this issue, we need to first generate the test binary, the modify the compiled binary with dd. e.g.</p>\n<pre><code>$ go test -c -o test-bin mytest/abc\n</code></pre>\n<p>With -c and -o option, go test will generate a binary named test-bin. Then modify the binary by <code>dd</code> command to <code>set __TEXT(max_prot)</code> to <code>0x7</code> after linking:</p>\n<pre><code>$  printf '\\x07' | dd of=test-bin bs=1 seek=160 count=1 conv=notrunc\n</code></pre>\n<p>Finally, you can run the test binary:</p>\n<pre><code>./test-bin\n</code></pre>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1580, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1595138470, "creation_date": 1575951058, "question_id": 59260100, "link": "https://stackoverflow.com/questions/59260100/gos-monkey-patchinstancemethod-returns-a-permission-denied-error", "title": "Go&#39;s monkey.PatchInstanceMethod returns a &quot;permission denied&quot; error?", "body": "<p>I've tried to come up with a simple, minimal example which reproduces this bug, but wasn't able to (it only occurs in one private repo), but I'll start by showing my attempt. Suppose we have a Go module with the following structure:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 command\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 command.go\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 command_test.go\n\u251c\u2500\u2500 go.mod\n\u2514\u2500\u2500 go.sum\n</code></pre>\n\n<p>where <code>go.mod</code> reads</p>\n\n<pre><code>module github.com/kurtpeek/monkeypatching\n\ngo 1.12\n\nrequire (\n    bou.ke/monkey v1.0.2\n    github.com/google/go-cmp v0.3.1 // indirect\n    github.com/pkg/errors v0.8.1 // indirect\n    github.com/stretchr/testify v1.4.0\n    gotest.tools v2.2.0+incompatible\n)\n</code></pre>\n\n<p>and <code>command.go</code> reads</p>\n\n<pre><code>package command\n\nimport \"os/exec\"\n\n// RunCommand runs a command\nfunc RunCommand() ([]byte, error) {\n    return exec.Command(\"profiles\", \"list\", \"-all\").Output()\n}\n</code></pre>\n\n<p>and <code>command_test.go</code></p>\n\n<pre><code>package command\n\nimport (\n    \"os/exec\"\n    \"reflect\"\n    \"testing\"\n\n    \"bou.ke/monkey\"\n    \"github.com/stretchr/testify/assert\"\n    \"github.com/stretchr/testify/require\"\n)\n\nfunc TestRunCommand(t *testing.T) {\n    var cmd *exec.Cmd\n    patchGuard := monkey.PatchInstanceMethod(reflect.TypeOf(cmd), \"Output\", func(_ *exec.Cmd) ([]byte, error) {\n        return []byte(\"foobar\"), nil\n    })\n    defer patchGuard.Unpatch()\n\n    output, err := RunCommand()\n    require.NoError(t, err)\n    assert.Equal(t, []byte(\"foobar\"), output)\n}\n</code></pre>\n\n<p>This test passes.</p>\n\n<p>Now, in my 'real' repo I have a similar unit test</p>\n\n<pre><code>func TestFindIdentity(t *testing.T) {\n    certPEM, err := ioutil.ReadFile(\"testdata/6dc9bf91-37c6-4882-bfaf-301f118f7fac.pem\")\n    require.NoError(t, err)\n\n    var cmd *exec.Cmd\n    patchGuard := monkey.PatchInstanceMethod(reflect.TypeOf(cmd), \"Output\", func(_ *exec.Cmd) ([]byte, error) {\n        output, err := ioutil.ReadFile(\"testdata/find_identity_match.txt\")\n        require.NoError(t, err)\n        return output, nil\n    })\n    defer patchGuard.Unpatch()\n\n    found, err := FindIdentity(certPEM)\n\n    assert.True(t, found)\n}\n</code></pre>\n\n<p>where <code>FindIdentity()</code> reads</p>\n\n<pre><code>// FindIdentity checks whether there is an identity (certificate + private key) for the given certificate in the system keychain\nfunc FindIdentity(certPEM []byte) (bool, error) {\n    ctx, cancel := context.WithTimeout(context.TODO(), time.Second*5)\n    defer cancel()\n\n    fingerprint, err := GetFingerprint(certPEM)\n    if err != nil {\n        return false, fmt.Errorf(\"get cert fingerprint: %v\", err)\n    }\n\n    output, err := exec.CommandContext(ctx, cmdSecurity, \"find-identity\", systemKeychain).Output()\n    if err != nil {\n        return false, fmt.Errorf(\"find identity: %v\", err)\n    }\n\n    return strings.Contains(string(output), fingerprint), nil\n}\n\n// GetFingerprint generates a SHA-1 fingerprint of a certificate, which is how it can be identified from the `security` command\nfunc GetFingerprint(certPEM []byte) (string, error) {\n    block, _ := pem.Decode(certPEM)\n    if block == nil {\n        return \"\", errors.New(\"failed to decode cert PEM\")\n    }\n\n    cert, err := x509.ParseCertificate(block.Bytes)\n    if err != nil {\n        return \"\", fmt.Errorf(\"parse certificate: %v\", err)\n    }\n\n    fingerprint := fmt.Sprintf(\"%x\", sha1.Sum(cert.Raw))\n    fingerprint = strings.Replace(fingerprint, \" \", \"\", -1)\n    return strings.ToUpper(fingerprint), nil\n}\n</code></pre>\n\n<p>So similarly, it uses a <code>Command</code> which is patched in the unit test. However, if I try to run the unit test I get this error:</p>\n\n<pre><code>Running tool: /usr/local/opt/go@1.12/bin/go test -timeout 30s github.com/fleetsmith/agent/agent/auth/defaultauth -run ^(TestFindIdentity)$\n\n--- FAIL: TestFindIdentity (0.00s)\npanic: permission denied [recovered]\n    panic: permission denied\n\ngoroutine 25 [running]:\ntesting.tRunner.func1(0xc000494100)\n    /usr/local/Cellar/go@1.12/1.12.12/libexec/src/testing/testing.go:830 +0x392\npanic(0x48fede0, 0xc000554730)\n    /usr/local/Cellar/go@1.12/1.12.12/libexec/src/runtime/panic.go:522 +0x1b5\nbou.ke/monkey.mprotectCrossPage(0x41c20e0, 0xc, 0x7)\n    /Users/kurt/go/pkg/mod/bou.ke/monkey@v1.0.2/replace_unix.go:15 +0xe6\nbou.ke/monkey.copyToLocation(0x41c20e0, 0xc0000ebd2c, 0xc, 0xc)\n    /Users/kurt/go/pkg/mod/bou.ke/monkey@v1.0.2/replace_unix.go:26 +0x6d\nbou.ke/monkey.replaceFunction(0x41c20e0, 0xc0001a2510, 0x13, 0x41c20e0, 0x48c3b00)\n    /Users/kurt/go/pkg/mod/bou.ke/monkey@v1.0.2/replace.go:29 +0xe6\nbou.ke/monkey.patchValue(0x48c3b60, 0xc0000bc078, 0x13, 0x48c3b60, 0xc0001a2510, 0x13)\n    /Users/kurt/go/pkg/mod/bou.ke/monkey@v1.0.2/monkey.go:87 +0x22f\nbou.ke/monkey.PatchInstanceMethod(0x4b359a0, 0x4996280, 0x49d0699, 0x6, 0x48c3b60, 0xc0001a2510, 0x0)\n    /Users/kurt/go/pkg/mod/bou.ke/monkey@v1.0.2/monkey.go:62 +0x160\ngithub.com/fleetsmith/agent/agent/auth/defaultauth.TestFindIdentity(0xc000494100)\n    /Users/kurt/go/src/github.com/fleetsmith/agent/agent/auth/defaultauth/keychain_test.go:46 +0x146\ntesting.tRunner(0xc000494100, 0x4a30260)\n    /usr/local/Cellar/go@1.12/1.12.12/libexec/src/testing/testing.go:865 +0xc0\ncreated by testing.(*T).Run\n    /usr/local/Cellar/go@1.12/1.12.12/libexec/src/testing/testing.go:916 +0x35a\nFAIL    github.com/fleetsmith/agent/agent/auth/defaultauth  0.390s\nError: Tests failed.\n</code></pre>\n\n<p>Concretely, I get a <code>permission denied</code> panic upon calling <code>monkey.PatchInstanceMethod</code> at this line:</p>\n\n<pre><code>patchGuard := monkey.PatchInstanceMethod(reflect.TypeOf(cmd), \"Output\", func(_ *exec.Cmd) ([]byte, error) {\n\n})\n</code></pre>\n\n<p>Any idea what could cause this? It must be some difference between my 'real' repo and my scratch repo.</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 4244, "user_id": 3348112, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab4cd9458f5debd780353a5554b718d8?s=128&d=identicon&r=PG&f=1", "display_name": "CAustin", "link": "https://stackoverflow.com/users/3348112/caustin"}, "edited": false, "score": 0, "creation_date": 1575943413, "post_id": 59258923, "comment_id": 104727391, "body": "What&#39;s the use of regex here? The requirement &quot;replace <code>foobar</code> with <code>foobaz</code>, but only if <code>bar</code> is preceded by <code>foo</code>&quot; is rather strange, seeing as how <code>foobar</code> is just a static string and that condition will always be met."}], "answers": [{"tags": [], "owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "is_accepted": true, "score": 2, "last_activity_date": 1575944074, "creation_date": 1575944074, "answer_id": 59259268, "question_id": 59258923, "link": "https://stackoverflow.com/questions/59258923/go-regular-expression-with-positive-lookbehind/59259268#59259268", "title": "Go regular expression with positive lookbehind", "body": "<p>look like your issue is only static string replacement. can simply done with <a href=\"https://golang.org/pkg/strings/#Replace\" rel=\"nofollow noreferrer\">strings.Replace</a></p>\n\n<p>but if you do want lookbehind:</p>\n\n<p>Go's <code>regexp</code> package don't support lookbehind, you can check the supported feature here: <a href=\"https://github.com/google/re2/wiki/Syntax\" rel=\"nofollow noreferrer\">https://github.com/google/re2/wiki/Syntax</a></p>\n\n<p>if you do need lookbehind, you should try third-party module, for example: <a href=\"https://github.com/dlclark/regexp2\" rel=\"nofollow noreferrer\">https://github.com/dlclark/regexp2</a></p>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 508, "favorite_count": 0, "closed_date": 1575964016, "accepted_answer_id": 59259268, "answer_count": 1, "score": 0, "last_activity_date": 1575944074, "creation_date": 1575941177, "question_id": 59258923, "link": "https://stackoverflow.com/questions/59258923/go-regular-expression-with-positive-lookbehind", "closed_reason": "Duplicate", "title": "Go regular expression with positive lookbehind", "body": "<p>I'm trying to write a function in Go which will replace <code>foobar</code> with <code>foobaz</code>, but only if <code>bar</code> is preceded by <code>foo</code>. It seems to me that the <a href=\"https://golang.org/pkg/regexp/#Regexp.ReplaceAll\" rel=\"nofollow noreferrer\"><code>regexp.ReplaceAll</code></a> function together with a positive lookbehind (cf. <a href=\"https://www.regular-expressions.info/lookaround.html\" rel=\"nofollow noreferrer\">https://www.regular-expressions.info/lookaround.html</a>) would work for this, so I tried the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    re := regexp.MustCompile(`(?&lt;=foo)bar`)\n\n    new := re.ReplaceAll([]byte(\"foobar\"), []byte(\"baz\"))\n\n    fmt.Println(string(new))\n}\n</code></pre>\n\n<p>The goal was to make this program print <code>foobaz</code>, but instead I get a panic because the regular expression doesn't compile:</p>\n\n<pre><code>panic: regexp: Compile(`(?&lt;=foo)bar`): error parsing regexp: invalid or unsupported Perl syntax: `(?&lt;`\n</code></pre>\n\n<p>How can I make this work?</p>\n\n<h2>Note</h2>\n\n<p>One thing I've tried is to replace the regular expression with a non-capturing group:</p>\n\n<pre><code>re := regexp.MustCompile(`(?:foo)bar`)\n</code></pre>\n\n<p>However, I find that the program then prints <code>baz</code> instead of <code>foobaz</code> as desired.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1575935029, "post_id": 59258201, "comment_id": 104725640, "body": "The exit status is 1, what does stderr say?"}, {"owner": {"reputation": 97, "user_id": 10143812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e1fc65fdf160ed7f1d91d1cace065d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/10143812/peter"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1575935273, "post_id": 59258201, "comment_id": 104725684, "body": "I attempted to read stderr like this and got nothing. <code>out := capturer.CaptureStderr(func() { \texec.Command(&quot;tcpdump&quot;, &quot;-i&quot;, &quot;enp0s31f6&quot;, &quot;host&quot;, &quot;192.168.1.180&quot;, &quot;-F&quot;, folderPath+pcapName).Output() }) fmt.Println(out)</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1575937699, "post_id": 59258201, "comment_id": 104726233, "body": "Don\u2019t try to put code in the comments. I don\u2019t know how that\u2019s supposed to capture stderr, since it does not touch the command stderr in any way."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1575940010, "post_id": 59258201, "comment_id": 104726689, "body": "By default, <code>tcpdump</code> just keeps on running, gathering data forever. The <code>Output()</code> function collects all of the output, waiting for the program to terminate. So it waits forever, accumulating more and more output (if there is any more), waiting, and waiting, and waiting some more. When will it stop waiting? Never. To make <code>Output()</code> finish and return the collected output, you have to make <code>tcpdump</code> stop running, finish printing its output, and exit. Of course, if your filter expression is bad, it will never start running at all, and thus have no output."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1575940439, "post_id": 59258201, "comment_id": 104726766, "body": "In this case, I suspect the filter in your file is bad, or the file itself (<code>.&#47;testfile</code>) is not found."}], "answers": [{"comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1575940298, "post_id": 59258659, "comment_id": 104726741, "body": "You might want <code>-c</code> and a packet count here, so that the whole thing will terminate. Or, one could use <code>cmd.Start</code>, without redirecting the output to a file, and collect the output as it comes, although this starts to get a bit more complicated."}, {"owner": {"reputation": 550, "user_id": 3518621, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf3b0c525ec4ad5c29864f230486dea2?s=128&d=identicon&r=PG&f=1", "display_name": "cslrnr", "link": "https://stackoverflow.com/users/3518621/cslrnr"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1575940718, "post_id": 59258659, "comment_id": 104726828, "body": "@torek yes , -c work too and <code>cmd.Start</code> will run the command and dont wait for it to finish. let me update the answer with this input as well that will improve the answers and whoever looking at this ."}], "tags": [], "owner": {"reputation": 550, "user_id": 3518621, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf3b0c525ec4ad5c29864f230486dea2?s=128&d=identicon&r=PG&f=1", "display_name": "cslrnr", "link": "https://stackoverflow.com/users/3518621/cslrnr"}, "is_accepted": true, "score": 0, "last_activity_date": 1575941181, "last_edit_date": 1575941181, "creation_date": 1575938732, "answer_id": 59258659, "question_id": 59258201, "link": "https://stackoverflow.com/questions/59258201/go-exec-command-of-tcpdump-not-doing-anything/59258659#59258659", "title": "Go &quot;exec.Command&quot; of tcpdump not doing anything", "body": "<p>Something like this should work, i am not sure if there is any specific command like -F available in tcp dump,\nIf you want to capture plain output of the tcp dump , you can direct the output to file using <code>&gt; file</code> . The -w option is for wireshark/tcpdump format , to read and display </p>\n\n<pre><code>cmd := exec.Command(\"sh\", \"-c\", \"sudo tcpdump -i &lt;eth&gt; host &lt;ip&gt; -w ./testfile\")\nerr := cmd.Run()\nif err != nil {\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>Thanks, @torek, the -c option can be used with tcpdump to exit after capturing n packets</p>\n\n<pre><code> cmd := exec.Command(\"sh\", \"-c\", \"sudo tcpdump -i ens33 -c 100 host localhost -w ./testfile\")\n err := cmd.Run()\n if err != nil {\n      fmt.Println(err)\n }\n</code></pre>\n\n<p>The other way is to use <code>cmd.Start</code></p>\n\n<pre><code>cmd := exec.Command(\"sh\", \"-c\", \"sudo tcpdump -i ens33 -c 100 host localhost -w ./testfile\")\nerr := cmd.Start()\nif err != nil {\n    log.Fatal(err)\n}\nlog.Printf(\"Waiting for command to finish...\")\nerr = cmd.Wait()\nlog.Printf(\"Command finished with error: %v\", err)\n</code></pre>\n\n<p>The tcpdump command continue to run infinitely if you use cmd.run without -c option with tcpdump cmd.So you can't see if you put print statement after cmd.Run() call, the reason being the exec.Command failed is, it just work the same way on how it works from the cli, so if you need sodo in front for it , you should put it in command as well or run it from the root user.</p>\n"}], "owner": {"reputation": 97, "user_id": 10143812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e1fc65fdf160ed7f1d91d1cace065d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/10143812/peter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 0, "accepted_answer_id": 59258659, "answer_count": 1, "score": 0, "last_activity_date": 1575941181, "creation_date": 1575934791, "last_edit_date": 1575935057, "question_id": 59258201, "link": "https://stackoverflow.com/questions/59258201/go-exec-command-of-tcpdump-not-doing-anything", "title": "Go &quot;exec.Command&quot; of tcpdump not doing anything", "body": "<p>I am attempting to run the following code in Go.  I have tried both of the following ways:</p>\n\n<pre><code>out, err := exec.Command(\"sh\", \"-c\", \"tcpdump -i ens0 host 192.168.1.100 -F ./testfile\").Output()\nfmt.Println(string(out))           // Prints nothing\nfmt.Println(err)                   // exit status 1\n</code></pre>\n\n<p>I have also tried replacing <code>sh</code> with <code>/bin/bash</code>.\nI have also tried the following, with and without <code>sh</code> as the first argument:</p>\n\n<pre><code>out, err := exec.Command(\"tcpdump\", \"-i\", \"ens0\", \"host\", \"192.168.1.100\", \"-F\", \"./testfile\").Output()\nfmt.Println(string(out))           // Prints nothing\nfmt.Println(err)                   // exit status 1\n</code></pre>\n\n<p>None of this is working.  Can someone see what I am doing wrong?  I have also tried this go package <code>\"github.com/kami-zh/go-capturer\"</code> to read stderr and again it prints nothing.</p>\n\n<p>Normally I have to use <code>sudo</code> to execute <code>tcpdump</code> from shell, so I build the go binary and execute it as root user.</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1575921270, "post_id": 59255207, "comment_id": 104720914, "body": "What is the question exactly? What are you doing were this response in particular is causing an issue?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1575921329, "post_id": 59255207, "comment_id": 104720940, "body": "Please edit your question to include the server code and client request necessary to reproduce the issue."}], "owner": {"reputation": 252, "user_id": 4781711, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DeqWC.jpg?s=128&g=1", "display_name": "Anar Rzayev", "link": "https://stackoverflow.com/users/4781711/anar-rzayev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 296, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1575922937, "creation_date": 1575918746, "last_edit_date": 1575922937, "question_id": 59255207, "link": "https://stackoverflow.com/questions/59255207/http2-received-goaway-frameheader-goaway-len-8-starting-graceful-shutdown", "title": "http2: received GOAWAY [FrameHeader GOAWAY len=8], starting graceful shutdown", "body": "<p>I built a web app with go net/http package. sometimes server return error \u201chttp2: received GOAWAY [FrameHeader GOAWAY len=8], starting graceful shutdown\u201d. how can I fix it?. go version is 1.12.8.</p>\n\n<p>When request the API server returns the error and can not reach the endpoint.</p>\n\n<p>here is my http server codes: <a href=\"https://play.golang.org/p/t2VWrHFwDrl\" rel=\"nofollow noreferrer\">enter link description here</a></p>\n\n<p>the main problem is some client request causes this issue. I can log only this error. </p>\n\n<p>The client send post request the endpont with json body:</p>\n\n<pre><code>POST /api/me/posts HTTP/1.1\n</code></pre>\n\n<p>Host: localhost\ntoken: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0aW1lIjoxNTY4OTgyMDc4LCJ1bmlxdWVJZCI6IjZmMDM4YTZiNTRkYzQ5MDhiYThhNjY0OWMzM2ZhM2VkIn0.Vs0Oz8ZuLJIv_KrFww_jolVyIzdTGlFVgVQgG5j1X7E\nContent-Type: application/json\ncache-control: no-cache\nPostman-Token: 76fc1168-8da1-4477-b32a-c7961515f48e</p>\n\n<p>{\n    \"description\":\"Gophers\",\n    \"parent_id\":\"12aa4332mias1\"\n}</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 3, "creation_date": 1575915310, "post_id": 59254424, "comment_id": 104718559, "body": "You are setting the first field to its zero value. The zero value for a pointer is nil. If you need to set it to a pointer pointing to the zero value of the struct, you have to create a new instance of that struct, get a pointer to that, and set that instead."}, {"owner": {"reputation": 1137, "user_id": 834604, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/370dff88f83f96e95114d06df9ee5f42?s=128&d=identicon&r=PG", "display_name": "Lem0n", "link": "https://stackoverflow.com/users/834604/lem0n"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575915625, "post_id": 59254424, "comment_id": 104718703, "body": "That&#39;s what I tried doing when defining <code>inputStruct</code>, but apparently this creates a new &quot;*InputA&quot;, not a new &quot;InputA&quot;. This makes sense, but I don&#39;t know how to fix this to my intent."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1575915998, "post_id": 59254424, "comment_id": 104718852, "body": "If you want a new <code>InputA</code> that would be <code>reflect.New(v.Field(i).Elem().Type()).Interface()</code>."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 0, "last_activity_date": 1575916253, "creation_date": 1575916253, "answer_id": 59254689, "question_id": 59254424, "link": "https://stackoverflow.com/questions/59254424/golang-reflection-to-set-first-value-of-a-struct-to-its-zero-value/59254689#59254689", "title": "golang reflection to set first value of a struct to its zero value", "body": "<p>The code below should work. If the field is a pointer, it creates an instance of the type pointed to by that pointer, and sets that.</p>\n\n<pre><code>    typ := v.Field(i).Type()\n    var inputStruct reflect.Value\n    if typ.Kind()==reflect.Ptr {\n       inputStruct=reflect.New(typ.Elem())\n    } else {\n        inputStruct = reflect.New(typ).Elem()\n    }\n\n    reflect.ValueOf(&amp;actionInput).Elem().Field(i).Set(inputStruct)\n</code></pre>\n"}], "owner": {"reputation": 1137, "user_id": 834604, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/370dff88f83f96e95114d06df9ee5f42?s=128&d=identicon&r=PG", "display_name": "Lem0n", "link": "https://stackoverflow.com/users/834604/lem0n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 59254689, "answer_count": 1, "score": 0, "last_activity_date": 1575916253, "creation_date": 1575915029, "question_id": 59254424, "link": "https://stackoverflow.com/questions/59254424/golang-reflection-to-set-first-value-of-a-struct-to-its-zero-value", "title": "golang reflection to set first value of a struct to its zero value", "body": "<p>go playground: <a href=\"https://play.golang.org/p/ck3PtydW3YT\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ck3PtydW3YT</a></p>\n\n<p>I have a struct like:</p>\n\n<pre><code>type Input struct {\n    InputA *InputA\n    InputB *InputB\n    InputC *InputC\n}\n</code></pre>\n\n<p>I'm trying to use reflection to set the first value (in this case, *InputA) to its zero value (&amp;InputA{}), but it's not working:</p>\n\n<pre><code>    actionInput = Input{}\n    v := reflect.ValueOf(actionInput)\n\n    i := 0\n    typ := v.Field(i).Type()\n\n    inputStruct := reflect.New(typ).Elem().Interface()\n\n    reflect.ValueOf(&amp;actionInput).Elem().Field(i).Set(reflect.ValueOf(inputStruct))\n</code></pre>\n\n<p>I'm guessing this is because it's a pointer, but I'm not sure how to work around that</p>\n"}, {"tags": ["go", "ffi", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1575909189, "post_id": 59252963, "comment_id": 104715846, "body": "What have you tried? The preamble is parsed as C, so c-style comments should work correctly."}, {"owner": {"reputation": 1253, "user_id": 1621927, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/89ac07c3144b367a017d04e51441f050?s=128&d=identicon&r=PG", "display_name": "elichai2", "link": "https://stackoverflow.com/users/1621927/elichai2"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1575909883, "post_id": 59252963, "comment_id": 104716201, "body": "I tried just adding <code>&#47;&#47; my comment</code> and I get <code>invalid flag in #cgo CFLAGS: &#47;&#47;</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1575910044, "post_id": 59252963, "comment_id": 104716267, "body": "Please show the <i>exact</i> source you are using. Since the comment is what is being process, you need to comment the text twice (or use c-style block comments for one level to make it more obvious)."}, {"owner": {"reputation": 1253, "user_id": 1621927, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/89ac07c3144b367a017d04e51441f050?s=128&d=identicon&r=PG", "display_name": "elichai2", "link": "https://stackoverflow.com/users/1621927/elichai2"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1575914038, "post_id": 59252963, "comment_id": 104718010, "body": "@JimB Edited with the <i>exact</i> comment"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1575914322, "post_id": 59252963, "comment_id": 104718138, "body": "<code>#cgo</code> directives (as well as others directives) are not C source, you can&#39;t put C comments on the same line. (not to mention, go style guidelines prefer comments to precede their subjects anyway)"}], "answers": [{"tags": [], "owner": {"reputation": 161, "user_id": 11339140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_oZaOqfxYFI/AAAAAAAAAAI/AAAAAAAAADw/o9Jcv0YYArU/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u0438\u0444\u043e\u0440 \u0421\u0435\u0440\u044f\u043a\u043e\u0432", "link": "https://stackoverflow.com/users/11339140/%d0%9d%d0%b8%d0%ba%d0%b8%d1%84%d0%be%d1%80-%d0%a1%d0%b5%d1%80%d1%8f%d0%ba%d0%be%d0%b2"}, "is_accepted": true, "score": 1, "last_activity_date": 1575936952, "creation_date": 1575936952, "answer_id": 59258478, "question_id": 59252963, "link": "https://stackoverflow.com/questions/59252963/how-to-write-comments-in-cgo-arguments/59258478#59258478", "title": "how to write comments in cgo arguments", "body": "<p>Try that:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// // comment in the comment\n// #cgo CFLAGS: -I./depend/ -I./depend/src/\n// // 32 bit\n// #cgo 386 amd64p32 arm armbe mips mipsle mips64p32 mips64p32le ppc s390 sparc CFLAGS: -D32bit=1\n// // 64 bit\n// #cgo amd64 arm64 arm64be ppc64 ppc64le mips64 mips64le s390x sparc64 CFLAGS: -D64bit=1\n// // big endian\n// #cgo arm64be armbe mips mips64 mips64p32 ppc s390 s390x sparc sparc64 CFLAGS: -DBIGENDIAN=1\n// #include \"example.c\"\nimport \"C\"\n</code></pre>\n"}], "owner": {"reputation": 1253, "user_id": 1621927, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/89ac07c3144b367a017d04e51441f050?s=128&d=identicon&r=PG", "display_name": "elichai2", "link": "https://stackoverflow.com/users/1621927/elichai2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 59258478, "answer_count": 1, "score": -2, "last_activity_date": 1575936952, "creation_date": 1575908906, "last_edit_date": 1575914021, "question_id": 59252963, "link": "https://stackoverflow.com/questions/59252963/how-to-write-comments-in-cgo-arguments", "title": "how to write comments in cgo arguments", "body": "<p>I have the following cgo arguments and I want to annotate lines with things like <code>// this checks for 32bit</code> etc. how can I do that without getting? <code>invalid flag in #cgo CFLAGS: //</code></p>\n\n<pre><code>// #cgo CFLAGS: -I./depend/ -I./depend/src/\n// #cgo 386 amd64p32 arm armbe mips mipsle mips64p32 mips64p32le ppc s390 sparc CFLAGS: -D32bit=1 // 32 bit\n// #cgo amd64 arm64 arm64be ppc64 ppc64le mips64 mips64le s390x sparc64 CFLAGS: -D64bit=1 // 64 bit\n// #cgo arm64be armbe mips mips64 mips64p32 ppc s390 s390x sparc sparc64 CFLAGS: -DBIGENDIAN=1 // big endian\n// #include \"example.c\"\nimport \"C\"\n</code></pre>\n"}, {"tags": ["database", "mongodb", "go", "dbref", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 642, "user_id": 3420149, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/qO8hL.jpg?s=128&g=1", "display_name": "AknKplnoglu", "link": "https://stackoverflow.com/users/3420149/aknkplnoglu"}, "edited": false, "score": 0, "creation_date": 1583348796, "post_id": 59293606, "comment_id": 107089485, "body": "What if my Email object changes frequently? I think your first advice is not suitable for me. Manual reference seems the best option. What do you think about that @Wan Bachtiar?"}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "reply_to_user": {"reputation": 642, "user_id": 3420149, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/qO8hL.jpg?s=128&g=1", "display_name": "AknKplnoglu", "link": "https://stackoverflow.com/users/3420149/aknkplnoglu"}, "edited": false, "score": 0, "creation_date": 1583365651, "post_id": 59293606, "comment_id": 107095831, "body": "By <code>Email</code> object, do you mean the <code>Email</code> struct ? if that changes frequently, you can just not have an object mapping. That would be the same as resolving the DBRef without knowing the struct."}, {"owner": {"reputation": 642, "user_id": 3420149, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/qO8hL.jpg?s=128&g=1", "display_name": "AknKplnoglu", "link": "https://stackoverflow.com/users/3420149/aknkplnoglu"}, "edited": false, "score": 0, "creation_date": 1583428524, "post_id": 59293606, "comment_id": 107122399, "body": "Yes I mean Email struct. A user&#39;s email can change frequently @Wan Bachtiar."}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "reply_to_user": {"reputation": 642, "user_id": 3420149, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/qO8hL.jpg?s=128&g=1", "display_name": "AknKplnoglu", "link": "https://stackoverflow.com/users/3420149/aknkplnoglu"}, "edited": false, "score": 0, "creation_date": 1583448222, "post_id": 59293606, "comment_id": 107130644, "body": "There&#39;s a different between changing the struct and the value of the property inside of the struct. Changing value is quite easily done via update operations."}, {"owner": {"reputation": 642, "user_id": 3420149, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/qO8hL.jpg?s=128&g=1", "display_name": "AknKplnoglu", "link": "https://stackoverflow.com/users/3420149/aknkplnoglu"}, "edited": false, "score": 0, "creation_date": 1583474765, "post_id": 59293606, "comment_id": 107136590, "body": "Let&#39;s say there is a many to many relationship with user and email. In that example embedding email is not the best option. If an email changes(the property changes) it does not make sense updating the embedded email object in whole users collection.  What do you think @Wan Bachtiar ?"}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "reply_to_user": {"reputation": 642, "user_id": 3420149, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/qO8hL.jpg?s=128&g=1", "display_name": "AknKplnoglu", "link": "https://stackoverflow.com/users/3420149/aknkplnoglu"}, "edited": false, "score": 1, "creation_date": 1583557877, "post_id": 59293606, "comment_id": 107166174, "body": "I think you mean one-to-many, many-to-many doesn&#39;t make sense or not common for user/email relationship. Really depends on your use case. You can either have one-to-many and store emails on a different collection and use <code>$lookup</code> to join user and email, or you can have one-to-few and have an array of emails embedded on user collection."}], "tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": true, "score": 3, "last_activity_date": 1576096173, "creation_date": 1576096173, "answer_id": 59293606, "question_id": 59252797, "link": "https://stackoverflow.com/questions/59252797/using-dbref-in-mongo-go-driver/59293606#59293606", "title": "Using DBRef in mongo go driver", "body": "<blockquote>\n  <p>I worked with Spring Data Mongodb before and you can indicate Dbref inside a class</p>\n</blockquote>\n\n<p>Unless you have a compelling reason to use <a href=\"https://docs.mongodb.com/manual/reference/database-references/#dbref-explanation\" rel=\"nofollow noreferrer\">DBRefs</a> you should avoid it, or use <a href=\"https://docs.mongodb.com/manual/reference/database-references/#manual-references\" rel=\"nofollow noreferrer\">manual references</a> instead.</p>\n\n<p>With the example that you posted, you should definitely try to embed the value of <code>EmailAddress</code> in the document first. Using an embedded model should save you from querying the database twice just to retrieve <code>EmailAddress</code> value. See also <a href=\"https://docs.mongodb.com/manual/core/data-model-design/#embedded-data-models\" rel=\"nofollow noreferrer\">Embedded Data Models</a>. </p>\n\n<pre><code>type User struct \n{\n    ID           primitive.ObjectID `json:\"ID\" bson:\"_id\"`\n    UserName     string             `json:\"username\"`\n    EmailAddress Email              `json:\"emailAddress\"`\n}\n\ntype Email struct \n{\n     PrivateEmail     string      `json:\"private\"`\n     BusinessEmail    string      `json:\"business\"`\n}\n</code></pre>\n\n<p>In some cases, where you do need to store related information in separate documents, you should use <a href=\"https://docs.mongodb.com/manual/reference/database-references/#manual-references\" rel=\"nofollow noreferrer\">manual references</a>. You can do this by saving the <code>_id</code> field of one document in another document as a reference. Then your application can run a second query to return the related data. Since MongoDB v3.4+, you can use either <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup\" rel=\"nofollow noreferrer\">$lookup</a> or <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/graphLookup/#pipe._S_graphLookup\" rel=\"nofollow noreferrer\">$graphLookup</a> to perform a lookup. </p>\n\n<p><a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">MongoDB Go driver</a> does not have direct support for <code>DBRef</code> type. Spring Data MongoDB provides a convenient helper methods that form the query of <code>DBRef</code> automatically, although behind the scene it's just querying the database twice. </p>\n\n<p>Having said all the above, and there's some special edge case that you need it you can construct your own struct as below example:</p>\n\n<pre><code>type User struct \n{\n    ID               primitive.ObjectID  `json:\"ID\" bson:\"_id\"`\n    UserName         string              `json:\"username\"`\n    EmailAddress     DBRef               `json:\"emailAddress\"`\n}\n\ntype DBRef struct {\n   Ref interface{}   `bson:\"$ref\"`\n   ID  interface{}   `bson:\"$id\"`\n   DB  interface{}   `bson:\"$db\"`\n}\n</code></pre>\n\n<p>Again, please note that MongoDB drivers do not automatically resolve <code>DBRef</code>. There may be frameworks or helpers on top of the driver that could provide the automatic reference resolution (looking up the value by performing a second query). </p>\n"}], "owner": {"reputation": 642, "user_id": 3420149, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/qO8hL.jpg?s=128&g=1", "display_name": "AknKplnoglu", "link": "https://stackoverflow.com/users/3420149/aknkplnoglu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 961, "favorite_count": 0, "accepted_answer_id": 59293606, "answer_count": 1, "score": 0, "last_activity_date": 1576096173, "creation_date": 1575908300, "last_edit_date": 1575913005, "question_id": 59252797, "link": "https://stackoverflow.com/questions/59252797/using-dbref-in-mongo-go-driver", "title": "Using DBRef in mongo go driver", "body": "<p>I want to use <code>DBref</code> with <code>go-mongo-driver</code> but I couldn't find any example about it. How can I achieve this? \nI worked with Spring Data Mongodb before and you can indicate Dbref inside a class like :</p>\n\n<blockquote>\n  <p>@DBRef private EmailAddress emailAddress;</p>\n</blockquote>\n\n<p>Is there anybody to show up a good example?\nThanks in advance</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 4970, "user_id": 892788, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e233ae4d7776dd50ffc5dd43eab2d8e8?s=128&d=identicon&r=PG", "display_name": "diyoda_", "link": "https://stackoverflow.com/users/892788/diyoda"}, "edited": false, "score": 0, "creation_date": 1575904409, "post_id": 59251539, "comment_id": 104713158, "body": "sanity check the value : <code>pool.PoolId</code> is correct"}], "answers": [{"tags": [], "owner": {"reputation": 96, "user_id": 11673635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dbe6722f75d1f91e49e4217b44c8c40?s=128&d=identicon&r=PG&f=1", "display_name": "cyprx", "link": "https://stackoverflow.com/users/11673635/cyprx"}, "is_accepted": true, "score": 7, "last_activity_date": 1575904588, "creation_date": 1575904588, "answer_id": 59251767, "question_id": 59251539, "link": "https://stackoverflow.com/questions/59251539/gorm-query-returning-only-a-single-row/59251767#59251767", "title": "Gorm query returning only a single row", "body": "<p>I rarely use an ORM while coding with go, but following the <a href=\"http://gorm.io/docs/query.html#Struct-amp-Map\" rel=\"noreferrer\">doc</a> from gorm, it seems like you are doing it the wrong way.</p>\n\n<p><code>Scan</code> is used for scanning result into another struct, like this:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>type Result struct {\r\n  Name string\r\n  Age  int\r\n}\r\n\r\nvar result Result\r\ndb.Table(\"users\").Select(\"name, age\").Where(\"name = ?\", 3).Scan(&amp;result)</code></pre>\r\n</div>\r\n</div>\r\n\nThe correct way to get query results into a slice of structs should be:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>var poolVolumes []Volume\r\nif err := tx.Where(\"storageid = ?\", pool.PoolId).Find(&amp;poolVolumes).Error; err != nil {\r\n    return err\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11471017"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2259, "favorite_count": 0, "accepted_answer_id": 59251767, "answer_count": 1, "score": 1, "last_activity_date": 1575906131, "creation_date": 1575903772, "last_edit_date": 1575906131, "question_id": 59251539, "link": "https://stackoverflow.com/questions/59251539/gorm-query-returning-only-a-single-row", "title": "Gorm query returning only a single row", "body": "<p>We're trying to use Gorm with mysql 8 to much frustration.</p>\n\n<p>I have the following tables (simplified for brevity here)</p>\n\n<pre><code>type StoragePool struct {\n    gorm.Model\n    PoolId  string   `json:\"id\" gorm:\"column:poolid;size:40;unique;not null\"`\n    Volumes []Volume `json:\"volumes\" gorm:\"foreignkey:StorageId;association_foreignkey:PoolId\"`\n}\n\ntype Volume struct {\n    gorm.Model\n    StorageId string `json:\"storageid\" gorm:\"column:storageid;size:40\"`\n}\n</code></pre>\n\n<p>Data insertions seem to work fine. Both tables get populated and no constraints are violated.</p>\n\n<p>A query that expects a single record seems to work fine:</p>\n\n<pre><code>poolRecord := &amp;StoragePool{}\nif err := tx.Where(\"poolid = ?\", pool.PoolId).First(&amp;StoragePool{}).Scan(poolRecord).Error; err != nil {        \n    return err\n}\n</code></pre>\n\n<p>This query only returns a single row. When I perform this exact query as raw SQL outside of go, it returns all 31 records I expect.</p>\n\n<pre><code>var poolVolumes []Volume\nif err := tx.Where(\"storageid = ?\", pool.PoolId).Find(&amp;Volume{}).Scan(&amp;poolVolumes).Error; err != nil {\n    return err\n}\nlog.Debugf(\"found %d volumes belonging to %q [%s]\", len(poolVolumes), pool.Name, pool.PoolId)\n</code></pre>\n\n<p>According to the docs, that second sql statement is the equivalent of \"SELECT * FROM VOLUMES WHERE STORAGEID = 'poolid'\". That is not the behavior I am getting.</p>\n\n<p>Anyone have any ideas what I'm doing wrong here?</p>\n"}, {"tags": ["go", "kubernetes"], "comments": [{"owner": {"reputation": 287, "user_id": 12377933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2b0626c6a712d040aaf21387ac6a35d?s=128&d=identicon&r=PG&f=1", "display_name": "julian", "link": "https://stackoverflow.com/users/12377933/julian"}, "edited": false, "score": 0, "creation_date": 1575901744, "post_id": 59250812, "comment_id": 104711576, "body": "you can call a service based on its name and namespace, e.g. if we have a service called proxy under the namespace dev we can call the host as : <code>HOST=proxy.dev.svc</code>"}, {"owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "reply_to_user": {"reputation": 287, "user_id": 12377933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2b0626c6a712d040aaf21387ac6a35d?s=128&d=identicon&r=PG&f=1", "display_name": "julian", "link": "https://stackoverflow.com/users/12377933/julian"}, "edited": false, "score": 0, "creation_date": 1575903369, "post_id": 59250812, "comment_id": 104712568, "body": "@julian- ok thanks, should I define it as type <code>NodePort</code> and what is the port which I should use? if any..."}, {"owner": {"reputation": 287, "user_id": 12377933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2b0626c6a712d040aaf21387ac6a35d?s=128&d=identicon&r=PG&f=1", "display_name": "julian", "link": "https://stackoverflow.com/users/12377933/julian"}, "edited": false, "score": 1, "creation_date": 1575904206, "post_id": 59250812, "comment_id": 104713042, "body": "that depends on which port your app is listening. Maybe have a look at this: <a href=\"https://blog.learnk8s.io/connect-service-kubernetes-7cb346cf2f64\" rel=\"nofollow noreferrer\">blog.learnk8s.io/connect-service-kubernetes-7cb346cf2f64</a>"}], "answers": [{"comments": [{"owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "edited": false, "score": 0, "creation_date": 1575901634, "post_id": 59250923, "comment_id": 104711512, "body": "sorry I didint get it, how does it know to which IP it should access ?"}, {"owner": {"reputation": 898, "user_id": 7829123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Rwdmn.png?s=128&g=1", "display_name": "Martin Paucot", "link": "https://stackoverflow.com/users/7829123/martin-paucot"}, "reply_to_user": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "edited": false, "score": 0, "creation_date": 1575902705, "post_id": 59250923, "comment_id": 104712179, "body": "@NinaS Take a look at the concept of selectors <a href=\"https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/\" rel=\"nofollow noreferrer\">kubernetes.io/docs/concepts/overview/working-with-objects/&hellip;</a>"}, {"owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "reply_to_user": {"reputation": 898, "user_id": 7829123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Rwdmn.png?s=128&g=1", "display_name": "Martin Paucot", "link": "https://stackoverflow.com/users/7829123/martin-paucot"}, "edited": false, "score": 0, "creation_date": 1575903008, "post_id": 59250923, "comment_id": 104712373, "body": "@MartinPaucot - thanks, I already look into it but not found how from restApi I can call to service inside the same cluster... how to define the service etc, if you have example for this it will be great"}, {"owner": {"reputation": 11, "user_id": 12505768, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/6c8daa2b4f859d7461846fcb67fd673b?s=128&d=identicon&r=PG", "display_name": "Jadro", "link": "https://stackoverflow.com/users/12505768/jadro"}, "edited": false, "score": 0, "creation_date": 1575906947, "post_id": 59250923, "comment_id": 104714583, "body": "Sorry, wrong formatting. I have editted out how should it look. The IP should not matter, as it will load balance between various pods that make up the App B"}], "tags": [], "owner": {"reputation": 11, "user_id": 12505768, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/6c8daa2b4f859d7461846fcb67fd673b?s=128&d=identicon&r=PG", "display_name": "Jadro", "link": "https://stackoverflow.com/users/12505768/jadro"}, "is_accepted": false, "score": 1, "last_activity_date": 1575906901, "last_edit_date": 1575906901, "creation_date": 1575901558, "answer_id": 59250923, "question_id": 59250812, "link": "https://stackoverflow.com/questions/59250812/how-to-use-application-host-and-port-on-runtime/59250923#59250923", "title": "How to use application host and port on runtime", "body": "<p>Define a Service for your application B. Then you can access it from other pods with the following url: <em>your-service-name</em>:<em>port</em>/api/app/getconfig</p>\n"}, {"comments": [{"owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "edited": false, "score": 0, "creation_date": 1575906494, "post_id": 59251928, "comment_id": 104714320, "body": "Thanks will try it and let you know :)"}], "tags": [], "owner": {"reputation": 113, "user_id": 6598968, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JAhuF.png?s=128&g=1", "display_name": "Connor Graham", "link": "https://stackoverflow.com/users/6598968/connor-graham"}, "is_accepted": false, "score": 1, "last_activity_date": 1575905154, "creation_date": 1575905154, "answer_id": 59251928, "question_id": 59250812, "link": "https://stackoverflow.com/questions/59250812/how-to-use-application-host-and-port-on-runtime/59251928#59251928", "title": "How to use application host and port on runtime", "body": "<p>If you have 2 apps on the same cluster then they can reference eachother via kubernetes' built in DNS.</p>\n\n<p>If AppA needs to reference AppB, then as long as you have a Service defined for AppB, you can reference it with <code>&lt;service&gt;.&lt;namespace&gt;</code>. In your case, if AppB was running the in the default namespace you could call <code>AppB.default/api/app/getconfig</code>.</p>\n\n<p>The port part can be managed by your service definition. Below I'm using port 80 so I don't have to manually specify the port in my requests</p>\n\n<pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: AppB\nspec:\n  ports:\n  - name: \"80\"\n    port: 80\n    targetPort: 9090\n  selector:\n    select: AppB\n</code></pre>\n\n<p>More information: <a href=\"https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/\" rel=\"nofollow noreferrer\">https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/</a></p>\n"}, {"tags": [], "owner": {"reputation": 287, "user_id": 12377933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2b0626c6a712d040aaf21387ac6a35d?s=128&d=identicon&r=PG&f=1", "display_name": "julian", "link": "https://stackoverflow.com/users/12377933/julian"}, "is_accepted": true, "score": 3, "last_activity_date": 1575905190, "creation_date": 1575905190, "answer_id": 59251941, "question_id": 59250812, "link": "https://stackoverflow.com/questions/59250812/how-to-use-application-host-and-port-on-runtime/59251941#59251941", "title": "How to use application host and port on runtime", "body": "<p>Note: The Kube-DNS naming convention is <code>service.namespace.svc.cluster-domain.tld</code> and the default cluster domain is <code>cluster.local</code></p>\n\n<p>So you can refer to your app as ..svc as long as the services are in the same cluster. You then need to check the ports on which the apps are listening by issuing: </p>\n\n<pre><code>kubectl -n &lt;namespace&gt; get svc\n</code></pre>\n\n<p>note the service identifier and issue: </p>\n\n<pre><code>kubectl -n &lt;namespace&gt; get svc &lt;identifier&gt; -o yaml\n</code></pre>\n\n<p>This will list you the service manifest where you can see which port the app is listening on. </p>\n"}, {"comments": [{"owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "edited": false, "score": 0, "creation_date": 1575906423, "post_id": 59252070, "comment_id": 104714289, "body": "Thanks but I cannot hard-coded it :( does with <code>NodePort</code> service it will work on the same cluster ? from diffrent cluster this is not a requirement ritght now ... thanks"}, {"owner": {"reputation": 5254, "user_id": 5564578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JBnMN.jpg?s=128&g=1", "display_name": "suren", "link": "https://stackoverflow.com/users/5564578/suren"}, "reply_to_user": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "edited": false, "score": 0, "creation_date": 1575907149, "post_id": 59252070, "comment_id": 104714661, "body": "In the same cluster, you have no problem. As everyone here is suggesting, you can reach the service (clusterIp would be enough) with <code>service_name.svc_namespace.svc.cluster.local</code>, so you can hit this endpoint with your path with no problem always. From different clusters though, you need service discovery."}], "tags": [], "owner": {"reputation": 5254, "user_id": 5564578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JBnMN.jpg?s=128&g=1", "display_name": "suren", "link": "https://stackoverflow.com/users/5564578/suren"}, "is_accepted": false, "score": 1, "last_activity_date": 1575905637, "creation_date": 1575905637, "answer_id": 59252070, "question_id": 59250812, "link": "https://stackoverflow.com/questions/59250812/how-to-use-application-host-and-port-on-runtime/59252070#59252070", "title": "How to use application host and port on runtime", "body": "<p>If you want to make it so tolerant (from any cluster to any cluster), then you need a DNS, with an external IP address in front of the <code>App B</code>.</p>\n\n<p>I would consider hardcoding somewhere. With hardcoding it in one <code>ConfigMap</code>, you could get some beautiful implementations.</p>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 8233790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb2af0a5e60adcfdd5fd7d76050ecea1?s=128&d=identicon&r=PG&f=1", "display_name": "C Han", "link": "https://stackoverflow.com/users/8233790/c-han"}, "is_accepted": false, "score": 1, "last_activity_date": 1575907390, "last_edit_date": 1575907390, "creation_date": 1575906630, "answer_id": 59252334, "question_id": 59250812, "link": "https://stackoverflow.com/questions/59250812/how-to-use-application-host-and-port-on-runtime/59252334#59252334", "title": "How to use application host and port on runtime", "body": "<p>Create a ClusterIP service for appB.\n<strong>hardcode the port</strong>, this port is only for that specific service, and will not have any conflict in different clusters.\ndo <code>kubectl get svc &lt;your service&gt;</code> to get the ip of the service, then use <code>nslookup &lt;ip&gt;</code> you can see an fqdn in the result.\nNormally, the fqdn is <code>&lt;your-service&gt;.&lt;namespace&gt;.svc.cluster.local</code>\nRef: <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/\" rel=\"nofollow noreferrer\">https://kubernetes.io/docs/concepts/services-networking/service/</a></p>\n"}], "owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 2, "accepted_answer_id": 59251941, "answer_count": 5, "score": 1, "last_activity_date": 1575907390, "creation_date": 1575901235, "last_edit_date": 1575906169, "question_id": 59250812, "link": "https://stackoverflow.com/questions/59250812/how-to-use-application-host-and-port-on-runtime", "title": "How to use application host and port on runtime", "body": "<p>I\u2019ve two <strong>differen</strong>t apps in k8s that need needs to read data,e.g. <code>AppA</code> from <code>AppB</code>, both are deployed on the <strong>same cluster</strong></p>\n\n<p>The <code>tricky</code> part here is that I need the both apps will deployed to any cluster and know the host and port to connect, I <strong>don't</strong> want to use hard-coded values.</p>\n\n<p>e.g. </p>\n\n<p>App A reads data from App B</p>\n\n<p>App <code>B</code> is web application with rest API\nhence app <code>A</code> needs to call like <a href=\"http://10.26.131.136:9090/api/app/getconfig\" rel=\"nofollow noreferrer\">http://10.26.131.136:9090/api/app/getconfig</a></p>\n\n<p>App A know the service path: like <code>api/app/getconfig</code> of App <code>B</code> but how it can know the the <strong>host and the port</strong> of appB?</p>\n\n<p>I cannot use it hardcoded , this works if I use <code>type:LoadBalacer</code> but this is hard-coded host and port, I need somehow to determine it on run-time maybe with serviceName, etc?</p>\n"}, {"tags": ["go", "redis"], "answers": [{"tags": [], "owner": {"reputation": 135, "user_id": 5869005, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89bd0b8b28d02afc7b4deeaaa560dbf4?s=128&d=identicon&r=PG&f=1", "display_name": "Grabusz", "link": "https://stackoverflow.com/users/5869005/grabusz"}, "is_accepted": true, "score": 3, "last_activity_date": 1575898873, "creation_date": 1575898873, "answer_id": 59250139, "question_id": 59249885, "link": "https://stackoverflow.com/questions/59249885/go-redis-connect-to-db1/59250139#59250139", "title": "Go redis connect to db1", "body": "<p>As you can see in the <a href=\"https://redis.io/commands/select\" rel=\"nofollow noreferrer\">SELECT command documentation</a>:</p>\n\n<blockquote>\n  <p>Select the Redis logical database having the specified zero-based\n  numeric index. New connections always use the database 0.</p>\n</blockquote>\n\n<p>which means that you're supposed to pass an integer (in your case that would be 1), so it should look like this: <code>keys, err := conn.Do(\"SELECT\",\"1\")</code></p>\n\n<p>In general Redis databases are assigned numbers starting from 0, and you have to configure in the <a href=\"http://download.redis.io/redis-stable/redis.conf\" rel=\"nofollow noreferrer\">redis.conf</a> how many of them you want to have (by default you have 16 at indexes from 0 to 15):</p>\n\n<pre><code># Set the number of databases. The default database is DB 0, you can select\n# a different one on a per-connection basis using SELECT &lt;dbid&gt; where\n# dbid is a number between 0 and 'databases'-1\ndatabases 16\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": -1, "last_activity_date": 1575916454, "creation_date": 1575916454, "answer_id": 59254738, "question_id": 59249885, "link": "https://stackoverflow.com/questions/59249885/go-redis-connect-to-db1/59254738#59254738", "title": "Go redis connect to db1", "body": "<p>Redis support 16 database. You can switch a DB using an integer starting from 0 to 15</p>\n"}], "owner": {"reputation": 75, "user_id": 6273422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/54cecf2e296e7c25df1c9b4c91e38e60?s=128&d=identicon&r=PG", "display_name": "shuki shtein", "link": "https://stackoverflow.com/users/6273422/shuki-shtein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 439, "favorite_count": 0, "accepted_answer_id": 59250139, "answer_count": 2, "score": 2, "last_activity_date": 1575916454, "creation_date": 1575897959, "question_id": 59249885, "link": "https://stackoverflow.com/questions/59249885/go-redis-connect-to-db1", "title": "Go redis connect to db1", "body": "<p>I have redis Server with a few db, i want to connect to db1 in the server.</p>\n\n<p>i manage to connect to the server but i couldn't connect to one of the db.</p>\n\n<p>this is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"redigo-master\"\n)\n\n    func main() {\n\n        conn, err := redis.Dial(\"tcp\", \"qacd:6410\")\n        defer conn.Close()\n        if err != nil {\n            fmt.Println(err)\n        }\n        keys, err := conn.Do(\"SELECT\",\"db1\")\n        fmt.Println(keys)\n    }\n</code></pre>\n\n<p>the result is:</p>\n\n<pre><code>ERR invalid DB index\n</code></pre>\n\n<p>any way to get to the 1st db?</p>\n"}, {"tags": ["go", "jwt", "go-gin"], "comments": [{"owner": {"reputation": 3517, "user_id": 8069748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g9ZD9.png?s=128&g=1", "display_name": "Navid Zarepak", "link": "https://stackoverflow.com/users/8069748/navid-zarepak"}, "edited": false, "score": 0, "creation_date": 1575912028, "post_id": 59249418, "comment_id": 104717134, "body": "You mean decode the token string? <a href=\"https://godoc.org/github.com/dgrijalva/jwt-go#ParseWithClaims\" rel=\"nofollow noreferrer\">godoc.org/github.com/dgrijalva/jwt-go#ParseWithClaims</a>"}, {"owner": {"reputation": 85, "user_id": 8011371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed07f26d39c31c8a43c153dbd1fc4a55?s=128&d=identicon&r=PG&f=1", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/8011371/abhinav"}, "reply_to_user": {"reputation": 3517, "user_id": 8069748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g9ZD9.png?s=128&g=1", "display_name": "Navid Zarepak", "link": "https://stackoverflow.com/users/8069748/navid-zarepak"}, "edited": false, "score": 0, "creation_date": 1575961854, "post_id": 59249418, "comment_id": 104732197, "body": "@NavidZarepak Yeah, I just need to extract the name as well as Id from the token."}], "answers": [{"tags": [], "owner": {"reputation": 359, "user_id": 2879188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c9007bf8ffe2f57f4bfa848c4c50fc8?s=128&d=identicon&r=PG&f=1", "display_name": "ShayK", "link": "https://stackoverflow.com/users/2879188/shayk"}, "is_accepted": false, "score": 0, "last_activity_date": 1575930159, "creation_date": 1575930159, "answer_id": 59257530, "question_id": 59249418, "link": "https://stackoverflow.com/questions/59249418/how-to-get-the-claims-from-the-token/59257530#59257530", "title": "How to get the claims from the token?", "body": "<p>Try this:</p>\n\n<pre><code>func parseToken(tokenString string) (claims jwt.MapClaims, err error) {\n    claims = jwt.MapClaims{}\n    parsed, err := jwt.ParseWithClaims(tokenString, claims, verifyFunc)\n    if err != nil {\n        return nil, err\n    }\n    if !parsed.Valid {\n        return nil, fmt.Errorf(\"invalid token\")\n    }\n    return claims, nil\n}\n\nfunc verifyFunc(token *jwt.Token) (interface{}, error) {\n    return []byte(os.Getenv(\"SECRET_CODE\")), nil\n}\n</code></pre>\n\n<p>The first method accepts a token string and parses it.\nThe second method is the key func in which you can use properties in the header of the token</p>\n"}], "owner": {"reputation": 85, "user_id": 8011371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed07f26d39c31c8a43c153dbd1fc4a55?s=128&d=identicon&r=PG&f=1", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/8011371/abhinav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 128, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1597218072, "creation_date": 1575896288, "last_edit_date": 1597218072, "question_id": 59249418, "link": "https://stackoverflow.com/questions/59249418/how-to-get-the-claims-from-the-token", "title": "How to get the claims from the token?", "body": "<p>I have a GenerateToken function that generates the token based on Username, Id and the combination of Standard Claims.</p>\n\n<pre><code>func GenerateToken( creds *users.User) (tokenString string, err error){\n    expirationTime := time.Now().Add(100 * time.Hour)\n    claims := &amp;Claims{\n        Username: creds.Username,\n        Id      : creds.Id,\n        StandardClaims: jwt.StandardClaims{\n            ExpiresAt: expirationTime.Unix(),\n            Issuer:    \"gogin\",\n        },\n    }\n    token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)\n    tokenString, err = token.SignedString([]byte(os.Getenv(\"SECRET_CODE\")))\n    if err != nil{\n        return \"\", err\n    }\n    return tokenString, nil\n}\n</code></pre>\n\n<p>And here is the struct for the Claims</p>\n\n<pre><code>type Claims struct {\n    Username string `json:\"username\"`\n    Id uint32\n    jwt.StandardClaims\n}\n</code></pre>\n\n<p>Above will generate me a token.\nI need to decode this token and extract the Claims. Is there any way to get the same?</p>\n"}, {"tags": ["sockets", "go", "websocket", "tcp"], "answers": [{"tags": [], "owner": {"reputation": 550, "user_id": 3518621, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf3b0c525ec4ad5c29864f230486dea2?s=128&d=identicon&r=PG&f=1", "display_name": "cslrnr", "link": "https://stackoverflow.com/users/3518621/cslrnr"}, "is_accepted": false, "score": 2, "last_activity_date": 1575908236, "last_edit_date": 1575908236, "creation_date": 1575898062, "answer_id": 59249918, "question_id": 59248852, "link": "https://stackoverflow.com/questions/59248852/error-an-established-connection-was-aborted-by-the-software-in-your-host-machin/59249918#59249918", "title": "Error &quot;An established connection was aborted by the software in your host machine&quot;", "body": "<p>From the error code , I assume you are building this in windows and the error indicates that there is some issue in your host machine , that is your windows desktop/laptop . May be firewall or antivirus software or some other third party software or your internet connectivity if you connect to server over internet. </p>\n\n<p>Use wireshark to trace the packet flow to understand bit more. As per RFC for websocket , it uses tcp connection , use proper tcp filters with wireshark to capture the packets and inspect from which point the connection has closed.</p>\n"}], "owner": {"reputation": 35, "user_id": 12270548, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-29aG6VZz4qU/AAAAAAAAAAI/AAAAAAAAAHI/hc0bHaTWANc/photo.jpg?sz=128", "display_name": "\u0410\u0440\u0442\u0435\u043c \u0410\u0440\u0442\u0435\u043c\u044b\u0447", "link": "https://stackoverflow.com/users/12270548/%d0%90%d1%80%d1%82%d0%b5%d0%bc-%d0%90%d1%80%d1%82%d0%b5%d0%bc%d1%8b%d1%87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1419, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1596018842, "creation_date": 1575894090, "last_edit_date": 1596018842, "question_id": 59248852, "link": "https://stackoverflow.com/questions/59248852/error-an-established-connection-was-aborted-by-the-software-in-your-host-machin", "title": "Error &quot;An established connection was aborted by the software in your host machine&quot;", "body": "<p>back code (Go):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var upgrader = websocket.Upgrader{\n    ReadBufferSize:  1024,\n    WriteBufferSize: 1024,\n    CheckOrigin: func(r *http.Request) bool {\n      return true\n    },\n  }\n\n// ..................\n\nhttp.HandleFunc(\"/notifications\", func(w http.ResponseWriter, r *http.Request) {\n        ws, err := upgrader.Upgrade(w, r, nil)\n        if err != nil {\n            logrus.Panic(err)\n        }\n\n\n    })\n</code></pre>\n\n<p>front (JS)</p>\n\n<pre><code>conn = new WebSocket(\"ws://host:2020/notifications\");\n    conn.onmessage = function (event) {\n        if(event.data != \"\") {\n            newMessage(JSON.parse(event.data));\n        }\n    };\n</code></pre>\n\n<p>in this line logrus.Panic(err) sometimes get an error  </p>\n\n<pre><code>write tcp 10.3.0.14:2020-&gt;10.2.1.87:58691: wsasend: An established connection was aborted by the software in your host machine.\n</code></pre>\n\n<p>what could it be, something with the network?</p>\n"}, {"tags": ["azure", "go", "kubernetes"], "comments": [{"owner": {"reputation": 183792, "user_id": 1749403, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/g0aFU.png?s=128&g=1", "display_name": "Sajeetharan", "link": "https://stackoverflow.com/users/1749403/sajeetharan"}, "edited": false, "score": 0, "creation_date": 1575893071, "post_id": 59248379, "comment_id": 104706806, "body": "did you check this <a href=\"https://github.com/kubernetes/kubernetes/issues/27973\" rel=\"nofollow noreferrer\">github.com/kubernetes/kubernetes/issues/27973</a>"}, {"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "reply_to_user": {"reputation": 183792, "user_id": 1749403, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/g0aFU.png?s=128&g=1", "display_name": "Sajeetharan", "link": "https://stackoverflow.com/users/1749403/sajeetharan"}, "edited": false, "score": 0, "creation_date": 1575894433, "post_id": 59248379, "comment_id": 104707560, "body": "@Sajeetharan - Thanks, sorry I dont realy understand how it could help, what am I missing?"}], "answers": [{"tags": [], "owner": {"reputation": 7394, "user_id": 1093508, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/745c6e48a5e09036b23b4f57caab5bec?s=128&d=identicon&r=PG", "display_name": "D&#225;vid Moln&#225;r", "link": "https://stackoverflow.com/users/1093508/d%c3%a1vid-moln%c3%a1r"}, "is_accepted": true, "score": 2, "last_activity_date": 1575915849, "last_edit_date": 1575915849, "creation_date": 1575910380, "answer_id": 59253319, "question_id": 59248379, "link": "https://stackoverflow.com/questions/59248379/k8s-get-config-map-data-issue/59253319#59253319", "title": "K8S - get config map data issue", "body": "<p>You'll need to create the token manually:</p>\n\n<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: build-robot-secret\n  annotations:\n    kubernetes.io/service-account.name: default # I assume you use the default service account\ntype: kubernetes.io/service-account-token\n</code></pre>\n\n<p>Then mount this secret as a file into the pod:</p>\n\n<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: mypod\nspec:\n  containers:\n  - name: mypod\n    image: redis\n    volumeMounts:\n    - name: foo\n      mountPath: \"/var/run/secrets/kubernetes.io/serviceaccount\"\n  volumes:\n  - name: foo\n    secret:\n      secretName: build-robot-secret\n</code></pre>\n"}], "owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 1, "accepted_answer_id": 59253319, "answer_count": 1, "score": 0, "last_activity_date": 1575915849, "creation_date": 1575892418, "last_edit_date": 1575892726, "question_id": 59248379, "link": "https://stackoverflow.com/questions/59248379/k8s-get-config-map-data-issue", "title": "K8S - get config map data issue", "body": "<p>we need that each pod which use our binary will have the ability to read a specific <code>config map</code></p>\n\n<p>we use for that  the Go API to read the config map.</p>\n\n<p><a href=\"https://github.com/kubernetes/client-go\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/client-go</a> </p>\n\n<p>The tricky part here that some of the pods have the following config  <code>automountServiceAccountToken: false</code> (unfortunately we cannot change it :(  ) </p>\n\n<p>Hence Im getting the following error:</p>\n\n<pre><code> open /var/run/secrets/kubernetes.io/serviceaccount/token:no such file or directory\n</code></pre>\n\n<p>Any idea how to avoid this ? </p>\n\n<p>is there is other solution how to provide specific env variable to be available on all the pods and all the namespace ? </p>\n\n<p><a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server\" rel=\"nofollow noreferrer\">https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server</a></p>\n"}, {"tags": ["go", "telegram-bot", "go-echo"], "comments": [{"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1575891901, "post_id": 59247645, "comment_id": 104706193, "body": "This may not solve your problem, but I noticed that your are using the echo lib v1.x while the latest is v4. You probably want to add the version number you want to use to the echo import path."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1575892590, "post_id": 59247645, "comment_id": 104706563, "body": "The argument of <code>NewBotAPI</code> must be a valid telegram API token as per <a href=\"https://go-telegram-bot-api.github.io/getting-started/\" rel=\"nofollow noreferrer\">go-telegram-bot-api.github.io/getting-started</a>. You give an empty string. According to this documentation, the function will panic if the token is not valid."}, {"owner": {"reputation": 3517, "user_id": 8069748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g9ZD9.png?s=128&g=1", "display_name": "Navid Zarepak", "link": "https://stackoverflow.com/users/8069748/navid-zarepak"}, "reply_to_user": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1575895762, "post_id": 59247645, "comment_id": 104708254, "body": "@chmike He removed the token so he can post the code here. His problem is that it never reaches that part."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "reply_to_user": {"reputation": 3517, "user_id": 8069748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g9ZD9.png?s=128&g=1", "display_name": "Navid Zarepak", "link": "https://stackoverflow.com/users/8069748/navid-zarepak"}, "edited": false, "score": 0, "creation_date": 1575896431, "post_id": 59247645, "comment_id": 104708593, "body": "@NavidZarepak The problem is thus not in telegram bot api. The OP doesn&#39;t say where and how the program fails. Error message ? Can&#39;t do much to help without this information."}, {"owner": {"reputation": 3517, "user_id": 8069748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g9ZD9.png?s=128&g=1", "display_name": "Navid Zarepak", "link": "https://stackoverflow.com/users/8069748/navid-zarepak"}, "reply_to_user": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1575899731, "post_id": 59247645, "comment_id": 104710379, "body": "@chmike You can. You can clearly see that the process doesn&#39;t reach any code after <code>_ = e.Start(&quot;:1323&quot;)</code>.  And the problem: &quot;the telegram bot didn&#39;t start.&quot;. Even if it can reach the codes (It won&#39;t), your argument about the token not being there is not going to solve anything because you know why it&#39;s not there and even if you don&#39;t, then you should ask. And if you can&#39;t help without any error messages, then ask for them so he can tell you that there is none which can help you to see the <code>_ = e.Start(&quot;:1323&quot;)</code> part and realize the actual problem."}, {"owner": {"reputation": 3517, "user_id": 8069748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g9ZD9.png?s=128&g=1", "display_name": "Navid Zarepak", "link": "https://stackoverflow.com/users/8069748/navid-zarepak"}, "reply_to_user": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1575899965, "post_id": 59247645, "comment_id": 104710513, "body": "@chmike Also, according to the docs, if the token is invalid, the function will <b>NOT</b> panic but returns an error and you can handle it the way you want."}], "answers": [{"tags": [], "owner": {"reputation": 3517, "user_id": 8069748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g9ZD9.png?s=128&g=1", "display_name": "Navid Zarepak", "link": "https://stackoverflow.com/users/8069748/navid-zarepak"}, "is_accepted": true, "score": 2, "last_activity_date": 1575895527, "last_edit_date": 1575895527, "creation_date": 1575894376, "answer_id": 59248923, "question_id": 59247645, "link": "https://stackoverflow.com/questions/59247645/how-to-works-with-golang-echo-framework-and-telegram-bot/59248923#59248923", "title": "How to works with Golang echo framework and Telegram bot?", "body": "<p>The problem is that when you start the echo server, then the code does not go any further.</p>\n\n<p>In order to use both of them, you need to separate each of them into a different thread and also stop your program to finish and stop everything.</p>\n\n<p>The simplest way is to separate the web server and telegram bot and start them separately:</p>\n\n<pre><code>func StartEcho() { \n    e := echo.New()\n    e.GET(\"/\", func(c echo.Context) error {\n        return c.String(http.StatusOK, \"Hello, World!\")\n    })\n    _ = e.Start(\":1323\")\n}\n\nfunc StartBot() {\n    bot, err := tgbotapi.NewBotAPI(\"\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    bot.Debug = true\n\n    log.Printf(\"Authorized on account %s\", bot.Self.UserName)\n\n    u := tgbotapi.NewUpdate(0)\n    u.Timeout = 60\n\n    updates, err := bot.GetUpdatesChan(u)\n\n    for update := range updates {\n        if update.Message == nil {\n            continue\n        }\n\n        gp_msg := tgbotapi.NewMessage(update.Message.Chat.ID, \"Hi\")\n        bot.Send(gp_msg)\n    }\n}\n</code></pre>\n\n<p>And then call them:</p>\n\n<pre><code>func main() {\n    # Start the echo server in a separate thread\n    go StartEcho()\n\n    db, err := sql.Open(\"sqlite3\", \"./criticism.db\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer db.Close()\n\n    # Start the bot in a separate thread\n    go StartBot()\n\n    # To stop the program to finish and close\n    select{}\n\n    # You can also use https://golang.org/pkg/sync/#WaitGroup instead.\n}\n</code></pre>\n\n<p>Or you can just run the last one in the main thread:</p>\n\n<pre><code>func main() {\n    # Start the echo server in a separate thread\n    go StartEcho()\n\n    db, err := sql.Open(\"sqlite3\", \"./criticism.db\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer db.Close()\n\n    # Start the bot\n    StartBot()\n}\n</code></pre>\n\n<p>But if the last one stops, so will your entire program and the echo server with it. So you have to recover any panics and doesn't allow it to stop.</p>\n"}], "owner": {"reputation": 359, "user_id": 7431943, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-G3caskqfX5g/AAAAAAAAAAI/AAAAAAAAAkI/XSiOhk4rSLA/photo.jpg?sz=128", "display_name": "MohammadReza", "link": "https://stackoverflow.com/users/7431943/mohammadreza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 503, "favorite_count": 0, "accepted_answer_id": 59248923, "answer_count": 1, "score": 5, "last_activity_date": 1575895527, "creation_date": 1575889931, "last_edit_date": 1575890384, "question_id": 59247645, "link": "https://stackoverflow.com/questions/59247645/how-to-works-with-golang-echo-framework-and-telegram-bot", "title": "How to works with Golang echo framework and Telegram bot?", "body": "<p>I want to use \"telegram bot\" with \"echo framework\" (When the server started, echo and telegram bot work together). I used the below code, but when I ran that, the telegram bot didn't start.</p>\n\n<p>My main.go:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"database/sql\"\n    \"log\"\n    \"net/http\"\n    \"strings\"\n\n    tgbotapi \"github.com/go-telegram-bot-api/telegram-bot-api\"\n    \"github.com/labstack/echo\"\n    _ \"github.com/mattn/go-sqlite3\"\n)\n\nfunc main() {\n    e := echo.New()\n    e.GET(\"/\", func(c echo.Context) error {\n        return c.String(http.StatusOK, \"Hello, World!\")\n    })\n    _ = e.Start(\":1323\")\n\n    db, err := sql.Open(\"sqlite3\", \"./criticism.db\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer db.Close()\n\n    bot, err := tgbotapi.NewBotAPI(\"\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    bot.Debug = true\n\n    log.Printf(\"Authorized on account %s\", bot.Self.UserName)\n\n    u := tgbotapi.NewUpdate(0)\n    u.Timeout = 60\n\n    updates, err := bot.GetUpdatesChan(u)\n\n    for update := range updates {\n        if update.Message == nil {\n            continue\n        }\n\n        gp_msg := tgbotapi.NewMessage(update.Message.Chat.ID, \"Hi\")\n        bot.Send(gp_msg)\n    }\n}\n</code></pre>\n"}, {"tags": ["string", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1575903731, "post_id": 59247455, "comment_id": 104712783, "body": "Also note that it incurs the cost of reflection and will be slower than the static solution that OP is already using."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1575964107, "last_edit_date": 1575964107, "creation_date": 1575889263, "answer_id": 59247455, "question_id": 59247344, "link": "https://stackoverflow.com/questions/59247344/print-list-of-fields-in-struct-with-delimiter/59247455#59247455", "title": "Print list of fields in struct with delimiter", "body": "<p>That exact format is not supported by verbs of the <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\"><code>fmt</code></a> package.</p>\n\n<p>The closest would be</p>\n\n<pre><code>s := fmt.Sprintf(\"%#v\", p)\n</code></pre>\n\n<p>Which generates a string like:</p>\n\n<pre><code>main.Person{FirstName:\"John\", LastName:\"Smith\", Age:45}\n</code></pre>\n\n<p>If you exactly need what you posted in the question, you may use reflection to iterate over the fields and build the result like this:</p>\n\n<pre><code>func asFields(data interface{}) string {\n    v := reflect.ValueOf(data)\n    b := &amp;strings.Builder{}\n    for i := 0; i &lt; v.NumField(); i++ {\n        if i &gt; 0 {\n            b.WriteString(\", \")\n        }\n        b.WriteString(fmt.Sprint(v.Field(i).Interface()))\n    }\n    return b.String()\n}\n</code></pre>\n\n<p>This indeed gives:</p>\n\n<pre><code>John, Smith, 45\n</code></pre>\n\n<p>Try the examples on the <a href=\"https://play.golang.org/p/hhQmLnLCeNr\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Note that this <code>asFields()</code> function handles all struct types of course not just your <code>Person</code>. Adjustment would be needed to handle pointers and struct of structs of course.</p>\n\n<p>Also note that alternatively to <a href=\"https://golang.org/pkg/fmt/#Sprint\" rel=\"nofollow noreferrer\"><code>fmt.Sprint()</code></a> you may also use <a href=\"https://golang.org/pkg/fmt/#Fprint\" rel=\"nofollow noreferrer\"><code>fmt.Fprint()</code></a> directed to the buffer in which we're assembling the string:</p>\n\n<pre><code>func asFields(data interface{}) string {\n    v := reflect.ValueOf(data)\n    b := &amp;strings.Builder{}\n    for i := 0; i &lt; v.NumField(); i++ {\n        if i &gt; 0 {\n            b.WriteString(\", \")\n        }\n        fmt.Fprint(b, v.Field(i).Interface())\n    }\n    return b.String()\n}\n</code></pre>\n\n<p>Which of course gives the same result (and may or may not be faster, benchmark it). Try it on the <a href=\"https://play.golang.org/p/nu5n4itziAB\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "is_accepted": false, "score": 1, "last_activity_date": 1575889790, "creation_date": 1575889790, "answer_id": 59247598, "question_id": 59247344, "link": "https://stackoverflow.com/questions/59247344/print-list-of-fields-in-struct-with-delimiter/59247598#59247598", "title": "Print list of fields in struct with delimiter", "body": "<p>Can we use this approach, it will be applicable only to <code>Person type struct</code> though ?</p>\n\n<p><a href=\"https://play.golang.org/p/YI2Nu0q51ls\" rel=\"nofollow noreferrer\">https://play.golang.org/p/YI2Nu0q51ls</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Person struct {\n    FirstName string\n    LastName  string\n    Age       int\n}\n\nfunc (p Person) String() string {\n    return fmt.Sprintf(\"%s, %s, %d\", p.FirstName, p.LastName, p.Age)\n}\n\nfunc main() {\n    p := Person{FirstName: \"John\",LastName: \"Doe\", Age: 25}\n    fmt.Printf(\"%v\", p)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>John, Doe, 25\n</code></pre>\n\n<p>Similar SO question:\n<a href=\"https://stackoverflow.com/questions/13247644/tostring-function-in-go\">ToString() function in Go</a></p>\n"}], "owner": {"reputation": 1954, "user_id": 10048799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43e3b78b616247e7b5a2fcfde299bcfb?s=128&d=identicon&r=PG&f=1", "display_name": "kaleidawave", "link": "https://stackoverflow.com/users/10048799/kaleidawave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 1, "accepted_answer_id": 59247455, "answer_count": 2, "score": 2, "last_activity_date": 1575964107, "creation_date": 1575888843, "last_edit_date": 1575889733, "question_id": 59247344, "link": "https://stackoverflow.com/questions/59247344/print-list-of-fields-in-struct-with-delimiter", "title": "Print list of fields in struct with delimiter", "body": "<p>I have a type with three fields</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Person struct {\n    FirstName string\n    LastName  string\n    Age       int\n}\n</code></pre>\n\n<p>Creating an instance and using default <code>fmt.Sprint()</code> returns <code>{John Smith 45}</code>. However for my use case I need a string of format <code>John, Smith, 45</code>. A comma delimited list without being surrounded by curly braces. Is there a more reusable and effective way than:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>fmt.Sprintf(\"%s, %s, %d\", x.FirstName, x.LastName, x.Age)\n</code></pre>\n\n<p>I will be using this method alot with other types and I would prefer a generic method rather than having to type out a format for each type I use:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func asFields(data interface{}) string {\n    // TODO logic here\n}\n</code></pre>\n"}, {"tags": ["http", "go", "request"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575889459, "post_id": 59247315, "comment_id": 104704973, "body": "All of the values in your json are missing quotes around them. It should be <code>&quot;source_address&quot;: &quot;source&quot;</code>, etc. not <code>&quot;source_address&quot;: source</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1575889604, "post_id": 59247315, "comment_id": 104705039, "body": "... although it seems a bit like you&#39;re trying to refer to actual variables inside the raw string, which is not possible in Go. Instead you should declare a struct type with a structure equivalent to that of the json, initialize it and set the fields to the desired values and then marshal that struct instance with the <code>encoding&#47;json</code> package."}, {"owner": {"reputation": 415, "user_id": 10263695, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IClZzCdXtC8/AAAAAAAAAAI/AAAAAAAAGAs/4BH-9diuSwM/photo.jpg?sz=128", "display_name": "Vani Polnedi", "link": "https://stackoverflow.com/users/10263695/vani-polnedi"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575891076, "post_id": 59247315, "comment_id": 104705781, "body": "i have taken source,destn,encrypted_msg,Message_CallbackURL,msg_id as constant values"}, {"owner": {"reputation": 415, "user_id": 10263695, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IClZzCdXtC8/AAAAAAAAAAI/AAAAAAAAGAs/4BH-9diuSwM/photo.jpg?sz=128", "display_name": "Vani Polnedi", "link": "https://stackoverflow.com/users/10263695/vani-polnedi"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575891117, "post_id": 59247315, "comment_id": 104705813, "body": "tried by taking structure also .. but i&#39;m getting error as 502 Bad Gateway"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1575893503, "post_id": 59247315, "comment_id": 104707052, "body": "Constant values or variables, it doesn&#39;t matter, using Go identifiers in a string will not  interpolate their values into the string automagically. If you want to build the string yourself you can use concatenation for example, or, as already mentioned, use a struct and the <code>encoding&#47;json</code> package."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575893556, "post_id": 59247315, "comment_id": 104707080, "body": "<i>&quot;tried by taking structure also .. but i&#39;m getting error as 502 Bad Gateway&quot;</i> well if you want help with that you&#39;ll need to include the code from that attempt in the question as well."}, {"owner": {"reputation": 415, "user_id": 10263695, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IClZzCdXtC8/AAAAAAAAAAI/AAAAAAAAGAs/4BH-9diuSwM/photo.jpg?sz=128", "display_name": "Vani Polnedi", "link": "https://stackoverflow.com/users/10263695/vani-polnedi"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575894039, "post_id": 59247315, "comment_id": 104707342, "body": "added code ... can u pls check once now"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575894172, "post_id": 59247315, "comment_id": 104707422, "body": "You need to export the fields of the struct for them to be accessible by the <code>encoding&#47;json</code> package."}, {"owner": {"reputation": 135, "user_id": 4706045, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YqYFs.jpg?s=128&g=1", "display_name": "ASHMIL HUSSAIN K", "link": "https://stackoverflow.com/users/4706045/ashmil-hussain-k"}, "edited": false, "score": 0, "creation_date": 1575894408, "post_id": 59247315, "comment_id": 104707543, "body": "try nested map and convert to JSON <a href=\"https://stackoverflow.com/questions/44305617/nested-maps-in-golang\" title=\"nested maps in golang\">stackoverflow.com/questions/44305617/nested-maps-in-golang</a>    for converting map to json - jsonString, err := json.Marshal(datas)"}], "answers": [{"tags": [], "owner": {"reputation": 161, "user_id": 11339140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_oZaOqfxYFI/AAAAAAAAAAI/AAAAAAAAADw/o9Jcv0YYArU/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u0438\u0444\u043e\u0440 \u0421\u0435\u0440\u044f\u043a\u043e\u0432", "link": "https://stackoverflow.com/users/11339140/%d0%9d%d0%b8%d0%ba%d0%b8%d1%84%d0%be%d1%80-%d0%a1%d0%b5%d1%80%d1%8f%d0%ba%d0%be%d0%b2"}, "is_accepted": true, "score": 0, "last_activity_date": 1575939543, "creation_date": 1575939543, "answer_id": 59258746, "question_id": 59247315, "link": "https://stackoverflow.com/questions/59247315/how-to-send-json-inside-json-in-post/59258746#59258746", "title": "How to send JSON inside JSON in POST", "body": "<p>First of all: please use <code>gofmt</code></p>\n\n<p>Your first code can't work because golang doesn't substitute variables inside string. It's better to use structs.</p>\n\n<p>With structs it's not working because you named struct fields from lower case latter, it means \"private\" fields in go. So <code>encoding/json</code> package can't access them and just skip them. Use Capital first letters.</p>\n\n<p>Another fix is about <code>'json:\"tag\"'</code> - here tag means encoded field name, not type. So instead of <code>'json:\"string\"'</code> you should use <code>'json:\"message_id\"'</code> or so. You can specify type like this <code>'json:\"field_name,type\"'</code> or like this <code>'json:\",type\"'</code> but <code>encoding/json</code> guess type on his own.</p>\n\n<p>(I used wrong quotes in tags because of markdown)</p>\n\n<p>I used <code>netcat -l 5000</code> to listen on 5000 port on localhost and print everything to the terminal. Then I changed <code>url</code> to <code>http://localhost:5000</code> (not https) to send request to myself.\nYou need to restart <code>netcat</code> each time to work.</p>\n\n<p>And I made logging a bit more readable.</p>\n\n<p>Also it's CamelCase naming convention in go.</p>\n\n<p>Changed your code a little bit</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"flag\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n\n    //\"crypto/tls\"\n    \"encoding/json\"\n\n    \"github.com/nikandfor/tlog\"\n)\n\ntype ClientInterface struct {\n    SourceAddress      string `json:\"source_address\"`\n    DestinationAddress uint64 `json:\"destination_address\"`\n    Message            string `json:\"message\"`\n    BusinessEventURL   string `json:\"business_event_url\"`\n}\ntype ServerInterface struct {\n    MessageID uint64 `json:\"message_id\"`\n}\ntype Data struct {\n    ClientInterface ClientInterface `json:\"client_interface\"`\n    ServerInterface ServerInterface `json:\"server_interface\"`\n}\n\nvar (\n    // use command line flag. so run like so:\n    // go run ./file.go -addr https://example.com\n    addr = flag.String(\"addr\", \"http://localhost:5000\", \"address to send data to\")\n)\n\nfunc main() {\n    flag.Parse() // DO NOT FORGET TO PARSE FLAGS\n\n    fmt.Println(\"URL:&gt;\", *addr)\n\n    clientInterface := ClientInterface{\n        SourceAddress:      \"1\",\n        DestinationAddress: 8886121111,\n        Message:            \"khsjhdjks\",\n        BusinessEventURL:   \"http://callbackurl-hdfc\",\n    }\n\n    serverInterface := ServerInterface{\n        MessageID: 8210993557215399651,\n    }\n\n    tlog.Printf(\"server_interface %+v\", serverInterface)\n    tlog.Printf(\"client_interface %+v\", clientInterface)\n\n    body1 := &amp;Data{\n        ClientInterface: clientInterface,\n        ServerInterface: serverInterface,\n    }\n    tlog.Printf(\"body %+v\", body1)\n    t, err := json.Marshal(body1)\n    if err != nil {\n        panic(err)\n    }\n    tlog.Printf(\"marshalled: %s\", t)\n\n    req, err := http.NewRequest(\"POST\", *addr, bytes.NewReader(t))\n    tlog.Printf(\"req %v\", req)\n    req.Header.Set(\"Content-Type\", \"application/json\")\n    req.Header.Set(\"requestid\", \"8210993557215399651\")\n    req.Header.Set(\"Authorization\", \"Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkJCOENlRlZxeWFHckdOdWVoSklpTDRkZmp6dyIsImtpZCI6IkJCOENlRlZxeWFHckdOdWVoSklpTDRkZmp6dyJ9.eyJhdWQiOiJhcGk6Ly90cC1kZXYtdGFubGEtYXBpIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvY2JhYThhYmItZTcwZi00YmI4LWIwNDQtZmZiZjAwNzk0NzkwLyIsImlhdCI6MTU3NTg5MTI3NCwibmJmIjoxNTc1ODkxMjc0LCJleHAiOjE1NzU4OTUxNzQsImFjciI6IjEiLCJhaW8iOiI0MlZnWU9EY3JjenlhZXIxdkRMRDVlNHVtWUxha1UrRUplOVYrZGVlRFgrOTNUMytNRGNBIiwiYW1yIjpbInB3ZCJdLCJhcHBpZCI6IjFmMjI1N2ZlLWIzYjktNGQ2Ny05M2YyLWRjNjM2N2Q2MGM4MCIsImFwcGlkYWNyIjoiMCIsImlwYWRkciI6IjE0LjE0My4xODcuMjUwIiwibmFtZSI6ImhkZmMuMTEiLCJvaWQiOiIzOGQxMGFlNS01OGYyLTQ0NjUtYTFkOC04YTc0NDAzYjc5MmEiLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJzdWIiOiIzNDdUd0ZwYUw5MDhmOXlNRWlGOWNHMU84THFQYmJxZk45VzhyQWVEX1prIiwidGlkIjoiY2JhYThhYmItZTcwZi00YmI4LWIwNDQtZmZiZjAwNzk0NzkwIiwidW5pcXVlX25hbWUiOiJoZGZjLjExQFRhbmxhUHJvZHVjdC5vbm1pY3Jvc29mdC5jb20iLCJ1cG4iOiJoZGZjLjExQFRhbmxhUHJvZHVjdC5vbm1pY3Jvc29mdC5jb20iLCJ1dGkiOiJuS05TTXRsT3VFeXMtQjRIOGJ3TEFRIiwidmVyIjoiMS4wIn0.F5H9WCOktau3JaqNyWM91A5jFpJ9eJE99fBWvqDq9kOfCk3OCJnHFKXtIaIA7MoqbxWpNZt1yWpVKuw8gd2Lg_9nfUvvXts2DJHVQN0EqQmFUyWTzhdLW8ZVi6E9RtXK2aEWrI2TVceL5C2wbYOQYfvV4LzjTuNbs6k_20cQ0nD6oO1Id16VVFQWy9yKvpDzsTrvlQdFBZeohIfyL9XWKa8DOk0gxe4bjC7OFmuMsF3FZE5XPaQPHOJ3ejlZJiApml2TlRHnvLpkn1biE3NTAu9aO2lE262lyLg8ZaU0sbPuQaS8P797a-outxLvKEMh07895mA9g6vMxEdRV9X2eA\")\n\n    client := &amp;http.Client{}\n    resp, err := client.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    defer resp.Body.Close()\n\n    tlog.Printf(\"response Status: %v\", resp.Status)\n    tlog.Printf(\"response Headers: %v\", resp.Header)\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        panic(err)\n    }\n    tlog.Printf(\"response Body: %s\", string(body))\n}\n</code></pre>\n\n<pre><code>$ nc -l 5000\nPOST / HTTP/1.1\nHost: localhost:5000\nUser-Agent: Go-http-client/1.1\nContent-Length: 92\nAuthorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkJCOENlRlZxeWFHckdOdWVoSklpTDRkZmp6dyIsImtpZCI6IkJCOENlRlZxeWFHckdOdWVoSklpTDRkZmp6dyJ9.eyJhdWQiOiJhcGk6Ly90cC1kZXYtdGFubGEtYXBpIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvY2JhYThhYmItZTcwZi00YmI4LWIwNDQtZmZiZjAwNzk0NzkwLyIsImlhdCI6MTU3NTg5MTI3NCwibmJmIjoxNTc1ODkxMjc0LCJleHAiOjE1NzU4OTUxNzQsImFjciI6IjEiLCJhaW8iOiI0MlZnWU9EY3JjenlhZXIxdkRMRDVlNHVtWUxha1UrRUplOVYrZGVlRFgrOTNUMytNRGNBIiwiYW1yIjpbInB3ZCJdLCJhcHBpZCI6IjFmMjI1N2ZlLWIzYjktNGQ2Ny05M2YyLWRjNjM2N2Q2MGM4MCIsImFwcGlkYWNyIjoiMCIsImlwYWRkciI6IjE0LjE0My4xODcuMjUwIiwibmFtZSI6ImhkZmMuMTEiLCJvaWQiOiIzOGQxMGFlNS01OGYyLTQ0NjUtYTFkOC04YTc0NDAzYjc5MmEiLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJzdWIiOiIzNDdUd0ZwYUw5MDhmOXlNRWlGOWNHMU84THFQYmJxZk45VzhyQWVEX1prIiwidGlkIjoiY2JhYThhYmItZTcwZi00YmI4LWIwNDQtZmZiZjAwNzk0NzkwIiwidW5pcXVlX25hbWUiOiJoZGZjLjExQFRhbmxhUHJvZHVjdC5vbm1pY3Jvc29mdC5jb20iLCJ1cG4iOiJoZGZjLjExQFRhbmxhUHJvZHVjdC5vbm1pY3Jvc29mdC5jb20iLCJ1dGkiOiJuS05TTXRsT3VFeXMtQjRIOGJ3TEFRIiwidmVyIjoiMS4wIn0.F5H9WCOktau3JaqNyWM91A5jFpJ9eJE99fBWvqDq9kOfCk3OCJnHFKXtIaIA7MoqbxWpNZt1yWpVKuw8gd2Lg_9nfUvvXts2DJHVQN0EqQmFUyWTzhdLW8ZVi6E9RtXK2aEWrI2TVceL5C2wbYOQYfvV4LzjTuNbs6k_20cQ0nD6oO1Id16VVFQWy9yKvpDzsTrvlQdFBZeohIfyL9XWKa8DOk0gxe4bjC7OFmuMsF3FZE5XPaQPHOJ3ejlZJiApml2TlRHnvLpkn1biE3NTAu9aO2lE262lyLg8ZaU0sbPuQaS8P797a-outxLvKEMh07895mA9g6vMxEdRV9X2eA\nContent-Type: application/json\nRequestid: 8210993557215399651\nAccept-Encoding: gzip\n\n{\"client_interface\":{\"source_address\":\"1\",\"destination_address\":8886121111,\"message\":\"khsjhdjks\",\"business_event_url\":\"http://callbackurl-hdfc\"},\"server_interface\":{\"message_id\":8210993557215399651}}\n</code></pre>\n\n<p>Is it what you've expected?</p>\n\n<p>And the last. I strongly suggest you to read <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html</a></p>\n"}], "owner": {"reputation": 415, "user_id": 10263695, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IClZzCdXtC8/AAAAAAAAAAI/AAAAAAAAGAs/4BH-9diuSwM/photo.jpg?sz=128", "display_name": "Vani Polnedi", "link": "https://stackoverflow.com/users/10263695/vani-polnedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 59258746, "answer_count": 1, "score": -1, "last_activity_date": 1575958912, "creation_date": 1575888762, "last_edit_date": 1575958912, "question_id": 59247315, "link": "https://stackoverflow.com/questions/59247315/how-to-send-json-inside-json-in-post", "title": "How to send JSON inside JSON in POST", "body": "<p>I am trying to send the following data via a <code>POST</code> HTTP request to an API:</p>\n\n<pre><code>{ \n   \"client_interface\":{ \n      \"source_address\":source,\n      \"destination_address\":destn,\n      \"message\":encrypted_msg,\n      \"business_event_url\":settings.Message_CallbackURL\n   },\n   \"server_interface\":{ \n      \"message_id\":msg_id\n   }\n}\n</code></pre>\n\n<p>The API is responding with the following error:</p>\n\n<pre><code>{ \n   \"Meta\":{ \n      \"Requestid\":12301343169471000\n   },\n   \"Error\":{ \n      \"Message\":\"Request body contains badly-formed JSON (at position 51)\",\n      \"Param\":\"\"\n   }\n}\n</code></pre>\n\n<p>CODE:</p>\n\n<pre><code>apiUrl := \"http://example.com\"\ntr := &amp;http.Transport{\n    TLSClientConfig: &amp;tls.Config{InsecureSkipVerify : true},\n}\n\njsonStr := []byte(`{\n        \"client_interface\": {\n          \"source_address\": source,\n          \"destination_address\": destn,\n          \"message\": encrypted_msg,\n          \"business_event_url\": settings.Message_CallbackURL\n        },\n        \"server_interface\": {\n          \"message_id\": msg_id\n        }\n    }`)\n\nreq, err := http.NewRequest(\"POST\", apiUrl, bytes.NewBuffer(jsonStr)) \nfmt.Println(\"req..........\",req)\nif err!=nil{\n    log.Println(\"err in http req..............\",err)\n}\nreq.Header.Set(\"Content-Type\", \"application/json\")\nreq.Header.Set(\"requestid\", msg_id)\nreq.Header.Set(\"Authorization\", \"Bearer \"+conn_token)\nclient := &amp;http.Client{Transport: tr}\nresp, err := client.Do(req)\nif resp!=nil{\n    body, _ := ioutil.ReadAll(resp.Body)\n}\n</code></pre>\n\n<p>Using struct :</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"io/ioutil\"\n    \"bytes\"\n    //\"crypto/tls\"\n    \"encoding/json\"\n)\n\ntype client_interface struct {\n        source_address string `json:\"string\"`\n        destination_address uint64 `json:\"uint64\"`\n        message string `json:\"string\"`\n        business_event_url string `json:\"string\"`\n    }\ntype server_interface struct { \n    message_id uint64 `json:\"uint64\"`\n    }\ntype data struct {\n    client_interface client_interface `json:\"client_interface\"`\n    server_interface server_interface `json:\"server_interface\"`\n}\n\n\nfunc main() {\n    url := \"https://example.com\"\n    fmt.Println(\"URL:&gt;\", url)\n\n\n    client_interface := client_interface{}\n    server_interface := server_interface{}\n\n    client_interface.source_address=\"1\"\n    client_interface.destination_address=1111111111\n    client_interface.message=\"khsjhdjks\"\n    client_interface.business_event_url=\"http://callbackurl-hdfc\"\n\n    server_interface.message_id=8210993557215399651\n\n    fmt.Println(\"server_interface..........\",server_interface)\n    fmt.Println(\"client_interface..........\",client_interface)\n\n    body1 := &amp;data{\n                client_interface: client_interface,\n                server_interface: server_interface,\n    }\n    fmt.Println(\"body1..........\",body1)\n    t,e:=json.Marshal(body1)\n    fmt.Println(\"t..........\",t)            \n    fmt.Println(\"e..........\",e)            \n\n\n    req, err := http.NewRequest(\"POST\", url, bytes.NewReader(t))\n    fmt.Println(\"req......\",req)\n    req.Header.Set(\"Content-Type\", \"application/json\")\n    req.Header.Set(\"requestid\", \"8210993557215399651\")\n    req.Header.Set(\"Authorization\", \"Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkJCOENlRlZxeWFHckdOdWVoSklpTDRkZmp6dyIsImtpZCI6IkJCOENlRlZxeWFHckdOdWVoSklpTDRkZmp6dyJ9.eyJhdWQiOiJhcGk6Ly90cC1kZXYtdGFubGEtYXBpIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvY2JhYThhYmItZTcwZi00YmI4LWIwNDQtZmZiZjAwNzk0NzkwLyIsImlhdCI6MTU3NTg5MTI3NCwibmJmIjoxNTc1ODkxMjc0LCJleHAiOjE1NzU4OTUxNzQsImFjciI6IjEiLCJhaW8iOiI0MlZnWU9EY3JjenlhZXIxdkRMRDVlNHVtWUxha1UrRUplOVYrZGVlRFgrOTNUMytNRGNBIiwiYW1yIjpbInB3ZCJdLCJhcHBpZCI6IjFmMjI1N2ZlLWIzYjktNGQ2Ny05M2YyLWRjNjM2N2Q2MGM4MCIsImFwcGlkYWNyIjoiMCIsImlwYWRkciI6IjE0LjE0My4xODcuMjUwIiwibmFtZSI6ImhkZmMuMTEiLCJvaWQiOiIzOGQxMGFlNS01OGYyLTQ0NjUtYTFkOC04YTc0NDAzYjc5MmEiLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJzdWIiOiIzNDdUd0ZwYUw5MDhmOXlNRWlGOWNHMU84THFQYmJxZk45VzhyQWVEX1prIiwidGlkIjoiY2JhYThhYmItZTcwZi00YmI4LWIwNDQtZmZiZjAwNzk0NzkwIiwidW5pcXVlX25hbWUiOiJoZGZjLjExQFRhbmxhUHJvZHVjdC5vbm1pY3Jvc29mdC5jb20iLCJ1cG4iOiJoZGZjLjExQFRhbmxhUHJvZHVjdC5vbm1pY3Jvc29mdC5jb20iLCJ1dGkiOiJuS05TTXRsT3VFeXMtQjRIOGJ3TEFRIiwidmVyIjoiMS4wIn0.F5H9WCOktau3JaqNyWM91A5jFpJ9eJE99fBWvqDq9kOfCk3OCJnHFKXtIaIA7MoqbxWpNZt1yWpVKuw8gd2Lg_9nfUvvXts2DJHVQN0EqQmFUyWTzhdLW8ZVi6E9RtXK2aEWrI2TVceL5C2wbYOQYfvV4LzjTuNbs6k_20cQ0nD6oO1Id16VVFQWy9yKvpDzsTrvlQdFBZeohIfyL9XWKa8DOk0gxe4bjC7OFmuMsF3FZE5XPaQPHOJ3ejlZJiApml2TlRHnvLpkn1biE3NTAu9aO2lE262lyLg8ZaU0sbPuQaS8P797a-outxLvKEMh07895mA9g6vMxEdRV9X2eA\")\n\n    client := &amp;http.Client{}\n    resp, err := client.Do(req)\n    fmt.Println(\"err.............\",err)\n    if err != nil {\n        panic(err)\n    }\n    defer resp.Body.Close()\n\n    fmt.Println(\"response Status:\", resp.Status)\n    fmt.Println(\"response Headers:\", resp.Header)\n    body, _ := ioutil.ReadAll(resp.Body)\n    fmt.Println(\"response Body:\", string(body))\n}\n</code></pre>\n"}, {"tags": ["go", "goland"], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 1, "last_activity_date": 1575892751, "creation_date": 1575892751, "answer_id": 59248474, "question_id": 59246450, "link": "https://stackoverflow.com/questions/59246450/why-does-goland-debug-rebuild-every-time-how-to-solve-it/59248474#59248474", "title": "Why does GoLand debug rebuild every time? how to solve it?", "body": "<p>This is done by the Go compiler and it should be very fast if nothing changed, thanks to the compiler cache introduced in Go 1.10.</p>\n\n<p>And the reason the recompilation step is required is simple: there is no simple way to tell if indeed nothing has changed or not in the build as external resources outside of the compilers reach could affect the results.</p>\n\n<p>So, the IDE invokes the compiler first, then it starts the debugging process.</p>\n\n<p>A better question would be: what are you trying to do and why is the recompilation a problem in this case?</p>\n"}], "owner": {"reputation": 13, "user_id": 12504316, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mW-6Ipn6rBs/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdhEr6hZhlo4DJd79YVjnhqcK22Bg/photo.jpg?sz=128", "display_name": "Shengda Li", "link": "https://stackoverflow.com/users/12504316/shengda-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 59248474, "answer_count": 1, "score": -2, "last_activity_date": 1575895956, "creation_date": 1575885737, "last_edit_date": 1575895956, "question_id": 59246450, "link": "https://stackoverflow.com/questions/59246450/why-does-goland-debug-rebuild-every-time-how-to-solve-it", "title": "Why does GoLand debug rebuild every time? how to solve it?", "body": "<p>When press the Run button in GoLand, it will <strong>recompile</strong> the code even without any change for the code, why? </p>\n"}, {"tags": ["go", "grpc", "rpc", "grpc-python", "grpc-go"], "answers": [{"tags": [], "owner": {"reputation": 933, "user_id": 2536112, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/zIv5h.jpg?s=128&g=1", "display_name": "Ashwin Shirva", "link": "https://stackoverflow.com/users/2536112/ashwin-shirva"}, "is_accepted": true, "score": 1, "last_activity_date": 1585729690, "last_edit_date": 1585729690, "creation_date": 1576053410, "answer_id": 59281686, "question_id": 59245890, "link": "https://stackoverflow.com/questions/59245890/how-to-measure-the-size-of-grpc-response/59281686#59281686", "title": "How To Measure The Size of gRPC Response", "body": "<p>I figured out a way to do this. The solution is to encode the gRPC response into the <code>byte</code> stream, and then calculate the size using  <code>binary.Size()</code></p>\n\n<pre><code>func GetGRPCResponseSize(val interface{}, desc string) (int, error) {\n\n    var buff bytes.Buffer\n    enc := gob.NewEncoder(&amp;buff)\n    err := enc.Encode(val)\n    if err != nil {\n        log.Error(\"encode error:\", err)\n        return 0, err\n    }\n    return binary.Size(buff.Bytes()), nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 131, "user_id": 3501177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8L6th.jpg?s=128&g=1", "display_name": "Dustin Hooten", "link": "https://stackoverflow.com/users/3501177/dustin-hooten"}, "is_accepted": false, "score": 3, "last_activity_date": 1591387071, "last_edit_date": 1592644375, "creation_date": 1591387071, "answer_id": 62223272, "question_id": 59245890, "link": "https://stackoverflow.com/questions/59245890/how-to-measure-the-size-of-grpc-response/62223272#62223272", "title": "How To Measure The Size of gRPC Response", "body": "<h3>Computing message size</h3>\n<p>As per the <a href=\"https://godoc.org/github.com/golang/protobuf/proto#Size\" rel=\"nofollow noreferrer\">proto docs</a>,</p>\n<blockquote>\n<p><code>func Size(m Message) int</code></p>\n<p>Size returns the size in bytes of the wire-format encoding of m.</p>\n</blockquote>\n<h3>gRPC message size limits</h3>\n<p>Also, it might be useful in your case to consider setting <a href=\"https://godoc.org/google.golang.org/grpc#MaxCallRecvMsgSize\" rel=\"nofollow noreferrer\"><code>grpc.MaxCallRecvMsgSize</code></a> as a <code>grpc.CallOption</code> to manage limits.</p>\n"}], "owner": {"reputation": 933, "user_id": 2536112, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/zIv5h.jpg?s=128&g=1", "display_name": "Ashwin Shirva", "link": "https://stackoverflow.com/users/2536112/ashwin-shirva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2144, "favorite_count": 0, "accepted_answer_id": 59281686, "answer_count": 2, "score": 0, "last_activity_date": 1591387071, "creation_date": 1575883630, "last_edit_date": 1575950148, "question_id": 59245890, "link": "https://stackoverflow.com/questions/59245890/how-to-measure-the-size-of-grpc-response", "title": "How To Measure The Size of gRPC Response", "body": "<p>I am trying come up with better ways to deal with the 4mb message size limit in grpc. I need a way to measure the size of the grpc response received on client side. When the response exceeds 4mb limit grpc shows a error message like:</p>\n\n<blockquote>\n  <p>could not greet: rpc error: code = ResourceExhausted desc = grpc: received message larger than max (74000087 vs. 4194304)</p>\n</blockquote>\n\n<p>with \"74000087\" being the actual size of the response. How is this calculated? Is there a way to get this value?</p>\n\n<p>I have gone through multiple articles on this topic but could find nothing? Can someone please help? Thanks.</p>\n\n<p>My implementation is using golang</p>\n"}, {"tags": ["json", "go", "swagger-2.0", "openapi"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 12504123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f21e0f6ee7b155b76c93c9bbc847d790?s=128&d=identicon&r=PG&f=1", "display_name": "wyaacov", "link": "https://stackoverflow.com/users/12504123/wyaacov"}, "edited": false, "score": 0, "creation_date": 1575988315, "post_id": 59258813, "comment_id": 104746169, "body": "The API that I am documented submits a request to the system database and returns the JSON response  from the database as &quot;glob&quot; (i.e. json.rawMessage) and allows the original requester to decipher. Therefore, one of the fields of the response object contains this &quot;glob&quot; . Want to know if there is a way to describe this in swagger/openapi."}, {"owner": {"reputation": 161, "user_id": 11339140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_oZaOqfxYFI/AAAAAAAAAAI/AAAAAAAAADw/o9Jcv0YYArU/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u0438\u0444\u043e\u0440 \u0421\u0435\u0440\u044f\u043a\u043e\u0432", "link": "https://stackoverflow.com/users/11339140/%d0%9d%d0%b8%d0%ba%d0%b8%d1%84%d0%be%d1%80-%d0%a1%d0%b5%d1%80%d1%8f%d0%ba%d0%be%d0%b2"}, "reply_to_user": {"reputation": 11, "user_id": 12504123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f21e0f6ee7b155b76c93c9bbc847d790?s=128&d=identicon&r=PG&f=1", "display_name": "wyaacov", "link": "https://stackoverflow.com/users/12504123/wyaacov"}, "edited": false, "score": 0, "creation_date": 1576081328, "post_id": 59258813, "comment_id": 104785019, "body": "Now I understand what you meant. I&#39;ve never needed such feature, but may be what you are looking for is this: <a href=\"https://swagger.io/docs/specification/describing-parameters/#schema-vs-content\" rel=\"nofollow noreferrer\">swagger.io/docs/specification/describing-parameters/&hellip;</a>"}], "tags": [], "owner": {"reputation": 161, "user_id": 11339140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_oZaOqfxYFI/AAAAAAAAAAI/AAAAAAAAADw/o9Jcv0YYArU/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u0438\u0444\u043e\u0440 \u0421\u0435\u0440\u044f\u043a\u043e\u0432", "link": "https://stackoverflow.com/users/11339140/%d0%9d%d0%b8%d0%ba%d0%b8%d1%84%d0%be%d1%80-%d0%a1%d0%b5%d1%80%d1%8f%d0%ba%d0%be%d0%b2"}, "is_accepted": false, "score": 0, "last_activity_date": 1575940159, "creation_date": 1575940159, "answer_id": 59258813, "question_id": 59245851, "link": "https://stackoverflow.com/questions/59245851/how-do-i-specify-a-json-raw-message-in-api-object-using-swagger-2-0-or-openapi/59258813#59258813", "title": "How do I specify a &quot;JSON Raw Message&quot; in API object using Swagger 2.0 or OpenApi 3.x?", "body": "<p><a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\"><code>json.RawMessage</code></a> is just way of parsing of json message. It allows to delay parsing of some fields or all the message.</p>\n\n<p>It doesn't affect structure or format of response so you don't need to specify it in openapi spec by any way.</p>\n\n<p>The only thing I can guess, that some of the fields could have different schemas from one response to another. So you can't document all of them in the same time (as far as I know openapi features), and all you can do is to describe it as just general <code>\"object\"</code>. And describe possible schemas somewhere in documentation.</p>\n"}], "owner": {"reputation": 11, "user_id": 12504123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f21e0f6ee7b155b76c93c9bbc847d790?s=128&d=identicon&r=PG&f=1", "display_name": "wyaacov", "link": "https://stackoverflow.com/users/12504123/wyaacov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 468, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1575940159, "creation_date": 1575883475, "question_id": 59245851, "link": "https://stackoverflow.com/questions/59245851/how-do-i-specify-a-json-raw-message-in-api-object-using-swagger-2-0-or-openapi", "title": "How do I specify a &quot;JSON Raw Message&quot; in API object using Swagger 2.0 or OpenApi 3.x?", "body": "<p>I am documenting a REST API (developed in Go) using Swagger 2.0 and one of the structures used by an API Response includes several fields that are declared to be of type \"Json.RawMessage\" in Go. I can't find any appropriate \"data type\" in the Swagger specification that would cover this. The closest that I could imagine would be a string in \"byte\" format. But that isn't even close. Any ideas would be of great help.</p>\n"}, {"tags": ["go"], "owner": {"reputation": 26911, "user_id": 225262, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/10f7602ff38f6486cb1580052746fc05?s=128&d=identicon&r=PG", "display_name": "satoru", "link": "https://stackoverflow.com/users/225262/satoru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 259, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1575881909, "creation_date": 1575881909, "question_id": 59245442, "link": "https://stackoverflow.com/questions/59245442/why-is-a-compatible-dependency-ok-for-go-build-but-not-for-go-list-m-all", "title": "Why is a &quot;+compatible&quot; dependency OK for `go build` but not for `go list -m all`?", "body": "<p>I tried to read the source code of tidb-lightning with GoLand. But it failed to index the project complaining with the following error message:</p>\n\n<pre><code>go: finding github.com/pingcap/tidb v3.0.4+incompatible\ngo: finding github.com/pingcap/tidb v3.0.4+incompatible\ngo list -m: github.com/pingcap/tidb@v3.0.4+incompatible: invalid version: +incompatible suffix not allowed: module contains a go.mod file, so semantic import versioning is required\n</code></pre>\n\n<p>But when I tried <code>make lightning</code> to build the binaries everything's OK.</p>\n\n<p>I've googled the error message but can not find an existing solution. But I found this <a href=\"https://stackoverflow.com/questions/57355929/what-incompatible-in-go-mod-mean-will-it-make-harm\">question</a> and guessed that it had something to do with semver, so I updated the dependency to some v1 version and now GoLand can index it.</p>\n\n<p>I wonder if this dependency is valid at all, why does <code>go list -m all</code> fail while <code>go build</code> succeed?</p>\n"}, {"tags": ["sql", "json", "postgresql", "go"], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1575888353, "post_id": 59246962, "comment_id": 104704420, "body": "The question is about retrieving a possibly NULL json value from a db column, not about how to unmarshal json. Also your recommendation to use maps instead of structs is backward in my experience, if possible/practical it is always better to use structs instead of maps."}, {"owner": {"reputation": 529, "user_id": 1540739, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4c9e558372c8a4422060f277b3f73886?s=128&d=identicon&r=PG", "display_name": "arshpreet", "link": "https://stackoverflow.com/users/1540739/arshpreet"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575888534, "post_id": 59246962, "comment_id": 104704527, "body": "OK,@mkopriva thanks for  your intention, There does not seem to be any rule related to Structs over maps, If there is could you please pass more information on that? Although if you look into code, it make sense to use MAP with Switch case."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575888784, "post_id": 59246962, "comment_id": 104704646, "body": "There is no rule, that&#39;s why I&#39;ve written <i>&quot;in my experience&quot;</i>. But why would you need a rule, just look at your code and it becomes clear that it is sub-optimal, because you&#39;ve introduced maps you now have to do a type switch to find out the type of a member of the map. How would that be better than having a concrete struct type with fields of concrete types?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575888916, "post_id": 59246962, "comment_id": 104704707, "body": "<i>&quot;Although if you look into code, it make sense to use MAP with Switch case.&quot;</i> No it doesn&#39;t."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1575889054, "post_id": 59246962, "comment_id": 104704776, "body": "Go is a statically typed language, using <code>interface{}</code> subverts that very much desired feature. While <code>interface{}</code> can be very useful in situations where it makes sense, in most other situations if it can be avoided it should be."}], "tags": [], "owner": {"reputation": 529, "user_id": 1540739, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4c9e558372c8a4422060f277b3f73886?s=128&d=identicon&r=PG", "display_name": "arshpreet", "link": "https://stackoverflow.com/users/1540739/arshpreet"}, "is_accepted": false, "score": -1, "last_activity_date": 1575887575, "creation_date": 1575887575, "answer_id": 59246962, "question_id": 59244393, "link": "https://stackoverflow.com/questions/59244393/how-to-handle-nullable-postgres-jsonb-data-and-parse-it-as-json/59246962#59246962", "title": "How to handle nullable Postgres JSONB data and parse it as JSON", "body": "<p>Instead of using struct to store values, You can use map.</p>\n\n<pre><code>type TestJson struct {\n    First_name *string `json:\"firstName\"`\n    Last_name *string `json:\"lastName\"`\n}\n</code></pre>\n\n<p>You can use interface as</p>\n\n<pre><code>var TestJson interface{}\nerr := json.Unmarshal(b, &amp;TestJson)\n</code></pre>\n\n<p>On the other side you can also use Dynamic creation of structs as well. \nSomething like</p>\n\n<pre><code>m := map[string]interface{}{\n    \"key\": \"value\",\n}\n\n</code></pre>\n\n<p>And rather than having TestJSONNullable it would be better to have Switch case while saving data.</p>\n\n<pre><code>switch v := TestJson.(type) {\ncase int:\n\ncase float64:\n\ncase string:\n\ndefault:\n    // i isn't one of the types above\n}\n</code></pre>\n\n<p>Look into this for more details--> <a href=\"https://godoc.org/encoding/json#Unmarshal\" rel=\"nofollow noreferrer\">https://godoc.org/encoding/json#Unmarshal</a></p>\n"}, {"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1575905326, "post_id": 59249872, "comment_id": 104713713, "body": "The information in the answer itself is not very informative. Add a short description of what solution is. Mentioning the interfaces will be a big improvement."}], "tags": [], "owner": {"reputation": 3142, "user_id": 1570901, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1bf0cf4364781c9020f0ed9683c0ea35?s=128&d=identicon&r=PG", "display_name": "sravis", "link": "https://stackoverflow.com/users/1570901/sravis"}, "is_accepted": true, "score": 0, "last_activity_date": 1575897898, "creation_date": 1575897898, "answer_id": 59249872, "question_id": 59244393, "link": "https://stackoverflow.com/questions/59244393/how-to-handle-nullable-postgres-jsonb-data-and-parse-it-as-json/59249872#59249872", "title": "How to handle nullable Postgres JSONB data and parse it as JSON", "body": "<p>After doing some research i found the solution.</p>\n\n<pre><code>type TestJSONMap map[string]interface{}\n\nfunc (t TestJSONMap) Value() (driver.Value, error) {\n    j, err := json.Marshal(t)\n    return j, err\n}\n\nfunc (p *TestJSONMap) Scan(val interface{}) error {\n    value, ok := val.([]byte)\n    if !ok {\n        return errors.New(\"Type assertion .([]byte) failed.\")\n    }\n\n    var i interface{}\n    err := json.Unmarshal(value, &amp;i)\n    if err != nil {\n        return err\n    }\n\n    *p, ok = i.(map[string]interface{})\n    if !ok {\n        return errors.New(\"Type assertion .(map[string]interface{}) failed.\")\n    }\n\n    return nil\n}\n\ntype Test01 struct {\n    Id string `json:\"id\"`\n    Test_json *TestJSONMap `json:\"testJson\"`\n}\n</code></pre>\n\n<p>Got help from <a href=\"https://coussej.github.io/2016/02/16/Handling-JSONB-in-Go-Structs/\" rel=\"nofollow noreferrer\">https://coussej.github.io/2016/02/16/Handling-JSONB-in-Go-Structs/</a></p>\n"}, {"tags": [], "owner": {"reputation": 795, "user_id": 4297035, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/my4fZ.jpg?s=128&g=1", "display_name": "Soroush", "link": "https://stackoverflow.com/users/4297035/soroush"}, "is_accepted": false, "score": 0, "last_activity_date": 1603720089, "last_edit_date": 1603720089, "creation_date": 1603719631, "answer_id": 64538282, "question_id": 59244393, "link": "https://stackoverflow.com/questions/59244393/how-to-handle-nullable-postgres-jsonb-data-and-parse-it-as-json/64538282#64538282", "title": "How to handle nullable Postgres JSONB data and parse it as JSON", "body": "<p>Here's another solution: You can implement a <em>nullable</em> type for raw JSON data, similar to <a href=\"https://pkg.go.dev/database/sql#NullString\" rel=\"nofollow noreferrer\"><code>sql.NullString</code></a>, and use it as a scan destination. In this scenario, you will first check whether the value is null, and then unmarshal it only if it's not null. For instance, the <a href=\"https://pkg.go.dev/github.com/soroushj/sqlt#NullRawMessage\" rel=\"nofollow noreferrer\"><code>NullRawMessage</code></a> type from <a href=\"https://github.com/soroushj/sqlt\" rel=\"nofollow noreferrer\"><code>github.com/soroushj/sqlt</code></a> is a <em>nullable</em> <a href=\"https://pkg.go.dev/encoding/json#RawMessage\" rel=\"nofollow noreferrer\"><code>json.RawMessage</code></a> which can be used for this purpose.</p>\n<p>Here's an example:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;database/sql&quot;\n    &quot;log&quot;\n\n    _ &quot;github.com/lib/pq&quot;\n    &quot;github.com/soroushj/sqlt&quot;\n)\n\nfunc main() {\n    db, err := sql.Open(&quot;postgres&quot;, &quot;dbname=dbname user=user password=password sslmode=disable&quot;)\n    if err != nil {\n        log.Fatal(err)\n    }\n    row := db.QueryRow(`SELECT test_json FROM my_table WHERE id = $1`, 1)\n    testJSON := sqlt.NullRawMessage{}\n    err = row.Scan(&amp;testJSON)\n    if err != nil {\n        log.Fatal(err)\n    }\n    if testJSON.Valid {\n        // test_json is not null\n        // Unmarshal testJSON.RawMessage\n    } else {\n        // test_json is null\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3142, "user_id": 1570901, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1bf0cf4364781c9020f0ed9683c0ea35?s=128&d=identicon&r=PG", "display_name": "sravis", "link": "https://stackoverflow.com/users/1570901/sravis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 755, "favorite_count": 1, "accepted_answer_id": 59249872, "answer_count": 3, "score": 2, "last_activity_date": 1603720089, "creation_date": 1575877008, "last_edit_date": 1575884880, "question_id": 59244393, "link": "https://stackoverflow.com/questions/59244393/how-to-handle-nullable-postgres-jsonb-data-and-parse-it-as-json", "title": "How to handle nullable Postgres JSONB data and parse it as JSON", "body": "<p>DB Records</p>\n\n<pre><code>---------------------------------------------------------\n| id | test_json                                        |\n---------------------------------------------------------\n| 1  | NULL                                             |\n---------------------------------------------------------\n| 2  | { \"firstName\": \"Hello\", \"lastName\": \"World\" }    |\n---------------------------------------------------------\n</code></pre>\n\n<p>I have JSONB column in postgres which can be NULL. I want to read this records DB in golang and send it to the client.</p>\n\n<p>I'm getting below error on SQL scan:</p>\n\n<pre><code>sql: Scan error on column index 2, name \"test_json\": unsupported Scan, storing driver.Value type []uint8 into type *models.TestJSONNullable\nexit status 1\n</code></pre>\n\n<p>I'm using echo web server.</p>\n\n<pre><code>package models\n\nimport (\n    \"fmt\"\n    \"github.com/lib/pq\"\n    \"encoding/json\"\n)\n\ntype TestJson struct {\n    First_name *string `json:\"firstName\"`\n    Last_name *string `json:\"lastName\"`\n}\n\ntype TestJSONNullable struct {\n  Valid bool\n}\n\nfunc (i *TestJSONNullable) UnmarshalJSON(data []byte) error {\n  if string(data) == \"null\" {\n    i.Valid = false\n    return nil\n  }\n\n  // The key isn't set to null\n  var temp *TestJson\n  if err := json.Unmarshal(data, &amp;temp); err != nil {\n    return err\n  }\n  i.Valid = true\n  return nil\n}\n\ntype Test01 struct {\n    Id string `json:\"id\"`\n    Test_json *TestJSONNullable `json:\"testJson\"`\n}\n\n\nfunc (db *DB) TestRecords () ([]*Test01, error)  {\n    rows, err := db.Query(\"SELECT id, test_json FROM table_1 where success = true\")\n\n    if err != nil {\n        log.Fatal(err)\n        return nil, err\n    }\n\n    defer rows.Close()\n\n    recs := []*Test01{}\n\n    for rows.Next() {\n        r := new(Test01)\n\n        err := rows.Scan(&amp;r.Id, &amp;r.Test_json)\n\n        if err != nil {\n            log.Fatal(err)\n            return nil, err\n        }\n\n        recs = append(recs, r)\n    }\n\n    if err = rows.Err(); err != nil {\n        log.Fatal(err)\n        return nil, err\n    }\n\n    return recs, nil\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "kubernetes", "kubectl", "minikube"], "answers": [{"tags": [], "owner": {"reputation": 155, "user_id": 10450863, "user_type": "registered", "profile_image": "https://graph.facebook.com/2192347384310274/picture?type=large", "display_name": "Shivani Singhal", "link": "https://stackoverflow.com/users/10450863/shivani-singhal"}, "is_accepted": false, "score": 2, "last_activity_date": 1575876156, "creation_date": 1575876156, "answer_id": 59244227, "question_id": 59244179, "link": "https://stackoverflow.com/questions/59244179/kubectl-throws-imagepullbackoff-error-while-creating-deployment-via-minikube/59244227#59244227", "title": "Kubectl throws ImagePullBackOff Error while creating deployment via minikube", "body": "<p>This error can be solved using :</p>\n\n<ol>\n<li><p>Check whether any docker machine is running or not by <code>docker-machine ls</code></p></li>\n<li><p>If no machine exist, then create one using <code>docker-machine create &lt;machine-name&gt;</code></p></li>\n<li><p>Then get this machine IP using <code>docker-machine ip &lt;machine-name&gt;</code></p></li>\n<li><p>Then first delete any existing minikube cluster using <code>minikube delete</code> and start again using <code>minikube start --vm-driver=\"virtualbox\" --insecure-registry=\"docker-machine IP\":80</code> </p></li>\n<li><p>Then run <code>kubectl create deployment hello-minikube --image=k8s.gcr.io/echoserver:1.10</code> and check the logs, it will show image pulled successfully.</p></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 1416, "user_id": 14801225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f6c32f26d1615b037b1ef11b154b866?s=128&d=identicon&r=PG&f=1", "display_name": "matt_j", "link": "https://stackoverflow.com/users/14801225/matt-j"}, "edited": false, "score": 0, "creation_date": 1616667814, "post_id": 59296116, "comment_id": 118076781, "body": "@Shivani Singhal any progress ? Have you solved this problem ?  Have you tried the steps suggested by <b>gears</b> ?"}], "tags": [], "owner": {"reputation": 519, "user_id": 12405999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb1931467ae8d8d5ad50be6b9db49fcd?s=128&d=identicon&r=PG&f=1", "display_name": "gears", "link": "https://stackoverflow.com/users/12405999/gears"}, "is_accepted": false, "score": 1, "last_activity_date": 1576111069, "creation_date": 1576111069, "answer_id": 59296116, "question_id": 59244179, "link": "https://stackoverflow.com/questions/59244179/kubectl-throws-imagepullbackoff-error-while-creating-deployment-via-minikube/59296116#59296116", "title": "Kubectl throws ImagePullBackOff Error while creating deployment via minikube", "body": "<p>From the events it looks like the call to a DNS server at <code>192.168.64.1:53</code> to resolve k8s.gcr.io is failing. Check if there's a DNS server running at that IP. It may be configured in <code>/etc/resolv.conf</code> (if Linux) on the minikube host.</p>\n"}], "owner": {"reputation": 155, "user_id": 10450863, "user_type": "registered", "profile_image": "https://graph.facebook.com/2192347384310274/picture?type=large", "display_name": "Shivani Singhal", "link": "https://stackoverflow.com/users/10450863/shivani-singhal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1515, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1576111069, "creation_date": 1575875891, "question_id": 59244179, "link": "https://stackoverflow.com/questions/59244179/kubectl-throws-imagepullbackoff-error-while-creating-deployment-via-minikube", "title": "Kubectl throws ImagePullBackOff Error while creating deployment via minikube", "body": "<p>Trying to create a deployment from an image          </p>\n\n<p><code>kubectl create deployment hello-minikube --image=k8s.gcr.io/echoserver:1.10</code></p>\n\n<p>and then do <code>kubectl get pods</code> and check the logs of hello-minikube pod using     </p>\n\n<p><code>kubectl pod describe &lt;pod-name&gt;</code> throws following error </p>\n\n<pre><code>  Type     Reason     Age                From               Message\n  ----     ------     ----               ----               -------\n  Normal   Scheduled  &lt;unknown&gt;          default-scheduler  Successfully assigned default/hello-minikube-797f975945-dmq26 to minikube\n  Warning  Failed     42s                kubelet, minikube  Failed to pull image \"k8s.gcr.io/echoserver:1.10\": rpc error: code = Unknown desc = Error response from daemon: Get https://k8s.gcr.io/v2/: dial tcp: lookup k8s.gcr.io on 192.168.64.1:53: read udp 192.168.64.3:56747-&gt;192.168.64.1:53: read: connection refused\n  Warning  Failed     27s                kubelet, minikube  Failed to pull image \"k8s.gcr.io/echoserver:1.10\": rpc error: code = Unknown desc = Error response from daemon: Get https://k8s.gcr.io/v2/: dial tcp: lookup k8s.gcr.io on 192.168.64.1:53: read udp 192.168.64.3:48279-&gt;192.168.64.1:53: read: connection refused\n  Normal   BackOff    16s (x2 over 42s)  kubelet, minikube  Back-off pulling image \"k8s.gcr.io/echoserver:1.10\"\n  Warning  Failed     16s (x2 over 42s)  kubelet, minikube  Error: ImagePullBackOff\n  Normal   Pulling    4s (x3 over 42s)   kubelet, minikube  Pulling image \"k8s.gcr.io/echoserver:1.10\"\n  Warning  Failed     4s (x3 over 42s)   kubelet, minikube  Error: ErrImagePull\n  Warning  Failed     4s                 kubelet, minikube  Failed to pull image \"k8s.gcr.io/echoserver:1.10\": rpc error: code = Unknown desc = Error response from daemon: Get https://k8s.gcr.io/v2/: dial tcp: lookup k8s.gcr.io on 192.168.64.1:53: read udp 192.168.64.3:50616-&gt;192.168.64.1:53: read: connection refused\n</code></pre>\n"}, {"tags": ["postgresql", "go", "go-pg"], "answers": [{"tags": [], "owner": {"reputation": 381813, "user_id": 1863229, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/4sh1l.png?s=128&g=1", "display_name": "Tim Biegeleisen", "link": "https://stackoverflow.com/users/1863229/tim-biegeleisen"}, "is_accepted": true, "score": 1, "last_activity_date": 1575869822, "creation_date": 1575869822, "answer_id": 59243061, "question_id": 59242969, "link": "https://stackoverflow.com/questions/59242969/ambiguous-column-reference-when-joining/59243061#59243061", "title": "Ambiguous column reference when joining", "body": "<p>You may try qualifying the <code>Id</code> column with either an alias or the full table name, e.g.</p>\n\n<pre><code>db.Model(&amp;Trade).Where(`\"Trade\".id = ?`, tradeId).Relation(\"Client\").Select()\n</code></pre>\n"}], "owner": {"reputation": 313, "user_id": 1780284, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa9c14b84a773b6342eee932e79ee63d?s=128&d=identicon&r=PG", "display_name": "nkt", "link": "https://stackoverflow.com/users/1780284/nkt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 59243061, "answer_count": 1, "score": -1, "last_activity_date": 1575869822, "creation_date": 1575869064, "question_id": 59242969, "link": "https://stackoverflow.com/questions/59242969/ambiguous-column-reference-when-joining", "title": "Ambiguous column reference when joining", "body": "<p>Structs</p>\n\n<pre><code>type Client struct {\n   Id int64\n   Name string\n}\n\ntype Trade struct {\n   Id int64\n   ClientId int64\n   Client *Client\n}\n</code></pre>\n\n<p>Query\n<code>db.Model(&amp;Trade).Where(\"id = \", tradeId).Relation(\"Client\").Select()</code></p>\n\n<p>Error encountered: Column Id ambiguous. Not sure what's the proper way to work around this\nWould be great if someone can help</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575857229, "post_id": 59241582, "comment_id": 104694561, "body": "What package name do the go files of module <code>net</code> declare?"}, {"owner": {"reputation": 949, "user_id": 2057806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bdb765f79775ab341c31d7c890d46c5e?s=128&d=identicon&r=PG", "display_name": "Ivan Zhivolupov", "link": "https://stackoverflow.com/users/2057806/ivan-zhivolupov"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575857443, "post_id": 59241582, "comment_id": 104694595, "body": "@BurakSerdar i have updated the question with the structure of the <code>net</code> module, i hope it helps, if not, could you please elaborate on your question as i am a bit confused"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575858220, "post_id": 59241582, "comment_id": 104694742, "body": "How are you getting this error? Are you running go get? or did you import one of the packages in net, and running a go build?"}, {"owner": {"reputation": 949, "user_id": 2057806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bdb765f79775ab341c31d7c890d46c5e?s=128&d=identicon&r=PG", "display_name": "Ivan Zhivolupov", "link": "https://stackoverflow.com/users/2057806/ivan-zhivolupov"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575858341, "post_id": 59241582, "comment_id": 104694760, "body": "@BurakSerdar first of all, i&#39;ve written the <code>net</code> module and pushed it to github, then i moved to the other application which is using the <code>net</code>, and i&#39;ve installed it using the <code>go get -u github.com&#47;USERNAME&#47;net</code>, the thing is, second application is perfectly fine with importing the files (i can Shift + RClick on the file name in Goland and go the the <code>net</code> implementation), but the build fails with the error in the  question"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575858581, "post_id": 59241582, "comment_id": 104694798, "body": "I assume, <code>errors.go</code> has <code>package errors</code>. Do you import this as <code>github.com&#47;username&#47;net&#47;errors</code>?"}, {"owner": {"reputation": 949, "user_id": 2057806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bdb765f79775ab341c31d7c890d46c5e?s=128&d=identicon&r=PG", "display_name": "Ivan Zhivolupov", "link": "https://stackoverflow.com/users/2057806/ivan-zhivolupov"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575858849, "post_id": 59241582, "comment_id": 104694842, "body": "@BurakSerdar yes, i do and yes, it is <code>package errors</code>"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575859083, "post_id": 59241582, "comment_id": 104694874, "body": "Are you building this from an IDE, or using go build? If you&#39;re using an IDE, try go build."}, {"owner": {"reputation": 949, "user_id": 2057806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bdb765f79775ab341c31d7c890d46c5e?s=128&d=identicon&r=PG", "display_name": "Ivan Zhivolupov", "link": "https://stackoverflow.com/users/2057806/ivan-zhivolupov"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575859178, "post_id": 59241582, "comment_id": 104694891, "body": "@BurakSerdar just tried that, still, same error even if i am using <code>go build</code>"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575859994, "post_id": 59241582, "comment_id": 104695035, "body": "I&#39;m stumped. Everything looks in order. I have similar setup that works. You sure everything you need is pushed to github? The errors points to go.mod declaring something different, or missing altogether."}, {"owner": {"reputation": 949, "user_id": 2057806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bdb765f79775ab341c31d7c890d46c5e?s=128&d=identicon&r=PG", "display_name": "Ivan Zhivolupov", "link": "https://stackoverflow.com/users/2057806/ivan-zhivolupov"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575860402, "post_id": 59241582, "comment_id": 104695131, "body": "@BurakSerdar yep, just tried to create two pushes just to be sure, the &quot;versioin&quot; is changing as it should be, so i also have no idea"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575860501, "post_id": 59241582, "comment_id": 104695150, "body": "version actually shouldn&#39;t be changing if you had everything up there. Did you check if github really has all your files?"}, {"owner": {"reputation": 949, "user_id": 2057806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bdb765f79775ab341c31d7c890d46c5e?s=128&d=identicon&r=PG", "display_name": "Ivan Zhivolupov", "link": "https://stackoverflow.com/users/2057806/ivan-zhivolupov"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575860696, "post_id": 59241582, "comment_id": 104695191, "body": "@BurakSerdar yes, i have been changing contents of the <code>version.env</code> file to see if i am actually getting latest version from the github and not the local cached one"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575860845, "post_id": 59241582, "comment_id": 104695215, "body": "This is not in a private github repo is it? Maybe you can share the full url?"}, {"owner": {"reputation": 949, "user_id": 2057806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bdb765f79775ab341c31d7c890d46c5e?s=128&d=identicon&r=PG", "display_name": "Ivan Zhivolupov", "link": "https://stackoverflow.com/users/2057806/ivan-zhivolupov"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575861001, "post_id": 59241582, "comment_id": 104695241, "body": "@BurakSerdar it kind of is, since i am not the only one doing it and the person who shared the initial files might not want to share them. Just as an update, new project with <code>replace</code> in the <code>go.mod</code> works just fine, issue arises only when i am trying to load modules from git"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1575904620, "post_id": 59241582, "comment_id": 104713298, "body": "The error implies that somewhere you have an <code>import &quot;github.com&#47;USERNAME&#47;net&quot;</code>, which isn&#39;t going to work since <code>github.com&#47;USERNAME&#47;net</code> contains no Go source files. I would search all your source for <code>github.com&#47;USERNAME&#47;net</code> and make sure you aren&#39;t trying to import that directly anywhere, that you&#39;re only importing packages under it."}], "answers": [{"tags": [], "owner": {"reputation": 161, "user_id": 11339140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_oZaOqfxYFI/AAAAAAAAAAI/AAAAAAAAADw/o9Jcv0YYArU/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u0438\u0444\u043e\u0440 \u0421\u0435\u0440\u044f\u043a\u043e\u0432", "link": "https://stackoverflow.com/users/11339140/%d0%9d%d0%b8%d0%ba%d0%b8%d1%84%d0%be%d1%80-%d0%a1%d0%b5%d1%80%d1%8f%d0%ba%d0%be%d0%b2"}, "is_accepted": false, "score": 3, "last_activity_date": 1575940536, "creation_date": 1575940536, "answer_id": 59258846, "question_id": 59241582, "link": "https://stackoverflow.com/questions/59241582/unable-to-get-the-package-from-the-module/59258846#59258846", "title": "Unable to get the package from the module", "body": "<p>Probably you've imported your module from some of <code>*.go</code> files in <code>github.com/USERNAME/micro-helix</code> as <code>github.com/USERNAME/net</code>. </p>\n\n<p>You must import all of subpackages (which you use in that file) by there full paths like</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"github.com/USERNAME/net/errors\"\n    \"github.com/USERNAME/net/proto\"\n)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2439, "user_id": 82230, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/PSGNe.jpg?s=128&g=1", "display_name": "slim", "link": "https://stackoverflow.com/users/82230/slim"}, "is_accepted": false, "score": 0, "last_activity_date": 1580754934, "creation_date": 1580754934, "answer_id": 60045176, "question_id": 59241582, "link": "https://stackoverflow.com/questions/59241582/unable-to-get-the-package-from-the-module/60045176#60045176", "title": "Unable to get the package from the module", "body": "<p>I had a similar issue and the problem was that I had checked my code into master, but another branch was set as the default branch in the main git repo. Changing the default branch to master fixed it for me, but YMMV.</p>\n"}], "owner": {"reputation": 949, "user_id": 2057806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bdb765f79775ab341c31d7c890d46c5e?s=128&d=identicon&r=PG", "display_name": "Ivan Zhivolupov", "link": "https://stackoverflow.com/users/2057806/ivan-zhivolupov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5881, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1580754934, "creation_date": 1575856257, "last_edit_date": 1575884897, "question_id": 59241582, "link": "https://stackoverflow.com/questions/59241582/unable-to-get-the-package-from-the-module", "title": "Unable to get the package from the module", "body": "<p>I am trying to create a microservice application, which depends on my <code>net</code> module which contains general errors (so i don't have to \"replicate\" them across all of my modules).  </p>\n\n<p>The issue is that for some reason it is able to find the module, but then telling me that the modules has no package (the <code>net</code> module does not have the <code>main.go</code> file, since it is just a group of files which are used across other projects) </p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go: finding github.com/USERNAME/net latest\nbuild github.com/USERNAME/micro-helix: cannot load github.com/USERNAME/net: module github.com/USERNAME/net@latest found (v0.0.0-20191209010811-97a65ac0928c), but does not contain package github.com/USERNAME/net\n</code></pre>\n\n<p>And here is the <code>go.mod</code> file containing all the necessary requirements (as far as i am concerned):</p>\n\n<pre><code>module github.com/USERNAME/micro-helix\n\ngo 1.13\n\nrequire (\n    github.com/USERNAME/net v0.0.0-20191209010811-97a65ac0928c\n    github.com/USERNAME/service v0.0.0-20191209005400-57ee0eb02082\n    github.com/golang/protobuf v1.3.2\n    github.com/hashicorp/consul/api v1.3.0 // indirect\n    github.com/micro/go-micro v1.17.1\n    github.com/micro/go-plugins v1.5.1 // indirect\n    github.com/nats-io/nats-streaming-server v0.16.2 // indirect\n    github.com/nats-io/stan.go v0.5.2 // indirect\n    github.com/nicklaw5/helix v0.5.4\n    github.com/spf13/viper v1.5.0 // indirect\n)\n</code></pre>\n\n<p>The <code>go.mod</code> file for the <code>net</code> module is as simple as:</p>\n\n<pre><code>module github.com/USERNAME/net\n\ngo 1.13\n</code></pre>\n\n<p>If you need any further clarification, i am here to provide. I know that this might be some rookie mistake (misconfiguration) but this is my first week actually trying to write something in Go.</p>\n\n<p><strong>Update #1</strong></p>\n\n<p>This is the structure of the <code>github.com/USERNAME/net</code> module</p>\n\n<pre><code>/-\n    errors/\n        -   error.go            // github.com/USERNAME/net/errors\n        -   code.go             // github.com/USERNAME/net/errors\n    proto/\n        -   error.pb.go         // github.com/USERNAME/net/proto\n        -   response.pb.go      // github.com/USERNAME/net/proto\n    errors.proto\n    go.mod                      // module github.com/USERNAME/net\n    response.proto\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mongodb-query"], "answers": [{"comments": [{"owner": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "edited": false, "score": 0, "creation_date": 1575856827, "post_id": 59241431, "comment_id": 104694492, "body": "I had to remove $ in city.name, because I received runtime error for that, and with out $ I recieved another error about  &quot;FieldPath field names may not contain &#39;.&#39;.&quot; , and when I remove city. I received again another error: Expression $arrayElemAt takes exactly 2 arguments. 1 were passed in."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "edited": false, "score": 1, "creation_date": 1575857022, "post_id": 59241431, "comment_id": 104694531, "body": "Looking at the original pipeline, I see <code>&quot;$arrayElemAt&quot; : [&quot;$city.name&quot;, 0]</code>. That&#39;s an array, so the correct way is: <code>bson.M{&quot;$arrayElemAt&quot;:[]interface{}{&quot;$city.name&quot;,0}}</code>"}, {"owner": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "edited": false, "score": 0, "creation_date": 1575894779, "post_id": 59241431, "comment_id": 104707736, "body": "yes, that was the trick, do you want to edit your answer so I mark this as the answer?"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1575901669, "last_edit_date": 1575901669, "creation_date": 1575854626, "answer_id": 59241431, "question_id": 59241067, "link": "https://stackoverflow.com/questions/59241067/how-to-use-arrayelemat-with-mongodb/59241431#59241431", "title": "How to use $arrayElemAt with MongoDb", "body": "<p>The correct way to translate</p>\n\n<pre><code>\"city\": { \"$arrayElemAt\" : [\"$city.name\", 0]}\n</code></pre>\n\n<p>would be:</p>\n\n<pre><code>bson.M{\"$arrayElemAt\":[]interface{}{\"$city.name\",0}\n</code></pre>\n\n<p>You were getting the compile error because of this:</p>\n\n<pre><code>bson.M{\"$city.name\", 0} \n</code></pre>\n\n<p><code>bson.M</code> is a map, thus the correct syntax should use a <code>:</code> instead of a <code>,</code>.</p>\n"}], "owner": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 0, "accepted_answer_id": 59241431, "answer_count": 1, "score": 0, "last_activity_date": 1575901669, "creation_date": 1575850128, "last_edit_date": 1575884920, "question_id": 59241067, "link": "https://stackoverflow.com/questions/59241067/how-to-use-arrayelemat-with-mongodb", "title": "How to use $arrayElemAt with MongoDb", "body": "<p>I have the following pipeline, which I want to use it in Golang and convert it to bson.M. One way is using bson.UnmarshalExtJSON but I want to know what is exact equivalent of bson.M of this pipeline. In fact my problem is in $arrayElemAt line.</p>\n\n<pre><code>            \"$lookup\": {\n                        \"from\" : \"cities\",\n                        \"localField\": \"cityId\",\n                        \"foreignField\": \"_id\",\n                        \"as\" : \"city\"\n                    }}\n            , {\n            \"$project\": {\n              \"_id\": 0,\n              \"name\": 1,\n              \"age\": 1,\n              \"city\": { \"$arrayElemAt\" : [\"$city.name\", 0]}\n            }}\n</code></pre>\n\n<p>I use this bson.M:</p>\n\n<pre><code>   stage1 := bson.M{\n        \"$lookup\": bson.M{\n            \"from\": \"cities\",\n            \"localField\": \"cityId\",\n            \"foreignField\": \"_id\",\n            \"as\" : \"city\",\n        },\n    }\n\n    stage2 := bson.M{\n        \"$project\": bson.M{\n            \"_id\": 0,\n            \"name\": 1,\n            \"age\": 1,\n            \"city\": bson.M{ \"$arrayElemAt\" : bson.M{\"$city.name\", 0} },\n        },\n    }\n\n    pipeline := make([]bson.M, 0)\n\n    pipeline = append(pipeline, stage1)\n    pipeline = append(pipeline, stage2)\n</code></pre>\n\n<p>The above code gives me compiler error: <em>missing key in map literal</em> at the line I have <em>\"city\": bson.M{ \"$arrayElemAt\" : bson.M{\"$city.name\", 0} }</em>. So what is the correct way of defining $arrayElemAt as bson.M?</p>\n"}, {"tags": ["mongodb", "go", "struct", "decode"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 2, "creation_date": 1575843369, "post_id": 59240353, "comment_id": 104692109, "body": "Have you tried tagging the field with bson:&quot;_id&quot; instead of json:&quot;_id&quot;?"}], "answers": [{"tags": [], "owner": {"reputation": 95, "user_id": 8893337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3ed98c5b3212f50965bdcd10c311be9?s=128&d=identicon&r=PG&f=1", "display_name": "qweqweqweqweqw", "link": "https://stackoverflow.com/users/8893337/qweqweqweqweqw"}, "is_accepted": true, "score": 1, "last_activity_date": 1575857216, "creation_date": 1575857216, "answer_id": 59241684, "question_id": 59240353, "link": "https://stackoverflow.com/questions/59240353/fail-to-decode-mongo-document-id-onto-struct-field/59241684#59241684", "title": "Fail to decode mongo document ID onto struct field", "body": "<p>the struct should be like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import \"go.mongodb.org/mongo-driver/bson/primitive\"\n\ntype User struct {\n    ID primitive.ObjectID `bson:\"_id\"`\n    ...\n}\n</code></pre>\n\n<p>to transfer your <code>_id</code> to string please use <code>xx.ID.Hex()</code></p>\n\n<blockquote>\n  <p><a href=\"https://github.com/mongodb/mongo-go-driver/blob/master/bson/primitive/objectid.go\" rel=\"nofollow noreferrer\">see more on Github</a></p>\n</blockquote>\n"}], "owner": {"reputation": 184, "user_id": 5539494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/de5558aed62a14232df48682aff5f875?s=128&d=identicon&r=PG&f=1", "display_name": "ks2bmallik", "link": "https://stackoverflow.com/users/5539494/ks2bmallik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 59241684, "answer_count": 1, "score": 1, "last_activity_date": 1575884941, "creation_date": 1575843093, "last_edit_date": 1575884941, "question_id": 59240353, "link": "https://stackoverflow.com/questions/59240353/fail-to-decode-mongo-document-id-onto-struct-field", "title": "Fail to decode mongo document ID onto struct field", "body": "<p>Trying to use <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">mongo go driver</a> to decode a fetch a single user document and decode it into a struct, using the <a href=\"https://github.com/mongodb/mongo-go-driver#usage\" rel=\"nofollow noreferrer\">findOne</a> method. But, I am unable to decode the document ID on the struct field. I tried looking for it in their examples, or at other sites/blogs, but no luck. I am working with: </p>\n\n<ul>\n<li>go v1.13.4 </li>\n<li>mongo v4.2.1 </li>\n<li>mongo-go-driver v1.1.3</li>\n</ul>\n\n<p>Below is the code snippet:</p>\n\n<pre><code>type User struct {\n    ID            interface{} `json:\"_id\"`\n    Name          string\n    Email         string\n    Password      string // hashed\n}\n\n/* Other versions of User struct which I already tried\n\ntype User struct {\n    ID            interface{}\n    Name          string\n    Email         string\n    Password      string // hashed\n}\n\ntype User struct {\n    ID            string `json:\"_id\"`\n    Name          string\n    Email         string\n    Password      string // hashed\n}\n\ntype User struct {\n    ID            string\n    Name          string\n    Email         string\n    Password      string // hashed\n}\n*/\n\nfunc main() {\n    conn := service.MongoConn() // get a mongo connection on the required database\n    user := &amp;service.User{}\n    err := conn.Collection(\"users\").\n             FindOne(context.Background(), bson.M{\"email\": \"foo@bar.com\"}).\n             Decode(user)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%+v\\n\", user)\n}\n</code></pre>\n\n<p>I want to use doc ID as a reference in other documents in a different collection, otherwise, I have to resort to some other unique field like email. </p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1575839835, "post_id": 59239910, "comment_id": 104691311, "body": "Show the code that receives on <code>paths</code> and <code>errc</code>.  Indicate where in the code the groutines were blocked using the stack traces printed by the panic handler."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1575840334, "post_id": 59239910, "comment_id": 104691428, "body": "Nobody is reading from errc."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 5, "creation_date": 1575842837, "post_id": 59239910, "comment_id": 104691992, "body": "You&#39;re reading from errc only once, but all groutines are writing to it. Once the errc is read for the first completing goroutine, all others are stuck waiting to write to it."}, {"owner": {"reputation": 11109, "user_id": 78640, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/b083b8207ccd0744a5abb18c8e75d24d?s=128&d=identicon&r=PG", "display_name": "Sergi Mansilla", "link": "https://stackoverflow.com/users/78640/sergi-mansilla"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575887743, "post_id": 59239910, "comment_id": 104704078, "body": "@BurakSerdar that was it, thanks :) If you want to put it as an answer I&#39;ll accept it!"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1575901505, "creation_date": 1575901505, "answer_id": 59250899, "question_id": 59239910, "link": "https://stackoverflow.com/questions/59239910/goroutine-deadlock-while-walking-folders/59250899#59250899", "title": "Goroutine deadlock while walking folders", "body": "<p>The problem is here:</p>\n\n<pre><code>   if err := &lt;-errc; err != nil {\n        return nil, err\n    }\n</code></pre>\n\n<p>You're reading from the <code>errc</code> only once, but all groutines are writing to it. Once the errc is read for the first completing goroutine, all others are stuck waiting to write to it.</p>\n\n<p>Read using a for-loop.</p>\n"}], "owner": {"reputation": 11109, "user_id": 78640, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/b083b8207ccd0744a5abb18c8e75d24d?s=128&d=identicon&r=PG", "display_name": "Sergi Mansilla", "link": "https://stackoverflow.com/users/78640/sergi-mansilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 59250899, "answer_count": 1, "score": 0, "last_activity_date": 1575901505, "creation_date": 1575839142, "last_edit_date": 1575841683, "question_id": 59239910, "link": "https://stackoverflow.com/questions/59239910/goroutine-deadlock-while-walking-folders", "title": "Goroutine deadlock while walking folders", "body": "<p>I have this code based on the <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">pipelines</a> example. <code>walkFiles</code> takes one or more than one folder (as specified in the <code>folders</code> variable) and \"visits\" the files in all folders given as a parameter. It also takes a <code>done</code> channel to allow for cancellation, but I don't think it matters for this problem.</p>\n\n<p>The code works as expected when passed only one folder to walk. But when given two it gives me the infamous <code>fatal error: all goroutines are asleep - deadlock!</code> error. It even looks like it's doing the right thing by processing the files of the two folders, but it doesn't end well. What is the (probably obvious) error I'm making in the concurrency of this function?</p>\n\n<p>Here's the code:</p>\n\n<pre><code>type result struct {\n    path     string\n    checksum []byte\n    err      error\n}\n\ntype FileData struct {\n    Hash []byte\n}\n\n// walkFiles starts a goroutine to walk the directory tree at root and send the\n// path of each regular file on the string channel.  It sends the result of the\n// walk on the error channel.  If done is closed, walkFiles abandons its work.\nfunc (p Processor) walkFiles(done &lt;-chan struct{}, folders []string) (&lt;-chan string, &lt;-chan error) {\n    paths := make(chan string)\n    errc := make(chan error, 1)\n\n    visit := func(path string, info os.FileInfo, err error) error {\n        if err != nil {\n            return err\n        }\n\n        if !info.Mode().IsRegular() {\n            return nil\n        }\n\n        select {\n        case paths &lt;- path:\n        case &lt;-done:\n            return errors.New(\"walk canceled\")\n        }\n        return nil\n    }\n\n    var wg sync.WaitGroup\n    for i, folder := range folders {\n        wg.Add(1)\n        go func(f string, i int) {\n            defer wg.Done()\n            // No select needed for this send, since errc is buffered.\n            errc &lt;- filepath.Walk(f, visit)\n        }(folder, i)\n    }\n\n    go func() {\n        wg.Wait()\n        close(paths)\n    }()\n\n    return paths, errc\n}\n\nfunc closeFile(f *os.File) {\n    err := f.Close()\n\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"error: %v\\n\", err)\n        os.Exit(1)\n    }\n}\n\n// processor reads path names from paths and sends digests of the corresponding\n// files on c until either paths or done is closed.\nfunc (p Processor) process(done &lt;-chan struct{}, files &lt;-chan string, c chan&lt;- result, loc *locator.Locator) {\n    for f := range files {\n        func() {\n            file, err := os.Open(f.path)\n            if err != nil {\n                fmt.Println(err)\n                return\n            }\n            defer closeFile(file)\n\n            // Hashing file, producing `checksum` variable, and an `err`\n\n            select {\n            case c &lt;- result{f.path, checksum, err}:\n\n            case &lt;-done:\n                return\n            }\n        }()\n    }\n}\n\n// MD5All reads all the files in the file tree rooted at root and returns a map\n// from file path to the MD5 sum of the file's contents.  If the directory walk\n// fails or any read operation fails, MD5All returns an error.  In that case,\n// MD5All does not wait for inflight read operations to complete.\nfunc (p Processor) MD5All(folders []string) (map[string]FileData, error) {\n    // MD5All closes the done channel when it returns; it may do so before\n    // receiving all the values from c and errc.\n    done := make(chan struct{})\n    defer close(done)\n\n    paths, errc := p.walkFiles(done, folders)\n\n    c := make(chan result)\n    var wg sync.WaitGroup\n    wg.Add(NUM_DIGESTERS)\n    for i := 0; i &lt; NUM_DIGESTERS; i++ {\n        go func() {\n            p.process(done, paths, c, loc)\n            wg.Done()\n        }()\n    }\n    go func() {\n        wg.Wait()\n        close(c)\n    }()\n    // End of pipeline. OMIT\n\n    m := make(map[string]FileData)\n    for r := range c {\n        if r.err != nil {\n            return nil, r.err\n        }\n        m[r.path] = FileData{r.checksum}\n    }\n\n    if err := &lt;-errc; err != nil {\n        return nil, err\n    }\n    return m, nil\n}\n\n\nfunc (p Processor) Start() map[string]FileData {\n    m, err := p.MD5All(p.folders)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return m\n}\n</code></pre>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1575824068, "post_id": 59237542, "comment_id": 104686811, "body": "The fields are <i>unexported</i>, you need to export them."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1575824131, "post_id": 59237542, "comment_id": 104686826, "body": "... if you don&#39;t know how, or why, see here: <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Exported_identifiers</a>"}, {"owner": {"reputation": 89, "user_id": 12500881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8f02d48a965189efd7e43370bc6014d?s=128&d=identicon&r=PG&f=1", "display_name": "Takato Horikoshi", "link": "https://stackoverflow.com/users/12500881/takato-horikoshi"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1575824239, "post_id": 59237542, "comment_id": 104686859, "body": "I forgot to definition of type of response. I fixed the question."}], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 12500881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8f02d48a965189efd7e43370bc6014d?s=128&d=identicon&r=PG&f=1", "display_name": "Takato Horikoshi", "link": "https://stackoverflow.com/users/12500881/takato-horikoshi"}, "edited": false, "score": 0, "creation_date": 1575824679, "post_id": 59237727, "comment_id": 104686964, "body": "Thx. I got mistake when I create the question."}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 1, "last_activity_date": 1575827060, "last_edit_date": 1575827060, "creation_date": 1575824471, "answer_id": 59237727, "question_id": 59237542, "link": "https://stackoverflow.com/questions/59237542/why-i-cant-parse-json-which-has-nested-array-with-unmarshal/59237727#59237727", "title": "Why I can&#39;t parse json which has nested array with Unmarshal", "body": "<p>Edit: And as @mkopriva has pointed out the JSON will not unmarshal into the struct, if the fields are not exported (i.e. begin with a capital letter) e.g.</p>\n\n<pre><code>type GaitameOnlineResponse struct {\n    Quotes []Quote `json:\"quotes\"`\n}\n\ntype Quote struct {\n    High             string `json:\"high\"`\n    Open             string `json:\"open\"`\n    Bid              string `json:\"bid\"`\n    CurrencyPairCode string `json:\"currencyPairCode\"` // add tags to match the exact JSON field names\n    Ask              string `json:\"ask\"`\n    Low              string `json:\"low\"`\n}\n</code></pre>\n\n<hr>\n\n<p>There's many online JSON validators out there e.g. <a href=\"https://jsonlint.com/\" rel=\"nofollow noreferrer\">https://jsonlint.com/</a></p>\n\n<p>Pasting your JSON into reveals the error:</p>\n\n<pre><code>Error: Parse error on line 17:\n...\"low\": \"81.79\"\n</code></pre>\n\n<p>Adding a <code>]</code> to complete the array at line 18 will fix your JSON e.g.</p>\n\n<pre><code>            \"low\": \"81.79\"\n        }\n    ]\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 89, "user_id": 12500881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8f02d48a965189efd7e43370bc6014d?s=128&d=identicon&r=PG&f=1", "display_name": "Takato Horikoshi", "link": "https://stackoverflow.com/users/12500881/takato-horikoshi"}, "is_accepted": true, "score": 1, "last_activity_date": 1575824857, "creation_date": 1575824857, "answer_id": 59237782, "question_id": 59237542, "link": "https://stackoverflow.com/questions/59237542/why-i-cant-parse-json-which-has-nested-array-with-unmarshal/59237782#59237782", "title": "Why I can&#39;t parse json which has nested array with Unmarshal", "body": "<p>I had to export.</p>\n\n<pre><code>type GaitameOnlineResponse struct {\n    Quotes []Quote\n}\n\ntype Quote struct {\n    High             string\n    Open             string\n    Bid              string\n    CurrencyPairCode string\n    Ask              string\n    Low              string\n}\n</code></pre>\n\n<p>I resolved.</p>\n"}], "owner": {"reputation": 89, "user_id": 12500881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8f02d48a965189efd7e43370bc6014d?s=128&d=identicon&r=PG&f=1", "display_name": "Takato Horikoshi", "link": "https://stackoverflow.com/users/12500881/takato-horikoshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "closed_date": 1575831211, "accepted_answer_id": 59237782, "answer_count": 2, "score": -2, "last_activity_date": 1575827060, "creation_date": 1575823344, "last_edit_date": 1575824622, "question_id": 59237542, "link": "https://stackoverflow.com/questions/59237542/why-i-cant-parse-json-which-has-nested-array-with-unmarshal", "closed_reason": "Duplicate", "title": "Why I can&#39;t parse json which has nested array with Unmarshal", "body": "<p>I want parse this json using <code>json.Unmarshal</code> in Go.</p>\n\n<pre><code>{\n    \"quotes\": [\n        {\n            \"high\": \"1.9981\",\n            \"open\": \"1.9981\",\n            \"bid\": \"1.9981\",\n            \"currencyPairCode\": \"GBPNZD\",\n            \"ask\": \"2.0043\",\n            \"low\": \"1.9981\"\n        },\n        {\n            \"high\": \"81.79\",\n            \"open\": \"81.79\",\n            \"bid\": \"81.79\",\n            \"currencyPairCode\": \"CADJPY\",\n            \"ask\": \"82.03\",\n            \"low\": \"81.79\"\n        }\n    ]\n}\n</code></pre>\n\n<p>source returns <code>{[]}</code> about parse result. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\ntype GaitameOnlineResponse struct {\n    quotes []Quote\n}\n\ntype Quote struct {\n    high             string\n    open             string\n    bid              string\n    currencyPairCode string\n    ask              string\n    low              string\n}\n\nfunc sampleParse() {\n    path := os.Getenv(\"PWD\")\n    bytes, err := ioutil.ReadFile(path + \"/rate.json\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    var r GaitameOnlineResponse\n    if err := json.Unmarshal(bytes, &amp;r); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(r)\n    // {[]} \n}\n</code></pre>\n\n<p>I don't know a reason of the result.</p>\n"}, {"tags": ["go", "cryptography", "integer", "hex"], "comments": [{"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1575836946, "post_id": 59237142, "comment_id": 104690552, "body": "XOR&#39;ing twice or more with the same key means that a lot of information is quickly lost, read up about many-time pad. Using a block cipher is much more secure."}], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 1, "last_activity_date": 1575822853, "creation_date": 1575822853, "answer_id": 59237481, "question_id": 59237142, "link": "https://stackoverflow.com/questions/59237142/scramble-unscramble-an-integer-value-to-from-hexadecimal-string/59237481#59237481", "title": "Scramble/unscramble an integer value to/from hexadecimal string", "body": "<p>There are many native or external packages to achieve what you want, but if you want to implement this yourself for a learning experience, you can try the following tack:</p>\n\n<p>Rather than shuffle your data back and forth between string and int32 format - keep the data in its raw type and use Stringer methods to convert to hex - and helper methods/functions to convert to the desired type. This simplifies the scrambling/unscrambling logic - as the input types are the same for both.</p>\n\n<pre><code>// Code custom type so we can add stringer methods\ntype Code uint32\n\n// String converts code to hex string format\nfunc (c Code) String() string {\n    return fmt.Sprintf(\"%x\", uint32(c))\n}\n\n// CodeFromString gets a code from a hex string\nfunc CodeFromString(hexs string) (Code, error) {\n    ui, err := strconv.ParseUint(hexs, 16, 32)\n    if err != nil {\n        return 0, err\n    }\n\n    return Code(ui), nil\n}\n\n// XOR scrambles/unscrambles\nfunc XOR(key, value Code) Code {\n    return key ^ value\n}\n</code></pre>\n\n<p>And to use:</p>\n\n<pre><code>keyHex := \"74490a85\"\nvalueHex := \"d195c729\"\n\nvalue, _ := CodeFromString(valueHex)\nkey, _ := CodeFromString(keyHex)\n\nscrambled := XOR(key, value)\n\nunscrambled := XOR(key, scrambled)\n</code></pre>\n\n<p>Playground Example: <a href=\"https://play.golang.org/p/y5pbac_f8Z1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/y5pbac_f8Z1</a></p>\n"}], "owner": {"reputation": 11, "user_id": 11457307, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PtEOM.jpg?s=128&g=1", "display_name": "luke.ph", "link": "https://stackoverflow.com/users/11457307/luke-ph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 1, "accepted_answer_id": 59237481, "answer_count": 1, "score": 0, "last_activity_date": 1575831383, "creation_date": 1575820314, "last_edit_date": 1575831383, "question_id": 59237142, "link": "https://stackoverflow.com/questions/59237142/scramble-unscramble-an-integer-value-to-from-hexadecimal-string", "title": "Scramble/unscramble an integer value to/from hexadecimal string", "body": "<p>I'm attempting to implement some Go code to solve a problem in which I need to sufficiently obfuscate a known integer value by converting it into a seemingly random hexadecimal string, when provided a known key value as an additional input parameter. The resulting hexadecimal string needs to always be the same number of characters in length (ideally, &lt;= 32 characters).</p>\n\n<p>Furthermore, using the same key string value, I need to un-obfuscate the hexadecimal string back into the original integer. For additional context, I'd like to satisfy the following function signatures (but am open to alternative methods, if necessary):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Scramble(key string, value int32) string {\n  // TODO: Given a known key and value, generate a sufficiently unpredictable hexadecimal string.\n}\n\nfunc Unscramble(key string, value string) int32 {\n  // TODO: Given a known key and value, generate the integer that created the hexadecimal string.\n}\n\nfunc main() {\n  key := \"Something super secret!\"\n\n  scrambled := Scramble(key, 135)\n  fmt.Printf(\"Scrambled: %s\\n\", scrambled) // Scrambled: a1dec128b590b9ec3281110d6d188c26\n\n  unscrambled := Unscramble(key, scrambled)\n  fmt.Printf(\"Unscrambled: %d\\n\", unscrambled) // Unscrambled: 135\n}\n</code></pre>\n\n<p>I <em>think</em> XOR'ing may be the right direction, but I'm unsure and not particularly familiar with the topic yet.</p>\n\n<p>Any insight/direction would be greatly appreciated! Please let me know if I can provide any additional context/clarifications.</p>\n"}, {"tags": ["go", "signals"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1575818391, "post_id": 59236641, "comment_id": 104685137, "body": "I have not looked at the Go 1.14 code, but in general, the Linux/Unix signal handling system works by delivering a signal on the signal stack that the process has pre-set, or on the current stack if it did not pre-set a signal stack. To interrupt the running program, instead of having the kernel&#39;s own interrupt/fault-handler return to the user instruction that got interrupted/faulted, the kernel writes a kernel context to the signal stack frame, then sets the program counter(s) appropriately and &quot;returns&quot; to the user signal trampoline. This trampoline is responsible for (continued)"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1575818526, "post_id": 59236641, "comment_id": 104685169, "body": "... taking the signal and eventually using a <code>sigreturn</code> system call (or similar) to restore register values and go back to user code. Typically, to reschedule in a user-land scheduler, you would change the sigreturn data structure&#39;s saved PC(s) (and any other special registers) after first saving the interrupted PC(s) / registers so that the interrupted thing can be restored. In this case, that corresponds to setting the ctx <code>rip</code>, so it&#39;s more or less what you&#39;re suggesting."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1575819343, "post_id": 59236641, "comment_id": 104685417, "body": "@torek If I understand correctly, the kernel indeed can restore the modified registers and can start executing from somewhere else other than where was interrupted. If so then it becomes very interesting: the signal handler in Go runtime sets the <code>rip</code> to <code>asyncPreempt</code>, but not executing it after signal handler is returned. Instead, it calls <code>morestack</code>. Any thoughts on why?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1575819409, "post_id": 59236641, "comment_id": 104685440, "body": "I&#39;d bet that there&#39;s some other boilerplate-y stuff somewhere that makes sure that the newly launched goroutine calls <code>morestack</code> first. Exactly where, well, that tends to be tricky."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1575819592, "post_id": 59236641, "comment_id": 104685496, "body": "@torek, this seems false. I checked the generated assembly, there is no prologue in <code>asyncPreempt</code> call, which means if the kernel restores to <code>asyncPreempt</code>, it should start calling it immediately."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1575819782, "post_id": 59236641, "comment_id": 104685549, "body": "The boilerplate may be elsewhere/elsewise: that ctx.rip might not be sent directly to the kernel, for instance. As I said, I haven&#39;t looked at the new 1.14 code (haven&#39;t even looked at the 1.13 code, actually)."}], "answers": [{"tags": [], "owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "is_accepted": true, "score": 0, "last_activity_date": 1575839644, "creation_date": 1575839644, "answer_id": 59239956, "question_id": 59236641, "link": "https://stackoverflow.com/questions/59236641/what-happens-if-ctx-rip-and-ctx-rsp-in-a-signal-handler-is-modified/59239956#59239956", "title": "What happens if ctx.rip and ctx.rsp in a signal handler is modified", "body": "<p>I've figured it out, many thanks to Ian's hint:</p>\n\n<p><a href=\"https://groups.google.com/forum/#!topic/golang-nuts/BA7Dqp_zcwk\" rel=\"nofollow noreferrer\">https://groups.google.com/forum/#!topic/golang-nuts/BA7Dqp_zcwk</a></p>\n\n<p>The root cause seems similar to the \"uncertainty principle\".</p>\n\n<p>As an observer, by adding a <code>println</code> call in <code>asyncPreempt</code> \nas well as <code>asyncPreempt2</code> influences the actual behavior \nafter signal handling. The <code>println</code> involves stack split check, \nwhich calls the <code>morestack</code>.</p>\n\n<p>It took me a while to realize that <code>morestack</code> stores its caller \npc in <code>g.m.morebuf.pc</code> since <code>getcallerpc</code> in <code>newstack</code> \nalways returns the pc from <code>morestack</code>, which doesn't tell \ntoo much information.</p>\n\n<pre><code>//go:nosplit\nfunc asyncPreempt2() {\n    // println(\"asyncPreempt2 is called\") // comment here omits calling morestack.\n    gp := getg()\n    gp.asyncSafePoint = true\n    if gp.preemptStop {\n        mcall(preemptPark)\n    } else {\n        mcall(gopreempt_m)\n    }\n    println(\"asyncPreempt2 finished\")\n    gp.asyncSafePoint = false\n}\n</code></pre>\n\n<p><strong>TLDR: after signal handler, kernal restores <code>asyncPreempt</code>'s <code>rip</code> and directly switches to it, nothing happens between <code>runtime.asyncPreempt</code> and <code>runtime.sigtramp</code>.</strong></p>\n"}], "owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 59239956, "answer_count": 1, "score": 0, "last_activity_date": 1575839644, "creation_date": 1575817030, "last_edit_date": 1575817402, "question_id": 59236641, "link": "https://stackoverflow.com/questions/59236641/what-happens-if-ctx-rip-and-ctx-rsp-in-a-signal-handler-is-modified", "title": "What happens if ctx.rip and ctx.rsp in a signal handler is modified", "body": "<p>As we all know that a program is interrupted by a signal and entering kernel space then switch to a userspace signal handler. After the signal handler is accomplished, it will be reentering the kernel space then switch back to where was interrupted.</p>\n\n<p>I am recently reading the newly implemented async preemption in go 1.14, which uses the OS signal to interrupt a \"non-preemptive\" user goroutine. I am debugging very simple program:</p>\n\n<pre><code>package main\n\nimport (\n    \"runtime\"\n    \"time\"\n)\n\nfunc tightloop() {\n    for {\n    }\n}\n\nfunc main() {\n    runtime.GOMAXPROCS(1)\n    go tightloop()\n\n    time.Sleep(time.Millisecond)\n    println(\"OK\")\n    runtime.Gosched()\n}\n</code></pre>\n\n<p>In Go 1.14, when a preempt signal arrives, the <code>tightloop</code> will be interrupted by the OS and entering the pre-configured signal handler <code>runtime\u00b7sigtramp</code>:</p>\n\n<pre><code>TEXT runtime\u00b7sigtramp(SB),NOSPLIT,$72\n    MOVQ    DX, ctx-56(SP)\n    MOVQ    SI, info-64(SP)\n    MOVQ    DI, signum-72(SP)\n    MOVQ    $runtime\u00b7sigtrampgo(SB), AX\n    CALL AX\n    RET\n</code></pre>\n\n<p>which <code>sigtrampgo</code> eventually calls the <code>sighandler</code>.</p>\n\n<pre><code>//go:nosplit\n//go:nowritebarrierrec\nfunc sigtrampgo(sig uint32, info *siginfo, ctx unsafe.Pointer) {\n    (...)\n    setg(g.m.gsignal)\n    (...)\n    sighandler(sig, info, ctx, g)\n    setg(g)\n    (...)\n}\n</code></pre>\n\n<p>As far as I read the <code>sighandler</code> function, it calls <code>doSigPreempt</code> and modifies the <code>ctx</code> that passed from system kernel, and sets the <code>rip</code> to the prologue of <code>runtime.asyncPreempt</code>.</p>\n\n<pre><code>//go:nowritebarrierrec\nfunc sighandler(sig uint32, info *siginfo, ctxt unsafe.Pointer, gp *g) {\n    _g_ := getg()\n    c := &amp;sigctxt{info, ctxt}\n\n    (...)\n    if sig == sigPreempt {\n        doSigPreempt(gp, c)\n    }\n}\nfunc doSigPreempt(gp *g, ctxt *sigctxt) {\n    if canPreempt {\n        // here modifies the rip and rsp\n        ctxt.pushCall(funcPC(asyncPreempt))\n    }\n\n    (...)\n}\n</code></pre>\n\n<p>However, I noticed that the asyncPreempt is not immediately executed when\nthe signal handler is complete, instead:</p>\n\n<ol>\n<li><p><code>morestack</code> or <code>morestack_noctxt</code> is called after <code>sighandler</code> is <strong>returned</strong> (not entering either the epilogue or prologue), which calls <code>newstack</code> and check checks the preempt flag and entering schedule loop and therefore schedules the main goroutine to finish the async preemption.</p></li>\n<li><p>the <code>OK</code> outputs before executing <code>asyncPreempt</code></p></li>\n</ol>\n\n<p>Here is my inserted print logs in runtime:</p>\n\n<pre><code>mstart1 call schedule()\nenter schedule()\npark_m call schedule()\nenter schedule()\nmstart1 call schedule()\nenter schedule()\nmstart1 call schedule()\nenter schedule()\npark_m call schedule()\nenter schedule()\npark_m call schedule()\nenter schedule()\npark_m call schedule()\nenter schedule()\nmstart1 call schedule()\nenter schedule()\npark_m call schedule()\nenter schedule()\nrip: 17149264 eip: 824634034136\nbefore pushCall asyncPreempt\nafter pushCall asyncPreempt\nrip: 17124704 eip: 824634034128      // rip points to asyncPreempt\ncalling newstack: m0, g0             // how could newstack is called?\nnewstack call gopreempt_m\ngopreempt_m call goschedImpl\ngoschedImpl call schedule()\nenter schedule()\nOK\ngosched_m call goschedImpl\ngoschedImpl call schedule()\nenter schedule()\nasyncPreempt2\nasyncPreempt2\nasyncPreempt2\nasyncPreempt2\npreemptPark\ngopreempt_m call goschedImpl\ngoschedImpl call schedule()\nenter schedule()\n</code></pre>\n\n<p>while I checked the dumped assembly code, there are no stack split check\nin neither <code>asyncPreempt</code> or <code>sigtramp</code>.</p>\n\n<p>Sorry for the long story, my questions are:</p>\n\n<ul>\n<li>When, who, and how runtime calls the <code>morestack</code> after <code>sighandler</code>? What did I miss?</li>\n<li>Does modifying <code>ctx</code> changes program jumps to the modified <code>rip</code> instruction after finishing the signal handler?</li>\n</ul>\n\n<p>Thank you very much for reading the question and thanks to the go team building such a brilliant feature.</p>\n"}, {"tags": ["windows", "powershell", "go", "github-actions", "golint"], "answers": [{"tags": [], "owner": {"reputation": 25744, "user_id": 2089675, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/sBz5q.jpg?s=128&g=1", "display_name": "smac89", "link": "https://stackoverflow.com/users/2089675/smac89"}, "is_accepted": true, "score": 3, "last_activity_date": 1575870892, "last_edit_date": 1575870892, "creation_date": 1575868991, "answer_id": 59242962, "question_id": 59236611, "link": "https://stackoverflow.com/questions/59236611/github-actions-run-golint-on-wihdows/59242962#59242962", "title": "GitHub Actions: Run golint on wihdows", "body": "<p>As <a href=\"https://stackoverflow.com/a/59238828/2089675\">another (deleted) answer</a> mentioned, this is a PATH issue.</p>\n\n<p>Use this workflow instead:</p>\n\n<pre><code>name: test\non:\n  push:\n    branches:\n    - \"**\"\njobs:\n  test:\n    runs-on: ${{ matrix.os }}\n    strategy:\n      fail-fast: false\n      matrix:\n        os:\n        - ubuntu-latest\n        - macOS-latest\n        - windows-latest\n    steps:\n    - name: setup go\n      uses: actions/setup-go@v1\n      with:\n        go-version: 1.x\n    - name: setup env\n      run: |\n        echo \"::set-env name=GOPATH::$(go env GOPATH)\"\n        echo \"::add-path::$(go env GOPATH)/bin\"\n      shell: bash\n    - name: checkout\n      uses: actions/checkout@v1\n      with:\n        fetch-depth: 1\n        path: src/github.com/${{ github.repository }}\n    - name: golint\n      run: |\n        go env\n        go install golang.org/x/lint/golint\n        golint ./...\n</code></pre>\n"}], "owner": {"reputation": 4644, "user_id": 104080, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Mq2Yx.jpg?s=128&g=1", "display_name": "Matt - sanemat", "link": "https://stackoverflow.com/users/104080/matt-sanemat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 640, "favorite_count": 0, "accepted_answer_id": 59242962, "answer_count": 1, "score": 2, "last_activity_date": 1575870892, "creation_date": 1575816811, "question_id": 59236611, "link": "https://stackoverflow.com/questions/59236611/github-actions-run-golint-on-wihdows", "title": "GitHub Actions: Run golint on wihdows", "body": "<p>I want to run golint on windows in GitHub Actions.</p>\n\n<pre><code>go install golang.org/x/lint/golint\ngolint ./...\n</code></pre>\n\n<p>But I met this error:</p>\n\n<pre><code>golint : The term 'golint' is not recognized as the name of a cmdlet, function, script file, or operable program.\nCheck the spelling of the name, or if a path was included, verify that the path is correct and try again.\nAt D:\\a\\_temp\\dd1f47cc-42be-445e-9300-b2b5fbfd04da.ps1:4 char:1\n+ golint ./...\n+ ~~~~~~\n+ CategoryInfo          : ObjectNotFound: (golint:String) [], ParentContainsErrorRecordException\n+ FullyQualifiedErrorId : CommandNotFoundException\n\n##[error]Process completed with exit code 1.\n</code></pre>\n\n<p>What do I do next?</p>\n\n<p>This is my <code>.github/workflows/test.yaml</code> below. This works well on Ubuntu and Mac. </p>\n\n<pre><code>name: test\non:\n  push:\n    branches:\n    - \"**\"\njobs:\n  test:\n    runs-on: ${{ matrix.os }}\n    strategy:\n      fail-fast: false\n      matrix:\n        os:\n        - ubuntu-latest\n        - macOS-latest\n        - windows-latest\n    steps:\n    - name: setup env unix\n      run: |\n        echo ::set-env name=GOPATH::${{ runner.workspace }}\n        echo ::add-path::${{ runner.workspace }}/bin\n      if: \"matrix.os == 'ubuntu-latest' || matrix.os == 'macOS-latest'\"\n    - name: setup env windows\n      run: |\n        echo ::set-env name=GOPATH::${{ runner.workspace }}\n        echo ::add-path::${{ runner.workspace }}\\bin\n      if: \"matrix.os == 'windows-latest'\"\n    - name: setup go\n      uses: actions/setup-go@v1\n      with:\n        go-version: 1.x\n    - name: checkout\n      uses: actions/checkout@v1\n      with:\n        fetch-depth: 1\n        path: src/github.com/${{ github.repository }}\n    - name: golint\n      run: |\n        go env\n        go install golang.org/x/lint/golint\n        golint ./...\n\n</code></pre>\n\n<p>This is the minimal repository: <a href=\"https://github.com/sanemat/use-golint-on-windows\" rel=\"nofollow noreferrer\">https://github.com/sanemat/use-golint-on-windows</a>\nThis is the pull request: <a href=\"https://github.com/sanemat/use-golint-on-windows/pull/2\" rel=\"nofollow noreferrer\">https://github.com/sanemat/use-golint-on-windows/pull/2</a></p>\n"}, {"tags": ["c", "pointers", "go", "aix", "cgo"], "comments": [{"owner": {"reputation": 326, "user_id": 12054723, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBX1jlTeWtw4e6GW6fOldhIagCJz5QEBQ9lTTcN_g=k-s128", "display_name": "Gor Stepanyan", "link": "https://stackoverflow.com/users/12054723/gor-stepanyan"}, "edited": false, "score": 0, "creation_date": 1575816405, "post_id": 59236396, "comment_id": 104684629, "body": "<a href=\"https://stackoverflow.com/questions/4007268/what-exactly-is-meant-by-de-referencing-a-null-pointer\" title=\"what exactly is meant by de referencing a null pointer\">stackoverflow.com/questions/4007268/&hellip;</a>"}, {"owner": {"reputation": 46, "user_id": 1064409, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M4aAV.png?s=128&g=1", "display_name": "David Lopes", "link": "https://stackoverflow.com/users/1064409/david-lopes"}, "reply_to_user": {"reputation": 326, "user_id": 12054723, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBX1jlTeWtw4e6GW6fOldhIagCJz5QEBQ9lTTcN_g=k-s128", "display_name": "Gor Stepanyan", "link": "https://stackoverflow.com/users/12054723/gor-stepanyan"}, "edited": false, "score": 0, "creation_date": 1575816569, "post_id": 59236396, "comment_id": 104684677, "body": "This does not help at all. I am passing a pointer as an argument, the pointer should not be dereferenced because I am calling malloc, it must be freed by calling free, can you expand on why you posted that link?"}, {"owner": {"reputation": 46, "user_id": 1064409, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M4aAV.png?s=128&g=1", "display_name": "David Lopes", "link": "https://stackoverflow.com/users/1064409/david-lopes"}, "reply_to_user": {"reputation": 326, "user_id": 12054723, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBX1jlTeWtw4e6GW6fOldhIagCJz5QEBQ9lTTcN_g=k-s128", "display_name": "Gor Stepanyan", "link": "https://stackoverflow.com/users/12054723/gor-stepanyan"}, "edited": false, "score": 0, "creation_date": 1575817049, "post_id": 59236396, "comment_id": 104684805, "body": "The code is heavily inspired on this: <a href=\"https://github.com/prometheus/node_exporter/blob/master/collector/cpu_dragonfly.go\" rel=\"nofollow noreferrer\">github.com/prometheus/node_exporter/blob/master/collector/&hellip;</a> and they seem to not get a nil pointer."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 2, "creation_date": 1575817434, "post_id": 59236396, "comment_id": 104684909, "body": "Is <code>ncpus</code> ever zero? (<code>malloc(0)</code> is allowed to return <code>NULL</code>. AIX is notorious for this.)"}, {"owner": {"reputation": 46, "user_id": 1064409, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M4aAV.png?s=128&g=1", "display_name": "David Lopes", "link": "https://stackoverflow.com/users/1064409/david-lopes"}, "edited": false, "score": 0, "creation_date": 1575818316, "post_id": 59236396, "comment_id": 104685121, "body": "I think you got it, it looks like ncpus is -1 &quot;If I use the return value too fast&quot;, if I put a printf after perfstat_cpu I always get the correct value (16 in this case). I wonder if I need to somehow wait for this function or something like that."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1575823685, "post_id": 59236396, "comment_id": 104686682, "body": "Compared to <a href=\"https://www.ibm.com/support/knowledgecenter/en/ssw_aix_72/performancetools/idprftools_perfstat_int_cpu.html\" rel=\"nofollow noreferrer\">this example</a> your C code is missing copying of the name of the first CPU to the <code>name</code> field of the <code>firstcpu</code> variable. May it really be the reason for the next call to <code>perfstat_cpu</code> to fail (sometimes)?"}, {"owner": {"reputation": 1339, "user_id": 2141064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c56d69ec8f5e469a8c6ca22d60271e9b?s=128&d=identicon&r=PG", "display_name": "Lorinczy Zsigmond", "link": "https://stackoverflow.com/users/2141064/lorinczy-zsigmond"}, "edited": false, "score": 0, "creation_date": 1575825232, "post_id": 59236396, "comment_id": 104687106, "body": "Yeu could try and link with Electric Fence -- it might help to find memory-abuses. <a href=\"http://lzsiga.users.sourceforge.net/aix-linking.html#Q0040\" rel=\"nofollow noreferrer\">lzsiga.users.sourceforge.net/aix-linking.html#Q0040</a>"}, {"owner": {"reputation": 46, "user_id": 1064409, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M4aAV.png?s=128&g=1", "display_name": "David Lopes", "link": "https://stackoverflow.com/users/1064409/david-lopes"}, "edited": false, "score": 1, "creation_date": 1575848949, "post_id": 59236396, "comment_id": 104693292, "body": "Thanks @kostik that seems to fix it, I believe I was passing some garbage to that function before copying the name"}], "answers": [{"tags": [], "owner": {"reputation": 46, "user_id": 1064409, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M4aAV.png?s=128&g=1", "display_name": "David Lopes", "link": "https://stackoverflow.com/users/1064409/david-lopes"}, "is_accepted": false, "score": 0, "last_activity_date": 1575849159, "creation_date": 1575849159, "answer_id": 59240980, "question_id": 59236396, "link": "https://stackoverflow.com/questions/59236396/pointer-from-c-is-removed-from-memory/59240980#59240980", "title": "Pointer from C is removed from memory", "body": "<p>This had nothing to do with pointers being removed from memory, the <strong>cputicks</strong> was NULL because ncpus was -1 so the malloc call returned NULL, ncpu was -1 because the first parameter of the perfstat_cpu call was not initialized properly, adding:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>strcpy(firstcpu.name, FIRST_CPU);\n</code></pre>\n\n<p>Before the call to <code>perfstat_cpu</code> fixed the issue, as suggested by @kostik</p>\n"}], "owner": {"reputation": 46, "user_id": 1064409, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M4aAV.png?s=128&g=1", "display_name": "David Lopes", "link": "https://stackoverflow.com/users/1064409/david-lopes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1575849159, "creation_date": 1575815365, "last_edit_date": 1575823510, "question_id": 59236396, "link": "https://stackoverflow.com/questions/59236396/pointer-from-c-is-removed-from-memory", "title": "Pointer from C is removed from memory", "body": "<p>In this situation, I pass a pointer from Go to a C function, the C function modifies that pointer value (fills in an array) and I use the same pointer again on the Go code, making sure to call <code>C.free</code> to release it after I am done.</p>\n\n<p>I am <strong>sometimes</strong>  getting a nil reference on that pointer, I am having a hard time understanding why.</p>\n\n<p>Here, the object in Go is <strong>cpuTimesC</strong>, in C it is the <strong>cputicks</strong>.</p>\n\n<p>I have also tried making the function return the pointer, with the same results. The weirdest thing is that if I put a printf statement at the end of the function, it takes longer before I eventually get the nil error.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package collector\n\n/*\n#cgo LDFLAGS: -lperfstat\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;libperfstat.h&gt;\n#include &lt;string.h&gt;\n#include &lt;time.h&gt;\n\nu_longlong_t **ref;\n\nint getCPUTicks(uint64_t **cputicks, size_t *cpu_ticks_len) {\n    int i, ncpus, cputotal;\n    perfstat_id_t firstcpu;\n    perfstat_cpu_t *statp;\n\n    cputotal = perfstat_cpu(NULL, NULL, sizeof(perfstat_cpu_t), 0);\n    if (cputotal &lt;= 0){\n        return -1;\n   }\n\n    statp = calloc(cputotal, sizeof(perfstat_cpu_t));\n    if(statp==NULL){\n            return -1;\n    }\n    ncpus = perfstat_cpu(&amp;firstcpu, statp, sizeof(perfstat_cpu_t), cputotal);\n    *cpu_ticks_len = ncpus*4;\n\n    *cputicks = (uint64_t *) malloc(sizeof(uint64_t)*(*cpu_ticks_len));\n    for (i = 0; i &lt; ncpus; i++) {\n        int offset = 4 * i;\n        (*cputicks)[offset] = statp[i].user;\n        (*cputicks)[offset+1] = statp[i].sys;\n        (*cputicks)[offset+2] = statp[i].wait;\n        (*cputicks)[offset+3] = statp[i].idle;\n    }\n    return 0;\n}\n*/\nimport \"C\"\n\nimport (\n    \"errors\"\n    \"unsafe\"\n    \"fmt\"\n    \"github.com/prometheus/client_golang/prometheus\"\n)\n\nconst ClocksPerSec = float64(C.CLK_TCK)\nconst maxCPUTimesLen = 1024 * 4\n\ntype statCollector struct {\n    cpu *prometheus.Desc\n}\n\nfunc init() {\n    registerCollector(\"cpu\", true, NewCPUCollector)\n}\n\nfunc NewCPUCollector() (Collector, error) {\n    return &amp;statCollector{\n        cpu: nodeCPUSecondsDesc,\n    }, nil\n}\n\nfunc (c *statCollector) Update(ch chan&lt;- prometheus.Metric) error {\n    var fieldsCount = 4\n    cpuFields := []string{\"user\", \"sys\", \"wait\", \"idle\"}\n\n    var (\n        cpuTimesC       *C.uint64_t\n        cpuTimesLength  C.size_t\n    )\n\n    if C.getCPUTicks(&amp;cpuTimesC, &amp;cpuTimesLength) == -1 {\n        return errors.New(\"could not retrieve CPU times\")\n    }\n    defer C.free(unsafe.Pointer(cpuTimesC))\n    cput := (*[maxCPUTimesLen]C.u_longlong_t)(unsafe.Pointer(cpuTimesC))[:cpuTimesLength:cpuTimesLength]\n\n    cpuTicks := make([]float64, cpuTimesLength)\n    for i, value := range cput {\n        cpuTicks[i] = float64(value) / ClocksPerSec\n    }\n\n    for i, value := range cpuTicks {\n        cpux := fmt.Sprintf(\"CPU %d\", i/fieldsCount)\n        ch &lt;- prometheus.MustNewConstMetric(c.cpu, prometheus.CounterValue, value, cpux, cpuFields[i%fieldsCount])\n    }\n\n    return nil\n}\n\n</code></pre>\n\n<p>The error is:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x33 addr=0x0 pc=0x1003fcec0]\n\ngoroutine 940 [running]:\ngithub.com/dlopes7/aix-prometheus-exporter/collector.(*statCollector).Update(0xa000100000d21b8, 0xa0001000028c480, 0x0, 0x0)\n        /home/david/go/src/github.com/dlopes7/aix-prometheus-exporter/collector/cpu_aix.go:81 +0xf0\ngithub.com/dlopes7/aix-prometheus-exporter/collector.execute(0x10043e7e7, 0x3, 0x1101120e0, 0xa000100000d21b8, 0xa0001000028c480)\n        /home/david/go/src/github.com/dlopes7/aix-prometheus-exporter/collector/collector.go:95 +0x6c\ngithub.com/dlopes7/aix-prometheus-exporter/collector.AIXCollector.Collect.func1(0xa0001000028c480, 0xa000100000cd440, 0x10043e7e7, 0x3, 0x1101120e0, 0xa000100000d21b8)\n        /home/david/go/src/github.com/dlopes7/aix-prometheus-exporter/collector/collector.go:115 +0x4c\ncreated by github.com/dlopes7/aix-prometheus-exporter/collector.AIXCollector.Collect\n        /home/david/go/src/github.com/dlopes7/aix-prometheus-exporter/collector/collector.go:114 +0xf8\n\n</code></pre>\n\n<p>And I know it happens here, because for some reason <strong>cpuTimesC</strong> is nil:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>cput := (*[maxCPUTimesLen]C.u_longlong_t)(unsafe.Pointer(cpuTimesC))[:cpuTimesLength:cpuTimesLength]\n</code></pre>\n\n<p>Why would this object be nil sometimes, and how do I make it remain in memory until I call that <code>C.free</code>?</p>\n\n<p>This is on <code>AIX</code> <code>PPC64</code> with <code>cgo</code> if that makes any difference.</p>\n"}, {"tags": ["c", "go"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 4, "creation_date": 1575815659, "post_id": 59236310, "comment_id": 104684448, "body": "Go defaults to unbuffered I/O. Hence, unlike the maze of different buffering behaviors you get in C by default, it&#39;s up to the programmer to pick a buffering system to use."}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1575815436, "post_id": 59236393, "comment_id": 104684393, "body": "but do you know why ? Is the C implementation uses buffering out of the box ?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 4, "creation_date": 1575817839, "post_id": 59236393, "comment_id": 104685002, "body": "@mh-cbon: Yes, C stdio streams are normally either line-buffered or fully-buffered depending on whether they are connected to &quot;terminal-like&quot; devices or &quot;file-like&quot; data. However, the <code>stderr</code> stream is normally <i>un</i>-buffered, regardless of its data sink. Systems may choose to provide additional overrides, such as magic environment variables (though not enough have a nice way to de-buffer or forcibly line-buffer stdout for cases of piped output)."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1575823254, "post_id": 59236393, "comment_id": 104686539, "body": "@mh-cbon, for instance, see <a href=\"https://manpages.debian.org/1/stdbuf\" rel=\"nofollow noreferrer\"><code>stdbuf</code></a>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 6, "last_activity_date": 1575815595, "last_edit_date": 1575815595, "creation_date": 1575815347, "answer_id": 59236393, "question_id": 59236310, "link": "https://stackoverflow.com/questions/59236310/why-write-bytes-to-files-is-slow-for-go-compared-with-c/59236393#59236393", "title": "Why write bytes to files is slow for Go, compared with C", "body": "<p>Meaningless microbenchmarks produce meaningless results.</p>\n\n<hr>\n\n<p>Go:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    f, _ := os.Create(\"tmp/sotest/test.txt\")\n    w := bufio.NewWriter(f)\n    count := int(1.024e7)\n    for i := 0; i &lt; count; i++ {\n        w.Write([]byte{byte('a' + i%24)})\n    }\n    w.Flush()\n    f.Close()\n    fmt.Println(\"ok\")\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>ok\nreal    0m0.159s\nuser    0m0.160s\nsys     0m0.004s\n</code></pre>\n\n<hr>\n\n<p>C:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    FILE *fp=fopen(\"data.txt\",\"w\");\n    int  size=1.024e7;\n    for(int i=0; i&lt;size; i++)\n        putc('a'+i%24,fp);\n    fclose(fp);\n    printf(\"ok\");\n    return 0;\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>ok\nreal    0m0.058s\nuser    0m0.045s\nsys     0m0.004s\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 12500354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e20dd90a26af0d240bac9fd52488811?s=128&d=identicon&r=PG&f=1", "display_name": "TianZerL", "link": "https://stackoverflow.com/users/12500354/tianzerl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 3, "accepted_answer_id": 59236393, "answer_count": 1, "score": 2, "last_activity_date": 1575815595, "creation_date": 1575814773, "last_edit_date": 1575815015, "question_id": 59236310, "link": "https://stackoverflow.com/questions/59236310/why-write-bytes-to-files-is-slow-for-go-compared-with-c", "title": "Why write bytes to files is slow for Go, compared with C", "body": "<p>I just found that write bytes to files is slow for Go.</p>\n\n<p>I want to create a 10mb file. Go takes almost 1 min to do it, but it is less than 5 seconds in C.</p>\n\n<p>This is Go code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    f, _ := os.Create(\"./src/test/test.txt\")\n    count := int(1.024e7)\n    for i := 0; i &lt; count; i++ {\n        f.Write([]byte{byte('a' + i%24)})\n    }\n    f.Close()\n    fmt.Println(\"ok\")\n}\n</code></pre>\n\n<p>And C:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    FILE *fp=fopen(\"data.txt\",\"w\");\n    int  size=1.024e7;\n    for(int i=0;i&lt;size;i++)\n        putc('a'+i%24,fp);\n    fclose(fp);\n    printf(\"ok\");\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1575812830, "post_id": 59235575, "comment_id": 104683748, "body": "When a slice extends beyond the capacity of the underlying array, a underlying array is allocated and the contents copied."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1575815987, "post_id": 59235575, "comment_id": 104684530, "body": "@Flimzy: Only for the Go <code>append</code> buit-in function."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1575816768, "post_id": 59235575, "comment_id": 104684726, "body": "@peterSO: Yes, but is there some other way to extend the capacity of a slice?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1575818042, "post_id": 59235575, "comment_id": 104685052, "body": "@Flimzy: The standard library is a good place to see how it&#39;s done. Look at the source code for the <code>bytes.Buffer</code> <code>func (b *Buffer) grow(n int) int</code> method: <a href=\"https://golang.org/src/bytes/buffer.go\" rel=\"nofollow noreferrer\">golang.org/src/bytes/buffer.go</a>. grow grows the buffer to guarantee space for n more bytes."}], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 3, "last_activity_date": 1575851982, "last_edit_date": 1575851982, "creation_date": 1575813514, "answer_id": 59236111, "question_id": 59235575, "link": "https://stackoverflow.com/questions/59235575/how-is-the-term-dynamically-sized-for-slice-justifiable-when-maximum-length-o/59236111#59236111", "title": "How is the term \u201cdynamically sized\u201d for slice justifiable, when maximum length of a slice is less than length of the underlying array?", "body": "<p>Even with a cap, a dynamic size is still dynamic: it can range between zero and whatever the cap is.</p>\n\n<p>That said, as <a href=\"https://stackoverflow.com/questions/59235575/how-is-the-term-dynamically-sized-for-slice-justifiable-when-maximum-length-o#comment104683748_59235575\">Flimzy noted in a comment</a>, if you use an operation that can \"grow\" a slice, it always returns a new slice, or takes a pointer to the slice\u2014usually the former\u2014so that the routine that needed to go past the current capacity could allocate a new, larger array<sup>1</sup> and make the slice use that instead of the old array.</p>\n\n<p>That's why <code>append</code> returns a new value, and you must write:</p>\n\n<pre><code>s = append(s, element)\n</code></pre>\n\n<p>for instance.</p>\n\n<p>(The previous underlying array, if any, is garbage collected if and when it is appropriate to do so.  A nil slice has no underlying array and hence a zero capacity.)</p>\n\n<hr>\n\n<p><sup>1</sup>The runtime uses <code>unsafe</code> and other special tricks to allocate this array, bypassing type-checking, but coordinating with the runtime's own garbage collection code.  Hence it can allocate an array whose size is chosen at runtime instead of at compile time.  The compiler's <code>new</code> and <code>make</code> and <code>append</code> built-ins have access to this same ability.</p>\n\n<p>You can write this same kind of tricky code yourself using <code>unsafe</code>, but if you do, you run the risk of having to rewrite your code when a new Go release comes out, if the new Go has changed something internally.  So, don't do that: use <code>append</code> or <code>make</code> to create the runtime-sized array with the slice data already set up for you.</p>\n"}, {"comments": [{"owner": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "edited": false, "score": 0, "creation_date": 1575818346, "post_id": 59236315, "comment_id": 104685126, "body": "This is little bit confusing. So once we do some append operation on runtime on a slice, then how does the underlying array gets dynamically re-sized? If the dynamic re-sizing happens at run time, then doesn&#39;t the new array size get assigned in run time?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "edited": false, "score": 0, "creation_date": 1575818779, "post_id": 59236315, "comment_id": 104685234, "body": "@sofs1:  If the capacity of s is not large enough to fit the additional values, append allocates a new, sufficiently large underlying array that fits both the existing slice elements and the additional values. Otherwise, append re-uses the underlying array. <a href=\"https://golang.org/ref/spec#Appending_and_copying_slices\" rel=\"nofollow noreferrer\">The Go Programming Language Specification: Appending to and copying slices</a>. This happens at runtime."}, {"owner": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "edited": false, "score": 0, "creation_date": 1575819101, "post_id": 59236315, "comment_id": 104685326, "body": "&quot;This happen at runtime&quot; contradicts to &quot;The size of a Go array is fixed at compile time&quot;. So, Can we assume that the first time array size allocation alone happens at compile time?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "edited": false, "score": 2, "creation_date": 1575819428, "post_id": 59236315, "comment_id": 104685447, "body": "@sofs1: The size of a Go array type is fixed at compile time. The Go runtime built-in <code>make</code> and <code>append</code> functions for Go slice types have special privileges. They can allocte underlying arrays dynamically at run time."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "edited": false, "score": 0, "creation_date": 1575819693, "post_id": 59236315, "comment_id": 104685520, "body": "@sofs1: I have added two useful references to my answer."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1575819660, "last_edit_date": 1575819660, "creation_date": 1575814816, "answer_id": 59236315, "question_id": 59235575, "link": "https://stackoverflow.com/questions/59235575/how-is-the-term-dynamically-sized-for-slice-justifiable-when-maximum-length-o/59236315#59236315", "title": "How is the term \u201cdynamically sized\u201d for slice justifiable, when maximum length of a slice is less than length of the underlying array?", "body": "<p>The size of a Go array is fixed at compile time. The size of a Go slice is set dynamically at runtime.</p>\n\n<hr>\n\n<p>References:</p>\n\n<p><a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">The Go Blog: Go Slices: usage and internals</a></p>\n\n<p><a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">The Go Blog: Arrays, slices (and strings): The mechanics of 'append'</a></p>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": -2, "last_activity_date": 1575904324, "creation_date": 1575904324, "answer_id": 59251700, "question_id": 59235575, "link": "https://stackoverflow.com/questions/59235575/how-is-the-term-dynamically-sized-for-slice-justifiable-when-maximum-length-o/59251700#59251700", "title": "How is the term \u201cdynamically sized\u201d for slice justifiable, when maximum length of a slice is less than length of the underlying array?", "body": "<blockquote>\n  <p>How can the slice be called as dynamically sized when it cannot go beyond the size of the underlying array.</p>\n</blockquote>\n\n<p>The <em>types</em> are static vs dynamic. An array type is like <code>[4]byte</code> - the size is part of the type definition, and therefore set at compile time. Only a <code>[4]byte</code> can be stored in a variable of type <code>[4]byte</code>. Not a <code>[3]byte</code>, not a <code>[5]byte</code>. It's static.</p>\n\n<p>A slice type is like <code>[]byte</code> - the size isn't part of the type definition, so it is not set at compile time, and a slice of <em>any size</em> can be stored in a <code>[]byte</code> at runtime. It could be zero-length, it could be a thousand, it could be a four-byte window into a million-length array. It's dynamic.</p>\n\n<p>The size of a slice can also shrink and grow within its capacity at runtime, though the capacity can only change by replacing the underlying array (which, being an array, is of fixed size). This is done automatically behind the scenes by <code>append</code>, for example. But, to my understanding at least, this is <em>not</em> what makes slices \"dynamic\"; it's the fact that a slice can be of any size at runtime - it is not known at compile time. That is what defines them as \"dynamic\" to me.</p>\n"}], "owner": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 1, "answer_count": 3, "score": -1, "last_activity_date": 1575904324, "creation_date": 1575809706, "last_edit_date": 1575812878, "question_id": 59235575, "link": "https://stackoverflow.com/questions/59235575/how-is-the-term-dynamically-sized-for-slice-justifiable-when-maximum-length-o", "title": "How is the term \u201cdynamically sized\u201d for slice justifiable, when maximum length of a slice is less than length of the underlying array?", "body": "<p>From <a href=\"https://tour.golang.org/moretypes/7\" rel=\"nofollow noreferrer\">A Tour of Go</a>:</p>\n\n<blockquote>\n  <p>An array has a fixed size. A slice, on the other hand, is a dynamically-sized, flexible view into the elements of an array.</p>\n</blockquote>\n\n<p>How can the slice be called as dynamically sized when it cannot go beyond the size of the underlying array.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "is_accepted": false, "score": 2, "last_activity_date": 1575830120, "creation_date": 1575830120, "answer_id": 59238644, "question_id": 59235415, "link": "https://stackoverflow.com/questions/59235415/protobuf-tutorial-addressbook-does-not-implement-github-com-gogo-protobuf-pro/59238644#59238644", "title": "ProtoBuf tutorial: &quot;AddressBook does not implement &quot;github.com/gogo/protobuf/proto&quot;.Message (ProtoMessage method has pointer receiver)&quot;", "body": "<p>You need to pass a pointer to proto.Marshal() either do <code>proto.Marshal(&amp;book)</code> or create pointer already before when you create the book like this:</p>\n\n<pre><code>book := &amp;addressbook.AddressBook{\n             People: []*addressbook.Person{&amp;person},\n        }\n</code></pre>\n\n<p>see the &amp; in the first line</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 14045274, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df8d3d3c3aa4a5905c75e15978832a13?s=128&d=identicon&r=PG&f=1", "display_name": "Yosep", "link": "https://stackoverflow.com/users/14045274/yosep"}, "is_accepted": false, "score": 0, "last_activity_date": 1596508324, "last_edit_date": 1596508324, "creation_date": 1596507749, "answer_id": 63239359, "question_id": 59235415, "link": "https://stackoverflow.com/questions/59235415/protobuf-tutorial-addressbook-does-not-implement-github-com-gogo-protobuf-pro/63239359#63239359", "title": "ProtoBuf tutorial: &quot;AddressBook does not implement &quot;github.com/gogo/protobuf/proto&quot;.Message (ProtoMessage method has pointer receiver)&quot;", "body": "<p>It's a problem from API version.</p>\n<p><a href=\"https://blog.golang.org/protobuf-apiv2\" rel=\"nofollow noreferrer\">From the go blog</a></p>\n<blockquote>\n<p>The github.com/golang/protobuf module is APIv1. The google.golang.org/protobuf module is APIv2. We have taken advantage of the need to change the import path to switch to one that is not tied to a specific hosting provider. (We considered google.golang.org/protobuf/v2, to make it clear that this is the second major version of the API, but settled on the shorter path as being the better choice in the long term.)</p>\n</blockquote>\n<p>Therefore, to run your code simply, use &quot;github.com/golang/protobuf/proto&quot; instead of &quot;github.com/gogo/protobuf/proto&quot; for marshal function. The problem is from a new api protoreflect. See article.</p>\n<p>You have an option to use &quot;google.golang.org/protobuf&quot; but my suggestion is to use &quot;github.com/golang/protobuf/proto&quot;. You can read more about the difference of the two <a href=\"https://developers.google.com/protocol-buffers/docs/reference/go/faq\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 929, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1596508324, "creation_date": 1575808371, "question_id": 59235415, "link": "https://stackoverflow.com/questions/59235415/protobuf-tutorial-addressbook-does-not-implement-github-com-gogo-protobuf-pro", "title": "ProtoBuf tutorial: &quot;AddressBook does not implement &quot;github.com/gogo/protobuf/proto&quot;.Message (ProtoMessage method has pointer receiver)&quot;", "body": "<p>I'm trying to follow along with this tutorial on ProtoBufs: <a href=\"https://developers.google.com/protocol-buffers/docs/gotutorial\" rel=\"nofollow noreferrer\">https://developers.google.com/protocol-buffers/docs/gotutorial</a>. I have the following project structure:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 addressbook\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 addressbook.pb.go\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 addressbook.proto\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 go.sum\n\u2514\u2500\u2500 main.go\n</code></pre>\n\n<p>where <code>addressbook.proto</code> is</p>\n\n<pre><code>syntax = \"proto3\";\npackage addressbook;\n\nimport \"google/protobuf/timestamp.proto\";\n\nmessage Person {\n    string name = 1;\n    int32 id = 2;\n    string email = 3;\n\n    enum PhoneType {\n        MOBILE = 0;\n        HOME = 1;\n        WORK = 2;\n    }\n\n    message PhoneNumber {\n        string number = 1;\n        PhoneType type = 2;\n    }\n\n    repeated PhoneNumber phones = 4;\n\n    google.protobuf.Timestamp last_updated = 5;\n}\n\nmessage AddressBook {\n    repeated Person people = 1;\n}\n</code></pre>\n\n<p>and the auto-generated (with <code>protoc addressbook.proto --go-out=.</code>) <code>addressbook.pb.go</code> reads</p>\n\n<pre><code>// Code generated by protoc-gen-go. DO NOT EDIT.\n// source: addressbook.proto\n\npackage addressbook\n\nimport (\n    fmt \"fmt\"\n    proto \"github.com/golang/protobuf/proto\"\n    timestamp \"github.com/golang/protobuf/ptypes/timestamp\"\n    math \"math\"\n)\n\n// Reference imports to suppress errors if they are not otherwise used.\nvar _ = proto.Marshal\nvar _ = fmt.Errorf\nvar _ = math.Inf\n\n// This is a compile-time assertion to ensure that this generated file\n// is compatible with the proto package it is being compiled against.\n// A compilation error at this line likely means your copy of the\n// proto package needs to be updated.\nconst _ = proto.ProtoPackageIsVersion3 // please upgrade the proto package\n\ntype Person_PhoneType int32\n\nconst (\n    Person_MOBILE Person_PhoneType = 0\n    Person_HOME   Person_PhoneType = 1\n    Person_WORK   Person_PhoneType = 2\n)\n\nvar Person_PhoneType_name = map[int32]string{\n    0: \"MOBILE\",\n    1: \"HOME\",\n    2: \"WORK\",\n}\n\nvar Person_PhoneType_value = map[string]int32{\n    \"MOBILE\": 0,\n    \"HOME\":   1,\n    \"WORK\":   2,\n}\n\nfunc (x Person_PhoneType) String() string {\n    return proto.EnumName(Person_PhoneType_name, int32(x))\n}\n\nfunc (Person_PhoneType) EnumDescriptor() ([]byte, []int) {\n    return fileDescriptor_1eb1a68c9dd6d429, []int{0, 0}\n}\n\ntype Person struct {\n    Name                 string                `protobuf:\"bytes,1,opt,name=name,proto3\" json:\"name,omitempty\"`\n    Id                   int32                 `protobuf:\"varint,2,opt,name=id,proto3\" json:\"id,omitempty\"`\n    Email                string                `protobuf:\"bytes,3,opt,name=email,proto3\" json:\"email,omitempty\"`\n    Phones               []*Person_PhoneNumber `protobuf:\"bytes,4,rep,name=phones,proto3\" json:\"phones,omitempty\"`\n    LastUpdated          *timestamp.Timestamp  `protobuf:\"bytes,5,opt,name=last_updated,json=lastUpdated,proto3\" json:\"last_updated,omitempty\"`\n    XXX_NoUnkeyedLiteral struct{}              `json:\"-\"`\n    XXX_unrecognized     []byte                `json:\"-\"`\n    XXX_sizecache        int32                 `json:\"-\"`\n}\n\nfunc (m *Person) Reset()         { *m = Person{} }\nfunc (m *Person) String() string { return proto.CompactTextString(m) }\nfunc (*Person) ProtoMessage()    {}\nfunc (*Person) Descriptor() ([]byte, []int) {\n    return fileDescriptor_1eb1a68c9dd6d429, []int{0}\n}\n\nfunc (m *Person) XXX_Unmarshal(b []byte) error {\n    return xxx_messageInfo_Person.Unmarshal(m, b)\n}\nfunc (m *Person) XXX_Marshal(b []byte, deterministic bool) ([]byte, error) {\n    return xxx_messageInfo_Person.Marshal(b, m, deterministic)\n}\nfunc (m *Person) XXX_Merge(src proto.Message) {\n    xxx_messageInfo_Person.Merge(m, src)\n}\nfunc (m *Person) XXX_Size() int {\n    return xxx_messageInfo_Person.Size(m)\n}\nfunc (m *Person) XXX_DiscardUnknown() {\n    xxx_messageInfo_Person.DiscardUnknown(m)\n}\n\nvar xxx_messageInfo_Person proto.InternalMessageInfo\n\nfunc (m *Person) GetName() string {\n    if m != nil {\n        return m.Name\n    }\n    return \"\"\n}\n\nfunc (m *Person) GetId() int32 {\n    if m != nil {\n        return m.Id\n    }\n    return 0\n}\n\nfunc (m *Person) GetEmail() string {\n    if m != nil {\n        return m.Email\n    }\n    return \"\"\n}\n\nfunc (m *Person) GetPhones() []*Person_PhoneNumber {\n    if m != nil {\n        return m.Phones\n    }\n    return nil\n}\n\nfunc (m *Person) GetLastUpdated() *timestamp.Timestamp {\n    if m != nil {\n        return m.LastUpdated\n    }\n    return nil\n}\n\ntype Person_PhoneNumber struct {\n    Number               string           `protobuf:\"bytes,1,opt,name=number,proto3\" json:\"number,omitempty\"`\n    Type                 Person_PhoneType `protobuf:\"varint,2,opt,name=type,proto3,enum=addressbook.Person_PhoneType\" json:\"type,omitempty\"`\n    XXX_NoUnkeyedLiteral struct{}         `json:\"-\"`\n    XXX_unrecognized     []byte           `json:\"-\"`\n    XXX_sizecache        int32            `json:\"-\"`\n}\n\nfunc (m *Person_PhoneNumber) Reset()         { *m = Person_PhoneNumber{} }\nfunc (m *Person_PhoneNumber) String() string { return proto.CompactTextString(m) }\nfunc (*Person_PhoneNumber) ProtoMessage()    {}\nfunc (*Person_PhoneNumber) Descriptor() ([]byte, []int) {\n    return fileDescriptor_1eb1a68c9dd6d429, []int{0, 0}\n}\n\nfunc (m *Person_PhoneNumber) XXX_Unmarshal(b []byte) error {\n    return xxx_messageInfo_Person_PhoneNumber.Unmarshal(m, b)\n}\nfunc (m *Person_PhoneNumber) XXX_Marshal(b []byte, deterministic bool) ([]byte, error) {\n    return xxx_messageInfo_Person_PhoneNumber.Marshal(b, m, deterministic)\n}\nfunc (m *Person_PhoneNumber) XXX_Merge(src proto.Message) {\n    xxx_messageInfo_Person_PhoneNumber.Merge(m, src)\n}\nfunc (m *Person_PhoneNumber) XXX_Size() int {\n    return xxx_messageInfo_Person_PhoneNumber.Size(m)\n}\nfunc (m *Person_PhoneNumber) XXX_DiscardUnknown() {\n    xxx_messageInfo_Person_PhoneNumber.DiscardUnknown(m)\n}\n\nvar xxx_messageInfo_Person_PhoneNumber proto.InternalMessageInfo\n\nfunc (m *Person_PhoneNumber) GetNumber() string {\n    if m != nil {\n        return m.Number\n    }\n    return \"\"\n}\n\nfunc (m *Person_PhoneNumber) GetType() Person_PhoneType {\n    if m != nil {\n        return m.Type\n    }\n    return Person_MOBILE\n}\n\ntype AddressBook struct {\n    People               []*Person `protobuf:\"bytes,1,rep,name=people,proto3\" json:\"people,omitempty\"`\n    XXX_NoUnkeyedLiteral struct{}  `json:\"-\"`\n    XXX_unrecognized     []byte    `json:\"-\"`\n    XXX_sizecache        int32     `json:\"-\"`\n}\n\nfunc (m *AddressBook) Reset()         { *m = AddressBook{} }\nfunc (m *AddressBook) String() string { return proto.CompactTextString(m) }\nfunc (*AddressBook) ProtoMessage()    {}\nfunc (*AddressBook) Descriptor() ([]byte, []int) {\n    return fileDescriptor_1eb1a68c9dd6d429, []int{1}\n}\n\nfunc (m *AddressBook) XXX_Unmarshal(b []byte) error {\n    return xxx_messageInfo_AddressBook.Unmarshal(m, b)\n}\nfunc (m *AddressBook) XXX_Marshal(b []byte, deterministic bool) ([]byte, error) {\n    return xxx_messageInfo_AddressBook.Marshal(b, m, deterministic)\n}\nfunc (m *AddressBook) XXX_Merge(src proto.Message) {\n    xxx_messageInfo_AddressBook.Merge(m, src)\n}\nfunc (m *AddressBook) XXX_Size() int {\n    return xxx_messageInfo_AddressBook.Size(m)\n}\nfunc (m *AddressBook) XXX_DiscardUnknown() {\n    xxx_messageInfo_AddressBook.DiscardUnknown(m)\n}\n\nvar xxx_messageInfo_AddressBook proto.InternalMessageInfo\n\nfunc (m *AddressBook) GetPeople() []*Person {\n    if m != nil {\n        return m.People\n    }\n    return nil\n}\n\nfunc init() {\n    proto.RegisterEnum(\"addressbook.Person_PhoneType\", Person_PhoneType_name, Person_PhoneType_value)\n    proto.RegisterType((*Person)(nil), \"addressbook.Person\")\n    proto.RegisterType((*Person_PhoneNumber)(nil), \"addressbook.Person.PhoneNumber\")\n    proto.RegisterType((*AddressBook)(nil), \"addressbook.AddressBook\")\n}\n\nfunc init() { proto.RegisterFile(\"addressbook.proto\", fileDescriptor_1eb1a68c9dd6d429) }\n\nvar fileDescriptor_1eb1a68c9dd6d429 = []byte{\n    // 309 bytes of a gzipped FileDescriptorProto\n    0x1f, 0x8b, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0xff, 0x74, 0x90, 0x41, 0x4b, 0xc3, 0x40,\n    0x10, 0x85, 0x4d, 0x9a, 0x06, 0x3b, 0x91, 0x52, 0x47, 0x91, 0x50, 0x90, 0x86, 0x9e, 0x02, 0x85,\n    0x14, 0xeb, 0x41, 0x10, 0x3c, 0x58, 0x28, 0x28, 0x5a, 0x5b, 0x96, 0x8a, 0xde, 0x24, 0x21, 0x63,\n    0x0d, 0x4d, 0xb2, 0x4b, 0x76, 0x7b, 0xe8, 0xcf, 0xf3, 0x9f, 0x49, 0x76, 0x53, 0xe9, 0x41, 0x6f,\n    0x6f, 0x66, 0x3f, 0xde, 0xbe, 0x37, 0x70, 0x1a, 0xa7, 0x69, 0x45, 0x52, 0x26, 0x9c, 0x6f, 0x22,\n    0x51, 0x71, 0xc5, 0xd1, 0x3b, 0x58, 0xf5, 0x07, 0x6b, 0xce, 0xd7, 0x39, 0x8d, 0xf5, 0x53, 0xb2,\n    0xfd, 0x1c, 0xab, 0xac, 0x20, 0xa9, 0xe2, 0x42, 0x18, 0x7a, 0xf8, 0x6d, 0x83, 0xbb, 0xa4, 0x4a,\n    0xf2, 0x12, 0x11, 0x9c, 0x32, 0x2e, 0xc8, 0xb7, 0x02, 0x2b, 0xec, 0x30, 0xad, 0xb1, 0x0b, 0x76,\n    0x96, 0xfa, 0x76, 0x60, 0x85, 0x6d, 0x66, 0x67, 0x29, 0x9e, 0x43, 0x9b, 0x8a, 0x38, 0xcb, 0xfd,\n    0x96, 0x86, 0xcc, 0x80, 0x37, 0xe0, 0x8a, 0x2f, 0x5e, 0x92, 0xf4, 0x9d, 0xa0, 0x15, 0x7a, 0x93,\n    0x41, 0x74, 0x18, 0xcb, 0xd8, 0x47, 0xcb, 0x9a, 0x78, 0xd9, 0x16, 0x09, 0x55, 0xac, 0xc1, 0xf1,\n    0x0e, 0x4e, 0xf2, 0x58, 0xaa, 0x8f, 0xad, 0x48, 0x63, 0x45, 0xa9, 0xdf, 0x0e, 0xac, 0xd0, 0x9b,\n    0xf4, 0x23, 0x93, 0x3a, 0xda, 0xa7, 0x8e, 0x56, 0xfb, 0xd4, 0xcc, 0xab, 0xf9, 0x57, 0x83, 0xf7,\n    0xdf, 0xc1, 0x3b, 0x70, 0xc5, 0x0b, 0x70, 0x4b, 0xad, 0x9a, 0x0a, 0xcd, 0x84, 0x57, 0xe0, 0xa8,\n    0x9d, 0x20, 0x5d, 0xa3, 0x3b, 0xb9, 0xfc, 0x37, 0xdc, 0x6a, 0x27, 0x88, 0x69, 0x74, 0x38, 0x82,\n    0xce, 0xef, 0x0a, 0x01, 0xdc, 0xf9, 0x62, 0xfa, 0xf8, 0x3c, 0xeb, 0x1d, 0xe1, 0x31, 0x38, 0x0f,\n    0x8b, 0xf9, 0xac, 0x67, 0xd5, 0xea, 0x6d, 0xc1, 0x9e, 0x7a, 0xf6, 0xf0, 0x16, 0xbc, 0x7b, 0x63,\n    0x39, 0xe5, 0x7c, 0x83, 0x23, 0x70, 0x05, 0x71, 0x91, 0xd7, 0x97, 0xac, 0xaf, 0x71, 0xf6, 0xc7,\n    0x87, 0xac, 0x41, 0x12, 0x57, 0x77, 0xbc, 0xfe, 0x09, 0x00, 0x00, 0xff, 0xff, 0x9a, 0x92, 0x62,\n    0x76, 0xc9, 0x01, 0x00, 0x00,\n}\n</code></pre>\n\n<p>I'm trying this script in <code>main.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/gogo/protobuf/proto\"\n    \"github.com/kurtpeek/addressbook/addressbook\"\n    \"github.com/sirupsen/logrus\"\n)\n\nfunc main() {\n    person := addressbook.Person{\n        Name:  \"Boba Fett\",\n        Email: \"boba.fett@gmail.com\",\n        Phones: []*addressbook.Person_PhoneNumber{\n            &amp;addressbook.Person_PhoneNumber{\n                Number: \"4158666171\",\n                Type:   addressbook.Person_MOBILE,\n            },\n        },\n    }\n    book := addressbook.AddressBook{\n        People: []*addressbook.Person{&amp;person},\n    }\n\n    _, err := proto.Marshal(book)\n    if err != nil {\n        logrus.WithError(err).Fatal(\"marshal to ProtoBuf\")\n    }\n    fmt.Printf(\"%+v\\n\", person)\n}\n</code></pre>\n\n<p>The problem is that when I try to run this I get an error that <code>AddressBook</code> doesn't implement the <code>Message</code> interface:</p>\n\n<pre><code>&gt; go run main.go\n# command-line-arguments\n./main.go:26:25: cannot use book (type addressbook.AddressBook) as type \"github.com/gogo/protobuf/proto\".Message in argument to \"github.com/gogo/protobuf/proto\".Marshal:\n    addressbook.AddressBook does not implement \"github.com/gogo/protobuf/proto\".Message (ProtoMessage method has pointer receiver)\n</code></pre>\n\n<p>Going to the definition of a <code>Message</code>, I find the following interface:</p>\n\n<pre><code>// Message is implemented by generated protocol buffer messages.\ntype Message interface {\n    Reset()\n    String() string\n    ProtoMessage()\n}\n</code></pre>\n\n<p>It seems from the <code>addressbook.pg.go</code> that <code>AddressBook</code> implements all three of these methods, so I don't get why I'm getting the error message? </p>\n\n<p>Here is my <code>go.mod</code>,</p>\n\n<pre><code>module github.com/kurtpeek/addressbook\n\ngo 1.12\n\nrequire (\n    github.com/gogo/protobuf v1.3.1\n    github.com/golang/protobuf v1.3.2\n    github.com/sirupsen/logrus v1.4.2\n)\n</code></pre>\n\n<p>and here is my <code>protoc</code> version (I installed <code>protoc</code> using <code>brew install protobuf</code>):</p>\n\n<pre><code>&gt; protoc --version\nlibprotoc 3.11.1\n</code></pre>\n"}, {"tags": ["git", "go", "git-submodules", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 161, "user_id": 11339140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_oZaOqfxYFI/AAAAAAAAAAI/AAAAAAAAADw/o9Jcv0YYArU/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u0438\u0444\u043e\u0440 \u0421\u0435\u0440\u044f\u043a\u043e\u0432", "link": "https://stackoverflow.com/users/11339140/%d0%9d%d0%b8%d0%ba%d0%b8%d1%84%d0%be%d1%80-%d0%a1%d0%b5%d1%80%d1%8f%d0%ba%d0%be%d0%b2"}, "is_accepted": false, "score": 0, "last_activity_date": 1575846549, "creation_date": 1575846549, "answer_id": 59240744, "question_id": 59235029, "link": "https://stackoverflow.com/questions/59235029/how-to-modify-and-maintain-an-imported-go-dependency/59240744#59240744", "title": "How to modify and maintain an imported go dependency?", "body": "<p>If I understand you right you should fork the repo, change import paths, keep it updated with upstream and use it.</p>\n\n<p>Another option is to contribute to the third party library.</p>\n\n<p><code>replace</code> directive is more not for long-term usage but for debugging and non-standard situations.</p>\n"}], "owner": {"reputation": 620, "user_id": 576031, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/438f31234dfb64a17f9ad0466500c08a?s=128&d=identicon&r=PG", "display_name": "pauljeba", "link": "https://stackoverflow.com/users/576031/pauljeba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 128, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1575846549, "creation_date": 1575805429, "question_id": 59235029, "link": "https://stackoverflow.com/questions/59235029/how-to-modify-and-maintain-an-imported-go-dependency", "title": "How to modify and maintain an imported go dependency?", "body": "<p>In my go app(parent), I import a go library(child) through go get and copy it to the parent directory. For my use, I make some modifications in \"child\" for extending certain features. I use go module and use \"replace\" in go.mod to point to the local child(with extended features) path instead of the global $GOPATH.</p>\n\n<p>I am confused how to constantly keep the child in sync with its upstream repo, while retaining my extended features. </p>\n\n<pre><code>//App directory    \nParent.go\n--Child/ (copied from $GOPATH)\ngo.mod\n\n//go.mod\nreplace github.com/xyz/child =&gt; ./Child\n</code></pre>\n\n<p>Setting up the child as a git-submodule works well in my system. But when the repo is pulled from another system, the child picks up it's go dependencies from <code>$GOPATH</code> from past versions and doesn't map to the correct version.</p>\n\n<p>I an trying to setup git-submodule and go-module to work seamlessly for my app in any environment. I am trying to resolve this for more than a week now. Please help.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": false, "score": 1, "last_activity_date": 1575803621, "creation_date": 1575803621, "answer_id": 59234812, "question_id": 59234754, "link": "https://stackoverflow.com/questions/59234754/passing-integer-with-leading-zeroes-to-a-function-in-golang/59234812#59234812", "title": "passing integer with leading zeroes to a function in golang", "body": "<p>It is indeed the octal value, you can read more about it <a href=\"https://golang.org/ref/spec#Integer_literals\" rel=\"nofollow noreferrer\">here</a>. To be more explicit which base should be used you could also use <code>0o23</code> instead of <code>023</code></p>\n"}, {"tags": [], "owner": {"reputation": 3237, "user_id": 9741769, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4b0913fe3d348f510777caaf5540169?s=128&d=identicon&r=PG&f=1", "display_name": "Blokje5", "link": "https://stackoverflow.com/users/9741769/blokje5"}, "is_accepted": false, "score": 1, "last_activity_date": 1575803623, "creation_date": 1575803623, "answer_id": 59234813, "question_id": 59234754, "link": "https://stackoverflow.com/questions/59234754/passing-integer-with-leading-zeroes-to-a-function-in-golang/59234813#59234813", "title": "passing integer with leading zeroes to a function in golang", "body": "<p>If you look in the golang language specification, the section on <a href=\"https://golang.org/ref/spec#Integer_literals\" rel=\"nofollow noreferrer\">integer literals</a> describes this behaviour. A leading <code>0</code> is treated as an octal number.</p>\n"}], "owner": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1575803623, "creation_date": 1575803187, "question_id": 59234754, "link": "https://stackoverflow.com/questions/59234754/passing-integer-with-leading-zeroes-to-a-function-in-golang", "title": "passing integer with leading zeroes to a function in golang", "body": "<p>Please refer to my code below for understanding the problem I am describing. </p>\n\n<p>When I pass 23, the function printMe, it prints 23, whereas if I pass 023 (which is also 23) - it prints 19. </p>\n\n<p>What is the reason for this behavior? Only clue I have so far, is that this looks like the octal value 23 (octal) -> 19 (decimal). </p>\n\n<p>Thanks in advance. </p>\n\n<p><a href=\"https://play.golang.org/p/Zrkq04Nu2DV\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Zrkq04Nu2DV</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    printMe(23)\n    printMe(023)\n}\n\nfunc printMe(num int) {\n    fmt.Printf(\"%d\\n\", num)\n}\n</code></pre>\n"}, {"tags": ["go", "machine-learning", "artificial-intelligence"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11370656"}, "edited": false, "score": 0, "creation_date": 1598088575, "post_id": 59234500, "comment_id": 112348215, "body": "Hey, you got any solution regarding this?"}, {"owner": {"reputation": 608, "user_id": 13717851, "user_type": "registered", "profile_image": "https://graph.facebook.com/642866656309980/picture?type=large", "display_name": "Sayan Dey", "link": "https://stackoverflow.com/users/13717851/sayan-dey"}, "edited": false, "score": 0, "creation_date": 1598189928, "post_id": 59234500, "comment_id": 112370530, "body": "check <a href=\"https://stackoverflow.com/a/63545696/13717851\">this</a> out."}], "owner": {"reputation": 111, "user_id": 10412696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/551b0ea14f1f7576f881992998108f3d?s=128&d=identicon&r=PG&f=1", "display_name": "Emanolo78", "link": "https://stackoverflow.com/users/10412696/emanolo78"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1575801033, "creation_date": 1575801033, "question_id": 59234500, "link": "https://stackoverflow.com/questions/59234500/how-to-specify-predictor-and-predicted-variables-in-golearn", "title": "How to specify predictor and predicted variables in Golearn", "body": "<p>I want to use Golearn, which is great, as a machine learning library. I have very simple questions, for which I could not find answers, neither if the library doc, nor on Google:</p>\n\n<p><strong>How to specify the predictor and predicted variables in a fit ?</strong>\nIn a linear regression, one can compute Y = aX + b, or X = aY+b.\nHow does one specify to Golearn which column of the data set is X and which is Y ?</p>\n"}, {"tags": ["go", "grpc", "goland", "grpc-go"], "answers": [{"tags": [], "owner": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "is_accepted": false, "score": 0, "last_activity_date": 1575830458, "creation_date": 1575830458, "answer_id": 59238695, "question_id": 59234313, "link": "https://stackoverflow.com/questions/59234313/file-not-found-unable-to-import-package/59238695#59238695", "title": "file not found / unable to import package", "body": "<p>If I read this issue correct it's the same that you have. They say you have to put these files in your repository <a href=\"https://github.com/grpc-ecosystem/grpc-gateway/issues/1065#issuecomment-544241612\" rel=\"nofollow noreferrer\">https://github.com/grpc-ecosystem/grpc-gateway/issues/1065#issuecomment-544241612</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11137806"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 657, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1575830458, "creation_date": 1575799502, "last_edit_date": 1575800074, "question_id": 59234313, "link": "https://stackoverflow.com/questions/59234313/file-not-found-unable-to-import-package", "title": "file not found / unable to import package", "body": "<p>I have been following a gRPC tutorial, this works perfectly fine. The problems start when I try to add <a href=\"https://github.com/grpc-ecosystem/grpc-gateway\" rel=\"nofollow noreferrer\">https://github.com/grpc-ecosystem/grpc-gateway</a> to my project. I use the commands they give you:</p>\n\n<pre><code>go get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-grpc-gateway\ngo get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-swagger\ngo get -u github.com/golang/protobuf/protoc-gen-go\n</code></pre>\n\n<p>and I import the package in my proto:</p>\n\n<pre><code>import \"google/api/annotations.proto\";\n</code></pre>\n\n<p>I am getting an error on the line above saying \"file not found\".\nWhen I copy the files inside my project, they are found but when I run the command</p>\n\n<pre><code>protoc -I/usr/local/include -I. \\\n  -I$GOPATH/src \\\n  -I$GOPATH/src/github.com/grpc-ecosystem/grpc-gateway/third_party/googleapis \\\n  --go_out=plugins=grpc:. \\\n  path/to/your_service.proto\n</code></pre>\n\n<p>it will complain that it cannot find the files.</p>\n\n<p>Could someone please tell me the correct way on how to be able to get this grpc-gateway working properly?</p>\n\n<p>I am currently on windows with GoLand as IDE.</p>\n"}, {"tags": ["go", "kubernetes"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1575798549, "post_id": 59234194, "comment_id": 104680515, "body": "Have you attached a service account to the pod?"}, {"owner": {"reputation": 99, "user_id": 12218656, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UvVqOhSgbqk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfSPbDrm1uzqACG3jr2DFqyYlLOPA/photo.jpg?sz=128", "display_name": "Jon lib", "link": "https://stackoverflow.com/users/12218656/jon-lib"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1575799485, "post_id": 59234194, "comment_id": 104680718, "body": "@zerkms - it runs from local without service-account, is this a must to use machinary permmission in this case? if yes please provide it as answer and i\u2019ll close the question . thanks"}, {"owner": {"reputation": 318, "user_id": 1941846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97c6bd07a916977981e8846c6232a711?s=128&d=identicon&r=PG", "display_name": "debarshi", "link": "https://stackoverflow.com/users/1941846/debarshi"}, "edited": false, "score": 0, "creation_date": 1575804406, "post_id": 59234194, "comment_id": 104681788, "body": "I think it is related to kubeconfig not being set properly. Do you set KUBECONFIG environment variable?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1575833058, "post_id": 59234194, "comment_id": 104689482, "body": "@Jonlib &quot;it runs from local without service-account&quot; --- that&#39;s a weak argument. To interact with API you need a valid token. If you have created a <code>zrole</code> role - you must create a service account and attach it to a container."}], "answers": [{"comments": [{"owner": {"reputation": 99, "user_id": 12218656, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UvVqOhSgbqk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfSPbDrm1uzqACG3jr2DFqyYlLOPA/photo.jpg?sz=128", "display_name": "Jon lib", "link": "https://stackoverflow.com/users/12218656/jon-lib"}, "edited": false, "score": 0, "creation_date": 1575808178, "post_id": 59235234, "comment_id": 104682612, "body": "Thanks! you write to check the <code>automountServiceAccountToken</code> and the path to the token , could you please write how to do it from the cli ?"}, {"owner": {"reputation": 7394, "user_id": 1093508, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/745c6e48a5e09036b23b4f57caab5bec?s=128&d=identicon&r=PG", "display_name": "D&#225;vid Moln&#225;r", "link": "https://stackoverflow.com/users/1093508/d%c3%a1vid-moln%c3%a1r"}, "reply_to_user": {"reputation": 99, "user_id": 12218656, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UvVqOhSgbqk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfSPbDrm1uzqACG3jr2DFqyYlLOPA/photo.jpg?sz=128", "display_name": "Jon lib", "link": "https://stackoverflow.com/users/12218656/jon-lib"}, "edited": false, "score": 0, "creation_date": 1575811345, "post_id": 59235234, "comment_id": 104683359, "body": "By checking <code>automountServiceAccountToken</code> I mean to check your yaml files. Just look for it. If you can not find it, most likely it is enabled. The token could be checked very easily. Just &quot;exec&quot; into the pod and see if the files are there: <code>kubectl exec -it &lt;pod-name&gt; sh</code>. Then <code>ls &#47;var&#47;run&#47;secrets&#47;kubernetes.io&#47;serviceaccount&#47;token</code>."}], "tags": [], "owner": {"reputation": 7394, "user_id": 1093508, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/745c6e48a5e09036b23b4f57caab5bec?s=128&d=identicon&r=PG", "display_name": "D&#225;vid Moln&#225;r", "link": "https://stackoverflow.com/users/1093508/d%c3%a1vid-moln%c3%a1r"}, "is_accepted": true, "score": 2, "last_activity_date": 1575806969, "creation_date": 1575806969, "answer_id": 59235234, "question_id": 59234194, "link": "https://stackoverflow.com/questions/59234194/k8s-read-config-map-via-go-api/59235234#59235234", "title": "K8S Read config map via go API", "body": "<p>Check <a href=\"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#pod-v1-core\" rel=\"nofollow noreferrer\"><code>automountServiceAccountToken</code></a> in the pod spec. By default it's set to <code>true</code>, but maybe you have it disabled.</p>\n\n<p>Use the official GO client. It reads the correct configuration and tokens by default. <a href=\"https://github.com/kubernetes/client-go/blob/master/examples/in-cluster-client-configuration/main.go\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/client-go/blob/master/examples/in-cluster-client-configuration/main.go</a></p>\n\n<p>If you don't use it, then use the correct configuration:\n<a href=\"https://kubernetes.io/docs/tasks/administer-cluster/access-cluster-api/#directly-accessing-the-rest-api-1\" rel=\"nofollow noreferrer\">https://kubernetes.io/docs/tasks/administer-cluster/access-cluster-api/#directly-accessing-the-rest-api-1</a></p>\n\n<p>Check the token in the pod: <code>/var/run/secrets/kubernetes.io/serviceaccount/token</code> and use the <code>kubernetes</code> service.</p>\n"}], "owner": {"reputation": 99, "user_id": 12218656, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UvVqOhSgbqk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfSPbDrm1uzqACG3jr2DFqyYlLOPA/photo.jpg?sz=128", "display_name": "Jon lib", "link": "https://stackoverflow.com/users/12218656/jon-lib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3007, "favorite_count": 1, "accepted_answer_id": 59235234, "answer_count": 1, "score": 2, "last_activity_date": 1575806969, "creation_date": 1575798428, "question_id": 59234194, "link": "https://stackoverflow.com/questions/59234194/k8s-read-config-map-via-go-api", "title": "K8S Read config map via go API", "body": "<p>I\u2019ve a config map which I need to read from K8S via api </p>\n\n<p>I Created a cluster role</p>\n\n<pre><code>kind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: zrole\nrules:\n- apiGroups: [\"\"]\n  resources: [\"configmaps\"]\n  verbs: [\"get\", \"list\"]\n</code></pre>\n\n<p>and cluster role binding</p>\n\n<pre><code>kind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: z-role-binding\nsubjects:\n- kind: Group\n  name: system:serviceaccounts\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: ClusterRole\n  name: zrole\n\n</code></pre>\n\n<p>Config Map</p>\n\n<pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: z-config\n  namespace: fdrs\ndata:\n  avr: client1\n  fuss: xurbz\n\n</code></pre>\n\n<p>The <a href=\"https://github.com/kubernetes/client-go/blob/master/kubernetes/typed/core/v1/configmap.go\" rel=\"nofollow noreferrer\">code</a> is used like</p>\n\n<p>clientSet.CoreV1().ConfigMaps(uNamespcae)</p>\n\n<p>when I run the code locally (and provide to the the GO api the kubeconfig) I was able to get the config map data,\nHowever when I run the code inside the cluster I got error: <code>invalid token</code> , any idea what am I missing here? </p>\n"}, {"tags": ["bash", "docker", "go"], "comments": [{"owner": {"reputation": 31823, "user_id": 1960455, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/d22bdc5c04b48a9054586eb64174ea99?s=128&d=identicon&r=PG", "display_name": "t.niese", "link": "https://stackoverflow.com/users/1960455/t-niese"}, "edited": false, "score": 1, "creation_date": 1575795859, "post_id": 59233855, "comment_id": 104679956, "body": "How does the first line (the <i>shebang</i> / <i>bang</i> line <code>#!\u2026</code>) of <code>app&#47;main.sh</code> look like  ?"}, {"owner": {"reputation": 155, "user_id": 5077099, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w7MEx.jpg?s=128&g=1", "display_name": "flybox", "link": "https://stackoverflow.com/users/5077099/flybox"}, "reply_to_user": {"reputation": 31823, "user_id": 1960455, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/d22bdc5c04b48a9054586eb64174ea99?s=128&d=identicon&r=PG", "display_name": "t.niese", "link": "https://stackoverflow.com/users/1960455/t-niese"}, "edited": false, "score": 0, "creation_date": 1575797921, "post_id": 59233855, "comment_id": 104680371, "body": "It&#39;s binary, not a text bash script."}], "answers": [{"tags": [], "owner": {"reputation": 137100, "user_id": 874188, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ZcY77.png?s=128&g=1", "display_name": "tripleee", "link": "https://stackoverflow.com/users/874188/tripleee"}, "is_accepted": true, "score": 5, "last_activity_date": 1575822791, "last_edit_date": 1575822791, "creation_date": 1575817946, "answer_id": 59236770, "question_id": 59233855, "link": "https://stackoverflow.com/questions/59233855/docker-bin-sh-not-found-with-binary-go-file/59236770#59236770", "title": "Docker /bin/sh not found with binary go file", "body": "<p>I'm guessing the error message is misleading, and that the real problem is that some library or other Go runtime component is missing from inside your Docker image. Try building your app statically (which means all the things it needs will be bundled into the binary).</p>\n\n<pre><code>CGO_ENABLED=0 go build -o myapp ./main\n</code></pre>\n\n<p>(And yeah, don't call it <code>main.sh</code> if it's not a shell script. Unix doesn't care, but you are confusing the hell out of your human readers. And actually, don't call it that even if it is. You don't need to know whether <code>grep</code> is a binary, a shell script, or a Python program; the same convention makes sense for your own tools.)</p>\n"}], "owner": {"reputation": 155, "user_id": 5077099, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w7MEx.jpg?s=128&g=1", "display_name": "flybox", "link": "https://stackoverflow.com/users/5077099/flybox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3054, "favorite_count": 1, "accepted_answer_id": 59236770, "answer_count": 1, "score": 1, "last_activity_date": 1575822791, "creation_date": 1575795323, "last_edit_date": 1575813855, "question_id": 59233855, "link": "https://stackoverflow.com/questions/59233855/docker-bin-sh-not-found-with-binary-go-file", "title": "Docker /bin/sh not found with binary go file", "body": "<p>Served many pages and forums and didn't find a solution. I have the simple docker container with executable .sh file. When I build and run it from Windows - all is fine. Now trying to build it from Ubuntu 18.04 with Docker version 19.03.5.</p>\n\n<p>For rebuild use .sh script that I execute as <code>bash install.sh</code></p>\n\n<pre><code>go build -o main.sh ./main\n\ndocker stop stats\ndocker container rm stats\ndocker image rm stats\ndocker build -t stats .\ndocker run --name stats -p 8080:8080 stats\n</code></pre>\n\n<p>My Dockerfile is:</p>\n\n<pre><code>FROM alpine:3.10.1\n\nARG appPath=\"app\"\n\nRUN mkdir /app/\nCOPY main.sh /app/main.sh\nRUN chmod +x /app/main.sh\nCOPY resources  /app/resources\n\nRUN apk add --no-cache bash\nWORKDIR /app\n\nEXPOSE 8080\nCMD /bin/bash -c 'ls' &amp;&amp; /app/main.sh dev\n</code></pre>\n\n<p>The output 'install' call is the following:</p>\n\n<pre><code>bash install.sh\nstats\nstats\nUntagged: stats:latest\nSending build context to Docker daemon  38.98MB\nStep 1/10 : FROM alpine:3.10.1\n ---&gt; b7b28af77ffe\nStep 2/10 : ARG appPath=\"app\"\n ---&gt; Using cache\n ---&gt; 08baa7336701\nStep 3/10 : RUN mkdir /app/\n ---&gt; Using cache\n ---&gt; fb9870e78322\nStep 4/10 : COPY main.sh /app/main.sh\n ---&gt; Using cache\n ---&gt; 79bf713855e3\nStep 5/10 : RUN chmod +x /app/main.sh\n ---&gt; Using cache\n ---&gt; 88bf70f9c6ec\nStep 6/10 : COPY resources  /app/resources\n ---&gt; Using cache\n ---&gt; 2ebf95627a9e\nStep 7/10 : RUN apk add --no-cache bash\n ---&gt; Using cache\n ---&gt; 39cd823e7f2f\nStep 8/10 : WORKDIR /app\n ---&gt; Using cache\n ---&gt; 37e6fcea2d65\nStep 9/10 : EXPOSE 8080\n ---&gt; Using cache\n ---&gt; 4250094c65f6\nStep 10/10 : CMD /bin/bash -c 'ls' &amp;&amp; /app/main.sh dev\n ---&gt; Using cache\n ---&gt; ed41a1efb15b\nSuccessfully built ed41a1efb15b\nSuccessfully tagged stats:latest\nmain.sh\nresources\n/bin/sh: /app/main.sh: not found\n</code></pre>\n\n<p>I don't understand what is wrong. main.sh is there. If I try to execute <code>CMD /bin/bash -c 'ls' &amp;&amp; bash main.sh dev</code> then receive <code>main.sh: main.sh: cannot execute binary file</code>. </p>\n\n<p>What is wrong there and how can I fix it? </p>\n\n<p><strong>UPD:</strong></p>\n\n<p>Renamed file that this was binary and shouldn't have .sh in the end. </p>\n\n<p>And tryed again wi the following:</p>\n\n<p><code>install.sh</code></p>\n\n<pre><code>#!/bin/bash\ngo build -o myapp ./main\n\ndocker stop stats\ndocker container rm stats\ndocker image rm stats\ndocker build -t stats .\ndocker run --name stats -p 8080:8080 stats\n</code></pre>\n\n<p><code>Dockerfile</code></p>\n\n<pre><code>FROM alpine:3.10.1\n\nRUN mkdir /app/\nCOPY myapp /app/myapp\nRUN chmod +x /app/myapp\nCOPY resources  /app/resources\n\nRUN apk add --no-cache bash\nWORKDIR /app\n\nEXPOSE 8080\nCMD /bin/bash -c 'ls' &amp;&amp; ./myapp dev\n</code></pre>\n\n<p>Output was the following:</p>\n\n<pre><code>....    \nStep 9/9 : CMD /bin/bash -c 'ls' &amp;&amp; ./myapp dev\n ---&gt; Running in 52fc24d26747\nRemoving intermediate container 52fc24d26747\n ---&gt; 8d4f415e6dcd\nSuccessfully built 8d4f415e6dcd\nSuccessfully tagged stats:latest\nmyapp\nresources\n/bin/sh: ./myapp: not found\n</code></pre>\n\n<p>Tryed <code>/app/myapp</code>, <code>./myapp</code> and it doesn't work.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1575793745, "post_id": 59233560, "comment_id": 104679590, "body": "See <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Slice_types</a> - it&#39;s not at all the same, but now that the question is already closed, there&#39;s no way to add a proper description of using slices to get the effect you want."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1575793824, "post_id": 59233560, "comment_id": 104679606, "body": "@torek I have tried to do it in my answer."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1575793919, "post_id": 59233560, "comment_id": 104679628, "body": "@PumpkinSeed: what the OP might want is: <code>q := arr[:]</code> followed by <code>q = q[3:]</code>. See also <a href=\"https://stackoverflow.com/q/29110426/1256452\">stackoverflow.com/q/29110426/1256452</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1746, "user_id": 5785743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21a09b5b4639c7459d79f565db0d63da?s=128&d=identicon&r=PG&f=1", "display_name": "pr-pal", "link": "https://stackoverflow.com/users/5785743/pr-pal"}, "is_accepted": false, "score": 3, "last_activity_date": 1575793247, "creation_date": 1575793247, "answer_id": 59233643, "question_id": 59233560, "link": "https://stackoverflow.com/questions/59233560/offsetting-zero-index-in-golang-slice/59233643#59233643", "title": "Offsetting zero index in Golang slice", "body": "<p>Golang does not support pointer arithmetic since that is a source of vulnerabilities.</p>\n\n<p>References: <a href=\"https://tour.golang.org/moretypes/1\" rel=\"nofollow noreferrer\">https://tour.golang.org/moretypes/1</a></p>\n"}, {"tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": 1, "last_activity_date": 1575793344, "creation_date": 1575793344, "answer_id": 59233651, "question_id": 59233560, "link": "https://stackoverflow.com/questions/59233560/offsetting-zero-index-in-golang-slice/59233651#59233651", "title": "Offsetting zero index in Golang slice", "body": "<p>Golang does not support <code>pointer arithmetic</code> in order to increase the safety during development.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1575808948, "creation_date": 1575808948, "answer_id": 59235487, "question_id": 59233560, "link": "https://stackoverflow.com/questions/59233560/offsetting-zero-index-in-golang-slice/59235487#59235487", "title": "Offsetting zero index in Golang slice", "body": "<p>For example, using Go slices,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    array := [4]int{1, 2, 3, 4}\n    slice := array[:]\n    fmt.Printf(\"%d\\n\", slice[0]) /* 1 */\n    slice = slice[3:]\n    fmt.Printf(\"%d\\n\", slice[0]) /* 4 */\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/82pXFkHLSfd\" rel=\"nofollow noreferrer\">https://play.golang.org/p/82pXFkHLSfd</a></p>\n\n<p>Output:</p>\n\n<pre><code>1\n4\n</code></pre>\n"}], "owner": {"reputation": 471, "user_id": 589969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/743586d634a537e7466e2dd5b16e18a3?s=128&d=identicon&r=PG&f=1", "display_name": "Odinovsky", "link": "https://stackoverflow.com/users/589969/odinovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 1, "answer_count": 3, "score": -1, "last_activity_date": 1575808948, "creation_date": 1575792380, "question_id": 59233560, "link": "https://stackoverflow.com/questions/59233560/offsetting-zero-index-in-golang-slice", "title": "Offsetting zero index in Golang slice", "body": "<p>In C, we can move pointer like so:</p>\n\n<pre><code>int main()\n{\n    int array[4] = { 1, 2, 3, 4};\n    int *q;\n    q = array; \n    printf(\"%d\\n\", q[0]); /* 1 */\n    q += 3; \n    printf(\"%d\\n\", q[0]); /* 4 */\n}\n</code></pre>\n\n<p>Is there a way to do something like this in Golang?</p>\n"}, {"tags": ["docker", "go", "sdk"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 2421220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5Q2eb.jpg?s=128&g=1", "display_name": "jerrymannel", "link": "https://stackoverflow.com/users/2421220/jerrymannel"}, "is_accepted": true, "score": 0, "last_activity_date": 1575804943, "last_edit_date": 1575804943, "creation_date": 1575785614, "answer_id": 59232921, "question_id": 59232853, "link": "https://stackoverflow.com/questions/59232853/unable-to-push-images-using-go-sdk-for-docker/59232921#59232921", "title": "Unable to push images using Go SDK for Docker", "body": "<p>After spending a day behind this, I found the solution 5 mins after asking this question.</p>\n\n<p>I was giving the wrong <em>username</em> and  <em>password</em>. The <code>cli.ImagePush()</code> method doesn't return an error if the username or password is wrong.</p>\n\n<p>Modified the last lines like this, </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>pusher, err := cli.ImagePush(ctx, \"docker.io/jerrymannel/alpine:3\", types.ImagePushOptions{\n    RegistryAuth: authStr,\n})\ncheck(err)\n\ndefer pusher.Close()\nio.Copy(os.Stdout, pusher)\n</code></pre>\n\n<p>That showed the following message - </p>\n\n<pre><code>{\"errorDetail\":{\"message\":\"unauthorized: incorrect username or password\"},\"error\":\"unauthorized: incorrect username or password\"}\n</code></pre>\n\n<p>Gave the correct password and now it's working.</p>\n\n<p>[updated]</p>\n\n<p>There's an open defect for this <a href=\"https://github.com/moby/moby/issues/36253\" rel=\"nofollow noreferrer\">Defect 36253</a></p>\n\n<p>For now, here's the code for handling the error.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>pusher, err := cli.ImagePush(ctx, \"docker.io/jerrymannel/alpine:3\", types.ImagePushOptions{\n    RegistryAuth: authStr,\n})\ncheck(err)\ndefer pusher.Close()\n\ntype ErrorMessage struct {\n    Error string\n}\nvar errorMessage ErrorMessage\nbuffIOReader := bufio.NewReader(pusher)\n\nfor {\n    streamBytes, err := buffIOReader.ReadBytes('\\n')\n    if err == io.EOF {\n        break\n    }\n    json.Unmarshal(streamBytes, &amp;errorMessage)\n    if errorMessage.Error != \"\" {\n        panic(errorMessage.Error)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 2421220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5Q2eb.jpg?s=128&g=1", "display_name": "jerrymannel", "link": "https://stackoverflow.com/users/2421220/jerrymannel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "accepted_answer_id": 59232921, "answer_count": 1, "score": 0, "last_activity_date": 1575804943, "creation_date": 1575784839, "question_id": 59232853, "link": "https://stackoverflow.com/questions/59232853/unable-to-push-images-using-go-sdk-for-docker", "title": "Unable to push images using Go SDK for Docker", "body": "<p>I'm trying to push an image to Docker hub using the Go SDK library.\nPulling the image, tagging etc. works but I'm unable to push the image.</p>\n\n<p>The program also throws no errors.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"context\"\n    \"encoding/base64\"\n    \"encoding/json\"\n\n    \"github.com/docker/docker/api/types\"\n    \"github.com/docker/docker/client\"\n)\n\nfunc check(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n\nfunc main() {\n    ctx := context.Background()\n\n    cli, err := client.NewEnvClient()\n    check(err)\n\n    err = cli.ImageTag(ctx, \"alpine:3\", \"docker.io/jerrymannel/alpine:3\")\n    check(err)\n\n    authConfig := types.AuthConfig{\n        Username: \"&lt;username&gt;\",\n        Password: \"&lt;password&gt;\",\n    }\n    encodedJSON, err := json.Marshal(authConfig)\n    check(err)\n    authStr := base64.URLEncoding.EncodeToString(encodedJSON)\n\n    _, err = cli.ImagePush(ctx, \"docker.io/jerrymannel/alpine:3\", types.ImagePushOptions{\n        RegistryAuth: authStr,\n    })\n    check(err)\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32690, "user_id": 3266847, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/U0oyt.png?s=128&g=1", "display_name": "Benjamin W.", "link": "https://stackoverflow.com/users/3266847/benjamin-w"}, "edited": false, "score": 5, "creation_date": 1575784398, "post_id": 59232785, "comment_id": 104678305, "body": "Maybe it&#39;s like in math, where you can &quot;factor&quot; <code>x * a + x * b</code> to <code>x * (a + b)</code> - now replace <code>x</code> with <code>import</code>, <code>a</code> with <code>fmt</code> and <code>b</code> with <code>math</code>...? ;)"}, {"owner": {"reputation": 1885, "user_id": 6157849, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fsSjx.jpg?s=128&g=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/6157849/jesse"}, "reply_to_user": {"reputation": 32690, "user_id": 3266847, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/U0oyt.png?s=128&g=1", "display_name": "Benjamin W.", "link": "https://stackoverflow.com/users/3266847/benjamin-w"}, "edited": false, "score": 0, "creation_date": 1575784794, "post_id": 59232785, "comment_id": 104678360, "body": "I had a similar first guess, and when you lay it out like that it does seem plausible. Still just seems like a stretch of that word and not worth the confusion. Why not just &quot;multi-line import&quot; statement?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1575789972, "post_id": 59232785, "comment_id": 104678981, "body": "They wanted to define a term, and &quot;factored&quot; is the term they chose. You would have to ask them\u2014the authors of this particular part of the tutorial\u2014why they chose that particular word, to get anything definitive."}], "answers": [{"tags": [], "owner": {"reputation": 20930, "user_id": 6881240, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/dc1e27d7e9a3de2ca8e257cb7c72ff4a?s=128&d=identicon&r=PG&f=1", "display_name": "kabanus", "link": "https://stackoverflow.com/users/6881240/kabanus"}, "is_accepted": true, "score": 5, "last_activity_date": 1575793379, "creation_date": 1575793379, "answer_id": 59233657, "question_id": 59232785, "link": "https://stackoverflow.com/questions/59232785/why-is-it-called-a-factored-import-statement-in-golang/59233657#59233657", "title": "Why is it called a &quot;factored&quot; import statement in golang?", "body": "<p>The comments under the question are correct according to the documentation. See this example from <a href=\"https://golang.org/src/cmd/go/alldocs.go?h=factored#L1770\" rel=\"noreferrer\">docs</a> as a good indication:</p>\n\n<pre><code>// The leading verb can be factored out of adjacent lines to create a block,\n// like in Go imports:\n\n    require (\n        new/thing v2.3.4\n        old/thing v1.2.3\n    )\n</code></pre>\n\n<p>The comment clearly specifies <code>\"require\"</code>, a shared \"verb\", as being factored out. That is, instead of writing two lines with the word <code>require</code>, you can take it back and use parenthesis to indicate all lines in the block share this initial \"verb\". This is the same as <code>ab+ac=a(b+c)</code>, which is called factoring. I think this is indication enough for the choice of wording, a good one in my opinion.</p>\n"}, {"tags": [], "owner": {"reputation": 1746, "user_id": 5785743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21a09b5b4639c7459d79f565db0d63da?s=128&d=identicon&r=PG&f=1", "display_name": "pr-pal", "link": "https://stackoverflow.com/users/5785743/pr-pal"}, "is_accepted": false, "score": 3, "last_activity_date": 1575793666, "creation_date": 1575793666, "answer_id": 59233687, "question_id": 59232785, "link": "https://stackoverflow.com/questions/59232785/why-is-it-called-a-factored-import-statement-in-golang/59233687#59233687", "title": "Why is it called a &quot;factored&quot; import statement in golang?", "body": "<p>As mentioned in the following issue  <a href=\"https://github.com/golang/go/issues/24011\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/24011</a>, \"factored import\" is not a formal term used in golang specification.</p>\n\n<p>The go-tour developer would have come up with that term to differentiate it from the regular import statement. </p>\n\n<p>Having said that, we dont need to break our sweat on the option to choose, you can stick to the coding convention followed in your team (or stick to once option consistently across your code base)</p>\n"}], "owner": {"reputation": 1885, "user_id": 6157849, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fsSjx.jpg?s=128&g=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/6157849/jesse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 59233657, "answer_count": 2, "score": 2, "last_activity_date": 1575793666, "creation_date": 1575783857, "last_edit_date": 1575784411, "question_id": 59232785, "link": "https://stackoverflow.com/questions/59232785/why-is-it-called-a-factored-import-statement-in-golang", "title": "Why is it called a &quot;factored&quot; import statement in golang?", "body": "<p>I'm going through the \"A Tour of Go\" tutorial and got to <a href=\"https://tour.golang.org/basics/2\" rel=\"nofollow noreferrer\">this lesson</a> that states:</p>\n\n<blockquote>\n  <p>This code groups the imports into a parenthesized, \"factored\" import statement.</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"math\"\n)\n</code></pre>\n  \n  <p>You can also write multiple import statements, like:</p>\n  \n  <p><code>import \"fmt\"</code></p>\n  \n  <p><code>import \"math\"</code></p>\n  \n  <p>But it is good style to use the factored import statement.</p>\n</blockquote>\n\n<p>Does anyone know why this format is called a \"factored\" import statement? What about that format makes it \"factored\"? I've never heard that word used that way before.</p>\n"}, {"tags": ["go", "webserver", "webassembly"], "answers": [{"tags": [], "owner": {"reputation": 339, "user_id": 2852445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03167a12f5062b9b5aec927a2fef5af3?s=128&d=identicon&r=PG&f=1", "display_name": "Momchil Atanasov", "link": "https://stackoverflow.com/users/2852445/momchil-atanasov"}, "is_accepted": false, "score": 0, "last_activity_date": 1575787965, "creation_date": 1575787965, "answer_id": 59233114, "question_id": 59232223, "link": "https://stackoverflow.com/questions/59232223/go-web-server-404-page-not-found/59233114#59233114", "title": "Go web server 404 page not found", "body": "<p>I presume your project is called <code>Hello_WebAssembly</code> and you are running the <code>go run</code> command from within the folder. </p>\n\n<p>If this is the case, then your <code>http.Dir</code>invocation should be <code>http.Dir(\".\")</code> as you want to serve resources from your current directory (the Project).</p>\n"}], "owner": {"reputation": 13, "user_id": 12495049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8e597ad96c3d0f6c9dbec0da12735af?s=128&d=identicon&r=PG&f=1", "display_name": "Stephen", "link": "https://stackoverflow.com/users/12495049/stephen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 206, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1575787965, "creation_date": 1575776241, "question_id": 59232223, "link": "https://stackoverflow.com/questions/59232223/go-web-server-404-page-not-found", "title": "Go web server 404 page not found", "body": "<p>I am new to web assembly </p>\n\n<p>I write a <code>web.go</code> to server <code>index.html</code> <code>wasm_exec.js</code> <code>main.wasm</code> under directory <code>Hello_WebAssembly</code></p>\n\n<p>Then I <code>go run web.go</code> in terminal </p>\n\n<p>Then i go to localhost:8080 it reports <code>404 page not found</code></p>\n\n<p>I am following the instructions <code>https://github.com/golang/go/wiki/WebAssembly</code></p>\n\n<p>Here is my <code>web.go</code> code</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    fs := http.FileServer(http.Dir(\"Hello_WebAssembly\"))\n    http.Handle(\"/\", fs)\n\n    log.Println(\"Listening...\")\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>I don't know why </p>\n\n<p>Hope someone can help me out </p>\n\n<p>Thanks in advance </p>\n\n<p>By the way my OS is win10</p>\n"}, {"tags": ["unit-testing", "go", "testing"], "comments": [{"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1575759372, "post_id": 59230895, "comment_id": 104675065, "body": "What would a test for this function look like? I don&#39;t understand what you would try to test here."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1575760504, "post_id": 59230895, "comment_id": 104675264, "body": "I think unless there are very specific use (like having combination of <code>GOOS</code> and other build tag dependency like introduced by <code>cgo</code> or <code>GOARCH</code>), use build tag and have OS related code (including test) separated is better. Say, what sense does it make to test Linux related code on Windows?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4142722"}, "reply_to_user": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1575760621, "post_id": 59230895, "comment_id": 104675283, "body": "@mkrieger1 I doubt that this snippet is even worth testing (although code coverage is always a bonus). My question isn&#39;t specific to this piece of code - really, what I&#39;m asking is how should I deal with testing functions that rely on code that I can&#39;t easily mock. There&#39;s no easy way for me to override the value of <code>runtime.GOOS</code> , and short of running the tests across multiple platforms, I&#39;m not sure how to manage testing something that relies on that value. I could refactor code to always take the OS as a parameter - but is that the best way to do it?"}, {"owner": {"reputation": 32690, "user_id": 3266847, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/U0oyt.png?s=128&g=1", "display_name": "Benjamin W.", "link": "https://stackoverflow.com/users/3266847/benjamin-w"}, "edited": false, "score": 2, "creation_date": 1575760774, "post_id": 59230895, "comment_id": 104675308, "body": "If you supplied the OS as a parameter and then tested that, you would effectively test the <code>==</code> operator, which I don&#39;t think is very useful."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4142722"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1575761246, "post_id": 59230895, "comment_id": 104675373, "body": "@leafbebop the entire package is dependent on the CLI tool (it effectively acts as a wrapper around the functionality that the tool provides). My question is more to do with how I should go about testing code that changes behaviour depending on the OS, and whether there&#39;s an easy way to stub/mock it in tests - or whether I would have to test the package on multiple platforms."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1575796504, "creation_date": 1575796504, "answer_id": 59233966, "question_id": 59230895, "link": "https://stackoverflow.com/questions/59230895/how-should-i-handle-testing-of-a-go-function-that-uses-runtime-goos/59233966#59233966", "title": "How should I handle testing of a Go function that uses runtime.GOOS?", "body": "<blockquote>\n  <p>How should I handle testing of a Go function that uses runtime.GOOS?</p>\n</blockquote>\n\n<p>Either not at all or on a machine with the appropriate OS.\nIt really is that simple.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4142722"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1575796504, "creation_date": 1575758670, "last_edit_date": 1575760129, "question_id": 59230895, "link": "https://stackoverflow.com/questions/59230895/how-should-i-handle-testing-of-a-go-function-that-uses-runtime-goos", "title": "How should I handle testing of a Go function that uses runtime.GOOS?", "body": "<p>I'm writing a Go package that needs to interact with the Linux command line. Since the CLI tools that my code is interacting with are Linux specific, I first need to make sure that the OS is Linux, and then I can check for the presence of the CLI tools.\nMy function to test the OS is as follows:</p>\n\n<pre><code>func isLinux() bool {\n    return runtime.GOOS == \"linux\"\n}\n</code></pre>\n\n<p>Realistically, the statement within the function can only return a boolean value. The result of the boolean being true or false seems to be wholly dependent on the testing environment too - so unless I run the tests across different OSes, I have to just assume that the function would return false in a Windows environment.</p>\n\n<p>Is there a way for me to temporarily set the value of <code>runtime.GOOS</code> for the purpose of testing? </p>\n\n<p>Would passing <code>runtime.GOOS</code> to the function as a string parameter be worthwhile? It would allow me to test the function more easily (because I could pass in string literals for different OSes), but since the function is so specific, and the snippet is so small, I'm not sure whether parameterising it would be worthwhile.</p>\n\n<p><em>EDIT:</em> It's more of a hypothetical question, I'm not really sure whether it's even worth testing given the size of the function. But, when I write code that's reliant on the current OS, how should I write it to facilitate testing - should I always to take the OS as a parameter so that I can easily mock it, or is there a way for me to temporarily override the value of <code>runtime.GOOS</code>?</p>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1575748239, "post_id": 59229490, "comment_id": 104672408, "body": "Note that your code is dealing with slices, not arrays."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1575748429, "post_id": 59229490, "comment_id": 104672462, "body": "&quot;I would need to iterate over both&quot; -- Yes, this is exactly the Go way."}, {"owner": {"reputation": 703, "user_id": 905965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/addfc6b0eaca2997670088b53fd604f4?s=128&d=identicon&r=PG", "display_name": "Eyal", "link": "https://stackoverflow.com/users/905965/eyal"}, "edited": false, "score": 4, "creation_date": 1575748640, "post_id": 59229490, "comment_id": 104672507, "body": "Note that because slices are already pointers, I see no need to have a pointer to a slice in your situation."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1575748694, "post_id": 59229490, "comment_id": 104672518, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/q/12753805/13860\">stackoverflow.com/q/12753805/13860</a>"}, {"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1575750617, "post_id": 59229490, "comment_id": 104672963, "body": "It might be better to have them instead provide a function which returns, say, a string which uniquely identifies it.  If two objects provide the same string, they are equal.  Then you could use a <code>map[string]bool</code> to know if it exists in your slice - simply check if the key already exists, if not, add it to the map and add the item to the slice you will be returning."}], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1575754554, "post_id": 59230363, "comment_id": 104673980, "body": "&quot;there is no idiomatic way&quot; --- <b>the</b> idiomatic way is copy-paste."}, {"owner": {"reputation": 173, "user_id": 7012282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QFNLO.jpg?s=128&g=1", "display_name": "tuberains", "link": "https://stackoverflow.com/users/7012282/tuberains"}, "edited": false, "score": 0, "creation_date": 1575807369, "post_id": 59230363, "comment_id": 104682424, "body": "The first part sounds like an acceptable answer. But why would anyone use go in production then. This leads to unmaintainable code as the codebase grows, doesn&#39;t it?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1575827565, "post_id": 59230363, "comment_id": 104687817, "body": "Evidence shows otherwise. DRY is a perfect way too add dependencies and coupling between otherwise unrelated code. This algorithm you have, for instance, adds the second slice into the first for non-existing elements. How many of the users of this algorihtm will assume the outcome is a set (it is not if the first slice is not a set)? How many will fix it? How many other users will that fix break? Some level of repetition improves code readability and maintainability. This is just simpler when repeated. Of course, this is just opinion. If you want to see a large codebase, see k8s."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1575753923, "creation_date": 1575753923, "answer_id": 59230363, "question_id": 59229490, "link": "https://stackoverflow.com/questions/59229490/idiomatic-and-dry-solution-to-merging-arrays-of-arbitrary-types/59230363#59230363", "title": "Idiomatic and DRY solution to merging arrays of arbitrary types", "body": "<p>First: without generics, there is no idiomatic way of doing this. \nSecond: your thinking might be too influenced by other languages. You already got a function to compare, why not take it a bit further?</p>\n\n<p>What I suggest below is not efficient, and it should not be done. However, if you really want to do it:</p>\n\n<p>It looks like this is not a set union, but add the elements of the second slice to the first if they don't already exist in the first slice. To do that, you can pass two functions:</p>\n\n<pre><code>func merge(len1,len2 int, eq func(int,int)bool, write func(int)) {\n   for i2:=0;i2&lt;len2;i2++ {\n     found:=false\n     for i1:=0;i1&lt;len1;i1++ {\n        if eq(i1,i2) {\n          found=true\n          break\n        }\n     }\n     if !found {\n       write(i2)\n     }\n}\n</code></pre>\n\n<p>Above, <code>eq(i,j)</code> returns true if <code>slice1[i]==slice2[j]</code>, and <code>write(j)</code> does <code>append(result,slice2[j])</code>.</p>\n"}], "owner": {"reputation": 173, "user_id": 7012282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QFNLO.jpg?s=128&g=1", "display_name": "tuberains", "link": "https://stackoverflow.com/users/7012282/tuberains"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 59230363, "answer_count": 1, "score": -2, "last_activity_date": 1575753923, "creation_date": 1575747243, "last_edit_date": 1575748376, "question_id": 59229490, "link": "https://stackoverflow.com/questions/59229490/idiomatic-and-dry-solution-to-merging-arrays-of-arbitrary-types", "title": "Idiomatic and DRY solution to merging arrays of arbitrary types", "body": "<p>I want to create a utility-function that is able to merge two given slices, determining equality by a given function.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type IsEqualTest func(interface{}, interface{}) bool\n\nfunc ArrayMerge(one *[]interface{}, another *[]interface{}, comp IsEqualTest) *[]interface{} {\n    merged := *one\n\n    for _, element := range *another {\n        if !ArrayContains(one, &amp;element, comp) {\n            merged = append(merged, element)\n        }\n    }\n\n    return &amp;merged\n}\n\nfunc ArrayContains(container *[]interface{}, eventualContent *interface{}, comp IsEqualTest) bool {\n    for _, element := range *container {\n        if comp(element, eventualContent) {\n            return true\n        }\n    }\n\n    return false\n}\n\n// please don't mind the algorithmic flaws\n</code></pre>\n\n<p>However, as go does treat the <code>[]interface{}</code> type as non-compatible to slices of anything (and it lacks generics), I would need to iterate over both operands, converting the type of the contained elements when calling, which is not what anyone could want.</p>\n\n<p><strong>What is the Go style of dealing with collections containing any type?</strong></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1575738582, "post_id": 59228265, "comment_id": 104670151, "body": "I&#39;m not sure about <code>go doc</code> but <code>go list</code> can do something like <code>go list package&#47;prefix&#47;...</code> \u2014 note the triple-dot."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1575738915, "post_id": 59228265, "comment_id": 104670220, "body": "See <a href=\"https://stackoverflow.com/questions/28166249/how-to-list-installed-go-packages/28166550#28166550\">How to list installed go packages</a>; also <a href=\"https://stackoverflow.com/questions/55866604/whats-the-go-mod-equivalent-of-npm-outdated/55866702#55866702\">What&#39;s the Go (mod) equivalent of npm-outdated?</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1575738924, "post_id": 59228265, "comment_id": 104670222, "body": "There is no concept of &quot;under a package&quot; or &quot;sub-packages&quot; in Go, so the question doesn&#39;t really make sense."}, {"owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1575795459, "post_id": 59228265, "comment_id": 104679885, "body": "@Flimzy - how would you refer to a \u201csub-package\u201d then?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1575798765, "post_id": 59228265, "comment_id": 104680562, "body": "I don&#39;t think you understood my comment. You don&#39;t refer to a sub-package, because there are no sub-packages."}], "answers": [{"comments": [{"owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "edited": false, "score": 0, "creation_date": 1575795718, "post_id": 59228393, "comment_id": 104679932, "body": "Thank you for an exercise answer. Is it true that Go has no concept of a sub-package? How does <code>go list crypto&#47;...</code> works? Does it looks for a package called \u201ccrypto\u201d in the <code>GOPATH</code> workspace, by searching the whole directory hierarchy, and then list all sub-packages under that package?"}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "reply_to_user": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "edited": false, "score": 0, "creation_date": 1575798494, "post_id": 59228393, "comment_id": 104680501, "body": "About <code>go list</code> you can find its doc <a href=\"https://golang.org/cmd/go/#hdr-List_packages_or_modules\" rel=\"nofollow noreferrer\">here</a>.  <a href=\"https://golang.org/ref/spec#Packages\" rel=\"nofollow noreferrer\">Go spec</a> does not define sub-packages. In fact, every collection of files sharing the same package name belong to one package. Implementation may require that these files reside under the same directory. Given that subdirectories do exist, one may argue that also sub-packages exist. The <i>de facto</i> standard is that sub-packages contain low-level API whereas higher level package provide more abstract API and interfaces. <code>crypto</code> package is an example."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1575798822, "post_id": 59228393, "comment_id": 104680579, "body": "&quot;If you want to see all sub-packages&quot; -- There are no sub-packages in Go. It would be better to re-phrase this to make sense."}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1575799563, "post_id": 59228393, "comment_id": 104680742, "body": "@Flimzy, thanks for the downvote. IMHO, this is just a terminology detail and even if go spec does not exactly report the wording &quot;sub-package&quot; it does not mean that gophers cannot use this word. It conveniently refer to packages contained in one package&#39;s subdirectories."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1575799821, "post_id": 59228393, "comment_id": 104680798, "body": "It&#39;s not just terminology. It&#39;s part of the Go spec.  A sub-package implies a relationship between packages. There is no such relationship between Go packages. The <i>only</i> namespace-defined relationship between Go packages relates to the use of an <code>internal</code> package."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1575799874, "post_id": 59228393, "comment_id": 104680803, "body": "Of course people can use incorrect terms if they wish, but it&#39;s irresponsible and incorrect to encourage such misuses."}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1575800639, "post_id": 59228393, "comment_id": 104680955, "body": "Besides the fact that there is an actual relationship between one package and its &quot;sub-package&quot;, which is that the latter resides in former&#39;s subdirectories. You will find many results on Google about &quot;sub-packages&quot;. Apparently many people find it convenient to use this word. As long as the word conveys the message meant by source to destination, there is no harm in using it and is not irresponsible."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1575812921, "post_id": 59228393, "comment_id": 104683772, "body": "Again, many people use wrong terminology all the time. That&#39;s not a reason to propagate bad habits."}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1575814810, "post_id": 59228393, "comment_id": 104684228, "body": "I agree. However, in this context I don&#39;t see wrong terminology. I only see one word that is not explicitly reported in Go spec."}], "tags": [], "owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "is_accepted": true, "score": 2, "last_activity_date": 1575738578, "creation_date": 1575738578, "answer_id": 59228393, "question_id": 59228265, "link": "https://stackoverflow.com/questions/59228265/how-can-i-list-all-sub-packages-under-a-specific-go-package/59228393#59228393", "title": "How can I list all sub-packages under a specific Go package?", "body": "<p>If you want to see <em>all</em> sub-packages under a specific package you can use <code>go list</code> command:</p>\n\n<pre><code>go list crypto/...\ncrypto\ncrypto/aes\ncrypto/cipher\ncrypto/des\ncrypto/dsa\ncrypto/ecdsa\ncrypto/ed25519\ncrypto/ed25519/internal/edwards25519\ncrypto/elliptic\ncrypto/hmac\ncrypto/internal/randutil\ncrypto/internal/subtle\ncrypto/md5\ncrypto/rand\ncrypto/rc4\ncrypto/rsa\ncrypto/sha1\ncrypto/sha256\ncrypto/sha512\ncrypto/subtle\ncrypto/tls\ncrypto/x509\ncrypto/x509/pkix\n</code></pre>\n\n<p>Finally, for each package you can get the doc with <code>go doc</code> command.</p>\n\n<pre><code>go doc crypto/x509\n...\n</code></pre>\n\n<p>You can write a script if you need to iterate over the results returned by <code>go list</code>. </p>\n\n<p>Honestly, I think that the best way to consume the doc of std library is the Go website: <a href=\"https://golang.org/pkg/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/</a>.</p>\n\n<p>You can also start a local <code>godoc</code> web server to read the doc of your Go code:</p>\n\n<pre><code>godoc -http=:6060\n\n*open your browser and visit localhost:6060*\n</code></pre>\n"}], "owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "accepted_answer_id": 59228393, "answer_count": 1, "score": 0, "last_activity_date": 1575795382, "creation_date": 1575737707, "last_edit_date": 1575795382, "question_id": 59228265, "link": "https://stackoverflow.com/questions/59228265/how-can-i-list-all-sub-packages-under-a-specific-go-package", "title": "How can I list all sub-packages under a specific Go package?", "body": "<p>Is it possible to use <code>go doc</code> to view all sub-packages defined under a specific package?</p>\n\n<p>Say, I want to view all sub-packages under <code>crypto</code>. </p>\n\n<p><code>go doc crypto</code> only lists what <code>crypto</code> defines, but no information about its sub-packages, like <code>crypto/aes</code> and <code>crypto/cipher</code>: </p>\n\n<pre><code>go doc crypto\npackage crypto // import \"crypto\"\n\nPackage crypto collects common cryptographic constants.\n\nfunc RegisterHash(h Hash, f func() hash.Hash)\ntype Decrypter interface{ ... }\ntype DecrypterOpts interface{}\ntype Hash uint\n    const MD4 Hash = 1 + iota ...\n...\n</code></pre>\n"}]