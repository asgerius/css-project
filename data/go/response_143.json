[{"tags": ["go", "apache-kafka", "kafka-consumer-api", "sarama"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507162357, "post_id": 46575777, "comment_id": 80105345, "body": "where is that <i>sarama-cluster</i> client ?"}, {"owner": {"reputation": 190, "user_id": 1251028, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/be9d640f39492c3d88d07e8d3968d560?s=128&d=identicon&r=PG", "display_name": "Sagar D", "link": "https://stackoverflow.com/users/1251028/sagar-d"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507222126, "post_id": 46575777, "comment_id": 80134820, "body": "For Kafka-based tracking (Kafka 0.9 and later), use <a href=\"https://github.com/bsm/sarama-cluster\" rel=\"nofollow noreferrer\">github.com/bsm/sarama-cluster</a>. For Zookeeper-based tracking (Kafka 0.8.2 and earlier), use <a href=\"https://github.com/wvanbergen/kafka\" rel=\"nofollow noreferrer\">github.com/wvanbergen/kafka</a>. Is this what you are asking?"}], "owner": {"reputation": 190, "user_id": 1251028, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/be9d640f39492c3d88d07e8d3968d560?s=128&d=identicon&r=PG", "display_name": "Sagar D", "link": "https://stackoverflow.com/users/1251028/sagar-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 206, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1507160653, "creation_date": 1507160653, "question_id": 46575777, "link": "https://stackoverflow.com/questions/46575777/upgrading-consumers-from-zk-based-offset-storage-to-kafka-based-storage", "title": "Upgrading consumers from zk based offset storage to kafka based storage", "body": "<p>I am using Golang and Sarama client. Kafka version is 0.9 which I plan to upgrade.</p>\n\n<p>I am planning to upgrade sarama clients to latest version and use sarama-cluster instead of wvanbergen/kafka. I see that offset will be committed to kafka now.  </p>\n\n<p>On Apache Kafka page it says that for doing migration from zk based storage to kafka you need to do following:\nSet offsets.storage=kafka and dual.commit.enabled=true in your consumer config.</p>\n\n<p>There is no such property in wvanbergen/kafka library and they don't have plans to add it too. </p>\n\n<p>Has anyone performed a similar upgrade from wvanbergen/kafka to sarama-cluster without the dual.commit.enabled settings on a production system? How did you migrate offsets from zk to kafka?</p>\n"}, {"tags": ["java", "python", "go", "data-analysis", "metrics"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507198565, "post_id": 46575762, "comment_id": 80119106, "body": "<a href=\"https://prometheus.io/\" rel=\"nofollow noreferrer\">prometheus.io</a>"}, {"owner": {"reputation": 869, "user_id": 1903880, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3a7f0353e763f3e86ca839f199ebc6dd?s=128&d=identicon&r=PG", "display_name": "zhihuifan", "link": "https://stackoverflow.com/users/1903880/zhihuifan"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507264145, "post_id": 46575762, "comment_id": 80148763, "body": "Thanks @Peter,  but that&#39;s not what I want now, please see my edited version."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507284372, "post_id": 46575762, "comment_id": 80158246, "body": "<a href=\"https://github.com/etsy/skyline\" rel=\"nofollow noreferrer\">github.com/etsy/skyline</a> used to do this. It was intended for statsd and is no longer maintained, but perhaps it helps your googling efforts. Elasticsearch has something similar now (they call it machine learning) -- that is part of the commercial subscriptions though."}, {"owner": {"reputation": 869, "user_id": 1903880, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3a7f0353e763f3e86ca839f199ebc6dd?s=128&d=identicon&r=PG", "display_name": "zhihuifan", "link": "https://stackoverflow.com/users/1903880/zhihuifan"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507422731, "post_id": 46575762, "comment_id": 80203397, "body": "this is exactly what I want.  thank you.   I will search for a implemention for prometheus or an implemention with Python / Go /Java.  skylink is Python code but oculus is Ruby."}], "answers": [{"tags": [], "owner": {"reputation": 479, "user_id": 4586310, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QHwwwYJ_K8w/AAAAAAAAAAI/AAAAAAAAAaE/cDd3z2Ny0Fk/photo.jpg?sz=128", "display_name": "Jordi Mart&#237;n", "link": "https://stackoverflow.com/users/4586310/jordi-mart%c3%adn"}, "is_accepted": false, "score": 0, "last_activity_date": 1507192943, "creation_date": 1507192943, "answer_id": 46581324, "question_id": 46575762, "link": "https://stackoverflow.com/questions/46575762/metric-pattern-analysis-for-troubleshooting/46581324#46581324", "title": "Metric pattern analysis for troubleshooting", "body": "<p>I think you need some monitoring &amp; analytic services like: </p>\n\n<p>DataDog: <a href=\"https://www.datadoghq.com/\" rel=\"nofollow noreferrer\">https://www.datadoghq.com/</a></p>\n\n<p>Librato: <a href=\"https://www.librato.com/\" rel=\"nofollow noreferrer\">https://www.librato.com/</a></p>\n\n<p>etc...</p>\n\n<p>Or a self hosted infrastructure to run Graphite </p>\n\n<p>(<a href=\"https://github.com/hopsoft/docker-graphite-statsd\" rel=\"nofollow noreferrer\">https://github.com/hopsoft/docker-graphite-statsd</a>) or similar tools.</p>\n"}], "owner": {"reputation": 869, "user_id": 1903880, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3a7f0353e763f3e86ca839f199ebc6dd?s=128&d=identicon&r=PG", "display_name": "zhihuifan", "link": "https://stackoverflow.com/users/1903880/zhihuifan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1507264113, "creation_date": 1507160559, "last_edit_date": 1507264113, "question_id": 46575762, "link": "https://stackoverflow.com/questions/46575762/metric-pattern-analysis-for-troubleshooting", "title": "Metric pattern analysis for troubleshooting", "body": "<p>When I troubleshoot some site issues, I need to check many metrics like CPU, memory, application metrics and so on. generally, I want to know the following items automatically (without checking all the metrics one by one by human) :</p>\n\n<ol>\n<li>How many metrics have spikes during that time.</li>\n<li>if metric X has the same pattern with metric Y</li>\n<li>if metric X has some periodicity characters.</li>\n</ol>\n\n<p>for item 1 and 2,  I think I can get it by calculating some change rate.  for item 3, I have no idea so far.</p>\n\n<p>my questions here are:</p>\n\n<ol>\n<li>do we have some library already which can be used here, language (Go, Java, Python is ok).</li>\n<li>do you have any suggestion for requirement 3.</li>\n</ol>\n\n<p>=====</p>\n\n<p>More background here:</p>\n\n<p>I have a Prometheus(a monitor system) setup already, but my issue is I want to analyze these metrics automatically.  For example:\nUser input:\nHere are 1000 time-serial data and I have an issue on time 1 to time 2, I see metrics X has spiked during that time. \nProgram output:\nitem 1/2/3 above. </p>\n\n<p>I just have some issue during implement the program.</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3", "aws-sdk"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1507156311, "post_id": 46575011, "comment_id": 80103868, "body": "my google foo says  <a href=\"https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/s3-example-presigned-urls.html\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/sdk-for-go/v1/developer-guide/&hellip;</a>"}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1507186203, "post_id": 46575011, "comment_id": 80111752, "body": "I expanded my answer with how to get get non pre signed urls."}], "answers": [{"comments": [{"owner": {"reputation": 779, "user_id": 983914, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/b142828ad59326a7ff64e7c782cd403f?s=128&d=identicon&r=PG", "display_name": "oleynikd", "link": "https://stackoverflow.com/users/983914/oleynikd"}, "edited": false, "score": 0, "creation_date": 1507189116, "post_id": 46575239, "comment_id": 80113355, "body": "Thanks. I ended up with this: <code>fmt.Sprintf(&quot;https:&#47;&#47;s3-%s.amazonaws.com&#47;%s&#47;%s&quot;, region, bucket, key)</code>. Also there&#39;s a problem with the key (url path) as it can contain unescaped characters like semicolons, etc... That&#39;s why there&#39;s a separate method in Java SDK..."}], "tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": true, "score": 7, "last_activity_date": 1507185892, "last_edit_date": 1507185892, "creation_date": 1507156805, "answer_id": 46575239, "question_id": 46575011, "link": "https://stackoverflow.com/questions/46575011/how-to-get-resource-url-from-aws-s3-in-a-golang/46575239#46575239", "title": "How to get resource URL from AWS S3 in a golang", "body": "<p>This is how you get presigned URLs using the go sdk:</p>\n\n<pre><code>func GetFileLink(key string) (string, error) {\n    svc := s3.New(some params)\n\n    params := &amp;s3.GetObjectInput{\n        Bucket: aws.String(a bucket name),\n        Key:    aws.String(key),\n    }\n\n    req, _ := svc.GetObjectRequest(params)\n\n    url, err := req.Presign(15 * time.Minute) // Set link expiration time\n    if err != nil {\n        global.Log(\"[AWS GET LINK]:\", params, err)\n    }\n\n    return url, err\n}\n</code></pre>\n\n<p>If what you want is just the URL of a public access object you can build the URL yourself:</p>\n\n<pre><code>https://&lt;region&gt;.amazonaws.com/&lt;bucket-name&gt;/&lt;key&gt;\n</code></pre>\n\n<p>Where  is something like <code>us-east-2</code>. So using go it will be something like:</p>\n\n<pre><code>url := \"https://%s.amazonaws.com/%s/%s\"\nurl = fmt.Sprintf(url, \"us-east-2\", \"my-bucket-name\", \"some-file.txt\")\n</code></pre>\n\n<p><a href=\"http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region\" rel=\"noreferrer\">Here</a> is a list of all the available regions for S3.</p>\n"}], "owner": {"reputation": 779, "user_id": 983914, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/b142828ad59326a7ff64e7c782cd403f?s=128&d=identicon&r=PG", "display_name": "oleynikd", "link": "https://stackoverflow.com/users/983914/oleynikd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5613, "favorite_count": 1, "accepted_answer_id": 46575239, "answer_count": 1, "score": 1, "last_activity_date": 1507185892, "creation_date": 1507155371, "question_id": 46575011, "link": "https://stackoverflow.com/questions/46575011/how-to-get-resource-url-from-aws-s3-in-a-golang", "title": "How to get resource URL from AWS S3 in a golang", "body": "<p>I need to get public permanent (not signed) URL of a resource using golang and <a href=\"https://github.com/aws/aws-sdk-go\" rel=\"nofollow noreferrer\">official aws go sdk</a>. In Java AWS S3 SDK there's a method called <a href=\"http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/AmazonS3Client.html#getResourceUrl-java.lang.String-java.lang.String-\" rel=\"nofollow noreferrer\"><code>getResourceUrl()</code></a> what's the equivalent in go?</p>\n"}, {"tags": ["php", "wordpress", "go", "routes", "google-cloud-platform"], "answers": [{"tags": [], "owner": {"reputation": 7568, "user_id": 3645370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZfsLt.png?s=128&g=1", "display_name": "David", "link": "https://stackoverflow.com/users/3645370/david"}, "is_accepted": true, "score": 1, "last_activity_date": 1507141550, "creation_date": 1507141550, "answer_id": 46571736, "question_id": 46571068, "link": "https://stackoverflow.com/questions/46571068/http-route-url-parts-to-different-server/46571736#46571736", "title": "http route url parts to different server", "body": "<p>The choice of options depends on which compute system you are using:</p>\n\n<ul>\n<li><p>Google App Engine - GAE has build in <a href=\"https://cloud.google.com/appengine/docs/standard/php/how-requests-are-routed#routing_via_url\" rel=\"nofollow noreferrer\">request routing</a> which allows you to have different URLs served by different \"modules\" or \"versions\".</p></li>\n<li><p>Google Compute Engine - on GCE you can use Cloud HTTP Load Balancing to do <a href=\"https://cloud.google.com/compute/docs/load-balancing/http/content-based-example\" rel=\"nofollow noreferrer\">Content-Based Load Balancing</a> to send different paths to different instance groups.</p></li>\n<li><p>Google Container Engine - on GKE you can create an <a href=\"https://kubernetes.io/docs/concepts/services-networking/ingress/\" rel=\"nofollow noreferrer\">Ingress with fanout</a>, to send different paths to different pods.</p></li>\n</ul>\n"}], "owner": {"reputation": 99, "user_id": 731908, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f96aa3f33636ae7df5c73d687cbbd695?s=128&d=identicon&r=PG", "display_name": "Wieknot", "link": "https://stackoverflow.com/users/731908/wieknot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 46571736, "answer_count": 1, "score": 0, "last_activity_date": 1507142403, "creation_date": 1507139175, "last_edit_date": 1507142403, "question_id": 46571068, "link": "https://stackoverflow.com/questions/46571068/http-route-url-parts-to-different-server", "title": "http route url parts to different server", "body": "<p>I'm not sure what the correct verbiage is for this question, but here it goes.</p>\n\n<p>I want to set up two web applications. One is based on golang and the other is apache/php (wordpress)</p>\n\n<p>These applications will be hosted as separate google cloud platform API engines.</p>\n\n<p>I would like these to be published under the same domain, so for example the main golang app URL would be www.mygolangapp.com and the wordpress url would be www.mygolangapp.com/blog</p>\n\n<p>I'm thinking I may need to setup a google VPC network. Could anyone confirm this, and/or provide better options? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7927, "user_id": 5214807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aq31b.jpg?s=128&g=1", "display_name": "Saleem", "link": "https://stackoverflow.com/users/5214807/saleem"}, "edited": false, "score": 2, "creation_date": 1507137640, "post_id": 46570617, "comment_id": 80094903, "body": "The intention of <code>go run</code> is to execute application without storing of final executable on disk. That&#39;s the reason, it generates executable in temporary location and once done, file is ready to be disposed off."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1507153902, "post_id": 46570617, "comment_id": 80103039, "body": "<code>go run</code> just executes <code>go build -o</code> with a temp path, executes the binary, then deletes it. If you don&#39;t want to do that, then don&#39;t use <code>go run</code>."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 7, "last_activity_date": 1507137544, "creation_date": 1507137544, "answer_id": 46570645, "question_id": 46570617, "link": "https://stackoverflow.com/questions/46570617/how-to-change-default-path-to-store-executable-in-go-compiler/46570645#46570645", "title": "How to change default path to store executable in Go compiler?", "body": "<p>If you want to do something with the binary beyond just running it once, you should be using <code>go build</code>, not <code>go run</code>. <code>go build</code> will put the binary in the current working directory.</p>\n"}, {"tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": false, "score": 2, "last_activity_date": 1507154152, "creation_date": 1507154152, "answer_id": 46574788, "question_id": 46570617, "link": "https://stackoverflow.com/questions/46570617/how-to-change-default-path-to-store-executable-in-go-compiler/46574788#46574788", "title": "How to change default path to store executable in Go compiler?", "body": "<p>I agree with @Adrian and @Saleem, however, for interest sake, you can override the location (somewhat) by changing the location of your environment variable <code>TEMP</code> (or <code>TMPDIR</code> on OSX or Linux).  This will still create a temporary directory in whatever directory you specify, in which the working files will be placed.  Keep in mind that as Adrian and Saleem say, <code>go run</code> is intended for temporary runs.</p>\n\n<p>And of course @JimB beat me to it with his comment which is really the essence of what I'm saying here.</p>\n"}, {"tags": [], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "is_accepted": false, "score": 1, "last_activity_date": 1507186761, "creation_date": 1507186761, "answer_id": 46579672, "question_id": 46570617, "link": "https://stackoverflow.com/questions/46570617/how-to-change-default-path-to-store-executable-in-go-compiler/46579672#46579672", "title": "How to change default path to store executable in Go compiler?", "body": "<p>Agree with previous answers. <code>go install</code> saves binary file into <code>GOBIN</code> folder. So you may change it to have a specific location. However, I don't suggest to do it, because you can always build into specific folder using <code>-o</code> option of <code>go build</code>:</p>\n\n<pre><code>go build -o /usr/bin/app main.go\n</code></pre>\n"}], "owner": {"reputation": 746, "user_id": 3162146, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4746642a3bfbcb4833362d14f14d9fed?s=128&d=identicon&r=PG", "display_name": "coolgoose", "link": "https://stackoverflow.com/users/3162146/coolgoose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1317, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1507186761, "creation_date": 1507137425, "question_id": 46570617, "link": "https://stackoverflow.com/questions/46570617/how-to-change-default-path-to-store-executable-in-go-compiler", "title": "How to change default path to store executable in Go compiler?", "body": "<p>In Go compiler, when I do \"go run\", executable file is stored to a temporary location. How to change this path to store the file in current working directory? I am using windows 7 64bit machine.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 746, "user_id": 3162146, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4746642a3bfbcb4833362d14f14d9fed?s=128&d=identicon&r=PG", "display_name": "coolgoose", "link": "https://stackoverflow.com/users/3162146/coolgoose"}, "edited": false, "score": 0, "creation_date": 1507137747, "post_id": 46570586, "comment_id": 80094965, "body": "Thanks! what is default name of the executable?"}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "reply_to_user": {"reputation": 746, "user_id": 3162146, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4746642a3bfbcb4833362d14f14d9fed?s=128&d=identicon&r=PG", "display_name": "coolgoose", "link": "https://stackoverflow.com/users/3162146/coolgoose"}, "edited": false, "score": 0, "creation_date": 1507137838, "post_id": 46570586, "comment_id": 80095009, "body": "The same as run file. In your case it is <code>file</code>."}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 3, "last_activity_date": 1507137328, "creation_date": 1507137328, "answer_id": 46570586, "question_id": 46570517, "link": "https://stackoverflow.com/questions/46570517/where-is-executable-stored-after-go-run-file-go-command/46570586#46570586", "title": "Where is executable stored after &quot;go run file.go&quot; command?", "body": "<p>In the <code>/tmp</code> folder, if you're using unix machine.</p>\n\n<p>In the <code>\\Users\\SomeUser\\AppData\\Local\\Temp\\</code> if you're on windows.</p>\n"}, {"tags": [], "owner": {"reputation": 493, "user_id": 6111465, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/72fJG.png?s=128&g=1", "display_name": "gammazero", "link": "https://stackoverflow.com/users/6111465/gammazero"}, "is_accepted": false, "score": 2, "last_activity_date": 1507338729, "last_edit_date": 1507338729, "creation_date": 1507333046, "answer_id": 46615240, "question_id": 46570517, "link": "https://stackoverflow.com/questions/46570517/where-is-executable-stored-after-go-run-file-go-command/46615240#46615240", "title": "Where is executable stored after &quot;go run file.go&quot; command?", "body": "<p>In Go 1.8 or later, use <a href=\"https://golang.org/pkg/os/#Executable\" rel=\"nofollow noreferrer\">os.Executable</a> to see where your executable is located:</p>\n\n<pre><code>exePath, err := os.Executable()\nif err != nil {\n    fmt.Println(\"Failed to get executable path:\", err)\n} else {\n    fmt.Println(\"Executable:\", exePath)\n}\n</code></pre>\n\n<p><code>go run myprog.go</code></p>\n\n<p><code>Executable: /tmp/go-build260998498/command-line-arguments/_obj/exe/myprog</code></p>\n"}], "owner": {"reputation": 746, "user_id": 3162146, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4746642a3bfbcb4833362d14f14d9fed?s=128&d=identicon&r=PG", "display_name": "coolgoose", "link": "https://stackoverflow.com/users/3162146/coolgoose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 46570586, "answer_count": 2, "score": -2, "last_activity_date": 1507338729, "creation_date": 1507137081, "question_id": 46570517, "link": "https://stackoverflow.com/questions/46570517/where-is-executable-stored-after-go-run-file-go-command", "title": "Where is executable stored after &quot;go run file.go&quot; command?", "body": "<p>Where does go compiler store the executable file after executing following command?</p>\n\n<pre><code>$&gt; go run file.go\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": false, "score": 6, "last_activity_date": 1507134982, "creation_date": 1507134982, "answer_id": 46569921, "question_id": 46569874, "link": "https://stackoverflow.com/questions/46569874/how-to-get-an-integer-result-from-the-math-floor-function-in-golang/46569921#46569921", "title": "How to get an integer result from the math floor function in golang?", "body": "<p>You can compare the float64 value with <code>math.MaxInt64</code> or <code>math.MinInt64</code> before doing the conversion.</p>\n"}, {"tags": [], "owner": {"reputation": 1917, "user_id": 4039768, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EWQUf.jpg?s=128&g=1", "display_name": "Mohsin", "link": "https://stackoverflow.com/users/4039768/mohsin"}, "is_accepted": false, "score": 8, "last_activity_date": 1507147696, "creation_date": 1507147696, "answer_id": 46573344, "question_id": 46569874, "link": "https://stackoverflow.com/questions/46569874/how-to-get-an-integer-result-from-the-math-floor-function-in-golang/46573344#46573344", "title": "How to get an integer result from the math floor function in golang?", "body": "<p><strong>You may just want to check beforehand; if the conversion will perform safely or an overflow will occur.</strong></p>\n\n<p>As <a href=\"https://stackoverflow.com/users/102371/john-weldon\">John Weldon</a> suggested,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc main() {\n    var (\n        a   int64\n        f64 float64\n    )\n\n    // This number doesn't exist in the float64 world, \n    // just a number to perform the test.\n    f64 = math.Floor(9223372036854775808.5) \n    if f64 &gt;= math.MaxInt64 || f64 &lt;= math.MinInt64 {\n        fmt.Println(\"f64 is out of int64 range.\")\n        return\n    }\n\n    a = int64(f64)\n    fmt.Println(a)\n}\n</code></pre>\n\n<blockquote>\n  <p><a href=\"https://play.golang.org/p/1QEORXkli6\" rel=\"noreferrer\">Go Playground</a></p>\n</blockquote>\n\n<p>I hope this will answer your question.<br>\nAlso, I'd really like to know if any better solution is available. :)</p>\n"}], "owner": {"reputation": 4968, "user_id": 244330, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/66b048081841e1854319684966683663?s=128&d=identicon&r=PG", "display_name": "newguy", "link": "https://stackoverflow.com/users/244330/newguy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6683, "favorite_count": 2, "answer_count": 2, "score": 4, "last_activity_date": 1507147696, "creation_date": 1507134813, "last_edit_date": 1507145609, "question_id": 46569874, "link": "https://stackoverflow.com/questions/46569874/how-to-get-an-integer-result-from-the-math-floor-function-in-golang", "title": "How to get an integer result from the math floor function in golang?", "body": "<p>The <code>math.Floor</code> in Golang returns a float64. But I would like it to return an integer. How can I get the integer value after performing the <code>floor</code> operation? Can I just use <code>int(x)</code> or <code>int32(x)</code> or <code>int64(x)</code>? I worry that the integer range might not match that of a float64 result therefore brings inaccuracy to the operation.</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507163205, "post_id": 46567672, "comment_id": 80105525, "body": "did you test your code ?"}, {"owner": {"reputation": 63, "user_id": 4971613, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c16e556a4e543395322dd15157db49b8?s=128&d=identicon&r=PG&f=1", "display_name": "Swati", "link": "https://stackoverflow.com/users/4971613/swati"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507173721, "post_id": 46567672, "comment_id": 80107750, "body": "@YandryPozo Hello Yes my code working fine for me. you can test with urls. <a href=\"http://admin.localhost:9090/ping\" rel=\"nofollow noreferrer\">admin.localhost:9090/ping</a>, <a href=\"http://analytics.localhost:9090/ping\" rel=\"nofollow noreferrer\">analytics.localhost:9090/ping</a>."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 4971613, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c16e556a4e543395322dd15157db49b8?s=128&d=identicon&r=PG&f=1", "display_name": "Swati", "link": "https://stackoverflow.com/users/4971613/swati"}, "edited": false, "score": 0, "creation_date": 1507177215, "post_id": 46574138, "comment_id": 80108544, "body": "Thanks @Kenny Grant for your answer. I checked the Default ServeMux and your code. It works fine, but I have completed my app with the  gin router now I need to implement the sub-domain part using the gin. Can you please provide a way to complete this with gin."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 63, "user_id": 4971613, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c16e556a4e543395322dd15157db49b8?s=128&d=identicon&r=PG&f=1", "display_name": "Swati", "link": "https://stackoverflow.com/users/4971613/swati"}, "edited": false, "score": 0, "creation_date": 1507184949, "post_id": 46574138, "comment_id": 80111177, "body": "Sorry, don\u2019t use gin. Does it support domains? If so do something similar?"}, {"owner": {"reputation": 69, "user_id": 9206643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AUuNe.png?s=128&g=1", "display_name": "Kafka Tamura", "link": "https://stackoverflow.com/users/9206643/kafka-tamura"}, "edited": false, "score": 1, "creation_date": 1594052869, "post_id": 46574138, "comment_id": 110985177, "body": "@KennyGrant I&#39;m implementing something similar to the OP. I&#39;m using ServeMux like you recommended, Thanks! How would you make the subdomains dynamic to support hundreds of them?"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": -1, "last_activity_date": 1507151012, "creation_date": 1507151012, "answer_id": 46574138, "question_id": 46567672, "link": "https://stackoverflow.com/questions/46567672/what-is-the-best-way-to-handle-dynamic-subdomains-in-golang-with-gin-router/46574138#46574138", "title": "What is the best way to handle dynamic subdomains in golang with gin router", "body": "<p>You have a few options (write a router, write wrappers, attempt to bend gin to your will), but as the default ServeMux supports this, and you probably really don't need gin in particular, I'd go with the standard router. Take a look at the source of the <a href=\"https://golang.org/src/net/http/server.go?s=69186:69230#L2066\" rel=\"nofollow noreferrer\">DefaultServeMux</a> first, to get an idea of how simple a router is at heart - a router is just a map of paths to handlers. </p>\n\n<p>The Default <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\">ServeMux</a> actually does what you want (allows matching on host as well as path), so I'd suggest trying with that first. Register your patterns:</p>\n\n<pre><code>mux := http.NewServeMux()\nmux.HandleFunc(\"/\", handlerRoot)\nmux.HandleFunc(\"analytics.example.com/\", handlerOne)\nmux.HandleFunc(\"admin.example.com/\", handlerTwo)\nerr := http.ListenAndServe(\":9090\", mux)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Write some handlers (obviously you might write json with an encoder rather than directly, this is just an example):</p>\n\n<pre><code>func handlerOne(w http.ResponseWriter, r *http.Request) {\n    j := fmt.Sprintf(`{\"one\":\"%s\"}`, r.Host)\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.WriteHeader(http.StatusOK)\n    w.Write([]byte(j))\n}\n</code></pre>\n\n<p>If you're then testing this on localhost, you'd probably want to edit your /etc/hosts file to be sure you hit the server with the right hostname. </p>\n\n<p>Putting that together, you could use something like this to test with:</p>\n\n<p><a href=\"https://play.golang.org/p/ut-GT_s3Gf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ut-GT_s3Gf</a></p>\n\n<p>Note these subdomains could be dynamic if you want (the mention of 100 plus makes me think they might be), and you could just customise behaviour at runtime in handlers rather than using separate handlers, it depends how differently the domains behave.</p>\n"}, {"comments": [{"owner": {"reputation": 63, "user_id": 4971613, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c16e556a4e543395322dd15157db49b8?s=128&d=identicon&r=PG&f=1", "display_name": "Swati", "link": "https://stackoverflow.com/users/4971613/swati"}, "edited": false, "score": 1, "creation_date": 1563447379, "post_id": 57067033, "comment_id": 100707317, "body": "Thank you Pie for your answer but this post was old and I have already implemented a solution for this."}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "reply_to_user": {"reputation": 63, "user_id": 4971613, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c16e556a4e543395322dd15157db49b8?s=128&d=identicon&r=PG&f=1", "display_name": "Swati", "link": "https://stackoverflow.com/users/4971613/swati"}, "edited": false, "score": 1, "creation_date": 1565560562, "post_id": 57067033, "comment_id": 101382279, "body": "Don&#39;t worry. This is for future benefits to others."}], "tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": false, "score": 1, "last_activity_date": 1563323375, "creation_date": 1563323375, "answer_id": 57067033, "question_id": 46567672, "link": "https://stackoverflow.com/questions/46567672/what-is-the-best-way-to-handle-dynamic-subdomains-in-golang-with-gin-router/57067033#57067033", "title": "What is the best way to handle dynamic subdomains in golang with gin router", "body": "<p>You can use <a href=\"https://golang.org/pkg/net/http/httputil/#ReverseProxy\" rel=\"nofollow noreferrer\"><code>*httputil.ReverseProxy</code></a> for this. Here is how I would reroute to a subdomain based on a hostname without any middleware in Gin.</p>\n\n<pre><code>router.GET(\"/:username\", func(c *gin.Context) {\n    uri, ok := c.Get(\"location\")\n    if !ok {\n        c.JSON(500, gin.H{\n            \"reason\": \"Location unknown\",\n        })\n    }\n    hostname := \"awesome.io\"\n    if uri.(*url.URL).Host == hostname {\n        // Want to send client to \"https://auth.awesome.io/:username\"\n        s := fmt.Sprintf(\"https://auth.%s/%s\", domain, c.Param(\"username\"))\n        uri, err := url.Parse(s)\n        if err != nil {\n            c.JSON(500, gin.H{\n                \"reason\": \"Subdomain is wrong\",\n            })\n        }\n        rp := new(httputil.ReverseProxy)\n\n        // Modify request's URL to point to the new uri\n        rp.Director = func(req *http.Request) {\n            req.URL = uri\n        }\n        rp.ServeHTTP(c.Writer, c.Request)\n    }\n})\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 4971613, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c16e556a4e543395322dd15157db49b8?s=128&d=identicon&r=PG&f=1", "display_name": "Swati", "link": "https://stackoverflow.com/users/4971613/swati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3174, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1563323375, "creation_date": 1507127927, "last_edit_date": 1507333966, "question_id": 46567672, "link": "https://stackoverflow.com/questions/46567672/what-is-the-best-way-to-handle-dynamic-subdomains-in-golang-with-gin-router", "title": "What is the best way to handle dynamic subdomains in golang with gin router", "body": "<p>Hello Everyone,</p>\n\n<p>I am working on a project where I need to setup the multiple sub-domains with the routes. I tried code with two sub-domains, but in my case it would be 100 sub-domains. I tried the following code for this:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gin-gonic/gin\"\n    \"net/http\"\n    \"strings\"\n)\n\ntype Subdomains map[string]http.Handler\n\nfunc (subdomains Subdomains) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    domainParts := strings.Split(r.Host, \".\")\n\n    if mux := subdomains[domainParts[0]]; mux != nil {\n        mux.ServeHTTP(w, r)\n    } else {\n        http.Error(w, \"Not found\", 404)\n    }\n}\n\nfunc main() {\n    r := gin.Default()\n    r2 := gin.Default()\n    hs := make(Subdomains)\n    hs[\"admin\"] = r\n    hs[\"analytics\"] = r2\n    r.GET(\"/ping\", adminHandlerOne)\n    r2.GET(\"/ping\", adminHandlerOne)\n    http.ListenAndServe(\":9090\", hs)\n}\nfunc adminHandlerOne(c *gin.Context) {\n    c.JSON(200, gin.H{\n        \"message\": \"pong\",\n    })\n}\n</code></pre>\n\n<p>But I think that this is not good. Is anybody know the proper way to do this?</p> \n"}, {"tags": ["select", "go", "channel"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1507127104, "post_id": 46567318, "comment_id": 80088354, "body": "Where is your definition for type Job? Also your Work defination shouldn&#39;t be in a goroutine that. You&#39;re spinning up multiple listeners."}, {"owner": {"reputation": 33, "user_id": 5098582, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/0454de992e1b6c71584276b5dfd04fa9?s=128&d=identicon&r=PG&f=1", "display_name": "bluebeel", "link": "https://stackoverflow.com/users/5098582/bluebeel"}, "edited": false, "score": 0, "creation_date": 1507127627, "post_id": 46567318, "comment_id": 80088786, "body": "Job is defined in a other go file i haven&#39;t put his because he contains a lot of information... What do you mean by my work definition shouldn&#39;t be in a goroutine?"}, {"owner": {"reputation": 33, "user_id": 5098582, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/0454de992e1b6c71584276b5dfd04fa9?s=128&d=identicon&r=PG&f=1", "display_name": "bluebeel", "link": "https://stackoverflow.com/users/5098582/bluebeel"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507127726, "post_id": 46567318, "comment_id": 80088853, "body": "@JimB my bad a spelling error I have a case for channeliIn and a case for channel out"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1507137381, "post_id": 46567318, "comment_id": 80094767, "body": "Your nested selects probably don&#39;t work the way you think they do; the inner selects will only get executed once, so there is no way for e.g. the <code>&lt;-ticker</code> case to sent on <code>quitIn</code> and have it executed in the <code>&lt;-quitIn</code> case; it&#39;s impossible. Only one case will be executed. Same for the <code>quitOut</code>."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1507137224, "post_id": 46567862, "comment_id": 80094688, "body": "This is a completely relevant comment, but not an answer to the question."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1507128489, "creation_date": 1507128489, "answer_id": 46567862, "question_id": 46567318, "link": "https://stackoverflow.com/questions/46567318/golang-channel-in-select-not-receiving/46567862#46567862", "title": "Golang channel in select not receiving", "body": "<p>Your <code>quitIn</code> and <code>quitOut</code> channels are basically useless: You create them and try to receive from them. Which you cannot as nobody can write to these channels because nobody even knows about their existence. I cannot say more because I do not understand what the code is supposed to do.</p>\n"}, {"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 2, "last_activity_date": 1507129679, "last_edit_date": 1507129679, "creation_date": 1507129320, "answer_id": 46568123, "question_id": 46567318, "link": "https://stackoverflow.com/questions/46567318/golang-channel-in-select-not-receiving/46568123#46568123", "title": "Golang channel in select not receiving", "body": "<p>I think your solution might be a bit over complicated.  Here is a simplified version.  Bare in mind that there are numerous implementations. A good article to read </p>\n\n<p><a href=\"https://medium.com/smsjunk/handling-1-million-requests-per-minute-with-golang-f70ac505fcaa\" rel=\"nofollow noreferrer\">https://medium.com/smsjunk/handling-1-million-requests-per-minute-with-golang-f70ac505fcaa</a></p>\n\n<p>Or even better right from the Go handbook </p>\n\n<p><a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow noreferrer\">https://gobyexample.com/worker-pools</a> (which I think maybe is what you were aiming for)</p>\n\n<p>Anyway, below serves as a different type of example.. There are a few ways to go about solving this problem.</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"log\"\n    \"os\"\n    \"sync\"\n    \"time\"\n)\n\ntype worker struct {\n    wg   *sync.WaitGroup\n    in   chan job\n    quit context.Context\n}\n\ntype job struct {\n    message int\n}\n\nfunc main() {\n    numberOfJobs := 50\n\n    ctx, cancel := context.WithTimeout(context.Background(), 3*time.Second)\n    defer cancel()\n\n    w := worker{\n        wg:   &amp;sync.WaitGroup{},\n        in:   make(chan job),\n        quit: ctx,\n    }\n\n    for i := 0; i &lt; numberOfJobs; i++ {\n        go func(i int) {\n            w.in &lt;- job{message: i}\n        }(i)\n    }\n\n    counter := 0\n    for {\n        select {\n        case j := &lt;-w.in:\n            counter++\n            log.Printf(\"Received job %+v\\n\", j)\n            // DO SOMETHING WITH THE RECEIVED JOB\n            // WORKING ON IT\n            x := j.message * j.message\n            log.Printf(\"job processed, result %d\", x)\n        case &lt;-w.quit.Done():\n            log.Printf(\"Recieved quit, timeout reached.  Number of jobs queued: %d, Number of jobs complete: %d\\n\", numberOfJobs, counter)\n            os.Exit(0)\n        default:\n            // TODO\n        }\n    }\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 608, "user_id": 4823789, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/16701fdace0347de7dbf1c356d295e76?s=128&d=identicon&r=PG&f=1", "display_name": "ND003", "link": "https://stackoverflow.com/users/4823789/nd003"}, "is_accepted": false, "score": 0, "last_activity_date": 1547831940, "creation_date": 1547831940, "answer_id": 54258680, "question_id": 46567318, "link": "https://stackoverflow.com/questions/46567318/golang-channel-in-select-not-receiving/54258680#54258680", "title": "Golang channel in select not receiving", "body": "<p>Because your function is \"Work\" and you are calling \"work\".</p>\n"}], "owner": {"reputation": 33, "user_id": 5098582, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/0454de992e1b6c71584276b5dfd04fa9?s=128&d=identicon&r=PG&f=1", "display_name": "bluebeel", "link": "https://stackoverflow.com/users/5098582/bluebeel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2014, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1547831940, "creation_date": 1507126926, "last_edit_date": 1507138847, "question_id": 46567318, "link": "https://stackoverflow.com/questions/46567318/golang-channel-in-select-not-receiving", "title": "Golang channel in select not receiving", "body": "<p>I am currently working on a small script where I use the channels, select and goroutine and I really don't understand why it doesn't run as I think.</p>\n\n<p>I have 2 channels that all my goroutines listen to. </p>\n\n<p>I pass the channels to each goroutine where there is a select which must choose between the 2 depending on where the data comes first.</p>\n\n<p>The problem is that no goroutine falls into the second case. I can have received 100 jobs one after the other, I see everything in the log. It does well what is requested in the first case and after that it sent the work in the second channel (still if it does well ...) I do not have any more logs.\nI just don't understand why...</p>\n\n<p>If someone can enlighten me :)</p>\n\n<pre><code>package main\n\nfunc main() {\n\n    wg := new(sync.WaitGroup)\n    in := make(chan *Job)\n    out := make(chan *Job)\n    results := make(chan *Job)\n\n    for i := 0; i &lt; 50; i++ {\n        go work(wg, in, out, results)\n    }\n\n    wg.Wait()\n\n    // Finally we collect all the results of the work.\n    for elem := range results {\n            fmt.Println(elem)\n    }    \n}\n\nfunc Work(wg *sync.WaitGroup, in chan *Job, out chan *Job, results chan *Job) {\n    wg.Add(1)\n    defer wg.Done()\n    for {\n        select {\n        case job := &lt;-in:\n            ticker := time.Tick(10 * time.Second)\n\n            select {\n            case &lt;-ticker:\n                // DO stuff\n            if condition is true {\n                out &lt;- job\n            }\n            case &lt;-time.After(5 * time.Minute):\n                fmt.Println(\"Timeout\")\n            }\n        case job := &lt;-out:\n            ticker := time.Tick(1 * time.Minute)\n\n            select {\n            case &lt;-ticker:\n                // DO stuff\n            if condition is true {\n                results &lt;- job\n            }\n\n            case &lt;-quitOut:\n                fmt.Println(\"Job completed\")\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I create a number of workers who listen to 2 channels and send the final results to the 3rd.</p>\n\n<p>It does something with the received job and if it validates a given condition, it passes this job to the next channel and if it validates a condition it passes the job into the result channel.</p>\n\n<p>So, in my head I had a pipeline like this for 5 workers for example: 3 jobs in the channel IN, directly 3 workers takes them, if the 3 job validates the condition, they are sent in the channel OUT. Directly 2 workers takes them and the 3rd job is picked up by one of the first 3 workers ...</p>\n\n<p>Now I hope you have a better understanding for my first code. But in my code, I never get to the second case.</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1507117684, "post_id": 46563875, "comment_id": 80081484, "body": "Run it under the race detector :-)"}], "answers": [{"comments": [{"owner": {"reputation": 2270, "user_id": 136129, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/HzEgP.jpg?s=128&g=1", "display_name": "royse41", "link": "https://stackoverflow.com/users/136129/royse41"}, "edited": false, "score": 0, "creation_date": 1507125098, "post_id": 46564206, "comment_id": 80086857, "body": "now you&#39;ve said that, it makes sense. i think i&#39;m starting to understand goroutines a little more now. thanks for the heads up about atomic functions as well."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 7, "last_activity_date": 1507118071, "creation_date": 1507118071, "answer_id": 46564206, "question_id": 46563875, "link": "https://stackoverflow.com/questions/46563875/waiting-for-all-go-routines-to-finish/46564206#46564206", "title": "waiting for all go routines to finish", "body": "<p>It's not safe to modify a single variable simultaneously in different goroutines. Some of your updates to <code>numRows</code> will be lost, and occasionally your program may crash.</p>\n\n<p>Either protect your <code>numRows</code> variable with a mutex, or use one of the <a href=\"https://golang.org/pkg/sync/atomic/\" rel=\"noreferrer\">atomic</a> functions to do your addition atomically:</p>\n\n<pre><code>var numRows int32\n\n// ...\n\n    go (func() {\n        atomic.AddInt32(&amp;numRows, 1)\n        waitGroup.Done()\n    })()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1507121150, "post_id": 46565069, "comment_id": 80083974, "body": "No doubt it could be simplified, but I don&#39;t think that&#39;s the point of the question."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1507121782, "post_id": 46565069, "comment_id": 80084412, "body": "yep, just shared some ideas how to serialize access with channels"}, {"owner": {"reputation": 2270, "user_id": 136129, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/HzEgP.jpg?s=128&g=1", "display_name": "royse41", "link": "https://stackoverflow.com/users/136129/royse41"}, "edited": false, "score": 0, "creation_date": 1507125059, "post_id": 46565069, "comment_id": 80086828, "body": "ahh this makes sense. my code is pretty flimsy, but the point was just me getting to grips with concurrency in go so this has pushed me in the right direction. thanks!"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 1, "last_activity_date": 1507120667, "creation_date": 1507120667, "answer_id": 46565069, "question_id": 46563875, "link": "https://stackoverflow.com/questions/46563875/waiting-for-all-go-routines-to-finish/46565069#46565069", "title": "waiting for all go routines to finish", "body": "<p>What do you do with this code:</p>\n\n<pre><code>for scanner.Scan() {\n    err := scanner.Err()\n\n    if err != nil &amp;&amp; err != io.EOF {\n        panic(err)\n    }\n\n    waitGroup.Add(1)\n\n    go (func() {\n        numRows++\n        waitGroup.Done()\n    })()\n}\n</code></pre>\n\n<p>Really all the work is done in one main goroutine and only <code>numRows</code> increment uses separate goroutines. I think this could be simplified to simple increment:</p>\n\n<pre><code>for scanner.Scan() {\n    err := scanner.Err()\n\n    if err != nil &amp;&amp; err != io.EOF {\n        panic(err)\n    }\n    numRows++\n}\n</code></pre>\n\n<p>If you want to simulate parallel parsing and pipelining you may use channels. Make only one goroutine responsible for counter increment.  Every time when another goroutine wants to increment counter - it sends a message to that channel.</p>\n\n<p><a href=\"https://play.golang.org/p/W60twJjY8P\" rel=\"nofollow noreferrer\">https://play.golang.org/p/W60twJjY8P</a></p>\n"}], "owner": {"reputation": 2270, "user_id": 136129, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/HzEgP.jpg?s=128&g=1", "display_name": "royse41", "link": "https://stackoverflow.com/users/136129/royse41"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 528, "favorite_count": 0, "accepted_answer_id": 46565069, "answer_count": 2, "score": 0, "last_activity_date": 1507125018, "creation_date": 1507117060, "last_edit_date": 1507125018, "question_id": 46563875, "link": "https://stackoverflow.com/questions/46563875/waiting-for-all-go-routines-to-finish", "title": "waiting for all go routines to finish", "body": "<p>First time with go, and trying to get go routines and <code>WaitGroups</code> working.</p>\n\n<p>I have a CSV file with 100 rows of data. (101 including header)</p>\n\n<p>I have the following simple code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    start := time.Now()\n    numRows := 0\n\n    waitGroup := sync.WaitGroup{}\n    file, _ := os.Open(\"./data.csv\")\n\n    scanner := bufio.NewScanner(file)\n    scanner.Scan() // to read the header\n\n    for scanner.Scan() {\n        err := scanner.Err()\n\n        if err != nil &amp;&amp; err != io.EOF {\n            panic(err)\n        }\n\n        waitGroup.Add(1)\n\n        go (func() {\n            numRows++\n            waitGroup.Done()\n        })()\n    }\n\n    waitGroup.Wait()\n    file.Close()\n\n    fmt.Println(\"Finished parsing \", numRows)\n    fmt.Println(\"Elapsed time in seconds: \", time.Now().Sub(start))\n}\n</code></pre>\n\n<p>When i run this, the <code>numRows</code> output fluctuates between 94 and 100 each time. I'm expecting it to be 100 each time. If i run the same code on a CSV of 10 rows of data, it outputs <code>10</code> each and every time.</p>\n\n<p>Seems to me like the final few go routines aren't finishing in time.</p>\n\n<p>I've tried the following which have failed:</p>\n\n<ul>\n<li>using a <code>CsvReader</code> instead of a <code>Scanner</code></li>\n<li>moving <code>waitGroup.Add(1)</code> to underneath the anonymous func</li>\n<li>moving the anonymous func out into a package-level scope func (and passed things round using ptrs)</li>\n</ul>\n\n<p>What am i missing?</p>\n"}, {"tags": ["go", "websocket", "socket.io"], "comments": [{"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1507122301, "post_id": 46561747, "comment_id": 80084781, "body": "The <code>Dial</code> function is used to connect to a server as a client, but you&#39;re trying to create a server. You need to use <code>NewServer</code>, which is shown in the library&#39;s documentation."}, {"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1507122499, "post_id": 46561747, "comment_id": 80084929, "body": "Thanks Gavin. I want to connect to a server, not create a new one. So the use of <code>Dial()</code> is correct here, isn&#39; t it?"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1507123784, "post_id": 46561747, "comment_id": 80085901, "body": "My apologies, I misread and thought you were trying to move the backend to Go. I notice with your current setup, the requests via http are logged and have <code>transport=polling</code>, and the request via ws is logged as a client connecting and <code>transport=websocket</code>. However, when you are using the Go client, you log an <i>http</i> request with <code>transport=websocket</code>."}, {"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1507125087, "post_id": 46561747, "comment_id": 80086850, "body": "Yes you are right. By digging more to the source code of <a href=\"https://github.com/graarh/golang-socketio\" rel=\"nofollow noreferrer\">golang-socketio</a> I don&#39;t see any option to do the same thing javascript does in the browser. Also this handshake / polling phase is not very well documented: <a href=\"https://github.com/socketio/socket.io-protocol/issues/10\" rel=\"nofollow noreferrer\">Document the handshake process #10</a>"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1507661904, "post_id": 46561747, "comment_id": 80296488, "body": "In fact yor JS and Go clients work different ways. JS uses polling and Go tries to use websockets. Could you restrict available transport to websocket only? Like this: <code>io.connect(&quot;http:&#47;&#47;your.domain.com&quot;, {transports: [&#39;websocket&#39;]});</code>"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1507662691, "post_id": 46561747, "comment_id": 80296913, "body": "Have you tried to connect with pure browser WebSockes?"}, {"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 0, "creation_date": 1507663128, "post_id": 46561747, "comment_id": 80297127, "body": "I have noticed that long polling is for the first steps and then <code>ws</code> are used. For the back end that I have now, I cannot bypass this step because during this phase an <code>sid</code> is also exchanged."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1507664858, "post_id": 46561747, "comment_id": 80297902, "body": "What is the problem exactly? It connects, yes and then you don&#39;t do anything with that connection (aka call join), so you won&#39;t see subsequent calls..."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1507699362, "post_id": 46561747, "comment_id": 80308604, "body": "started to comment... by ran out of characters )"}], "answers": [{"comments": [{"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 0, "creation_date": 1507210471, "post_id": 46575848, "comment_id": 80127042, "body": "Thanks John. This is the example I&#39;ve been using too. For some reason the 2 server functions <code>socketio.on(&#39;connect&#39;...)</code> and <code>socketio.on(&#39;join&#39;...)</code> are never executed. I really think that this library tries to directly connect to a <code>ws</code> and does not implement the initial steps that <code>socket.io</code> requires as a protocol."}, {"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "reply_to_user": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 0, "creation_date": 1507211966, "post_id": 46575848, "comment_id": 80128229, "body": "Well, the two main differences are 1) you&#39;re only waiting for 1 second instead of 60 seconds, and 2) you&#39;re not actually doing any <code>Join</code> calls - the example issues several <code>Join</code> requests in goroutines before waiting 60 seconds for the goroutines to complete."}, {"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "reply_to_user": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 0, "creation_date": 1507678070, "post_id": 46575848, "comment_id": 80303306, "body": "@tgogos - I&#39;ve updated my answer with an example that should give you the results you&#39;re looking for."}, {"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 0, "creation_date": 1507711176, "post_id": 46575848, "comment_id": 80314839, "body": "Thank you very much for your effort John. I&#39;ve included the results of your code in my question."}, {"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 0, "creation_date": 1507712386, "post_id": 46575848, "comment_id": 80315625, "body": "I&#39;ve also added the results from python client"}], "tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": false, "score": 2, "last_activity_date": 1507678036, "last_edit_date": 1507678036, "creation_date": 1507161137, "answer_id": 46575848, "question_id": 46561747, "link": "https://stackoverflow.com/questions/46561747/socket-io-client-using-go/46575848#46575848", "title": "socket.io client using Go", "body": "<p>I think you're doing it right except you forgot to actually send the <code>join</code> message, maybe something like:</p>\n\n<pre><code>package main\n\nimport (\n        \"log\"\n        \"runtime\"\n        \"sync\"\n        \"time\"\n\n        \"github.com/graarh/golang-socketio\"\n        \"github.com/graarh/golang-socketio/transport\"\n)\n\nfunc doSomethingWith(c *gosocketio.Client, wg *sync.WaitGroup) {\n        if res, err := c.Ack(\"join\", \"This is a client\", time.Second*3); err != nil {\n                log.Printf(\"error: %v\", err)\n        } else {\n                log.Printf(\"result %q\", res)\n        }\n        wg.Done()\n}\n\nfunc main() {\n\n        runtime.GOMAXPROCS(runtime.NumCPU())\n\n        c, err := gosocketio.Dial(\n                gosocketio.GetUrl(\"127.0.0.1\", 3003, false),\n                transport.GetDefaultWebsocketTransport())\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        err = c.On(gosocketio.OnDisconnection, func(h *gosocketio.Channel) {\n                log.Fatal(\"Disconnected\")\n        })\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        err = c.On(gosocketio.OnConnection, func(h *gosocketio.Channel) {\n                log.Println(\"Connected\")\n        })\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        wg := &amp;sync.WaitGroup{}\n        wg.Add(1)\n        go doSomethingWith(c, wg)\n        wg.Wait()\n        log.Printf(\"Done\")\n}\n</code></pre>\n\n<p>Notice the goroutine call to the function that actually communicates the 'join' message to the server.</p>\n\n<p>Also, notice the use of a <code>sync.WaitGroup</code> to block until the goroutine completes, instead of using <code>time.Sleep()</code> to wait.</p>\n"}, {"comments": [{"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 0, "creation_date": 1507709477, "post_id": 46680417, "comment_id": 80313826, "body": "Thanks for your effort Eugene, more or less I&#39;ve come to the same conclusions while searching for this..."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1507699335, "creation_date": 1507699335, "answer_id": 46680417, "question_id": 46561747, "link": "https://stackoverflow.com/questions/46561747/socket-io-client-using-go/46680417#46680417", "title": "socket.io client using Go", "body": "<p>According to commentws above, we've found websocket connection itself is working. I think problem is here - <code>socket.io</code> was developed many years ago when native WebSockets were not well supported by majority of browsers and inermediate servers/proxies/routers. So it has a special checks and fallbacks when to upgrade and downgrade a connection (to longpolling for example). If you have already installed connection you may start working without special key exchanges with another protocol. </p>\n\n<p>Try to start using connection and performing next steps at application level logics (<code>Join</code> and so on). Is it working?</p>\n\n<p>I think nowadays WS are supported well for 99% of clients. If you want not to loose chance some client will be not working you may keep <code>sockets.io</code> in project. But sometimes you'll have to realize its connections logics in WS.</p>\n"}], "owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8485, "favorite_count": 2, "answer_count": 2, "score": 8, "last_activity_date": 1535442299, "creation_date": 1507110236, "last_edit_date": 1535442299, "question_id": 46561747, "link": "https://stackoverflow.com/questions/46561747/socket-io-client-using-go", "title": "socket.io client using Go", "body": "<p>Starting with a working <code>socket.io</code> example (back-end: Python/Flask, front-end: socket.io.js v2.0.3), I now try to set up a client with Go but can't even pass the handshake phase. Apologies for the long post... (At the end I have also added a Python client which does what I want to implement in Go)</p>\n\n<h3>(The following work):</h3>\n\n<hr>\n\n<p><strong>back-end:</strong></p>\n\n<pre><code>@socketio.on('connect', namespace='/endpoint')\ndef connect():\n    print(\"Client connected with request sid \"+request.sid)\n\n@socketio.on('join', namespace='/endpoint')\ndef join(message):\n    print(\"Server received from client:\" +message)\n    print(\"Client just joined room with request sid \"+request.sid)\n    join_room(request.sid)\n</code></pre>\n\n<p><strong>front-end:</strong></p>\n\n<pre><code>namespace = '/endpoint';\nvar socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);\n\nvar client_join_message = \"This is a client\";    \nsocket.emit('join', client_join_message);\n</code></pre>\n\n<p><strong>Developer tools:</strong> I notice a few requests until the browser and the server select to use websockets and exchange frames:</p>\n\n<pre><code>http://localhost:5000/socket.io/?EIO=3&amp;transport=polling&amp;t=LxcgetJ\nhttp://localhost:5000/socket.io/?EIO=3&amp;transport=polling&amp;t=Lxcgetf&amp;sid=025e105a5093467d994a891367380aa3\nhttp://localhost:5000/socket.io/?EIO=3&amp;transport=polling&amp;t=Lxcgeti&amp;sid=025e105a5093467d994a891367380aa3\nws://localhost:5000/socket.io/?EIO=3&amp;transport=websocket&amp;sid=025e105a5093467d994a891367380aa3\nhttp://localhost:5000/socket.io/?EIO=3&amp;transport=polling&amp;t=Lxcgetw&amp;sid=025e105a5093467d994a891367380aa3\nhttp://localhost:5000/socket.io/?EIO=3&amp;transport=polling&amp;t=Lxcgetx&amp;sid=025e105a5093467d994a891367380aa3\n</code></pre>\n\n<p><strong>Server logs:</strong></p>\n\n<pre><code>\"GET /socket.io/?EIO=3&amp;transport=polling&amp;t=LxcgetJ HTTP/1.1\" 200 381 0.000322\nClient connected with request sid 025e105a5093467d994a891367380aa3\n\"POST /socket.io/?EIO=3&amp;transport=polling&amp;t=Lxcgetf&amp;sid=025e105a5093467d994a891367380aa3 HTTP/1.1\" 200 219 0.000806\n(6450) accepted ('127.0.0.1', 45034)\n\"GET /socket.io/?EIO=3&amp;transport=polling&amp;t=Lxcgeti&amp;sid=025e105a5093467d994a891367380aa3 HTTP/1.1\" 200 227 0.003941\n\"POST /socket.io/?EIO=3&amp;transport=polling&amp;t=Lxcgetw&amp;sid=025e105a5093467d994a891367380aa3 HTTP/1.1\" 200 219 0.001650\n\"GET /socket.io/?EIO=3&amp;transport=polling&amp;t=Lxcgetx&amp;sid=025e105a5093467d994a891367380aa3 HTTP/1.1\" 200 215 0.000235\nServer received from client:This is a client\nClient just joined room with request sid 025e105a5093467d994a891367380aa3\n</code></pre>\n\n<p><br></p>\n\n<h3>My try with Go, (doesn't work):</h3>\n\n<hr>\n\n<p>The code comes from this <a href=\"https://github.com/graarh/golang-socketio/blob/master/examples/client.go\" rel=\"nofollow noreferrer\">client</a> example in <a href=\"https://github.com/graarh/golang-socketio\" rel=\"nofollow noreferrer\">github.com/graarh/golang-socketio</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/graarh/golang-socketio\"\n    \"github.com/graarh/golang-socketio/transport\"\n    \"log\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc main() {\n\n    runtime.GOMAXPROCS(runtime.NumCPU())\n\n    c, err := gosocketio.Dial(\n        gosocketio.GetUrl(\"127.0.0.1\", 5000, false),\n        transport.GetDefaultWebsocketTransport())\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    err = c.On(gosocketio.OnDisconnection, func(h *gosocketio.Channel) {\n        log.Fatal(\"Disconnected\")\n    })\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    err = c.On(gosocketio.OnConnection, func(h *gosocketio.Channel) {\n        log.Println(\"Connected\")\n    })\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    time.Sleep(1 * time.Second)\n}\n</code></pre>\n\n<p><strong>Go code output:</strong></p>\n\n<pre><code>Connected\n</code></pre>\n\n<p><strong>Server logs:</strong></p>\n\n<pre><code>\"GET /socket.io/?EIO=3&amp;transport=websocket HTTP/1.1\" 200 0 1.004291\n</code></pre>\n\n<p>Is there anything that I'm missing? With the Go code I don't see any <code>sid</code>, <code>transport=polling</code>... Also, there are only a few questions tagged with <code>[go] [socket.io]</code>, which makes me think I've chosen the wrong path... I would be grateful for any thoughts, ideas on this.</p>\n\n<hr>\n\n<h3>@John Weldon</h3>\n\n<p>Your code produces the following:</p>\n\n<p>Client:</p>\n\n<pre><code>$ go run gotest5.go \n2017/10/11 11:21:40 Connected\n2017/10/11 11:21:40 result \"\"\n2017/10/11 11:21:40 Done\n</code></pre>\n\n<p>Server:</p>\n\n<pre><code>(4380) wsgi starting up on http://127.0.0.1:5000\n(4380) accepted ('127.0.0.1', 38860)\n127.0.0.1 - - [11/Oct/2017 11:21:40] \"GET /socket.io/?EIO=3&amp;transport=websocket HTTP/1.1\" 200 0 0.003100\n</code></pre>\n\n<p>Notice that the server functions <code>on.('connect'...)</code> and <code>on.('join',...)</code> didn't produce logs.</p>\n\n<hr>\n\n<h3>Python client (it works):</h3>\n\n<pre><code>from socketIO_client import SocketIO, BaseNamespace\n\nclass ThisNamespace(BaseNamespace):\n    def on_connect(self):\n        print('[Connected]')\n    def on_reconnect(self):\n        print('[Reconnected]')\n    def on_disconnect(self):\n        print('[Disconnected]')\n\nwith SocketIO('127.0.0.1', 5000, ThisNamespace) as socketIO:\n    this_namespace = socketIO.define(ThisNamespace, '/endpoint')\n</code></pre>\n\n<p>client logs:</p>\n\n<pre><code>python3 test.py \n[Connected]\n[Disconnected]\n[Disconnected]\n</code></pre>\n\n<p>server logs:</p>\n\n<pre><code>(6047) wsgi starting up on http://127.0.0.1:5000\n(6047) accepted ('127.0.0.1', 38900)\n127.0.0.1 - - [11/Oct/2017 11:53:27] \"GET /socket.io/?t=1507712007314-0&amp;transport=polling&amp;EIO=3 HTTP/1.1\" 200 381 0.000859\n(6047) accepted ('127.0.0.1', 38902)\nClient connected with request sid 919ed69264dd4e9f93e7af0294970dbd\nClient disconnected with request.sid 919ed69264dd4e9f93e7af0294970dbd\n127.0.0.1 - - [11/Oct/2017 11:53:27] \"GET /socket.io/?sid=919ed69264dd4e9f93e7af0294970dbd&amp;transport=websocket&amp;EIO=3 HTTP/1.1\" 200 0 0.032171\n</code></pre>\n"}, {"tags": ["string", "go", "http-post", "url-encoding"], "comments": [{"owner": {"reputation": 1882, "user_id": 1242028, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/rRidE.jpg?s=128&g=1", "display_name": "noel", "link": "https://stackoverflow.com/users/1242028/noel"}, "edited": false, "score": 0, "creation_date": 1507109434, "post_id": 46561312, "comment_id": 80076475, "body": "What do you mean by better?"}, {"owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "reply_to_user": {"reputation": 1882, "user_id": 1242028, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/rRidE.jpg?s=128&g=1", "display_name": "noel", "link": "https://stackoverflow.com/users/1242028/noel"}, "edited": false, "score": 0, "creation_date": 1507109544, "post_id": 46561312, "comment_id": 80076576, "body": "@shakabra to avoid string manipulation"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1507109703, "post_id": 46561312, "comment_id": 80076686, "body": "You&#39;re not manipulating strings, you just have a string literal. You mean without having to specify values in the encoded form?"}, {"owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1507110090, "post_id": 46561312, "comment_id": 80076934, "body": "@icza changed my question to show implied string manipulation"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1507110773, "post_id": 46561312, "comment_id": 80077321, "body": "You are looking for <a href=\"https://golang.org/pkg/net/url/#Values\" rel=\"nofollow noreferrer\">golang.org/pkg/net/url/#Values</a> and it&#39;s Encode method."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1507118271, "last_edit_date": 1507118271, "creation_date": 1507111259, "answer_id": 46562063, "question_id": 46561312, "link": "https://stackoverflow.com/questions/46561312/setting-post-request-form-data-variables/46562063#46562063", "title": "Setting POST request form data variables", "body": "<p>Certain characters in form keys and values need to be escaped, such as <code>&amp;</code> or <code>=</code>. So to avoid those mistakes, best is to use the <a href=\"https://golang.org/pkg/net/url/#Values\" rel=\"nofollow noreferrer\"><code>url.Values</code></a> type.</p>\n\n<p>It maps <code>string</code> keys to list of <code>string</code> values. So if you have a value other than <code>string</code>, you have to convert it to <code>string</code> first. Easiest is to use <a href=\"https://golang.org/pkg/fmt/#Sprint\" rel=\"nofollow noreferrer\"><code>fmt.Sprint()</code></a> or <a href=\"https://golang.org/pkg/strconv/#Itoa\" rel=\"nofollow noreferrer\"><code>strconv.Itoa()</code></a> (for more options see <a href=\"https://stackoverflow.com/questions/11123865/golang-format-a-string-without-printing/31742265#31742265\">Golang: format a string without printing?</a>).</p>\n\n<pre><code>vs := url.Values{}\nvs.Set(\"a\", fmt.Sprint(123))\nvs.Set(\"b\", \"xyz\")\nvs.Set(\"tricky\", \"= &amp; =\")\nb := bytes.NewBufferString(vs.Encode())\n</code></pre>\n\n<p><code>url.Values</code> knows how to escape keys and values properly. The above <code>vs.Encode()</code> for example outputs (try it on the <a href=\"https://play.golang.org/p/kz6n8NrNRG\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>a=123&amp;b=xyz&amp;tricky=%3D+%26+%3D\n</code></pre>\n\n<p><strong>Note:</strong></p>\n\n<p>As <code>url.Values</code> is just a map (with <code>map[string][]string</code> as its underlying type), you can also use a simple <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a> to create and populate it:</p>\n\n<pre><code>vs := url.Values{\n    \"a\":      {strconv.Itoa(123)},\n    \"b\":      {\"xyz\"},\n    \"tricky\": {\"= &amp; =\"},\n}\nb := bytes.NewBufferString(vs.Encode())\n</code></pre>\n\n<p>Try this variant on the <a href=\"https://play.golang.org/p/Y4rQ_3PRgT\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507118271, "creation_date": 1507108845, "last_edit_date": 1507111597, "question_id": 46561312, "link": "https://stackoverflow.com/questions/46561312/setting-post-request-form-data-variables", "title": "Setting POST request form data variables", "body": "<pre><code>A := 123\nB := \"xyz\"\nb := bytes.NewBufferString(\"a=\" + A + \"&amp;b=\" + B)\nr.Body = ioutil.NopCloser(b)\n</code></pre>\n\n<p>Is there a better way of setting variables <code>a</code> and <code>b</code> before the <code>POST</code> request is sent?</p>\n"}, {"tags": ["angular", "session", "go", "login", "token"], "comments": [{"owner": {"reputation": 667, "user_id": 7091706, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/kIdrY.jpg?s=128&g=1", "display_name": "Habib", "link": "https://stackoverflow.com/users/7091706/habib"}, "edited": false, "score": 0, "creation_date": 1507107159, "post_id": 46560567, "comment_id": 80075054, "body": "Is there any problem in this question? Please kindly read the whole question first and than vote it down.  There question is different."}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1507107661, "post_id": 46560567, "comment_id": 80075352, "body": "why do you need both JWT and session? i&#39;ve created a single page app using vue.js using go as API server, IMHO, you don&#39;t need both, you either use JWT or session. i&#39;m saving the JWT token on cookie."}, {"owner": {"reputation": 667, "user_id": 7091706, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/kIdrY.jpg?s=128&g=1", "display_name": "Habib", "link": "https://stackoverflow.com/users/7091706/habib"}, "reply_to_user": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1507108885, "post_id": 46560567, "comment_id": 80076140, "body": "Yes you are right. I have save JWT in local storage. But how can I detect a user is login or not? So thats why I have to use session or something which can be used to store token at server so I can check the user status."}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1507109631, "post_id": 46560567, "comment_id": 80076624, "body": "maybe that&#39;s a nice thing that I also want in my app. i&#39;m not sure about this, but what about some kind of refresh function in javascript that runs let&#39;s say every 10-20 minutes? but i think it can be really heavy for your server. you&#39;ll still use your JWT token for that."}, {"owner": {"reputation": 667, "user_id": 7091706, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/kIdrY.jpg?s=128&g=1", "display_name": "Habib", "link": "https://stackoverflow.com/users/7091706/habib"}, "reply_to_user": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1507118212, "post_id": 46560567, "comment_id": 80081796, "body": "I have saved a JWT token in local storage. So yes server would be heavy that it will check the token validation time and when a user do any request on server it will also check the token but it would be the secure way to do it. What do you think @srxf ?"}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 1, "creation_date": 1507176300, "post_id": 46560567, "comment_id": 80108331, "body": "to be honest, i&#39;m not really sure about it, as far as i know, JWTs are meant to be stateless, so i would say just try implementing what you think would work in your case. anyway, try reading <a href=\"http://cryto.net/~joepie91/blog/2016/06/13/stop-using-jwt-for-sessions/\" rel=\"nofollow noreferrer\">this</a>, it might help you decide what you really want for your app. cheers man!"}], "answers": [{"comments": [{"owner": {"reputation": 667, "user_id": 7091706, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/kIdrY.jpg?s=128&g=1", "display_name": "Habib", "link": "https://stackoverflow.com/users/7091706/habib"}, "edited": false, "score": 0, "creation_date": 1507179078, "post_id": 46574956, "comment_id": 80109064, "body": "You are absolutely right @Muhammad Kashif Sulaiman. But I have already save token in DB and if I find and check user from db by token, it be a long process. Can you tell me a short/easy way to do it?"}, {"owner": {"reputation": 255, "user_id": 6082616, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/64002ae4d728745d60ef38e556dd03c3?s=128&d=identicon&r=PG&f=1", "display_name": "Mohammad Kashif Sulaiman", "link": "https://stackoverflow.com/users/6082616/mohammad-kashif-sulaiman"}, "reply_to_user": {"reputation": 667, "user_id": 7091706, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/kIdrY.jpg?s=128&g=1", "display_name": "Habib", "link": "https://stackoverflow.com/users/7091706/habib"}, "edited": false, "score": 0, "creation_date": 1507213897, "post_id": 46574956, "comment_id": 80129591, "body": "if you don&#39;t wanna use db, then use global variables. For e.g. tokensList = [{ &lt;uid&gt;: &lt;token&gt; }, { &lt;uid&gt; : &lt;token&gt; }]"}], "tags": [], "owner": {"reputation": 255, "user_id": 6082616, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/64002ae4d728745d60ef38e556dd03c3?s=128&d=identicon&r=PG&f=1", "display_name": "Mohammad Kashif Sulaiman", "link": "https://stackoverflow.com/users/6082616/mohammad-kashif-sulaiman"}, "is_accepted": false, "score": 1, "last_activity_date": 1507155082, "creation_date": 1507155082, "answer_id": 46574956, "question_id": 46560567, "link": "https://stackoverflow.com/questions/46560567/how-can-i-get-the-login-status-of-user-using-jwt-in-angular-4-using-golang-as-ap/46574956#46574956", "title": "How can I get the login status of user using JWT in angular-4 using golang as API server", "body": "<p>There is no local storage for server like for the webs... There are databases for these purposes. Use Mongodb instead if you're using it as a database...\nOr use global variables on server side.\nBut I would suggest db.</p>\n"}], "owner": {"reputation": 667, "user_id": 7091706, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/kIdrY.jpg?s=128&g=1", "display_name": "Habib", "link": "https://stackoverflow.com/users/7091706/habib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 414, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1507155082, "creation_date": 1507106566, "last_edit_date": 1507114141, "question_id": 46560567, "link": "https://stackoverflow.com/questions/46560567/how-can-i-get-the-login-status-of-user-using-jwt-in-angular-4-using-golang-as-ap", "title": "How can I get the login status of user using JWT in angular-4 using golang as API server", "body": "<p>I am new to go language or golang and I am creating an application using  Angular-4 as front-end and go as API server. The database I that am using is mongodb.</p>\n\n<p>So, I have created an endpoint APIs using <code>gin</code> in go.</p>\n\n<p>The APIs are working good and I have created a login API which gets the email and password and if email and password is correct, it creates a JWT token and returns the JWT token in response. </p>\n\n<p>The JWT token consists of following things : </p>\n\n<ul>\n<li>userId.</li>\n<li>User Role.</li>\n<li>Current server time.</li>\n</ul>\n\n<p>If the user's email and password is correct the server create a JWT token and saved it in the user's collection and return it to the client side and saved it to the local storage.</p>\n\n<p>I want to save the token to the server like in PHP or Java applications.\nSomeone advised me to store the JWT token in server local storage or memory instead of saving it to the user's cookie.</p>\n\n<p>I am using <code>gin</code> package not <code>http</code> package. So please help me with the reference of <strong><code>gin</code></strong> package.</p>\n\n<p>I have searched too much for the session but I found the way related to <code>http</code> and I have also read about <code>gorilla</code>'s session but what I get is it is for <code>client</code> side and I want to save the token on <strong>server</strong> side.</p>\n"}, {"tags": ["asynchronous", "go", "goroutine"], "comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1507106436, "post_id": 46560204, "comment_id": 80074621, "body": "Could you show the whole code?"}, {"owner": {"reputation": 620, "user_id": 6838838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/063168f6e5477ad7990330b95331d798?s=128&d=identicon&r=PG&f=1", "display_name": "Girdhar Sojitra", "link": "https://stackoverflow.com/users/6838838/girdhar-sojitra"}, "edited": false, "score": 0, "creation_date": 1507107548, "post_id": 46560204, "comment_id": 80075279, "body": "By default channels are unbuffered, meaning that they will only accept sends if there is a corresponding receive ready to receive the sent value.So when you are sending activity to queue, there is no corresponding receive for that and it is blocked.All goroutines are blocked and finally wg.wait will hang. There is concept called buffered channel which can be used to buffer more than one input.Go through <a href=\"https://gobyexample.com/channel-buffering\" rel=\"nofollow noreferrer\">gobyexample.com/channel-buffering</a>"}], "answers": [{"comments": [{"owner": {"reputation": 656, "user_id": 5721702, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WDGk4.png?s=128&g=1", "display_name": "Huy-Anh Hoang", "link": "https://stackoverflow.com/users/5721702/huy-anh-hoang"}, "edited": false, "score": 0, "creation_date": 1507151855, "post_id": 46560572, "comment_id": 80102213, "body": "Given that your explanation makes a lot of sense but only after reading it, that makes me wonder, is the way I wrote it the best way to write it? I did not intend my logic to work out that way, so I&#39;m worried that the code is a little convoluted and not too readable."}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 656, "user_id": 5721702, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WDGk4.png?s=128&g=1", "display_name": "Huy-Anh Hoang", "link": "https://stackoverflow.com/users/5721702/huy-anh-hoang"}, "edited": false, "score": 1, "creation_date": 1507175849, "post_id": 46560572, "comment_id": 80108213, "body": "This is pretty much how problems like this are handled. Some people prefer to rely exclusively on channels but there&#39;s nothing wrong with wait groups. As for readability, the issue might be with understanding the flow of code. And that is something you&#39;ll get comfortable with as you work with the language more."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 9, "last_activity_date": 1507107331, "last_edit_date": 1507107331, "creation_date": 1507106584, "answer_id": 46560572, "question_id": 46560204, "link": "https://stackoverflow.com/questions/46560204/why-does-my-code-work-correctly-when-i-run-wg-wait-inside-a-goroutine/46560572#46560572", "title": "Why does my code work correctly when I run wg.Wait() inside a goroutine?", "body": "<p>You need to wait for goroutines to finish in a separate thread because <code>queue</code> needs to be read from. When you do the following:</p>\n\n<pre><code>queue := make(chan Activity)\nfor i, activityURL := range urls {\n    wg.Add(1)\n    go func(i int, url string) {\n        defer wg.Done()\n        activity, err := extractDetail(url)\n        if err != nil {\n            log.Println(err)\n            return\n        }\n        queue &lt;- activity // nothing is reading data from queue.\n    }(i, activityURL)\n}\n\nwg.Wait() \nclose(queue)\n\nfor a := range queue {\n    activities = append(activities, a)\n}\n</code></pre>\n\n<p>Each goroutine blocks at <code>queue &lt;- activity</code> since <code>queue</code> is unbuffered and nothing is reading data from it. This is because the range loop on <code>queue</code> is in the main thread after <code>wg.Wait</code>.</p>\n\n<p><code>wg.Wait</code> will only unblock once all the goroutine return. But as mentioned, all the goroutines are blocked at channel send.</p>\n\n<p>When you use a separate goroutine to wait, code execution actually reaches the range loop on <code>queue</code>.</p>\n\n<pre><code>// wg.Wait does not block the main thread.\ngo func() {\n    wg.Wait()\n    close(queue)\n}()\n</code></pre>\n\n<p>This results in the goroutines unblocking at the <code>queue &lt;- activity</code> statement (main thread starts reading off <code>queue</code>) and running until completion. Which in turn calls each individual <code>wg.Done</code>.</p>\n\n<p>Once the waiting goroutine get past <code>wg.Wait</code>, <code>queue</code> is closed and the main thread exits the range loop on it.</p>\n"}, {"comments": [{"owner": {"reputation": 656, "user_id": 5721702, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WDGk4.png?s=128&g=1", "display_name": "Huy-Anh Hoang", "link": "https://stackoverflow.com/users/5721702/huy-anh-hoang"}, "edited": false, "score": 0, "creation_date": 1507151200, "post_id": 46560750, "comment_id": 80101918, "body": "You mean calling the reader first in a goroutine then calling the waiter without the goroutine? I tried this and it returned 3 results inside my slice instead of the expected 4. I suspect it has to do with closing the queue a little bit too early after all the <code>wg.Done()</code> were reached and the slice was returned before the last item could be appended."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 656, "user_id": 5721702, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WDGk4.png?s=128&g=1", "display_name": "Huy-Anh Hoang", "link": "https://stackoverflow.com/users/5721702/huy-anh-hoang"}, "edited": false, "score": 0, "creation_date": 1507171698, "post_id": 46560750, "comment_id": 80107318, "body": "Yes. In this case you need to need to wait until reader finishes otherwise last record could be lost."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1507107169, "creation_date": 1507107169, "answer_id": 46560750, "question_id": 46560204, "link": "https://stackoverflow.com/questions/46560204/why-does-my-code-work-correctly-when-i-run-wg-wait-inside-a-goroutine/46560750#46560750", "title": "Why does my code work correctly when I run wg.Wait() inside a goroutine?", "body": "<p><code>queue</code> channel is unbuffered so every goroutine trying to write to it gets blocked because reader process is not yet started. So no goroutinte can write and they all hang - as a result <code>wg.Wait</code> waits forever.\nTry to launch reader in a separate goroutine:</p>\n\n<pre><code>go func() {\n    for a := range queue {\n        // block channel until valid url is added to queue\n        // once all are added, close it\n       activities = append(activities, a)\n    }\n}()\n</code></pre>\n\n<p>and then start waiter:</p>\n\n<pre><code>wg.Wait() \nclose(queue)\n</code></pre>\n\n<p>This way you can not to accumulate all the data in channel and overload it, but get data as it comes and put to target slice.</p>\n"}], "owner": {"reputation": 656, "user_id": 5721702, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WDGk4.png?s=128&g=1", "display_name": "Huy-Anh Hoang", "link": "https://stackoverflow.com/users/5721702/huy-anh-hoang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 928, "favorite_count": 2, "accepted_answer_id": 46560572, "answer_count": 2, "score": 6, "last_activity_date": 1507107331, "creation_date": 1507105309, "question_id": 46560204, "link": "https://stackoverflow.com/questions/46560204/why-does-my-code-work-correctly-when-i-run-wg-wait-inside-a-goroutine", "title": "Why does my code work correctly when I run wg.Wait() inside a goroutine?", "body": "<p>I have a list of urls that I am scraping. What I want to do is store all of the successfully scraped page data into a channel, and when I am done, dump it into a slice. I don't know how many successful fetches I will get, so I cannot specify a fixed length. I expected the code to reach <code>wg.Wait()</code> and then wait until all the <code>wg.Done()</code> methods are called, but I never reached the <code>close(queue)</code> statement. Looking for a similar answer, I came across this SO answer</p>\n\n<p><a href=\"https://stackoverflow.com/a/31573574/5721702\">https://stackoverflow.com/a/31573574/5721702</a></p>\n\n<p>where the author does something similar:</p>\n\n<pre><code>ports := make(chan string)\ntoScan := make(chan int)\nvar wg sync.WaitGroup\n\n// make 100 workers for dialing\nfor i := 0; i &lt; 100; i++ {\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        for p := range toScan {\n            ports &lt;- worker(*host, p)\n        }\n    }()\n}\n\n// close our receiving ports channel once all workers are done\ngo func() {\n    wg.Wait()\n    close(ports)\n}()\n</code></pre>\n\n<p>As soon as I wrapped my <code>wg.Wait()</code> inside the goroutine, <code>close(queue)</code> was reached:</p>\n\n<pre><code>urls := getListOfURLS()\nactivities := make([]Activity, 0, limit)\nqueue := make(chan Activity)\nfor i, activityURL := range urls {\n    wg.Add(1)\n    go func(i int, url string) {\n        defer wg.Done()\n        activity, err := extractDetail(url)\n        if err != nil {\n            log.Println(err)\n            return\n        }\n        queue &lt;- activity\n    }(i, activityURL)\n}\n    // calling it like this without the goroutine causes the execution to hang\n// wg.Wait() \n// close(queue)\n\n    // calling it like this successfully waits\ngo func() {\n    wg.Wait()\n    close(queue)\n}()\nfor a := range queue {\n    // block channel until valid url is added to queue\n    // once all are added, close it\n    activities = append(activities, a)\n}\n</code></pre>\n\n<p>Why does the code not reach the <code>close</code> if I don't use a goroutine for <code>wg.Wait()</code>? I would think that the all of the <code>defer wg.Done()</code> statements are called so eventually it would clear up, because it gets to the <code>wg.Wait()</code>. Does it have to do with receiving values in my channel?</p>\n"}, {"tags": ["go", "environment-variables", "goinstall"], "comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1507102504, "post_id": 46559217, "comment_id": 80072510, "body": "Do you want to compile these settings into the application?"}, {"owner": {"reputation": 7297, "user_id": 5604676, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/CQ3zk.jpg?s=128&g=1", "display_name": "Sergii Bishyr", "link": "https://stackoverflow.com/users/5604676/sergii-bishyr"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1507102613, "post_id": 46559217, "comment_id": 80072572, "body": "@EugeneLisitsky what do you mean by compiling the settings into the application? The application is going to use it, of course."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1507102744, "post_id": 46559217, "comment_id": 80072649, "body": "Put them in source file and read from it. What task do you want to solve? That the purpose: fix settings? Hide them?"}, {"owner": {"reputation": 7297, "user_id": 5604676, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/CQ3zk.jpg?s=128&g=1", "display_name": "Sergii Bishyr", "link": "https://stackoverflow.com/users/5604676/sergii-bishyr"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1507103020, "post_id": 46559217, "comment_id": 80072799, "body": "@EugeneLisitsky I need some simple configs that can be changed by the users without changing the source code. Something like <code>.gitconfig</code> or so."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1507104149, "post_id": 46559217, "comment_id": 80073420, "body": "No, <code>go install</code> cannot do this."}], "answers": [{"comments": [{"owner": {"reputation": 7297, "user_id": 5604676, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/CQ3zk.jpg?s=128&g=1", "display_name": "Sergii Bishyr", "link": "https://stackoverflow.com/users/5604676/sergii-bishyr"}, "edited": false, "score": 0, "creation_date": 1507104821, "post_id": 46559848, "comment_id": 80073737, "body": "So, taking <code>git</code> as an example does it mean that <code>.gitconfig</code> file won&#39;t exist until the first execution of the <code>git</code> command? And if user what to change the configs before running <code>git</code> command he has to create that file manually?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 7297, "user_id": 5604676, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/CQ3zk.jpg?s=128&g=1", "display_name": "Sergii Bishyr", "link": "https://stackoverflow.com/users/5604676/sergii-bishyr"}, "edited": false, "score": 2, "creation_date": 1507104953, "post_id": 46559848, "comment_id": 80073831, "body": "@SergiiBishyr Something like that. It&#39;s up to your use case. If config file does not exist, your app should create a default one, and may even terminate without doing anything, notifying the user to review the config the app just created."}, {"owner": {"reputation": 7297, "user_id": 5604676, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/CQ3zk.jpg?s=128&g=1", "display_name": "Sergii Bishyr", "link": "https://stackoverflow.com/users/5604676/sergii-bishyr"}, "edited": false, "score": 0, "creation_date": 1507105498, "post_id": 46559848, "comment_id": 80074131, "body": "Thanks a lot! It&#39;s a little disappointing that <code>go install</code> can&#39;t do that as I tought it&#39;s a common use-case."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1507104152, "creation_date": 1507104152, "answer_id": 46559848, "question_id": 46559217, "link": "https://stackoverflow.com/questions/46559217/go-install-execute-custom-action/46559848#46559848", "title": "Go install. Execute custom action", "body": "<p><code>go install</code> can't set environment variables and can't create config files for you.</p>\n\n<p>The best practice is to have sensible defaults \"built\" into the app. The app should provide some options to override the defaults, e.g. command line flags, environment variables and config files.</p>\n\n<p>If overrides (config files) do not exist, the app may create default config files on startup, and the app may even notify the user with a warning message that configuration did not exist, so the default settings will be used, and the app just created one with the defaults which the user can change / modify.</p>\n"}], "owner": {"reputation": 7297, "user_id": 5604676, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/CQ3zk.jpg?s=128&g=1", "display_name": "Sergii Bishyr", "link": "https://stackoverflow.com/users/5604676/sergii-bishyr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507104152, "creation_date": 1507101811, "question_id": 46559217, "link": "https://stackoverflow.com/questions/46559217/go-install-execute-custom-action", "title": "Go install. Execute custom action", "body": "<p>I have a CLI Go application. This application is reading some environment variables, and reading a custom config file. \nAnd I don't want this env-variable to be set manually or the config file to be created manually. It would be great if these actions would be made by <code>go install</code> command.\nHowever, I haven't found a way to execute some additional actions during <code>go install</code>. \nIs it possible and what are the best practices to do so?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 3, "creation_date": 1507100721, "post_id": 46558824, "comment_id": 80071521, "body": "<code>os.Stat</code> returns an <code>os.FileInfo</code> type which is an interface type. <code>Size</code> is a method on the returned type, not a field. <code>0xc420031f58</code> is the address of the function <code>Size</code>. <a href=\"https://golang.org/pkg/os/#FileInfo\" rel=\"nofollow noreferrer\">golang.org/pkg/os/#FileInfo</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1507100981, "post_id": 46558824, "comment_id": 80071666, "body": "Sidenote: <code>fmt.Errorf</code> does not what you think it does. Much like printing an os.FileInfos Size field. How about looking up the documentation for all functions/methods used?"}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1507108645, "post_id": 46558824, "comment_id": 80075980, "body": "Oh, oops. I was supposed to do <code>Size()</code>. Nice catch."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1507108705, "post_id": 46558824, "comment_id": 80076012, "body": "Well, <code>Size()</code> returns <code>0</code>, so that certainly isn&#39;t it. I believe that is more of an OS thing, since <code># stat &#47;dev&#47;sda1</code> gives <code>Size: 0</code>"}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1507109124, "post_id": 46558824, "comment_id": 80076281, "body": "&quot;Sidenote: fmt.Errorf does not...&quot; I don&#39;t particularly care, @volker. Copy-paste and edit the minimum necessary to show what works/doesn&#39;t. I care about getting it working, not purity of the example on SO."}, {"owner": {"reputation": 2382, "user_id": 1052899, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z8orf.jpg?s=128&g=1", "display_name": "Fabiano Tarlao", "link": "https://stackoverflow.com/users/1052899/fabiano-tarlao"}, "edited": false, "score": 0, "creation_date": 1544291546, "post_id": 46558824, "comment_id": 94227181, "body": "@deitch have you found an answer to your question? I&#39;m looking to exactly the same thing"}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 2382, "user_id": 1052899, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z8orf.jpg?s=128&g=1", "display_name": "Fabiano Tarlao", "link": "https://stackoverflow.com/users/1052899/fabiano-tarlao"}, "edited": false, "score": 0, "creation_date": 1544310219, "post_id": 46558824, "comment_id": 94232166, "body": "Not that I recall @FabianoTarlao. Sorry. This was a year ago, trying to recall which project it was that was using it..."}, {"owner": {"reputation": 2382, "user_id": 1052899, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z8orf.jpg?s=128&g=1", "display_name": "Fabiano Tarlao", "link": "https://stackoverflow.com/users/1052899/fabiano-tarlao"}, "edited": false, "score": 0, "creation_date": 1544521223, "post_id": 46558824, "comment_id": 94295973, "body": "Ok, I think I&#39;ll change from Golang to C++, but I&#39;m just curious about the solution you found :-("}], "answers": [{"comments": [{"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 1, "creation_date": 1507109015, "post_id": 46559181, "comment_id": 80076211, "body": "Ah, very good point, thank you @icza. So, how would I actually get it <i>without</i> mounting? I can do it in C with the right <code>ioctl</code> call (edited question), is there a go-native method?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 6, "last_activity_date": 1507102614, "last_edit_date": 1507102614, "creation_date": 1507101667, "answer_id": 46559181, "question_id": 46558824, "link": "https://stackoverflow.com/questions/46558824/how-do-i-get-a-block-devices-size-correctly-in-go/46559181#46559181", "title": "How do I get a block device&#39;s size correctly in go?", "body": "<p>When calling <a href=\"https://golang.org/pkg/syscall/#Statfs\" rel=\"nofollow noreferrer\"><code>syscall.Statfs()</code></a>, you have to pass the <strong>path where the device is mounted</strong>, e.g. <code>/</code>, and not the device file (not <code>/dev/sda1</code>). In your case this is <code>/var</code>.</p>\n\n<p>You get the result in a value of type <a href=\"https://golang.org/pkg/syscall/#Statfs_t\" rel=\"nofollow noreferrer\"><code>syscall.Statfs_t</code></a>. Interpretation:</p>\n\n<pre><code>var stat syscall.Statfs_t\nif err := syscall.Statfs(\"/\", &amp;stat); err != nil {\n    panic(err)\n}\n\nsize := stat.Blocks * uint64(stat.Bsize)\nfree := stat.Bfree * uint64(stat.Bsize)\navail := stat.Bavail * uint64(stat.Bsize)\nfmt.Println(\"Size:\", size)\nfmt.Println(\"Free:\", free)\nfmt.Println(\"Available:\", avail)\nfmt.Println(\"Used:\", size-free)\n</code></pre>\n\n<p>See this possible duplicate: <a href=\"https://stackoverflow.com/questions/20108520/get-amount-of-free-disk-space-using-go\">Get amount of free disk space using Go</a></p>\n"}, {"comments": [{"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1567885263, "post_id": 57822606, "comment_id": 102102186, "body": "This is very nice. I hadn&#39;t thought of it. Is it accurate? I get slightly off numbers. <a href=\"https://gist.github.com/deitch/20c611e60f240eea7591bd973a0d5915\" rel=\"nofollow noreferrer\">gist.github.com/deitch/20c611e60f240eea7591bd973a0d5915</a>"}, {"owner": {"reputation": 1201, "user_id": 1375752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ebfb522fcaed2bbbde1faca252c9dcd?s=128&d=identicon&r=PG", "display_name": "smoser", "link": "https://stackoverflow.com/users/1375752/smoser"}, "reply_to_user": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1568034554, "post_id": 57822606, "comment_id": 102135618, "body": "The OP asked how to get the size of a block device.  The io.Seek answer is the correct answer.  The block device in your gist can store 53686025728 bytes of data. Which is 1065472 bytes shy of 50GiB (<a href=\"https://en.wikipedia.org/wiki/Gibibyte\" rel=\"nofollow noreferrer\">GiB vs GB</a>)."}, {"owner": {"reputation": 1201, "user_id": 1375752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ebfb522fcaed2bbbde1faca252c9dcd?s=128&d=identicon&r=PG", "display_name": "smoser", "link": "https://stackoverflow.com/users/1375752/smoser"}, "reply_to_user": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1568037024, "post_id": 57822606, "comment_id": 102136985, "body": "I updated the answer to try to explain filesystem vs block device."}, {"owner": {"reputation": 1372, "user_id": 2891692, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/2Lf2V.jpg?s=128&g=1", "display_name": "SL5net", "link": "https://stackoverflow.com/users/2891692/sl5net"}, "edited": false, "score": 0, "creation_date": 1574200270, "post_id": 57822606, "comment_id": 104145193, "body": "your example gets me same value for system partition and mounted NAS:  <code>&#47;mnt&#47;ix4300d is 9223372036854775807 bytes. &#47; is 9223372036854775807 bytes.</code> Value of NAS is wrong for me."}], "tags": [], "owner": {"reputation": 1201, "user_id": 1375752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ebfb522fcaed2bbbde1faca252c9dcd?s=128&d=identicon&r=PG", "display_name": "smoser", "link": "https://stackoverflow.com/users/1375752/smoser"}, "is_accepted": true, "score": 1, "last_activity_date": 1568036989, "last_edit_date": 1568036989, "creation_date": 1567775062, "answer_id": 57822606, "question_id": 46558824, "link": "https://stackoverflow.com/questions/46558824/how-do-i-get-a-block-devices-size-correctly-in-go/57822606#57822606", "title": "How do I get a block device&#39;s size correctly in go?", "body": "<p>The OP asked how to get the size of a <em>block device</em>. To get the size of a block device (or any file), you can File.Seek to the end of the file using io.SeekEnd and read the position returned.  Credit to others for <a href=\"https://stackoverflow.com/a/2774125/1375752\">python</a> and <a href=\"https://unix.stackexchange.com/a/52226/370407\">C</a>.</p>\n\n<p>Running the example <code>getsize.go</code> below shows:</p>\n\n<pre><code>$ sudo go run getsize.go /dev/sda\n/dev/sda is 256060514304 bytes.\n</code></pre>\n\n<p><code>lsblk --bytes /dev/device</code> will give you the same information.  That is how much data the <em>block device</em> can store.</p>\n\n<p>The <code>Statfs_t</code> path, and <code>df /path/to/mounted/filesystem</code> will give you information about how much data you can store in the <em>filesystem</em> mounted at  provided path.  Filesystems have overhead, probably in the 2-5% range depending on details of the filesystem, and also keep track of how much space is <code>Free</code> or <code>Used</code>.</p>\n\n<p>There is no api that I am aware of that can provide information about unmounted filesystems on a block device.  <code>dumpe2fs</code> can give you that information for the ext{2,3,4} filesystems.  There likely exist tools for other filesystems.  Such tools are filesystem specific. When you mount the filesystem, then the linux kernel's filesystem driver exposes that information that is returned by <code>df</code>.</p>\n\n<p>Code:</p>\n\n<pre><code>// getsize.go: get the size of a block device or file\npackage main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\nfunc main() {\n    var path string\n    if len(os.Args) &lt; 2 {\n        fmt.Println(\"Give path to file/disk\")\n        os.Exit(1)\n    }\n    path = os.Args[1]\n    file, err := os.Open(path)\n    if err != nil {\n        fmt.Printf(\"error opening %s: %s\\n\", path, err)\n        os.Exit(1)\n    }\n    pos, err := file.Seek(0, io.SeekEnd)\n    if err != nil {\n        fmt.Printf(\"error seeking to end of %s: %s\\n\", path, err)\n        os.Exit(1)\n    }\n    fmt.Printf(\"%s is %d bytes.\\n\", path, pos)\n}\n</code></pre>\n"}], "owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1766, "favorite_count": 1, "accepted_answer_id": 57822606, "answer_count": 2, "score": 4, "last_activity_date": 1568036989, "creation_date": 1507100423, "last_edit_date": 1507108983, "question_id": 46558824, "link": "https://stackoverflow.com/questions/46558824/how-do-i-get-a-block-devices-size-correctly-in-go", "title": "How do I get a block device&#39;s size correctly in go?", "body": "<p>EDITED: as @abhink pointed out, was not invoking <code>Size()</code>.</p>\n\n<p>I tried two different go methods, and then compared to <code>df</code>. Of course, all 3 give different results:</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"syscall\"\n    \"fmt\"\n)\n\nfunc main() {\n    disk := \"/dev/sda1\"\n    statout, err := os.Stat(disk)\n    if err != nil {\n        fmt.Errorf(\"Error %x\", err)\n        os.Exit(1)\n    }\n    println(\"os.Stat Size   : \", statout.Size())\n\n    var stat syscall.Statfs_t\n    syscall.Statfs(disk, &amp;stat)\n    println(\"syscall.Statfs_t Type: \",  stat.Type)\n    println(\"syscall.Statfs_t Bsize: \",  stat.Bsize)\n    println(\"syscall.Statfs_t Blocks: \",  stat.Blocks)\n}\n</code></pre>\n\n<p>Running the programs:</p>\n\n<pre><code>$ main\nos.Stat Size   :  0\nsyscall.Statfs_t Type: 16914836\nsyscall.Statfs_t Bsize: 4096\nsyscall.Statfs_t Blocks: 2560\n</code></pre>\n\n<p>And df:</p>\n\n<pre><code>$ df /dev/sda1\nFilesystem           1K-blocks      Used Available Use% Mounted on\n/dev/sda1             65792556  43694068  18726712  70% /var\n</code></pre>\n\n<p>Net:</p>\n\n<ul>\n<li><code>os.Stat()</code> gives <code>0</code> which it is not, but might be an OS issue.</li>\n<li><code>syscall.Statfs()</code> gives 2560 blocks * 4096 block size = <code>10,485,760</code>. More realistic, but still incorrect</li>\n<li><code>df</code> gives 65792556 1K-blocks * 1024 bytes / K = <code>67,371,577,344</code></li>\n</ul>\n\n<p>How do I reliably get the size of a block device without mounting it?</p>\n\n<p>Essentially, I am looking for the equivalent of the <code>ioctl</code> call on the device. </p>\n\n<pre><code>ioctl(fd,BLKGETSIZE64,&amp;size)\n</code></pre>\n"}, {"tags": ["go", "gccgo"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1507100828, "post_id": 46558696, "comment_id": 80071580, "body": "A typo somewhere in LDFLAGS."}, {"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 0, "creation_date": 1507100951, "post_id": 46558696, "comment_id": 80071647, "body": "Yeah, probably supposed to be <code>--plugin</code> and got converted to <code>-lugin</code> (-p) accidentally deleted?  Gold uses <code>--plugin</code> and <code>--plugin-opt=...</code>"}, {"owner": {"reputation": 237, "user_id": 4756623, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/RHAFC.jpg?s=128&g=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4756623/alex"}, "edited": false, "score": 0, "creation_date": 1507100988, "post_id": 46558696, "comment_id": 80071671, "body": "Are you saying &quot;-lugin&quot; is the typo? Unfortunately, this is the exact error message I got."}], "answers": [{"tags": [], "owner": {"reputation": 1872, "user_id": 2104472, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/18805ffb0c3acfbd23cd6c84951afafc?s=128&d=identicon&r=PG&f=1", "display_name": "Vladislav Ivanishin", "link": "https://stackoverflow.com/users/2104472/vladislav-ivanishin"}, "is_accepted": false, "score": 0, "last_activity_date": 1522068027, "creation_date": 1522068027, "answer_id": 49491719, "question_id": 46558696, "link": "https://stackoverflow.com/questions/46558696/build-gccgo-got-linker-error/49491719#49491719", "title": "build gccgo got linker error", "body": "<p>You should pass <code>--enable-plugins</code> to <code>configure</code> when you build binutils to be able to use plugins with <code>ld.gold</code> (the plugin interface is enabled by default for new enough versions of <code>ld.bfd</code>, the traditional GNU linker).</p>\n\n<p>See this bug: <a href=\"https://sourceware.org/bugzilla/show_bug.cgi?id=22500\" rel=\"nofollow noreferrer\">https://sourceware.org/bugzilla/show_bug.cgi?id=22500</a></p>\n"}], "owner": {"reputation": 237, "user_id": 4756623, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/RHAFC.jpg?s=128&g=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4756623/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 225, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1522068027, "creation_date": 1507099975, "last_edit_date": 1507180670, "question_id": 46558696, "link": "https://stackoverflow.com/questions/46558696/build-gccgo-got-linker-error", "title": "build gccgo got linker error", "body": "<p>I am building gccgo given the instruction <a href=\"https://golang.org/doc/install/gccgo\" rel=\"nofollow noreferrer\">here</a>. However, I got error message after I did:</p>\n\n<pre><code>../gccgo/configure --prefix=/opt/gccgo --enable-languages=c,c++,go --with-ld=/opt/gold/bin/ld  \nmake\n</code></pre>\n\n<p>Error:</p>\n\n<blockquote>\n  <p>/opt/gold/bin/ld: error: cannot find -lugin<br>\n  /opt/gold/bin/ld: error: cannot find -lugin-opt=/home/objdir/./gcc/lto-wrapper<br>\n  /opt/gold/bin/ld: error: cannot find -lugin-opt=-fresolution=/tmp/cc9M7ZGm.res</p>\n</blockquote>\n\n<p>Here is what source code I used:</p>\n\n<p>os: ubuntu 14.04/x86_64<br>\nbinutils: <a href=\"http://ftp.gnu.org/gnu/binutils/binutils-2.29.tar.xz\" rel=\"nofollow noreferrer\">http://ftp.gnu.org/gnu/binutils/binutils-2.29.tar.xz</a><br>\ngccgo code brach: <a href=\"https://github.com/gcc-mirror/gcc/tree/gccgo\" rel=\"nofollow noreferrer\">https://github.com/gcc-mirror/gcc/tree/gccgo</a></p>\n\n<p>Is there anything that I missed?</p>\n\n<p><strong>Update</strong>: It works for me after I remove the <code>--with-ld==/opt/gold/bin/ld</code> option when running configure for gccgo make. Seems this is an issue related to gold.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1507099187, "post_id": 46558252, "comment_id": 80070756, "body": "Since <code>viper.GetString</code> return <code>string</code> (not a pointer), it won&#39;t be null. Do you mean that the return value is <i>empty string</i>? First, check whether the key exists or not by <code>viper.IsSet</code>."}, {"owner": {"reputation": 11, "user_id": 8718174, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ZM93le493Ag/AAAAAAAAAAI/AAAAAAAAAEg/GoOWdI-fR4A/photo.jpg?sz=128", "display_name": "\u0418\u043b\u044c\u044f \u041f\u043e\u043a\u0440\u043e\u0432\u0441\u043a\u0438\u0439", "link": "https://stackoverflow.com/users/8718174/%d0%98%d0%bb%d1%8c%d1%8f-%d0%9f%d0%be%d0%ba%d1%80%d0%be%d0%b2%d1%81%d0%ba%d0%b8%d0%b9"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1507100117, "post_id": 46558252, "comment_id": 80071216, "body": "sorry, yes, string is empty. Key exists, because when I&#39;m using getString  inside func it gives me a value which i need."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1507100540, "post_id": 46558252, "comment_id": 80071419, "body": "It means that <code>viper.GetString</code> is called before viper configuration is initialized, e.g. by <code>viper.ReadConfig</code> etc. Use <a href=\"https://stackoverflow.com/questions/24790175/when-is-the-init-function-run\"><code>init()</code></a> function."}, {"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 0, "creation_date": 1507101636, "post_id": 46558252, "comment_id": 80072052, "body": "Probably more of a style difference, but I&#39;d prefer the <code>viper.ReadConfig</code> etc. to be in the <code>main()</code> function, and retrieving the values inside of the functions that use it rather than as a package var initialization."}, {"owner": {"reputation": 11, "user_id": 8718174, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ZM93le493Ag/AAAAAAAAAAI/AAAAAAAAAEg/GoOWdI-fR4A/photo.jpg?sz=128", "display_name": "\u0418\u043b\u044c\u044f \u041f\u043e\u043a\u0440\u043e\u0432\u0441\u043a\u0438\u0439", "link": "https://stackoverflow.com/users/8718174/%d0%98%d0%bb%d1%8c%d1%8f-%d0%9f%d0%be%d0%ba%d1%80%d0%be%d0%b2%d1%81%d0%ba%d0%b8%d0%b9"}, "edited": false, "score": 0, "creation_date": 1507107189, "post_id": 46558252, "comment_id": 80075078, "body": "well I follow Your advice, it works now. Thank You so much for Your help!"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 8718174, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ZM93le493Ag/AAAAAAAAAAI/AAAAAAAAAEg/GoOWdI-fR4A/photo.jpg?sz=128", "display_name": "\u0418\u043b\u044c\u044f \u041f\u043e\u043a\u0440\u043e\u0432\u0441\u043a\u0438\u0439", "link": "https://stackoverflow.com/users/8718174/%d0%98%d0%bb%d1%8c%d1%8f-%d0%9f%d0%be%d0%ba%d1%80%d0%be%d0%b2%d1%81%d0%ba%d0%b8%d0%b9"}, "edited": false, "score": 0, "creation_date": 1507100938, "post_id": 46558805, "comment_id": 80071637, "body": "well viper initialization is in a main() function You&#39;re guessing right (and excuse me, i missed it), but variable init is in another package"}, {"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "reply_to_user": {"reputation": 11, "user_id": 8718174, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ZM93le493Ag/AAAAAAAAAAI/AAAAAAAAAEg/GoOWdI-fR4A/photo.jpg?sz=128", "display_name": "\u0418\u043b\u044c\u044f \u041f\u043e\u043a\u0440\u043e\u0432\u0441\u043a\u0438\u0439", "link": "https://stackoverflow.com/users/8718174/%d0%98%d0%bb%d1%8c%d1%8f-%d0%9f%d0%be%d0%ba%d1%80%d0%be%d0%b2%d1%81%d0%ba%d0%b8%d0%b9"}, "edited": false, "score": 0, "creation_date": 1507101153, "post_id": 46558805, "comment_id": 80071755, "body": "Yeah, see <a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Package_initialization</a> and <a href=\"https://golang.org/doc/effective_go.html#initialization\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#initialization</a>.  Probably the other package is initializing viper after this variable is assigned"}, {"owner": {"reputation": 11, "user_id": 8718174, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ZM93le493Ag/AAAAAAAAAAI/AAAAAAAAAEg/GoOWdI-fR4A/photo.jpg?sz=128", "display_name": "\u0418\u043b\u044c\u044f \u041f\u043e\u043a\u0440\u043e\u0432\u0441\u043a\u0438\u0439", "link": "https://stackoverflow.com/users/8718174/%d0%98%d0%bb%d1%8c%d1%8f-%d0%9f%d0%be%d0%ba%d1%80%d0%be%d0%b2%d1%81%d0%ba%d0%b8%d0%b9"}, "edited": false, "score": 0, "creation_date": 1507102910, "post_id": 46558805, "comment_id": 80072737, "body": "well, i edited my question a bit, i cannot realize why the method inside the function returns right value, but the outside call gives empty. if it would be reinitialization it wouldn&#39;t give me a config value."}], "tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": false, "score": 0, "last_activity_date": 1507101480, "last_edit_date": 1507101480, "creation_date": 1507100366, "answer_id": 46558805, "question_id": 46558252, "link": "https://stackoverflow.com/questions/46558252/viper-cannot-get-the-value-initialized-outside-the-functions/46558805#46558805", "title": "Viper, cannot get the value initialized outside the functions", "body": "<p>I suspect that doing package variable initialization as you show will lead to the viper configuration not being complete before performing the <code>GetString()</code>, and therefore the zero (empty) string value is what is returned.  Without seeing how you initialize your viper config, I'm guessing that it's not in an <code>init()</code> function, but is in a <code>main()</code> function that hasn't run yet when the package variable is assigned.</p>\n\n<p>You should probably retrieve the <code>viper.GetString(\"db.host\")</code> inside the highest level function that needs it rather than during package initialization.</p>\n"}], "owner": {"reputation": 11, "user_id": 8718174, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ZM93le493Ag/AAAAAAAAAAI/AAAAAAAAAEg/GoOWdI-fR4A/photo.jpg?sz=128", "display_name": "\u0418\u043b\u044c\u044f \u041f\u043e\u043a\u0440\u043e\u0432\u0441\u043a\u0438\u0439", "link": "https://stackoverflow.com/users/8718174/%d0%98%d0%bb%d1%8c%d1%8f-%d0%9f%d0%be%d0%ba%d1%80%d0%be%d0%b2%d1%81%d0%ba%d0%b8%d0%b9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1192, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507112022, "creation_date": 1507098158, "last_edit_date": 1507112022, "question_id": 46558252, "link": "https://stackoverflow.com/questions/46558252/viper-cannot-get-the-value-initialized-outside-the-functions", "title": "Viper, cannot get the value initialized outside the functions", "body": "<p>I have a problem using a viper, I have assigned variable by viper method, so when I try to get value inside any function I have a null value. Does anybody have any idea why does it happen so? Any other variables initialization works fine, but not viper GetString method.</p>\n\n<p>Structure:\nmain.go</p>\n\n<pre><code>    package main\n\n    import (\n        \"project/Model\"\n        \"github.com/spf13/viper\"\n        ...\n    )\n\n    func main() {\n        //Config handling\n        viper.SetConfigName(\"main\")\n        viper.AddConfigPath(\"/config/\")\n        err = viper.ReadInConfig()\n        ...\n    }\n</code></pre>\n\n<p>Package Model</p>\n\n<pre><code>    package Model\n\n    import (\"github.com/spf13/viper\"\n        ...\n    )\n\n    var sqlhost = viper.GetString(\"db.host\")\n\n    func foo() {\n        log.Println(sqlhost)\n    }    \n</code></pre>\n"}, {"tags": ["go", "atomicity"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1507095992, "post_id": 46556857, "comment_id": 80069397, "body": "The first is guaranteed to be atomic, the second not."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 9, "last_activity_date": 1507092130, "last_edit_date": 1592644375, "creation_date": 1507091679, "answer_id": 46557083, "question_id": 46556857, "link": "https://stackoverflow.com/questions/46556857/is-atomic-loaduint32-necessary/46557083#46557083", "title": "Is atomic.LoadUint32 necessary?", "body": "<blockquote>\n<p>which basically load the value from the memory address and return it.</p>\n</blockquote>\n<p>That is the case in your context, but might differ on a different machine architecture where <strong><a href=\"http://www.1024cores.net/home/lock-free-algorithms/so-what-is-a-memory-model-and-how-to-cook-it\" rel=\"noreferrer\">atomicity</a></strong> is to be implemented, as <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/CJwyejWMTBQ\" rel=\"noreferrer\">discussed here</a>.<br />\nAs mentioned in <a href=\"https://github.com/golang/go/issues/8739#issuecomment-270486766\" rel=\"noreferrer\">go issue 8739</a></p>\n<blockquote>\n<p>We intrinsify both <code>sync/atomic</code> and <code>runtime/internal/atomic</code> for a bunch of architectures.<br />\nThe APIs are not unified (e.g. <a href=\"https://golang.org/pkg/sync/atomic/#LoadUint32\" rel=\"noreferrer\"><code>LoadUint32</code></a> in <a href=\"https://golang.org/pkg/sync/atomic/\" rel=\"noreferrer\"><code>sync/atomic</code></a> is <a href=\"https://golang.org/pkg/runtime/internal/atomic/#Load\" rel=\"noreferrer\"><code>Load</code></a> in <a href=\"https://golang.org/pkg/runtime/internal/atomic/\" rel=\"noreferrer\"><code>runtime/internal/atomic</code></a>).</p>\n</blockquote>\n<p>(* &quot;intrinsify&quot; as in <a href=\"https://github.com/golang/go/issues/4947\" rel=\"noreferrer\">issue 4947</a>)</p>\n<p>As mentioned in my first link:</p>\n<blockquote>\n<p>Regarding loads and stores.</p>\n<p>Memory model along with instruction set specifies whether plain loads and stores are atomic or not. Typical guarantee for all modern commodity hardware is that aligned word-sized loads and stores are atomic. For example, on x86 architecture (IA-32 and Intel 64) 1-, 2-, 4-, 8- and 16-byte aligned loads and stores are all atomic (that is, plain <code>MOV</code> instruction, <code>MOVQ</code> and <code>MOVDQA</code> are atomic).</p>\n</blockquote>\n"}], "owner": {"reputation": 117, "user_id": 3746949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8209cd3f2211066ddf31eb9b1040b3c2?s=128&d=identicon&r=PG&f=1", "display_name": "Yuguang", "link": "https://stackoverflow.com/users/3746949/yuguang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1292, "favorite_count": 3, "accepted_answer_id": 46557083, "answer_count": 1, "score": 5, "last_activity_date": 1611833136, "creation_date": 1507090078, "last_edit_date": 1611833136, "question_id": 46556857, "link": "https://stackoverflow.com/questions/46556857/is-atomic-loaduint32-necessary", "title": "Is atomic.LoadUint32 necessary?", "body": "<p>Go's atomic package provides function <code>func LoadUint32(addr *uint32) (val uint32)</code>. I looked into the assembly implementation:</p>\n<pre><code>TEXT \u00b7LoadUint32(SB),NOSPLIT,$0-12\nMOVQ    addr+0(FP), AX\nMOVL    0(AX), AX\nMOVL    AX, val+8(FP)\nRET\n</code></pre>\n<p>which basically load the value from the memory address and return it.\nI'm wondering if we have a uint32 pointer(addr) <code>x</code>, what is the difference between calling <code>atomic.LoadUint32(x)</code> and directly access it using <code>*x</code>?</p>\n"}, {"tags": ["html", "go"], "comments": [{"owner": {"reputation": 8276, "user_id": 2058552, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rymLy.jpg?s=128&g=1", "display_name": "Mukesh Sharma", "link": "https://stackoverflow.com/users/2058552/mukesh-sharma"}, "edited": false, "score": 0, "creation_date": 1507093983, "post_id": 46556770, "comment_id": 80068669, "body": "<a href=\"https://play.golang.org/p/fcb8ijB7qj\" rel=\"nofollow noreferrer\">play.golang.org/p/fcb8ijB7qj</a>"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1507100873, "post_id": 46556770, "comment_id": 80071611, "body": "Please start with <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">the tutorial</a> and then a <a href=\"https://github.com/golang/go/wiki/Books\" rel=\"nofollow noreferrer\">good book</a>. I appreciate your intent to learn Go, but you should really get certain basics laid in your head first."}], "answers": [{"tags": [], "owner": {"reputation": 1291, "user_id": 6331045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/189f94db303d16b891800f11846bd753?s=128&d=identicon&r=PG&f=1", "display_name": "Laney", "link": "https://stackoverflow.com/users/6331045/laney"}, "is_accepted": false, "score": 0, "last_activity_date": 1507089840, "creation_date": 1507089840, "answer_id": 46556826, "question_id": 46556770, "link": "https://stackoverflow.com/questions/46556770/early-ending-of-code/46556826#46556826", "title": "Early ending of code", "body": "<p>There are many options. For example, you can use channels or <a href=\"https://golang.org/pkg/sync/#example_WaitGroup\" rel=\"nofollow noreferrer\">sync.WaitGroup</a></p>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 1, "last_activity_date": 1507095376, "creation_date": 1507095376, "answer_id": 46557688, "question_id": 46556770, "link": "https://stackoverflow.com/questions/46556770/early-ending-of-code/46557688#46557688", "title": "Early ending of code", "body": "<p>Yes as @Laney mentions this can be done using both Waitgroups and channels. Refer code below.</p>\n\n<p>Waitgroups:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"sync\"\n    \"time\"\n)\n\n// run x tasks at random intervals\n// - a task is a goroutine that runs for 2 seconds.\n// - a task runs concurrently to other task\n// - the interval between task is between 0 and 2 seconds\n\nfunc main() {\n    // set x to the number of tasks\n    x := 4\n    // random numbers generation initialization\n    var wg sync.WaitGroup\n    random := rand.New(rand.NewSource(1234))\n\n    for num := 0; num &lt; x; num++ {\n        // sleep for a random amount of milliseconds             before starting a new task\n        duration := time.Millisecond * time.Duration(random.Intn(2000))\n        time.Sleep(duration)\n        //\n        wg.Add(1)\n        // run a task\n        go func() {\n            // this is the work, expressed by sleeping for 2 seconds\n            time.Sleep(2 * time.Second)\n            fmt.Println(\"task done\")\n            wg.Done()\n        }()\n    }\n    wg.Wait()\n    fmt.Println(\"All tasks done\")\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>task done\ntask done\ntask done\ntask done\nAll tasks done\n</code></pre>\n\n<p>On playground : <a href=\"https://play.golang.org/p/V-olyX9Qm8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/V-olyX9Qm8</a></p>\n\n<p>Using channels:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\n// run x tasks at random intervals\n// - a task is a goroutine that runs for 2 seconds.\n// - a task runs concurrently to other task\n// - the interval between task is between 0 and 2 seconds\n\nfunc main() {\n    //Channel to indicate completion of a task, can be helpful in sending a result value also\n    results := make(chan int)\n    // set x to the number of tasks\n    x := 4\n    t := 0 //task tracker\n    // random numbers generation initialization\n    random := rand.New(rand.NewSource(1234))\n\n    for num := 0; num &lt; x; num++ {\n        // sleep for a random amount of milliseconds             before starting a new task\n        duration := time.Millisecond * time.Duration(random.Intn(2000))\n        time.Sleep(duration)\n        //\n\n        // run a task\n        go func() {\n            // this is the work, expressed by sleeping for 2 seconds\n            time.Sleep(2 * time.Second)\n            fmt.Println(\"task done\")\n            results &lt;- 1 //may be something possibly relevant to the task\n\n        }()\n    }\n    //Iterate over the channel till the number of tasks\n    for result := range results {\n        fmt.Println(\"Got result\", result)\n        t++\n        if t == x {\n            close(results)\n        }\n    }\n    fmt.Println(\"All tasks done\")\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>task done\ntask done\nGot result 1\nGot result 1\ntask done\nGot result 1\ntask done\nGot result 1\nAll tasks done\n</code></pre>\n\n<p>Playground : <a href=\"https://play.golang.org/p/yAFdDj5nhb\" rel=\"nofollow noreferrer\">https://play.golang.org/p/yAFdDj5nhb</a></p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1507098731, "last_edit_date": 1507098731, "creation_date": 1507096157, "answer_id": 46557830, "question_id": 46556770, "link": "https://stackoverflow.com/questions/46556770/early-ending-of-code/46557830#46557830", "title": "Early ending of code", "body": "<p>The program ends when main goroutine ends.\nYou may use: </p>\n\n<ul>\n<li>waitgroup - it gives very convenient way to wait when all tasks are done</li>\n<li>channels - read from channel is blocked until new data arrives or channel gets closed. </li>\n<li>na\u00efve sleep - good only for example purposes</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": false, "score": 1, "last_activity_date": 1507102033, "creation_date": 1507102033, "answer_id": 46559284, "question_id": 46556770, "link": "https://stackoverflow.com/questions/46556770/early-ending-of-code/46559284#46559284", "title": "Early ending of code", "body": "<p>In Go, as most languages, the process will exit when the entrypoint <code>main()</code> function exits.</p>\n\n<p>Because you're spawning a number of goroutines, the main function is ending before the goroutines are all done, causing the process to exit and not finish those goroutines.</p>\n\n<p>As others have suggested, you want to block your <code>main()</code> function until all the goroutines are done, and a couple of the most common ways to do that are either using semaphores (<a href=\"https://golang.org/pkg/sync/#example_WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a>), or channels (<a href=\"https://gobyexample.com/channel-synchronization\" rel=\"nofollow noreferrer\">go by example</a>)</p>\n"}], "owner": {"reputation": 75, "user_id": 6754358, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/BuxFq.jpg?s=128&g=1", "display_name": "Moe Joe", "link": "https://stackoverflow.com/users/6754358/moe-joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 4, "score": 0, "last_activity_date": 1507102033, "creation_date": 1507089353, "question_id": 46556770, "link": "https://stackoverflow.com/questions/46556770/early-ending-of-code", "title": "Early ending of code", "body": "<p>In my code the code is executed before doing all tasks. Whatt\u00e4 do I have to change on my code such that does all tasks before ending?</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n\"math/rand\"\n\"time\"\n)\n\n// run x tasks at random intervals\n// - a task is a goroutine that runs for 2 seconds.\n// - a task runs concurrently to other task\n// - the interval between task is between 0 and 2 seconds\n\nfunc main() {\n// set x to the number of tasks\nx := 4\n// random numbers generation initialization\nrandom := rand.New(rand.NewSource(1234))\n\nfor num := 0; num &lt; x; num++ {\n    // sleep for a random amount of milliseconds             before starting a new task\n    duration := time.Millisecond *                 time.Duration(random.Intn(2000))\n    time.Sleep(duration)\n\n    // run a task\n    go func() {\n        // this is the work, expressed by sleeping for 2          seconds\n        time.Sleep(2 * time.Second)\n        fmt.Println(\"task done\")\n    }()\n}\n}\n</code></pre>\n"}, {"tags": ["http", "go", "file-upload", "go-iris"], "answers": [{"comments": [{"owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "edited": false, "score": 0, "creation_date": 1507087263, "post_id": 46556482, "comment_id": 80066867, "body": "Why doesn&#39;t you recommend use Iris?"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "reply_to_user": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "edited": false, "score": 0, "creation_date": 1507091481, "post_id": 46556482, "comment_id": 80067936, "body": "@Kin read .<a href=\"https://news.ycombinator.com/item?id=11976798\" rel=\"nofollow noreferrer\">news.ycombinator.com/item?id=11976798</a> and <a href=\"http://www.florinpatan.ro/2016/10/why-you-should-not-use-iris-for-your-go.html\" rel=\"nofollow noreferrer\">florinpatan.ro/2016/10/&hellip;</a> . Although these articles are rather old, and some part may be outdated, but it is true that the iris author is very problematic person. You can google about &quot;iris kataras&quot; and get more information."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1507095698, "post_id": 46556482, "comment_id": 80069273, "body": "Yes. Many developers dislike the way author make his deals. So it&#39;s unlikely there would be a strong community around framework. So development and bug fixing would be very slow and without proper review. This way it becomes very risky to put this framework  as a basement of new project. Golang community has developed a lot of alternatives without such baggage."}, {"owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "edited": false, "score": 0, "creation_date": 1507099925, "post_id": 46556482, "comment_id": 80071115, "body": "Which fast Go web framework do you suggest for programming end API?"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1507102074, "post_id": 46556482, "comment_id": 80072280, "body": "You may try <a href=\"https://github.com/labstack/echo\" rel=\"nofollow noreferrer\">echo</a> or <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow noreferrer\">gin</a>. Also you may not to use framework at all - go http library is quite good and has nearly all required functions."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 2, "last_activity_date": 1507098512, "last_edit_date": 1507098512, "creation_date": 1507087177, "answer_id": 46556482, "question_id": 46556050, "link": "https://stackoverflow.com/questions/46556050/file-upload-failed-using-siris/46556482#46556482", "title": "File Upload Failed using SIRIS", "body": "<p>To correctly hanle file upload html form should have attribute </p>\n\n<pre><code>enctype=\"multipart/form-data\"\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/gfsQC.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/gfsQC.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://www.w3schools.com/php/php_file_upload.asp\" rel=\"nofollow noreferrer\">https://www.w3schools.com/php/php_file_upload.asp</a></p>\n\n<p>P.S. I do not recommend to use Iris.</p>\n"}], "owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 46556482, "answer_count": 1, "score": 0, "last_activity_date": 1507104646, "creation_date": 1507083818, "last_edit_date": 1507104646, "question_id": 46556050, "link": "https://stackoverflow.com/questions/46556050/file-upload-failed-using-siris", "title": "File Upload Failed using SIRIS", "body": "<p>I want to upload a file to the server using SIRIS and Postman.</p>\n\n<p><strong>Go Program</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/go-siris/siris\"\n)\n\nfunc main() {\n    app := siris.New()\n    app.Post(\"/\", handleFileUpload)\n    app.Run(siris.Addr(\":8080\"))\n}\n\nfunc handleFileUpload(ctx siris.Context) {\n    ctx.Writef(\"Hello&lt;br/&gt;\")\n    file, info, err := ctx.FormFile(\"filee\")\n    if err != nil {\n        ctx.StatusCode(iris.StatusInternalServerError)\n        ctx.HTML(\"Error while uploading: &lt;b&gt;\" + err.Error() + \"&lt;/b&gt;\")\n        return\n    }\n    defer file.Close()\n    fn := info.Filename\n    ctx.Writef(\"File Name: \" + fn)\n}\n</code></pre>\n\n<p><strong>Postman</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/EgUzq.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/EgUzq.png\" alt=\"enter image description here\"></a></p>\n\n<p>But Postman only can get the error message:</p>\n\n<blockquote>\n  <p>Hello <br/>\n  Error while uploading: <strong>request Content-Type isn't multipart/form-data</strong></p>\n</blockquote>\n\n<p>Why does this happen?</p>\n"}, {"tags": ["go", "sha256"], "comments": [{"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 0, "creation_date": 1507079529, "post_id": 46555379, "comment_id": 80065258, "body": "I made a couple tweaks to your code and added a <code>main()</code> to run it twice with the same inputs... can you modify the <code>main()</code> to reflect what you&#39;re actually passing in? <a href=\"https://play.golang.org/p/ujHtWeZNWE\" rel=\"nofollow noreferrer\">play.golang.org/p/ujHtWeZNWE</a>"}, {"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 1, "creation_date": 1507079790, "post_id": 46555379, "comment_id": 80065315, "body": "I suspect there is a bug in what you&#39;re sending to this function.  My guess is some sort of whitespace difference in reading in files or marshaling or something"}, {"owner": {"reputation": 1214, "user_id": 4309985, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d9a46a23b2bc57d11cf9c3adda670dea?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Fan", "link": "https://stackoverflow.com/users/4309985/andrew-fan"}, "reply_to_user": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 0, "creation_date": 1507079981, "post_id": 46555379, "comment_id": 80065352, "body": "@JohnWeldon: The entire thing is a CBC implementation for a university course. This part is the section of code that generates the MAC tag.   On the first run, PCSSHA256 is called at the start of encrypt. It is concatenated onto a message, given some padding, and then shoved into AES before being dumped to a file.  On the second run, that file is read, and at the very end, PCSSHA256 is run on the decrypted message and the result is compared to the tag that came with the decrypted message.  I have already confirmed that the message is the same, and the kmac is also the same."}, {"owner": {"reputation": 1214, "user_id": 4309985, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d9a46a23b2bc57d11cf9c3adda670dea?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Fan", "link": "https://stackoverflow.com/users/4309985/andrew-fan"}, "reply_to_user": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 0, "creation_date": 1507080121, "post_id": 46555379, "comment_id": 80065375, "body": "@JohnWeldon I&#39;ll check the decrypted message via a direct byte by byte comparison with the original. This was done on a Linux machine so I don&#39;t think I need to worry about \\r but I&#39;ll take a look regardless."}, {"owner": {"reputation": 1214, "user_id": 4309985, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d9a46a23b2bc57d11cf9c3adda670dea?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Fan", "link": "https://stackoverflow.com/users/4309985/andrew-fan"}, "reply_to_user": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 0, "creation_date": 1507081017, "post_id": 46555379, "comment_id": 80065541, "body": "@JohnWeldon Thank you - your hunch led me to the actual problem."}, {"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 0, "creation_date": 1507094830, "post_id": 46555379, "comment_id": 80068980, "body": "Great - glad you figured it out"}], "answers": [{"tags": [], "owner": {"reputation": 1214, "user_id": 4309985, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d9a46a23b2bc57d11cf9c3adda670dea?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Fan", "link": "https://stackoverflow.com/users/4309985/andrew-fan"}, "is_accepted": true, "score": 0, "last_activity_date": 1507080989, "creation_date": 1507080989, "answer_id": 46555750, "question_id": 46555379, "link": "https://stackoverflow.com/questions/46555379/golang-crypto-sha256-same-inputs-produce-different-outputs/46555750#46555750", "title": "Golang crypto/sha256 - same inputs produce different outputs", "body": "<p>Answer: It is an issue with my code. My message is padded by 8 extra 0s in the second case when converted to Hex - this padding is not visible when printed as a string.</p>\n"}], "owner": {"reputation": 1214, "user_id": 4309985, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/d9a46a23b2bc57d11cf9c3adda670dea?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Fan", "link": "https://stackoverflow.com/users/4309985/andrew-fan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 553, "favorite_count": 0, "accepted_answer_id": 46555750, "answer_count": 1, "score": 0, "last_activity_date": 1507080989, "creation_date": 1507077323, "last_edit_date": 1507080465, "question_id": 46555379, "link": "https://stackoverflow.com/questions/46555379/golang-crypto-sha256-same-inputs-produce-different-outputs", "title": "Golang crypto/sha256 - same inputs produce different outputs", "body": "<p>I have a problem with Golang's crypto/sha256 package. I am sending the same input to sha256.Sum256 two separate times, and the output is different each time.</p>\n\n<p>My code is the following:</p>\n\n<pre><code>//Run the HMAC-SHA256 on the given kmac and message and return the generated MAC tag\nfunc PCSSHA256(kmac []byte, message []byte) [32]byte {\n    //NOTE: bitwise XOR ^ only works on integers.\n    kmac64 := append(kmac, []byte(strings.Repeat(\"0\", 48))[0:]...) //Pad to obtain a 64 byte unit\n    tohashinner := make([]byte, 64)\n    for i := 0; i &lt; 64; i++ {\n            tohashinner[i] = kmac64[i] ^ 0x36\n    }\n    tohashouter := make([]byte, 64)\n    for i := 0; i &lt; 64; i++ {\n            tohashouter[i] = kmac64[i] ^ 0x5c\n    }\n    tohashinnerwmess := append(tohashinner, message[0:]...)\n    firsthashval := sha256.Sum256(tohashinnerwmess)\n\n    fmt.Printf(\"tohashinner in || bounds:\\n||%s||\\n\", tohashinner)\n    fmt.Printf(\"tohashouter in || bounds:\\n||%s||\\n\", tohashouter)\n    fmt.Printf(\"tohashinnerwmess in || bounds:\\n||%s||\\n\", tohashinnerwmess)\n    fmt.Printf(\"firsthashval after Hex Encode in || bounds:\\n||%s||\\n\", hex.EncodeToString(firsthashval[:]))\n\n    tag := sha256.Sum256(append(tohashouter, firsthashval[0:]...))\n\n    fmt.Printf(\"Input message in || bounds:\\n||%s||\\n\", message)\n    fmt.Printf(\"Input kmac in || bounds:\\n||%s||\\n\", kmac)\n    fmt.Printf(\"Tag generated by PCSSHA256 after Hex Encode in || bounds:\\n||%s||\\n\", hex.EncodeToString(tag[:]))\n    return tag\n}\n</code></pre>\n\n<p>Below is the fmt.Printf output for the first run:</p>\n\n<pre><code>tohashinner in || bounds:\n||gdebc`anolwtursp||\ntohashouter in || bounds:\n||\n\nllllllllllllllllllllllllllllllllllllllllllllllll||\ntohashinnerwmess in || bounds:\n||gdebc`anolwturspThis is a sample message. It is to be used for testing.\n||\nfirsthashval after Hex Encode in || bounds:\n||7b7bec6f1a9e8860a40730f76f3c5a5f3576a90008630e0dc3fbdc088430ce0f||\nInput message in || bounds:\n||This is a sample message. It is to be used for testing.\n||\nInput kmac in || bounds:\n||QRSTUVWXYZABCDEF||\nTag generated by PCSSHA256 after Hex Encode in || bounds:\n||fd54280dbbca722e41024100c8fa171fa640c814cb4c06380efced71d37504d5||\n</code></pre>\n\n<p>And here is the output for the second run:</p>\n\n<pre><code>tohashinner in || bounds:\n||gdebc`anolwtursp||\ntohashouter in || bounds:\n||\n\nllllllllllllllllllllllllllllllllllllllllllllllll||\ntohashinnerwmess in || bounds:\n||gdebc`anolwturspThis is a sample message. It is to be used for testing.\n||\nfirsthashval after Hex Encode in || bounds:\n||632b978ee2b3498754b761e3e091832a6e8f8308ea89f55749a0754f481564d1||\nInput message in || bounds:\n||This is a sample message. It is to be used for testing.\n||\nInput kmac in || bounds:\n||QRSTUVWXYZABCDEF||\nTag generated by PCSSHA256 after Hex Encode in || bounds:\n||e81de52ce8c7d86ef9937011e2978b452d300b85051cf68f7bd99572558e3cee||\n</code></pre>\n\n<p>In both of the outputs, everything is the same except for firsthashvalue and the resulting tag. Since tohashinnerwmess (a variable I'm using solely to figure out what's going wrong) is equivalent in both cases and it is the only thing being fed into sha256.Sum256, I'm confused as to why firsthashvalue is different for the two inputs.</p>\n\n<p>I'm pretty sure that sha256.Sum256 is deterministic and is expected to return the same output for a given input - tested this in the Go Playground, and indeed it returned the same thing - so I assume the problem lies either with my code or my understanding of Sum256's inner workings. If anyone could explain what I am doing wrong, that would be greatly appreciated. </p>\n\n<p>Thank you.</p>\n\n<p>EDITS:\n- On the first run, the message input to the PCSSHA256 function is directly read from a file using ioutil.ReadFile() while on the second run, an encrypted message is first processed block by block via AES and then passed to PCSSHA256.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 5072015, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-KKwiJs9kjb8/AAAAAAAAAAI/AAAAAAAAAF0/kR-V_mZoi9w/photo.jpg?sz=128", "display_name": "Max Stevens", "link": "https://stackoverflow.com/users/5072015/max-stevens"}, "edited": false, "score": 0, "creation_date": 1599163633, "post_id": 46555268, "comment_id": 112697210, "body": "<a href=\"https://golang.org/pkg/time/#Month\" rel=\"nofollow noreferrer\">Official go docs for time.Month</a>"}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 5, "last_activity_date": 1507076404, "creation_date": 1507076404, "answer_id": 46555268, "question_id": 46555207, "link": "https://stackoverflow.com/questions/46555207/how-do-i-convert-a-number-to-a-month-in-go/46555268#46555268", "title": "How do i convert a number to a month in Go", "body": "<p>You can use the type <code>time.Month</code>, which implements the <code>Stringer</code> interface, which means you can do something like:</p>\n\n<pre><code>m := time.Month(10)\nfmt.Println(m) //\"October\" - could also do m.String() here\nfmt.Println(int(m)) //10\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/PeFfVZZIK_\" rel=\"noreferrer\">https://play.golang.org/p/PeFfVZZIK_</a></p>\n"}], "owner": {"reputation": 101, "user_id": 3898856, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/4ba41455a288f3a09a706c4797615b76?s=128&d=identicon&r=PG&f=1", "display_name": "Ani", "link": "https://stackoverflow.com/users/3898856/ani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 606, "favorite_count": 0, "accepted_answer_id": 46555268, "answer_count": 1, "score": 1, "last_activity_date": 1507076404, "creation_date": 1507075840, "question_id": 46555207, "link": "https://stackoverflow.com/questions/46555207/how-do-i-convert-a-number-to-a-month-in-go", "title": "How do i convert a number to a month in Go", "body": "<p>I just want to take an integer input and convert it into corresponding month using Go time package. Is there a way apart from defining months in using a const block and using iota to incrementally represent them ? </p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 3, "last_activity_date": 1507067577, "creation_date": 1507067577, "answer_id": 46554010, "question_id": 46553730, "link": "https://stackoverflow.com/questions/46553730/whats-the-difference-between-unmarshaltext-and-unmarshaljson/46554010#46554010", "title": "What&#39;s the difference between UnmarshalText and UnmarshalJson?", "body": "<p>Simply:</p>\n\n<ul>\n<li><code>UnmarshalText</code> unmarshals a text-encoded value.</li>\n<li><code>UnmarshalJSON</code> unmarshals a JSON-encoded value.</li>\n</ul>\n\n<p>Which is preferred depends on what you're doing.</p>\n\n<p>JSON encoding is defined by <a href=\"https://tools.ietf.org/html/rfc7159\" rel=\"nofollow noreferrer\">RFC 7159</a>. If you're consuming or producing JSON documents, you should use JSON encoding.</p>\n\n<p>Text encoding has no standard, and is entirely implementation-dependent. Go implements Text-(un)marshalers for a few types, but there's no guarantee that any other application will understand these formats.</p>\n\n<p>Text-encoding is most commonly used for things like URL query parameters, HTML forms, or other loosely-defined formats.</p>\n\n<p>If you have a choice in the matter, using JSON is probably a better way to go.  But again, it depends on what you're doing what makes the most sense.</p>\n\n<p>As it relates to Go's JSON unmarshaler, the JSON unmarshaler will call a type's <code>UnmarshalJSON</code> method, if it's defined, and fall back to <code>UnmarshalText</code> if that is defined.</p>\n\n<p>If you know you'll be using JSON, you should absolutely define an <code>UnmarshalJSON</code> function.</p>\n\n<p>You would generally create an <code>UnmarshalText</code> only if you expected it to be used in non-JSON contexts, with the added benefit that the JSON unmarshaler would also use it, without having to duplicate it (if indeed the same implementation would work for JSON).</p>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1507072824, "creation_date": 1507072824, "answer_id": 46554841, "question_id": 46553730, "link": "https://stackoverflow.com/questions/46553730/whats-the-difference-between-unmarshaltext-and-unmarshaljson/46554841#46554841", "title": "What&#39;s the difference between UnmarshalText and UnmarshalJson?", "body": "<p><a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">Per the documentation</a>:</p>\n\n<blockquote>\n  <p>To unmarshal JSON into a value implementing the Unmarshaler interface,\n  Unmarshal calls that value's UnmarshalJSON method, including when the\n  input is a JSON null. Otherwise, if the value implements\n  encoding.TextUnmarshaler and the input is a JSON quoted string,\n  Unmarshal calls that value's UnmarshalText method with the unquoted\n  form of the string.</p>\n</blockquote>\n\n<p>Meaning: if you want to take some JSON and unmarshal it with some custom logic, you would use <code>UnmarshalJSON</code>. If you want to take the text in a string field of a JSON document and decode that in some special way (i.e. parse it rather than just write it into a <code>string</code>-typed field), you would use <code>UnmarshalText</code>. For example, <code>net.IP</code> implements <code>UnmarshalText</code> so that you can provide a string value like <code>\"ipAddress\": \"1.2.3.4\"</code> and unmarshal it into a <code>net.IP</code> field. If <code>net.IP</code> did not implement <code>UnmarshalText</code>, you would only be able to unmarshal the JSON representation of the underlying type (<code>[]byte</code>).</p>\n"}], "owner": {"reputation": 41, "user_id": 1804676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50aec5d41411cf68a9650aaae6d1c121?s=128&d=identicon&r=PG", "display_name": "Feng Wang", "link": "https://stackoverflow.com/users/1804676/feng-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2114, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1596610093, "creation_date": 1507066201, "last_edit_date": 1596610093, "question_id": 46553730, "link": "https://stackoverflow.com/questions/46553730/whats-the-difference-between-unmarshaltext-and-unmarshaljson", "title": "What&#39;s the difference between UnmarshalText and UnmarshalJson?", "body": "<p>In <a href=\"https://golang.org/src/encoding/json/decode.go?s=3976:4024#L38\" rel=\"nofollow noreferrer\">decode.go</a>, it mentions:</p>\n<blockquote>\n<p>// To unmarshal JSON into a value implementing the Unmarshaler interface,<br />\n// Unmarshal calls that value's UnmarshalJSON method, including<br />\n// when the input is a JSON null.<br />\n// Otherwise, if the value implements encoding.TextUnmarshaler<br />\n// and the input is a JSON quoted string, Unmarshal calls that value's<br />\n// UnmarshalText method with the unquoted form of the string.</p>\n</blockquote>\n<p>What are the differences between <code>UnmarshalText</code> and <code>UnmarshalJSON</code>? Which one is preferred?</p>\n"}, {"tags": ["go", "factory-pattern"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 8, "last_activity_date": 1507052656, "last_edit_date": 1507052656, "creation_date": 1507050776, "answer_id": 46549988, "question_id": 46549800, "link": "https://stackoverflow.com/questions/46549800/factory-pattern-in-go/46549988#46549988", "title": "Factory pattern in Go", "body": "<p>Your <code>NewPet</code> factory returns type <code>Pet</code>, not <code>*Pet</code> in the type assertion. (you rarely ever want a pointer to an interface)</p>\n\n<pre><code>return Pets[pet].(func(string) Pet)(name)\n</code></pre>\n\n<p>Your Pet constructors also need to return type <code>Pet</code> in order to satisfy the factory function signature, which you can simplify as:</p>\n\n<pre><code>func NewDog(name string) Pet {\n    return &amp;Dog{\n        name: name,\n    }\n}\n</code></pre>\n\n<p>Now since all the functions have the same signature, you can define the <code>Pets</code> map with that signature to avoid the need for the type assertion</p>\n\n<pre><code>var Pets = map[string]func(name string) Pet\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/-cz1vX-cMs\" rel=\"noreferrer\">https://play.golang.org/p/-cz1vX-cMs</a></p>\n"}], "owner": {"reputation": 45, "user_id": 8715417, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-3LD5mCJofzQ/AAAAAAAAAAI/AAAAAAAAAAs/BlcwfTLufPc/photo.jpg?sz=128", "display_name": "Sergio Leon", "link": "https://stackoverflow.com/users/8715417/sergio-leon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1991, "favorite_count": 2, "accepted_answer_id": 46549988, "answer_count": 1, "score": 0, "last_activity_date": 1507052656, "creation_date": 1507050111, "question_id": 46549800, "link": "https://stackoverflow.com/questions/46549800/factory-pattern-in-go", "title": "Factory pattern in Go", "body": "<p>I'm trying to implement a factory pattern with Go, here is the example <a href=\"https://play.golang.org/p/ASU0UiJ0ch\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ASU0UiJ0ch</a></p>\n\n<p>I have a interface <strong>Pet</strong> and a struct <strong>Dog</strong> so <strong>Dog</strong> should have the properties of <strong>Pet</strong>, on this case only one which is the specie, when trying to initialize the object <strong>Dog</strong> via the factory <strong>NewPet</strong>, can someone please advise.</p>\n"}, {"tags": ["node.js", "go", "protocol-buffers", "grpc"], "comments": [{"owner": {"reputation": 1006, "user_id": 4666785, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/YXCzR.png?s=128&g=1", "display_name": "elcomendante", "link": "https://stackoverflow.com/users/4666785/elcomendante"}, "edited": false, "score": 0, "creation_date": 1507062113, "post_id": 46549616, "comment_id": 80060013, "body": "you will need to pass code example in order to spot the issue, have a look at this tutorial, hopefully you will spot the issue on your own: <a href=\"https://codelabs.developers.google.com/codelabs/cloud-grpc/\" rel=\"nofollow noreferrer\">codelabs.developers.google.com/codelabs/cloud-grpc</a> . There is nice lib for web browser that supports node, but have not tried it yet: <a href=\"https://github.com/improbable-eng/grpc-web\" rel=\"nofollow noreferrer\">github.com/improbable-eng/grpc-web</a>"}, {"owner": {"reputation": 4055, "user_id": 2598037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWCTo.jpg?s=128&g=1", "display_name": "Carl Mastrangelo", "link": "https://stackoverflow.com/users/2598037/carl-mastrangelo"}, "edited": false, "score": 0, "creation_date": 1507073675, "post_id": 46549616, "comment_id": 80063978, "body": "I believe you can specify the option <code>option go_package = &quot;foo&quot;;</code> in your go project to get the correct package name.  Also, You can specify multiple <code>-I</code> paths that include both directories."}], "owner": {"reputation": 11, "user_id": 692149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91b9c707e58b065b8cfd389a8728a665?s=128&d=identicon&r=PG", "display_name": "DuineAnaithnid", "link": "https://stackoverflow.com/users/692149/duineanaithnid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 328, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1507049320, "creation_date": 1507049320, "question_id": 46549616, "link": "https://stackoverflow.com/questions/46549616/grpc-protobuf-file-setup-for-golang-and-node", "title": "gRPC protobuf file setup for golang and node", "body": "<p>I am trying to get a project going with gRPC that has the servers written in golang and the clients written in node</p>\n\n<p>I have a protobuf file structure like this</p>\n\n<pre><code>- $GOPATH/src/company/api\n  |- server\n     |- svc1\n        |- svc1.proto\n     |- svc2\n        |- svc2.proto\n  |- hardware\n     |- hardware1\n        |- hardware1.proto\n     |- hardware2\n        |- hardware2.proto\n  |- lib\n     |- used-by-both\n        |- used-by-both.proto\n</code></pre>\n\n<p>When defining a service that uses something in the lib directory, I use <code>-I$GOPATH/src</code> then import using <code>import \"company/api/lib/used-by-both\";</code> in the proto file and that seems to work <strong>for golang</strong> when I generate everything.</p>\n\n<p>However, when I generate the node files, the import paths in the packages that depend on files from <code>lib</code> to be incorrect when the while <code>api</code> directory is installed as a node module</p>\n\n<p>If I try to make the <code>-I</code> option for the compiler more specific and shorten the <code>import</code> statement, the golang package import gets messed up </p>\n\n<p>Any advice on how best to compile these proto files in order to make use of them easliy as go packages <strong>and</strong> node modules? </p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-elasticache"], "answers": [{"tags": [], "owner": {"reputation": 4764, "user_id": 1517410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d0f3c5b683ae64c738cf1af18796e1e?s=128&d=identicon&r=PG", "display_name": "ketan vijayvargiya", "link": "https://stackoverflow.com/users/1517410/ketan-vijayvargiya"}, "is_accepted": false, "score": 16, "last_activity_date": 1507049660, "creation_date": 1507049660, "answer_id": 46549694, "question_id": 46549461, "link": "https://stackoverflow.com/questions/46549461/how-to-use-put-and-get-data-from-elasticache-redis-of-aws-with-golang/46549694#46549694", "title": "How to use put and get data from elasticache redis of AWS with golang", "body": "<p><a href=\"http://docs.aws.amazon.com/sdk-for-go/api/service/elasticache/\" rel=\"noreferrer\">This</a> Go SDK that you are using provides APIs for managing your ElastiCache infrastructure, such as create/delete clusters or snapshots, add tags, purchase cache nodes etc. It doesn't provide APIs to put or get items <em>inside</em> the cache.</p>\n\n<p>The Redis cluster that ElastiCache gives you is similar to the one that you might have installed on your own. So, you can connect it with the usual Go libraries outside AWS SDK. For e.g., <a href=\"https://github.com/go-redis/redis\" rel=\"noreferrer\">go-redis/redis</a> or <a href=\"https://github.com/garyburd/redigo\" rel=\"noreferrer\">garyburd/redigo</a>.</p>\n\n<p>In short, use the AWS SDK to manage your ElastiCache infrastructure and Redis' Go clients to put or get items from the cache.</p>\n"}], "owner": {"reputation": 61, "user_id": 8715291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a06dfc1149db54ea915d4731e2bf4eb3?s=128&d=identicon&r=PG&f=1", "display_name": "H\u01b0\u1eddng \u0110inh Th\u1ecb", "link": "https://stackoverflow.com/users/8715291/h%c6%b0%e1%bb%9dng-%c4%90inh-th%e1%bb%8b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4138, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1507049660, "creation_date": 1507048716, "question_id": 46549461, "link": "https://stackoverflow.com/questions/46549461/how-to-use-put-and-get-data-from-elasticache-redis-of-aws-with-golang", "title": "How to use put and get data from elasticache redis of AWS with golang", "body": "<p>I tried to connect to elasticache to put data but I have not found a method to perform put the data.\nHow can I put and get data on elasticache resdis of aws?\nmy code</p>\n\n<pre><code>mySession := getAWSSession()\nsvc := elasticache.New(mySession)\n\ninput := &amp;elasticache.CreateCacheClusterInput{\n    AutoMinorVersionUpgrade: aws.Bool(true),\n    CacheClusterId:          aws.String(\"my-redis\"),\n    CacheNodeType:           aws.String(\"cache.r3.larage\"),\n    CacheSubnetGroupName:    aws.String(\"default\"),\n    Engine:                  aws.String(\"redis\"),\n    EngineVersion:           aws.String(\"3.2.4\"),\n    NumCacheNodes:           aws.Int64(1),\n    Port:                    aws.Int64(6379),\n    PreferredAvailabilityZone: aws.String(\"us-east-1c\"),\n    SnapshotRetentionLimit:    aws.Int64(7),\n\n}\n\nresult, err := svc.CreateCacheCluster(input)\nvar data = Logo{}\ndata.name = \"test1\"\ndata.logo = \"test2\"\n// how to put and get data from elasticache\n</code></pre>\n"}, {"tags": ["go", "x86-64", "memory-address", "google-nativeclient"], "comments": [{"owner": {"reputation": 2409, "user_id": 2284570, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9bd1d26aad2cfb7ece066d94c128d529?s=128&d=identicon&r=PG", "display_name": "user2284570", "link": "https://stackoverflow.com/users/2284570/user2284570"}, "edited": false, "score": 0, "creation_date": 1507064401, "post_id": 46548452, "comment_id": 80061087, "body": "More precisely, I failed to further than <a href=\"https://play.golang.org/p/sZX0cHNsAo\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "edited": false, "score": 0, "creation_date": 1507075117, "post_id": 46548452, "comment_id": 80064298, "body": "I quess, you should look for type Signature in go source code(declared at /src/go/types/type.go) because functions are not passed by pointer but signature."}], "answers": [{"tags": [], "owner": {"reputation": 1948, "user_id": 1924657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/gumlg.jpg?s=128&g=1", "display_name": "Bryce", "link": "https://stackoverflow.com/users/1924657/bryce"}, "is_accepted": false, "score": 0, "last_activity_date": 1535086583, "creation_date": 1535086583, "answer_id": 51997718, "question_id": 46548452, "link": "https://stackoverflow.com/questions/46548452/how-to-get-functions-s-start-address-using-the-unsafe-package/51997718#51997718", "title": "How to get functions\u2019s start address using the unsafe package?", "body": "<p>Try this:</p>\n\n<pre><code>functionLocation := **(**uintptr)(unsafe.Pointer(&amp;orig))\n</code></pre>\n"}], "owner": {"reputation": 2409, "user_id": 2284570, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9bd1d26aad2cfb7ece066d94c128d529?s=128&d=identicon&r=PG", "display_name": "user2284570", "link": "https://stackoverflow.com/users/2284570/user2284570"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1535086583, "creation_date": 1507045195, "last_edit_date": 1507069124, "question_id": 46548452, "link": "https://stackoverflow.com/questions/46548452/how-to-get-functions-s-start-address-using-the-unsafe-package", "title": "How to get functions\u2019s start address using the unsafe package?", "body": "<p>I need to get the first cpu instruction of a go function <em>(not assembly or cgo)</em>, but in golang, <code>&amp;dummy</code> of <code>func dummy() {}</code> doesn\u2019t lead to the function start address, but to the variable start address on the stack representing the function.</p>\n\n<p>So in my example, <code>&amp;dummy</code> doesn\u2019t lead to a pointer, but to an obscure structure which I failed to find description in golang source code\u2026</p>\n"}, {"tags": ["parsing", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1507037617, "post_id": 46545594, "comment_id": 80045768, "body": "You can&#39;t get the types from just parsing the file. You&#39;re going to want the <a href=\"https://golang.org/pkg/go/types/\" rel=\"nofollow noreferrer\">go/types</a> package. There&#39;s a tutorial here which may help: <a href=\"https://github.com/golang/example/tree/master/gotypes\" rel=\"nofollow noreferrer\">github.com/golang/example/tree/master/gotypes</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1166, "user_id": 1934787, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NI2bC.png?s=128&g=1", "display_name": "al3x", "link": "https://stackoverflow.com/users/1934787/al3x"}, "is_accepted": true, "score": 2, "last_activity_date": 1507193226, "creation_date": 1507193226, "answer_id": 46581405, "question_id": 46545594, "link": "https://stackoverflow.com/questions/46545594/how-to-parse-the-statements-in-a-method-or-function-with-go/46581405#46581405", "title": "How to parse the statements in a method or function with Go", "body": "<p>Thanks to <a href=\"https://stackoverflow.com/users/32880/jimb\">JimB</a> and his hint about <code>go/types</code>, here's how I could get the signature of my method</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"go/ast\"\n    \"go/importer\"\n    \"go/parser\"\n    \"go/token\"\n    \"go/types\"\n    \"log\"\n)\n\nvar code = []byte(`\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc GetFoo() {\n    test := foo()\n    fmt.Println(test)\n}\n\nfunc foo() int {\n    return 0\n}\n`)\n\nfunc main() {\n    fset := token.NewFileSet()\n    f, err := parser.ParseFile(fset, \"\", code, parser.ParseComments)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    conf := types.Config{Importer: importer.Default()}\n    pkg, err := conf.Check(\"cmd\", fset, []*ast.File{f}, nil)\n    scope := pkg.Scope()\n\n    for _, decl := range f.Decls {\n        switch t := decl.(type) {\n        // That's a func decl !\n        case *ast.FuncDecl:\n            for _, s := range t.Body.List {\n                switch as := s.(type) {\n                case *ast.AssignStmt:\n                    for _, l := range as.Rhs {\n                        switch rh := l.(type) {\n                        case *ast.CallExpr:\n                            if i, ok := rh.Fun.(*ast.Ident); ok {\n                                ft := scope.Lookup(i.Name)\n                                if ft != nil {\n                                    if ftype, ok := ft.(*types.Func); ok {\n                                        f := ftype.Type()\n                                        if sig, ok := f.(*types.Signature); ok {\n                                            // get the returned elements\n                                            r := sig.Results()\n                                            for i := 0; i &lt; r.Len(); i++ {\n                                                v := r.At(i)\n                                                varTpe := v.Type()\n                                                fmt.Println(varTpe)\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1166, "user_id": 1934787, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NI2bC.png?s=128&g=1", "display_name": "al3x", "link": "https://stackoverflow.com/users/1934787/al3x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1277, "favorite_count": 0, "accepted_answer_id": 46581405, "answer_count": 1, "score": 3, "last_activity_date": 1507193226, "creation_date": 1507036772, "question_id": 46545594, "link": "https://stackoverflow.com/questions/46545594/how-to-parse-the-statements-in-a-method-or-function-with-go", "title": "How to parse the statements in a method or function with Go", "body": "<p>I would like to parse go code, and more especially the content of a function. </p>\n\n<p>So far it's pretty easy to get the function declaration with the <code>parser.ParseFile</code> function.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"go/parser\"\n    \"go/token\"\n    \"go/ast\"\n    \"log\"\n)\n\nvar code = []byte(`\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc GetFoo() {\n    test := foo()\n    fmt.Println(test)\n}\n\nfunc foo() int {\n    return 0\n}\n`)\n\nfunc main() {\n    fset := token.NewFileSet()\n    f, err := parser.ParseFile(fset, \"\", code, parser.ParseComments)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    for _, decl := range f.Decls {\n        switch t := decl.(type) {\n        // That's a func decl !\n        case *ast.FuncDecl:\n            fmt.Printf(\"Function name: %v\\n\", t.Name)\n            // Now I would like to access to the test var and get its type\n            // Must be int, because foo() returns an int\n        }\n    }\n\n}\n</code></pre>\n\n<p>Now I would like to access to the <code>test</code> var and get its type, but I am a little bit lost. I have seen the <code>decl.Body.List</code> to iterate over the statements but I can get that my <code>test</code> var is an <code>int</code></p>\n\n<p>Thank you for your precious help !</p>\n\n<p><a href=\"https://play.golang.org/p/Y8uwM-CDWy\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Y8uwM-CDWy</a> </p>\n"}, {"tags": ["sqlite", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1507035984, "post_id": 46545139, "comment_id": 80044691, "body": "You haven&#39;t set <code>CC_FOR_TARGET</code>. Do you have the toolchain necessary to cross-compile C programs for Linux at all?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1507036108, "post_id": 46545139, "comment_id": 80044786, "body": "BTW, it&#39;s far easier to just build it in a Docker container."}, {"owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1507036644, "post_id": 46545139, "comment_id": 80045129, "body": "You right building it in a Docker container seem to work, don&#39;t know enough about clang compiler to confirm if i have all the tools needed. I guess i do but don&#39;t know for sure. Feel free to collaborate and maybe pull request the readme go-sqlite3 to help others thx"}], "owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 712, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1507035613, "creation_date": 1507035310, "last_edit_date": 1507035613, "question_id": 46545139, "link": "https://stackoverflow.com/questions/46545139/go-sqlite3-compiler-arguments-for-cross-compile-osx-to-linux", "title": "go-sqlite3 compiler arguments for cross compile OSX to linux", "body": "<p><a href=\"https://github.com/mattn/go-sqlite3/\" rel=\"nofollow noreferrer\">https://github.com/mattn/go-sqlite3/</a></p>\n\n<p>Can't find the correct go build compiler arguments for OSX to linux using the clang compiler, help greatly appreciated thx</p>\n\n<pre><code>% env GOOS=linux CGO_ENABLED=1 go build -ldflags \"-linkmode external -extldflags -static\"\n# runtime/cgo\nld: unknown option: --build-id=none\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n\n% env GOOS=linux CGO_ENABLED=1 go build\n# runtime/cgo\nld: unknown option: --build-id=none\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n</code></pre>\n\n<p>Note that a plain <code>go build</code> without cross compiling works</p>\n"}, {"tags": ["go", "routing", "routes", "url-routing", "go-chi"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1507035399, "post_id": 46544990, "comment_id": 80044280, "body": "please define <i>I am unable</i>, any errors?"}, {"owner": {"reputation": 31, "user_id": 7362078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f1e0e69f3615fa73e3742dbded013ce?s=128&d=identicon&r=PG&f=1", "display_name": "0xTanvir", "link": "https://stackoverflow.com/users/7362078/0xtanvir"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1507035897, "post_id": 46544990, "comment_id": 80044641, "body": "sorry , actually if I set my route as &quot;/something&quot; then request &quot;/something/&quot; url it&#39;s give me <i>404 page not found</i>"}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1507035997, "post_id": 46544990, "comment_id": 80044698, "body": "Please read this <a href=\"https://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1507037988, "post_id": 46544990, "comment_id": 80046039, "body": "Where&#39;s your code?"}], "answers": [{"tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": true, "score": 2, "last_activity_date": 1507036060, "creation_date": 1507036060, "answer_id": 46545354, "question_id": 46544990, "link": "https://stackoverflow.com/questions/46544990/how-to-serve-something-and-something-both-on-golanggo-chi-router/46545354#46545354", "title": "How to serve &quot;/something&quot; and &quot;/something/&quot; both on Golang(go-chi) router?", "body": "<p>use middleware StripSlashes, that change path \"/something/\"  to \"/something\"</p>\n"}], "owner": {"reputation": 31, "user_id": 7362078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f1e0e69f3615fa73e3742dbded013ce?s=128&d=identicon&r=PG&f=1", "display_name": "0xTanvir", "link": "https://stackoverflow.com/users/7362078/0xtanvir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 733, "favorite_count": 0, "accepted_answer_id": 46545354, "answer_count": 1, "score": 0, "last_activity_date": 1534002070, "creation_date": 1507034853, "last_edit_date": 1534002070, "question_id": 46544990, "link": "https://stackoverflow.com/questions/46544990/how-to-serve-something-and-something-both-on-golanggo-chi-router", "title": "How to serve &quot;/something&quot; and &quot;/something/&quot; both on Golang(go-chi) router?", "body": "<p>I am using go-chi router for my application but I am unable to serve \"/something\" and \"/something/\" both with one route, if I set my route as \"/something\" </p>\n\n<pre><code>r := chi.NewRouter()\nr.Get(\"/something\", func(writer http.ResponseWriter, request *http.Request) {\n    writer.Write([]byte(\"just for test\"))\n})\n</code></pre>\n\n<p>and then request \"/something/\" its give me <em>404 page not found</em> error.Is there any way to serve both case with one route?</p>\n"}, {"tags": ["go", "apache-kafka", "kafka-producer-api", "confluent-platform"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507055491, "post_id": 46544045, "comment_id": 80056695, "body": "not sure about that client that&#39;s just a wrapper on top of the C client, have you tried this one <a href=\"https://github.com/Shopify/sarama\" rel=\"nofollow noreferrer\">github.com/Shopify/sarama</a> ?"}, {"owner": {"reputation": 71, "user_id": 3673769, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k6dP1.jpg?s=128&g=1", "display_name": "nams", "link": "https://stackoverflow.com/users/3673769/nams"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507056085, "post_id": 46544045, "comment_id": 80057006, "body": "Yes I did try that out to replicate this behaviour, probably this issue has something to do with the particular library itself. I noticed that, the messages are getting produced and the offset is maintained correctly internally, its just that the offset is not being reflected in the acks at times. Need to dig deeper to know the actual reason. Will update the post once I come across something concrete !  Thanks @YandryPozo !"}], "answers": [{"tags": [], "owner": {"reputation": 2193, "user_id": 6886316, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/magB4.png?s=128&g=1", "display_name": "Treziac", "link": "https://stackoverflow.com/users/6886316/treziac"}, "is_accepted": false, "score": 0, "last_activity_date": 1507189205, "creation_date": 1507189205, "answer_id": 46580346, "question_id": 46544045, "link": "https://stackoverflow.com/questions/46544045/kafka-returning-offset-as-0-on-producing/46580346#46580346", "title": "Kafka returning Offset as 0 on Producing", "body": "<p>Try setting <code>produce.offset.report</code> to true in config.</p>\n\n<blockquote>\n  <p>Try setting produce.offset.report to true for the producer, otherwise\n  it will only report the offset of the last message in each\n  batch/messageSet.</p>\n  \n  <p>The go client should really do this by default.</p>\n</blockquote>\n\n<p><a href=\"https://github.com/confluentinc/confluent-kafka-go/issues/95#issuecomment-330837647\" rel=\"nofollow noreferrer\">https://github.com/confluentinc/confluent-kafka-go/issues/95#issuecomment-330837647</a></p>\n\n<p>If this does not solve your problem, could you post the code and config you use for producing ?</p>\n"}], "owner": {"reputation": 71, "user_id": 3673769, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k6dP1.jpg?s=128&g=1", "display_name": "nams", "link": "https://stackoverflow.com/users/3673769/nams"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 678, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1507189205, "creation_date": 1507031769, "last_edit_date": 1592644375, "question_id": 46544045, "link": "https://stackoverflow.com/questions/46544045/kafka-returning-offset-as-0-on-producing", "title": "Kafka returning Offset as 0 on Producing", "body": "<p>Having written a basic channel based producer in golang using <a href=\"https://github.com/confluentinc/confluent-kafka-go\" rel=\"nofollow noreferrer\">confluent-kafka-go</a> and a single partition single broker kafka set up through confluent.\nOn producing sometimes during iteration through the <code>acks</code>  the offset of the successfully produced message is received as <strong>0</strong>.</p>\n<p>Sample logs :</p>\n<blockquote>\n<p>{&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Published successfully to topic test, offset 0, Partition 0 and Length 1316&quot;,&quot;time&quot;:&quot;2017-10-03T17:03:43+05:30&quot;}</p>\n<p>{&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Published successfully to topic test, offset 0, Partition 0 and Length 1316&quot;,&quot;time&quot;:&quot;2017-10-03T17:03:43+05:30&quot;}</p>\n</blockquote>\n<p>This is the function that iterates over the kafka acks :</p>\n<pre><code>func (kc *KafkaClient) HandleAcknowledgements() {\n  for event := range kc.AckChannel {\n    message := event.(*kafka.Message)\n\n    if message.TopicPartition.Error != nil {\n      log.Errorf(&quot;Delivery Failed: Partition: %d Reason: %v&quot;, message.TopicPartition.Partition, message.TopicPartition.Error)\n    } else {\n      if message.TopicPartition.Offset == 0 {\n        bodyLen := len(message.Value)\n        log.Infof(&quot;Published successfully to topic %s, offset %s, Partition %d and Length %d&quot;, *message.TopicPartition.Topic, message.TopicPartition.Offset, message.TopicPartition.Partition, bodyLen)\n      }\n    }\n  }\n}\n</code></pre>\n<p>My retention policy is as below :</p>\n<pre><code>   log.retention.hours=168\n</code></pre>\n<p>Any sort of help will be great, so as to why this happens !</p>\n<p>Thanks.</p>\n"}, {"tags": ["go", "registry"], "comments": [{"owner": {"reputation": 817, "user_id": 3459011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/561a4ac06c6502c6d8e7907fd55510e4?s=128&d=identicon&r=PG", "display_name": "rmjoia", "link": "https://stackoverflow.com/users/3459011/rmjoia"}, "edited": false, "score": 1, "creation_date": 1507027307, "post_id": 46542609, "comment_id": 80039281, "body": "what did you expect to happen? change the key value? &quot;nothing happens&quot; is a bit too broad don&#39;t you think?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1507028180, "post_id": 46542609, "comment_id": 80039767, "body": "You are ignoring the errors from SetStringvalue and from Close. What output do you expect if you deliberately close your eyes? Handle all errors, always."}, {"owner": {"reputation": 43, "user_id": 8713375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a06b9cbd6f4a3bdaec83a764b6ca425?s=128&d=identicon&r=PG&f=1", "display_name": "Ted Kaczynski", "link": "https://stackoverflow.com/users/8713375/ted-kaczynski"}, "edited": false, "score": 0, "creation_date": 1507029621, "post_id": 46542609, "comment_id": 80040581, "body": "<b>NOTHING HAPPENS</b> means it doesn&#39;t work, that, it doesn&#39;t create or set any registry values. apologies for ambiguation."}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 7, "last_activity_date": 1507031580, "creation_date": 1507031580, "answer_id": 46543973, "question_id": 46542609, "link": "https://stackoverflow.com/questions/46542609/create-a-registry-key-string-with-go/46543973#46543973", "title": "Create a registry key/string with Go", "body": "<p>You are opening the key with only the <code>QUERY_VALUE</code> permission, but you also need <code>SET_VALUE</code> in order to successfully call <code>SetStringValue</code>.</p>\n\n<p>You should also be checking the return value on <code>SetStringValue</code>, which would have likely informed you what the problem was.</p>\n\n<pre><code>k, err := registry.OpenKey(registry.CURRENT_USER, `Software\\Microsoft\\Windows\\CurrentVersion\\Audio`, registry.QUERY_VALUE|registry.SET_VALUE)\nif err != nil {\n    log.Fatal(err)\n}\nif err := k.SetStringValue(\"xyz\", \"blahblah\"); err != nil {\n    log.Fatal(err)\n}\nif err := k.Close(); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 8713375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a06b9cbd6f4a3bdaec83a764b6ca425?s=128&d=identicon&r=PG&f=1", "display_name": "Ted Kaczynski", "link": "https://stackoverflow.com/users/8713375/ted-kaczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3187, "favorite_count": 0, "accepted_answer_id": 46543973, "answer_count": 1, "score": 3, "last_activity_date": 1507032220, "creation_date": 1507027028, "last_edit_date": 1507029819, "question_id": 46542609, "link": "https://stackoverflow.com/questions/46542609/create-a-registry-key-string-with-go", "title": "Create a registry key/string with Go", "body": "<p>I was following this <a href=\"https://godoc.org/golang.org/x/sys/windows/registry\" rel=\"nofollow noreferrer\">document</a> to create a key/string in windows registry with this code snippet:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"golang.org/x/sys/windows/registry\"\n    \"log\"\n)\n\nfunc main() {\n\n    k, err := registry.OpenKey(registry.CURRENT_USER, `Software\\Microsoft\\Windows\\CurrentVersion\\Audio`, registry.QUERY_VALUE)\n    if err != nil {\n        log.Fatal(err)\n    }\n    k.SetStringValue(\"xyz\", \"blahblah\")\n    err = k.Close()\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>but nothing happens, without any errors.\nEdit (clarification): It doesn't work, in any circumstances.</p>\n"}, {"tags": ["c++", "winapi", "go", "cgo", "wpd"], "comments": [{"owner": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 2, "creation_date": 1507025570, "post_id": 46541585, "comment_id": 80038355, "body": "You need to read the documentation for <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms695279.aspx\" rel=\"nofollow noreferrer\">CoInitializeEx</a>. The way you are using it is unusual to say the least. And probably wrong. Don&#39;t try to initialize COM from your library. Have clients of your library initialize COM on the calling thread."}, {"owner": {"reputation": 37, "user_id": 6659575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2TQwCLmKS7o/AAAAAAAAAAI/AAAAAAAABMA/56weWG1F1RU/photo.jpg?sz=128", "display_name": "RedLaboratory", "link": "https://stackoverflow.com/users/6659575/redlaboratory"}, "reply_to_user": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 0, "creation_date": 1507026383, "post_id": 46541585, "comment_id": 80038777, "body": "I removed init code in cpp and written the code in Golang. (<code>hr := C.CoInitializeEx(nil, C.COINIT_MULTITHREADED)</code>) And this code returns S_OK but problem still remains."}, {"owner": {"reputation": 870061, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 0, "creation_date": 1507027319, "post_id": 46541585, "comment_id": 80039291, "body": "Not so easy to see whether the -blahblah compile option takes care of the proper calling convention.  HRESULT is a 32-bit type."}, {"owner": {"reputation": 37, "user_id": 6659575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2TQwCLmKS7o/AAAAAAAAAAI/AAAAAAAABMA/56weWG1F1RU/photo.jpg?sz=128", "display_name": "RedLaboratory", "link": "https://stackoverflow.com/users/6659575/redlaboratory"}, "reply_to_user": {"reputation": 870061, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 0, "creation_date": 1507027955, "post_id": 46541585, "comment_id": 80039627, "body": "@HansPassant -blahblah is just include options to find <code>libgowpd.h</code> file. And I don&#39;t know why but when I try to cast <code>C.E_SOMEERROR</code> to <code>uint32</code>, go compiler throws overflow error."}, {"owner": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 0, "creation_date": 1507028564, "post_id": 46541585, "comment_id": 80039987, "body": "<code>HRESULT</code>&#39;s are signed 32-bit values. Your code doesn&#39;t appear to acknowledge this."}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1507036287, "post_id": 46541585, "comment_id": 80044889, "body": "the <code>E_INVALIDARG</code> can be or when <i>pPortableDeviceManager</i> == 0 or when <i>dwClsContext</i> is invalid. simply look in debugger parameters in call <code>CoCreateInstance</code>"}, {"owner": {"reputation": 37, "user_id": 6659575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2TQwCLmKS7o/AAAAAAAAAAI/AAAAAAAABMA/56weWG1F1RU/photo.jpg?sz=128", "display_name": "RedLaboratory", "link": "https://stackoverflow.com/users/6659575/redlaboratory"}, "reply_to_user": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1507104683, "post_id": 46541585, "comment_id": 80073672, "body": "@RbMm <code>IID_PPV_ARGS</code> macro couldn&#39;t get <code>IID</code> of pointer. So the problem was <code>dwClsContext</code>. I manually set parameter so that I could solve the problem. Thank you all!"}], "owner": {"reputation": 37, "user_id": 6659575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2TQwCLmKS7o/AAAAAAAAAAI/AAAAAAAABMA/56weWG1F1RU/photo.jpg?sz=128", "display_name": "RedLaboratory", "link": "https://stackoverflow.com/users/6659575/redlaboratory"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 333, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1507025558, "creation_date": 1507023729, "last_edit_date": 1507025558, "question_id": 46541585, "link": "https://stackoverflow.com/questions/46541585/cocreateinstance-returns-e-invalidarg", "title": "CoCreateInstance returns E_INVALIDARG", "body": "<p>I have been working on wrapping WindowsPortableDevice Api for Golang. The c++ code below was working but suddenly is not working.</p>\n\n<p>libgowpd.h:</p>\n\n<pre><code>#include &lt;Windows.h&gt;\n\ntypedef struct IPortableDeviceManager IPortableDeviceManager;\n\nHRESULT createPortableDeviceManager(IPortableDeviceManager **pPortableDeviceManager);\n</code></pre>\n\n<p>libgowpd.cpp:</p>\n\n<pre><code>#include &lt;libgowpd.h&gt;\n\nHRESULT createPortableDeviceManager(IPortableDeviceManager **pPortableDeviceManager) {\n    HRESULT hr = CoInitializeEx(NULL, COINIT_MULTITHREADED);\n    if (SUCCEEDED(hr)) {\n        hr = CoCreateInstance(CLSID_PortableDeviceManager,\n            NULL,\n            CLSCTX_INPROC_SERVER,\n            IID_PPV_ARGS(pPortableDeviceManager));\n    }\n\n    return hr;\n}\n</code></pre>\n\n<p>In Golang</p>\n\n<pre><code>/*\n#cgo CFLAGS: -blahblah\n#cgo LDFLAGS: -llibgowpd -Ole32\n\ninclude \"libgowpd.h\"\n*/\nimport \"C\"\n\ntype HRESULT uint64\ntype IPortableDeviceManager C.IPortableDeviceManager\n\nfunc CreatePortableDeviceManager() (*IPortableDeviceManager, error) {\n    var pPortableDeviceManager *C.struct_IPortableDeviceManager// No matter whether C.IPortableDeviceManager or C.struct_IPortableDeviceManager\n\n    hr := C.createPortableDeviceManager(&amp;pPortableDeviceManager)\n\n    if hr &lt; 0 {\n        return nil, HRESULT(hr)\n    }\n    if pPortableDeviceManager == nil {\n        return nil, E_POINTER\n    }\n\n    log.Println(\"CreatePortableDeviceManager(): Create portable device manager instance.\")\n\n    return (*IPortableDeviceManager)(pPortableDeviceManager), nil\n}\n</code></pre>\n\n<p>I think I pass pointer to <code>pPortableDeviceManager</code> correctly via getting address of <code>pPortableDeviceManager</code> but it returns <code>0x80070057</code> error code(<code>E_INVALIDARG</code>).</p>\n\n<p>What have I done wrong?</p>\n"}, {"tags": ["go", "wmi"], "answers": [{"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 1, "last_activity_date": 1507017564, "creation_date": 1507017564, "answer_id": 46539793, "question_id": 46539424, "link": "https://stackoverflow.com/questions/46539424/execute-wql-query-on-remote-machine/46539793#46539793", "title": "Execute WQL Query on Remote Machine", "body": "<p>According to <a href=\"https://msdn.microsoft.com/en-us/library/aa393720.aspx\" rel=\"nofollow noreferrer\">the docs</a>, the signature of <code>ConnectServer</code> method is:</p>\n\n<pre><code>objwbemServices = .ConnectServer( _\n  [ ByVal strServer ], _\n  [ ByVal strNamespace ], _\n  [ ByVal strUser ], _\n  [ ByVal strPassword ], _\n  [ ByVal strLocale ], _\n  [ ByVal strAuthority ], _\n  [ ByVal iSecurityFlags ], _\n  [ ByVal objwbemNamedValueSet ] _\n)\n</code></pre>\n\n<p>so try something like:</p>\n\n<pre><code>c.Query(wqlQery, dst, \"your-remote.server.net or IP address\", \n    \"root\\CIMV2\", \"DomainName\\UserName\", \"secret password\")\n</code></pre>\n"}], "owner": {"reputation": 180, "user_id": 8444899, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/6c26fb55e950c64e40e73590b7aa02cb?s=128&d=identicon&r=PG&f=1", "display_name": "Learner", "link": "https://stackoverflow.com/users/8444899/learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 1, "accepted_answer_id": 46539793, "answer_count": 1, "score": 0, "last_activity_date": 1507017564, "creation_date": 1507016143, "last_edit_date": 1507016723, "question_id": 46539424, "link": "https://stackoverflow.com/questions/46539424/execute-wql-query-on-remote-machine", "title": "Execute WQL Query on Remote Machine", "body": "<p>I am using this <a href=\"https://github.com/StackExchange/wmi\" rel=\"nofollow noreferrer\">WMI library</a> for executing WQL query in Go language. I am able to execute the sample code in local machine. However, I need to execute the WQL query on a remote machine. The <a href=\"https://godoc.org/github.com/StackExchange/wmi#Client.Query\" rel=\"nofollow noreferrer\">documentation</a> for the <code>Query</code> method I use reads as shown below:</p>\n\n<blockquote>\n  <p>By default, the local machine and default namespace are used. These\n  can be changed using connectServerArgs. See\n  <a href=\"http://msdn.microsoft.com/en-us/library/aa393720.aspx\" rel=\"nofollow noreferrer\">http://msdn.microsoft.com/en-us/library/aa393720.aspx</a> for details.</p>\n</blockquote>\n\n<p>However, I am not sure how to pass the <code>connectServerArgs</code> correctly. \nCould somebody please help me with a sample declaration of this argument and how to pass it to <code>Query</code> method?</p>\n"}, {"tags": ["mysql", "go", "many-to-many"], "comments": [{"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 0, "creation_date": 1507003814, "post_id": 46537060, "comment_id": 80028595, "body": "That code won&#39;t compile - I assume it&#39;s more &#39;pseudo-code&#39;"}, {"owner": {"reputation": 663, "user_id": 2901304, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/58a98883c95278f89a4d0dcbce619d6a?s=128&d=identicon&r=PG&f=1", "display_name": "user2901304", "link": "https://stackoverflow.com/users/2901304/user2901304"}, "reply_to_user": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 0, "creation_date": 1507003899, "post_id": 46537060, "comment_id": 80028608, "body": "Yeah its pseudo-code. I am just planning my implementation."}], "answers": [{"comments": [{"owner": {"reputation": 663, "user_id": 2901304, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/58a98883c95278f89a4d0dcbce619d6a?s=128&d=identicon&r=PG&f=1", "display_name": "user2901304", "link": "https://stackoverflow.com/users/2901304/user2901304"}, "edited": false, "score": 0, "creation_date": 1507004375, "post_id": 46537124, "comment_id": 80028704, "body": "The benefit of using the pointers would be that I could update the value at the pointer, otherwise using <code>Tag</code> or <code>Post</code> would just be read-only. Is that correct?  I was going to use gorm but from reading online the general consensus I got was its better to learn go using just the standard library."}, {"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "reply_to_user": {"reputation": 663, "user_id": 2901304, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/58a98883c95278f89a4d0dcbce619d6a?s=128&d=identicon&r=PG&f=1", "display_name": "user2901304", "link": "https://stackoverflow.com/users/2901304/user2901304"}, "edited": false, "score": 0, "creation_date": 1507004516, "post_id": 46537124, "comment_id": 80028736, "body": "Yes, if I understand you correctly, using pointers would make it easier for you to modify the structs &quot;in-place&quot;.  I think using the standard library and the native language as much as possible is good, but in the case of Object-to-Relational mapping there aren&#39;t as many native examples, and using a popular library may decrease the liklihood of edge-case errors."}, {"owner": {"reputation": 663, "user_id": 2901304, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/58a98883c95278f89a4d0dcbce619d6a?s=128&d=identicon&r=PG&f=1", "display_name": "user2901304", "link": "https://stackoverflow.com/users/2901304/user2901304"}, "edited": false, "score": 0, "creation_date": 1507004727, "post_id": 46537124, "comment_id": 80028782, "body": "Okay awesome I think I get it, thanks so much! I am going to continue with the standard library for now. Hopefully it all works out"}], "tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": true, "score": 2, "last_activity_date": 1507004116, "creation_date": 1507004116, "answer_id": 46537124, "question_id": 46537060, "link": "https://stackoverflow.com/questions/46537060/model-structs-for-many-to-many-relationship-using-std/46537124#46537124", "title": "model structs for many to many relationship using std", "body": "<p>Here are a couple of modifications to consider:</p>\n\n<ol>\n<li>Keep your type names consistent (<code>post</code> vs. <code>Post</code> for example)</li>\n<li>I think you were going for a slice of Tags and a slice of Posts, so I updated the syntax for that.</li>\n<li>One significant question you'll need to answer; do you need/want your structures to be stored in memory with single structs for each item?  If so you'll probably want to consider using slices of pointers to Tag and Post instead (<code>[]*Post</code> and <code>[]*Tag</code> for example), but popular ORM libraries don't strictly need that (for example gorm: <a href=\"http://jinzhu.me/gorm/associations.html#many-to-many\" rel=\"nofollow noreferrer\">http://jinzhu.me/gorm/associations.html#many-to-many</a>).</li>\n</ol>\n\n<p>Example code:</p>\n\n<pre><code>type Post struct {\n    ID   int    `json:\"id\"`\n    Title string `json:\"title\"`\n    Content string `json:\"content\"`\n    Tags []Tag `json:\"tags\"`\n}\n\ntype Tag struct {\n    ID   int    `json:\"id\"`\n    Name string `json:\"name\"`\n    Posts []Post `json:\"posts\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 663, "user_id": 2901304, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/58a98883c95278f89a4d0dcbce619d6a?s=128&d=identicon&r=PG&f=1", "display_name": "user2901304", "link": "https://stackoverflow.com/users/2901304/user2901304"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 46537124, "answer_count": 1, "score": 1, "last_activity_date": 1507004116, "creation_date": 1507003573, "question_id": 46537060, "link": "https://stackoverflow.com/questions/46537060/model-structs-for-many-to-many-relationship-using-std", "title": "model structs for many to many relationship using std", "body": "<p>I'm trying to learn go and I want to create a many to many relationship between a post and a tag. A tag can belong to many posts and a post can have many tags. I am using the standard library using the mysql drive (github.com/go-sql-driver/mysql)</p>\n\n<p>Here's my code:</p>\n\n<p>post.go</p>\n\n<pre><code>package main\n\ntype post struct {\n    ID   int    `json:\"id\"`\n    Title string `json:\"title\"`\n    Content string `json:\"content\"`\n    Tags: Tag `json:\"tags\"`\n}\n</code></pre>\n\n<p>tag.go</p>\n\n<pre><code>package main\n\ntype tag struct {\n    ID   int    `json:\"id\"`\n    Name string `json:\"name\"`\n    Posts: Post `json:\"posts\"`\n}\n</code></pre>\n\n<p>Is this the correct way to structure this many to many relationship?</p>\n\n<p>Cheers</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 22172, "user_id": 1263942, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/b272a5e1d5d3589192d942552e51e2a8?s=128&d=identicon&r=PG", "display_name": "Bruno Grieder", "link": "https://stackoverflow.com/users/1263942/bruno-grieder"}, "edited": false, "score": 1, "creation_date": 1507003975, "post_id": 46537040, "comment_id": 80028621, "body": "In Go, struct properties default to the zero of their type, which is not necessarily nil: <a href=\"https://tour.golang.org/basics/12\" rel=\"nofollow noreferrer\">tour.golang.org/basics/12</a>"}, {"owner": {"reputation": 473, "user_id": 1112324, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c0d5f88b71e5eca44b2b641e3e4ba6b3?s=128&d=identicon&r=PG", "display_name": "user1112324", "link": "https://stackoverflow.com/users/1112324/user1112324"}, "reply_to_user": {"reputation": 22172, "user_id": 1263942, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/b272a5e1d5d3589192d942552e51e2a8?s=128&d=identicon&r=PG", "display_name": "Bruno Grieder", "link": "https://stackoverflow.com/users/1263942/bruno-grieder"}, "edited": false, "score": 0, "creation_date": 1507004387, "post_id": 46537040, "comment_id": 80028709, "body": "Would I then need to check each value in the <code>loadFromFile</code> method?"}], "answers": [{"comments": [{"owner": {"reputation": 473, "user_id": 1112324, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c0d5f88b71e5eca44b2b641e3e4ba6b3?s=128&d=identicon&r=PG", "display_name": "user1112324", "link": "https://stackoverflow.com/users/1112324/user1112324"}, "edited": false, "score": 0, "creation_date": 1507004338, "post_id": 46537129, "comment_id": 80028691, "body": "Are you able to give an example at all for me when you say &#39;Unmarshaling your config file into a struct would preserve nil values for the keys that are missing / have null values.&#39;"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1507004365, "post_id": 46537129, "comment_id": 80028701, "body": "If you ever save this config from Go&#39;s end, you will probably want to add the <code>omitempty</code> option to the <code>json</code> tag e.g. <code>json:&quot;streamGroup,omitempty&quot;</code>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 473, "user_id": 1112324, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c0d5f88b71e5eca44b2b641e3e4ba6b3?s=128&d=identicon&r=PG", "display_name": "user1112324", "link": "https://stackoverflow.com/users/1112324/user1112324"}, "edited": false, "score": 0, "creation_date": 1507004544, "post_id": 46537129, "comment_id": 80028739, "body": "@user1112324 What do you mean an example? If that value is missing from the <code>json</code>, it will be <code>nil</code>, what is there to give an example for?"}, {"owner": {"reputation": 5692, "user_id": 626810, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dde9640589b85543aa33fddb58bb169c?s=128&d=identicon&r=PG", "display_name": "Blaskovicz", "link": "https://stackoverflow.com/users/626810/blaskovicz"}, "edited": false, "score": 0, "creation_date": 1507004771, "post_id": 46537129, "comment_id": 80028788, "body": "added go playground example - <a href=\"https://play.golang.org/p/DU_5Tuvm5-\" rel=\"nofollow noreferrer\">play.golang.org/p/DU_5Tuvm5-</a>. Try adding <code>\\&quot;foo\\&quot;: \\&quot;\\&quot;</code> to the string reader body to see another example."}], "tags": [], "owner": {"reputation": 5692, "user_id": 626810, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dde9640589b85543aa33fddb58bb169c?s=128&d=identicon&r=PG", "display_name": "Blaskovicz", "link": "https://stackoverflow.com/users/626810/blaskovicz"}, "is_accepted": true, "score": 4, "last_activity_date": 1507004753, "last_edit_date": 1507004753, "creation_date": 1507004160, "answer_id": 46537129, "question_id": 46537040, "link": "https://stackoverflow.com/questions/46537040/how-to-check-if-a-specific-property-of-a-struct-is-null/46537129#46537129", "title": "How to check if a specific property of a struct is null?", "body": "<p>In go, a value's default value is its <a href=\"https://tour.golang.org/basics/12\" rel=\"nofollow noreferrer\">zero value</a>. You may want to make all of your types pointers (eg: <code>*string</code> rather than <code>string</code>) since the zero value of a pointer is <code>nil</code>. Unmarshaling your config file into a struct would preserve nil values for the keys that are missing / have null values.</p>\n\n<p>Note that since slices (eg: <code>[]string</code>) are reference types, they act as pointers and are nullable (meaning you wouldn't need to declare the type as <code>*[]string</code>).</p>\n\n<p>I've used this library in the past to help with merging config / setting required keys (and many others exist):\n<a href=\"https://github.com/jinzhu/configor\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/configor</a></p>\n\n<p>Example of encoding/decoding json - <a href=\"https://play.golang.org/p/DU_5Tuvm5-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/DU_5Tuvm5-</a></p>\n"}], "owner": {"reputation": 473, "user_id": 1112324, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c0d5f88b71e5eca44b2b641e3e4ba6b3?s=128&d=identicon&r=PG", "display_name": "user1112324", "link": "https://stackoverflow.com/users/1112324/user1112324"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3465, "favorite_count": 0, "accepted_answer_id": 46537129, "answer_count": 1, "score": 2, "last_activity_date": 1507004753, "creation_date": 1507003416, "question_id": 46537040, "link": "https://stackoverflow.com/questions/46537040/how-to-check-if-a-specific-property-of-a-struct-is-null", "title": "How to check if a specific property of a struct is null?", "body": "<p>Forgive me, I come from a c# background!</p>\n\n<p>I have following struct in Go. We populate this struct by reading in the config from a file, which works well. However Im trying to find out a way to tell if a particular property in the struct, when passed in through the config file is null. As in, explicitly not set at all. </p>\n\n<p>I've struggled for about 3 hours on this. I can do it for type strings etc, but I can't find out how to do it generically, across all types?</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n    \"reflect\"\n)\n\n// Config type for configuration\ntype Config struct {\n    BatchSize  int    `json:\"batchSize\"`\n    BatchTime  int    `json:\"batchTime\"`\n    DataFolder string `json:\"dataFolder\"`\n    TempFolder string `json:\"tempFolder\"`\n\n    //Kafka configuration\n    Brokers      []string `json:\"streamBrokers\"`\n    TopicJoined  string   `json:\"streamTopicJoined\"`\n    TopicRemoved string   `json:\"streamTopicRemoved\"`\n    Group        string   `json:\"streamGroup\"`\n    ClientName   string   `json:\"streamClientName\"`\n\n    // Stats configuration\n    StatsPrefix string `json:\"statsPrefix\"`\n\n    //AWS S3 configuration\n    AccessKey              string `json:\"amazonAccessKey\"`\n    SecretKey              string `json:\"amazonSecretKey\"`\n    Region                 string `json:\"amazonRegion\"`\n    Endpoint               string `json:\"amazonEndpoint\"`\n    S3Bucket               string `json:\"amazonS3Bucket\"`\n    S3UploadBufferSize     int32  `json:\"amazonS3UploadBufferSize\"`\n    S3UploadConcurrentSize int32  `json:\"amazonS3UploadConcurrentSize\"`\n    S3UploadRetries        int32  `json:\"amazonS3UploadRetries\"`\n    S3UploadRetryTime      int32  `json:\"amazonS3UploadRetryTime\"`\n\n    //Logging\n    StatsdHost string  `json:\"statsdHost\"`\n    StatsdPort int     `json:\"statsdPort\"`\n    StatsdRate float64 `json:\"statsdRate\"`\n\n    //Test Publishing\n    TestMode  bool `json:\"testMode\"`\n    TestCount int  `json:\"testCount\"`\n}\n\n// LoadConfig load config from file\nfunc LoadConfig(configFile string) *Config {\n    if _, err := os.Stat(configFile); os.IsNotExist(err) {\n        panic(err)\n    }\n\n    if config, err := loadFromFile(configFile); nil != err {\n        panic(err)\n    } else {\n        fmt.Println(\"OneDrive\", os.Getenv(\"OneDrive\"))\n        msValuePtr := reflect.ValueOf(config)\n        msValue := msValuePtr.Elem()\n        typeOfT := msValue.Type()\n\n        for i := 0; i &lt; msValue.NumField(); i++ {\n            field := msValue.Field(i)\n            // TODO: Check if field is null, regardless of type and the value from OS env variables...\n\n        }\n        return config\n    }\n}\n\nfunc loadFromFile(path string) (*Config, error) {\n    var config Config\n    file, err := os.Open(path)\n    if err != nil {\n        return nil, fmt.Errorf(\"could not open config path %q: %v\", path, err)\n    }\n    defer file.Close()\n\n    decoder := json.NewDecoder(file)\n    err = decoder.Decode(&amp;config)\n    if err != nil {\n        return nil, fmt.Errorf(\"could not parse config path %q: %v\", path, err)\n    }\n    return &amp;config, nil\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 1, "creation_date": 1507001940, "post_id": 46536687, "comment_id": 80028177, "body": "FWIW <code>String()</code> is usually a method <code>String() string</code> that fulfils the <code>fmt.Stringer</code> (<a href=\"https://golang.org/pkg/fmt/#Stringer\" rel=\"nofollow noreferrer\">golang.org/pkg/fmt/#Stringer</a>) interface.  Most Go programmers will be surprised seeing a <code>String()</code> that doesn&#39;t return <code>string</code>"}], "answers": [{"tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": true, "score": 3, "last_activity_date": 1507002157, "last_edit_date": 1507002157, "creation_date": 1507001797, "answer_id": 46536836, "question_id": 46536687, "link": "https://stackoverflow.com/questions/46536687/property-in-golang-struct-not-getting-modified/46536836#46536836", "title": "Property in Golang struct not getting modified", "body": "<p>This isn't a type system issue, but an issue with how data is passed in Go.</p>\n\n<p>I think the root misunderstanding is about \"passing by reference\".  In Go, everything is passed by value, there is no pass by reference (<a href=\"https://golang.org/doc/faq#pass_by_value\" rel=\"nofollow noreferrer\">https://golang.org/doc/faq#pass_by_value</a>)</p>\n\n<p>So when you pass a <code>Node</code> struct in to the <code>addEdge</code> method, it's actually making a copy of that struct.</p>\n\n<p>If you want to refer to the same underlying struct instead of copying it you should pass the pointer to it.</p>\n\n<p>Try the following slightly modified code, that uses pointers to pass the structs: (You can tweak and run the code here: <a href=\"https://play.golang.org/p/Qsbi4LBXS4\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Qsbi4LBXS4</a>)</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Node struct {\n    neighbors []*Edge\n    visited   bool\n    name      string\n}\n\ntype Edge struct {\n    neighbor *Node\n}\n\ntype Graph struct {\n    nodes []*Node\n}\n\nfunc (g *Graph) addNode(node *Node) {\n    g.nodes = append(g.nodes, node)\n}\n\nfunc (n *Node) addEdge(neighbor *Node) {\n    edge := &amp;Edge{\n        neighbor: neighbor,\n    }\n    n.neighbors = append(n.neighbors, edge)\n}\n\nfunc (g Graph) String() {\n    for _, node := range g.nodes {\n        //fmt.Printf(\"nodename: %v\", node.name)\n        fmt.Printf(\"number of neighbors: %d\\n\", len(node.neighbors))\n        if len(node.neighbors) &gt; 0 {\n            fmt.Printf(\"node: %v, edges: \", node.name)\n            for _, e := range node.neighbors {\n                fmt.Printf(\"%q\", e.neighbor.name)\n            }\n            fmt.Println()\n        }\n    }\n}\n\nfunc main() {\n    graph := &amp;Graph{}\n    n1 := &amp;Node{name: \"abc\"}\n    n2 := &amp;Node{name: \"def\"}\n    graph.addNode(n1)\n    graph.addNode(n2)\n    n1.addEdge(n2)\n\n    graph.String()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22172, "user_id": 1263942, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/b272a5e1d5d3589192d942552e51e2a8?s=128&d=identicon&r=PG", "display_name": "Bruno Grieder", "link": "https://stackoverflow.com/users/1263942/bruno-grieder"}, "is_accepted": false, "score": 1, "last_activity_date": 1507001805, "creation_date": 1507001805, "answer_id": 46536837, "question_id": 46536687, "link": "https://stackoverflow.com/questions/46536687/property-in-golang-struct-not-getting-modified/46536837#46536837", "title": "Property in Golang struct not getting modified", "body": "<p>You need to pass your variables by pointer or a new value is created </p>\n\n<pre><code> func (g *Graph) addNode(node *Node) {\n    g.nodes = append(g.nodes, node)\n }\n\n ...\n n1 := Node { name: \"abc\", }\n graph.addNode(&amp;n1)\n ...\n n1.addEdge(&amp;n2)\n</code></pre>\n"}], "owner": {"reputation": 25076, "user_id": 207524, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7204a1f9d3a10e3b044e2e8ca58c877?s=128&d=identicon&r=PG", "display_name": "Crystal", "link": "https://stackoverflow.com/users/207524/crystal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 46536836, "answer_count": 2, "score": 0, "last_activity_date": 1556059327, "creation_date": 1507000531, "last_edit_date": 1556059327, "question_id": 46536687, "link": "https://stackoverflow.com/questions/46536687/property-in-golang-struct-not-getting-modified", "title": "Property in Golang struct not getting modified", "body": "<p>I'm coming from Java and trying to figure out how Go's type system works.  I want to create a simple graph data structure and implement breadth first search.  This is what I have so far.</p>\n\n<pre><code>package graph\n\nimport \"fmt\"\n\ntype Node struct {\n    neighbors []Edge\n    visited   bool\n    name      string\n}\n\ntype Edge struct {\n    neighbor Node\n}\n\ntype Graph struct {\n    nodes []Node\n}\n\nfunc (g *Graph) addNode(node Node) {\n    g.nodes = append(g.nodes, node)\n}\n\nfunc (n *Node) addEdge(neighbor Node) {\n    edge := Edge{\n        neighbor: neighbor,\n    }\n    n.neighbors = append(n.neighbors, edge)\n}\n\nfunc (g Graph) String() {\n    for _, node := range g.nodes {\n        //fmt.Printf(\"nodename: %v\", node.name)\n        fmt.Println(len(node.neighbors))\n        if len(node.neighbors) &gt; 0 {\n            fmt.Print(\"node: %v, edges: \", node.name)\n            for _, e := range node.neighbors {\n                fmt.Print(e.neighbor.name)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>when I try to run it with test code:</p>\n\n<pre><code>func TestGraph(t *testing.T) {\n    graph := Graph{}\n    n1 := Node { name: \"abc\", }\n    n2 := Node { name: \"def\", }\n    graph.addNode(n1) \n    graph.addNode(n2) \n    n1.addEdge(n2)\n\n    graph.String()\n}\n</code></pre>\n\n<p>in my String() method, the len(node.neighbors) is always 0.  What am I doing wrong?  I thought that since I take in a reference type in addEdge, it modifies the node reference but I'm obviously I'm missing something about Go's type system. </p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 1585, "user_id": 5025679, "user_type": "registered", "accept_rate": 7, "profile_image": "https://graph.facebook.com/10102218283349199/picture?type=large", "display_name": "Bobby Battista", "link": "https://stackoverflow.com/users/5025679/bobby-battista"}, "edited": false, "score": 0, "creation_date": 1507002419, "post_id": 46536521, "comment_id": 80028289, "body": "Thank you! Any reason that you use Ack * Ack? How is that different from just Ack Ack?"}, {"owner": {"reputation": 2731, "user_id": 440166, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/3880325020651bb6618686091bec6b02?s=128&d=identicon&r=PG", "display_name": "Mobius", "link": "https://stackoverflow.com/users/440166/mobius"}, "reply_to_user": {"reputation": 1585, "user_id": 5025679, "user_type": "registered", "accept_rate": 7, "profile_image": "https://graph.facebook.com/10102218283349199/picture?type=large", "display_name": "Bobby Battista", "link": "https://stackoverflow.com/users/5025679/bobby-battista"}, "edited": false, "score": 0, "creation_date": 1507033552, "post_id": 46536521, "comment_id": 80043026, "body": "if it&#39;s not a pointer, then it can&#39;t be <code>nil</code>, you can still check if it&#39;s empty, but it&#39;s easier to check that it&#39;s <code>nil</code>"}, {"owner": {"reputation": 2731, "user_id": 440166, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/3880325020651bb6618686091bec6b02?s=128&d=identicon&r=PG", "display_name": "Mobius", "link": "https://stackoverflow.com/users/440166/mobius"}, "reply_to_user": {"reputation": 1585, "user_id": 5025679, "user_type": "registered", "accept_rate": 7, "profile_image": "https://graph.facebook.com/10102218283349199/picture?type=large", "display_name": "Bobby Battista", "link": "https://stackoverflow.com/users/5025679/bobby-battista"}, "edited": false, "score": 0, "creation_date": 1507079241, "post_id": 46536521, "comment_id": 80065198, "body": "dear downvoters, please explain, is there something wrong with this answer?"}, {"owner": {"reputation": 642, "user_id": 4203744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4b8ec66122aa4930cf806cea6b3cd3f?s=128&d=identicon&r=PG", "display_name": "Matthew Curry", "link": "https://stackoverflow.com/users/4203744/matthew-curry"}, "edited": false, "score": 0, "creation_date": 1607439340, "post_id": 46536521, "comment_id": 115268916, "body": "@Mobius gave you an upvote, this is similar to what I did for a project. Pointers allowed you to see if that data was provided or not, which makes it quick to validate.  The parse the json twice crowd may not realize at how slow that can be sometimes."}], "tags": [], "owner": {"reputation": 2731, "user_id": 440166, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/3880325020651bb6618686091bec6b02?s=128&d=identicon&r=PG", "display_name": "Mobius", "link": "https://stackoverflow.com/users/440166/mobius"}, "is_accepted": false, "score": 0, "last_activity_date": 1506999091, "creation_date": 1506999091, "answer_id": 46536521, "question_id": 46536234, "link": "https://stackoverflow.com/questions/46536234/how-to-parse-json-in-golang-without-unmarshaling-twice/46536521#46536521", "title": "How to parse JSON in golang without unmarshaling twice", "body": "<p>You will want to create a struct which contains all keys you <em>might</em> receive, then unmarshal once, finally based on which keys are <code>nil</code> you can decide what kind of packet you got.</p>\n\n<p>The example below displays this behavior: <a href=\"https://play.golang.org/p/aFG6M0SPJs\" rel=\"nofollow noreferrer\">https://play.golang.org/p/aFG6M0SPJs</a></p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/json\"\n  \"fmt\"\n  \"strings\"\n)\n\n\ntype Ack struct {\n  Messages []string `json:\"messages\"`\n}\n\ntype Packet struct {\n  Ack  * Ack    `json:\"ack\"`\n  Ping * string `json:\"ping\"`\n}\n\nfunc runTest(testJSON []byte) {\n  var p = Packet{}\n  err := json.Unmarshal(testJSON, &amp;p)\n  if err != nil {\n    fmt.Println(\"error unmarshalling: \", err)\n  }\n  if (p.Ack != nil) {\n    fmt.Println(\"Got ACK: \", strings.Join(p.Ack.Messages, \", \"));\n  } else if (p.Ping != nil){\n          fmt.Println(\"Got PING\");\n  }\n}\n\nfunc main() {\n  tests := [][]byte{\n    []byte(`{\"ack\":{\"messages\":[\"Hi there\",\"Hi again\"]}}`),\n    []byte(`{\"ping\": \"Are you there?\"}`),\n  }\n  for _, test := range tests {\n    runTest(test)\n  }\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5692, "user_id": 626810, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dde9640589b85543aa33fddb58bb169c?s=128&d=identicon&r=PG", "display_name": "Blaskovicz", "link": "https://stackoverflow.com/users/626810/blaskovicz"}, "is_accepted": false, "score": 0, "last_activity_date": 1507005266, "creation_date": 1507005266, "answer_id": 46537273, "question_id": 46536234, "link": "https://stackoverflow.com/questions/46536234/how-to-parse-json-in-golang-without-unmarshaling-twice/46537273#46537273", "title": "How to parse JSON in golang without unmarshaling twice", "body": "<p>Another solution is to use a common key between all messages (eg: <code>type</code>) which indicates what type of message it is. After this, if the messages aren't sufficiently complicated, you can build the raw structs from the other map keys / type assert map values:</p>\n\n<p>From some related websocket code I wrote that does this:\n<a href=\"https://github.com/blaskovicz/cut-me-some-slack/blob/master/chat/message.go#L66\" rel=\"nofollow noreferrer\">https://github.com/blaskovicz/cut-me-some-slack/blob/master/chat/message.go#L66</a></p>\n\n<pre><code>func DecodeClientMessage(c *ClientMessage) (typedMessage interface{}, err error) {\n    buff := map[string]string{}\n    err = json.NewDecoder(bytes.NewReader(c.Raw)).Decode(&amp;buff)\n    if err != nil {\n        return\n    }\n\n    switch t := buff[\"type\"]; t {\n    case \"message\":\n        channelID := buff[\"channel_id\"]\n        if channelID == \"\" {\n            err = fmt.Errorf(\"invalid client message received: missing channel_id\")\n            return\n        }\n        cms := &amp;ClientMessageSend{ChannelID: channelID, Text: buff[\"text\"]}\n        if cms.Text == \"\" {\n            err = fmt.Errorf(\"invalid client message received: missing text\")\n        } else {\n            typedMessage = cms\n        }\n</code></pre>\n\n<p>... and then the caller code does a <code>result.(type)</code> assertion and switch:\n<a href=\"https://github.com/blaskovicz/cut-me-some-slack/blob/master/chat/hub.go#L150\" rel=\"nofollow noreferrer\">https://github.com/blaskovicz/cut-me-some-slack/blob/master/chat/hub.go#L150</a></p>\n\n<pre><code>switch m := raw.(type) {\ncase *ClientMessageHistory:\n    channelID := h.resolveSlackChannel(m.ChannelID)\n    if channelID == \"\" {\n        log.Printf(\"error: no channel found matching %s\\n\", m.ChannelID)\n        return\n    }\n    var username string\n    if c.Client.User != nil {\n        username = c.Client.User.Username\n    } else {\n        username = \"&lt;anonymous&gt;\"\n    }\n    log.Printf(\"sending previous messages for channel %s to client %s\\n\", channelID, username)\n    for _, prevMessage := range h.previousMessages(channelID, m.Limit) {\n        c.Client.send &lt;- prevMessage\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": false, "score": 5, "last_activity_date": 1507012359, "creation_date": 1507012359, "answer_id": 46538415, "question_id": 46536234, "link": "https://stackoverflow.com/questions/46536234/how-to-parse-json-in-golang-without-unmarshaling-twice/46538415#46538415", "title": "How to parse JSON in golang without unmarshaling twice", "body": "<p>One solution is to partially unmarshal the data by unmarshalling the values into a <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"noreferrer\"><code>json.RawMessage</code></a> instead of an <code>interface{}</code></p>\n\n<pre><code>var myMap map[string]json.RawMessage\n</code></pre>\n\n<p>Later in the switch, which still is required, you do not need to marshal. Just do:</p>\n\n<pre><code>err = json.Unmarshal(v, &amp;myAck)\n</code></pre>\n\n<p><strong>Playground:</strong> <a href=\"https://play.golang.org/p/NHd3uH5e7z\" rel=\"noreferrer\">https://play.golang.org/p/NHd3uH5e7z</a></p>\n"}], "owner": {"reputation": 1585, "user_id": 5025679, "user_type": "registered", "accept_rate": 7, "profile_image": "https://graph.facebook.com/10102218283349199/picture?type=large", "display_name": "Bobby Battista", "link": "https://stackoverflow.com/users/5025679/bobby-battista"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3368, "favorite_count": 2, "answer_count": 3, "score": 3, "last_activity_date": 1507012359, "creation_date": 1506996776, "last_edit_date": 1506997084, "question_id": 46536234, "link": "https://stackoverflow.com/questions/46536234/how-to-parse-json-in-golang-without-unmarshaling-twice", "title": "How to parse JSON in golang without unmarshaling twice", "body": "<p>I've got a web socket connection that sends different types of messages in a JSON object, and I want to unmarshal the contents into some known structs. \nTo do this, I figure I should do the following:</p>\n\n<p>Step 1) Unmarshal the JSON into a generic map[string]interface{}</p>\n\n<p>Step 2) Find the key I'm looking for</p>\n\n<p>Step 3) Try to cast the value into one of my types (this fails)</p>\n\n<p>Step 3 alternate) json marshal this value and unmarshal it to my known struct</p>\n\n<p>If I try to use <code>myStruct, ok := value.(myType)</code> it will fail, but if I json.marshal(value) and then json.unmarshal to myStruct, it works just fine. Is that how I'm supposed to do this? Going json-> map[string]interface{} -> json -> myStruct seems redundant to me.</p>\n\n<p>Sample code:</p>\n\n<p><a href=\"https://play.golang.org/p/to_0Id_ja9\" rel=\"nofollow noreferrer\">https://play.golang.org/p/to_0Id_ja9</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Ping struct {\n    Ping string `json:\"ping\"`\n}\n\ntype Ack struct {\n    Messages []Message `json:\"messages\"`\n}\n\ntype Message string\n\nfunc main() {\n    testJSON := []byte(`{\"ack\":{\"messages\":[\"Hi there\",\"Hi again\"]}}`)\n    var myAck = Ack{}\n    var myMap map[string]interface{}\n    err := json.Unmarshal(testJSON, &amp;myMap)\n    if err != nil {\n        fmt.Println(\"error unmarshalling: \", err)\n    }\n    for k, v := range myMap {\n        fmt.Printf(\"key: %s, value: %s \\n\", k, v)\n\n        switch k {\n        case \"ping\":\n            fmt.Println(k, \" is a ping\", v)\n        case \"ack\":\n            fmt.Println(k, \" is an ack containing a message list\")\n            ackjson, err := json.Marshal(v)\n            if err != nil {\n                fmt.Println(\"marshal error: \", err)\n            }\n            err = json.Unmarshal(ackjson, &amp;myAck)\n            if err != nil {\n                fmt.Println(\"unmarshal error\", err)\n            } else {\n                fmt.Println(\"New ack object: \", myAck)\n            }\n        default:\n            fmt.Printf(\"%s is of a type (%T) I don't know how to handle\", k, v)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["rest", "testing", "go", "mocking", "integration-testing"], "answers": [{"tags": [], "owner": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "is_accepted": false, "score": 2, "last_activity_date": 1506998651, "creation_date": 1506998651, "answer_id": 46536468, "question_id": 46535770, "link": "https://stackoverflow.com/questions/46535770/golang-http-rest-mocking/46536468#46536468", "title": "Golang HTTP REST mocking", "body": "<p>Writing this out helped me answer my own question.</p>\n\n<p><code>main()</code> would read in environment variables and then call a function like <code>doBackup(client_id, region)</code>. My test would mock the endpoints and then call <code>doBackup(client_id, region)</code>.</p>\n"}], "owner": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2019, "favorite_count": 3, "answer_count": 1, "score": 3, "last_activity_date": 1506998651, "creation_date": 1506992501, "last_edit_date": 1506994003, "question_id": 46535770, "link": "https://stackoverflow.com/questions/46535770/golang-http-rest-mocking", "title": "Golang HTTP REST mocking", "body": "<p>I writing a client that connects to a server with REST endpoints. The client needs to make a chain of 11 different requests to complete an action (it's a <a href=\"http://catb.org/jargon/html/R/rococo.html\" rel=\"nofollow noreferrer\">rococo</a> backup system).</p>\n\n<p>I'm writing my client in Go and I also want to write my mocks/tests in Go. What I'm unclear about is how a test called <code>func TestMain</code> would call into the client's <code>func main()</code>, to test completion of the chain of 11 requests.</p>\n\n<p>My client's binary would be run from the shell in the following way:</p>\n\n<p><code>$ client_id=12345 region=apac3 backup</code></p>\n\n<p>How would I call <code>func main()</code> from the tests, with environment variables set? Or is there another approach? (I'm <a href=\"https://github.com/soniah/gosnmp/blob/master/marshal_test.go\" rel=\"nofollow noreferrer\">comfortable writing tests</a>, so that's not the issue)</p>\n\n<p>I'm looking at the Advanced Example in <a href=\"https://github.com/jarcoal/httpmock\" rel=\"nofollow noreferrer\">jarcoal/httpmock</a> (but I could use another library). At the end the example says <code>// do stuff that adds and checks articles</code>, is that where I would call <code>main()</code>?</p>\n\n<p>I've pasted the Advanced Example below, for future reference.</p>\n\n<hr>\n\n<pre><code>func TestFetchArticles(t *testing.T) {\n    httpmock.Activate()\n    defer httpmock.DeactivateAndReset()\n\n    // our database of articles\n    articles := make([]map[string]interface{}, 0)\n\n    // mock to list out the articles\n    httpmock.RegisterResponder(\"GET\", \"https://api.mybiz.com/articles.json\",\n        func(req *http.Request) (*http.Response, error) {\n            resp, err := httpmock.NewJsonResponse(200, articles)\n            if err != nil {\n                return httpmock.NewStringResponse(500, \"\"), nil\n            }\n            return resp, nil\n        },\n    )\n\n    // mock to add a new article\n    httpmock.RegisterResponder(\"POST\", \"https://api.mybiz.com/articles.json\",\n        func(req *http.Request) (*http.Response, error) {\n            article := make(map[string]interface{})\n            if err := json.NewDecoder(req.Body).Decode(&amp;article); err != nil {\n                return httpmock.NewStringResponse(400, \"\"), nil\n            }\n\n            articles = append(articles, article)\n\n            resp, err := httpmock.NewJsonResponse(200, article)\n            if err != nil {\n                return httpmock.NewStringResponse(500, \"\"), nil\n            }\n            return resp, nil\n        },\n    )\n\n    // do stuff that adds and checks articles\n}\n</code></pre>\n"}, {"tags": ["dictionary", "go"], "answers": [{"tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": true, "score": 2, "last_activity_date": 1506978243, "creation_date": 1506978243, "answer_id": 46533695, "question_id": 46533551, "link": "https://stackoverflow.com/questions/46533551/what-is-the-idiomatic-go-way-of-testing-for-and-processing-multiple-keys-in-a/46533695#46533695", "title": "What is the idiomatic Go way of testing for, and processing, multiple keys in a map?", "body": "<p>One way to do it is to create your own <code>map[string]string</code> type and add some simple methods to that. Here is a simple example:</p>\n\n<pre><code>type mapExists map[string]string\n\nfunc (m mapExists) exists(key string) bool {\n    _, ok := m[key]\n    return ok\n}\n\nfunc (m mapExists) isInt(key string) bool {\n    v, ok := m[key]\n    if !ok {\n        return false\n    }\n\n    _, err := strconv.ParseInt(v, 10, 64)\n    return err == nil\n}\n</code></pre>\n\n<p>You can convert a <code>map[string]string</code> to the <code>mapExists</code> with:</p>\n\n<pre><code>m := map[string]string{\n    \"a\": \"b\",\n    \"c\": \"2\",\n}\n\nm2 := mapExists(m)\n</code></pre>\n\n<p>And then call stuff like in your example:</p>\n\n<pre><code>fmt.Println(\"a exists:\\t\", m2.exists(\"a\"))\nfmt.Println(\"asd exists:\\t\", m2.exists(\"asd\"))\nfmt.Println(\"a isInt:\\t\", m2.isInt(\"a\"))\nfmt.Println(\"c isInt:\\t\", m2.isInt(\"c\"))\n</code></pre>\n\n<p>Which will output:</p>\n\n<pre><code>a exists:        true\nasd exists:      false\na isInt:         false\nc isInt:         true\n</code></pre>\n\n<hr>\n\n<p>Whether this is the \"best\" or \"idiomatic\" way is a matter of opinion and depends on the circumstances. In general, I would (personally) prefer to <em>not</em> use these wrappers. Your above example could be rewritten to something like the following :</p>\n\n<pre><code>func test() {\n    m := map[string]string{\"a\": \"b\", \"c\": \"d\", \"e\": \"f\"}\n\n    v1, v1ok := m[\"a\"]\n    v2, v2ok := m[\"c\"]\n    if !v1ok || !v2ok {\n       return\n    }\n\n    i1, err := strconv.Atoi(v1)\n    if err != nil {\n       return\n    }\n    i2, err := strconv.Atoi(v2) {\n    if err != nil {\n       return\n    }\n}\n</code></pre>\n\n<p>Which I think is much more readable. It's more verbose, but Go is a verbose language ;-)</p>\n\n<p>But again, it depends on the entirety of your codebase. If you're calling this pattern very often then a custom type <em>might</em> be a good solution (at the cost of slightly lower performance, which may or may not be a problem).</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1506978929, "creation_date": 1506978929, "answer_id": 46533836, "question_id": 46533551, "link": "https://stackoverflow.com/questions/46533551/what-is-the-idiomatic-go-way-of-testing-for-and-processing-multiple-keys-in-a/46533836#46533836", "title": "What is the idiomatic Go way of testing for, and processing, multiple keys in a map?", "body": "<p>Testing if a <code>string</code> value is a number and converting it to a number is basically the same amount of work.</p>\n\n<p>So I would rather use the following util function which besides checking the keys and testing the values also returns the converted numbers:</p>\n\n<pre><code>func getInts(m map[string]string, keys ...string) (is []int, err error) {\n    for _, k := range keys {\n        v, ok := m[k]\n        if !ok {\n            return is, fmt.Errorf(\"%s is missing\", k)\n        }\n        var i int\n        if i, err = strconv.Atoi(v); err != nil {\n            return\n        }\n        is = append(is, i)\n    }\n    return\n}\n</code></pre>\n\n<p>Testing it with 3 different cases:</p>\n\n<pre><code>maps := []map[string]string{\n    {},\n    {\"a\": \"b\", \"c\": \"d\", \"e\": \"f\"},\n    {\"a\": \"1\", \"c\": \"2\", \"e\": \"f\"},\n}\n\nfor _, m := range maps {\n    if is, err := getInts(m, \"a\", \"c\"); err == nil {\n        fmt.Println(\"Numbers:\", is)\n    } else {\n        fmt.Println(\"Error:\", err)\n    }\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/WztZIraxFG\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Error: a is missing\nError: strconv.Atoi: parsing \"b\": invalid syntax\nNumbers: [1 2]\n</code></pre>\n"}], "owner": {"reputation": 1626, "user_id": 1488821, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ff34020e0a05e5f3b45e4e3825bf7c64?s=128&d=identicon&r=PG", "display_name": "Ivan Voras", "link": "https://stackoverflow.com/users/1488821/ivan-voras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 46533695, "answer_count": 2, "score": 2, "last_activity_date": 1506984658, "creation_date": 1506977449, "last_edit_date": 1506984658, "question_id": 46533551, "link": "https://stackoverflow.com/questions/46533551/what-is-the-idiomatic-go-way-of-testing-for-and-processing-multiple-keys-in-a", "title": "What is the idiomatic Go way of testing for, and processing, multiple keys in a map?", "body": "<p>I have a <code>map[string]string</code> and I need to test if some keys exist and if they do, convert some of the values to integers. For example:</p>\n\n<pre><code>m := map[string]string{\"a\": \"b\", \"c\": \"d\", \"e\": \"f\"}\nif v1, ok := m[\"a\"]; ok {\n  if v2, ok := m[\"c\"]; ok {\n     if i1, err := strconv.Atoi(v1); err != nil {\n       if i2, err := strconv.Atoi(v2); err != nil {\n         // do something with i1, i2\n       }\n     }\n  }\n}\n</code></pre>\n\n<p>I find myself thinking in the lines of:</p>\n\n<pre><code>if m.exists(\"a\") &amp;&amp; m.exists(\"c\") &amp;&amp; is_int(m[\"a\"]) &amp;&amp; is_int(m[\"c\"]) {\n   // do something with atoi(m[\"a\"]) and atoi(m[\"c\"])\n}\n</code></pre>\n\n<p>... but that's not convenient with Go's standard library. So, what is the Go way of doing it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506974364, "post_id": 46532450, "comment_id": 80020315, "body": "How would set a color in your image if you couldn&#39;t convert your color to the correct model?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506974497, "post_id": 46532450, "comment_id": 80020387, "body": "How would you determine the color model if the image would not provide this information?"}, {"owner": {"reputation": 1704, "user_id": 1931098, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/080d676d788903407f4e99ef245ca707?s=128&d=identicon&r=PG", "display_name": "Alex Lew", "link": "https://stackoverflow.com/users/1931098/alex-lew"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506974504, "post_id": 46532450, "comment_id": 80020390, "body": "@JimB In general, you can&#39;t set a color in the image. None of the interface methods support changing a color, and not all images are stored as mutable arrays of colors."}, {"owner": {"reputation": 1704, "user_id": 1931098, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/080d676d788903407f4e99ef245ca707?s=128&d=identicon&r=PG", "display_name": "Alex Lew", "link": "https://stackoverflow.com/users/1931098/alex-lew"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506974624, "post_id": 46532450, "comment_id": 80020454, "body": "@Volker Hmm, what do you need to determine the color model for? color.Color is an interface with a method for converting to RGBA. And in general, &quot;knowing a color model&quot; just means having a way to convert an arbitrary color into that color model (color.Model is an interface with a single method for conversion). What good is it to be able to convert?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506975240, "post_id": 46532450, "comment_id": 80020787, "body": "@AlexLew: yup, forgot that <code>Set</code> calls convert regardless, since I rarely ever use <code>At</code> and <code>Set</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1704, "user_id": 1931098, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/080d676d788903407f4e99ef245ca707?s=128&d=identicon&r=PG", "display_name": "Alex Lew", "link": "https://stackoverflow.com/users/1931098/alex-lew"}, "edited": false, "score": 0, "creation_date": 1506974965, "post_id": 46532793, "comment_id": 80020627, "body": "Thanks! This makes sense. I guess it still seems misleading to me to say that you return a color.Model, an interface, when consumers actually compare your returned object to a predefined set of existing objects. But I can see that there might not be a better way to arrange things, given Go&#39;s lack of, e.g., tagged union types."}, {"owner": {"reputation": 1704, "user_id": 1931098, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/080d676d788903407f4e99ef245ca707?s=128&d=identicon&r=PG", "display_name": "Alex Lew", "link": "https://stackoverflow.com/users/1931098/alex-lew"}, "edited": false, "score": 0, "creation_date": 1506975225, "post_id": 46532793, "comment_id": 80020775, "body": "Hope it&#39;s OK to ask one follow-up! Why is this approach (switching on the return value of the ColorModel() method) more desirable than using a type-switch on the color returned by the <code>At</code> method?"}, {"owner": {"reputation": 101, "user_id": 6718791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c335c19126519ef7e0e20be83f7ea65?s=128&d=identicon&r=PG&f=1", "display_name": "Elbert Fliek", "link": "https://stackoverflow.com/users/6718791/elbert-fliek"}, "reply_to_user": {"reputation": 1704, "user_id": 1931098, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/080d676d788903407f4e99ef245ca707?s=128&d=identicon&r=PG", "display_name": "Alex Lew", "link": "https://stackoverflow.com/users/1931098/alex-lew"}, "edited": false, "score": 1, "creation_date": 1506982455, "post_id": 46532793, "comment_id": 80023686, "body": "I think the primary reason will be speed. The type switch is slower. For a simple benchmark: <a href=\"https://play.golang.org/p/bocw3y9RHS\" rel=\"nofollow noreferrer\">play.golang.org/p/bocw3y9RHS</a>  I also think it looks stylistically nicer to get the ColorModel directly instead of first getting some pixel&#39;s color and then checking the type of that.  Both would work though."}], "tags": [], "owner": {"reputation": 101, "user_id": 6718791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c335c19126519ef7e0e20be83f7ea65?s=128&d=identicon&r=PG&f=1", "display_name": "Elbert Fliek", "link": "https://stackoverflow.com/users/6718791/elbert-fliek"}, "is_accepted": true, "score": 2, "last_activity_date": 1506974111, "creation_date": 1506974111, "answer_id": 46532793, "question_id": 46532450, "link": "https://stackoverflow.com/questions/46532450/what-is-the-purpose-of-the-colormodel-method-in-the-image-image-interface/46532793#46532793", "title": "What is the purpose of the ColorModel() method in the image.Image interface?", "body": "<p>I'm not sure if I understand your question entirely, but I do not think the purpose of ColorModel() is to change the color. It is only to get the color model.</p>\n\n<p>The standard library uses it mostly when encoding images, like in the png package:</p>\n\n<pre><code>switch m.ColorModel() {\ncase color.GrayModel:\n    e.cb = cbG8\ncase color.Gray16Model:\n    e.cb = cbG16\ncase color.RGBAModel, color.NRGBAModel, color.AlphaModel:\n    if opaque(m) {\n        e.cb = cbTC8\n    } else {\n        e.cb = cbTCA8\n    }\ndefault:\n    if opaque(m) {\n        e.cb = cbTC16\n    } else {\n        e.cb = cbTCA16\n    }\n}\n</code></pre>\n\n<p>Another hint on it's intended use can be found in the jpeg/writer:</p>\n\n<pre><code>// TODO(wathiede): switch on m.ColorModel() instead of type.\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1704, "user_id": 1931098, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/080d676d788903407f4e99ef245ca707?s=128&d=identicon&r=PG", "display_name": "Alex Lew", "link": "https://stackoverflow.com/users/1931098/alex-lew"}, "edited": false, "score": 0, "creation_date": 1507044495, "post_id": 46537541, "comment_id": 80050555, "body": "Thanks! It&#39;s strange to me to do that, though, because an image can have an RGBA color model without being an <code>image.RGBA</code>. I&#39;ve implemented my own image types that represent, say, graphs of functions, and contain no array of pixel values; the color model is still RGBA because I return RGBA colors from <code>At</code>, but anyone trying to do a type coercion will be disappointed. (In general, if your goal is to do a type coercion, why not just do it and see if it works? Why check a color model first?)"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "reply_to_user": {"reputation": 1704, "user_id": 1931098, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/080d676d788903407f4e99ef245ca707?s=128&d=identicon&r=PG", "display_name": "Alex Lew", "link": "https://stackoverflow.com/users/1931098/alex-lew"}, "edited": false, "score": 0, "creation_date": 1507085483, "post_id": 46537541, "comment_id": 80066465, "body": "You&#39;re correct that the image having <code>color.RGBAModel</code> not necessarily an <code>image.RGBA</code>. My main point is, do the type check <b>outside</b> the loop instead of of doing it <i>inside</i> the loop every time you got a color by <code>At</code> method. It&#39;s expensive. Perhaps, for small image, the difference is unnoticeable, but when dealing with large images (3D/4D images), you will see the difference.  If it&#39;s not an RGB image, you can always fallback to <i>generic</i> inefficient access mode. I&#39;ve updated the answer to reflect my comment."}, {"owner": {"reputation": 1704, "user_id": 1931098, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/080d676d788903407f4e99ef245ca707?s=128&d=identicon&r=PG", "display_name": "Alex Lew", "link": "https://stackoverflow.com/users/1931098/alex-lew"}, "edited": false, "score": 0, "creation_date": 1507166774, "post_id": 46537541, "comment_id": 80106293, "body": "Thanks, your point is well-taken! It seems to me that <code>ColorModel</code> doesn&#39;t really factor into this, though; you can do the type coercion (of the entire image) outside the loop without using <code>ColorModel</code> at all, and if you care about efficiency, you <i>should</i> do this, as the call to <code>ColorModel</code> is extraneous and potentially misleading."}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": false, "score": 1, "last_activity_date": 1609107111, "last_edit_date": 1609107111, "creation_date": 1507007180, "answer_id": 46537541, "question_id": 46532450, "link": "https://stackoverflow.com/questions/46532450/what-is-the-purpose-of-the-colormodel-method-in-the-image-image-interface/46537541#46537541", "title": "What is the purpose of the ColorModel() method in the image.Image interface?", "body": "<p>To extend the accepted answer:</p>\n<p>Although the <code>color.Model</code> is capable of converting a color to a different color type, as said in <a href=\"https://golang.org/pkg/image/#Image\" rel=\"nofollow noreferrer\">the docs</a>:</p>\n<blockquote>\n<p>Interface <code>ColorModel</code> describes the image's color model.</p>\n</blockquote>\n<p>i.e. it's not the pixel's color model. It looks similar, but the latter implies that an image <em>may</em> contain pixel(s) with a different color model.</p>\n<p>Note that an <code>image</code> represents a rectangular grid of homogeneous colors, i.e. all pixels have the same color model. Once you understand the <em>color model</em> of an <code>image</code>, it's better and more efficient to cast the <code>image</code> to a particular concrete image type, then work directly on that particular image. The following snippet illustrates the idea:</p>\n<pre><code>switch img.ColorModel() {\ncase color.RGBAModel:\n    // Try to cast to RGBA first\n    m, ok := img.(*image.RGBA)\n    if !ok {\n        //not an RGBA image, do generic/custom processing,\n        //e.g. using interface exposed by image.Image\n        return\n    }\n    \n    //Direct pixel access for performance\n    for y := m.Rect.Min.Y; y &lt; m.Rect.Max.Y; y++ {\n        yp := (y - m.Rect.Min.Y) * m.Stride\n        for x := m.Rect.Min.X; x &lt; m.Rect.Max.X; x++ {\n            rgba := m.Pix[yp+(x-m.Rect.Min.X)*4:] //[]byte{r, g, b, a}\n            //get rgba component\n            r, g, b, a := rgba[0], rgba[1], rgba[2], rgba[3]\n            \n            //set r channel to RED\n            rgba[0] = 255\n            \n            //...           \n        }\n    }\n}\n</code></pre>\n<p>is more efficient compared to the following code</p>\n<pre><code>// Less efficient image processing\n// a type-switch on the color returned by the `At` method\nb := img.Bounds()\nfor y := b.Min.Y; y &lt; b.Max.Y; y++ {\n    for x := b.Min.X; x &lt; b.Max.X; x++ {\n        col := img.At(x, y)\n        switch col := col.(type) {\n        case color.RGBA:\n            //do something with pixel\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1704, "user_id": 1931098, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/080d676d788903407f4e99ef245ca707?s=128&d=identicon&r=PG", "display_name": "Alex Lew", "link": "https://stackoverflow.com/users/1931098/alex-lew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 457, "favorite_count": 0, "accepted_answer_id": 46532793, "answer_count": 2, "score": 1, "last_activity_date": 1609107111, "creation_date": 1506972655, "question_id": 46532450, "link": "https://stackoverflow.com/questions/46532450/what-is-the-purpose-of-the-colormodel-method-in-the-image-image-interface", "title": "What is the purpose of the ColorModel() method in the image.Image interface?", "body": "<p>Go's <code>image.Image</code> interface has three methods: <code>Bounds</code> (clearly necessary for determining the size of an image), <code>At</code> (which returns the actual color at each pixel), and <code>ColorModel</code>. This last method returns a <code>color.Model</code>, which is capable of converting a color from any model into the representation that this image uses.</p>\n\n<p>Why is <code>ColorModel</code> a part of this interface? How is it used by consumers of the <code>image.Image</code> type? If I have an image <code>img</code>, and I know nothing about its underlying representation, what good does <code>img.ColorModel()</code> do me? I can convert any color into the proper model, but I don't see what I can use this converted color for; the other two ways of interacting with an image, <code>At</code> and <code>Bounds</code>, do not take colors as arguments.</p>\n\n<p>Am I missing something? Do any standard library functions call the <code>ColorModel</code> method of an <code>image.Image</code>, and what for?</p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506970603, "post_id": 46531797, "comment_id": 80018469, "body": "If you need the <code>tzdata</code> package, then you need to install that. What image are you building your binary with?"}, {"owner": {"reputation": 39428, "user_id": 315828, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/033829f8a1562bafb256157e24548fac?s=128&d=identicon&r=PG", "display_name": "xbonez", "link": "https://stackoverflow.com/users/315828/xbonez"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506974001, "post_id": 46531797, "comment_id": 80020126, "body": "I currently do not build within a container. I do intend to fix that by building using the <code>golang:1.7.5-alpine</code> container"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506974211, "post_id": 46531797, "comment_id": 80020228, "body": "If you not building with alpine, you need to be sure you&#39;re building a static binary if you intend to release with alpine. Either way you need the zoneinfo in your final container if you&#39;re using it in your program."}, {"owner": {"reputation": 39428, "user_id": 315828, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/033829f8a1562bafb256157e24548fac?s=128&d=identicon&r=PG", "display_name": "xbonez", "link": "https://stackoverflow.com/users/315828/xbonez"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506974750, "post_id": 46531797, "comment_id": 80020508, "body": "@JimB I am currently building a static binary targeted for my current runtime container. Regarding zoneinfo, I&#39;m trying to figure out the best way to have that in my final container - should I install the <code>tzdata</code> package in my <code>ubuntu</code> container, or use one of <code>golang</code> containers."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506986632, "post_id": 46531797, "comment_id": 80024767, "body": "That&#39;s entirely up to you. You can view the associated Dockerfiles, and see if one suits your needs more than the other. There is no &quot;right&quot; answer here"}], "answers": [{"comments": [{"owner": {"reputation": 39428, "user_id": 315828, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/033829f8a1562bafb256157e24548fac?s=128&d=identicon&r=PG", "display_name": "xbonez", "link": "https://stackoverflow.com/users/315828/xbonez"}, "edited": false, "score": 1, "creation_date": 1506973898, "post_id": 46532352, "comment_id": 80020062, "body": "With this approach, your final runtime container won&#39;t have the time data at <code>&#47;usr&#47;local&#47;go&#47;lib&#47;time&#47;</code> though"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 39428, "user_id": 315828, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/033829f8a1562bafb256157e24548fac?s=128&d=identicon&r=PG", "display_name": "xbonez", "link": "https://stackoverflow.com/users/315828/xbonez"}, "edited": false, "score": 0, "creation_date": 1507006240, "post_id": 46532352, "comment_id": 80029162, "body": "@xbonez of couse, if you need some data files what aren&#39;t get compiled into binary you can <code>ADD</code> them. This way you get minimal image - only things you need."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 2, "last_activity_date": 1506972265, "creation_date": 1506972265, "answer_id": 46532352, "question_id": 46531797, "link": "https://stackoverflow.com/questions/46531797/docker-image-for-built-golang-binary/46532352#46532352", "title": "Docker image for built Golang binary", "body": "<p>I prefer to use multi-stage build. On 1st step you use special golang building container for installing all dependencies and build an application. On 2nd stage I copy binary file to empty <code>alpine</code> container. This allows having all required tooling and minimal docker image simultaneously (in my case 6MB instead of 280MB).</p>\n\n<p>Example of <code>Dockerfile</code>:</p>\n\n<pre><code># build stage\nFROM golang:1.8\nADD . /src\nRUN set -x &amp;&amp; \\\n    cd /src &amp;&amp; \\\n    go get -t -v github.com/lisitsky/go-site-search-string &amp;&amp; \\\n    CGO_ENABLED=0 GOOS=linux go build -a -o goapp\n\n# final stage\nFROM alpine\nWORKDIR /app\nCOPY --from=0 /src/goapp /app/\nENTRYPOINT /goapp\nEXPOSE 8080\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 4664247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77d45c9acb7a6b8fedf5362ab131070e?s=128&d=identicon&r=PG", "display_name": "Tuo Shan", "link": "https://stackoverflow.com/users/4664247/tuo-shan"}, "is_accepted": false, "score": 1, "last_activity_date": 1506986934, "creation_date": 1506986934, "answer_id": 46535102, "question_id": 46531797, "link": "https://stackoverflow.com/questions/46531797/docker-image-for-built-golang-binary/46535102#46535102", "title": "Docker image for built Golang binary", "body": "<p>You can use the system's tzdata. Or you can copy <code>$GOROOT/lib/time/zoneinfo.zip</code> into your image, which is a trimmed version of the system one.</p>\n"}, {"comments": [{"owner": {"reputation": 39428, "user_id": 315828, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/033829f8a1562bafb256157e24548fac?s=128&d=identicon&r=PG", "display_name": "xbonez", "link": "https://stackoverflow.com/users/315828/xbonez"}, "edited": false, "score": 0, "creation_date": 1507062267, "post_id": 46551305, "comment_id": 80060096, "body": "Thanks. Marking this as accepted since this is the approach I ended up going with."}], "tags": [], "owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "is_accepted": true, "score": 1, "last_activity_date": 1507055979, "creation_date": 1507055979, "answer_id": 46551305, "question_id": 46531797, "link": "https://stackoverflow.com/questions/46531797/docker-image-for-built-golang-binary/46551305#46551305", "title": "Docker image for built Golang binary", "body": "<p>This is more of a vote, but apt-get is what we (my company's tech group) do in situations like this. It gives us complete control over the hierarchy of images, but this is assuming you may have future images based on this one.  </p>\n"}, {"tags": [], "owner": {"reputation": 3996, "user_id": 1615594, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VD0n3.jpg?s=128&g=1", "display_name": "tsuz", "link": "https://stackoverflow.com/users/1615594/tsuz"}, "is_accepted": false, "score": 2, "last_activity_date": 1566493417, "creation_date": 1566493417, "answer_id": 57614065, "question_id": 46531797, "link": "https://stackoverflow.com/questions/46531797/docker-image-for-built-golang-binary/57614065#57614065", "title": "Docker image for built Golang binary", "body": "<p>Since not all OS have localized timezone installed, this is what I did to make it work:</p>\n\n<pre><code>ADD https://github.com/golang/go/raw/master/lib/time/zoneinfo.zip /usr/local/go/lib/time/zoneinfo.zip\n</code></pre>\n\n<p>The full example of multi-step Docker image for adding timezone is <a href=\"https://gist.github.com/tsuz/08f84647eea856bc1e2f136130955579\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 39428, "user_id": 315828, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/033829f8a1562bafb256157e24548fac?s=128&d=identicon&r=PG", "display_name": "xbonez", "link": "https://stackoverflow.com/users/315828/xbonez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2340, "favorite_count": 0, "accepted_answer_id": 46551305, "answer_count": 4, "score": 2, "last_activity_date": 1566493417, "creation_date": 1506970095, "question_id": 46531797, "link": "https://stackoverflow.com/questions/46531797/docker-image-for-built-golang-binary", "title": "Docker image for built Golang binary", "body": "<p>I have a Go application that I build into a binary and distribute as a Docker image.</p>\n\n<p>Currently, I'm using <code>ubuntu</code> as my base image, but this causes an issue where if a user tries to use a Timezone other than UTC or their local timezone, they get an error stating:</p>\n\n<pre><code>pod error: panic: open /usr/local/go/lib/time/zoneinfo.zip: no such file or directory\n</code></pre>\n\n<p>This error is caused because the <a href=\"https://golang.org/pkg/time/#LoadLocation\" rel=\"nofollow noreferrer\">LoadLocation</a> package in Go requires that file.</p>\n\n<p>I can think of two ways to fix this issue:</p>\n\n<ol>\n<li><p>Continue using the <code>ubuntu</code> base image, but in my Dockerfile add the commands: <code>RUN apt-get install -y tzdata</code></p></li>\n<li><p>Use one of Golang's base images, eg. <code>golang:1.7.5-alpine</code>.</p></li>\n</ol>\n\n<p>What would be the recommended way? I'm not sure if I need to or should be using a Golang image since this is the container where the pre-built binary runs. My understanding is that Golang images are good for building the binary in the first place.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 6213895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6d4fc2156765739b78bdd3378e2a884?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/6213895/alexander"}, "edited": false, "score": 0, "creation_date": 1506969742, "post_id": 46531626, "comment_id": 80018061, "body": "Lol, after using PHP I was confused. I thought this is a problem with scopes. Thanks."}], "tags": [], "owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "is_accepted": true, "score": 4, "last_activity_date": 1506969402, "creation_date": 1506969402, "answer_id": 46531626, "question_id": 46531533, "link": "https://stackoverflow.com/questions/46531533/write-to-a-variable-in-another-scope/46531626#46531626", "title": "Write to a variable in another scope?", "body": "<p><code>:=</code> declares and initializes a new variable, while <code>=</code> assigns to an existing variable.</p>\n\n<p>So change your code to</p>\n\n<pre><code>models = append(models, model.User{})\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 6213895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6d4fc2156765739b78bdd3378e2a884?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/6213895/alexander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 46531626, "answer_count": 1, "score": -1, "last_activity_date": 1506969402, "creation_date": 1506969073, "question_id": 46531533, "link": "https://stackoverflow.com/questions/46531533/write-to-a-variable-in-another-scope", "title": "Write to a variable in another scope?", "body": "<p>I am newbie in Golang, and I get stuck with setting value of variable from anonymous function (another scope). Now I am using goquery.</p>\n\n<p>For example I've following:</p>\n\n<pre><code>models := []model.User{}\n\ndoc.Find(\".ff\").Each(func(i int, s *goquery.Selection) {\n     //...\n\n    models := append(models, model.User{})\n})\n</code></pre>\n\n<p>And this does not work. How can I append new model to models?</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 3063, "user_id": 5075720, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kNyMGvaELDs/AAAAAAAAAAI/AAAAAAAAVnw/P1Rt8TFE2gc/photo.jpg?sz=128", "display_name": "PaSTE", "link": "https://stackoverflow.com/users/5075720/paste"}, "edited": false, "score": 0, "creation_date": 1506968132, "post_id": 46531147, "comment_id": 80017282, "body": "Could you post the code you use specifically for <code>userObj.Addresses</code>?  It might help to know exactly what is causing the problem rather than leaving it up to our imagination."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1506968771, "post_id": 46531147, "comment_id": 80017608, "body": "Please show a complete example. The code here can&#39;t be valid, as you&#39;re immediately dereferencing a nil pointer."}, {"owner": {"reputation": 1017, "user_id": 4232577, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/a5a00cebae51f88c74b381d3489dc5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Mikuli\u0107", "link": "https://stackoverflow.com/users/4232577/marko-mikuli%c4%87"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506969377, "post_id": 46531147, "comment_id": 80017902, "body": "@JimB I&#39;ve added playground link with my structs, it&#39;s everything but validation function there"}, {"owner": {"reputation": 737, "user_id": 6275844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f7071f7e0149f02e945420a120a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Dan 0", "link": "https://stackoverflow.com/users/6275844/dan-0"}, "edited": false, "score": 0, "creation_date": 1506985587, "post_id": 46531147, "comment_id": 80024513, "body": "Even with the playground link, it doesn&#39;t look complete. there is no declared User.Mobile in the struct. You&#39;re not checking if Username, Password, and Email is not null, you&#39;re using the <code>not null</code> attribute, which would definitely be invalid if one of these fields is null. Also, why are you persisting pointers to the DB rather than the value? Does GORM implicitly store the value rather than the pointer?"}, {"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 1, "creation_date": 1507004703, "post_id": 46531147, "comment_id": 80028776, "body": "Are you sure you want a pointer to a slice of UserAddress (<code>*[]UserAddress</code>) rather than a slice of pointers to UserAddress (<code>[]*UserAddress</code>)?"}], "owner": {"reputation": 1017, "user_id": 4232577, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/a5a00cebae51f88c74b381d3489dc5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Mikuli\u0107", "link": "https://stackoverflow.com/users/4232577/marko-mikuli%c4%87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1506969349, "creation_date": 1506967487, "last_edit_date": 1506969349, "question_id": 46531147, "link": "https://stackoverflow.com/questions/46531147/save-struct-model-with-dereferencing", "title": "Save struct model with dereferencing", "body": "<p>I have this struct for user</p>\n\n<pre><code>type User struct {\n    gorm.Model\n    Username  string        `gorm:\"not null;unique\" json:\"username\"`\n    Password  *string       `gorm:\"not null\"json:\"password,omitempty\"`\n    Email     string        `gorm:\"not null;unique\"json:\"email\"`\n    Addresses *[]UserAddress `json:\"addresses,omitempty\"`\n}\n</code></pre>\n\n<p>When I bind json to my struct I can save password to the database like this</p>\n\n<pre><code>userObj := User{}\npassword := *userObj.Password\nuserObj.Password = &amp;password\ndb.Debug().Save(&amp;userObj)\n</code></pre>\n\n<p>The part that is not working is when I try to apply the same thing for Addresses field. Error from terminal is this \"field value not valid\".</p>\n\n<p>Here's the playground <a href=\"https://play.golang.org/p/ZICMwVDUSm\" rel=\"nofollow noreferrer\">link</a></p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506960128, "post_id": 46529195, "comment_id": 80013053, "body": "Do you need to preserve the input order?"}, {"owner": {"reputation": 214, "user_id": 2125379, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/677dbb945adcd4fc00d8a51a083c7c06?s=128&d=identicon&r=PG", "display_name": "Brandon Sturgeon", "link": "https://stackoverflow.com/users/2125379/brandon-sturgeon"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506960712, "post_id": 46529195, "comment_id": 80013379, "body": "@Peter No, order shouldn&#39;t matter in this case."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1506961143, "creation_date": 1506961143, "answer_id": 46529570, "question_id": 46529195, "link": "https://stackoverflow.com/questions/46529195/i-want-to-split-a-file-into-equally-sized-chunks-or-slices-and-use-goroutines/46529570#46529570", "title": "I want to split a file into equally sized &quot;chunks&quot;, or slices and use goroutines to process them simultaneously", "body": "<p>If it is acceptable that line N+1 is processed before line N, you can use a simple fan-out pattern to get started. <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">The Go blog</a> explains this and more advanced patterns, such as cancelation and fan-in. </p>\n\n<p>Note that this is just a starting point to keep it simple and on point. You would almost certainly want to wait for the <code>process</code> functions to return before exiting, for instance. This is explained in the mentioned blog post.</p>\n\n<pre><code>package main\n\nimport \"bufio\"\n\nfunc main() {\n    var sc *bufio.Scanner\n\n    lines := make(chan string)\n\n    go process(lines)\n    go process(lines)\n    go process(lines)\n    go process(lines)\n\n    for sc.Scan() {\n            lines &lt;- sc.Text()\n    }\n\n    close(lines)\n}\n\nfunc process(lines &lt;-chan string) {\n    for line := range lines {\n            // implement processing here\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 214, "user_id": 2125379, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/677dbb945adcd4fc00d8a51a083c7c06?s=128&d=identicon&r=PG", "display_name": "Brandon Sturgeon", "link": "https://stackoverflow.com/users/2125379/brandon-sturgeon"}, "edited": false, "score": 0, "creation_date": 1507230293, "post_id": 46529886, "comment_id": 80139048, "body": "This is very interesting how involved this is. Not quite like other languages I&#39;m used to!  Thank you for the thorough example, it really helped me dig deeper into this!"}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1565526325, "post_id": 46529886, "comment_id": 101375021, "body": "Sending each line will create an unnecessary contention. Instead, batch them together in groups, then send. Channel communication is not free."}, {"owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "reply_to_user": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1576427876, "post_id": 46529886, "comment_id": 104888087, "body": "@InancGumus - What if the single goroutine that reads lines from <code>&#47;path&#47;to&#47;file.txt</code> imposes a bottleneck? How could I use multiple readers on a single file? Any ideas?"}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "reply_to_user": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "edited": false, "score": 0, "creation_date": 1576429638, "post_id": 46529886, "comment_id": 104888531, "body": "@Shuzheng The thing is whenever you communicate through channels you&#39;re paying a synchronization cost unless (<i>sometimes</i>) you&#39;re using unbuffered chans."}], "tags": [], "owner": {"reputation": 101, "user_id": 6718791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c335c19126519ef7e0e20be83f7ea65?s=128&d=identicon&r=PG&f=1", "display_name": "Elbert Fliek", "link": "https://stackoverflow.com/users/6718791/elbert-fliek"}, "is_accepted": true, "score": 3, "last_activity_date": 1506962397, "creation_date": 1506962397, "answer_id": 46529886, "question_id": 46529195, "link": "https://stackoverflow.com/questions/46529195/i-want-to-split-a-file-into-equally-sized-chunks-or-slices-and-use-goroutines/46529886#46529886", "title": "I want to split a file into equally sized &quot;chunks&quot;, or slices and use goroutines to process them simultaneously", "body": "<p>Peter gives a good starting point, if you wanted to do something like a fan-out, fan-in pattern you could do something like:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"sync\"\n)\n\nfunc main() {\n    file, err := os.Open(\"/path/to/file.txt\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n    lines := make(chan string)\n    // start four workers to do the heavy lifting\n    wc1 := startWorker(lines)\n    wc2 := startWorker(lines)\n    wc3 := startWorker(lines)\n    wc4 := startWorker(lines)\n    scanner := bufio.NewScanner(file)\n    go func() {\n        defer close(lines)\n        for scanner.Scan() {\n            lines &lt;- scanner.Text()\n        }\n\n        if err := scanner.Err(); err != nil {\n            log.Fatal(err)\n        }\n    }()\n\n    merged := merge(wc1, wc2, wc3, wc4)\n    for line := range merged {\n        fmt.Println(line)\n    }\n}\n\nfunc startWorker(lines &lt;-chan string) &lt;-chan string {\n    finished := make(chan string)\n    go func() {\n        defer close(finished)\n        for line := range lines {\n            // Do your heavy work here\n            finished &lt;- line\n        }\n    }()\n    return finished\n}\n\nfunc merge(cs ...&lt;-chan string) &lt;-chan string {\n    var wg sync.WaitGroup\n    out := make(chan string)\n\n    // Start an output goroutine for each input channel in cs.  output\n    // copies values from c to out until c is closed, then calls wg.Done.\n    output := func(c &lt;-chan string) {\n        for n := range c {\n            out &lt;- n\n        }\n        wg.Done()\n    }\n    wg.Add(len(cs))\n    for _, c := range cs {\n        go output(c)\n    }\n\n    // Start a goroutine to close out once all the output goroutines are\n    // done.  This must start after the wg.Add call.\n    go func() {\n        wg.Wait()\n        close(out)\n    }()\n    return out\n}\n</code></pre>\n"}], "owner": {"reputation": 214, "user_id": 2125379, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/677dbb945adcd4fc00d8a51a083c7c06?s=128&d=identicon&r=PG", "display_name": "Brandon Sturgeon", "link": "https://stackoverflow.com/users/2125379/brandon-sturgeon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2800, "favorite_count": 0, "accepted_answer_id": 46529886, "answer_count": 2, "score": 5, "last_activity_date": 1506965759, "creation_date": 1506959799, "last_edit_date": 1506965759, "question_id": 46529195, "link": "https://stackoverflow.com/questions/46529195/i-want-to-split-a-file-into-equally-sized-chunks-or-slices-and-use-goroutines", "title": "I want to split a file into equally sized &quot;chunks&quot;, or slices and use goroutines to process them simultaneously", "body": "<p>Using Go, I have large log files. Currently I open them, create a new scanner <code>bufio.NewScanner</code>, and then <code>for scanner.Scan()</code> to loop through the lines. Each line is sent through a processing function, which matches it to regular expressions and extracts data. I would like to process this file in chunks simultaneously using goroutines. I believe this may be quicker than looping through the whole file sequentially.</p>\n\n<p>It can take a few seconds per file, and I'm wondering if I can process a single file in, say, 10 pieces at a time. I believe I can sacrifice the memory if needed. I have ~3gb, and the biggest log file is maybe 75mb.</p>\n\n<p>I see that a <code>scanner</code> has a <code>.Split()</code> method, where you can provide a custom split function, but I wasn't able to find a good solution using this method.</p>\n\n<p>I've also tried creating a slice of slices, looping through the scanner with <code>scanner.Scan()</code> and appending <code>scanner.Text()</code> to each slice.\neg:</p>\n\n<pre><code>// pseudocode because I couldn't get this to work either\n\nscanner := bufio.NewScanner(logInfo)\nthreads := [[], [], [], [], []]\n\ni := 0\nfor scanner.Scan() {\n    i = i + 1\n    if i &gt; 5 {\n        i = 0\n    }\n    threads[i] = append(threads[i], scanner.Text())\n}\nfmt.Println(threads)\n</code></pre>\n\n<p>I'm new to Go and concerned about efficiency and performance. I want to learn how to write good Go code! Any help or advice is really appreciated.</p>\n"}, {"tags": ["docker", "go", "docker-compose", "dockerfile"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1506957066, "post_id": 46528319, "comment_id": 80011024, "body": "You need to ADD or COPY your code into the image. Also, don&#39;t use <code>go run</code>. That is a toy. Use <code>go build</code> or <code>go install</code> instead."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506957071, "post_id": 46528319, "comment_id": 80011028, "body": "How are you getting <code>myproject</code> into your container in the first place?"}, {"owner": {"reputation": 750, "user_id": 2690165, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/f0fab7c7aace5c1103b6cc490206c8e0?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian", "link": "https://stackoverflow.com/users/2690165/lucian"}, "edited": false, "score": 0, "creation_date": 1506957219, "post_id": 46528319, "comment_id": 80011138, "body": "I added the yml file for the docker"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506958110, "post_id": 46528319, "comment_id": 80011696, "body": "@Lucian: if you&#39;re mounting the <code>src</code> directory as a volume, and you can build the main package, then <code>utils</code> is there too. What problem are you having exactly?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506958541, "post_id": 46528319, "comment_id": 80011987, "body": "The problem is that your volume is not in GOPATH, so Go can&#39;t locate the utils package. (There is no math package)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506966204, "post_id": 46528319, "comment_id": 80016309, "body": "oh yes, Peter is right. You&#39;re putting your code in the default GOPATH, but then changing GOPATH."}], "answers": [{"comments": [{"owner": {"reputation": 750, "user_id": 2690165, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/f0fab7c7aace5c1103b6cc490206c8e0?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian", "link": "https://stackoverflow.com/users/2690165/lucian"}, "edited": false, "score": 0, "creation_date": 1507016124, "post_id": 46534605, "comment_id": 80032983, "body": "I fixed it by changing the volume to match my local path: volumes:       - ./src/:/usr/local/go/src/gitlab/golang/login/src/  And run main.go in dockerfile also from this path"}], "tags": [], "owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "is_accepted": false, "score": 1, "last_activity_date": 1506983180, "creation_date": 1506983180, "answer_id": 46534605, "question_id": 46528319, "link": "https://stackoverflow.com/questions/46528319/dockerfile-install-go-local-packages-can-be-possible/46534605#46534605", "title": "dockerfile install go local packages can be possible?", "body": "<p>You should try below</p>\n\n<pre><code>services:\n    cozonac:\n       image: cozonac:local\n       ports:\n         - \"10004:10004\"\n       volumes:\n         - ./src/:/go/\n       environment:\n         - GOPATH=/golib/:/go/\n</code></pre>\n\n<p>Just for this case you can append the folder to <code>GOPATH</code></p>\n"}], "owner": {"reputation": 750, "user_id": 2690165, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/f0fab7c7aace5c1103b6cc490206c8e0?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian", "link": "https://stackoverflow.com/users/2690165/lucian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 673, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1506983180, "creation_date": 1506956889, "last_edit_date": 1506957198, "question_id": 46528319, "link": "https://stackoverflow.com/questions/46528319/dockerfile-install-go-local-packages-can-be-possible", "title": "dockerfile install go local packages can be possible?", "body": "<p><br>\nI am trying to create a docker image with my golang project. The project has some local packages like <em>math</em>:</p>\n\n<pre><code>/myproject/\n  src/\n    main.go\n    utils/\n      math.go\n</code></pre>\n\n<p>in main.go I include lots of packages but also <code>math</code> from <em>math.go</em>.\n<br>My docker file looks something like:</p>\n\n<pre><code>FROM golang:latest\n\nENV GOPATH=/golib/\n\nRUN /usr/local/go/bin/go get github.com/julienschmidt/httprouter\n\nCMD /usr/local/go/bin/go run main.go\n\nEXPOSE 10004\n</code></pre>\n\n<p>How do I include also math package since it's a local package, so it's not deployed on github?</p>\n\n<p>The yml file:</p>\n\n<pre><code>services:\n    cozonac:\n       image: cozonac:local\n       ports:\n         - \"10004:10004\"\n       volumes:\n         - ./src/:/go/\n</code></pre>\n\n<p><br>Thanks</p>\n"}, {"tags": ["go", "tcp"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1506955318, "post_id": 46527616, "comment_id": 80009788, "body": "You&#39;re looking in the wrong place. Whether it&#39;s <code>io.Copy</code> directly to the <code>*TCPConn</code>, or this byte-by-byte example, you are writing to the connection immediately. It&#39;s either being being buffered by your OS, or on the client side."}, {"owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "edited": false, "score": 0, "creation_date": 1506955912, "post_id": 46527616, "comment_id": 80010192, "body": "instead of <code>for run_loop := true; run_loop; {}</code> you can run simple <code>for {}</code>; net.TCPConn implements Read() and Write(), do you really need to wrap it with bufio?"}, {"owner": {"reputation": 1, "user_id": 2414658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1d4f05efdd65fb64550dbc2e6bf6690?s=128&d=identicon&r=PG", "display_name": "SeanH", "link": "https://stackoverflow.com/users/2414658/seanh"}, "edited": false, "score": 0, "creation_date": 1506957122, "post_id": 46527616, "comment_id": 80011069, "body": "I don&#39;t technically need a bufio, but I&#39;ve gone through quite a few iterations trying to get this working."}, {"owner": {"reputation": 559, "user_id": 8513305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1536318262396a41237981f159eecad5?s=128&d=identicon&r=PG&f=1", "display_name": "C. Gonzalez", "link": "https://stackoverflow.com/users/8513305/c-gonzalez"}, "edited": false, "score": 0, "creation_date": 1506960294, "post_id": 46527616, "comment_id": 80013141, "body": "Your writer.WriteByte(b) seems to be outside the loop..."}], "owner": {"reputation": 1, "user_id": 2414658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1d4f05efdd65fb64550dbc2e6bf6690?s=128&d=identicon&r=PG", "display_name": "SeanH", "link": "https://stackoverflow.com/users/2414658/seanh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 551, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1506955571, "creation_date": 1506954694, "last_edit_date": 1506955571, "question_id": 46527616, "link": "https://stackoverflow.com/questions/46527616/go-tcpconn-not-writing-out-data-until-connection-is-closed", "title": "Go TCPConn not writing out data until connection is closed", "body": "<p>I'm writing a \"binary echo server\" and I've tried several ways to continuously read binary data from a connection and echo that data back, and for whatever reason upon writing the data, it's not making it to the other side until the connection is closed.  Here is the handler method for the connection. As you can see I'm trying to read byte by byte (after several other attempts using io.Copy() failed.</p>\n\n<pre><code>func handle_relay_connection(instance *ServerInstance, conn *net.TCPConn) {\n    var err error\n    var b byte\n\n    defer conn.Close()\n\n    reader := bufio.NewReader(conn)\n    writer := bufio.NewWriter(conn)\n\n    for run_loop := true; run_loop; {\n            b, err = reader.ReadByte()\n\n            if err != nil {\n                    if err != io.EOF {\n                            logError(\"Problem reading data from connection %s: %v\", instance.address, err)\n                    } else {\n                            logWarning(\"Client %s ended connection: %v\", instance.address, err)\n                    }\n\n                    run_loop = false\n            }\n            writer.WriteByte(b)\n            writer.Flush()\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "google-cloud-platform", "google-container-registry", "govendor", "google-container-builder"], "answers": [{"comments": [{"owner": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "edited": false, "score": 0, "creation_date": 1507022776, "post_id": 46526875, "comment_id": 80036695, "body": "I don&#39;t follow... I can set <code>PROJECT_ROOT</code> only once, but in <code>program1&#47;main&#47;main.go</code> I import several different packages: <code>my_root&#47;program1</code>, <code>my_root&#47;utils</code>, <code>github.com&#47;golang&#47;glog</code>, to name a few (<code>my_root</code> is the name of the overall Go package, and is the directory name of my source code), so I&#39;m not sure what to set <code>PROJECT_ROOT</code> to."}, {"owner": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "edited": false, "score": 0, "creation_date": 1507023216, "post_id": 46526875, "comment_id": 80036973, "body": "I tried setting <code>PROJECT_ROOT</code> to: <code>my_root</code> (this should have worked, I think), <code>my_root&#47;program1</code>, <code>program1</code>, but all resulted in the same problem. Since <code>my_root</code> is not an actual folder in my Git repo, maybe the Go build step doesn&#39;t &quot;know&quot; about the <code>my_root</code> directory, which messes up my paths?"}, {"owner": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "edited": false, "score": 0, "creation_date": 1507024228, "post_id": 46526875, "comment_id": 80037590, "body": "(apologies for the spam, just keep getting more info to share)  When I set <code>PROJECT_ROOT</code> to <code>my_root</code>, I get several errors that look like this:  <code>cannot find package &quot;my_root&#47;utils&quot; in any of</code> <code>&#47;usr&#47;local&#47;go&#47;src&#47;my_root&#47;utils (from $GOROOT)</code> <code>&#47;workspace&#47;program1&#47;main&#47;gopath&#47;src&#47;my_root&#47;utils (from $GOPATH)</code>  The latter error file path looks absurd to me... seems to be looking inside <code>program1&#47;main&#47;</code>!"}, {"owner": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "edited": false, "score": 0, "creation_date": 1507034771, "post_id": 46526875, "comment_id": 80043838, "body": "never mind, I played around with the <code>dirs</code> field and it seems to work now. Thanks!"}, {"owner": {"reputation": 942, "user_id": 2912342, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kYyo0.png?s=128&g=1", "display_name": "John Asmuth", "link": "https://stackoverflow.com/users/2912342/john-asmuth"}, "reply_to_user": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "edited": false, "score": 0, "creation_date": 1507120914, "post_id": 46526875, "comment_id": 80083819, "body": "As you discovered, if you set <code>PROJECT_ROOT</code> you need to run the <code>gcr.io&#47;cloud-builders&#47;go</code> step from the directory containing things directly inside the root - the env var tells the builder that &quot;this directory is the project root, and call it &lt;whatever&gt;&quot;."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "edited": false, "score": 0, "creation_date": 1537311306, "post_id": 46526875, "comment_id": 91736284, "body": "@IsmailKhan could you provide the setup you did to avoid error &quot;cannot find package &quot; please"}], "tags": [], "owner": {"reputation": 942, "user_id": 2912342, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kYyo0.png?s=128&g=1", "display_name": "John Asmuth", "link": "https://stackoverflow.com/users/2912342/john-asmuth"}, "is_accepted": false, "score": 3, "last_activity_date": 1506952379, "creation_date": 1506952379, "answer_id": 46526875, "question_id": 46526250, "link": "https://stackoverflow.com/questions/46526250/google-cloud-container-builder-build-docker-container-from-go-source-with-vend/46526875#46526875", "title": "Google Cloud Container Builder - Build Docker container from Go source with vendored dependencies", "body": "<p>The issue is with #1: <code>PROJECT_ROOT</code> refers to the desired import path of your binaries. For example, if in <code>program1/main/main.go</code> you import <code>\"github.com/foo/bar/program1\"</code> to get the package defined in <code>program1/program1.go</code>, you'd set <code>PROJECT_ROOT=github.com/foo/bar</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1537814242, "post_id": 46544952, "comment_id": 91912271, "body": "Could you tell me please what command line did you apply and where please?"}], "tags": [], "owner": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "is_accepted": true, "score": 2, "last_activity_date": 1507034732, "creation_date": 1507034732, "answer_id": 46544952, "question_id": 46526250, "link": "https://stackoverflow.com/questions/46526250/google-cloud-container-builder-build-docker-container-from-go-source-with-vend/46544952#46544952", "title": "Google Cloud Container Builder - Build Docker container from Go source with vendored dependencies", "body": "<p>Fixed the problem (but not exactly sure how...), thanks to these changes:</p>\n\n<ol>\n<li>Set <code>PROJECT_ROOT</code> to <code>my_root</code>, such that the code I want to compile sits at <code>my_root/program1/main/main.go</code> (thanks to John Asmuth for his answer: <a href=\"https://stackoverflow.com/a/46526875/6905609\">https://stackoverflow.com/a/46526875/6905609</a>)</li>\n<li>Remove the <code>dirs</code> field for the Go build step</li>\n<li>Set the <code>-o</code> flag to <code>./program1/main/main</code>, and the final build arg to <code>./program1/main/main.go</code></li>\n</ol>\n\n<p>Previously I was <code>cd</code>ing into the <code>program1/main</code> directory during the build step, and for some reason <code>go build</code> was looking for packages within <code>my_root/program1/main</code> instead of <code>my_root</code>. Weird!</p>\n"}], "owner": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 647, "favorite_count": 0, "accepted_answer_id": 46544952, "answer_count": 2, "score": 2, "last_activity_date": 1507034732, "creation_date": 1506950152, "question_id": 46526250, "link": "https://stackoverflow.com/questions/46526250/google-cloud-container-builder-build-docker-container-from-go-source-with-vend", "title": "Google Cloud Container Builder - Build Docker container from Go source with vendored dependencies", "body": "<p><strong>Background</strong></p>\n\n<p>Related question: <a href=\"https://stackoverflow.com/questions/46395187/google-container-builder-how-to-install-govendor-dependencies-during-build-step\">Google Container Builder: How to install govendor dependencies during build step?</a></p>\n\n<p>I am trying to use Google Cloud Container Builder to automate the building of my Docker containers using Build Triggers.</p>\n\n<p>My code is in Go, and I have a <code>vendor</code> folder (checked in to Git) in my project root which contains all of my Go dependencies.</p>\n\n<p>My project has four binaries that need to be Dockerized, structured as follows:</p>\n\n<pre><code>vendor/\n   ...\nprogram1/\n    program1.go\n    main/\n        main.go\n        Dockerfile\nprogram2/\n    program2.go\n    main/\n        main.go\n        Dockerfile\n...\n</code></pre>\n\n<p>Each program's Dockerfile is simple: </p>\n\n<pre><code>FROM alpine\nADD main main\nENTRYPOINT [\"/main\"]\n</code></pre>\n\n<p>I have a Build Trigger set up to track my <code>master</code> branch. The trigger runs the following build request (<code>cloudbuild.yaml</code>), which makes use of the open sourced Docker build step:</p>\n\n<pre><code>steps:\n- name: 'gcr.io/cloud-builders/docker'\n  args: ['build', '-t', 'gcr.io/$PROJECT_ID/program1:0.1.15-$SHORT_SHA', '.']\n  dir: 'program1/main'\n\n  ... (repeated for each program)\n  (images, tags omitted)\n</code></pre>\n\n<p>To summarize, my current build process is as follows:</p>\n\n<ol>\n<li>Edit code.</li>\n<li>Build each Go executable using <code>go build</code>. The executable is called <code>main</code>, and is saved in the <code>programX/main/</code> directory, alongside <code>main.go</code>.</li>\n<li>Commit and push code (since the <code>main</code> executables are tracked by Git) to my master branch.</li>\n<li>Build Trigger makes four Docker images using the <code>main</code> file built in step 1.</li>\n</ol>\n\n<p><strong>Goal</strong></p>\n\n<p>I would like to eliminate Step 1 from my build process, so that I no longer need to compile my executables locally, and do not need to track my <code>main</code> executables in Git. </p>\n\n<p>In sum, here is my ideal process:</p>\n\n<ol>\n<li>Edit code, commit, push to remote.</li>\n<li>Build Trigger compiles all four programs, builds all four images.</li>\n<li>Relax :)</li>\n</ol>\n\n<p><strong>Attempted solution</strong></p>\n\n<p>I used the open source <a href=\"https://github.com/GoogleCloudPlatform/cloud-builders/tree/master/go\" rel=\"nofollow noreferrer\">Go build step</a>, as follows:</p>\n\n<p><code>cloudbuild.yaml</code>: (updated)</p>\n\n<pre><code>steps:\n- id: 'build-program1'\n  name: 'gcr.io/cloud-builders/go'\n  args: ['build', '-a', '-installsuffix', 'cgo', '-ldflags', '''-w''', '-o', 'main', './main.go']\n  env: ['PROJECT_ROOT=/workspace', 'CGO_ENABLED=0', 'GOOS=linux']\n  dir: 'program1/main'\n- name: 'gcr.io/cloud-builders/docker'\n  args: ['build', '-t', 'gcr.io/$PROJECT_ID/program1:0.1.15-$SHORT_SHA', '.']\n  dir: 'program1/main'\n  waitFor: ['build-program1']\n\n  ... (repeated for each program)\n  (images, tags omitted)\n</code></pre>\n\n<p>After trying various combinations of setting PROJECT_ROOT and GOPATH in the <code>env</code> field of the <code>build-programX</code>, I kept getting the same error for every single package used in my project (file path varies): </p>\n\n<pre><code>cannot find package \"github.com/acoshift/go-firebase-admin\" in any of\nStep #0 - \"build-program1\": /usr/local/go/src/github.com/acoshift/go-firebase-admin (from $GOROOT) \nStep #0 - \"build-program1\": /workspace/auth/main/gopath/src/github.com/acoshift/go-firebase-admin (from $GOPATH)\n</code></pre>\n\n<p>It's not even looking for a vendor directory?</p>\n\n<p><strong>What next?</strong></p>\n\n<p>My guess is that one of the following is true:</p>\n\n<ol>\n<li>I am not specifying the <code>GOPATH</code>/<code>PROJECT_ROOT</code> correctly in the build request file. But if so, what is the correct setting?</li>\n<li>My project is not structured correctly.</li>\n<li>What I am trying to do is impossible :(*</li>\n<li>I need to make a custom build step, somehow.</li>\n<li>The version of Go used is old - but how can I check this?</li>\n</ol>\n\n<p>I can find no examples online of what I am trying to achieve, and I find GCP's documentation on this subject quite lacking.</p>\n\n<p>Any help would be greatly appreciated!</p>\n"}, {"tags": ["javascript", "ajax", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1506950605, "post_id": 46526245, "comment_id": 80006675, "body": "&quot;Can anyone see where the error lies?&quot; Yes. You are trying to decode the body of GET request. But GETs do not have a body. You send query parameters. Jest get your data transmission logic straight."}, {"owner": {"reputation": 16, "user_id": 8708484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/602ccf9840945db48f88fa68eaef28ce?s=128&d=identicon&r=PG&f=1", "display_name": "oysandvik", "link": "https://stackoverflow.com/users/8708484/oysandvik"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506952912, "post_id": 46526245, "comment_id": 80008087, "body": "I removed that line and it worked, thank you."}], "owner": {"reputation": 16, "user_id": 8708484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/602ccf9840945db48f88fa68eaef28ce?s=128&d=identicon&r=PG&f=1", "display_name": "oysandvik", "link": "https://stackoverflow.com/users/8708484/oysandvik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1506950145, "creation_date": 1506950145, "question_id": 46526245, "link": "https://stackoverflow.com/questions/46526245/trying-to-send-an-ajax-get-request-to-a-go-webserver-but-response-gives-a-500-i", "title": "Trying to send an ajax get request to a Go webserver, but response gives a 500 internal server error", "body": "<p>I'm trying to implement an ajax request that sends simple form data to a Go webserver, then return the same values in a response to the client (website). </p>\n\n<p>Ajax request in javascript: </p>\n\n<pre><code>function addWheel(){\ntitle = document.getElementById('title').value;\ndesc = document.getElementById('desc').value;\n\nvar xhttp = new XMLHttpRequest();\nxhttp.onreadystatechange = function() {\n    if (this.readyState == 4 &amp;&amp; this.status == 200) {\n        console.log(this.responseText);\n    }\n};\nxhttp.open(\"GET\", \"/getCardInfo?title=\" + title + \"&amp;desc=\" + desc, true);\nxhttp.send();\n</code></pre>\n\n<p>}</p>\n\n<p>There error from the browser console I recieve says the internal server error occurs in \"xhttp.send();\"</p>\n\n<p>Code from the webserver:</p>\n\n<pre><code>func ajaxHandler(w http.ResponseWriter, r *http.Request) {\n//parse request to struct\nfmt.Println(\"Ajaxhandler\")\nvar d Data\nerr := json.NewDecoder(r.Body).Decode(&amp;d)\nq := r.URL.Query()\nd.Title = q.Get(\"title\")\nd.Desc = q.Get(\"desc\")\nif err != nil {\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n}\n\n// create json response from struct\na, err := json.Marshal(d)\nif err != nil {\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n}\n_, err = w.Write(a)\nif err != nil {\n    fmt.Println(\"handle error\")\n}\n</code></pre>\n\n<p>}</p>\n\n<p>It runs all the way through without throwing any errors. It looks like it sends it at w.Write(a), so I assume there's an issue in my javascript. The variable d Data is just a struct containing 2 strings. </p>\n\n<p>The handle function is defined in main like this: <code>http.HandleFunc(\"/getCardInfo\", ajaxHandler)</code></p>\n\n<p>Can anyone see where the error lies? </p>\n"}, {"tags": ["go", "dll", "com"], "comments": [{"owner": {"reputation": 116623, "user_id": 403671, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/454HU.jpg?s=128&g=1", "display_name": "Simon Mourier", "link": "https://stackoverflow.com/users/403671/simon-mourier"}, "edited": false, "score": 0, "creation_date": 1506938060, "post_id": 46522109, "comment_id": 80000422, "body": "class not registered is often a 32-bit vs 64-bit issue"}], "answers": [{"tags": [], "owner": {"reputation": 33821, "user_id": 45685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y4RJr.jpg?s=128&g=1", "display_name": "AndersK", "link": "https://stackoverflow.com/users/45685/andersk"}, "is_accepted": false, "score": 1, "last_activity_date": 1506944378, "creation_date": 1506944378, "answer_id": 46524757, "question_id": 46522109, "link": "https://stackoverflow.com/questions/46522109/how-to-create-com-object/46524757#46524757", "title": "How to create COM object", "body": "<p>When you get class not registered it means that the COM dll or exe has not been registered so when you try to instantiate the COM object the OS doesn't know where to find the .DLL/Exe. </p>\n\n<p>In the case of DLL register with regsvr32 (<code>C:\\&gt;regsvr32 {full path}dm.dll</code>), executables usually register with a command line argument /RegServer</p>\n"}], "owner": {"reputation": 88, "user_id": 6688333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98bd7deafd408f614f9f65edece60cbc?s=128&d=identicon&r=PG&f=1", "display_name": "Lyons Huang", "link": "https://stackoverflow.com/users/6688333/lyons-huang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1506944378, "creation_date": 1506933413, "last_edit_date": 1506943797, "question_id": 46522109, "link": "https://stackoverflow.com/questions/46522109/how-to-create-com-object", "title": "How to create COM object", "body": "<p>How do I create an object using golang? I use go-ole and it report an class not registered error although I have already registered this dll by regsvr32 dm.dll. </p>\n\n<p>Can anyone show me the correct code. </p>\n\n<pre><code>ole.CoInitialize(0)\n\nunknown, err := oleutil.CreateObject(\"dm.dmsoft\")\n\nif err != nil {\n    log.Fatal(err)\n}\ndm := unknown.MustQueryInterface(ole.IID_IDispatch)\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/2aaXP.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2aaXP.jpg\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["c", "windows", "go", "cuda", "cgo"], "comments": [{"owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "edited": false, "score": 1, "creation_date": 1506952608, "post_id": 46521708, "comment_id": 80007889, "body": "Have you installed CUDA on your windows machine?  That would be the first step.  And if you intend to use CUDA, GCC is not an officially supported compiler. You should use MSVC."}, {"owner": {"reputation": 122, "user_id": 5835066, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/TzsPu.png?s=128&g=1", "display_name": "Abeltensor", "link": "https://stackoverflow.com/users/5835066/abeltensor"}, "reply_to_user": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "edited": false, "score": 0, "creation_date": 1506965392, "post_id": 46521708, "comment_id": 80015904, "body": "Yes of course I have cuda installed on my machine.  MSVC also gives the same error."}, {"owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "edited": false, "score": 0, "creation_date": 1506966431, "post_id": 46521708, "comment_id": 80016427, "body": "If you use MSVC, then add an include path in the MSVC project to point to the directory where <code>cuda.h</code> is located."}, {"owner": {"reputation": 122, "user_id": 5835066, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/TzsPu.png?s=128&g=1", "display_name": "Abeltensor", "link": "https://stackoverflow.com/users/5835066/abeltensor"}, "reply_to_user": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "edited": false, "score": 0, "creation_date": 1506969982, "post_id": 46521708, "comment_id": 80018189, "body": "its not working even if i point MSVC to the cuda includes folder.   This is extremely annoying, I can use tensorflow and almost any other ML Library with Cuda but I can&#39;t get any golang libraries to compile."}, {"owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "edited": false, "score": 0, "creation_date": 1506973276, "post_id": 46521708, "comment_id": 80019754, "body": "If you have a MSVC project, and you have added an include path of something like <code>C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v8.0\\include</code> (or wherever it is installed on your machine) then the project should be able to locate <code>#include &lt;cuda.h&gt;</code> properly.  Not sure what the issue is."}], "answers": [{"comments": [{"owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "edited": false, "score": 1, "creation_date": 1506993781, "post_id": 46535797, "comment_id": 80026392, "body": "You may be able to work around the issue with the spaces by enclosing the paths in quotes, eg. <code>&quot;C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v8.0\\include&quot;</code>  This shouldn&#39;t be necessary if you&#39;re putting the path into a MSVS project &quot;extra include paths&quot; entry."}, {"owner": {"reputation": 122, "user_id": 5835066, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/TzsPu.png?s=128&g=1", "display_name": "Abeltensor", "link": "https://stackoverflow.com/users/5835066/abeltensor"}, "reply_to_user": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "edited": false, "score": 0, "creation_date": 1506996323, "post_id": 46535797, "comment_id": 80026925, "body": "I was using GCC.  MSVS didn&#39;t really help much for what I was trying to do with this.  I swapped my go compilers to the MSVC toolbelt (and briefly tried LLVM as well) to see if the windows linker would work better with these types of issues but it didn&#39;t really seem like it (still was getting the same errors).  Perhaps, if I was building a library in cgo and not just in go this would be a potential solution, but honestly, it is just better in most cases to move the paths to something more simple."}], "tags": [], "owner": {"reputation": 122, "user_id": 5835066, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/TzsPu.png?s=128&g=1", "display_name": "Abeltensor", "link": "https://stackoverflow.com/users/5835066/abeltensor"}, "is_accepted": true, "score": 1, "last_activity_date": 1506992682, "creation_date": 1506992682, "answer_id": 46535797, "question_id": 46521708, "link": "https://stackoverflow.com/questions/46521708/trying-to-use-cuda-with-go-on-windows/46535797#46535797", "title": "trying to use cuda with go on windows", "body": "<p>I was able to find the answer.</p>\n\n<p>The windows cuda installer installs things by default into a weird path: </p>\n\n<pre><code>C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v8.0\\include\n</code></pre>\n\n<p>This path caused a lot of pain for the compiler as a result of the spaces in the folder names.  After reinstalling Cuda into <code>C:\\CUDA\\v8.0</code> and then appending my CFLAGS and LDFLAGS appropriately in my CGO file I was able to get things to run correctly.</p>\n\n<p>For reference here are the CFLAGS and LDFLAGS that I used to get this to work: </p>\n\n<pre><code>//#cgo windows LDFLAGS:-LC:/cuda/v8.0/lib/x64\n//#cgo windows CFLAGS: -IC:/cuda/v8.0/include\nimport \"C\"\n</code></pre>\n\n<p>This was with the github.com/chewxy/cu go library.  I also appended the new flags into that library in the cgoflags.go file because the maintainer did not have version 8 or version 9 in there already.  I mentioned this to him and he might update it later but for now that's what you have to do. </p>\n"}], "owner": {"reputation": 122, "user_id": 5835066, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/TzsPu.png?s=128&g=1", "display_name": "Abeltensor", "link": "https://stackoverflow.com/users/5835066/abeltensor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 541, "favorite_count": 0, "accepted_answer_id": 46535797, "answer_count": 1, "score": 0, "last_activity_date": 1506992682, "creation_date": 1506931654, "last_edit_date": 1506945968, "question_id": 46521708, "link": "https://stackoverflow.com/questions/46521708/trying-to-use-cuda-with-go-on-windows", "title": "trying to use cuda with go on windows", "body": "<p>There are various Go libraries that rely on the cuda.h file and the cuda library (specifically ML libraries).  Every time I try to install one of these libraries on Windows, I get an error saying </p>\n\n<pre><code> fatal error: cuda.h: No such file or directory\n //#include &lt;cuda.h&gt;\n</code></pre>\n\n<p>I am aware of what I need to do (link the Cuda library/header files to the go library that I am trying to install), however, I am not sure how to go about doing this especially on windows. I am using GCC and not MSVC for various reasons, but even when I've tried using MSVC, I've had the same issues. </p>\n\n<p>Is there some way that I can link the cuda compiler/header files directly to my Go env or do I need to manually point the go/cgo compiler to the directory holding the Cuda headers and how do I go about doing this?</p>\n\n<p>I've tried asking a few of the developers who make these libraries for help but most of them are linux users so they don't really know.  An exhaustive google search has really lead me nowhere so I'm asking here.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1506932263, "post_id": 46521614, "comment_id": 79997534, "body": "Example 1 keeps all file descriptors open until the end and then closes all of them. Example 2 opens one file descriptor and closes it once done, so that in example 2 only one file descriptor is in use at any time."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1506933765, "last_edit_date": 1506933765, "creation_date": 1506931632, "answer_id": 46521700, "question_id": 46521614, "link": "https://stackoverflow.com/questions/46521614/how-to-understand-the-defer-statement/46521700#46521700", "title": "How to understand the defer statement", "body": "<p>Deferred functions run when the enclosing function returns. <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\">Spec: Defer statements:</a></p>\n\n<blockquote>\n  <p>A \"defer\" statement invokes a function whose execution is deferred to the moment the surrounding function returns, either because the surrounding function executed a <a href=\"https://golang.org/ref/spec#Return_statements\" rel=\"nofollow noreferrer\">return statement</a>, reached the end of its <a href=\"https://golang.org/ref/spec#Function_declarations\" rel=\"nofollow noreferrer\">function body</a>, or because the corresponding goroutine is <a href=\"https://golang.org/ref/spec#Handling_panics\" rel=\"nofollow noreferrer\">panicking</a>.</p>\n</blockquote>\n\n<p>In your first example you use a single <code>for</code> loop in which you use <code>defer</code> statements, but the deferred functions will not get executed at the end of the iterations, only after the <code>for</code> loop (when the enclosing function ends). This means all the files you open inside the <code>for</code> loop will remain open 'till the \"end\". If <code>filenames</code> contains a thousand valid file names, the loop will (try to) open a thousand files before starting to close any of them.</p>\n\n<p>In your second example you \"outsourced\" dealing with the files to a separate function. Using <code>defer</code> in this function is fundamentally different, as when this function returns, the deferred function (<code>File.Close()</code>) will be called first. So in your second example at most 1 file is open at all times by the posted code, no matter how many elements <code>filenames</code> contains.</p>\n"}], "owner": {"reputation": 629, "user_id": 5617371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1a62a220f8c2fb0fcbce483555ae120d?s=128&d=identicon&r=PG&f=1", "display_name": "leo", "link": "https://stackoverflow.com/users/5617371/leo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 46521700, "answer_count": 1, "score": 2, "last_activity_date": 1506934109, "creation_date": 1506931298, "last_edit_date": 1506934109, "question_id": 46521614, "link": "https://stackoverflow.com/questions/46521614/how-to-understand-the-defer-statement", "title": "How to understand the defer statement", "body": "<p>I have two examples about defer statement in golang, the first one is incorrect, and the second one is correct. But I think they have the same problem, in my opinion I think the second still has risk that run out of file descriptors, could any one can help me to clarify why the second is correct? Thanks!</p>\n\n<p>Example1:</p>\n\n<pre><code>for _, filename := range filenames {\n    f, err := os.Open(filename)\n    if err != nil {\n        return err\n    }\n    defer f.Close() // NOTE: risky; could run out of file descriptors\n    // ...process f...\n }\n</code></pre>\n\n<p>Example2:</p>\n\n<pre><code>for _, filename := range filenames {\n    if err := doFile(filename); err != nil {\n        return err\n    }\n}\nfunc doFile(filename string) error {\n    f, err := os.Open(filename)\n    if err != nil {\n        return err\n    }\n    defer f.Close()\n    // ...process f...\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19, "user_id": 8706986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/111539d893d97d23e98b2f59247f1ad7?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander L", "link": "https://stackoverflow.com/users/8706986/alexander-l"}, "edited": false, "score": 1, "creation_date": 1506928710, "post_id": 46520955, "comment_id": 79995885, "body": "output: true true true"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1506929601, "post_id": 46520955, "comment_id": 79996277, "body": "Try consulting the FAQ first if questions arise. Your&#39;s an instance of <a href=\"https://golang.org/doc/faq#nil_error\" rel=\"nofollow noreferrer\">golang.org/doc/faq#nil_error</a>"}], "owner": {"reputation": 19, "user_id": 8706986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/111539d893d97d23e98b2f59247f1ad7?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander L", "link": "https://stackoverflow.com/users/8706986/alexander-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "closed_date": 1506928653, "answer_count": 0, "score": 0, "last_activity_date": 1506931420, "creation_date": 1506928513, "last_edit_date": 1506931420, "question_id": 46520955, "link": "https://stackoverflow.com/questions/46520955/incomprehension-with-golang-interface", "closed_reason": "Duplicate", "title": "incomprehension with golang interface", "body": "<pre><code>package main\n\nimport (\n  \"bytes\"\n  \"fmt\"\n  \"io\"\n )\n\nconst debug = false\n\nfunc f(out io.Writer) {\n  var buf *bytes.Buffer\n  fmt.Println(buf == nil)\n  fmt.Println(buf == out)\n  fmt.Println(out != nil)\n  if out != nil {\n    fmt.Println(\"pizdec\")\n    fmt.Printf(\"%v\\n\", out)\n    fmt.Printf(\"%T\\n\", out)\n  }\n}\n\nfunc main() {\n  var buf *bytes.Buffer\n  if debug {\n    //\n  }\n  f(buf)\n  if debug {\n    //\n  }\n}\n</code></pre>\n\n<p>I don't understand why <code>buf == out</code> is true and <code>out != nil</code> is also true?\nHow it's possible that if the output of the first three lines is 'true',\nbuf == nil and buf == out, and at the same time, out is not equal to nil?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1291, "user_id": 6331045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/189f94db303d16b891800f11846bd753?s=128&d=identicon&r=PG&f=1", "display_name": "Laney", "link": "https://stackoverflow.com/users/6331045/laney"}, "is_accepted": true, "score": 3, "last_activity_date": 1506928572, "creation_date": 1506928572, "answer_id": 46520974, "question_id": 46520738, "link": "https://stackoverflow.com/questions/46520738/how-to-use-websocket-with-newservemux-in-go/46520974#46520974", "title": "How to use websocket with NewServeMux in Go?", "body": "<p>I believe you should use <code>mx.Handle</code>, not <code>mx.HandleFunc</code></p>\n"}], "owner": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 0, "accepted_answer_id": 46520974, "answer_count": 1, "score": 1, "last_activity_date": 1506928572, "creation_date": 1506927385, "question_id": 46520738, "link": "https://stackoverflow.com/questions/46520738/how-to-use-websocket-with-newservemux-in-go", "title": "How to use websocket with NewServeMux in Go?", "body": "<p>I got an error message: cannot use websocket.Handler(handler) (type websocket.Handler) as type func(http.ResponseWriter, *http.Request) in argument to mx.HandleFunc</p>\n\n<p>in following code</p>\n\n<pre><code>package main\n\nimport (\n    \"golang.org/x/net/websocket\"\n    \"net/http\"\n)\n\nfunc handler(ws *websocket.Conn) {\n    // TODO\n}\nfunc main() {\n    mx := http.NewServeMux()\n    mx.HandleFunc(\"/ws\", websocket.Handler(handler)) // error\n\n    http.ListenAndServe(\"localhost:8888\", mx)\n}\n</code></pre>\n"}, {"tags": ["go", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 2, "last_activity_date": 1506919844, "last_edit_date": 1592644375, "creation_date": 1506919844, "answer_id": 46519670, "question_id": 46519595, "link": "https://stackoverflow.com/questions/46519595/gorilla-mux-subroute-methods-post-request-trigger-get/46519670#46519670", "title": "Gorilla Mux Subroute Methods POST request trigger GET", "body": "<p>The specific issue would be <a href=\"https://github.com/gorilla/mux/issues/79\" rel=\"nofollow noreferrer\">mux issue 79</a>, which is still pending (even if closed), also seen in <a href=\"https://github.com/gorilla/mux/issues/254\" rel=\"nofollow noreferrer\">mux issue 254</a></p>\n<p>That seems also related to <a href=\"https://github.com/gorilla/mux/issues/145\" rel=\"nofollow noreferrer\">mux issue 145</a>: StrictSlash is confusing</p>\n<blockquote>\n<p>This</p>\n<blockquote>\n<p>&quot;When true, if the route path is &quot;/path/&quot;, accessing &quot;/path&quot; will redirect to the former and vice versa. In other words, your application will always see the path as specified in the route.&quot;</p>\n</blockquote>\n<p>and</p>\n<blockquote>\n<p>&quot;When false, if the route path is &quot;/path&quot;, accessing &quot;/path/&quot; will not match this route and vice versa.&quot;</p>\n</blockquote>\n<p>should be inverted, because <code>strict==true</code> should mean no trailing slash allowed.<br />\nIt's name and docs are confusing.</p>\n</blockquote>\n"}], "owner": {"reputation": 53, "user_id": 2921452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8PO3e.jpg?s=128&g=1", "display_name": "Leonardo Fachini Martins", "link": "https://stackoverflow.com/users/2921452/leonardo-fachini-martins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 943, "favorite_count": 1, "accepted_answer_id": 46519670, "answer_count": 1, "score": 4, "last_activity_date": 1506924395, "creation_date": 1506919184, "last_edit_date": 1506924395, "question_id": 46519595, "link": "https://stackoverflow.com/questions/46519595/gorilla-mux-subroute-methods-post-request-trigger-get", "title": "Gorilla Mux Subroute Methods POST request trigger GET", "body": "<p>I'm trying to develop a simple REST API in Go, using Gorilla Mux. </p>\n\n<p>I have the <strong>main.go</strong> which register the simple path above and start the server to listen on port 3000.</p>\n\n<pre><code>func main() {\n    router := mux.NewRouter().StrictSlash(true)\n    sub := router.PathPrefix(\"/api/v1\").Subrouter()\n    handlers.RegisterRoutes(sub)\n\n    log.Fatal(http.ListenAndServe(\":3000\", router))\n}\n</code></pre>\n\n<p>A basic handlers registration method inside another generic <strong>handlers.go</strong> file</p>\n\n<pre><code>func RegisterRoutes(sub *mux.Router) {\n    user.RegisterRoutes(sub)\n}\n</code></pre>\n\n<p>And the <strong>user.handler.go</strong> file, which register the \"/user\" subroute:</p>\n\n<pre><code>func RegisterRoutes(sub *mux.Router) {\n    userRoutes := sub.StrictSlash(true).Path(\"/users\").Subrouter()\n\n    userRoutes.Methods(\"POST\").HandlerFunc(getUsers)\n    userRoutes.Methods(\"GET\").HandlerFunc(getUsers)\n}\n\nfunc getUsers(w http.ResponseWriter, r *http.Request) {\n    user := User{Name: \"test\", Password: \"test\"}\n\n    fmt.Printf(\"%+v\\n\", r.Method)\n\n    json.NewEncoder(w).Encode(user)\n}\n</code></pre>\n\n<p>I was testing the path that I've had set up above, and came up with an wird behavior:</p>\n\n<pre>\nTest - GET - localhost:3000/api/v1/users  => Prints GET in console. (as expected)\nTest - GET - localhost:3000/api/v1/users/  => Prints GET in console. (as expected)\nTest - POST - localhost:3000/api/v1/users  => Prints POST in console. (as expected)\nTest - POST - localhost:3000/api/v1/users/  => Prints GET in console. (And here is the strange behavior)\n</pre>\n\n<p>When I send a POST to the endpoint(localhost:3000/api/users/) with the trailing slash at the end of the url it triggers the GET instead of the POST. </p>\n\n<p>Anyone came across with this behavior using Gorilla Mux?</p>\n"}, {"tags": ["asynchronous", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1506938386, "post_id": 46519440, "comment_id": 80000559, "body": "So, why do you use goroutines if you want things to happen sequentially? Simply call one processor on all of your data, and then the next."}, {"owner": {"reputation": 121, "user_id": 4893819, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/69b691a83e3cba77791ce38097b53402?s=128&d=identicon&r=PG&f=1", "display_name": "Feanon", "link": "https://stackoverflow.com/users/4893819/feanon"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506995086, "post_id": 46519440, "comment_id": 80026678, "body": "@Peter Thanks for the answer. Consistent storage in each structure, and not in general, I need to ensure that the function of saving each structure works asynchronously. In other words, I need to give these functions and do not expect an answer from her. (newdata)"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507020016, "post_id": 46519440, "comment_id": 80034980, "body": "I&#39;m not following. You can have it be sequentially, or asynchronous; not both at the same time."}, {"owner": {"reputation": 121, "user_id": 4893819, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/69b691a83e3cba77791ce38097b53402?s=128&d=identicon&r=PG&f=1", "display_name": "Feanon", "link": "https://stackoverflow.com/users/4893819/feanon"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507080636, "post_id": 46519440, "comment_id": 80065476, "body": "@Peter Thanks for the answer! Can you please edit my code in play.golang.org?"}], "answers": [{"tags": [], "owner": {"reputation": 493, "user_id": 6111465, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/72fJG.png?s=128&g=1", "display_name": "gammazero", "link": "https://stackoverflow.com/users/6111465/gammazero"}, "is_accepted": false, "score": 0, "last_activity_date": 1507335867, "creation_date": 1507335867, "answer_id": 46615524, "question_id": 46519440, "link": "https://stackoverflow.com/questions/46519440/data-processing-by-several-functions-is-asynchronous/46615524#46615524", "title": "Data processing by several functions is asynchronous", "body": "<p>It sounds like what you are looking for is something that works like a channel that resizes (grows or shrinks) with the data that is enqueued on it.  This could be implemented by having a queue between an input and output channel, with a goroutine to service those channels.  Here is such a solution:\n<a href=\"https://github.com/gammazero/bigchan#bigchan\" rel=\"nofollow noreferrer\">https://github.com/gammazero/bigchan#bigchan</a></p>\n\n<p>I have used a <code>BigChan</code> as the Data channel in your <code>fileWriter</code> and <code>sqlWriter</code> and it appears to have the results you are looking for.  Following is your reworked code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    \"github.com/gammazero/bigchan\"\n)\n\n// Maximum number of items to buffer.  set to -1 for unlimited.\nconst limit = 65536\n\ntype procHandler interface {\n    Start()\n    NewData(newdata []byte)\n}\n\ntype fileWriter struct {\n    Data *bigchan.BigChan\n}\n\nfunc (proc *fileWriter) Start() {\n    proc.Data = bigchan.New(limit)\n    go func() {\n        for {\n            _obj := &lt;-proc.Data.Out()\n            obj := _obj.([]byte)\n\n            fmt.Printf(\"proc %T \", proc)\n            fmt.Println(obj)\n        }\n    }()\n}\n\nfunc (proc *fileWriter) NewData(newdata []byte) {\n    proc.Data.In() &lt;- newdata\n}\n\ntype sqlWriter struct {\n    Data *bigchan.BigChan\n}\n\nfunc (proc *sqlWriter) Start() {\n    proc.Data = bigchan.New(limit)\n\n    go func() {\n        for {\n            _obj := &lt;-proc.Data.Out()\n            obj := _obj.([]byte)\n            time.Sleep(5 * time.Second)\n            fmt.Printf(\"proc %T \", proc)\n            fmt.Println(obj)\n        }\n    }()\n}\nfunc (proc *sqlWriter) NewData(newdata []byte) {\n    proc.Data.In() &lt;- newdata\n}\n\nvar processors = []procHandler{}\n\nfunc receiver() {\n    newDataImitateByteRange := 30\n    for i := 0; i &lt; newDataImitateByteRange; i++ {\n        pseudoData := []byte{byte(i)}\n\n        for _, handler := range processors {\n            handler.NewData(pseudoData)\n        }\n    }\n}\n\nfunc main() {\n    // file writer\n    fileUpdate := &amp;fileWriter{}\n    processors = append(processors, fileUpdate)\n\n    // sql writer\n    sqlUpdate := &amp;sqlWriter{}\n    processors = append(processors, sqlUpdate)\n\n    sqlUpdate.Start()\n    fileUpdate.Start()\n\n    go receiver()\n\n    fmt.Scanln()\n}\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 4893819, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/69b691a83e3cba77791ce38097b53402?s=128&d=identicon&r=PG&f=1", "display_name": "Feanon", "link": "https://stackoverflow.com/users/4893819/feanon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507335867, "creation_date": 1506917870, "question_id": 46519440, "link": "https://stackoverflow.com/questions/46519440/data-processing-by-several-functions-is-asynchronous", "title": "Data processing by several functions is asynchronous", "body": "<p>I have data that I receive via http, this data needs to be processed by two different functions. It is important that they are processed by each function in sequence. In the file, for example: 1,2,3,4,5. And the database also recorded 1,2,3,4,5. As a fifo model.\nNow I have such a problem ... The data I have is running continuously and sometimes the database can fulfill my request to update the data quite a long time, because of this I can not update the file in a timely manner.\nIt is important for me that the data has been added to the file or database when it is possible. I could use buffered channels, but I can not know how much data can wait for processing in the queue, I would not want to indicate the size of the buffer is certainly large.\nI tried adding more goroutine to the NewData function, but in that case my data is not written sequentially.</p>\n\n<p>this code shows the problem.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype procHandler interface {\n    Start()\n    NewData(newdata []byte)\n}\n\ntype fileWriter struct {\n    Data chan []byte\n}\n\nfunc (proc *fileWriter) Start() {\n    proc.Data = make(chan []byte)\n    go func() {\n        for {\n            obj := &lt;-proc.Data\n\n            fmt.Printf(\"proc %T \", proc)\n            fmt.Println(obj)\n        }\n    }()\n}\n\nfunc (proc *fileWriter) NewData(newdata []byte) {\n    proc.Data &lt;- newdata\n}\n\ntype sqlWriter struct {\n    Data chan []byte\n}\n\nfunc (proc *sqlWriter) Start() {\n    proc.Data = make(chan []byte)\n    go func() {\n        for {\n            obj := &lt;-proc.Data\n            time.Sleep(5 * time.Second)\n            fmt.Printf(\"proc %T \", proc)\n            fmt.Println(obj)\n        }\n    }()\n}\n\nfunc (proc *sqlWriter) NewData(newdata []byte) {\n    proc.Data &lt;- newdata\n}\n\nvar processors = []procHandler{}\n\nfunc receiver() {\n    newDataImitateByteRange := 30\n    for i := 0; i &lt; newDataImitateByteRange; i++ {\n        pseudoData := []byte{byte(i)}\n\n        for _, handler := range processors {\n            handler.NewData(pseudoData)\n        }\n    }\n}\n\nfunc main() {\n    // file writer\n    fileUpdate := &amp;fileWriter{}\n    processors = append(processors, fileUpdate)\n\n    // sql writer\n    sqlUpdate := &amp;sqlWriter{}\n    processors = append(processors, sqlUpdate)\n\n    sqlUpdate.Start()\n    fileUpdate.Start()\n\n    go receiver()\n\n    fmt.Scanln()\n}\n</code></pre>\n\n<p>Code works: <a href=\"https://play.golang.org/p/rSshsJYZ4h\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rSshsJYZ4h</a></p>\n\n<p>output:</p>\n\n<pre><code>proc *main.fileWriter [0]\nproc *main.fileWriter [1]\nproc *main.sqlWriter [0] (sleep)\nproc *main.fileWriter [2] (Display after 5 seconds when the previous channel is processed)\nproc *main.sqlWriter [1] (sleep)\nproc *main.fileWriter [3] (Display after 5 seconds when the previous channel is processed)\nproc *main.sqlWriter [2]\nproc *main.fileWriter [4]\nproc *main.sqlWriter [3]\nproc *main.fileWriter [5]\nproc *main.sqlWriter [4]\nproc *main.fileWriter [6]\n</code></pre>\n\n<p>I want:</p>\n\n<pre><code>proc *main.fileWriter [0]\nproc *main.fileWriter [1]\nproc *main.fileWriter [2]\nproc *main.fileWriter [3]\nproc *main.fileWriter [4]\nproc *main.fileWriter [5]\nproc *main.fileWriter [6]\nproc *main.sqlWriter [0] (after 5 seconds passed the handler started execution.)\nproc *main.sqlWriter [1] (sleep)\nproc *main.sqlWriter [2] (sleep)\nproc *main.sqlWriter [3] (sleep)\nproc *main.sqlWriter [4] (sleep)\nproc *main.sqlWriter [5] (sleep)\nproc *main.sqlWriter [6] (sleep)\n</code></pre>\n\n<p>I hope for help, thank you!</p>\n"}, {"tags": ["go", "redis"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1506925441, "last_edit_date": 1506925441, "creation_date": 1506924796, "answer_id": 46520313, "question_id": 46519415, "link": "https://stackoverflow.com/questions/46519415/passing-a-struct-to-the-redigo-send-function-breaks-it-and-data-is-missing/46520313#46520313", "title": "Passing a Struct to the redigo Send function breaks it and data is missing", "body": "<p>Redigo <a href=\"https://godoc.org/github.com/garyburd/redigo/redis#hdr-Executing_Commands\" rel=\"nofollow noreferrer\">supports the following conversions to Redis bulk strings</a>:</p>\n\n<pre><code>Go Type                 Conversion\n[]byte                  Sent as is\nstring                  Sent as is\nint, int64              strconv.FormatInt(v)\nfloat64                 strconv.FormatFloat(v, 'g', -1, 64)\nbool                    true -&gt; \"1\", false -&gt; \"0\"\nnil                     \"\"\nall other types         fmt.Print(v)\n</code></pre>\n\n<p>The <code>Reply</code> type is encoding using <code>fmt.Print(v)</code>. </p>\n\n<p>It looks like you want to encode the value as JSON. If so, do the encoding in the application.  You can remove the <code>redis</code> field tags.</p>\n\n<pre><code>writeToRedis(conn redis.Conn, data Reply) error {\n    p, err := json.Marshl(data)\n    if err != nil {\n        return errors.Wrap(err, \"Unable to encode message to json\")\n    }\n    if err := conn.Send(\"PUBLISH\", Channel, p); err != nil {\n        return errors.Wrap(err, \"Unable to publish message to Redis\")\n    }\n    if err := conn.Flush(); err != nil {\n        return errors.Wrap(err, \"Unable to flush published message to Redis\")\n    }\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 193, "user_id": 5121885, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh4.googleusercontent.com/-Gac4fZTstvo/AAAAAAAAAAI/AAAAAAAAABg/zO613LrrL9s/photo.jpg?sz=128", "display_name": "Itzik Ben Hutta", "link": "https://stackoverflow.com/users/5121885/itzik-ben-hutta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 0, "accepted_answer_id": 46520313, "answer_count": 1, "score": 2, "last_activity_date": 1506925441, "creation_date": 1506917685, "last_edit_date": 1506918711, "question_id": 46519415, "link": "https://stackoverflow.com/questions/46519415/passing-a-struct-to-the-redigo-send-function-breaks-it-and-data-is-missing", "title": "Passing a Struct to the redigo Send function breaks it and data is missing", "body": "<p>This is my struct, when I get a socket message I readJson and the structs gets filled with the data and all is fine. It goes through some functions, but once it goes through the Send function it serializes it in a weird way that eventually I get back a bunch of numbers and when I convert it to string, data is missing.  </p>\n\n<pre><code>type Reply struct {\n  Topic   string `redis:\"topic\" json:\"topic\"`\n  Ref string `redis:\"ref\" json:\"ref\"`\n  Payload struct {\n      Status string `redis:\"status\" json:\"status\"`\n      Response map[string]interface{} `redis:\"response\" json:\"response\"`\n  } `json:\"payload\"`\n}\n</code></pre>\n\n<p>I just want to broadcast messages in this format. </p>\n\n<p>This is where I get the modified and problematic data</p>\n\n<pre><code>func (rr *redisReceiver) run() error {\n  l := log.WithField(\"channel\", Channel)\n  conn := rr.pool.Get()\n  defer conn.Close()\n  psc := redis.PubSubConn{Conn: conn}\n  psc.Subscribe(Channel)\n  go rr.connHandler()\n  for {\n    switch v := psc.Receive().(type) {\n    case redis.Message:\n        rr.broadcast(v.Data)\n    case redis.Subscription:\n        l.WithFields(logrus.Fields{\n            \"kind\":  v.Kind,\n            \"count\": v.Count,\n        }).Println(\"Redis Subscription Received\")\n        log.Println(\"Redis Subscription Received\")\n    case error:\n        return errors.New(\"Error while subscribed to Redis channel\")\n    default:\n        l.WithField(\"v\", v).Info(\"Unknown Redis receive during subscription\")\n        log.Println(\"Unknown Redis receive during subscription\")\n    }\n  }\n}\n</code></pre>\n\n<p>Does Redigo not support that type of data structure?</p>\n\n<p>This is the format I get and the format I'm supposed to get.</p>\n\n<pre><code>//Get\n\"{{spr_reply sketchpad map[] 1} {ok map[success:Joined successfully]}}\"\n//Supposed to get\n{event: \"spr_reply\", topic: \"sketchpad\", ref: \"45\", payload: {status: \n\"ok\", response: {}}}\n</code></pre>\n\n<p>On line 55 is where I get back the \"corrupted\" data - <a href=\"https://play.golang.org/p/TOzJuvewlP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/TOzJuvewlP</a></p>\n"}, {"tags": ["go", "exec", "stdout", "stderr"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1506903150, "post_id": 46518049, "comment_id": 79990260, "body": "Duplicate the stdout code for stderr (create the pipe, add one to the wait group, start the goroutine)."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1506903482, "post_id": 46518049, "comment_id": 79990330, "body": "If you need to process the lines serially, duplicate the stdout code for stderr, but instead of calling your function on each line in those goroutines, write each line to a channel and have a third goroutine that reads the channel and processes the lines."}], "answers": [{"tags": [], "owner": {"reputation": 768, "user_id": 1011867, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/3c7d3778a88027a6e925cd4360057d48?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/1011867/michael"}, "is_accepted": false, "score": 2, "last_activity_date": 1506907799, "creation_date": 1506907799, "answer_id": 46518473, "question_id": 46518049, "link": "https://stackoverflow.com/questions/46518049/scanning-both-stdout-and-stderr-simultaneously/46518473#46518473", "title": "Scanning both stdout and stderr simultaneously", "body": "<p>As above commentors suggested I added 2 more goroutines (one for stderr, one for closing channel).</p>\n\n<pre><code>var wg sync.WaitGroup\n\nstdout, err := cmd.StdoutPipe()\nif err != nil {\n    return fmt.Errorf(\"RunCommand: cmd.StdoutPipe(): %v\", err)\n}\nstderr, err := cmd.StderrPipe()\nif err != nil {\n    return fmt.Errorf(\"RunCommand: cmd.StderrPipe(): %v\", err)\n}\n\nif err := cmd.Start(); err != nil {\n    return fmt.Errorf(\"RunCommand: cmd.Start(): %v\", err)\n}\n\noutch := make(chan string, 10)\n\nscannerStdout := bufio.NewScanner(stdout)\nscannerStdout.Split(ScanLinesR)\nwg.Add(1)\ngo func() {\n    for scannerStdout.Scan() {\n        text := scannerStdout.Text()\n        if strings.TrimSpace(text) != \"\" {\n            outch &lt;- text\n        }\n    }\n    wg.Done()\n}()\nscannerStderr := bufio.NewScanner(stderr)\nscannerStderr.Split(ScanLinesR)\nwg.Add(1)\ngo func() {\n    for scannerStderr.Scan() {\n        text := scannerStderr.Text()\n        if strings.TrimSpace(text) != \"\" {\n            outch &lt;- text\n        }\n    }\n    wg.Done()\n}()\n\ngo func() {\n    wg.Wait()\n    close(outch)\n}()\n\nfor t := range outch {\n    DoWhateverYouNeedWithText(t)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 313, "user_id": 7052021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80e432db69cde0a1d276d51e60a93ff2?s=128&d=identicon&r=PG&f=1", "display_name": "ANSerpen", "link": "https://stackoverflow.com/users/7052021/anserpen"}, "is_accepted": false, "score": 0, "last_activity_date": 1538049522, "creation_date": 1538049522, "answer_id": 52536502, "question_id": 46518049, "link": "https://stackoverflow.com/questions/46518049/scanning-both-stdout-and-stderr-simultaneously/52536502#52536502", "title": "Scanning both stdout and stderr simultaneously", "body": "<pre class=\"lang-golang prettyprint-override\"><code>// child.go\n\nfunc main() {\n    fmt.Fprintln(os.Stdout, \"Child started.\")\n    time.Sleep(time.Second * 1)\n    fmt.Println(\"Tick...\")\n    time.Sleep(time.Second * 1)\n    fmt.Println(\"Tick...\")\n    time.Sleep(time.Second * 1)\n    fmt.Println(\"Tick...\")\n    time.Sleep(time.Second * 2)\n    fmt.Println(\"Child ended.\")\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// childerr.go\nfunc main() {\n    fmt.Fprintln(os.Stdout, \"Child started.\")\n    time.Sleep(time.Second * 1)\n    fmt.Fprintln(os.Stdout, \"Tick...\")\n    time.Sleep(time.Second * 1)\n    fmt.Fprintln(os.Stdout, \"Tick...\")\n    time.Sleep(time.Second * 1)\n    fmt.Fprintln(os.Stdout, \"Tick...\")\n    time.Sleep(time.Second * 2)\n    panic(\"testing\")\n    fmt.Fprintln(os.Stdout, \"Child ended.\")\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func executeCommand(output chan&lt;- string, err chan&lt;- error, start chan interface{}, cmd *exec.Cmd) {\n\n    defer close(start)\n\n    stdout, e := cmd.StdoutPipe()\n    if e != nil {\n        log.Println(\"Error starting Cmd: \", e)\n        err &lt;- e\n        return\n    }\n\n    cmd.Stderr = cmd.Stdout\n\n    &lt;-start\n\n    scanner := bufio.NewScanner(stdout)\n\n    for scanner.Scan() {\n        output &lt;- scanner.Text()\n    }\n\n}\n\nfunc run(cmd *exec.Cmd) {\n\n    start := make(chan interface{})\n    output := make(chan string)\n    errChan := make(chan error)\n    defer close(output)\n    defer close(errChan)\n\n    go executeCommand(output, errChan, start, cmd)\n\n    start &lt;- nil\n\n    if e := cmd.Start(); e != nil {\n        log.Println(\"Error starting Cmd: \", e)\n    }\n\n    for {\n        select {\n        case b := &lt;-output:\n            fmt.Println(b)\n        case e := &lt;-errChan:\n            fmt.Println(\"ERR EXECUTING COMMAND-&gt;\", e)\n            return\n        case &lt;-start:\n            fmt.Println(\"COMPLETED\")\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>Use child or childerr to create sample long running proces(es).</p>\n"}], "owner": {"reputation": 768, "user_id": 1011867, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/3c7d3778a88027a6e925cd4360057d48?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/1011867/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 638, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1538049522, "creation_date": 1506902641, "last_edit_date": 1506928103, "question_id": 46518049, "link": "https://stackoverflow.com/questions/46518049/scanning-both-stdout-and-stderr-simultaneously", "title": "Scanning both stdout and stderr simultaneously", "body": "<p>I'm looking for a way to process both stdout and stderr simultaneously as one stream.\nFor a stdout I can use:</p>\n\n<pre><code>cmd := exec.Command(command, flags...)\nvar wg sync.WaitGroup\n\nstdout, err := cmd.StdoutPipe()\nif err != nil {\n    return fmt.Errorf(\"RunCommand: cmd.StdoutPipe(): %v\", err)\n}\n\nif err := cmd.Start(); err != nil {\n    return fmt.Errorf(\"RunCommand: cmd.Start(): %v\", err)\n}\n\nscanner := bufio.NewScanner(stdout)\nscanner.Split(ScanLinesR)\nwg.Add(1)\ngo func() {\n    for scanner.Scan() {\n        text := scanner.Text()\n        if strings.TrimSpace(text) != \"\" {\n            DoWhateverYouNeedWithText(text)\n        }\n    }\n    wg.Done()\n}()\n\nwg.Wait()\n</code></pre>\n\n<p>But how I add stderr to the same code?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1592, "user_id": 618951, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/b867e8993ce4bf8205315e4a2e45e418?s=128&d=identicon&r=PG", "display_name": "RisingSun", "link": "https://stackoverflow.com/users/618951/risingsun"}, "edited": false, "score": 0, "creation_date": 1506893897, "post_id": 46517103, "comment_id": 79988400, "body": "why not just iterate over attr and put the data into stringmap?"}, {"owner": {"reputation": 1626, "user_id": 1488821, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ff34020e0a05e5f3b45e4e3825bf7c64?s=128&d=identicon&r=PG", "display_name": "Ivan Voras", "link": "https://stackoverflow.com/users/1488821/ivan-voras"}, "reply_to_user": {"reputation": 1592, "user_id": 618951, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/b867e8993ce4bf8205315e4a2e45e418?s=128&d=identicon&r=PG", "display_name": "RisingSun", "link": "https://stackoverflow.com/users/618951/risingsun"}, "edited": false, "score": 0, "creation_date": 1506894101, "post_id": 46517103, "comment_id": 79988443, "body": "Performance reasons, those are potentially huge. And the structures are basically the same, there has to be a way of just using them."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1506895166, "post_id": 46517103, "comment_id": 79988701, "body": "Type aliases could have helped."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1506928183, "post_id": 46517103, "comment_id": 79995662, "body": "&quot;Ok, apparently this is a language limitation (booo-hooo). Can it be stepped aside with unsafe pointers?&quot; -- this is a terrible question.  Just use a loop."}, {"owner": {"reputation": 1626, "user_id": 1488821, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ff34020e0a05e5f3b45e4e3825bf7c64?s=128&d=identicon&r=PG", "display_name": "Ivan Voras", "link": "https://stackoverflow.com/users/1488821/ivan-voras"}, "edited": false, "score": 0, "creation_date": 1506933000, "post_id": 46517103, "comment_id": 79997909, "body": "Uhm, that&#39;s a completely inappropriate response and an unwarranted downvote. Just use a loop? For assigning two containers defined exactly the same? I think it&#39;s fair to call it a language limitation because other practical languages allow it, which makes, comparing them by <i>this particular feature</i>, Go more limited. Consider this valid C++ code: <a href=\"https://gist.github.com/ebit-ivoras/170fa97131b5d105aaaa7fa94cae11ee\" rel=\"nofollow noreferrer\">gist.github.com/ebit-ivoras/170fa97131b5d105aaaa7fa94cae11ee</a> ."}], "answers": [{"tags": [], "owner": {"reputation": 737, "user_id": 6275844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f7071f7e0149f02e945420a120a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Dan 0", "link": "https://stackoverflow.com/users/6275844/dan-0"}, "is_accepted": true, "score": 2, "last_activity_date": 1506895620, "creation_date": 1506895620, "answer_id": 46517358, "question_id": 46517103, "link": "https://stackoverflow.com/questions/46517103/casting-compatible-but-different-slices-of-maps/46517358#46517358", "title": "Casting compatible but different slices of maps", "body": "<p>You can do this, but it circumvents Go's type safety, which can lead to trouble depending on implementation type.</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"unsafe\"\n)\n\nfunc main() {\n    type Attrs map[string]string\n    type StringMap map[string]string\n    a := Attrs{\"key1\": \"val1\", \"key2\": \"val2\"}\n    b := Attrs{\"key3\": \"val3\", \"key4\": \"val4\"}\n\n    attrs := []Attrs{a, b}\n\n    // This is what you're asking for, keep in mind this circumvents the type safety provided by go\n\n    sh := *(*reflect.SliceHeader)(unsafe.Pointer(&amp;attrs))\n    unsafeStrMaps := *(*[]StringMap)(unsafe.Pointer(&amp;sh))\n    fmt.Println(unsafeStrMaps)\n\n    // This would be the preferred way of casting the array\n\n    strMaps := []StringMap{}\n    for _, v := range attrs {\n        strMaps = append(strMaps, StringMap(v))\n    }\n\n    fmt.Println(strMaps)\n}\n</code></pre>\n\n<p>It is much better for type safety to just iterate the <code>[]Attrs</code> slice and append to a <code>[]StringMap</code>.</p>\n"}], "owner": {"reputation": 1626, "user_id": 1488821, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ff34020e0a05e5f3b45e4e3825bf7c64?s=128&d=identicon&r=PG", "display_name": "Ivan Voras", "link": "https://stackoverflow.com/users/1488821/ivan-voras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 46517358, "answer_count": 1, "score": -2, "last_activity_date": 1506928127, "creation_date": 1506893438, "last_edit_date": 1506928127, "question_id": 46517103, "link": "https://stackoverflow.com/questions/46517103/casting-compatible-but-different-slices-of-maps", "title": "Casting compatible but different slices of maps", "body": "<p>I'm working with two libraries, and one defines a type:</p>\n\n<pre><code>type Attrs map[string]string\n</code></pre>\n\n<p>while the other defines:</p>\n\n<pre><code>type StringMap map[string]string\n</code></pre>\n\n<p>A function from the first library returns an <code>[]Attrs</code>, and struct required by the other has a field as <code>[]StringMap</code> which needs to be set. Attempting to either use a simple assignment, or a cast in the form of <code>([]StringMap)(attrs)</code>, just results in an error:</p>\n\n<pre><code>./wscmd.go:8:22: cannot convert attrs (type []mpd.Attrs) to type []StringMap\n</code></pre>\n\n<p>So, how can those be bridged?</p>\n\n<p><strong>Edit:</strong> Ok, apparently this is a language limitation (booo-hooo). Can it be stepped aside with unsafe pointers? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 8704876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e956229ac497b30ace9e9e10fc63922?s=128&d=identicon&r=PG&f=1", "display_name": "GoHttp", "link": "https://stackoverflow.com/users/8704876/gohttp"}, "edited": false, "score": 0, "creation_date": 1506891932, "post_id": 46516845, "comment_id": 79987949, "body": "I am trying to create a string array which is going to read from the file and then as the post request will be coming up it will check the array for values."}, {"owner": {"reputation": 21, "user_id": 8704876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e956229ac497b30ace9e9e10fc63922?s=128&d=identicon&r=PG&f=1", "display_name": "GoHttp", "link": "https://stackoverflow.com/users/8704876/gohttp"}, "edited": false, "score": 0, "creation_date": 1506891977, "post_id": 46516845, "comment_id": 79987967, "body": "I need to pass given array to handler. It would be really good if it could be done by pointer."}, {"owner": {"reputation": 21, "user_id": 8704876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e956229ac497b30ace9e9e10fc63922?s=128&d=identicon&r=PG&f=1", "display_name": "GoHttp", "link": "https://stackoverflow.com/users/8704876/gohttp"}, "edited": false, "score": 0, "creation_date": 1506892015, "post_id": 46516845, "comment_id": 79987980, "body": "Could you give me some examples on how to do it?"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 3, "last_activity_date": 1506891578, "creation_date": 1506891578, "answer_id": 46516845, "question_id": 46516797, "link": "https://stackoverflow.com/questions/46516797/additional-arguments-to-http-function-golang/46516845#46516845", "title": "Additional arguments to http function Golang", "body": "<p>There are lots of options here, you could: </p>\n\n<ul>\n<li>Use a closure to set state for the enclosed handler</li>\n<li>Use a method on a struct for the handler, and set global state there</li>\n<li>Use the request context to store a value, then get it out</li>\n<li>Use a package global to store the value</li>\n<li>Write your own router with a new signature (not as complex as it sounds, but probably not a good idea)</li>\n<li>Write a helper function to do things like extract params from the url</li>\n</ul>\n\n<p>It depends what s is really - is it a constant, is it based on some state, does it belong in a separate package?</p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1506892752, "creation_date": 1506892752, "answer_id": 46516998, "question_id": 46516797, "link": "https://stackoverflow.com/questions/46516797/additional-arguments-to-http-function-golang/46516998#46516998", "title": "Additional arguments to http function Golang", "body": "<p>One of ways is to store data in global variable:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nvar replies map[string]string\n\nfunc handler1(w http.ResponseWriter, r *http.Request) {\n    r.ParseForm()\n    question := r.FormValue(\"question\")\n    var answer string\n    var ok bool\n    if answer, ok = replies[question]; !ok {\n        answer = \"I have no answer for this\"\n    }\n    fmt.Fprintf(w, \"Hi there, I love %s! My answer is: %s\", question, answer)\n}\n\nfunc main() {\n    //files := \"bar\"\n    replies = map[string]string{\n        \"UK\": \"London\",\n        \"FR\": \"Paris\",\n    }\n    http.HandleFunc(\"/\", handler1)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>Here for brevity I've commented out files and put data as is into the map. You may read the file and put them there.</p>\n\n<p>Usage with CURL:</p>\n\n<pre><code>$ curl -X POST 127.0.0.1:8080/ -d \"question=FR\"\nHi there, I love FR! My answer is: Paris\n\n$ curl -X POST 127.0.0.1:8080/ -d \"question=US\"\nHi there, I love US! My answer is: I have no answer for this\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 8704876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e956229ac497b30ace9e9e10fc63922?s=128&d=identicon&r=PG&f=1", "display_name": "GoHttp", "link": "https://stackoverflow.com/users/8704876/gohttp"}, "edited": false, "score": 0, "creation_date": 1506893623, "post_id": 46517000, "comment_id": 79988339, "body": "I really like this answer but i am not sure how to turn it into a array of strings &lt;.&lt;."}, {"owner": {"reputation": 737, "user_id": 6275844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f7071f7e0149f02e945420a120a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Dan 0", "link": "https://stackoverflow.com/users/6275844/dan-0"}, "reply_to_user": {"reputation": 21, "user_id": 8704876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e956229ac497b30ace9e9e10fc63922?s=128&d=identicon&r=PG&f=1", "display_name": "GoHttp", "link": "https://stackoverflow.com/users/8704876/gohttp"}, "edited": false, "score": 0, "creation_date": 1506894630, "post_id": 46517000, "comment_id": 79988581, "body": "Just change <code>Files string</code> to <code>Files []string</code> and instantiate the struct with your array."}, {"owner": {"reputation": 737, "user_id": 6275844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f7071f7e0149f02e945420a120a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Dan 0", "link": "https://stackoverflow.com/users/6275844/dan-0"}, "reply_to_user": {"reputation": 21, "user_id": 8704876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e956229ac497b30ace9e9e10fc63922?s=128&d=identicon&r=PG&f=1", "display_name": "GoHttp", "link": "https://stackoverflow.com/users/8704876/gohttp"}, "edited": false, "score": 0, "creation_date": 1506896591, "post_id": 46517000, "comment_id": 79989022, "body": "If you want to fetch the files dynamically you can just add another function like <code>func (fh *FilesHandler) GetFiles() []string {&#47;&#47;Do stuff to get your string array of files}</code> and call it in <code>handler</code> like <code>fh.GetFiles()</code>"}, {"owner": {"reputation": 21, "user_id": 8704876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e956229ac497b30ace9e9e10fc63922?s=128&d=identicon&r=PG&f=1", "display_name": "GoHttp", "link": "https://stackoverflow.com/users/8704876/gohttp"}, "edited": false, "score": 0, "creation_date": 1506937257, "post_id": 46517000, "comment_id": 80000037, "body": "Okay so i did something like this: <a href=\"https://play.golang.org/p/6AZ-2wDdo7\" rel=\"nofollow noreferrer\">play.golang.org/p/6AZ-2wDdo7</a>"}, {"owner": {"reputation": 21, "user_id": 8704876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e956229ac497b30ace9e9e10fc63922?s=128&d=identicon&r=PG&f=1", "display_name": "GoHttp", "link": "https://stackoverflow.com/users/8704876/gohttp"}, "edited": false, "score": 0, "creation_date": 1506937400, "post_id": 46517000, "comment_id": 80000109, "body": "You mentioned something about modifying array and i have got interested. I  have made this : <a href=\"https://play.golang.org/p/EzWjMxxtdV\" rel=\"nofollow noreferrer\">play.golang.org/p/EzWjMxxtdV</a> but i am interested in how you would do it. Please give me working example as i can not grasp it."}, {"owner": {"reputation": 21, "user_id": 8704876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e956229ac497b30ace9e9e10fc63922?s=128&d=identicon&r=PG&f=1", "display_name": "GoHttp", "link": "https://stackoverflow.com/users/8704876/gohttp"}, "edited": false, "score": 0, "creation_date": 1506938967, "post_id": 46517000, "comment_id": 80000827, "body": "I have put this example to work by what you mentioned in the comment: <a href=\"https://play.golang.org/p/agjRrSYQ-U\" rel=\"nofollow noreferrer\">play.golang.org/p/agjRrSYQ-U</a> Is it what you meant?"}, {"owner": {"reputation": 21, "user_id": 8704876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e956229ac497b30ace9e9e10fc63922?s=128&d=identicon&r=PG&f=1", "display_name": "GoHttp", "link": "https://stackoverflow.com/users/8704876/gohttp"}, "edited": false, "score": 0, "creation_date": 1506941323, "post_id": 46517000, "comment_id": 80001828, "body": "I did something like this using yours tips and pointer: <a href=\"https://play.golang.org/p/MN9q7c2yyc\" rel=\"nofollow noreferrer\">play.golang.org/p/MN9q7c2yyc</a>"}, {"owner": {"reputation": 737, "user_id": 6275844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f7071f7e0149f02e945420a120a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Dan 0", "link": "https://stackoverflow.com/users/6275844/dan-0"}, "reply_to_user": {"reputation": 21, "user_id": 8704876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e956229ac497b30ace9e9e10fc63922?s=128&d=identicon&r=PG&f=1", "display_name": "GoHttp", "link": "https://stackoverflow.com/users/8704876/gohttp"}, "edited": false, "score": 0, "creation_date": 1506985950, "post_id": 46517000, "comment_id": 80024610, "body": "Without knowing your exact intent, I can&#39;t really suggest much more. Your latest playground link works assuming you know the values of <code>Files</code> at runtime."}], "tags": [], "owner": {"reputation": 737, "user_id": 6275844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f7071f7e0149f02e945420a120a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Dan 0", "link": "https://stackoverflow.com/users/6275844/dan-0"}, "is_accepted": true, "score": 9, "last_activity_date": 1506892775, "creation_date": 1506892775, "answer_id": 46517000, "question_id": 46516797, "link": "https://stackoverflow.com/questions/46516797/additional-arguments-to-http-function-golang/46517000#46517000", "title": "Additional arguments to http function Golang", "body": "<p>I'm a little unclear on what you're trying to do, but based off what you said, why not try to encapsulate the data you want to pass in like this:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\ntype FilesHandler struct {\n    Files string\n}\n\nfunc (fh *FilesHandler) handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hi there, I love %s!\", fh.Files)\n}\n\nfunc main() {\n    myFilesHandler := &amp;FilesHandler{Files: \"bar\"}\n    http.HandleFunc(\"/\", myFilesHandler.handler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>This provides a little more granular control of what you make available to your Handler.</p>\n"}], "owner": {"reputation": 21, "user_id": 8704876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e956229ac497b30ace9e9e10fc63922?s=128&d=identicon&r=PG&f=1", "display_name": "GoHttp", "link": "https://stackoverflow.com/users/8704876/gohttp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3949, "favorite_count": 1, "accepted_answer_id": 46517000, "answer_count": 3, "score": 0, "last_activity_date": 1506892775, "creation_date": 1506891199, "question_id": 46516797, "link": "https://stackoverflow.com/questions/46516797/additional-arguments-to-http-function-golang", "title": "Additional arguments to http function Golang", "body": "<p>I am trying to pass string to handler in given example.</p>\n\n<pre><code>package main\nimport (\n\"fmt\"\n\"net/http\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n     fmt.Fprintf(w, \"Hi there, I love %s!\", r.URL.Path[1:])\n}\n\nfunc main() {\n     http.HandleFunc(\"/\", handler)\n     http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>Here is what i tried but it throws an error as it expects regular number of arguments:</p>\n\n<pre><code>package main\nimport (\n\"fmt\"\n\"net/http\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request, s *string) {\n     fmt.Fprintf(w, \"Hi there, I love %s!\", *s)\n}\n\nfunc main() {\n     files := \"bar\"\n     http.HandleFunc(\"/\", handler(&amp;files))\n     http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 1675412, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ddb81e6a50af93f4334e5a9c5bc22b4f?s=128&d=identicon&r=PG", "display_name": "hello world", "link": "https://stackoverflow.com/users/1675412/hello-world"}, "edited": false, "score": 0, "creation_date": 1506887469, "post_id": 46516011, "comment_id": 79986733, "body": "how to access the value of customerMobile key"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 21, "user_id": 1675412, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ddb81e6a50af93f4334e5a9c5bc22b4f?s=128&d=identicon&r=PG", "display_name": "hello world", "link": "https://stackoverflow.com/users/1675412/hello-world"}, "edited": false, "score": 0, "creation_date": 1506888216, "post_id": 46516011, "comment_id": 79986951, "body": "@helloworld <code>things[0].Record.CustomerMobile</code> will give you the Key. Details -   <a href=\"https://play.golang.org/p/kBX6jqdSA-\" rel=\"nofollow noreferrer\">play.golang.org/p/kBX6jqdSA-</a>"}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 3, "last_activity_date": 1506885634, "creation_date": 1506885634, "answer_id": 46516011, "question_id": 46515876, "link": "https://stackoverflow.com/questions/46515876/how-to-access-key-and-value-from-json-in-golang/46516011#46516011", "title": "How to access key and value from json in golang?", "body": "<p>You need to unmarshal into something that represents the entire JSON object. Your <code>Order</code> struct defines part of it, so just define the rest of it, as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Order struct {\n    ID             string `json:\"id\"`\n    CustomerMobile string `json:\"customerMobile\"`\n    CustomerName   string `json:\"customerName\"`\n}\n\ntype Thing struct {\n    Key    string `json:\"Key\"`\n    Record Order  `json:\"Record\"`\n}\n\nfunc main() {\n    jsonByteArray := []byte(`[{\"Key\":\"S001\", \"Record\":{\"id\":\"SOO1\",\"customerMobile\":\"12344566\",\"customerName\":\"John\"}}]`)\n    var things []Thing\n    err := json.Unmarshal(jsonByteArray, &amp;things)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%+v\\n\", things)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": false, "score": 0, "last_activity_date": 1506886168, "creation_date": 1506886168, "answer_id": 46516087, "question_id": 46515876, "link": "https://stackoverflow.com/questions/46515876/how-to-access-key-and-value-from-json-in-golang/46516087#46516087", "title": "How to access key and value from json in golang?", "body": "<p>Give a try to this: <a href=\"https://play.golang.org/p/pruDx70SjW\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pruDx70SjW</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nconst data = `[{\"Key\":\"S001\", \"Record\":{\"id\":\"SOO1\",\"customerMobile\":\"12344566\",\"customerName\":\"John\"}}]`\n\ntype Orders struct {\n    Key    string\n    Record Order\n}\n\ntype Order struct {\n    ID             string\n    CustomerMobile string\n    CustomerName   string\n}\n\nfunc main() {\n    var orders []Orders\n    if err := json.Unmarshal([]byte(data), &amp;orders); err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%+v\\n\", orders)\n}\n</code></pre>\n\n<p>In this case, I am omitting the <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">struct tags</a></p>\n"}], "owner": {"reputation": 21, "user_id": 1675412, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ddb81e6a50af93f4334e5a9c5bc22b4f?s=128&d=identicon&r=PG", "display_name": "hello world", "link": "https://stackoverflow.com/users/1675412/hello-world"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3255, "favorite_count": 1, "accepted_answer_id": 46516011, "answer_count": 2, "score": 0, "last_activity_date": 1506886168, "creation_date": 1506884799, "last_edit_date": 1506885847, "question_id": 46515876, "link": "https://stackoverflow.com/questions/46515876/how-to-access-key-and-value-from-json-in-golang", "title": "How to access key and value from json in golang?", "body": "<p>I have a struct</p>\n\n<pre><code>type Order struct {\n    ID string `json:\"id\"`\n    CustomerMobile string `json:\"customerMobile\"`\n    CustomerName string `json:\"customerName\"`\n   }\n</code></pre>\n\n<p>and the json data:</p>\n\n<pre><code>[{\"Key\":\"S001\", \"Record\":{\"id\":\"SOO1\",\"customerMobile\":\"12344566\",\"customerName\":\"John\"}}] \n</code></pre>\n\n<p>How can i access customerMobile key from the above json object?</p>\n\n<p>I have done some research in Google and i found the below solution, but its not working when i apply to my above requirement. Its working with simple json format.</p>\n\n<pre><code>jsonByteArray := []byte(jsondata)\n json.Unmarshal(jsonByteArray, &amp;order)\n</code></pre>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1506883120, "post_id": 46515542, "comment_id": 79985396, "body": "Use <code>http.FileServer</code> as documented in gorilla&#39;s readme <a href=\"https://github.com/gorilla/mux#static-files\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1506883817, "post_id": 46515542, "comment_id": 79985601, "body": "<a href=\"https://play.golang.org/p/KwwmnVhh7N\" rel=\"nofollow noreferrer\">Example</a>."}, {"owner": {"reputation": 387, "user_id": 2432174, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/ioAZo.jpg?s=128&g=1", "display_name": "dinu0101", "link": "https://stackoverflow.com/users/2432174/dinu0101"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1506916784, "post_id": 46515542, "comment_id": 79992610, "body": "Thanks for reply :-) I want to know that whether or not public folder to be inside application"}], "answers": [{"tags": [], "owner": {"reputation": 737, "user_id": 6275844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f7071f7e0149f02e945420a120a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Dan 0", "link": "https://stackoverflow.com/users/6275844/dan-0"}, "is_accepted": false, "score": 2, "last_activity_date": 1506919233, "creation_date": 1506919233, "answer_id": 46519604, "question_id": 46515542, "link": "https://stackoverflow.com/questions/46515542/static-content-not-served-with-the-gorilla-mux-router-like-style-css-script-js/46519604#46519604", "title": "Static content not served with the Gorilla mux router- like style.css,script.js", "body": "<p>As mkopriva stated, <code>http.FileServer</code> is the way to go. Your public folder can be wherever or whatever you want it to be as long as its referenced properly as the <code>http.FileServer</code> argument.</p>\n\n<p>Adding this would work:</p>\n\n<pre><code>fs := http.FileServer(http.Dir(\"./public\"))\ngorillaRoute.PathPrefix(\"/js/\").Handler(fs)\ngorillaRoute.PathPrefix(\"/css/\").Handler(fs)\n</code></pre>\n\n<p>That way a <code>GET</code> request to <code>http://[host]:[port]/css/style.css</code> will return <code>style.css</code> from the relative <code>./public/css/</code> directory.</p>\n"}], "owner": {"reputation": 387, "user_id": 2432174, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/ioAZo.jpg?s=128&g=1", "display_name": "dinu0101", "link": "https://stackoverflow.com/users/2432174/dinu0101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1062, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1506919233, "creation_date": 1506882534, "last_edit_date": 1506914596, "question_id": 46515542, "link": "https://stackoverflow.com/questions/46515542/static-content-not-served-with-the-gorilla-mux-router-like-style-css-script-js", "title": "Static content not served with the Gorilla mux router- like style.css,script.js", "body": "<p>I am very beginner of Go language. I an trying to serve static containt with Gorrila Mux router. But css and js is not server in my case.</p>\n\n<pre><code>  project\n   f-mymux.go \n   d-pages\n         f-home.html\n         f-about.html\n   d-public\n        d-css\n           f-style.css\n        d-js\n           f-script.js\n</code></pre>\n\n<p>Note: f- file &amp; d- directory</p>\n\n<p>My GO code as below:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"github.com/gorilla/mux\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"strings\"\n    \"text/template\"\n)\n\nfunc main() {\n    serverWeb()\n}\n\nvar staticPages = populateStaticPages()\n\nfunc serverWeb() {\n    gorillaRoute := mux.NewRouter().StrictSlash(true)\n    gorillaRoute.HandleFunc(\"/\", serveContent)\n    gorillaRoute.HandleFunc(\"/{page_alias}\", serveContent)\n    gorillaRoute.HandleFunc(\"/css\", serveResource)\n    port := \":8080\"\n    log.Println(\"Listening at port :\", port)\n    http.Handle(\"/\", gorillaRoute)\n    err := http.ListenAndServe(port, nil)\n    if err == nil {\n        log.Fatal(err)\n    }\n}\n\nfunc serveContent(w http.ResponseWriter, r *http.Request) {\n    pathX := r.URL.Path\n    log.Println(pathX)\n    urlParams := mux.Vars(r)\n    page_alias := urlParams[\"page_alias\"]\n    if page_alias == \"\" {\n        page_alias = \"home\"\n    }\n    staticPage := staticPages.Lookup(page_alias + \".html\")\n    if staticPage == nil {\n        staticPage = staticPages.Lookup(\"404.html\")\n        w.WriteHeader(404)\n    }\n    staticPage.Execute(w, nil)\n}\n\nfunc populateStaticPages() *template.Template {\n    result := template.New(\"template\")\n    templatePaths := new([]string)\n    basePath := \"pages\"\n    templateFolder, _ := os.Open(basePath)\n    defer templateFolder.Close()\n    templatePathsRow, _ := templateFolder.Readdir(-1)\n    for _, pathInfo := range templatePathsRow {\n        log.Println(pathInfo.Name())\n        *templatePaths = append(*templatePaths, basePath+\"/\"+\n            pathInfo.Name())\n    }\n    result.ParseFiles(*templatePaths...)\n    return result\n}\n\n//---------------------------------------------\n// Serve resource of types css, js &amp; img files\n//---------------------------------------------\n\nfunc serveResource(w http.ResponseWriter, r *http.Request) {\n    path := \"./public\" + r.URL.Path\n    var contentType string\n    if strings.HasSuffix(path, \".css\") {\n        contentType = \"text/css; charset=utf-8\"\n    } /* else if strings.HasSuffix(path , \".png\"){\n        contentType = \"image/png; charset=utf-8\"\n       } else if strings.HasSuffix(path , \".jpg\"){\n        contentType = \"image/jpg; charset=utf-8\"\n       } else if strings.HasSuffix(path , \".js\"){\n       contentType = \"application/javascript; charset=utf-8\"\n       } else {\n         contentType = \"text/plain; charset=utf-8\"\n       }*/\n\n    f, err := os.Open(path)\n    if err == nil {\n        defer f.Close()\n        w.Header().Add(\"Content-Type\", contentType)\n        br := bufio.NewReader(f)\n        br.WriteTo(w)\n    } else {\n        w.WriteHeader(404)\n    }\n}\n</code></pre>\n\n<p>when I am invoking code\n      <a href=\"http://localhost:8080/home\" rel=\"nofollow noreferrer\">http://localhost:8080/home</a>\nthen page come witout css and js.When invoking page <a href=\"http://localhost:8080/css/bootstrap.min.css\" rel=\"nofollow noreferrer\">http://localhost:8080/css/bootstrap.min.css</a> then 404 staus code come</p>\n\n<p>Please help me what am doing wrong here.\nWe can do easily on Java and java server. But on Go lang I spend a whole day but\nunable to resolve the issue.\nYour help is appropriated. </p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["node.js", "reactjs", "go", "cors", "http-status-code-302"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1506876976, "post_id": 46514522, "comment_id": 79983476, "body": "Does your react app get the cors error response from <code>b.com</code> or from <code>sso.example.com</code>?"}, {"owner": {"reputation": 2546, "user_id": 2105910, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/49d27fa05d4c28818d893ff859de0dbd?s=128&d=identicon&r=PG&f=1", "display_name": "yonasstephen", "link": "https://stackoverflow.com/users/2105910/yonasstephen"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1506877248, "post_id": 46514522, "comment_id": 79983558, "body": "@mkopriva oh yeah I just added that into the question. it&#39;s from <code>sso.example.com</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1506877765, "post_id": 46514522, "comment_id": 79983732, "body": "If <code>sso.example.com</code> does not allow cross origin requests and you don&#39;t have access to its server to modify the access controll then I&#39;m not sure your react app will ever be able to access its resources."}], "answers": [{"comments": [{"owner": {"reputation": 2546, "user_id": 2105910, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/49d27fa05d4c28818d893ff859de0dbd?s=128&d=identicon&r=PG&f=1", "display_name": "yonasstephen", "link": "https://stackoverflow.com/users/2105910/yonasstephen"}, "edited": false, "score": 0, "creation_date": 1506922802, "post_id": 46514915, "comment_id": 79993864, "body": "ahh okay, that&#39;s what I thought. I was just thinking if there&#39;s anything that I can do to avoid CORS on redirect in this scenario. thanks for the advice tho!"}], "tags": [], "owner": {"reputation": 5621, "user_id": 1472186, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1d558e820c0bf111894a0f7bff6611cb?s=128&d=identicon&r=PG", "display_name": "paradite", "link": "https://stackoverflow.com/users/1472186/paradite"}, "is_accepted": false, "score": 2, "last_activity_date": 1506878574, "creation_date": 1506878574, "answer_id": 46514915, "question_id": 46514522, "link": "https://stackoverflow.com/questions/46514522/reactjs-sent-get-request-responded-with-302-redirect-received-cors-error/46514915#46514915", "title": "ReactJS sent GET request, responded with 302 redirect, received CORS error", "body": "<p>In your case, it would be easier to do the redirection in browser on the client side, so you won't have CORS issues (because you are accessing it from the SSO website url directly).</p>\n\n<p>You can either do it with react, which is complicated: <a href=\"https://stackoverflow.com/questions/42123261/programmatically-navigate-using-react-router-v4\">Programmatically navigate using react router V4</a></p>\n\n<p>Or do it with <code>window</code> with plain JavaScript, which is easy but might cause problems with browsing history: </p>\n\n<pre><code>window.location.href = \"https://www.example.com\";\n</code></pre>\n\n<p><a href=\"https://appendto.com/2016/04/javascript-redirect-how-to-redirect-a-web-page-with-javascript/\" rel=\"nofollow noreferrer\">https://appendto.com/2016/04/javascript-redirect-how-to-redirect-a-web-page-with-javascript/</a></p>\n"}], "owner": {"reputation": 2546, "user_id": 2105910, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/49d27fa05d4c28818d893ff859de0dbd?s=128&d=identicon&r=PG&f=1", "display_name": "yonasstephen", "link": "https://stackoverflow.com/users/2105910/yonasstephen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6468, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1506878574, "creation_date": 1506876020, "last_edit_date": 1506877204, "question_id": 46514522, "link": "https://stackoverflow.com/questions/46514522/reactjs-sent-get-request-responded-with-302-redirect-received-cors-error", "title": "ReactJS sent GET request, responded with 302 redirect, received CORS error", "body": "<p>This is my stack:</p>\n\n<ol>\n<li>Frontend server: Node + ReactJS (<code>f.com</code>)</li>\n<li>Backend server (API): Golang (<code>b.com</code>)</li>\n</ol>\n\n<p>I'm doing this in development environment where I use <a href=\"https://github.com/facebookincubator/create-react-app\" rel=\"nofollow noreferrer\">create-react-app</a> to run my frontend server via <code>npm start</code> command. I want to perform authentication using SSO served at <code>sso.example.com/login</code>. Ideally whenever there's a request to the Backend server without proper authorization, it will be responded with HTTP 302 Redirect to the SSO page. So the sequence is: </p>\n\n<ol>\n<li>ReactJS sends GET request to <code>b.com/users</code></li>\n<li>Golang responded with http.Redirect(\"<code>sso.example.com/login</code>\")</li>\n<li>ReactJS app gets CORS error from <code>sso.example.com</code> of which I don't have control of adding <code>Access-Control-Allow-Origin:*</code> respond header</li>\n</ol>\n\n<p>How can I redirect my GET request successfully?</p>\n"}, {"tags": ["go", "leveldb"], "answers": [{"tags": [], "owner": {"reputation": 552, "user_id": 2030387, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KcdcP.jpg?s=128&g=1", "display_name": "adm_", "link": "https://stackoverflow.com/users/2030387/adm"}, "is_accepted": true, "score": 2, "last_activity_date": 1506876611, "creation_date": 1506876611, "answer_id": 46514611, "question_id": 46514211, "link": "https://stackoverflow.com/questions/46514211/overwrite-throw-error-on-duplicate-key-in-go-leveldb/46514611#46514611", "title": "Overwrite/Throw error on duplicate key in Go LevelDB", "body": "<p>LevelDB is a <a href=\"https://en.wikipedia.org/wiki/Log-structured_merge-tree\" rel=\"nofollow noreferrer\">log-structured merge-tree</a> and has transaction logs (the ones you were inspecting with hexdump). With this code you can validate that only one value is present for your key:</p>\n\n<pre><code>package main\n\nimport ( \"fmt\"\n\"github.com/syndtr/goleveldb/leveldb\"\n)\n\nfunc main () {\n        db, err := leveldb.OpenFile(\"mydb.test\", nil)\n        if err != nil { fmt.Println(err) }\n\n        for count := 0; count &lt; 5; count++ {\n                err := db.Put([]byte(\"keys\"), []byte(\"values\"), nil)\n                if err != nil {\n                    fmt.Println(err)\n                }\n        }\n\n        iter := db.NewIterator(nil, nil)\n        for iter.Next() {\n                key := iter.Key()\n                value := iter.Value()\n                fmt.Println(string(key), string(value))\n        }\n        iter.Release()\n\n        defer db.Close()\n}\n</code></pre>\n\n<blockquote>\n  <p>How can I control when the value gets overwritten?</p>\n</blockquote>\n\n<p>You can't, if the key is present, its value gets overwritten</p>\n"}], "owner": {"reputation": 83, "user_id": 7092921, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tAvwp.jpg?s=128&g=1", "display_name": "thee-engineer", "link": "https://stackoverflow.com/users/7092921/thee-engineer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 46514611, "answer_count": 1, "score": 2, "last_activity_date": 1506876611, "creation_date": 1506873795, "question_id": 46514211, "link": "https://stackoverflow.com/questions/46514211/overwrite-throw-error-on-duplicate-key-in-go-leveldb", "title": "Overwrite/Throw error on duplicate key in Go LevelDB", "body": "<p>When using the following code below I expect to have only one entry in the db.\nI use the <a href=\"https://github.com/syndtr/goleveldb\" rel=\"nofollow noreferrer\">syndtr/goleveldb</a> LevelDB implementation for Go.</p>\n\n<pre><code>for count := 0; count &lt; 5; count++ {\n    err := db.Put([]byte(\"key\"), []byte(\"value\"))\n    if err != nil {\n        t.Error(err)\n    }\n}\n</code></pre>\n\n<p>Instead, a hexdump reveals that there are 5 entries:</p>\n\n<pre><code>00000000  a8 ef d2 d4 17 00 01 01  00 00 00 00 00 00 00 01  |................|\n00000010  00 00 00 01 03 6b 65 79  05 76 61 6c 75 65 10 23  |.....key.value.#|\n00000020  44 b5 17 00 01 02 00 00  00 00 00 00 00 01 00 00  |D...............|\n00000030  00 01 03 6b 65 79 05 76  61 6c 75 65 77 be 34 95  |...key.valuew.4.|\n00000040  17 00 01 03 00 00 00 00  00 00 00 01 00 00 00 01  |................|\n00000050  03 6b 65 79 05 76 61 6c  75 65 08 35 86 60 17 00  |.key.value.5.`..|\n00000060  01 04 00 00 00 00 00 00  00 01 00 00 00 01 03 6b  |...............k|\n00000070  65 79 05 76 61 6c 75 65  6f 8c f6 00 17 00 01 05  |ey.valueo.......|\n00000080  00 00 00 00 00 00 00 01  00 00 00 01 03 6b 65 79  |.............key|\n00000090  05 76 61 6c 75 65                                 |.value|\n00000096\n</code></pre>\n\n<p>From my understanding <code>LevelDB</code> should by default overwrite any duplicate key or at least throw an error.</p>\n\n<p>How can I control when the value gets overwritten or how can I get an error (other than checking <code>db.Has(key)</code> every time that I <code>db.Put(key)</code>?\nDoes <code>compaction</code> have anything to do with this?</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506872988, "post_id": 46514016, "comment_id": 79982293, "body": "Just try it out under the race detector :-)  If you can ensure that no two code path write concurrently to the same inner map then you should be good. But why take a risk? What&#39;s wrong with a cute little mutex here or maybe several?"}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506873367, "post_id": 46514016, "comment_id": 79982392, "body": "@Volker, I could add several locks, but I feel that useless lock/unlock is like unused variable - why does it exist?!"}], "answers": [{"comments": [{"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1506873998, "post_id": 46514168, "comment_id": 79982589, "body": "But changing internal Map will also change the outer Map - is that true? Because in general it is a one big Map. So I always will have to lock outer Map"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1506874578, "post_id": 46514168, "comment_id": 79982782, "body": "short answer is that depends if you need to (can the outer map change?) - If the outer map will always be referring to the same inner maps then no you don&#39;t need to, if you are only ever adding new inner maps then you could just get a read lock (you can acquire multiple read locks). If there is a chance another process will delete the inner map from the outer map, or replace it with a different map, then yes you do"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 1, "creation_date": 1506874952, "post_id": 46514168, "comment_id": 79982894, "body": "Might be helpful to think of the outer map as a map of pointers to the inner maps (which they are), as long as the pointers aren&#39;t changing you are good"}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1506877586, "post_id": 46514168, "comment_id": 79983673, "body": "My outer Map can always be changed, new entries appear and may be modified, some other disappear. So if I add new inner Map - I should lock the outer Map; if I modify the inner Map - I should lock only this inner Map; if I delete inner Map - outer Map should be locked?! Correct?"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1506879509, "post_id": 46514168, "comment_id": 79984199, "body": "Unfortunately no, If there is a chance of deleting a map from the outer map I think you will always have to acquire a Write lock on the outer map when modifying the inner map other wise it may get deleted during modification. So for your purposes you may as well do away with the locks on the inner map and just lock the outer map every time you modify anything. If performance is an issue you might look at some way of batching together the changes or nesting the inner maps in a struct. you could then lock this struct when you modify or delete an inner map and periodically clean these up."}], "tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": true, "score": 2, "last_activity_date": 1506874010, "last_edit_date": 1506874010, "creation_date": 1506873559, "answer_id": 46514168, "question_id": 46514016, "link": "https://stackoverflow.com/questions/46514016/concurrent-writes-into-map-containing-another-map-in-golang/46514168#46514168", "title": "Concurrent writes into Map containing another Map in Golang", "body": "<p>My understanding is that there aren't any hard and fast rules here. </p>\n\n<p>For example, you could coordinate all map writes via a mutex that's not even stored on the map, there is no inherent link between any mutex and your map - its just about how you use them to coordinate access to your data.</p>\n\n<p>Essentially if you lock individual elements you will see less contention over the locks because the locks will be acquired less often, if you use an outer lock over all maps there will be more contention as more processes will be trying to acquire the same lock which will reduce how much actual work your processes can get done.</p>\n\n<p>It's ultimately up to you to work out what works best for your use case</p>\n\n<p><strong>Help with that:</strong></p>\n\n<p>There is a new tool available in go 1.9 that allows you to benchmark lock contention to see what approach is most efficient for your application.</p>\n\n<p>Building and running your app with the <code>-race</code> flag will help determine if the locks are doing their job correctly</p>\n\n<p>You could also take a look at the new sync maps which I haven't played with yet but I understand handle this for you:</p>\n\n<p><a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\">Sync maps</a></p>\n"}, {"tags": [], "owner": {"reputation": 5081, "user_id": 8657904, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-rMfL3u_MOf8/AAAAAAAAAAI/AAAAAAAAA3o/MAq-a_P33vI/photo.jpg?sz=128", "display_name": "Alin S&#238;np\u0103lean", "link": "https://stackoverflow.com/users/8657904/alin-s%c3%aenp%c4%83lean"}, "is_accepted": false, "score": 0, "last_activity_date": 1507149696, "creation_date": 1507149696, "answer_id": 46573820, "question_id": 46514016, "link": "https://stackoverflow.com/questions/46514016/concurrent-writes-into-map-containing-another-map-in-golang/46573820#46573820", "title": "Concurrent writes into Map containing another Map in Golang", "body": "<p>The simple (and most likely good enough) solution is to have a mutex that protects the whole structure. It can be a regular mutex or a read-write mutex, in case reads are much more frequent than writes. This is easy to implement, easy to reason about and in the vast majority of cases it will do the job.</p>\n\n<p>If on the other hand you're looking for a challenge, then you can take this into a number of directions:</p>\n\n<ul>\n<li>Have a top-level read-write mutex and one (simple or read-write) mutex per top-level map key. Write lock the top-level mutex when adding or deleting entries to the top level map; else read lock it, acquire the entry-specific lock and read or write the entry (which is also a map).</li>\n<li>Decide on what kind of parallelism you want and split your top-level map into shards, with keys sharded based on their hash and one mutex per shard. Then you can have parallel writes (key adds and removes) to multiple keys as long as they are in different shards.</li>\n<li>Apply the second approach to the second-level maps too. Go crazy! :o)</li>\n</ul>\n\n<p>But, in all seriousness, unless this map is huge, much of your application is simply adding and removing stuff from it, and you're willing to put a lot of effort into benchmarking and tweaking your implementation, go with the single lock approach. It is actually going to be much faster in the general case and, as a bonus, it's simple to implement.</p>\n"}], "owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 846, "favorite_count": 0, "accepted_answer_id": 46514168, "answer_count": 2, "score": 1, "last_activity_date": 1507149696, "creation_date": 1506872598, "question_id": 46514016, "link": "https://stackoverflow.com/questions/46514016/concurrent-writes-into-map-containing-another-map-in-golang", "title": "Concurrent writes into Map containing another Map in Golang", "body": "<p>In Golang we have to sync concurrent changes to the Map. If my Map contains another Map like this:</p>\n\n<pre><code>map[string]map[string]*CustomStruct\n</code></pre>\n\n<p>.. do I have to use <strong>Lock</strong> in all of them when writing something?</p>\n\n<p>If I'll write something into internal Map -> outer Map will also be changed, so I still have to sync outer Map's changes.</p>\n\n<p>If I Lock outer Map's changes -> no one else can write into internal Map -> there is no point to Lock internal Map.</p>\n\n<p>Am I right or it works in a different way and I must lock all Maps?</p>\n"}, {"tags": ["go", "go-cobra"], "answers": [{"tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": true, "score": 3, "last_activity_date": 1506871168, "creation_date": 1506871168, "answer_id": 46513804, "question_id": 46513718, "link": "https://stackoverflow.com/questions/46513718/how-can-the-default-helpcommand-be-called-inside-a-cobra-command/46513804#46513804", "title": "How can the default helpCommand be called inside a cobra command?", "body": "<p>I think its just this looking through the lib (not tested):</p>\n\n<pre><code>var infoCmd = &amp;cobra.Command{\n    Use:   \"info\",\n    Short: \"A brief description of your command\",\n    Run: func(cmd *cobra.Command, args []string) {\n        var infoURL string\n        if flag1 != \"\" {\n            doSomething()\n        } else if flag2 { //this is a boolean flag\n            doSomethingElse()\n        } else {\n            // Show the default help here\n            cmd.Help()\n        }\n     },\n }\n</code></pre>\n\n<p>See here:</p>\n\n<pre><code>// Help puts out the help for the command.\n// Used when a user calls help [command].\n// Can be defined by user by overriding HelpFunc.\nfunc (c *Command) Help() error {\n    c.HelpFunc()(c, []string{})\n    return nil\n}\n</code></pre>\n\n<p>Generally speaking a readme is only going to give some get started and overview info, you will often have to open up the godocs (inline documentation) to properly understand a package: <a href=\"https://godoc.org/github.com/spf13/cobra#Command.Help\" rel=\"nofollow noreferrer\">godoc cobra: help command</a></p>\n"}], "owner": {"reputation": 552, "user_id": 2030387, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KcdcP.jpg?s=128&g=1", "display_name": "adm_", "link": "https://stackoverflow.com/users/2030387/adm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 316, "favorite_count": 0, "accepted_answer_id": 46513804, "answer_count": 1, "score": 3, "last_activity_date": 1506871168, "creation_date": 1506870571, "question_id": 46513718, "link": "https://stackoverflow.com/questions/46513718/how-can-the-default-helpcommand-be-called-inside-a-cobra-command", "title": "How can the default helpCommand be called inside a cobra command?", "body": "<p>In the following code I'm defining a command, where two options are possible:\n1. myapp info --flag1 text\n2. myapp info --flag2 \nif none of the two options are specified, I want to show the helpCommand</p>\n\n<pre><code>var infoCmd = &amp;cobra.Command{\n    Use:   \"info\",\n    Short: \"A brief description of your command\",\n    Run: func(cmd *cobra.Command, args []string) {\n        var infoURL string\n        if flag1 != \"\" {\n            doSomething()\n        } else if flag2 { //this is a boolean flag\n            doSomethingElse()\n        } else {\n            // Show the default help here\n        }\n     },\n }\n</code></pre>\n\n<p>In the cobra <a href=\"https://github.com/spf13/cobra#the-help-command\" rel=\"nofollow noreferrer\">README</a> the helpCommand is explained for usage like\n<code>myapp help info</code> or <code>myapp info --help</code> or <code>myapp info --nonexistentoption</code> but nothing regarding how to actually call the method voluntarily. Any pointers?</p>\n"}, {"tags": ["go", "tensorflow", "keras"], "comments": [{"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1506928970, "post_id": 46512342, "comment_id": 79995999, "body": "That&#39;s something strange in your code  and error. Tensorflow is complaining about a missing value for the placeholder with name &#39;theoutput_target&#39;, whilst this placeholder is never defined in the code you posted. Instead, your code defines a placeholder whose name is &#39;theinput&#39;."}, {"owner": {"reputation": 35, "user_id": 5796181, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8assq.png?s=128&g=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/5796181/adrian"}, "reply_to_user": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1506946533, "post_id": 46512342, "comment_id": 80004386, "body": "thank you so much, it was a layer naming issue indeed (even if layers are named correctly in Keras they end up in TF with different names  - pasted the new export code above (basically just reads the graph and outputs layer names, I&#39;m using those names from Go afterwards)"}, {"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1506947643, "post_id": 46512342, "comment_id": 80005006, "body": "You&#39;re welcome! Since I solved your problem, I&#39;m going to copy the comment and post it as answer, feel free to accept it"}], "answers": [{"tags": [], "owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "is_accepted": true, "score": 0, "last_activity_date": 1506947682, "creation_date": 1506947682, "answer_id": 46525558, "question_id": 46512342, "link": "https://stackoverflow.com/questions/46512342/unable-to-predict-when-loading-a-tensorflow-model-in-go/46525558#46525558", "title": "Unable to predict when loading a Tensorflow model in Go", "body": "<p>That's something strange in your code and error. Tensorflow is complaining about a missing value for the placeholder with name 'theoutput_target', whilst this placeholder is never defined in the code you posted. Instead, your code defines a placeholder whose name is 'theinput'.</p>\n\n<p>Also, I suggest you to use a more complete and easy to use wrapper around the tensorflow API: <a href=\"https://github.com/galeone/tfgo\" rel=\"nofollow noreferrer\">tfgo</a></p>\n"}], "owner": {"reputation": 35, "user_id": 5796181, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8assq.png?s=128&g=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/5796181/adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 46525558, "answer_count": 1, "score": 0, "last_activity_date": 1506947682, "creation_date": 1506860506, "last_edit_date": 1506946387, "question_id": 46512342, "link": "https://stackoverflow.com/questions/46512342/unable-to-predict-when-loading-a-tensorflow-model-in-go", "title": "Unable to predict when loading a Tensorflow model in Go", "body": "<p>I've loaded a Tensorflow model in Go and cannot get predictions - it keeps complaining about shape mismatch - a simple 2d array. Would appreciate an idea here, thank you so much in advance.</p>\n\n<pre><code>Error running the session with input, err: You must feed a value for placeholder tensor 'theoutput_target' with dtype float\n [[Node: theoutput_target = Placeholder[_output_shapes=[[?,?]], dtype=DT_FLOAT, shape=[], _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]]\n</code></pre>\n\n<p>Input tensor being sent is a [][]float32{ {1.0}, }</p>\n\n<pre><code>a := [][]float32{ {1.0}, }\ntensor, terr :=  tf.NewTensor(a)\nif terr != nil {\n    fmt.Printf(\"Error creating input tensor: %s\\n\", terr.Error())\n    return\n}\nresult, runErr := model.Session.Run(\n    map[tf.Output]*tf.Tensor{\n        model.Graph.Operation(\"theinput\").Output(0): tensor,\n    },\n    []tf.Output{\n        model.Graph.Operation(\"theoutput_target\").Output(0),\n    },\n    nil,\n)\n</code></pre>\n\n<p>and the model is generated via Keras and exported to TF using SavedModelBuilder after:</p>\n\n<pre><code>layer_name_input = \"theinput\"\nlayer_name_output = \"theoutput\"\n\ndef get_encoder():\n    model = Sequential()\n    model.add(Dense(5, input_dim=1))\n    model.add(Activation(\"relu\"))\n    model.add(Dense(5, input_dim=1))\n    return model\n\ninputs = Input(shape=(1, ), name=layer_name_input)\nencoder = get_encoder()\nmodel = encoder(inputs)\nmodel = Activation(\"relu\")(model)\nobjective = Dense(1, name=layer_name_output)(model)\nmodel = Model(inputs=[inputs], outputs=objective)\nmodel.compile(loss='mean_squared_error', optimizer='sgd')\n</code></pre>\n\n<p>EDIT - fixed, it was a problem with exporting from Keras to TF (layer names). Pasting the export here, hopefully helpful for someone else:</p>\n\n<pre><code>def export_to_tf(keras_model_path, export_path, export_version, is_functional=False):\n\n    sess = tf.Session()\n    K.set_session(sess)\n    K.set_learning_phase(0)\n\n    export_path = os.path.join(export_path, str(export_version))\n\n    model = load_model(keras_model_path)\n    config = model.get_config()\n    weights = model.get_weights()\n    if is_functional == True:\n        model = Model.from_config(config)\n    else:\n        model = Sequential.from_config(config)\n    model.set_weights(weights)\n\n    with K.get_session() as sess:\n        inputs = [ (model_input.name.split(\":\")[0], model_input) for model_input in model.inputs]\n        outputs = [ (model_output.name.split(\":\")[0], model_output) for model_output in model.outputs]\n        signature = predict_signature_def(inputs=dict(inputs),\n                                      outputs=dict(outputs))\n        input_descriptor = [ { 'name': item[0], 'shape': item[1].shape.as_list() } for item in inputs]\n        output_descriptor = [ { 'name': item[0], 'shape': item[1].shape.as_list() } for item in outputs]\n        builder = saved_model_builder.SavedModelBuilder(export_path)\n        builder.add_meta_graph_and_variables(\n            sess=sess,\n            tags=[tag_constants.SERVING],\n            signature_def_map={signature_constants.DEFAULT_SERVING_SIGNATURE_DEF_KEY: signature})\n        builder.save()\n\n        descriptor = dict()\n        descriptor[\"inputs\"] = input_descriptor\n        descriptor[\"outputs\"] = output_descriptor\n        pprint.pprint(descriptor)               \n</code></pre>\n"}, {"tags": ["templates", "go"], "comments": [{"owner": {"reputation": 14807, "user_id": 6870228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13425c63b585e3bba05d30509e9e2b00?s=128&d=identicon&r=PG&f=1", "display_name": "Keith", "link": "https://stackoverflow.com/users/6870228/keith"}, "edited": false, "score": 0, "creation_date": 1506852593, "post_id": 46511312, "comment_id": 79976648, "body": "You might want to use a session for this, because what you have done here wouldn&#39;t work multi-user either."}, {"owner": {"reputation": 14807, "user_id": 6870228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13425c63b585e3bba05d30509e9e2b00?s=128&d=identicon&r=PG&f=1", "display_name": "Keith", "link": "https://stackoverflow.com/users/6870228/keith"}, "edited": false, "score": 0, "creation_date": 1506852793, "post_id": 46511312, "comment_id": 79976691, "body": "Have a look here, <a href=\"https://github.com/expressjs/session\" rel=\"nofollow noreferrer\">github.com/expressjs/session</a>  once you have a session handler, you can just do things like -&gt;  <code>req.session.aaa = req.body.aa</code>.."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523798733, "post_id": 46511312, "comment_id": 86699383, "body": "@JennyHilton Are you looking for something like this? <a href=\"https://play.golang.org/p/v65jr0Hr5v2\" rel=\"nofollow noreferrer\">play.golang.org/p/v65jr0Hr5v2</a>"}, {"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523799458, "post_id": 46511312, "comment_id": 86699627, "body": "@mkopriva - Thanks, I need two things 1. generate bash.script with the results of the template 2.  for each entry (type of dependencies) I need to call like echo  api1 and for the second echo api2 , this is in the install object."}, {"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523799579, "post_id": 46511312, "comment_id": 86699671, "body": "@mkopriva - and it should have <code>switch</code> like statment  , like if its <code>runner1</code> call to <code>api1</code> and if it <code>runner2</code> call to` api2`"}, {"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523800185, "post_id": 46511312, "comment_id": 86699896, "body": "@mkopriva - The idea that for dep type <code>&quot;runner1&quot;</code> I need to run several commands and for <code>&quot;runner2&quot;</code> I need to run <code>several different commands </code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523801437, "post_id": 46511312, "comment_id": 86700315, "body": "@JennyHilton I&#39;m still not 100% sure what you mean, but you could have a switch statement inside a method defined on the <code>Dependency</code> type, and based on the value of the <code>Type</code> field the method would return the correct command name and command arguments... Or what you can do to clarify, given the example yaml file, provide the exact bash script you would like the Go program to generate."}, {"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523802409, "post_id": 46511312, "comment_id": 86700609, "body": "@mkopriva - please see my update, let me know if its more clear now"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523803144, "post_id": 46511312, "comment_id": 86700841, "body": "@JennyHilton <a href=\"https://play.golang.org/p/jx_V_62Qu47\" rel=\"nofollow noreferrer\">play.golang.org/p/jx_V_62Qu47</a> ?"}, {"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523803872, "post_id": 46511312, "comment_id": 86701050, "body": "@mkopriva - Much better, i&#39;ll check it deeply and let you know. i&#39;ve currently 2 questions 1. how should I generate a file from the template output 2. assume that I&#39;ve two structs <code>API</code> and <code>Dependency</code> (see my update) , how it should work then ?"}, {"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523803924, "post_id": 46511312, "comment_id": 86701063, "body": "@mkopriva - btw, you can put it as answer ... :)"}, {"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523886301, "post_id": 46511312, "comment_id": 86732472, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/169086/discussion-between-jenny-hilton-and-mkopriva\">continue this discussion in chat</a>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1523891395, "post_id": 46511312, "comment_id": 86736322, "body": "Please read through the docs here: <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">golang.org/pkg/text/template</a> All of your template needs are explained there in clear detail. Please understand that it is important that you put some work into solving the problem yourself. I&#39;m here because i&#39;m trying to help and learn, I&#39;m not here to work for free."}, {"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523946134, "post_id": 46511312, "comment_id": 86757492, "body": "@mkopriva - Well, I did it but some things are not clear to me 100% therefore I put bounty of 100 points...thanks anyhow..."}], "answers": [{"comments": [{"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1524393544, "post_id": 49903901, "comment_id": 86945909, "body": "I wasnt able to test it depely , i&#39;ll give you the points and I&#39;ve sevrel of question hopefully you can assist ...thanks"}, {"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "reply_to_user": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1524400026, "post_id": 49903901, "comment_id": 86947479, "body": "@jennyhilton sure, happy to chat further."}], "tags": [], "owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "is_accepted": false, "score": 2, "last_activity_date": 1524222479, "last_edit_date": 1524222479, "creation_date": 1524066366, "answer_id": 49903901, "question_id": 46511312, "link": "https://stackoverflow.com/questions/46511312/golang-template-with-switch-foreach/49903901#49903901", "title": "Golang template with switch &amp; ForEach", "body": "<p>Some minimal changes to get to working for the above are here:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"text/template\"\n    \"gopkg.in/yaml.v2\"\n    \"os\"\n)\n\ntype File struct {\n    TypeVersion string `yaml:\"_type-version\"`\n    Dependency  []Dependency\n}\n\ntype Dependency struct {\n    Name    string\n    Type    string\n    CWD     string\n    Install []Install\n}\n\ntype Install map[string]string\n\nvar data = `\n_type-version: \"1.0.0\"\ndependency:\n  - name: ui\n    type: runner\n    cwd: /ui\n    install:\n       - name: api\n\n  - name: ui2\n    type: runner2\n    cwd: /ui2\n    install:\n       - name: api2\n\n`\n\nfunc main() {\n    f := File{}\n\n    err := yaml.Unmarshal([]byte(data), &amp;f)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n\n   const t = `\n#!/bin/bash\n\n{{range .Dependency}}\necho \"type is {{.Type}}\"\necho \"cwd is {{.CWD}}\"\n{{range .Install}}\necho \"install {{.name}}\"\n{{end}}\n{{end}}\n`\n\n    tt := template.Must(template.New(\"\").Parse(t))\n    err = tt.Execute(os.Stdout, f)\n    if err != nil {\n        log.Println(\"executing template:\", err)\n    }\n}\n</code></pre>\n\n<p>This produces</p>\n\n<pre><code>$ go run main.go \n\n#!/bin/bash\n\n\necho \"type is runner\"\necho \"cwd is /ui\"\n\necho \"install api\"\n\n\necho \"type is runner2\"\necho \"cwd is /ui2\"\n\necho \"install api2\"\n</code></pre>\n\n<p>The key change is to let the template do the work- use the range function on the Dependency array, and then again on the Install array, to traverse the data structure. </p>\n\n<p>The other change is just to write to stdout, rather than to a file. If it is desirable to turn this into a script, just pipe it to a file. </p>\n\n<p>More broadly, I think there is a tension in the data model around ownership of the install steps. Are the install steps fixed for each runner type? Or may they vary? If they are fixed, then having a map[string][string] of runner type to array of install steps probably makes sense, which would then relieve the Dependency object of having a copy of install steps. </p>\n\n<p>I also wonder about the YAML- is it a source of truth? Or is it derivative? If derivative, perhaps it is unnecessary. Probably better to have the go program interrogate the actual source of truth and generate a script. </p>\n\n<p>In any event, I hope that's helpful. </p>\n"}], "owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 916, "favorite_count": 2, "answer_count": 1, "score": 8, "last_activity_date": 1524222479, "creation_date": 1506852387, "last_edit_date": 1523802385, "question_id": 46511312, "link": "https://stackoverflow.com/questions/46511312/golang-template-with-switch-foreach", "title": "Golang template with switch &amp; ForEach", "body": "<p>I need to create <strong>bash.sh</strong> file from golang program\nwhich should do the following:</p>\n\n<p>Create <strong>ForEach</strong> loop on dependencies and read the type and according to type \nprint different echo message (commands) I need it to work with <strong>switch</strong>\non the <code>type</code> of the dependency with Golang </p>\n\n<p>e.g. something like following</p>\n\n<p>For each dependency entry add the type message of echo</p>\n\n<pre><code>#!/bin/bash\nfor a in $(dependencies.type) \n  echo $runner  //from type \ndone\n</code></pre>\n\n<p>what I did is the following which doesn't work</p>\n\n<ol>\n<li>The idea that for dependencies type <strong>\"runner1\"</strong>(see the type property value in dependency struct instance) I need to run <strong>several commands</strong> and for <strong>\"runner2\"</strong> I need to run <strong>several different commands</strong> </li>\n<li>And those commands (like echo api1 for runner1 etc )above should be written in the bash.script that I need to create from the template </li>\n</ol>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"log\"\n    \"text/template\"\n    \"gopkg.in/yaml.v2\"\n    \"os\"\n)\n\ntype File struct {\n    TypeVersion string `yaml:\"_type-version\"`\n    Dependency  []Dependency\n}\n\ntype Dependency struct {\n    Name    string\n    Type    string\n    CWD     string\n    Install []Install\n}\n\ntype Install map[string]string\n\nvar data = `\n_type-version: \"1.0.0\"\ndependency:\n  - name: ui\n    type: runner\n    cwd: /ui\n    install:\n       - name: api\n\n  - name: ui2\n    type: runner2\n    cwd: /ui2\n    install:\n       - name: api2\n\n`\n\nfunc main() {\n    f := File{}\n\n    err := yaml.Unmarshal([]byte(data), &amp;f)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n\n    d, err := yaml.Marshal(&amp;f)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n    fmt.Printf(\"--- t dump:\\n%s\\n\\n\", string(d))\n\n    wd, _ := os.Getwd()\n\n    newfile, err := os.Create(wd + \"/\" + \"bash.sh\") // Truncates if file already exists\n    if err != nil {\n        fmt.Errorf(\"Failed to create file: %s , %s\", wd+\"/\"+\"bash.sh\", err)\n    }\n\n    fmt.Println(newfile)\n\n    const File = `\n#!/bin/bash\n{{.dependency}},\n{{if .Type runner2}}\n echo \"type is runner2\"\n{{- else}}\necho \"type is %S\"\n{{- end}}\n{{end}}\n`\n\n    t := template.Must(template.New(\"bash.sh\").Parse(File))\n\n    for _, r := range f.Dependency {\n        err := t.Execute(os.Stdout, r)\n        if err != nil {\n            log.Println(\"executing template:\", err)\n        }\n    }\n\n}\n</code></pre>\n\n<p><strong>update</strong></p>\n\n<p>For example </p>\n\n<p>lets say i\u2019ve map like following and the dependencies struct should work with the API struct to know which command to run for each type value</p>\n\n<pre><code>API := map[string]string {\n{\n\u201crunner1\u201d : \u201capi1\u201d,\n},\n{\n\u201crunner2\u201d : \u201capi2\u201d,\n}\n}\n</code></pre>\n\n<p>This is how should the script look like at the end</p>\n\n<pre><code>#bin/bash\n\n// in context of dep1\necho runner1\nsubmitting api1\n\n\n// in context of dep2\necho runner2\nsubmitting api2\n</code></pre>\n"}, {"tags": ["go", "concurrency", "deadlock", "channel"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 7758023, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-FBxuH5ZrMfA/AAAAAAAAAAI/AAAAAAAAQxo/roFSZFV6H8s/photo.jpg?sz=128", "display_name": "Peter Hecht", "link": "https://stackoverflow.com/users/7758023/peter-hecht"}, "is_accepted": false, "score": 0, "last_activity_date": 1518060284, "creation_date": 1518060284, "answer_id": 48677026, "question_id": 46510341, "link": "https://stackoverflow.com/questions/46510341/getting-deadlock-as-i-try-to-emulate-fan-in-fan-out-with-factorial-calculation/48677026#48677026", "title": "Getting deadlock as I try to emulate fan in - fan out with factorial calculations", "body": "<p>I'm no expert in channels. I've taking on this to try and get more familiar with go. \n Another issue is the int isn't large enough to take all factorials over 20 or so. \nAs you can see, I added a defer close as well as a logical channel called done in the generator func. The rest of the changes probably aren't needed.  With channels you need to make sure something is ready to take off a value on the channel when you put something on a channel.  Otherwise deadlock.  Also, using </p>\n\n<blockquote>\n  <p>go run -race main.go </p>\n</blockquote>\n\n<p>helps at least see which line(s) are causing problems. </p>\n\n<p>I hope this helps and isn't removed for being off topic. </p>\n\n<p>I was able to remove the deadlock by doing this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    _gen := generator()\n    _inChannel := _inListener(_gen)\n    for val := range _inChannel {\n        fmt.Print(val, \" -- \\n\")\n    }\n}\n\nfunc generator() chan int { // NEED TO CALCULATE FACTORIAL FOR 100 NUMBERS\n    ch := make(chan int) // CREATE CHANNEL TO INPUT NUMBERS\n    done := make(chan bool)\n    go func() {\n        defer close(ch)\n        for i := 1; i &lt;= 100; i++ {\n            ch &lt;- i\n        }\n        //close(ch) // CLOSE CHANNEL WHEN ALL NUMBERS HAVE BEEN WRITTEM\n        done &lt;- true\n    }()\n\n    // this function will pull off the done for each function call above.\n    go func() {\n        for i := 1; i &lt; 100; i++ {\n            &lt;-done\n        }\n    }()\n\n    return ch\n}\n\nfunc _inListener(ch chan int) chan int {\n    rec := make(chan int) // CHANNEL RECEIVED FROM GENERATOR\n    go func() {\n        for num := range ch { // RECEIVE THE INPUT NUMBERS FROM GENERATOR\n            result := factorial(num) // RESULT IS A NEW CHANNEL CREATED\n            rec &lt;- result            // MERGE INTO A SINGLE CHANNEL; rec\n        }\n        close(rec)\n    }()\n\n    return rec // RETURN THE DEDICATED CHANNEL TO RECEIVE ALL OUTPUTS\n}\n\nfunc factorial(n int) int {\n    // OF FACTORIAL\n    total := 1\n    for i := n; i &gt; 0; i-- {\n        total *= i\n    }\n    return total // RETURN THE CHANNEL HAVING THE FACTORIAL CALCULATED\n}\n</code></pre>\n"}], "owner": {"reputation": 19471, "user_id": 648138, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/gzQEA.jpg?s=128&g=1", "display_name": "Suhail Gupta", "link": "https://stackoverflow.com/users/648138/suhail-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518060284, "creation_date": 1506844438, "last_edit_date": 1506846464, "question_id": 46510341, "link": "https://stackoverflow.com/questions/46510341/getting-deadlock-as-i-try-to-emulate-fan-in-fan-out-with-factorial-calculation", "title": "Getting deadlock as I try to emulate fan in - fan out with factorial calculations", "body": "<p>I am trying the <code>fan in - fan out</code> pattern with a factorial problem. But I am getting:</p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n</code></pre>\n\n<p>and unable to identify the reason for deadlock.</p>\n\n<p>I am trying to concurrently calculate factorial for 100 numbers using the fan-in fan-out pattern.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    _inChannel := _inListener(generator())\n    for val := range _inChannel {\n        fmt.Print(val, \" -- \")\n    }\n}\n\nfunc generator() chan int { // NEED TO CALCULATE FACTORIAL FOR 100 NUMBERS\n    ch := make(chan int) // CREATE CHANNEL TO INPUT NUMBERS\n\n    go func() {\n        for i := 1; i &lt;= 100; i++ {\n            ch &lt;- i\n        }\n        close(ch) // CLOSE CHANNEL WHEN ALL NUMBERS HAVE BEEN WRITTEM\n    }()\n\n    return ch\n}\n\nfunc _inListener(ch chan int) chan int {\n    rec := make(chan int) // CHANNEL RECEIVED FROM GENERATOR\n    go func() {\n        for num := range ch { // RECEIVE THE INPUT NUMBERS FROM GENERATOR\n            result := factorial(num) // RESULT IS A NEW CHANNEL CREATED\n            rec &lt;- &lt;-result // MERGE INTO A SINGLE CHANNEL; rec\n            close(result)\n        }\n        close(rec)\n    }()\n    return rec // RETURN THE DEDICATED CHANNEL TO RECEIVE ALL OUTPUTS\n}\n\nfunc factorial(n int) chan int {\n    ch := make(chan int) // MAKE A NEW CHANNEL TO OUTPUT THE RESULT \n    // OF FACTORIAL\n    total := 1\n    for i := n; i &gt; 0; i-- {\n        total *= i\n    }\n    ch &lt;- total\n    return ch // RETURN THE CHANNEL HAVING THE FACTORIAL CALCULATED\n}\n</code></pre>\n\n<p>I have put in comments, so that it becomes easier to follow the code.</p>\n"}, {"tags": ["performance", "go", "optimization", "io", "get-request"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 4, "creation_date": 1506847143, "post_id": 46510272, "comment_id": 79975331, "body": "One thing I notice is that you don&#39;t close the <code>res.Body</code> after reading from it. This might prevent connection reuse IIRC."}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "edited": false, "score": 2, "creation_date": 1506860260, "post_id": 46510272, "comment_id": 79978661, "body": "Data race condition alert. You share buf []byte across 800 goroutines which  lead to concurent r/w. Slices and maps are not safe for concurent r/w. &amp;buf is also useless because slice is always passed by pointer."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1506862523, "post_id": 46510272, "comment_id": 79979258, "body": "Trying to download the same page with 800 concurrent connections is rarely going to be faster. Limit your connections and reuse them."}, {"owner": {"reputation": 95, "user_id": 3521339, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/FmOYe.png?s=128&g=1", "display_name": "Maximus12793", "link": "https://stackoverflow.com/users/3521339/maximus12793"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506884922, "post_id": 46510272, "comment_id": 79985972, "body": "@JimB could you show an example of what you mean? Does this mean creating a new client every n times rather than w/ each function call?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506948886, "post_id": 46510272, "comment_id": 80005684, "body": "@Maximus12793: No, I mean don&#39;t open 800 <i>concurrent</i> connections. Use a small worker pool, or a semaphore, or don&#39;t fetch the same thing 800 times. You have to test what the optimal concurrency is for your upstream connection and latency, probably somewhere between 1 and 20. If you&#39;re only trying to contact a single host, make sure the http transport is going to maintain enough connections for your desired concurrency."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506950148, "post_id": 46510272, "comment_id": 80006414, "body": "http.Client maintains a connection pool automatically (with the default transport anyway), so no, do not create multiple clients. However, you have to close the response body when you&#39;re done with it, otherwise the connection cannot be reused. And as bigless mentioned, don&#39;t share the buffer. io.Copy is pretty smart and usually does the Right Thing."}, {"owner": {"reputation": 95, "user_id": 3521339, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/FmOYe.png?s=128&g=1", "display_name": "Maximus12793", "link": "https://stackoverflow.com/users/3521339/maximus12793"}, "edited": false, "score": 0, "creation_date": 1506971673, "post_id": 46510272, "comment_id": 80018996, "body": "Ok great so really I am just running up against the syscall copy limit right? Just want to make sure there are no other tricks I can do like pre-allocate space for the biggest file size or disable gc etc."}], "owner": {"reputation": 95, "user_id": 3521339, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/FmOYe.png?s=128&g=1", "display_name": "Maximus12793", "link": "https://stackoverflow.com/users/3521339/maximus12793"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 360, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1506857545, "creation_date": 1506843723, "last_edit_date": 1506857545, "question_id": 46510272, "link": "https://stackoverflow.com/questions/46510272/golang-speeding-up-response-writing-time", "title": "golang speeding up response writing time?", "body": "<pre><code>func grabPage(i int, wg *sync.WaitGroup, buf *[]byte) {\n    defer wg.Done()\n    res, err := http.Get(\"https://en.wikipedia.org/wiki/Immanuel_Kant\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    f, err := os.Create(fmt.Sprintf(\"./data/%d.txt\", i))\n    if err != nil {\n        log.Fatal(err)\n    }\n    _, err = io.CopyBuffer(f, res.Body, *buf)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc main() {\n    f, _ := os.Create(\"cpuprofile\")\n\n    pprof.StartCPUProfile(f)\n    defer pprof.StopCPUProfile()\n    runtime.GOMAXPROCS(4)\n    start := time.Now()\n    var wg sync.WaitGroup\n    total := 800\n\n    var buf []byte\n    wg.Add(total)\n    for index := 0; index &lt; total; index++ {\n        go grabPage(index, &amp;wg, &amp;buf)\n    }\n    wg.Wait()\n    elapsed := time.Since(start)\n    log.Printf(\"took %s\", elapsed)\n}\n</code></pre>\n\n<p>I have a toy program and am simply grabbing an http request and writing it to a file. wget shows a latency of .2s and I am wondering how to get closer to this sort of speed (if possible). I have tried <code>io.copy</code>,<code>fasthttp</code>, <code>bufio</code> stream readers etc. which all were slower than the above. I just want to make sure there is nothing obvious I am missing that could speed this up as I am very new to Go. I liked fasthttp's concept of reading directly to a buffer but I think I mimicked that via io.CopyBuffer. here are my proff results :/</p>\n\n<pre><code>     0     0%     0%      6.78s 68.00%  io.CopyBuffer /usr/local/opt/go/libexec/src/io/io.go\n     0     0%     0%      6.78s 68.00%  io.copyBuffer /usr/local/opt/go/libexec/src/io/io.go\n     0     0%     0%      5.44s 54.56%  net/http.(*http2gzipReader).Read /usr/local/opt/go/libexec/src/net/http/h2_bundle.go\n     0     0%     0%      5.41s 54.26%  compress/gzip.(*Reader).Read /usr/local/opt/go/libexec/src/compress/gzip/gunzip.go\n     0     0%     0%      5.35s 53.66%  compress/flate.(*decompressor).Read /usr/local/opt/go/libexec/src/compress/flate/inflate.go\n 0.92s  9.23%  9.23%      5.20s 52.16%  compress/flate.(*decompressor).huffmanBlock /usr/local/opt/go/libexec/src/compress/flate/inflate.go\n 2.97s 29.79% 39.02%      2.99s 29.99%  syscall.Syscall /usr/local/opt/go/libexec/src/syscall/asm_darwin_amd64.s\n 0.01s   0.1% 39.12%      2.59s 25.98%  internal/poll.(*FD).Write /usr/local/opt/go/libexec/src/internal/poll/fd_unix.go\n 1.02s 10.23% 49.35%      2.53s 25.38%  compress/flate.(*decompressor).huffSym /usr/local/opt/go/libexec/src/compress/flate/inflate.go\n</code></pre>\n"}, {"tags": ["mysql", "docker", "go", "docker-compose"], "answers": [{"comments": [{"owner": {"reputation": 3788, "user_id": 5079239, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8dcb1db087404704ae6b98f774488940?s=128&d=identicon&r=PG&f=1", "display_name": "blacklabelops", "link": "https://stackoverflow.com/users/5079239/blacklabelops"}, "edited": false, "score": 1, "creation_date": 1506851240, "post_id": 46510481, "comment_id": 79976264, "body": "He also needs to give the container the name <code>db</code>, otherwise the container will not be available with the name <code>db</code> on the Docker network. <code>container_name: db</code>."}, {"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "reply_to_user": {"reputation": 3788, "user_id": 5079239, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8dcb1db087404704ae6b98f774488940?s=128&d=identicon&r=PG&f=1", "display_name": "blacklabelops", "link": "https://stackoverflow.com/users/5079239/blacklabelops"}, "edited": false, "score": 0, "creation_date": 1506851409, "post_id": 46510481, "comment_id": 79976298, "body": "@maybeg, by default service name is discoverable inside a compose network. So you don&#39;t need  <code>container_name: db</code> And since his service name is already <code>db</code> this is not needed at all. Also better option in such cases is to use network aliases rather then changing container names"}, {"owner": {"reputation": 3788, "user_id": 5079239, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8dcb1db087404704ae6b98f774488940?s=128&d=identicon&r=PG&f=1", "display_name": "blacklabelops", "link": "https://stackoverflow.com/users/5079239/blacklabelops"}, "edited": false, "score": 0, "creation_date": 1506852700, "post_id": 46510481, "comment_id": 79976674, "body": "Thank you! That will improve my configurations as well!"}, {"owner": {"reputation": 663, "user_id": 2901304, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/58a98883c95278f89a4d0dcbce619d6a?s=128&d=identicon&r=PG&f=1", "display_name": "user2901304", "link": "https://stackoverflow.com/users/2901304/user2901304"}, "edited": false, "score": 0, "creation_date": 1506882368, "post_id": 46510481, "comment_id": 79985111, "body": "I added the host to the connection string and attempted to use that wait for it library but its still failing. If its not too much to ask could you see my implementation <a href=\"https://github.com/bliitzkrieg/go-sql-testing/commit/125ab7a232ef226098f3509f258a064392f37bf6\" rel=\"nofollow noreferrer\">github.com/bliitzkrieg/go-sql-testing/commit/&hellip;</a> and let me know where I am going wrong"}, {"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "reply_to_user": {"reputation": 663, "user_id": 2901304, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/58a98883c95278f89a4d0dcbce619d6a?s=128&d=identicon&r=PG&f=1", "display_name": "user2901304", "link": "https://stackoverflow.com/users/2901304/user2901304"}, "edited": false, "score": 0, "creation_date": 1506937842, "post_id": 46510481, "comment_id": 80000313, "body": "@user2901304, you use <code>wait-for-it.sh</code> not during the build but when the container is run. You should remove the <code>RUN .&#47;wait...</code> and <code>ENTRYPOINT ...</code> and use <code>CMD .&#47;wait-for-it&#47;wait-for-it.sh --host=db --port=3306 --timeout=60 -- &#47;go&#47;src&#47;bin&#47;main</code>. I checked and it works fine for me"}], "tags": [], "owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "is_accepted": true, "score": 3, "last_activity_date": 1506937918, "last_edit_date": 1506937918, "creation_date": 1506845674, "answer_id": 46510481, "question_id": 46510166, "link": "https://stackoverflow.com/questions/46510166/docker-application-container-wont-communicate-with-my-mysql-container/46510481#46510481", "title": "Docker application container wont communicate with my MySQL container", "body": "<p>Two issues in your code. One is the </p>\n\n<pre><code>a.Initialize(\n    os.Getenv(\"APP_DB_USERNAME\"),\n    os.Getenv(\"APP_DB_PASSWORD\"),\n    os.Getenv(\"APP_DB_NAME\"))\n</code></pre>\n\n<p>You have not used <code>APP_DB_HOST</code> to initialize DB, so you are going to localhost directly.</p>\n\n<p>Second you are connecting to the DB at the start of the program and it takes sometime for the DB to actually get UP. So you need to have some retry and timeout either in your code, or you should wait for the DB to get up and then run the main command. </p>\n\n<p>See <a href=\"https://github.com/vishnubob/wait-for-it\" rel=\"nofollow noreferrer\">https://github.com/vishnubob/wait-for-it</a> a bash script which can be used in container to wait for mysql db to get up and then run the main program</p>\n\n<p><strong>Edit-1: Updated dockerfile</strong></p>\n\n<p>Below is a updated dockerfile for your github repo <a href=\"https://github.com/bliitzkrieg/go-sql-testing/\" rel=\"nofollow noreferrer\">https://github.com/bliitzkrieg/go-sql-testing/</a></p>\n\n<pre><code>FROM golang\nADD . /go/src\nWORKDIR /go/src\n\nRUN go get github.com/go-sql-driver/mysql\nRUN go get github.com/gorilla/mux\nRUN go build -o bin/main main.go app.go model.go\nRUN git clone https://github.com/vishnubob/wait-for-it.git\n\nCMD ./wait-for-it/wait-for-it.sh --host=db --port=3306 --timeout=60 -- /go/src/bin/main\n\nEXPOSE 8080\n</code></pre>\n"}], "owner": {"reputation": 663, "user_id": 2901304, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/58a98883c95278f89a4d0dcbce619d6a?s=128&d=identicon&r=PG&f=1", "display_name": "user2901304", "link": "https://stackoverflow.com/users/2901304/user2901304"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 662, "favorite_count": 0, "accepted_answer_id": 46510481, "answer_count": 1, "score": 3, "last_activity_date": 1506937918, "creation_date": 1506842709, "question_id": 46510166, "link": "https://stackoverflow.com/questions/46510166/docker-application-container-wont-communicate-with-my-mysql-container", "title": "Docker application container wont communicate with my MySQL container", "body": "<p>I am using docker compose to put together two containers to help better familiarize myself with docker and I can't seem to figure out why my two containers can't communicate with each other.</p>\n\n<p>My dockerfile for my app is:</p>\n\n<pre><code>FROM golang\nADD . /go/src\nWORKDIR /go/src\n\nRUN go get github.com/go-sql-driver/mysql\nRUN go get github.com/gorilla/mux\nRUN go build -o bin/main main.go app.go model.go\n\nENTRYPOINT /go/src/bin/main\n\nEXPOSE 8080\n</code></pre>\n\n<p>and my docker-compose.yml is</p>\n\n<pre><code>version: '3'\n\nservices:\n  db:\n    image: mysql:5.7\n    volumes:\n      - db_data:/var/lib/mysql\n    restart: always\n    ports:\n      - \"3306:3306\"\n    expose:\n      - \"3306\"\n    environment:\n      MYSQL_ROOT_PASSWORD: testrootpassword\n      MYSQL_DATABASE: testing\n      MYSQL_USER: testuser\n      MYSQL_PASSWORD: testpassword\n\n  api:\n    depends_on:\n      - db\n    build: .\n    ports:\n      - \"8080:8080\"\n    # restart: always\n    environment:\n      APP_DB_HOST: db:3306\n      APP_DB_NAME: testing\n      APP_DB_USERNAME: testuser\n      APP_DB_PASSWORD: testpassword\nvolumes:\n  db_data:\n</code></pre>\n\n<p>The main app just starts a server on port 8080 and <em>tries</em> to establish a connection to SQL. The full implementation is here: <a href=\"https://github.com/bliitzkrieg/go-sql-testing\" rel=\"nofollow noreferrer\">https://github.com/bliitzkrieg/go-sql-testing</a></p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n)\n\nfunc main() {\n    a := App{}\n    a.Initialize(\n        os.Getenv(\"APP_DB_USERNAME\"),\n        os.Getenv(\"APP_DB_PASSWORD\"),\n        os.Getenv(\"APP_DB_NAME\"))\n\n    a.Run(\":8080\")\n}\n</code></pre>\n\n<p>app.go</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"strconv\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n    \"github.com/gorilla/mux\"\n)\n\ntype App struct {\n    Router *mux.Router\n    DB     *sql.DB\n}\n\nfunc (a *App) Initialize(user, password, dbname string) {\n    connectionString :=\n        fmt.Sprintf(\"%s:%s@/%s\", user, password, dbname)\n\n    var err error\n    a.DB, err = sql.Open(\"mysql\", connectionString)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    a.ensureTableExists()\n    a.Router = mux.NewRouter()\n    a.initializeRoutes()\n}\n\nfunc (a *App) ensureTableExists() {\n    if _, err := a.DB.Exec(tableCreationQuery); err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc (a *App) Run(addr string) {\n    log.Fatal(http.ListenAndServe(\":8080\", a.Router))\n}\n\nfunc (a *App) initializeRoutes() {\n    a.Router.HandleFunc(\"/\", a.sayHello).Methods(\"GET\")\n    a.Router.HandleFunc(\"/products\", a.getProducts).Methods(\"GET\")\n    a.Router.HandleFunc(\"/product\", a.createProduct).Methods(\"POST\")\n    a.Router.HandleFunc(\"/product/{id:[0-9]+}\", a.getProduct).Methods(\"GET\")\n    a.Router.HandleFunc(\"/product/{id:[0-9]+}\", a.updateProduct).Methods(\"PUT\")\n    a.Router.HandleFunc(\"/product/{id:[0-9]+}\", a.deleteProduct).Methods(\"DELETE\")\n}\n\nfunc (a *App) sayHello(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello Luca!\")\n}\n\nfunc (a *App) getProduct(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n    id, err := strconv.Atoi(vars[\"id\"])\n    if err != nil {\n        respondWithError(w, http.StatusBadRequest, \"Invalid product ID\")\n        return\n    }\n\n    p := product{ID: id}\n    if err := p.getProduct(a.DB); err != nil {\n        switch err {\n        case sql.ErrNoRows:\n            respondWithError(w, http.StatusNotFound, \"Product not found\")\n        default:\n            respondWithError(w, http.StatusInternalServerError, err.Error())\n        }\n        return\n    }\n\n    respondWithJSON(w, http.StatusOK, p)\n}\n\nfunc (a *App) getProducts(w http.ResponseWriter, r *http.Request) {\n    products, err := getProducts(a.DB)\n    if err != nil {\n        respondWithError(w, http.StatusInternalServerError, err.Error())\n        return\n    }\n\n    respondWithJSON(w, http.StatusOK, products)\n}\n\nfunc (a *App) createProduct(w http.ResponseWriter, r *http.Request) {\n    var p product\n    decoder := json.NewDecoder(r.Body)\n    if err := decoder.Decode(&amp;p); err != nil {\n        respondWithError(w, http.StatusBadRequest, \"Invalid request payload\")\n        return\n    }\n    defer r.Body.Close()\n\n    if err := p.createProduct(a.DB); err != nil {\n        respondWithError(w, http.StatusInternalServerError, err.Error())\n        return\n    }\n\n    respondWithJSON(w, http.StatusCreated, p)\n}\n\nfunc (a *App) updateProduct(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n    id, err := strconv.Atoi(vars[\"id\"])\n    if err != nil {\n        respondWithError(w, http.StatusBadRequest, \"Invalid product ID\")\n        return\n    }\n\n    var p product\n    decoder := json.NewDecoder(r.Body)\n    if err := decoder.Decode(&amp;p); err != nil {\n        respondWithError(w, http.StatusBadRequest, \"Invalid resquest payload\")\n        return\n    }\n    defer r.Body.Close()\n    p.ID = id\n\n    if err := p.updateProduct(a.DB); err != nil {\n        respondWithError(w, http.StatusInternalServerError, err.Error())\n        return\n    }\n\n    respondWithJSON(w, http.StatusOK, p)\n}\n\nfunc (a *App) deleteProduct(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n    id, err := strconv.Atoi(vars[\"id\"])\n    if err != nil {\n        respondWithError(w, http.StatusBadRequest, \"Invalid Product ID\")\n        return\n    }\n\n    p := product{ID: id}\n    if err := p.deleteProduct(a.DB); err != nil {\n        respondWithError(w, http.StatusInternalServerError, err.Error())\n        return\n    }\n\n    respondWithJSON(w, http.StatusOK, map[string]string{\"result\": \"success\"})\n}\n\nfunc respondWithError(w http.ResponseWriter, code int, message string) {\n    respondWithJSON(w, code, map[string]string{\"error\": message})\n}\n\nfunc respondWithJSON(w http.ResponseWriter, code int, payload interface{}) {\n    response, _ := json.Marshal(payload)\n\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.WriteHeader(code)\n    w.Write(response)\n}\n\nconst tableCreationQuery = `CREATE TABLE IF NOT EXISTS products\n(\nid SERIAL,\nname TEXT NOT NULL,\nprice NUMERIC(10,2) NOT NULL DEFAULT 0.00,\nCONSTRAINT products_pkey PRIMARY KEY (id)\n)`\n</code></pre>\n\n<p>To run the application I am using the docker command <code>docker-compose up -d --build</code> which builds the application fine. When I run <code>docker ps</code> it shows only my SQL server is up and when I look at the logs of my api container, it shows one line saying <code>2017/10/01 06:54:14 dial tcp 127.0.0.1:3306: getsockopt: connection refused</code>. I ran the application locally with the hard coded connection string and it worked fine. I am not really sure whats going on so hopefully somebody can help me out!</p>\n\n<p>Cheers!</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506956172, "post_id": 46510146, "comment_id": 80010394, "body": "The context.WithDeadline call can be simplified to context.WithTimeout(context.Background(), 100*time.Millisecond)"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507009597, "post_id": 46510146, "comment_id": 80030114, "body": "@Peter: <code>WithTimeout</code> itself calls <code>WithDeadline</code> see inside: <code>func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc) { \treturn WithDeadline(parent, time.Now().Add(timeout)) }</code>"}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 2, "last_activity_date": 1506843073, "last_edit_date": 1506843073, "creation_date": 1506842563, "answer_id": 46510146, "question_id": 46509979, "link": "https://stackoverflow.com/questions/46509979/golang-waitgroup-timeout-error-handling/46510146#46510146", "title": "Golang WaitGroup Timeout Error handling", "body": "<p>nice way is to use <code>context.WithDeadline</code>:  </p>\n\n<blockquote>\n<pre><code>// WithDeadline returns a copy of the parent context with the deadline adjusted\n// to be no later than d. If the parent's deadline is already earlier than d,\n// WithDeadline(parent, d) is semantically equivalent to parent. The returned\n// context's Done channel is closed when the deadline expires, when the returned\n// cancel function is called, or when the parent context's Done channel is\n// closed, whichever happens first.\n//\n// Canceling this context releases resources associated with it, so code should\n// call cancel as soon as the operations running in this Context complete.\n</code></pre>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    ctx, cancel := context.WithDeadline(context.Background(), time.Now().Add(100*time.Millisecond))\n\n    // Even though ctx will be expired, it is good practice to call its\n    // cancelation function in any case. Failure to do so may keep the\n    // context and its parent alive longer than necessary.\n    defer cancel()\n\n    select {\n    case &lt;-time.After(1 * time.Second):\n        fmt.Println(\"overslept\")\n    case &lt;-ctx.Done():\n        fmt.Println(ctx.Err())\n    }\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 38497, "user_id": 104014, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3d186f3c6ad2de59b356c1cfad9af404?s=128&d=identicon&r=PG", "display_name": "Artem Barger", "link": "https://stackoverflow.com/users/104014/artem-barger"}, "is_accepted": false, "score": 0, "last_activity_date": 1506842591, "creation_date": 1506842591, "answer_id": 46510151, "question_id": 46509979, "link": "https://stackoverflow.com/questions/46509979/golang-waitgroup-timeout-error-handling/46510151#46510151", "title": "Golang WaitGroup Timeout Error handling", "body": "<p>You can use <a href=\"https://blog.golang.org/context\" rel=\"nofollow noreferrer\">Context</a>, in the following way:</p>\n\n<pre><code>func doWork(ctx context.Context, element Element, wg &amp;sync.WaitGroup) {\n    defer wg.Done()\n\n    done := make(chan struct{})\n    go func() {\n       // do some work on element\n       done &lt;- struct{}{} // signal work is done\n    }\n\n    select {\n       case &lt;- done: \n       { \n          // work completed in time\n       }\n       case &lt;- ctx.Done:\n       {\n         // timeout reached\n       }\n    }\n}\n\ncontexts := make([]*context.Context, len(elements))\n\nfor _, element:= range elements{\n    wg.Add(1)\n    ctx, cancel := context.WithTimeout(context.Background(), 1*time.Second)\n    defer cancel()\n    contexts = append(contexts, ctx)\n    go doWork(ctx, element, &amp;wg)\n}\nwg.Wait()\n\nfor i, ctx := range contexts {\n  if ctx.Err() {\n     fmt.Println(\"Go routine \", i, \"canceled due to\", ctx.Err())\n  }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506956101, "post_id": 46511560, "comment_id": 80010332, "body": "The context.WithDeadline call can be simplified to <code>context.WithTimeout(context.Background(), 10*time.Second)</code>."}], "tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": false, "score": 1, "last_activity_date": 1604939382, "last_edit_date": 1604939382, "creation_date": 1506854357, "answer_id": 46511560, "question_id": 46509979, "link": "https://stackoverflow.com/questions/46509979/golang-waitgroup-timeout-error-handling/46511560#46511560", "title": "Golang WaitGroup Timeout Error handling", "body": "<p>I indeed had the same question and came up with this approach:</p>\n<p><a href=\"https://play.golang.org/p/9F9T_sYIof\" rel=\"nofollow noreferrer\">https://play.golang.org/p/9F9T_sYIof</a></p>\n<p>Using: <code>context.WithTimeout(context.Background(), 10*time.Second)</code>:</p>\n<p><a href=\"https://play.golang.org/p/WK0ebe0c9t\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WK0ebe0c9t</a></p>\n<p>Don't know if is the proper way of doing it but is working:</p>\n<pre><code>package main\n\nimport (\n    &quot;context&quot;\n    &quot;fmt&quot;\n    &quot;sync&quot;\n    &quot;time&quot;\n)\n\nfunc doWork(element int, wg *sync.WaitGroup) {\n    ctx, cancel := context.WithDeadline(context.Background(), time.Now().Add(10*time.Second))\n    defer cancel()\n\n    ch := make(chan struct{})\n\n    go func() {\n        time.Sleep(time.Second)\n        fmt.Printf(&quot;element = %+v\\n&quot;, element)\n        ch &lt;- struct{}{}\n    }()\n\n    select {\n    case &lt;-ch:\n    case &lt;-ctx.Done():\n        fmt.Println(ctx.Err())\n    }\n    wg.Done()\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n\n    elements := []int{1, 2, 3}\n\n    for _, element := range elements {\n        wg.Add(1)\n        go doWork(element, &amp;wg)\n    }\n    wg.Wait()\n}\n</code></pre>\n<p>Notice the goroutine within the <code>doWork</code> function:</p>\n<pre><code>go func(ch chan struct{}) {\n   // your code logic goes here\n}(ch)\n</code></pre>\n<p>That's the part that I don't know if is the best way of doing it,  but seems to be the pattern to follow when using context mainly when want to deal with the <code>ctx.Done()</code></p>\n"}], "owner": {"reputation": 4501, "user_id": 1291235, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f4e8c04e8802c3ac4e53c5fa790e0b57?s=128&d=identicon&r=PG", "display_name": "Moonlit", "link": "https://stackoverflow.com/users/1291235/moonlit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2459, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1604939382, "creation_date": 1506841029, "question_id": 46509979, "link": "https://stackoverflow.com/questions/46509979/golang-waitgroup-timeout-error-handling", "title": "Golang WaitGroup Timeout Error handling", "body": "<p>In the following code, how can I add proper timeout error handling in case one of the launched go routines takes too long (e.g. > 10 sec) to finish? Note, that I do not want to have an \"overall\" timeout but a timeout for each go routine, so that I can also know which go routine timed out in my error report. </p>\n\n<pre><code>var wg sync.WaitGroup\n\nfor _, element:= range elements{\n    wg.Add(1)\n    go doWork(element, &amp;wg)\n}\nwg.Wait()\n</code></pre>\n\n<p>kind regards</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6606, "user_id": 4135670, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mArsS.jpg?s=128&g=1", "display_name": "Rafael", "link": "https://stackoverflow.com/users/4135670/rafael"}, "edited": false, "score": 0, "creation_date": 1506831058, "post_id": 46509068, "comment_id": 79972479, "body": "im not an avid go programmer, but it seems that you are writing anti-pattern code."}, {"owner": {"reputation": 121, "user_id": 4893819, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/69b691a83e3cba77791ce38097b53402?s=128&d=identicon&r=PG&f=1", "display_name": "Feanon", "link": "https://stackoverflow.com/users/4893819/feanon"}, "reply_to_user": {"reputation": 6606, "user_id": 4135670, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mArsS.jpg?s=128&g=1", "display_name": "Rafael", "link": "https://stackoverflow.com/users/4135670/rafael"}, "edited": false, "score": 0, "creation_date": 1506831338, "post_id": 46509068, "comment_id": 79972515, "body": "@Rafael it did not help :)"}, {"owner": {"reputation": 6606, "user_id": 4135670, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mArsS.jpg?s=128&g=1", "display_name": "Rafael", "link": "https://stackoverflow.com/users/4135670/rafael"}, "edited": false, "score": 1, "creation_date": 1506831390, "post_id": 46509068, "comment_id": 79972525, "body": "check out <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">pipeline</a> models in go. you should almost <i>never</i> call sleep in a go routine."}], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 4893819, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/69b691a83e3cba77791ce38097b53402?s=128&d=identicon&r=PG&f=1", "display_name": "Feanon", "link": "https://stackoverflow.com/users/4893819/feanon"}, "edited": false, "score": 0, "creation_date": 1506835040, "post_id": 46509413, "comment_id": 79972992, "body": "Thanks for the answer. If I add &quot;sleep&quot; time.Sleep (100 * time.Second) after &quot;fmt.Println (&quot; second job: &quot;, d)&quot; then I get: first job: 1, first job: 3 (?), Second job : 2. I would like to see: first job: 1, first job: 3, second job 2, first job 5, first job 7 etc. Your example has the same problem as mine."}, {"owner": {"reputation": 121, "user_id": 4893819, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/69b691a83e3cba77791ce38097b53402?s=128&d=identicon&r=PG&f=1", "display_name": "Feanon", "link": "https://stackoverflow.com/users/4893819/feanon"}, "edited": false, "score": 0, "creation_date": 1506835483, "post_id": 46509413, "comment_id": 79973070, "body": "I need the data in both structures to be the same. In the first there was 1,2,3,4 and in the second 1,2,3,4. With a long second processing, so that the former still receives data, when the second processes a long process, it continues to execute further. First: 1,2,3,4,5. Second: 1,2 (sleep), 3,4,5. Thank you for your help!"}, {"owner": {"reputation": 121, "user_id": 4893819, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/69b691a83e3cba77791ce38097b53402?s=128&d=identicon&r=PG&f=1", "display_name": "Feanon", "link": "https://stackoverflow.com/users/4893819/feanon"}, "edited": false, "score": 0, "creation_date": 1506835824, "post_id": 46509413, "comment_id": 79973131, "body": "Commented the condition in a loop and it seems to be good. But... I looped up to 100 in the data place in the array, and I again got the lock on the first channel."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 121, "user_id": 4893819, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/69b691a83e3cba77791ce38097b53402?s=128&d=identicon&r=PG&f=1", "display_name": "Feanon", "link": "https://stackoverflow.com/users/4893819/feanon"}, "edited": false, "score": 0, "creation_date": 1506836232, "post_id": 46509413, "comment_id": 79973195, "body": "use buffered channel. you need to elaborate, your question is not clear. edit your question  add sample &amp; output."}, {"owner": {"reputation": 121, "user_id": 4893819, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/69b691a83e3cba77791ce38097b53402?s=128&d=identicon&r=PG&f=1", "display_name": "Feanon", "link": "https://stackoverflow.com/users/4893819/feanon"}, "edited": false, "score": 0, "creation_date": 1506836775, "post_id": 46509413, "comment_id": 79973286, "body": "Posted by. Look here please."}, {"owner": {"reputation": 121, "user_id": 4893819, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/69b691a83e3cba77791ce38097b53402?s=128&d=identicon&r=PG&f=1", "display_name": "Feanon", "link": "https://stackoverflow.com/users/4893819/feanon"}, "edited": false, "score": 0, "creation_date": 1506838883, "post_id": 46509413, "comment_id": 79973681, "body": "The solution works as it should! But without using the indication of the buffer is not how? I can not know how much data will be written. After all, when the 1000 mark is reached, the process will stop again ... How to be in this case? And can I somehow close the channel when I reach a certain amount of data in the buffer?"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 121, "user_id": 4893819, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/69b691a83e3cba77791ce38097b53402?s=128&d=identicon&r=PG&f=1", "display_name": "Feanon", "link": "https://stackoverflow.com/users/4893819/feanon"}, "edited": false, "score": 0, "creation_date": 1506839053, "post_id": 46509413, "comment_id": 79973720, "body": "so increase your channel buffer size"}, {"owner": {"reputation": 121, "user_id": 4893819, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/69b691a83e3cba77791ce38097b53402?s=128&d=identicon&r=PG&f=1", "display_name": "Feanon", "link": "https://stackoverflow.com/users/4893819/feanon"}, "edited": false, "score": 0, "creation_date": 1506854759, "post_id": 46509413, "comment_id": 79977213, "body": "I understood, thanks for the help. I read <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">blog.golang.org/pipelines</a> and it says that you can use data that can be written / read. Is there still no solution? I used <a href=\"https://gist.github.com/moraes/2141121\" rel=\"nofollow noreferrer\">gist.github.com/moraes/2141121</a> to write data, and I read the data in a separate thread. But my processor is very loaded with this solution, but it looks more elegant."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 121, "user_id": 4893819, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/69b691a83e3cba77791ce38097b53402?s=128&d=identicon&r=PG&f=1", "display_name": "Feanon", "link": "https://stackoverflow.com/users/4893819/feanon"}, "edited": false, "score": 1, "creation_date": 1506855582, "post_id": 46509413, "comment_id": 79977441, "body": "with data you provided i can&#39;t help more,  it seems you need some algorithms for your problem,  for better help here in Stackoverflow, it is better to ask One question per thread as simple as possible. and provide each Question with your sample input and output."}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 1, "last_activity_date": 1506837466, "last_edit_date": 1506837466, "creation_date": 1506834559, "answer_id": 46509413, "question_id": 46509068, "link": "https://stackoverflow.com/questions/46509068/asynchronous-queues-with-serial-data-for-several-channels/46509413#46509413", "title": "Asynchronous queues with serial data for several channels", "body": "<p>It seems you need two separate buffered channels, <a href=\"https://play.golang.org/p/9hVAqT_imY\" rel=\"nofollow noreferrer\">like so</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    wg.Add(2)\n    go first()\n    go second()\n    for i := 1; i &lt; 10; i++ {\n        a &lt;- i // send to first\n        b &lt;- i // send to second\n    }\n    close(a)\n    close(b)\n    wg.Wait()\n}\n\nfunc first() {\n    for {\n        d, ok := &lt;-a\n        time.Sleep(100 * time.Millisecond)\n        if !ok {\n            break\n        }\n        fmt.Println(\"first job:\", d) // do first job here.\n    }\n    wg.Done()\n}\n\nfunc second() {\n    for {\n        d, ok := &lt;-b\n        time.Sleep(300 * time.Millisecond)\n        if !ok {\n            break\n        }\n        fmt.Println(\"second job:\", d) // do second job here.\n    }\n    wg.Done()\n}\n\nvar a = make(chan int, 1000)\nvar b = make(chan int, 1000)\nvar wg sync.WaitGroup\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>first job: 1\nfirst job: 2\nsecond job: 1\nfirst job: 3\nfirst job: 4\nfirst job: 5\nsecond job: 2\nfirst job: 6\nfirst job: 7\nfirst job: 8\nsecond job: 3\nfirst job: 9\nsecond job: 4\nsecond job: 5\nsecond job: 6\nsecond job: 7\nsecond job: 8\nsecond job: 9\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 4893819, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/69b691a83e3cba77791ce38097b53402?s=128&d=identicon&r=PG&f=1", "display_name": "Feanon", "link": "https://stackoverflow.com/users/4893819/feanon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1506837466, "creation_date": 1506830322, "last_edit_date": 1506836674, "question_id": 46509068, "link": "https://stackoverflow.com/questions/46509068/asynchronous-queues-with-serial-data-for-several-channels", "title": "Asynchronous queues with serial data for several channels", "body": "<p>There was a problem ... I have three structures that implement one interface. I have a function that processes the structure data, but it happens that the processing of the data for some structure can take a few seconds. Data must be processed sequentially.</p>\n\n<p>I did it this way:</p>\n\n<pre><code>type dater struct {\n    value int\n}\n\ntype waiter struct {\n    data chan *dater\n}\n\nfunc (dat *waiter) conf(wait bool) {\n    go func() {\n        for {\n            obj := &lt;-dat.data\n            if wait {\n                time.Sleep(5 * time.Second)\n            }\n            fmt.Println(\"WAIT\", wait, *obj)\n        }\n    }()\n}\n\nfunc (dat *waiter) gowrite(w *dater) {\n    dat.data &lt;- w\n}\n\nfunc main() {\n    waiters := []*waiter{}\n\n    first := &amp;waiter{data: make(chan *dater)}\n    first.conf(false)\n    waiters = append(waiters, first)\n\n    second := &amp;waiter{data: make(chan *dater)}\n    second.conf(true)\n    waiters = append(waiters, second)\n\n    for i := 0; i &lt; 30; i++ {\n        for _, wait := range waiters {\n            wait.gowrite(&amp;dater{value: i})\n        }\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>WAIT false {0}\nWAIT false {1}\nWAIT true {0} (SLEEP 5 sec)\nWAIT false {2} (will appear after 5 seconds)\nWAIT true {1}\nWAIT false {3}\nWAIT true {2}\nWAIT false {4}\nWAIT true {3}\nWAIT false {5}\n</code></pre>\n\n<p>I want:</p>\n\n<pre><code>WAIT false {0}\nWAIT false {1}\nWAIT false {2}\nWAIT false {3}\nWAIT false {4}\nWAIT false {5}\nWAIT true {0} (5 seconds have passed and we show the first message)\nWAIT true {1} (This message will appear after 5 seconds)\nWAIT true {2}\nWAIT true {3}\n</code></pre>\n\n<p>The \"gowrite\" function of the \"second\" structure waits until the channel of the structure \"first\" receives the data. But it's important for me that they process the data asynchronously without blocking each other. In this case, all channels receive the correct data.</p>\n"}, {"tags": ["database", "generics", "go", "reflection", "go-interface"], "comments": [{"owner": {"reputation": 4676, "user_id": 454646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dcd9862c0c73c0eb1465d20668b4e55?s=128&d=identicon&r=PG", "display_name": "Michael Banzon", "link": "https://stackoverflow.com/users/454646/michael-banzon"}, "edited": false, "score": 2, "creation_date": 1506794767, "post_id": 46504629, "comment_id": 79965474, "body": "If you are having performance issues I&#39;d suggest you try profiling. This code isn&#39;t too long - try and make a version that uses reflection and see how fast that is. It is unclear what kind of database you are getting your data from - does it follow the spec of sql.DB? Is the data layout known at compile time or are you dealing with dynamic data?"}, {"owner": {"reputation": 1, "user_id": 7032683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8eb954121eceae3348b20fb211b100a9?s=128&d=identicon&r=PG", "display_name": "Vincento Law", "link": "https://stackoverflow.com/users/7032683/vincento-law"}, "reply_to_user": {"reputation": 4676, "user_id": 454646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dcd9862c0c73c0eb1465d20668b4e55?s=128&d=identicon&r=PG", "display_name": "Michael Banzon", "link": "https://stackoverflow.com/users/454646/michael-banzon"}, "edited": false, "score": 0, "creation_date": 1506802118, "post_id": 46504629, "comment_id": 79967623, "body": "I didn&#39;t compare the performance of this solution with reflect solution yet, but will. The main question is about right solution, seems it&#39;s not a right way: to copy array to get 1 level of abstraction. Also calling data getting from DB using 9 lines seems very bad. I&#39;m using couchDB. Data layout is known at compile time, I just have a lot of different structs needed to load from DB, and I don&#39;t want to write a lot of code every time I need to get data from DB."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 7032683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8eb954121eceae3348b20fb211b100a9?s=128&d=identicon&r=PG", "display_name": "Vincento Law", "link": "https://stackoverflow.com/users/7032683/vincento-law"}, "is_accepted": true, "score": 0, "last_activity_date": 1507223596, "creation_date": 1507223596, "answer_id": 46591315, "question_id": 46504629, "link": "https://stackoverflow.com/questions/46504629/golang-abstract-function-that-gets-data-from-db-and-fills-array/46591315#46591315", "title": "Golang abstract function that gets data from db and fills array", "body": "<p>I tested performance with reflect, and it is similar to the mentioned above solution. So here is solution with reflect, if someone needs it. This function gets data from DB and fills abstract array</p>\n\n<pre><code>func GetItems(design string, viewName string, opts map[string]interface{}, arrayType interface{}) (interface{}, error) {\n    res := couchResponse{}\n    opts[\"limit\"] = 100000\n    bytes, err := CouchView(design, viewName, opts)\n    if err != nil {\n        return nil, err\n    }\n    err = json.Unmarshal(bytes, &amp;res)\n    if err != nil {\n        return nil, err\n    }\n    dataType := reflect.TypeOf(arrayType)\n    slice := reflect.MakeSlice(reflect.SliceOf(dataType), len(res.Rows), len(res.Rows))\n    for i := 0; i &lt; len(res.Rows); i++ {\n        if opts[\"include_docs\"] == true {\n            err = json.Unmarshal(res.Rows[i].Doc, slice.Index(i).Addr().Interface())\n        } else {\n            err = json.Unmarshal(res.Rows[i].Value, slice.Index(i).Addr().Interface())\n        }\n        if err != nil {\n            return nil, err\n        }\n    }\n    x := reflect.New(slice.Type())\n    x.Elem().Set(slice)\n    return x.Interface(), nil\n}\n</code></pre>\n\n<p>and getting data using this function:</p>\n\n<pre><code>var e Event\nres, err := GetItems(\"data\", \"data_list\", map[string]interface{}{}, e)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 7032683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8eb954121eceae3348b20fb211b100a9?s=128&d=identicon&r=PG", "display_name": "Vincento Law", "link": "https://stackoverflow.com/users/7032683/vincento-law"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 46591315, "answer_count": 1, "score": -1, "last_activity_date": 1507223596, "creation_date": 1506788077, "last_edit_date": 1506794358, "question_id": 46504629, "link": "https://stackoverflow.com/questions/46504629/golang-abstract-function-that-gets-data-from-db-and-fills-array", "title": "Golang abstract function that gets data from db and fills array", "body": "<p>I want to create an abstract function, that gets data from DB and fills array by this data. Types of array can be different. And I want to do it without reflect, due to performance issues.\nI just want to call everywhere some function like GetDBItems() and get array of data from DB with desired type. But all implementations that I create are owful. </p>\n\n<p>Here is this function implementation:</p>\n\n<pre><code>type AbstractArrayGetter func(size int) []interface{}\n\nfunc GetItems(arrayGetter AbstractArrayGetter) {\n    res := DBResponse{}\n    DB.Get(&amp;res)\n    arr := arrayGetter(len(res.Rows))\n    for i := 0; i &lt; len(res.Rows); i++ {\n        json.Unmarshal(res.Rows[i].Value, &amp;obj[i])\n    }\n}\n</code></pre>\n\n<p>Here I call this function:</p>\n\n<pre><code>var events []Event\nGetFullItems(\"events\", \"events_list\", map[string]interface{}{}, func(size int) []interface{} {\n        events = make([]Event, size, size)\n        proxyEnt := make([]interface{}, size, size)\n        for i, _ := range events {\n            proxyEnt[i] = &amp;events[i]\n        }\n        return proxyEnt\n    })\n</code></pre>\n\n<p>It works, but there are to much code to call this function, also there is some perfomance issue about copying events array to interfaces array.</p>\n\n<p>How can I do it without reflect and do it with a short function call code? Or reflect not to slow in this case?</p>\n"}, {"tags": ["performance", "go"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1506800791, "post_id": 46504507, "comment_id": 79967316, "body": "<code>go openImage()</code>"}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 0, "last_activity_date": 1506952269, "creation_date": 1506952269, "answer_id": 46526840, "question_id": 46504507, "link": "https://stackoverflow.com/questions/46504507/how-to-run-filepath-walkfunc-as-a-goroutine/46526840#46526840", "title": "How to run filepath.Walkfunc as a goroutine", "body": "<p>You can't get filepath.Walk to call your function in a goroutine, but you can simply start a goroutine in your WalkFunc.</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"path/filepath\"\n)\n\nfunc main() {\n    filepath.Walk(\"/my/dir\", func(path string, info os.FileInfo, err error) error {\n            if err != nil {\n                    return err\n            }\n\n            if info.IsDir() {\n                    return nil\n            }\n\n            // Check more criteria if necessary. Also consider limiting the number\n            // of concurrent goroutines.\n\n            go openImage(path, info)\n\n            return nil\n    })\n}\n\nfunc openImage(path string, info os.FileInfo) {\n}\n</code></pre>\n"}], "owner": {"reputation": 1670, "user_id": 6579556, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ddcf07d32c7d026a6e2fb697b8ae75f3?s=128&d=identicon&r=PG&f=1", "display_name": "Pavel", "link": "https://stackoverflow.com/users/6579556/pavel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 537, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1506952269, "creation_date": 1506787316, "question_id": 46504507, "link": "https://stackoverflow.com/questions/46504507/how-to-run-filepath-walkfunc-as-a-goroutine", "title": "How to run filepath.Walkfunc as a goroutine", "body": "<p>I'm trying to parse a large image dataset. I'm using filepath.Walk ]and processing each file I find there.  I'd like the filepath.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"image/color\"\n    \"image/png\"\n    \"math/rand\"\n    \"os\"\n)\n\nvar (\n    Black = color.Gray{0}\n)\n\nfunc getRandFloatNumber(min, max float32) float32 {\n    return (rand.Float32()*2 - min) * max\n}\n\nfunc openImage(path string, info os.FileInfo, err error) error {\n    infile, _ := os.Open(path)\n    defer infile.Close()\n    img, err := png.Decode(infile)\n    if err != nil {\n        return nil\n    }\n\n    array := make([]float32, 128*128)\n    for y := 0; y &lt; 128; y++ {\n        for x := 0; x &lt; 128; x++ {\n            c := color.GrayModel.Convert(img.At(x, y)).(color.Gray)\n            if c == Black {\n                array[x*y] = getRandFloatNumber(0.7, 0.95)\n            } else {\n                array[x*y] = getRandFloatNumber(0.1, 0.25)\n            }\n        }\n    }\n\n    fmt.Println(info.Name())\n\n    return nil\n}\n</code></pre>\n\n<p>How to run <code>openImage</code> as a gorutine?\nOr how to optimize this code?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "edited": false, "score": 1, "creation_date": 1506778874, "post_id": 46503212, "comment_id": 79960791, "body": "Why don&#39;t you reference the schema name by name? <code>schema.table</code>"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1506779000, "post_id": 46503212, "comment_id": 79960819, "body": "Can you run this queries in console?"}, {"owner": {"reputation": 28753, "user_id": 1138192, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4ed67a4983ab0568593e133930430941?s=128&d=identicon&r=PG", "display_name": "Always Sunny", "link": "https://stackoverflow.com/users/1138192/always-sunny"}, "edited": false, "score": 0, "creation_date": 1506779254, "post_id": 46503212, "comment_id": 79960871, "body": "Why you added extra <code>&quot;&quot;</code> to the table name?"}, {"owner": {"reputation": 169, "user_id": 7801344, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/09a811a52800bdc737af6eb24faa921a?s=128&d=identicon&r=PG&f=1", "display_name": "ErvingGoffman", "link": "https://stackoverflow.com/users/7801344/ervinggoffman"}, "reply_to_user": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "edited": false, "score": 0, "creation_date": 1506779340, "post_id": 46503212, "comment_id": 79960898, "body": "@salient, can you tell it in more detail?"}, {"owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "edited": false, "score": 0, "creation_date": 1506779412, "post_id": 46503212, "comment_id": 79960910, "body": "<code>CREATE TABLE schema.tablename \u2026</code>, <code>INSERT INTO schema.tablename</code>"}, {"owner": {"reputation": 169, "user_id": 7801344, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/09a811a52800bdc737af6eb24faa921a?s=128&d=identicon&r=PG&f=1", "display_name": "ErvingGoffman", "link": "https://stackoverflow.com/users/7801344/ervinggoffman"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1506779614, "post_id": 46503212, "comment_id": 79960975, "body": "@Eugene Lisitsky, I tried to execute just INSERT INTO ... VALUES (...) and got the same problem."}, {"owner": {"reputation": 169, "user_id": 7801344, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/09a811a52800bdc737af6eb24faa921a?s=128&d=identicon&r=PG&f=1", "display_name": "ErvingGoffman", "link": "https://stackoverflow.com/users/7801344/ervinggoffman"}, "reply_to_user": {"reputation": 28753, "user_id": 1138192, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4ed67a4983ab0568593e133930430941?s=128&d=identicon&r=PG", "display_name": "Always Sunny", "link": "https://stackoverflow.com/users/1138192/always-sunny"}, "edited": false, "score": 0, "creation_date": 1506779772, "post_id": 46503212, "comment_id": 79961015, "body": "@Being Sunny, &quot;extra&quot;? I think, without quotes the PostgreSQL will result in lowercase."}, {"owner": {"reputation": 169, "user_id": 7801344, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/09a811a52800bdc737af6eb24faa921a?s=128&d=identicon&r=PG&f=1", "display_name": "ErvingGoffman", "link": "https://stackoverflow.com/users/7801344/ervinggoffman"}, "reply_to_user": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "edited": false, "score": 0, "creation_date": 1506779899, "post_id": 46503212, "comment_id": 79961054, "body": "@salient, I tried. Maybe, not correctly, but I got the same error."}, {"owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "edited": false, "score": 0, "creation_date": 1506780002, "post_id": 46503212, "comment_id": 79961088, "body": "after you create the tables, can you assert that they are in the schema you expect them to be?"}, {"owner": {"reputation": 169, "user_id": 7801344, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/09a811a52800bdc737af6eb24faa921a?s=128&d=identicon&r=PG&f=1", "display_name": "ErvingGoffman", "link": "https://stackoverflow.com/users/7801344/ervinggoffman"}, "reply_to_user": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "edited": false, "score": 0, "creation_date": 1506780566, "post_id": 46503212, "comment_id": 79961252, "body": "@salient, actually I do not know. I execute the command <b>SET search_path = schema1, public</b> for this. It is not right? Can you explain how this works? Nevertheless when I use <b>INSERT INTO schema1.&quot;Sities&quot;</b> or <b>INSERT INTO schema1.Sities</b> or <b>INSERT INTO &quot;schema1&quot;.&quot;Sities&quot;</b> the problem remains the same."}, {"owner": {"reputation": 81552, "user_id": 562459, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/V3UR9.png?s=128&g=1", "display_name": "Mike Sherrill &#39;Cat Recall&#39;", "link": "https://stackoverflow.com/users/562459/mike-sherrill-cat-recall"}, "edited": false, "score": 0, "creation_date": 1506780957, "post_id": 46503212, "comment_id": 79961365, "body": "What&#39;s the output of this? <code>select table_catalog, table_schema, table_name from information_schema.tables where table_name = &#39;Sities&#39;;</code> Strings like &#39;Orenburg&#39; take single quotes in standard SQL. Database objects like &quot;Sities&quot; take double quotes. I don&#39;t know what <code>&quot;RU&quot;</code> is."}, {"owner": {"reputation": 169, "user_id": 7801344, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/09a811a52800bdc737af6eb24faa921a?s=128&d=identicon&r=PG&f=1", "display_name": "ErvingGoffman", "link": "https://stackoverflow.com/users/7801344/ervinggoffman"}, "reply_to_user": {"reputation": 81552, "user_id": 562459, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/V3UR9.png?s=128&g=1", "display_name": "Mike Sherrill &#39;Cat Recall&#39;", "link": "https://stackoverflow.com/users/562459/mike-sherrill-cat-recall"}, "edited": false, "score": 0, "creation_date": 1506781576, "post_id": 46503212, "comment_id": 79961533, "body": "@Mike Sherrill &#39;Cat Recall&#39;, <a href=\"https://ibb.co/iCLaRG\" rel=\"nofollow noreferrer\">ibb.co/iCLaRG</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1506783600, "post_id": 46503212, "comment_id": 79962140, "body": "Show the code that executes the two separate sets of SQL commands, and also show the code that connects to the database. Also at the top of your first file you create a database called <code>weather</code>, your subsequent commands are executed outside of that new database since the script runs in the database to which you originally connected. Anyways your not giving us the whole picture so we are unable to help."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1506784028, "post_id": 46503212, "comment_id": 79962274, "body": "And also from your link (<a href=\"https://ibb.co/iCLaRG\" rel=\"nofollow noreferrer\">ibb.co/iCLaRG</a>) it&#39;s clear that you are either connecting to the wrong database (the image says postgres and who knows what database your Go code is connecting to...) or that your first set of commands, the ones that create the tables, did not work as you inteded, and so you have no tables to work with."}, {"owner": {"reputation": 169, "user_id": 7801344, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/09a811a52800bdc737af6eb24faa921a?s=128&d=identicon&r=PG&f=1", "display_name": "ErvingGoffman", "link": "https://stackoverflow.com/users/7801344/ervinggoffman"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1507109072, "post_id": 46503212, "comment_id": 80076247, "body": "@mkopriva, you right, I forgot to connect to the created databas\u0435 after it was created."}, {"owner": {"reputation": 169, "user_id": 7801344, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/09a811a52800bdc737af6eb24faa921a?s=128&d=identicon&r=PG&f=1", "display_name": "ErvingGoffman", "link": "https://stackoverflow.com/users/7801344/ervinggoffman"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1507109271, "post_id": 46503212, "comment_id": 80076362, "body": "@mkopriva, if you if you can, post this comment in answer field."}, {"owner": {"reputation": 169, "user_id": 7801344, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/09a811a52800bdc737af6eb24faa921a?s=128&d=identicon&r=PG&f=1", "display_name": "ErvingGoffman", "link": "https://stackoverflow.com/users/7801344/ervinggoffman"}, "edited": false, "score": 0, "creation_date": 1507109507, "post_id": 46503212, "comment_id": 80076540, "body": "After this:  <code>_, err = predb.Exec(&quot;CREATE DATABASE weather;&quot;)</code> <code>_, err = predb.Exec(&quot;CREATE SCHEMA schema1;&quot;)</code> I had to add this: <code>predb.Close()</code>  And only then connect to the created database and create tables."}], "answers": [{"comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 169, "user_id": 7801344, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/09a811a52800bdc737af6eb24faa921a?s=128&d=identicon&r=PG&f=1", "display_name": "ErvingGoffman", "link": "https://stackoverflow.com/users/7801344/ervinggoffman"}, "edited": false, "score": 0, "creation_date": 1506781263, "post_id": 46503463, "comment_id": 79961449, "body": "<code>SHOW search_path;</code> ?"}, {"owner": {"reputation": 169, "user_id": 7801344, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/09a811a52800bdc737af6eb24faa921a?s=128&d=identicon&r=PG&f=1", "display_name": "ErvingGoffman", "link": "https://stackoverflow.com/users/7801344/ervinggoffman"}, "edited": false, "score": 0, "creation_date": 1506781635, "post_id": 46503463, "comment_id": 79961557, "body": "&quot;$user&quot;, public"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 169, "user_id": 7801344, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/09a811a52800bdc737af6eb24faa921a?s=128&d=identicon&r=PG&f=1", "display_name": "ErvingGoffman", "link": "https://stackoverflow.com/users/7801344/ervinggoffman"}, "edited": false, "score": 0, "creation_date": 1506784971, "post_id": 46503463, "comment_id": 79962557, "body": "So <code>search_path</code> was not applied. Do you use any connection pooler?"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1506780288, "creation_date": 1506780288, "answer_id": 46503463, "question_id": 46503212, "link": "https://stackoverflow.com/questions/46503212/postgresql-relation-does-not-exist-error/46503463#46503463", "title": "PostgreSQL: relation does not exist error", "body": "<p>This works - try to check quotes <code>\"</code> and apostrophes <code>'</code>:</p>\n\n<pre><code>SET search_path = schema1, public;\n\nINSERT INTO \"Sities\" (name, country, weather_id_api)\n            SELECT 'Orenburg', 'RU', 234234\n            WHERE NOT EXISTS (SELECT name FROM \"Sities\" WHERE name='Orenburg');\n</code></pre>\n\n<p><a href=\"http://sqlfiddle.com/#!17/5abd9/4\" rel=\"nofollow noreferrer\">http://sqlfiddle.com/#!17/5abd9/4</a></p>\n"}], "owner": {"reputation": 169, "user_id": 7801344, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/09a811a52800bdc737af6eb24faa921a?s=128&d=identicon&r=PG&f=1", "display_name": "ErvingGoffman", "link": "https://stackoverflow.com/users/7801344/ervinggoffman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12348, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1506780288, "creation_date": 1506778421, "last_edit_date": 1506778767, "question_id": 46503212, "link": "https://stackoverflow.com/questions/46503212/postgresql-relation-does-not-exist-error", "title": "PostgreSQL: relation does not exist error", "body": "<p>Perhaps this error can be caused by problems with the SCHEMA, I tried to fix it, but I was completely confused.</p>\n\n<p>Here is the detailed description.</p>\n\n<p>There is a separate file that runs the following commands:</p>\n\n<pre><code>CREATE DATABASE weather;\nCREATE SCHEMA public;\nCREATE SCHEMA schema1;\n\nSET search_path = schema1, public;\n\nCREATE TABLE \"Sities\" (\n                    Id SERIAL PRIMARY KEY,\n                    name TEXT,\n                    country TEXT,\n                    weather_id_api int);\n\nCREATE TABLE \"Forecasts\" (\n                    Id SERIAL PRIMARY KEY,\n                    city_id int,\n                    time DATE,\n                    temp INT,\n                    humidity INT,\n                    pressure INT);\n\nGRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO postgres;\nGRANT usage ON SCHEMA public TO postgres;\n</code></pre>\n\n<p>The execution of each command is checked for errors. These commands are executed without problems.</p>\n\n<p>Further in another file such commands are executed:</p>\n\n<pre><code>SET search_path = schema1, public;\nINSERT INTO \"Sities\" (name, country, weather_id_api)\n            SELECT 'Orenburg', \"RU\", 234234\n            WHERE NOT EXISTS (SELECT name FROM \"Sities\" WHERE name=\"Orenburg\");\n</code></pre>\n\n<p><strong>The last command causes an error:</strong></p>\n\n<blockquote>\n  <p>panic: pq: Relation \"Sities\" does not exist</p>\n  \n  <p>goroutine 1 [running]: main.PostToDatabase(0x11731ee0)\n          D:/Go/src/WeatherSoket/main.go:135 +0x40f main.Update()\n          D:/Go/src/WeatherSoket/main.go:150 +0x52 main.main()\n          D:/Go/src/WeatherSoket/main.go:165 +0xbe exit status 2</p>\n</blockquote>\n"}, {"tags": ["elasticsearch", "nginx", "go", "proxy"], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 1, "last_activity_date": 1506953045, "creation_date": 1506953045, "answer_id": 46527079, "question_id": 46501734, "link": "https://stackoverflow.com/questions/46501734/cant-connect-to-my-proxied-elasticsearch-node/46527079#46527079", "title": "Cant connect to my proxied elasticsearch node", "body": "<p>You are looking for the <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-http.html\" rel=\"nofollow noreferrer\">HTTP options</a>, specifically <code>http.publish_host</code> and <code>http.publish_port</code>, which should be set to the publicly reachable address and port of the Nginx server proxying the ES node. </p>\n\n<p>Note that with Elasticsearch listening on 127.0.0.1:9300 for the transport, you won't be able to form a cluster with nodes on other hosts. The transport can be configured similarly with the <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-transport.html\" rel=\"nofollow noreferrer\">transport options</a>.</p>\n"}], "owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 435, "favorite_count": 1, "accepted_answer_id": 46527079, "answer_count": 1, "score": 0, "last_activity_date": 1506953045, "creation_date": 1506766235, "last_edit_date": 1506767342, "question_id": 46501734, "link": "https://stackoverflow.com/questions/46501734/cant-connect-to-my-proxied-elasticsearch-node", "title": "Cant connect to my proxied elasticsearch node", "body": "<p>I'm having issues with connecting from my Go client to my es node.</p>\n\n<p>I have elasticsearch behind an nginx proxy that sets basic auth. \nAll settings are default in ES besides memory.</p>\n\n<p>Via browser it works wonderfully, but not via this client: \n<a href=\"https://github.com/olivere/elastic\" rel=\"nofollow noreferrer\">https://github.com/olivere/elastic</a></p>\n\n<p>I read the docs and it says it uses the /_nodes/http api to connect. Now this is probably where I did something wrong because the response from that api looks like this:</p>\n\n<pre><code>{\n  \"_nodes\" : {\n    \"total\" : 1,\n    \"successful\" : 1,\n    \"failed\" : 0\n  },\n  \"cluster_name\" : \"elasticsearch\",\n  \"nodes\" : {\n    \"u6TqFjAvRBa3_4FndfKh4w\" : {\n      \"name\" : \"u6TqFjA\",\n      \"transport_address\" : \"127.0.0.1:9300\",\n      \"host\" : \"127.0.0.1\",\n      \"ip\" : \"127.0.0.1\",\n      \"version\" : \"5.6.2\",\n      \"build_hash\" : \"57e20f3\",\n      \"roles\" : [\n        \"master\",\n        \"data\",\n        \"ingest\"\n      ],\n      \"http\" : {\n        \"bound_address\" : [\n          \"[::1]:9200\",\n          \"127.0.0.1:9200\"\n        ],\n        \"publish_address\" : \"127.0.0.1:9200\",\n        \"max_content_length_in_bytes\" : 104857600\n      }\n    }\n  }\n}\n</code></pre>\n\n<p>I'm guessing I have to set the IPs to my actual IP/domain (my domain is like es01.somedomain.com)</p>\n\n<p>So how do i correctly configure elastisearch so that my go client can connect?</p>\n\n<p>My config files for nginx look similar to this: <a href=\"https://www.elastic.co/blog/playing-http-tricks-nginx\" rel=\"nofollow noreferrer\">https://www.elastic.co/blog/playing-http-tricks-nginx</a></p>\n\n<p><strong>Edit: I found a temporary solution by setting elastic.SetSniff(false) in the Options for the client, but I think that means I can't scale ES horizontally. So still looking for an alternative.</strong></p>\n"}, {"tags": ["go", "channel"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 12, "last_activity_date": 1506792168, "last_edit_date": 1506792168, "creation_date": 1506766401, "answer_id": 46501752, "question_id": 46501433, "link": "https://stackoverflow.com/questions/46501433/infinite-loop-with-zeros-while-trying-to-achieve-deadlock/46501752#46501752", "title": "Infinite loop with zeros while trying to achieve deadlock", "body": "<p>Your understanding is (almost) correct, except that the infinite loop in the main goroutine will not block but will receive and print relentlessly.</p>\n\n<p>The goroutine you start sends the numbers 0, 1, ... 9 on the channel, then <em>closes</em> it. And receiving from a closed channel does not block, on the contrary, it can proceed immediately, and it yields the zero value of the element type of the channel, which is <code>0</code> for the type <code>int</code>. This is stated in <a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"nofollow noreferrer\">Spec: Receive operator:</a></p>\n\n<blockquote>\n  <p>Receiving from a <code>nil</code> channel blocks forever. <strong>A receive operation on a <a href=\"https://golang.org/ref/spec#Close\" rel=\"nofollow noreferrer\">closed</a> channel can always proceed immediately, yielding the element type's <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a> after any previously sent values have been received.</strong></p>\n</blockquote>\n\n<p>So you see exactly what you should. First it prints the numbers <code>0..9</code>, then keeps printing <code>0</code> very fast (without any delay), so probably you don't even notice the initial <code>0..9</code> numbers.</p>\n\n<p>Slightly modifying your example so that the loop in the main goroutine exits after 15 iterations will immediately show what happens:</p>\n\n<pre><code>c := make(chan int)\ngo func() {\n    for i := 0; i &lt; 10; i++ {\n        c &lt;- i // INPUT\n    }\n    close(c)\n}()\n\nfor i := 0; i &lt; 15; i++ {\n    fmt.Print(&lt;-c) // RECEIVER; OUTPUT\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/hvhq6-BldF\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>012345678900000\n</code></pre>\n\n<p>If your goal is to quit once all sent numbers have been processed (printed), use the <code>for range</code> on the channel:</p>\n\n<pre><code>for i := range c {\n    fmt.Print(i) // RECEIVER; OUTPUT\n}\n</code></pre>\n\n<p>If your goal is to block until new numbers are available once those 10 numbers are processed, then don't close the channel. That way the next receive operation will block. In this case both your original loop and the <code>for range</code> loop would work, but <code>for range</code> is better as that always exits if / when the channel is closed.</p>\n\n<p>Check out this question and memorize the channel axioms: <a href=\"https://stackoverflow.com/questions/39015602/how-does-a-non-initialized-channel-behave/39016004#39016004\">How does a non initialized channel behave?</a></p>\n"}], "owner": {"reputation": 19471, "user_id": 648138, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/gzQEA.jpg?s=128&g=1", "display_name": "Suhail Gupta", "link": "https://stackoverflow.com/users/648138/suhail-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 46501752, "answer_count": 1, "score": 8, "last_activity_date": 1506792168, "creation_date": 1506763510, "question_id": 46501433, "link": "https://stackoverflow.com/questions/46501433/infinite-loop-with-zeros-while-trying-to-achieve-deadlock", "title": "Infinite loop with zeros while trying to achieve deadlock", "body": "<p>The following code keeps printing <code>0</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n    c := make(chan int)\n\n    go func() {\n        for i := 0; i &lt; 10; i++ {\n            c &lt;- i // INPUT\n        }\n        close(c)\n    }()\n\n    for {\n        fmt.Print(&lt;-c) // RECEIVER; OUTPUT\n    }\n}\n</code></pre>\n\n<p>From my understanding, it should print <code>0</code> to <code>9</code> and then go on an infinite loop.  Why does it keep printing <code>zero</code>?</p>\n"}, {"tags": ["json", "curl", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1506758499, "post_id": 46500712, "comment_id": 79955796, "body": "Post your <code>models.User</code> type."}, {"owner": {"reputation": 555, "user_id": 8337498, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8b22e7b8121ee9ea74b80f0783247a02?s=128&d=identicon&r=PG&f=1", "display_name": "taraf", "link": "https://stackoverflow.com/users/8337498/taraf"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1506762078, "post_id": 46500712, "comment_id": 79956656, "body": "type User struct {  ID       uint64   <code>json:&quot;id&quot; gorm:&quot;primary_key;AUTO_INCREAMENT&quot;</code> Username string   <code>json:&quot;username,omitempty&quot; gorm:&quot;size:100;not null;unique&quot;</code>   Password string   <code>json:&quot;password,omitempty&quot; gorm:&quot;size:200;not null&quot;</code>   Admin    bool     <code>json:&quot;admin&quot; gorm:&quot;not null;default=flase&quot;</code>    Charges  Charge <code>json:&quot;charges,omitempty&quot; gorm:&quot;ForeignKey:UserID&quot;</code>       Incomes  Income <code>json:&quot;incomes,omitempty&quot; gorm:&quot;ForeignKey:UserID&quot;</code> }"}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1506760442, "last_edit_date": 1506760442, "creation_date": 1506759888, "answer_id": 46500973, "question_id": 46500712, "link": "https://stackoverflow.com/questions/46500712/sending-boolean-value-through-application-json-curl-request/46500973#46500973", "title": "Sending boolean value through application/json curl request", "body": "<p>In principle, this should work: </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype User struct {\n    Username string\n    Password string\n    Admin    bool\n}\n\nfunc main() {\n    var u User\n    // var u models.User\n    j := []byte(`{\"username\":\"tahereh\",\"password\":\"1234\", \"admin\":true}`)\n    err := json.Unmarshal(j, &amp;u)\n    if err != nil {\n        fmt.Printf(\"error:%v\", err)\n        return\n    }\n\n    fmt.Printf(\"User:%v\", u)\n}\n</code></pre>\n\n<p>Since it works partially for you, the json is probably being read ok. So perhaps take this sample code, and start by using your models.User type in place of User, and see if it still unmarshals ok. </p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1506762661, "last_edit_date": 1506762661, "creation_date": 1506761735, "answer_id": 46501220, "question_id": 46500712, "link": "https://stackoverflow.com/questions/46500712/sending-boolean-value-through-application-json-curl-request/46501220#46501220", "title": "Sending boolean value through application/json curl request", "body": "<p>In your <code>models.User</code> type you explicitly specified to exclude the <code>Admin</code> field from JSON processing (this is what the <code>json:\"-\"</code> tag value means), so its value is left to its <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a> (which is <code>false</code> for the <code>bool</code> type).</p>\n\n<p>Change its tag to <code>json:\"admin\"</code> and so its value will be set from the JSON <code>\"admin\"</code> property, like in this example:</p>\n\n<pre><code>type User {\n    // your other fields...\n    Admin bool `json:\"admin\" gorm:\"not null;default=false\"`\n}\n</code></pre>\n\n<p>Read more about struct tags here: <a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go/30889373#30889373\">What are the use(s) for tags in Go?</a></p>\n"}], "owner": {"reputation": 555, "user_id": 8337498, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8b22e7b8121ee9ea74b80f0783247a02?s=128&d=identicon&r=PG&f=1", "display_name": "taraf", "link": "https://stackoverflow.com/users/8337498/taraf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2195, "favorite_count": 0, "accepted_answer_id": 46501220, "answer_count": 2, "score": 2, "last_activity_date": 1506762661, "creation_date": 1506757728, "last_edit_date": 1506758147, "question_id": 46500712, "link": "https://stackoverflow.com/questions/46500712/sending-boolean-value-through-application-json-curl-request", "title": "Sending boolean value through application/json curl request", "body": "<p>I'm trying to send a curl request. This is my request:</p>\n\n<pre><code>curl -H \"Content-Type: application/json\" -X POST -d '{\"username\":\"tahereh\",\"password\":\"1234\", \"admin\":true}' http://localhost:8000/users\n</code></pre>\n\n<p>I decode this request in my code and store it in 'user var' of code's User struct, like this:</p>\n\n<pre><code>var newUser models.User //User is an struct in model package\nerr1 := json.NewDecoder(r.Body).Decode(&amp;newUser)\n</code></pre>\n\n<p>Then I debug my code with <code>dlv debug</code> command line. My problem is when I print <code>newUser</code> with <code>print newUser</code> in <code>dlv</code> all of the variable correctly set except the boolean value. While I'm sending the true value through curl request, it sets to false!</p>\n\n<p>point:  I have printed the err1, it's also null.</p>\n"}, {"tags": ["multithreading", "debugging", "go", "dump", "tee"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1506758472, "post_id": 46500600, "comment_id": 79955788, "body": "try <code>go test .&#47;foo -v | tail -f log.txt</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506787097, "post_id": 46500600, "comment_id": 79963180, "body": "A core dump always goes to a file, but you need to set <code>GOTRACEBACK=crash</code> and use <code>SIGABRT</code>"}, {"owner": {"reputation": 636, "user_id": 3333488, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/49Fx1.jpg?s=128&g=1", "display_name": "lash", "link": "https://stackoverflow.com/users/3333488/lash"}, "edited": false, "score": 0, "creation_date": 1506791216, "post_id": 46500600, "comment_id": 79964440, "body": "Always? The core dump goes to the terminal if stderr goes to terminal and I give <code>SIGQUIT</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506795271, "post_id": 46500600, "comment_id": 79965643, "body": "That&#39;s not a core dump, that&#39;s the stack trace."}, {"owner": {"reputation": 636, "user_id": 3333488, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/49Fx1.jpg?s=128&g=1", "display_name": "lash", "link": "https://stackoverflow.com/users/3333488/lash"}, "edited": false, "score": 0, "creation_date": 1506797751, "post_id": 46500600, "comment_id": 79966465, "body": "Indeed you are right :/ edited the question"}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 1, "creation_date": 1506891574, "post_id": 46500600, "comment_id": 79987844, "body": "Try <code>go test .&#47;foo -v |&amp; { trap &quot;&quot; 3; tee log.txt; }</code>"}, {"owner": {"reputation": 636, "user_id": 3333488, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/49Fx1.jpg?s=128&g=1", "display_name": "lash", "link": "https://stackoverflow.com/users/3333488/lash"}, "edited": false, "score": 0, "creation_date": 1506908225, "post_id": 46500600, "comment_id": 79991115, "body": "That did the trick, thanks."}], "answers": [{"tags": [], "owner": {"reputation": 636, "user_id": 3333488, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/49Fx1.jpg?s=128&g=1", "display_name": "lash", "link": "https://stackoverflow.com/users/3333488/lash"}, "is_accepted": false, "score": 0, "last_activity_date": 1506908288, "creation_date": 1506908288, "answer_id": 46518504, "question_id": 46500600, "link": "https://stackoverflow.com/questions/46500600/stack-trace-with-tiered-output/46518504#46518504", "title": "Stack trace with tiered output", "body": "<p>As per comment from <a href=\"https://stackoverflow.com/users/2554472/mark-plotnick\">Mark Plotnick</a> , trapping the <code>SIGQUIT</code> signal before the <code>tee</code> works (at least for me):</p>\n\n<p><code>go test ./foo -v |&amp; { trap \"\" 3; tee log.txt; }</code></p>\n"}], "owner": {"reputation": 636, "user_id": 3333488, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/49Fx1.jpg?s=128&g=1", "display_name": "lash", "link": "https://stackoverflow.com/users/3333488/lash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1506908288, "creation_date": 1506756793, "last_edit_date": 1506797513, "question_id": 46500600, "link": "https://stackoverflow.com/questions/46500600/stack-trace-with-tiered-output", "title": "Stack trace with tiered output", "body": "<p>I am debugging a go program with a lot of goroutines which seem to deadlock.</p>\n\n<p>I would like to have a stack trace when it freezes. But the output is long and doesn't fit my terminal buffer. So I want to output it to a file. However, if I output stderr to a file, I can't (easily) detect when it freezes.</p>\n\n<p>I expected <code>tee</code> would be good for this:</p>\n\n<p><code>go test ./foo -v |&amp; tee log.txt</code></p>\n\n<p>However, when I hit <code>Ctrl</code> + <code>Alt</code> + <code>\\</code>, no stack trace output is shown either in terminal or in file. Somehow, it seems it doesn't survive the trip through <code>tee</code>.</p>\n\n<p>Is there a better way to do it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 45, "user_id": 6384391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c5209f557798e03f6acb69a1ec7a86a?s=128&d=identicon&r=PG&f=1", "display_name": "shx", "link": "https://stackoverflow.com/users/6384391/shx"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1506755525, "post_id": 46500273, "comment_id": 79955157, "body": "yes, the synax is somehow different from other language which i used before"}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 1, "last_activity_date": 1506754633, "creation_date": 1506754633, "answer_id": 46500365, "question_id": 46500273, "link": "https://stackoverflow.com/questions/46500273/how-declare-two-variables-in-for-init-in-golang/46500365#46500365", "title": "how declare two variables in for init in GoLang?", "body": "<p>A <a href=\"https://golang.org/ref/spec#ForClause\" rel=\"nofollow noreferrer\">For clause</a> has an <a href=\"https://golang.org/ref/spec#InitStmt\" rel=\"nofollow noreferrer\">Init Statement</a> which is a <a href=\"https://golang.org/ref/spec#SimpleStmt\" rel=\"nofollow noreferrer\">Simple Statement</a>, including only one <a href=\"https://golang.org/ref/spec#Assignment\" rel=\"nofollow noreferrer\">Assigment</a></p>\n\n<p>So in your case, you cannot declare multiple variable with different type/values. You could use a tuple assignment though</p>\n\n<pre><code>for z, n := 1.0, 0; n &lt; 10; n++ {\n</code></pre>\n\n<p>(<a href=\"https://play.golang.org/p/DUS1W6_8cB\" rel=\"nofollow noreferrer\">playground</a>)</p>\n"}], "owner": {"reputation": 45, "user_id": 6384391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c5209f557798e03f6acb69a1ec7a86a?s=128&d=identicon&r=PG&f=1", "display_name": "shx", "link": "https://stackoverflow.com/users/6384391/shx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 2, "closed_date": 1506766291, "accepted_answer_id": 46500365, "answer_count": 1, "score": 2, "last_activity_date": 1506754633, "creation_date": 1506753737, "question_id": 46500273, "link": "https://stackoverflow.com/questions/46500273/how-declare-two-variables-in-for-init-in-golang", "closed_reason": "Duplicate", "title": "how declare two variables in for init in GoLang?", "body": "<p>when i write:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc Sqrt(x float64) float64 {\n    var ret float64\n\n    for z := 1.0, n := 0;n &lt; 10;n++ {\n        ret = z - (z*z - x) / 2*z\n    }\n    return ret\n}\n\nfunc main() {\n    fmt.Println(Sqrt(2))\n}\n</code></pre>\n\n<p>syntax error: z := 1.0, n used as value.\nand bring </p>\n\n<blockquote>\n  <p>z := 1.0</p>\n</blockquote>\n\n<p>out of the for block below</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc Sqrt(x float64) float64 {\n    var ret float64\n    z := 1.0\n    for n := 0;n &lt; 10;n++ {\n        ret = z - (z*z - x) / 2*z\n    }\n    return ret\n}\n\nfunc main() {\n    fmt.Println(Sqrt(2))\n}\n</code></pre>\n\n<p>it's ok so how can i define two variables in init of the for block?</p>\n"}, {"tags": ["reactjs", "go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1506754922, "post_id": 46500198, "comment_id": 79955053, "body": "What serves the reactjs app?"}, {"owner": {"reputation": 1442, "user_id": 3289673, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/100001287204028/picture?type=large", "display_name": "SanchelliosProg", "link": "https://stackoverflow.com/users/3289673/sanchelliosprog"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1506755306, "post_id": 46500198, "comment_id": 79955118, "body": "I&#39;m serving it with Webpack"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1506755375, "post_id": 46500198, "comment_id": 79955128, "body": "What webserver serves it? <code>webpack</code> is a bundler."}, {"owner": {"reputation": 1442, "user_id": 3289673, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/100001287204028/picture?type=large", "display_name": "SanchelliosProg", "link": "https://stackoverflow.com/users/3289673/sanchelliosprog"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1506755728, "post_id": 46500198, "comment_id": 79955188, "body": "Well, let me tell you how I run it and on what domain, because question about server is a little bit confusing to me. I&#39;m building a project with create-react-app, I&#39;ve added the necessary code there, then I just run it on loaclhost:3000 by npm start script. The Golang backend app is running on docker container in VirtualBox"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1506755810, "post_id": 46500198, "comment_id": 79955204, "body": "<code>npm start</code> is not a production ready solution. And in your case it&#39;s not even a development-friendly. You might have set up a nginx that forwards requests to both npm webserver and golang webserver."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 5, "last_activity_date": 1506956748, "creation_date": 1506956748, "answer_id": 46528278, "question_id": 46500198, "link": "https://stackoverflow.com/questions/46500198/how-could-i-run-golan-application-backend-and-reactjs-application-frontend-o/46528278#46528278", "title": "How could I run Golan application (backend) and ReactJS application (frontend) on the same domain to prevent CORS?", "body": "<p>Use Go's file server to serve the static assets:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/api/\", apiHandler)\n    http.Handle(\"/\", http.FileServer(http.Dir(\"/var/www/my-app\")))\n    log.Fatal(http.ListenAndServe(\":3000\", nil))\n}\n\nfunc apiHandler(w http.ResponseWriter, r *http.Request) {}\n</code></pre>\n\n<p>The documentation has <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"noreferrer\">more examples for http.FileServer</a>.</p>\n\n<p>Alternatively, you can use something like <a href=\"https://godoc.org/github.com/jteeuwen/go-bindata\" rel=\"noreferrer\">github.com/jteeuwen/go-bindata</a> (and go-bindata-assetfs) to compile your assets into the Go binary and serve them from memory.</p>\n"}], "owner": {"reputation": 1442, "user_id": 3289673, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/100001287204028/picture?type=large", "display_name": "SanchelliosProg", "link": "https://stackoverflow.com/users/3289673/sanchelliosprog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1551, "favorite_count": 1, "accepted_answer_id": 46528278, "answer_count": 1, "score": 1, "last_activity_date": 1506956748, "creation_date": 1506752986, "question_id": 46500198, "link": "https://stackoverflow.com/questions/46500198/how-could-i-run-golan-application-backend-and-reactjs-application-frontend-o", "title": "How could I run Golan application (backend) and ReactJS application (frontend) on the same domain to prevent CORS?", "body": "<p>So, I have a golang application and reactJs application. If I run them on the different domains, I get problems with CORS. </p>\n\n<p>To allow CORS on the server side is not a problem at all, but I can't get cookies from the server, because they are ignored by browser as third-party cookies. </p>\n\n<p>So, I see quite a simple solution - to run server and frontend on the same domain, but I can't understand, how to do that. How could I configure everything to run on the same domain without conflicts? What are the best practices to prevent CORS between golang app and ReactJS app?</p>\n"}, {"tags": ["go", "closures"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 1, "creation_date": 1506734462, "post_id": 46498494, "comment_id": 79952161, "body": "parameter <code>b int</code> is shadowing local variable <code>b := 1</code>, that&#39;s why <i>b</i> is never used in <code>func fibonacci()</code>"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 1, "creation_date": 1506751521, "post_id": 46498494, "comment_id": 79954558, "body": "tip: you can use multiple assignment to make your code simpler: <code>a, b = b, a+b</code>"}], "answers": [{"comments": [{"owner": {"reputation": 789, "user_id": 4926126, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/48vo2.jpg?s=128&g=1", "display_name": "jiaweizhang", "link": "https://stackoverflow.com/users/4926126/jiaweizhang"}, "edited": false, "score": 0, "creation_date": 1506734989, "post_id": 46498692, "comment_id": 79952230, "body": "I see. Didn&#39;t know that named return parameters couldn&#39;t be defined outside the function"}], "tags": [], "owner": {"reputation": 13091, "user_id": 483266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a88664c5c8cd526ac9c0638e59db2c0f?s=128&d=identicon&r=PG", "display_name": "Arie Xiao", "link": "https://stackoverflow.com/users/483266/arie-xiao"}, "is_accepted": true, "score": 2, "last_activity_date": 1506734536, "creation_date": 1506734536, "answer_id": 46498692, "question_id": 46498494, "link": "https://stackoverflow.com/questions/46498494/go-closure-with-naked-return/46498692#46498692", "title": "Go closure with naked return", "body": "<p>Variables defined in the return segment shadow the variable with the same name in the outer scope. Inside your returned function, <code>b</code> refers to the one defined in the return value.</p>\n\n<p>You can remove the first declaration (and initialization) of <code>b</code> and the program passes the check, although the logic is not right.</p>\n\n<pre><code>// fibonacci is a function that returns\n// a function that returns an int.\nfunc fibonacci() func() int {\n    a := 0\n    b := 1 // declare a variable b and initialize with 1\n    return func() (b int) { // declare a variable b with default initialization\n        t := a + b // b refers to the variable defined in the return value\n        a = b\n        b = t\n        return\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 789, "user_id": 4926126, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/48vo2.jpg?s=128&g=1", "display_name": "jiaweizhang", "link": "https://stackoverflow.com/users/4926126/jiaweizhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 391, "favorite_count": 0, "accepted_answer_id": 46498692, "answer_count": 1, "score": 2, "last_activity_date": 1506734536, "creation_date": 1506732388, "question_id": 46498494, "link": "https://stackoverflow.com/questions/46498494/go-closure-with-naked-return", "title": "Go closure with naked return", "body": "<p>I am playing around with Go and am trying to implement a <code>fibonacci</code> function that returns a closure that returns fibonacci numbers. The problem can be found in the go tool tour. Here is a closure implementation that uses a regular (non-naked) return:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n// fibonacci is a function that returns\n// a function that returns an int.\nfunc fibonacci() func() int {\n    a := 0\n    b := 1\n    return func() int {\n        t := a + b\n        a = b\n        b = t\n        return b\n    }\n}\n\nfunc main() {\n    f := fibonacci()\n    for i := 0; i &lt; 10; i++ {\n        fmt.Println(f())\n    }\n}\n</code></pre>\n\n<p>The function correctly returns the following:</p>\n\n<pre><code>1\n2\n3\n5\n8\n13\n21\n34\n55\n89\n</code></pre>\n\n<p>I tried writing the <code>fibonacci</code> function differently by trying to use a naked return within the closure function, but it produces an error:</p>\n\n<blockquote>\n  <p>./compile20.go:9:7: b declared and not used</p>\n</blockquote>\n\n<p>Here is the code that generates the error</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n// fibonacci is a function that returns\n// a function that returns an int.\nfunc fibonacci() func() int {\n    a := 0\n    b := 1\n    return func() (b int) {\n        t := a + b\n        a = b\n        b = t\n        return\n    }\n}\n\nfunc main() {\n    f := fibonacci()\n    for i := 0; i &lt; 10; i++ {\n        fmt.Println(f())\n    }\n}\n</code></pre>\n\n<p>Anybody know how the variable <code>b</code> is not being used? <code>b</code> is obviously used in the first line of the closure function (<code>t := a + b</code>).</p>\n"}, {"tags": ["http", "go", "serialization"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 2, "creation_date": 1506734356, "post_id": 46498297, "comment_id": 79952143, "body": "you&#39;re making a lot of questions at the same time, looks like you&#39;re learning Go, I recommend you taking the <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">tour</a> and/or take a look here: <a href=\"https://gobyexample.com/\" rel=\"nofollow noreferrer\">gobyexample.com</a>"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1506760238, "post_id": 46498297, "comment_id": 79956190, "body": "Try it, and when you get stuck, come back here with a specific question. The answer to your question as currently posed is &#39;it depends&#39;."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1506953159, "post_id": 46498297, "comment_id": 80008269, "body": "<a href=\"https://golang.org/pkg/net/http/#Request.Write\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Request.Write</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3395, "user_id": 6164984, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/gtaJI.png?s=128&g=1", "display_name": "math2001", "link": "https://stackoverflow.com/users/6164984/math2001"}, "edited": false, "score": 0, "creation_date": 1577407374, "post_id": 51421625, "comment_id": 105163581, "body": "From the documentation: &gt; it should only be used by servers to debug client requests."}], "tags": [], "owner": {"reputation": 8461, "user_id": 193982, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/961667038883e6f6832949ba3c98d13e?s=128&d=identicon&r=PG", "display_name": "Mike Gleason jr Couturier", "link": "https://stackoverflow.com/users/193982/mike-gleason-jr-couturier"}, "is_accepted": false, "score": 0, "last_activity_date": 1532000004, "creation_date": 1532000004, "answer_id": 51421625, "question_id": 46498297, "link": "https://stackoverflow.com/questions/46498297/is-there-a-way-to-serialize-golang-http-request-object-and-persist-in-db/51421625#51421625", "title": "Is there a way to serialize golang http request object and persist in DB", "body": "<p>Yes you can: <a href=\"https://golang.org/pkg/net/http/httputil/#DumpRequest\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/httputil/#DumpRequest</a></p>\n\n<pre><code>import \"net/http/httputil\"\n\ndumped, err := httputil.DumpRequest(req, true)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "edited": false, "score": 0, "creation_date": 1574805906, "post_id": 59059924, "comment_id": 104359503, "body": "BTW: <code>httputil.DumpRequest</code> and <code>Request.Write</code> likely have the same implementation under the hood -- so either could work for this, but the <a href=\"https://golang.org/pkg/net/http/httputil/#DumpRequest\" rel=\"nofollow noreferrer\"><code>DumpRequest</code> documentation</a> says that it should only be used for debugging purposes."}, {"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "edited": false, "score": 0, "creation_date": 1574807349, "post_id": 59059924, "comment_id": 104360012, "body": "Serializing the <a href=\"https://golang.org/pkg/net/http/#Response\" rel=\"nofollow noreferrer\"><code>Response</code></a> can be done using a nearly identical routine, with a small amount of substitution (<code>req</code>/<code>resp</code>, etc.).  <a href=\"https://golang.org/pkg/net/http/#ReadResponse\" rel=\"nofollow noreferrer\"><code>http.ReadResponse</code></a> takes one additional argument, which can be <code>nil</code> (it doesn&#39;t seem to matter in my testing)."}], "tags": [], "owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "is_accepted": false, "score": 2, "last_activity_date": 1574805308, "creation_date": 1574805308, "answer_id": 59059924, "question_id": 46498297, "link": "https://stackoverflow.com/questions/46498297/is-there-a-way-to-serialize-golang-http-request-object-and-persist-in-db/59059924#59059924", "title": "Is there a way to serialize golang http request object and persist in DB", "body": "<p>There's not a nice way to serialize the <code>http.Request</code> structure itself (see notes below), but you can serialize the request back into HTTP/1.1 wire format (and deserialize too).  This can be done using <a href=\"https://golang.org/pkg/net/http/#Request.Write\" rel=\"nofollow noreferrer\"><code>Request.Write</code></a> and <a href=\"https://golang.org/pkg/net/http/#ReadRequest\" rel=\"nofollow noreferrer\"><code>http.ReadRequest</code></a>:</p>\n\n<pre><code>func captureRequestData(req *http.Request) error {\n    var b = &amp;bytes.Buffer{} // holds serialized representation\n    var tmp *http.Request\n    var err error\n    if err = req.Write(b); err != nil { // serialize request to HTTP/1.1 wire format\n        return err\n    }\n    r := bufio.NewReader(b)\n    if tmp, err = http.ReadRequest(r); err != nil { // deserialize request\n        return err\n    }\n    *req = *tmp // replace original request structure\n    return nil\n}\n</code></pre>\n\n<p>Persistence of the serialized buffer is just a matter of saving a copy of <code>b</code>.  You might prefer to persist the <code>string</code> representation, which involves some additional conversions:</p>\n\n<pre><code>s := b.String() // persist this\nr := bufio.NewReader(strings.NewReader(s))\n</code></pre>\n\n<hr>\n\n<p>There are a couple of reasons, at least, why you can't just use <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\"><code>json.Marshal()</code></a> for this:</p>\n\n<ol>\n<li><p>The <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow noreferrer\">public fields of <code>Request</code></a> include <em>functions</em>, which Marshall does not accept:</p>\n\n<blockquote>\n  <p>json: unsupported type: func() (io.ReadCloser, error)</p>\n</blockquote></li>\n<li><p><a href=\"https://golang.org/src/net/http/request.go\" rel=\"nofollow noreferrer\"><code>Request</code></a> also contains a <em>private</em> field <code>ctx</code> which thwarts any generic attempts at deserialization:</p>\n\n<blockquote>\n  <p>ctx is either the client or server context. It should only\n  be modified via copying the whole Request using WithContext.\n  It is unexported to prevent people from using Context wrong\n  and mutating the contexts held by callers of the same request.</p>\n</blockquote></li>\n</ol>\n"}], "owner": {"reputation": 1127, "user_id": 3565529, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/8440e4deb7914e16038deb64da6f0ce9?s=128&d=identicon&r=PG&f=1", "display_name": "user3565529", "link": "https://stackoverflow.com/users/3565529/user3565529"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1584, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1574808672, "creation_date": 1506730007, "last_edit_date": 1574808672, "question_id": 46498297, "link": "https://stackoverflow.com/questions/46498297/is-there-a-way-to-serialize-golang-http-request-object-and-persist-in-db", "title": "Is there a way to serialize golang http request object and persist in DB", "body": "<p>I need to make a http call in golang code. My server code will create the http request object and put it in database.</p>\n\n<p>The worker code will get the data from the DB and should be able to make the http call using the persisted request object.</p>\n\n<p>Can I directly persist the request object in DB by serializing the http request or do I need to add method/URL/body separately in the database?</p>\n"}, {"tags": ["reactjs", "go", "cookies"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1506713383, "post_id": 46495571, "comment_id": 79945991, "body": "You &quot;pass cookie from server to client&quot; via a Set-Cookie header (constructed by <code>http.SetCookie</code>). This seems fine. Note that the browser need not accept the cookie. Some of these rejections are controlled by user settings like rejecting third party cookies (which everybody should reject). If your React-triggered request is not considered an original request then the browser might discard the received cookie as third-party. You should not rely on being able to set (or even read) cookies cross site."}, {"owner": {"reputation": 1442, "user_id": 3289673, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/100001287204028/picture?type=large", "display_name": "SanchelliosProg", "link": "https://stackoverflow.com/users/3289673/sanchelliosprog"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506713716, "post_id": 46495571, "comment_id": 79946136, "body": "But is this possible to make a non-cross-site application with golang server and react client? And if not, what are the alternatives to hold user&#39;s data in browser?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1506714146, "post_id": 46495571, "comment_id": 79946328, "body": "Modern browser offer much more than cookies: Local/Session storage, Indexeddb and Web SQL."}, {"owner": {"reputation": 1442, "user_id": 3289673, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/100001287204028/picture?type=large", "display_name": "SanchelliosProg", "link": "https://stackoverflow.com/users/3289673/sanchelliosprog"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506716305, "post_id": 46495571, "comment_id": 79947399, "body": "Is JWT a good idea to start with?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1506721978, "post_id": 46495571, "comment_id": 79949562, "body": "JWT is something different so I do not understand how it could solve your problem."}], "answers": [{"tags": [], "owner": {"reputation": 1442, "user_id": 3289673, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/100001287204028/picture?type=large", "display_name": "SanchelliosProg", "link": "https://stackoverflow.com/users/3289673/sanchelliosprog"}, "is_accepted": true, "score": 1, "last_activity_date": 1506780116, "creation_date": 1506780116, "answer_id": 46503432, "question_id": 46495571, "link": "https://stackoverflow.com/questions/46495571/cant-get-cookies-from-server-side-golang-in-a-react-app-cors/46503432#46503432", "title": "Can&#39;t get cookies from server side (golang) in a react app (CORS)", "body": "<p>The solution is to write proxy variable in <code>package.json</code> to get of CORS</p>\n\n<p>For example, if client is on <code>localhost:3000</code> and server is on <code>localhost:8080</code>, we should add:</p>\n\n<blockquote>\n  <p>\"proxy\": \"<a href=\"http://localhost:8080/\" rel=\"nofollow noreferrer\">http://localhost:8080/</a>\"</p>\n</blockquote>\n\n<p>And access any path of server API with domain of client side, like:</p>\n\n<blockquote>\n  <p><a href=\"http://localhost:3000/set_coookie\" rel=\"nofollow noreferrer\">http://localhost:3000/set_coookie</a></p>\n</blockquote>\n"}], "owner": {"reputation": 1442, "user_id": 3289673, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/100001287204028/picture?type=large", "display_name": "SanchelliosProg", "link": "https://stackoverflow.com/users/3289673/sanchelliosprog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1054, "favorite_count": 1, "accepted_answer_id": 46503432, "answer_count": 1, "score": 1, "last_activity_date": 1506780116, "creation_date": 1506712501, "last_edit_date": 1506713031, "question_id": 46495571, "link": "https://stackoverflow.com/questions/46495571/cant-get-cookies-from-server-side-golang-in-a-react-app-cors", "title": "Can&#39;t get cookies from server side (golang) in a react app (CORS)", "body": "<p>I have a quite simple server application written in go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n    \"net/http\"\n    \"encoding/base64\"\n    \"encoding/json\"\n    \"github.com/rs/cors\"\n)\n\ntype Message struct {\n    Text string `json:\"text\"`\n}\n\nvar cookieQuotes = []string{\n    ...\n}\n\nconst COOKIE_NAME = \"your_cookie\"\n\nfunc main() {\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/set_cookie\", setCookie)\n    mux.HandleFunc(\"/get_cookie\", getCookie)\n    mux.Handle(\"/favicon.ico\", http.NotFoundHandler())\n    handler := cors.Default().Handler(mux)\n    http.ListenAndServe(\":8080\", handler)\n}\n\n...\n</code></pre>\n\n<p>Well, I have skipped the most of code here, but let me explain what it does.</p>\n\n<p>When we go to /set_cookie path, we are getting a cookie to our browser. Cookie has a Value, which is encrypted text of quote about a cookie. So, here is the function:</p>\n\n<pre><code>func setCookie(w http.ResponseWriter, r *http.Request) {\n    quote := getRandomCookieQuote()\n    encQuote := base64.StdEncoding.EncodeToString([]byte(quote))\n    http.SetCookie(w, &amp;http.Cookie{\n        Name: COOKIE_NAME,\n        Value: encQuote,\n    })\n}\n</code></pre>\n\n<p>This app is deployed in VirtualBox in a docker container.</p>\n\n<p>So, when I'm accessing the </p>\n\n<blockquote>\n  <p><a href=\"http://IP_ADDRESS:PORT/set_cookie\" rel=\"nofollow noreferrer\">http://IP_ADDRESS:PORT/set_cookie</a></p>\n</blockquote>\n\n<p>the cookie is set to the browser. And when I access </p>\n\n<blockquote>\n  <p><a href=\"http://IP_ADDRESS:PORT/get_cookie\" rel=\"nofollow noreferrer\">http://IP_ADDRESS:PORT/get_cookie</a></p>\n</blockquote>\n\n<p>I get decrypted text from a cookie (but this doesn't matter in case of this question)</p>\n\n<p>The client side is written in React. Well, I think it is not necessary to post all the code of the application, but the main part is here:</p>\n\n<pre><code>export const setCookie = () =&gt; async dispatch =&gt; {\n  const res = await axios.get(URL+SET_COOKIE_PATH);\n  console.log('set_cookie', res);\n};\n</code></pre>\n\n<p>It is the the same thing as if we just called</p>\n\n<blockquote>\n  <p><a href=\"http://IP_ADDRESS:PORT/set_cookie\" rel=\"nofollow noreferrer\">http://IP_ADDRESS:PORT/set_cookie</a></p>\n</blockquote>\n\n<p>But I can't get the cookie to the browser. Never. I get the response with status code 200 and everything seems to be okay, but I don't get a cookie.</p>\n\n<p>I have to mention, that this is a cross site thing.</p>\n\n<p>So, the question is: How could I pass cookie from server to client?</p>\n"}, {"tags": ["linux", "github", "go", "odbc"], "comments": [{"owner": {"reputation": 43, "user_id": 4830600, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-b_g0oUjFI10/AAAAAAAAAAI/AAAAAAAAGG8/xZjPaADem-E/photo.jpg?sz=128", "display_name": "vishal bhatia", "link": "https://stackoverflow.com/users/4830600/vishal-bhatia"}, "edited": false, "score": 0, "creation_date": 1506706949, "post_id": 46494173, "comment_id": 79942926, "body": "DSN is okay as we are able to connect using perl"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1506708718, "post_id": 46494173, "comment_id": 79943862, "body": "Did you follow the <a href=\"https://github.com/alexbrainman/odbc/wiki/GettingStartedOnLinux\" rel=\"nofollow noreferrer\">Getting Started on Linux</a> wiki? Did you successfully install <a href=\"https://github.com/alexbrainman/odbc/wiki/LinuxSQLDrivers\" rel=\"nofollow noreferrer\">the linux SQL drivers</a> and <a href=\"https://github.com/alexbrainman/odbc/wiki/InstallingUnixODBC\" rel=\"nofollow noreferrer\">unixODBC</a>?"}, {"owner": {"reputation": 43, "user_id": 4830600, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-b_g0oUjFI10/AAAAAAAAAAI/AAAAAAAAGG8/xZjPaADem-E/photo.jpg?sz=128", "display_name": "vishal bhatia", "link": "https://stackoverflow.com/users/4830600/vishal-bhatia"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1506709814, "post_id": 46494173, "comment_id": 79944329, "body": "Yes I am following the wiki and already checked that unixodbc is there                                       <code>-bash-4.2$ rpm -qa | grep -i unixodbc unixODBC-2.3.1-11.el7.x86_64 unixODBC-devel-2.3.1-11.el7.x86_64</code>"}, {"owner": {"reputation": 550, "user_id": 2665006, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f5fc5207efb9ca551f6c5f3e4804beca?s=128&d=identicon&r=PG", "display_name": "phage", "link": "https://stackoverflow.com/users/2665006/phage"}, "edited": false, "score": 0, "creation_date": 1538055139, "post_id": 46494173, "comment_id": 92015816, "body": "Did you also install the teradata driver?"}, {"owner": {"reputation": 15416, "user_id": 2441637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z8fpp.jpg?s=128&g=1", "display_name": "Hasan A Yousef", "link": "https://stackoverflow.com/users/2441637/hasan-a-yousef"}, "edited": false, "score": 0, "creation_date": 1604041171, "post_id": 46494173, "comment_id": 114231227, "body": "Have a look at this: <a href=\"https://www.cdata.com/kb/tech/teradata-odbc-go-linux.rst\" rel=\"nofollow noreferrer\">cdata.com/kb/tech/teradata-odbc-go-linux.rst</a>"}], "owner": {"reputation": 43, "user_id": 4830600, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-b_g0oUjFI10/AAAAAAAAAAI/AAAAAAAAGG8/xZjPaADem-E/photo.jpg?sz=128", "display_name": "vishal bhatia", "link": "https://stackoverflow.com/users/4830600/vishal-bhatia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1421, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1530165356, "creation_date": 1506706454, "question_id": 46494173, "link": "https://stackoverflow.com/questions/46494173/alexbrainman-odbc-golang-package-for-odbc-connection-panicking", "title": "alexbrainman/odbc golang package for odbc connection panicking", "body": "<p>I am trying to use alexbrainman/odbc package to connect to teradata, but it is panicking with the following error. I am running this on Linux  4.6.0-1.el7.elrepo.x86_64 </p>\n\n<pre><code>-bash-4.2$ go run bhn_equipment.go\npanic: SQLSetEnvUIntPtrAttr: {\u38336} \u3235\u2033\u38334\n\ngoroutine 1 [running]:\ngithub.com/alexbrainman/odbc.init.1()\n/home/xxx/github.com/src/github.com/alexbrainman/odbc/driver.go:72 +0x7f\ngithub.com/alexbrainman/odbc.init()\n/home/xxx/github.com/src/github.com/alexbrainman/odbc/utf16.go:56 +0x6c\nmain.init()\n/home/xxx/github.com/src/bhn/bhn_equipment.go:25 +0x4e\nexit status 2\n</code></pre>\n\n<p>here is my code\npackage main</p>\n\n<pre><code>import (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/alexbrainman/odbc\"\n)\n\nfunc main() {\n\ndb, err := sql.Open(\"odbc\", \"DSN=BHN-UAT\")\nif err != nil {\n        fmt.Println(\"Could not connect to db:\", err)\n}\n\nerr = db.Ping()\nif err != nil {\n        fmt.Println(\"got an error:\", err)\n}\n\nfmt.Println(\"Connection successful:\", db)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506704330, "post_id": 46493148, "comment_id": 79941626, "body": "One the servers you connect to is sending some unexpected data. There&#39;s not much you can do if the remote server doesn&#39;t work correctly. If most of the hosts are different, you could try setting <code>req.Close</code> so the Transport doesn&#39;t keep the idle connections at all. That however will slow you down significantly if each host is used many times."}, {"owner": {"reputation": 65, "user_id": 8629072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d5731c78f87782981828c2e3b18f5fb?s=128&d=identicon&r=PG&f=1", "display_name": "Stefano Conte", "link": "https://stackoverflow.com/users/8629072/stefano-conte"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506704889, "post_id": 46493148, "comment_id": 79941894, "body": "@JimB my problem is not print this error in terminal"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506704958, "post_id": 46493148, "comment_id": 79941928, "body": "You would have to disable the standard logger, which it appears you may be using. If you use a custom logger, you could turn off the default logger output."}], "owner": {"reputation": 65, "user_id": 8629072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d5731c78f87782981828c2e3b18f5fb?s=128&d=identicon&r=PG&f=1", "display_name": "Stefano Conte", "link": "https://stackoverflow.com/users/8629072/stefano-conte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3200, "favorite_count": 2, "answer_count": 0, "score": 5, "last_activity_date": 1506702291, "creation_date": 1506702291, "question_id": 46493148, "link": "https://stackoverflow.com/questions/46493148/golang-unsolicited-response-received-on-idle-http-channel-starting-with", "title": "golang : Unsolicited response received on idle HTTP channel starting with", "body": "<p>this is my actual code : </p>\n\n<pre><code>func cURL(cURL string, follow bool) (*string, error) {\n    var err error\n    var resp *http.Response\n    var req *http.Request\n\n    var u *url.URL\n    if u, err = url.Parse(cURL); nil != err {\n        if logLevel &gt;= 30 {\n            log.Print(\"ERROR: \", err)\n        }\n        return nil, err\n    }\n\n    if req, err = http.NewRequest(\"GET\", u.Scheme+\"://\"+u.Host+u.Path, nil); err != nil {\n        if logLevel &gt;= 40 {\n            log.Print(\"ERROR: \", err)\n        }\n        return nil, err\n    }\n    req.URL.RawQuery = u.RawQuery\n\n    client := &amp;http.Client{\n        Timeout: 3 * time.Second,  //timeout connexion\n    }\n    if resp, err = client.Do(req); nil != err {\n        if logLevel &gt;= 50 {\n            log.Print(\"ERROR: \", err)\n        }\n        return nil, err\n    }\n    defer resp.Body.Close()\n\n    var body []byte\n    if body, err = ioutil.ReadAll(resp.Body); nil != err {\n        if logLevel &gt;= 30 {\n            log.Print(\"ERROR: \", err)\n        }\n        return nil, err\n    }\n\n    var html string\n    html = string(body)\n\n    return &amp;html, nil\n}\n</code></pre>\n\n<p>same time print this error in terminal, i want to hide this :</p>\n\n<pre><code>2017/09/29 18:19:28 Unsolicited response received on idle HTTP channel starting with \"HTTP/1.0 408 Request Time-out\\r\\nServer: AkamaiGHost\\r\\nMime-Version: 1.0\\r\\nDate: Fri, 29 Sep 2017 16:18:21 GMT\\r\\nContent-Type: text/html\\r\\nContent-Length: 218\\r\\nExpires: Fri, 29 Sep 2017 16:18:21 GMT\\r\\n\\r\\n&lt;HTML&gt;&lt;HEAD&gt;\\n&lt;TITLE&gt;Request Timeout&lt;/TITLE&gt;\\n&lt;/HEAD&gt;&lt;BODY&gt;\\n&lt;H1&gt;Request Timeout&lt;/H1&gt;\\nThe server timed out while waiting for the browser's request.&lt;P&gt;\\nReference&amp;#32;&amp;#3\n</code></pre>\n\n<p>i want  to hide this error, not print in terminal, how i can do this ? Where im wrong ? i use this function for check large list urls if have specific keyword, the list is really big 50 milions urls.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506699967, "post_id": 46492318, "comment_id": 79939341, "body": "That&#39;s how Go works. You get back a new slice from the map index operation. Appending to this slice does append to this slice and doesn&#39;t do any magic trick like &quot;I stem from a map index operation so let&#39;s modify the map and not me.&quot;"}, {"owner": {"reputation": 1260, "user_id": 3893901, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1936c40432997826b9c180e11d010106?s=128&d=identicon&r=PG&f=1", "display_name": "jonathanGB", "link": "https://stackoverflow.com/users/3893901/jonathangb"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506700109, "post_id": 46492318, "comment_id": 79939436, "body": "That&#39;s interesting, I thought slices worked as basically pointers to arrays, so I thought the index action would return the pointers to that array. Thanks!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506702312, "post_id": 46492318, "comment_id": 79940705, "body": "@jonathanGB: slices do work like pointers to an array (a slice header contains a length, capacity, and the array pointer), but you want it to work like a pointer to a pointer to an array."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1506702528, "post_id": 46492318, "comment_id": 79940811, "body": "The slice itself is a plain value with copy semantics. The backing array it is viewing is shared. It <i>might</i> get updated during append or not, depending on the cap."}, {"owner": {"reputation": 1260, "user_id": 3893901, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1936c40432997826b9c180e11d010106?s=128&d=identicon&r=PG&f=1", "display_name": "jonathanGB", "link": "https://stackoverflow.com/users/3893901/jonathangb"}, "edited": false, "score": 0, "creation_date": 1506703956, "post_id": 46492318, "comment_id": 79941481, "body": "Oh, if I understand correctly the underlying array will be updated, but the len, cap and such slice&#39;s metadata will not be updated in the original slice because that data is copied during the index access?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506705196, "post_id": 46492318, "comment_id": 79942059, "body": "@jonathanGB: yes, but the array pointer is also part of that copy, so if the array needs to be reallocated that will be a different too."}], "answers": [{"comments": [{"owner": {"reputation": 1260, "user_id": 3893901, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1936c40432997826b9c180e11d010106?s=128&d=identicon&r=PG&f=1", "display_name": "jonathanGB", "link": "https://stackoverflow.com/users/3893901/jonathangb"}, "edited": false, "score": 0, "creation_date": 1506704074, "post_id": 46492481, "comment_id": 79941526, "body": "Thanks, well explained!"}, {"owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "edited": false, "score": 1, "creation_date": 1609524094, "post_id": 46492481, "comment_id": 115859763, "body": "<b>typed</b> <code>nil</code> is fine for first argument, untyped <code>nil</code> is not."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 10, "last_activity_date": 1600502760, "last_edit_date": 1600502760, "creation_date": 1506699887, "answer_id": 46492481, "question_id": 46492318, "link": "https://stackoverflow.com/questions/46492318/go-append-directly-to-slice-found-in-a-map/46492481#46492481", "title": "Go: append directly to slice found in a map", "body": "<p><code>append</code> returns a new slice if the underlying array has to grow to accomodate the new element. So yes, you have to put the new slice back into the map. This is no different from how strings work, for instance:</p>\n<pre><code>var x map[string]string\nx[&quot;a&quot;] = &quot;foo&quot;\n\ny := x[&quot;a&quot;]\ny = &quot;bar&quot;\n\n// x[&quot;a&quot;] is still &quot;foo&quot;\n</code></pre>\n<p>To get the behaviour you expected, you'd have to use slice pointers.</p>\n<pre><code>aminoAcidsToCodons := map[rune]*[]string{}\nfor codon, aminoAcid := range utils.CodonsToAminoAcid {\n    mappedAminoAcid := aminoAcidsToCodons[aminoAcid]\n    *mappedAminoAcid = append(*mappedAminoAcid, codon)\n}\n</code></pre>\n<p>That being said, since <code>nil</code> is a perfectly fine first argument for append, you can simplify your code  to</p>\n<pre><code>aminoAcidsToCodons := map[rune][]string{}\nfor codon, aminoAcid := range utils.CodonsToAminoAcid {\n    aminoAcidsToCodons[aminoAcid] = append(aminoAcidsToCodons[aminoAcid], codon)\n}\n</code></pre>\n"}], "owner": {"reputation": 1260, "user_id": 3893901, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1936c40432997826b9c180e11d010106?s=128&d=identicon&r=PG&f=1", "display_name": "jonathanGB", "link": "https://stackoverflow.com/users/3893901/jonathangb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6417, "favorite_count": 3, "accepted_answer_id": 46492481, "answer_count": 1, "score": 9, "last_activity_date": 1600502760, "creation_date": 1506699285, "question_id": 46492318, "link": "https://stackoverflow.com/questions/46492318/go-append-directly-to-slice-found-in-a-map", "title": "Go: append directly to slice found in a map", "body": "<p>I wanted to create a map of slices where values are appended to the corresponding slice. However, when trying to append directly to the slice returned by accessing it (see comment below), it would not be stored, so I had to go with the long form access (line below the comment).</p>\n\n<p>Why is it so? I expected the access to the map to return some sort of pointer, so in my mind <code>mappedAminoAcid == aminoAcidsToCodons[aminoAcid]</code>; clearly, I'm wrong.</p>\n\n<p>Thanks!</p>\n\n<pre><code>aminoAcidsToCodons := map[rune][]string{}\nfor codon, aminoAcid := range utils.CodonsToAminoAcid {\n    mappedAminoAcid, ok := aminoAcidsToCodons[aminoAcid]\n\n    if ok {\n        // NOT WORKING: mappedAminoAcid = append(mappedAminoAcid, codon)\n        aminoAcidsToCodons[aminoAcid] = append(mappedAminoAcid, codon)\n    } else {\n        aminoAcidsToCodons[aminoAcid] = []string{codon}\n    }\n}\n</code></pre>\n"}, {"tags": ["variables", "go", "type-conversion", "rounding"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1506698540, "post_id": 46491966, "comment_id": 79938499, "body": "You cannot. That&#39;s how floats work. Floats are not reals an simply <i>cannot</i> represent some decimal numbers. You either have to take great care and implement proper rounding or work with cents all the time or use a decimal type. This will get ugly pretty soon. Good luck."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1506699075, "post_id": 46491966, "comment_id": 79938783, "body": "If you want to understand why some values are impossible to represent, this post explains how floats work pretty well: <a href=\"http://fabiensanglard.net/floating_point_visually_explained/\" rel=\"nofollow noreferrer\">fabiensanglard.net/floating_point_visually_explained</a>"}, {"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 1, "creation_date": 1506699846, "post_id": 46491966, "comment_id": 79939249, "body": "and the corresponding backchannel of that blog post <a href=\"https://news.ycombinator.com/item?id=15359574\" rel=\"nofollow noreferrer\">news.ycombinator.com/item?id=15359574</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1506711404, "last_edit_date": 1506711404, "creation_date": 1506698537, "answer_id": 46492064, "question_id": 46491966, "link": "https://stackoverflow.com/questions/46491966/golang-float-to-int-conversion/46492064#46492064", "title": "Golang - float to int conversion", "body": "<h2>From <code>string</code> to float to integer</h2>\n\n<p>If you first want to start with parsing the amount to a float, then in the next step instead of converting, use <em>rounding</em>.</p>\n\n<p>Since conversion keeps the integer part, <strong>add <code>0.5</code> to it before converting</strong>. So if the fraction part was less than <code>0.5</code>, adding <code>0.5</code> will not increase the integer part and so after conversion the integer part will be the same (<em>rounding down</em>). If fraction part was greater than 0.5, adding 0.5 to it will increase the integer part, and after conversion we get 1 higher of the original integer part (<em>rounding up</em>).</p>\n\n<p>In your case, after multiplying by 100, add 0.5 before doing the conversion \n:</p>\n\n<pre><code>f := 655.17\ni := int(f*100 + 0.5)\nfmt.Println(i)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/Omc4eP6n2Z\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>65517\n</code></pre>\n\n<p>Read related question which covers this and more: <a href=\"https://stackoverflow.com/questions/39544571/golang-round-to-nearest-0-05/39544897#39544897\">Golang Round to Nearest 0.05</a></p>\n\n<h2>Parsing integer and fraction parts separately, as 2 integers</h2>\n\n<p>Another option is to skip floating point numbers entirely. To do that, we can parse the input <code>string</code> which supposed to hold a floating point number as 2 integers separated by a dot <code>.</code>: <code>\"dollars.cents\"</code> (where <code>dollars</code> and <code>cents</code> are both integers):</p>\n\n<pre><code>s := \"655.17\"\n\nvar dollars int64\nvar cents uint64\nif _, err := fmt.Sscanf(s, \"%d.%d\", &amp;dollars, &amp;cents); err != nil {\n    panic(err)\n}\nif cents &gt; 99 {\n    panic(\"cents cannot be greater than 99\")\n}\n\nvar total int64\nif dollars &gt;= 0 {\n    total = dollars*100 + int64(cents)\n} else {\n    total = dollars*100 - int64(cents)\n}\nfmt.Println(total)\n</code></pre>\n\n<p>Output again is (try it on the <a href=\"https://play.golang.org/p/JWBD3Bl3oF\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>65517\n</code></pre>\n\n<p>Note: The above parsing code requires you to enter cents using 2 digits, e.g. <code>655.70</code>, entering <code>655.7</code> would give bad results.</p>\n"}, {"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1506699214, "post_id": 46492200, "comment_id": 79938863, "body": "Except it&#39;s horrible UX to have users enter monetary values in cents (or the equivalent for the currency)."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1506699491, "post_id": 46492200, "comment_id": 79939018, "body": "It&#39;s not too hard to convert from user representations ( &#163; 23.00, or 3.43 or &#163;3) to a cent value, and format cents for display as currency for presentation to users. I wasn&#39;t advocating making users work in cents, just always storing in cents."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1506699822, "post_id": 46492200, "comment_id": 79939233, "body": "@KennyGrant Basically that&#39;s what asker wants to do: convert user input (dollars which was given as float) to integer (number of cents)."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 4, "creation_date": 1506705007, "post_id": 46492200, "comment_id": 79941956, "body": "No it\u2019s not, you don\u2019t have to convert to float"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 4, "last_activity_date": 1506708271, "last_edit_date": 1506708271, "creation_date": 1506699002, "answer_id": 46492200, "question_id": 46491966, "link": "https://stackoverflow.com/questions/46491966/golang-float-to-int-conversion/46492200#46492200", "title": "Golang - float to int conversion", "body": "<p>Don't use floats for currency. Use an integer representing cents instead. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    input := \"655.18\"\n    c := strings.Replace(input, \".\", \"\", -1)\n    cents, _ := strconv.ParseInt(c, 10, 64)\n    fmt.Println(cents)\n}\n</code></pre>\n\n<p>You should probably also tidy up user input as they may give you .40 or 4.50 or $40 but that's easy to do while it is a string and can be part of your conversion method. Do this before conversion and you can then parse the string as cents. You should have one stringToCents method for user input and one centsToString method for formatting the currency which are the boundaries, everywhere else use cents. </p>\n\n<p>If you parse and store as cents you will always have to explicitly convert to float where required for a calc and then back to cents, you will never be surprised by rounding rules or inaccuracies in the floats, as you then explicitly state which rounding is going to be used for each calculation (there are lots of arbitrary rules about rounding on currencies, this becomes necc. quite apart from the problems with floats). </p>\n\n<p>See the answers to this related question for more examples of where this will trip you up. </p>\n\n<p><a href=\"https://stackoverflow.com/questions/3730019/why-not-use-double-or-float-to-represent-currency\">Why not use Double or Float to represent currency?</a></p>\n"}], "owner": {"reputation": 427, "user_id": 6254868, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-coh80Kgp5wI/AAAAAAAAAAI/AAAAAAAAAEM/YAQYO15Emg0/photo.jpg?sz=128", "display_name": "\u041e\u043b\u0435\u0433 \u0421\u0438\u0434\u043e\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/6254868/%d0%9e%d0%bb%d0%b5%d0%b3-%d0%a1%d0%b8%d0%b4%d0%be%d1%80%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7907, "favorite_count": 1, "accepted_answer_id": 46492064, "answer_count": 2, "score": 5, "last_activity_date": 1506711404, "creation_date": 1506698220, "question_id": 46491966, "link": "https://stackoverflow.com/questions/46491966/golang-float-to-int-conversion", "title": "Golang - float to int conversion", "body": "<p>My problem looks like very simple, but I cat not solve it yet..\nUser enters a money amount xx.xx as a string. After that I convert string to float value (some dollars, some cents), for example, let it be 655.18 (float64)\nThen, I need to convert this amount to cents - 655.18*100 and the result is 65517.9999999, so when I cast this value to int, I get 65517, so 1 cent was lost.\nHow can I avoid this behaviour?</p>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc CheckParamsPur(sa string) (amount float64) {\n    amount, _ = strconv.ParseFloat(sa, 64)\n    return amount\n}\n\nfunc main() {\n\n    fmt.Print(\"Enter a number: \")\n    var input string\n    fmt.Scanf(\"%s\", &amp;input)\n    amount := int(CheckParamsPur(input) * (100))\n\n    fmt.Println(amount)\n\n}\n</code></pre>\n"}, {"tags": ["angular", "go", "cors", "swagger", "google-cloud-endpoints"], "comments": [{"owner": {"reputation": 1478, "user_id": 7385011, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ZoeRJ.jpg?s=128&g=1", "display_name": "FussinHussin", "link": "https://stackoverflow.com/users/7385011/fussinhussin"}, "edited": false, "score": 0, "creation_date": 1506700310, "post_id": 46488415, "comment_id": 79939545, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/36002493/no-access-control-allow-origin-header-in-angular-2-app\">No &#39;Access-Control-Allow-Origin&#39; header in Angular 2 app</a>"}, {"owner": {"reputation": 105, "user_id": 8228408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3bfad71f436bbd7d03d134544255d821?s=128&d=identicon&r=PG&f=1", "display_name": "Santosh Kumar", "link": "https://stackoverflow.com/users/8228408/santosh-kumar"}, "reply_to_user": {"reputation": 1478, "user_id": 7385011, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ZoeRJ.jpg?s=128&g=1", "display_name": "FussinHussin", "link": "https://stackoverflow.com/users/7385011/fussinhussin"}, "edited": false, "score": 0, "creation_date": 1506701656, "post_id": 46488415, "comment_id": 79940330, "body": "Hussain, The solution provided in the answer simply doesn&#39;t work."}, {"owner": {"reputation": 1478, "user_id": 7385011, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ZoeRJ.jpg?s=128&g=1", "display_name": "FussinHussin", "link": "https://stackoverflow.com/users/7385011/fussinhussin"}, "edited": false, "score": 0, "creation_date": 1506702038, "post_id": 46488415, "comment_id": 79940543, "body": "Hussain is not my name, have you gotten the http calls to work using curl bash? you are sure the requests are going through? is there any other info you can provide or clarify"}, {"owner": {"reputation": 105, "user_id": 8228408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3bfad71f436bbd7d03d134544255d821?s=128&d=identicon&r=PG&f=1", "display_name": "Santosh Kumar", "link": "https://stackoverflow.com/users/8228408/santosh-kumar"}, "reply_to_user": {"reputation": 1478, "user_id": 7385011, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ZoeRJ.jpg?s=128&g=1", "display_name": "FussinHussin", "link": "https://stackoverflow.com/users/7385011/fussinhussin"}, "edited": false, "score": 0, "creation_date": 1506702336, "post_id": 46488415, "comment_id": 79940721, "body": "Well Hussin, the http calls work using curl bash, and I am pretty sure the requests are going through."}, {"owner": {"reputation": 105, "user_id": 8228408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3bfad71f436bbd7d03d134544255d821?s=128&d=identicon&r=PG&f=1", "display_name": "Santosh Kumar", "link": "https://stackoverflow.com/users/8228408/santosh-kumar"}, "reply_to_user": {"reputation": 1478, "user_id": 7385011, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ZoeRJ.jpg?s=128&g=1", "display_name": "FussinHussin", "link": "https://stackoverflow.com/users/7385011/fussinhussin"}, "edited": false, "score": 1, "creation_date": 1506702443, "post_id": 46488415, "comment_id": 79940770, "body": "If you go through the question carefully, you have all the details to find out what is happening. Just a gentle reminder it is not just about angular, Please go through the question details carefully."}, {"owner": {"reputation": 1478, "user_id": 7385011, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ZoeRJ.jpg?s=128&g=1", "display_name": "FussinHussin", "link": "https://stackoverflow.com/users/7385011/fussinhussin"}, "edited": false, "score": 0, "creation_date": 1506702540, "post_id": 46488415, "comment_id": 79940814, "body": "have you tried using the CORS chrome extension just to see if it works?"}, {"owner": {"reputation": 105, "user_id": 8228408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3bfad71f436bbd7d03d134544255d821?s=128&d=identicon&r=PG&f=1", "display_name": "Santosh Kumar", "link": "https://stackoverflow.com/users/8228408/santosh-kumar"}, "reply_to_user": {"reputation": 1478, "user_id": 7385011, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ZoeRJ.jpg?s=128&g=1", "display_name": "FussinHussin", "link": "https://stackoverflow.com/users/7385011/fussinhussin"}, "edited": false, "score": 0, "creation_date": 1506702627, "post_id": 46488415, "comment_id": 79940857, "body": "Yes...It doesn&#39;t work"}, {"owner": {"reputation": 1478, "user_id": 7385011, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ZoeRJ.jpg?s=128&g=1", "display_name": "FussinHussin", "link": "https://stackoverflow.com/users/7385011/fussinhussin"}, "edited": false, "score": 0, "creation_date": 1506702757, "post_id": 46488415, "comment_id": 79940934, "body": "ah, alright... hmmm. I wonder if it could be a deeper issue then. I&#39;ll give you an upvote and see if this can get some traction"}], "answers": [{"tags": [], "owner": {"reputation": 105, "user_id": 8228408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3bfad71f436bbd7d03d134544255d821?s=128&d=identicon&r=PG&f=1", "display_name": "Santosh Kumar", "link": "https://stackoverflow.com/users/8228408/santosh-kumar"}, "is_accepted": true, "score": 0, "last_activity_date": 1506939024, "creation_date": 1506939024, "answer_id": 46523530, "question_id": 46488415, "link": "https://stackoverflow.com/questions/46488415/cors-issue-in-angular-4-frontend-with-google-cloud-endpoints-running-a-go-api-ba/46523530#46523530", "title": "CORS issue in Angular 4 frontend with Google Cloud Endpoints running a go API backend", "body": "<p>There was a silly mistake at my end. I missed out on a path component in Angular. It works fine now.</p>\n"}], "owner": {"reputation": 105, "user_id": 8228408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3bfad71f436bbd7d03d134544255d821?s=128&d=identicon&r=PG&f=1", "display_name": "Santosh Kumar", "link": "https://stackoverflow.com/users/8228408/santosh-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 769, "favorite_count": 1, "accepted_answer_id": 46523530, "answer_count": 1, "score": 2, "last_activity_date": 1506939024, "creation_date": 1506686524, "last_edit_date": 1506703770, "question_id": 46488415, "link": "https://stackoverflow.com/questions/46488415/cors-issue-in-angular-4-frontend-with-google-cloud-endpoints-running-a-go-api-ba", "title": "CORS issue in Angular 4 frontend with Google Cloud Endpoints running a go API backend", "body": "<p>I am unable to call API running in the google cloud behind cloud endpoints from the Angular 4 front end. I am getting following errors:<br><br>\n<em>Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin '<a href=\"http://localhost:4200\" rel=\"nofollow noreferrer\">http://localhost:4200</a>' is therefore not allowed access. The response had HTTP status code 403.</em><br></p>\n\n<p>I am running swagger too on the local machine and making successful API calls from swagger.<br>\nMy various settings are as follows:<br><br>\nOpenAPI(Swagger Specification):<br></p>\n\n<pre><code>host: MyApp.appspot.com\nx-google-endpoints:\n  - name: MyApp.appspot.com\n    allowCors: true\n</code></pre>\n\n<p><br>\n GO Server CORS Settings:&nbsp;&nbsp;&nbsp;<em>I am using \"github.com/rs/cors\" library</em></p>\n\n<pre><code>c := cors.New(cors.Options{\n        AllowedOrigins:   []string{\"*\"},\n        AllowedHeaders:   []string{\"*\"},\n        AllowedMethods:   []string{\"GET\", \"PUT\", \"POST\", \"HEAD\", \"POST\"},\n        AllowCredentials: true,\n    })\n</code></pre>\n\n<p><br>\nAngular 4 App:</p>\n\n<pre><code>const payloadHeaders = new Headers({'Access-Control-Allow-Origin' : 'http://localhost:4200','authorization':'Bearer *********'});\n    var url = 'https://MyApp.appspot.com/users/user?u=' + username;\n    this.http.get(url,{headers:payloadHeaders}).timeout(3000)\n    .map((response) =&gt; {\n      return response.json();\n    }).subscribe(\n</code></pre>\n\n<p><br></p>\n\n<p>The only difference between swagger and angular might be how they make http request...though I am not sure. Swagger origin is '127.0.0.1:64298' whereas Angular is 'localhost:4200'</p>\n\n<p>Does anyone know how I can overcome this CORS issue?</p>\n\n<blockquote>\n  <p>The Stackdriver log throws: Endpoints management skipped for an unrecognized >HTTP call: OPTIONS /users/user?u=xxxx@yyyy.com\n  But I think I have taken care of that in GO server itself. So it is a bit >confusing.</p>\n</blockquote>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 8, "creation_date": 1506686579, "post_id": 46488404, "comment_id": 79931223, "body": "That&#39;s how the language works. Please consult the Tour of Go or the Language Spec on constants. I hope you know that 257 does overflow a byte."}, {"owner": {"reputation": 167, "user_id": 7134723, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d20a110f4ed1ce268b4e78cb8b99c6ca?s=128&d=identicon&r=PG&f=1", "display_name": "binbin", "link": "https://stackoverflow.com/users/7134723/binbin"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506687262, "post_id": 46488404, "comment_id": 79931597, "body": "@Volker Yes,I know 257 does overflow a byte.So case 1,2 ok make me confuse"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1506687362, "post_id": 46488404, "comment_id": 79931638, "body": "The comment in the code is confusing. All four are overflows, but the last two were detected during compilation (as pointed by @Volker, consult language spec). The first two (<code>rv1</code> and <code>rv2</code>) are also overflow (at run-time), so it&#39;s not <i>ok</i>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1506687458, "post_id": 46488404, "comment_id": 79931688, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/39444852/does-go-compilers-evaluation-differ-for-constant-expression-and-other-expressio/39445372#39445372\">Does go compiler&#39;s evaluation differ for constant expression and other expression</a>."}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1506688084, "post_id": 46488404, "comment_id": 79932012, "body": "@putu  What is your definition of &quot;not ok&quot; ? The OP simply asks why the last 2 cases results in a compiler error, while the first 2 cases does not result in any error (and both will print the number 1)"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1506689525, "post_id": 46488404, "comment_id": 79932838, "body": "@nos, Yes, I understand the question, but when comparing the comments (first two lines, and last two lines), what came to my mind are: <i>the last two are overflows</i>, while the first two are &quot;ok&quot; (the meaning is too broad/confusing)."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 9, "last_activity_date": 1506687488, "creation_date": 1506687488, "answer_id": 46488692, "question_id": 46488404, "link": "https://stackoverflow.com/questions/46488404/go-convert-int-to-byte/46488692#46488692", "title": "Go convert int to byte", "body": "<p>Variable numeric values can be converted to smaller types, with the normal loss of the high bits.</p>\n\n<p>The compiler refuses to do this for constant values (that is clearly always an error). This is <a href=\"https://golang.org/ref/spec#Constants\" rel=\"noreferrer\">required by the spec</a> (emphasize mine):</p>\n\n<blockquote>\n  <p>Every implementation must:</p>\n  \n  <ul>\n  <li>Represent integer constants with at least 256 bits.</li>\n  <li>Represent floating-point constants, including the parts of a complex constant, > with a mantissa of at least 256 bits and a signed binary exponent of at least 16 bits.</li>\n  <li><strong>Give an error if unable to represent an integer constant precisely.</strong></li>\n  <li>Give an error if unable to represent a floating-point or complex constant due to overflow.</li>\n  <li>Round to the nearest representable constant if unable to represent a floating-point or complex constant due to limits on precision.</li>\n  </ul>\n  \n  <p><strong>These requirements apply both to literal constants and to the result of evaluating constant expressions.</strong></p>\n</blockquote>\n\n<p>Consequently, if you change <code>var x</code> and <code>var y</code> to <code>const x</code> and <code>const y</code>, you get an error for all four cases.</p>\n"}], "owner": {"reputation": 167, "user_id": 7134723, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d20a110f4ed1ce268b4e78cb8b99c6ca?s=128&d=identicon&r=PG&f=1", "display_name": "binbin", "link": "https://stackoverflow.com/users/7134723/binbin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2553, "favorite_count": 0, "accepted_answer_id": 46488692, "answer_count": 1, "score": 2, "last_activity_date": 1506687488, "creation_date": 1506686481, "last_edit_date": 1506687010, "question_id": 46488404, "link": "https://stackoverflow.com/questions/46488404/go-convert-int-to-byte", "title": "Go convert int to byte", "body": "<pre><code>var x uint64 = 257\nvar y int = 257\nfmt.Println(\"rv1 is \", byte(x))        // ok\nfmt.Println(\"rv2 is \", byte(y))        // ok\nfmt.Println(\"rv3 is \", byte(257))      // constant 257 overflows byte\nfmt.Println(\"rv4 is \", byte(int(257))) // constant 257 overflows byte \n</code></pre>\n\n<p>It is strange.</p>\n\n<p>All of them are converting int to byte,so all of them should be error.</p>\n\n<p>But case 1,2 is ok!</p>\n\n<p>How could be that?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1506683099, "post_id": 46487152, "comment_id": 79929286, "body": "nit-pick: The spelling is &quot;Entities&quot;, and Go doesn&#39;t have classes, so that term should be avoided."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1506723976, "post_id": 46487368, "comment_id": 79950157, "body": "A fun go trick is to use a <code>map[EntitiesClass]struct{}</code> because you never need to actually look at the <code>bool</code>. This saves the memory that would be used by the <code>bool</code> because using an empty <code>struct{}</code> value doesn&#39;t allocate any. <a href=\"https://dave.cheney.net/2014/03/25/the-empty-struct\" rel=\"nofollow noreferrer\">dave.cheney.net/2014/03/25/the-empty-struct</a>"}, {"owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1506849625, "post_id": 46487368, "comment_id": 79975890, "body": "@RayfenWindspear That&#39;s a nice one to use when the map is large. But otherwise for small maps using bool makes for a nicer syntax when checking presence in the map. <code>if m[x]</code> vs <code>if _, ok := m[x]; ok</code>"}], "tags": [], "owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "is_accepted": false, "score": 3, "last_activity_date": 1506682522, "creation_date": 1506682522, "answer_id": 46487368, "question_id": 46487152, "link": "https://stackoverflow.com/questions/46487152/how-to-compare-map-for-common-keys-and-print-the-output/46487368#46487368", "title": "How to compare Map for common keys and print the output?", "body": "<p>I can think of two ways to do this:</p>\n\n<ol>\n<li><p>Dedup your data before passing to the template execution</p>\n\n<p>This means you can pre-process the data before passing to <code>t.Execute</code> to eliminate duplicates. You can do this using something like:</p>\n\n<pre><code>m := map[EntitiesClass]bool{}\nfor _, ... {\n    m[ec] = true\n    // Or maybe you want to aggregate \"Container 1\"\n    // and \"Container 2\" in some way\n}\n</code></pre>\n\n<p>Then you can just pass the processed data and the template itself remains virtually unchanged</p></li>\n<li><p>Add a <a href=\"https://golang.org/pkg/text/template/#Template.Funcs\" rel=\"nofollow noreferrer\">custom function for your template</a></p>\n\n<p>This means you can add a normal go function that receives as many <code>EntitiesClass</code> as you like and returns them deduplicated (perhaps with the mechanism from option 1).</p>\n\n<p>You can even do something like:</p>\n\n<pre><code>{{if not customHaveSeenThisValueBefore }}\n   ...\n{{ endif }}\n</code></pre></li>\n</ol>\n\n<p>For your simple example I would choose option 1, it seems easiest to leave templates very simple.</p>\n"}, {"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 0, "last_activity_date": 1506693601, "creation_date": 1506693601, "answer_id": 46490423, "question_id": 46487152, "link": "https://stackoverflow.com/questions/46487152/how-to-compare-map-for-common-keys-and-print-the-output/46490423#46490423", "title": "How to compare Map for common keys and print the output?", "body": "<p>This applies some filtering logic. I'm using <code>text/template</code> because this code isn't using a server. It will work the same with <code>html/template</code>. When appending to slices of structs pointers have to be used. If you don't know why see <a href=\"https://stackoverflow.com/questions/18042439/go-append-to-slice-in-struct\">here</a>. <code>func isInSlice() bool</code> needs to be modded to your needs. This serves as an example.</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"text/template\"\n)\n\ntype Entitie struct {\n    Results []*Data\n}\n\ntype Data struct {\n    Name  string\n    Value int32\n}\n\n// Change this function to mod how to filter\nfunc (e *Entitie) isInSlice(name string) bool {\n    for _, item := range e.Results {\n        if item.Name == name {\n            return true\n        }\n    }\n    return false\n}\n\nfunc (e *Entitie) AddData(name string, value int32) {\n    if !e.isInSlice(name) {\n        e.Results = append(e.Results, &amp;Data{Name: name, Value: value})\n    }\n}\n\n// In the template, we use rangeStruct to turn our struct values\n// into a slice we can iterate over\nvar template = `\n    {{range $i, $e := .Data.Results}}\n        {{$e.Name}} = {{$e.Value}}\n    {{end}}\n    `\n\nfunc main() {\n    data := make(map[string]Entitie)\n\n    var entities Entitie\n\n    entities.AddData(\"test\", 15)\n    entities.AddData(\"test\", 15)\n    entities.AddData(\"test2\", 15)\n\n    t := template.New(\"t\")\n    t, err := t.Parse(template)\n    if err != nil {\n        panic(err)\n    }\n\n    data[\"Data\"] = entities\n\n    err = t.Execute(os.Stdout, data)\n    if err != nil {\n        panic(err)\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 6567017, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f15c20a561924f2ccabc0192e10c1b85?s=128&d=identicon&r=PG&f=1", "display_name": "Maddy_15", "link": "https://stackoverflow.com/users/6567017/maddy-15"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1506693601, "creation_date": 1506681793, "last_edit_date": 1506682979, "question_id": 46487152, "link": "https://stackoverflow.com/questions/46487152/how-to-compare-map-for-common-keys-and-print-the-output", "title": "How to compare Map for common keys and print the output?", "body": "<p>I have the following code which generates the following output</p>\n\n<p>code:</p>\n\n<pre><code>package main\n\nimport (\n    \"html/template\"\n    \"os\"\n)\n\ntype EntetiesClass struct {\n    Name  string\n    Value int32\n}\n\n// In the template, we use rangeStruct to turn our struct values\n// into a slice we can iterate over\nvar htmlTemplate = `{{range $index, $element := .}}\n{{range $element}}{{.Name}}={{.Value}}\n{{- end}}\n{{- end}}`\n\nfunc main() {\n    data := map[string][]EntetiesClass{\n            \"Container1\": {{\"Test\", 15}},\n            \"Container2\": {{\"Test\", 15}},\n    }\n\n    t := template.New(\"t\")\n    t, err := t.Parse(htmlTemplate)\n    if err != nil {\n            panic(err)\n    }\n\n    err = t.Execute(os.Stdout, data)\n    if err != nil {\n            panic(err)\n    }\n\n}\n</code></pre>\n\n<p>link: <a href=\"https://play.golang.org/p/yM9_wWmyLY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/yM9_wWmyLY</a><br>\nOutput:</p>\n\n<p>Test=15\nTest=15</p>\n\n<p>I want to compare the Container1 with Container2 and if they have common key, i just want to print output only once.</p>\n\n<p>Output:\nTest=15</p>\n\n<p>How can i achieve this? Any help is appreciated?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "edited": false, "score": 0, "creation_date": 1506675274, "post_id": 46484627, "comment_id": 79924841, "body": "This may happen if you have a lot of goroutines that are all blocked at the same time, ie. in system calls. Those threads do not count towards the GOMAXPROCS limitations, therefore more will be spawned. What are your goroutines doing?"}, {"owner": {"reputation": 629, "user_id": 5617371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1a62a220f8c2fb0fcbce483555ae120d?s=128&d=identicon&r=PG&f=1", "display_name": "leo", "link": "https://stackoverflow.com/users/5617371/leo"}, "reply_to_user": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "edited": false, "score": 0, "creation_date": 1506675924, "post_id": 46484627, "comment_id": 79925216, "body": "My goroutine just simply return a number. And my temporary solution is to limit the number of goroutines executing concurrently. When my program was executing,  I found that the incrementation memory is no more than 200M, and I still have very enough memory which is not used yet, so I still wonder whether golang itself has memory limitation"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506688356, "post_id": 46484627, "comment_id": 79932152, "body": "If you don&#39;t know why you have more than 2049 goroutines, get a full stack trace and look at what&#39;s there. You have blocked goroutines somewhere that are causing you to spawn more threads."}], "answers": [{"comments": [{"owner": {"reputation": 629, "user_id": 5617371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1a62a220f8c2fb0fcbce483555ae120d?s=128&d=identicon&r=PG&f=1", "display_name": "leo", "link": "https://stackoverflow.com/users/5617371/leo"}, "edited": false, "score": 0, "creation_date": 1506674196, "post_id": 46484747, "comment_id": 79924194, "body": "I keep monitoring memory usage percent when program executing, and I found that the incrementation memory is no more than 200M, and I still have very enough memory which is not used yet, so I still wonder whether golang itself has memory limitation."}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "reply_to_user": {"reputation": 629, "user_id": 5617371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1a62a220f8c2fb0fcbce483555ae120d?s=128&d=identicon&r=PG&f=1", "display_name": "leo", "link": "https://stackoverflow.com/users/5617371/leo"}, "edited": false, "score": 1, "creation_date": 1506675724, "post_id": 46484747, "comment_id": 79925091, "body": "@PengWu Even when there&#39;s enough memory, there might be a case for limitation using <code>ulimit</code> or some other reason. read:  <a href=\"https://stackoverflow.com/questions/1367373/python-subprocess-popen-oserror-errno-12-cannot-allocate-memory/13329386#13329386\" title=\"python subprocess popen oserror errno 12 cannot allocate memory\">stackoverflow.com/questions/1367373/&hellip;</a>"}], "tags": [], "owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "is_accepted": true, "score": 2, "last_activity_date": 1506673673, "creation_date": 1506673673, "answer_id": 46484747, "question_id": 46484627, "link": "https://stackoverflow.com/questions/46484627/golang-runtime-failed-to-create-new-os-thread-have-2049-already-errno-12/46484747#46484747", "title": "golang runtime: failed to create new OS thread (have 2049 already; errno=12)", "body": "<p>It's OS's limitation. I would assume you are using linux.</p>\n\n<p>According to <a href=\"https://golang.org/src/runtime/os_linux.go#L156\" rel=\"nofollow noreferrer\">the source of go</a>,\nit is calling <code>clone</code> system call</p>\n\n<pre><code>ret := clone(cloneFlags, stk, unsafe.Pointer(mp), unsafe.Pointer(mp.g0), unsafe.Pointer(funcPC(mstart)))\nsigprocmask(_SIG_SETMASK, &amp;oset, nil)\n\nif ret &lt; 0 {\n    print(\"runtime: failed to create new OS thread (have \", mcount(), \" already; errno=\", -ret, \")\\n\")\n    if ret == -_EAGAIN {\n        println(\"runtime: may need to increase max user processes (ulimit -u)\")\n    }\n    throw(\"newosproc\")\n}\n</code></pre>\n\n<p>from the <a href=\"http://man7.org/linux/man-pages/man2/clone.2.html#RETURN_VALUE\" rel=\"nofollow noreferrer\">manpage of clone(2)</a>, when the <code>errno=12</code>, the error reason is <a href=\"https://github.com/torvalds/linux/blob/master/include/uapi/asm-generic/errno-base.h\" rel=\"nofollow noreferrer\">out of memory</a></p>\n\n<pre><code>ENOMEM Cannot allocate sufficient memory to allocate a task structure\n              for the child, or to copy those parts of the caller's context\n              that need to be copied.\n</code></pre>\n"}], "owner": {"reputation": 629, "user_id": 5617371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1a62a220f8c2fb0fcbce483555ae120d?s=128&d=identicon&r=PG&f=1", "display_name": "leo", "link": "https://stackoverflow.com/users/5617371/leo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2339, "favorite_count": 1, "accepted_answer_id": 46484747, "answer_count": 1, "score": 0, "last_activity_date": 1506674624, "creation_date": 1506673086, "last_edit_date": 1506674624, "question_id": 46484627, "link": "https://stackoverflow.com/questions/46484627/golang-runtime-failed-to-create-new-os-thread-have-2049-already-errno-12", "title": "golang runtime: failed to create new OS thread (have 2049 already; errno=12)", "body": "<p>I created lots of goroutines on MacOs, and there was an error emitted when program executing.</p>\n\n<pre><code>goRoutineId = 3710, i = 3683, len(chan) = 2049\nruntime: failed to create new OS thread (have 2049 already; errno=12)\nfatal error: runtime.newosproc\n</code></pre>\n\n<p>So I wonder what the \"failed to create new OS thread\" means, is that an operating system limitation, of just golang has no ability to create more goroutine?\nThank you for helping me.</p>\n"}, {"tags": ["parsing", "go", "scanf"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1506671663, "post_id": 46482685, "comment_id": 79922816, "body": "What did you expect instead?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1506665443, "creation_date": 1506665443, "answer_id": 46482730, "question_id": 46482685, "link": "https://stackoverflow.com/questions/46482685/why-does-use-of-with-fmt-scanf-in-go-always-return-1/46482730#46482730", "title": "Why does use of := with fmt.Scanf in Go always return 1?", "body": "<p><a href=\"https://golang.org/pkg/fmt/#Scanf\" rel=\"noreferrer\"><code>fmt.Scanf()</code></a> returns the number of successfully scanned items:</p>\n\n<blockquote>\n  <p>Scanf scans text read from standard input, storing successive space-separated values into successive arguments as determined by the format. <strong>It returns the number of items successfully scanned.</strong> If that is less than the number of arguments, err will report why.</p>\n</blockquote>\n\n<p>So if your input is a valid integer number fitting into an <code>int</code>, <code>fmt.Scanf()</code> will succeed to parse it and store it in <code>n</code>, and so it will return 1.</p>\n\n<p>Should you input an invalid number (e.g. the <code>string</code> value <code>\"a\"</code>), scanning would not succeed, so <code>0</code> would be returned along with a non-<code>nil</code> error, like in this example:</p>\n\n<pre><code>var n int\na, err := fmt.Sscanf(\"a\", \"%d\", &amp;n)\nfmt.Println(a, err)\n</code></pre>\n\n<p>Which outputs (try it on the <a href=\"https://play.golang.org/p/QT0BRidlpT\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0 expected integer\n</code></pre>\n"}], "owner": {"reputation": 828, "user_id": 6234590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1666b3dd42c197b397efd3058c9b72c0?s=128&d=identicon&r=PG&f=1", "display_name": "Dylan", "link": "https://stackoverflow.com/users/6234590/dylan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 0, "closed_date": 1506676053, "accepted_answer_id": 46482730, "answer_count": 1, "score": -5, "last_activity_date": 1577083345, "creation_date": 1506665250, "last_edit_date": 1577083345, "question_id": 46482685, "link": "https://stackoverflow.com/questions/46482685/why-does-use-of-with-fmt-scanf-in-go-always-return-1", "closed_reason": "Needs details or clarity", "title": "Why does use of := with fmt.Scanf in Go always return 1?", "body": "<p>Here is the code: </p>\n\n<pre><code>var n int\na, _ := fmt.Scanf(\"%d\",&amp;n)\n</code></pre>\n\n<p>Then <code>a == 1</code>, <code>n</code> has changed its value by input. Why does use of <code>:=</code> with fmt.Scanf in Go always return 1?</p>\n"}, {"tags": ["windows", "winapi", "go", "setwindowshookex"], "comments": [{"owner": {"reputation": 870061, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 2, "creation_date": 1506668118, "post_id": 46482629, "comment_id": 79920991, "body": "It is &quot;SetWindowsHookExW&quot;, note the extra W.  Same idea as GetMessageW et al, you want the Unicode version of the function.  It will now fail on the next one, &quot;LowLevelKeyboardProc&quot; is not an exported function, merely a prototype for the callback function.  Just delete that one."}, {"owner": {"reputation": 85, "user_id": 7121482, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5cf0acff96ff334d6c2add43fcbe1ca1?s=128&d=identicon&r=PG&f=1", "display_name": "chunguang qu", "link": "https://stackoverflow.com/users/7121482/chunguang-qu"}, "reply_to_user": {"reputation": 870061, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 0, "creation_date": 1506747190, "post_id": 46482629, "comment_id": 79953959, "body": "Thanks, it solved my problem."}], "answers": [{"tags": [], "owner": {"reputation": 85, "user_id": 7121482, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5cf0acff96ff334d6c2add43fcbe1ca1?s=128&d=identicon&r=PG&f=1", "display_name": "chunguang qu", "link": "https://stackoverflow.com/users/7121482/chunguang-qu"}, "is_accepted": false, "score": 0, "last_activity_date": 1506747262, "creation_date": 1506747262, "answer_id": 46499717, "question_id": 46482629, "link": "https://stackoverflow.com/questions/46482629/failed-to-find-setwindowshookex-procedure-in-user32-dll/46499717#46499717", "title": "Failed to find SetWindowsHookEx procedure in user32.dll", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"syscall\"\n    \"unsafe\"\n\n    \"golang.org/x/sys/windows\"\n)\n\n// String returns a human-friendly display name of the hotkey\n// such as \"Hotkey[Id: 1, Alt+Ctrl+O]\"\nvar (\n    user32                  = windows.NewLazySystemDLL(\"user32.dll\")\n    procSetWindowsHookEx    = user32.NewProc(\"SetWindowsHookExW\")\n    procCallNextHookEx      = user32.NewProc(\"CallNextHookEx\")\n    procUnhookWindowsHookEx = user32.NewProc(\"UnhookWindowsHookEx\")\n    procGetMessage          = user32.NewProc(\"GetMessageW\")\n    procTranslateMessage    = user32.NewProc(\"TranslateMessage\")\n    procDispatchMessage     = user32.NewProc(\"DispatchMessageW\")\n    keyboardHook            HHOOK\n)\n\nconst (\n    WH_KEYBOARD_LL = 13\n    WH_KEYBOARD    = 2\n    WM_KEYDOWN     = 256\n    WM_SYSKEYDOWN  = 260\n    WM_KEYUP       = 257\n    WM_SYSKEYUP    = 261\n    WM_KEYFIRST    = 256\n    WM_KEYLAST     = 264\n    PM_NOREMOVE    = 0x000\n    PM_REMOVE      = 0x001\n    PM_NOYIELD     = 0x002\n    WM_LBUTTONDOWN = 513\n    WM_RBUTTONDOWN = 516\n    NULL           = 0\n)\n\ntype (\n    DWORD     uint32\n    WPARAM    uintptr\n    LPARAM    uintptr\n    LRESULT   uintptr\n    HANDLE    uintptr\n    HINSTANCE HANDLE\n    HHOOK     HANDLE\n    HWND      HANDLE\n)\n\ntype HOOKPROC func(int, WPARAM, LPARAM) LRESULT\n\ntype KBDLLHOOKSTRUCT struct {\n    VkCode      DWORD\n    ScanCode    DWORD\n    Flags       DWORD\n    Time        DWORD\n    DwExtraInfo uintptr\n}\n\n// http://msdn.microsoft.com/en-us/library/windows/desktop/dd162805.aspx\ntype POINT struct {\n    X, Y int32\n}\n\n// http://msdn.microsoft.com/en-us/library/windows/desktop/ms644958.aspx\ntype MSG struct {\n    Hwnd    HWND\n    Message uint32\n    WParam  uintptr\n    LParam  uintptr\n    Time    uint32\n    Pt      POINT\n}\n\nfunc SetWindowsHookEx(idHook int, lpfn HOOKPROC, hMod HINSTANCE, dwThreadId DWORD) HHOOK {\n    ret, _, _ := procSetWindowsHookEx.Call(\n        uintptr(idHook),\n        uintptr(syscall.NewCallback(lpfn)),\n        uintptr(hMod),\n        uintptr(dwThreadId),\n    )\n    return HHOOK(ret)\n}\n\nfunc CallNextHookEx(hhk HHOOK, nCode int, wParam WPARAM, lParam LPARAM) LRESULT {\n    ret, _, _ := procCallNextHookEx.Call(\n        uintptr(hhk),\n        uintptr(nCode),\n        uintptr(wParam),\n        uintptr(lParam),\n    )\n    return LRESULT(ret)\n}\n\nfunc UnhookWindowsHookEx(hhk HHOOK) bool {\n    ret, _, _ := procUnhookWindowsHookEx.Call(\n        uintptr(hhk),\n    )\n    return ret != 0\n}\n\nfunc GetMessage(msg *MSG, hwnd HWND, msgFilterMin uint32, msgFilterMax uint32) int {\n    ret, _, _ := procGetMessage.Call(\n        uintptr(unsafe.Pointer(msg)),\n        uintptr(hwnd),\n        uintptr(msgFilterMin),\n        uintptr(msgFilterMax))\n    return int(ret)\n}\n\nfunc TranslateMessage(msg *MSG) bool {\n    ret, _, _ := procTranslateMessage.Call(\n        uintptr(unsafe.Pointer(msg)))\n    return ret != 0\n}\n\nfunc DispatchMessage(msg *MSG) uintptr {\n    ret, _, _ := procDispatchMessage.Call(\n        uintptr(unsafe.Pointer(msg)))\n    return ret\n}\n\nfunc Start() {\n    // defer user32.Release()\n    keyboardHook = SetWindowsHookEx(WH_KEYBOARD_LL,\n        (HOOKPROC)(func(nCode int, wparam WPARAM, lparam LPARAM) LRESULT {\n            if nCode == 0 &amp;&amp; wparam == WM_KEYDOWN {\n                fmt.Println(\"key pressed:\")\n                kbdstruct := (*KBDLLHOOKSTRUCT)(unsafe.Pointer(lparam))\n                code := rune(kbdstruct.VkCode)\n                fmt.Printf(\"%q\", code)\n            }\n            return CallNextHookEx(keyboardHook, nCode, wparam, lparam)\n        }), 0, 0)\n    var msg MSG\n    for GetMessage(&amp;msg, 0, 0, 0) != 0 {\n        // TranslateMessage(msg)\n        // DispatchMessage(msg)\n    }\n\n    UnhookWindowsHookEx(keyboardHook)\n    keyboardHook = 0\n}\n\nfunc main() {\n    Start()\n}\n</code></pre>\n"}], "owner": {"reputation": 85, "user_id": 7121482, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5cf0acff96ff334d6c2add43fcbe1ca1?s=128&d=identicon&r=PG&f=1", "display_name": "chunguang qu", "link": "https://stackoverflow.com/users/7121482/chunguang-qu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 531, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1506747262, "creation_date": 1506664955, "last_edit_date": 1506670772, "question_id": 46482629, "link": "https://stackoverflow.com/questions/46482629/failed-to-find-setwindowshookex-procedure-in-user32-dll", "title": "Failed to find SetWindowsHookEx procedure in user32.dll", "body": "<p>OS: Windows 10 64bit\nGo version: <strong>go version go1.7 windows/amd64</strong> </p>\n\n<p>I get following error message when runing code. I tried to run it with administrators prividge, but still not work.</p>\n\n<p>I referenced following links,</p>\n\n<p><a href=\"https://github.com/AllenDang/w32\" rel=\"nofollow noreferrer\">https://github.com/AllenDang/w32</a></p>\n\n<p><a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms644990(v=vs.85).aspx\" rel=\"nofollow noreferrer\">https://msdn.microsoft.com/en-us/library/windows/desktop/ms644990(v=vs.85).aspx</a></p>\n\n<pre><code>panic: Failed to find SetWindowsHookEx procedure in user32.dll: The specified procedure could not be found.\ngoroutine 1 [running]:\npanic(0x4a7980, 0xc04206c3f0)\n    C:/Go/src/runtime/panic.go:500 +0x1af\ngolang.org/x/sys/windows.(*LazyProc).mustFind(0xc04206c240)\n    D:/repos/src/golang.org/x/sys/windows/dll_windows.go:286 +0x71\ngolang.org/x/sys/windows.(*LazyProc).Call(0xc04206c240, 0xc04203e480, 0x4, 0x4, 0xc042036058, 0x0, 0xc04206c360, 0xc04202def8)\n    D:/repos/src/golang.org/x/sys/windows/dll_windows.go:307 +0x36\nmain.SetWindowsHookEx(0xd, 0x4cab20, 0x0, 0xc000000000, 0x4bfe15)\n    d:/repos/src/github.com/quchunguang/trygo/demos/demo_windows_hook/main.go:85 +0xac\nmain.Start()\n    d:/repos/src/github.com/quchunguang/trygo/demos/demo_windows_hook/main.go:147 +0x52\nmain.main()\n    d:/repos/src/github.com/quchunguang/trygo/demos/demo_windows_hook/main.go:166 +0x1b\nexit status 2\nProcess exiting with code: 1\n</code></pre>\n\n<p>My code here.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"syscall\"\n    //~ \"time\"\n    \"unsafe\"\n\n    \"golang.org/x/sys/windows\"\n)\n\n// String returns a human-friendly display name of the hotkey\n// such as \"Hotkey[Id: 1, Alt+Ctrl+O]\"\nvar (\n    user32                  = windows.NewLazySystemDLL(\"user32.dll\")\n    procSetWindowsHookEx    = user32.NewProc(\"SetWindowsHookEx\")\n    procLowLevelKeyboard    = user32.NewProc(\"LowLevelKeyboardProc\")\n    procCallNextHookEx      = user32.NewProc(\"CallNextHookEx\")\n    procUnhookWindowsHookEx = user32.NewProc(\"UnhookWindowsHookEx\")\n    procGetMessage          = user32.NewProc(\"GetMessageW\")\n    procTranslateMessage    = user32.NewProc(\"TranslateMessage\")\n    procDispatchMessage     = user32.NewProc(\"DispatchMessageW\")\n    keyboardHook            HHOOK\n)\n\nconst (\n    WH_KEYBOARD_LL = 13\n    WH_KEYBOARD    = 2\n    WM_KEYDOWN     = 256\n    WM_SYSKEYDOWN  = 260\n    WM_KEYUP       = 257\n    WM_SYSKEYUP    = 261\n    WM_KEYFIRST    = 256\n    WM_KEYLAST     = 264\n    PM_NOREMOVE    = 0x000\n    PM_REMOVE      = 0x001\n    PM_NOYIELD     = 0x002\n    WM_LBUTTONDOWN = 513\n    WM_RBUTTONDOWN = 516\n    NULL           = 0\n)\n\ntype (\n    DWORD     uint32\n    WPARAM    uintptr\n    LPARAM    uintptr\n    LRESULT   uintptr\n    HANDLE    uintptr\n    HINSTANCE HANDLE\n    HHOOK     HANDLE\n    HWND      HANDLE\n)\n\ntype HOOKPROC func(int, WPARAM, LPARAM) LRESULT\n\ntype KBDLLHOOKSTRUCT struct {\n    VkCode      DWORD\n    ScanCode    DWORD\n    Flags       DWORD\n    Time        DWORD\n    DwExtraInfo uintptr\n}\n\n// http://msdn.microsoft.com/en-us/library/windows/desktop/dd162805.aspx\ntype POINT struct {\n    X, Y int32\n}\n\n// http://msdn.microsoft.com/en-us/library/windows/desktop/ms644958.aspx\ntype MSG struct {\n    Hwnd    HWND\n    Message uint32\n    WParam  uintptr\n    LParam  uintptr\n    Time    uint32\n    Pt      POINT\n}\n\nfunc SetWindowsHookEx(idHook int, lpfn HOOKPROC, hMod HINSTANCE, dwThreadId DWORD) HHOOK {\n    ret, _, _ := procSetWindowsHookEx.Call(\n        uintptr(idHook),\n        uintptr(syscall.NewCallback(lpfn)),\n        uintptr(hMod),\n        uintptr(dwThreadId),\n    )\n    return HHOOK(ret)\n}\n\nfunc CallNextHookEx(hhk HHOOK, nCode int, wParam WPARAM, lParam LPARAM) LRESULT {\n    ret, _, _ := procCallNextHookEx.Call(\n        uintptr(hhk),\n        uintptr(nCode),\n        uintptr(wParam),\n        uintptr(lParam),\n    )\n    return LRESULT(ret)\n}\n\nfunc UnhookWindowsHookEx(hhk HHOOK) bool {\n    ret, _, _ := procUnhookWindowsHookEx.Call(\n        uintptr(hhk),\n    )\n    return ret != 0\n}\n\nfunc GetMessage(msg *MSG, hwnd HWND, msgFilterMin uint32, msgFilterMax uint32) int {\n    ret, _, _ := procGetMessage.Call(\n        uintptr(unsafe.Pointer(msg)),\n        uintptr(hwnd),\n        uintptr(msgFilterMin),\n        uintptr(msgFilterMax))\n    return int(ret)\n}\n\nfunc TranslateMessage(msg *MSG) bool {\n    ret, _, _ := procTranslateMessage.Call(\n        uintptr(unsafe.Pointer(msg)))\n    return ret != 0\n}\n\nfunc DispatchMessage(msg *MSG) uintptr {\n    ret, _, _ := procDispatchMessage.Call(\n        uintptr(unsafe.Pointer(msg)))\n    return ret\n}\n\nfunc LowLevelKeyboardProc(nCode int, wParam WPARAM, lParam LPARAM) LRESULT {\n    ret, _, _ := procLowLevelKeyboard.Call(\n        uintptr(nCode),\n        uintptr(wParam),\n        uintptr(lParam),\n    )\n    return LRESULT(ret)\n}\n\nfunc Start() {\n    // defer user32.Release()\n    keyboardHook = SetWindowsHookEx(WH_KEYBOARD_LL,\n        (HOOKPROC)(func(nCode int, wparam WPARAM, lparam LPARAM) LRESULT {\n            if nCode == 0 &amp;&amp; wparam == WM_KEYDOWN {\n                fmt.Println(\"key pressed:\")\n                kbdstruct := (*KBDLLHOOKSTRUCT)(unsafe.Pointer(lparam))\n                code := byte(kbdstruct.VkCode)\n                fmt.Sprintf(\"%q\", code)\n            }\n            return CallNextHookEx(keyboardHook, nCode, wparam, lparam)\n        }), 0, 0)\n    var msg MSG\n    for GetMessage(&amp;msg, 0, 0, 0) != 0 {\n\n    }\n    //~ for {\n    //~\n    //~ GetMessage(uintptr(unsafe.Pointer(msg)), 0, 0, 0)\n    //~ TranslateMessage(msg)\n    //~ DispatchMessage(msg)\n    //~ // fmt.Println(\"key pressed:\")\n    //~\n    //~ }\n\n    UnhookWindowsHookEx(keyboardHook)\n    keyboardHook = 0\n}\n\nfunc main() {\n    Start()\n}\n</code></pre>\n"}, {"tags": ["c++", "go", "dll"], "owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 261, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1610824372, "creation_date": 1506664460, "last_edit_date": 1610824372, "question_id": 46482541, "link": "https://stackoverflow.com/questions/46482541/how-can-i-link-go-object-file-to-a-dynamic-library", "title": "How can I link Go object file to a dynamic library?", "body": "<p>I used <a href=\"https://github.com/swig/swig\" rel=\"nofollow noreferrer\"><code>swig</code></a> to wrap <code>c++</code> in my <code>golang</code> project, I find that <code>golang</code> build can do separately: </p>\n\n<ol>\n<li>generate object file </li>\n<li>link the object file to binary file</li>\n</ol>\n\n<p>like this(I get these from <a href=\"https://github.com/swig/swig/blob/836a57190e85ba0b178782697af4d5dc1cb20a64/Examples/Makefile.in#L1854\" rel=\"nofollow noreferrer\">makefile</a>):</p>\n\n<pre><code>go tool compile -pack -o runme.o runme.go\ngo tool link -linkmode external -extld \"g++\" -extldflags \"-I/include/boost-0\" -o runme runme.o\n</code></pre>\n\n<p>Anyway this works fine, but now I am facing a situation, I have to generate <code>c-share</code> library. I know that <code>go build</code> support <a href=\"https://golang.org/cmd/go/\" rel=\"nofollow noreferrer\"><code>-buildmode=c-shared</code></a>. </p>\n\n<p><strong>So can I link the object <code>runme.o</code> file to <code>librunme.so</code>?</strong></p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1506657028, "post_id": 46480918, "comment_id": 79917685, "body": "<a href=\"https://gobyexample.com/channels\" rel=\"nofollow noreferrer\">gobyexample.com/channels</a> it has more examples for channels"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506684948, "post_id": 46480918, "comment_id": 79930329, "body": "Only execute <code>defer resp.Body.Close()</code> if the error is nil. Otherwise resp is nil and your program will panic."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2775683"}, "edited": false, "score": 0, "creation_date": 1506654104, "post_id": 46481034, "comment_id": 79917040, "body": "Thanks for your reply! Even after I call a <code>make</code> on every channel in channels slice, the <code>ch &lt;-</code> or <code>&lt;-results</code> still seems to be blocking.  I am trying to create a specified number of goroutines. Each goroutine calls GET and POST in on a url for specified number of times and records the time taken to complete each iteration for each goroutine."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1506655629, "post_id": 46481034, "comment_id": 79917351, "body": "If the channels are unbuffered, any send or receive will block until the corresponding receive or send has executed, so those operations have to be in different goroutines. You have one goroutine trying to send and then trying to receive on a channel."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": false, "score": 1, "last_activity_date": 1506653471, "last_edit_date": 1506653471, "creation_date": 1506653129, "answer_id": 46481034, "question_id": 46480918, "link": "https://stackoverflow.com/questions/46480918/confusion-regarding-channel-directions-and-blocking-in-go/46481034#46481034", "title": "Confusion regarding channel directions and blocking in Go", "body": "<p>The channels in <code>channels</code> are <code>nil</code> (no <code>make</code> is executed; you make the slice but not the channels), so any send or receive will block. I'm not sure exactly what you're trying to do here, but that's the basic problem.</p>\n\n<p>See <a href=\"https://golang.org/doc/effective_go.html#channels\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html#channels</a> for an explanation of how channels work.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2775683"}, "edited": false, "score": 1, "creation_date": 1506664145, "post_id": 46481481, "comment_id": 79919443, "body": "Thank you very much for your reply and spending time to write a very clean code! I will try to learn more about semaphores and concurrency. I skimmed through Donovan and Kernighan book chapter on goroutines, Effective Go, Go by example, go concurrency patterns talk by Rob Pike, and Go tour but I guess it will take some more practice to understand these concepts.  I was trying to simulate what happens to my toy server when a large number of users simultaneously send GET and POST requests. All this is a part of a homework assignment and I am the only one using Go."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506686525, "post_id": 46481481, "comment_id": 79931189, "body": "Those are all great resources, you&#39;ll be learning Go in no time."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506686900, "post_id": 46481481, "comment_id": 79931403, "body": "Also there are a few modifications that can still be made above.  I&#39;d write few wrapper methods for the waitgroup stuff.  Eg.  <code>worker.wg.Add(1)</code>  is a bit gross, <code>worker.Add(1)</code> would be better.  I didn&#39;t do much about logging, but something needs to be done. I suggest you use something like this for logging.  <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">github.com/sirupsen/logrus</a>  also in goroutines use logs over fmt.  The <code>log</code> package is safe for concurrent use. Consider using time.Duration over floats <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#Duration</a> and <code>flag</code> over os.Args <a href=\"https://golang.org/pkg/flag/\" rel=\"nofollow noreferrer\">golang.org/pkg/flag</a>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506687588, "post_id": 46481481, "comment_id": 79931743, "body": "Also if you&#39;re testing a server written in Go the above code won&#39;t really load it to much.  The semaphore stops that, also you&#39;d want an infinite loop that either breaks on some timeout or signal. (both are defined channels in Go). You can also bench your server with <code>siege</code> <a href=\"https://www.joedog.org/siege-home/\" rel=\"nofollow noreferrer\">joedog.org/siege-home</a> or something like this <a href=\"https://github.com/btfak/sniper\" rel=\"nofollow noreferrer\">github.com/btfak/sniper</a>.. there are other like packages in the wild."}, {"owner": {"reputation": 3641, "user_id": 3139595, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/r1GRx.png?s=128&g=1", "display_name": "Edwin O.", "link": "https://stackoverflow.com/users/3139595/edwin-o"}, "edited": false, "score": 0, "creation_date": 1519021852, "post_id": 46481481, "comment_id": 84724287, "body": "would <code>w.result &lt;- Result{duration: secs, results: string(b)}</code> not block? will it not cause all go-routines to get stuck at that point and thereby never calling wg.done() ?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1519024334, "post_id": 46481481, "comment_id": 84725191, "body": "Channels with a fix capacity don&#39;t block unless the bucket is full, but that&#39;s okay since we want to limit the amount of work done anyway."}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 1, "last_activity_date": 1506687232, "last_edit_date": 1506687232, "creation_date": 1506656487, "answer_id": 46481481, "question_id": 46480918, "link": "https://stackoverflow.com/questions/46480918/confusion-regarding-channel-directions-and-blocking-in-go/46481481#46481481", "title": "Confusion regarding channel directions and blocking in Go", "body": "<p>I'm not really sure that you are doing... It seems really convoluted.  I suggest you read up on how to use channels.</p>\n\n<p><a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/2</a></p>\n\n<p>That being said you have so much going on in your code that it was much easier to just gut it to something a bit simpler. (It can be simplified further).  I left comments to understand the code.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"sync\"\n    \"time\"\n)\n\n// using structs is a nice way to organize your code\ntype Worker struct {\n    wg        sync.WaitGroup\n    semaphore chan struct{}\n    result    chan Result\n    client    http.Client\n}\n\n// group returns so that you don't have to send to many channels\ntype Result struct {\n    duration float64\n    results  string\n}\n\n// closing your channels will stop the for loop in main\nfunc (w *Worker) Close() {\n    close(w.semaphore)\n    close(w.result)\n}\n\nfunc (w *Worker) MakeRequest(url string) {\n    // a semaphore is a simple way to rate limit the amount of goroutines running at any single point of time\n    // google them, Go uses them often\n    w.semaphore &lt;- struct{}{}\n    defer func() {\n        w.wg.Done()\n        &lt;-w.semaphore\n    }()\n\n    start := time.Now()\n\n    resp, err := w.client.Get(url)\n    if err != nil {\n        log.Println(\"error\", err)\n        return\n    }\n    defer resp.Body.Close()\n\n    // don't have any examples where I need to also POST anything but the point should be made\n    // resp, err = http.Post(url, \"text/plain\", bytes.NewBuffer([]byte(\"Hey\")))\n    // if err != nil {\n    // log.Println(\"error\", err)\n    // return\n    // }\n    // defer resp.Body.Close()\n\n    secs := time.Since(start).Seconds()\n\n    b, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Println(\"error\", err)\n        return\n    }\n    w.result &lt;- Result{duration: secs, results: string(b)}\n}\n\nfunc main() {\n    urls := []string{\"https://facebook.com/\", \"https://twitter.com/\", \"https://google.com/\", \"https://youtube.com/\", \"https://linkedin.com/\", \"https://wordpress.org/\",\n        \"https://instagram.com/\", \"https://pinterest.com/\", \"https://wikipedia.org/\", \"https://wordpress.com/\", \"https://blogspot.com/\", \"https://apple.com/\",\n    }\n\n    workerNumber := 5\n    worker := Worker{\n        semaphore: make(chan struct{}, workerNumber),\n        result:    make(chan Result),\n        client:    http.Client{Timeout: 5 * time.Second},\n    }\n\n    // use sync groups to allow your code to wait for\n    // all your goroutines to finish\n    for _, url := range urls {\n        worker.wg.Add(1)\n        go worker.MakeRequest(url)\n    }\n\n    // by declaring wait and close as a seperate goroutine\n    // I can get to the for loop below and iterate on the results\n    // in a non blocking fashion\n    go func() {\n        worker.wg.Wait()\n        worker.Close()\n    }()\n\n    // do something with the results channel\n    for res := range worker.result {\n        fmt.Printf(\"Request took %2.f seconds.\\nResults: %s\\n\\n\", res.duration, res.results)\n    }\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2775683"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 1, "accepted_answer_id": 46481481, "answer_count": 2, "score": 0, "last_activity_date": 1506687232, "creation_date": 1506652191, "last_edit_date": 1506653747, "question_id": 46480918, "link": "https://stackoverflow.com/questions/46480918/confusion-regarding-channel-directions-and-blocking-in-go", "title": "Confusion regarding channel directions and blocking in Go", "body": "<p>In a function definition, if a channel is an argument without a direction, does it have to send or receive something?</p>\n\n<pre><code>func makeRequest(url string, ch chan&lt;- string, results chan&lt;- string) {\n    start := time.Now()\n\n    resp, err := http.Get(url)\n    defer resp.Body.Close()\n    if err != nil {\n        fmt.Printf(\"%v\", err)\n    }\n\n    resp, err = http.Post(url, \"text/plain\", bytes.NewBuffer([]byte(\"Hey\")))\n    defer resp.Body.Close()\n\n    secs := time.Since(start).Seconds()\n\n    if err != nil {\n        fmt.Printf(\"%v\", err)\n    }\n    // Cannot move past this.\n    ch &lt;- fmt.Sprintf(\"%f\", secs) \n    results &lt;- &lt;- ch\n}\n\nfunc MakeRequestHelper(url string, ch chan string, results chan string, iterations int) {\n    for i := 0; i &lt; iterations; i++ {\n        makeRequest(url, ch, results)\n    }\n    for i := 0; i &lt; iterations; i++ {\n        fmt.Println(&lt;-ch)\n    }\n}\n\nfunc main() {\n    args := os.Args[1:]\n    threadString := args[0]\n    iterationString := args[1]\n    url := args[2]\n    threads, err := strconv.Atoi(threadString)\n    if err != nil {\n        fmt.Printf(\"%v\", err)\n    }\n    iterations, err := strconv.Atoi(iterationString)\n    if err != nil {\n        fmt.Printf(\"%v\", err)\n    }\n\n    channels := make([]chan string, 100)\n    for i := range channels {\n        channels[i] = make(chan string)\n    }\n\n    // results aggregate all the things received by channels in all goroutines\n    results := make(chan string, iterations*threads)\n\n    for i := 0; i &lt; threads; i++ {\n        go MakeRequestHelper(url, channels[i], results, iterations)\n\n    }\n\n    resultSlice := make([]string, threads*iterations)\n    for i := 0; i &lt; threads*iterations; i++ {\n        resultSlice[i] = &lt;-results\n    }\n}\n</code></pre>\n\n<p>In the above code, </p>\n\n<blockquote>\n  <p>ch &lt;- or &lt;-results</p>\n</blockquote>\n\n<p>seems to be blocking every goroutine that executes makeRequest.</p>\n\n<p>I am new to concurrency model of Go. I understand that sending to and receiving from a channel blocks but find it difficult what is blocking what in this code.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1506650930, "post_id": 46480667, "comment_id": 79916335, "body": "Which terminal are you using ? according to <a href=\"https://stackoverflow.com/questions/35884965/gopath-error-in-windows-gopath-entry-is-relative-must-be-absolute-path\">this question</a>, it should be <code>c:\\Users\\Petey\\ </code> instead of <code>c:&#47;Users&#47;Petey&#47;</code>"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1506651091, "post_id": 46480667, "comment_id": 79916366, "body": "and don&#39;t forget to enclose with single quote (e.g <code>export GOPATH=&#39;C:\\Users\\Petey&#39;</code>)."}, {"owner": {"reputation": 55, "user_id": 8222762, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/022669532d632fa9c28ea4080d0d40c5?s=128&d=identicon&r=PG&f=1", "display_name": "Devologist", "link": "https://stackoverflow.com/users/8222762/devologist"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1506651811, "post_id": 46480667, "comment_id": 79916511, "body": "Peters-MacBook-Air:go Petey$ cat .bash_profile export GOPATH=c:\\Users\\Petey\\Documents\\go this is my bash profile pwd however, when I run a go file still the same error of path must be relative."}, {"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1506652333, "post_id": 46480667, "comment_id": 79916627, "body": "once you have a working GOPATH you may want its children dirs  :   pkg, src, bin   as per  <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a>"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1506654254, "post_id": 46480667, "comment_id": 79917068, "body": "@NewCoder are you using MacBook? please write your OS."}, {"owner": {"reputation": 55, "user_id": 8222762, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/022669532d632fa9c28ea4080d0d40c5?s=128&d=identicon&r=PG&f=1", "display_name": "Devologist", "link": "https://stackoverflow.com/users/8222762/devologist"}, "edited": false, "score": 0, "creation_date": 1506655856, "post_id": 46480667, "comment_id": 79917392, "body": "Yes I am using Macbook."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1506718412, "post_id": 46480667, "comment_id": 79948339, "body": "So to be clear, you&#39;re <i>not</i> using Microsoft Windows but macOS? In that case I don&#39;t quite follow why you&#39;re using a Windows path starting with a drive letter? Also, since Go 1.8 the GOPATH is automatically set to <code>$HOME&#47;go</code>, so you may not need to set it yourself at all!"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user2775683"}, "is_accepted": false, "score": 1, "last_activity_date": 1506653195, "creation_date": 1506653195, "answer_id": 46481044, "question_id": 46480667, "link": "https://stackoverflow.com/questions/46480667/configuring-golang-gopath-setup/46481044#46481044", "title": "configuring golang gopath setup", "body": "<p>You should quote the path like so:\nexport GOPATH=\"C:/Users/Petey/Documents/go\"</p>\n\n<p>Since it is Windows bash, you could also try:\nexport GOPATH=\"/mnt/c/Users/Petey/Documents/go\"</p>\n"}], "owner": {"reputation": 55, "user_id": 8222762, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/022669532d632fa9c28ea4080d0d40c5?s=128&d=identicon&r=PG&f=1", "display_name": "Devologist", "link": "https://stackoverflow.com/users/8222762/devologist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1495, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1506681870, "creation_date": 1506650364, "last_edit_date": 1506681870, "question_id": 46480667, "link": "https://stackoverflow.com/questions/46480667/configuring-golang-gopath-setup", "title": "configuring golang gopath setup", "body": "<p>When I run my <code>cat .bash_profile</code> command via terminal the following message is displayed:</p>\n\n<blockquote>\n  <p>export GOPATH=c:/Users/Petey/Documents/go</p>\n</blockquote>\n\n<p>I <code>cd</code> into the above, create a <code>main.go</code> and attempt to execute with <code>go run main.go</code>, but I receive this error. What am I doing incorrectly?</p>\n\n<blockquote>\n  <p>go: GOPATH entry is relative; must be absolute path: \"c\".</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1506632802, "post_id": 46478169, "comment_id": 79911765, "body": "What is <code>res</code>? Is is the same as <code>line</code> here?  You need to know what is generating that data in order to be certain of how to process it."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1506632845, "post_id": 46478169, "comment_id": 79911782, "body": "Is your container configured to be run with a TTY?"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506634016, "post_id": 46478169, "comment_id": 79912246, "body": "@jimB yes, the same, my bad, fixed in question"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1506634020, "post_id": 46478169, "comment_id": 79912248, "body": "@CharlesDuffy looks like its configured with TTY=false"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506634043, "post_id": 46478169, "comment_id": 79912259, "body": "BTW, converting bytes to a string should <i>never</i> crash without memory corruption or incorrect use of <code>unsafe</code>."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506634125, "post_id": 46478169, "comment_id": 79912285, "body": "@jimB Ive never seen it before, but as soon as I hit the string conversion the service bugs out, fixed by removing the prefix bytes"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 2, "creation_date": 1506634133, "post_id": 46478169, "comment_id": 79912289, "body": "(1, 0, 0, 0, 0, 0, 0, 88) X=88=length of the json just trim anything before { is encountered to be safe."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 2, "creation_date": 1506634468, "post_id": 46478169, "comment_id": 79912423, "body": "What <i>is</i> the software generating that JSON? If this were being done without the cooperation of the code generating the output, it wouldn&#39;t know the length. Which is to say that I&#39;m doubting presently that this is having anything to do with the Golang library you&#39;re using."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1506634622, "post_id": 46478169, "comment_id": 79912479, "body": "good spot - it is generated by a php laravel artisan command, nothing seen when run through the cli, not sure whats going on behind the scenes though"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1506641939, "post_id": 46478169, "comment_id": 79914500, "body": "Show the line of code where the app crashes. Show the panic message."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1506679391, "post_id": 46478169, "comment_id": 79927360, "body": "Cerise, I cant get a panic out of it, the service just dies, I have tried catching and printing and it never hits the code. but if the line after Readline were stringLine:= string(line) it would die"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1506680442, "post_id": 46478169, "comment_id": 79927897, "body": "I suspect the panic stops the event logging - I guess I could try logging to file and see if that logs the panic, ill give it a go and see if I can get an error I would like to get to the bottom of the crash"}], "answers": [{"comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1506680312, "post_id": 46479002, "comment_id": 79927840, "body": "Thanks Imars, that looks like the answer, Ill have a play today and accept once confirmed"}], "tags": [], "owner": {"reputation": 2422, "user_id": 2622394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d36f32e6280af5bb307cead90e3844f?s=128&d=identicon&r=PG", "display_name": "lmars", "link": "https://stackoverflow.com/users/2622394/lmars"}, "is_accepted": true, "score": 4, "last_activity_date": 1506636430, "creation_date": 1506636430, "answer_id": 46479002, "question_id": 46478169, "link": "https://stackoverflow.com/questions/46478169/explain-and-remove-useless-bytes-at-the-start-of-docker-exec-response/46479002#46479002", "title": "explain and remove useless bytes at the start of docker exec response", "body": "<p>The HTTP response you are getting back is the Docker stream format as documented <a href=\"https://docs.docker.com/engine/api/v1.32/#operation/ContainerAttach\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>You should consider using the <a href=\"https://godoc.org/github.com/moby/moby/pkg/stdcopy#StdCopy\" rel=\"nofollow noreferrer\"><code>github.com/docker/docker/pkg/stdcopy.StdCopy</code></a> function to demultiplex the stream into stdout / stderr.</p>\n"}], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 0, "accepted_answer_id": 46479002, "answer_count": 1, "score": 1, "last_activity_date": 1506636430, "creation_date": 1506632171, "last_edit_date": 1506633888, "question_id": 46478169, "link": "https://stackoverflow.com/questions/46478169/explain-and-remove-useless-bytes-at-the-start-of-docker-exec-response", "title": "explain and remove useless bytes at the start of docker exec response", "body": "<p>Im running the docker api function:</p>\n\n<p><a href=\"https://github.com/moby/moby/blob/master/client/container_exec.go#L38\" rel=\"nofollow noreferrer\">func (cli *Client) ContainerExecAttach(ctx context.Context, execID string, config types.ExecConfig) (types.HijackedResponse, error)</a></p>\n\n<p>When I read the response using the built in bufio reader:</p>\n\n<pre><code>line, _, err := resp.Reader.ReadLine()\n</code></pre>\n\n<p>I get no error but if I try to convert the bytes to a string the app crashes - the app in question is a windows service, and i think because of this I'm struggling to get an error out of it.</p>\n\n<p>I have now managed to view the output using (logs to event viewer):</p>\n\n<pre><code>logger.Infof(\"res: %q\", line)\n</code></pre>\n\n<p>the output from this is:</p>\n\n<blockquote>\n  <p>res:\n  \"\\x01\\x00\\x00\\x00\\x00\\x00\\x00X{\\\"updating\\\":false,\\\"scanning\\\":false,\\\"progress\\\":0,\\\"discovering\\\":false,\\\"registered\\\":false}\"</p>\n</blockquote>\n\n<p>Now, I was expecting the json but the funky prefix is most unwelcome, any idea what these bytes are are and why they are there? I'm hoping this will inform my next question; what is the cleanest way to remove them or not receive them in the first place? </p>\n\n<p>I'm currently left trimming the bytes by a fixed length but I think I need to do something more sophisticated. I'm thinking left trim these bytes: <code>\\x01</code> <code>\\x00</code> but not sure if I should expect any others</p>\n"}]