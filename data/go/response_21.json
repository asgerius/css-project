[{"tags": ["opengl", "go", "framebuffer", "post-processing"], "comments": [{"owner": {"reputation": 610, "user_id": 4964928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90267b06c0fe8f738c4269c8b46a708c?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Man", "link": "https://stackoverflow.com/users/4964928/erik-man"}, "edited": false, "score": 0, "creation_date": 1433366411, "post_id": 30630751, "comment_id": 49327488, "body": "Try adding some glGetError&#39;s to see if gl reports any errors. From my quick read though you don&#39;t unbind gl.BindTexture(gl.TEXTURE_2D, this.fboTex) which might cause problems (circular reference?) but it might be something else."}, {"owner": {"reputation": 123, "user_id": 687927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d89bad6553ab41249dc17b2c187fd87?s=128&d=identicon&r=PG", "display_name": "morcmarc", "link": "https://stackoverflow.com/users/687927/morcmarc"}, "reply_to_user": {"reputation": 610, "user_id": 4964928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90267b06c0fe8f738c4269c8b46a708c?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Man", "link": "https://stackoverflow.com/users/4964928/erik-man"}, "edited": false, "score": 0, "creation_date": 1433367281, "post_id": 30630751, "comment_id": 49327910, "body": "I tried unbinding it but didn&#39;t help. Is gl.Disable(gl.TEXTURE_2D) not enough by the way? Also forgot to mention that I based my post processing on the following <a href=\"http://en.wikibooks.org/wiki/OpenGL_Programming/Post-Processing\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/OpenGL_Programming/Post-Processing</a> if you prefer C++ syntax."}, {"owner": {"reputation": 610, "user_id": 4964928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90267b06c0fe8f738c4269c8b46a708c?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Man", "link": "https://stackoverflow.com/users/4964928/erik-man"}, "edited": false, "score": 0, "creation_date": 1433367998, "post_id": 30630751, "comment_id": 49328222, "body": "Yes, gl.Disable(gl.TEXTURE_2D) should be enough. I still recommend adding some glGetErrors though, or run it through glintercept <a href=\"https://github.com/dtrebilco/glintercept\" rel=\"nofollow noreferrer\">github.com/dtrebilco/glintercept</a> or similar."}], "answers": [{"tags": [], "owner": {"reputation": 123, "user_id": 687927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d89bad6553ab41249dc17b2c187fd87?s=128&d=identicon&r=PG", "display_name": "morcmarc", "link": "https://stackoverflow.com/users/687927/morcmarc"}, "is_accepted": false, "score": 0, "last_activity_date": 1433425974, "creation_date": 1433425974, "answer_id": 30645697, "question_id": 30630751, "link": "https://stackoverflow.com/questions/30630751/opengl-framebuffer-post-processing/30645697#30645697", "title": "OpenGL framebuffer post processing", "body": "<p>Found the problem: forgot to bind the vertex array in my post-processor's render cycle. Checked the code at <a href=\"http://en.wikibooks.org/wiki/OpenGL_Programming/Post-Processing\" rel=\"nofollow\">http://en.wikibooks.org/wiki/OpenGL_Programming/Post-Processing</a> and it's missing there too.</p>\n\n<p>Anyways, it was a good lesson and I feel I've got a better understanding of OpenGL now.</p>\n"}], "owner": {"reputation": 123, "user_id": 687927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d89bad6553ab41249dc17b2c187fd87?s=128&d=identicon&r=PG", "display_name": "morcmarc", "link": "https://stackoverflow.com/users/687927/morcmarc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 440, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1433425974, "creation_date": 1433365659, "last_edit_date": 1433365949, "question_id": 30630751, "link": "https://stackoverflow.com/questions/30630751/opengl-framebuffer-post-processing", "title": "OpenGL framebuffer post processing", "body": "<p>I'm trying to apply a simple vignette effect to my scene using a framebuffer and offscreen rendering. I was able to get the FBO and the effect working but for some reason my scene is not appearing at all. When the scene loads I can see the objects for a split second then it just goes \"blank\" (check attached gif). My understanding is that the scene is rendered into the FBO correctly (otherwise it wouldn't be visible at all, not even for a short time), but for some reason it is wiped out by something.</p>\n\n<p>Source files: gist.github.com/morcmarc/31a02dbbd9aad2955f47</p>\n\n<p><a href=\"http://postimg.org/image/wvhuestr3/\" rel=\"nofollow\">http://postimg.org/image/wvhuestr3/</a></p>\n\n<p>For comparison, this is how it looks rendered directly onto the built-in framebuffer. Just to show the scene seems to be rendering properly.</p>\n\n<p><a href=\"http://postimg.org/image/jegkle3z9/\" rel=\"nofollow\">http://postimg.org/image/jegkle3z9/</a></p>\n"}, {"tags": ["go", "cockroachdb"], "answers": [{"comments": [{"owner": {"reputation": 4720, "user_id": 503413, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/npSsL.jpg?s=128&g=1", "display_name": "Olimpiu POP", "link": "https://stackoverflow.com/users/503413/olimpiu-pop"}, "edited": false, "score": 0, "creation_date": 1435130066, "post_id": 30630458, "comment_id": 50065412, "body": "you should mark your response as answer, it will be quite helpful"}], "tags": [], "owner": {"reputation": 20703, "user_id": 2805033, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TasHL.jpg?s=128&g=1", "display_name": "Ben Darnell", "link": "https://stackoverflow.com/users/2805033/ben-darnell"}, "is_accepted": true, "score": 8, "last_activity_date": 1433364679, "creation_date": 1433364679, "answer_id": 30630458, "question_id": 30630456, "link": "https://stackoverflow.com/questions/30630456/in-cockroachdb-how-do-batches-and-transactions-interact/30630458#30630458", "title": "In CockroachDB, how do batches and transactions interact?", "body": "<p>A <em>batch</em> is a collection of operations that are sent to the server as a single unit for efficiency. It is equivalent to sending the same operations as individual requests from different threads.  Requests in a batch may be executed out of order, and it's possible for some operations in a batch to succeed while others fail.</p>\n\n<p>In Go, batches are created with the batcher object <a href=\"https://godoc.org/github.com/cockroachdb/cockroach/client#DB\" rel=\"noreferrer\"><code>DB.B</code></a>, and must be passed to <code>DB.Run()</code>. For example:</p>\n\n<pre><code>err := db.Run(db.B.Put(\"a\", \"1\").Put(\"b\", \"2\"))\n</code></pre>\n\n<p>is equivalent to:</p>\n\n<pre><code>_, err1 := db.Put(\"a\", \"1\")\n_, err2 := db.Put(\"b\", \"2\")\n</code></pre>\n\n<p>A <em>transaction</em> defines a consistent and atomic sequence of operations. Transactions guarantee consistency with respect to all other operations in the system: the results of a transaction cannot be seen unless and until the transaction is committed. Since transactions may need to be retried, transactions are defined by function objects (typically closures) which may be called multiple times.</p>\n\n<p>In Go, transactions are created with the <a href=\"https://godoc.org/github.com/cockroachdb/cockroach/client#DB.Tx\" rel=\"noreferrer\">DB.Tx</a> method. The <a href=\"https://godoc.org/github.com/cockroachdb/cockroach/client#Tx\" rel=\"noreferrer\"><code>*client.Tx</code></a> parameter to the closure implements a similar interface to <a href=\"https://godoc.org/github.com/cockroachdb/cockroach/client#DB\" rel=\"noreferrer\"><code>DB</code></a>; inside the transaction you must perform all your operations on this object instead of the original DB. If your function returns an error, the transaction will be aborted; otherwise it will commit. Here is a transactional version of the previous example (but see below for a more efficient version):</p>\n\n<pre><code>err := db.Tx(func(tx *client.Tx) error {\n    err := tx.Put(\"a\", \"1\")\n    if err != nil {\n        return err\n    }\n    return tx.Put(\"b\", \"2\")\n})\n</code></pre>\n\n<p>The previous example waits for the \"a\" write to complete before starting the \"b\" write, and then waits for the \"b\" write to complete before committing the transaction. It is possible to make this more efficient by using batches inside the transaction. <code>Tx.B</code> is a batcher object, just like <code>DB.B</code>. In a transaction, you can run batches with either <a href=\"https://godoc.org/github.com/cockroachdb/cockroach/client#Tx.Run\" rel=\"noreferrer\"><code>Tx.Run</code></a> or <a href=\"https://godoc.org/github.com/cockroachdb/cockroach/client#Tx.Commit\" rel=\"noreferrer\"><code>Tx.Commit</code></a>. <code>Tx.Commit</code> will commit the transaction if and only if all other operations in the batch succeed, and is more efficient than letting the transaction commit automatically when the closure returns. It is a good practice to always make the last operation in a transaction a batch executed by <code>Tx.Commit</code>:</p>\n\n<pre><code>err := db.Tx(func(tx *client.Tx) error {\n    return tx.Commit(tx.B.Put(\"a\", \"1\").Put(\"b\", \"2\"))\n})\n</code></pre>\n"}], "owner": {"reputation": 20703, "user_id": 2805033, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TasHL.jpg?s=128&g=1", "display_name": "Ben Darnell", "link": "https://stackoverflow.com/users/2805033/ben-darnell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 641, "favorite_count": 0, "accepted_answer_id": 30630458, "answer_count": 1, "score": 6, "last_activity_date": 1433364679, "creation_date": 1433364679, "question_id": 30630456, "link": "https://stackoverflow.com/questions/30630456/in-cockroachdb-how-do-batches-and-transactions-interact", "title": "In CockroachDB, how do batches and transactions interact?", "body": "<p>When should I use batches and when should I use transactions? Can I embed a transaction in a batch? A batch in a transaction?</p>\n"}, {"tags": ["json", "google-app-engine", "go", "google-cloud-storage"], "comments": [{"owner": {"reputation": 3386, "user_id": 1668204, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0bc95f5cf4f7a5da0f8c3d9bd745ab45?s=128&d=identicon&r=PG", "display_name": "tx802", "link": "https://stackoverflow.com/users/1668204/tx802"}, "edited": false, "score": 0, "creation_date": 1433399298, "post_id": 30629659, "comment_id": 49337811, "body": "Seems like Datastore would be more suitable for this kind of job. Is there a reason you&#39;re using GCS? If the objects change infrequently and are read frequently, look at memcache."}, {"owner": {"reputation": 127, "user_id": 2284019, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5da76f7ed150b38a3db00413d3976f67?s=128&d=identicon&r=PG", "display_name": "Dede", "link": "https://stackoverflow.com/users/2284019/dede"}, "reply_to_user": {"reputation": 3386, "user_id": 1668204, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0bc95f5cf4f7a5da0f8c3d9bd745ab45?s=128&d=identicon&r=PG", "display_name": "tx802", "link": "https://stackoverflow.com/users/1668204/tx802"}, "edited": false, "score": 0, "creation_date": 1433434180, "post_id": 30629659, "comment_id": 49361312, "body": "I&#39;m using GCS because the app was built with that so It will be hard to rewrite everything. I&#39;m sure there is a way to read the content returned by rc, err := storage.NewReader(d.ctx, bucket, fileName) and decomposed it as needed."}], "owner": {"reputation": 127, "user_id": 2284019, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5da76f7ed150b38a3db00413d3976f67?s=128&d=identicon&r=PG", "display_name": "Dede", "link": "https://stackoverflow.com/users/2284019/dede"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 926, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1433361983, "creation_date": 1433361983, "question_id": 30629659, "link": "https://stackoverflow.com/questions/30629659/list-bucket-content-by-name-gcs-go", "title": "list bucket content by name GCS go", "body": "<p>I'm trying to read the content of a bucket on Google Cloud Storage using GO.\nI'm able to do that, but is is very slow.</p>\n\n<p>The content of the bucket is like this:</p>\n\n<pre><code>bucket name \n-&gt; folders with alphanumeric characters\n----&gt; 5 files into each of the folder\n--------&gt; each file has a json array inside\n</code></pre>\n\n<p>what I want to do is to inspect the content of the jsons files for all the folders in the bucket and look for a specific value. The following code work, but it is very slow:</p>\n\n<pre><code>package backend\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"golang.org/x/net/context\"\n    \"golang.org/x/oauth2\"\n    \"golang.org/x/oauth2/google\"\n    \"google.golang.org/appengine\"\n    \"google.golang.org/appengine/file\"\n    \"google.golang.org/appengine/urlfetch\"\n    \"google.golang.org/cloud\"\n    \"google.golang.org/cloud/storage\"\n    \"io\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nvar bucket = \"bucket_Name\"\n\ntype jsonStruct struct {\n    Gender string `json:\"gender\"`\n    Age    string `json:\"age\"`\n    ID     string `json:\"id\"`\n    Done   int    `json:\"done\"`\n}\n\ntype saveData struct {\n    c       context.Context\n    r       *http.Request       //http response\n    w       http.ResponseWriter //http writer\n    ctx     context.Context\n    cleanUp []string // cleanUp is a list of filenames that need cleaning up at the end of the saving.\n    failed  bool     // failed indicates that one or more of the saving steps failed.\n}\n\nfunc init() {\n    http.HandleFunc(\"/\", handleStatic)\n    http.HandleFunc(\"/listBuckets\", listBuckets)\n}\n\nfunc handleStatic(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Cache-Control\", \"no-cache\")\n    http.ServeFile(w, r, \"static/\"+r.URL.Path)\n}\n\nfunc listBuckets(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n    if bucket == \"\" {\n        var err error\n        if bucket, err = file.DefaultBucketName(c); err != nil {\n            // log.Errorf(c, \"failed to get default GCS bucket name: %v\", err)\n            return\n        }\n    }\n    hc := &amp;http.Client{\n        Transport: &amp;oauth2.Transport{\n            Source: google.AppEngineTokenSource(c, storage.ScopeFullControl),\n            Base:   &amp;urlfetch.Transport{Context: c},\n        },\n    }\n    ctx := cloud.NewContext(appengine.AppID(c), hc)\n\n    // structure to holds information needed to run the various saving functions\n    d := &amp;saveData{\n        c:   c,\n        r:   r,\n        w:   w,\n        ctx: ctx,\n    }\n\n    d.listBucket(bucket)\n}\n\nfunc (d *saveData) errorf(format string, args ...interface{}) {\n    d.failed = true\n    // log.Errorf(d.c, format, args...)\n}\n\nfunc (d *saveData) listBucket(bucket string) {\n    io.WriteString(d.w, \"\\nListbucket result:\\n\")\n\n    query := &amp;storage.Query{}\n    for query != nil {\n        objs, err := storage.ListObjects(d.ctx, bucket, query)\n        if err != nil {\n            d.errorf(\"listBucket: unable to list bucket %q: %v\", bucket, err)\n            return\n        }\n        query = objs.Next\n        for _, obj := range objs.Results {\n            d.readFile(obj.Name)\n        }\n\n    }\n}\n\nfunc (d *saveData) readFile(fileName string) {\n\n    rc, err := storage.NewReader(d.ctx, bucket, fileName)\n    if err != nil {\n        d.errorf(\"readFile: unable to open file from bucket %q, file %q: %v\", bucket, fileName, err)\n        return\n    }\n    defer rc.Close()\n    slurp, err := ioutil.ReadAll(rc)\n    if err != nil {\n        d.errorf(\"readFile: unable to read data from bucket %q, file %q: %v\", bucket, fileName, err)\n        return\n    }\n    var userDetails jsonStruct\n    err1 := json.Unmarshal(slurp, &amp;userDetails)\n    if err1 != nil {\n        d.errorf(\"readFile: %v\", err1)\n        return\n    }\n    fmt.Fprintf(d.w, \"done is: %v\\n\", userDetails.Done)\n}\n</code></pre>\n\n<p>Basically now I'm reading the folder name from the bucket and then I read the content using the folder name. It would be possible to cache all the bucket content in a go variable and then work on that variable instead of read the bucket for each folder?</p>\n\n<p>I really need this to be faster because I need to present the result back in real time.</p>\n\n<p>Thanks a lot</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1433343120, "post_id": 30623185, "comment_id": 49313080, "body": "update your installation of Go"}, {"owner": {"reputation": 427, "user_id": 4213664, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1TCzb.png?s=128&g=1", "display_name": "ZedsWhatSheSaid", "link": "https://stackoverflow.com/users/4213664/zedswhatshesaid"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1433343651, "post_id": 30623185, "comment_id": 49313543, "body": "@JimB that is the newest installation"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1433343759, "post_id": 30623185, "comment_id": 49313624, "body": "Show the output of <code>go env</code> and <code>go version</code>.  <code>crypto.Signer</code> was added in go1.4. You should be using go1.4.2"}, {"owner": {"reputation": 3330, "user_id": 1075324, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/750Qe.jpg?s=128&g=1", "display_name": "Abhijeet Kasurde", "link": "https://stackoverflow.com/users/1075324/abhijeet-kasurde"}, "edited": false, "score": 2, "creation_date": 1433400685, "post_id": 30623185, "comment_id": 49338563, "body": "It seems that you have errors in getting cfssl. Because Github page says you need to have Go lang version 1.4 atleast."}], "answers": [{"tags": [], "owner": {"reputation": 3330, "user_id": 1075324, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/750Qe.jpg?s=128&g=1", "display_name": "Abhijeet Kasurde", "link": "https://stackoverflow.com/users/1075324/abhijeet-kasurde"}, "is_accepted": true, "score": 3, "last_activity_date": 1433401041, "creation_date": 1433401041, "answer_id": 30637007, "question_id": 30623185, "link": "https://stackoverflow.com/questions/30623185/bash-cfssl-command-not-found/30637007#30637007", "title": "-bash: cfssl: command not found", "body": "<p>It seems that you have errors in getting <a href=\"https://github.com/cloudflare/cfssl\" rel=\"nofollow\">cfssl</a>.</p>\n\n<p>Because <a href=\"https://github.com/cloudflare/cfssl#cloudflares-pkitls-toolkit\" rel=\"nofollow\">Cloudflare's Github page</a> says you require to have Go lang version 1.4 atleast.</p>\n\n<p>If you download and install go 1.4 and get cfssl, then binary will be created in \n<code>$GOPATH/bin/cfssl</code> </p>\n\n<p>Refer $GOPATH variable - <a href=\"https://golang.org/doc/code.html#GOPATH\" rel=\"nofollow\">here</a></p>\n"}, {"comments": [{"owner": {"reputation": 2402, "user_id": 8123139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToseE.jpg?s=128&g=1", "display_name": "AATHITH RAJENDRAN", "link": "https://stackoverflow.com/users/8123139/aathith-rajendran"}, "edited": false, "score": 0, "creation_date": 1553254821, "post_id": 54898049, "comment_id": 97325950, "body": "when i use the cmd <code>make</code> i  get the following error   <code>exec: &quot;gcc&quot;: executable file not found in $PATH Makefile:5: recipe for target &#39;bin&#47;cfssl&#39; failed make: *** [bin&#47;cfssl] Error 2</code>"}, {"owner": {"reputation": 694, "user_id": 3800106, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/gGcrp.jpg?s=128&g=1", "display_name": "Gauraang Khurana", "link": "https://stackoverflow.com/users/3800106/gauraang-khurana"}, "reply_to_user": {"reputation": 2402, "user_id": 8123139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToseE.jpg?s=128&g=1", "display_name": "AATHITH RAJENDRAN", "link": "https://stackoverflow.com/users/8123139/aathith-rajendran"}, "edited": false, "score": 0, "creation_date": 1576109938, "post_id": 54898049, "comment_id": 104796319, "body": "Same issue, how did you fix it @AATHITHRAJENDRAN"}, {"owner": {"reputation": 2402, "user_id": 8123139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToseE.jpg?s=128&g=1", "display_name": "AATHITH RAJENDRAN", "link": "https://stackoverflow.com/users/8123139/aathith-rajendran"}, "reply_to_user": {"reputation": 694, "user_id": 3800106, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/gGcrp.jpg?s=128&g=1", "display_name": "Gauraang Khurana", "link": "https://stackoverflow.com/users/3800106/gauraang-khurana"}, "edited": false, "score": 0, "creation_date": 1576209086, "post_id": 54898049, "comment_id": 104833095, "body": "I haven&#39;t :( @GauraangKhurana"}], "tags": [], "owner": {"reputation": 171, "user_id": 8028778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29f1dc8adde33bd073264559b5d65eb3?s=128&d=identicon&r=PG&f=1", "display_name": "Kasun Palihakkara", "link": "https://stackoverflow.com/users/8028778/kasun-palihakkara"}, "is_accepted": false, "score": 0, "last_activity_date": 1551244905, "last_edit_date": 1551244905, "creation_date": 1551241607, "answer_id": 54898049, "question_id": 30623185, "link": "https://stackoverflow.com/questions/30623185/bash-cfssl-command-not-found/54898049#54898049", "title": "-bash: cfssl: command not found", "body": "<p><strong>Install Go lang version latest.</strong></p>\n\n<p>1.yum update</p>\n\n<p>2.wget <a href=\"https://dl.google.com/go/go1.12.linux-amd64.tar.gz\" rel=\"nofollow noreferrer\">https://dl.google.com/go/go1.12.linux-amd64.tar.gz</a></p>\n\n<p>3.tar -xzf go1.12.linux-amd64.tar.gz</p>\n\n<p>4.mv go /usr/local</p>\n\n<p>5.set up environment variables.</p>\n\n<pre><code> 5.1.GOROOT is the location where Go package is installed on your system\n\n   export GOROOT=/usr/local/go\n\n 5.2.GOPATH is the location of your work directoryexport \n\n  export GOPATH=$HOME/your project location\n\n 5.3.Now set the PATH variable to access go binary system wide\n\n   export PATH=$GOPATH/bin:$GOROOT/bin:$PATH\n</code></pre>\n\n<p>6.verify</p>\n\n<pre><code>6.1.go version\n\n6.2.go env\n</code></pre>\n\n<p><strong>CFSSL</strong></p>\n\n<p>1.git clone <a href=\"https://github.com/cloudflare/cfssl.git\" rel=\"nofollow noreferrer\">https://github.com/cloudflare/cfssl.git</a> \n$GOPATH/src/github.com/cloudflare/cfssl</p>\n\n<p>2.cd $GOPATH/src/github.com/cloudflare/cfssl</p>\n\n<p>3.make</p>\n\n<p>4.yum install tree</p>\n\n<p>6.tree bin</p>\n\n<p>7.go get -u github.com/cloudflare/cfssl/cmd/...</p>\n"}], "owner": {"reputation": 427, "user_id": 4213664, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1TCzb.png?s=128&g=1", "display_name": "ZedsWhatSheSaid", "link": "https://stackoverflow.com/users/4213664/zedswhatshesaid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3791, "favorite_count": 0, "accepted_answer_id": 30637007, "answer_count": 2, "score": 1, "last_activity_date": 1551244905, "creation_date": 1433342179, "last_edit_date": 1433399782, "question_id": 30623185, "link": "https://stackoverflow.com/questions/30623185/bash-cfssl-command-not-found", "title": "-bash: cfssl: command not found", "body": "<p>When I tried to install <a href=\"https://github.com/cloudflare/cfssl\" rel=\"nofollow\">cfssl</a> with this command:</p>\n\n<pre><code>go get -u github.com/cloudflare/cfssl/cmd/cfssl\n</code></pre>\n\n<p>I received following output:</p>\n\n<pre><code># github.com/cloudflare/cfssl/crypto/pkcs7\ngo_packages/src/github.com/cloudflare/cfssl/crypto/pkcs7/pkcs7.go:141: pkcs7.ContentType.String undefined (type asn1.ObjectIdentifier has no field or method String)\n# github.com/cloudflare/cfssl/helpers/derhelpers\ngo_packages/src/github.com/cloudflare/cfssl/helpers/derhelpers/derhelpers.go:16: undefined: crypto.Signer\n# github.com/cloudflare/cfssl/csr\ngo_packages/src/github.com/cloudflare/cfssl/csr/csr.go:191: undefined: x509.CertificateRequest\ngo_packages/src/github.com/cloudflare/cfssl/csr/csr.go:204: undefined: x509.CreateCertificateRequest\n# golang.org/x/crypto/ocsp\ngo_packages/src/golang.org/x/crypto/ocsp/ocsp.go:494: undefined: crypto.Signer\n# github.com/cloudflare/cf-tls/tls\ngo_packages/src/github.com/cloudflare/cf-tls/tls/handshake_client.go:431: undefined: crypto.Signer\n</code></pre>\n\n<p>I really have no clue whether this is harmful or not and has something to do with the usage of this tool. However when I try to use it, I receive this error:</p>\n\n<pre><code>-bash: cfssl: Command not found.\n</code></pre>\n\n<p>I never used go but I wanted to use this tool. Do you guys know why this is not working as expected?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>output of <code>go env</code></p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOCHAR=\"6\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/ubuntu/go\"\nGORACE=\"\"\nGOROOT=\"/usr/lib/go\"\nGOTOOLDIR=\"/usr/lib/go/pkg/tool/linux_amd64\"\nTERM=\"dumb\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-g -O2 -fPIC -m64 -pthread\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n\n<p>output of <code>go version</code></p>\n\n<pre><code>go version go1.2.1 linux/amd64\n</code></pre>\n\n<p>I really don't know why this is the case because I installed <a href=\"https://storage.googleapis.com/golang/go1.4.2.linux-amd64.tar.gz\" rel=\"nofollow\">this</a> version.</p>\n"}, {"tags": ["struct", "go", "embedding"], "answers": [{"comments": [{"owner": {"reputation": 231, "user_id": 1702069, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a93f16742c367cda43b4eaa04b5aa498?s=128&d=identicon&r=PG", "display_name": "ZeroHour", "link": "https://stackoverflow.com/users/1702069/zerohour"}, "edited": false, "score": 0, "creation_date": 1433341296, "post_id": 30622739, "comment_id": 49311673, "body": "Currently I have a validation library that I made that is similar to HIbernate validation in Java.  As of now, I have a validate method that you use like:   mypackage.Validate(myStructOb)  as you are suggesting.  I would have thought it would be cleaner is there was a way to embed a validate method on the struct I want to validate and just call it."}, {"owner": {"reputation": 3515, "user_id": 3574628, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W5BJ2.jpg?s=128&g=1", "display_name": "luther", "link": "https://stackoverflow.com/users/3574628/luther"}, "edited": false, "score": 0, "creation_date": 1433347223, "post_id": 30622739, "comment_id": 49316316, "body": "I can&#39;t find anything about Hibernate in the Java API index, so I&#39;m at a loss to figure out what you&#39;re trying to do. I would reiterate the first paragraph of this answer. What does <code>Validate</code> do that it needs to know about structs that embed it?"}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 1, "last_activity_date": 1433358774, "last_edit_date": 1433358774, "creation_date": 1433341033, "answer_id": 30622739, "question_id": 30622605, "link": "https://stackoverflow.com/questions/30622605/can-embedded-struct-method-have-knowledge-of-parent-child/30622739#30622739", "title": "Can embedded struct method have knowledge of parent/child?", "body": "<p>Any kind of <code>parent</code> reference is impossible. What would you hope to do with the parent? Since they would be potentially widely different types, they would be incompatible to do anything meaningful with.</p>\n\n<p>If you need something in common between different types you want an interface, and you will need to pass it in:</p>\n\n<pre><code>type B struct {}\nfunc (b B) Validate(parent MyInterface) {\n}\n\n\ntype A struct {\n  B\n}\n// A implements MyInterface\na := A{B{}}\na.Validate(a)\n</code></pre>\n\n<p>If you can explain what you are actually trying to accomplish there is almost certainly a better way than this. </p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1471955515, "last_edit_date": 1495542817, "creation_date": 1433360248, "answer_id": 30629132, "question_id": 30622605, "link": "https://stackoverflow.com/questions/30622605/can-embedded-struct-method-have-knowledge-of-parent-child/30629132#30629132", "title": "Can embedded struct method have knowledge of parent/child?", "body": "<p>This is something not possible. To better understand why, see this slightly modified version of your example:</p>\n\n<pre><code>type B struct{}\n\nfunc (b *B) Validate() {\n    fmt.Printf(\"b:%p\\n\", b)\n}\n\ntype A struct {\n    *B\n}\n\nfunc main() {\n    b := B{}\n    a1 := A{&amp;b}\n    a2 := A{&amp;b}\n\n    a1.Validate()\n    a2.Validate()\n    a1.B.Validate()\n    a2.B.Validate()\n\n    b.Validate()\n}\n</code></pre>\n\n<p>Output as expected, the same value of <code>*B</code> everywhere (<a href=\"http://play.golang.org/p/eDPxLse0Vp\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>b: 0x1becd8\nb: 0x1becd8\nb: 0x1becd8\nb: 0x1becd8\nb: 0x1becd8\n</code></pre>\n\n<p>As you can see, I changed the method receiver and the embedded type to pointer of <code>B</code>.</p>\n\n<p>From this example it is clear: you can use the same value of <code>B</code> (or rather the same address of a value of <code>B</code>) to embed in different values of type <code>A</code>!</p>\n\n<p><strong>And you can call <code>Validate()</code> on both: so the theoretical \"parent\" is not even \"constant\" for a given value of <code>*B</code>.</strong> This wouldn't be a deal-breaker, but: having a value of <code>A</code>, you can call the promoted method <code>B.Validate()</code> by writing <code>a.Validate()</code> which is OK, but you can also call it like <code>a.B.Validate()</code> - now this time you don't really have a value of <code>A</code> (arguable, but <code>Validate()</code> is called on a value of <code>*B</code> and not <code>A</code>), but finally you can also call <code>b.Validate()</code> - this time you definitely don't have a value of <code>A</code>.</p>\n\n<p>There is no definite type for the parent, <code>B</code> (or <code>*B</code>) can be embedded in any type (so it couldn't be anything other than <code>interface{}</code>).</p>\n\n<p>So image: you have a concrete value of <code>*B</code> and when its <code>Validate()</code> method is called, sometimes there is a parent, and sometimes there isn't. Then what would be the justification to have a parent at all?</p>\n\n<p>Back to your example: for this <code>Validate()</code> method to validate something meaningful, it should (must) be passed to the <code>Validate()</code> method as a parameter - explicitly and not automatically.</p>\n\n<p>The best you can do is what captncraig wrote in <a href=\"https://stackoverflow.com/a/30622739/1705598\">his answer</a> (+1).</p>\n\n<p>You can simplify it a little though if you explicitly add a method to <code>A</code> which would call <code>B.Validate()</code> like this:</p>\n\n<pre><code>func (a *A) Validate2() {\n    a.Validate(a)\n}\n\n// And using it:\na.Validate2()\n</code></pre>\n\n<p>There is no justification for a validator of the kind you imagine to be embedded in <code>A</code>, it should just be a field of <code>A</code>, or since there is no direct relation, it can be an \"independent\" validator. In both of these cases you may add a helper <code>Validate()</code> method to <code>A</code> if you would like to simplify validation.</p>\n"}], "owner": {"reputation": 231, "user_id": 1702069, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a93f16742c367cda43b4eaa04b5aa498?s=128&d=identicon&r=PG", "display_name": "ZeroHour", "link": "https://stackoverflow.com/users/1702069/zerohour"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 482, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1471955515, "creation_date": 1433340673, "last_edit_date": 1470147536, "question_id": 30622605, "link": "https://stackoverflow.com/questions/30622605/can-embedded-struct-method-have-knowledge-of-parent-child", "title": "Can embedded struct method have knowledge of parent/child?", "body": "<p>I have been working with Go on and off on my free time for a few months and I feel I've been getting a hang of it.  Coming from traditional OOP languages, such as Java and PHP, I had a hard time grasping composition and embedding in Go.  I think it finally clicked recently and want to use it more, but I have hit a roadblock for one idea I have.  </p>\n\n<p>Lets say I have a struct from a package that has a Validate method and I embedded that in my struct in the package I am currently working in.  Is there a way (I own both packages) that I can get a reference to the struct that is doing the embedding inside of the Validate method?  Kind of like a way to see who called me since I would be calling it on the \"parent\" instead of the embedded.</p>\n\n<p>I'll try to visualize this...</p>\n\n<pre><code>type B struct {}\nfunc (b B) Validate() {\n  // get reference somehow of A obj\n}\n\n\ntype A struct {\n  B\n}\n\na := A{B{}}\na.Validate()\n</code></pre>\n\n<p>I feel as though this isn't possible, but it would be cool if you could.  I'd imagine that you would need to make A and B both the same interface type for this to work.  Any thoughts or help will be much appreciated.</p>\n"}, {"tags": ["session", "go", "session-cookies", "session-timeout", "beego"], "comments": [{"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1433393677, "post_id": 30619553, "comment_id": 49335483, "body": "@can any one post suggestions for this... Please"}], "answers": [{"tags": [], "owner": {"reputation": 86, "user_id": 2163393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Oefgh.jpg?s=128&g=1", "display_name": "ysqi", "link": "https://stackoverflow.com/users/2163393/ysqi"}, "is_accepted": true, "score": 1, "last_activity_date": 1438417182, "creation_date": 1438417182, "answer_id": 31759815, "question_id": 30619553, "link": "https://stackoverflow.com/questions/30619553/beego-how-to-redirect-to-other-page-on-session-time-out/31759815#31759815", "title": "Beego: How to redirect to other page on session time out", "body": "<p>beego has method <code>Prepare()</code> to do this , <a href=\"http://beego.me/docs/mvc/controller/controller.md\" rel=\"nofollow\">see doc</a></p>\n\n<p><strong>Prepare()</strong></p>\n\n<p>You can use this function for extension, it will execute before the methods below. You can overwrite it to implement functions such as user validation.</p>\n\n<p><strong>code</strong></p>\n\n<pre><code>type MainController struct {\n    beego.Controller\n}\n\nfunc (c *MainController) Prepare() { \n    if timeOut {\n        c.Redirect(\"login.html\", 302)\n    }\n}\n\nfunc (c *MainController) Index() {\n    c.TplNames = \"index.tpl\"\n}\n</code></pre>\n"}], "owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1681, "favorite_count": 0, "accepted_answer_id": 31759815, "answer_count": 1, "score": 3, "last_activity_date": 1438417182, "creation_date": 1433332869, "last_edit_date": 1433336818, "question_id": 30619553, "link": "https://stackoverflow.com/questions/30619553/beego-how-to-redirect-to-other-page-on-session-time-out", "title": "Beego: How to redirect to other page on session time out", "body": "<p>i am handling session variable by setting time out using </p>\n\n<pre><code>globalSessions, _ = session.NewManager(\"memory\", `{\"cookieName\":\"gosessionid\", \"enableSetCookie,omitempty\": true, \"gclifetime\":5, \"maxLifetime\": 5, \"secure\": false, \"sessionIDHashFunc\": \"sha1\", \"sessionIDHashKey\": \"\", \"cookieLifeTime\": 3600, \"providerConfig\": \"\"}`)\n\ngo globalSessions.GC()\n\nsess, _ := globalSessions.SessionStart(c.Ctx.ResponseWriter, c.Ctx.Request)\n\ndefer sess.SessionRelease(c.Ctx.ResponseWriter)\n\nerrU := sess.Set(\"user1\", c.Input().Get(\"userName\"))\n\nif errU != nil {\n    fmt.Println(\"error in settng value\")\n}\n</code></pre>\n\n<p>now how to redirect back to specific page on time out of the current page.\nI have this application in beego</p>\n"}, {"tags": ["regex", "postgresql", "go"], "comments": [{"owner": {"reputation": 124629, "user_id": 7586, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Ryqtb.jpg?s=128&g=1", "display_name": "Kobi", "link": "https://stackoverflow.com/users/7586/kobi"}, "edited": false, "score": 1, "creation_date": 1433319542, "post_id": 30614402, "comment_id": 49295614, "body": "What language do you use? How are quotes escaped? How would these values look with and without quotes: <code>a,b</code>, <code>a&quot;b</code>? Can arrays contain objects or nested arrays? Looks like has <a href=\"http://www.postgresql.org/docs/9.4/static/arrays.html\" rel=\"nofollow noreferrer\">multidimensional arrays</a>."}, {"owner": {"reputation": 362892, "user_id": 256196, "user_type": "moderator", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/d84b558fd67be10d5a718fb94231909d?s=128&d=identicon&r=PG", "display_name": "Bohemian", "link": "https://stackoverflow.com/users/256196/bohemian"}, "edited": false, "score": 0, "creation_date": 1433319900, "post_id": 30614402, "comment_id": 49295847, "body": "With what language are you running the regex replace? Can values have commas within them?"}, {"owner": {"reputation": 1710, "user_id": 1630191, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/179c7e7c696827305522d3e97952f46c?s=128&d=identicon&r=PG&f=1", "display_name": "user232343", "link": "https://stackoverflow.com/users/1630191/user232343"}, "edited": false, "score": 0, "creation_date": 1433320127, "post_id": 30614402, "comment_id": 49296007, "body": "Updated question. Language is golang, strings can contain commas. In the first version we just split by comma, but now we can have also commas inside elements, so our old method doesn&#39;t work anymore."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1433346552, "post_id": 30614402, "comment_id": 49315851, "body": "Which ORM are you using?"}, {"owner": {"reputation": 1710, "user_id": 1630191, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/179c7e7c696827305522d3e97952f46c?s=128&d=identicon&r=PG&f=1", "display_name": "user232343", "link": "https://stackoverflow.com/users/1630191/user232343"}, "edited": false, "score": 0, "creation_date": 1433364904, "post_id": 30614402, "comment_id": 49326667, "body": "<a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1710, "user_id": 1630191, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/179c7e7c696827305522d3e97952f46c?s=128&d=identicon&r=PG&f=1", "display_name": "user232343", "link": "https://stackoverflow.com/users/1630191/user232343"}, "edited": false, "score": 0, "creation_date": 1433320381, "post_id": 30614787, "comment_id": 49296167, "body": "Question updated. There are commas inside values, and we are using Go."}, {"owner": {"reputation": 362892, "user_id": 256196, "user_type": "moderator", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/d84b558fd67be10d5a718fb94231909d?s=128&d=identicon&r=PG", "display_name": "Bohemian", "link": "https://stackoverflow.com/users/256196/bohemian"}, "reply_to_user": {"reputation": 1710, "user_id": 1630191, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/179c7e7c696827305522d3e97952f46c?s=128&d=identicon&r=PG&f=1", "display_name": "user232343", "link": "https://stackoverflow.com/users/1630191/user232343"}, "edited": false, "score": 0, "creation_date": 1433321167, "post_id": 30614787, "comment_id": 49296692, "body": "@user232343 thx. I too have updated to cater for embedded commas."}], "tags": [], "owner": {"reputation": 362892, "user_id": 256196, "user_type": "moderator", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/d84b558fd67be10d5a718fb94231909d?s=128&d=identicon&r=PG", "display_name": "Bohemian", "link": "https://stackoverflow.com/users/256196/bohemian"}, "is_accepted": false, "score": 1, "last_activity_date": 1433326627, "last_edit_date": 1433326627, "creation_date": 1433320324, "answer_id": 30614787, "question_id": 30614402, "link": "https://stackoverflow.com/questions/30614402/regex-for-postgres-array/30614787#30614787", "title": "regex for postgres array", "body": "<p>I'm not au fait with golang, but use this search regex</p>\n\n<pre><code>(?&lt;=,)(?=[^\"](([^\"]*\"){2})*[^\"]*$)|(?&lt;=[^\"])(?=,(([^\"]*\"){2})*[^\"]*$)\n</code></pre>\n\n<p>and replace matches with a quote <code>\"</code>.</p>\n\n<p>See <a href=\"http://rubular.com/r/qdHx0KhIS0\" rel=\"nofollow\">regex live demo</a>.</p>\n\n<p>Then add <code>\"[]\"</code> at the front.</p>\n\n<p>Assumes (escaped) quotes never appear within values.</p>\n"}], "owner": {"reputation": 1710, "user_id": 1630191, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/179c7e7c696827305522d3e97952f46c?s=128&d=identicon&r=PG&f=1", "display_name": "user232343", "link": "https://stackoverflow.com/users/1630191/user232343"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1433326627, "creation_date": 1433319169, "last_edit_date": 1433320335, "question_id": 30614402, "link": "https://stackoverflow.com/questions/30614402/regex-for-postgres-array", "title": "regex for postgres array", "body": "<p>I am using ORM which doesn't support postgres array, so I am trying to do some hacks to add \"support\".</p>\n\n<p>Currently I have to convert postgres array string into array of programming language.</p>\n\n<p>Example of postgres array string representation:</p>\n\n<pre><code>{\"bla, bla\",bla,\"bu bu\",bu}\n</code></pre>\n\n<p>So if there are spaces, postgres is automatically adding quotes, if not, then element is without quotes.</p>\n\n<p>What regex you would use to get array out of this? So result should be:</p>\n\n<pre><code>array := []{\"bla, bla\", \"bla\", \"bu bu\", \"bu\"}\n</code></pre>\n\n<p>I am using <code>Go</code>.</p>\n\n<p>Arrays are one dimensional, so something like:\n<code>\nCREATE TABLE test (\n    something  text[]\n);\n</code></p>\n"}, {"tags": ["go", "slice", "memset"], "comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1433321350, "post_id": 30614165, "comment_id": 49296805, "body": "You could use <a href=\"https://github.com/golang/go/blob/7e0c11c32fb1c7515c52b6ebe9db0d77c70b63d2/src/runtime/duff_amd64.s\" rel=\"nofollow noreferrer\"><code>runtime.duffzero</code></a> with some other value than <code>0</code> in AX. Also see <a href=\"https://github.com/golang/go/blob/2b7505e28a50f49e85c3e0812a4c4f287b8dfa30/src/runtime/mkduff.go\" rel=\"nofollow noreferrer\">mkduff.go</a>."}, {"owner": {"reputation": 464, "user_id": 3640407, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/22ed1df1eda4cb1de4298506d325a0d3?s=128&d=identicon&r=PG&f=1", "display_name": "edc65", "link": "https://stackoverflow.com/users/3640407/edc65"}, "edited": false, "score": 0, "creation_date": 1433334583, "post_id": 30614165, "comment_id": 49306219, "body": "With any good compiler the loop is as fast as memset"}, {"owner": {"reputation": 14316, "user_id": 1012936, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/eXQaP.png?s=128&g=1", "display_name": "milleniumbug", "link": "https://stackoverflow.com/users/1012936/milleniumbug"}, "edited": false, "score": 5, "creation_date": 1433335672, "post_id": 30614165, "comment_id": 49307037, "body": "Your <code>memset</code> doesn&#39;t initialize all elements to <code>1</code> either."}, {"owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "edited": false, "score": 0, "creation_date": 1433343251, "post_id": 30614165, "comment_id": 49313192, "body": "Just out of curiosity, do you have timings for performance of <code>memset</code> vs loop?"}, {"owner": {"reputation": 5468, "user_id": 89233, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/a36afadc530a6936e9e336a729f7ecf3?s=128&d=identicon&r=PG", "display_name": "Jon Watte", "link": "https://stackoverflow.com/users/89233/jon-watte"}, "reply_to_user": {"reputation": 464, "user_id": 3640407, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/22ed1df1eda4cb1de4298506d325a0d3?s=128&d=identicon&r=PG&f=1", "display_name": "edc65", "link": "https://stackoverflow.com/users/3640407/edc65"}, "edited": false, "score": 0, "creation_date": 1583022037, "post_id": 30614165, "comment_id": 106977460, "body": "@edc65 it is a common myth that a loop will be as fast as memset. In a modern world with special cache control and SIMD instructions, memset can run significantly faster on large buffers than any simple loop over scalar registers. This started being true with the PowerPC in the &#39;90s, and moved to Intel with the Pentium III, and is also true on ARM with NEON instructions. That being said: The go compiler is explicitly NOT spending time optimizing much, because it&#39;s supposed to prioritize fast compile times."}], "answers": [{"comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 1, "creation_date": 1433321135, "post_id": 30614594, "comment_id": 49296665, "body": "thanks for the answer. It looks strange that theoretically you can get <code>log(n)</code> but practically approximately only 2 times faster."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 5, "creation_date": 1433325000, "post_id": 30614594, "comment_id": 49299389, "body": "@SalvadorDali The number of iterations is <code>log(n)</code>, but each <code>copy()</code> in the subsequent iteration has to do twice as many work (copy twice as many elements). So it&#39;s not only the iteration count that counts."}, {"owner": {"reputation": 708, "user_id": 3302584, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/19cai.jpg?s=128&g=1", "display_name": "Awn", "link": "https://stackoverflow.com/users/3302584/awn"}, "edited": false, "score": 2, "creation_date": 1525971059, "post_id": 30614594, "comment_id": 87572235, "body": "A small note here, there is <a href=\"https://github.com/golang/go/commit/f03c9202c43e0abb130669852082117ca50aa9b1\" rel=\"nofollow noreferrer\">this optimisation</a> that exists in the Go compiler."}, {"owner": {"reputation": 1195, "user_id": 5157801, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3ca58cb0069eca6979b4a63cd6a5e478?s=128&d=identicon&r=PG", "display_name": "Liqang Lau", "link": "https://stackoverflow.com/users/5157801/liqang-lau"}, "edited": false, "score": 0, "creation_date": 1583744381, "post_id": 30614594, "comment_id": 107206030, "body": "Run at Linux 3.10.0 with amd64 go 1.14 and result is: <code>goos: linux goarch: amd64 pkg: - BenchmarkLoop-4          1949619               573 ns&#47;op BenchmarkRepeat-4         785382              1359 ns&#47;op </code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 26, "last_activity_date": 1433336520, "last_edit_date": 1433336520, "creation_date": 1433319757, "answer_id": 30614594, "question_id": 30614165, "link": "https://stackoverflow.com/questions/30614165/is-there-analog-of-memset-in-go/30614594#30614594", "title": "Is there analog of memset in go?", "body": "<p>The simplest solution with a loop would look like this:</p>\n\n<pre><code>func memsetLoop(a []int, v int) {\n    for i := range a {\n        a[i] = v\n    }\n}\n</code></pre>\n\n<p>There is no <code>memset</code> support in the standard library, but we can make use of the built-in <a href=\"https://golang.org/pkg/builtin/#copy\"><code>copy()</code></a> which is highly optimized.</p>\n\n<h3>With repeated <code>copy()</code></h3>\n\n<p>We can set the first element manually, and start copying the already set part to the unset part using <code>copy()</code>; where the already set part gets bigger and bigger every time (doubles), so the number of iterations is <code>log(n)</code>:</p>\n\n<pre><code>func memsetRepeat(a []int, v int) {\n    if len(a) == 0 {\n        return\n    }\n    a[0] = v\n    for bp := 1; bp &lt; len(a); bp *= 2 {\n        copy(a[bp:], a[:bp])\n    }\n}\n</code></pre>\n\n<p>This solution was inspired by the implementation of <a href=\"http://golang.org/pkg/bytes/#Repeat\"><code>bytes.Repeat()</code></a>. If you just want to create a new <code>[]byte</code> filled with the same values, you can use the <code>bytes.Repeat()</code> function. You can't use that for an existing slice or slices other than <code>[]byte</code>, for that you can use the presented <code>memsetRepeat()</code>.</p>\n\n<p>In case of small slices <code>memsetRepeat()</code> may be slower than <code>memsetLoop()</code> (but in case of small slices it doesn't really matter, it will run in an instant).</p>\n\n<p>Due to using the fast <code>copy()</code>, <code>memsetRepeat()</code> will be much faster if the number of elements grows.</p>\n\n<p>Benchmarking these 2 solutions:</p>\n\n<pre><code>var a = make([]int, 1000) // Size will vary\n\nfunc BenchmarkLoop(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        memsetLoop(a, 10)\n    }\n}\n\nfunc BenchmarkRepeat(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        memsetRepeat(a, 11)\n    }\n}\n</code></pre>\n\n<h3>Benchmark results</h3>\n\n<p>100 elements: <strong>~1.15 times faster</strong></p>\n\n<pre><code>BenchmarkLoop   20000000                81.6 ns/op\nBenchmarkRepeat 20000000                71.0 ns/op\n</code></pre>\n\n<p>1,000 elements: <strong>~2.5 times faster</strong></p>\n\n<pre><code>BenchmarkLoop    2000000               706 ns/op\nBenchmarkRepeat  5000000               279 ns/op\n</code></pre>\n\n<p>10,000 elements: <strong>~2 times faster</strong></p>\n\n<pre><code>BenchmarkLoop     200000              7029 ns/op\nBenchmarkRepeat   500000              3544 ns/op\n</code></pre>\n\n<p>100,000 elements: <strong>~1.5 times faster</strong></p>\n\n<pre><code>BenchmarkLoop      20000             70671 ns/op\nBenchmarkRepeat    30000             45213 ns/op\n</code></pre>\n\n<p>The highest performance gain is around 3800-4000 elements where it is <strong>~3.2 times faster</strong>.</p>\n"}, {"comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1433320600, "post_id": 30614836, "comment_id": 49296286, "body": "Note that C&#39;s implementation is also &quot;just&quot; a loop. Only it makes sure that it&#39;s word-aligned and writes word-by-word instead of the width of the data type in question."}, {"owner": {"reputation": 5071, "user_id": 1124744, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2f7980bcb4c6b1c604cd0f3424f06f84?s=128&d=identicon&r=PG", "display_name": "paulm", "link": "https://stackoverflow.com/users/1124744/paulm"}, "edited": false, "score": 0, "creation_date": 1433335939, "post_id": 30614836, "comment_id": 49307271, "body": "In C it will probably compile down to a specific instruction on x86 though, so not really a loop - i.e the compiler intrinsic for memset"}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 7, "last_activity_date": 1433320445, "creation_date": 1433320445, "answer_id": 30614836, "question_id": 30614165, "link": "https://stackoverflow.com/questions/30614165/is-there-analog-of-memset-in-go/30614836#30614836", "title": "Is there analog of memset in go?", "body": "<p>According to <a href=\"https://github.com/golang/go/issues/5373\">this bug</a> titled \"optimize memset idiom\" there is no way to do this in Go other than with a loop. The issue was closed on 9 Jan 2013 with this post</p>\n\n<blockquote>\n  <p>I consider this fixed. Optimizing non-zero cases isn't very\n  interesting.</p>\n  \n  <p>We can open another bug if people feel strongly about doing more.</p>\n</blockquote>\n\n<p>So the solution is to use a loop as already covered by icza.</p>\n\n<p>There is <a href=\"http://golang.org/pkg/bytes/#Repeat\">bytes.Repeat</a> but that also just uses a loop:</p>\n\n<pre><code>func Repeat(b []byte, count int) []byte {\n    nb := make([]byte, len(b)*count)\n    bp := copy(nb, b)\n    for bp &lt; len(nb) {\n        copy(nb[bp:], nb[:bp])\n        bp *= 2\n    }\n    return nb\n}\n</code></pre>\n"}], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9423, "favorite_count": 4, "accepted_answer_id": 30614594, "answer_count": 2, "score": 25, "last_activity_date": 1546952288, "creation_date": 1433318421, "last_edit_date": 1592644375, "question_id": 30614165, "link": "https://stackoverflow.com/questions/30614165/is-there-analog-of-memset-in-go", "title": "Is there analog of memset in go?", "body": "<p>In C++ I can initialize an array with some value using <a href=\"https://msdn.microsoft.com/en-us/library/aa246471%28v=vs.60%29.aspx\" rel=\"noreferrer\">memset</a>:</p>\n<pre><code>const int MAX = 1000000;\nint is_prime[MAX]\n\nmemset(is_prime, 1, sizeof(is_prime))\n</code></pre>\n<p>What memset does, crudely can be described as filling the array with some value, but doing this really really fast.</p>\n<p>In go I can do <code>is_prime := make([]int, 1000000)</code>, but this will create a slice with all 0, in the similar manner I can use <code>new([1000000]int)</code>, but nothing will allow me to create an array/slice with all 1 or any other non-zero element.</p>\n<p>Of course I can use a loop to populate it with the value later, but the main purpose of <code>memset</code> is that it is way way faster than the loop.</p>\n<p>So do Go programmers have a <code>memset</code> analog (fast way of initializing array to some non-zero value)?</p>\n"}, {"tags": ["go", "build", "compilation"], "comments": [{"owner": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "edited": false, "score": 0, "creation_date": 1548796132, "post_id": 30612611, "comment_id": 95669289, "body": "<a href=\"https://stackoverflow.com/a/54429573/3702377\">go build vs go install</a>"}], "answers": [{"comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 1, "creation_date": 1492105048, "post_id": 30612612, "comment_id": 73857776, "body": "seems strange that go install does not update the executable if its identical to previously installed one ... any insights here ?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 150, "last_activity_date": 1575832502, "last_edit_date": 1575832502, "creation_date": 1433313562, "answer_id": 30612612, "question_id": 30612611, "link": "https://stackoverflow.com/questions/30612611/what-does-go-build-build-go-build-vs-go-install/30612612#30612612", "title": "What does go build build? (go build vs. go install)", "body": "<p>What the <code>go</code> command does depends on whether we run it for a \"normal\" package or for the special <code>\"main\"</code> package.</p>\n\n<p><strong>For packages</strong></p>\n\n<ul>\n<li><code>go build\u00a0\u00a0</code> builds your package then <em>discards the results</em>.</li>\n<li><code>go install</code> builds then <em>installs</em> the package in your <code>$GOPATH/pkg</code> directory.</li>\n</ul>\n\n<p><strong>For commands (package <code>main</code>)</strong></p>\n\n<ul>\n<li><code>go build\u00a0\u00a0</code> builds the command and leaves the result in the <em>current working directory</em>.</li>\n<li><code>go install</code> builds the command in a temporary directory then moves it to <code>$GOPATH/bin</code>.</li>\n</ul>\n\n<h3>What to pass to <code>go build</code>?</h3>\n\n<p>You may pass <em>packages</em> to <code>go build</code>, packages you want to build. You may also pass a list of <code>.go</code> files from a single directory, which is then treated as the list of source files specifying a single package.</p>\n\n<p>If no packages (import paths) are provided, the build is applied on the current directory.</p>\n\n<p>An import path may contain one or more <code>\"...\"</code> wildcards (in which case it is a <em>pattern</em>).  <code>...</code> can match any string, e.g. <code>net/...</code> matches the <code>net</code> package and packages being in any of its subfolders. The command</p>\n\n<pre><code>go build ./...\n</code></pre>\n\n<p>often used to build the package in the current folder and all packages recursing down. This command issued in a project root builds the complete project.</p>\n\n<p>For more about specifying packages, run <code>go help packages</code>.</p>\n\n<h3>Regarding modules</h3>\n\n<p>Preliminary support for Go modules was introduced in Go 1.11, and modules became default starting with Go 1.13. When the <code>go</code> tool is run from a folder which contains a <code>go.mod</code> file (or one of the parents of the current folder), the <code>go</code> tool runs in <em>module-aware</em> mode (the legacy mode is called <em>GOPATH mode</em>).</p>\n\n<blockquote>\n  <p>In module-aware mode, GOPATH no longer defines the meaning of imports\n  during a build, but it still stores downloaded dependencies (in GOPATH/pkg/mod)\n  and installed commands (in GOPATH/bin, unless GOBIN is set).</p>\n</blockquote>\n\n<p>When building modules, what is built is specified by the <em>build list</em>. The build list initially contains only the main module (the module containing the directory where the <code>go</code> command is run), and the dependencies of the main module are added to the build list, recursively (dependencies of dependencies are also added).</p>\n\n<p>For more info, run <code>go help modules</code>.</p>\n\n<hr>\n\n<p>Basically you can use <code>go build</code> as a check that the packages can be built (along with their dependencies) while <code>go install</code> also (permanently) installs the results in the proper folders of your <code>$GOPATH</code>.  </p>\n\n<p><code>go build</code> will silently terminate if everything is OK, and will give you error messages if the packages cannot be built/compiled.</p>\n\n<p>Whenever the <code>go</code> tool installs a package or binary, it also installs whatever dependencies it has, so running <code>go install</code> will also install packages your program depends on (publicly available, \"go gettable\" packages), automatically.</p>\n\n<p>For a start, read the official <a href=\"https://golang.org/doc/code.html\" rel=\"noreferrer\"><strong>How to Write Go Code</strong></a> page.</p>\n\n<p>More information about the <code>go</code> tool: <a href=\"https://golang.org/cmd/go/\" rel=\"noreferrer\"><strong>Command go</strong></a></p>\n\n<p>You can also get more help by running the following command:</p>\n\n<pre><code>go help build\n</code></pre>\n\n<p>It is also worth noting that starting with Go 1.5 <code>go install</code> also removes executables created by <code>go build</code> (<a href=\"https://go-review.googlesource.com/#/c/10682/\" rel=\"noreferrer\">source</a>):</p>\n\n<blockquote>\n  <p>If 'go install' (with no arguments, meaning the current directory)\n  succeeds, remove the executable written by 'go build', if present. This avoids leaving a stale binary behind...</p>\n</blockquote>\n\n<p>To complete the list, <code>go run</code> compiles your application into a temporary folder, and starts that executable binary. When the app exits, it properly cleans up the temporary files.</p>\n\n<p><sub>Question inspired by Dave Cheney's <a href=\"http://dave.cheney.net/2014/06/04/what-does-go-build-build\" rel=\"noreferrer\">What does go build build?</a></sub></p>\n"}, {"comments": [{"owner": {"reputation": 6696, "user_id": 537980, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/DZUB4.png?s=128&g=1", "display_name": "ctrl-alt-delor", "link": "https://stackoverflow.com/users/537980/ctrl-alt-delor"}, "edited": false, "score": 0, "creation_date": 1547993396, "post_id": 47109875, "comment_id": 95376399, "body": "Does <code>go build</code>, do <code>get</code>s? I have a build error <code>cannot find package &quot;github.com&#47;spf13&#47;cobra&quot; in any of:\u2026</code>. I don&#39;t know how to tell it to get it. Do I need to explicitly get?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 6696, "user_id": 537980, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/DZUB4.png?s=128&g=1", "display_name": "ctrl-alt-delor", "link": "https://stackoverflow.com/users/537980/ctrl-alt-delor"}, "edited": false, "score": 0, "creation_date": 1547993527, "post_id": 47109875, "comment_id": 95376449, "body": "@ctrl-alt-delor With which version of Go? Does your project has a <code>go.mod</code> file in it?"}, {"owner": {"reputation": 6696, "user_id": 537980, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/DZUB4.png?s=128&g=1", "display_name": "ctrl-alt-delor", "link": "https://stackoverflow.com/users/537980/ctrl-alt-delor"}, "edited": false, "score": 0, "creation_date": 1547993766, "post_id": 47109875, "comment_id": 95376529, "body": "<code>go version go1.11.4 linux&#47;amd64</code>. I don&#39;t know about go.mod. I am re-building <code>https:&#47;&#47;github.com&#47;cbroglie&#47;mustache&#47;blob&#47;master&#47;cmd&#47;mustach&zwnj;&#8203;e&#47;main.go</code>, it is odd as I just built the whole package, and am using this example as a base, and I did create a more basic version that worked (but not using this library). I can&#39;t see how it was not installed with the mustache package."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 6696, "user_id": 537980, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/DZUB4.png?s=128&g=1", "display_name": "ctrl-alt-delor", "link": "https://stackoverflow.com/users/537980/ctrl-alt-delor"}, "edited": false, "score": 0, "creation_date": 1547993917, "post_id": 47109875, "comment_id": 95376580, "body": "@ctrl-alt-delor so cobr is vendored <a href=\"https://github.com/cbroglie/mustache/tree/master/cmd/mustache/vendor/github.com/spf13/cobra\" rel=\"nofollow noreferrer\">github.com/cbroglie/mustache/tree/master/cmd/mustache/vendor&zwnj;&#8203;/&hellip;</a>. Is your GOPATH properly set?"}, {"owner": {"reputation": 6696, "user_id": 537980, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/DZUB4.png?s=128&g=1", "display_name": "ctrl-alt-delor", "link": "https://stackoverflow.com/users/537980/ctrl-alt-delor"}, "edited": false, "score": 0, "creation_date": 1547998099, "post_id": 47109875, "comment_id": 95377783, "body": "I have discovered what you already found. The package is in a vendor sub-directory: this is why it did not get installed. However I don&#39;t know why it does not install it now on build. Or how to use the vendor directory (if I copy it to my directory)."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 15, "last_activity_date": 1509793049, "last_edit_date": 1509793049, "creation_date": 1509792369, "answer_id": 47109875, "question_id": 30612611, "link": "https://stackoverflow.com/questions/30612611/what-does-go-build-build-go-build-vs-go-install/47109875#47109875", "title": "What does go build build? (go build vs. go install)", "body": "<p>For package:</p>\n\n<blockquote>\n  <p><code>go build</code>: builds your package then <em>discards</em> the results</p>\n</blockquote>\n\n<p>That won't be true after Go 1.10 (Q1 2018), thank to  <a href=\"https://golang.org/cl/68116\" rel=\"noreferrer\">CL 68116</a> and <a href=\"https://golang.org/cl/75473\" rel=\"noreferrer\">CL 75473</a>. See <a href=\"https://groups.google.com/forum/#!msg/golang-dev/qfa3mHN4ZPA/X2UzjNV1BAAJ\" rel=\"noreferrer\">this thread</a>, that I reference here.</p>\n\n<blockquote>\n  <blockquote>\n    <p>What do exactly the <code>go build</code> and <code>go install</code> commands build</p>\n  </blockquote>\n  \n  <p>Whenever the go tool installs a package or binary, it also installs whatever dependencies it has, so running go install will also install packages your program depends on (publicly available, \"go gettable\" packages), automatically.</p>\n</blockquote>\n\n<p>Actually... <code>go install</code> will change also with Go 1.10, <em>in addition</em> of the new cache:</p>\n\n<blockquote>\n  <p>The \"<code>go install</code>\" command <strong>no longer installs dependencies of the named packages</strong> (<a href=\"https://golang.org/cl/75850\" rel=\"noreferrer\">CL 75850</a>). </p>\n  \n  <p><strong>If you run \"<code>go install foo</code>\", the only thing installed is <code>foo</code></strong>.  </p>\n  \n  <p>Before, it varied. If dependencies were out-of-date, \"<code>go install</code>\" also installed any dependencies.<br>\n  The implicit installation of dependencies during \"<code>go install</code>\" caused a lot of confusion and headaches for users, but it was previously necessary to enable incremental builds.<br>\n  Not anymore.<br>\n  We think that the new \"<code>install what I said</code>\" semantics will be much more understandable, especially since it's clear from bug reports that many users already expected them.<br>\n  <strong>To force installation of dependencies during \"<code>go install</code>\", use the new \"<code>go install -i</code>\"</strong>, by analogy with \"<code>go build -i</code>\" and \"<code>go test -i</code>\".</p>\n  \n  <p>The fact that \"<code>go install</code>\" used to install any rebuilt dependencies caused confusion most often in conjunction with <code>-a</code>, which means \"<code>force rebuild of all dependencies</code>\".<br>\n  Now, \"<code>go install -a myprog</code>\" will force a complete rebuild of all dependencies of <code>myprog</code>, as well as <code>myprog</code> itself, but only <code>myprog</code> will get installed. (All the rebuilt dependencies will still be saved in the build cache, of course.)<br>\n  Making this case work more understandably is especially important in conjunction with the new content-based staleness analysis, because it sees good reasons to rebuild dependencies more often than before, which would have increased the amount of \"why did my dependencies get installed\" confusion.<br>\n  For example, if you run \"<code>go install -gcflags=-N myprog</code>\", that installs a <code>myprog</code> built with no compiler optimizations, but it no longer also reinstalls the packages <code>myprog</code> uses from the standard library without compiler optimizations.</p>\n</blockquote>\n"}], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72325, "favorite_count": 38, "accepted_answer_id": 30612612, "answer_count": 2, "score": 122, "last_activity_date": 1577588251, "creation_date": 1433313562, "last_edit_date": 1577588251, "question_id": 30612611, "link": "https://stackoverflow.com/questions/30612611/what-does-go-build-build-go-build-vs-go-install", "title": "What does go build build? (go build vs. go install)", "body": "<p>New Go programmers often don't know or get confused what the fundamental go build command does.</p>\n\n<p>What do exactly the <code>go build</code> and <code>go install</code> commands build and where do they put the result/output?</p>\n"}, {"tags": ["json", "mongodb", "go"], "comments": [{"owner": {"reputation": 44359, "user_id": 2363712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/beAJU.jpg?s=128&g=1", "display_name": "Sylvain Leroux", "link": "https://stackoverflow.com/users/2363712/sylvain-leroux"}, "edited": false, "score": 0, "creation_date": 1433311375, "post_id": 30611086, "comment_id": 49290704, "body": "<i>&quot;Obviously this doesn&#39;t scale very well&quot;</i> Do you just want to get rid of the recursive call ? Or are you looking for some kind of proxy object accessing the underlying DB to retrieve data on a per-need basis ?"}, {"owner": {"reputation": 958, "user_id": 2626742, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3376e8297d843faf775b3cee1a906f9a?s=128&d=identicon&r=PG", "display_name": "Cody", "link": "https://stackoverflow.com/users/2626742/cody"}, "reply_to_user": {"reputation": 44359, "user_id": 2363712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/beAJU.jpg?s=128&g=1", "display_name": "Sylvain Leroux", "link": "https://stackoverflow.com/users/2363712/sylvain-leroux"}, "edited": false, "score": 0, "creation_date": 1433312495, "post_id": 30611086, "comment_id": 49291324, "body": "@SylvainLeroux Sorry for the ambiguity! I meant that it doesn&#39;t scale well in terms of the complexity of the code. I&#39;m mostly concerned with keeping things DRY -- there&#39;s some implications in regards to my project&#39;s structure (which would take to long to describe) as to why I want to avoid manually piecing together the json."}, {"owner": {"reputation": 3164, "user_id": 514329, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/6YdMT.jpg?s=128&g=1", "display_name": "Mohsen", "link": "https://stackoverflow.com/users/514329/mohsen"}, "edited": false, "score": 0, "creation_date": 1471874468, "post_id": 30611086, "comment_id": 65510750, "body": "I put <code>bson:&quot;_id,omitempty&quot; json:&quot;id,omitempty&quot;</code> in fromt of an string field, and worked like a charm."}, {"owner": {"reputation": 3164, "user_id": 514329, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/6YdMT.jpg?s=128&g=1", "display_name": "Mohsen", "link": "https://stackoverflow.com/users/514329/mohsen"}, "edited": false, "score": 0, "creation_date": 1471874674, "post_id": 30611086, "comment_id": 65510935, "body": "Adding a simple <code>bson:&quot;_id&quot;</code> to a string field does the trick"}], "answers": [{"comments": [{"owner": {"reputation": 958, "user_id": 2626742, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3376e8297d843faf775b3cee1a906f9a?s=128&d=identicon&r=PG", "display_name": "Cody", "link": "https://stackoverflow.com/users/2626742/cody"}, "edited": false, "score": 1, "creation_date": 1433358549, "post_id": 30626379, "comment_id": 49323118, "body": "Wow thank you so much, this is exactly what I was looking for! Although for future reference, I had to make some adjustments to make it compatible with MongoDB -- you need to add a <code>bson:&quot;,inline&quot;</code> tag next <code>Owner ownerObjID</code>, and a <code>bson:&quot;owner&quot;</code> tag next to <code>bson.ObjectId</code> in <code>struct ownerObjID</code>. This will store the ObjectId in MongoDB correctly under the name &quot;owner&quot;."}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 1, "last_activity_date": 1433350997, "creation_date": 1433350997, "answer_id": 30626379, "question_id": 30611086, "link": "https://stackoverflow.com/questions/30611086/replacing-objectid-with-embedded-json-when-marshaling-struct/30626379#30626379", "title": "Replacing ObjectId with embedded json when marshaling struct", "body": "<p>I'm not familar with MongoDB or <code>bson.ObjectId</code>, but can you substitute your own type for your <code>User</code> field and have MongoDB easily fill that in for you from a user's <code>bson.ObjectId</code>?</p>\n\n<p>If so you can just wrap user object id's into their own type that implements the <code>json.Marshaler</code> interface. E.g.:</p>\n\n<pre><code>// Embedded (instead of `type x bson.ObjectId`) so that we\n// get all the methods and satisfy all the interfaces that\n// bson.ObjectId does. Hopefully that's engough to allow MongoDB\n// to fill in fields of this type from a database??\ntype ownerObjID struct{ bson.ObjectId }\n\n// Here we marshal the results of looking up the user from the id\n// rather than just the ID itself.\nfunc (oid ownerObjID) MarshalJSON() ([]byte, error) {\n    user, err := LookupUser(oid.ObjectId)\n    if err != nil {\n        return nil, err\n    }\n    return json.Marshal(user)\n}\n\ntype Post struct {\n    ID    bson.ObjectId `json:\"id,omitempty\"`\n    Title string        `json:\"title,omitempty\"`\n    Owner ownerObjID    `json:\"owner,omitempty\"` // &lt;-- is this type wrapping doable/easy with MongoDB?\n}\n\ntype User struct {\n    ID   bson.ObjectId `json:\"id,omitempty\"`\n    Name string        `json:\"name,omitempty\"`\n}\n\nfunc main() {\n    post := LookupPost()\n    b, err := json.MarshalIndent(post, \"\", \"  \")\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"JSON:\\n%s\\n\", b)\n}\n\n// Some stubs for demo:\nfunc LookupPost() Post {\n    return Post{\n        ID:    \"postID001\",\n        Title: \"Ima Test\",\n        Owner: ownerObjID{\"ownerID002\"},\n    }\n}\n\nfunc LookupUser(id bson.ObjectId) (User, error) {\n    return User{\n        ID:   id,\n        Name: \"name for \" + string(id),\n    }, nil\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ds-u3lfEzu\" rel=\"nofollow\"><kbd>Playground</kbd></a></p>\n\n<p>Gives me:</p>\n\n<pre><code>JSON:\n{\n  \"id\": \"postID001\",\n  \"title\": \"Ima Test\",\n  \"owner\": {\n    \"id\": \"ownerID002\",\n    \"name\": \"name for ownerID002\"\n  }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 958, "user_id": 2626742, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3376e8297d843faf775b3cee1a906f9a?s=128&d=identicon&r=PG", "display_name": "Cody", "link": "https://stackoverflow.com/users/2626742/cody"}, "is_accepted": true, "score": 0, "last_activity_date": 1433460828, "creation_date": 1433460828, "answer_id": 30655945, "question_id": 30611086, "link": "https://stackoverflow.com/questions/30611086/replacing-objectid-with-embedded-json-when-marshaling-struct/30655945#30655945", "title": "Replacing ObjectId with embedded json when marshaling struct", "body": "<p>So I actually discovered a much cleaner solution to this problem:</p>\n\n<pre><code>type Post struct {\n    ID bson.ObjectId `bson:\"_id,omitempty\" json:\"id,omitempty\"`\n    Title string `bson:\"title,omitempty\" json:\"title,omitempty\"`\n    Owner UserRef `bson:\"owner,omitempty\" json:\"owner,omitempty\"`\n}\n\ntype User struct {\n    ID   bson.ObjectId `json:\"id,omitempty\"`\n    Name string        `json:\"name,omitempty\"`\n}\n\ntype UserRef bson.ObjectId\n\nfunc (ref UserRef) GetBSON() (interface{}, error) {\n    return bson.ObjectId(ref), nil\n}\n\nfunc (ref UserRef) MarshalJSON() ([]byte, error) {\n    u := LookupUserInMongoDB(ref)\n\n    return json.Marshal(u)\n}\n</code></pre>\n\n<p>Here's how it works -- mgo can't store UserRef as an ObjectId when converting a Post to bson, so we can implement the <code>GetBSON</code> method for UserRef to return the underlying ObjectId. This allows us to store Owner as an ObjectId in the database. And, like in @DaveC's answer, we implement the <code>MarshalJSON</code> method for UserRef so that when converting a Post to json, we can replace the ObjectId with an actual embedded user.</p>\n"}], "owner": {"reputation": 958, "user_id": 2626742, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3376e8297d843faf775b3cee1a906f9a?s=128&d=identicon&r=PG", "display_name": "Cody", "link": "https://stackoverflow.com/users/2626742/cody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1277, "favorite_count": 0, "accepted_answer_id": 30655945, "answer_count": 2, "score": 3, "last_activity_date": 1433460828, "creation_date": 1433307054, "last_edit_date": 1433314452, "question_id": 30611086, "link": "https://stackoverflow.com/questions/30611086/replacing-objectid-with-embedded-json-when-marshaling-struct", "title": "Replacing ObjectId with embedded json when marshaling struct", "body": "<p>I'm building a RESTful API with Go and MongoDB, and I'm running into some difficulty with embedding the JSON for one document inside the JSON for another. Here's a toy example of what I'm trying to accomplish. I have the following schemas:</p>\n\n<pre><code>type Post struct {\n    ID    bson.ObjectId `json:\"id,omitempty\"`\n    Title string        `json:\"title,omitempty\"`\n    Owner bson.ObjectId `json:\"owner,omitempty\"` // references a User\n}\n\ntype User struct {\n    ID   bson.ObjectId `json:\"id,omitempty\"`\n    Name string        `json:\"name,omitempty\"`\n}\n</code></pre>\n\n<p>When creating the JSON for a post, I'd like to first look up the owner of the post in MongoDB and embed the resulting user inside said post's JSON (in-place of the original <code>ObjectId</code>), like so:</p>\n\n<pre><code>{\n    \"id\": \"...\",\n    \"title\": \"My awesome post\",\n    \"owner\": {\n        \"id\": \"...\",\n        \"name\": \"Cody\"\n    }\n}\n</code></pre>\n\n<p>I'm not quite sure how to accomplish this, other than manually constructing the JSON using <code>map[string]interface{}</code>, like so:</p>\n\n<pre><code>post := LookupPost(...)\nuser := LookupUser(post.Owner)\n\nm := map[string]interface{}{\n    \"id\": post.ID,\n    \"title\": post.Title,\n    \"owner\": map[string]interface{}{\n        \"id\": user.ID,\n        \"name\": user.Name,\n    },\n}\n\nb, _ := json.Marshal(m)\n</code></pre>\n\n<p>Obviously this <strike>doesn't scale very well</strike> isn't very DRY -- ideally, I'd be able to utilize the <code>json</code> tags in each struct definition and have the fields inserted automatically.</p>\n\n<p>Am I missing something, or is what I'm trying to do impossible? Or am I simply not approaching MongoDB/JSON in Go correctly? To put things in perspective, I'm coming from a Node.js background, where this sort of functionality is trivial.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>To clarify things, here's some incorrect Go code that shows what I'd like to do</p>\n\n<pre><code>func getPostJSON() []byte {\n    p := LookupPost(...)\n    u := LookupUser(p.Owner, ...)\n\n    uj, _ := json.Marshal(u)\n    p.Owner = uj // can't do this in Go\n\n    pj, _ := json.Marshal(p)\n\n    return pj\n}\n</code></pre>\n"}, {"tags": ["templates", "go"], "answers": [{"tags": [], "owner": {"reputation": 166, "user_id": 4655777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f8a0f4579bd4de4ad1e1e1abf555759?s=128&d=identicon&r=PG", "display_name": "stonith", "link": "https://stackoverflow.com/users/4655777/stonith"}, "is_accepted": true, "score": 8, "last_activity_date": 1433324044, "last_edit_date": 1433324044, "creation_date": 1433321966, "answer_id": 30615359, "question_id": 30609485, "link": "https://stackoverflow.com/questions/30609485/with-golang-templates-how-can-i-set-a-variable-in-each-template/30615359#30615359", "title": "With Golang Templates how can I set a variable in each template?", "body": "<p>If you want to use the Value in another template you can pipeline it to the dot:</p>\n\n<pre><code>{{with $title := \"SomeTitle\"}}\n{{$title}} &lt;--prints the value on the page\n{{template \"body\" .}}\n{{end}}\n</code></pre>\n\n<p>body template:</p>\n\n<pre><code>{{define \"body\"}}\n&lt;h1&gt;{{.}}&lt;/h1&gt; &lt;--prints \"SomeTitle\" again\n{{end}}\n</code></pre>\n\n<p>As far as i know it is not possible to go upwards in the chain.\nSo <code>layout.html</code> gets rendered before <code>home.html</code>, so you cant pass a value back.</p>\n\n<p>In your example it would be the best solution to use a struct and pass it from the <code>layout.html</code> to the <code>home.html</code> using the <code>dot</code>:</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"html/template\"\n    \"net/http\"\n)\n\ntype WebData struct {\n    Title string\n}\n\nfunc homeHandler(w http.ResponseWriter, r *http.Request) {\n    tmpl, _ := template.ParseFiles(\"layout.html\", \"home.html\")\n    wd := WebData{\n        Title: \"Home\",\n    }\n    tmpl.Execute(w, &amp;wd)\n}\n\nfunc pageHandler(w http.ResponseWriter, r *http.Request) {\n    tmpl, _ := template.ParseFiles(\"layout.html\", \"page.html\")\n    wd := WebData{\n        Title: \"Page\",\n    }\n    tmpl.Execute(w, &amp;wd)\n}\n\nfunc main() {\n    http.HandleFunc(\"/home\", homeHandler)\n    http.HandleFunc(\"/page\", pageHandler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p><strong>layout.html</strong></p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;{{.Title}} &lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    {{template \"body\" .}}\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p><strong>home.html</strong></p>\n\n<pre><code>{{define \"body\"}}\n&lt;h1&gt;home.html {{.Title}}&lt;/h1&gt;\n{{end}}\n</code></pre>\n\n<p><strong>page.html</strong></p>\n\n<pre><code>{{define \"body\"}}\n&lt;h1&gt;page.html {{.Title}}&lt;/h1&gt;\n{{end}}\n</code></pre>\n\n<p>Also go has a nice documentation on how to use templates:</p>\n\n<p><a href=\"http://golang.org/pkg/text/template/\" rel=\"noreferrer\">http://golang.org/pkg/text/template/</a></p>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11403, "favorite_count": 4, "accepted_answer_id": 30615359, "answer_count": 1, "score": 7, "last_activity_date": 1433324044, "creation_date": 1433295943, "question_id": 30609485, "link": "https://stackoverflow.com/questions/30609485/with-golang-templates-how-can-i-set-a-variable-in-each-template", "title": "With Golang Templates how can I set a variable in each template?", "body": "<p>How can I set a variable in each template that I can use in other templates e.g.</p>\n\n<p><code>{{ set title \"Title\" }}</code></p>\n\n<p>in one template then in my layout</p>\n\n<p><code>&lt;title&gt; {{ title }} &lt;/title&gt;</code></p>\n\n<p>Then when it's rendered </p>\n\n<p><code>tmpl, _ := template.ParseFiles(\"layout.html\", \"home.html\")</code></p>\n\n<p>it will set the title according to whatever was set in <code>home.html</code> instead of having to make a <code>struct</code> for each view page when it isn't really necessary. I hope I made sense, thanks.</p>\n\n<p>Just for clarification:</p>\n\n<pre><code>layout.html:\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;{{ title }} &lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n\n  &lt;/body&gt;\n&lt;/html&gt;\n\nhome.html:\n{{ set Title \"Home\" . }}\n&lt;h1&gt; {{ Title }} Page &lt;/h1&gt;\n</code></pre>\n"}, {"tags": ["go", "sonarqube", "cobertura", "sonar-runner"], "answers": [{"comments": [{"owner": {"reputation": 1225, "user_id": 6434747, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3hAwL.jpg?s=128&g=1", "display_name": "Nebulosar", "link": "https://stackoverflow.com/users/6434747/nebulosar"}, "edited": false, "score": 0, "creation_date": 1515081822, "post_id": 30612483, "comment_id": 83173123, "body": "The generic coverage plugin is deleted, to bad"}, {"owner": {"reputation": 1225, "user_id": 6434747, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3hAwL.jpg?s=128&g=1", "display_name": "Nebulosar", "link": "https://stackoverflow.com/users/6434747/nebulosar"}, "edited": false, "score": 0, "creation_date": 1515081839, "post_id": 30612483, "comment_id": 83173134, "body": "for more on generic test coverage: <a href=\"https://docs.sonarqube.org/display/SONARQUBE45/Generic+Test+Coverage\" rel=\"nofollow noreferrer\">docs.sonarqube.org/display/SONARQUBE45/Generic+Test+Coverage</a>"}], "tags": [], "owner": {"reputation": 4069, "user_id": 806736, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7951dcb9edc6e3c03c9c9f8db8a863df?s=128&d=identicon&r=PG", "display_name": "Mithfindel", "link": "https://stackoverflow.com/users/806736/mithfindel"}, "is_accepted": false, "score": 0, "last_activity_date": 1433313158, "creation_date": 1433313158, "answer_id": 30612483, "question_id": 30606175, "link": "https://stackoverflow.com/questions/30606175/importing-go-source-and-coverage-into-sonarqube/30612483#30612483", "title": "Importing Go source and coverage into SonarQube", "body": "<p>Yes, to my knowledge the <a href=\"http://docs.sonarqube.org/display/PLUG/Cobertura+Plugin\" rel=\"nofollow\">SonarQube Cobertura</a> plugin only allows to import coverage reports for Java (and maybe supported JVM based languages).</p>\n\n<p>However, if you are willing to do some transformation on your coverage result file, the <a href=\"http://docs.sonarqube.org/display/PLUG/Generic+Test+Coverage\" rel=\"nofollow\">Generic Test Coverage</a> plugin might suit your needs.</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1561999798, "last_edit_date": 1592644375, "creation_date": 1561999798, "answer_id": 56839455, "question_id": 30606175, "link": "https://stackoverflow.com/questions/30606175/importing-go-source-and-coverage-into-sonarqube/56839455#56839455", "title": "Importing Go source and coverage into SonarQube", "body": "<p>Since <a href=\"https://www.sonarqube.org/sonarqube-7-9-lts/\" rel=\"nofollow noreferrer\">SonarQube 7.9</a> (July 2019), the go language is officially supported.<br />\nThat includes <a href=\"https://docs.sonarqube.org/latest/analysis/coverage/\" rel=\"nofollow noreferrer\">code coverage for Go</a>.\nAnd it is supported in the <a href=\"https://docs.sonarqube.org/latest/analysis/languages/overview/\" rel=\"nofollow noreferrer\">community edition</a>!</p>\n<p><a href=\"https://docs.sonarqube.org/7.9/analysis/languages/go/\" rel=\"nofollow noreferrer\">40 rules for Go were present since SonarQube 6.7</a>  .</p>\n<p>But the legacy <a href=\"https://github.com/SonarSource/sonar-go\" rel=\"nofollow noreferrer\"><code>SonarSource/sonar-go</code></a>, the  Go Analyzer for SonarQube, is now SonarQube LTS) par of <a href=\"https://github.com/SonarSource/slang\" rel=\"nofollow noreferrer\"><strong><code>SonarSource/slang</code></strong></a> (SonarSource Language), which is a framework to quickly develop code analyzers for SonarQube.<br />\nSee <a href=\"https://jira.sonarsource.com/browse/MMF-1670\" rel=\"nofollow noreferrer\">MMF-1670</a> (Migrate Go to SLANG)</p>\n<blockquote>\n<p>SonarGo is relying on the UAST technology developed early in the ideation phase of an unified language to write language parsers, which later led to the creation of SLANG.</p>\n<p>In order to unify the technologies we use, reduce the maintain cost, and benefit from more features, <strong>we need to migrate the current SonarGO implementation to a GO plugin relying solely on the SLANG framework</strong>.</p>\n</blockquote>\n<p>See <a href=\"https://jira.sonarsource.com/browse/SONARSLANG-399?jql=text%20%7E%20%22coverage%20go%22\" rel=\"nofollow noreferrer\">its Go code coverage SLang issues</a>, in particular: <a href=\"https://jira.sonarsource.com/browse/SONARSLANG-399\" rel=\"nofollow noreferrer\"><code>SONARSLANG-399</code></a></p>\n<pre><code>sonarqube {\n  properties {\n    property 'sonar.sources', '.'\n    property 'sonar.exclusions', '**/*_test.go,**/generate_source.go,**/*_generated.go,**/build/**,**/.gogradle/**'\n    property 'sonar.tests', '.'\n    property 'sonar.test.inclusions', '**/*_test.go'\n    property 'sonar.test.exclusions', '**/build/**,**/.gogradle/**'\n    property 'sonar.go.tests.reportPaths', &quot;${project.projectDir}/.gogradle/reports/test-report.out&quot;\n    property 'sonar.go.coverage.reportPaths', &quot;${project.projectDir}/.gogradle/reports/coverage/profiles/github.com%2FSonarSource%2Fsonar-go%2Fuast-generator-go.out&quot;\n  }\n}\n</code></pre>\n<p><a href=\"https://jira.sonarsource.com/browse/SONARSLANG-408\" rel=\"nofollow noreferrer\">SONARSLANG-408</a> (&quot;[Go] Import Go Cover report&quot;) is still in progress though.<br />\n(But is only 4 hours old, at the time of writing)</p>\n"}], "owner": {"reputation": 21, "user_id": 4966980, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153992238317627/picture?type=large", "display_name": "Andy McGuigan", "link": "https://stackoverflow.com/users/4966980/andy-mcguigan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4103, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1561999798, "creation_date": 1433277658, "question_id": 30606175, "link": "https://stackoverflow.com/questions/30606175/importing-go-source-and-coverage-into-sonarqube", "title": "Importing Go source and coverage into SonarQube", "body": "<p>I have a Go project that I would like to import into SonarQube 5.1, using SonarRunner. </p>\n\n<p>I know it's not one of SonarQube's supported languages so I have set the property </p>\n\n<pre><code>sonar.import_unknown_files=true\n</code></pre>\n\n<p>to accomplish some basic level of import - and it does the job. The project also has code coverage in Cobertura format, generated using <a href=\"https://github.com/axw/gocov/\" rel=\"nofollow\">https://github.com/axw/gocov/</a> and <a href=\"https://github.com/AlekSi/gocov-xml\" rel=\"nofollow\">https://github.com/AlekSi/gocov-xml</a>. </p>\n\n<p>I have not been successful in getting this XML to import with settings:</p>\n\n<pre><code>sonar.core.codeCoveragePlugin=cobertura\nsonar.cobertura.reportPath=coverage.xml\n</code></pre>\n\n<p>Hence the project appears as a gray box on the Sonar dashboard. Has anyone done something similar and got it working? Is it because Go is an unsupported language? </p>\n\n<p>Many thanks!</p>\n\n<p>Andy</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1579, "user_id": 1354514, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e83e6f559891e7489995dfa43e010fa3?s=128&d=identicon&r=PG", "display_name": "steve landiss", "link": "https://stackoverflow.com/users/1354514/steve-landiss"}, "edited": false, "score": 0, "creation_date": 1433276799, "post_id": 30605811, "comment_id": 49279854, "body": "For example, in function r() if I change the line to say cb(t.(*Bottom)), the code works.  But in function r() I do not want to know about any specific type."}, {"owner": {"reputation": 2809, "user_id": 680668, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f594cfa76cdc7d3046871b2b0976697?s=128&d=identicon&r=PG", "display_name": "Ryan Atallah", "link": "https://stackoverflow.com/users/680668/ryan-atallah"}, "edited": false, "score": 0, "creation_date": 1433276984, "post_id": 30605811, "comment_id": 49279958, "body": "If <code>cb()</code> requires a <code>Bottom</code>, then all callers will need to know about the <code>Bottom</code> type. If your callers can&#39;t know about the <code>Bottom</code> type, then your <code>cb()</code> function should take in an interface that <code>Bottom</code> implements instead of a struct of type <code>Bottom</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1579, "user_id": 1354514, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e83e6f559891e7489995dfa43e010fa3?s=128&d=identicon&r=PG", "display_name": "steve landiss", "link": "https://stackoverflow.com/users/1354514/steve-landiss"}, "edited": false, "score": 0, "creation_date": 1433277609, "post_id": 30605956, "comment_id": 49280282, "body": "I would like to do it such that my function r() does not know about Bottom."}, {"owner": {"reputation": 2809, "user_id": 680668, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f594cfa76cdc7d3046871b2b0976697?s=128&d=identicon&r=PG", "display_name": "Ryan Atallah", "link": "https://stackoverflow.com/users/680668/ryan-atallah"}, "reply_to_user": {"reputation": 1579, "user_id": 1354514, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e83e6f559891e7489995dfa43e010fa3?s=128&d=identicon&r=PG", "display_name": "steve landiss", "link": "https://stackoverflow.com/users/1354514/steve-landiss"}, "edited": false, "score": 0, "creation_date": 1433284929, "post_id": 30605956, "comment_id": 49283312, "body": "In that case you&#39;ll need to define an interface that <code>r()</code> does know about that <code>Bottom</code> implements, and have <code>cb</code> take in an instance of that interface instead of a parameter of type <code>Bottom</code>."}], "tags": [], "owner": {"reputation": 2809, "user_id": 680668, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f594cfa76cdc7d3046871b2b0976697?s=128&d=identicon&r=PG", "display_name": "Ryan Atallah", "link": "https://stackoverflow.com/users/680668/ryan-atallah"}, "is_accepted": true, "score": 2, "last_activity_date": 1433276877, "creation_date": 1433276877, "answer_id": 30605956, "question_id": 30605811, "link": "https://stackoverflow.com/questions/30605811/how-do-i-pass-in-an-interface-to-a-function-as-a-specific-structure/30605956#30605956", "title": "How do I pass in an interface{} to a function as a specific structure?", "body": "<p>You will need to <a href=\"https://golang.org/doc/effective_go.html#interface_conversions\" rel=\"nofollow\">use a type assertion</a> to convert your <code>interface{}</code> to the type that your function requires. You can then add error checking to appropriately handle the case where your parameter can't be typecast to the desired type.</p>\n\n<p>See this generic playground that demonstrates the solution: <a href=\"http://play.golang.org/p/NYeoAVTEeA\" rel=\"nofollow\">http://play.golang.org/p/NYeoAVTEeA</a></p>\n\n<p>In your case, that means</p>\n\n<pre><code>cb(&amp;t.(Bottom))\n</code></pre>\n\n<p>You can add error checking:</p>\n\n<pre><code>bottom, ok := t.(Bottom)\nif !ok {\n  // do something\n}\ncb(&amp;bottom)\n</code></pre>\n"}], "owner": {"reputation": 1579, "user_id": 1354514, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e83e6f559891e7489995dfa43e010fa3?s=128&d=identicon&r=PG", "display_name": "steve landiss", "link": "https://stackoverflow.com/users/1354514/steve-landiss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 30605956, "answer_count": 1, "score": -2, "last_activity_date": 1433276877, "creation_date": 1433276375, "question_id": 30605811, "link": "https://stackoverflow.com/questions/30605811/how-do-i-pass-in-an-interface-to-a-function-as-a-specific-structure", "title": "How do I pass in an interface{} to a function as a specific structure?", "body": "<p>I am trying to have a generic routine handle messages between specific components.  Part of this involves reading a byte array and using json.Marshal and json.Unmarshal and calling a callback.</p>\n\n<p>I am trying to pass an interface to a function who expects a specific structure, but I do not know the type of the target structure.  In the code below, how does function r() call function cb() and pass in the correct data?</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Bottom struct {\n    Foo string\n}\n\nfunc cb(b *Bottom) {\n\n    fmt.Println(\"5. \", b)\n}\n\nfunc r(t interface{}, buf []byte) {\n\n    _ = json.Unmarshal(buf, &amp;t)\n\n    fmt.Println(\"2. \", reflect.TypeOf(t))\n    fmt.Println(\"3. \", t)\n\n    cb(&amp;t)\n}\n\nfunc main() {\n    x := Bottom{Foo: \"blah\"}\n    var y Bottom\n\n    buf, _ := json.Marshal(x)\n\n    fmt.Println(\"1. \", x)\n    r(&amp;y, buf)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "edited": false, "score": 0, "creation_date": 1433276041, "post_id": 30605605, "comment_id": 49279421, "body": "you both responded &quot;5 mins ago&quot;. I don&#39;t know whose answer to accept so I&#39;ll toss a coin. I voted both of you up, however."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 3, "last_activity_date": 1433275626, "creation_date": 1433275626, "answer_id": 30605605, "question_id": 30605500, "link": "https://stackoverflow.com/questions/30605500/route-a-put-request-without-a-third-party-routing-library/30605605#30605605", "title": "route a PUT request without a third party routing library", "body": "<p><code>HandleFunc</code> doesn't know what to do with <code>{id}</code>. Give it a specific path it can match:</p>\n\n<pre><code>http.HandleFunc(\"/products/\", doSomethingWithProduct)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "edited": false, "score": 0, "creation_date": 1433276053, "post_id": 30605610, "comment_id": 49279429, "body": "according to SO, you and JimB both responded &quot;5 mins ago&quot;. I don&#39;t know whose answer to accept so I&#39;ll toss a coin. I voted both of you up, however."}], "tags": [], "owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "is_accepted": true, "score": 3, "last_activity_date": 1433275634, "creation_date": 1433275634, "answer_id": 30605610, "question_id": 30605500, "link": "https://stackoverflow.com/questions/30605500/route-a-put-request-without-a-third-party-routing-library/30605610#30605610", "title": "route a PUT request without a third party routing library", "body": "<p><code>http.HandleFunc</code> does not handle the \"capture groups\" like you're trying to do with <code>{id}</code>.</p>\n\n<p><code>http.HandleFunc(\"/products/\", handler)</code> will match all routes that begin with this pattern. You have to parse the rest of it yourself.</p>\n\n<p>See <a href=\"http://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow\">ServeMux</a>.</p>\n\n<blockquote>\n  <p>ServeMux is an HTTP request multiplexer. It matches the URL of each incoming request against a list of registered patterns and calls the handler for the pattern that most closely matches the URL.</p>\n  \n  <p>Patterns name fixed, rooted paths, like \"/favicon.ico\", or rooted subtrees, like \"/images/\" (note the trailing slash). Longer patterns take precedence over shorter ones, so that if there are handlers registered for both \"/images/\" and \"/images/thumbnails/\", the latter handler will be called for paths beginning \"/images/thumbnails/\" and the former will receive requests for any other paths in the \"/images/\" subtree.</p>\n  \n  <p>Note that since a pattern ending in a slash names a rooted subtree, the pattern \"/\" matches all paths not matched by other registered patterns, not just the URL with Path == \"/\".</p>\n  \n  <p>Patterns may optionally begin with a host name, restricting matches to URLs on that host only. Host-specific patterns take precedence over general patterns, so that a handler might register for the two patterns \"/codesearch\" and \"codesearch.google.com/\" without also taking over requests for \"<a href=\"http://www.google.com/\" rel=\"nofollow\">http://www.google.com/</a>\".</p>\n  \n  <p>ServeMux also takes care of sanitizing the URL request path, redirecting any request containing . or .. elements to an equivalent .- and ..-free URL.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 3, "last_activity_date": 1433276057, "creation_date": 1433276057, "answer_id": 30605723, "question_id": 30605500, "link": "https://stackoverflow.com/questions/30605500/route-a-put-request-without-a-third-party-routing-library/30605723#30605723", "title": "route a PUT request without a third party routing library", "body": "<p>The builtin HTTP router doesn't do anything fancy like binding parameters; however, you can specify entire prefixes to associate with a handler.  See the documentation for <a href=\"http://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow\"><code>http.ServeMux</code></a>.</p>\n\n<p>Try something like this:</p>\n\n<pre><code>func main() {\n  productsPrefix := \"/products/\"\n  http.HandleFunc(productsPrefix, func(w http.ResponseWriter, r *http.Request) {\n    if (r.Method == \"PUT\") &amp;&amp; (strings.Index(r.URL.Path, productsPrefix) == 0) {\n      productId := r.URL.Path[len(productsPrefix):]\n      fmt.Printf(\"OK: %s %s productId=%s\\n\", r.Method, r.URL.Path, productId)\n    }\n  })\n\n  log.Print(\"Listening on localhost:8080\")\n  log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>For example:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ curl -XPUT http://localhost:8080/products/1234\n# =&gt; OK: PUT /products/1234 productId=1234\n</code></pre>\n"}], "owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 30605610, "answer_count": 3, "score": -1, "last_activity_date": 1433276057, "creation_date": 1433275217, "question_id": 30605500, "link": "https://stackoverflow.com/questions/30605500/route-a-put-request-without-a-third-party-routing-library", "title": "route a PUT request without a third party routing library", "body": "<p>In <a href=\"https://www.youtube.com/watch?v=yi5A3cK1LNA\" rel=\"nofollow\">this</a> Youtube video (at around 15:29) of a Golang talk by Blake Mizerany, he talks about how to build a router without using a third party package, covering in detail how to construct a route that has a variable component, such as an id. This is the handler that he uses, with the first line showing how to get the variable component of the route (i.e. the key)</p>\n\n<pre><code>func productHandler(w http.ResponseWriter, r *http.Request){\n    key := r.URL.Path[len(\"/products/\":]\n    switch r.Method{\n    case \"GET\":\n      //do stuff\n    case \"POST\"\n      //do stuff\n    default:\n       http.Error(w, \"method not allowed\", 405)\n    }\n}\n</code></pre>\n\n<p>It's not clear from his presentation though what his actual route looks like. </p>\n\n<p>I'm trying to build a route that handles a put request with an id. When I click an element on my page, it sends a put request to this route</p>\n\n<pre><code>http://localhost:8080/products/1433255183951\n</code></pre>\n\n<p>I have a route like this</p>\n\n<pre><code>   http.HandleFunc(\"/products/{id}\", doSomethingWithProduct){\n\n   }\n</code></pre>\n\n<p>and of course have the func</p>\n\n<pre><code>func doSomethingWithProduct(res http.ResponseWriter, req *http.Request{\n     key := req.URL.Path[len(\"/products/\"):]\n\n     log.Println(key, \"is this logging?? nope\")\n\n}\n</code></pre>\n\n<p>Problem. Even though I have that route set up, and the handler, when I click the element I got a 404 not found, and there's no indication that my function was called (i.e. it's not logging)</p>\n\n<p>Question: How do I create a custom route/func that handles a PUT request to </p>\n\n<pre><code>http://localhost:8080/products/1433255183951\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 303, "user_id": 3873801, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3626962a476e6d7b63293ada60529b65?s=128&d=identicon&r=PG&f=1", "display_name": "afboteros", "link": "https://stackoverflow.com/users/3873801/afboteros"}, "reply_to_user": {"reputation": 1158, "user_id": 1167872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HJsta.jpg?s=128&g=1", "display_name": "Paul O.", "link": "https://stackoverflow.com/users/1167872/paul-o"}, "edited": false, "score": 0, "creation_date": 1433274645, "post_id": 30604999, "comment_id": 49278623, "body": "@PaulO. Thanks a lot, that was exactly the problem."}], "answers": [{"tags": [], "owner": {"reputation": 1804, "user_id": 1260229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a918b56d3f83f46ced68b33737396b87?s=128&d=identicon&r=PG", "display_name": "sn&#248;reven", "link": "https://stackoverflow.com/users/1260229/sn%c3%b8reven"}, "is_accepted": false, "score": 3, "last_activity_date": 1433274582, "creation_date": 1433274582, "answer_id": 30605311, "question_id": 30604999, "link": "https://stackoverflow.com/questions/30604999/go-write-carriage-return-with-io/30605311#30605311", "title": "Go: Write carriage return with IO", "body": "<p>Carriage return is <code>\\r</code> not <code>\\n</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 303, "user_id": 3873801, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3626962a476e6d7b63293ada60529b65?s=128&d=identicon&r=PG&f=1", "display_name": "afboteros", "link": "https://stackoverflow.com/users/3873801/afboteros"}, "is_accepted": false, "score": 5, "last_activity_date": 1433274770, "creation_date": 1433274770, "answer_id": 30605363, "question_id": 30604999, "link": "https://stackoverflow.com/questions/30604999/go-write-carriage-return-with-io/30605363#30605363", "title": "Go: Write carriage return with IO", "body": "<p>The problem was the way Windows expects carriage return, \"\\n\" is Unix way, and \"\\r\\n\" is Windows way.</p>\n\n<p>So, just replacing it does the trick. </p>\n\n<pre><code>n, err := io.WriteString(f, \"Hello World\\r\\n\")\n</code></pre>\n"}], "owner": {"reputation": 303, "user_id": 3873801, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3626962a476e6d7b63293ada60529b65?s=128&d=identicon&r=PG&f=1", "display_name": "afboteros", "link": "https://stackoverflow.com/users/3873801/afboteros"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9673, "favorite_count": 2, "closed_date": 1433274795, "answer_count": 2, "score": 2, "last_activity_date": 1433274770, "creation_date": 1433273559, "question_id": 30604999, "link": "https://stackoverflow.com/questions/30604999/go-write-carriage-return-with-io", "closed_reason": "Duplicate", "title": "Go: Write carriage return with IO", "body": "<p>I'm trying to write on a file in Go with IO.WriteString, but even writing \"\\n\" character it does not print the carriage return. I think maybe is not the carriage return itself what i need to write, in Windows, if i open the txt file with Wordpad, the carriage return is shown, but not in the notepad.</p>\n\n<p>Any ideas about this behaviour?, here is the code:</p>\n\n<pre><code>//Write\nt := time.Now().Local()\nsrc, err := os.Stat(\"/dir\")\nif err != nil {\n    log.Println(err, log.Llongfile)\n}\nif !src.IsDir() {\n    err = errors.New(\"Folder does not exists\")\n    log.Println(err, log.Llongfile)\n    err = os.MkdirAll(\"/dir\", 665)\n    log.Println(err, log.Llongfile)\n}\nf, err := os.Create(\"/dir\" + \"/File_\" + t.Format(\"20060102\") + \".txt\")\nn, err := io.WriteString(f, \"Hello World\\n\")\nn, err = io.WriteString(f, \"Goodbye\\n\")\n</code></pre>\n\n<p>With this code, the result in the txt file is \"Hello WorldGoodbye\" if i open it in Windows notepad.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 1, "creation_date": 1433263634, "post_id": 30601495, "comment_id": 49272177, "body": "I can&#39;t reproduce this with a simple program (<a href=\"http://play.golang.org/p/9QQEkVED8i\" rel=\"nofollow noreferrer\">play.golang.org/p/9QQEkVED8i</a>). Do you have a minimal, complete, verifiable test case that demonstrates the problem?"}, {"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 1, "creation_date": 1433266890, "post_id": 30601495, "comment_id": 49274228, "body": "<code>module.py</code> suggests that you already have a python program listening to that port and your Go app failed to bind to the port"}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 3820958, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WpdI9.jpg?s=128&g=1", "display_name": "heisenb0rg", "link": "https://stackoverflow.com/users/3820958/heisenb0rg"}, "edited": false, "score": 0, "creation_date": 1563455851, "post_id": 30601995, "comment_id": 100712130, "body": "This needs more of an explanation. You no longer specify the port to listen on, so... what&#39;s going on here?"}], "tags": [], "owner": {"reputation": 689, "user_id": 4790925, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/2cc53e8c0ce2780e65098f82c20be15e?s=128&d=identicon&r=PG&f=1", "display_name": "Thargor", "link": "https://stackoverflow.com/users/4790925/thargor"}, "is_accepted": true, "score": 2, "last_activity_date": 1433263766, "creation_date": 1433263766, "answer_id": 30601995, "question_id": 30601495, "link": "https://stackoverflow.com/questions/30601495/golang-mux-handlefunc-always-404/30601995#30601995", "title": "golang mux HandleFunc always 404", "body": "<p>Found solution.</p>\n\n<p>Change</p>\n\n<pre><code>http.ListenAndServe(\":8080\", mx)\n</code></pre>\n\n<p>To</p>\n\n<pre><code>http.Handle(\"/\", mx)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 381, "user_id": 5193766, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh5.googleusercontent.com/-ijH86FwAgd0/AAAAAAAAAAI/AAAAAAAAAXc/VxUFFDcM_38/photo.jpg?sz=128", "display_name": "Gaurav Sharma", "link": "https://stackoverflow.com/users/5193766/gaurav-sharma"}, "is_accepted": false, "score": 0, "last_activity_date": 1580061803, "creation_date": 1580061803, "answer_id": 59921208, "question_id": 30601495, "link": "https://stackoverflow.com/questions/30601495/golang-mux-handlefunc-always-404/59921208#59921208", "title": "golang mux HandleFunc always 404", "body": "<p>You forgot to add the default handler. It's always better to keep the method along with the handlers.</p>\n\n<pre><code> import (\n        _ \"github.com/go-sql-driver/mysql\"\n        \"github.com/gorilla/mux\"\n        _ \"io/ioutil\"\n        \"net/http\"\n    )\n\n\nfunc init() {\n\n    mx := mux.NewRouter()\n\n    //create a poll\n    mx.Path(\"/\").HandlerFunc(indexHandler)\n    mx.PathPrefix(\"/poll\", pollCreate).Method(\"POST)\n    mx.PathPrefix(\"/poll/{id}\", loadPoll)\n    mx.PathPrefix(\"/poll/vote\", castVote)\n\n    http.ListenAndServe(\":8080\", mx)\n}\n</code></pre>\n"}], "owner": {"reputation": 689, "user_id": 4790925, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/2cc53e8c0ce2780e65098f82c20be15e?s=128&d=identicon&r=PG&f=1", "display_name": "Thargor", "link": "https://stackoverflow.com/users/4790925/thargor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1186, "favorite_count": 0, "accepted_answer_id": 30601995, "answer_count": 2, "score": 2, "last_activity_date": 1580061803, "creation_date": 1433262315, "last_edit_date": 1433399304, "question_id": 30601495, "link": "https://stackoverflow.com/questions/30601495/golang-mux-handlefunc-always-404", "title": "golang mux HandleFunc always 404", "body": "<p>I try to handle HTTP request using mux instead of standart HandleFunc from net/http, because of reasons. With http it used to work, with mux it doesnt. </p>\n\n<pre><code>import (\n    _ \"github.com/go-sql-driver/mysql\"\n    \"github.com/gorilla/mux\"\n    _ \"io/ioutil\"\n    \"net/http\"\n)\n\n\nfunc init() {\n\n    mx := mux.NewRouter()\n\n    //create a poll\n    mx.HandleFunc(\"/poll\", pollCreate)\n    mx.HandleFunc(\"/poll/{id}\", loadPoll)\n    mx.HandleFunc(\"/poll/vote\", castVote)\n\n    http.ListenAndServe(\":8080\", mx)\n}\n</code></pre>\n\n<p>The following POST request</p>\n\n<pre><code>localhost:8080/poll\n</code></pre>\n\n<p>Results in:</p>\n\n<pre><code>INFO     2015-06-02 16:23:12,219 module.py:718] default: \"POST /poll HTTP/1.1\" 404 19\n</code></pre>\n"}, {"tags": ["algorithm", "go"], "comments": [{"owner": {"reputation": 2364, "user_id": 3967289, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/78b45aa13a80357e212ca1ec4e015f54?s=128&d=identicon&r=PG&f=1", "display_name": "H W", "link": "https://stackoverflow.com/users/3967289/h-w"}, "edited": false, "score": 0, "creation_date": 1433247373, "post_id": 30595330, "comment_id": 49260002, "body": "Do you use the exact same arrays for A and B as given in the link that you provided? I don&#39;t see any reason why the result would be negative if both A and B consist of small, positive integers."}, {"owner": {"reputation": 11, "user_id": 2142415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3da49207c12963e5eaf443190b21be44?s=128&d=identicon&r=PG", "display_name": "victor1ee", "link": "https://stackoverflow.com/users/2142415/victor1ee"}, "reply_to_user": {"reputation": 2364, "user_id": 3967289, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/78b45aa13a80357e212ca1ec4e015f54?s=128&d=identicon&r=PG&f=1", "display_name": "H W", "link": "https://stackoverflow.com/users/3967289/h-w"}, "edited": false, "score": 0, "creation_date": 1433253025, "post_id": 30595330, "comment_id": 49264464, "body": "The sample array results OK. But after submitting the code, it failed with some cases. Unfortunatly, codilty doesn&#39;t show the exactly test case so I&#39;ve no idea about the array used in the case. Strange!"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 2142415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3da49207c12963e5eaf443190b21be44?s=128&d=identicon&r=PG", "display_name": "victor1ee", "link": "https://stackoverflow.com/users/2142415/victor1ee"}, "edited": false, "score": 0, "creation_date": 1433297756, "post_id": 30598939, "comment_id": 49286694, "body": "It makes sence! The codility problem assumes <code>each element of array B is an integer within the range [1..30]</code>, maybe some test case&#39;s inputs exceed that limit."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 0, "last_activity_date": 1433257291, "last_edit_date": 1433257291, "creation_date": 1433255304, "answer_id": 30598939, "question_id": 30595330, "link": "https://stackoverflow.com/questions/30595330/why-the-code-returns-negative-values-in-codility-test-case/30598939#30598939", "title": "Why the code returns negative values in Codility test case?", "body": "<p>For some input, you're converting a value in the range <code>[1&lt;&lt;31, 1&lt;&lt;32)</code> to an <code>int32</code>. </p>\n\n<p><a href=\"http://play.golang.org/p/6HYPXY9Kjb\" rel=\"nofollow\">http://play.golang.org/p/6HYPXY9Kjb</a></p>\n\n<pre><code>a := int64(1 &lt;&lt; 31)\nb := int64(1&lt;&lt;32 - 1)\n// int32(a) == -2147483648\n// int32(b) == -1\n</code></pre>\n\n<p>Depending on how your algorithm is supposed to work, you need to expand the range to use <code>int64</code>, or use a <code>uint32</code>, which will truncate the value but remain positive. </p>\n"}], "owner": {"reputation": 11, "user_id": 2142415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3da49207c12963e5eaf443190b21be44?s=128&d=identicon&r=PG", "display_name": "victor1ee", "link": "https://stackoverflow.com/users/2142415/victor1ee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 213, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1433257291, "creation_date": 1433245976, "question_id": 30595330, "link": "https://stackoverflow.com/questions/30595330/why-the-code-returns-negative-values-in-codility-test-case", "title": "Why the code returns negative values in Codility test case?", "body": "<p>The Codility problem and test case are shown in:<a href=\"https://codility.com/demo/results/demoCM9HYB-MXE/\" rel=\"nofollow\">here</a></p>\n\n<p>The code written in golang:  </p>\n\n<pre><code>func Solution(A []int, B []int) []int {\n    result := make([]int, len(A))\n    step := make([]int, len(A)+1)\n    step[0] = 1\n    step[1] = 1\n    for i := 2; i &lt;= len(A); i++ {\n        step[i] = step[i-1] + step[i-2]\n    }\n    for i := 0; i &lt; len(A); i++ {\n        result[i] = int(int32(step[A[i]]) % int32(math.Pow(2, float64(B[i]))))\n        // result[i] = step[A[i]] &amp; (1&lt;&lt;uint(B[i]) - 1)\n    }\n    return result\n}\n</code></pre>\n\n<p>The <code>result[i] = step[A[i]] &amp; (1&lt;&lt;uint(B[i]) - 1)</code> passes all the cases. But <code>result[i] = int(int32(step[A[i]]) % int32(math.Pow(2, float64(B[i]))))</code> or <code>result[i] = step[A[i]] % int(math.Pow(2, float64(B[i])))</code> results some negative numbers.</p>\n\n<p>It seems something goes overflow. Would anyone know reason? Thanks!</p>\n"}, {"tags": ["go", "http-headers", "metrics", "endpoints", "endpointbehavior"], "answers": [{"comments": [{"owner": {"reputation": 3563, "user_id": 685540, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/4447ba1ad70d4b35cd418817d30dae9f?s=128&d=identicon&r=PG", "display_name": "atilkan", "link": "https://stackoverflow.com/users/685540/atilkan"}, "edited": false, "score": 0, "creation_date": 1507484673, "post_id": 30781380, "comment_id": 80217552, "body": "Put full example."}], "tags": [], "owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "is_accepted": true, "score": 2, "last_activity_date": 1438530485, "last_edit_date": 1438530485, "creation_date": 1434027235, "answer_id": 30781380, "question_id": 30595236, "link": "https://stackoverflow.com/questions/30595236/golang-implements-http-server-health-checking-gocraft-health/30781380#30781380", "title": "Golang: implements http server health checking. gocraft/health", "body": "<p>Finally, I choose <strong>\"gocraft/health\"</strong>, a great library. </p>\n\n<p>Example of usage:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"time\"\n\n    \"github.com/gocraft/health\"\n)\n\n//should be global Var\nvar stream = health.NewStream()\n\nfunc main() {\n    // Log to stdout!\n    stream.AddSink(&amp;health.WriterSink{os.Stdout})\n    // Make sink and add it to stream\n    sink := health.NewJsonPollingSink(time.Minute*5, time.Minute*20)\n    stream.AddSink(sink)\n    // Start the HTTP server! This will expose metrics via a JSON API.\n    adr := \"127.0.0.1:5001\"\n    sink.StartServer(adr)\n\n    http.HandleFunc(\"/api/getVastPlayer\", vastPlayer)\n    log.Println(\"Listening...\")\n    panic(http.ListenAndServe(\":2001\", nil))\n}\n</code></pre>\n\n<p>Per the initialization options above, your metrics are aggregated in 5-minute chunks. We'll keep 20 minutes worth of data in memory. Nothing is ever persisted to disk. </p>\n\n<p>You can create as many jobs as you want </p>\n\n<pre><code>func vastPlayer(w http.ResponseWriter, r *http.Request) {\n  job_1 := stream.NewJob(\"/api/getVastPlayer\")\n\n  ...\n  ...\n\n  if bol {\n    job_1.Complete(health.Success)\n  } else {\n    job_1.Complete(health.Error)\n  }\n}\n</code></pre>\n\n<p>Once you start your app, this will expose metrics via a JSON API. You can browse the <code>/health</code> endpoint (eg, <code>127.0.0.1:5001/health</code>) to see the metrics. You will get something like that:</p>\n\n<pre><code>{\n  \"instance_id\": \"sd-69536.29342\",\n  \"interval_duration\": 86400000000000,\n  \"aggregations\": [\n    {\n      \"interval_start\": \"2015-06-11T02:00:00+02:00\",\n      \"serial_number\": 1340,\n      \"jobs\": {\n        \"/api/getVastPlayer\": {\n          \"timers\": {},\n          \"events\": {},\n          \"event_errs\": {},\n          \"count\": 1328,\n          \"nanos_sum\": 140160794784,\n          \"nanos_sum_squares\": 9.033775178022173E+19,\n          \"nanos_min\": 34507863,\n          \"nanos_max\": 2736850494,\n          \"count_success\": 62,\n          \"count_validation_error\": 1266,\n          \"count_panic\": 0,\n          \"count_error\": 0,\n          \"count_junk\": 0\n        },\n        \"timers\": {},\n        \"events\": {},\n        \"event_errs\": {}\n      }\n    }\n  ]\n}\n</code></pre>\n\n<p>For more information and functionality check this link:  </p>\n\n<p><a href=\"https://github.com/gocraft/health\" rel=\"nofollow\">https://github.com/gocraft/health</a></p>\n"}, {"tags": [], "owner": {"reputation": 13980, "user_id": 3554264, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/TbLcc.jpg?s=128&g=1", "display_name": "Christian Hujer", "link": "https://stackoverflow.com/users/3554264/christian-hujer"}, "is_accepted": false, "score": 1, "last_activity_date": 1583687583, "last_edit_date": 1583687583, "creation_date": 1583686903, "answer_id": 60589882, "question_id": 30595236, "link": "https://stackoverflow.com/questions/30595236/golang-implements-http-server-health-checking-gocraft-health/60589882#60589882", "title": "Golang: implements http server health checking. gocraft/health", "body": "<p>In case you came across this question because you were looking for exposing a <code>/health</code> endpoint, there is an upcoming RFC for health checks: <a href=\"https://github.com/inadarei/rfc-healthcheck\" rel=\"nofollow noreferrer\">https://github.com/inadarei/rfc-healthcheck</a></p>\n\n<p>And there's a Go library <code>health-go</code> for exposing health endpoints compliant with that RFC: <a href=\"https://github.com/nelkinda/health-go\" rel=\"nofollow noreferrer\">https://github.com/nelkinda/health-go</a></p>\n\n<p>Example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"github.com/nelkinda/health-go\"\n    \"net/http\"\n)\n\nfunc main() {\n    // 1. Create the health Handler.\n    h := health.New(health.Health{Version: \"1\", ReleaseID: \"1.0.0-SNAPSHOT\"}) \n\n    // 2. Add the handler to your mux/server.\n    http.HandleFunc(\"/health\", h.Handler)\n\n    // 3. Start your server.\n    http.ListenAndServe(\":80\", nil)\n}\n</code></pre>\n\n<p>It is extensible and supports a number of built-in checks such as uptime and sysinfo.</p>\n\n<p>Disclaimer: I'm the author of <code>health-go</code>.</p>\n"}], "owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3290, "favorite_count": 0, "accepted_answer_id": 30781380, "answer_count": 2, "score": 2, "last_activity_date": 1583687583, "creation_date": 1433245670, "last_edit_date": 1433266998, "question_id": 30595236, "link": "https://stackoverflow.com/questions/30595236/golang-implements-http-server-health-checking-gocraft-health", "title": "Golang: implements http server health checking. gocraft/health", "body": "<p>I want to check the health of my service,having the metrics of each endPoint.\nMy service calls some other services and recieves a Json code, I make templates with it, and then I send it to a http.ResponseWriter.</p>\n\n<p>I searched and I found this package <strong>\"gocraft/health\"</strong> but I didn't really understand how it works.</p>\n\n<p>Is there any other way or package to generate metrics or should I just use \"gocraft/health.</p>\n\n<p>Thank you in advance</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1433238466, "post_id": 30592459, "comment_id": 49253879, "body": "Call <code>go get</code> with <code>-x</code> command line flag to see what go get is doing. And do not set GOROOT."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1433239025, "post_id": 30592459, "comment_id": 49254263, "body": "What version of git do you have?"}, {"owner": {"reputation": 608, "user_id": 4050822, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/UiYwh.jpg?s=128&g=1", "display_name": "Shivendra Mishra", "link": "https://stackoverflow.com/users/4050822/shivendra-mishra"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1433239514, "post_id": 30592459, "comment_id": 49254568, "body": "git version 1.7.1 @JimB"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1433240260, "post_id": 30592459, "comment_id": 49255029, "body": "update git. That&#39;s old and doesn&#39;t work correctly."}, {"owner": {"reputation": 608, "user_id": 4050822, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/UiYwh.jpg?s=128&g=1", "display_name": "Shivendra Mishra", "link": "https://stackoverflow.com/users/4050822/shivendra-mishra"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1433246561, "post_id": 30592459, "comment_id": 49259388, "body": "Thanks! It works. @JimB"}], "answers": [{"tags": [], "owner": {"reputation": 608, "user_id": 4050822, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/UiYwh.jpg?s=128&g=1", "display_name": "Shivendra Mishra", "link": "https://stackoverflow.com/users/4050822/shivendra-mishra"}, "is_accepted": true, "score": 1, "last_activity_date": 1433246480, "creation_date": 1433246480, "answer_id": 30595525, "question_id": 30592459, "link": "https://stackoverflow.com/questions/30592459/go-get-command-of-golang-is-not-responding/30595525#30595525", "title": "go get command of golang is not responding", "body": "<p>It happens because of old version of git.</p>\n"}], "owner": {"reputation": 608, "user_id": 4050822, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/UiYwh.jpg?s=128&g=1", "display_name": "Shivendra Mishra", "link": "https://stackoverflow.com/users/4050822/shivendra-mishra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1668, "favorite_count": 0, "accepted_answer_id": 30595525, "answer_count": 1, "score": 1, "last_activity_date": 1433246480, "creation_date": 1433237918, "last_edit_date": 1433239968, "question_id": 30592459, "link": "https://stackoverflow.com/questions/30592459/go-get-command-of-golang-is-not-responding", "title": "go get command of golang is not responding", "body": "<p>I am facing a strange situation. I tried to run:</p>\n\n<pre><code>go get -x github.com/hooklift/gowsdl\ncd.\ngit clone https://gopkg.in/inconshreveable/log15.v2 /home/usr_a/gocode/src/gopkg.in/inconshreveable/log15.v2\n</code></pre>\n\n<p>And I don't see this command giving any response. It never returns.</p>\n\n<p>This is my <code>$GOPATH</code>:</p>\n\n<pre><code>/home/usr_a/gocode\n</code></pre>\n\n<p>and <code>$GOROOT</code>:</p>\n\n<pre><code>/usr/local/go/\n</code></pre>\n\n<p>However, the version shows like this:</p>\n\n<pre><code>go version go1.4.2 linux/amd64\n</code></pre>\n\n<p>Any idea, where am I going wrong or can point me to the way we install github module in golang?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 4883216, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/73a6db6ae7d0691b4448877e3f607ee4?s=128&d=identicon&r=PG&f=1", "display_name": "Elegant Metal", "link": "https://stackoverflow.com/users/4883216/elegant-metal"}, "edited": false, "score": 0, "creation_date": 1433238649, "post_id": 30592483, "comment_id": 49253991, "body": "Wow... I should really learn when to stop working on stuff and take a break. Thanks a ton!"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 5, "last_activity_date": 1433238711, "last_edit_date": 1433238711, "creation_date": 1433237996, "answer_id": 30592483, "question_id": 30592307, "link": "https://stackoverflow.com/questions/30592307/golang-cant-write-to-text-file-the-handle-is-invalid/30592483#30592483", "title": "golang can&#39;t write to text file: the handle is invalid", "body": "<p>You're calling <code>file.Close()</code> inside a closure. If <code>doc.Find(\"tbody\").Each</code> is called more than one time, you'll end up trying to write to a closed file. You should defer the file closing right after you've created it:</p>\n\n<pre><code>file, err := os.Create(filename)\nif err != nil {\n    log.Fatal(err)\n}\ndefer file.Close()\n</code></pre>\n"}], "owner": {"reputation": 119, "user_id": 4883216, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/73a6db6ae7d0691b4448877e3f607ee4?s=128&d=identicon&r=PG&f=1", "display_name": "Elegant Metal", "link": "https://stackoverflow.com/users/4883216/elegant-metal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3318, "favorite_count": 0, "accepted_answer_id": 30592483, "answer_count": 1, "score": -1, "last_activity_date": 1433238711, "creation_date": 1433237529, "last_edit_date": 1433238495, "question_id": 30592307, "link": "https://stackoverflow.com/questions/30592307/golang-cant-write-to-text-file-the-handle-is-invalid", "title": "golang can&#39;t write to text file: the handle is invalid", "body": "<p>Hello again everybody,</p>\n\n<p>I apologize for asking another question so soon, but it just seems to be one thing after another with Go lately.</p>\n\n<p>I have a working web page scraper (thanks to everybody's help) that grabs all the info I want from this wiki page: <a href=\"http://monsterhunter.wikia.com/wiki/MH4U:_Item_List\" rel=\"nofollow\">http://monsterhunter.wikia.com/wiki/MH4U:_Item_List</a></p>\n\n<p>It then displays everything I want, no hiccups. However, when I go to write to a .txt file I get an error stating: \"0 write mh4u.txt: The handle is invalid\"</p>\n\n<p>Here is my current code for reference:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/PuerkitoBio/goquery\"\n    \"os\"\n    \"io\"\n)\n\nfunc main() {\n\n    filename := \"mh4u.txt\"\n    file, err := os.Create(filename)\n\n    if err!= nil {\n        fmt.Println(err)\n    }\n    doc, err := goquery.NewDocument(\"http://www.ign.com/wikis/monster-hunter-4/Items\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    doc.Find(\"tbody\").Each(func(i int, s *goquery.Selection) {\n\n        s.Find(\"td\").Each(func(j int, s2 *goquery.Selection) {\n\n            if s3 := s2.Find(\"img\"); s3 != nil &amp;&amp; s3.Length() &gt; 0 {\n                return\n            }\n\n            fmt.Printf(s2.Text())\n            n, err := io.WriteString(file, s2.Text())\n\n            if err != nil {\n                fmt.Println(n, err) \n            }\n        })\n\n        file.Close()\n    })\n}\n</code></pre>\n\n<p>Testing this code with other web sites leads me to believe that there is maybe some hidden characters that is giving the writer some issues, but that's the only thing I can guess.</p>\n\n<p>Thanks so much for any suggestions/tips/solutions you can offer!</p>\n"}, {"tags": ["json", "go", "deserialization"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1433233335, "post_id": 30590808, "comment_id": 49250605, "body": "Check out the <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow noreferrer\"><code>encoding&#47;gob</code></a> package."}, {"owner": {"reputation": 18920, "user_id": 1933917, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7abf55dbb13da076d7a75637f22a74db?s=128&d=identicon&r=PG", "display_name": "Amol M Kulkarni", "link": "https://stackoverflow.com/users/1933917/amol-m-kulkarni"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1433233375, "post_id": 30590808, "comment_id": 49250631, "body": "@icza I had tried that. Forgot to mention it over here will update"}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1433233540, "post_id": 30590808, "comment_id": 49250734, "body": "You say that the parsing is taking <i>more time</i>. More time than what ? That said, I would suggest either storing your data in a serialized format, or retrieving them in a background process to have them handy when you need them (that may be complex, thought)."}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1433233654, "post_id": 30590808, "comment_id": 49250804, "body": "Storing data in a serialized format would probably need a change in the database you&#39;re using: using MongoDB without JSON sounds like a bad idea for me\u2026"}, {"owner": {"reputation": 18920, "user_id": 1933917, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7abf55dbb13da076d7a75637f22a74db?s=128&d=identicon&r=PG", "display_name": "Amol M Kulkarni", "link": "https://stackoverflow.com/users/1933917/amol-m-kulkarni"}, "reply_to_user": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1433233701, "post_id": 30590808, "comment_id": 49250828, "body": "@Elwinar: Updated the question. But I was comparing with php&#39;s performance."}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1433233856, "post_id": 30590808, "comment_id": 49250904, "body": "Do your data really need to use <code>map[string]interface{}</code> ? You could try unmarshalling to a base struct that would enable you to find the real type you need to use\u2026"}, {"owner": {"reputation": 18920, "user_id": 1933917, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7abf55dbb13da076d7a75637f22a74db?s=128&d=identicon&r=PG", "display_name": "Amol M Kulkarni", "link": "https://stackoverflow.com/users/1933917/amol-m-kulkarni"}, "reply_to_user": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1433233865, "post_id": 30590808, "comment_id": 49250913, "body": "@Elwinar When I tried gob/binary or msg pack the data which got store in cache was in uint8/byte but looking into it. Its was just string converted to bytes array. No extra data I mean meta data of object representation of golang&#39;s <code>map[string]interface{}</code> And more over all of it no performance gain was observed. Anyways Thanks for your time &amp; help."}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "reply_to_user": {"reputation": 18920, "user_id": 1933917, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7abf55dbb13da076d7a75637f22a74db?s=128&d=identicon&r=PG", "display_name": "Amol M Kulkarni", "link": "https://stackoverflow.com/users/1933917/amol-m-kulkarni"}, "edited": false, "score": 0, "creation_date": 1433233928, "post_id": 30590808, "comment_id": 49250959, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/79394/discussion-between-elwinar-and-amol-m-kulkarni\">continue this discussion in chat</a>."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1433233956, "post_id": 30590808, "comment_id": 49250980, "body": "Given the parameters you laid out--the data has to come as a huge JSON blob whose structure is not known at compile time--it&#39;s plausible (de/re)serialization will just be slow. It seems like you have to change some part of the problem definition: break up the mega-document so you don&#39;t have to deal with the whole thing at once, keep the <code>map</code> in RAM instead of caching a reserialized blob, or define some spec so you can keep a <code>struct</code> instead of maps."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1433234394, "post_id": 30590808, "comment_id": 49251250, "body": "Of those, breaking it up seems esp. appealing: 6.5 MB seems like an unwieldy-sized blob to be tossing around as a single unit."}], "answers": [{"tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": true, "score": 2, "last_activity_date": 1433237320, "last_edit_date": 1433237320, "creation_date": 1433235136, "answer_id": 30591468, "question_id": 30590808, "link": "https://stackoverflow.com/questions/30590808/best-way-to-store-golang-mapstringinterface-into-data-store/30591468#30591468", "title": "Best way to store golang map[string]interface into data store", "body": "<p>The standard library package for JSON is notoriously slow. There is a good reason for that: it use RTTI to provide a really flexible interface that is really simple. Hence the unmarshalling being slower than PHP's\u2026</p>\n\n<p>Fortunately, there is an alternative way, which is to implement the <code>json.Unmarshaller</code> interface on the types you want to use. If this interface is implemented, the package will use it instead of its standard method so you can see huge performance boosts.</p>\n\n<p>And to help you, there is a small group of tools that appeared, among which:</p>\n\n<ul>\n<li><a href=\"https://godoc.org/github.com/benbjohnson/megajson\" rel=\"nofollow\">https://godoc.org/github.com/benbjohnson/megajson</a></li>\n<li><a href=\"https://godoc.org/github.com/pquerna/ffjson\" rel=\"nofollow\">https://godoc.org/github.com/pquerna/ffjson</a></li>\n</ul>\n\n<p>(listing here the main players from memory, there must be others)</p>\n\n<p>These tools will generate tailored implementations of the <code>json.Unmarshaller</code> interface for the types you requested. And with <code>go:generate</code>, you can even integrate them seamlessly to your build step.</p>\n"}], "owner": {"reputation": 18920, "user_id": 1933917, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7abf55dbb13da076d7a75637f22a74db?s=128&d=identicon&r=PG", "display_name": "Amol M Kulkarni", "link": "https://stackoverflow.com/users/1933917/amol-m-kulkarni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2393, "favorite_count": 3, "accepted_answer_id": 30591468, "answer_count": 1, "score": 1, "last_activity_date": 1433237320, "creation_date": 1433233007, "last_edit_date": 1433233675, "question_id": 30590808, "link": "https://stackoverflow.com/questions/30590808/best-way-to-store-golang-mapstringinterface-into-data-store", "title": "Best way to store golang map[string]interface into data store", "body": "<p><strong>Scenario</strong>: I am having a arbitrary JSON size ranging from 300 KB - 6.5 MB read from MongoDB. Since it is very much arbitrary/dynamic data I cannot have struct type defined in golang, So I am using <code>map[sting]interface{}</code> type. And string of JSON data is parsed by using <a href=\"http://golang.org/pkg/encoding/json\" rel=\"nofollow\"><code>encoding/json</code></a>'s <a href=\"http://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow\"><code>Unmarshal</code></a> method. Some what similar to what is mentioned in <a href=\"http://blog.golang.org/json-and-go\" rel=\"nofollow\">Generic JSON with interface{}</a>.</p>\n\n<p><strong>Issue</strong>: But the problem is its taking more time (around 30ms to 180ms) to parse the string json into <code>map[string]interface{}</code>. (Comparing to php parsing json using json_encode/decode / igbinary/ msgpack)</p>\n\n<p><strong>Question</strong>: Is there any way to pre-process it and store in cache? </p>\n\n<p>I mean parse string into <code>map[string]interface{}</code> and serialize it and store to some cache, then when we retrieve it should not take much time to unserialization and proceed with execution. </p>\n\n<p>Note: I am Newbie for the golang any suggestion are highly appriciated. Thanks</p>\n\n<p><strong>Updates</strong>: Serialization using <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow\"><code>Gob</code></a>, <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow\"><code>binary</code></a> built-in package &amp; <a href=\"https://github.com/vmihailenco/msgpack\" rel=\"nofollow\">Msgpack implementation for Golang</a> package are already tried. No luck, No improvement in the time to unserialization.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "edited": false, "score": 4, "creation_date": 1433233534, "post_id": 30590689, "comment_id": 49250727, "body": "Note that in your version when you do <code>p := &amp;a</code> your&#39;re getting a reference of <code>a</code> which is a copy of <code>x</code>, not a reference of <code>x</code>. Imagine it like this. You have a drawing. Taking a reference of the drawing you get the paper. Performing operations on this paper (erase, draw etc) alters the drawing. Now, xerox (photocopy) that drawing. Take a reference of the copy you get a paper but performing operations on <i>this</i> paper will only alter the copy, not the original drawing. That&#39;s what passing by value is."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1433233626, "post_id": 30590689, "comment_id": 49250785, "body": "Go has <b>absolutely</b> <b>no</b> notion of &quot;pass by reference&quot;. Stop using this term, stop thinking along such (broken) concepts and talk/think/use pointers and all is fine. Never think of a pointer argument as &quot;pass by reference&quot;. It is not."}, {"owner": {"reputation": 481, "user_id": 2967113, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5d72f96279c46ac2639cfdc34753bc42?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Lagergren", "link": "https://stackoverflow.com/users/2967113/eric-lagergren"}, "reply_to_user": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "edited": false, "score": 0, "creation_date": 1433390738, "post_id": 30590689, "comment_id": 49334674, "body": "@slebetman <code>p := &amp;a</code> is assigning <code>p</code> the address of <code>a</code>, creating a pointer. It is in no way, shape, or form a reference. <code>a</code> is a copy of <code>x</code>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1433232883, "creation_date": 1433232883, "answer_id": 30590786, "question_id": 30590689, "link": "https://stackoverflow.com/questions/30590689/go-passing-parameters-of-pointers-or-copies-to-functions/30590786#30590786", "title": "Go passing parameters of pointers or copies to functions", "body": "<p>Why should they behave equivalently? In the first example you pass a pointer (to <code>int</code>), in the second example you pass an <code>int</code> value.</p>\n\n<p>What happens in the 2nd example is that you pass an <code>int</code> value. Parameters in functions work like local variables. A local variable called <code>a</code> of type <code>int</code> will be created, and will be initialized with the value you passed (<code>3</code> which is the value of <code>x</code>). This local variable is addressable like any other variables.</p>\n\n<p>You take its address (<code>p := &amp;a</code>) and you increment the value pointed by this pointer (which is variable <code>a</code> itself). And you return the value pointed by it which is the incremented value of <code>a</code>.</p>\n\n<p>Outside from where you called this <code>add1()</code> function, the value of <code>x</code> is not modified because only the local copy <code>a</code> was modified.</p>\n"}, {"tags": [], "owner": {"reputation": 10501, "user_id": 1180968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tsPVx.png?s=128&g=1", "display_name": "Sajan Chandran", "link": "https://stackoverflow.com/users/1180968/sajan-chandran"}, "is_accepted": false, "score": 2, "last_activity_date": 1433233720, "creation_date": 1433233720, "answer_id": 30591002, "question_id": 30590689, "link": "https://stackoverflow.com/questions/30590689/go-passing-parameters-of-pointers-or-copies-to-functions/30591002#30591002", "title": "Go passing parameters of pointers or copies to functions", "body": "<p>Everything in <code>golang</code> is <code>pass by value</code>, which means the function always gets a copy of the thing being passed.\nIn your second example, the value of <code>x</code> is actually sent to the function <code>add</code>, so any modification you made to the copy wont affect the original <code>x</code>.</p>\n\n<p>See <a href=\"https://golang.org/doc/faq#pass_by_value\" rel=\"nofollow\">pass by value</a></p>\n"}], "owner": {"reputation": 2482, "user_id": 2605049, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/EgmcV.png?s=128&g=1", "display_name": "s&#231;u&#231;u", "link": "https://stackoverflow.com/users/2605049/s%c3%a7u%c3%a7u"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "accepted_answer_id": 30590786, "answer_count": 2, "score": -1, "last_activity_date": 1433234132, "creation_date": 1433232528, "last_edit_date": 1433234132, "question_id": 30590689, "link": "https://stackoverflow.com/questions/30590689/go-passing-parameters-of-pointers-or-copies-to-functions", "title": "Go passing parameters of pointers or copies to functions", "body": "<p>I am contemplating on the Go pointers, passing variables as parameters to functions by value or by reference. In a book I have encountered a good example, which is the first code snippet below, on passing a pointer.</p>\n\n<p>The first version is working as expected, in function that takes parameter of a pointer makes changes to the variable itself, not on a copy of it. But the second example below I am tinkering with works on a copy of it. I have thought they should behave equivalently, and second one to work on the variable passed as parameter, not on copy of it.</p>\n\n<p>Essentially, what these two versions of the function is behaving different?</p>\n\n<p><a href=\"https://play.golang.org/p/vsfiLd5a4U\" rel=\"nofollow\">version in the book</a>, passing parameters by reference:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n// simple function to add 1 to a\nfunc add1(a *int) int {\n    *a = *a+1 // we changed value of a\n    return *a // return new value of a\n}\n\nfunc main() {\n    x := 3\n\n    fmt.Println(\"x = \", x)  // should print \"x = 3\"\n\n    x1 := add1(&amp;x)  // call add1(&amp;x) pass memory address of x\n\n    fmt.Println(\"x+1 = \", x1) // should print \"x+1 = 4\"\n    fmt.Println(\"x = \", x)    // should print \"x = 4\"\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/VX7pt6XmQP\" rel=\"nofollow\">my alternative tinkering version</a>, passing pointer parameter:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n// simple function to add 1 to a\nfunc add1(a int) int {\n    p := &amp;a\n    *p = *p+1 // we changed value of a\n    return *p // return new value of a\n}\nfunc main(){\n    fmt.Println(\"this is my go playground.\")\n\n        x := 3\n\n        fmt.Println(\"x = \", x)  // should print \"x = 3\"\n\n        x1 := add1(x)  // call add1(&amp;x) pass memory address of x\n\n        fmt.Println(\"x+1 = \", x1) // should print \"x+1 = 4\"\n        fmt.Println(\"x = \", x)    // should print \"x = 4\"   \n}\n</code></pre>\n"}, {"tags": ["go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "edited": false, "score": 0, "creation_date": 1433227106, "post_id": 30588680, "comment_id": 49247129, "body": "I don&#39;t know how to convert to interface from result of  regexp.FindStringSubmatch()"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "edited": false, "score": 0, "creation_date": 1433228384, "post_id": 30588680, "comment_id": 49247820, "body": "@DanielYCLin You have to do that manually. See my edited answer."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1471955266, "last_edit_date": 1495540844, "creation_date": 1433225708, "answer_id": 30588680, "question_id": 30588581, "link": "https://stackoverflow.com/questions/30588581/how-to-pass-variable-parameters-to-sprintf-in-golang/30588680#30588680", "title": "How to pass variable parameters to Sprintf in golang", "body": "<p>Yes, it is possible, just declare your slice to be of type <code>[]interface{}</code> because that's what <a href=\"https://golang.org/pkg/fmt/#Printf\" rel=\"noreferrer\"><code>Printf()</code></a> expects. <code>Printf()</code> signature:</p>\n\n<pre><code>func Printf(format string, a ...interface{}) (n int, err error)\n</code></pre>\n\n<p>So this will work:</p>\n\n<pre><code>s := []interface{}{\"a\", \"b\", \"c\", \"d\"}\nfmt.Printf(\"%5s %4s %3s\\n\", s[1], s[2], s[3])\n\nv := s[1:]\nfmt.Printf(\"%5s %4s %3s\\n\", v...)\n</code></pre>\n\n<p>Output (<a href=\"http://play.golang.org/p/4emcCimGTR\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>b    c   d\nb    c   d\n</code></pre>\n\n<p><code>[]interface{}</code> and <code>[]string</code> are not convertible. See this question+answers for more details:</p>\n\n<p><strong><a href=\"https://stackoverflow.com/questions/12753805/type-converting-slices-of-interfaces-in-go\">Type converting slices of interfaces in go</a></strong></p>\n\n<p>If you already have a <code>[]string</code> or you use a function which returns a <code>[]string</code>, you have to manually convert it to <code>[]interface{}</code>, like this:</p>\n\n<pre><code>ss := []string{\"a\", \"b\", \"c\"}\nis := make([]interface{}, len(ss))\nfor i, v := range ss {\n    is[i] = v\n}\n</code></pre>\n"}], "owner": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7153, "favorite_count": 0, "accepted_answer_id": 30588680, "answer_count": 1, "score": 7, "last_activity_date": 1471955266, "creation_date": 1433225297, "last_edit_date": 1433227064, "question_id": 30588581, "link": "https://stackoverflow.com/questions/30588581/how-to-pass-variable-parameters-to-sprintf-in-golang", "title": "How to pass variable parameters to Sprintf in golang", "body": "<p>I'm lazy, want to pass many variables to <code>Printf</code> function, is it possible?\n(The sample code is simplified as 3 parameters, I require more than 10 parameters).</p>\n\n<p>I got the following message:</p>\n\n<blockquote>\n  <p>cannot use v (type []string) as type []interface {} in argument to fmt.Printf</p>\n</blockquote>\n\n<pre><code>s := []string{\"a\", \"b\", \"c\", \"d\"}  // Result from regexp.FindStringSubmatch()\nfmt.Printf(\"%5s %4s %3s\\n\", s[1], s[2], s[3])  \n\nv := s[1:]\nfmt.Printf(\"%5s %4s %3s\\n\", v...)  \n</code></pre>\n"}, {"tags": ["go", "active-directory", "ldap"], "comments": [{"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1433224509, "post_id": 30586970, "comment_id": 49245863, "body": "<a href=\"https://github.com/jbcrail/ldap\" rel=\"nofollow noreferrer\">github.com/jbcrail/ldap</a>, <a href=\"https://gist.github.com/sfreiberg/3372371\" rel=\"nofollow noreferrer\">gist.github.com/sfreiberg/3372371</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3778, "user_id": 79941, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/icKxy.png?s=128&g=1", "display_name": "Carl Bergquist", "link": "https://stackoverflow.com/users/79941/carl-bergquist"}, "is_accepted": false, "score": 3, "last_activity_date": 1435849539, "creation_date": 1435849539, "answer_id": 31188237, "question_id": 30586970, "link": "https://stackoverflow.com/questions/30586970/activedirectory-ldap-authentication-client-package-for-go-language/31188237#31188237", "title": "ActiveDirectory/ LDAP Authentication client package for GO Language?", "body": "<p>You might wanna try this module <a href=\"https://github.com/go-ldap/ldap\" rel=\"nofollow\">https://github.com/go-ldap/ldap</a></p>\n"}], "owner": {"reputation": 1275, "user_id": 3846091, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/05a22704d6f3656abe5c948acafcd201?s=128&d=identicon&r=PG&f=1", "display_name": "user3846091", "link": "https://stackoverflow.com/users/3846091/user3846091"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2921, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1435849539, "creation_date": 1433216845, "question_id": 30586970, "link": "https://stackoverflow.com/questions/30586970/activedirectory-ldap-authentication-client-package-for-go-language", "title": "ActiveDirectory/ LDAP Authentication client package for GO Language?", "body": "<p>I am using the below nodejs module for LDAP authentication and searching user in a particular group. I want to do similar for my GO program but i am having a hard time finding the right module. I definitely tried google but not coming across a decent stable module for GO lang. Please advise ?</p>\n\n<p><a href=\"https://www.npmjs.com/package/activedirectory\" rel=\"nofollow\">https://www.npmjs.com/package/activedirectory</a></p>\n"}, {"tags": ["utf-8", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1433213500, "post_id": 30586467, "comment_id": 49242511, "body": "See <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">The Go Blog - Strings, bytes, runes and characters in Go</a> to see why your attempt is incorrect. <a href=\"https://play.golang.org/p/_odF4J6LSb\" rel=\"nofollow noreferrer\">play.golang.org/p/_odF4J6LSb</a>"}], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 4, "last_activity_date": 1433213340, "creation_date": 1433213340, "answer_id": 30586527, "question_id": 30586467, "link": "https://stackoverflow.com/questions/30586467/cut-off-last-rune-in-utf-string/30586527#30586527", "title": "cut off last rune in UTF string", "body": "<p>Almost,</p>\n\n<p>utf8 package has a function to decode the last rune in a string which also returns its length. Cut that number of bytes off the end and you are golden:</p>\n\n<pre><code>str := \"\u4f60\u597d\"\n_, lastSize := utf8.DecodeLastRuneInString(str)\nwithoutLastRune := str[:len(str)-lastSize]\nfmt.Println(withoutLastRune)\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/fQTI97H98Q\" rel=\"nofollow\">playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1433272786, "post_id": 30603225, "comment_id": 49277581, "body": "I&#39;ll add a note to your note :) that this is O(n) and allocates and copies whereas using <code>utf8.DecodeLastRuneInString</code> is O(1) and does not allocate or copy. The later can be done <a href=\"https://play.golang.org/p/_odF4J6LSb\" rel=\"nofollow noreferrer\">in two lines that to me look just as simple</a> as your two lines."}], "tags": [], "owner": {"reputation": 1051, "user_id": 809410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1ffc49c668c0066df3196ecf48aa39f?s=128&d=identicon&r=PG", "display_name": "iant", "link": "https://stackoverflow.com/users/809410/iant"}, "is_accepted": false, "score": 0, "last_activity_date": 1433267740, "creation_date": 1433267740, "answer_id": 30603225, "question_id": 30586467, "link": "https://stackoverflow.com/questions/30586467/cut-off-last-rune-in-utf-string/30603225#30603225", "title": "cut off last rune in UTF string", "body": "<p>Using DecodeLastRuneInString is the best answer.  I'll just note that if you prize simpler code over run time efficiency, you can do</p>\n\n<pre>\n    s := []rune(str)\n    fmt.Println(string(s[:len(s)-1]))\n</pre>\n"}], "owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 30586527, "answer_count": 2, "score": 2, "last_activity_date": 1433267740, "creation_date": 1433212934, "question_id": 30586467, "link": "https://stackoverflow.com/questions/30586467/cut-off-last-rune-in-utf-string", "title": "cut off last rune in UTF string", "body": "<p>How to cut off last rune in UTF string?\nThis method is obviously incorrect:</p>\n\n<pre><code>package main\n\nimport (\"fmt\"\n \"unicode/utf8\")\n\nfunc main() {\n    string := \"\u4f60\u597d\"\n    length := utf8.RuneCountInString(string)\n    // how to cut off last rune in UTF string? \n    // this method is obviously incorrect:\n    withoutLastRune := string[0:length-1]\n    fmt.Println(withoutLastRune)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/ugeMExeedT\" rel=\"nofollow\">Playground</a></p>\n"}, {"tags": ["reflection", "go", "generic-programming"], "comments": [{"owner": {"reputation": 5398, "user_id": 306405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ee6aa44b77c0ec1c85663d0b667d666?s=128&d=identicon&r=PG", "display_name": "Karmastan", "link": "https://stackoverflow.com/users/306405/karmastan"}, "edited": false, "score": 1, "creation_date": 1433209417, "post_id": 30585938, "comment_id": 49241585, "body": "Could you provide a smaller example showing the problem you&#39;re trying to solve? Type assertions are normal for go programs that attempt generic programming."}, {"owner": {"reputation": 423, "user_id": 3435329, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ek5Ff.jpg?s=128&g=1", "display_name": "DLopes", "link": "https://stackoverflow.com/users/3435329/dlopes"}, "reply_to_user": {"reputation": 5398, "user_id": 306405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ee6aa44b77c0ec1c85663d0b667d666?s=128&d=identicon&r=PG", "display_name": "Karmastan", "link": "https://stackoverflow.com/users/306405/karmastan"}, "edited": false, "score": 0, "creation_date": 1433209754, "post_id": 30585938, "comment_id": 49241677, "body": "Thanks for your answer, Karmastan. Actually i put a example in Go Playground. <a href=\"http://play.golang.org/p/59JrtxywCj\" rel=\"nofollow noreferrer\">play.golang.org/p/59JrtxywCj</a>"}, {"owner": {"reputation": 423, "user_id": 3435329, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ek5Ff.jpg?s=128&g=1", "display_name": "DLopes", "link": "https://stackoverflow.com/users/3435329/dlopes"}, "reply_to_user": {"reputation": 5398, "user_id": 306405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ee6aa44b77c0ec1c85663d0b667d666?s=128&d=identicon&r=PG", "display_name": "Karmastan", "link": "https://stackoverflow.com/users/306405/karmastan"}, "edited": false, "score": 0, "creation_date": 1433210189, "post_id": 30585938, "comment_id": 49241786, "body": "I get the values to put in the attributes from a cache store (Redis), but the function that bring it to me from the store, returns a interface and the reflect.Type about the value. Note that i could have hundreds of types of structs in my system, that breaks my generic code... Thanks for yout help."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1433210415, "post_id": 30585938, "comment_id": 49241837, "body": "please show exactly what you&#39;re trying to accomplish. This is the same as your last question, but one more layer of indirection. You&#39;re not explaining why you need a type assertion, and why you can&#39;t just use reflection."}], "answers": [{"tags": [], "owner": {"reputation": 423, "user_id": 3435329, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ek5Ff.jpg?s=128&g=1", "display_name": "DLopes", "link": "https://stackoverflow.com/users/3435329/dlopes"}, "is_accepted": true, "score": 0, "last_activity_date": 1433220687, "last_edit_date": 1433220687, "creation_date": 1433219987, "answer_id": 30587460, "question_id": 30585938, "link": "https://stackoverflow.com/questions/30585938/generic-programming-in-go-avoiding-hard-coded-type-assertion/30587460#30587460", "title": "Generic Programming in Go. Avoiding hard coded type assertion", "body": "<p>Finally i find a way to do that. Follow the Go Playground and code snippet below:</p>\n\n<p><a href=\"http://play.golang.org/p/pZjL4_CDXk\" rel=\"nofollow\">GO Playground: Avoiding Hard Coded Type Assertion</a></p>\n\n<pre><code>\n//new approach SetAttribute, without any hard coded type assertion, just based on objectType parameter\nfunc SetAttribute(myUnknownTypeValue *interface{}, attributeName string, attValue interface{}, objectType reflect.Type) {\n\n    // create value for old val\n    oldValue := reflect.ValueOf(*myUnknownTypeValue)\n\n    //create a new value, based on type\n    newValue := reflect.New(objectType).Elem()\n    // set the old value to the new one, making the \n    // implicit type assertion, not hard coding that.\n    newValue.Set(oldValue)\n\n    //set value attribute to the new struct, copy of the old one\n    field := newValue.FieldByName(attributeName)\n    valueForAtt := reflect.ValueOf(attValue)\n    field.Set(valueForAtt)\n\n    //capture the new value from reflect.Value\n    newValInterface := newValue.Interface()\n    //set the new value to the pointer\n    *myUnknownTypeValue = newValInterface\n}\n\n</code></pre>\n"}], "owner": {"reputation": 423, "user_id": 3435329, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ek5Ff.jpg?s=128&g=1", "display_name": "DLopes", "link": "https://stackoverflow.com/users/3435329/dlopes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "accepted_answer_id": 30587460, "answer_count": 1, "score": -2, "last_activity_date": 1433220687, "creation_date": 1433208874, "last_edit_date": 1433212935, "question_id": 30585938, "link": "https://stackoverflow.com/questions/30585938/generic-programming-in-go-avoiding-hard-coded-type-assertion", "title": "Generic Programming in Go. Avoiding hard coded type assertion", "body": "<p>I'm programming a generic cache mechanism and i need to set some attributes in a struct knowing only their reflect.Type, attribute name and reflect.Value to be setted in the attribute, but i can't avoid the type assertion, that makes my code not generic...</p>\n\n<pre><code>func main() {\n    addressNew := Address{\"New Address description!\"}\n\n    // In the real problem, i know the reflect.Type of value, but\n    // the struct came to me as a interface{}, just like this method\n    // Return many kinds of values from redis as interface{}, \n    // (Customer, Order, Address, Product, SKU etc), in a generic way,\n    // but returns the reflect.Type of value also.\n    interfaceSomeValue := getMyValue()\n\n    fmt.Printf(\"%v\", interfaceSomeValue)\n    fmt.Println(\"\")\n\n    // This portion of code comes from my cache mechanism, that is a library \n    // used by other projects. My cache lib really can't know all others\n    // type structs to perform the type assertion, but the cache mechanism know \n    // the reflect.Type of the interface. \n    // If you try at this way, will cause a panic by try to access a FieldByName\n    // in a interface, because the Customer comes from getMyValue and \n    // becomes a interface{}, and now a type assertion is \n    // required -&gt; http://play.golang.org/p/YA8U9_KzC9\n    newCustomerNewAttribute := SetAttribute(&amp;interfaceSomeValue, \"Local\", interface{}(addressNew), reflect.TypeOf(Customer{}))\n\n    fmt.Printf(\"%v\", newCustomerNewAttribute)\n    fmt.Println(\"\")\n}\n\nfunc SetAttribute(object interface{}, attributeName string, attValue interface{}, objectType reflect.Type) interface{} {\n    if reflect.ValueOf(object).Kind() != reflect.Ptr {\n        panic(\"need a pointer\")\n    }\n\n    value := reflect.ValueOf(object).Elem()\n    field := value.FieldByName(attributeName)\n    valueForAtt := reflect.ValueOf(attValue)\n    field.Set(valueForAtt)\n    return value.Interface()\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/59JrtxywCj\" rel=\"nofollow\">Go Playground for the problem (works by hard coded type assertion)...</a></p>\n\n<p><a href=\"http://play.golang.org/p/YA8U9_KzC9\" rel=\"nofollow\">Go Playground for the problem (doesn't work with an unknown interface)</a></p>\n"}, {"tags": ["concurrency", "go", "priority-queue"], "comments": [{"owner": {"reputation": 378, "user_id": 1485415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e5be08a8fff700b794336f44c2a5216?s=128&d=identicon&r=PG&f=1", "display_name": "philoj", "link": "https://stackoverflow.com/users/1485415/philoj"}, "edited": false, "score": 0, "creation_date": 1608612305, "post_id": 30584367, "comment_id": 115630302, "body": "&quot;because the behavior of multiple go-routines reading on the same channel is undefined&quot; - can you point me towards where you found this info? I am in a similar situation and would very much like to get some documentation regarding this"}], "answers": [{"comments": [{"owner": {"reputation": 27292, "user_id": 100208, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e2fda105627061de42901c671680638b?s=128&d=identicon&r=PG&f=1", "display_name": "atp", "link": "https://stackoverflow.com/users/100208/atp"}, "edited": false, "score": 0, "creation_date": 1433199174, "post_id": 30584589, "comment_id": 49238836, "body": "I have not heard of them. Thanks for the suggestion; I will take a look."}], "tags": [], "owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "is_accepted": true, "score": 2, "last_activity_date": 1433198883, "creation_date": 1433198883, "answer_id": 30584589, "question_id": 30584367, "link": "https://stackoverflow.com/questions/30584367/go-concurrency-and-priority-ordering/30584589#30584589", "title": "Go: Concurrency and priority ordering", "body": "<p>You have heard of Weighted Fair Queues?  That is a well developed way to schedule such that a prediction is made about which job should theoretically complete first, and that is the one that is serviced.</p>\n"}], "owner": {"reputation": 27292, "user_id": 100208, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e2fda105627061de42901c671680638b?s=128&d=identicon&r=PG&f=1", "display_name": "atp", "link": "https://stackoverflow.com/users/100208/atp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 834, "favorite_count": 0, "accepted_answer_id": 30584589, "answer_count": 1, "score": 2, "last_activity_date": 1433198883, "creation_date": 1433197738, "question_id": 30584367, "link": "https://stackoverflow.com/questions/30584367/go-concurrency-and-priority-ordering", "title": "Go: Concurrency and priority ordering", "body": "<p>I have n ~=1000 jobs running on outside servers, each tied to a go-routine in my program. I started the jobs at different times, and they finish roughly in the order they were started, but that's not guaranteed.</p>\n\n<p>From each go-routine I poll its corresponding server job: is it done yet? My  outbound requests are rate-limited, so I need to poll smartly.</p>\n\n<p>I want to prioritize polling by go-routines whose jobs were started earlier. The way I'm doing it now, I have a channel that represents my rate limit, and all go-routines wait to acquire a value from this channel, poll their server, and then put a value back. </p>\n\n<p>But, there's no guarantee that these go-routines would even read randomly (much less in priority order), because the behavior of multiple go-routines reading on the same channel is undefined.</p>\n\n<p>Could someone guide me as to how to think about this problem? It doesn't have to be specific, but I'm not sure what primitives and data structures I would use in Go to read from channels in priority order, while taking into account rate-limiting.</p>\n\n<p>It seems difficult because individual goroutines do not know the state of the whole program -- which of their colleague routines were started first, etc. They should merely be fed whether or not they should poll their server at any given time.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["java", "python", "node.js", "go", "couchbase"], "answers": [{"tags": [], "owner": {"reputation": 2498, "user_id": 1181512, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/NW1Zh.png?s=128&g=1", "display_name": "scalabilitysolved", "link": "https://stackoverflow.com/users/1181512/scalabilitysolved"}, "is_accepted": false, "score": 0, "last_activity_date": 1433237318, "last_edit_date": 1495535212, "creation_date": 1433237318, "answer_id": 30592224, "question_id": 30583844, "link": "https://stackoverflow.com/questions/30583844/couchbase-golang-json-atomic-increment/30592224#30592224", "title": "couchbase golang json atomic increment", "body": "<p>It's not possible to have an atomic counter within a document, you have two options to work around this:</p>\n\n<p>1)  Have your document reference separate atomic counters, rather than holding the counter value they'll just hold the key that points to the counter. Something like the json below, if you retrieved the document then to work with the counter you'd use the value in 'counter_key'.</p>\n\n<pre><code>{\n  \"id\": \"customer::1343\"\n  \"name\": \"John Smith\",\n  \"counter_key\": \"counter::customer::1343\"\n}\n</code></pre>\n\n<p>2) Your second option is to keep the field within the Json document that you want to increment, to be able to update this atomically you'll need to look at CAS which is a form of optimistic locking which will allow you to update the value within the actual document rather than having a separate counter, this method does introduce additional coding overhead and won't be as performant as a separate counter.  You can read about more about CAS here:  <a href=\"http://docs.couchbase.com/developer/dev-guide-3.0/retrieve-by-cas.html\" rel=\"nofollow noreferrer\">http://docs.couchbase.com/developer/dev-guide-3.0/retrieve-by-cas.html</a></p>\n\n<p>There is also a nice succinct description here of Couchbase CAS here on Stack Overflow:  <a href=\"https://stackoverflow.com/questions/22601503/what-is-cas-and-how-to-use-it\">What is CAS in nosql and how to use it?</a></p>\n"}], "owner": {"reputation": 11, "user_id": 4963048, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22a6111b31ef26879db9171a2b3e4dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ram Kumar", "link": "https://stackoverflow.com/users/4963048/ram-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 417, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1433397721, "creation_date": 1433195117, "last_edit_date": 1433397721, "question_id": 30583844, "link": "https://stackoverflow.com/questions/30583844/couchbase-golang-json-atomic-increment", "title": "couchbase golang json atomic increment", "body": "<p>Is there a golang API similar to counter available in other couchbase SDK's  that will help us to atomically increment certain fields inside a json document?</p>\n\n<p>For example, I have a below struct with two fields which will be associated with a document D1</p>\n\n<pre><code>type Counter struct {\n        c1 string `json:\"c1\"`\n        c2 string `json:\"c2\"`\n}\n</code></pre>\n\n<p>For every http request that comes in, I would like to do an atomic increment of c1 and c2. since it's within a json document, am not able to use GET and not sure how to use counter method using golang. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2327, "user_id": 3938395, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/9bc7fb2849c95ac9f211671b7c83cb07?s=128&d=identicon&r=PG", "display_name": "Adam", "link": "https://stackoverflow.com/users/3938395/adam"}, "edited": false, "score": 0, "creation_date": 1433186146, "post_id": 30581384, "comment_id": 49232681, "body": "<a href=\"http://golang.org/pkg/archive/zip/\" rel=\"nofollow noreferrer\">golang.org/pkg/archive/zip</a>"}, {"owner": {"reputation": 2364, "user_id": 4347337, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/xu2hN.jpg?s=128&g=1", "display_name": "Brino", "link": "https://stackoverflow.com/users/4347337/brino"}, "edited": false, "score": 0, "creation_date": 1433187377, "post_id": 30581384, "comment_id": 49233428, "body": "With a little googling I was able to find this: <a href=\"https://www.socketloop.com/tutorials/golang-how-to-tell-if-a-file-is-compressed-either-gzip-or-zip\" rel=\"nofollow noreferrer\">socketloop.com/tutorials/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 1668004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a02e3f05023c72b56f29154ad43b7cf3?s=128&d=identicon&r=PG", "display_name": "Farid", "link": "https://stackoverflow.com/users/1668004/farid"}, "edited": false, "score": 0, "creation_date": 1442016229, "post_id": 30581505, "comment_id": 52925583, "body": "Thank you, that was very helpful."}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 3, "last_activity_date": 1433186424, "creation_date": 1433186424, "answer_id": 30581505, "question_id": 30581384, "link": "https://stackoverflow.com/questions/30581384/recommended-way-to-check-if-a-file-is-compressed-zipped/30581505#30581505", "title": "Recommended way to check if a file is compressed /zipped", "body": "<p>A quick-and-easy built-in way is with <code>http.DetectContentType()</code>. It does much more than just gzip/zip, but it's very fast because it doesn't check for too many things. If you want to check for a smaller set, and skip testing a string, check the source code in src/net/http/sniff.go and pull out the tests you want.</p>\n"}], "owner": {"reputation": 33, "user_id": 1668004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a02e3f05023c72b56f29154ad43b7cf3?s=128&d=identicon&r=PG", "display_name": "Farid", "link": "https://stackoverflow.com/users/1668004/farid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "accepted_answer_id": 30581505, "answer_count": 1, "score": 1, "last_activity_date": 1433186827, "creation_date": 1433185950, "question_id": 30581384, "link": "https://stackoverflow.com/questions/30581384/recommended-way-to-check-if-a-file-is-compressed-zipped", "title": "Recommended way to check if a file is compressed /zipped", "body": "<p>I am trying to check if an uploaded file ( no file extension) is compressed/ zipped.\nI searched through the fileinfo, fileheader etc but haven't found a way to do this. May be the magic number?\nThanks   </p>\n"}, {"tags": ["generics", "reflection", "go"], "answers": [{"comments": [{"owner": {"reputation": 423, "user_id": 3435329, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ek5Ff.jpg?s=128&g=1", "display_name": "DLopes", "link": "https://stackoverflow.com/users/3435329/dlopes"}, "edited": false, "score": 0, "creation_date": 1433187134, "post_id": 30581265, "comment_id": 49233262, "body": "Thanks, Jim. Works perfectly!"}, {"owner": {"reputation": 423, "user_id": 3435329, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ek5Ff.jpg?s=128&g=1", "display_name": "DLopes", "link": "https://stackoverflow.com/users/3435329/dlopes"}, "edited": false, "score": 0, "creation_date": 1433209121, "post_id": 30581265, "comment_id": 49241499, "body": "Sorry, man. The problem becomes more trickier in the real implementation... Look at these new question: <a href=\"http://stackoverflow.com/questions/30585938/generic-programming-in-go-avoiding-hard-coded-type-assertion\" title=\"generic programming in go avoiding hard coded type assertion\">stackoverflow.com/questions/30585938/&hellip;</a>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1433186032, "last_edit_date": 1433186032, "creation_date": 1433185558, "answer_id": 30581265, "question_id": 30580941, "link": "https://stackoverflow.com/questions/30580941/generic-programming-in-go-implicit-generic-type/30581265#30581265", "title": "Generic Programming in Go, Implicit generic type", "body": "<p><code>convertedObject</code> is the value of what is in the <code>object</code> interface. Taking the address of that has no effect on the original <code>customer</code>. (and converted is probably a poor prefix for the name, since that is generated from a \"type assertion\", not a \"type conversion\")</p>\n\n<p>If you use object directly, it panics, because you're then taking the address of the interface, not the customer. </p>\n\n<p>You need to pass the address of the customer you want to modify to the function: </p>\n\n<pre><code>SetAttribute(&amp;customer, \"Local\", addressNew, reflect.TypeOf(Customer{}))\n</code></pre>\n\n<p>You can also have your SetAttribute check if it's a pointer first:</p>\n\n<pre><code>if reflect.ValueOf(object).Kind() != reflect.Ptr {\n    panic(\"need a pointer\")\n}\n\nvalue := reflect.ValueOf(object).Elem() \nfield := value.FieldByName(attributeName)\nvalueForAtt := reflect.ValueOf(attValue)\nfield.Set(valueForAtt)\nreturn value.Interface()\n</code></pre>\n"}], "owner": {"reputation": 423, "user_id": 3435329, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ek5Ff.jpg?s=128&g=1", "display_name": "DLopes", "link": "https://stackoverflow.com/users/3435329/dlopes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 30581265, "answer_count": 1, "score": -1, "last_activity_date": 1433186032, "creation_date": 1433184436, "last_edit_date": 1433185049, "question_id": 30580941, "link": "https://stackoverflow.com/questions/30580941/generic-programming-in-go-implicit-generic-type", "title": "Generic Programming in Go, Implicit generic type", "body": "<p>I need Go to implicitly resolve my struct type, in order to do generic replacement of some attribute.</p>\n\n<pre><code>//must replace the attribute with attValue\nfunc SetAttribute(object interface{}, attributeName string, attValue interface{}, objectType reflect.Type) interface{} {\n\n    /// works perfectly, but function SetAttribute needs to know Customer type to do the convertion\n    convertedObject := object.(Customer) // &lt;-- Need to hard code a cast :(\n\n    // doesn't works... raise panic!\n    //convertedObject := object \n\n\n    value := reflect.ValueOf(&amp;convertedObject).Elem()\n    field := value.FieldByName(attributeName)\n    valueForAtt := reflect.ValueOf(attValue)\n    field.Set(valueForAtt)\n\n    return value.Interface()\n}\n</code></pre>\n\n<p>Please check out full example in the Go playground...\n<a href=\"http://play.golang.org/p/jxxSB5FKEy\" rel=\"nofollow\">http://play.golang.org/p/jxxSB5FKEy</a></p>\n"}, {"tags": ["javascript", "json", "google-app-engine", "go", "google-cloud-storage"], "comments": [{"owner": {"reputation": 1278, "user_id": 2036231, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/nYM74.png?s=128&g=1", "display_name": "Jose Bagatelli", "link": "https://stackoverflow.com/users/2036231/jose-bagatelli"}, "edited": false, "score": 0, "creation_date": 1433479323, "post_id": 30580746, "comment_id": 49379454, "body": "Short answer is you can&#39;t. You can&#39;t write to disk on appengine. You have to write your output using a http.ResponseWriter or save your json onto a database."}, {"owner": {"reputation": 127, "user_id": 2284019, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5da76f7ed150b38a3db00413d3976f67?s=128&d=identicon&r=PG", "display_name": "Dede", "link": "https://stackoverflow.com/users/2284019/dede"}, "reply_to_user": {"reputation": 1278, "user_id": 2036231, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/nYM74.png?s=128&g=1", "display_name": "Jose Bagatelli", "link": "https://stackoverflow.com/users/2036231/jose-bagatelli"}, "edited": false, "score": 0, "creation_date": 1433493135, "post_id": 30580746, "comment_id": 49386033, "body": "I fixed the issue, you have to enable the Cloud Storage JSON API in google apis. It is not a matter of writing on disk, I didn&#39;t want to do that! The code writes on GCS directly."}], "owner": {"reputation": 127, "user_id": 2284019, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5da76f7ed150b38a3db00413d3976f67?s=128&d=identicon&r=PG", "display_name": "Dede", "link": "https://stackoverflow.com/users/2284019/dede"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 244, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1433183757, "creation_date": 1433183757, "question_id": 30580746, "link": "https://stackoverflow.com/questions/30580746/post-json-on-gcs-using-app-engine-in-go", "title": "Post Json on GCS using app engine in go", "body": "<p>I develop an app in go that locally was working perfectly with the google SDK. Now I tried to deploy it and I cannot save files on cloud storage anymore.</p>\n\n<p>Here is my go code</p>\n\n<pre><code>package galileo\n\nimport (\n    \"encoding/json\"\n    \"golang.org/x/net/context\"\n    \"golang.org/x/oauth2\"\n    \"golang.org/x/oauth2/google\"\n    \"google.golang.org/appengine\"\n    \"google.golang.org/appengine/file\"\n    \"google.golang.org/appengine/urlfetch\"\n    \"google.golang.org/cloud\"\n    \"google.golang.org/cloud/storage\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\nvar bucket = \"prod_agl_expt\"\n\n// saveData struct holds information needed to run the various saving functions.\ntype saveData struct {\n    c       context.Context\n    r       *http.Request       //http response\n    w       http.ResponseWriter //http writer\n    ctx     context.Context\n    cleanUp []string // cleanUp is a list of filenames that need cleaning up at the end of the saving.\n    failed  bool     // failed indicates that one or more of the saving steps failed.\n}\n\n// saveData struct holds information needed to run the various saving functions.\ntype loadData struct {\n    c       context.Context\n    r       *http.Request       //http response\n    w       http.ResponseWriter //http writer\n    ctx     context.Context\n    cleanUp []string // cleanUp is a list of filenames that need cleaning up at the end of the saving.\n    failed  bool     // failed indicates that one or more of the saving steps failed.\n}\n\ntype jsonStruct struct {\n    User struct {\n        Gender string `json:\"gender\"`\n        Age    string `json:\"age\"`\n        ID     string `json:\"id\"`\n    } `json:\"user\"`\n    Stim map[string]struct {\n        Index           int    `json:\"index\"`\n        Word            string `json:\"word\"`\n        WordDisplayTime int    `json:\"wordDisplayTime\"`\n        AnswerMaxTime   int    `json:\"answerMaxTime\"`\n        FixationTime    int    `json:\"fixationTime\"`\n        Train           bool   `json:\"train\"`\n        Test            bool   `json:\"test\"`\n        Grammatical     bool   `json:\"grammatical\"`\n        Grammar         string `json:\"grammar\"`\n        Keyboard        bool   `json:\"keyboard\"`\n        TestSeq         int    `json:\"testSeq\"`\n    } `json:\"viewedTrials\"`\n    Answers struct {\n        Training []struct {\n            Answer   string  `json:\"ans\"`\n            RT       float32 `json:\"RT\"`\n            GtAnswer string  `json:\"gtAns\"`\n            Correct  int     `json:\"correct\"`\n        } `json:\"training\"`\n        Test []struct {\n            Answer   string  `json:\"ans\"`\n            RT       float32 `json:\"RT\"`\n            GtAnswer bool    `json:\"gtAns\"`\n            Correct  int     `json:\"correct\"`\n        } `json:\"test\"`\n    } `json:\"answers\"`\n    Trials []struct {\n        Trial struct {\n            Index           int    `json:\"index\"`\n            Word            string `json:\"word\"`\n            WordDisplayTime int    `json:\"wordDisplayTime\"`\n            AnswerMaxTime   int    `json:\"answerMaxTime\"`\n            FixationTime    int    `json:\"fixationTime\"`\n            Train           bool   `json:\"train\"`\n            Test            bool   `json:\"test\"`\n            Grammatical     bool   `json:\"grammatical\"`\n            Grammar         string `json:\"grammar\"`\n            Keyboard        bool   `json:\"keyboard\"`\n            TestSeq         int    `json:\"testSeq\"`\n        } `json:\"trial\"`\n        Metadata struct {\n            Instructions string `json:\"instructions\"`\n            SubmitUrl    string `json:\"submitUrl\"`\n        } `json:\"metadata\"`\n    } `json:\"shuffledTrials\"`\n    Debriefing []struct {\n        Type             string `json:\"type\"`\n        RadioWithTextAns string `json:\"radioWithTextAns\"`\n        TextAns          string `json:\"textAns\"`\n        Rating           int    `json:\"rating\"`\n        RadioOnlyAns     string `json:\"radioOnlyAns\"`\n    } `json:\"debriefingAns\"`\n}\n\ntype trialStruct []struct {\n    Trial struct {\n        Index           int    `json:\"index\"`\n        Word            string `json:\"word\"`\n        WordDisplayTime int    `json:\"wordDisplayTime\"`\n        AnswerMaxTime   int    `json:\"answerMaxTime\"`\n        FixationTime    int    `json:\"fixationTime\"`\n        Train           bool   `json:\"train\"`\n        Test            bool   `json:\"test\"`\n        Grammatical     bool   `json:\"grammatical\"`\n        Grammar         string `json:\"grammar\"`\n        Keyboard        bool   `json:\"keyboard\"`\n        TestSeq         int    `json:\"testSeq\"`\n    } `json:\"trial\"`\n    Metadata struct {\n        Instructions string `json:\"instructions\"`\n        SubmitUrl    string `json:\"submitUrl\"`\n    } `json:\"metadata\"`\n}\n\nfunc fromJSON(r io.Reader) (jsonStruct, error) {\n    var x jsonStruct\n    dec := json.NewDecoder(r)\n    err := dec.Decode(&amp;x)\n    return x, err\n}\n\nfunc toJSON(b io.Writer, trial trialStruct) (io.Writer, error) {\n    enc := json.NewEncoder(b)\n    err := enc.Encode(&amp;trial)\n    return b, err\n}\n\nfunc init() {\n    http.HandleFunc(\"/\", handleStatic)\n    http.HandleFunc(\"/saveUserData\", handleSaveUser)\n    http.HandleFunc(\"/loadTrials\", handleloadTrials)\n}\n\nfunc handleStatic(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Cache-Control\", \"no-cache\")\n    http.ServeFile(w, r, \"static/\"+r.URL.Path)\n}\n\n// testSave is the main saving entry point that calls the GCS operations.\nfunc handleSaveUser(w http.ResponseWriter, r *http.Request) {\n\n    c := appengine.NewContext(r)\n    if bucket == \"\" {\n        var err error\n        if bucket, err = file.DefaultBucketName(c); err != nil {\n            // log.Errorf(c, \"failed to get default GCS bucket name: %v\", err)\n            return\n        }\n    }\n    hc := &amp;http.Client{\n        Transport: &amp;oauth2.Transport{\n            Source: google.AppEngineTokenSource(c, storage.ScopeFullControl),\n            Base:   &amp;urlfetch.Transport{Context: c},\n        },\n    }\n    ctx := cloud.NewContext(appengine.AppID(c), hc)\n\n    // structure to holds information needed to run the various saving functions\n    d := &amp;saveData{\n        c:   c,\n        r:   r,\n        w:   w,\n        ctx: ctx,\n    }\n\n    // retrieve data\n    processedJson, trials, trainAns, testAns, stimSeq, userDetails, debriefingAns, rawJson := getJsonUserData(d.r, d.w)\n    //\n    d.createUserFolder(processedJson.User.ID)\n    // d.saveJson(k.User.ID, \"raw\", z)\n    d.saveJson(processedJson.User.ID, \"trials\", trials)\n    d.saveJson(processedJson.User.ID, \"train\", trainAns)\n    d.saveJson(processedJson.User.ID, \"test\", testAns)\n    d.saveJson(processedJson.User.ID, \"stim\", stimSeq)\n    d.saveJson(processedJson.User.ID, \"user\", userDetails)\n    d.saveJson(processedJson.User.ID, \"debriefing\", debriefingAns)\n    d.saveJson(processedJson.User.ID, \"raw\", rawJson)\n}\n\n// Deal with error\nfunc (d *saveData) errorf(format string, args ...interface{}) {\n    d.failed = true\n}\n\nfunc getJsonUserData(r *http.Request, w http.ResponseWriter) (jsonStruct, []byte, []byte, []byte, []byte, []byte, []byte, []byte) {\n    defer r.Body.Close()\n\n    procJson, err := fromJSON(r.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Printf(\"initial structure: \", procJson)\n    log.Printf(\"%+v\\n\", procJson)\n    trials, err := json.Marshal(procJson.Trials)\n    if err != nil {\n        log.Fatal(err)\n    }\n    trainAns, err := json.Marshal(procJson.Answers.Training)\n    if err != nil {\n        log.Fatal(err)\n    }\n    testAns, err := json.Marshal(procJson.Answers.Test)\n    if err != nil {\n        log.Fatal(err)\n    }\n    stimSeq, err := json.Marshal(procJson.Stim)\n    if err != nil {\n        log.Fatal(err)\n    }\n    userDetail, err := json.Marshal(procJson.User)\n    if err != nil {\n        log.Fatal(err)\n    }\n    debriefingAns, err := json.Marshal(procJson.Debriefing)\n    if err != nil {\n        log.Fatal(err)\n    }\n    rawJson, err := json.Marshal(procJson)\n    if err != nil {\n        log.Fatal(err)\n    }\n    return procJson, trials, trainAns, testAns, stimSeq, userDetail, debriefingAns, rawJson\n}\n\nfunc (d *saveData) createUserFolder(folderName string) {\n    fName := folderName + \"/\"\n    wc := storage.NewWriter(d.ctx, bucket, fName)\n    wc.ContentType = \"text/plain\"\n    d.cleanUp = append(d.cleanUp, fName)\n\n    if err := wc.Close(); err != nil {\n        d.errorf(\"createFile: unable to close bucket %q, file %q: %v\", bucket, fName, err)\n        return\n    }\n\n}\n\nfunc (d *saveData) saveJson(folderName string, fileName string, fileContent []byte) {\n    fullName := folderName + \"/\" + fileName\n    wc := storage.NewWriter(d.ctx, bucket, fullName)\n    wc.ContentType = \"text/plain\"\n    d.cleanUp = append(d.cleanUp, fullName)\n    d.createFile(fullName, fileContent)\n\n}\n\nfunc (d *saveData) createFile(fileName string, content []byte) {\n\n    wc := storage.NewWriter(d.ctx, bucket, fileName)\n    wc.ContentType = \"text/plain\"\n    d.cleanUp = append(d.cleanUp, fileName)\n\n    if _, err := wc.Write([]byte(content)); err != nil {\n        d.errorf(\"createFile: unable to write data to bucket %q, file %q: %v\", bucket, fileName, err)\n        return\n    }\n    if err := wc.Close(); err != nil {\n        d.errorf(\"createFile: unable to close bucket %q, file %q: %v\", bucket, fileName, err)\n        return\n    }\n}\n\nfunc handleloadTrials(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n    if bucket == \"\" {\n        var err error\n        if bucket, err = file.DefaultBucketName(c); err != nil {\n            // log.Errorf(c, \"failed to get default GCS bucket name: %v\", err)\n            return\n        }\n    }\n    hc := &amp;http.Client{\n        Transport: &amp;oauth2.Transport{\n            Source: google.AppEngineTokenSource(c, storage.ScopeFullControl),\n            Base:   &amp;urlfetch.Transport{Context: c},\n        },\n    }\n    ctx := cloud.NewContext(appengine.AppID(c), hc)\n\n    // structure to holds information needed to run the various saving functions\n    d := &amp;saveData{\n        c:   c,\n        r:   r,\n        w:   w,\n        ctx: ctx,\n    }\n\n    userID := r.URL.Query().Get(\"id\")\n    log.Println(userID)\n    trialJson := d.readFile(userID)\n    w.Write(trialJson)\n}\n\n// readFile reads the named file in Google Cloud Storage.\nfunc (d *saveData) readFile(fileName string) []byte {\n    trialName := fileName + \"/trials\"\n    rc, err := storage.NewReader(d.ctx, bucket, trialName)\n    if err != nil {\n        d.errorf(\"readFile: unable to open file from bucket %q, file %q: %v\", bucket, trialName, err)\n\n    }\n    defer rc.Close()\n    slurp, err := ioutil.ReadAll(rc)\n    if err != nil {\n        d.errorf(\"readFile: unable to read data from bucket %q, file %q: %v\", bucket, fileName, err)\n    }\n    return slurp\n}\n</code></pre>\n\n<p>The javascript code:</p>\n\n<pre><code>saveUserData : function saveUserData(data) {\n  var _this = this,\n      save = this.shadowRoot.querySelector('#save-data');\n\n  save.url=\"http://galileoexp.appspot.com/saveUserData\";\n  save.body = JSON.stringify(data);\n  save.go();\n}\n</code></pre>\n\n<p>The console does not give any error when it call /saveUserData so I really do no know where the problem is, it seems like the permission are wrong but I checked them and they look good.</p>\n\n<p>Any idea?\nthanks</p>\n"}, {"tags": ["go", "cross-platform"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1433182327, "post_id": 30580111, "comment_id": 49230549, "body": "<code>cgo</code> is how you call into C libraries from Go. It does not create C libraries."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1433182684, "post_id": 30580111, "comment_id": 49230752, "body": "Go will support various build modes in go1.5. If you&#39;re using the development version, you need to show an example of what you&#39;re trying to do."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1433188189, "post_id": 30580111, "comment_id": 49233891, "body": "<code>go build -h</code> says &quot;When the command line specifies a single main package, build writes the resulting executable to output.  Otherwise build <b>compiles the packages but discards the results</b>, serving only as a check that the packages can be built.&quot; You want <code>go install</code> (and make sure you&#39;ve read <a href=\"https://golang.org/doc/code.html#Library\" rel=\"nofollow noreferrer\">How to Write Go Code</a>)."}, {"owner": {"reputation": 172, "user_id": 2517996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8856c303ec9b2da9878f3127e84a765c?s=128&d=identicon&r=PG", "display_name": "Sense", "link": "https://stackoverflow.com/users/2517996/sense"}, "edited": false, "score": 0, "creation_date": 1433260773, "post_id": 30580111, "comment_id": 49270430, "body": "That <code>cgo</code> is only for calling <code>C</code> from <code>go</code> is actually not completely true: <a href=\"https://golang.org/cmd/cgo/#hdr-C_references_to_Go\" rel=\"nofollow noreferrer\">golang.org/cmd/cgo/#hdr-C_references_to_Go</a>. <code>go install</code> did not create anything either, but thanks for the suggestion. <b>However, Go 1.5 looks really promising.</b>"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1433420387, "post_id": 30580111, "comment_id": 49351272, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/30072281/using-go-on-existing-c-project\">Using Go on existing C project</a>"}, {"owner": {"reputation": 172, "user_id": 2517996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8856c303ec9b2da9878f3127e84a765c?s=128&d=identicon&r=PG", "display_name": "Sense", "link": "https://stackoverflow.com/users/2517996/sense"}, "edited": false, "score": 0, "creation_date": 1433420810, "post_id": 30580111, "comment_id": 49351578, "body": "I agree that the other question deals with the same topic."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1433255123, "post_id": 30588502, "comment_id": 49266248, "body": "&quot;in the future&quot; is in the next release, Go1.5 scheduled for August. The work is done so you could try using &quot;tip&quot; (probably by installing it from source from the head/tip of the repository; see some of the <a href=\"https://tip.golang.org/cmd/go/#hdr-Description_of_build_modes\" rel=\"nofollow noreferrer\">upcoming build mode documentation</a>)."}, {"owner": {"reputation": 172, "user_id": 2517996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8856c303ec9b2da9878f3127e84a765c?s=128&d=identicon&r=PG", "display_name": "Sense", "link": "https://stackoverflow.com/users/2517996/sense"}, "edited": false, "score": 0, "creation_date": 1433260969, "post_id": 30588502, "comment_id": 49270571, "body": "<b>I will try out Go 1.5.</b> For others looking: <a href=\"http://talks.golang.org/2015/state-of-go-may.slide\" rel=\"nofollow noreferrer\">The State of Go</a> from May is explaining the plans for the 1.5 release in August."}], "tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": true, "score": 0, "last_activity_date": 1433225032, "creation_date": 1433225032, "answer_id": 30588502, "question_id": 30580111, "link": "https://stackoverflow.com/questions/30580111/how-to-create-an-embeddable-c-api-library-in-go/30588502#30588502", "title": "How to create an embeddable C-API library in Go?", "body": "<p>If your aim is to build a library that can be linked into arbitrary C, Objective-C or Java programs, you are out of luck with the currently released standard tool chain.  There are plans to change this in the future, but at present the Go runtime is not embeddable in other applications.</p>\n\n<p>While <code>cgo</code> will allow you to export functions to be called from C, this is only really useful for cases when the C code you call from Go needs to call back to Go.</p>\n"}], "owner": {"reputation": 172, "user_id": 2517996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8856c303ec9b2da9878f3127e84a765c?s=128&d=identicon&r=PG", "display_name": "Sense", "link": "https://stackoverflow.com/users/2517996/sense"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 30588502, "answer_count": 1, "score": 0, "last_activity_date": 1433225032, "creation_date": 1433181554, "last_edit_date": 1433181655, "question_id": 30580111, "link": "https://stackoverflow.com/questions/30580111/how-to-create-an-embeddable-c-api-library-in-go", "title": "How to create an embeddable C-API library in Go?", "body": "<p>I am planning to write a cross-platform app that has most of its functionality shared across all platforms (Linux, OS X, Windows, iOS, Android).\nThese are mostly helper function (calculations, internal lists, networking etc.) so I figured it would be convenient to have those functions in a library I can compile for every platform while still being able to create custom UI for each platform individually.</p>\n\n<p>Dominant languages across those platforms I mentioned are <em>C, Objective-C, C# and Java</em>. All these languages support calling C-API functions from a library either directly or via internal wrappers. Since I don't want to write 80% of my application's code in C/C++, I searched and found <strong>Go</strong>.</p>\n\n<p><a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow\"><code>cgo</code></a> seems to be the solution for my problem.<br>\nMy current thought is to code the core library in Go and then compile it for each platform, however, invoking <code>go build</code> does not create anything at all.<br>\nI <code>import \"C\"</code>.<br>\nI have declared a <code>func</code> and added the <code>//export</code> statement before.</p>\n\n<p>I read about <code>gccgo</code> but people keep pointing out that it is outdated and should not be used.</p>\n\n<p>Maybe anyone can point out a flaw in my thoughts or help me bring this library file together. Thanks in advance.</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 4962401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/938f142cee103ef1bdfcfc00b2333e8b?s=128&d=identicon&r=PG&f=1", "display_name": "Terio", "link": "https://stackoverflow.com/users/4962401/terio"}, "edited": false, "score": 1, "creation_date": 1433355701, "post_id": 30586958, "comment_id": 49321408, "body": "That&#39;s true but it does not explain the error as appengine.NewContext() returns the new Context type from golang.org/x/net/context. This code is in the simple helloworld demo provided by Google for an application running in the managed VM (<a href=\"https://github.com/golang/appengine/tree/master/demos/helloworld\" rel=\"nofollow noreferrer\">github.com/golang/appengine/tree/master/demos/helloworld</a>)."}, {"owner": {"reputation": 4111, "user_id": 1665544, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/534605444/picture?type=large", "display_name": "Su-Au Hwang", "link": "https://stackoverflow.com/users/1665544/su-au-hwang"}, "reply_to_user": {"reputation": 11, "user_id": 4962401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/938f142cee103ef1bdfcfc00b2333e8b?s=128&d=identicon&r=PG&f=1", "display_name": "Terio", "link": "https://stackoverflow.com/users/4962401/terio"}, "edited": false, "score": 0, "creation_date": 1433356593, "post_id": 30586958, "comment_id": 49321919, "body": "I&#39;ve set app engine&#39;s managed vms with golang aside for a while until it stabilizes a bit more. There seem to be drastic changes right now and I couldn&#39;t get any demos to work. According to the google app engine golang google group there is going to be a big announcement soonish. Even my gcloud generated Dockerfile is totally different from yours."}, {"owner": {"reputation": 11, "user_id": 4962401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/938f142cee103ef1bdfcfc00b2333e8b?s=128&d=identicon&r=PG&f=1", "display_name": "Terio", "link": "https://stackoverflow.com/users/4962401/terio"}, "edited": false, "score": 0, "creation_date": 1433454770, "post_id": 30586958, "comment_id": 49372416, "body": "I am also putting it aside for the time being. The Dockefile I provided was not the one that was generated by gcloud. I could not get that one to work event when I added git installation to it which improved things but did not solve all the problems. That Dockerfile I listed was suggested as a solution to the problems the generated Dockerfile has and it takes me as far as having the application running an answering to health requests. Then I get the NewContext errors. Thanks for your answers!"}, {"owner": {"reputation": 4111, "user_id": 1665544, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/534605444/picture?type=large", "display_name": "Su-Au Hwang", "link": "https://stackoverflow.com/users/1665544/su-au-hwang"}, "reply_to_user": {"reputation": 11, "user_id": 4962401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/938f142cee103ef1bdfcfc00b2333e8b?s=128&d=identicon&r=PG&f=1", "display_name": "Terio", "link": "https://stackoverflow.com/users/4962401/terio"}, "edited": false, "score": 0, "creation_date": 1433849325, "post_id": 30586958, "comment_id": 49517581, "body": "Good news, the appengine standard runtime Docker image was updated <a href=\"https://groups.google.com/forum/#!msg/google-appengine-go/9se4b7r8sas/vKF0N5sic_4J\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!msg/google-appengine-go/9se4b7r8sa&zwnj;&#8203;s/&hellip;</a>"}, {"owner": {"reputation": 4111, "user_id": 1665544, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/534605444/picture?type=large", "display_name": "Su-Au Hwang", "link": "https://stackoverflow.com/users/1665544/su-au-hwang"}, "reply_to_user": {"reputation": 11, "user_id": 4962401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/938f142cee103ef1bdfcfc00b2333e8b?s=128&d=identicon&r=PG&f=1", "display_name": "Terio", "link": "https://stackoverflow.com/users/4962401/terio"}, "edited": false, "score": 0, "creation_date": 1433849492, "post_id": 30586958, "comment_id": 49517689, "body": "I had the Hello world tutorial running locally and deployed, just using gcloud and the auto generated Dockerfile."}, {"owner": {"reputation": 11, "user_id": 4962401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/938f142cee103ef1bdfcfc00b2333e8b?s=128&d=identicon&r=PG&f=1", "display_name": "Terio", "link": "https://stackoverflow.com/users/4962401/terio"}, "edited": false, "score": 0, "creation_date": 1433955746, "post_id": 30586958, "comment_id": 49578089, "body": "Thanks! I will go back to that next week."}], "tags": [], "owner": {"reputation": 4111, "user_id": 1665544, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/534605444/picture?type=large", "display_name": "Su-Au Hwang", "link": "https://stackoverflow.com/users/1665544/su-au-hwang"}, "is_accepted": false, "score": 0, "last_activity_date": 1433216786, "creation_date": 1433216786, "answer_id": 30586958, "question_id": 30579816, "link": "https://stackoverflow.com/questions/30579816/appengine-newcontext-error-when-running-web-app-in-local-dev-enviroment-for-mana/30586958#30586958", "title": "appengine.NewContext error when running web app in local dev enviroment for managed vm", "body": "<p>from <a href=\"https://github.com/golang/appengine\" rel=\"nofollow\">Go App Engine for Managed VMs</a></p>\n\n<blockquote>\n  <p>appengine.Context has been replaced with the Context type from golang.org/x/net/context.</p>\n</blockquote>\n"}], "owner": {"reputation": 11, "user_id": 4962401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/938f142cee103ef1bdfcfc00b2333e8b?s=128&d=identicon&r=PG&f=1", "display_name": "Terio", "link": "https://stackoverflow.com/users/4962401/terio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 344, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1433216786, "creation_date": 1433180556, "question_id": 30579816, "link": "https://stackoverflow.com/questions/30579816/appengine-newcontext-error-when-running-web-app-in-local-dev-enviroment-for-mana", "title": "appengine.NewContext error when running web app in local dev enviroment for managed vm", "body": "<p>I am trying to run one of the demos of the appengine using managed vm locally in my development environment. The requests fail with a panic when the code tries to create a new context for the request (appengine.NewContext(r)):</p>\n\n<pre><code>func handle(w http.ResponseWriter, r *http.Request) {\n   if r.URL.Path != \"/\" {\n    http.NotFound(w, r)\n    return\n   }\n\n   c := appengine.NewContext(r)\n   log.Infof(c, \"Serving the front page.\")\n   tmpl.Execute(w, time.Since(initTime))\n}\n</code></pre>\n\n<p>The appengine.NewContext(r) produces this error:</p>\n\n<pre><code>2015/05/30 01:01:27 appengine: NewContext passed an unknown http.Request \n2015/05/30 01:01:27 http: panic serving 192.168.59.3:51889: appengine: NewContext passed an unknown http.Request \ngoroutine 115 [running]: \nnet/http.func\u00b7011() \n /usr/local/go/src/net/http/server.go:1130 +0xbb \nlog.Panic(0xc2080c6b10, 0x1, 0x1) \n /usr/local/go/src/log/log.go:307 +0xb9 \ngoogle.golang.org/appengine/internal.WithContext(0x7f7072110508, 0xc20800a380, 0xc208031110, 0x0, 0x0) \n google.golang.org/appengine/internal/api.go:247 +0x158 \ngoogle.golang.org/appengine.WithContext(0x7f7072110508, 0xc20800a380, 0xc208031110, 0x0, 0x0) \n google.golang.org/appengine/appengine.go:35 +0x4e \ngoogle.golang.org/appengine.NewContext(0xc208031110, 0x0, 0x0) \n google.golang.org/appengine/appengine.go:28 +0x7f \nmain28149.handle(0x7f70721103d0, 0xc208062d20, 0xc208031110) \n helloworld.go:28 +0x8f \nnet/http.HandlerFunc.ServeHTTP(0x8662e0, 0x7f70721103d0, 0xc208062d20, 0xc208031110) \n /usr/local/go/src/net/http/server.go:1265 +0x41 \n\nnet/http.(*ServeMux).ServeHTTP(0xc208038e40, 0x7f70721103d0, 0xc208062d20, 0xc208031110) \n /usr/local/go/src/net/http/server.go:1541 +0x17d \nnet/http.serverHandler.ServeHTTP(0xc2080600c0, 0x7f70721103d0, 0xc208062d20, 0xc208031110) \n /usr/local/go/src/net/http/server.go:1703 +0x19a \nnet/http.(*conn).serve(0xc208062c80) \n /usr/local/go/src/net/http/server.go:1204 +0xb57 \ncreated by net/http.(*Server).Serve \n /usr/local/go/src/net/http/server.go:1751 +0x35e\n</code></pre>\n\n<p>The Dockerfile is:</p>\n\n<pre><code>FROM gcr.io/google_appengine/go-compat\nRUN rm -rf /goroot &amp;&amp; mkdir /goroot &amp;&amp; curl https://storage.googleapis.com/golang/go1.4.2.linux-amd64.tar.gz | tar xvzf - -C /goroot --strip-components=1\nADD . /app\nRUN /bin/bash /app/_ah/build.sh\n</code></pre>\n\n<p>It seems like the appengine environment is not properly set up in the docker image. </p>\n\n<p>I would appreciate any suggestion about how to solve this problem.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["concurrency", "go"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 2, "creation_date": 1433180628, "post_id": 30579752, "comment_id": 49229659, "body": "You have a racecondition in your code on <code>myurl</code>. You should copy it by passing it to the closure. Otherwise, it will probably mostly refer to the last element in your range in all of your goroutines."}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "reply_to_user": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1433181461, "post_id": 30579752, "comment_id": 49230121, "body": "Yes, I added 2nd version which I guess correct, but does not works too."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1433181584, "post_id": 30579752, "comment_id": 49230188, "body": "What happens when you run the second version?"}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1433181775, "post_id": 30579752, "comment_id": 49230277, "body": "If listOfUrls has say 4 urls, It prints (&quot;Getting url:&quot;) from getBodyUrls four times, and then it prints zeroes for length also four times...  In theory it should print &quot;Done url: &quot; from getBodyUrls, and print correct size..."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1433182098, "post_id": 30579752, "comment_id": 49230426, "body": "It&#39;s not possible to comment on what&#39;s going on because none of the print statements mentioned in your comment are in the code that you have shown."}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1433182510, "post_id": 30579752, "comment_id": 49230655, "body": "sorry I thought that it would be enough, the getUrlBody is really huge to post, but I guess problem must be there,  I will simplify it by rmeoving things, and edit the head post."}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1433184451, "post_id": 30579752, "comment_id": 49231714, "body": "It&#39;s a shame... error was very clear (if look) in getUrlBody... :-( I am so sorry. Thank you for pointing me on my closure/variable that was also source of problem."}], "answers": [{"comments": [{"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1433181259, "post_id": 30579875, "comment_id": 49230008, "body": "Thank you. Please, if my edit with addition to start topic, makes sense?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1433181047, "last_edit_date": 1433181047, "creation_date": 1433180747, "answer_id": 30579875, "question_id": 30579752, "link": "https://stackoverflow.com/questions/30579752/sync-waitgroup-doesnt-waits/30579875#30579875", "title": "sync.WaitGroup doesnt waits", "body": "<p>All of the goroutines are sharing the single <code>myurl</code> variable. See <a href=\"https://golang.org/doc/faq#closures_and_goroutines\" rel=\"nofollow\">https://golang.org/doc/faq#closures_and_goroutines</a> for more information.</p>\n\n<p>Change the code to:</p>\n\n<pre><code>func f(listOfUrls []string){\n  var wg sync.WaitGroup\n  wg.Add(len(listOfUrl))\n  for _, myurl := range(listOfUrls){\n    go func(myurl string){\n           body := getUrlBody(myurl)\n           fmt.Println(len(body))\n           wg.Done()\n       }(myurl)    \n  } \n  wg.Wait()\n}\n</code></pre>\n\n<p>or </p>\n\n<pre><code>func f(listOfUrls []string){\n  var wg sync.WaitGroup\n  wg.Add(len(listOfUrl))\n  for _, myurl := range(listOfUrls){\n    myurl := myurl\n    go func(){\n           body := getUrlBody(myurl)\n           fmt.Println(len(body))\n           wg.Done()\n       }()    \n  } \n  wg.Wait()\n}\n</code></pre>\n"}], "owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "accepted_answer_id": 30579875, "answer_count": 1, "score": -2, "last_activity_date": 1433184545, "creation_date": 1433180345, "last_edit_date": 1433184545, "question_id": 30579752, "link": "https://stackoverflow.com/questions/30579752/sync-waitgroup-doesnt-waits", "title": "sync.WaitGroup doesnt waits", "body": "<p>May be I can not see obvious thing, what am I doing wrong:</p>\n\n<pre><code>func printSize (listOfUrls []string){\n    var wg sync.WaitGroup\n    wg.Add(len(listOfUrl))\n    for _, myurl := range(listOfUrls){\n        go func(){\n               body := getUrlBody(myurl)\n               fmt.Println(len(body))\n               wg.Done()\n           }()    \n    } \n    wg.Wait()\n}\n</code></pre>\n\n<p>If I remove wg and go, I receive the size of each url body correctly. If I do it as in above, it prints zeroes almost instantly. The getUrlBody() takes time to execute sometimes minutes.</p>\n\n<p>Answering comment: I also tried it this way, to be sure, and it demonstrate same behaviour.\nI found the error was in getUrlBody and main() function...</p>\n\n<pre><code>func printSize(listOfUrls []string) {\n    var wg sync.WaitGroup\n    wg.Add(len(listOfUrls))\n        for _, myurl := range listOfUrls {\n          go f(myurl, &amp;wg)\n        }\n    wg.Wait()\n}\n\nfunc f(myurl string, wg *sync.WaitGroup) {\n    body := getUrlBody(myurl)\n    fmt.Println(len(body))\n    wg.Done()\n }\n</code></pre>\n"}, {"tags": ["encryption", "go", "cryptography", "aes", "rsa"], "answers": [{"comments": [{"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1433180781, "post_id": 30578651, "comment_id": 49229752, "body": "Sorry, that last paragraph is simply incorrect. I felt it must be incorrect and I&#39;ve tested it with Java just to be sure (so I&#39;ve to eat fast otherwise my healthy green beans are getting cold)."}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1433181322, "post_id": 30578651, "comment_id": 49230042, "body": "Just to be 100% compatibility with existing implementations I would use a multiple of 64 bit or even 3072 (2048 + 1024, so 2^x + 2^(x-1)). Note that some (hardware) runtimes are restricted to 2048 bits as well."}, {"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "reply_to_user": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1433190462, "post_id": 30578651, "comment_id": 49235127, "body": "Maarten, your two comments are somewhat contradictory. First you say that my last paragraph is wrong (I suspect you mean the multiple of 64-bit), then you say that a multiple of 64-bit is ok. It&#39;s kind of strange. Maybe you can clarify what you meant. In any case I used your critique to do a little experimentation and the results are vastly different across languages/frameworks. I also wanted to do Ruby and PhpSecLib, but ruby was buggy on ideone and I couldn&#39;t get phpseclib to download from sourceforge."}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1433190813, "post_id": 30578651, "comment_id": 49235300, "body": "There is a clear performance difference between e.g. 1025/1057 bits and 1088 bits on the Java platform. For 1000 iterations I got an average of 4.744/4.874 ms and 5.150 ms. However, an 8 byte difference is a <i>very</i> good idea for compatibility reasons. And using anything else than something on the byte boundary is just asking for trouble."}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1433191042, "post_id": 30578651, "comment_id": 49235410, "body": "PyCrypto is certainly taking it a bit too far. 32 <i>byte</i> steps? That&#39;s fine for a protocol, but not for the underlying primitive. Personally I think for an API 8 bit steps are fine, but 1 bit steps are still preferable."}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1433191289, "post_id": 30578651, "comment_id": 49235526, "body": "I want to vote up, but the performance remark is still in there. Test on the other frameworks as well for the performance. You&#39;ll see that in the majority of cases the performance will go down for each bit of security that is added (my apologies to your CPU, it&#39;ll get hammered generating the key pairs :) )."}, {"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "reply_to_user": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1433191403, "post_id": 30578651, "comment_id": 49235593, "body": "I actually haven&#39;t <i>yet</i> run a performace test on the different key sizes. That was just a check what sizes are accepted at all. :)"}], "tags": [], "owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "is_accepted": true, "score": 4, "last_activity_date": 1433271548, "last_edit_date": 1492087698, "creation_date": 1433176426, "answer_id": 30578651, "question_id": 30577630, "link": "https://stackoverflow.com/questions/30577630/source-text-key-size-relationship-for-encryption-decryption-in-go/30578651#30578651", "title": "Source text, key size relationship for encryption/decryption in Go", "body": "<p>One does not usually calculate the RSA key size based on payload. One simply needs to select one RSA key size based on a compromise between security (bigger is better) and performance (smaller is better). If that is done, use <a href=\"https://en.wikipedia.org/wiki/Hybrid_cryptosystem\" rel=\"nofollow noreferrer\">hybrid encryption</a> in conjunction with AES or another symmetric cipher to actually encrypt the data.</p>\n\n<p>If the payload doesn't exceed 300 bytes and you're using OAEP (at least 42 bytes of padding), then you can easily calculate the minimum key size:</p>\n\n<pre><code>(300 + 42) * 8 = 2736 bit\n</code></pre>\n\n<p>That's already a reasonable size key. It provides good security according to today's norms and is fairly fast. There is no need to apply a hybrid encryption scheme for this.</p>\n\n<p>Now, you may notice that the key size isn't a power of 2. <a href=\"https://crypto.stackexchange.com/questions/7849/why-are-rsa-key-sizes-almost-always-a-power-of-two\">This is not a problem</a>. You should however use a key size that is a multiple of 64 bit, because processors use 32-bit and 64-bit primitives to do the actual calculation, so you can increase the security without a performance penalty. The next such key size would be:</p>\n\n<pre><code>ceil((300 + 42) * 8 / 64.0) * 64 = 2752 bit\n</code></pre>\n\n<p>Here are some experimental results what some languages/frameworks accept (not performance-wise) as the key size:</p>\n\n<ul>\n<li>Golang: multiple of 1 bit and >= 1001 (sic!) [used ideone.com]</li>\n<li>PyCrypto: multiple of 256 bit and >= 1024 [local install]</li>\n<li>C#: multiple of 16 bit and >= 512 [used ideone.com]</li>\n<li>Groovy: multiple of 1 bit and >= 512 [local install]</li>\n<li>Java: multiple of 1 bit and >= 512 [used ideone.com: Java &amp; Java7]</li>\n<li>PHP/OpenSSL Ext: multiple of 128 bit and >= 640 [used ideone.com]</li>\n<li>Crypto++: multiple of 1 bit and >= 16 [local install with maximal validation toughness of <code>3</code>]</li>\n</ul>\n\n<p>Before you decide to use some kind of specific key size, you should check that all frameworks support that size. As you see, there are vastly varying results.</p>\n\n<p>I tried to write some performance tests of key generation, encryption and decryption with different key sizes: 512, 513, 514, 516, 520, 528, 544, 576. Since I don't know any go, it would be hard to get the timing right. So I settled for Java and Crypto++. The Crypto++ code is probably very buggy, because key generation for 520-bit and 528-bit keys is up to seven orders of magnitude faster than for the other key sizes which is more or less constant for the small key size window.</p>\n\n<p>In Java the key generation was pretty clear in that the generation of a 513-bit key was 2-3 <em>times</em> slower than for a 512-bit key. Other than that the results are nearly linear. The graph is normalized and the numbers of iterations is 1000 for the full keygen-enc-dec cycle.</p>\n\n<p><img src=\"https://i.stack.imgur.com/VIM6N.png\" alt=\"key generation, encryption and decryption performance for different key sizes\"></p>\n\n<p>The decryption makes a little dip at 544-bit which is a multiple of 32-bit. Since it was executed on a 32-bit debian, this might mean that indeed there are some performance improvements, but on the other hand the encryption was slower for that key size.</p>\n\n<p>Since this benchmark wasn't done in Go, I won't give any advice on how small the overhead can be.</p>\n"}], "owner": {"reputation": 57, "user_id": 3691075, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c51d7ab1d6c5ab5ca3a6d1431b48a7b8?s=128&d=identicon&r=PG&f=1", "display_name": "parens", "link": "https://stackoverflow.com/users/3691075/parens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1527, "favorite_count": 1, "accepted_answer_id": 30578651, "answer_count": 1, "score": 0, "last_activity_date": 1433271548, "creation_date": 1433173186, "last_edit_date": 1495541389, "question_id": 30577630, "link": "https://stackoverflow.com/questions/30577630/source-text-key-size-relationship-for-encryption-decryption-in-go", "title": "Source text, key size relationship for encryption/decryption in Go", "body": "<p>In the code below (also at <a href=\"http://play.golang.org/p/77fRvrDa4A\" rel=\"nofollow noreferrer\">http://play.golang.org/p/77fRvrDa4A</a> but takes \"too long to process\" in the browser there) the 124 byte version of the <strong>sourceText</strong> won't encrypt because: \"message too long for RSA public key size\" of 1024. It, and the longer 124 byte <strong>sourceText</strong> version, work with 2048 bit key size.</p>\n\n<p>My question is how does one exactly calculate the key size in <strong>rsa.GenerateKey</strong> given the byte length of the source text? (A small paragraph size of text takes nearly 10 seconds at 4096 key size, and I don't know the length of the sourceText until runtime.)</p>\n\n<p>There's a very brief discussion of this at <a href=\"https://stackoverflow.com/a/11750658/3691075\">https://stackoverflow.com/a/11750658/3691075</a>, but it's not clear to me as I'm not a crypto guy. </p>\n\n<p>My goal is to encrypt, store in a DB and decrypt about 300-byte long JSON strings. I control both the sending and the receiving end. Text is encrypted once, and decrypted many times. Any hints of strategy would be appreciated. </p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/md5\"\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"fmt\"\n    \"hash\"\n    \"log\"\n    \"time\"\n)\n\nfunc main() {\n     startingTime := time.Now()\n     var err error\n     var privateKey *rsa.PrivateKey\n     var publicKey *rsa.PublicKey\n     var sourceText, encryptedText, decryptedText, label []byte\n\n    // SHORT TEXT 92 bytes\n     sourceText = []byte(`{347,7,3,8,7,0,7,5,6,4,1,6,5,6,7,3,7,7,7,6,5,3,5,3,3,5,4,3,2,10,3,7,5,6,65,350914,760415,33}`)\n     fmt.Printf(\"\\nsourceText byte length:\\n%d\\n\", len(sourceText))\n\n    // LONGER TEXT 124 bytes\n    // sourceText = []byte(`{347,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,65,350914,760415,33}`)\n    // fmt.Printf(\"\\nsourceText byte length:\\n%d\\n\", len(sourceText))\n\n    if privateKey, err = rsa.GenerateKey(rand.Reader, 1024); err != nil {\n         log.Fatal(err)\n    }\n\n    // fmt.Printf(\"\\nprivateKey:\\n%s\\n\", privateKey)\n\n    privateKey.Precompute()\n\n    if err = privateKey.Validate(); err != nil {\n         log.Fatal(err)\n    }\n\n     publicKey = &amp;privateKey.PublicKey\n\n     encryptedText = encrypt(publicKey, sourceText, label)\n     decryptedText = decrypt(privateKey, encryptedText, label)\n\n     fmt.Printf(\"\\nsourceText: \\n%s\\n\", string(sourceText))\n     fmt.Printf(\"\\nencryptedText: \\n%x\\n\", encryptedText)\n     fmt.Printf(\"\\ndecryptedText: \\n%s\\n\", decryptedText)\n\n     fmt.Printf(\"\\nDone in %v.\\n\\n\", time.Now().Sub(startingTime))\n}\n\nfunc encrypt(publicKey *rsa.PublicKey, sourceText, label []byte) (encryptedText []byte) {\n     var err error\n     var md5_hash hash.Hash\n     md5_hash = md5.New()\n     if encryptedText, err = rsa.EncryptOAEP(md5_hash, rand.Reader,           publicKey, sourceText, label); err != nil {\n         log.Fatal(err)\n     }\n     return\n}\n\nfunc decrypt(privateKey *rsa.PrivateKey, encryptedText, label []byte) (decryptedText []byte) {\n     var err error\n     var md5_hash hash.Hash\n     md5_hash = md5.New()\n     if decryptedText, err = rsa.DecryptOAEP(md5_hash, rand.Reader, privateKey, encryptedText, label); err != nil {\n         log.Fatal(err)\n     }\n     return\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1433173928, "post_id": 30577727, "comment_id": 49225859, "body": "This question makes me curious, there must be some way to handle this more gracefully. What about preemptively checking the systems memory conditions and giving the warning before you get to the point of panic?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1433174536, "post_id": 30577727, "comment_id": 49226274, "body": "@evanmcdonnal: How would you preemptively check? What you consider &quot;used&quot; may not be what kernel considers used. You can&#39;t rely on malloc&#39;s return, because it always gives you a pointer when overcommit is on. The kernel may also free up memory for you when needed, causing the &quot;check&quot; to return false positives. (and that&#39;s just on Linux, you&#39;d have to make this cross-platform)"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1433175640, "post_id": 30577727, "comment_id": 49226880, "body": "I&#39;m not sure, it was just an idea for how to improve the application. If I knew of a package that could reliably tell me where my memory usage was relative to the maximum I&#39;m allowed by the runtime then I would have used it to write an answer attempting what I described. There may be no reliable way to do it. However, I personally would take false positives/not perfect error prevention over ugly unrecoverable errors. The bar for &#39;just good enough&#39; isn&#39;t set very high in these circumstances."}, {"owner": {"reputation": 18225, "user_id": 152580, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/34b114b30616ba935061582133cceeb8?s=128&d=identicon&r=PG", "display_name": "Eloff", "link": "https://stackoverflow.com/users/152580/eloff"}, "edited": false, "score": 0, "creation_date": 1590533958, "post_id": 30577727, "comment_id": 109714788, "body": "The correct thing to do in an OOM is to let the process die and be restarted by the watchdog - because you do have something (e.g. systemd) monitoring your production process for crashes right? It would just bite you eventually if you don&#39;t, probably on a Friday night. I go a step further and have my server process kill itself once a day, this ensures the watchdog is working correctly, and bad states are cleaned up like fragmented memory."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 8, "last_activity_date": 1433174949, "last_edit_date": 1433174949, "creation_date": 1433173446, "answer_id": 30577727, "question_id": 30577308, "link": "https://stackoverflow.com/questions/30577308/golang-cannot-recover-from-out-of-memory-crash/30577727#30577727", "title": "golang: cannot recover from Out Of Memory crash", "body": "<p>You can't.</p>\n\n<p>If the runtime can't allocate memory for append, it may not be able to recover, or communicate \"Resource temporary unavailable\" to the user. For example, GC might need to allocate to clean up, or the scheduler might be trying to allocate a new thread. Because there's no way to strictly control allocations in a Go program, there's no way to gracefully handle running out of memory. </p>\n\n<p>All OOM conditions terminate a Go program. </p>\n"}], "owner": {"reputation": 113, "user_id": 1146209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66e3b4825e8da42c22e075ca082f8eb1?s=128&d=identicon&r=PG", "display_name": "vadmeste", "link": "https://stackoverflow.com/users/1146209/vadmeste"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1573, "favorite_count": 0, "accepted_answer_id": 30577727, "answer_count": 1, "score": 9, "last_activity_date": 1433174949, "creation_date": 1433172313, "question_id": 30577308, "link": "https://stackoverflow.com/questions/30577308/golang-cannot-recover-from-out-of-memory-crash", "title": "golang: cannot recover from Out Of Memory crash", "body": "<p>Under certain circumstances, calling append() triggers an out of memory panic and it seems append() itself doesn't return nil.</p>\n\n<p>How could I avoid that panic scenario and show to my user \"Resource temporary unavailable\" ?</p>\n\n<p>Best regards,</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1907906"}, "edited": false, "score": 1, "creation_date": 1433172176, "post_id": 30577212, "comment_id": 49224678, "body": "I can&#39;t see how <code>data</code> is defined different the second time."}, {"owner": {"reputation": 97, "user_id": 2547562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/e9pSO.jpg?s=128&g=1", "display_name": "cilendeng", "link": "https://stackoverflow.com/users/2547562/cilendeng"}, "edited": false, "score": 0, "creation_date": 1433172401, "post_id": 30577212, "comment_id": 49224826, "body": "@LutzHorn sorry for the typo and your recorrectness. the first wrong case the data is defined as      &quot;  data := []field{{&quot;one&quot;},{&quot;two&quot;},{&quot;three&quot;}}&quot; .while the new one &quot;        data := []*field{{&quot;one&quot;},{&quot;two&quot;},{&quot;three&quot;}}&quot;"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1907906"}, "edited": false, "score": 0, "creation_date": 1433185393, "post_id": 30577212, "comment_id": 49232274, "body": "Please <a href=\"https://stackoverflow.com/posts/30577212/edit\">edit</a> your question and fix the code."}], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 2547562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/e9pSO.jpg?s=128&g=1", "display_name": "cilendeng", "link": "https://stackoverflow.com/users/2547562/cilendeng"}, "edited": false, "score": 0, "creation_date": 1433216771, "post_id": 30577471, "comment_id": 49243272, "body": "that&#39;s right,the operation is on the element stored in the <code>data</code>,but the element which is operated on is referenced by the <code>v</code>,when the loop runs ,the <code>v</code> is overwritten.when the goroutine is finally  invocated,the v has pointed to the last element.How can the <code>v</code> keep the reference to multiple whatever pointer or struct value or something else."}, {"owner": {"reputation": 97, "user_id": 2547562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/e9pSO.jpg?s=128&g=1", "display_name": "cilendeng", "link": "https://stackoverflow.com/users/2547562/cilendeng"}, "edited": false, "score": 0, "creation_date": 1433217038, "post_id": 30577471, "comment_id": 49243358, "body": "or maybe i miss some mechanism ,Has the golang fetched the real address which the <code>v</code> point to .or the <code>v</code> is fetched until the goroutine finally get the chance to run? the <code>v</code> value is pre-fetched or running-time fetched"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 97, "user_id": 2547562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/e9pSO.jpg?s=128&g=1", "display_name": "cilendeng", "link": "https://stackoverflow.com/users/2547562/cilendeng"}, "edited": false, "score": 0, "creation_date": 1433282309, "post_id": 30577471, "comment_id": 49282419, "body": "@cilendeng: I don&#39;t understand your question. There&#39;s no magic going on, in Go everything is a value, and the copy happens at the time of assignment."}, {"owner": {"reputation": 97, "user_id": 2547562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/e9pSO.jpg?s=128&g=1", "display_name": "cilendeng", "link": "https://stackoverflow.com/users/2547562/cilendeng"}, "edited": false, "score": 0, "creation_date": 1433403240, "post_id": 30577471, "comment_id": 49340035, "body": "I got it .the parameters of a new goroutine get evaluated and passed on the current gorouine(many times the current is the  main goroutine).but it gets scheduled some time later on a new goroutine"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1433172746, "creation_date": 1433172746, "answer_id": 30577471, "question_id": 30577212, "link": "https://stackoverflow.com/questions/30577212/go-for-range-slice-and-goroutine-method-invocation-the-logic-behind/30577471#30577471", "title": "go for range slice and goroutine method invocation,the logic behind", "body": "<p>In the first loop, <code>v</code> is the <em>value</em> of a <code>field</code> item. Because <code>v</code> is addressable, it is automatically referenced as the pointer receiver for the <code>print()</code> method. So <code>v.print()</code> is using the address of <code>v</code> itself, and the contents of that address is overwritten each iteration of the loop. </p>\n\n<p>When you change the declaration to use a <code>*field</code>, <code>v</code> is now a pointer to a <code>field</code> value. When you call <code>v.print()</code> in this case, you are operating on the value that <code>v</code> points to, which is stored in <code>data</code>, and the overwriting of <code>v</code> has no effect. </p>\n"}], "owner": {"reputation": 97, "user_id": 2547562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/e9pSO.jpg?s=128&g=1", "display_name": "cilendeng", "link": "https://stackoverflow.com/users/2547562/cilendeng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 275, "favorite_count": 0, "accepted_answer_id": 30577471, "answer_count": 1, "score": 1, "last_activity_date": 1433172746, "creation_date": 1433171995, "last_edit_date": 1433172305, "question_id": 30577212, "link": "https://stackoverflow.com/questions/30577212/go-for-range-slice-and-goroutine-method-invocation-the-logic-behind", "title": "go for range slice and goroutine method invocation,the logic behind", "body": "<p>The code is like the following:</p>\n\n<pre><code>package main\n\n    import (\n        \"fmt\"\n        \"time\"\n    )\n\n    type field struct {\n        name string\n    }\n\n    func (p *field) print() {\n        fmt.Println(p.name)\n    }\n\n    func main() {\n        data := []field{{\"one\"},{\"two\"},{\"three\"}}\n        for _,v := range data {\n            go v.print()\n        }\n        time.Sleep(3 * time.Second)\n    }\n</code></pre>\n\n<p>I know that the code is wrong,because the for loop variable is reused in the for-range loop.</p>\n\n<p>When the goroutine has got the chance to launch,the value of <code>v</code> might has been modified. so the print result will be <code>\"three,three,three\"</code>.</p>\n\n<p>But when we modify the data variable into another declaration as:</p>\n\n<pre><code>data := []*field{{\"one\"},{\"two\"},{\"three\"}}\n</code></pre>\n\n<p>the print result will be <code>\"one ,two,three\"</code>.</p>\n\n<p>I didn't get the point of why. Does the pointer make any difference or any different mechanism is on this?</p>\n\n<p>I read this from <a href=\"http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/index.html#range_val_update\" rel=\"nofollow\">this article</a>. But the poster didn't not tell why. Or it's just a incident the output is right.</p>\n"}, {"tags": ["reflection", "go"], "comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1433185151, "post_id": 30576874, "comment_id": 49232138, "body": "...<code>!field.Anonymous</code> or a field reachable only through an anonymous / embedded field, I suppose I should say.   Didn&#39;t consider at first the non-anonymous fields of the embedded struct."}], "answers": [{"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1433184658, "post_id": 30577326, "comment_id": 49231842, "body": "Thanks... as I said, though, the docs are clear and I understand what <code>FieldByIndex()</code> does.  My question is about the <code>Index</code> field of <code>reflect.StructField</code> - see the last two sentences of the question."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1433188942, "post_id": 30577326, "comment_id": 49234322, "body": "@BadZen I just gave you an example of how it&#39;s used for non embedded structs. But you should be fine with using a single index."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": false, "score": 4, "last_activity_date": 1433172352, "creation_date": 1433172352, "answer_id": 30577326, "question_id": 30576874, "link": "https://stackoverflow.com/questions/30576874/go-reflect-field-index-single-index-vs-slice/30577326#30577326", "title": "Go reflect field index - single index vs. slice", "body": "<p>It can refer to fields in embedded or non embedded structs, recursively:</p>\n\n<pre><code>type Foo struct {\n    Bar string\n}\n\ntype Baz struct {\n    Zoo Foo\n}\n\nfunc main() {\n\n    b := Baz{Zoo:Foo{\"foo\"}}\n    v := reflect.ValueOf(b)\n\n    fmt.Println(v.FieldByIndex([]int{0})) //output: &lt;main.Foo Value&gt;\n\n    fmt.Println(v.FieldByIndex([]int{0, 0})) //output: foo\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 4617780, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zFbCmE2Nets/AAAAAAAAAAI/AAAAAAAAABA/ulgrweQAIZo/photo.jpg?sz=128", "display_name": "Zeka", "link": "https://stackoverflow.com/users/4617780/zeka"}, "is_accepted": false, "score": 0, "last_activity_date": 1557230624, "creation_date": 1557230624, "answer_id": 56022213, "question_id": 30576874, "link": "https://stackoverflow.com/questions/30576874/go-reflect-field-index-single-index-vs-slice/56022213#56022213", "title": "Go reflect field index - single index vs. slice", "body": "<p>Here is an example. To answer this question, I've dig into reflect tests.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype (\n    Bar struct {\n        Val string\n    }\n\n    Foo struct {\n        Bar\n    }\n)\n\nfunc main() {\n    t := reflect.TypeOf(Foo{})\n    f, _ := t.FieldByName(\"Val\")\n    fmt.Println(f.Index)         // [0 0]\n}\n</code></pre>\n"}], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1142, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1557230624, "creation_date": 1433170952, "question_id": 30576874, "link": "https://stackoverflow.com/questions/30576874/go-reflect-field-index-single-index-vs-slice", "title": "Go reflect field index - single index vs. slice", "body": "<p><code>reflect.StructField</code> has an <code>Index</code> field that is typed <code>[]int</code>.   The documentation on this is slightly confounding:</p>\n\n<pre><code>    Index     []int     // index sequence for Type.FieldByIndex\n</code></pre>\n\n<p>And of course <code>Type.FieldByIndex</code> follows suit as expected, with the somewhat clearer explanation of its behavior:</p>\n\n<pre><code>    // FieldByIndex returns the nested field corresponding\n    // to the index sequence.  It is equivalent to calling Field\n    // successively for each index i.\n    // It panics if the type's Kind is not Struct.\n    FieldByIndex(index []int) StructField\n</code></pre>\n\n<p>But, there is also <code>Type.Field()</code>:</p>\n\n<pre><code>    // Field returns a struct type's i'th field.\n    // It panics if the type's Kind is not Struct.\n    // It panics if i is not in the range [0, NumField()).\n    Field(i int) StructFiel\n</code></pre>\n\n<p>So the behavior of those respectively is very clear.</p>\n\n<p>My question:   Exactly for which fields / what circumstances will a <code>reflect.StructField</code> have an <code>Index</code> with <code>len(field.Index) &gt; 1</code>?  Is this there to support enumerating embedded fields (reachable through an anonymous field in the parent)?  Does it happen in other cases?  (ie. is it  safe to assume if <code>!field.Anonymous</code>, then we can just use <code>field.Index[0]</code> as an argument to <code>Field(i int)</code>?)</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1433173678, "post_id": 30573899, "comment_id": 49225694, "body": "No offense but I think you should reconsider your design because you should be able to avoid a decision like that at run time or at the very least use a type flag of some sort to avoid this more loose introspective means of deciding how to deserialize. You&#39;re treating data from YOUR db as if it&#39;s from some uncontrollable and unpredictable third party, I recommend against that."}, {"owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1433173851, "post_id": 30573899, "comment_id": 49225806, "body": "@evanmcdonnal thanks for the input. I&#39;ll take it into consideration and if I find a better way to do it I will however, I don&#39;t believe I&#39;m treating t as if it&#39;s from an unpredictable third party. It&#39;s just that the structure of the json documents are not the same and therefore have to be unmarshalled into different structs and I therefore have to figure out what the json looks like before I choose which struct to unmarshal into"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1433174006, "post_id": 30573899, "comment_id": 49225911, "body": "Yes, the json is representing different types. You can store the type info in your database as well and use it to make a 100% conclusive decision about which type it is prior the calling Unmarshal, you&#39;re using unmarshal like it&#39;s a try/catch rather than using type info + select to unmarshal into the correct type with no indeterminate runtime behavior."}], "answers": [{"comments": [{"owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "edited": false, "score": 0, "creation_date": 1433164745, "post_id": 30574518, "comment_id": 49219175, "body": "I&#39;m interested in this answer, but I think you misunderstand the structure of my data. Every one of my documents has a &quot;foo&quot; field (it is the top level namespace of each json document). What I need to determine is the value of the type field when I unmarshal a second time. Can you redo your play.golang.org to show me that?"}, {"owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "edited": false, "score": 0, "creation_date": 1433165540, "post_id": 30574518, "comment_id": 49219748, "body": "but after I unmarshal it into the interface, (and figure out what the value of the type field is), I can&#39;t unmarshal it again into the Bar struct (now that I know the Bar struct would be the appropriate struct), can I? I need to be able to get the document into the appropriate struct"}, {"owner": {"reputation": 1641, "user_id": 3828156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/scFYI.jpg?s=128&g=1", "display_name": "chendesheng", "link": "https://stackoverflow.com/users/3828156/chendesheng"}, "reply_to_user": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "edited": false, "score": 0, "creation_date": 1433165771, "post_id": 30574518, "comment_id": 49219909, "body": "I don&#39;t think you can. If you want use a typed struct object, you need to create the object and copy fields to it."}, {"owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "edited": false, "score": 1, "creation_date": 1433166485, "post_id": 30574518, "comment_id": 49220404, "body": "is it possible to make a copy of the json.RawMessage, unmarshal into the interface as you showed, and then unmarshal the copy itno the struct once you know the type?"}, {"owner": {"reputation": 1641, "user_id": 3828156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/scFYI.jpg?s=128&g=1", "display_name": "chendesheng", "link": "https://stackoverflow.com/users/3828156/chendesheng"}, "reply_to_user": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "edited": false, "score": 1, "creation_date": 1433166816, "post_id": 30574518, "comment_id": 49220637, "body": "Yes, but you can always check the object type by regular expression instead, no need to unmarshal into a interface. What I suggest is the way go handle dynamic json type."}, {"owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "edited": false, "score": 1, "creation_date": 1433167077, "post_id": 30574518, "comment_id": 49220826, "body": "ok, can you update your answer to show how to do both? I&#39;ve given you an upvote and will accept your answer if you can show me. Thank you so much for your assistance."}, {"owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "edited": false, "score": 0, "creation_date": 1433179334, "post_id": 30574518, "comment_id": 49228980, "body": "Thank you for updating your answer with the regular expression (I didn&#39;t notice). I will have a look at it.  By saying that there are two ways to check the struct type, are you saying that copying the json.RawMessage is not a way?"}, {"owner": {"reputation": 5609, "user_id": 1226748, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/RfDKy.jpg?s=128&g=1", "display_name": "Jimmy Obonyo Abor", "link": "https://stackoverflow.com/users/1226748/jimmy-obonyo-abor"}, "edited": false, "score": 0, "creation_date": 1493010675, "post_id": 30574518, "comment_id": 74209828, "body": "This was very helpfull"}], "tags": [], "owner": {"reputation": 1641, "user_id": 3828156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/scFYI.jpg?s=128&g=1", "display_name": "chendesheng", "link": "https://stackoverflow.com/users/3828156/chendesheng"}, "is_accepted": true, "score": 11, "last_activity_date": 1527413179, "last_edit_date": 1527413179, "creation_date": 1433164438, "answer_id": 30574518, "question_id": 30573899, "link": "https://stackoverflow.com/questions/30573899/unmarshal-nested-json-without-knowing-structure/30574518#30574518", "title": "unmarshal nested json without knowing structure", "body": "<p>Two ways to check struct type:</p>\n\n<ol>\n<li>Unmarshal json.RawMessage to a map[string]interface{}</li>\n<li>Use a regular expression to extract type string</li>\n</ol>\n\n<p><a href=\"http://play.golang.org/p/gfP6P4SmaC\" rel=\"noreferrer\">http://play.golang.org/p/gfP6P4SmaC</a></p>\n"}], "owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11916, "favorite_count": 6, "accepted_answer_id": 30574518, "answer_count": 1, "score": 13, "last_activity_date": 1581368450, "creation_date": 1433162832, "last_edit_date": 1581368450, "question_id": 30573899, "link": "https://stackoverflow.com/questions/30573899/unmarshal-nested-json-without-knowing-structure", "title": "unmarshal nested json without knowing structure", "body": "<p>I am using a key value store as the backend for my golang application, with the date serving as the key (to keep entries sorted) and json documents as the values.  The top level namespace of the json (<code>foo</code>) and the <code>type</code> and <code>date</code>  are present in each json document that I'm storing but otherwise there are some differences (especially with respect to some nested json data), so when keyI'm pulling from the database, I don't really know what I'm pulling out at any time that I'm looping through . Here is a sample of the json data </p>\n\n<pre><code>{\n  \"foo\": {\n    \"id\": \"124\",\n    \"type\": \"baz\",\n    \"rawdata\": [\n      123,\n      345,\n      345\n    ],\n    \"epoch\": \"1433120656704\"\n  }\n}\n\n{\n  \"foo\": {\n    \"id\": \"234\",\n    \"type\": \"bar\",\n    \"rawdata\": [\n      {\n        \"key\": \"dog\",\n        \"values\": [\n          123,\n          234\n        ]\n      },\n      {\n        \"key\": \"cat\",\n        \"values\": [\n          23,\n          45\n        ]\n      }\n    ],\n    \"epoch\": \"1433120656705\"\n  }\n}\n\n\n</code></pre>\n\n<p>when I'm pulling from the database, the first thing I do is unmarshal each entry into a <code>map[string]*json.RawMessage</code> to deal with the <code>foo</code> namespace</p>\n\n<pre><code>//as I'm looping through the entries in the database\n   var objmap map[string]*json.RawMessage\n   if err := json.Unmarshal(dbvalue, &amp;objmap); err !=nil{\n       return err\n   }\n</code></pre>\n\n<p>which I do thanks to this <a href=\"https://stackoverflow.com/questions/11066946/partly-json-unmarshal-into-a-map-in-go\">SO answer</a></p>\n\n<p>However, unlike in that SO answer, when I have to unmarshal again whatever is contained under the <code>foo</code> namespace I don't know which struct to unmarshal into</p>\n\n<pre><code>   if err :=json.Unmarshal(*objmap[\"foo\"], &amp;bazorbar; err != nil{\n         return err\n   }\n\n type Baz struct{\n  Id string `json:\"id\"`\n  Type string `json:\"type\"`\n  RawData []int `json:\"rawdata\"`\n  Epoch string  `json:\"epoch\"`\n}\n\ntype Bar struct{\n  Id string `json:\"id\"`\n  Type string `json:\"type\"`\n  RawData []*Qux `json:\"rawdata\"`\n  Epoch string  `json:\"epoch\"`\n}\n//nested inside Bar\ntype Qux struct{\n  Key string `json:\"key\"`\n  Values []int `json:\"values`\n}\n</code></pre>\n\n<p>Two part Question: </p>\n\n<ol>\n<li>Is there a way to avoid repeated unmarshals (or is that something I shouldn't even care about)</li>\n<li>how can I figure out which struct to unmarshal the json.RawMessage into (which also allows for nested json data)</li>\n</ol>\n\n<p><strong>Update:</strong> the initial answer provided by @chendesheng enables me to find out the type but not to unmarshal again into a struct once that type has been determined (which I need to do), so based on a conversation in the comments to his/her answer, I would be interested in either of these possibilities</p>\n\n<p>a) make a copy of the json.RawMessage, unmarshal into the interface as you shown (by chendesheng's answer), and then unmarshal the copy itno the struct once you know the type (from having unmarshaled into the interface)?</p>\n\n<p>b) use a regular expression to determine the type and then unmarshal into a struct of that type once it's known </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "edited": false, "score": 0, "creation_date": 1433158193, "post_id": 30572348, "comment_id": 49214705, "body": "Isnt this is same package? Both have package &#39;main&#39; at top, and lies within subdirectory"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "edited": false, "score": 0, "creation_date": 1433158542, "post_id": 30572348, "comment_id": 49214922, "body": "@Avdept <code>main</code> packages from multiple folders are not compiled into the same package. Your <code>routes.go</code> should be declared in package <code>config</code> based on the folder it is in."}, {"owner": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "edited": false, "score": 0, "creation_date": 1433159131, "post_id": 30572348, "comment_id": 49215278, "body": "does that means, if i want to have <code>autoimport</code> files, they must be in same directory as file with <code>main</code> func?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "edited": false, "score": 0, "creation_date": 1433159458, "post_id": 30572348, "comment_id": 49215473, "body": "@Avdept Different files of the same package have to be put into the same folder. And different files of the same package can use everything from the package without importing it and without using the package name (doesn&#39;t matter in which file it is defined). This is also true for unexported identifiers. From an another package you can only access exported identifiers (their name must start with a capital letter)."}, {"owner": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "edited": false, "score": 0, "creation_date": 1433159541, "post_id": 30572348, "comment_id": 49215520, "body": "But in my case server.go and config/routes.go are parts of same package"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "edited": false, "score": 0, "creation_date": 1433159698, "post_id": 30572348, "comment_id": 49215623, "body": "@Avdept The <code>main</code> package is special. Files which are marked to be part of package <code>main</code> will be compiled into executable binaries. If files are in <i>different</i> folders, they will end up in different executable files, not the same. If the package is not the special <code>main</code>, then if files are not in the same folder, they are <b>not</b> part of the same package. The package is not just the last folder name, it is the full name starting from the source folder (which is excluded)."}, {"owner": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "edited": false, "score": 0, "creation_date": 1433161077, "post_id": 30572348, "comment_id": 49216485, "body": "check ps in my question please"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "edited": false, "score": 0, "creation_date": 1433161576, "post_id": 30572348, "comment_id": 49216877, "body": "@Avdept If you move both files into the same folder, you have to pass both files to <code>go run</code> e.g. <code>go run server.go routes.go</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1433309306, "last_edit_date": 1592644375, "creation_date": 1433158124, "answer_id": 30572348, "question_id": 30572146, "link": "https://stackoverflow.com/questions/30572146/getting-access-to-functions-from-subdirectories/30572348#30572348", "title": "Getting access to functions from subdirectories", "body": "<p>In order to use a function defined in another package, first you have to import it:</p>\n<pre><code>import &quot;myblog/config&quot;\n</code></pre>\n<p>And after that you have to refer to it by the package name:</p>\n<pre><code>config.Register_routes(r)\n</code></pre>\n<p>Also the package name should reflect the folder name in which it is defined. In your routes.go the package should be <code>config</code>. Package <code>main</code> is special, the <code>main</code> package will be compiled into an executable binary (it is the entry point of the program). See <a href=\"https://golang.org/ref/spec#Program_execution\" rel=\"nofollow noreferrer\">Program Execution</a> in the language specification.</p>\n<p>From the page you linked: <a href=\"https://golang.org/doc/code.html#PackageNames\" rel=\"nofollow noreferrer\">Package names</a>:</p>\n<blockquote>\n<p>Go's convention is that the package name is the last element of the import path: the package imported as <code>&quot;crypto/rot13&quot;</code> should be named <code>rot13</code>.</p>\n<p>Executable commands must always use package <code>main</code>.</p>\n<p>There is no requirement that package names be unique across all packages linked into a single binary, only that the import paths (their full file names) be unique.</p>\n</blockquote>\n<p>Check out the blog post <a href=\"https://blog.golang.org/package-names\" rel=\"nofollow noreferrer\">Package names</a> for a detailed guideline.</p>\n<p>Note that different files of the same package have to be put into the same folder. And different files of the same package can use everything from the package without importing it and without using the package name (doesn't matter in which file it is defined). This is also true for unexported identifiers. From another package you can only access exported identifiers (their name must start with a capital letter).</p>\n<p>Also the go naming convention is to used mixed caps rather than underscores to write multiword names, see <a href=\"https://golang.org/doc/effective_go.html#mixed-caps\" rel=\"nofollow noreferrer\">Effective Go / MixedCaps</a>. So the function should be named <code>RegisterRoutes</code> but this is not a requirement.</p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1433176284, "post_id": 30572397, "comment_id": 49227245, "body": "This is a bad idea. Although there may be a way to use <code>go run</code> (or calling the compiler and linker manually for that matter) to work around it, the issue is laying things out in a way that is non-idiomatic and <b>will not work with the <code>go</code> tools</b> (e.g. <code>go build</code>, <code>go install</code>, <code>go test</code>, <code>go install</code> will not work with such a layout)."}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 0, "last_activity_date": 1433158271, "creation_date": 1433158271, "answer_id": 30572397, "question_id": 30572146, "link": "https://stackoverflow.com/questions/30572146/getting-access-to-functions-from-subdirectories/30572397#30572397", "title": "Getting access to functions from subdirectories", "body": "<p>From the documentation on the <a href=\"https://golang.org/cmd/go/#hdr-Compile_and_run_Go_program\" rel=\"nofollow\">go command</a>:</p>\n\n<blockquote>\n  <p><code>go run [build flags] [-exec xprog] gofiles... [arguments...]</code></p>\n  \n  <p>Run compiles and runs the main package comprising the named Go source\n  files.</p>\n</blockquote>\n\n<p>You need to give the name of the second file to the <code>go run</code> command to include it.</p>\n\n<pre><code>go run server.go config/routes.go\n</code></pre>\n"}], "owner": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 396, "favorite_count": 0, "accepted_answer_id": 30572348, "answer_count": 2, "score": -1, "last_activity_date": 1433309306, "creation_date": 1433157513, "last_edit_date": 1433261100, "question_id": 30572146, "link": "https://stackoverflow.com/questions/30572146/getting-access-to-functions-from-subdirectories", "title": "Getting access to functions from subdirectories", "body": "<p>I'm writing small app following <a href=\"http://golang.org/doc/code.html\" rel=\"nofollow\">http://golang.org/doc/code.html</a></p>\n\n<p>My directory tree looks like</p>\n\n<pre><code>-blog\n  -bin\n  -pkg\n  -src\n    -github.com\n      -packages_that_i_imported\n    -myblog\n      -config\n        routes.go\n      server.go\n</code></pre>\n\n<p>my <code>server.go</code> file contains following code</p>\n\n<pre><code>package main\n\nimport \"...\" //ommited imports\n\n\nfunc main(){\n    r:= mux.InitRoutes()  //function from imported package\n    Register_routes(r)  //function from routes.go\n}\n</code></pre>\n\n<p>And my routes.go</p>\n\n<pre><code>package main\n\nfunc Register_routes(r *Router){\n  r.addRoute(\"test\", \"test\", \"test)\n}\n</code></pre>\n\n<p>But after I do <code>go run server.go</code>\nI'm getting following error</p>\n\n<pre><code>$ go run server.go \n# command-line-arguments\n./server.go:10: undefined: Register_routes\n</code></pre>\n\n<p>GOPATH variable points to my <code>/blog</code> folder</p>\n\n<p>What am I missing? Why go doesn't it see files in subdirectories?</p>\n\n<p>P.S. config/routes.go is part of server.go package</p>\n\n<p>P.P.S I have moved routes.go to the same folder as server.go, but the error is still present</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 1, "last_activity_date": 1433149545, "creation_date": 1433149545, "answer_id": 30569560, "question_id": 30569005, "link": "https://stackoverflow.com/questions/30569005/reading-database-rows-into-map-and-appending-to-a-slice-of-maps/30569560#30569560", "title": "Reading database rows into map and appending to a slice of maps", "body": "<p>This is because what you are storing in the slice is a pointer to a map rather than a copy of the map.</p>\n\n<p>From <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow\">Go maps in action:</a></p>\n\n<blockquote>\n  <p>Map types are reference types, like pointers or slices...</p>\n</blockquote>\n\n<p>Since you create the map outside the loop that updates it, you keep overwriting the data in the map with new data and are appending a pointer to the same map to the slice each time. Thus you get multiple copies of the same thing in your slice (being the last record read from your table).</p>\n\n<p>To handle, move <code>var myMap = make(map[string]interface{})</code> into the <code>for rows.Next()</code> loop so a new map is create on each iteration and then appended to the slice.</p>\n"}], "owner": {"reputation": 2482, "user_id": 2605049, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/EgmcV.png?s=128&g=1", "display_name": "s&#231;u&#231;u", "link": "https://stackoverflow.com/users/2605049/s%c3%a7u%c3%a7u"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 768, "favorite_count": 0, "accepted_answer_id": 30569560, "answer_count": 1, "score": 2, "last_activity_date": 1433149545, "creation_date": 1433147812, "last_edit_date": 1433148867, "question_id": 30569005, "link": "https://stackoverflow.com/questions/30569005/reading-database-rows-into-map-and-appending-to-a-slice-of-maps", "title": "Reading database rows into map and appending to a slice of maps", "body": "<p>I am trying to use maps and slice of those maps to store rows returned from a database query. But what I get in every iteration of the rows.Next() and in final is the slice of the one same row from the query. It seems the problem is related to the memory place being same I store the <code>cols</code>, yet I could not resolve it until now.</p>\n\n<p>What is the thing am I missing here:</p>\n\n<p>The source code is as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    _ \"github.com/lib/pq\"\n\n    \"fmt\"\n    \"log\"\n\n    \"reflect\"\n)\nvar myMap = make(map[string]interface{})\nvar mySlice = make([]map[string]interface{}, 0)\n\nfunc main(){\n    fmt.Println(\"this is my go playground.\")\n\n    // DB Connection-\n    db, err := sql.Open(\"postgres\", \"user=postgres dbname=proj2-dbcruddb-dev password=12345 sslmode=disable\")\n    if err != nil {\n        log.Fatalln(err)\n    }\n    rows, err := db.Query(\"SELECT id, username, password FROM userstable\")\n    defer rows.Close()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    colNames, err := rows.Columns()\n    if err != nil {\n        log.Fatal(err)\n    }\n    cols := make([]interface{}, len(colNames))\n    colPtrs := make([]interface{}, len(colNames))\n    for i := 0; i &lt; len(colNames); i++ {\n        colPtrs[i] = &amp;cols[i]\n    }\n\n    for rows.Next() {\n        err = rows.Scan(colPtrs...)\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Println(\"cols: \", cols)\n\n        for i, col := range cols {\n            myMap[colNames[i]] = col\n        }\n        mySlice = append(mySlice, myMap)\n\n        // Do something with the map\n        for key, val := range myMap {\n            fmt.Println(\"Key:\", key, \"Value:\", val, \"Value Type:\", reflect.TypeOf(val))\n        }\n        fmt.Println(\"myMap: \", myMap)\n        fmt.Println(\"mySlice: \", mySlice)\n\n    }\n    fmt.Println(mySlice)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 10501, "user_id": 1180968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tsPVx.png?s=128&g=1", "display_name": "Sajan Chandran", "link": "https://stackoverflow.com/users/1180968/sajan-chandran"}, "edited": false, "score": 0, "creation_date": 1433148282, "post_id": 30568318, "comment_id": 49208658, "body": "You can look for <code>td</code> with no child <code>a</code> anchor element."}, {"owner": {"reputation": 119, "user_id": 4883216, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/73a6db6ae7d0691b4448877e3f607ee4?s=128&d=identicon&r=PG&f=1", "display_name": "Elegant Metal", "link": "https://stackoverflow.com/users/4883216/elegant-metal"}, "reply_to_user": {"reputation": 10501, "user_id": 1180968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tsPVx.png?s=128&g=1", "display_name": "Sajan Chandran", "link": "https://stackoverflow.com/users/1180968/sajan-chandran"}, "edited": false, "score": 0, "creation_date": 1433148568, "post_id": 30568318, "comment_id": 49208823, "body": "Ok I can try and figure out how to do that. I just tried slicing the title to get the 4 first characters because they all start with &quot;&lt;img&quot; and only displaying the title if it didn&#39;t start with &quot;&lt;img&quot;. Either this idea just doesn&#39;t work or I just simply don&#39;t know the syntax"}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 4883216, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/73a6db6ae7d0691b4448877e3f607ee4?s=128&d=identicon&r=PG&f=1", "display_name": "Elegant Metal", "link": "https://stackoverflow.com/users/4883216/elegant-metal"}, "edited": false, "score": 0, "creation_date": 1433188596, "post_id": 30569835, "comment_id": 49234127, "body": "Oh ok I see thank you so much! these are both extremely helpful!"}, {"owner": {"reputation": 725, "user_id": 1340135, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/19c77ec6e88f9ee85488d72fbeef0b64?s=128&d=identicon&r=PG", "display_name": "Kaah", "link": "https://stackoverflow.com/users/1340135/kaah"}, "edited": false, "score": 0, "creation_date": 1496097198, "post_id": 30569835, "comment_id": 75510601, "body": "@icza How can this be modified to be able to handel empty <code>&lt;tr&gt;</code>? When I have  <code>&lt;tr&gt;&lt;&#47;tr&gt;&lt;tr&gt;&lt;&#47;tr&gt;</code> I get this error: <code>panic: runtime error: index out of range</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 725, "user_id": 1340135, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/19c77ec6e88f9ee85488d72fbeef0b64?s=128&d=identicon&r=PG", "display_name": "Kaah", "link": "https://stackoverflow.com/users/1340135/kaah"}, "edited": false, "score": 0, "creation_date": 1496101057, "post_id": 30569835, "comment_id": 75511454, "body": "@Kaah I don&#39;t see your code and I don&#39;t know where that panic occurs. Best would be to post that as a new question."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1485534735, "last_edit_date": 1485534735, "creation_date": 1433150486, "answer_id": 30569835, "question_id": 30568318, "link": "https://stackoverflow.com/questions/30568318/golang-web-scraper-ignoring-specific-cells-of-a-table/30569835#30569835", "title": "golang web scraper, ignoring specific cells of a table", "body": "<p>Let's clear some things. A <a href=\"http://godoc.org/github.com/PuerkitoBio/goquery#Selection\" rel=\"nofollow noreferrer\"><code>Selection</code></a> is a collection of nodes matching some criteria.</p>\n\n<p><code>doc.Find()</code> is <a href=\"http://godoc.org/github.com/PuerkitoBio/goquery#Selection.Find\" rel=\"nofollow noreferrer\"><code>Selection.Find()</code></a> which returns a new <code>Selection</code> containing the elements matching the criteria. And <a href=\"http://godoc.org/github.com/PuerkitoBio/goquery#Selection.Each\" rel=\"nofollow noreferrer\"><code>Selection.Each()</code></a> iterations over each of the elements of the collection and calls the function value passed to it.</p>\n\n<p>So in your case <code>Find(\"tbody\")</code> will find all <code>tbody</code> elements, <code>Each()</code> will iterate over all <code>tbody</code> elements and call your anonymous function.</p>\n\n<p>Inside your anonymous function <code>s</code> is a <code>Selection</code> of one <code>tbody</code> element. You call <code>s.Find(\"td\")</code> which will return a new <code>Selection</code> which will contain <strong>all</strong> the <code>td</code> elements of the current table. So when you call <a href=\"http://godoc.org/github.com/PuerkitoBio/goquery#Selection.Text\" rel=\"nofollow noreferrer\"><code>Text()</code></a> on this, it will be the combined text contents of each <code>td</code> elements including their descendants. This is not what you want.</p>\n\n<p>What you should do is call another <code>Each()</code> on the <code>Selection</code> returned by <code>s.Find(\"td\")</code>. And check if the <code>Selection</code> passed to the 2nd anonymous function has an <code>img</code> child.</p>\n\n<p>Example code:</p>\n\n<pre><code>doc.Find(\"tbody\").Each(func(i int, s *goquery.Selection) {\n    // s here is a tbody element\n    s.Find(\"td\").Each(func(j int, s2 *goquery.Selection) {\n        // s2 here is a td element\n        if s3 := s2.Find(\"img\"); s3 != nil &amp;&amp; s3.Length() &gt; 0 {\n            return // This TD has at least one img child, skip it\n        }\n        fmt.Printf(s2.Text())\n    })\n})\n</code></pre>\n\n<p>Alternatively you could search <code>tr</code> elements and skip the first <code>td</code> child of each row by checking if the index passed to the 3rd anonymous function is <code>0</code> (first child), something like this:</p>\n\n<pre><code>doc.Find(\"tbody\").Each(func(i int, s *goquery.Selection) {\n    // s here is a tbody element\n    s.Find(\"tr\").Each(func(j int, s2 *goquery.Selection) {\n        // s2 here is a tr element\n        s2.Find(\"td\").Each(func(k int, s3 *goquery.Selection) {\n            // s3 here is a td element\n            if k == 0 {\n                return // This is the first TD in the row\n            }\n            fmt.Printf(s3.Text())\n        })\n    })\n})\n</code></pre>\n"}], "owner": {"reputation": 119, "user_id": 4883216, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/73a6db6ae7d0691b4448877e3f607ee4?s=128&d=identicon&r=PG&f=1", "display_name": "Elegant Metal", "link": "https://stackoverflow.com/users/4883216/elegant-metal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 719, "favorite_count": 0, "accepted_answer_id": 30569835, "answer_count": 1, "score": 3, "last_activity_date": 1485534735, "creation_date": 1433145209, "last_edit_date": 1433148305, "question_id": 30568318, "link": "https://stackoverflow.com/questions/30568318/golang-web-scraper-ignoring-specific-cells-of-a-table", "title": "golang web scraper, ignoring specific cells of a table", "body": "<p>I'm working on a small web scraper to just get a feel of golang. It currently is grabbing info off of a wiki from a table and then grabbing info specifically from cells. I don't currently have the code on me (not currently at home) but it looks fairly similar to this:</p>\n\n<pre><code>    func main() {\n        doc, err := goquery.NewDocument(\"http://monsterhunter.wikia.com/wiki/MH4:_Item_List\")\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        doc.Find(\"tbody\").Each(func(i int, s *goquery.Selection) {\n                title := s.Find(\"td\").Text()\n                fmt.Printf(title)\n        })\n}\n</code></pre>\n\n<p>The issue is that on this website the first cell is an image, so it prints the image source which I don't want. How can I ignore the first cell in each row of the large table?</p>\n"}, {"tags": ["pointers", "methods", "go"], "answers": [{"tags": [], "owner": {"reputation": 1081, "user_id": 1976730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8f2d3471083d1569b698ff42ca5f303?s=128&d=identicon&r=PG", "display_name": "sqweek", "link": "https://stackoverflow.com/users/1976730/sqweek"}, "is_accepted": false, "score": 0, "last_activity_date": 1433136047, "creation_date": 1433136047, "answer_id": 30566077, "question_id": 30565818, "link": "https://stackoverflow.com/questions/30565818/go-array-for-method/30566077#30566077", "title": "Go array for method", "body": "<p>It works fine if you define the array/slice variable as the receiver type:</p>\n\n<pre><code>type arrayType [3]string\nvar array arrayType = [3]string{\"A\", \"B\", \"C\"}   # note \"arrayType\" here\nfunc (m *arrayType) change() { m[1] = \"W\" }\nfunc main() {\n    array.change()\n}\n</code></pre>\n\n<p>I'm not sure why the typecasting behaves like it does.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1471849510, "last_edit_date": 1471849510, "creation_date": 1433136809, "answer_id": 30566223, "question_id": 30565818, "link": "https://stackoverflow.com/questions/30565818/go-array-for-method/30566223#30566223", "title": "Go array for method", "body": "<p>The <em>receiver</em> type of a method cannot be a pointer to a pointer, but that is what you wrote:</p>\n\n<pre><code>func (m *arrayTypePt) change() { m[1] = \"W\" }\n</code></pre>\n\n<p><code>arrayTypePt</code> is already a pointer <code>*[3]string</code>. Quoting from the <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow\">language specification</a>:</p>\n\n<blockquote>\n  <p>[The receiver] type must be of the form <code>T</code> or <code>*T</code> (possibly using parentheses) where <code>T</code> is a type name. The type denoted by <code>T</code> is called the receiver base type; <strong>it must not be a pointer or interface type</strong> and it must be declared in the same package as the method.</p>\n</blockquote>\n\n<p>Your 2nd error (<em>\"type *arrayTypePt does not support indexing\"</em>) is also a result of this (<code>m</code> is a pointer to pointer, that's why you can't index it; if it would only be a pointer to array or slice, the pointer indirection would be automatic).</p>\n\n<p>Your 3rd error is simply a typo, you declared a method named <code>change()</code> and not <code>changeArray4()</code>.</p>\n\n<p>So you should only name the non-pointer array type:</p>\n\n<pre><code>type arrayType [3]string\n</code></pre>\n\n<p>And you can declare your array using directly this type:</p>\n\n<pre><code>var array = arrayType{\"A\", \"B\", \"C\"}\n</code></pre>\n\n<p>And you can simply call its <code>change()</code> method:</p>\n\n<pre><code>array.change()\n</code></pre>\n\n<p>The address of the array will be taken automatically (because the <code>change()</code> method has a pointer receiver but the <code>array</code> variable itself is not a pointer).</p>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/wXV1-Vyc4c\" rel=\"nofollow\">Go Playground</a>.</p>\n\n<h3>Notes / Alternatives</h3>\n\n<p>If you would want your <code>array</code> variable to be explicitly <code>[3]string</code>, you could still make it work by converting it to <code>arrayType</code>, setting it to another variable, and <code>change()</code> can be called on this (because being a variable its address can be taken - while the address of a conversion like <code>arrayType(arr)</code> cannot):</p>\n\n<pre><code>arr2 := [3]string{\"A\", \"B\", \"C\"}\narr3 := arrayType(arr2)\narr3.change()\n</code></pre>\n\n<p>Or if you would declare your variable to be a pointer to type <code>[3]string</code>, you could save the required additional variable (which was only required so we were able to take its address):</p>\n\n<pre><code>arr4 := new([3]string)\n*arr4 = [3]string{\"A\", \"B\", \"C\"}\n((*arrayType)(arr4)).change()\n</code></pre>\n\n<p>Try these variants too on the <a href=\"http://play.golang.org/p/HPvm2k7cDj\" rel=\"nofollow\">Go Playground</a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4211028"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1200, "favorite_count": 0, "accepted_answer_id": 30566223, "answer_count": 2, "score": 0, "last_activity_date": 1471849510, "creation_date": 1433134328, "last_edit_date": 1433134567, "question_id": 30565818, "link": "https://stackoverflow.com/questions/30565818/go-array-for-method", "title": "Go array for method", "body": "<p>Can I use array and its pointer for Go methods?</p>\n\n<p>I have the following code:</p>\n\n<pre><code>var array = [3]string{\"A\", \"B\", \"C\"}\ntype arrayTypePt *[3]string\nfunc (m *arrayTypePt) change() { m[1] = \"W\" }\nfunc main() {\n    (arrayTypePt(&amp;array)).changeArray4()\n}\n</code></pre>\n\n<p>But this code: <a href=\"http://play.golang.org/p/mXDEhmA9wk\" rel=\"nofollow\">http://play.golang.org/p/mXDEhmA9wk</a></p>\n\n<p>give me an error of:</p>\n\n<pre><code>invalid receiver type *arrayTypePt (arrayTypePt is a pointer type)\ninvalid operation: m[1] (type *arrayTypePt does not support indexing)\narrayTypePt(&amp;array).changeArray4 undefined (type arrayTypePt has no field or method changeArray4)\n</code></pre>\n\n<p>I get the same error when I try this with slice.\nWhy I cannot do this in method?</p>\n"}, {"tags": ["go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "edited": false, "score": 0, "creation_date": 1433163841, "post_id": 30573485, "comment_id": 49218517, "body": "Oops, not using the mux router, was last minute attempt to work around the problem, but it looks like I didn&#39;t undo far back enough before asking the question."}, {"owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "edited": false, "score": 0, "creation_date": 1433164411, "post_id": 30573485, "comment_id": 49218935, "body": "I was unaware that context played a part.  Not using the mux router and trimming off the prefix, like you did in the last example, was the way I wanted to go but didn&#39;t due to the need to match the urls with a regex. Maybe, as you suggested, going that route would make things much cleaner. Thanks for the help"}], "tags": [], "owner": {"reputation": 3027, "user_id": 560382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1741fdf36945df8f3e26c4f1abd24cad?s=128&d=identicon&r=PG", "display_name": "Alvivi", "link": "https://stackoverflow.com/users/560382/alvivi"}, "is_accepted": true, "score": 5, "last_activity_date": 1433161634, "creation_date": 1433161634, "answer_id": 30573485, "question_id": 30565518, "link": "https://stackoverflow.com/questions/30565518/mux-vars-is-empty-when-using-httputil-reverseproxy/30573485#30573485", "title": "mux.Vars is empty when using httputil.ReverseProxy", "body": "<p>You have two different problems here.</p>\n\n<p>The first one, you are not using a <code>mux.Router</code>, so <code>gorilla/mux</code> has not the opportunity to pre-process your request.  In other words, the requests are going directly from <code>http</code> package to your reverse proxies. This issue has an easy fix:</p>\n\n<pre><code>r := mux.NewRouter()\nfor _, route := range routes {\n    r.Handle(route.match, NewProxy(&amp;route))\n}\nhttp.Handle(\"/\", r)\n</code></pre>\n\n<p>The second problem is more tricky than the first one. This issue is related to how is <code>mux</code> package implemented. If you look <code>mux.Vars()</code> implementation, you will see that it uses something called <code>Context</code>. A <code>Context</code>, as described in the <a href=\"http://www.gorillatoolkit.org/pkg/context\">official documentation</a>, is something that stores values shared during a request lifetime. A simplified Context implementation will be: </p>\n\n<pre><code>type Context map[*http.Request]interface{}\n\nfunc (c Context) Set(req *http.Request, v interface{}) {\n    c[req] = v\n}\n\nfunc (c Context) Get(req *http.Request) interface{} {\n    return c[req]\n}\n</code></pre>\n\n<p>As you see, given a <code>http.Request</code>, we can store values in a context. Later we can retrieve these values using the same <code>Context</code> and the same <code>http.Request</code>. <code>mux</code> uses a global <code>Context</code> to store the vars parsed in routing process so that you can use the standard <code>http.request</code>. But, because <code>httputil.ReverseProxy</code> passes a copy of the actual request and <code>Context</code> links values by request, this new <code>Request</code> has no values in the <code>Context</code>.</p>\n\n<p>To fix it, you can implement your own <code>ReverseProxy</code> based on <code>httputil.ReverseProxy</code>:</p>\n\n<pre><code>type MyReverseProxy struct {\n    httputil.ReverseProxy\n    Director func(inr, outr *http.Request)\n}\n\nfunc (p *MyReverseProxy) ServeHTTP(rw http.ResponseWriter, inr *http.Request) {\n    p.ReverseProxy.Director = func(outr *http.Request) {\n        p.Director(inr, outr)\n    }\n    p.ReverseProxy.ServeHTTP(rw, inr)\n}\n\nfunc NewProxy(r *route) http.Handler {\n    director := func(inr, outr *http.Request) {\n        out, _ := url.Parse(r.base)\n\n        outr.URL.Scheme = out.Scheme\n        outr.URL.Host = out.Host\n        outr.URL.Path = out.Path + \"/\" + mux.Vars(inr)[\"path\"] \n\n        log.Printf(\"IN VARS: %#v\\n\", mux.Vars(inr)) // Now inr has proper vars\n        log.Printf(\"OUT VARS: %#v\\n\", mux.Vars(outr))\n    }\n    return &amp;MyReverseProxy{Director: director}\n</code></pre>\n\n<p>You can even use <code>context</code> and keep <code>Director</code> declaration: </p>\n\n<pre><code>type MyReverseProxy struct {\n    httputil.ReverseProxy\n    Director func(req *http.Request)\n}\n\nfunc (p *MyReverseProxy) ServeHTTP(rw http.ResponseWriter, inr *http.Request) {\n    p.ReverseProxy.Director = func(outr *http.Request) {\n        context.Set(outr, \"in_req\", inr)\n        p.Director(outr)\n    }\n    p.ReverseProxy.ServeHTTP(rw, inr)\n}\n\nfunc NewProxy(r *route) http.Handler {\n    director := func(outr *http.Request) {\n        out, _ := url.Parse(r.base)\n\n        inr := context.Get(outr, \"in_req\").(*http.Request)\n        outr.URL.Scheme = out.Scheme\n        outr.URL.Host = out.Host\n        outr.URL.Path = out.Path + \"/\" + mux.Vars(inr)[\"path\"]\n\n        log.Printf(\"IN VARS: %#v\\n\", mux.Vars(inr)) // Now inr has proper vars\n        log.Printf(\"OUT VARS: %#v\\n\", mux.Vars(outr))\n    }\n    return &amp;MyReverseProxy{Director: director}\n}\n</code></pre>\n\n<p>Both implementations seem tricky to me. They have to change <code>httputil.ReverseProxy</code>'s <code>Director</code> in every call. So, I probably accept that <code>mux</code> is not a good choice here, and instead I will use some simpler solution: </p>\n\n<pre><code>var routes = []route{\n    route{match: \"/api/\", base: \"https://api.bar.com/5\"},\n    route{match: \"/sales/\", base: \"https://sales.bar.com/3\"},\n}\n\nfunc NewProxy(r *route) http.Handler {\n    director := func(req *http.Request) {\n        out, _ := url.Parse(r.base)\n\n        req.URL.Scheme = out.Scheme\n        req.URL.Host = out.Host\n        req.URL.Path = out.Path + \"/\" + strings.TrimPrefix(req.URL.Path, r.match)\n    }\n    return &amp;httputil.ReverseProxy{Director: director}\n}\n</code></pre>\n\n<p>You can read <a href=\"https://github.com/gorilla/mux/blob/master/regexp.go\"><code>mux</code> source code</a> to implement a complex solution based on regular expressions.</p>\n"}], "owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 814, "favorite_count": 0, "accepted_answer_id": 30573485, "answer_count": 1, "score": 3, "last_activity_date": 1433161634, "creation_date": 1433131848, "question_id": 30565518, "link": "https://stackoverflow.com/questions/30565518/mux-vars-is-empty-when-using-httputil-reverseproxy", "title": "mux.Vars is empty when using httputil.ReverseProxy", "body": "<p>I am trying to use gorilla mux and httputil.ReverseProxy together, but when trying to get the mux.Vars it is empty. According to <a href=\"https://golang.org/src/net/http/httputil/reverseproxy.go?s=2744:2819#L93\" rel=\"nofollow\">https://golang.org/src/net/http/httputil/reverseproxy.go?s=2744:2819#L93</a> it seems like the http.Request pointer is a shallow copy of the original request, which should still work.</p>\n\n<p>Any ideas?</p>\n\n<p><a href=\"https://play.golang.org/p/JpjNvEMIFB\" rel=\"nofollow\">https://play.golang.org/p/JpjNvEMIFB</a></p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gorilla/mux\"\n    \"log\"\n    \"net/http\"\n    \"net/http/httputil\"\n    \"net/url\"\n)\n\ntype route struct {\n    match string\n    base  string\n}\n\nvar routes = []route{\n    // proxy http://localhost:3000/api/foo/bar =&gt; https://api.bar.com/5/foo/bar\n    route{match: \"/api/{path}\", base: \"https://api.bar.com/5\"},\n    route{match: \"/sales/{path}\", base: \"https://sales.bar.com/3\"},\n}\n\nfunc NewProxy(r *route) http.Handler {\n    director := func(req *http.Request) {\n        out, _ := url.Parse(r.base)\n\n        req.URL.Scheme = out.Scheme\n        req.URL.Host = out.Host\n        req.URL.Path = out.Path + \"/\" + mux.Vars(req)[\"path\"] // mux Vars are empty here\n    }\n    return &amp;httputil.ReverseProxy{Director: director}\n}\n\nfunc main() {\n    for _, route := range routes {\n        http.Handle(route.match, NewProxy(&amp;route))\n    }\n\n    log.Println(\"Listening on port 8080\")\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n"}, {"tags": ["linux", "go", "network-programming", "udp"], "answers": [{"comments": [{"owner": {"reputation": 602, "user_id": 2085627, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/E86RS.jpg?s=128&g=1", "display_name": "Carson McNeil", "link": "https://stackoverflow.com/users/2085627/carson-mcneil"}, "edited": false, "score": 0, "creation_date": 1433113322, "post_id": 30563546, "comment_id": 49198328, "body": "Yep. Wow, that was a big hole in my understanding of IP. Thanks!"}], "tags": [], "owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "is_accepted": false, "score": 1, "last_activity_date": 1433112970, "creation_date": 1433112970, "answer_id": 30563546, "question_id": 30563473, "link": "https://stackoverflow.com/questions/30563473/golang-udp-server-only-recieving-locally-sent-packets/30563546#30563546", "title": "Golang UDP Server only recieving locally sent packets", "body": "<p>It's doing what you told it to do: listen at 127.0.0.1. If you want it to listen at all interfaces, you have to specify 0.0.0.0.</p>\n\n<p>Don't ask me how that's done in Go.</p>\n"}, {"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 3, "last_activity_date": 1433113357, "creation_date": 1433113357, "answer_id": 30563601, "question_id": 30563473, "link": "https://stackoverflow.com/questions/30563473/golang-udp-server-only-recieving-locally-sent-packets/30563601#30563601", "title": "Golang UDP Server only recieving locally sent packets", "body": "<p>Just listen on any address, you're listening on localhost only.</p>\n\n<pre><code>ServerAddr, err := net.ResolveUDPAddr(\"udp\", \":666\")\n</code></pre>\n"}], "owner": {"reputation": 602, "user_id": 2085627, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/E86RS.jpg?s=128&g=1", "display_name": "Carson McNeil", "link": "https://stackoverflow.com/users/2085627/carson-mcneil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1266, "favorite_count": 0, "accepted_answer_id": 30563601, "answer_count": 2, "score": 1, "last_activity_date": 1433113357, "creation_date": 1433112268, "question_id": 30563473, "link": "https://stackoverflow.com/questions/30563473/golang-udp-server-only-recieving-locally-sent-packets", "title": "Golang UDP Server only recieving locally sent packets", "body": "<p>I've written a UDP Server in Go(listens on port 666), and it seems to be only receiving packets that were sent locally. To confirm traffic, I have been using:</p>\n\n<pre><code>sudo tcpdump -n udp dst port 666\n</code></pre>\n\n<p>My(abbreviated) server code:</p>\n\n<pre><code>import \"net\"\n\nfunc startServer() {\n    // Bind the port.\n    ServerAddr, err := net.ResolveUDPAddr(\"udp\", \"localhost:666\")\n    if err != nil {\n        fmt.Println(\"Error binding port!\")\n    }\n\n    ServerConn, _ := net.ListenUDP(\"udp\", ServerAddr)\n    defer ServerConn.Close()\n\n    buf := make([]byte, 1024)\n    for {\n        // Recieve a UDP packet and unmarshal it into a protobuf.\n        n, _, _ := ServerConn.ReadFromUDP(buf)\n        fmt.Println(\"Packet received!\")\n        // Do stuff with buf.\n    }\n}\n</code></pre>\n\n<p>If, from the machine the server is running on, I use:</p>\n\n<pre><code>echo -n \u201cfoo\u201d | nc -4u -w1 127.0.0.1 666\n</code></pre>\n\n<p>then the server receives that packet, and prints the message(and tcpdump shows no output).</p>\n\n<p>However, if I run the following from another computer on the network:</p>\n\n<pre><code>echo -n \u201cfoo\u201d | nc -4u -w1 192.168.1.134 666\n</code></pre>\n\n<p>Then, while tcpdump reports a packet being received (<code>15:05:43.634604 IP 192.168.1.113.59832 &gt; 192.168.1.134.666: UDP, length 9</code> confirming I got the IP address right), the Go server does not respond.</p>\n\n<p>Is there something special I need to do to make Go respond to non-local requests?</p>\n"}, {"tags": ["go", "closures", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 2, "last_activity_date": 1433109261, "creation_date": 1433109261, "answer_id": 30563107, "question_id": 30563064, "link": "https://stackoverflow.com/questions/30563064/wrapping-a-function-call-into-a-closure-when-using-goroutines/30563107#30563107", "title": "Wrapping a function call into a closure when using goroutines", "body": "<p>That's how closures in all languages work, if you want to do it that way, you have to isolate the variable.</p>\n\n<pre><code>go func(i int) { startWorker(i) }(i)\n</code></pre>\n"}], "owner": {"reputation": 21358, "user_id": 1977620, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/lvWfj.jpg?s=128&g=1", "display_name": "Max Malysh", "link": "https://stackoverflow.com/users/1977620/max-malysh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 644, "favorite_count": 0, "closed_date": 1433109311, "accepted_answer_id": 30563107, "answer_count": 1, "score": -1, "last_activity_date": 1433109261, "creation_date": 1433108952, "question_id": 30563064, "link": "https://stackoverflow.com/questions/30563064/wrapping-a-function-call-into-a-closure-when-using-goroutines", "closed_reason": "Duplicate", "title": "Wrapping a function call into a closure when using goroutines", "body": "<p>Wrapping a function call into a closure leads to an unexpected behaviour when using goroutines. </p>\n\n<p>Consider the following example:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"sync\"\n    \"time\"\n)\n\nvar workerNum = 5\nvar wg sync.WaitGroup\n\nfunc block() {\n    dur := 300 * time.Millisecond\n    //time.Sleep()\n    select {\n    case &lt;- time.After(dur): {}\n    }\n}\n\nfunc startWorker(worker int) {\n    for i:=0; i &lt; 3; i++{\n        log.Printf(\"Worker %d woke up! \\n\", worker)\n        block()\n    }\n    wg.Done()\n}\n\nfunc main() {\n    for i:=0; i &lt; workerNum; i++ {\n        //go func() { startWorker(i) }()\n        go startWorker(i)\n    }\n\n    wg.Add(workerNum)\n    wg.Wait()\n}\n</code></pre>\n\n<p>Test it here: <a href=\"http://play.golang.org/p/nMlnTkbwVf\" rel=\"nofollow\">http://play.golang.org/p/nMlnTkbwVf</a></p>\n\n<p>One can see that wrapping <code>startWorker(i)</code> into <code>func() { startWorker(i) }()</code> results in calling only the 5-th worker. </p>\n\n<p>It looks like there is something wrong in the way how closures capture variables from the outer scope. Why is this happening? Do closures use pass-by-reference way for passing outer variables instead of pass-by-value? </p>\n"}, {"tags": ["regex", "go"], "answers": [{"comments": [{"owner": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "edited": false, "score": 0, "creation_date": 1433146634, "post_id": 30568052, "comment_id": 49207735, "body": "Thanks for advice, but could you explain a little more about compiling regexp? Wha do you mean by compile regexp?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "edited": false, "score": 0, "creation_date": 1433147819, "post_id": 30568052, "comment_id": 49208399, "body": "@Avdept If you have a regexp in Go as a <code>string</code>, if you want to check if the regexp matches another <code>string</code>, you can do that for example with the <a href=\"https://golang.org/pkg/regexp/#Regexp.MatchString\" rel=\"nofollow noreferrer\"><code>Regexp.MatchString()</code></a> method. <code>Regexp</code> is a compiled (analyzed) version of a <code>string</code> regular expression. You can compile a regexp <code>string</code> and acquire a <code>Regexp</code> value with the <a href=\"https://golang.org/pkg/regexp/#Compile\" rel=\"nofollow noreferrer\"><code>regexp.Compile()</code></a> or <a href=\"https://golang.org/pkg/regexp/#MustCompile\" rel=\"nofollow noreferrer\"><code>regexp.MustCompile()</code></a> functions for example."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1433155178, "last_edit_date": 1495540266, "creation_date": 1433144272, "answer_id": 30568052, "question_id": 30562624, "link": "https://stackoverflow.com/questions/30562624/preserve-structs-data-for-using-it-later/30568052#30568052", "title": "Preserve structs data for using it later", "body": "<p>Your question is not really well defined. You told us you want to implement routing functionality based on regular expressions, but you haven't told us what kind of tasks you want to achieve which greatly influence the optimal or best data structure to be used.</p>\n\n<p>You already mentioned you know about a lot of other implementations which are open source, maybe you should check their sources.</p>\n\n<p><a href=\"https://stackoverflow.com/a/30474723/1705598\">This answer</a> might also be a help to you which shows a simple implementation of a basic implementation how to do routing functionality using regular expressions.</p>\n\n<p>If you just want to be able to register regular expressions which if matched by the request path and then forward the serving to a <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow noreferrer\"><code>Handler</code></a>, yes, storing the \"rules\" in a <code>[]Routes</code> is a viable and simple option.</p>\n\n<p>Things to keep in mind:</p>\n\n<ul>\n<li><p>I would definitely compile the regexp in advance and store the result and not compile them each time which is an awful waste of resources. So your <code>Routes</code> struct should contain a field of type <a href=\"https://golang.org/pkg/regexp/#Regexp\" rel=\"nofollow noreferrer\"><code>*regexp.Regexp</code></a> instead of the pattern (you can keep the <code>string</code> pattern too e.g. for debugging purposes).</p></li>\n<li><p>If your <code>Routes</code> struct grows bigger, I would consider storing pointers in the slice and not struct values, e.g. <code>[]*Routes</code> because each time when you loop over them (e.g. in each request to see which matches) or whenever you create a local variable from one of the <code>Routes</code>, a copy is made from the values. Copying large struct is inefficient compared to copying a pointer which is fast.</p></li>\n</ul>\n"}], "owner": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 30568052, "answer_count": 1, "score": 1, "last_activity_date": 1433155178, "creation_date": 1433105822, "question_id": 30562624, "link": "https://stackoverflow.com/questions/30562624/preserve-structs-data-for-using-it-later", "title": "Preserve structs data for using it later", "body": "<p>I'm learning golang - coding small web blog, and writing router(I know there are available few - gorilla mux, martini, etc). </p>\n\n<p>I have simple struct</p>\n\n<pre><code>type Routes struct {    \n    method string\n    pattern string\n    handler Handler\n}\n</code></pre>\n\n<p>and some regex matchers. But i can't understand how do i keep all routes that i will define in one place. Is using slice of structs good idea(like\n<code>[]Routes</code>) to keep them all together?</p>\n\n<p>P.S. This is meant for personal understanding of how it all works together</p>\n"}, {"tags": ["go", "gorilla", "pprof"], "answers": [{"tags": [], "owner": {"reputation": 21358, "user_id": 1977620, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/lvWfj.jpg?s=128&g=1", "display_name": "Max Malysh", "link": "https://stackoverflow.com/users/1977620/max-malysh"}, "is_accepted": false, "score": 13, "last_activity_date": 1461332103, "last_edit_date": 1461332103, "creation_date": 1433095766, "answer_id": 30560860, "question_id": 30560859, "link": "https://stackoverflow.com/questions/30560859/cant-use-go-tool-pprof-with-an-existing-server/30560860#30560860", "title": "Can&#39;t use go tool pprof with an existing server", "body": "<p>Looks like the problem was in a <code>*mux.Router</code> used from <code>github.com/gorilla/mux</code> which I used as a <code>Handler</code> in my <code>http.Server</code> instance.</p>\n\n<p>Solution: just launch <strong>one more</strong> server just for the <code>pprof</code>:</p>\n\n<pre><code>server := &amp;http.Server {\n    Addr:           \":8080\",\n    Handler:        router,\n    ReadTimeout:    15*time.Second,\n    WriteTimeout:   15*time.Second,\n}\ngo func() {\n    log.Println(http.ListenAndServe(\":6060\", nil))\n}()\nlog.Fatal(server.ListenAndServe())\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 183, "user_id": 4313288, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/FyNe7.jpg?s=128&g=1", "display_name": "Andrew B", "link": "https://stackoverflow.com/users/4313288/andrew-b"}, "edited": false, "score": 1, "creation_date": 1598976087, "post_id": 30561285, "comment_id": 112627687, "body": "I have a question: Once going to <code>&#47;debug&#47;pprof&#47;</code> there are several links that lead to 404 pages. In particular <code>heap</code> and <code>allocs</code> 404. And as you&#39;ve shown above, I don&#39;t see routes for those paths provided in <code>net&#47;http&#47;pprof&#47;pprof.go</code>&#39;s <code>init()</code> func. How do I make those accessible? Would you happen to know how I can get those @Dave C?"}, {"owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "edited": false, "score": 0, "creation_date": 1607589530, "post_id": 30561285, "comment_id": 115321667, "body": "If you use <code>router.PathPrefix(&quot;&#47;debug&#47;&quot;).Handler(http.DefaultServeMux)</code> the heap endpoint is added. It&#39;s not if you apply the <code>init</code> handlers. Not sure why..."}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 24, "last_activity_date": 1507992726, "last_edit_date": 1507992726, "creation_date": 1433098024, "answer_id": 30561285, "question_id": 30560859, "link": "https://stackoverflow.com/questions/30560859/cant-use-go-tool-pprof-with-an-existing-server/30561285#30561285", "title": "Can&#39;t use go tool pprof with an existing server", "body": "<p>It's not explicitly mentioned in the documentation, but <a href=\"https://golang.org/pkg/net/http/pprof\" rel=\"noreferrer\"><code>net/http/pprof</code></a> only registers its handlers with <code>http.DefaultServeMux</code>.</p>\n\n<p>From the <a href=\"https://github.com/golang/go/blob/release-branch.go1.9/src/net/http/pprof/pprof.go#L72-L76\" rel=\"noreferrer\">source</a>:</p>\n\n<pre><code>func init() {\n        http.Handle(\"/debug/pprof/\", http.HandlerFunc(Index))\n        http.Handle(\"/debug/pprof/cmdline\", http.HandlerFunc(Cmdline))\n        http.Handle(\"/debug/pprof/profile\", http.HandlerFunc(Profile))\n        http.Handle(\"/debug/pprof/symbol\", http.HandlerFunc(Symbol))\n        http.Handle(\"/debug/pprof/trace\", http.HandlerFunc(Trace))\n}\n</code></pre>\n\n<p>If you're not using the default mux you just have to register any/all of those you want with whatever mux you're using, e.g.\u00a0something like <code>mymux.HandleFunc(\"\u2026\", pprof.Index)</code>, etc.</p>\n\n<p>Alternatively you can listen on a separate port (also possibly bound to only localhost if desired) with the default mux as <a href=\"https://stackoverflow.com/a/30560860/55504\">you've shown</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 369, "user_id": 1374061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16b8dad53250bf22c1337b062e67f03a?s=128&d=identicon&r=PG", "display_name": "Devon Peticolas", "link": "https://stackoverflow.com/users/1374061/devon-peticolas"}, "is_accepted": false, "score": 10, "last_activity_date": 1563284182, "last_edit_date": 1563284182, "creation_date": 1539121959, "answer_id": 52729856, "question_id": 30560859, "link": "https://stackoverflow.com/questions/30560859/cant-use-go-tool-pprof-with-an-existing-server/52729856#52729856", "title": "Can&#39;t use go tool pprof with an existing server", "body": "<p>If you're using a <code>github.com/gorilla/mux.Router</code> you can simply hand off any request prefixed with <code>/debug/</code> to the <code>http.DefaultServeMux</code>.</p>\n\n<pre><code>import _ \"net/http/debug\"\nrouter := mux.NewRouter()\nrouter.PathPrefix(\"/debug/\").Handler(http.DefaultServeMux)\n</code></pre>\n"}], "owner": {"reputation": 21358, "user_id": 1977620, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/lvWfj.jpg?s=128&g=1", "display_name": "Max Malysh", "link": "https://stackoverflow.com/users/1977620/max-malysh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8241, "favorite_count": 3, "accepted_answer_id": 30561285, "answer_count": 3, "score": 15, "last_activity_date": 1563284182, "creation_date": 1433095766, "question_id": 30560859, "link": "https://stackoverflow.com/questions/30560859/cant-use-go-tool-pprof-with-an-existing-server", "title": "Can&#39;t use go tool pprof with an existing server", "body": "<p>I have an existing http server which I would like to profile. I have included <code>_ \"net/http/pprof\"</code>to my imports, and I already have http server running:</p>\n\n<pre><code>router := createRouter()\nserver := &amp;http.Server {\n    Addr:           \":8080\",\n    Handler:        router,\n    ReadTimeout:    15*time.Second,\n    WriteTimeout:   15*time.Second,\n//  MaxHeaderBytes: 4096,\n}\n\nlog.Fatal(server.ListenAndServe())\n</code></pre>\n\n<p>When I'm trying to access <a href=\"http://localhost:8080/debug/pprof/\" rel=\"noreferrer\">http://localhost:8080/debug/pprof/</a> I get <code>404 page not found</code>. </p>\n\n<p>That's what I get when using <code>go tool pprof</code> on a local machine:</p>\n\n<pre><code>userver@userver:~/Desktop/gotest$ go tool pprof http://192.168.0.27:8080/\nUse of uninitialized value $prefix in concatenation (.) or string at /usr/lib/go/pkg/tool/linux_amd64/pprof line 3019.\nRead http://192.168.0.27:8080/pprof/symbol\nFailed to get the number of symbols from http://192.168.0.27:8080/pprof/symbol\n\nuserver@userver:~/Desktop/gotest$ go tool pprof http://localhost:8080/debug/pprof/profile\nRead http://localhost:8080/debug/pprof/symbol\nFailed to get the number of symbols from http://localhost:8080/debug/pprof/symbol\n</code></pre>\n\n<p>Same for a remote client:</p>\n\n<pre><code>MacBookAir:~ apple$ go tool pprof http://192.168.0.27:8080/\nUse of uninitialized value $prefix in concatenation (.) or string at /usr/local/Cellar/go/1.3.2/libexec/pkg/tool/darwin_amd64/pprof line 3027.\nRead http://192.168.0.27:8080/pprof/symbol\nFailed to get the number of symbols from http://192.168.0.27:8080/pprof/symbol\n</code></pre>\n"}, {"tags": ["macos", "go"], "comments": [{"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1433169296, "post_id": 30560178, "comment_id": 49222527, "body": "Now I&#39;m trying implementing the same thing for Linux following the answer for <a href=\"http://stackoverflow.com/questions/1420426/calculating-cpu-usage-of-a-process-in-linux\">this question</a>."}, {"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1433248314, "post_id": 30560178, "comment_id": 49260711, "body": "As you can see in latest question edit: I&#39;ve done (or I think so) for Linux. Still need some help for OS X."}], "owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 944, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1433248246, "creation_date": 1433092161, "last_edit_date": 1495540739, "question_id": 30560178, "link": "https://stackoverflow.com/questions/30560178/process-cpu-usage-for-os-x-using-libproc-h-from-go", "title": "Process CPU Usage for OS X using libproc.h from Go", "body": "<p>I known that excellent replies exist on the subject for questions like:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/63166/how-to-determine-cpu-and-memory-consumption-from-inside-a-process\">How to determine CPU and memory consumption from inside a process?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/220323/determine-process-info-programmatically-in-darwin-osx\">Determine Process Info Programmatically in Darwin/OSX</a></li>\n<li><a href=\"https://stackoverflow.com/questions/6785069/get-cpu-percent-usage\">Get CPU percent usage</a></li>\n</ul>\n\n<p>The problem is that I'm trying to use <code>libproc.h</code> that defines a <code>proc_threadinfo</code> structure (among others) but the field <code>pth_cpu_usage</code> is always <code>0</code> (see <code>trheadInfoHandler()</code> func <a href=\"https://gist.github.com/gsscoder/18e4f83601edf9e26849\" rel=\"nofollow noreferrer\">here</a> to see how I'm using the struct from Go).</p>\n\n<p>Looking at a snippet of Chromium source <a href=\"http://src.chromium.org/viewvc/chrome/trunk/src/base/process/process_metrics_mac.cc?view=markup\" rel=\"nofollow noreferrer\">here</a> (that doesn't use <code>libproc.h</code>), I was wondering if using fields from both <code>proc_threadinfo</code> and <code>proc_taskinfo</code> it could be possible calculate cpu percent usage.</p>\n\n<pre><code>\nproc_threadinfo.pth_user_time; /* user run time */\nproc_threadinfo.pth_system_time; /* system run time */\n\nproc_taskinfo.pti_total_user; /* total time */\nproc_taskinfo.pti_total_system;\n</code></pre>\n\n<p><strong>Edit</strong></p>\n\n<p><strike>Some <strong>pseudo code</strong> illustrating <em>the right algorithm</em> or a suggestion to put me on the right path will be very appreciated.</strike></p>\n\n<p>Using <code>/proc</code> filesystem I think I was able to calculate CPU % usage in <strong>Linux</strong>:</p>\n\n<pre><code>\nfunc cpuUsageOf(pid int, waitHandler func()) float32 {\n    stat1 := procFsStatOf(pid)\n    utime1 := stat1.utime // /proc/[pid]/stat field index 13\n    stime1 := stat1.stime // /proc/[pid]/stat field index 14\n    cputime1 := procFsCpuTimeTotal() // /proc/stat -> sum of cpu values\n\n    waitHandler() // here I wait 1 second\n\n    stat2 := procFsStatOf(pid)\n    utime2 := stat2.utime // /proc/[pid]/stat field index 13\n    stime2 := stat2.stime // /proc/[pid]/stat field index 14\n    cputime2 := procFsCpuTimeTotal() // /proc/stat -> sum of cpu values\n\n    return float32(cpuCount() * ((utime2 + stime2) - (utime1 + stime1)) * 100) / float32(cputime2 - cputime1)\n}\n</code></pre>\n\n<p>For <strong>OS X</strong>, do I've to use values from <code>proc_threadinfo</code> or <code>proc_taskinfo</code>? And where I can find the same values that in Linux I read from <code>/proc/stat</code> with (<code>procFsCpuTimeTotal()</code>)?</p>\n\n<p>Full code <a href=\"https://github.com/gsscoder/goproc\" rel=\"nofollow noreferrer\">here</a> (as in commit <code>9e34d3c72bf853ff49ef3970ad6a6c9688e9ba23</code>); fast link to <strong>OS X</strong> code <a href=\"https://github.com/gsscoder/goproc/blob/master/process_darwin.go\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3880, "user_id": 5328289, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0e0e88b500a567f9572d0f8fe4e99405?s=128&d=identicon&r=PG&f=1", "display_name": "M.E.", "link": "https://stackoverflow.com/users/5328289/m-e"}, "edited": false, "score": 0, "creation_date": 1600720291, "post_id": 30558071, "comment_id": 113171381, "body": "Excellent question. I am wondering why this was not implemented in Go. As everything seems to have been carefully selected in Go, there must be a good reason for not having implemented static variables."}], "answers": [{"tags": [], "owner": {"reputation": 16582, "user_id": 864236, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/cf2143f14e4018a342ce93aa0fad00c6?s=128&d=identicon&r=PG", "display_name": "mjibson", "link": "https://stackoverflow.com/users/864236/mjibson"}, "is_accepted": false, "score": 15, "last_activity_date": 1433079448, "creation_date": 1433079448, "answer_id": 30558090, "question_id": 30558071, "link": "https://stackoverflow.com/questions/30558071/static-local-variable-in-go/30558090#30558090", "title": "Static local variable in Go", "body": "<p>Declare a var at global scope:</p>\n\n<pre><code>var i = 1\n\nfunc a() {\n  println(i)\n  i++\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 711, "user_id": 1232726, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/Bg5nq.jpg?s=128&g=1", "display_name": "filthy_wizard", "link": "https://stackoverflow.com/users/1232726/filthy-wizard"}, "edited": false, "score": 0, "creation_date": 1469131626, "post_id": 30558173, "comment_id": 64423932, "body": "say i have a variable at the top of a file? (outside any method) is it accessible to all functions in the file? works on go playground anyway"}, {"owner": {"reputation": 3296, "user_id": 1456887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f01743e24e94a4bfe007c57079b21e7?s=128&d=identicon&r=PG", "display_name": "Jesse Chisholm", "link": "https://stackoverflow.com/users/1456887/jesse-chisholm"}, "edited": false, "score": 0, "creation_date": 1500683370, "post_id": 30558173, "comment_id": 77463891, "body": "Sadly, the function is outside of main, so this pattern doesn&#39;t work for me."}, {"owner": {"reputation": 121, "user_id": 6887454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e3f902f8b5a47577af76a191f816def?s=128&d=identicon&r=PG&f=1", "display_name": "Amit", "link": "https://stackoverflow.com/users/6887454/amit"}, "edited": false, "score": 2, "creation_date": 1579240505, "post_id": 30558173, "comment_id": 105707470, "body": "Not sure if we can really compare this usage with static. Isn&#39;t this more like a global variable ... x for func is global variable."}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 31, "last_activity_date": 1433079995, "creation_date": 1433079995, "answer_id": 30558173, "question_id": 30558071, "link": "https://stackoverflow.com/questions/30558071/static-local-variable-in-go/30558173#30558173", "title": "Static local variable in Go", "body": "<p>Use a <a href=\"http://golang.org/ref/spec#Function_literals\">closure</a>:</p>\n\n<blockquote>\n  <p>Function literals are closures: they may refer to variables defined in\n  a surrounding function. Those variables are then shared between the\n  surrounding function and the function literal, and they survive as\n  long as they are accessible.</p>\n</blockquote>\n\n<p>It doesn't have to be in global scope, just outside the function definition.</p>\n\n<pre><code>func main() {\n\n    x := 1\n\n    y := func() {\n        fmt.Println(\"x:\", x)\n        x++\n    }\n\n    for i := 0; i &lt; 10; i++ {\n        y()\n    }\n}\n</code></pre>\n\n<p>(Sample on the <a href=\"https://play.golang.org/p/onKjdWDtBE\">Go Playground</a>)</p>\n"}, {"comments": [{"owner": {"reputation": 840, "user_id": 2220153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8d19a9643f923cc96051e42735bdf4e?s=128&d=identicon&r=PG", "display_name": "Lost Crotchet", "link": "https://stackoverflow.com/users/2220153/lost-crotchet"}, "edited": false, "score": 3, "creation_date": 1569262223, "post_id": 37311107, "comment_id": 102531774, "body": "+1 because it is both thread safe (unlike mjibson&#39;s answer) AND the function that uses the persisting variable can be independently unit tested (unlike the accepted answer from IamNaN)."}, {"owner": {"reputation": 1062, "user_id": 1235165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3678a00749a25d0ec2501ef174d92569?s=128&d=identicon&r=PG", "display_name": "hmijail mourns resignees", "link": "https://stackoverflow.com/users/1235165/hmijail-mourns-resignees"}, "edited": false, "score": 0, "creation_date": 1602634992, "post_id": 37311107, "comment_id": 113781330, "body": "Interesting. My first feeling was that C&#39;s static vars are so much simpler, but actually I guess this is much more general and elegant."}], "tags": [], "owner": {"reputation": 72581, "user_id": 44852, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/JbQbc.jpg?s=128&g=1", "display_name": "Tarik", "link": "https://stackoverflow.com/users/44852/tarik"}, "is_accepted": false, "score": 15, "last_activity_date": 1463610438, "creation_date": 1463610438, "answer_id": 37311107, "question_id": 30558071, "link": "https://stackoverflow.com/questions/30558071/static-local-variable-in-go/37311107#37311107", "title": "Static local variable in Go", "body": "<p>You can do something like this</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n  f := do()\n  f() // 1\n  f() // 2\n}\n\nfunc do() (f func()){\n  var i int\n  f = func(){\n    i++\n    fmt.Println(i)\n  }\n  return\n}\n</code></pre>\n\n<p>Link on Playground <a href=\"https://play.golang.org/p/D9mv9_qKmN\" rel=\"noreferrer\">https://play.golang.org/p/D9mv9_qKmN</a></p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 11920955, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/85fc376b361f9255f5996d74af6d9a8a?s=128&d=identicon&r=PG", "display_name": "Claudius Gros", "link": "https://stackoverflow.com/users/11920955/claudius-gros"}, "is_accepted": false, "score": 2, "last_activity_date": 1565679451, "creation_date": 1565679451, "answer_id": 57472589, "question_id": 30558071, "link": "https://stackoverflow.com/questions/30558071/static-local-variable-in-go/57472589#57472589", "title": "Static local variable in Go", "body": "<p>Like Taric' suggestion, but with staticCounter() returning an int function</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc staticCounter() (f func()(int)){\n  var i int\n  f = func()(int){\n    i++\n//  fmt.Println(i)\n    return i\n  }\n  return\n}\n\nfunc main() {\n  f := staticCounter()\n  g := staticCounter()\n  fmt.Println(f())\n  fmt.Println(f())\n  fmt.Println(f())\n  fmt.Println(f())\n  fmt.Println(g())\n  fmt.Println(g())\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 121, "user_id": 6887454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e3f902f8b5a47577af76a191f816def?s=128&d=identicon&r=PG&f=1", "display_name": "Amit", "link": "https://stackoverflow.com/users/6887454/amit"}, "is_accepted": false, "score": 2, "last_activity_date": 1579241470, "creation_date": 1579241470, "answer_id": 59782075, "question_id": 30558071, "link": "https://stackoverflow.com/questions/30558071/static-local-variable-in-go/59782075#59782075", "title": "Static local variable in Go", "body": "<p><a href=\"https://tour.golang.org/moretypes/25\" rel=\"nofollow noreferrer\">Use Function closure</a></p>\n\n<p>In following example, variable sum behaves like a separate static for each closure a1 and a2. </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc adder() func(int) int {\n    sum := 0\n    return func(x int) int {\n        sum += x\n        return sum\n    }\n}\n\nfunc main() {\n    a1,a2 := adder(), adder()\n    for i := 0; i &lt; 10; i++ {\n        fmt.Println(\n            a1(i),\n            a2(-1*i),\n        )\n    }\n}\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>0 0\n1 -1\n3 -3\n6 -6\n10 -10\n15 -15\n21 -21\n28 -28\n36 -36\n45 -45\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 9041974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/647f5eba8a40fc2d5af8c95598fdda6c?s=128&d=identicon&r=PG&f=1", "display_name": "wwwdeveloperman", "link": "https://stackoverflow.com/users/9041974/wwwdeveloperman"}, "is_accepted": false, "score": 0, "last_activity_date": 1587525245, "creation_date": 1587525245, "answer_id": 61356656, "question_id": 30558071, "link": "https://stackoverflow.com/questions/30558071/static-local-variable-in-go/61356656#61356656", "title": "Static local variable in Go", "body": "<pre><code>// A var x1 is local to main(), is not a global var.\n// A static var is one that can't be accesed from others functions just\n// like global vars.\n// A static var dont disappears when the function ends.\n// So is what x1 n x2 are pretending in this program.\npackage main\n\nimport (\n    \"fmt\"\n)\n\n/*\nint func() {     // x static inside a function.\n    static int x = 0;\n    x++;\n    return x;\n}\n*/\n\n// \n\nfunc main() {\n\n    //\n    var x1 int = 0\n    var x2 int = 100\n    //\n\n    for i := 0; i &lt; 10; i++ {           // call to a \"static\" var x\n\n        x1 = fun1(&amp;x1)\n        x2 = fun2(&amp;x2)\n\n        fmt.Printf(\"%d     %d \\n\", x1, x2)\n\n    } //\n\n    test1(x1, x2) // a funct needs parameters to see x1 n x2\n\n} //main\n\n//\n\nfunc fun1(p *int) int {\n    //\n    *p++ // save value\n\n    return *p //counter  x1\n}\n\n//\n\nfunc fun2(p *int) int {\n\n    *p++      // save value\n    return *p //counter x2\n}\n\n//\n\nfunc test1(x1 int, x2 int) {\n    fmt.Println(\"\\\"x1\\\" y \\\"x2\\\"  \", x1, x2)\n}\n</code></pre>\n"}], "owner": {"reputation": 621, "user_id": 3758505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ac686fa8f23c2781ca23f0790c8739e?s=128&d=identicon&r=PG&f=1", "display_name": "Gustavo Bittencourt", "link": "https://stackoverflow.com/users/3758505/gustavo-bittencourt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51416, "favorite_count": 3, "accepted_answer_id": 30558173, "answer_count": 6, "score": 34, "last_activity_date": 1587525245, "creation_date": 1433079320, "last_edit_date": 1531518435, "question_id": 30558071, "link": "https://stackoverflow.com/questions/30558071/static-local-variable-in-go", "title": "Static local variable in Go", "body": "<p>Is it possible to define a local variable in Go that can maintain its value from one function call to another? In C, we can do this using the reserved word <code>static</code>.</p>\n\n<p>Example in C:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>int func() {\n    static int x = 0; \n    x++;\n    return x;\n}\n</code></pre>\n"}, {"tags": ["python", "go", "thrift"], "comments": [{"owner": {"reputation": 21, "user_id": 1185326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ff3aac830b9fd3543f12f67e0c6e9ef?s=128&d=identicon&r=PG", "display_name": "yilee", "link": "https://stackoverflow.com/users/1185326/yilee"}, "edited": false, "score": 0, "creation_date": 1433078566, "post_id": 30557917, "comment_id": 49187431, "body": "Thrift version 0.9.2   go version go1.4.2 darwin/amd64   Python 2.7.5"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 6339990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9db4606eb5c66a850f995e349249743?s=128&d=identicon&r=PG&f=1", "display_name": "soloph", "link": "https://stackoverflow.com/users/6339990/soloph"}, "is_accepted": false, "score": 0, "last_activity_date": 1463656818, "creation_date": 1463656818, "answer_id": 37321666, "question_id": 30557917, "link": "https://stackoverflow.com/questions/30557917/golang-and-python-thrift-communication/37321666#37321666", "title": "golang and python thrift communication", "body": "<p><code>transportFactory := thrift.NewTFramedTransportFactory(thrift.NewTTransportFactory())</code></p>\n\n<p>please change <code>NewTFramedTransportFactory</code> to <code>NewTBufferedTransportFactory</code>, just like <code>transportFactory := thrift.NewTBufferedTransportFactory(1024)</code>, thanks.</p>\n"}], "owner": {"reputation": 21, "user_id": 1185326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ff3aac830b9fd3543f12f67e0c6e9ef?s=128&d=identicon&r=PG", "display_name": "yilee", "link": "https://stackoverflow.com/users/1185326/yilee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1393, "favorite_count": 2, "answer_count": 1, "score": 2, "last_activity_date": 1507471967, "creation_date": 1433078441, "last_edit_date": 1507471967, "question_id": 30557917, "link": "https://stackoverflow.com/questions/30557917/golang-and-python-thrift-communication", "title": "golang and python thrift communication", "body": "<p>I am using Thrift.\nHere is the thrift file:</p>\n\n<pre><code>namespace py hello\nnamespace go hello\n\nservice Hello{ \n    string helloString(1:string para) \n} \n</code></pre>\n\n<p>And I then generate the python and golang code</p>\n\n<pre><code>thrift -gen py Hello.thrift\nthrift -gen go Hello.thrift \n</code></pre>\n\n<p>Python server code: py-server.py</p>\n\n<pre><code>import socket\nimport sys\nsys.path.append('./gen-py/')\n\nfrom hello import Hello\nfrom hello.ttypes import *\n\nfrom thrift.transport import TSocket\nfrom thrift.transport import TTransport\nfrom thrift.protocol import TBinaryProtocol\nfrom thrift.server import TServer\n\nclass HelloHandler:\n    def helloString(self, msg):\n        ret = \"helloString Received: \" + msg\n        print ret\n        return msg\n\n\nhandler = HelloHandler()\nprocessor = Hello.Processor(handler)\ntransport = TSocket.TServerSocket(\"127.0.0.1\", 19090)\ntfactory = TTransport.TBufferedTransportFactory()\npfactory = TBinaryProtocol.TBinaryProtocolFactory()\n\nserver = TServer.TSimpleServer(processor, transport, tfactory, pfactory)\n\nprint \"Starting thrift server in python...\"\nserver.serve()\n</code></pre>\n\n<p>and i can run well:</p>\n\n<pre><code>$ python py-server.py \nStarting thrift server in python...\n</code></pre>\n\n<p>And my client is writen by golang, go-client.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"./gen-go/hello\"\n    \"fmt\"\n    \"git.apache.org/thrift.git/lib/go/thrift\"\n    \"net\"\n    \"os\"\n)\n\nfunc main() {\n    transportFactory := thrift.NewTFramedTransportFactory(thrift.NewTTransportFactory())\n    protocolFactory := thrift.NewTBinaryProtocolFactoryDefault()\n    transport, err := thrift.NewTSocket(net.JoinHostPort(\"127.0.0.1\", \"19090\"))\n    fmt.Println(1)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, \"error resolving address:\", err)\n        os.Exit(1)\n    }\n    useTransport := transportFactory.GetTransport(transport)\n    client := hello.NewHelloClientFactory(useTransport, protocolFactory)\n    fmt.Println(2)\n    if err := transport.Open(); err != nil {\n        fmt.Println(3)\n        fmt.Fprintln(os.Stderr, \"localhsot:19090\", \" \", err)\n        os.Exit(1)\n    }\n    defer transport.Close()\n    fmt.Println(4)\n    r1, e1 := client.HelloString(\"lalalalalalalallalaal\")\n    fmt.Println(5)\n    fmt.Println(\"Call-&gt;\", r1, e1)\n}\n</code></pre>\n\n<p>But it can't run, it output, and it can not stop normally</p>\n\n<pre><code>$ go run go-client.go \n1\n2\n4\n</code></pre>\n\n<p>and the server do not receive any message.</p>\n\n<p>Is there any problem in my golang code?</p>\n\n<hr>\n\n<p>if i write a client by python , it can run well..</p>\n\n<pre><code>import socket\nimport sys\nsys.path.append('./gen-py/')\n\nfrom hello import Hello\nfrom thrift import Thrift\nfrom thrift.transport import TSocket\nfrom thrift.transport import TTransport\nfrom thrift.protocol import TBinaryProtocol\n\ntry:\n    transport = TSocket.TSocket('127.0.0.1', 19090)\n    transport = TTransport.TBufferedTransport(transport)\n    protocol = TBinaryProtocol.TBinaryProtocol(transport)\n    client = Hello.Client(protocol)\n    transport.open()\n\n    print \"client - helloString\"\n    msg = client.helloString(\"lalalalalla\")\n    print \"server - \" + msg\n\n\n    transport.close()\n\nexcept Thrift.TException, ex:\n    print \"%s\" % (ex.message)\n\n$ python py-client.py \nclient - helloString\nserver - lalalalalla\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1433076361, "post_id": 30556584, "comment_id": 49186806, "body": "Do you really need the output limited to UCS-2? Your Python example is for UTF-16BE, which isn&#39;t the same thing."}], "answers": [{"tags": [], "owner": {"reputation": 5661, "user_id": 3179857, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/74a01200b8e1bc8b9b57ddd5633288bc?s=128&d=identicon&r=PG", "display_name": "Evan", "link": "https://stackoverflow.com/users/3179857/evan"}, "is_accepted": false, "score": -1, "last_activity_date": 1433075444, "creation_date": 1433075444, "answer_id": 30557448, "question_id": 30556584, "link": "https://stackoverflow.com/questions/30556584/string-to-ucs-2/30557448#30557448", "title": "String to UCS-2", "body": "<p>The standard library has the built-in <code>utf16.Encode()</code> (<a href=\"https://golang.org/pkg/unicode/utf16/#Encode\" rel=\"nofollow\">https://golang.org/pkg/unicode/utf16/#Encode</a>) function for this purpose.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1433080368, "last_edit_date": 1433080368, "creation_date": 1433078672, "answer_id": 30557959, "question_id": 30556584, "link": "https://stackoverflow.com/questions/30556584/string-to-ucs-2/30557959#30557959", "title": "String to UCS-2", "body": "<p>Make this conversion a function then you can easily improve the conversion algorithm in the future. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    \"unicode/utf16\"\n)\n\nfunc hexUTF16FromString(s string) string {\n    hex := fmt.Sprintf(\"%04x\", utf16.Encode([]rune(s)))\n    return strings.Replace(hex[1:len(hex)-1], \" \", \"\", -1)\n}\n\nfunc main() {\n    str := \"Bien jou\u00e9\"\n    fmt.Println(str)\n    hex := hexUTF16FromString(str)\n    fmt.Println(hex)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Bien jou\u00e9\n004200690065006e0020006a006f007500e9\n</code></pre>\n\n<p>NOTE: </p>\n\n<p>You say \"convert an unicode string to a UCS-2 string\" but your Python example uses UTF-16:</p>\n\n<pre><code>u\"Bien jou\u00e9\".encode('utf-16-be').encode('hex')\n</code></pre>\n\n<blockquote>\n  <p><a href=\"http://www.unicode.org/\" rel=\"nofollow\">The Unicode Consortium</a></p>\n  \n  <p><a href=\"http://unicode.org/faq/utf_bom.html#UTF16\" rel=\"nofollow\">UTF-16 FAQ</a></p>\n  \n  <p><a href=\"http://unicode.org/faq/utf_bom.html#utf16-11\" rel=\"nofollow\">Q: What is the difference between UCS-2 and UTF-16?</a></p>\n  \n  <p>A: UCS-2 is obsolete terminology which refers to a Unicode\n  implementation up to Unicode 1.1, before surrogate code points and\n  UTF-16 were added to Version 2.0 of the standard. This term should now\n  be avoided.</p>\n  \n  <p>UCS-2 does not describe a data format distinct from UTF-16, because\n  both use exactly the same 16-bit code unit representations. However,\n  UCS-2 does not interpret surrogate code points, and thus cannot be\n  used to conformantly represent supplementary characters.</p>\n  \n  <p>Sometimes in the past an implementation has been labeled \"UCS-2\" to\n  indicate that it does not support supplementary characters and doesn't\n  interpret pairs of surrogate code points as characters. Such an\n  implementation would not handle processing of character properties,\n  code point boundaries, collation, etc. for supplementary characters.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 3, "last_activity_date": 1433086442, "last_edit_date": 1433086442, "creation_date": 1433086128, "answer_id": 30559156, "question_id": 30556584, "link": "https://stackoverflow.com/questions/30556584/string-to-ucs-2/30559156#30559156", "title": "String to UCS-2", "body": "<p>For anything other than trivially short input (and possibly even then), I'd use the <a href=\"https://godoc.org/golang.org/x/text/encoding/unicode\" rel=\"nofollow\"><code>golang.org/x/text/encoding/unicode</code></a> package to convert to UTF-16 (as @peterSo and @JimB point out, slightly different from obsolete UCS-2).</p>\n\n<p>The advantage (over <code>unicode/utf16</code>) of using this (and the <code>golang.org/x/text/transform</code> package) is that you get BOM support, big or little endian, and that you can encode/decode short strings or bytes, but you can also apply this as a filter to an <code>io.Reader</code> or to an <code>io.Writer</code> to transform your data as you process it instead of all up front (i.e.\u00a0for a large stream of data you don't need to have it all in memory at once).</p>\n\n<p>E.g.:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"strings\"\n\n    \"golang.org/x/text/encoding/unicode\"\n    \"golang.org/x/text/transform\"\n)\n\nconst input = \"Bien jou\u00e9\"\n\nfunc main() {\n    // Get a `transform.Transformer` for encoding.\n    e := unicode.UTF16(unicode.BigEndian, unicode.IgnoreBOM)\n    t := e.NewEncoder()\n    // For decoding, allows a Byte Order Mark at the start to\n    // switch to corresponding Unicode decoding (UTF-8, UTF-16BE, or UTF-16LE)\n    // otherwise we use `e` (UTF-16BE without BOM):\n    t2 := unicode.BOMOverride(e.NewDecoder())\n    _ = t2 // we don't show/use this\n\n    // If you have a string:\n    str := input\n    outstr, n, err := transform.String(t, str)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"string:   n=%d, bytes=%02x\\n\", n, []byte(outstr))\n\n    // If you have a []byte:\n    b := []byte(input)\n    outbytes, n, err := transform.Bytes(t, b)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"bytes:    n=%d, bytes=%02x\\n\", n, outbytes)\n\n    // If you have an io.Reader for the input:\n    ir := strings.NewReader(input)\n    r := transform.NewReader(ir, t)\n    // Now just read from r as you normal would and the encoding will\n    // happen as you read, good for large sources to avoid pre-encoding\n    // everything. Here we'll just read it all in one go though which negates\n    // that benefit (normally avoid ioutil.ReadAll).\n    outbytes, err = ioutil.ReadAll(r)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"reader: len=%d, bytes=%02x\\n\", len(outbytes), outbytes)\n\n    // If you have an io.Writer for the output:\n    var buf bytes.Buffer\n    w := transform.NewWriter(&amp;buf, t)\n    _, err = fmt.Fprint(w, input) // or io.Copy from an io.Reader, or whatever\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"writer: len=%d, bytes=%02x\\n\", buf.Len(), buf.Bytes())\n}\n\n// Whichever of these you need you could of\n// course put in a single simple function. E.g.:\n\n// NewUTF16BEWriter returns a new writer that wraps w\n// by transforming the bytes written into UTF-16-BE.\nfunc NewUTF16BEWriter(w io.Writer) io.Writer {\n    e := unicode.UTF16(unicode.BigEndian, unicode.IgnoreBOM)\n    return transform.NewWriter(w, e.NewEncoder())\n}\n\n// ToUTFBE converts UTF8 `b` into UTF-16-BE.\nfunc ToUTF16BE(b []byte) ([]byte, error) {\n    e := unicode.UTF16(unicode.BigEndian, unicode.IgnoreBOM)\n    out, _, err := transform.Bytes(e.NewEncoder(), b)\n    return out, err\n}\n</code></pre>\n\n<p>Gives:</p>\n\n<pre><code>string:   n=10, bytes=004200690065006e0020006a006f007500e9\nbytes:    n=10, bytes=004200690065006e0020006a006f007500e9\nreader: len=18, bytes=004200690065006e0020006a006f007500e9\nwriter: len=18, bytes=004200690065006e0020006a006f007500e9\n</code></pre>\n"}], "owner": {"reputation": 2253, "user_id": 1630586, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/902ef27763348c8d6d6aba56ffdf7304?s=128&d=identicon&r=PG", "display_name": "Julio", "link": "https://stackoverflow.com/users/1630586/julio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1571, "favorite_count": 2, "accepted_answer_id": 30557959, "answer_count": 3, "score": 2, "last_activity_date": 1433086442, "creation_date": 1433069775, "question_id": 30556584, "link": "https://stackoverflow.com/questions/30556584/string-to-ucs-2", "title": "String to UCS-2", "body": "<p>I want to translate in <code>Go</code> my <code>python</code> program to convert an <code>unicode</code> string to a <code>UCS-2</code> <code>HEX</code> string.</p>\n\n<p>In python, it's quite simple:</p>\n\n<pre><code>u\"Bien jou\u00e9\".encode('utf-16-be').encode('hex')\n-&gt; 004200690065006e0020006a006f007500e9\n</code></pre>\n\n<p>I am a beginner in <code>Go</code> and the simplest way I found is:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    str := \"Bien jou\u00e9\" \n    fmt.Printf(\"str: %s\\n\", str)\n\n    ucs2HexArray := []rune(str)\n    s := fmt.Sprintf(\"%U\", ucs2HexArray)\n    a := strings.Replace(s, \"U+\", \"\", -1)\n    b := strings.Replace(a, \"[\", \"\", -1)\n    c := strings.Replace(b, \"]\", \"\", -1)\n    d := strings.Replace(c, \" \", \"\", -1)\n    fmt.Printf(\"-&gt;: %s\", d)\n}\n\nstr: Bien jou\u00e9\n-&gt;: 004200690065006E0020006A006F007500E9\nProgram exited.\n</code></pre>\n\n<p>I really think it's clearly not efficient. How can-I improve it?</p>\n\n<p>Thank you</p>\n"}, {"tags": ["java", "encryption", "go", "rsa"], "comments": [{"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 4, "creation_date": 1433060831, "post_id": 30553653, "comment_id": 49182587, "body": "&quot;Can&#39;t decrypt&quot; is not an accurate problem statement. Please add the relevant error to your question (even though you already have an answer)."}], "answers": [{"tags": [], "owner": {"reputation": 132, "user_id": 4430496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/085400d00f5ed90f46d9bf69267f52f5?s=128&d=identicon&r=PG&f=1", "display_name": "Juris Lacis", "link": "https://stackoverflow.com/users/4430496/juris-lacis"}, "is_accepted": true, "score": 1, "last_activity_date": 1433047163, "creation_date": 1433047163, "answer_id": 30553904, "question_id": 30553653, "link": "https://stackoverflow.com/questions/30553653/rsa-encrypt-and-decrypt-between-java-and-go/30553904#30553904", "title": "RSA encrypt and decrypt between java and go", "body": "<p>Try to use padding in Java to encrypt. I know nothing about \"go\" but in Java you are encrypting message with no padding. </p>\n\n<pre><code>Cipher cipher = Cipher.getInstance(\"RSA\");\n</code></pre>\n\n<p>in this code snippet change \"RSA\" to \"RSA/ECB/PKCS1Padding\" since in \"go\" as I see you are using some function called \"DecryptPKCS1v15\", PKCS1 v1.5 standard itself means the PKCS#1 padding to be used. Hope it helps you.</p>\n"}], "owner": {"reputation": 53, "user_id": 2127884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fdf7ea4ac6bfff019ef5ca51f20a48e?s=128&d=identicon&r=PG", "display_name": "Davion", "link": "https://stackoverflow.com/users/2127884/davion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1460, "favorite_count": 3, "accepted_answer_id": 30553904, "answer_count": 1, "score": -3, "last_activity_date": 1433261721, "creation_date": 1433044320, "last_edit_date": 1433261721, "question_id": 30553653, "link": "https://stackoverflow.com/questions/30553653/rsa-encrypt-and-decrypt-between-java-and-go", "title": "RSA encrypt and decrypt between java and go", "body": "<p>In java I encrypt a string by RSA : \"Hello,I am  plaintext string!@sina.com\"\nthen get:</p>\n\n<p><code>kkkHf5QSXx8aDadk66AOysmV8LOi4vWUANal+7KV6va/5ZR7PSWGRS5bzbK4vMyK9FA5CLQolr2N\nB6ouPNWpgq3Af7Pn/f45+pDtKRsBLX8+q/Mw7TOYR525e7nVePDBLM2wLQZ4Gh5QMQzEI3Me3Zc3\n030jRg0gEG13N/1EzMo=</code></p>\n\n<p>But I tried many methods and couldn't decrypt it in go.\nWhat's the problem?</p>\n\n<p>Any help will be appreciated, thanks.</p>\n\n<p>Here is my code:</p>\n\n<p>java:</p>\n\n<pre><code>public static void main(String[] args) throws Exception {  \nString pubKey_from_go=\"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDZsfv1qscqYdy4vY+P4e3cAtmv\"+\n            \"ppXQcRvrF1cB4drkv0haU24Y7m5qYtT52Kr539RdbKKdLAM6s20lWy7+5C0Dgacd\"+\n            \"wYWd/7PeCELyEipZJL07Vro7Ate8Bfjya+wltGK9+XNUIHiumUKULW4KDx21+1NL\"+\n            \"AUeJ6PeW+DAkmJWF6QIDAQAB\";\n\nString plainText = \"Hello,I am  plaintext string!@sina.com\"; \nString encryptString=encByGoPubKey(pubKey_from_go,plainText);\n}\npublic static String encByGoPubKey(String pubkey_from_go,String plainText) throws Exception {\n    Cipher cipher = Cipher.getInstance(\"RSA\");//Cipher.getInstance(\"RSA/ECB/PKCS1Padding\");  \n    byte[] plainTextBytes = plainText.getBytes();  \n\n    PublicKey pubkey_go=getPublicKey(pubkey_from_go);\n    cipher.init(Cipher.ENCRYPT_MODE, pubkey_go);  \n    byte[] enBytes = cipher.doFinal(plainTextBytes);  \n    String encryptString = (new BASE64Encoder()).encode(enBytes);  \n    return encryptString;   \n}\npublic static PublicKey getPublicKey(String key) throws Exception {  \n  byte[] keyBytes;  \n  keyBytes = (new BASE64Decoder()).decodeBuffer(key);  \n\n  X509EncodedKeySpec keySpec = new X509EncodedKeySpec(keyBytes);  \n  KeyFactory keyFactory = KeyFactory.getInstance(\"RSA\");  \n  PublicKey publicKey = keyFactory.generatePublic(keySpec);  \n  return publicKey;  \n}  \n</code></pre>\n\n<p>Go:</p>\n\n<pre><code>import (\n        \"crypto/rand\"\n        \"crypto/rsa\"\n        // \"crypto/sha1\"\n        \"crypto/x509\"\n        \"encoding/base64\"\n        \"encoding/pem\"\n        \"errors\"\n        // \"flag\"\n        \"fmt\"\n        \"github.com/astaxie/beego\"\n    )\nvar publicKey = []byte(`\n    -----BEGIN PUBLIC KEY-----\n    MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDZsfv1qscqYdy4vY+P4e3cAtmv\n    ppXQcRvrF1cB4drkv0haU24Y7m5qYtT52Kr539RdbKKdLAM6s20lWy7+5C0Dgacd\n    wYWd/7PeCELyEipZJL07Vro7Ate8Bfjya+wltGK9+XNUIHiumUKULW4KDx21+1NL\n    AUeJ6PeW+DAkmJWF6QIDAQAB\n    -----END PUBLIC KEY-----\n    `)\n    var privateKey = []byte(`\n    -----BEGIN RSA PRIVATE KEY-----\n    MIICXQIBAAKBgQDZsfv1qscqYdy4vY+P4e3cAtmvppXQcRvrF1cB4drkv0haU24Y\n    7m5qYtT52Kr539RdbKKdLAM6s20lWy7+5C0DgacdwYWd/7PeCELyEipZJL07Vro7\n    Ate8Bfjya+wltGK9+XNUIHiumUKULW4KDx21+1NLAUeJ6PeW+DAkmJWF6QIDAQAB\n    AoGBAJlNxenTQj6OfCl9FMR2jlMJjtMrtQT9InQEE7m3m7bLHeC+MCJOhmNVBjaM\n    ZpthDORdxIZ6oCuOf6Z2+Dl35lntGFh5J7S34UP2BWzF1IyyQfySCNexGNHKT1G1\n    XKQtHmtc2gWWthEg+S6ciIyw2IGrrP2Rke81vYHExPrexf0hAkEA9Izb0MiYsMCB\n    /jemLJB0Lb3Y/B8xjGjQFFBQT7bmwBVjvZWZVpnMnXi9sWGdgUpxsCuAIROXjZ40\n    IRZ2C9EouwJBAOPjPvV8Sgw4vaseOqlJvSq/C/pIFx6RVznDGlc8bRg7SgTPpjHG\n    4G+M3mVgpCX1a/EU1mB+fhiJ2LAZ/pTtY6sCQGaW9NwIWu3DRIVGCSMm0mYh/3X9\n    DAcwLSJoctiODQ1Fq9rreDE5QfpJnaJdJfsIJNtX1F+L3YceeBXtW0Ynz2MCQBI8\n    9KP274Is5FkWkUFNKnuKUK4WKOuEXEO+LpR+vIhs7k6WQ8nGDd4/mujoJBr5mkrw\n    DPwqA3N5TMNDQVGv8gMCQQCaKGJgWYgvo3/milFfImbp+m7/Y3vCptarldXrYQWO\n    AQjxwc71ZGBFDITYvdgJM1MTqc8xQek1FXn1vfpy2c6O\n    -----END RSA PRIVATE KEY-----\n    `\n    func RsaEncrypt(origData []byte, pubKey []byte) ([]byte, error) {\n        block, _ := pem.Decode(pubKey)\n        if block == nil {\n            return nil, errors.New(\"public key error\")\n        }\n        pubInterface, err := x509.ParsePKIXPublicKey(block.Bytes)\n        if err != nil {\n            return nil, err\n        }\n        pub := pubInterface.(*rsa.PublicKey)\n        return rsa.EncryptPKCS1v15(rand.Reader, pub, origData)\n    }\n\n    func RsaDecrypt(ciphertext []byte, privKey []byte) ([]byte, error) {\n        block, _ := pem.Decode(privKey)\n        if block == nil {\n            return nil, errors.New(\"private key error!\")\n        }\n        priv, err := x509.ParsePKCS1PrivateKey(block.Bytes)\n        if err != nil {\n            return nil, err\n        }\n        return rsa.DecryptPKCS1v15(rand.Reader, priv, ciphertext)\n    }\nvar data64 string = `kkkHf5QSXx8aDadk66AOysmV8LOi4vWUANal+7KV6va/5ZR7PSWGRS5bzbK4vMyK9FA5CLQolr2NB6ouPNWpgq3Af7Pn/f45+pDtKRsBLX8+q/Mw7TOYR525e7nVePDBLM2wLQZ4Gh5QMQzEI3Me3Zc3030jRg0gEG13N/1EzMo=`\n    func main() {\n        data, _ := base64.StdEncoding.DecodeString(data64)\n        origData, _ := RsaDecrypt(data, privateKey)\n        fmt.Println(\"rsa-------\" + string(origData))\n    }\n</code></pre>\n"}, {"tags": ["google-app-engine", "logging", "go"], "comments": [{"owner": {"reputation": 1278, "user_id": 2036231, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/nYM74.png?s=128&g=1", "display_name": "Jose Bagatelli", "link": "https://stackoverflow.com/users/2036231/jose-bagatelli"}, "edited": false, "score": 0, "creation_date": 1433034009, "post_id": 30552762, "comment_id": 49177797, "body": "Log into your admin console and under the Logs menu. You&#39;ll see all the logs generated by you app. <a href=\"https://appengine.google.com/\" rel=\"nofollow noreferrer\">appengine.google.com</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1433069314, "last_edit_date": 1433069314, "creation_date": 1433054284, "answer_id": 30554605, "question_id": 30552762, "link": "https://stackoverflow.com/questions/30552762/can-only-access-request-logs-from-google-app-engine-golang-application/30554605#30554605", "title": "Can only access request-logs from Google App Engine golang application", "body": "<p>There are 2 kinds of logs: <strong>Request logs</strong> which are generated automatically by the platform for all requests and contains request details (like timestamp, client ip, user agent, status codes, serving time, instance id etc.) and <strong>Application logs</strong> which are the result of <code>context.Debugf()</code>, <code>context.Warningf()</code>, <code>context.Infof()</code>, <code>context.Errorf()</code> and <code>context.Criticalf()</code> method calls.</p>\n\n<p>Application logs are attached to (or associated with) requests (request log records), requests from which they were called (during serving those requests).</p>\n\n<p>Request (and application) logs can be viewed on the Logs page of the Admin console or on the Developer console. <strong>Both the Admin console and the Developer console</strong> display both Request and Application log records. Note that on both the Admin and Developer console you have to click on the log records to expand them. Once you expand a request log, all application log records will be displayed that were done from that request.</p>\n\n<p>If you want to download application logs as well, you can specify the <code>--include_all</code> parameter to the <code>appcfg.py</code> tool.</p>\n\n<p>Programatically you can query the request logs, see <a href=\"https://cloud.google.com/appengine/docs/go/logs/\" rel=\"nofollow\">Logs Go API Overview</a> for more details. Here is the <a href=\"https://cloud.google.com/appengine/docs/go/logs/reference\" rel=\"nofollow\">Log package</a> reference.</p>\n\n<p>When you query request logs, the result are <a href=\"https://cloud.google.com/appengine/docs/go/logs/reference#Record\" rel=\"nofollow\"><code>log.Record</code></a> values. This is a <code>struct</code> which contains an <code>AppLogs</code> field which is a slice of <a href=\"https://cloud.google.com/appengine/docs/go/logs/reference#AppLog\" rel=\"nofollow\"><code>log.AppLog</code></a>. This <code>AppLog</code> type (it's also a <code>struct</code>) descirbes an application log made by e.g. a <code>context.Debugf()</code> call.</p>\n\n<p>The <code>AppLog</code> type looks like this:</p>\n\n<pre><code>type AppLog struct {\n    Time    time.Time\n    Level   int\n    Message string\n}\n</code></pre>\n\n<p>The <code>Message</code> is the <code>string</code> result of the formatted log message.</p>\n\n<p>Here is an example how to query the log records including Application logs:</p>\n\n<pre><code>c := appengine.NewContext(r)\nquery := &amp;log.Query{\n    AppLogs:  true,\n    Versions: []string{\"1\"},\n}\n\nfor results := query.Run(c); ; {\n    record, err := results.Next()\n    if err == log.Done {\n        c.Infof(\"Done processing results\")\n        break\n    }\n    if err != nil {\n        c.Errorf(\"Failed to retrieve next log: %v\", err)\n        break\n    }\n    // Do something with record\n    // Process Application logs:\n\n    for _, ap := range record.AppLogs {\n        msg := ap.Message\n        // msg is an application log text message\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 4957438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f05cbb8a908ef71d0516bba78ba6b6?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron Alpar", "link": "https://stackoverflow.com/users/4957438/aaron-alpar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1433069314, "creation_date": 1433033445, "last_edit_date": 1433055523, "question_id": 30552762, "link": "https://stackoverflow.com/questions/30552762/can-only-access-request-logs-from-google-app-engine-golang-application", "title": "Can only access request-logs from Google App Engine golang application", "body": "<p>I have a GAE golang application that has logging statements that look something like:</p>\n\n<pre><code>func LogDebugMessage(req *http.Request) {\n  context := appengine.NewContext(req)\n  c.Debugf(\"#%d Debugging Here.\", 1)\n}\n</code></pre>\n\n<p>How can I access the logging messages generated by the <code>c.Debugf</code> call?</p>\n\n<p>The <code>appcfg.py request_logs</code> and GAE console (<code>https://console.developers.google.com/project/.../logs</code>) both appear to only have HTTP request logs.</p>\n\n<p>Is there another tool to request logs generated by the GAE context?</p>\n"}, {"tags": ["go", "sudo", "setuid"], "comments": [{"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 1, "creation_date": 1433034505, "post_id": 30552760, "comment_id": 49177889, "body": "You can only marshal/unmarshal into a public struct member. Those are identified by their initial capital letter. The (un)marshallers (JSON for example) take care of the case conversion for you."}], "answers": [{"tags": [], "owner": {"reputation": 1051, "user_id": 809410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1ffc49c668c0066df3196ecf48aa39f?s=128&d=identicon&r=PG", "display_name": "iant", "link": "https://stackoverflow.com/users/809410/iant"}, "is_accepted": true, "score": 8, "last_activity_date": 1433091166, "creation_date": 1433091166, "answer_id": 30560016, "question_id": 30552760, "link": "https://stackoverflow.com/questions/30552760/is-setgid-setuid-on-a-golang-binary-safe/30560016#30560016", "title": "Is SetGID/SetUID on a Go[lang] binary safe?", "body": "<p>A setuid/setgid Go program is reasonably safe, with one major caveat.  Go setuid/setgid programs are in general no more, and no less, secure than C/C++ setuid/setgid programs.</p>\n\n<p>It's true that you can force a Go program to dump core by running it with the environment variable GOTRACEBACK=crash and then sending it a signal.  However, this is OK for your purposes because the Go program will (try to) create the core dump by sending itself the SIGABRT signal.  The kernel will not generate a core dump for a setuid/setgid program killed by a signal.</p>\n\n<p>The major caveat for Go is that on GNU/Linux systems you can not drop back to the original user ID.  This is because of how setuid (and setgid, setgroups, setreuid, setregid, setresuid, and setresgid) are implemented for multi-threaded programs on GNU/Linux.  The details are at <a href=\"http://golang.org/issue/1435\" rel=\"noreferrer\">http://golang.org/issue/1435</a> .</p>\n\n<p>On your final note Uw and Pw need to be capitalized because the standard reflect package does not permit writing to unexported fields.</p>\n"}], "owner": {"reputation": 15668, "user_id": 149076, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZHnYp.jpg?s=128&g=1", "display_name": "Jim Dennis", "link": "https://stackoverflow.com/users/149076/jim-dennis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2668, "favorite_count": 2, "accepted_answer_id": 30560016, "answer_count": 1, "score": 6, "last_activity_date": 1560640391, "creation_date": 1433033432, "last_edit_date": 1560640391, "question_id": 30552760, "link": "https://stackoverflow.com/questions/30552760/is-setgid-setuid-on-a-golang-binary-safe", "title": "Is SetGID/SetUID on a Go[lang] binary safe?", "body": "<p>I've written a simple <a href=\"/questions/tagged/go\" class=\"post-tag\" title=\"show questions tagged &#39;go&#39;\" rel=\"tag\">go</a> program using YAML and the MySQL drivers with the intention of providing a simple utility to update a database without exposing the username and password credentials to the user executing the program.</p>\n\n<p>(I'm well aware that I could also write this in Python or some other scripting language and manage the permissions delegations using <a href=\"/questions/tagged/sudo\" class=\"post-tag\" title=\"show questions tagged &#39;sudo&#39;\" rel=\"tag\">sudo</a> but I'd like to try a different approach here, for my own edification).</p>\n\n<p>After building the program I've used <code>chgrp sys dbcreds.yaml &amp;&amp; chmod 0640 dbcreds.yaml</code> and <code>chgrp sys ./myprog &amp;&amp; chmod g+s ./myprog</code> (as root) ... and everything seems to work.  (I also tested that access was denied, as it should be, prior to the setGID step).</p>\n\n<p>I also tested <code>strace</code> and that results in permission denied (as it should be). (For fun I also ran <code>ltrace -S</code> on it; this is under Linux.  As expected I did not see many normal libc function calls ... through I am surprised to have seen a few <em>pthread_....()</em> and one <em>malloc()</em> calls in that listing.  I guess the GO runtime does link to some system library functions after all).</p>\n\n<p>My question: is this safe?  Is there any known way to cause a Go program, such as this (below) to core dump or expose its memory after it has read these private credentials?  Is there a way to drop my SGID privs after I've read my credentials?  Are there any examples of SUID/SGID exploits on Go binaries?  Is there a better way to do this?  Is there a way to proactive prevent core dumps or ensure that sensitive data (credentials) would not be in core dumps?</p>\n\n<p>One other note: I find the <strong>gopkg.in/yaml.v2</strong> semantics to be a bit disconcerting.  In my YAML file I have something like:</p>\n\n<pre><code>---\nuser me\npw mypassword\n</code></pre>\n\n<p>But in my code I have to use <strong><em>User</em></strong> and <strong><em>Pw</em></strong> (capitalized) rather than using lower case as I would have expected.  I presume this is an implementation decision by the authors of <a href=\"http://gopkg.in/yaml.v2\" rel=\"nofollow noreferrer\">Goyaml</a>.  Is that so?</p>\n\n<pre><code>#!go\npackage main\n\nimport (\n    \"fmt\"\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\"\n    \"gopkg.in/yaml.v2\"\n    \"io/ioutil\"\n    \"os\"\n    \"strconv\"\n)\n\ntype Creds struct {\n    User string\n    Pw   string\n}\n\nfunc main() {\n\n    filename := \"./dbcreds.yaml\"\n    var creds Creds\n    conf, err := ioutil.ReadFile(filename)\n    if err != nil {\n        panic(err)\n    }\n    err = yaml.Unmarshal(conf, &amp;creds)\n    if err != nil {\n        panic(err)\n    }\n\n    var arg1 int\n    arg1, err = strconv.Atoi(os.Args[1])\n    if err != nil {\n        panic(err.Error()) // Just for example purpose. You should use proper error handling instead of panic\n    }\n\n    fmt.Println(\"arg1: \", arg1, \"\\n\")\n    dsn := fmt.Sprintf(\"%s:%s@/mydatabase\", creds.User, creds.Pw)\n    db, err := sql.Open(\"mysql\", dsn)\n    if err != nil {\n        panic(err.Error())\n    }\n    defer db.Close()\n\n    err = db.Ping()\n    if err != nil {\n        panic(err.Error())\n    }\n\n    stmtOut, err := db.Prepare(\"SELECT quant FROM c WHERE id &gt;= ?\")\n    if err != nil {\n        panic(err.Error())\n    }\n    defer stmtOut.Close()\n\n    rows, err := stmtOut.Query(arg1)\n    if err != nil {\n        panic(err.Error())\n    }\n    defer rows.Close()\n\n    for rows.Next() {\n        var quant int\n        err = rows.Scan(&amp;quant)\n        if err != nil {\n            panic(err.Error())\n        }\n        fmt.Println(quant)\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11566, "user_id": 1262820, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mq3Cq.png?s=128&g=1", "display_name": "felipsmartins", "link": "https://stackoverflow.com/users/1262820/felipsmartins"}, "edited": false, "score": 0, "creation_date": 1433030210, "post_id": 30552447, "comment_id": 49177183, "body": "Do you want something like proxy (or proxy itself)?"}, {"owner": {"reputation": 4073, "user_id": 2626491, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/UUSae.jpg?s=128&g=1", "display_name": "Alex Woolford", "link": "https://stackoverflow.com/users/2626491/alex-woolford"}, "edited": false, "score": 0, "creation_date": 1433030503, "post_id": 30552447, "comment_id": 49177246, "body": "There are lots of services to obfuscate your IP address (e.g. proxies, VPN&#39;s, Tor). I suspect you&#39;ll need to do something like that rather than spoof your IP, otherwise you&#39;d never get to see the page since it would be served to and IP address that&#39;s not yours."}, {"owner": {"reputation": 954, "user_id": 313941, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/ZAUgh.jpg?s=128&g=1", "display_name": "kainlite", "link": "https://stackoverflow.com/users/313941/kainlite"}, "edited": false, "score": 2, "creation_date": 1433030535, "post_id": 30552447, "comment_id": 49177254, "body": "I&#39;ve several public ips on my server, What I want to do is select which one to use for web requests, for example like this: <a href=\"http://commandliners.com/2010/03/downloading-a-file-with-wget-through-a-specific-interface/\" rel=\"nofollow noreferrer\">commandliners.com/2010/03/&hellip;</a> but I don&#39;t want to rely on extenal binaries... neither I want to spoof my ip address..."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1433031545, "post_id": 30552447, "comment_id": 49177436, "body": "See the <code>LocalAddr</code> field of <a href=\"https://golang.org/pkg/net/#Dialer\" rel=\"nofollow noreferrer\"><code>net.Dialer</code></a>. Most the standard packages have a way to specify your own dialer rather the default."}, {"owner": {"reputation": 954, "user_id": 313941, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/ZAUgh.jpg?s=128&g=1", "display_name": "kainlite", "link": "https://stackoverflow.com/users/313941/kainlite"}, "edited": false, "score": 1, "creation_date": 1433032210, "post_id": 30552447, "comment_id": 49177537, "body": "That could do it, I will check it out, I will try go-curl also.. I wonder why the downvote?"}, {"owner": {"reputation": 954, "user_id": 313941, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/ZAUgh.jpg?s=128&g=1", "display_name": "kainlite", "link": "https://stackoverflow.com/users/313941/kainlite"}, "edited": false, "score": 0, "creation_date": 1433032405, "post_id": 30552447, "comment_id": 49177566, "body": "Also can someone bring up an answer with a working example ? thanks"}], "answers": [{"comments": [{"owner": {"reputation": 954, "user_id": 313941, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/ZAUgh.jpg?s=128&g=1", "display_name": "kainlite", "link": "https://stackoverflow.com/users/313941/kainlite"}, "edited": false, "score": 1, "creation_date": 1433034138, "post_id": 30552705, "comment_id": 49177820, "body": "that worked like a charm, this is the resulting code as an experiment with a vpn on my development machine... <a href=\"http://play.golang.org/p/Bh8gfggLK-\" rel=\"nofollow noreferrer\">play.golang.org/p/Bh8gfggLK-</a>  also go-curl works with  easy.Setopt(curl.OPT_INTERFACE, &quot;10.9.8.2&quot;).. thanks :)"}, {"owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "reply_to_user": {"reputation": 954, "user_id": 313941, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/ZAUgh.jpg?s=128&g=1", "display_name": "kainlite", "link": "https://stackoverflow.com/users/313941/kainlite"}, "edited": false, "score": 0, "creation_date": 1474854526, "post_id": 30552705, "comment_id": 66686408, "body": "@kainlite Are you sure that works? I&#39;m getting an error from ResolveTCPAddr (you&#39;re ignoring it): dial tcp 10.9.8.2:8080-&gt;54.221.194.87:80: bind: can&#39;t assign requested address (I had to add a port on it because of a previous &quot;couldn&#39;t find port&quot; error)."}, {"owner": {"reputation": 954, "user_id": 313941, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/ZAUgh.jpg?s=128&g=1", "display_name": "kainlite", "link": "https://stackoverflow.com/users/313941/kainlite"}, "edited": false, "score": 0, "creation_date": 1474861633, "post_id": 30552705, "comment_id": 66687754, "body": "You need to use an ip address from your net, I use that ip for a vpn"}, {"owner": {"reputation": 1790, "user_id": 1370397, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4cd00d196b2f9bef669ce212eec963b1?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1370397/alex"}, "edited": false, "score": 0, "creation_date": 1497559909, "post_id": 30552705, "comment_id": 76142344, "body": "@JimB which IP address will the default Go http.Client choose?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1790, "user_id": 1370397, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4cd00d196b2f9bef669ce212eec963b1?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1370397/alex"}, "edited": false, "score": 1, "creation_date": 1497566705, "post_id": 30552705, "comment_id": 76145097, "body": "@alex: the Go client doesn&#39;t choose an address, it works just like any other <code>connect</code> call and lets the system assign an address to the socket if there isn&#39;t one."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 21, "last_activity_date": 1497541129, "last_edit_date": 1497541129, "creation_date": 1433032607, "answer_id": 30552705, "question_id": 30552447, "link": "https://stackoverflow.com/questions/30552447/how-to-set-which-ip-to-use-for-a-http-request/30552705#30552705", "title": "How to set which IP to use for a HTTP request?", "body": "<p>You can set a custom Dialer in the Client's Transport.</p>\n\n<pre><code>// Create a transport like http.DefaultTransport, but with a specified localAddr\ntransport := &amp;http.Transport{\n    Proxy: http.ProxyFromEnvironment,\n    DialContext: (&amp;net.Dialer{\n        Timeout:   30 * time.Second,\n        KeepAlive: 30 * time.Second,\n        LocalAddr: localAddr,\n        DualStack: true,\n    }).DialContext,\n    MaxIdleConns:          100,\n    IdleConnTimeout:       90 * time.Second,\n    TLSHandshakeTimeout:   10 * time.Second,\n    ExpectContinueTimeout: 1 * time.Second,\n}\n\nclient := &amp;http.Client{\n    Transport: transport,\n}\n</code></pre>\n"}], "owner": {"reputation": 954, "user_id": 313941, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/ZAUgh.jpg?s=128&g=1", "display_name": "kainlite", "link": "https://stackoverflow.com/users/313941/kainlite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5107, "favorite_count": 3, "accepted_answer_id": 30552705, "answer_count": 1, "score": 9, "last_activity_date": 1497541129, "creation_date": 1433029463, "question_id": 30552447, "link": "https://stackoverflow.com/questions/30552447/how-to-set-which-ip-to-use-for-a-http-request", "title": "How to set which IP to use for a HTTP request?", "body": "<p>I dont know if it's possible as the std lib does not state anything about the current address being used:</p>\n\n<p><a href=\"http://golang.org/pkg/net/http/\" rel=\"noreferrer\">http://golang.org/pkg/net/http/</a></p>\n\n<pre><code>resp, err := http.Get(\"http://example.com/\")\nif err != nil {\n    // handle error\n}\ndefer resp.Body.Close()\nbody, err := ioutil.ReadAll(resp.Body)\n</code></pre>\n\n<p>What I'm trying to do is set the source address for that http request, why? because I don't want to use my primary ip address for that kind of stuff...</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1433069354, "last_edit_date": 1495541706, "creation_date": 1433067831, "answer_id": 30556320, "question_id": 30551659, "link": "https://stackoverflow.com/questions/30551659/in-google-app-engine-for-go-how-can-a-property-have-values-of-more-than-one-typ/30556320#30556320", "title": "In Google App Engine for Go, how can a property have values of more than one type?", "body": "<p>You do not necessarily have to declare a specific type for a property in a backing struct.</p>\n\n<p>By implementing the <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference#PropertyLoadSaver\" rel=\"nofollow noreferrer\"><code>PropertyLoadSaver</code></a> interface, you can dynamically do whatever you want with the properties of an entity during loading or before saving. See <a href=\"https://stackoverflow.com/a/29888449/1705598\"><strong>this answer</strong></a> which shows how to represent an entity as a general <code>map[string]interface{}</code> type in Go, so it can have dynamic properties.</p>\n\n<h3>Back to your question:</h3>\n\n<blockquote>\n  <p>A property can have values of more than one type.</p>\n</blockquote>\n\n<p>This is true. But if you want to make this work, you will also have to utilize a custom loading/saving mechanism through the <code>PropertyLoadSaver</code> interface.</p>\n\n<p>First define a backing <code>struct</code> where the property which will have multiple values of different types may be an <code>[]interface{}</code>:</p>\n\n<pre><code>type MyMy struct {\n    Objects []interface{}\n}\n</code></pre>\n\n<p>Next we have to implement <code>PropertyLoadSaver</code>. When loading, we will just append all values to the <code>Objects</code> slice that come with the name <code>\"Objects\"</code>.</p>\n\n<p>When saving, we will loop over the elements of the <code>Objects</code> slice and send all its values with the same property name. This will ensure they will be saved under the same property, and we also have to specify the <code>Multiple</code> field to be <code>true</code> (multi-value property):</p>\n\n<pre><code>func (m *MyMy) Load(ch &lt;-chan datastore.Property) error {\n    for p := range ch { // Read until channel is closed\n        if p.Name == \"Objects\" {\n            m.Objects = append(m.Objects, p.Value)\n        }\n    }\n    return nil\n}\n\nfunc (m *MyMy) Save(ch chan&lt;- datastore.Property) error {\n    defer close(ch)\n    for _, v := range m.Objects {\n        switch v2 := v.(type) {\n        case int64: // Here v2 is of type int64\n            ch &lt;- datastore.Property{Name: \"Objects\", Value: v2, Multiple: true}\n        case string:  // Here v2 is of type string\n            ch &lt;- datastore.Property{Name: \"Objects\", Value: v2, Multiple: true}\n        case float64: // Here v2 is of type float64\n            ch &lt;- datastore.Property{Name: \"Objects\", Value: v2, Multiple: true}\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>Note that setting a value of type <code>interface{}</code> as the <code>Property.Value</code> would result in an error, that is why I used a <a href=\"https://golang.org/ref/spec#Type_switches\" rel=\"nofollow noreferrer\">Type switch</a> so I will set concrete types. In my example I only supported 3 types (<code>int64</code>, <code>string</code> and <code>float64</code>) but you can just as easily add more types by adding new <code>case</code> branches.</p>\n\n<h3>And using it:</h3>\n\n<p>And finally using our custom <code>MyMy</code> type to save a new entity with property \"Objects\" which will have multiple values and of different types:</p>\n\n<pre><code>m := MyMy{[]interface{}{int64(1234), \"strval\", 32.2}}\nkey, err := datastore.Put(c, datastore.NewIncompleteKey(c, \"MyMy\", nil), &amp;m)\n</code></pre>\n"}], "owner": {"reputation": 750, "user_id": 654493, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/048fb052b006f21b685400b71e964b32?s=128&d=identicon&r=PG", "display_name": "David Smith", "link": "https://stackoverflow.com/users/654493/david-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 1, "accepted_answer_id": 30556320, "answer_count": 1, "score": 3, "last_activity_date": 1475273326, "creation_date": 1433022108, "last_edit_date": 1475273326, "question_id": 30551659, "link": "https://stackoverflow.com/questions/30551659/in-google-app-engine-for-go-how-can-a-property-have-values-of-more-than-one-typ", "title": "In Google App Engine for Go, how can a property have values of more than one type?", "body": "<p>The Google App Engine for Go <a href=\"https://cloud.google.com/appengine/docs/go/datastore/entities#Go_Properties_and_value_types\" rel=\"nofollow\">datastore docs</a> say, <strong>\"\nA property can have values of more than one type\"</strong>. There is no example or further explanation. (Version: appengine 1.9.19.)</p>\n\n<p>How can a property have more than one type if you must declare that property with a specific type in the backing struct?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1433011287, "post_id": 30549898, "comment_id": 49171993, "body": "i.e. although a <code>nil</code> slice has <a href=\"https://godoc.org/builtin#len\" rel=\"nofollow noreferrer\"><code>len</code></a> zero it is not the same as an &quot;actual&quot;/non-nil slice of length zero (with or without a zero capacity doesn&#39;t matter except for appending)."}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 6, "last_activity_date": 1433010946, "creation_date": 1433010946, "answer_id": 30549898, "question_id": 30549522, "link": "https://stackoverflow.com/questions/30549522/returning-an-empty-array-if-the-database-is-empty/30549898#30549898", "title": "returning an empty array if the database is empty", "body": "<p>Replace:</p>\n\n<pre><code>    var ib Inbox\n</code></pre>\n\n<p>with:</p>\n\n<pre><code>    var ib Inbox\n    ib.Messages = make([]*Message, 0)\n</code></pre>\n\n<p>or with:</p>\n\n<pre><code>    ib := Inbox{Messages: make([]*Message, 0)}\n</code></pre>\n\n<p>(Optionally using <code>make(\u2026, 0, someInitialCapacity)</code> instead.)</p>\n"}], "owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3335, "favorite_count": 0, "accepted_answer_id": 30549898, "answer_count": 1, "score": 1, "last_activity_date": 1594492210, "creation_date": 1433008890, "last_edit_date": 1433009675, "question_id": 30549522, "link": "https://stackoverflow.com/questions/30549522/returning-an-empty-array-if-the-database-is-empty", "title": "returning an empty array if the database is empty", "body": "<p>The front end of my application expects json to be returned from the server under a namespace (like <code>messages</code> below)</p>\n\n<pre><code>{\n   messages: [{\n       \"id\": \"6b2360d0\" //other properties omitted\n\n   },{\n       \"id\": \"a01dfaa0\" //other properties omitted\n\n   }]\n}\n</code></pre>\n\n<p>If there are no messages, I need to return an empty array with the namespace</p>\n\n<pre><code>{\n\n    messages: []\n}\n</code></pre>\n\n<p>However, the code below currently returns <code>null</code> if no messages are pulled from the db</p>\n\n<pre><code>{\n\n        messages: null\n    }\n</code></pre>\n\n<p>How can I change the code below so that  </p>\n\n<pre><code>  {\n\n        messages: []\n    }\n</code></pre>\n\n<p>is returned if there are no messages in the db?</p>\n\n<pre><code>type Inbox struct {\n    Messages []*Message `json:\"messages\"`\n}\ntype Message struct {\n    Content string `json:\"type\"`\n    Date string `json:\"date\"`\n    Id   string `json:\"id\"`\n}\n\nfunc fetchMessages(w http.ResponseWriter, req *http.Request) {\n\n    var ib Inbox\n\n    var index int = 0\n\n    err := db.View(func(tx *bolt.Tx) error {\n\n        c := tx.Bucket([]byte(\"messages\")).Cursor()\n\n        for k, v := c.Last(); k != nil &amp;&amp; index &lt; 10; k, v = c.Prev() {\n\n         //note the next few lines might appear odd, currently each  json object to be added to the array of messages is also namespaced under 'message', so I first unmarshal it to a map and then unmarshal again into a the struct\n            var objmap map[string]*json.RawMessage\n            if err := json.Unmarshal(v, &amp;objmap); err != nil {\n                return err\n            }\n\n            message := &amp;Message{}\n            if err := json.Unmarshal(*objmap[\"message\"], &amp;message); err != nil {\n                return err\n            }\n\n            ib.Messages = append(ib.Messages, message)\n\n        }\n\n        return nil\n    })\n\n    response, _ := json.Marshal(a)\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.WriteHeader(http.StatusOK)\n    w.Write(response)\n\n}\n</code></pre>\n"}, {"tags": ["concurrency", "go", "goroutine"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1433009520, "post_id": 30548428, "comment_id": 49171445, "body": "Side note: it is unsafe to read and write the same variable (<code>stop</code>) concurrently. Don&#39;t <i>ever</i> do this. This is a classic data race and has <a href=\"https://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong\" rel=\"nofollow noreferrer\">completely undefined behaviour</a>. Go&#39;s <a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">race detector</a> can point these out to you."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1433009854, "post_id": 30548428, "comment_id": 49171544, "body": "You aren&#39;t actually sending anything in this example. However, if you&#39;re just wanting raw data (strings, bytes) then perhaps an <code>io.Pipe</code> may be convenient with both sides doing a <code>defer myside.Close()</code> (where <code>myside</code> is either the read or write side of the pipe as appropriate). In the general case you&#39;d use a channel to send the data and the writer can close it to signal it&#39;s done; but the reader shouldn&#39;t/can&#39;t close; that usually means you&#39;d need a separate channel or other synchronization mechanism to signal the writer to exit."}], "answers": [{"comments": [{"owner": {"reputation": 2593, "user_id": 2030040, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Dea0s.jpg?s=128&g=1", "display_name": "sujin", "link": "https://stackoverflow.com/users/2030040/sujin"}, "edited": false, "score": 0, "creation_date": 1433057942, "post_id": 30549695, "comment_id": 49181939, "body": "Thanks for your response. In your solution after  fmt.Scanf executed then only  execution will come to select and for return, my question when there is no input for fmt.Scanf then how i can close the go routine."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2593, "user_id": 2030040, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Dea0s.jpg?s=128&g=1", "display_name": "sujin", "link": "https://stackoverflow.com/users/2030040/sujin"}, "edited": false, "score": 0, "creation_date": 1433083778, "post_id": 30549695, "comment_id": 49189039, "body": "@sujin: as explained in the answer, you can&#39;t directly interrupt the Read of stdin (this isn&#39;t a Go issue, in POSIX you can&#39;t interrupt a <code>read</code> from another thread). You could use the <code>select</code> syscall to only read if data is available, and return from the goroutine asynchronously, but why bother? If you know what the end of the input is supposed to be, return then. If the input stream ends, you get <code>EOF</code>. If you don&#39;t know what the end of the input stream is, then you either have an error, or you need to leave the Read open anyway."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 1, "last_activity_date": 1433010119, "last_edit_date": 1433010119, "creation_date": 1433009765, "answer_id": 30549695, "question_id": 30548428, "link": "https://stackoverflow.com/questions/30548428/how-to-close-the-goroutine-which-waiting-on-i-o/30549695#30549695", "title": "How to Close the goroutine which waiting on I/O", "body": "<p>To start, your code has a race around the <code>stop</code> variable. When there's a data race, there's no guarantee your program will behave as defined. Use channels to synchronize goroutines. This however isn't why you program continues.</p>\n\n<p>Your code is blocking on <code>fmt.Scanf</code>, and doesn't get to check the <code>stop</code> condition. Since a Read on Stdin can't be interrupted (which is happening inside <code>fmt.Scanf</code>), you need to check for the stop condition <em>before</em> calling <code>Scanf</code>again. If there's no more input, but you have a pending Read on Stdin, the easiest way to handle it is to just let leave that goroutine running. There are some rather complex ways to break out of this using something known as the \"self-pipe\" trick, but it's generally not worth the effort, as goroutines are small and don't take many resources. </p>\n\n<pre><code>for !stop {\n    fmt.Scanf(\"%s\", &amp;str)\n    fmt.Println(\"Entered :\", str)\n    // use a channel to detect when to exit\n    select {\n    case &lt;-stop:\n        return\n    default:\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2593, "user_id": 2030040, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Dea0s.jpg?s=128&g=1", "display_name": "sujin", "link": "https://stackoverflow.com/users/2030040/sujin"}, "edited": false, "score": 0, "creation_date": 1433066024, "post_id": 30555859, "comment_id": 49183860, "body": "In your example code listen() go routine will not exited after 5 write at by write() go routine because it will stay in the for loop itself, it probably a leak. only main() and write() will exited properly. use panic statement at end of the main and check the stack trace.  This expecting solution for this scenario"}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "reply_to_user": {"reputation": 2593, "user_id": 2030040, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Dea0s.jpg?s=128&g=1", "display_name": "sujin", "link": "https://stackoverflow.com/users/2030040/sujin"}, "edited": false, "score": 1, "creation_date": 1433080723, "post_id": 30555859, "comment_id": 49188075, "body": "I agree with JimB; easiest to leave the goroutine running if the scan can&#39;t be avoided. But perhaps this <a href=\"https://github.com/mindreframer/golang-devops-stuff/blob/master/src/github.com/mitchellh/packer/stdin.go\" rel=\"nofollow noreferrer\">pipe technique</a> or <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/4ZrDw__VkyI\" rel=\"nofollow noreferrer\">this thread</a> could help?"}], "tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": false, "score": 3, "last_activity_date": 1433064492, "creation_date": 1433064492, "answer_id": 30555859, "question_id": 30548428, "link": "https://stackoverflow.com/questions/30548428/how-to-close-the-goroutine-which-waiting-on-i-o/30555859#30555859", "title": "How to Close the goroutine which waiting on I/O", "body": "<p>As Dave C &amp; JimB say, use channels to coordinate goroutines. Here's an example that may help. </p>\n\n<p>Exit after receiving 5 messages from the user:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nvar pipe = make(chan string) //shares text entered by user\nvar stop = make(chan bool)   //shares stop signal\n\nfunc listen() {\n    for {\n        var input string\n        fmt.Scan(&amp;input)\n        pipe &lt;- input\n    }\n}\n\nfunc write() {\n    for i := 0; i &lt; 5; i++ {\n        var output string\n        output = &lt;-pipe\n        fmt.Println(\"Received\", output)\n    }\n\n    stop &lt;- true\n}\n\nfunc main() {\n    go listen()\n    go write()\n\n    &lt;-stop\n}\n</code></pre>\n"}], "owner": {"reputation": 2593, "user_id": 2030040, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Dea0s.jpg?s=128&g=1", "display_name": "sujin", "link": "https://stackoverflow.com/users/2030040/sujin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2711, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1433064492, "creation_date": 1433002581, "question_id": 30548428, "link": "https://stackoverflow.com/questions/30548428/how-to-close-the-goroutine-which-waiting-on-i-o", "title": "How to Close the goroutine which waiting on I/O", "body": "<p>I have created two go routines <strong>sender</strong> and <strong>receiver</strong>, sender will continuous get the data from the user(keyboard) and write to stream, receiver will independently get the value from stream print it to the screen. Both are concurrent using go routine</p>\n\n<p>At some point of time receiver failed and close the connection as well as exit the receiver go routine, but sender go routine which waiting for user input(i/o operation) will not be closed. How to exit all the go routines in this scenario?</p>\n\n<p>Below is the piece of sample code for this scenario.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nvar stop bool = false\n\nfunc sender() {\n    str := \"\"\n    for !stop {\n        fmt.Scanf(\"%s\", &amp;str)\n        fmt.Println(\"Entered :\", str)\n    }   \n    fmt.Println(\"Closing sender goroutine\")\n}\n\nfunc receiver() {\n    i := 0\n    for !stop {\n        i++\n        if i &gt; 5 { \n            stop = true\n        }\n        time.Sleep(1 * time.Second)\n    }   \n    fmt.Println(\"Closing receiver goroutine\")\n}\n\nfunc main() {\n    go sender()\n    go receiver()\n\n    /* Wait for goroutines to finish */\n    for !stop {\n        time.Sleep(1 * time.Millisecond)\n    }   \n    time.Sleep(1 * time.Second)\n\n    panic(\"Display stack\")\n}\n</code></pre>\n\n<p>Above code sender will wait for user input after 5 loop receiver will exit the receiver go routine. <em><code>I expect when receiver close, go routine which waiting on i/o has to be closed.</code></em></p>\n\n<p>Kindly help me on this question.</p>\n"}, {"tags": ["concurrency", "go", "mutex"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1433004060, "post_id": 30547916, "comment_id": 49169573, "body": "Does this code reproduce the problem for you consistently? I can&#39;t get it to hang."}], "answers": [{"comments": [{"owner": {"reputation": 11530, "user_id": 207894, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1f10c2fce594fe4d5bc05b6e5f466e6a?s=128&d=identicon&r=PG", "display_name": "Ory Band", "link": "https://stackoverflow.com/users/207894/ory-band"}, "edited": false, "score": 0, "creation_date": 1433268070, "post_id": 30549188, "comment_id": 49274917, "body": "So, to summarize: A goroutine shouldn&#39;t RLock twice, or Rlock and then Lock. The reason is that there is an order (like a queue) to unlocking."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 11530, "user_id": 207894, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1f10c2fce594fe4d5bc05b6e5f466e6a?s=128&d=identicon&r=PG", "display_name": "Ory Band", "link": "https://stackoverflow.com/users/207894/ory-band"}, "edited": false, "score": 0, "creation_date": 1433272337, "post_id": 30549188, "comment_id": 49277356, "body": "@OryBand; not quite. A single goroutine <b>can&#39;t</b> <code>Lock</code> twice (the second will <b>always block forever</b>; same for <code>RLock</code> then <code>Lock</code> on the same <code>RWMutex</code>). And a single goroutine shouldn&#39;t <code>RLock</code> the same lock twice, not because of any ordering (there is no queue for waiting/unlocking) but because the second <i>can block</i> (it won&#39;t always) effectively waiting forever on the first lock it already holds (actually waiting on a writer that&#39;s waiting on the first)."}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 10, "last_activity_date": 1433082992, "last_edit_date": 1433082992, "creation_date": 1433006759, "answer_id": 30549188, "question_id": 30547916, "link": "https://stackoverflow.com/questions/30547916/goroutine-blocks-when-calling-rwmutex-rlock-twice-after-an-rwmutex-unlock/30549188#30549188", "title": "goroutine blocks when calling RWMutex RLock twice after an RWMutex Unlock", "body": "<p>This is one of several standard behaviours for a read-write lock. What <a href=\"https://en.wikipedia.org/wiki/Read-write_lock\" rel=\"noreferrer\">Wikipedia calls \"Write-preferring RW locks\"</a>.</p>\n\n<p>The documentation for <code>sync's</code> <a href=\"https://golang.org/pkg/sync/#RWMutex.Lock\" rel=\"noreferrer\"><code>RWMutex.Lock</code></a> says:</p>\n\n<blockquote>\n  <p>To ensure that the lock eventually becomes available, a blocked Lock call excludes new readers from acquiring the lock.</p>\n</blockquote>\n\n<p>Otherwise a series of readers that each acquired the read lock before the previous released it could starve out writes indefinitely.</p>\n\n<p>This means that it is always unsafe to call <code>RLock</code> on a <code>RWMutex</code> that the same goroutine already has read locked. (Which by the way is also true of <code>Lock</code> on regular mutexes as well, as Go's mutexes do not support recursive locking.)</p>\n\n<p>The reason it is unsafe is that if the goroutine ever blocks getting the second read lock (due to a blocked writer) it will never release the first read lock. This will cause every future lock call on the mutex to block forever, deadlocking part or all of the program. Go will only detect a deadlock if all goroutines are blocked.</p>\n"}], "owner": {"reputation": 11530, "user_id": 207894, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1f10c2fce594fe4d5bc05b6e5f466e6a?s=128&d=identicon&r=PG", "display_name": "Ory Band", "link": "https://stackoverflow.com/users/207894/ory-band"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1891, "favorite_count": 0, "accepted_answer_id": 30549188, "answer_count": 1, "score": 4, "last_activity_date": 1433082992, "creation_date": 1432999659, "question_id": 30547916, "link": "https://stackoverflow.com/questions/30547916/goroutine-blocks-when-calling-rwmutex-rlock-twice-after-an-rwmutex-unlock", "title": "goroutine blocks when calling RWMutex RLock twice after an RWMutex Unlock", "body": "<pre><code>var mu sync.RWMutex\n\ngo func() {\n    mu.RLock()\n    defer mu.RUnlock()\n\n    mu.RLock()  // In my real scenario this second lock happened in a nested function.\n    defer mu.RUnlock()\n\n    // More code.\n}()\n\nmu.Lock()\nmu.Unlock()  // The goroutine above still hangs.\n</code></pre>\n\n<p>If a function read-locks a read/write mutex twice, while another function write-locks and then write-<strong>un</strong>locks that same mutex, the original function still hangs.</p>\n\n<p>Why is that? Is it  because there's a serial order in which mutexes allow code to execute?</p>\n\n<p>I've just solved a scenario like this (which took me hours to pinpoint) by removing the second <code>mu.RLock()</code> line.</p>\n"}, {"tags": ["http", "go", "couchdb"], "comments": [{"owner": {"reputation": 6288, "user_id": 2499076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72dcd37bc8460b1645d72f7a8248156e?s=128&d=identicon&r=PG", "display_name": "Ewan Mellor", "link": "https://stackoverflow.com/users/2499076/ewan-mellor"}, "edited": false, "score": 0, "creation_date": 1432955494, "post_id": 30541591, "comment_id": 49156828, "body": "If CouchDB is &quot;barfing stack traces into the logs&quot; then you should add those to the question."}, {"owner": {"reputation": 1924, "user_id": 1090568, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vY6kD.png?s=128&g=1", "display_name": "James Adam", "link": "https://stackoverflow.com/users/1090568/james-adam"}, "reply_to_user": {"reputation": 6288, "user_id": 2499076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72dcd37bc8460b1645d72f7a8248156e?s=128&d=identicon&r=PG", "display_name": "Ewan Mellor", "link": "https://stackoverflow.com/users/2499076/ewan-mellor"}, "edited": false, "score": 0, "creation_date": 1432987306, "post_id": 30541591, "comment_id": 49164374, "body": "Ok, added the stack trace.  If it matters, I&#39;m running CouchDB 1.6.1 and Go 1.4.1 on FreeBSD 10.1 :)"}], "answers": [{"comments": [{"owner": {"reputation": 1924, "user_id": 1090568, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vY6kD.png?s=128&g=1", "display_name": "James Adam", "link": "https://stackoverflow.com/users/1090568/james-adam"}, "edited": false, "score": 0, "creation_date": 1432987367, "post_id": 30541828, "comment_id": 49164394, "body": "Unfortunately, Go Client requests <i>always</i> use HTTP/1.1"}], "tags": [], "owner": {"reputation": 6288, "user_id": 2499076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72dcd37bc8460b1645d72f7a8248156e?s=128&d=identicon&r=PG", "display_name": "Ewan Mellor", "link": "https://stackoverflow.com/users/2499076/ewan-mellor"}, "is_accepted": true, "score": 3, "last_activity_date": 1432955403, "creation_date": 1432955403, "answer_id": 30541828, "question_id": 30541591, "link": "https://stackoverflow.com/questions/30541591/large-put-requests-from-go-to-couchdb/30541828#30541828", "title": "Large PUT requests from Go to CouchDB", "body": "<p>I don't know the answer, but I think that the critical spec for you is <a href=\"http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html\" rel=\"nofollow\">RFC 2616 section 8.2.3</a>.  The whole section is interesting, but particularly this:</p>\n\n<blockquote>\n  <p>\"There is an exception to this rule: for compatibility with RFC 2068,\n  a server MAY send a 100 (Continue) status in response to an HTTP/1.1\n  PUT or POST request that does not include an Expect request-header\n  field with the \"100-continue\" expectation. This exception, the purpose\n  of which is to minimize any client processing delays associated with\n  an undeclared wait for 100 (Continue) status, applies only to HTTP/1.1\n  requests, and not to requests with any other HTTP-version value.\"</p>\n</blockquote>\n\n<p>It sounds like you're getting caught between Go's missing 100-continue implementation, and some kind of corner case on the CouchDB side.  (Whatever the behavior of the client, I don't think 500 Internal error is an appropriate response from the server.)</p>\n\n<p>I'd try HTTP/1.0 as a workaround, if the Go client will let you set that.</p>\n"}], "owner": {"reputation": 1924, "user_id": 1090568, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vY6kD.png?s=128&g=1", "display_name": "James Adam", "link": "https://stackoverflow.com/users/1090568/james-adam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1229, "favorite_count": 2, "accepted_answer_id": 30541828, "answer_count": 1, "score": 2, "last_activity_date": 1432989881, "creation_date": 1432952803, "last_edit_date": 1432989881, "question_id": 30541591, "link": "https://stackoverflow.com/questions/30541591/large-put-requests-from-go-to-couchdb", "title": "Large PUT requests from Go to CouchDB", "body": "<p>I've been having a vexing problem with CouchDB and Golang.  When sending POST/PUT requests to CouchDB with relatively large Body sizes (the threshold seems to be ~8000 bytes or so), the connection times out and I get a \"tcp: use of closed network connection\" error from Go.</p>\n\n<p>Eventually (a second or two later), CouchDB sends a 500 Response along with a:</p>\n\n<pre><code>{\"error\":\"unknown_error\", \"reason\": \"noproc\"}\n</code></pre>\n\n<p>in the body.  The couchdb log also has a stack trace written to it:</p>\n\n<pre><code>Stacktrace: [{couch_db,collect_results,3,\n                [{file,\"couch_db.erl\"},{line,833}]},\n             {couch_db,write_and_commit,4,\n                [{file,\"couch_db.erl\"},{line,845}]},\n             {couch_db,update_docs,4,\n                [{file,\"couch_db.erl\"},{line,782}]},\n             {couch_db,update_doc,4,\n                [{file,\"couch_db.erl\"},{line,426}]},\n             {couch_httpd_db,update_doc,6,\n                [{file,\"couch_httpd_db.erl\"},{line,753}]},\n             {couch_httpd_db,do_db_req,2,\n                [{file,\"couch_httpd_db.erl\"},{line,234}]},\n             {couch_httpd,handle_request_int,5,\n                [{file,\"couch_httpd.erl\"},{line,318}]},\n             {mochiweb_http,headers,5,\n                [{file,\"mochiweb_http.erl\"},{line,94}]}]\n</code></pre>\n\n<p>So I wrote up a quick unit test to replicate the issue (and to make sure it's not my wrapper causing the problem).  I'm making the request like so:</p>\n\n<pre><code>client := &amp;http.Client{}\nreq, err := http.NewRequest(\n    \"PUT\",\n    \"http://localhost:5984/unittestdb/testdocid1\",\n    bytes.NewReader(testBody1), //testBody1 is 10000 bytes of json object\n)\nreq.Header.Set(\"Content-Type\", \"application/json\")\nreq.Header.Set(\"Accept\", \"application/json\")\nresp, err := client.Do(req)\n</code></pre>\n\n<p>This replicated the issue... so I tried curling a large json document to couchdb.  <em>That</em> worked.  </p>\n\n<p>So, I fired up wireshark and examined the request made by my code to CouchDB and compared it to a request sent from curl.  I noticed one additional header in the Curl Request:</p>\n\n<pre><code>Expect: 100-continue\n</code></pre>\n\n<p>I had to look that one up, as I couldn't recall having seen (or maybe I just hadn't had to deal with) that header before.  So then I did a google search to see if the Golang http client supported the Expect/Continue functionality, and found this: <a href=\"https://github.com/golang/go/issues/3665\" rel=\"nofollow\">https://github.com/golang/go/issues/3665</a></p>\n\n<p>So Go doesn't support it and won't at least until 1.6.  So I assumed it must be an obscure thing and wasn't the source of my problem.  I spent a couple of hours randomly trying other stuff with the http.Client, Transport, etc.  </p>\n\n<p>Eventually, I manually set the \"Expect: 100-continue\" header in my http request in Go (if the body size is over a certain size), and ... it worked.  No timeout, no error, no couchdb barfing stack traces into the logs.  </p>\n\n<p>Now I am confused, if Go doesn't support this, how is it working?  Am I just masking the problem by doing this?  Or can I just shrug my shoulders and move on?</p>\n\n<p>I suspect there is an issue on the CouchDB side, perhaps there's a configuration setting I'm missing?</p>\n"}, {"tags": ["csv", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432929082, "post_id": 30537260, "comment_id": 49149333, "body": "What OS? What Go version? What is <code>file</code> (i.e. is it an <code>*os.File</code> or a <code>bufio.Reader</code>; is it to the network or a local filesystem or a LAN filesystem."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 3, "creation_date": 1432929250, "post_id": 30537260, "comment_id": 49149415, "body": "For 1,000,000 (one million) records, my program took <code>real 0m11.128s</code>, <code>user 0m9.148s</code> and <code>sys 0m0.316s</code>. Give us a reproducible example: <a href=\"http://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example.</a>."}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1432929578, "post_id": 30537260, "comment_id": 49149564, "body": "I have edited top post. Thank you!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1432930330, "post_id": 30537260, "comment_id": 49149888, "body": "I have no idea what <code>getResults</code> does. Are you certain the problem isn&#39;t there?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1432930381, "post_id": 30537260, "comment_id": 49149916, "body": "Never ignore errors; does <code>writer.Write</code> return a non-nil error?"}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1432931211, "post_id": 30537260, "comment_id": 49150321, "body": "yes :-(  it seems like problem somewhere else,  I just made a simple function to write 10000 records and it was  milliseconds...    I will now see what writer.Write returns."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1432931438, "post_id": 30537260, "comment_id": 49150431, "body": "@peterSO, that&#39;s slow, mine took 1.84s totsl to compile, generate 1e6 random results (740ms), and write to a new file (940ms) ;-). For 10e6 it took 17.4s (7.63s+9.53s). (Sorry, I know such numbers are irrelevant, <a href=\"https://www.quora.com/Is-there-any-banter-over-Air-Traffic-Control\" rel=\"nofollow noreferrer\">but I couldn&#39;t resist</a>.)"}, {"owner": {"reputation": 693, "user_id": 1752516, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9a7dc0642e0a6408d22d570c7502a6c8?s=128&d=identicon&r=PG&f=1", "display_name": "Jya", "link": "https://stackoverflow.com/users/1752516/jya"}, "edited": false, "score": 0, "creation_date": 1432973705, "post_id": 30537260, "comment_id": 49160557, "body": "When you find out what happened please update :-)."}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1432992166, "post_id": 30537260, "comment_id": 49165848, "body": "yes... I trying to figure... Problem that getRusults() is complicated and take hours to finish, and I know that it returned fine, but then when it starting to write, it freezes for some time... No error on writer.Write... I thinking now, that could be thing with my PC. I will check it up and reports here."}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1434276308, "post_id": 30537260, "comment_id": 49701576, "body": "I figured what it was, it was libxml via Gokogiri eating my RAM by gigabytes, and when it was ready to write CSV the memory was kind of full, and all of these cause the freezing effect. I tried various suggestions but nothing worked as I needed, so I  switched to cascadia and regex... That was solution. Goquery is also option, but I didnt tried that."}], "owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 263, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1432930164, "creation_date": 1432926429, "last_edit_date": 1432930164, "question_id": 30537260, "link": "https://stackoverflow.com/questions/30537260/golang-csv-writer-write-20k-rows-into-csv-freeze-my-pc", "title": "Golang, csv.writer.write 20k rows into CSV freeze my PC", "body": "<p>I have an issue on Linux Ubuntu with 1.4.2, which I am not sure how to sort:</p>\n\n<pre><code>func main() {\n        dir, _ := filepath.Abs(filepath.Dir(os.Args[0]))\n        outputFile, outputError := os.OpenFile(dir+\"/out1.csv\",\n                os.O_WRONLY|os.O_CREATE, 0666)\n        if outputError != nil {\n                fmt.Printf(\"An error occurred with file creation\\n\")\n                return\n        }\n        defer outputFile.Close()\n        writer := csv.NewWriter(outputFile)\n        results := getResults()\n        for _, result := range results {\n                writer.Write([]string{result.Item, result.Price, result.Shipping})\n        }\n        writer.Flush()\n}\n</code></pre>\n\n<p>when <code>results</code> is 1000+ records my PC freezes for seconds and when it's say 20k, it freezes for minutes.\nHow do I solve such an issue in a proper way? \nI though to flush it every N records, and add <code>time.Sleep</code> \u2013 but that looks awkward\u2026</p>\n"}, {"tags": ["curl", "logging", "go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 0, "last_activity_date": 1432928705, "last_edit_date": 1432928705, "creation_date": 1432926284, "answer_id": 30537215, "question_id": 30537097, "link": "https://stackoverflow.com/questions/30537097/how-do-i-accept-post-requests-from-go-and-write-output-to-a-file/30537215#30537215", "title": "How do I accept POST requests from Go and write output to a file?", "body": "<p>You're not POST'ing a form, you're sending json data in the request body. </p>\n\n<p>Read the data directly:</p>\n\n<pre><code>body, err := ioutil.ReadAll(r.Body)\nif err != nil {\n    log.Println(\"ERROR:\", err)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 0, "creation_date": 1432934132, "post_id": 30537299, "comment_id": 49151654, "body": "<code>ioutil.WriteFile</code> is probably not the best solution here since it will truncate the file before writing to it."}], "tags": [], "owner": {"reputation": 862, "user_id": 3355188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d635e8f9bc47fa9b84c92241a62ff107?s=128&d=identicon&r=PG", "display_name": "D&#225;vid Kaya", "link": "https://stackoverflow.com/users/3355188/d%c3%a1vid-kaya"}, "is_accepted": false, "score": 0, "last_activity_date": 1432926555, "creation_date": 1432926555, "answer_id": 30537299, "question_id": 30537097, "link": "https://stackoverflow.com/questions/30537097/how-do-i-accept-post-requests-from-go-and-write-output-to-a-file/30537299#30537299", "title": "How do I accept POST requests from Go and write output to a file?", "body": "<p><code>r.Method</code> contains type of received request (GET, POST, HEAD, PUT, etc.).</p>\n\n<p>You can read data from <code>r.Body</code> with <code>ioutil</code> and write that data into the file with the same package.</p>\n\n<p>This is for handling only <strong>POST</strong> method, reading data and writing into file (output.txt).</p>\n\n<pre><code>if r.Method == \"POST\" {\n    body, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n        fmt.Errorf(\"Error during reading body: %v\", err)\n    }\n\n    if err := ioutil.WriteFile(\"output.txt\", body, 0644); err != nil {\n        fmt.Errorf(\"Error during writing data: %v\", err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1242, "user_id": 804707, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/af86b492c2772884b20791e8298595d9?s=128&d=identicon&r=PG", "display_name": "The Puma", "link": "https://stackoverflow.com/users/804707/the-puma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 248, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1432928705, "creation_date": 1432925817, "question_id": 30537097, "link": "https://stackoverflow.com/questions/30537097/how-do-i-accept-post-requests-from-go-and-write-output-to-a-file", "title": "How do I accept POST requests from Go and write output to a file?", "body": "<p>First of all, I'm trying to create a logging service in Go, where it is a lightweight server accepting POST requests with log data from my service.  I'm writing this service in Go because it is supposed to be fast and handle a lot of POST requests at once.  Is my logic sound there?</p>\n\n<p>Anyways, this is my issue.  I'm sending POST requests like this to test:\n<code>\ncurl -H \"Content-Type: application/json\" -X POST -d '{\"hello\":\"world\"}' http://localhost:8080/log</code></p>\n\n<p>And here is my Go script so far:</p>\n\n<pre><code>package main\n\nimport (\n   \"fmt\"\n   \"log\"\n   \"net/http\"\n)\n\nfunc logger(w http.ResponseWriter, r *http.Request) {\n   r.ParseForm()\n   fmt.Println(r.Form)\n   fmt.Println(r.FormValue(\"hello\"))\n}\n\nfunc main() {\n   http.HandleFunc(\"/log\", logger)\n   log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>It is outputting:\n<code>map []</code></p>\n\n<p>Why is that?  How could I write the POST data to a file on the server?</p>\n\n<p>Thank you very much!\nW</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 8, "last_activity_date": 1432928629, "last_edit_date": 1432928629, "creation_date": 1432926578, "answer_id": 30537303, "question_id": 30537035, "link": "https://stackoverflow.com/questions/30537035/golang-json-rawmessage-literal/30537303#30537303", "title": "Golang JSON RawMessage literal", "body": "<p>The underlying data type for <a href=\"http://golang.org/pkg/encoding/json/#RawMessage\" rel=\"noreferrer\">json.RawMessage</a> is a <code>[]byte</code></p>\n\n<p>You can convert your string, or use a byte slice directly in the literal</p>\n\n<pre><code>msg := ErrorMessage{\n    Timestamp: \"test-time\",\n    Message:   []byte(\"{}\"),\n}\n</code></pre>\n\n<p>Note that to actually marshal that as expected, you need to use <code>*json.RawMessage</code>, which you can't take the address of in a literal context.</p>\n"}], "owner": {"reputation": 10777, "user_id": 1507139, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/efa15e463560953d4ee5943bd427846d?s=128&d=identicon&r=PG", "display_name": "eatonphil", "link": "https://stackoverflow.com/users/1507139/eatonphil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6198, "favorite_count": 1, "accepted_answer_id": 30537303, "answer_count": 1, "score": 3, "last_activity_date": 1432928629, "creation_date": 1432925618, "question_id": 30537035, "link": "https://stackoverflow.com/questions/30537035/golang-json-rawmessage-literal", "title": "Golang JSON RawMessage literal", "body": "<p>Is it possible to create a json.RawMessage literal in Golang?</p>\n\n<p>I want to be able to do something like this:</p>\n\n<pre><code>type ErrorMessage struct {\n    Timestamp string\n    Message   json.RawMessage\n}\n\nfunc getTestData() ErrorMessage {\n    return ErrorMessage{\n        Timestamp: \"test-time\",\n        Message:   \"{}\"\n    }\n}\n</code></pre>\n\n<p>Or something like that. <a href=\"http://play.golang.org/p/C1tXFi23Bw\" rel=\"nofollow\">This</a> is the most succinct I've seen. I have not been able to find an example of a \"struct\" literal for creating raw json messages.</p>\n"}, {"tags": ["angularjs", "go", "cors"], "comments": [{"owner": {"reputation": 92569, "user_id": 400654, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/afc1068910df4dd83c2fc3af0255af11?s=128&d=identicon&r=PG", "display_name": "Kevin B", "link": "https://stackoverflow.com/users/400654/kevin-b"}, "edited": false, "score": 0, "creation_date": 1432922296, "post_id": 30535867, "comment_id": 49145834, "body": "My guess would be your webserver isn&#39;t responding to OPTIONS requests, but i&#39;m not familiar enough to golang to be sure or suggest a solution."}], "answers": [{"tags": [], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "is_accepted": false, "score": 3, "last_activity_date": 1432924113, "creation_date": 1432924113, "answer_id": 30536642, "question_id": 30535867, "link": "https://stackoverflow.com/questions/30535867/golang-cors-and-angularjs-header-missing/30536642#30536642", "title": "Golang, cors and angularjs - header missing", "body": "<p>Fixed it! I noticed that a few different headers were being sent with the request and I had to explicitly allow all of them.</p>\n\n<pre><code>AllowedHeaders: []string{\"accept\", \"authorization\", \"content-type\"}\n</code></pre>\n\n<p>I hope this helps someone.</p>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1049, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1432924113, "creation_date": 1432921260, "last_edit_date": 1432923848, "question_id": 30535867, "link": "https://stackoverflow.com/questions/30535867/golang-cors-and-angularjs-header-missing", "title": "Golang, cors and angularjs - header missing", "body": "<p>I'm using <a href=\"https://github.com/rs/cors\" rel=\"nofollow\">rs/cors</a> in my Go API to allow my Angularjs app to make direct requests. I've added the following code to configure CORS:</p>\n\n<pre><code>crs := cors.New(cors.Options{AllowCredentials: true})\nn.Use(crs) //Negroni include\n</code></pre>\n\n<p>but I'm getting the <strong>No 'Access-Control-Allow-Origin' header is present on the requested resource</strong> message in the browser when I make a request.</p>\n\n<p>My request looks like this:</p>\n\n<pre><code>var req = {\n    method: 'POST',\n    url: endPoint + version + method,\n    headers: {\n        'Authorization': 'Basic ' + btoa(':' + appId)\n    },\n    data: params\n}\n\n$http(req).\n    success(function(data, status, headers, config) {\n        callback(null, data);\n    }).\n    error(function(data, status, headers, config) {\n        callback(data);\n    });\n</code></pre>\n\n<p>How can I get round this?</p>\n"}, {"tags": ["go", "progress-bar"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1432912459, "post_id": 30532886, "comment_id": 49139980, "body": "you&#39;re downloading the file before you even start the progress bar."}, {"owner": {"reputation": 1203, "user_id": 3821823, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a760c201a9690d3c4786a76f8c07649e?s=128&d=identicon&r=PG", "display_name": "Ali", "link": "https://stackoverflow.com/users/3821823/ali"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1432915935, "post_id": 30532886, "comment_id": 49142206, "body": "@JimB I&#39;m tried but not working because I get fileSize undefined error"}], "answers": [{"comments": [{"owner": {"reputation": 1203, "user_id": 3821823, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a760c201a9690d3c4786a76f8c07649e?s=128&d=identicon&r=PG", "display_name": "Ali", "link": "https://stackoverflow.com/users/3821823/ali"}, "edited": false, "score": 0, "creation_date": 1432922935, "post_id": 30534837, "comment_id": 49146194, "body": "That works! Thank you. Now source code on GitHub:  <a href=\"https://gist.github.com/aligoren/9426249fa8cd04c4633e\" rel=\"nofollow noreferrer\">gist.github.com/aligoren/9426249fa8cd04c4633e</a>"}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": false, "score": 4, "last_activity_date": 1432917990, "last_edit_date": 1432917990, "creation_date": 1432917669, "answer_id": 30534837, "question_id": 30532886, "link": "https://stackoverflow.com/questions/30532886/golang-dynamic-progressbar/30534837#30534837", "title": "golang dynamic progressbar", "body": "<p>I wrote the below stuff, and it's right in the general case, unrelated to progressbar, but this library is <em>exactly</em> designed to handle this problem, has specialized support for it, and gives an <a href=\"https://github.com/cheggaaa/pb/blob/master/example/copy/copy.go\" rel=\"nofollow\">explicit example of downloading a file</a>.</p>\n\n<hr>\n\n<p>You need to run the download in parallel with updating the progressbar, currently you're downloading the whole file and then updating the progressbar.</p>\n\n<p>This is a little sloppy, but should get you going in the right direction:</p>\n\n<p>First, grab the expected filesize:</p>\n\n<pre><code>    filesize := response.ContentLength\n</code></pre>\n\n<p>Then start your download in a goroutine:</p>\n\n<pre><code>    go func() {\n        n, err := io.Copy(file, response.Body)\n        if n != filesize {\n            log.Fatal(\"Truncated\")\n        }\n        if err != nil {\n            log.Fatalf(\"Error: %v\", err)\n        }\n    }()\n</code></pre>\n\n<p>Then update your progressbar as it goes along:</p>\n\n<pre><code>    countSize := int(filesize / 1000)\n    bar := pb.StartNew(countSize)\n    var fi os.FileInfo\n    for fi == nil || fi.Size() &lt; filesize {\n        fi, _ = file.Stat()\n        bar.Set(int(fi.Size() / 1000))\n        time.Sleep(time.Millisecond)\n    }\n    bar.FinishPrint(\"The End!\")\n</code></pre>\n\n<p>Like I say, this is a little sloppy; you probably want to scale the bar better depending on the size of the file, and the <code>log.Fatal</code> calls are ugly. But it handles the core of the issue.</p>\n\n<p>Alternately, you can do this without a goroutine just by writing your own version of <code>io.Copy</code>. Read a block from <code>response.Body</code>, update the progress bar, and then write a block to <code>file</code>. That's arguably better because you can avoid the sleep call.</p>\n"}, {"tags": [], "owner": {"reputation": 86, "user_id": 5014921, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Kdj2I1pDq5c/AAAAAAAAAAI/AAAAAAAAAVU/NTpwQgyUhdo/photo.jpg?sz=128", "display_name": "cheggaaa", "link": "https://stackoverflow.com/users/5014921/cheggaaa"}, "is_accepted": true, "score": 7, "last_activity_date": 1434453946, "creation_date": 1434453946, "answer_id": 30866224, "question_id": 30532886, "link": "https://stackoverflow.com/questions/30532886/golang-dynamic-progressbar/30866224#30866224", "title": "golang dynamic progressbar", "body": "<p>More goroutines is not needed. Just read from bar</p>\n\n<pre><code>// start new bar\nbar := pb.New(fileSize).SetUnits(pb.U_BYTES)\nbar.Start()\n// create proxy reader\nrd := bar.NewProxyReader(response.Body)\n// and copy from reader\nio.Copy(file, rd)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2676, "user_id": 558032, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/J2uZ3.png?s=128&g=1", "display_name": "PixelsTech", "link": "https://stackoverflow.com/users/558032/pixelstech"}, "is_accepted": false, "score": 0, "last_activity_date": 1597483902, "creation_date": 1597483902, "answer_id": 63424571, "question_id": 30532886, "link": "https://stackoverflow.com/questions/30532886/golang-dynamic-progressbar/63424571#63424571", "title": "golang dynamic progressbar", "body": "<p>Actually you can implement progress bar by yourself with below piece of code.</p>\n<pre><code>func (bar *Bar) Play(cur int64) {\n bar.cur = cur\n last := bar.percent\n bar.percent = bar.getPercent()\n if bar.percent != last &amp;&amp; bar.percent%2 == 0 {\n   bar.rate += bar.graph\n }\n fmt.Printf(&quot;\\r[%-50s]%3d%% %8d/%d&quot;, bar.rate, bar.percent, bar.cur, bar.total)\n}\n</code></pre>\n<p>The key here is to use escape <strong>\\r</strong> which will replace the current progress with updated one in place  which creates a dynamic effect.</p>\n<p>A detailed explanation can be found at <a href=\"https://www.pixelstech.net/article/1596946473-A-simple-example-on-implementing-progress-bar-in-GoLang\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 1203, "user_id": 3821823, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a760c201a9690d3c4786a76f8c07649e?s=128&d=identicon&r=PG", "display_name": "Ali", "link": "https://stackoverflow.com/users/3821823/ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6753, "favorite_count": 2, "accepted_answer_id": 30866224, "answer_count": 3, "score": 4, "last_activity_date": 1597483902, "creation_date": 1432911633, "question_id": 30532886, "link": "https://stackoverflow.com/questions/30532886/golang-dynamic-progressbar", "title": "golang dynamic progressbar", "body": "<p>I'm trying file download with golang.</p>\n\n<p>I'm downloading file it's okay. After I'm using cheggaaa's progressbar library. But I can't dynamic.</p>\n\n<p>How can I do dynamic progressbar?</p>\n\n<p>My code below:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"flag\"\n    \"fmt\"\n    \"io\"\n    \"net/http\"\n    \"net/url\"\n    \"os\"\n    \"strings\"\n    \"github.com/cheggaaa/pb\"\n    \"time\"\n)\n\n/*\n    usage = usage text\n    version = current number\n    help use Sprintf\n    *cliUrl from cmd\n    *cliVersion from cmd\n    *cliHelp * from cmd\n*/\nvar (\n    usage      = \"Usage: ./gofret -url=http://some/do.zip\"\n    version    = \"Version: 0.1\"\n    help       = fmt.Sprintf(\"\\n\\n  %s\\n\\n\\n  %s\", usage, version)\n    cliUrl     *string\n    cliVersion *bool\n    cliHelp    *bool\n)\n\nfunc init() {\n    /*\n        if *cliUrl != \"\" {\n            fmt.Println(*cliUrl)\n        }\n\n        ./gofret -url=http://somesite.com/somefile.zip\n        ./gofret -url=https://github.com/aligoren/syspy/archive/master.zip\n    */\n    cliUrl = flag.String(\"url\", \"\", usage)\n\n    /*\n        else if *cliVersion{\n            fmt.Println(flag.Lookup(\"version\").Usage)\n        }\n\n        ./gofret -version\n    */\n    cliVersion = flag.Bool(\"version\", false, version)\n\n    /*\n        if *cliHelp {\n            fmt.Println(flag.Lookup(\"help\").Usage)\n        }\n\n        ./gofret -help\n    */\n    cliHelp = flag.Bool(\"help\", false, help)\n}\n\nfunc main() {\n\n    /*\n        Parse all flags\n    */\n    flag.Parse()\n\n    if *cliUrl != \"\" {\n        fmt.Println(\"Downloading file\")\n\n        /* parse url from *cliUrl */\n        fileUrl, err := url.Parse(*cliUrl)\n\n        if err != nil {\n            panic(err)\n        }\n\n        /* get path from *cliUrl */\n        filePath := fileUrl.Path\n\n        /*\n            seperate file.\n            http://+site.com/+(file.zip)\n        */\n        segments := strings.Split(filePath, \"/\")\n\n        /*\n            file.zip filename lenth -1\n        */\n        fileName := segments[len(segments)-1]\n\n        /*\n            Create new file.\n            Filename from fileName variable\n        */\n        file, err := os.Create(fileName)\n\n        if err != nil {\n            fmt.Println(err)\n            panic(err)\n        }\n        defer file.Close()\n\n        /*\n            check status and CheckRedirect\n        */\n        checkStatus := http.Client{\n            CheckRedirect: func(r *http.Request, via []*http.Request) error {\n                r.URL.Opaque = r.URL.Path\n                return nil\n            },\n        }\n\n        /*\n            Get Response: 200 OK?\n        */\n        response, err := checkStatus.Get(*cliUrl)\n\n        if err != nil {\n            fmt.Println(err)\n            panic(err)\n        }\n        defer response.Body.Close()\n        fmt.Println(response.Status) // Example: 200 OK\n\n        /*\n            fileSize example: 12572 bytes\n        */\n        fileSize, err := io.Copy(file, response.Body)\n        /*\n            progressbar worked after download :(\n        */\n        var countSize int = int(fileSize/1000)\n        count := countSize\n        bar := pb.StartNew(count)\n        for i := 0; i &lt; count; i++ {\n            bar.Increment()\n            time.Sleep(time.Millisecond)\n        }\n        bar.FinishPrint(\"The End!\")\n\n        if err != nil {\n            panic(err)\n        }\n\n\n        fmt.Printf(\"%s with %v bytes downloaded\", fileName, count)\n\n    } else if *cliVersion {\n        /*\n            lookup version flag's usage text\n        */\n        fmt.Println(flag.Lookup(\"version\").Usage)\n    } else if *cliHelp {\n        /*\n            lookup help flag's usage text\n        */\n        fmt.Println(flag.Lookup(\"help\").Usage)\n    } else {\n        /*\n            using help's usage text for handling other status\n        */\n        fmt.Println(flag.Lookup(\"help\").Usage)\n    }\n}\n</code></pre>\n\n<p>While the my program is running:</p>\n\n<pre><code>Downloading file\n200 OK\n</code></pre>\n\n<p>After download working progressbar:</p>\n\n<pre><code>6612 / 6612 [=====================================================] 100.00 % 7s\nThe End!\nmaster.zip with 6612 bytes downloaded\n</code></pre>\n\n<p>My progressbar code below:</p>\n\n<pre><code>/*\n    progressbar worked after download :(\n*/\nvar countSize int = int(fileSize/1000)\ncount := countSize\nbar := pb.StartNew(count)\nfor i := 0; i &lt; count; i++ {\n    bar.Increment()\n    time.Sleep(time.Millisecond)\n}\nbar.FinishPrint(\"The End!\")\n</code></pre>\n\n<p>How can I solve progressbar problem?</p>\n"}, {"tags": ["c", "pointers", "go", "language-interoperability"], "answers": [{"comments": [{"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1432912056, "post_id": 30532714, "comment_id": 49139648, "body": "+1 This answers my question and gave me a better understanding of C/Go interoperability. I think this is in the documentation (which I consult), but an important thing like this should have appeared more clearly (with a lot of bold sentences...)."}, {"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1432912302, "post_id": 30532714, "comment_id": 49139846, "body": "Change applied (it builds and passes tests), if anyone is interested in full (learning) project source, is possible to follow this <a href=\"https://goo.gl/he4bPH\" rel=\"nofollow noreferrer\">link</a>."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 7, "last_activity_date": 1432911154, "creation_date": 1432911154, "answer_id": 30532714, "question_id": 30531721, "link": "https://stackoverflow.com/questions/30531721/forced-to-define-go-struct-for-casting-an-unsafe-pointer-to-a-c-struct/30532714#30532714", "title": "Forced to define Go struct for casting an unsafe.Pointer() to a C struct", "body": "<p>As per <a href=\"https://golang.org/cmd/cgo/\">documentation</a></p>\n\n<blockquote>\n  <p>To access a struct, union, or enum type directly, prefix it with struct_, union_, or enum_, as in C.struct_stat.</p>\n</blockquote>\n\n<p>Use <code>C.struct_proc_taskinfo</code>.</p>\n"}], "owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "accepted_answer_id": 30532714, "answer_count": 1, "score": 3, "last_activity_date": 1432911154, "creation_date": 1432908415, "last_edit_date": 1495540693, "question_id": 30531721, "link": "https://stackoverflow.com/questions/30531721/forced-to-define-go-struct-for-casting-an-unsafe-pointer-to-a-c-struct", "title": "Forced to define Go struct for casting an unsafe.Pointer() to a C struct", "body": "<p>Interoperating with C code, I was not able to directly cast a structure and I was forced to define an equivalent one in Go.\nThe C function from <code>libproc.h</code> is</p>\n\n<pre><code>int proc_pidinfo(int pid, int flavor, uint64_t arg,  void *buffer, int buffersize)\n</code></pre>\n\n<p>The C structure for <code>flavor==PROC_PIDTASKINFO</code> is <code>proc_taskinfo</code> as defined in <code>sys/proc_info.h</code> (included by <code>libproc.h</code>):</p>\n\n<pre><code>struct proc_taskinfo {\n    uint64_t        pti_virtual_size;   /* virtual memory size (bytes) */\n    uint64_t        pti_resident_size;  /* resident memory size (bytes) */\n    uint64_t        pti_total_user;     /* total time */\n    uint64_t        pti_total_system;\n    uint64_t        pti_threads_user;   /* existing threads only */\n    uint64_t        pti_threads_system;\n    int32_t         pti_policy;     /* default policy for new threads */\n    int32_t         pti_faults;     /* number of page faults */\n    int32_t         pti_pageins;        /* number of actual pageins */\n    int32_t         pti_cow_faults;     /* number of copy-on-write faults */\n    int32_t         pti_messages_sent;  /* number of messages sent */\n    int32_t         pti_messages_received;  /* number of messages received */\n    int32_t         pti_syscalls_mach;  /* number of mach system calls */\n    int32_t         pti_syscalls_unix;  /* number of unix system calls */\n    int32_t         pti_csw;            /* number of context switches */\n    int32_t         pti_threadnum;      /* number of threads in the task */\n    int32_t         pti_numrunning;     /* number of running threads */\n    int32_t         pti_priority;       /* task priority*/\n};\n</code></pre>\n\n<p>Even if Go code actually works, I was not able to use <code>C.proc_taskinfo</code> directly. The Go function is <code>propertiesOf()</code>: complete source <a href=\"https://gist.github.com/gsscoder/0b6c46a4f5971c22c136\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>If I reference the C structure, I got a similar error reported as in my <a href=\"https://stackoverflow.com/questions/30481268/c-and-go-interoperability-issue-involving-c-free\">latest question</a> on the subject: <code>could not determine kind of name for C.proc_taskinfo</code>, but this time I'm sure the definition is imported with <code>#include</code>.</p>\n"}, {"tags": ["dictionary", "go"], "answers": [{"comments": [{"owner": {"reputation": 1751, "user_id": 3973406, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2d94768947ebd5fd0f38ee5b3f472c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dac0d3r", "link": "https://stackoverflow.com/users/3973406/dac0d3r"}, "edited": false, "score": 0, "creation_date": 1432910610, "post_id": 30530190, "comment_id": 49138474, "body": "Thanks icza for your great answer. I like your last proposal &quot;using keys as-is&quot;, but turning the above XML data structure proved much harder than I&#39;d ever have imagined. Unmarshalling nested elements to an array is easy, but do you have any idea how I get it unmarshalled into the desired map[string]*MediaItem with the correct keys? This is where I am now: <a href=\"http://play.golang.org/p/ZJQsTzBO-l\" rel=\"nofollow noreferrer\">play.golang.org/p/ZJQsTzBO-l</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1751, "user_id": 3973406, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2d94768947ebd5fd0f38ee5b3f472c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dac0d3r", "link": "https://stackoverflow.com/users/3973406/dac0d3r"}, "edited": false, "score": 2, "creation_date": 1432910792, "post_id": 30530190, "comment_id": 49138634, "body": "@Dac0d3r Unmarshal the XML into an array (slice), and then loop over the slice and build the map. You do not have to unmarshal directly into the final map."}, {"owner": {"reputation": 1751, "user_id": 3973406, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2d94768947ebd5fd0f38ee5b3f472c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dac0d3r", "link": "https://stackoverflow.com/users/3973406/dac0d3r"}, "edited": false, "score": 0, "creation_date": 1432910860, "post_id": 30530190, "comment_id": 49138685, "body": "Thanks man. I found just this <a href=\"http://play.golang.org/p/eA4_caHLyk\" rel=\"nofollow noreferrer\">play.golang.org/p/eA4_caHLyk</a> , I guess it&#39;s also what you just propose. :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 11, "last_activity_date": 1432906215, "last_edit_date": 1432906215, "creation_date": 1432904057, "answer_id": 30530190, "question_id": 30529970, "link": "https://stackoverflow.com/questions/30529970/golang-map-with-multiple-keys-per-value/30530190#30530190", "title": "Golang map with multiple keys per value", "body": "<p>Staying with the <code>map</code> type, you can use 2 (3) different solutions:</p>\n\n<h3>With 2 maps</h3>\n\n<p>Easiest would be to build 2 maps, 1 where the keys are the urls, and 1 where the keys are the ids:</p>\n\n<pre><code>var byUrlMap map[string]*MediaItem\nvar byIdMap map[string]*MediaItem\n</code></pre>\n\n<p>Note that you should store pointers instead of structs for example to avoid duplicating the values.</p>\n\n<p>If you need a <code>MediaItem</code> by id:</p>\n\n<pre><code>mi := byIdMap[id]\n</code></pre>\n\n<p>Similarly by url:</p>\n\n<pre><code>mi2 := byUrlMap[url]\n</code></pre>\n\n<h3>With key prefixes</h3>\n\n<p>Another option can be to prefix the actual key values, but this is not so efficient, but as a result, you'll have only one map.</p>\n\n<p>For example you could prefix URL keys with <code>\"url:\"</code> and ids with <code>\"id:\"</code> and store the same pointer value of course for both the url and id keys, for example:</p>\n\n<pre><code>var miMap = make(map[string]*MediaItem)\n\nmi := &amp;MediaItem{}\nmiMap[\"url:http://something\"] = mi\nmiMap[\"id:1\"] = mi\n</code></pre>\n\n<p>And getting an element:</p>\n\n<pre><code>mi2 := miMap[\"id:\" + id]   // By id\nmi3 := miMap[\"url:\" + url] // By url\n</code></pre>\n\n<h3>Using keys <em>\"as-is\"</em></h3>\n\n<p>This is something similar to \"With key prefixes\": if you have guarantee that the URLs and ids will never be the same (meaning you will never have an id that is the same as another item's url and vice versa), you can simply use both keys without prefixes, and set the same value (pointer) to them.</p>\n\n<p>The purpose of key prefixes was to make sure a final url key will never be the same as a final id key (achieved by using different prefixes for these 2 types of keys). But if this condition is naturally true (e.g. the <code>string</code> value of a numeric id will never be a valid url), we don't really need the prefixes:</p>\n\n<pre><code>var miMap = make(map[string]*MediaItem)\n\nmi := &amp;MediaItem{}\nmiMap[\"http://something\"] = mi\nmiMap[\"1\"] = mi\n</code></pre>\n\n<p>And getting an element:</p>\n\n<pre><code>mi2 := miMap[id]  // By id\nmi3 := miMap[url] // By url\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 99, "user_id": 7151170, "user_type": "registered", "profile_image": "https://graph.facebook.com/1106084696105464/picture?type=large", "display_name": "Orestes Kappa", "link": "https://stackoverflow.com/users/7151170/orestes-kappa"}, "edited": false, "score": 0, "creation_date": 1612528793, "post_id": 59729030, "comment_id": 116801702, "body": "Note that this is when you want to use both keys at the same to find a value and not when you want to be able to find the value using either one of the keys."}], "tags": [], "owner": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "is_accepted": false, "score": 7, "last_activity_date": 1578986123, "creation_date": 1578986123, "answer_id": 59729030, "question_id": 30529970, "link": "https://stackoverflow.com/questions/30529970/golang-map-with-multiple-keys-per-value/59729030#59729030", "title": "Golang map with multiple keys per value", "body": "<p>Better solution would be to use struct with two field as a key:</p>\n\n<pre><code>type key struct {\n    url string\n    id  int\n}\n\nm := make(map[key]MediaItem)\nm[key{url: \"http://...\", id: 2}] = MediaItem{}\n</code></pre>\n"}], "owner": {"reputation": 1751, "user_id": 3973406, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2d94768947ebd5fd0f38ee5b3f472c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dac0d3r", "link": "https://stackoverflow.com/users/3973406/dac0d3r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16749, "favorite_count": 1, "accepted_answer_id": 30530190, "answer_count": 2, "score": 7, "last_activity_date": 1578986123, "creation_date": 1432903452, "last_edit_date": 1432904920, "question_id": 30529970, "link": "https://stackoverflow.com/questions/30529970/golang-map-with-multiple-keys-per-value", "title": "Golang map with multiple keys per value", "body": "<p>Consider the following XML data structure:</p>\n\n<pre><code>&lt;MediaItems&gt;\n    &lt;item url=\"media/somefolder/pic1.jpg\" id=\"1\"&gt;\n        &lt;groups&gt;\n            &lt;group&gt;1&lt;/group&gt;\n            &lt;group&gt;2&lt;/group&gt;\n        &lt;/groups&gt;\n    &lt;/item&gt;\n    &lt;item url=\"media/somefolder/pic2.jpg\" id=\"2\"&gt;\n        &lt;groups&gt;\n            &lt;group&gt;3&lt;/group&gt;\n            &lt;group&gt;7&lt;/group&gt;\n        &lt;/groups&gt;\n    &lt;/item&gt;\n&lt;/MediaItems&gt;\n</code></pre>\n\n<p>Since my XML data structure/file can potentially scale to 10000 or perhaps 100000+ media item elements, I need to be able to access the individual items, in the parsed Go map (or what structure to use here?), like we do with <code>map[key]type</code> - but I need to be able to use either the url or the id as a key, and I can't figure out how to create a map with 2 keys pointing to the same value.</p>\n\n<p>From the parsed XML data structure above, I need to parse it in Go and store it in a type like:</p>\n\n<pre><code>map[string, string]MediaItem\n</code></pre>\n\n<p>Where the keys should be url and id, so I'd be able to get the item with id 1 doing <code>myMap[\"1\"]</code> or <code>myMap[\"media/somefolder/pic1.jpg\"]</code>. Both should return the corresponding <code>MediaItem</code>.)</p>\n\n<p>I can't wrap my head around how to implement this, or maybe there a better way to achieve the same?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": true, "score": 5, "last_activity_date": 1432901664, "last_edit_date": 1432901664, "creation_date": 1432901302, "answer_id": 30529254, "question_id": 30528941, "link": "https://stackoverflow.com/questions/30528941/how-to-pass-interfaces-indirectly-in-golang/30529254#30529254", "title": "How to pass interfaces indirectly in golang", "body": "<blockquote>\n  <p>I thought interfaces were implicitly used in golang</p>\n</blockquote>\n\n<p>Values are wrapped in interfaces implicitly, but only in specific cases like when passing an implementation to a function with an interface argument:</p>\n\n<pre><code>func X(api.Path) {}\n\nX(&amp;mux.Route{}) // works, implicitly converted to api.Path\n</code></pre>\n\n<p>or when returning an implementation from a function with an interface return type:</p>\n\n<pre><code>func Y() api.Path {\n    return &amp;mux.Route{} // works, implicitly converted to api.Path\n}\n</code></pre>\n\n<p>In your question's case the compiler wants a value that has a method with the signature:</p>\n\n<pre><code>Path(string) api.Path\n</code></pre>\n\n<p>But you're giving it a value with a method with signature:</p>\n\n<pre><code>Path(string) *mux.Route\n</code></pre>\n\n<p>As you might now, Go types are invariant. Formally:</p>\n\n<pre><code>type A interface { Path(string) *mux.Route }\n</code></pre>\n\n<p>is not a subtype of </p>\n\n<pre><code>type B interface { Path(string) api.Path }\n</code></pre>\n\n<p>Therefore this won't work.</p>\n"}], "owner": {"reputation": 10946, "user_id": 1259261, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a105607c3fd93df0d386c6d6a6b4aad?s=128&d=identicon&r=PG", "display_name": "Daniel Robinson", "link": "https://stackoverflow.com/users/1259261/daniel-robinson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 30529254, "answer_count": 1, "score": -1, "last_activity_date": 1432901664, "creation_date": 1432900390, "question_id": 30528941, "link": "https://stackoverflow.com/questions/30528941/how-to-pass-interfaces-indirectly-in-golang", "title": "How to pass interfaces indirectly in golang", "body": "<p>I have a package with a method:</p>\n\n<pre><code>func Route(router *mux.Router){\n    subrouter := router.PathPrefix(_API).Subrouter()\n    subrouter.Path(_FOO).HandlerFunc(foo)\n    subrouter.Path(_BAR).HandlerFunc(bar)\n}\n</code></pre>\n\n<p>and I would like to remove the external dependency of mux by having a matching interface in my package that simple encompasses all the functionality used above, like so:</p>\n\n<pre><code>type Router interface{\n    Path(string) Path\n    PathPrefix(string) Path\n}\n\ntype Path interface{\n    HandlerFunc(http.HandlerFunc)\n    Subrouter() Router\n}\n\nfunc Route(router Router){\n    subrouter := router.PathPrefix(_API).Subrouter()\n    subrouter.Path(_FOO).HandlerFunc(foo)\n    subrouter.Path(_BAR).HandlerFunc(bar)\n}\n</code></pre>\n\n<p>but when I build this I get error:</p>\n\n<blockquote>\n  <p>*mux.Router does not implement api.Router (wrong type for Path method)\n               have Path(string) *mux.Route\n               want Path(string) api.Path</p>\n</blockquote>\n\n<p>but I thought interfaces were implicitly used in golang so I thought that <code>*mux.Route</code> did implement my Path interface.</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 3, "creation_date": 1432894593, "post_id": 30526946, "comment_id": 49127371, "body": "What do you mean by response time? The time from when the server completed processing the request to the time the client is done receiving it? I&#39;m not sure how that would be possible - the round trip itself, dns and all that are an inherent part of the HTTP cycle... Your best bet would be to time it on the server."}, {"owner": {"reputation": 555, "user_id": 3936396, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/0CBCe.jpg?s=128&g=1", "display_name": "Devatoria", "link": "https://stackoverflow.com/users/3936396/devatoria"}, "reply_to_user": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 0, "creation_date": 1432894928, "post_id": 30526946, "comment_id": 49127565, "body": "Ok this is what I thought. In fact, I don&#39;t really know how JMeter tool is computing this time but I would like something like this. JMeter doesn&#39;t inspect the server (in my aknowledge). I tested with wget and the timing is the same that the one computed by my program (about 5s including DNS resolution)."}], "answers": [{"comments": [{"owner": {"reputation": 555, "user_id": 3936396, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/0CBCe.jpg?s=128&g=1", "display_name": "Devatoria", "link": "https://stackoverflow.com/users/3936396/devatoria"}, "edited": false, "score": 0, "creation_date": 1432902193, "post_id": 30527804, "comment_id": 49132455, "body": "Thank you very much for this answer. This is what I was looking for. I&#39;m going to improve it a little bit to be more accurate but I don&#39;t need perfection :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 12, "last_activity_date": 1544529991, "last_edit_date": 1544529991, "creation_date": 1432897086, "answer_id": 30527804, "question_id": 30526946, "link": "https://stackoverflow.com/questions/30526946/time-http-response-in-go/30527804#30527804", "title": "Time HTTP Response in Go", "body": "<p><strong>Edit:</strong> The following answer pre-dates Go 1.7. Go 1.7 added HTTP tracing, so be sure to check out this new answer: <a href=\"https://stackoverflow.com/questions/48077098/getting-ttfb-time-to-first-byte-value-in-golang/48077762?r=SearchResults#48077762\">Getting TTFB (time to first byte) value in golang</a></p>\n\n<p>Original answer follows.</p>\n\n<hr>\n\n<p>You can measure it by opening a TCP connection and \"speaking\" raw HTTP (<a href=\"http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol\" rel=\"nofollow noreferrer\">wikipedia</a>, <a href=\"https://tools.ietf.org/html/rfc7230\" rel=\"nofollow noreferrer\">rfc7230</a>, <a href=\"https://tools.ietf.org/html/rfc7231\" rel=\"nofollow noreferrer\">rfc7231</a>, <a href=\"https://tools.ietf.org/html/rfc7232\" rel=\"nofollow noreferrer\">rfc7232</a>, <a href=\"https://tools.ietf.org/html/rfc7233\" rel=\"nofollow noreferrer\">rfc7233</a>, <a href=\"https://tools.ietf.org/html/rfc7234\" rel=\"nofollow noreferrer\">rfc7234</a>, <a href=\"https://tools.ietf.org/html/rfc7235\" rel=\"nofollow noreferrer\">rfc7235</a>). You make a connection, send the request, and start the timer here. And wait for the response. By doing so you will exclude DNS resolving and the time required to make the connection.</p>\n\n<p>Since you have no insight whether the server starts sending data back immediately or only when everything is ready, and you have no info about network delays, it won't be accurate rather just an estimation.</p>\n\n<p>I would measure at 2 points: when the first byte can be read and when everything is read:</p>\n\n<pre><code>conn, err := net.Dial(\"tcp\", \"google.com:80\")\nif err != nil {\n    panic(err)\n}\ndefer conn.Close()\nconn.Write([]byte(\"GET / HTTP/1.0\\r\\n\\r\\n\"))\n\nstart := time.Now()\noneByte := make([]byte,1)\n_, err = conn.Read(oneByte)\nif err != nil {\n    panic(err)\n}\nlog.Println(\"First byte:\", time.Since(start))\n\n_, err = ioutil.ReadAll(conn)\nif err != nil {\n    panic(err)\n}\nlog.Println(\"Everything:\", time.Since(start))\n</code></pre>\n\n<p><strong>Note:</strong></p>\n\n<p>It might be reasonable to measure at a 3rd point: when all the response headers are read. This is detected as reading full lines from the response (connection) and encountering an empty line. This empty line separates response headers from the response body.</p>\n"}, {"comments": [{"owner": {"reputation": 555, "user_id": 3936396, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/0CBCe.jpg?s=128&g=1", "display_name": "Devatoria", "link": "https://stackoverflow.com/users/3936396/devatoria"}, "edited": false, "score": 0, "creation_date": 1433004193, "post_id": 30547965, "comment_id": 49169616, "body": "Thank you for this interesting alternative that could help me for further steps in my project :)"}], "tags": [], "owner": {"reputation": 506, "user_id": 3835333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1c838f6bc14ea3297f3305aca42f8bf?s=128&d=identicon&r=PG&f=1", "display_name": "SkyeC", "link": "https://stackoverflow.com/users/3835333/skyec"}, "is_accepted": false, "score": 15, "last_activity_date": 1432999917, "creation_date": 1432999917, "answer_id": 30547965, "question_id": 30526946, "link": "https://stackoverflow.com/questions/30526946/time-http-response-in-go/30547965#30547965", "title": "Time HTTP Response in Go", "body": "<p>Not to take anything away from the perfectly valid accepted answer, one alternative to be aware of is to implement a custom RoundTripper that wraps the default http.Transport and net.Dialer. This can be helpful if you are instrumenting code that uses http.Client or if you need to support proxies, TLS, keep-alive or other HTTP capabilities but don't want/need to re-implement them all. You won't have quite as much control as you will with a fully customized client but it's worth having in your toolbox.</p>\n\n<p>Example round tripper:</p>\n\n<pre><code>type customTransport struct {\n    rtp       http.RoundTripper\n    dialer    *net.Dialer\n    connStart time.Time\n    connEnd   time.Time\n    reqStart  time.Time\n    reqEnd    time.Time\n}\n\nfunc newTransport() *customTransport {\n    tr := &amp;customTransport{\n        dialer: &amp;net.Dialer{\n            Timeout:   30 * time.Second,\n            KeepAlive: 30 * time.Second,\n        },\n    }\n    tr.rtp = &amp;http.Transport{\n        Proxy:               http.ProxyFromEnvironment,\n        Dial:                tr.dial,\n        TLSHandshakeTimeout: 10 * time.Second,\n    }\n    return tr\n}\n\nfunc (tr *customTransport) RoundTrip(r *http.Request) (*http.Response, error) {\n    tr.reqStart = time.Now()\n    resp, err := tr.rtp.RoundTrip(r)\n    tr.reqEnd = time.Now()\n    return resp, err\n}\n\nfunc (tr *customTransport) dial(network, addr string) (net.Conn, error) {\n    tr.connStart = time.Now()\n    cn, err := tr.dialer.Dial(network, addr)\n    tr.connEnd = time.Now()\n    return cn, err\n}\n\nfunc (tr *customTransport) ReqDuration() time.Duration {\n    return tr.Duration() - tr.ConnDuration()\n}\n\nfunc (tr *customTransport) ConnDuration() time.Duration {\n    return tr.connEnd.Sub(tr.connStart)\n}\n\nfunc (tr *customTransport) Duration() time.Duration {\n    return tr.reqEnd.Sub(tr.reqStart)\n}\n</code></pre>\n\n<p>I've dropped that into a simple example program here: <a href=\"https://github.com/skyec/go-instrumented-roundtripper/blob/master/main.go\" rel=\"noreferrer\">https://github.com/skyec/go-instrumented-roundtripper/blob/master/main.go</a></p>\n"}, {"tags": [], "owner": {"reputation": 123, "user_id": 2806415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10cc5883e17934a5fd4a33ad966fc101?s=128&d=identicon&r=PG&f=1", "display_name": "Aleksey Kanaev", "link": "https://stackoverflow.com/users/2806415/aleksey-kanaev"}, "is_accepted": false, "score": 1, "last_activity_date": 1524976191, "creation_date": 1524976191, "answer_id": 50083395, "question_id": 30526946, "link": "https://stackoverflow.com/questions/30526946/time-http-response-in-go/50083395#50083395", "title": "Time HTTP Response in Go", "body": "<p>There is package <a href=\"https://golang.org/pkg/net/http/httptrace/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/httptrace/</a> since go 1.7;\nIt supports timing of following operations:</p>\n\n<ul>\n<li>Connection creation</li>\n<li>Connection reuse</li>\n<li>DNS lookups</li>\n<li>Writing the request to the wire</li>\n<li>Reading the response</li>\n</ul>\n\n<p>Also take a look at <a href=\"https://github.com/davecheney/httpstat\" rel=\"nofollow noreferrer\">https://github.com/davecheney/httpstat</a>. It's nice utility for visualizing timing results.</p>\n"}], "owner": {"reputation": 555, "user_id": 3936396, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/0CBCe.jpg?s=128&g=1", "display_name": "Devatoria", "link": "https://stackoverflow.com/users/3936396/devatoria"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13894, "favorite_count": 2, "accepted_answer_id": 30527804, "answer_count": 3, "score": 14, "last_activity_date": 1544529991, "creation_date": 1432894365, "last_edit_date": 1432894888, "question_id": 30526946, "link": "https://stackoverflow.com/questions/30526946/time-http-response-in-go", "title": "Time HTTP Response in Go", "body": "<p>In my Go program, I made some HTTP requests and I need to time the <strong>response time</strong> (and not request time).</p>\n\n<p>Here is my current code (timing request time):</p>\n\n<pre><code>func Get() int {\n    start := time.Now()\n    result, err := http.Get(\"http://www.google.com\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer result.Body.Close()\n    elapsed := time.Since(start).Seconds()\n    log.Println(elapsed)\n\n    return result.StatusCode\n}\n</code></pre>\n\n<p>Actually, this code will show something about 5s request time, including DNS resolution and other things... If I execute the same test with a tool like Apache JMeter, the time is just about 100ms (which is the real response time of the server, without taking care about request time).</p>\n\n<p>What I really want is to compute the real response time of the server. How can I compute this in Go ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1432893131, "post_id": 30526389, "comment_id": 49126403, "body": "Maybe you need some <code>go ORM&#39;s</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 2482, "user_id": 2605049, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/EgmcV.png?s=128&g=1", "display_name": "s&#231;u&#231;u", "link": "https://stackoverflow.com/users/2605049/s%c3%a7u%c3%a7u"}, "edited": false, "score": 0, "creation_date": 1432900746, "post_id": 30526690, "comment_id": 49131494, "body": "will this generic approach is there any performance overhead as compared to the more static approach involving a struct for each table or query?"}, {"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "reply_to_user": {"reputation": 2482, "user_id": 2605049, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/EgmcV.png?s=128&g=1", "display_name": "s&#231;u&#231;u", "link": "https://stackoverflow.com/users/2605049/s%c3%a7u%c3%a7u"}, "edited": false, "score": 0, "creation_date": 1432901286, "post_id": 30526690, "comment_id": 49131840, "body": "Definitely. If you use a struct or variables and thus know your types and columns most of the code from the generic approach is unnecessary, i.e. overhead to the direct approach. So in most cases you&#39;d want to use variables or structs to select known data. But there are situations where a generic approach comes in very handy. I use it for example to publish entire tables from one database to another remote database and don&#39;t have to worry about the table structure or changes to it."}, {"owner": {"reputation": 2482, "user_id": 2605049, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/EgmcV.png?s=128&g=1", "display_name": "s&#231;u&#231;u", "link": "https://stackoverflow.com/users/2605049/s%c3%a7u%c3%a7u"}, "edited": false, "score": 0, "creation_date": 1432905432, "post_id": 30526690, "comment_id": 49134733, "body": "More on types: I think the map at this state of the above snippet, after populated, is ready to use in application logic with the data with correct types in it. I mean no type conversion is necessary, the types of data from populated into the map is same as the those in the database; integers of db are now go integers, strings of db are go strings all in their corresponding value places in that map, myMap."}, {"owner": {"reputation": 2482, "user_id": 2605049, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/EgmcV.png?s=128&g=1", "display_name": "s&#231;u&#231;u", "link": "https://stackoverflow.com/users/2605049/s%c3%a7u%c3%a7u"}, "edited": false, "score": 0, "creation_date": 1433148343, "post_id": 30526690, "comment_id": 49208702, "body": "Problem I now face with is one same row is appended to the slice I want rows to be gathered."}, {"owner": {"reputation": 2482, "user_id": 2605049, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/EgmcV.png?s=128&g=1", "display_name": "s&#231;u&#231;u", "link": "https://stackoverflow.com/users/2605049/s%c3%a7u%c3%a7u"}, "edited": false, "score": 0, "creation_date": 1433148789, "post_id": 30526690, "comment_id": 49208947, "body": "I have pointed out this in another question <a href=\"http://stackoverflow.com/questions/30569005/reading-database-rows-into-map-and-appending-to-a-slice-of-maps\" title=\"reading database rows into map and appending to a slice of maps\">stackoverflow.com/questions/30569005/&hellip;</a>"}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 1, "last_activity_date": 1432893690, "creation_date": 1432893690, "answer_id": 30526690, "question_id": 30526389, "link": "https://stackoverflow.com/questions/30526389/storing-data-returned-from-a-database-query-into-a-on-the-fly-created-generic-go/30526690#30526690", "title": "Storing data returned from a database query into a on the fly created generic Go data type", "body": "<p>To do that you'll have to use a map with values of type <code>interface{}</code> so they can store any type. If you also need the column names you'd have to use <code>rows.Columns()</code> to then extract all the data and types.</p>\n\n<p>This will read all columns from a table and store the values in a map as type <code>interface{}</code> with the column names as keys. Based on that you should be able to work out what you need for your use.</p>\n\n<pre><code>var myMap = make(map[string]interface{})\nrows, err := db.Query(\"SELECT * FROM myTable\")\ndefer rows.Close()\nif err != nil {\n    log.Fatal(err)\n}\ncolNames, err := rows.Columns()\nif err != nil {\n    log.Fatal(err)\n}\ncols := make([]interface{}, len(colNames))\ncolPtrs := make([]interface{}, len(colNames))\nfor i := 0; i &lt; len(colNames); i++ {\n    colPtrs[i] = &amp;cols[i]\n}\nfor rows.Next() {\n    err = rows.Scan(colPtrs...)\n    if err != nil {\n        log.Fatal(err)\n    }\n    for i, col := range cols {\n        myMap[colNames[i]] = col\n    }\n    // Do something with the map\n    for key, val := range myMap {\n        fmt.Println(\"Key:\", key, \"Value Type:\", reflect.TypeOf(val))\n    }\n}\n</code></pre>\n\n<p>Using the reflect package you can then get the Type for each column as needed as demonstrated with the loop at the end. Or you can use a <a href=\"https://golang.org/doc/effective_go.html#type_switch\" rel=\"nofollow\">type switch</a> to extract the types.</p>\n\n<p>The above is generic and will work with any number of columns and types.</p>\n"}], "owner": {"reputation": 2482, "user_id": 2605049, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/EgmcV.png?s=128&g=1", "display_name": "s&#231;u&#231;u", "link": "https://stackoverflow.com/users/2605049/s%c3%a7u%c3%a7u"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "closed_date": 1432905553, "accepted_answer_id": 30526690, "answer_count": 1, "score": -1, "last_activity_date": 1434141123, "creation_date": 1432892864, "last_edit_date": 1434141123, "question_id": 30526389, "link": "https://stackoverflow.com/questions/30526389/storing-data-returned-from-a-database-query-into-a-on-the-fly-created-generic-go", "closed_reason": "Needs details or clarity", "title": "Storing data returned from a database query into a on the fly created generic Go data type", "body": "<p>Instead of using a <code>struct</code>, which is predefined in terms of its number of data fileds, capacity, and types of that fields, having a <code>map</code>, which is expandable and can contain several data types as value, will be more advantageous. For example, on database side, changes to column names, column types, or number of columns in a table will not affect the go code related to querying the database, such as go data structure you put the <code>rows</code> returned form your database query.</p>\n\n<p>Is there a way in golang sql package or related drivers to know the types of the data, in rows, returned by a database query to define a <code>struct</code> with  appropriate number of fields and types?</p>\n\n<p>If not how can a <code>map</code> be used to accomplish this with column names of returned <code>rows</code> are <strong>keys</strong> and row fields are <strong>values</strong> of this <code>map</code>?</p>\n"}, {"tags": ["arrays", "performance", "go", "benchmarking", "slice"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1432891719, "post_id": 30525184, "comment_id": 49125458, "body": "There are several factors which influence such micro benchmarks: Bounds checking, allocation (heap, stack), code generation, peephole optimizations, etc. Have a look at the generated assembly output under different conditions like disabled bound checking or disabled optimizations."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 2, "creation_date": 1432894169, "post_id": 30525184, "comment_id": 49127112, "body": "Interestingly enough, if you add a <a href=\"http://play.golang.org/p/nyynQgndDl\" rel=\"nofollow noreferrer\">pointer to array</a> to the benchmarks, you&#39;ll see that they perform about the same as slices."}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1432892687, "post_id": 30526161, "comment_id": 49126088, "body": "But <code>runtime.duffcopy()</code> is only invoked once right? Seeing that the benchmark cycle is executed half a million times (<code>N</code>), this shouldn&#39;t have any effect on the result."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1432892802, "post_id": 30526161, "comment_id": 49126161, "body": "Yes, that&#39;s what I think as well."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1432893177, "post_id": 30526161, "comment_id": 49126435, "body": "Does the almost same result in case of global array and slice come from the fact that in that case the compiled code does not include the &quot;registry&quot; optimization and does the same address-loading from memory?"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1432893477, "post_id": 30526161, "comment_id": 49126636, "body": "Yes, full assembly <a href=\"http://pastebin.com/rqktY5A4\" rel=\"nofollow noreferrer\">here</a>. Both global versions load from memory just like the local array version does."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1432894066, "post_id": 30526161, "comment_id": 49127020, "body": "Thanks, very helpful. I wonder why no register optimization is used in case of accessing local array in a loop..."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1474276922, "post_id": 30526161, "comment_id": 66449000, "body": "@icza looks like a oversight to me. May be it make sense to raise an issue  for Go compiler."}], "tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": true, "score": 13, "last_activity_date": 1432892278, "creation_date": 1432892278, "answer_id": 30526161, "question_id": 30525184, "link": "https://stackoverflow.com/questions/30525184/array-vs-slice-accessing-speed/30526161#30526161", "title": "Array vs Slice: accessing speed", "body": "<p>Comparing <a href=\"https://www.diffchecker.com/ziekbed5\" rel=\"noreferrer\">the amd64 assembly</a> of both <code>BenchmarkArrayLocal</code> and <code>BenchmarkSliceLocal</code> (too long to fit in this post):</p>\n\n<p>The array version loads the address of <code>a</code> from memory multiple times, practically on every array-access operation:</p>\n\n<pre><code>LEAQ    \"\".a+1000(SP),BX\n</code></pre>\n\n<p>Whereas the slice version is computing exclusively on registers after loading once from memory:</p>\n\n<pre><code>LEAQ    (DX)(SI*1),BX\n</code></pre>\n\n<p>This is not conclusive but probably the cause. Reason being that both methods are otherwise virtually identical. One other notable detail is that the array version calls into <a href=\"https://golang.org/src/runtime/asm_amd64.s\" rel=\"noreferrer\"><code>runtime.duffcopy</code></a>, which is a quite long assembly routine, whereas the slice version doesn't.</p>\n"}, {"tags": [], "owner": {"reputation": 446, "user_id": 2428640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97cdaaaa61e5541b98a01bbdfbdcff09?s=128&d=identicon&r=PG", "display_name": "Pascal de Kloe", "link": "https://stackoverflow.com/users/2428640/pascal-de-kloe"}, "is_accepted": false, "score": 4, "last_activity_date": 1494607469, "creation_date": 1494607469, "answer_id": 43942734, "question_id": 30525184, "link": "https://stackoverflow.com/questions/30525184/array-vs-slice-accessing-speed/43942734#43942734", "title": "Array vs Slice: accessing speed", "body": "<p>Go version 1.8 can eliminate some range checks so the difference got bigger.</p>\n\n<p><code>\nBenchmarkSliceGlobal-4        500000          3220 ns/op\nBenchmarkArrayGlobal-4       1000000          1287 ns/op\nBenchmarkSliceLocal-4        1000000          1267 ns/op\nBenchmarkArrayLocal-4        1000000          1301 ns/op\n</code></p>\n\n<p>For arrays I'd recommend to use sizes from powers of two and include a logical and operation. In that way you're sure the compiler eliminates the check. Thus <code>var ga [1024]byte</code> with <code>ga[j &amp; 1023]</code>.</p>\n"}], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5548, "favorite_count": 8, "accepted_answer_id": 30526161, "answer_count": 2, "score": 17, "last_activity_date": 1494607469, "creation_date": 1432889375, "last_edit_date": 1434519808, "question_id": 30525184, "link": "https://stackoverflow.com/questions/30525184/array-vs-slice-accessing-speed", "title": "Array vs Slice: accessing speed", "body": "<p>This question is about the speed of <em>accessing elements</em> of arrays and slices, not about the efficiency of passing them to functions as arguments.</p>\n\n<p>I would expect <strong>arrays</strong> to be faster than <strong>slices</strong> in most cases because a slice is a data structure describing a contiguous section of an array and so there may be an extra step involved when accessing elements of a slice (indirectly the elements of its underlying array).</p>\n\n<p>So I wrote a little test to benchmark a batch of simple operations. There are 4 benchmark functions, the first 2 test a <strong>global</strong> slice and a global array, the other 2 test a <strong>local</strong> slice and a local array:</p>\n\n<pre><code>var gs = make([]byte, 1000) // Global slice\nvar ga [1000]byte           // Global array\n\nfunc BenchmarkSliceGlobal(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        for j, v := range gs {\n            gs[j]++; gs[j] = gs[j] + v + 10; gs[j] += v\n        }\n    }\n}\n\nfunc BenchmarkArrayGlobal(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        for j, v := range ga {\n            ga[j]++; ga[j] = ga[j] + v + 10; ga[j] += v\n        }\n    }\n}\n\nfunc BenchmarkSliceLocal(b *testing.B) {\n    var s = make([]byte, 1000)\n    for i := 0; i &lt; b.N; i++ {\n        for j, v := range s {\n            s[j]++; s[j] = s[j] + v + 10; s[j] += v\n        }\n    }\n}\n\nfunc BenchmarkArrayLocal(b *testing.B) {\n    var a [1000]byte\n    for i := 0; i &lt; b.N; i++ {\n        for j, v := range a {\n            a[j]++; a[j] = a[j] + v + 10; a[j] += v\n        }\n    }\n}\n</code></pre>\n\n<p>I ran the test multiple times, here is the typical output (<code>go test -bench .*</code>):</p>\n\n<pre><code>BenchmarkSliceGlobal      300000              4210 ns/op\nBenchmarkArrayGlobal      300000              4123 ns/op\nBenchmarkSliceLocal       500000              3090 ns/op\nBenchmarkArrayLocal       500000              3768 ns/op\n</code></pre>\n\n<p><strong>Analyzing the results:</strong></p>\n\n<p>Accessing the global slice is slightly slower than accessing the global array which is as I expected:<br>\n<code>4210</code> vs <code>4123</code> ns/op</p>\n\n<p>But accessing the local slice is significantly faster than accessing the local array:<br>\n<code>3090</code> vs <code>3768</code> ns/op</p>\n\n<p>My question is: <strong>What is the reason for this?</strong></p>\n\n<p><strong>Notes</strong></p>\n\n<p>I tried varying the following things but none changed the outcome:</p>\n\n<ul>\n<li>the size of the array/slice (tried 100, 1000, 10000)</li>\n<li>the order of the benchmark functions</li>\n<li>the element type of the array/slice (tried <code>byte</code> and <code>int</code>)</li>\n</ul>\n"}, {"tags": ["go", "redis", "redigo"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1432889443, "post_id": 30525005, "comment_id": 49123959, "body": "What is the error you are seeing?"}], "answers": [{"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432889955, "post_id": 30525335, "comment_id": 49124309, "body": "Yeah good point - changed title to something more appropriate."}, {"owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "edited": false, "score": 0, "creation_date": 1432900360, "post_id": 30525335, "comment_id": 49131223, "body": "I disagree with your remark about modifications. Read consistency is as important as write consistency, and a Redis MULTI/EXEC block can ensure both. There are definitely use cases for which you need to use GET operations in a MULTI/EXEC block."}, {"owner": {"reputation": 2277, "user_id": 771844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ed46d5b51b425b59d3b0f36e3973c83?s=128&d=identicon&r=PG", "display_name": "wyattisimo", "link": "https://stackoverflow.com/users/771844/wyattisimo"}, "edited": false, "score": 0, "creation_date": 1449025524, "post_id": 30525335, "comment_id": 55823688, "body": "@SirDarius It <i>is</i> possible to get the results from commands in a transaction. See my answer."}, {"owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "reply_to_user": {"reputation": 2277, "user_id": 771844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ed46d5b51b425b59d3b0f36e3973c83?s=128&d=identicon&r=PG", "display_name": "wyattisimo", "link": "https://stackoverflow.com/users/771844/wyattisimo"}, "edited": false, "score": 0, "creation_date": 1449049270, "post_id": 30525335, "comment_id": 55833523, "body": "@wyattisimo I said from <b>within</b> a transaction. Your answer obtains the values after the transaction has been executed, just like mine, except in a better way. <code>Values</code> is nicer than the <code>Receive</code> calls indeed."}], "tags": [], "owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "is_accepted": false, "score": 4, "last_activity_date": 1432902639, "last_edit_date": 1432902639, "creation_date": 1432889801, "answer_id": 30525335, "question_id": 30525005, "link": "https://stackoverflow.com/questions/30525005/redigo-multi-requests/30525335#30525335", "title": "Redigo multi requests", "body": "<p><code>MULTI</code> is used to send several commands in an atomic way to Redis, by creating a transaction. This is not a pipeline at all.</p>\n\n<p>None of the commands will be actually executed before the <code>EXEC</code> call so it is impossible to obtain the value when you call <code>GET</code> from within a transaction.</p>\n\n<p>From the docs:</p>\n\n<blockquote>\n  <p>When a Redis connection is in the context of a MULTI request, all commands will reply with the string QUEUED (sent as a Status Reply from the point of view of the Redis protocol). A queued command is simply scheduled for execution when EXEC is called.</p>\n</blockquote>\n\n<p>In redigo pipelining is done in a different way:</p>\n\n<p><a href=\"http://godoc.org/github.com/garyburd/redigo/redis#hdr-Pipelining\" rel=\"nofollow\">http://godoc.org/github.com/garyburd/redigo/redis#hdr-Pipelining</a></p>\n\n<p>What you want to do is something like this (untested):</p>\n\n<pre><code>c.Send(\"GET\", key)\nc.Send(\"EXPIRE\", key)\nc.Flush()\nv := redis.Bytes(c.Receive()) // reply from GET\n_, err = c.Receive() // reply from EXPIRE\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1455, "user_id": 1261335, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7148159afe3a7065728d44063f3d22d0?s=128&d=identicon&r=PG", "display_name": "GrandOpener", "link": "https://stackoverflow.com/users/1261335/grandopener"}, "edited": false, "score": 0, "creation_date": 1501532559, "post_id": 34034177, "comment_id": 77810652, "body": "Note that if you are not very familiar with the internals of redis and redigo, it might be safer to also use the built in conversion functions with a nil error value for the secondary conversions.  In this example, that would look like this: <code>data := redis.Bytes(r[0], nil)</code>."}], "tags": [], "owner": {"reputation": 2277, "user_id": 771844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ed46d5b51b425b59d3b0f36e3973c83?s=128&d=identicon&r=PG", "display_name": "wyattisimo", "link": "https://stackoverflow.com/users/771844/wyattisimo"}, "is_accepted": false, "score": 5, "last_activity_date": 1449026532, "last_edit_date": 1449026532, "creation_date": 1449025449, "answer_id": 34034177, "question_id": 30525005, "link": "https://stackoverflow.com/questions/30525005/redigo-multi-requests/34034177#34034177", "title": "Redigo multi requests", "body": "<p>In redis, the <code>EXEC</code> command returns an array containing the results of all the commands in the transaction.</p>\n\n<p>redigo provides a <code>Values</code> function, which converts an array command reply to a <code>[]interface{}</code>.</p>\n\n<pre><code>c.Send(\"MULTI\")\nc.Send(\"GET\", key)\nc.Send(\"EXPIRE\", key)\nr, err := redis.Values(c.Do(\"EXEC\"))\n</code></pre>\n\n<p><code>r[0]</code> now has the reply from your <code>GET</code> command as a <code>interface{}</code>, so you'll need to do a type assertion to get the slice of bytes you're expecting:</p>\n\n<pre><code>data := r[0].([]byte)\n</code></pre>\n\n<p><strong>References</strong></p>\n\n<ul>\n<li>func Values: <a href=\"https://godoc.org/github.com/garyburd/redigo/redis#Values\" rel=\"noreferrer\">https://godoc.org/github.com/garyburd/redigo/redis#Values</a></li>\n<li>Type assertions: <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"noreferrer\">https://golang.org/ref/spec#Type_assertions</a></li>\n</ul>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5656, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1449026532, "creation_date": 1432888760, "last_edit_date": 1432889929, "question_id": 30525005, "link": "https://stackoverflow.com/questions/30525005/redigo-multi-requests", "title": "Redigo multi requests", "body": "<p>I have previously been using this:</p>\n\n<pre><code>data, err := redis.Bytes(c.Do(\"GET\", key))\n</code></pre>\n\n<p>to make sure that data returned is a slice of bytes.</p>\n\n<p>However, I now need to add an extra command to the Redis request so I have something like this:</p>\n\n<pre><code>c.Send(\"MULTI\")\nc.Send(\"GET\", key)\nc.Send(\"EXPIRE\", key)\nr, err := c.Do(\"EXEC\")\n</code></pre>\n\n<p>but now I can't seem to make the <code>GET</code> command return a slice of bytes. I've tried adding <code>redis.Bytes</code> like below but no luck.</p>\n\n<pre><code>c.Send(\"MULTI\")\nredis.Bytes(c.Send(\"GET\", key))\nc.Send(\"EXPIRE\", key)\nr, err := c.Do(\"EXEC\")\n</code></pre>\n"}, {"tags": ["go", "martini"], "answers": [{"comments": [{"owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "edited": false, "score": 0, "creation_date": 1432923551, "post_id": 30521796, "comment_id": 49146547, "body": "so there is no way that i can use dbmap.AddTableWithName(Post{}, &quot;posts&quot;).SetKeys(true, &quot;Id&quot;) and have longtext? i have to define database tables first?"}], "tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": true, "score": 0, "last_activity_date": 1432877514, "creation_date": 1432877514, "answer_id": 30521796, "question_id": 30519847, "link": "https://stackoverflow.com/questions/30519847/how-to-define-column-type-in-golang-type-struct-as-longtext/30521796#30521796", "title": "how to define column type in golang type struct as longtext?", "body": "<p>Maximum length of a string in go is definitely way bigger than 255. If you will look at <a href=\"http://play.golang.org/p/k8XRgad0pv\" rel=\"nofollow\">this code</a>:</p>\n\n<pre><code>myPost := Post{\n  Id: 43,\n  Created: 324,\n  Title: \"title\",\n  Body: \"very long string\",\n}\nfmt.Println(myPost.Body)\nfmt.Println()\nfmt.Println(len(myPost.Body))\n</code></pre>\n\n<p>you will see that the output of a string and the length is clearly bigger than 255. So either you are saving it to database, which truncates it, or I would rather create a nice reproducible example.</p>\n"}], "owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 853, "favorite_count": 0, "accepted_answer_id": 30521796, "answer_count": 1, "score": 1, "last_activity_date": 1432923803, "creation_date": 1432864102, "last_edit_date": 1432923803, "question_id": 30519847, "link": "https://stackoverflow.com/questions/30519847/how-to-define-column-type-in-golang-type-struct-as-longtext", "title": "how to define column type in golang type struct as longtext?", "body": "<p>I have this peace of code:</p>\n\n<pre><code>type Post struct {\n    Id      int64 `db:\"post_id\"`\n    Created int64\n    Title   string `form:\"Title\"`\n    Body    string `form:\"Body\" binding:\"required\"`\n\n}\n</code></pre>\n\n<p>but that gets me only 255 varchar for Body.\nHow can i set that to be longtext?</p>\n\n<p>This is from example app for martini framework.</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432856350, "post_id": 30518217, "comment_id": 49112533, "body": "Which you can see <a href=\"https://play.golang.org/p/xJrti_OfzA\" rel=\"nofollow noreferrer\">by sending more than two values</a>. You&#39;ll notice that (on the playground at least) these tend to get grouped in pairs (i.e. as Nathan says, control switches back to the sender so it logs the second line before it blocks again)."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 1, "creation_date": 1432884431, "post_id": 30518217, "comment_id": 49120870, "body": "Although arguably accurate, I wouldn&#39;t call this a race condition. Rather just a manifestation of scheduler yield points. Most people only call it a race condition if it leads to erroneous behavior and this code does not."}], "tags": [], "owner": {"reputation": 63413, "user_id": 193619, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/11e74c6cb64be4d24fdee076ddb374b0?s=128&d=identicon&r=PG", "display_name": "Nathan Osman", "link": "https://stackoverflow.com/users/193619/nathan-osman"}, "is_accepted": true, "score": 5, "last_activity_date": 1432852772, "creation_date": 1432852772, "answer_id": 30518217, "question_id": 30518166, "link": "https://stackoverflow.com/questions/30518166/why-arent-sends-on-this-channel-blocking/30518217#30518217", "title": "Why aren&#39;t sends on this channel blocking?", "body": "<p>This is caused by a race condition in the two goroutines. By default, the Go runtime uses a single thread for all goroutines, so execution is serialized. Consider the following possible scenario for executing the code above:</p>\n\n<ul>\n<li>the first goroutine is blocked by a <code>Sleep()</code> call</li>\n<li>the second goroutine is blocked waiting for a receive on the channel</li>\n<li>the first goroutine resumes execution after the <code>Sleep()</code> call ends</li>\n<li><code>\"test1\"</code> is written to the channel, which blocks</li>\n<li>the second goroutine receives the value <em>but before printing the output, execution switches back to the first goroutine</em></li>\n<li>the first goroutine prints <code>\"Sending test2...\"</code> and writes the second value to the channel which again blocks</li>\n<li>the second goroutine resumes where it was preempted and prints the <code>\"Received: test1\"</code> message</li>\n<li>the loop is executed again and receives the second value</li>\n</ul>\n\n<p>In summary, the send is indeed blocking, it just doesn't appear to be due to the order of output.</p>\n"}], "owner": {"reputation": 63413, "user_id": 193619, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/11e74c6cb64be4d24fdee076ddb374b0?s=128&d=identicon&r=PG", "display_name": "Nathan Osman", "link": "https://stackoverflow.com/users/193619/nathan-osman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 30518217, "answer_count": 1, "score": 2, "last_activity_date": 1432852772, "creation_date": 1432852423, "question_id": 30518166, "link": "https://stackoverflow.com/questions/30518166/why-arent-sends-on-this-channel-blocking", "title": "Why aren&#39;t sends on this channel blocking?", "body": "<p>Consider the following snippet of Go code:</p>\n\n<pre><code>c := make(chan string)\n\ngo func() {\n    time.Sleep(100 * time.Millisecond)\n    fmt.Println(\"Sending test1...\")\n    c &lt;- \"test1\"\n    fmt.Println(\"Sending test2...\")\n    c &lt;- \"test2\"\n    fmt.Println(\"Done sending\")\n}()\n\ngo func() {\n    for {\n        select {\n        case n := &lt;-c:\n            fmt.Println(\"Received:\", n)\n        }\n    }\n}()\n</code></pre>\n\n<p><sub><strong>Full source:</strong> <a href=\"http://play.golang.org/p/yY6JQzDMvn\" rel=\"nofollow\">http://play.golang.org/p/yY6JQzDMvn</a></sub></p>\n\n<p>I expect that the first goroutine will block when attempting to write <code>\"test1\"</code> to the channel until the receive in the second goroutine. The expected output would be:</p>\n\n<pre><code>Sending test1...\nReceived: test1\nSending test2...\nReceived: test2\n</code></pre>\n\n<p>However, when I actually run the example, I end up with:</p>\n\n<pre><code>Sending test1...\nSending test2...\nReceived: test1\nReceived: test2\n</code></pre>\n\n<p>It would appear by the output that the send is not blocking as one would expect. What's going on here?</p>\n"}, {"tags": ["go", "phantomjs", "exec"], "comments": [{"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1432842058, "post_id": 30515665, "comment_id": 49106496, "body": "Is the code that you want to pass to PhantomJS dynamically generated? If not, what&#39;s dynamic about it? Can&#39;t you simply put it in a file and pass some options into the script?"}, {"owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "reply_to_user": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1432842435, "post_id": 30515665, "comment_id": 49106694, "body": "The code is indeed dynamically generated. That is: one part is dynamically, the <code>url</code>. I indeed can put it in a file, but this means that I&#39;ll have to ship it together with my golang binary. It would be much better if my Go code delivers the code to the phantomJS binary."}], "answers": [{"comments": [{"owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "edited": false, "score": 0, "creation_date": 1432877161, "post_id": 30516246, "comment_id": 49117496, "body": "Thanks; variant 1 it will be, using system.args[1] to get the url."}], "tags": [], "owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "is_accepted": true, "score": 5, "last_activity_date": 1432887757, "last_edit_date": 1495535337, "creation_date": 1432844013, "answer_id": 30516246, "question_id": 30515665, "link": "https://stackoverflow.com/questions/30515665/pass-complete-code-to-phantomjs/30516246#30516246", "title": "Pass complete code to phantomjs", "body": "<p>PhantomJS has an interactive version where you can pass code in through stdin, but there is a <a href=\"https://stackoverflow.com/questions/17708657/execute-a-script-in-phantomjs-interactive-repl-mode\">bug</a> (versions 1.9.x and 2.0.0) because of which no pages can be opened which makes this effectively unusable.</p>\n\n<p>There is no way to pass a script into PhantomJS to be interpreted. You need to have at least one file. You can either</p>\n\n<ol>\n<li><p>create a template file which you ship with your executable and call PhantomJS with that file and an additional (URL) parameter or</p></li>\n<li><p>you generate the file from go into some temporary directory and let PhantomJS use it.</p></li>\n</ol>\n\n<p>If you have reason to believe that a time-of-write vs. time-of-use vulnerability will be exploited, then you should go with variant 1.</p>\n\n<p>To make the first case complete, you can use <a href=\"http://phantomjs.org/api/system/property/args.html\" rel=\"nofollow noreferrer\"><code>system.args</code></a> in PhantomJS to read the passed commandline options from go such as the URL.</p>\n"}, {"comments": [{"owner": {"reputation": 33978, "user_id": 124119, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14570e9514625800a440f40fec36ed6e?s=128&d=identicon&r=PG", "display_name": "Camilo Martin", "link": "https://stackoverflow.com/users/124119/camilo-martin"}, "edited": false, "score": 1, "creation_date": 1456712774, "post_id": 33275084, "comment_id": 59059688, "body": "I just checked and it works in Windows (MSysGit) as well."}], "tags": [], "owner": {"reputation": 407, "user_id": 5423680, "user_type": "registered", "accept_rate": 44, "profile_image": "https://lh5.googleusercontent.com/-26RXn_wl_Vw/AAAAAAAAAAI/AAAAAAAABqQ/Soy15798wpE/photo.jpg?sz=128", "display_name": "Kelyane", "link": "https://stackoverflow.com/users/5423680/kelyane"}, "is_accepted": false, "score": 1, "last_activity_date": 1456712663, "last_edit_date": 1456712663, "creation_date": 1445497272, "answer_id": 33275084, "question_id": 30515665, "link": "https://stackoverflow.com/questions/30515665/pass-complete-code-to-phantomjs/33275084#33275084", "title": "Pass complete code to phantomjs", "body": "<p>If you are using Linux, you can put this code in the beginning of the PhantomJS script. </p>\n\n<pre><code>#!/usr/bin/env phantomjs\n</code></pre>\n\n<p>This means, when this file is called, it's like it was called by the terminal.</p>\n\n<pre><code>$ phantomjs script.js args\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 33978, "user_id": 124119, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14570e9514625800a440f40fec36ed6e?s=128&d=identicon&r=PG", "display_name": "Camilo Martin", "link": "https://stackoverflow.com/users/124119/camilo-martin"}, "is_accepted": false, "score": -2, "last_activity_date": 1456713754, "creation_date": 1456713754, "answer_id": 35691117, "question_id": 30515665, "link": "https://stackoverflow.com/questions/30515665/pass-complete-code-to-phantomjs/35691117#35691117", "title": "Pass complete code to phantomjs", "body": "<p>The interactive version of phantomjs is <a href=\"https://github.com/ariya/phantomjs/issues/11180\" rel=\"nofollow\">completely screwed as of writing</a>.</p>\n\n<p>Due to this, if you don't want an extra file in your project, the cleanest way (if you're just distributing a script and not a directory bundle) is to generate a randomly-named js file in the temp directory, run it, and delete it after.</p>\n"}], "owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 613, "favorite_count": 1, "accepted_answer_id": 30516246, "answer_count": 3, "score": 2, "last_activity_date": 1456713754, "creation_date": 1432841784, "last_edit_date": 1432842226, "question_id": 30515665, "link": "https://stackoverflow.com/questions/30515665/pass-complete-code-to-phantomjs", "title": "Pass complete code to phantomjs", "body": "<p>I'm writing a service in Go and I'm using phantomJS to generate an image from a given url. From my Go program, I'm using <code>Exec</code> to start the phantomJS binary. This works fine, but now I'm looking for a way to pass the complete code, together with the call which runs the binary. My code is as follows:</p>\n\n<pre><code>var args = require('system').args;\nvar webPage = require('webpage');\nvar page = webPage.create();\n\npage.viewportSize = {\n    width: 1920,\n    height: 1080\n};\n\npage.open(\"http://www.url2fetch.com\", function (status) {\n  var base64 = page.renderBase64('PNG');\n  console.log(base64);\n  phantom.exit();\n});\n</code></pre>\n\n<p>This never changes. Except the url to fetch :). So my concrete question is: is it possible to start phantomJS and pass the code above as a parameter so it can be executed with one call. Reason for this: I don't want to package the phantomjs script together with my Go program.</p>\n"}, {"tags": ["go", "floating-point", "hex", "type-conversion"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1907906"}, "edited": false, "score": 0, "creation_date": 1432826688, "post_id": 30510711, "comment_id": 49096991, "body": "I get <code>3.289141843e+09</code> from your code. Is this correct?"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1432827861, "post_id": 30511187, "comment_id": 49097930, "body": "While it uses the same unsafe method, the <code>math</code> package has methods like <a href=\"http://golang.org/pkg/math/#Float64frombits\" rel=\"nofollow noreferrer\">Float64FromBits</a> to do just this"}, {"owner": {"reputation": 1086, "user_id": 2111533, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/db1096a59107ffe4dce1bcfd648048fb?s=128&d=identicon&r=PG&f=1", "display_name": "Jan", "link": "https://stackoverflow.com/users/2111533/jan"}, "edited": false, "score": 0, "creation_date": 1432828024, "post_id": 30511187, "comment_id": 49098061, "body": "The result has to be -561.2863 though, according to <a href=\"http://www.h-schmidt.net/FloatConverter/IEEE754.html\" rel=\"nofollow noreferrer\">this</a> page"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1086, "user_id": 2111533, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/db1096a59107ffe4dce1bcfd648048fb?s=128&d=identicon&r=PG&f=1", "display_name": "Jan", "link": "https://stackoverflow.com/users/2111533/jan"}, "edited": false, "score": 1, "creation_date": 1432828509, "post_id": 30511187, "comment_id": 49098393, "body": "@Jan The difference was because the number is a 32-bit float not 64-bit which you haven&#39;t stated. Doing so gives your expected result."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1471955278, "last_edit_date": 1471955278, "creation_date": 1432827627, "answer_id": 30511187, "question_id": 30510711, "link": "https://stackoverflow.com/questions/30510711/how-to-convert-hex-to-float/30511187#30511187", "title": "How to convert hex to float", "body": "<p>First it needs to be stated the bit-length of the input. Since the hex representation has 4 bytes (8 hex digits), it is most likely a <code>float32</code> (needs clarification from the asker).</p>\n\n<p>You can parse the bytes from the hex representation into an <code>uint32</code> using <a href=\"https://golang.org/pkg/strconv/#ParseUint\" rel=\"noreferrer\"><code>strconv.ParseUint()</code></a>. <code>ParseUint()</code> always returns <code>uint64</code> which uses 8 bytes in memory so you have to convert it to <code>uint32</code> which uses 4 bytes just like <code>float32</code>:</p>\n\n<pre><code>s := \"C40C5253\"\nn, err := strconv.ParseUint(s, 16, 32)\nif err != nil {\n    panic(err)\n}\nn2 = uint32(n)\n</code></pre>\n\n<p>Now you have the bytes but they are stored in a variable of type <code>uint32</code> and therefore interpreted as the bytes of an integer. And you want to interpret them as the bytes of a IEEE-754 floating point number, you can use the <a href=\"https://golang.org/pkg/unsafe/\" rel=\"noreferrer\"><code>unsafe</code></a> package to do that:</p>\n\n<pre><code>f := *(*float32)(unsafe.Pointer(&amp;n2))\nfmt.Println(f)\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/Cq1SCuWSPr\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>-561.2863\n</code></pre>\n\n<p><strong>Note:</strong></p>\n\n<p>As JimB noted, for the 2nd part (translating <code>uint32</code> to <code>float32</code>) the <a href=\"http://golang.org/pkg/math/\" rel=\"noreferrer\"><code>math</code></a> package has a built-in function <a href=\"http://golang.org/pkg/math/#Float32frombits\" rel=\"noreferrer\"><code>math.Float32frombits()</code></a> which does exactly this under the hood:</p>\n\n<pre><code>f := math.Float32frombits(n2)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1432828474, "post_id": 30511455, "comment_id": 49098370, "body": "No need to editorialize about other answers. There&#39;s also no problem with byte-order, as the math package does the exact same unsafe operation of <code>*(*float32)(unsafe.Pointer(&amp;b))</code>."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1432828698, "post_id": 30511455, "comment_id": 49098523, "body": "On <a href=\"https://stackoverflow.com\">Stack Overflow</a> &quot;previous answer&quot; has no meaning, answers get reordered based on votes and the readers options. If you need to refer to another answer use the &quot;share&quot; link to get a link. Also, link only answers are not a good fit for SO, you should include the relevant part (in this case the code) from the link into the post."}, {"owner": {"reputation": 1771, "user_id": 3938986, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L805E.jpg?s=128&g=1", "display_name": "Gary Storey", "link": "https://stackoverflow.com/users/3938986/gary-storey"}, "edited": false, "score": 3, "creation_date": 1432828741, "post_id": 30511455, "comment_id": 49098552, "body": "Welcome To Stack Overflow! Instead of pasting a link to a solution, you should also add the relevant code from the link in your answer.  That way if the link ever goes down the answer is still available."}], "tags": [], "owner": {"reputation": 9, "user_id": 4949957, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/a7fff991982875211e148fbdac247ede?s=128&d=identicon&r=PG", "display_name": "yed", "link": "https://stackoverflow.com/users/4949957/yed"}, "is_accepted": false, "score": 0, "last_activity_date": 1432834166, "last_edit_date": 1432834166, "creation_date": 1432828317, "answer_id": 30511455, "question_id": 30510711, "link": "https://stackoverflow.com/questions/30510711/how-to-convert-hex-to-float/30511455#30511455", "title": "How to convert hex to float", "body": "<p>The input is 32 bits, so must be treated as a 32-bit number. It is also unsigned, so should be parsed as a uint, not int. Finally, there is no need to use unsafe operations, and in fact as used here they will fail on a machine with a different byte order. </p>\n\n<p>Instead, use <code>math.Float32frombits</code>, which does exactly what you want:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"strconv\"\n)\n\nfunc main() {\n    s := \"C40C5253\"\n    n, err := strconv.ParseUint(s, 16, 32)\n    if err != nil {\n        panic(err)\n    }\n\n    nn := uint32(n)\n\n    g := math.Float32frombits(nn)\n    fmt.Println(g)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>-561.2863\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/y1ZjH9pscy\" rel=\"nofollow\">http://play.golang.org/p/y1ZjH9pscy</a></p>\n"}, {"tags": [], "owner": {"reputation": 9694, "user_id": 797538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b50394e88b7b1ff30dbca04c06560e5a?s=128&d=identicon&r=PG", "display_name": "lnmx", "link": "https://stackoverflow.com/users/797538/lnmx"}, "is_accepted": false, "score": 6, "last_activity_date": 1432828717, "creation_date": 1432828717, "answer_id": 30511622, "question_id": 30510711, "link": "https://stackoverflow.com/questions/30510711/how-to-convert-hex-to-float/30511622#30511622", "title": "How to convert hex to float", "body": "<p>Here are two different approaches that produce -561.2863: <a href=\"http://play.golang.org/p/Y60XB820Ib\" rel=\"noreferrer\">http://play.golang.org/p/Y60XB820Ib</a></p>\n\n<pre><code>import (\n    \"bytes\"\n    \"encoding/binary\"\n    \"encoding/hex\"\n    \"math\"\n    \"strconv\"\n)\n\nfunc parse_read(s string) (f float32, err error) {\n    b, err := hex.DecodeString(s)\n\n    if err != nil {\n        return\n    }\n\n    buf := bytes.NewReader(b)\n\n    err = binary.Read(buf, binary.BigEndian, &amp;f)\n\n    return\n}\n\nfunc parse_math(s string) (f float32, err error) {\n    i, err := strconv.ParseUint(s, 16, 32)\n\n    if err != nil {\n        return\n    }\n\n    f = math.Float32frombits(uint32(i))\n\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 1086, "user_id": 2111533, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/db1096a59107ffe4dce1bcfd648048fb?s=128&d=identicon&r=PG&f=1", "display_name": "Jan", "link": "https://stackoverflow.com/users/2111533/jan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13911, "favorite_count": 0, "accepted_answer_id": 30511187, "answer_count": 3, "score": 5, "last_activity_date": 1561812928, "creation_date": 1432826431, "last_edit_date": 1561812928, "question_id": 30510711, "link": "https://stackoverflow.com/questions/30510711/how-to-convert-hex-to-float", "title": "How to convert hex to float", "body": "<p>I have to convert <code>hex</code>, represeneted as <code>string</code>s (e.g. <code>\"0xC40C5253\"</code>) to float values (<em>IEEE-754</em> conversion). I did not manage to do that using the strconv.ParseFloat function. Is there anything else I have to use?\nI couldn't find it so far. I also tried converting it to an integer first and then to a float, but the results were wrong.</p>\n\n<p>Code of my last try:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"strconv\"\n)\n\nfunc main () {\n  x, err := strconv.ParseInt(\"C40C5253\", 16, 64) \n  f, err := strconv.ParseFloat(fmt.Sprintf(\"%d\", x), 64) \n\n  if err != nil {\n    fmt.Printf(\"Error in conversion: %s\\n\", err)\n  } else {\n    fmt.Println(f)\n  }\n}\n</code></pre>\n"}, {"tags": ["linux", "html", "go", "websocket", "network-programming"], "comments": [{"owner": {"reputation": 15, "user_id": 4107776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17f49eacfa5797ee5eb490a4a62d5118?s=128&d=identicon&r=PG&f=1", "display_name": "jktexas1", "link": "https://stackoverflow.com/users/4107776/jktexas1"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1432862239, "post_id": 30508787, "comment_id": 49113978, "body": "I really want to have a separate server application running somewhere and a separate client application that opens somewhere else just like regular socket applications work. Or do websockets not work that way? I&#39;m working on a multiplayer html5 game and it sounds to me that I would literally have to make a whole new website running on different ports for every server I want to make. So running 10 servers would mean I have to run 10 different websites?"}, {"owner": {"reputation": 15, "user_id": 4107776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17f49eacfa5797ee5eb490a4a62d5118?s=128&d=identicon&r=PG&f=1", "display_name": "jktexas1", "link": "https://stackoverflow.com/users/4107776/jktexas1"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1432865937, "post_id": 30508787, "comment_id": 49114829, "body": "I made a directory with all 3 go files and the home.html file on my server for the example you linked. I built the application and ran it on server, but whenever I try to open http//:244.214.21.44:8080/ i get the following error: ERR_CONNECTION_REFUSED. I&#39;ve tried it with port 8080 forwarded and not forwarded."}, {"owner": {"reputation": 15, "user_id": 4107776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17f49eacfa5797ee5eb490a4a62d5118?s=128&d=identicon&r=PG&f=1", "display_name": "jktexas1", "link": "https://stackoverflow.com/users/4107776/jktexas1"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1432869630, "post_id": 30508787, "comment_id": 49115537, "body": "On the server application do i need to specify that the server socket on html runs on the exteranal IP instead of localhost?"}, {"owner": {"reputation": 15, "user_id": 4107776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17f49eacfa5797ee5eb490a4a62d5118?s=128&d=identicon&r=PG&f=1", "display_name": "jktexas1", "link": "https://stackoverflow.com/users/4107776/jktexas1"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1432870920, "post_id": 30508787, "comment_id": 49115804, "body": "Ok, i guess its a network issue. I&#39;ll be trying to figure out whats blocking me from accessing the server from browser. Thanks for the info"}, {"owner": {"reputation": 15641, "user_id": 1567738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1065193e064ef75f6278754f7f02abb6?s=128&d=identicon&r=PG", "display_name": "Intermernet", "link": "https://stackoverflow.com/users/1567738/intermernet"}, "edited": false, "score": 0, "creation_date": 1432877624, "post_id": 30508787, "comment_id": 49117654, "body": "This sounds very much like an SE Linux related issue. Have look at <a href=\"http://wiki.centos.org/HowTos/SELinux\" rel=\"nofollow noreferrer\">wiki.centos.org/HowTos/SELinux</a> and see if it helps. You can set SE Linux to &quot;permissive&quot; or &quot;disabled&quot; for testing and development, but it&#39;s not recommended on a production server."}, {"owner": {"reputation": 15, "user_id": 4107776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17f49eacfa5797ee5eb490a4a62d5118?s=128&d=identicon&r=PG&f=1", "display_name": "jktexas1", "link": "https://stackoverflow.com/users/4107776/jktexas1"}, "edited": false, "score": 0, "creation_date": 1432879176, "post_id": 30508787, "comment_id": 49118215, "body": "I think i have ports 80, 443 and 8080 blocked by my ISP, i checked on &quot;<a href=\"http://www.t1shopper.com/tools/port-scan/\" rel=\"nofollow noreferrer\">t1shopper.com/tools/port-scan</a>&quot; and all 3 show up as &quot;isn&#39;t responding on port 80 (http)&quot; or something rather. I&#39;ve opened a ticket with my ISP to see whats up."}, {"owner": {"reputation": 15, "user_id": 4107776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17f49eacfa5797ee5eb490a4a62d5118?s=128&d=identicon&r=PG&f=1", "display_name": "jktexas1", "link": "https://stackoverflow.com/users/4107776/jktexas1"}, "edited": false, "score": 0, "creation_date": 1432949272, "post_id": 30508787, "comment_id": 49155724, "body": "Ok so my isp says they don&#39;t block ports. I&#39;ve done a test to see if I host on my desktop and connect to it from my laptop by way of local ip &quot;192.168.1.104&quot; and I can do that. Just for some reason my servers not responding. My server has go version 1.2.1 vs having 1.4.2 on my desktop. Would that possibly cause the problem? The local test to the server doesn&#39;t work."}], "owner": {"reputation": 15, "user_id": 4107776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17f49eacfa5797ee5eb490a4a62d5118?s=128&d=identicon&r=PG&f=1", "display_name": "jktexas1", "link": "https://stackoverflow.com/users/4107776/jktexas1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1005, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1432821623, "creation_date": 1432821623, "question_id": 30508787, "link": "https://stackoverflow.com/questions/30508787/connecting-to-websocket-server-from-external-network", "title": "Connecting to websocket server from external network", "body": "<p>I'm not sure whether to ask this question on a programming forum or linux administration forum as it involves both programming with web sockets and server admin. Basically I am trying to follow this guide \"<a href=\"http://41j.com/blog/2014/12/simple-websocket-example-golang/\" rel=\"nofollow\">http://41j.com/blog/2014/12/simple-websocket-example-golang/</a>\". I have a centos basic server that has a static IP and I've port forwarded it to ports 22 and 80 (ssh and http). I can compile and run the server app fine, but i cannot connect the client. I'm currently out of ideas since I've never messed with networking before. I read somewhere that html5 websockets go through ports 80 and 443 when given an external IP. What I want is to start the server app on port say something like 1445 and then lets pretend my external IP is 244.214.21.44 and then have client connection string look like 'ws//244.214.21.44:1445/echo'. What am I missing, do I need to install apache or something?</p>\n\n<p>Thanks for reading.</p>\n"}, {"tags": ["go", "gorilla", "negroni"], "answers": [{"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432817502, "post_id": 30507004, "comment_id": 49089762, "body": "Thanks but getting: <code>not enough arguments in call to context.ClearHandler</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432817605, "post_id": 30507004, "comment_id": 49089838, "body": "@tommyd456 Yes, updated the answer. <code>context.ClearHandler()</code> also expects another <code>http.Handler</code>."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432817813, "post_id": 30507004, "comment_id": 49089997, "body": "So I can do away with my <code>n.UseHandler(router)</code> and simply add <code>n.UseHandler(context.ClearHandler(router))</code> ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432823864, "post_id": 30507004, "comment_id": 49094843, "body": "@tommyd456 Please see edited answer. If you are using <code>mux.Router</code>, that automatically clears at the end of requests lifetime, so you don&#39;t need to use <code>context.ClearHandler()</code> at all. You only need to use it for other/custom handlers (unless you want to call <code>context.Clear()</code> manually)."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432827212, "post_id": 30507004, "comment_id": 49097432, "body": "I should have mentioned - I&#39;m using httprouter by Julien Schmidt"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1432823791, "last_edit_date": 1432823791, "creation_date": 1432817207, "answer_id": 30507004, "question_id": 30506831, "link": "https://stackoverflow.com/questions/30506831/negroni-and-gorilla-context-clearhandler/30507004#30507004", "title": "Negroni and Gorilla Context ClearHandler", "body": "<p><a href=\"http://godoc.org/github.com/codegangsta/negroni#Negroni.Use\" rel=\"nofollow\"><code>Negroni.Use()</code></a> expects a parameter of type <a href=\"http://godoc.org/github.com/codegangsta/negroni#Handler\" rel=\"nofollow\"><code>negroni.Handler</code></a> but Gorilla's <a href=\"http://godoc.org/code.google.com/p/gorilla/context#ClearHandler\" rel=\"nofollow\"><code>context.ClearHandler()</code></a> returns a value of type <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow\"><code>http.Handler</code></a>.</p>\n\n<p>Good thing is that there is an alternative <a href=\"http://godoc.org/github.com/codegangsta/negroni#Negroni.UseHandler\" rel=\"nofollow\"><code>Negroni.UseHandler()</code></a> method which expects an <code>http.Handler</code> so just use that. Note that <code>context.ClearHandler()</code> also expects another <code>http.Handler</code>:</p>\n\n<pre><code>otherHandler := ... // Other handler you want to clear\nn.UseHandler(context.ClearHandler(otherHandler))\n</code></pre>\n\n<h3>Notes:</h3>\n\n<p>The <a href=\"http://godoc.org/github.com/gorilla/mux#Router\" rel=\"nofollow\"><code>Router</code></a> from the <a href=\"http://godoc.org/github.com/gorilla/mux\" rel=\"nofollow\"><code>gorilla/mux</code></a> package automatically calls <a href=\"http://godoc.org/code.google.com/p/gorilla/context#Clear\" rel=\"nofollow\"><code>context.Clear()</code></a> at the end of a request lifetime, so if you are using it you don't need to clear the context using <code>context.ClearHandler()</code>. You only need to use it for other / custom handlers (unless you want to call <code>context.Clear()</code> manually).</p>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 751, "favorite_count": 1, "accepted_answer_id": 30507004, "answer_count": 1, "score": 2, "last_activity_date": 1432824045, "creation_date": 1432816677, "last_edit_date": 1432824045, "question_id": 30506831, "link": "https://stackoverflow.com/questions/30506831/negroni-and-gorilla-context-clearhandler", "title": "Negroni and Gorilla Context ClearHandler", "body": "<p>Is is possible to use <a href=\"http://www.gorillatoolkit.org/pkg/context\" rel=\"nofollow\">Gorilla's</a> <code>context.ClearHandler()</code> as middleware for Negroni like I've seen it used as middleware for Alice? Something like:</p>\n\n<pre><code>n.Use(context.ClearHandler())\n</code></pre>\n\n<p>At the moment I'm calling <code>context.Clear(r)</code> after every response but I would prefer the tidying up to be taken care of automatically. I'm currently getting the following error:</p>\n\n<pre><code>cannot use context.ClearHandler() (type http.Handler) as type negroni.Handler in argument to n.Use:                                                                   \nhttp.Handler does not implement negroni.Handler (wrong type for ServeHTTP method)                                                                                                  \n  have ServeHTTP(http.ResponseWriter, *http.Request)                                                                                                                         \n  want ServeHTTP(http.ResponseWriter, *http.Request, http.HandlerFunc)\n</code></pre>\n\n<p>But I'm not sure what the error message is telling me.</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 12822, "user_id": 87750, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9eb0c80f3b41463ed45f45584b065a9?s=128&d=identicon&r=PG", "display_name": "fredrik", "link": "https://stackoverflow.com/users/87750/fredrik"}, "edited": false, "score": 0, "creation_date": 1432846007, "post_id": 30505459, "comment_id": 49108585, "body": "Thanks! Then I understand why. Problem is, in my case I can&#39;t really do an ancestor query. Do you have any suggestions to how to get around this? The only thing I can think of is to iterate over all items in the database, and do the <code>Value &lt; 2</code> check in code which doesn&#39;t seem optimal."}, {"owner": {"reputation": 12822, "user_id": 87750, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9eb0c80f3b41463ed45f45584b065a9?s=128&d=identicon&r=PG", "display_name": "fredrik", "link": "https://stackoverflow.com/users/87750/fredrik"}, "edited": false, "score": 0, "creation_date": 1432846048, "post_id": 30505459, "comment_id": 49108611, "body": "Nice catch with the app engine version, I had two versions installed"}, {"owner": {"reputation": 12822, "user_id": 87750, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9eb0c80f3b41463ed45f45584b065a9?s=128&d=identicon&r=PG", "display_name": "fredrik", "link": "https://stackoverflow.com/users/87750/fredrik"}, "edited": false, "score": 0, "creation_date": 1432848818, "post_id": 30505459, "comment_id": 49109980, "body": "btw, I removed the sleep from the code as it didn&#39;t make a difference in this particular case"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 12822, "user_id": 87750, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9eb0c80f3b41463ed45f45584b065a9?s=128&d=identicon&r=PG", "display_name": "fredrik", "link": "https://stackoverflow.com/users/87750/fredrik"}, "edited": false, "score": 0, "creation_date": 1432878240, "post_id": 30505459, "comment_id": 49117874, "body": "@fredrik See the updated answer. Added a couple of suggestions how to come around this."}, {"owner": {"reputation": 12822, "user_id": 87750, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9eb0c80f3b41463ed45f45584b065a9?s=128&d=identicon&r=PG", "display_name": "fredrik", "link": "https://stackoverflow.com/users/87750/fredrik"}, "edited": false, "score": 0, "creation_date": 1432887721, "post_id": 30505459, "comment_id": 49122799, "body": "thanks @icza! too bad map reduce isn&#39;t available for go"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1432883438, "last_edit_date": 1592644375, "creation_date": 1432812953, "answer_id": 30505459, "question_id": 30503343, "link": "https://stackoverflow.com/questions/30503343/google-app-engine-datastore-query-with-cursor-wont-iterate-all-items/30505459#30505459", "title": "Google app engine datastore query with cursor won&#39;t iterate all items", "body": "<p>The problem is the nature and implementation of the cursors. The cursor contains the key of the last processed entity (encoded), and so if you set a cursor to your query before executing it, the Datastore will jump to the entity specified by the key encoded in the cursor, and will start listing entities from that point.</p>\n<h3>Let's examine your case</h3>\n<p>Your query filter is <code>Value&lt;2</code>. You iterate over the entities of the query result, and you change (and save) the <code>Value</code> property to <code>2</code>. <strong>Note that <code>Value=2</code> does not satisfy the filter <code>Value&lt;2</code></strong>.</p>\n<p>In the next iteration (next batch) a cursor is present which you apply properly. Therefore when the Datastore executes the query, it jumps to the last entity processed in the previous iteration, and wants to list entities that come after this. But the entity pointed by the cursor may already <strong>not satisfy</strong> the filter; because the index entry for its new Value <code>2</code> will most likely be already updated (non-deterministic behavior - see <a href=\"http://en.wikipedia.org/wiki/Eventual_consistency\" rel=\"nofollow noreferrer\">eventual consistency</a> for more details which applies here because you did not use an <a href=\"https://cloud.google.com/appengine/docs/go/datastore/queries#Go_Ancestor_queries\" rel=\"nofollow noreferrer\">Ancestor query</a> which would guarantee <a href=\"https://en.wikipedia.org/wiki/Strong_consistency\" rel=\"nofollow noreferrer\">strongly consistent</a> results; the <code>time.Sleep()</code> delay just increases the probability of this).</p>\n<p>So the Datastore sees that the last processed entity does not satisfy the filter and will not search all the entities again but report that no more entities are matching the filter, hence no more entities will be updated (and no errors wil be reported).</p>\n<p>Suggestion: don't use cursors and filter or sort by the same property you're updating at the same time.</p>\n<h3>By the way:</h3>\n<p>The part from the Appengine docs you quoted:</p>\n<blockquote>\n<p>Cursors don't always work as expected with a query that uses an inequality filter or a sort order on a property with multiple values.</p>\n</blockquote>\n<p>This is not what you think. This means: cursors may not work properly on a property <strong>which has multiple values</strong> AND the same property is either included in an inequality filter <em>or</em> is used to sort the results by.</p>\n<h3>By the way #2</h3>\n<p>In the screenshot you are using SDK 1.9.17. The latest SDK version is 1.9.21. You should update it and always use the latest available version.</p>\n<h2>Alternatives to achieve your goal</h2>\n<h3>1) Don't use cursors</h3>\n<p>If you have many records, you won't be able to update all your entities in one step (in one loop), but let's say you update 300 entities. If you repeat the query, the already updated entities will not be in the results of executing the same query again because the updated <code>Value=2</code> does not satisfy the filter <code>Value&lt;2</code>. Just redo the query+update until the query has no results. Since your change is <a href=\"http://en.wikipedia.org/wiki/Idempotence\" rel=\"nofollow noreferrer\">idempotent</a>, it would not cause any harm if the update of the index entry of an entity is delayed and would get returned by the query multiple times. It would be best to delay the execution of the next query to minimize the chance of this (e.g. wait a few seconds between redoing the query).</p>\n<p><strong>Pros:</strong> Simple. You already have the solution, just exclude the cursor handling part.</p>\n<p><strong>Cons:</strong> Some entities might get updated multiple times (therefore the change must be <a href=\"http://en.wikipedia.org/wiki/Idempotence\" rel=\"nofollow noreferrer\">idempotent</a>). Also the change performed on entities must be something which will exclude the entity from the next query.</p>\n<h3>2) Using Task Queue</h3>\n<p>You could first execute a keys-only query and defer the update to using tasks. You could create tasks with let's say passing 100 keys to each, and the tasks could load the entities by key and do the update. This would ensure each entity would only get updated once. This solution would have a little bigger delay due to involving the task queue, but that is not a problem in most cases.</p>\n<p><strong>Pros:</strong> No duplicated updates (therefore change may be non-<a href=\"http://en.wikipedia.org/wiki/Idempotence\" rel=\"nofollow noreferrer\">idempotent</a>). Works even if the change to be performed would not exclude the entity from the next query (more general).</p>\n<p><strong>Cons:</strong> Higher complexity. Bigger lag/delay.</p>\n<h3>3) Using Map-Reduce</h3>\n<p>You could use the map-reduce framework/utility to do massively parallel processing of many entities. Not sure if it has been implemented in Go.</p>\n<p><strong>Pros:</strong> Parallel execution, can handle even millions or billions of entities. Much faster in case of large entity number. Plus pros listed at 2) Using Task Queue.</p>\n<p><strong>Cons:</strong> Higher complexity. Might not be available in Go yet.</p>\n"}], "owner": {"reputation": 12822, "user_id": 87750, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9eb0c80f3b41463ed45f45584b065a9?s=128&d=identicon&r=PG", "display_name": "fredrik", "link": "https://stackoverflow.com/users/87750/fredrik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1069, "favorite_count": 0, "accepted_answer_id": 30505459, "answer_count": 1, "score": 1, "last_activity_date": 1475273346, "creation_date": 1432807438, "last_edit_date": 1475273346, "question_id": 30503343, "link": "https://stackoverflow.com/questions/30503343/google-app-engine-datastore-query-with-cursor-wont-iterate-all-items", "title": "Google app engine datastore query with cursor won&#39;t iterate all items", "body": "<p>In my application I have a datastore query with a filter, such as:</p>\n\n<pre><code>datastore.NewQuery(\"sometype\").Filter(\"SomeField&lt;\", 10)\n</code></pre>\n\n<p>I'm using a cursor to iterate batches of the result (e.g in different tasks). If the value of <code>SomeField</code> is changed while iterating over it, the cursor will no longer work on google app engine (works fine on devappserver).</p>\n\n<p>I have a test project here: <a href=\"https://github.com/fredr/appenginetest\" rel=\"nofollow noreferrer\">https://github.com/fredr/appenginetest</a>\nIn my test I ran <code>/db</code> that will setup the db with 10 items with their values set to 0, then ran <code>/run/2</code> that will iterate over all items where the value is less than 2, in batches of 5, and update the value of each item to 2.</p>\n\n<p>The result on my local devappserver (all items are updated):\n<img src=\"https://i.stack.imgur.com/NlgJo.png\" alt=\"devappserver result\"></p>\n\n<p>The result on appengine (only five items are updated):\n<img src=\"https://i.stack.imgur.com/pg2xi.png\" alt=\"appengine result\"></p>\n\n<p>Am I doing something wrong? Is this a bug? Or is this the expected result?\nIn the documentation it states: </p>\n\n<blockquote>\n  <p>Cursors don't always work as expected with a query that uses an inequality filter or a sort order on a property with multiple values.</p>\n</blockquote>\n"}, {"tags": ["function", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1432828167, "post_id": 30502933, "comment_id": 49098155, "body": "You aren&#39;t overriding anything. <code>MyFunc1</code> is a <i>variable</i> and you&#39;re simply changing it. That&#39;s what variables do, they vary. Otherwise they&#39;d be constants. (The fact that a variable can hold a function and you can use that variable to call the function without any special syntax is irrelevant; it&#39;s just syntactical difference from C function pointers for example.)"}, {"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432832788, "post_id": 30502933, "comment_id": 49100952, "body": "I&#39;m actually using it as the abstract method in Java. I&#39;m providing the basic behavior, and am expecting the client to override the default behavior with their more specific behaviors if they like. Because I want the library to be abstract and to know nothing about the implementation details. Forgive my words, I came from Java, and my brain is deeply affected that way. Is it wrong to use it this way?"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 1, "creation_date": 1432861724, "post_id": 30502933, "comment_id": 49113865, "body": "This can be more easily achieved using interfaces (very similar to Java)"}], "answers": [{"comments": [{"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1432806780, "post_id": 30503061, "comment_id": 49081836, "body": "So effectively, is there any significant difference between these two ways of writing a function, other than the possibility of being overridden?"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 2, "creation_date": 1432806989, "post_id": 30503061, "comment_id": 49081999, "body": "Unless there is a good reason not to you should always use function declaration (like <code>MyFunc0</code>). It is easier to read and it cannot change in a surprising way. To be honest I am not sure if there are any differences. I guess linker won&#39;t be able to remove function in a var from the resulting exe file even if it is not used."}, {"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1432807113, "post_id": 30503061, "comment_id": 49082091, "body": "Why? Is function override evil?"}, {"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1432822649, "post_id": 30503061, "comment_id": 49093815, "body": "Thanks @kostya. Still want to know if one is more effective, or consumes less memory than the other?"}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 3, "creation_date": 1432836722, "post_id": 30503061, "comment_id": 49103280, "body": "A static function can be optimized in ways that a mutable function literal (i.e. a variable that holds a function) cannot. For example, it is possible to inline static functions. While Go absolutely supports function literals, it is preferred to only use them when there is a particular goal in mind. It isn&#39;t &quot;overriding&quot; any more than <code>x = 1</code> is &quot;overriding&quot; <code>x</code>. It&#39;s assignment in Go. (In other languages, like ML, it <i>is</i> overriding, but <code>x = 1</code> is <i>also</i> overriding in ML.)"}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 5, "last_activity_date": 1432808165, "last_edit_date": 1432808165, "creation_date": 1432806645, "answer_id": 30503061, "question_id": 30502933, "link": "https://stackoverflow.com/questions/30502933/function-override/30503061#30503061", "title": "Function override", "body": "<p><code>MyFunc0</code> is a function declaration (<a href=\"https://golang.org/ref/spec#Function_declarations\" rel=\"nofollow\">https://golang.org/ref/spec#Function_declarations</a>)</p>\n\n<p><code>MyFunc1</code> is not a function declaration. It is a variable (<a href=\"https://golang.org/ref/spec#Variable_declarations\" rel=\"nofollow\">https://golang.org/ref/spec#Variable_declarations</a>) of type func (see <a href=\"https://golang.org/ref/spec#Function_types\" rel=\"nofollow\">https://golang.org/ref/spec#Function_types</a>, <a href=\"https://golang.org/ref/spec#Function_literals\" rel=\"nofollow\">https://golang.org/ref/spec#Function_literals</a>). It has an initial value, but can be changed to hold a different value/function (as long as function signatures match).</p>\n"}, {"comments": [{"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1435522062, "post_id": 31103130, "comment_id": 50223616, "body": "I think <code>doFibonacci </code> is a type alias."}], "tags": [], "owner": {"reputation": 9, "user_id": 1470802, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0e4c4b7f7d84992cee7b206d1b4baa0?s=128&d=identicon&r=PG", "display_name": "Anibal Anto", "link": "https://stackoverflow.com/users/1470802/anibal-anto"}, "is_accepted": false, "score": 0, "last_activity_date": 1435515183, "creation_date": 1435515183, "answer_id": 31103130, "question_id": 30502933, "link": "https://stackoverflow.com/questions/30502933/function-override/31103130#31103130", "title": "Function override", "body": "<p>I learning go language (and English :P), and in the tour of go is a exersie: Fibonacci closure</p>\n\n<p>(<a href=\"https://tour.golang.org/moretypes/22\" rel=\"nofollow\">https://tour.golang.org/moretypes/22</a>)</p>\n\n<p>The result is:\n0\n1\n1\n2\n3\n5\n8\n13\n21\n34</p>\n\n<p>The main function is:</p>\n\n<pre><code>func main() {\n    f := fibonacci()\n    for i := 0; i &lt; 10; i++ {\n        fmt.Println(f())\n    }\n}\n</code></pre>\n\n<p>And my first solution was:</p>\n\n<pre><code>func fibonacci() func() int {\n    antant := 0\n    ant := 1\n    i := 0\n    return func() int {\n        var result int\n        if i == 0 || i == 1 {\n            result = i\n            i++\n            return result\n        }\n        result = antant + ant\n        antant = ant\n        ant = result\n        return result\n    }\n}\n</code></pre>\n\n<p>But I didn't want ask in heach call to f() if was the firsth or second call (<code>if i == 0 || i == 1</code>). The result was a function auto-override:</p>\n\n<pre><code>type doFibonacci func(*doFibonacci) int\n\nfunc fibonacci() func() int {\n    antant := 0\n    ant := 1\n    i := 0\n    doFibo := doFibonacci(func(ptrDo *doFibonacci) int {\n        var result int\n        if i == 0 || i == 1 {\n            result = i\n            i++\n            return result\n        }\n        *ptrDo = func(ptrDo *doFibonacci) int {\n            var result int\n            result = antant + ant\n            antant = ant\n            ant = result\n            return result\n        }\n        return (*ptrDo)(ptrDo)\n    })\n    return func() int {\n        return doFibo(&amp;doFibo)\n    }\n}\n</code></pre>\n\n<p>I apologize for my English.</p>\n"}], "owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 594, "favorite_count": 0, "accepted_answer_id": 30503061, "answer_count": 2, "score": 3, "last_activity_date": 1435515183, "creation_date": 1432806319, "last_edit_date": 1432828101, "question_id": 30502933, "link": "https://stackoverflow.com/questions/30502933/function-override", "title": "Function override", "body": "<p>I found something interesting in Go. Let's say I have my package name is <code>mypkg</code>, inside <code>mypkg</code>, I have two functions:</p>\n\n<pre><code>package mypkg\nfunc MyFunc0(){\n    //...\n}\nvar MyFunc1 = func(){\n    //...\n}\n</code></pre>\n\n<p>Now in my <code>main</code> package, it is possible to override <code>MyFunc1</code>, like this:</p>\n\n<pre><code>mypkg.MyFunc1 = func(){\n   // new logic\n}\n</code></pre>\n\n<p>However, it is not possible to override <code>MyFunc0</code> the same way. So now a question is raised. What are the differences between the two ways of declaring a function? Is this behavior difference intended?</p>\n"}, {"tags": ["ssl", "heroku", "go", "martini"], "answers": [{"comments": [{"owner": {"reputation": 1162, "user_id": 1316907, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/vl9Qn.jpg?s=128&g=1", "display_name": "Evan Lin", "link": "https://stackoverflow.com/users/1316907/evan-lin"}, "edited": false, "score": 0, "creation_date": 1432803515, "post_id": 30501671, "comment_id": 49079505, "body": "Hi inf, Thanks for reply. But I found it works well in Rails on Heroku.  <a href=\"http://readysteadycode.com/howto-setup-ssl-with-rails-and-heroku\" rel=\"nofollow noreferrer\">readysteadycode.com/howto-setup-ssl-with-rails-and-heroku</a>"}, {"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "reply_to_user": {"reputation": 1162, "user_id": 1316907, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/vl9Qn.jpg?s=128&g=1", "display_name": "Evan Lin", "link": "https://stackoverflow.com/users/1316907/evan-lin"}, "edited": false, "score": 0, "creation_date": 1432804874, "post_id": 30501671, "comment_id": 49080532, "body": "@EvanLin I have no experience with Rails but I guess that all that setting does is to redirect http requests to https and sets HSTS plus maybe some other stuff."}, {"owner": {"reputation": 1162, "user_id": 1316907, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/vl9Qn.jpg?s=128&g=1", "display_name": "Evan Lin", "link": "https://stackoverflow.com/users/1316907/evan-lin"}, "edited": false, "score": 0, "creation_date": 1432861783, "post_id": 30501671, "comment_id": 49113882, "body": "Thank you, I will check with Heroku, if it is true."}, {"owner": {"reputation": 1162, "user_id": 1316907, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/vl9Qn.jpg?s=128&g=1", "display_name": "Evan Lin", "link": "https://stackoverflow.com/users/1316907/evan-lin"}, "edited": false, "score": 0, "creation_date": 1432908867, "post_id": 30501671, "comment_id": 49137247, "body": "Hi inf, Confirm with Heroku, it is expect.   &quot;Yep the SSL termination is done well before the dyno at the SSL endpoint add-on. Inside the dyno you only have to bind to one port and speak HTTP. No SSL required in-app.&quot;"}], "tags": [], "owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "is_accepted": true, "score": 3, "last_activity_date": 1432803242, "creation_date": 1432803242, "answer_id": 30501671, "question_id": 30501388, "link": "https://stackoverflow.com/questions/30501388/deploy-golang-martini-https-on-heroku-server/30501671#30501671", "title": "Deploy golang martini HTTPS on Heroku server", "body": "<p>Your app won't serve HTTPS if you are deploying to Heroku. The SSL connection will be terminated at the load balancers of Heroku and plain HTTP traffic will be forwarded to your application.</p>\n\n<p>So all you have to do is to listen on HTTP on the Port from the environment.</p>\n"}], "owner": {"reputation": 1162, "user_id": 1316907, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/vl9Qn.jpg?s=128&g=1", "display_name": "Evan Lin", "link": "https://stackoverflow.com/users/1316907/evan-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1210, "favorite_count": 0, "accepted_answer_id": 30501671, "answer_count": 1, "score": 0, "last_activity_date": 1432803469, "creation_date": 1432802456, "last_edit_date": 1432803469, "question_id": 30501388, "link": "https://stackoverflow.com/questions/30501388/deploy-golang-martini-https-on-heroku-server", "title": "Deploy golang martini HTTPS on Heroku server", "body": "<p>I am trying to deploy an HTTPS web side on Heroku using <a href=\"https://github.com/go-martini/martini\" rel=\"nofollow\">Golang-martini</a>.</p>\n\n<p>Here is the list I already done:</p>\n\n<ul>\n<li>I already enable SSL endpoint in Heroku. (it is paid plugin services)</li>\n<li><p>I already purchase my CA certificate key and it could be deploy Heroku. So, <code>heroku certs</code> shows: (note: the company name/endpoint address change)</p>\n\n<hr>\n\n<p>Endpoint  ||                 Common Name(s)  ||    Expires        ||       Trusted</p>\n\n<hr>\n\n<p>xxx.herokussl.com || server.sample.com ||  2016-05-25 23:59 UTC  || True</p></li>\n</ul>\n\n<p>And here is my code sample in Golang.</p>\n\n<pre><code>m := martini.Classic()\nmartini.Env = martini.Prod\nm.Use(secure.Secure(secure.Options{\n    SSLRedirect: false,\n}))\n\n\n//Because I want to keep HTTP and HTTPs enable.\ngo func() {\n    if err := http.ListenAndServe(\":\"+os.Getenv(\"PORT\"), m); err != nil {\n        log.Println(err)\n    }\n}()\n\n// HTTPS: \nif err := http.ListenAndServeTLS(\":443\", \"server.crt\", \"server.key\", m); err != nil {\n    log.Println(err)\n}\n</code></pre>\n\n<p>Here are the my Questions:</p>\n\n<ul>\n<li><p>If I set the <code>ListenAndServeTLS</code> port in 8443 (or something else) it will show error when I trying to test with <code>curl -vI https://server.sample.com</code>. It will show error as: </p>\n\n<p>\"curl: (60) SSL certificate problem: Invalid certificate chain\"</p></li>\n<li><p>If I set the <code>ListenAndServeTLS</code> port to 443, it will show:</p>\n\n<p>\"listen tcp :443: bind: permission denied\"</p></li>\n</ul>\n\n<p>Please advise how I deploy HTTPs with Go-martini on Heroku, thanks..</p>\n"}, {"tags": ["http", "go", "url-routing"], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 525, "user_id": 1248084, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/3DzER.jpg?s=128&g=1", "display_name": "miestasmia", "link": "https://stackoverflow.com/users/1248084/miestasmia"}, "edited": false, "score": 0, "creation_date": 1541778186, "post_id": 30500491, "comment_id": 93344468, "body": "@miestasmia Thanks for the note, I updated the answer accordingly."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1541778165, "last_edit_date": 1541778165, "creation_date": 1432799831, "answer_id": 30500491, "question_id": 30500322, "link": "https://stackoverflow.com/questions/30500322/httprouter-configuring-notfound/30500491#30500491", "title": "httprouter configuring NotFound", "body": "<p>The type <a href=\"http://godoc.org/github.com/julienschmidt/httprouter#Router\" rel=\"nofollow noreferrer\"><code>httprouter.Router</code></a> is a <code>struct</code> which has a field:</p>\n\n<pre><code>NotFound http.Handler\n</code></pre>\n\n<p>So type of <code>NotFound</code> is <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow noreferrer\"><code>http.Handler</code></a>, an interface type which has a single method:</p>\n\n<pre><code>ServeHTTP(ResponseWriter, *Request)\n</code></pre>\n\n<p>If you want your own custom \"Not Found\" handler, you have to set a value that implements this interface.</p>\n\n<p>The easiest way is to define a function with signature:</p>\n\n<pre><code>func(http.ResponseWriter, *http.Request)\n</code></pre>\n\n<p>And use the <a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"nofollow noreferrer\"><code>http.HandlerFunc()</code></a> helper function to \"convert\" it to a value that implements the <code>http.Handler</code> interface, whose <code>ServeHTTP()</code> method simply calls the function with the above signature.</p>\n\n<p>For example:</p>\n\n<pre><code>func MyNotFound(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"text/plain; charset=utf-8\")\n    w.WriteHeader(http.StatusNotFound) // StatusNotFound = 404\n    w.Write([]byte(\"My own Not Found handler.\"))\n    w.Write([]byte(\" The page you requested could not be found.\"))\n}\n\nvar router *httprouter.Router = ... // Your router value\nrouter.NotFound = http.HandlerFunc(MyNotFound)\n</code></pre>\n\n<p>This <code>NotFound</code> handler will be invoked by the <code>httprouter</code> package. If you would want to call it manually from one of your other handlers, you would have to pass a <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow noreferrer\"><code>ResponseWriter</code></a> and a <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow noreferrer\"><code>*Request</code></a> to it, something like this:</p>\n\n<pre><code>func ResourceHandler(w http.ResponseWriter, r *http.Request) {\n    exists := ... // Find out if requested resource is valid and available\n    if !exists {\n        MyNotFound(w, r) // Pass ResponseWriter and Request\n        // Or via the Router:\n        // router.NotFound(w, r)\n        return\n    }\n\n    // Resource exists, serve it\n    // ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "is_accepted": false, "score": 1, "last_activity_date": 1432799852, "creation_date": 1432799852, "answer_id": 30500494, "question_id": 30500322, "link": "https://stackoverflow.com/questions/30500322/httprouter-configuring-notfound/30500494#30500494", "title": "httprouter configuring NotFound", "body": "<p>NotFound is a function pointer of type http.HandlerFunc. You will have to put a function with the signature <code>Func(w ResponseWriter, r *Request)</code> somewhere and assign it to NotFound (<code>router.NotFound = Func</code>).</p>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1673, "favorite_count": 2, "accepted_answer_id": 30500491, "answer_count": 2, "score": 4, "last_activity_date": 1541778165, "creation_date": 1432799254, "last_edit_date": 1432802305, "question_id": 30500322, "link": "https://stackoverflow.com/questions/30500322/httprouter-configuring-notfound", "title": "httprouter configuring NotFound", "body": "<p>I'm using <a href=\"https://github.com/julienschmidt/httprouter\" rel=\"nofollow\"><code>httprouter</code></a> for an API and I'm trying to work out how to handle 404s. It does say in the <a href=\"http://godoc.org/github.com/julienschmidt/httprouter#Router.NotFound\" rel=\"nofollow\">docs</a> that 404's can be handled manually but I don't really have an idea how to write my own <strong>custom handler</strong>.</p>\n\n<p>I've tried the following after my other routes...</p>\n\n<pre><code>router.NotFound(pageNotFound)\n</code></pre>\n\n<p>But I get the error <code>not enough arguments in call to router.NotFound</code>.</p>\n\n<p>If anyone could point me in the right direction it would be great.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1432785403, "post_id": 30496639, "comment_id": 49070893, "body": "Nah, <code>heap.Interface</code> doesn&#39;t require no pointer. Pointer types can implement an interface (<code>*os.File</code> is an <code>io.Reader</code>). Try it, and if it doesn&#39;t work in a way that you can&#39;t figure out, post another question; someone&#39;ll try to help sort it out."}], "answers": [{"tags": [], "owner": {"reputation": 3753, "user_id": 451641, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/811b28e7b085e2e493fd32c5913a1ae8?s=128&d=identicon&r=PG", "display_name": "Frederik Deweerdt", "link": "https://stackoverflow.com/users/451641/frederik-deweerdt"}, "is_accepted": false, "score": 0, "last_activity_date": 1432827269, "last_edit_date": 1432827269, "creation_date": 1432784415, "answer_id": 30496814, "question_id": 30496639, "link": "https://stackoverflow.com/questions/30496639/go-heap-interface-as-a-struct/30496814#30496814", "title": "Go heap.Interface as a struct", "body": "<blockquote>\n  <p>I think it might be happening because of func (p PQueue) not being a pointer</p>\n</blockquote>\n\n<p>That's right. Quoting <a href=\"http://golang.org/doc/effective_go.html#pointers_vs_values\" rel=\"nofollow\">Effective Go</a>:</p>\n\n<blockquote>\n  <p>invoking [the method] on a value would cause the method to receive a\n  copy of the value, so any modifications would be discarded.</p>\n</blockquote>\n\n<p>You say:</p>\n\n<blockquote>\n  <p>heap.Interface specifically requires no pointer</p>\n</blockquote>\n\n<p>I'm confused, the example you point to is, in fact, using a pointer:</p>\n\n<pre><code>func (pq *PriorityQueue) Push(x interface{}) {\n    n := len(*pq)\n    item := x.(*Item)\n    item.index = n\n    *pq = append(*pq, item)\n}\n</code></pre>\n\n<p>Maybe something else is going on?</p>\n"}, {"tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": true, "score": 2, "last_activity_date": 1432795385, "creation_date": 1432795385, "answer_id": 30499030, "question_id": 30496639, "link": "https://stackoverflow.com/questions/30496639/go-heap-interface-as-a-struct/30499030#30499030", "title": "Go heap.Interface as a struct", "body": "<p>You are right about the problem being related to the receiver of your <code>Push</code> method: the method will receive a copy of the <code>PQueue</code>, so any changes made to the struct will not persist.</p>\n\n<p>Changing the method to use a pointer as a receiver is the correct change, but this also means that <code>PQueue</code> no longer implements <code>heap.Interface</code>.  This is due to the fact that Go does not let you take a pointer to the value stored inside an interface variable, so the automatic translation of <code>q.Push()</code> to <code>(&amp;q).Push()</code> does not occur.</p>\n\n<p>This isn't a dead end though, since <code>*PQueue</code> should still implement the <code>heap.Interface</code>.  So if you were previously calling <code>heap.Init(q)</code>, just change it to <code>heap.Init(&amp;q)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 2, "last_activity_date": 1432799812, "last_edit_date": 1432799812, "creation_date": 1432795578, "answer_id": 30499087, "question_id": 30496639, "link": "https://stackoverflow.com/questions/30496639/go-heap-interface-as-a-struct/30499087#30499087", "title": "Go heap.Interface as a struct", "body": "<p>The problem is that you are appending to a <strong>copy</strong> of your slice. Thus the change shows within the function, but is lost once you return from the function. </p>\n\n<p>In <a href=\"http://blog.golang.org/slices\" rel=\"nofollow\">this blog article</a> from the section <strong>Passing slices to functions</strong>:</p>\n\n<blockquote>\n  <p>It's important to understand that even though a slice contains a\n  pointer, it is itself a value. Under the covers, it is a struct value\n  holding a pointer and a length. It is not a pointer to a struct.</p>\n</blockquote>\n\n<p>With append you are modifying the slice header. And</p>\n\n<blockquote>\n  <p>Thus if we want to write a function that modifies the header, we must\n  return it as a result parameter</p>\n</blockquote>\n\n<p>Or:</p>\n\n<blockquote>\n  <p>Another way to have a function modify the slice header is to pass a\n  pointer to it.</p>\n</blockquote>\n\n<p>As a result you need to pass a pointer if you want to modify it with append. Simply change the method to use a pointer receiver. And for that to work you need to call init with a pointer like <code>heap.Init(&amp;pq)</code> as shown in the example that you linked to which does just that and also uses pointer receivers.</p>\n\n<p>From the <a href=\"http://golang.org/ref/spec#Method_sets\" rel=\"nofollow\">spec</a> on <strong>Method Sets</strong>:</p>\n\n<blockquote>\n  <p>The method set of the corresponding pointer type *T is the set of all methods \n  declared with receiver *T or T (that is, it also contains the method\n  set of T).</p>\n</blockquote>\n\n<p>So using a pointer type will work with value and pointer receivers and still implement the interface.</p>\n"}], "owner": {"reputation": 149, "user_id": 4086912, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-76B_qLObJ6Q/AAAAAAAAAAI/AAAAAAAAAF4/QDUbcz3Ue5c/photo.jpg?sz=128", "display_name": "jpittis", "link": "https://stackoverflow.com/users/4086912/jpittis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 0, "accepted_answer_id": 30499030, "answer_count": 3, "score": 0, "last_activity_date": 1432827269, "creation_date": 1432783173, "question_id": 30496639, "link": "https://stackoverflow.com/questions/30496639/go-heap-interface-as-a-struct", "title": "Go heap.Interface as a struct", "body": "<p>I'm creating a priority queue using Go's <a href=\"http://golang.org/pkg/container/heap/\" rel=\"nofollow\">heap</a> package. There is <a href=\"http://golang.org/pkg/container/heap/#example__priorityQueue\" rel=\"nofollow\">an example</a> of one in the documentation.</p>\n\n<p>The queue I'm creating needs to be based around a struct rather than a slice because it requires other properties like a mutex.</p>\n\n<pre><code>type PQueue struct {\n    queue []*Item\n    sync.Mutex\n}\n</code></pre>\n\n<p>I implement all the methods that <a href=\"http://golang.org/pkg/container/heap/#Interface\" rel=\"nofollow\">heap.Interface</a> requires.</p>\n\n<p>The issue is that my <code>PQueue.Push</code> method seems not to be permanently adding a value to <code>PQueue.queue</code>.</p>\n\n<pre><code>func (p PQueue) Push(x interface{}) {\n    p.Lock()\n    defer p.Unlock()\n    item := x.(*Item)\n    item.place = len(p.queue) // the index of an item in the queue\n    p.queue = append(p.queue, item)\n    // len(p.queue) does increase\n    // after the functions exits, the queues length has not increased\n}\n</code></pre>\n\n<p>If I print the length of <code>p.queue</code> at the end of this function, the length has increased. After the functions exits however, it seems the original struct does not get updated.</p>\n\n<p>I think it might be happening because of <code>func (p PQueue)</code> not being a pointer. Why might that be? Is there a way to fix it? If I were to use <code>func (p *PQeueue) Push(x interface{})</code> instead, I would need to implement my own heap because <code>heap.Interface</code> specifically requires no pointer. Is that my only option?</p>\n"}, {"tags": ["go", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "is_accepted": true, "score": 0, "last_activity_date": 1432786729, "creation_date": 1432786729, "answer_id": 30497189, "question_id": 30496470, "link": "https://stackoverflow.com/questions/30496470/how-do-i-add-my-apphandler-to-my-routes/30497189#30497189", "title": "How do I add my AppHandler to my routes?", "body": "<p>Your <code>AppHandler</code> isn't a <code>http.HandlerFunc</code>, it's a <code>http.Handler</code>.</p>\n\n<p>A <code>http.HandlerFunc</code> is just a function that takes both a <code>http.ResponseWriter</code> and a <code>*http.Request</code>.</p>\n\n<p><code>http.Handler</code> is an interface that is satisfied by any type that has a method <code>ServeHTTP(w http.ResponseWriter, r *http.Request)</code></p>\n\n<p>Change your struct to something like</p>\n\n<pre><code>type Route struct {\n    Method  string\n    Pattern string\n    Handler http.Handler\n}\n</code></pre>\n\n<p>And then at the bottom you can probably do</p>\n\n<pre><code>for _, route := range routes {\n    router.Methods(route.Method).Path(route.Pattern).Handler(route.Handler)\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 30497189, "answer_count": 1, "score": 1, "last_activity_date": 1432826457, "creation_date": 1432782033, "last_edit_date": 1432826457, "question_id": 30496470, "link": "https://stackoverflow.com/questions/30496470/how-do-i-add-my-apphandler-to-my-routes", "title": "How do I add my AppHandler to my routes?", "body": "<p>I am trying to implement an <code>appHandler</code> as described in <a href=\"http://blog.golang.org/error-handling-and-go#TOC_3.\" rel=\"nofollow\">The Go Blog: Error handling and Go</a>.\nI have the <code>appHandler</code>, now I'm just trying to hook it up to my routes. The following works:</p>\n\n<pre><code>router := new(mux.Router)\nrouter.Handle(\"/my/route/\", handlers.AppHandler(handlers.MyRoute))\n</code></pre>\n\n<p>But, I want to be able to allow GET requests as well as having \"StrictSlash(true)\". I have:</p>\n\n<pre><code>type Routes []Route\ntype Route struct {\n    Method      string\n    Pattern     string\n    HandlerFunc http.HandlerFunc\n}\n\n\nvar routes = Routes{\n    Route{\"GET\", \"/my/route/\", handlers.AppHandler(handlers.MyRoute)}\n} \nrouter := mux.NewRouter().StrictSlash(true)\nfor _, route := range routes {\n    var handler http.Handler\n    handler = route.HandlerFunc\n    router.Methods(route.Method).Path(route.Pattern).Handler(handler)\n}\n</code></pre>\n\n<p>AppHandler looks like:</p>\n\n<pre><code>type AppHandler func(http.ResponseWriter, *http.Request) *appError\n\nfunc (fn AppHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    // blah, blah, blah\n}\n</code></pre>\n\n<p>I get an error:</p>\n\n<pre><code>cannot use handlers.AppHandler(handlers.MyRoute) (type handlers.AppHandler) as type http.HandlerFunc in field value\n</code></pre>\n"}, {"tags": ["ssh", "concurrency", "go", "channel"], "answers": [{"comments": [{"owner": {"reputation": 2449, "user_id": 1167296, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/ddb9a14ebf77483b011d5fe415bf5168?s=128&d=identicon&r=PG", "display_name": "George K.", "link": "https://stackoverflow.com/users/1167296/george-k"}, "edited": false, "score": 0, "creation_date": 1432778813, "post_id": 30495888, "comment_id": 49069357, "body": "Perfect, thank you so much! Worked like a charm. I&#39;ll post the updated answer"}], "tags": [], "owner": {"reputation": 3753, "user_id": 451641, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/811b28e7b085e2e493fd32c5913a1ae8?s=128&d=identicon&r=PG", "display_name": "Frederik Deweerdt", "link": "https://stackoverflow.com/users/451641/frederik-deweerdt"}, "is_accepted": true, "score": 3, "last_activity_date": 1432777652, "creation_date": 1432777652, "answer_id": 30495888, "question_id": 30495497, "link": "https://stackoverflow.com/questions/30495497/golang-concurrent-ssh-connections-to-multiple-nodes/30495888#30495888", "title": "Golang - concurrent SSH connections to multiple nodes", "body": "<p>The code above is stuck in the <code>range cnres</code> <code>for</code> loop. As pointed out in the excellent <a href=\"https://gobyexample.com/range-over-channels\" rel=\"nofollow\">'Go by Example'</a>, <code>range</code> will only exit on a closed channel.</p>\n\n<p>One way to address that difficulty, is to run the <code>range cnres</code> iteration in another goroutine. You could then <code>wg.Wait()</code>, and then <code>close()</code> the channel, as such:</p>\n\n<pre><code>...\ngo func() {\n        for cr := range cnres {\n                fmt.Println(\"Connection to \" + cr.host + \" \" + cr.message)\n        }   \n}() \nwg.Wait()\nclose(cnres)\n</code></pre>\n\n<p>On a tangential note (independently of the code being stuck), I think the intention was to use <code>hostname</code> in the <code>Dial()</code> function, and subsequent channel writes, rather than <code>host</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 2449, "user_id": 1167296, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/ddb9a14ebf77483b011d5fe415bf5168?s=128&d=identicon&r=PG", "display_name": "George K.", "link": "https://stackoverflow.com/users/1167296/george-k"}, "is_accepted": false, "score": 1, "last_activity_date": 1432778888, "creation_date": 1432778888, "answer_id": 30496048, "question_id": 30495497, "link": "https://stackoverflow.com/questions/30495497/golang-concurrent-ssh-connections-to-multiple-nodes/30496048#30496048", "title": "Golang - concurrent SSH connections to multiple nodes", "body": "<p>Thanks to Frederik, I was able to get this running successfully:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"sync\"\n\n    \"github.com/awslabs/aws-sdk-go/aws\"\n    \"github.com/awslabs/aws-sdk-go/service/ec2\"\n)\n\n// ConnectionResult container\ntype ConnectionResult struct {\n    host    string\n    message string\n}\n\nfunc main() {\n    cnres := make(chan ConnectionResult)\n    ec2svc := ec2.New(&amp;aws.Config{Region: \"us-east-1\"})\n    wg := sync.WaitGroup{}\n\n    params := &amp;ec2.DescribeInstancesInput{\n        Filters: []*ec2.Filter{\n            &amp;ec2.Filter{\n                Name: aws.String(\"instance-state-name\"),\n                Values: []*string{\n                    aws.String(\"running\"),\n                },\n            },\n        },\n    }\n\n    resp, err := ec2svc.DescribeInstances(params)\n    if err != nil {\n        panic(err)\n    }\n\n    for _, res := range resp.Reservations {\n        for _, inst := range res.Instances {\n            for _, tag := range inst.Tags {\n                if *tag.Key == \"Name\" {\n                    host := *tag.Value\n                    publicdnsname := *inst.PublicDNSName\n                    wg.Add(1)\n                    go func(ec2name, cbname string, cr chan ConnectionResult) {\n                        defer wg.Done()\n                        _, err := net.Dial(\"tcp\", ec2name+\":22\")\n                        if err != nil {\n                            cr &lt;- ConnectionResult{cbname, \"failed\"}\n                        } else {\n                            cr &lt;- ConnectionResult{cbname, \"succeeded\"}\n                        }\n                    }(publicdnsname, host, cnres)\n                }\n            }\n        }\n    }\n\n    go func() {\n        for cr := range cnres {\n            fmt.Println(\"Connection to \" + cr.host + \" \" + cr.message)\n        }\n    }()\n\n    wg.Wait()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 9417989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ClGyA.png?s=128&g=1", "display_name": "ptsonkov", "link": "https://stackoverflow.com/users/9417989/ptsonkov"}, "is_accepted": false, "score": 0, "last_activity_date": 1601154700, "creation_date": 1601154700, "answer_id": 64082554, "question_id": 30495497, "link": "https://stackoverflow.com/questions/30495497/golang-concurrent-ssh-connections-to-multiple-nodes/64082554#64082554", "title": "Golang - concurrent SSH connections to multiple nodes", "body": "<p>Frederik's solution works fine but with some exceptions. If command group routines (from loop which write to to the channel) execute command with a bit longer response time, processing routine (Frederik's hint) will process and close the channel, before last command routine to finish, so some data loss may occur.</p>\n<p>In my case I'm using it to execute remote SSH command to multiple servers and to print response. Working solution for me is to use 2 separate WaitGroups, one for command group routines and second for processing routine. This way, processing routine will wait all command routines to be completed, then process response and close channel to exit for loop:</p>\n<pre><code>// Create waitgroup, channel and execute command with concurrency (goroutine)\noutchan := make(chan CommandResult)\nvar wg_command sync.WaitGroup\nvar wg_processing sync.WaitGroup\nfor _, t := range validNodes {\n    wg_command.Add(1)\n    target := t + &quot; (&quot; + user + &quot;@&quot; + nodes[t] + &quot;)&quot;\n    go func(dst, user, ip, command string, out chan CommandResult) {\n        defer wg_command.Done()\n        result := remoteExec(user, ip, cmdCommand)\n        out &lt;- CommandResult{dst, result}\n    }(target, user, nodes[t], cmdCommand, outchan)\n}\n\nwg_processing.Add(1)\ngo func() {\n    defer wg_processing.Done()\n    for o := range outchan {\n        bBlue.Println(o.target, &quot;=&gt;&quot;, cmdCommand)\n        fmt.Println(o.cmdout)\n    }\n}()\n\n// wait untill all goroutines to finish and close the channel\nwg_command.Wait()\nclose(outchan)\nwg_processing.Wait()\n</code></pre>\n"}], "owner": {"reputation": 2449, "user_id": 1167296, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/ddb9a14ebf77483b011d5fe415bf5168?s=128&d=identicon&r=PG", "display_name": "George K.", "link": "https://stackoverflow.com/users/1167296/george-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1037, "favorite_count": 2, "accepted_answer_id": 30495888, "answer_count": 3, "score": 4, "last_activity_date": 1601154700, "creation_date": 1432774479, "question_id": 30495497, "link": "https://stackoverflow.com/questions/30495497/golang-concurrent-ssh-connections-to-multiple-nodes", "title": "Golang - concurrent SSH connections to multiple nodes", "body": "<p>I have a fleet of servers that I'm trying to establish SSH connections to, and I'm spawning a new goroutine for every new SSH connection I have to establish. I then send the results of that connection (along with the error(s) (if any)) down a channel, and then read from the channel. This program sort of works, but it freezes in the end even though I close the channel.</p>\n\n<p>This is what I have so far:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"sync\"\n\n    \"github.com/awslabs/aws-sdk-go/aws\"\n    \"github.com/awslabs/aws-sdk-go/service/ec2\"\n)\n\n// ConnectionResult container\ntype ConnectionResult struct {\n    host    string\n    message string\n}\n\nfunc main() {\n    cnres := make(chan ConnectionResult)\n    ec2svc := ec2.New(&amp;aws.Config{Region: \"us-east-1\"})\n    wg := sync.WaitGroup{}\n\n    params := &amp;ec2.DescribeInstancesInput{\n        Filters: []*ec2.Filter{\n            &amp;ec2.Filter{\n                Name: aws.String(\"instance-state-name\"),\n                Values: []*string{\n                    aws.String(\"running\"),\n                },\n            },\n        },\n    }\n\n    resp, err := ec2svc.DescribeInstances(params)\n    if err != nil {\n        panic(err)\n    }\n\n    for _, res := range resp.Reservations {\n        for _, inst := range res.Instances {\n            for _, tag := range inst.Tags {\n                if *tag.Key == \"Name\" {\n                    host := *tag.Value\n                    wg.Add(1)\n                    go func(hostname string, cr chan ConnectionResult) {\n                        defer wg.Done()\n                        _, err := net.Dial(\"tcp\", host+\":22\")\n                        if err != nil {\n                            cr &lt;- ConnectionResult{host, \"failed\"}\n                        } else {\n                            cr &lt;- ConnectionResult{host, \"succeeded\"}\n                        }\n                    }(host, cnres)\n                }\n            }\n        }\n    }\n\n    for cr := range cnres {\n        fmt.Println(\"Connection to \" + cr.host + \" \" + cr.message)\n    }\n\n    close(cnres)\n\n    defer wg.Wait()\n}\n</code></pre>\n\n<p>What am I doing wrong? Is there a better way of doing concurrent SSH connections in Go?</p>\n"}, {"tags": ["python", "go", "rsa", "digital-signature", "pycrypto"], "comments": [{"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1432782903, "post_id": 30495284, "comment_id": 49070337, "body": "I don&#39;t have an answer to your question, but in the <code>Failed verification</code> case, you don&#39;t ever seem to inspect the error value from <code>VerifyPSS</code>.  Does it give you any additional information?"}, {"owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "reply_to_user": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1432787433, "post_id": 30495284, "comment_id": 49071404, "body": "@JamesHenstridge &quot;I&#39;ve had a look at the Go PSS verification code and if anything goes wrong, a generic verification error is returned so it&#39;s not that helpful.&quot; There is a single verification error that gets returned in all cases with no additional context."}, {"owner": {"reputation": 77029, "user_id": 1729265, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VMMeP.jpg?s=128&g=1", "display_name": "mkl", "link": "https://stackoverflow.com/users/1729265/mkl"}, "edited": false, "score": 0, "creation_date": 1432792805, "post_id": 30495284, "comment_id": 49073386, "body": "Perhaps the text message to sign is differently encoded in those context. I. that case the signed bytes would differ from those verified against. You might try signing known byte arrays first."}, {"owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "reply_to_user": {"reputation": 77029, "user_id": 1729265, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VMMeP.jpg?s=128&g=1", "display_name": "mkl", "link": "https://stackoverflow.com/users/1729265/mkl"}, "edited": false, "score": 0, "creation_date": 1432831521, "post_id": 30495284, "comment_id": 49100215, "body": "@mkl interesting idea. I&#39;ve just tried a number of different representations and continue to get consistent failing results. I specifically chose characters in the 7 bit ASCII range to keep things simple so I&#39;m not surprised."}], "answers": [{"tags": [], "owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "is_accepted": true, "score": 0, "last_activity_date": 1432921113, "creation_date": 1432921113, "answer_id": 30535821, "question_id": 30495284, "link": "https://stackoverflow.com/questions/30495284/fail-to-verify-rsassa-pss-signature-across-python-go/30535821#30535821", "title": "Fail to verify RSASSA-PSS signature across Python -&gt; Go", "body": "<p>So it appears I misinterpreted <code>_SALT_SIZE</code> in the Python code. With some help from the TUF developers (i.e. they told me) I discovered <strong>PyCrypto's RSA PSS code infers the salt size to be equal to the size of the hash digest of the hashing algorithm in use</strong>. In this case it was 32 bytes as the hashing algorithm was Sha256. With just the change of <code>opts := rsa.PSSOptions{SaltLength: 32, Hash: crypto.SHA256}</code> the code works.</p>\n"}], "owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1068, "favorite_count": 0, "accepted_answer_id": 30535821, "answer_count": 1, "score": 2, "last_activity_date": 1432921113, "creation_date": 1432772850, "last_edit_date": 1432845944, "question_id": 30495284, "link": "https://stackoverflow.com/questions/30495284/fail-to-verify-rsassa-pss-signature-across-python-go", "title": "Fail to verify RSASSA-PSS signature across Python -&gt; Go", "body": "<p>I've boiled this down to the simplest test case I can. I need to take RSASSA-PSS signatures that were generated in Python and validate them in Go. The Python code to create the RSA keypair and sign with it is as follows:</p>\n\n<pre><code>&gt;&gt;&gt; from tuf import pycrypto_keys as k\n&gt;&gt;&gt; pub, priv = k.generate_rsa_public_and_private()\n&gt;&gt;&gt; sig, method = k.create_rsa_signature(priv, \"The quick brown fox jumps over the lazy dog.\")\n&gt;&gt;&gt; sig.encode(\"hex\")\n'4e05ee9e435653549ac4eddbc43e1a6868636e8ea6dbec2564435afcb0de47e0824cddbd88776ddb20728c53ecc90b5d543d5c37575fda8bd0317025fc07de62ee8084b1a75203b1a23d1ef4ac285da3d1fc63317d5b2cf1aafa3e522acedd366ccd5fe4a7f02a42922237426ca3dc154c57408638b9bfaf0d0213855d4e9ee621db204151bcb13d4dbb18f930ec601469c992c84b14e9e0b6f91ac9517bb3b749dd117e1cbac2e4acb0e549f44558a2005898a226d5b6c8b9291d7abae0d9e0a16858b89662a085f74a202deb867acab792bdbd2c36731217caea8b17bd210c29b890472f11e5afdd1dd7b69004db070e04201778f2c49f5758643881403d45a58d08f51b5c63910c6185892f0b590f191d760b669eff2464456f130239bba94acf54a0cb98f6939ff84ae26a37f9b890be259d9b5d636f6eb367b53e895227d7d79a3a88afd6d28c198ee80f6527437c5fbf63accb81709925c4e03d1c9eaee86f58e4bd1c669d6af042dbd412de0d13b98b1111e2fadbe34b45de52125e9a'\n</code></pre>\n\n<p>The pycrypto_keys library referenced there can be found <a href=\"https://github.com/theupdateframework/tuf/blob/develop/tuf/pycrypto_keys.py\" rel=\"nofollow\">here</a> for reference of the specific implementation of the functions <code>generate_rsa_public_and_private</code> and <code>create_rsa_signature</code>.</p>\n\n<p>My Go test consists of 2 simple files that only rely on core packages. First the verification function, in verify.go:</p>\n\n<pre><code>package example\n\nimport (\n    \"crypto\"\n    \"crypto/rsa\"\n    \"crypto/sha256\"\n    \"crypto/x509\"\n    \"fmt\"\n)\n\nfunc Verify(key []byte, sig []byte, msg []byte) error {\n    digest := sha256.Sum256(msg)\n\n    pub, err := x509.ParsePKIXPublicKey(key)\n    if err != nil {\n        return fmt.Errorf(\"Failed to parse key\")\n    }\n\n    rsaPub, ok := pub.(*rsa.PublicKey)\n    if !ok {\n        return fmt.Errorf(\"Invalid value returned from ParsePKIXPublicKey\")\n    }\n\n    opts := rsa.PSSOptions{SaltLength: 16, Hash: crypto.SHA256}\n    if err = rsa.VerifyPSS(rsaPub, crypto.SHA256, digest[:], sig, &amp;opts); err != nil {\n        return fmt.Errorf(\"Failed Verification\")\n    }\n    return nil\n}\n</code></pre>\n\n<p>And second, a test case. The key pair and signature were generated using the Python commands at the top and copied in here to create a static set of parameters to use for compatibility testing.</p>\n\n<pre><code>package example\n\nimport (\n    \"encoding/hex\"\n    \"encoding/pem\"\n    \"testing\"\n)\n\nfunc TestPyCryptoRSACompatVerify(t *testing.T) {\n    pubPem := \"-----BEGIN PUBLIC KEY-----\\nMIIBojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEAnKuXZeefa2LmgxaL5NsM\\nzKOHNe+x/nL6ik+lDBCTV6OdcwAhHQS+PONGhrChIUVR6Vth3hUCrreLzPO73Oo5\\nVSCuRJ53UronENl6lsa5mFKP8StYLvIDITNvkoT3j52BJIjyNUK9UKY9As2TNqDf\\nBEPIRp28ev/NViwGOEkBu2UAbwCIdnDXm8JQErCZA0Ydm7PKGgjLbFsFGrVzqXHK\\n6pdzJXlhr9yap3UpgQ/iO9JtoEYB2EXsnSrPc9JRjR30bNHHtnVql3fvinXrAEwq\\n3xmN4p+R4VGzfdQN+8Kl/IPjqWB535twhFYEG/B7Ze8IwbygBjK3co/KnOPqMUrM\\nBI8ztvPiogz+MvXb8WvarZ6TMTh8ifZI96r7zzqyzjR1hJulEy3IsMGvz8XS2J0X\\n7sXoaqszEtXdq5ef5zKVxkiyIQZcbPgmpHLq4MgfdryuVVc/RPASoRIXG4lKaTJj\\n1ANMFPxDQpHudCLxwCzjCb+sVa20HBRPTnzo8LSZkI6jAgMBAAE=\\n-----END PUBLIC KEY-----\"\n    //privPem := \"-----BEGIN RSA PRIVATE KEY-----\\nMIIG4wIBAAKCAYEAnKuXZeefa2LmgxaL5NsMzKOHNe+x/nL6ik+lDBCTV6OdcwAh\\nHQS+PONGhrChIUVR6Vth3hUCrreLzPO73Oo5VSCuRJ53UronENl6lsa5mFKP8StY\\nLvIDITNvkoT3j52BJIjyNUK9UKY9As2TNqDfBEPIRp28ev/NViwGOEkBu2UAbwCI\\ndnDXm8JQErCZA0Ydm7PKGgjLbFsFGrVzqXHK6pdzJXlhr9yap3UpgQ/iO9JtoEYB\\n2EXsnSrPc9JRjR30bNHHtnVql3fvinXrAEwq3xmN4p+R4VGzfdQN+8Kl/IPjqWB5\\n35twhFYEG/B7Ze8IwbygBjK3co/KnOPqMUrMBI8ztvPiogz+MvXb8WvarZ6TMTh8\\nifZI96r7zzqyzjR1hJulEy3IsMGvz8XS2J0X7sXoaqszEtXdq5ef5zKVxkiyIQZc\\nbPgmpHLq4MgfdryuVVc/RPASoRIXG4lKaTJj1ANMFPxDQpHudCLxwCzjCb+sVa20\\nHBRPTnzo8LSZkI6jAgMBAAECggGAdzyI7z/HLt2IfoAsXDLynNRgVYZluzgawiU3\\ngeUjnnGhpSKWERXJC2IWDPBk0YOGgcnQxErNTdfXiFZ/xfRlSgqjVwob2lRe4w4B\\npLr+CZXcgznv1VrPUvdolOSp3R2Mahfn7u0qVDUQ/g8jWVI6KW7FACmQhzQkPM8o\\ntLGrpcmK+PA465uaHKtYccEB02ILqrK8v++tknv7eIZczrsSKlS1h/HHjSaidYxP\\n2DAUiF7wnChrwwQEvuEUHhwVgQcoDMBoow0zwHdbFiFO2ZT54H2oiJWLhpR/x6RK\\ngM1seqoPH2sYErPJACMcYsMtF4Tx7b5c4WSj3vDCGb+jeqnNS6nFC3aMnv75mUS2\\nYDPU1heJFd8pNHVf0RDejLZZUiJSnXf3vpOxt9Xv2+4He0jeMfLV7zX0mO2Ni3MJ\\nx6PiVy4xerHImOuuHzSla5crOq2ECiAxd1wEOFDRD2LRHzfhpk1ghiA5xA1qwc7Z\\neRnkVfoy6PPZ4lZakZTm0p8YCQURAoHBAMUIC/7vnayLae7POmgy+np/ty7iMfyd\\nV1eO6LTO21KAaGGlhaY26WD/5LcG2FUgc5jKKahprGrmiNLzLUeQPckJmuijSEVM\\nl/4DlRvCo867l7fLaVqYzsQBBdeGIFNiT+FBOd8atff87ZBEfH/rXbDi7METD/VR\\n4TdblnCsKYAXEJUdkw3IK7SUGERiQZIwKXrH/Map4ibDrljJ71iCgEureU0DBwcg\\nwLftmjGMISoLscdRxeubX5uf/yxtHBJeRwKBwQDLjzHhb4gNGdBHUl4hZPAGCq1V\\nLX/GpfoOVObW64Lud+tI6N9GNua5/vWduL7MWWOzDTMZysganhKwsJCY5SqAA9p0\\nb6ohusf9i1nUnOa2F2j+weuYPXrTYm+ZrESBBdaEJPuj3R5YHVujrBA9Xe0kVOe3\\nne151A+0xJOI3tX9CttIaQAsXR7cMDinkDITw6i7X4olRMPCSixHLW97cDsVDRGt\\necO1d4dP3OGscN+vKCoL6tDKDotzWHYPwjH47sUCgcEAoVI8WCiipbKkMnaTsNsE\\ngKXvO0DSgq3k5HjLCbdQldUzIbgfnH7bSKNcBYtiNxjR7OihgRW8qO5GWsnmafCs\\n1dy6a/2835id3cnbHRaZflvUFhVDFn2E1bCsstFLyFn3Y0w/cO9yzC/X5sZcVXRF\\nit3R0Selakv3JZckru4XMJwx5JWJYMBjIIAc+miknWg3niL+UT6pPun65xG3mXWI\\nS+yC7c4rw+dKQ44UMLs2MDHRBoxqi8T0W/x9NkfDszpjAoHAclH7S4ZdvC3RIR0L\\nLGoJuvroGbwx1JiGdOINuooNwGuswge2zTIsJi0gN/H3hcB2E6rIFiYid4BrMrwW\\nmSeq1LZVS6siu0qw4p4OVy+/CmjfWKQD8j4k6u6PipiK6IMk1JYIlSCr2AS04JjT\\njgNgGVVtxVt2cUM9huIXkXjEaRZdzK7boA60NCkIyGJdHWh3LLQdW4zg/A64C0lj\\nIMoJBGuQkAKgfRuh7KI6Q6Qom7BM3OCFXdUJUEBQHc2MTyeZAoHAJdBQGBn1RFZ+\\nn75AnbTMZJ6Twp2fVjzWUz/+rnXFlo87ynA18MR2BzaDST4Bvda29UBFGb32Mux9\\nOHukqLgIE5jDuqWjy4B5eCoxZf/OvwlgXkX9+gprGR3axn/PZBFPbFB4ZmjbWLzn\\nbocn7FJCXf+Cm0cMmv1jIIxej19MUU/duq9iq4RkHY2LG+KrSEQIUVmImCftXdN3\\n/qNP5JetY0eH6C+KRc8JqDB0nvbqZNOgYXOfYXo/5Gk8XIHTFihm\\n-----END RSA PRIVATE KEY-----\"\n    testStr := \"The quick brown fox jumps over the lazy dog.\"\n    sigHex := \"4e05ee9e435653549ac4eddbc43e1a6868636e8ea6dbec2564435afcb0de47e0824cddbd88776ddb20728c53ecc90b5d543d5c37575fda8bd0317025fc07de62ee8084b1a75203b1a23d1ef4ac285da3d1fc63317d5b2cf1aafa3e522acedd366ccd5fe4a7f02a42922237426ca3dc154c57408638b9bfaf0d0213855d4e9ee621db204151bcb13d4dbb18f930ec601469c992c84b14e9e0b6f91ac9517bb3b749dd117e1cbac2e4acb0e549f44558a2005898a226d5b6c8b9291d7abae0d9e0a16858b89662a085f74a202deb867acab792bdbd2c36731217caea8b17bd210c29b890472f11e5afdd1dd7b69004db070e04201778f2c49f5758643881403d45a58d08f51b5c63910c6185892f0b590f191d760b669eff2464456f130239bba94acf54a0cb98f6939ff84ae26a37f9b890be259d9b5d636f6eb367b53e895227d7d79a3a88afd6d28c198ee80f6527437c5fbf63accb81709925c4e03d1c9eaee86f58e4bd1c669d6af042dbd412de0d13b98b1111e2fadbe34b45de52125e9a\"\n    testKey, _ := pem.Decode([]byte(pubPem))\n\n    sigBytes, err := hex.DecodeString(sigHex)\n    if err != nil {\n        t.Fatal(err)\n    }\n    err = Verify(testKey.Bytes, sigBytes, []byte(testStr))\n    if err != nil {\n        t.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>The code fails in the final check of the Verify function, outputting the error <code>Failed verification</code>. I've had a look at the Go PSS verification code and if anything goes wrong, a generic verification error is returned so it's not that helpful. Even if it was more specific, either there is a compatibility problem here, a bug in one of the language implementations, or my code is wrong.</p>\n\n<p>Much thanks for any help.</p>\n"}]