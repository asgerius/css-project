[{"tags": ["go", "concurrency", "mapreduce"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1499349505, "post_id": 44937567, "comment_id": 76877116, "body": "While your counter will work fine, there is a built-in type to manage this, <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a>, worth taking a look at."}], "answers": [{"comments": [{"owner": {"reputation": 7796, "user_id": 2334254, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-6e2XuTZAjgM/AAAAAAAAAAI/AAAAAAAAABU/JpF2-AkHsH4/photo.jpg?sz=128", "display_name": "kpie", "link": "https://stackoverflow.com/users/2334254/kpie"}, "edited": false, "score": 0, "creation_date": 1499306303, "post_id": 44938501, "comment_id": 76853507, "body": "Well it&#39;s not the answer I wanted, but it is what I expected... Also thank you for pointing out what to call the empty interface!"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 7796, "user_id": 2334254, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-6e2XuTZAjgM/AAAAAAAAAAI/AAAAAAAAABU/JpF2-AkHsH4/photo.jpg?sz=128", "display_name": "kpie", "link": "https://stackoverflow.com/users/2334254/kpie"}, "edited": false, "score": 0, "creation_date": 1499306921, "post_id": 44938501, "comment_id": 76853692, "body": "@kpie: yeah, I imagined... if you have time you can read this thread which shows quite well the philosophy behind not adding precisely this kind of feature to the language: <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/RKymTuSCHS0\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/RKymTuSCHS0</a>"}, {"owner": {"reputation": 7796, "user_id": 2334254, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-6e2XuTZAjgM/AAAAAAAAAAI/AAAAAAAAABU/JpF2-AkHsH4/photo.jpg?sz=128", "display_name": "kpie", "link": "https://stackoverflow.com/users/2334254/kpie"}, "edited": false, "score": 0, "creation_date": 1499308006, "post_id": 44938501, "comment_id": 76853943, "body": "Actually I&#39;m not looking for map reduce and filter. That has all allready been created (<a href=\"https://blog.gopheracademy.com/advent-2015/glow-map-reduce-for-golang/\" rel=\"nofollow noreferrer\">blog.gopheracademy.com/advent-2015/glow-map-reduce-for-gola&zwnj;&#8203;ng</a>). What I am looking for may lay in unsafe.go (<a href=\"https://github.com/golang/go/blob/master/src/unsafe/unsafe.go\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/unsafe/unsafe.go</a>) but I haven&#39;t looked into that thoroughly yet."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1499349435, "post_id": 44938501, "comment_id": 76877062, "body": "It&#39;s worth pointing out that your map-reduce is <i>less than 20 lines of code</i>. Writing this each time you need to implement m-r is trivial - I&#39;ve seen more boilerplate in a Java DTO that does nothing."}, {"owner": {"reputation": 7796, "user_id": 2334254, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-6e2XuTZAjgM/AAAAAAAAAAI/AAAAAAAAABU/JpF2-AkHsH4/photo.jpg?sz=128", "display_name": "kpie", "link": "https://stackoverflow.com/users/2334254/kpie"}, "edited": false, "score": 0, "creation_date": 1499386650, "post_id": 44938501, "comment_id": 76896709, "body": "It&#39;s trivial but so is everything."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 1, "last_activity_date": 1499305393, "creation_date": 1499305393, "answer_id": 44938501, "question_id": 44937567, "link": "https://stackoverflow.com/questions/44937567/generalizing-concurrent-map-function-with-empty-interface-in-golang/44938501#44938501", "title": "Generalizing Concurrent Map Function with Empty Interface In GOlang", "body": "<p>No real workaround there, that's the nature of the beast.</p>\n\n<p>The language was designed after struggling with C++ for some time, and the idea of the creators was simplifying all non-vital things but at the same time make key additions to make the language more expressive.</p>\n\n<p>You can read a bit about their reasoning here, which I believe is quite interesting even if you don't agree with all the decisions they made:</p>\n\n<p><a href=\"https://commandcenter.blogspot.com.ar/2012/06/less-is-exponentially-more.html\" rel=\"nofollow noreferrer\">https://commandcenter.blogspot.com.ar/2012/06/less-is-exponentially-more.html</a></p>\n\n<p>In your example, if you wanted to, you could make your maps and functions use <code>interface{}</code> (which by the way is called the empty interface and not \"nil\" interface).</p>\n\n<p>But of course you would lose compile-time type checking and would have to add casts all around.</p>\n\n<p>You can also try to find an interface to express the commonalities of the types you want to use (which might not be so easy or even possible at all), and then build your mapping API around that interface.</p>\n"}, {"comments": [{"owner": {"reputation": 7796, "user_id": 2334254, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-6e2XuTZAjgM/AAAAAAAAAAI/AAAAAAAAABU/JpF2-AkHsH4/photo.jpg?sz=128", "display_name": "kpie", "link": "https://stackoverflow.com/users/2334254/kpie"}, "edited": false, "score": 0, "creation_date": 1499318055, "post_id": 44939808, "comment_id": 76856399, "body": "Thanks, I&#39;ve only been programming with Golang for 24 hours so the example is extremely helpful. (I actually hadn&#39;t figured out how to append until reading your example.)"}], "tags": [], "owner": {"reputation": 11, "user_id": 3272558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8595f8b54ecd17171b7fd36c503fe06f?s=128&d=identicon&r=PG&f=1", "display_name": "user3272558", "link": "https://stackoverflow.com/users/3272558/user3272558"}, "is_accepted": false, "score": 1, "last_activity_date": 1499315199, "creation_date": 1499315199, "answer_id": 44939808, "question_id": 44937567, "link": "https://stackoverflow.com/questions/44937567/generalizing-concurrent-map-function-with-empty-interface-in-golang/44939808#44939808", "title": "Generalizing Concurrent Map Function with Empty Interface In GOlang", "body": "<p>The philosophy of Go is not compatible with generalized functions such as is the style with popular dynamic languages. To properly inform the compiler of what you are trying to do, you should express your needed map through an interface or simply by writing it for each type you are using it with.</p>\n\n<p>Mapping requires allocating an array, iterating through a collection, and adding to the array some data element for each element in the collection. If you need a map for a slice of structs, as is common in the application layer, you can express this tersely in Go:</p>\n\n<p><a href=\"https://play.golang.org/p/pk3Tl_BdlD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pk3Tl_BdlD</a></p>\n\n<p>Dynamic languages build a \"type tree\" of \"generic\" types that allow for terse programming, such as functions like <code>map</code> being called by one symbol over any possible type. This provides a ton of developer productivity because code can be written loosely to allow easy experimentation.</p>\n\n<p>Go is designed for writing semi-permanent software. It performs well because it requires more information to be supplied to the compiler. Map is only about three lines of code, so the cost/benefit of developer productivity v. efficiency lands on the performance side for Go. Functions like map, reduce and filter should be written explicitly as needed.</p>\n\n<p>To evaluate the language, I would encourage you to try to solve a problem with a Go program and see where that takes you.</p>\n"}], "owner": {"reputation": 7796, "user_id": 2334254, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-6e2XuTZAjgM/AAAAAAAAAAI/AAAAAAAAABU/JpF2-AkHsH4/photo.jpg?sz=128", "display_name": "kpie", "link": "https://stackoverflow.com/users/2334254/kpie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 0, "accepted_answer_id": 44938501, "answer_count": 2, "score": 1, "last_activity_date": 1499315199, "creation_date": 1499297706, "last_edit_date": 1499306322, "question_id": 44937567, "link": "https://stackoverflow.com/questions/44937567/generalizing-concurrent-map-function-with-empty-interface-in-golang", "title": "Generalizing Concurrent Map Function with Empty Interface In GOlang", "body": "<p>So I'm super new to Golang and seeing as the big buzz around the language seems to be concurrency I figured a good way to get my toes wet would be to write a generalized map function. In psudo code:</p>\n\n<pre><code>map(F funtion,A array){\n    return([F(k) for k in A])\n}\n</code></pre>\n\n<p>And obviously I want the calculations for each F(k) occur concurrently. For organization I have a main file with my implementation and a supporting file Mr with my required definitions.</p>\n\n<pre><code>.\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 Mr\n \u00a0\u00a0 \u2514\u2500\u2500 Mr.go\n</code></pre>\n\n<p>Main is a simple test implementation which should convert an array of strings to an array of ints where each member of the result is the length of the corresponding string in the input array.</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"./Mr\"\n)\n\nfunc exfunc(i int, c chan int){\n    c&lt;-i\n}\n\nfunc main(){\n    data := make(map[int]string)\n    data[1]=\"these\"\n    data[2]=\"are\"\n    data[3]=\"some\"\n    data[4]=\"words\"\n    data[5]=\"and a few more...\"\n    f := func(w string)int{\n        return(len(w))\n    }\n    testMr := Mr.Map(f,data) // this is line 22 (matters later)\n    fmt.Println(testMr)\n}\n</code></pre>\n\n<p>Which works great with my Mr.Map function given that I specify all the types explicitly.</p>\n\n<pre><code>package Mr\n\ntype result struct{\n    key,value int\n}\n\nfunc wrapper(f func(string) int,k int,v string, c chan result){\n    c &lt;- result{k,f(v)}\n}\n\nfunc Map(f func(string) int,m map[int]string) map[int]int{\n    c := make(chan result)\n    ret := make(map[int]int)\n    n := 0\n    for k := range m{\n        go wrapper(f,k,m[k],c)\n        n++\n    }\n    for ;n&gt;0; {\n        r := &lt;-c\n        ret[r.key]=r.value\n        n--\n    }\n    return(ret)\n}\n</code></pre>\n\n<p>However I was hoping that I would be able to generalize this mapping with the empty interface.</p>\n\n<pre><code>package Mr\n\ntype T interface{}\n\ntype result struct{\n    key,value T\n}\n\nfunc wrapper(f func(T) T,k T,v T, c chan result){\n    c &lt;- result{k,f(v)}\n}\n\nfunc Map(f func(T) T,m map[T]T) map[T]T{\n    c := make(chan result)\n    ret := make(map[T]T)\n    n := 0\n    for k := range m{\n        go wrapper(f,k,m[k],c)\n        n++\n    }\n    for ;n&gt;0; {\n        r := &lt;-c\n        ret[r.key]=r.value\n        n--\n    }\n    return(ret)\n}\n</code></pre>\n\n<p>Unfortunately when I run main with this generalize Mr.Map I get the following error.</p>\n\n<pre><code># command-line-arguments\n./main.go:22: cannot use f (type func(string) int) as type func(Mr.T) Mr.T in argument to Mr.Map\n./main.go:22: cannot use data (type map[int]string) as type map[Mr.T]Mr.T in argument to Mr.Map\n</code></pre>\n\n<p>So yeah, obviously I understand what the errors are telling me but it seems wild that I would have to re-write my Map function for each possible combination of key and value types.</p>\n\n<p><code>Is there a work around here, or is this just the nature of the beast?</code></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "edited": false, "score": 0, "creation_date": 1499283906, "post_id": 44934634, "comment_id": 76845498, "body": "The only difference I see is capitalization ,is this what I need to use in my struct ?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1499284040, "post_id": 44934634, "comment_id": 76845594, "body": "Yes, capitalization of the first character is the salient detail, as explained in the link given."}, {"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "edited": false, "score": 0, "creation_date": 1499284587, "post_id": 44934634, "comment_id": 76845922, "body": "Yes, Reading them. Thanks a lot :)"}], "tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": true, "score": 1, "last_activity_date": 1499284007, "last_edit_date": 1499284007, "creation_date": 1499283453, "answer_id": 44934634, "question_id": 44934457, "link": "https://stackoverflow.com/questions/44934457/looping-slice-value-in-html-file/44934634#44934634", "title": "Looping slice value in HTML file", "body": "<p>To access your struct field on template, it must be exported fields. Update your struct to-</p>\n\n<pre><code>type blogs struct {\n    ID             int\n    Title          string\n    Featured_image string\n    Created_at     string\n}\n</code></pre>\n\n<p>Read more about <a href=\"https://www.goinggo.net/2014/03/exportedunexported-identifiers-in-go.html\" rel=\"nofollow noreferrer\">Exported/Unexported Identifiers In Go</a>.</p>\n"}], "owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 44934634, "answer_count": 1, "score": 0, "last_activity_date": 1515147776, "creation_date": 1499282718, "last_edit_date": 1515147776, "question_id": 44934457, "link": "https://stackoverflow.com/questions/44934457/looping-slice-value-in-html-file", "title": "Looping slice value in HTML file", "body": "<p>I have created slice of struct and an array of slice.</p>\n\n<pre><code>type blogs struct {\n    id             int\n    title          string\n    featured_image string\n    created_at     string\n}\n</code></pre>\n\n<p>and created variable inside \"xyz\" function :</p>\n\n<pre><code>blog := blogs{}\nblogData := []blogs{}\n</code></pre>\n\n<p>with value as :</p>\n\n<pre><code>    rows, err := db.Query(\"SELECT id, title, featured_image, created_at from blogs order by created_at desc limit 0,6\")\n    if err != nil {\n        ctx.Application().Logger().Fatalf(\"MySQL Error fetching row %s\\n\", err)\n    }        \n    for rows.Next() {\n        rcan := rows.Scan(&amp;id, &amp;title, &amp;featured_image, &amp;created_at)\n\n        blog.id = id\n        blog.title = title\n        blog.featured_image = featured_image\n        blog.created_at = created_at\n\n        blogData = append(blogData, blog)\n    }\n</code></pre>\n\n<p>and now, I have passed \"blogData\" value to \"html\" template and <code>iterating</code> below gives error :</p>\n\n<pre><code>  &lt;ul&gt;\n  {{ range $value := .blogData }}\n    &lt;li&gt;{{ $value.title }}&lt;/li&gt;\n  {{ end }}\n  &lt;/ul&gt;\n</code></pre>\n\n<p>Error :</p>\n\n<pre><code>template: master.html:18:5: executing \"master.html\" at &lt;yield&gt;: error calling yield: template: home.html:5:17: executing \"home.html\" at &lt;$value.title&gt;: title is an unexported field of struct type main.blogs\n</code></pre>\n\n<p>How can I print \"title\" and other value from <code>blogData</code> Variable in my template.</p>\n\n<p>if I print <code>$value</code> , it returns all value in below format </p>\n\n<pre><code>{5 This is Title img/blog.jpg 2017-07-05T10:11:30+05:30 }\n</code></pre>\n\n<p>But I want to print, <code>title</code> , <code>featured_image</code> and other date separately.</p>\n\n<p>Any help would be appreciated. I am using \"github.com/get-ion/ion\" framework</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1499281854, "post_id": 44934156, "comment_id": 76844293, "body": "You can&#39;t make it more efficient than a for loop, the php range function just hides it from you."}], "answers": [{"tags": [], "owner": {"reputation": 428, "user_id": 8092543, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BOOdr.png?s=128&g=1", "display_name": "sebito91", "link": "https://stackoverflow.com/users/8092543/sebito91"}, "is_accepted": true, "score": 0, "last_activity_date": 1499307927, "creation_date": 1499307927, "answer_id": 44938834, "question_id": 44934156, "link": "https://stackoverflow.com/questions/44934156/analog-of-function-range-in-golang/44938834#44938834", "title": "Analog of function range in golang", "body": "<p>In golang, there is only one iteration construct and that's the for loop. There are multiple ways to configure the for loop itself, but overall there is just the single construct:</p>\n\n<p><a href=\"https://tour.golang.org/flowcontrol/1\" rel=\"nofollow noreferrer\">https://tour.golang.org/flowcontrol/1</a></p>\n\n<p><a href=\"https://play.golang.org/p/wBSGJqHuLK\" rel=\"nofollow noreferrer\">https://play.golang.org/p/wBSGJqHuLK</a></p>\n\n<pre><code>The C method -- for i := 0; i &lt; 10; i++ { }\nThe python method -- for k, v := range map[string]string{\"key\": \"val\"} { }\nThe python method -- for idx, val := range []string{\"one\", \"two\"} { }\nThe empty for -- for { }\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 8188100, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4e334930c972ee44f83c74823a0ecc65?s=128&d=identicon&r=PG&f=1", "display_name": "gomazafaka", "link": "https://stackoverflow.com/users/8188100/gomazafaka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "accepted_answer_id": 44938834, "answer_count": 1, "score": 0, "last_activity_date": 1499307927, "creation_date": 1499281558, "question_id": 44934156, "link": "https://stackoverflow.com/questions/44934156/analog-of-function-range-in-golang", "title": "Analog of function range in golang", "body": "<p>Range in php <a href=\"http://php.net/manual/en/function.range.php\" rel=\"nofollow noreferrer\">http://php.net/manual/en/function.range.php</a> \nTo create such an array, need use a slice?\nI only know the method using the slice and loop for, but can there be another, more efficient way?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user5906464"}, "edited": false, "score": 0, "creation_date": 1499281294, "post_id": 44933956, "comment_id": 76843983, "body": "I&#39;ve never heard of the above testing techniques. I&#39;ll definitely look into them!"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 0, "last_activity_date": 1499280849, "creation_date": 1499280849, "answer_id": 44933956, "question_id": 44933674, "link": "https://stackoverflow.com/questions/44933674/testing-a-handler-that-connects-to-db-in-go/44933956#44933956", "title": "Testing a handler that connects to db in go", "body": "<p>If it works then it's not wrong, but it doesn't validate much, only that the response body is non-empty - not even that it's successful. I'm not sure why it prints out <code>http.StatusOK</code>, which is a constant, and doesn't tell you what the status code in the response was.</p>\n\n<p>Personally when I do this level of test I check, at the very least, that the response code is as expected, the response body unmarshals correctly (if it's JSON or XML), the response data is basically sane, etc. For more complex payloads I might use a <a href=\"http://jonnyreeves.co.uk/2016/integration-testing-with-golden-masters/\" rel=\"nofollow noreferrer\">golden file</a> test. For critical code I might use a <a href=\"https://en.wikipedia.org/wiki/Fuzzing\" rel=\"nofollow noreferrer\">fuzz (aka monte carlo) test</a>. For performance-critical code I'll likely add benchmarks and load tests. There are practically infinite ways to test code. You'll have to figure out what your needs are and how to meet them.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5906464"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 44933956, "answer_count": 1, "score": 0, "last_activity_date": 1499894869, "creation_date": 1499279866, "last_edit_date": 1592644375, "question_id": 44933674, "link": "https://stackoverflow.com/questions/44933674/testing-a-handler-that-connects-to-db-in-go", "title": "Testing a handler that connects to db in go", "body": "<p>I have a handler which connects to a db and retrieves the records. I wrote a test case for that and it goes this way:</p>\n<h1>main_test.go</h1>\n<pre><code>package main\n\nimport (\n  &quot;os&quot;\n  &quot;fmt&quot;\n  &quot;testing&quot;\n  &quot;net/http&quot;\n  &quot;net/http/httptest&quot;\n)\n\nvar a App \n\nfunc TestMain(m *testing.M) {\n    a = App{}\n    a.InitializeDB(fmt.Sprintf(&quot;postgres://****:****@localhost/db?sslmode=disable&quot;))\n    code := m.Run()\n    os.Exit(code)\n}\n\n\nfunc TestRulesetGet(t *testing.T) {\n\n    req, err := http.NewRequest(&quot;GET&quot;, &quot;/1/sig/&quot;, nil)\n    if err != nil {\n        t.Fatal(err)\n    }\n    // We create a ResponseRecorder (which satisfies http.ResponseWriter) to record the response.\n    rr := httptest.NewRecorder()\n    handler := http.HandlerFunc(a.Get)\n    handler.ServeHTTP(rr, req)\n\n    // Check the response body is what we expect.\n\n    if len(rr.Body.String()) != 0 {\n      fmt.Println(&quot;Status OK : &quot;, http.StatusOK)\n        fmt.Println(&quot;handler returned body: got &quot;,\n            rr.Body.String())\n    }\n}\n</code></pre>\n<p>I feel like this is a very basic test case where I'm just checking the response length (This is because I expect a slice). I'm not really sure whether this is the right way to write a test case. Please point out some loop holes so that I could write a solid test cases for my remaining handlers. And also, I'm not using the actual <code>Error</code>, and <code>Fatal</code> methods for checking the errors.</p>\n"}, {"tags": ["multithreading", "go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1499278866, "post_id": 44933295, "comment_id": 76842651, "body": "You might want to search for the term &quot;goroutine&quot; as this is what you are interested (and where you can find examples) and not threads."}, {"owner": {"reputation": 527, "user_id": 3591466, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/977d21dd4dde36df3ae73e9bef6ecf49?s=128&d=identicon&r=PG&f=1", "display_name": "user3591466", "link": "https://stackoverflow.com/users/3591466/user3591466"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1499279216, "post_id": 44933295, "comment_id": 76842835, "body": "@Volker Thanks for the advice, I did do a bit research, but most of the example I found ask for waiting of all goroutine to be finished, not wait until the first one to be finished. I edit my wording to be more precise in the terminology"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1499279368, "post_id": 44933295, "comment_id": 76842923, "body": "@user3591466: how can you have a slice of goroutine? Are you looking for cancelation, with something like <a href=\"https://golang.org/pkg/context/#Context\" rel=\"nofollow noreferrer\"><code>Context</code></a>?"}, {"owner": {"reputation": 527, "user_id": 3591466, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/977d21dd4dde36df3ae73e9bef6ecf49?s=128&d=identicon&r=PG&f=1", "display_name": "user3591466", "link": "https://stackoverflow.com/users/3591466/user3591466"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1499279544, "post_id": 44933295, "comment_id": 76842999, "body": "@JimB you are correct, slice of goroutine is confusing, I actually have a slice of task, and each task is run in a goroutine. I was looking for libraries that deal closing all task when the first task is complete"}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 2, "last_activity_date": 1499279568, "creation_date": 1499279568, "answer_id": 44933584, "question_id": 44933295, "link": "https://stackoverflow.com/questions/44933295/what-is-the-canonical-way-to-control-the-closing-of-goroutine-if-one-goroutine-i/44933584#44933584", "title": "What is the canonical way to control the closing of goroutine if one goroutine is complete?", "body": "<p>The common idiom is to have a <code>Done</code> channel shared between the calling code and the goroutines.</p>\n\n<p>Then each goroutine would check that channel via a <code>select</code> each time they \nsend a new value to the calling code.</p>\n\n<p>You can find a good example in Go's blog:</p>\n\n<p><a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">https://blog.golang.org/pipelines</a></p>\n\n<p>(look for \"Explicit Cancellation\" there)</p>\n\n<p>Later, they incorporated a <code>context</code> package to the standard library, and that is now the most \"standard\" way to manage cancellation of goroutines.</p>\n\n<p>You can find a good example in the documentation for the package itself:</p>\n\n<p><a href=\"https://golang.org/pkg/context/#example_WithCancel\" rel=\"nofollow noreferrer\">https://golang.org/pkg/context/#example_WithCancel</a></p>\n"}], "owner": {"reputation": 527, "user_id": 3591466, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/977d21dd4dde36df3ae73e9bef6ecf49?s=128&d=identicon&r=PG&f=1", "display_name": "user3591466", "link": "https://stackoverflow.com/users/3591466/user3591466"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 44933584, "answer_count": 1, "score": 0, "last_activity_date": 1499279568, "creation_date": 1499278489, "last_edit_date": 1499279439, "question_id": 44933295, "link": "https://stackoverflow.com/questions/44933295/what-is-the-canonical-way-to-control-the-closing-of-goroutine-if-one-goroutine-i", "title": "What is the canonical way to control the closing of goroutine if one goroutine is complete?", "body": "<p>I have a slice of struct that defines a task, each task is run in a goroutine, and I want all go goroutines to stop whenever the first one complete a task via the signal <code>task.signalComplete</code></p>\n\n<p>Currently I have the following.</p>\n\n<pre><code>for _, task := range taskList {\n    go func(task *myTask, firstCompleteSignal chan&lt;- bool) {\n        for {\n            select {\n                // When the task completes, it emit signalComplete\n                case &lt;-task.signalComplete:\n                    firstCompleteSignal&lt;-true\n                    return\n            }\n        }\n\n    }(task, firstCompleteSignal)\n}\n\nfor {\n    select {\n    case &lt;-firstCompleteSignal:\n        // manually stop all go thread\n        return\n    }\n}\n</code></pre>\n\n<p>Is this canonical?</p>\n\n<p>Or is there library to do this for me like sync.WaitGroup for waiting all goroutine to be done?</p>\n"}, {"tags": ["go", "makefile"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1499277652, "post_id": 44933025, "comment_id": 76841973, "body": "No, because <code>go build</code> works on packages (or directories) and <i>not</i> on files. So your current makefile is broken already."}, {"owner": {"reputation": 293, "user_id": 5225081, "user_type": "registered", "accept_rate": 6, "profile_image": "https://www.gravatar.com/avatar/88eacba7df7f23affd7a197753f2696b?s=128&d=identicon&r=PG&f=1", "display_name": "J.Doe", "link": "https://stackoverflow.com/users/5225081/j-doe"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1499280806, "post_id": 44933025, "comment_id": 76843699, "body": "Hmm...my new makefile is able to build (&quot;make go&quot;) the &quot;existingTest&quot; stub but when it tries to build &quot;newTest/newTest.go&quot;, it has trouble because of some undefined methods/variables that are implemented in &quot;util.go&quot;. I guess it&#39;s because GOPATH is not set up to look in the existingTest directory for util.go. Is there a way to circumvent this?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1499281105, "post_id": 44933025, "comment_id": 76843876, "body": "The <code>go</code> command is designed to work on directories, either building packages/commands consisting of all buildable Go files in a directory or running their <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow noreferrer\">tests</a> (note <code>foo_test.go</code> is recognized as a test file but not <code>fooTest.go</code>). It sounds like you might be trying to build two executables from different subsets of the files within one package, which it&#39;s not designed for. One approach would be take the common part (utils) and move that code out to other package(s), and have your two programs import it."}], "owner": {"reputation": 293, "user_id": 5225081, "user_type": "registered", "accept_rate": 6, "profile_image": "https://www.gravatar.com/avatar/88eacba7df7f23affd7a197753f2696b?s=128&d=identicon&r=PG&f=1", "display_name": "J.Doe", "link": "https://stackoverflow.com/users/5225081/j-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 491, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1499280541, "creation_date": 1499277476, "last_edit_date": 1499280541, "question_id": 44933025, "link": "https://stackoverflow.com/questions/44933025/makefile-for-go", "title": "Makefile for Go", "body": "<p>I have added a new Go test stub into my project's test tools repo in a folder called \"newTest\" which contains \"newTest.go, util.go and util_test.go\". In the parent directory there is a makefile that automates the building of all test tools and then dockerize them. There already exists a separate Go test stub executable that gets built (existingTest) in the test tools repo. This is the current makefile (redacted):</p>\n\n<pre><code>// Set up and do other stuff  \nexistingTest:\n    env GOPATH=${PWD}/../external_vendor go build existingTest.go\n\ndocker: \n    @if [ -n \"$${CI_PIPE}\" ]; then \\\n          //...other docker make stuff\n</code></pre>\n\n<p>My new go test stub has the same external dependencies that is in ${PWD}/../external_vendor and the build process itself is pretty much identical to what's currently being built. Can I do something like this?</p>\n\n<pre><code>// Set up other stuff\nGO_PROG=        existingTest  newTest/newTest\n\ngo: ${GO_PROG}\n\n${GO_PROG}:\n    env GOPATH=${PWD}/../external_vendor go build $@.go\n\ndocker: \n    @if [ -n \"$${CI_PIPE}\" ]; then \\\n          //...other docker make stuff\n</code></pre>\n"}, {"tags": ["go", "oauth-2.0", "google-authentication"], "answers": [{"comments": [{"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1499279475, "post_id": 44933147, "comment_id": 76842970, "body": "Right. So how to fix it?"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1499279730, "post_id": 44933147, "comment_id": 76843100, "body": "see my edited answer (at the end) for some alternative fixes"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1499280077, "post_id": 44933147, "comment_id": 76843298, "body": "Sorry what do you mean by <code>trigger the initialization from the init after you set the values</code> ?  I put the  <code>os.Setenv</code> inside init, but this causes <code>undefined</code> error."}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1499280231, "post_id": 44933147, "comment_id": 76843373, "body": "I mean doing the &quot;googleOauthConfig = ....&quot; inside the &quot;init&quot; function."}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1499280726, "post_id": 44933147, "comment_id": 76843648, "body": "As I said this causes <code>undefined: googleOauthConfig in googleOauthConfig.AuthCodeURL</code>"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1499281344, "post_id": 44933147, "comment_id": 76844020, "body": "You still need to define the var, but then initialize it in init, see my new edit"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 2, "last_activity_date": 1499281340, "last_edit_date": 1499281340, "creation_date": 1499277942, "answer_id": 44933147, "question_id": 44932806, "link": "https://stackoverflow.com/questions/44932806/error-invalid-request-missing-required-parameter-client-id-in-golang/44933147#44933147", "title": "Error: invalid_request Missing required parameter: client_id in golang", "body": "<p>The error message indicates that <code>ClientID</code> is not initialized.</p>\n\n<p>That looks consistent with the code, since <code>var</code> declarations are executed before the <code>init</code> functions.</p>\n\n<p>So when your <code>var</code> requests <code>os.Getenv(\"CLIENT_ID\")</code> the value is blank since <code>init</code> has not executed yet.</p>\n\n<p>From the documentation:</p>\n\n<blockquote>\n  <p>A package with no imports is initialized by assigning initial values to all its package-level variables followed by calling all init functions in the order they appear in the source, possibly in multiple files, as presented to the compiler</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Package_initialization</a></p>\n\n<p>To fix this, either put the string directly in the <code>var</code> initialization, or trigger the initialization from the <code>init</code> after you set the values.</p>\n\n<p>Like:</p>\n\n<pre><code>var (\n    googleOauthConfig *oauth2.Config\n)\n\nfunc init() {\n     // init ENV\n     // initialize the variable using ENV values\n     googleOauthConfig = &amp;oauth2.Config{ ... }\n}\n</code></pre>\n\n<p>Alternatively, you can set those <code>ENV</code> values at the OS level before executing the actual Go program. </p>\n"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3407, "favorite_count": 0, "accepted_answer_id": 44933147, "answer_count": 1, "score": 1, "last_activity_date": 1499281340, "creation_date": 1499276592, "question_id": 44932806, "link": "https://stackoverflow.com/questions/44932806/error-invalid-request-missing-required-parameter-client-id-in-golang", "title": "Error: invalid_request Missing required parameter: client_id in golang", "body": "<p>I'm having difficulty authenticating using Google OAuth2. </p>\n\n<p>I've obtainedd client ID and secret from google developer console, and I came up with this code :</p>\n\n<pre><code>package main\n\n    import (\n        \"fmt\"\n        \"golang.org/x/oauth2\"\n        \"golang.org/x/oauth2/google\"\n        \"io/ioutil\"\n        \"net/http\"\n        \"os\"\n    )\n\n    const htmlIndex = `&lt;html&gt;&lt;body&gt;\n    &lt;a href=\"/GoogleLogin\"&gt;Log in with Google&lt;/a&gt;\n    &lt;/body&gt;&lt;/html&gt;\n    `\n\n    func init() {\n        // Setup Google's example test keys\n        os.Setenv(\"CLIENT_ID\", \"somrestring-otherstring.apps.googleusercontent.com\")\n        os.Setenv(\"SECRET_KEY\", \"alongcharachterjumble\")\n    }\n\n    var (\n        googleOauthConfig = &amp;oauth2.Config{\n            RedirectURL:  \"http://127.0.0.1:8080/auth\",  //defined in Google console\n            ClientID:     os.Getenv(\"CLIENT_ID\"),\n            ClientSecret: os.Getenv(\"SECRET_KEY\"),\n            Scopes: []string{\"https://www.googleapis.com/auth/userinfo.profile\",\n                \"https://www.googleapis.com/auth/userinfo.email\"},\n            Endpoint: google.Endpoint,\n        }\n        // Some random string, random for each request\n        oauthStateString = \"random\"\n    )\n\n    func main() {\n        http.HandleFunc(\"/\", handleMain)\n        http.HandleFunc(\"/GoogleLogin\", handleGoogleLogin)\n        http.HandleFunc(\"/GoogleCallback\", handleGoogleCallback)\n        fmt.Println(http.ListenAndServe(\":8080\", nil))\n    }\n\n    func handleMain(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprintf(w, htmlIndex)\n        fmt.Println(\"another request made\")\n    }\n\n    func handleGoogleLogin(w http.ResponseWriter, r *http.Request) {\n        url := googleOauthConfig.AuthCodeURL(oauthStateString)\n        http.Redirect(w, r, url, http.StatusTemporaryRedirect)\n    }\n\n    func handleGoogleCallback(w http.ResponseWriter, r *http.Request) {\n        state := r.FormValue(\"state\")\n        if state != oauthStateString {\n            fmt.Printf(\"invalid oauth state, expected '%s', got '%s'\\n\", oauthStateString, state)\n            http.Redirect(w, r, \"/\", http.StatusTemporaryRedirect)\n            return\n        }\n\n        code := r.FormValue(\"code\")\n        token, err := googleOauthConfig.Exchange(oauth2.NoContext, code)\n        if err != nil {\n            fmt.Println(\"Code exchange failed with '%s'\\n\", err)\n            http.Redirect(w, r, \"/\", http.StatusTemporaryRedirect)\n            return\n        }\n\n        response, err := http.Get(\"https://www.googleapis.com/oauth2/v2/userinfo?access_token=\" + token.AccessToken)\n\n        defer response.Body.Close()\n        contents, err := ioutil.ReadAll(response.Body)\n        fmt.Fprintf(w, \"Content: %s\\n\", contents)\n    }\n</code></pre>\n\n<p>But I get this error from google:</p>\n\n<blockquote>\n  <ol start=\"400\">\n  <li>That\u2019s an error.</li>\n  </ol>\n  \n  <p>Error: invalid_request</p>\n  \n  <p>Missing required parameter: client_id</p>\n  \n  <p>Learn more</p>\n  \n  <p>Request Details client_id= redirect_uri=<a href=\"http://127.0.0.1:8080/auth\" rel=\"nofollow noreferrer\">http://127.0.0.1:8080/auth</a>\n  response_type=code\n  scope=<a href=\"https://www.googleapis.com/auth/userinfo.profile\" rel=\"nofollow noreferrer\">https://www.googleapis.com/auth/userinfo.profile</a>\n  <a href=\"https://www.googleapis.com/auth/userinfo.email\" rel=\"nofollow noreferrer\">https://www.googleapis.com/auth/userinfo.email</a> state=random</p>\n</blockquote>\n\n<p>What's wrong here? How can I fix it? </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1499271746, "creation_date": 1499271746, "answer_id": 44931451, "question_id": 44931422, "link": "https://stackoverflow.com/questions/44931422/html-template-optional-outer-element-around-sub-template-if-its-not-empty/44931451#44931451", "title": "html/template: optional outer element around sub-template if it&#39;s not empty", "body": "<p>You would need to do one of two things:</p>\n\n<ol>\n<li>Put the containing tag in the sub-template</li>\n<li>Pre-render the sub-template and pass it to the outer template as a string</li>\n</ol>\n"}], "owner": {"reputation": 75620, "user_id": 23643, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Efp8C.jpg?s=128&g=1", "display_name": "Alex B", "link": "https://stackoverflow.com/users/23643/alex-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1499271746, "creation_date": 1499271646, "question_id": 44931422, "link": "https://stackoverflow.com/questions/44931422/html-template-optional-outer-element-around-sub-template-if-its-not-empty", "title": "html/template: optional outer element around sub-template if it&#39;s not empty", "body": "<p>I have a template with an inner content template and I want to render it in a way that there is an outer wrapping element around inner content which is only shown if the content is not empty.</p>\n\n<p>For example:</p>\n\n<pre><code>...\n{{if template-content-exists-and-not-blank}}\n  &lt;div class=\"content\"&gt;\n   {{template \"content\" .}}\n  &lt;/div&gt;\n{{end}}\n...\n</code></pre>\n\n<p>I want to render <code>&lt;div&gt;</code> only when the result of <code>{{template \"content\" .}}</code> is not empty. I don't want to put the enclosing <code>&lt;div&gt;</code> into content, as it doesn't really belong there, and it will be duplicated across all content sub-templates.</p>\n\n<ol>\n<li>I cannot use <code>{{template ...}}</code> as a function argument, so it's not possible to test it.</li>\n<li><p>I wrote a\u00a0custom <code>defined</code> boolean function that tests if a sub-template is defined, but the <code>content</code> template is executed regardless of whether it's true or false (no short-circuiting), and obviously fails if it's not defined.</p>\n\n<pre><code>t.Funcs(\n    html.FuncMap{\n        \"defined\": func(name string) bool {\n            return t.Lookup(name) != nil\n        },\n    },\n)\n</code></pre></li>\n</ol>\n"}, {"tags": ["android", "ios", "linux", "go", "web"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1499269442, "post_id": 44930698, "comment_id": 76837139, "body": "I&#39;m not sure what you&#39;re asking: are you looking for a library/tool to create native applications with HTML/CSS UI? If so, that&#39;s off-topic for SO. Are you just asking if you can write a cross-platform web server with Go? If so, the answer is yes."}, {"owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1499271172, "post_id": 44930698, "comment_id": 76838269, "body": "Building go code to run on various platforms I know how to do. Question would be about a framework/method to package the go binary and static web resource files into a binary that runs the go service but also includes a &quot;web view&quot; that will be displayed as the apps UI. That would certainly be a question for SO."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1499271520, "post_id": 44930698, "comment_id": 76838509, "body": "No, looking for a framework or package is <a href=\"https://stackoverflow.com/help/on-topic\">specifically not permitted on SO</a>."}, {"owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1499272740, "post_id": 44930698, "comment_id": 76839279, "body": "Still this is just a question, I&#39;m interested in that kind of discussion, feel free not to answer if you are not interested!"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1499273552, "post_id": 44930698, "comment_id": 76839740, "body": "I&#39;m glad you&#39;re interested in that kind of discussion, but it might be more appropriate for Reddit or elsewhere. This question should (and likely will) be closed."}], "answers": [{"comments": [{"owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "edited": false, "score": 0, "creation_date": 1499273033, "post_id": 44931744, "comment_id": 76839453, "body": "So what I would be looking for is then a way to expose the Go functionality to HTML and JavaScript without any HTTP involved and then package those two parts together.  Cordova as far as I understood it will not allow you to integrate against a separate binary right? Maybe I should read up more on that framework."}, {"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "reply_to_user": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "edited": false, "score": 1, "creation_date": 1499273304, "post_id": 44931744, "comment_id": 76839606, "body": "You can use the gomobile tool to make an SDK library, that can be used by a native app. But this method is not available for desktop platforms."}, {"owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "edited": false, "score": 0, "creation_date": 1499279911, "post_id": 44931744, "comment_id": 76843210, "body": "Possibly another could be to convert everything to JavaScript using GopherJS but that would feel like defeating the purpose a bit and will run slower.  Maybe there is no good way right now to do this in a cross platform way with Go (except for creating that kind of library myself)."}], "tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 1, "last_activity_date": 1499284753, "last_edit_date": 1499284753, "creation_date": 1499272786, "answer_id": 44931744, "question_id": 44930698, "link": "https://stackoverflow.com/questions/44930698/can-i-run-a-go-web-server-with-html-javascript-ui-as-a-cross-platform-applicatio/44931744#44931744", "title": "Can I run a Go web server with HTML/JavaScript UI as a cross platform application (Linux, Android, iOS, macOS, Windows)", "body": "<p>All of these platforms have browsers to render web content. Frameworks like Cordova wrap a native app around a browser component (web view). </p>\n\n<p>The missing part is deploying a local go server, that would be the backend of your app. AFAIK, there is no cross platform solution for this yet.</p>\n\n<p>Also, using a server locally violates it's main purposes (serving many clients concurrently, security of remotely stored information).</p>\n"}], "owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "closed_date": 1499276809, "answer_count": 1, "score": -3, "last_activity_date": 1499284753, "creation_date": 1499269328, "question_id": 44930698, "link": "https://stackoverflow.com/questions/44930698/can-i-run-a-go-web-server-with-html-javascript-ui-as-a-cross-platform-applicatio", "closed_reason": "Needs details or clarity", "title": "Can I run a Go web server with HTML/JavaScript UI as a cross platform application (Linux, Android, iOS, macOS, Windows)", "body": "<p>I'm experimenting with Go and as I web developer I want to explore the possibilities of building the same Go web service with the same HTML/JavaScript/CSS UI cross platform for Linux, Android, iOS, macOS, Windows and so on.</p>\n\n<p>I am aware of frameworks such as Electron, Cordova, gomobile but none of them seem to work both with Go and a web UI to generate several of Linux binary, Android APK, Windows exe, macOS dmg, iOS binary (don't know that format yet) without having to code different UIs for different platforms.</p>\n\n<p>Any suggestions on how to solve this?</p>\n"}, {"tags": ["go", "kubernetes", "kubernetes-go-client"], "comments": [{"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1499277272, "post_id": 44930612, "comment_id": 76841762, "body": "Can you point me to the godoc for <code>k8s.io&#47;client-go&#47;pkg&#47;api</code>? I couldn&#39;t find godoc for <code>api.Codecs.UniversalDecoder()</code>. I checked the repo <code>https:&#47;&#47;github.com&#47;kubernetes&#47;client-go&#47;tree&#47;master&#47;pkg</code> no info."}], "answers": [{"tags": [], "owner": {"reputation": 9173, "user_id": 172265, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7d658f2c111ae5d8b48f0f0aa7624372?s=128&d=identicon&r=PG", "display_name": "lang2", "link": "https://stackoverflow.com/users/172265/lang2"}, "is_accepted": false, "score": 5, "last_activity_date": 1499298726, "creation_date": 1499298726, "answer_id": 44937708, "question_id": 44930612, "link": "https://stackoverflow.com/questions/44930612/kubernetes-client-for-go-errors-only-encoded-map-or-array-can-be-decoded-into/44937708#44937708", "title": "Kubernetes client for Go - ERRORS only encoded map or array can be decoded into a struct", "body": "<p>Normally when this happens it means there is something wrong with the definition. In your case the <code>containers</code> should be an array and not an object.</p>\n"}], "owner": {"reputation": 51, "user_id": 7727735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fe8290ed4f46f8fb6052326f8dd8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "vickeyshrestha", "link": "https://stackoverflow.com/users/7727735/vickeyshrestha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2012, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1499298726, "creation_date": 1499269056, "last_edit_date": 1499269344, "question_id": 44930612, "link": "https://stackoverflow.com/questions/44930612/kubernetes-client-for-go-errors-only-encoded-map-or-array-can-be-decoded-into", "title": "Kubernetes client for Go - ERRORS only encoded map or array can be decoded into a struct", "body": "<p>I am trying to update the existing deployments in Openshift using Kubernetes Client for Go. I am using the following JSON to update the replicas to 3:</p>\n\n<p>JSON:</p>\n\n<pre><code>{\n  \"kind\": \"Deployment\",\n  \"spec\": {\n    \"template\": {\n      \"spec\": {\n        \"containers\": {\n          \"image\": \"docker.fmr.com\\/fmr-pr000105\\/testcontainer:1.0.0\",\n          \"name\": \"testcontainer\",\n          \"resources\": {\n            \"requests\": {\n              \"cpu\": \"50m\"\n            },\n            \"limits\": {\n              \"cpu\": \"50m\",\n              \"memory\": \"50M\"\n            }\n          },\n          \"ports\": {\n            \"protocol\": \"TCP\",\n            \"name\": \"test-con-http\",\n            \"containerPort\": 22\n          }\n        }\n      },\n      \"metadata\": {\n        \"labels\": {\n          \"app\": \"testcontainer\"\n        }\n      }\n    },\n    \"replicas\": 3\n  },\n  \"apiVersion\": \"extensions\\/v1beta1\",\n  \"metadata\": {\n    \"name\": \"testcontainer\"\n  }\n}\n</code></pre>\n\n<p>But keep on getting the error:</p>\n\n<pre><code>only encoded map or array can be decoded into a struct\n</code></pre>\n\n<p>I am using the following code :</p>\n\n<pre><code>import (\n\"fmt\"\n\"flag\"\n\"k8s.io/client-go/tools/clientcmd\"\n\"k8s.io/client-go/kubernetes\"\napiv1 \"k8s.io/client-go/pkg/api/v1\"\n\n\"k8s.io/client-go/pkg/api\"\n\"k8s.io/client-go/pkg/apis/extensions\"\n\"k8s.io/client-go/pkg/apis/extensions/v1beta1\"\n\n\"bufio\"\n\"os\"\n\n)\n\nfunc main() {\n    var jsonBody []byte\n    jsonBody = rteMockedUp.GetJsonBody()\n    d := api.Codecs.UniversalDecoder()\n    obj, _, err := d.Decode(jsonBody, nil, nil)\n    if err != nil {\n        log.Fatalf(\"could not decode json: %s\\n%s\", jsonBody, err)\n    }\n    src := obj.(*extensions.Deployment)\n    dst := &amp;v1beta1.Deployment{}\n    err = api.Scheme.Convert(src,dst,0)\n    if err != nil {\n        log.Fatalf(\"failed to convert: %s\", err)\n    }\n    updateStatus, err := deploymentsClient.Update(dst)\n    if err != nil {\n        log.Fatalf(\"Update failed %s\", err)\n    }\n}\n</code></pre>\n\n<p>An error is thrown over here:</p>\n\n<pre><code>obj, _, err := d.Decode(jsonBody, nil, nil)\n</code></pre>\n\n<p>Is there a problem with my JSON?</p>\n"}, {"tags": ["sql", "postgresql", "rest", "go"], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 7095173, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/64e36928c735ec6c0391ac991c9adc05?s=128&d=identicon&r=PG&f=1", "display_name": "hitchnsmile", "link": "https://stackoverflow.com/users/7095173/hitchnsmile"}, "is_accepted": true, "score": 1, "last_activity_date": 1501252939, "creation_date": 1501252939, "answer_id": 45376318, "question_id": 44928638, "link": "https://stackoverflow.com/questions/44928638/how-to-do-joins-in-postgresql-using-ozzo-dbx-package/45376318#45376318", "title": "How to do joins in PostgreSQL using ozzo-dbx package?", "body": "<p>After some digging in dbx package code I have found that it's quite easy:</p>\n\n<pre><code>err := rs.Tx().Select().InnerJoin(\"table2\", dbx.NewExp(\"table2.id = table1.id\").OrderBy(\"name\").Offset(int64(offset)).Limit(int64(limit)).All(&amp;bikes)\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 7095173, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/64e36928c735ec6c0391ac991c9adc05?s=128&d=identicon&r=PG&f=1", "display_name": "hitchnsmile", "link": "https://stackoverflow.com/users/7095173/hitchnsmile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 302, "favorite_count": 0, "accepted_answer_id": 45376318, "answer_count": 1, "score": 1, "last_activity_date": 1501252939, "creation_date": 1499263899, "last_edit_date": 1499267532, "question_id": 44928638, "link": "https://stackoverflow.com/questions/44928638/how-to-do-joins-in-postgresql-using-ozzo-dbx-package", "title": "How to do joins in PostgreSQL using ozzo-dbx package?", "body": "<p>I am creating REST API in Go. And I want on request send the response with data about the object + some subdata about it which is another table. So basically do JOIN between tables.</p>\n\n<p>I am using this package: <code>https://github.com/go-ozzo/ozzo-dbx</code>.</p>\n\n<p>In the documentation, I failed to find JOIN examples. </p>\n\n<p>Could you help me to solve this?</p>\n\n<p>My code:</p>\n\n<p>This does simple <code>SELECT * FROM cars</code></p>\n\n<pre><code>func (dao *BikesDAO) Query(rs app.RequestScope, offset, limit int) ([]models.Bikes, error) {\nbikes := []models.Bikes{}\nerr := rs.Tx().Select().OrderBy(\"name\").Offset(int64(offset)).Limit(int64(limit)).All(&amp;bikes)\nreturn bikes, err\n}\n</code></pre>\n\n<p>My structs:</p>\n\n<pre><code>type Bikes struct {\n  Id                     int     `json:\"id\" db:\"id\"`\n  Name                   string  `json:\"name\" db:\"name\"`\n  Rating                 float64 `json:\"rating\" db:\"rating\"`\n  PriceValue             uint    `json:\"price_value\" db:\"price_value\"`\n  Users                  Users\n}\n\ntype Users struct {\n  Id             string  `json:\"id\" db:\"id\"`\n  Username       string  `json:\"username\" db:\"username\"`\n  Name           string  `json:\"name\" db:\"name\"`\n  Phone          string  `json:\"phone\" db:\"phone\"`\n  Email          string  `json:\"email\" db:\"email\"`\n}\n</code></pre>\n\n<p>With this I want to do <code>SELECT * FROM cars INNER JOIN users ON cars.user_id = users.id</code> and get the following result:</p>\n\n<pre><code>{\n \"id\":12, \n \"name\":\"Toyota\",\n \"rating\":4,\n \"price_value\":4000,\n \"users\": {\n            \"id\":64,\n            \"Username\":\"Tom32\",\n            \"Name\":\"Tom\",\n            \"Phone\":\"325345345\",\n            \"Email\":\"tom@gmail.com\"\n           }\n }\n</code></pre>\n"}, {"tags": ["go", "goland"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1499265730, "post_id": 44928478, "comment_id": 76834243, "body": "All files in the test suite (including the file which defines <code>TestMain</code>) must ends  with <code>*_test.go</code>. Rename it to e.g. <code>main_test.go</code>"}, {"owner": {"reputation": 1236, "user_id": 1221253, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c05edd2a49079a60ee18c6609dc44e10?s=128&d=identicon&r=PG&f=1", "display_name": "Dina", "link": "https://stackoverflow.com/users/1221253/dina"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1499267320, "post_id": 44928478, "comment_id": 76835618, "body": "@putu omg! That must be it. I feel like an idiot now. Will check once I&#39;m near my computer!"}, {"owner": {"reputation": 1236, "user_id": 1221253, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c05edd2a49079a60ee18c6609dc44e10?s=128&d=identicon&r=PG&f=1", "display_name": "Dina", "link": "https://stackoverflow.com/users/1221253/dina"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1499316290, "post_id": 44928478, "comment_id": 76855918, "body": "Yes, indeed that was the thing. Well, at least now I&#39;m sure this will never ever happen to me again."}], "answers": [{"comments": [{"owner": {"reputation": 1236, "user_id": 1221253, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c05edd2a49079a60ee18c6609dc44e10?s=128&d=identicon&r=PG&f=1", "display_name": "Dina", "link": "https://stackoverflow.com/users/1221253/dina"}, "edited": false, "score": 1, "creation_date": 1499264328, "post_id": 44928681, "comment_id": 76833132, "body": "Thanks. I&#39;m not next to my computer now. I&#39;ll try this later. But what about running from command line? I need this to work on TeamCity as well. On TeamCity we use &#39;go test -v path/tests&#39;"}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 1236, "user_id": 1221253, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c05edd2a49079a60ee18c6609dc44e10?s=128&d=identicon&r=PG&f=1", "display_name": "Dina", "link": "https://stackoverflow.com/users/1221253/dina"}, "edited": false, "score": 0, "creation_date": 1499265795, "post_id": 44928681, "comment_id": 76834289, "body": "That&#39;s the difference between running a specific file and a Package (or Directory). In TeamCity, unless you specify all the files manually, that path looks like a directory / package. Go will only run the Test functions in a single file if you specify that file. Please let me know if the configuration change helped or not."}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 0, "last_activity_date": 1499264015, "creation_date": 1499264015, "answer_id": 44928681, "question_id": 44928478, "link": "https://stackoverflow.com/questions/44928478/testmain-not-run/44928681#44928681", "title": "TestMain not run", "body": "<p>Make sure that the run configuration is set to Package not File in Run | Edit Configurations... | Go Test | Name of your configuration and this should work. If it doesn't, please post the commands the IDE runs to execute the tests.</p>\n"}, {"tags": [], "owner": {"reputation": 76, "user_id": 8261044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cda54d8bf5a0407c5ccb3fcb77ac772?s=128&d=identicon&r=PG&f=1", "display_name": "MTvB", "link": "https://stackoverflow.com/users/8261044/mtvb"}, "is_accepted": true, "score": 6, "last_activity_date": 1499280973, "creation_date": 1499280973, "answer_id": 44933999, "question_id": 44928478, "link": "https://stackoverflow.com/questions/44928478/testmain-not-run/44933999#44933999", "title": "TestMain not run", "body": "<p><a href=\"https://golang.org/pkg/testing/#hdr-Main\" rel=\"noreferrer\">TestMain</a> is only executed in test files (suffix <code>_test.go</code>). </p>\n\n<p>Move the function to the repository_test.go file to fix this.</p>\n"}], "owner": {"reputation": 1236, "user_id": 1221253, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c05edd2a49079a60ee18c6609dc44e10?s=128&d=identicon&r=PG&f=1", "display_name": "Dina", "link": "https://stackoverflow.com/users/1221253/dina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2363, "favorite_count": 0, "accepted_answer_id": 44933999, "answer_count": 2, "score": 2, "last_activity_date": 1499280973, "creation_date": 1499263451, "question_id": 44928478, "link": "https://stackoverflow.com/questions/44928478/testmain-not-run", "title": "TestMain not run", "body": "<p>I have a test package in go which tests some stuff that depend on reading a configuration. I want to read that configuration once before running all tests so I'm trying to use <code>TestMain(m *testing.M)</code>:</p>\n\n<p>main.go:</p>\n\n<pre><code>package tests\n\nimport (\n    ...\n)\n\nvar logger = logging.MustGetLogger(\"tests\")\n\nfunc TestMain(m *testing.M) {\n    logger.Info(\"Initializing test suite\")\n\n    viper.SetConfigName(\"config\")\n    viper.AddConfigPath(\"..\\\\..\\\\\")\n    err := viper.ReadInConfig()\n    if err == nil {\n        os.Exit(m.Run())\n    } else {\n        logger.Fatal(\"Could not read configuration\")\n    }\n}\n</code></pre>\n\n<p>And I have another file in the same directory (and package) with a test.</p>\n\n<p>repository_test.go:</p>\n\n<pre><code>package tests\n\nimport (\n    ...\n)\n\nfunc TestCreation(t *testing.T) {\n    aa := myModule.CreateRepository()\n    assert.NotNil(t, aa)\n}\n</code></pre>\n\n<p>My problem is that the test fails because the configuration is not read from the file. When I try to debug the test in Gogland a breakpoint inside <code>TestMain</code> is not hit. When I run the tests from command line I don't see any printouts from <code>TestMain</code>.</p>\n\n<p>Is there something special I should do to make it work? From what I read online I understood that if I define <code>TestMain(m *testing.M)</code> then it's going to run just once for the package and that's where I'm supposed to write any setup or teardown code.</p>\n"}, {"tags": ["mysql", "database", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 3365, "user_id": 4322228, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/388b0e91fd6bb09be4f12dc5a67a992a?s=128&d=identicon&r=PG&f=1", "display_name": "kskyriacou", "link": "https://stackoverflow.com/users/4322228/kskyriacou"}, "is_accepted": true, "score": 6, "last_activity_date": 1499281251, "last_edit_date": 1499281251, "creation_date": 1499280877, "answer_id": 44933965, "question_id": 44928032, "link": "https://stackoverflow.com/questions/44928032/retrieving-many-to-many-results-from-gorm/44933965#44933965", "title": "Retrieving many-to-many results from GORM", "body": "<p>You need to <a href=\"https://godoc.org/github.com/jinzhu/gorm#DB.Preload\" rel=\"noreferrer\">Preload</a> the resources field before querying for services:</p>\n\n<pre><code>services := []model.Service{}\ndb.Preload(\"Resources\").Find(&amp;services) // error checking ommited\n</code></pre>\n\n<p>This correctly populates the <code>Resources</code> field of every service.</p>\n"}], "owner": {"reputation": 3365, "user_id": 4322228, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/388b0e91fd6bb09be4f12dc5a67a992a?s=128&d=identicon&r=PG&f=1", "display_name": "kskyriacou", "link": "https://stackoverflow.com/users/4322228/kskyriacou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2338, "favorite_count": 0, "accepted_answer_id": 44933965, "answer_count": 1, "score": 2, "last_activity_date": 1527757180, "creation_date": 1499262294, "last_edit_date": 1527757180, "question_id": 44928032, "link": "https://stackoverflow.com/questions/44928032/retrieving-many-to-many-results-from-gorm", "title": "Retrieving many-to-many results from GORM", "body": "<p>I am mapping my database using <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">gorm</a>.</p>\n\n<p>I have two tables (<code>service</code> and <code>resource</code>) with a many-to-many relationship. I am modelling them in code as such:</p>\n\n<pre><code>type Service struct {\n    BaseModel\n    Name      string     `gorm:\"not null;unique_index\"`\n    Resources []Resource `gorm:\"many2many:service_resource\"`\n}\n\ntype Resource struct {\n    BaseModel\n    Name string `gorm:\"not null;unique_index\"`\n}\n</code></pre>\n\n<p>Using gorm's <a href=\"https://godoc.org/github.com/jinzhu/gorm#DB.AutoMigrate\" rel=\"nofollow noreferrer\">AutoMigrate</a> the following tables are created:</p>\n\n<p><a href=\"https://i.stack.imgur.com/KeLNt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KeLNt.png\" alt=\"Database diagram m2m\"></a></p>\n\n<p>(I also executed a raw SQL query to add the id primary key in the mapping table.)</p>\n\n<p>To create a new service, I use the following code:</p>\n\n<pre><code>service := Service{\n    Name: \"core\",\n    Resources: []Resource{\n        {Name: \"ec2\"},\n        {Name: \"dynamo\"},\n    },\n}\ndb.Create(&amp;service)\n</code></pre>\n\n<p>This creates all the resources along with the service and fills in the relationship between them in the <code>service_resource</code> table just fine, as expected.</p>\n\n<p>However, my problem is when I'm querying for the services. I use the following code to retrieve all services:</p>\n\n<pre><code>services := []model.Service{}\ndb.Find(&amp;services)\n</code></pre>\n\n<p>This returns successfully with the services array populated, but the <code>Resources</code> array of each service is empty:</p>\n\n<pre><code>\"services\": [\n    {\n        \"ID\": 1,\n        \"Name\": \"core\",\n        \"Resources\": null\n    },\n    ...\n]\n</code></pre>\n\n<p>I was under the assumption that gorm would populate it automatically. Is there some step that I'm missing?</p>\n"}, {"tags": ["go", "wifi", "gopacket"], "answers": [{"tags": [], "owner": {"reputation": 752, "user_id": 7496656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zMGuk.jpg?s=128&g=1", "display_name": "Jan Zerebecki", "link": "https://stackoverflow.com/users/7496656/jan-zerebecki"}, "is_accepted": false, "score": 0, "last_activity_date": 1499688255, "creation_date": 1499688255, "answer_id": 45011548, "question_id": 44927227, "link": "https://stackoverflow.com/questions/44927227/gopacket-parsing-dot11-layer/45011548#45011548", "title": "gopacket parsing Dot11 layer", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/google/gopacket\"\n    \"github.com/google/gopacket/pcap\"\n    \"github.com/google/gopacket/layers\"\n    \"log\"\n)\n\nvar (\n    pcapFile string = \"Network_Join_Nokia_Mobile.pcap\"\n    handle   *pcap.Handle\n    err      error\n)\n\nfunc main() {\n    // Open file instead of device\n    handle, err = pcap.OpenOffline(pcapFile)\n    if err != nil { log.Fatal(err) }\n    defer handle.Close()\n\n    // Loop through packets in file\n    packetSource := gopacket.NewPacketSource(handle, handle.LinkType())\n    for packet := range packetSource.Packets() {\n        fmt.Println(packet.Metadata().CaptureInfo.Timestamp)\n        dot11 := packet.Layer(layers.LayerTypeDot11)\n        if nil != dot11 {\n                dot11, _ := dot11.(*layers.Dot11)\n                // the flags are empty in many of the packets of this example capture file\n                fmt.Printf(\"BSSID: %v Flags: %+v\\n\", dot11.Address3, dot11.Flags)\n        }\n        dot11info := packet.Layer(layers.LayerTypeDot11InformationElement)\n        // some wlan frames contain these with the SSID, usually beacons, probes and association requests\n        if nil != dot11info {\n                dot11info, _ := dot11info.(*layers.Dot11InformationElement)\n                if dot11info.ID == layers.Dot11InformationElementIDSSID {\n                        fmt.Printf(\"SSID: %q\\n\", dot11info.Info)\n                }\n        }\n        fmt.Printf(\"\\n\")\n    }\n}\n</code></pre>\n\n<p>Part of output with <a href=\"https://wiki.wireshark.org/SampleCaptures?action=AttachFile&amp;do=get&amp;target=Network_Join_Nokia_Mobile.pcap\" rel=\"nofollow noreferrer\">example file Network_Join_Nokia_Mobile.pcap from Wireshark</a>:</p>\n\n<pre><code>2000-01-01 00:05:04.913478 +0000 UTC\nBSSID: 00:01:e3:41:bd:6e Flags: Retry\nSSID: \"martinet3\"\n</code></pre>\n\n<p>Note that the capture file you used in your question does not contain a frame with the layer that contains the SSID.</p>\n"}], "owner": {"reputation": 63, "user_id": 1673644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b1c7dee9b10b895d79ceb0afab531027?s=128&d=identicon&r=PG", "display_name": "drd0sPy", "link": "https://stackoverflow.com/users/1673644/drd0spy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1186, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1499695670, "creation_date": 1499260159, "last_edit_date": 1499695670, "question_id": 44927227, "link": "https://stackoverflow.com/questions/44927227/gopacket-parsing-dot11-layer", "title": "gopacket parsing Dot11 layer", "body": "<p>I'm trying to use gopacket to parse the packets of a .pcap file and pretty much to get all the information in it, until now I get either truncated information or an error IF I try to use a filter.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/google/gopacket\"\n    \"github.com/google/gopacket/pcap\"\n    //\"github.com/google/gopacket/layers\"\n    \"log\"\n)\n\nvar (\n    pcapFile string = \"myFile.pcap\"\n    handle   *pcap.Handle\n    err      error\n)\n\nfunc main() {\n    // Open file instead of device\n    handle, err = pcap.OpenOffline(pcapFile)\n    if err != nil { log.Fatal(err) }\n    defer handle.Close()\n\n    // Loop through packets in file\n    packetSource := gopacket.NewPacketSource(handle, handle.LinkType())\n    for packet := range packetSource.Packets() {\n        fmt.Println\n      }\n}\n</code></pre>\n\n<p><strong>This returns:</strong></p>\n\n<pre><code>PACKET: 122 bytes, wire length 122 cap length 122 @ 2017-06-11 02:57:03.133873 +0100 WEST\n- Layer 1 (36 bytes) = RadioTap {Contents=[..36..] Payload=[..86..] Version=0 Length=36 Present=2684370991 TSFT=661956589449 Flags=FCS Rate=1 Mb/s ChannelFrequency=2412 MHz ChannelFlags=CCK,Ghz2 FHSS=0 DBMAntennaSignal=-91 DBMAntennaNoise=0 LockQuality=0 TxAttenuation=0 DBTxAttenuation=0 DBMTxPower=0 Antenna=0 DBAntennaSignal=0 DBAntennaNoise=0 RxFlags= TxFlags= RtsRetries=0 DataRetries=0 MCS= AMPDUStatus=ref#0 VHT=}\n- Layer 2 (24 bytes) = Dot11    {Contents=[..24..] Payload=[..58..] Type=DataQOSData Proto=0 Flags=TO-DS,WEP DurationID=0 Address1=11:22:33:44:55:66 Address2=00:11:22:33:44:55 Address3=11:22:33:44:55:66 Address4= SequenceNumber=0 FragmentNumber=0 Checksum=4262477891}\n- Layer 3 (58 bytes) = Dot11WEP {Contents=[..58..] Payload=[]}\n\nPACKET: 116 bytes, wire length 116 cap length 116 @ 2017-06-11 02:57:03.243457 +0100 WEST\n- Layer 1 (18 bytes) = RadioTap {Contents=[..18..] Payload=[..102..] Version=0 Length=18 Present=18478 TSFT=0 Flags= Rate=1 Mb/s ChannelFrequency=2417 MHz ChannelFlags=CCK,Ghz2 FHSS=0 DBMAntennaSignal=-25 DBMAntennaNoise=0 LockQuality=0 TxAttenuation=0 DBTxAttenuation=0 DBMTxPower=0 Antenna=1 DBAntennaSignal=0 DBAntennaNoise=0 RxFlags= TxFlags= RtsRetries=0 DataRetries=0 MCS= AMPDUStatus=ref#0 VHT=}\n- Layer 2 (24 bytes) = Dot11    {Contents=[..24..] Payload=[..74..] Type=DataQOSData Proto=0 Flags=TO-DS,WEP DurationID=314 Address1=00:11:22:33:44:55 Address2=11:22:33:44:55:66 Address3=00:11:22:33:44:55 Address4= SequenceNumber=0 FragmentNumber=0 Checksum=412506031}\n- Layer 3 (74 bytes) = Dot11WEP {Contents=[..74..] Payload=[]}\n</code></pre>\n\n<p><strong>I would like to see for example the SSID of the packets or more info inside each layer but everytime I try to drill down the items I get:</strong></p>\n\n<pre><code>RadioTap\nDot11\nDot11WEP\nRadioTap\nDot11\nDot11WEP\n</code></pre>\n\n<p><strong>CODE FOR THE ABOVE OUTPUT</strong></p>\n\n<pre><code>package main\n\n\n\nimport (\n    \"fmt\"\n    \"github.com/google/gopacket\"\n    \"github.com/google/gopacket/pcap\"\n    //\"github.com/google/gopacket/layers\"\n    \"log\"\n)\n\nvar (\n    pcapFile string = \"myFile.pcap\"\n    handle   *pcap.Handle\n    err      error\n)\n\nfunc main() {\n    // Open file instead of device\n    handle, err = pcap.OpenOffline(pcapFile)\n    if err != nil { log.Fatal(err) }\n    defer handle.Close()\n\n    // Loop through packets in file\n    packetSource := gopacket.NewPacketSource(handle, handle.LinkType())\n    for packet := range packetSource.Packets() {\n      for _, p := range packet.Layers() {\n        for _, b := range p.LayerType() {\n          fmt.Println(b)\n        }\n      }\n    }\n}\n</code></pre>\n\n<p><strong><em>But in reality I would like to Know the SSID/BSSID and the flags inside the packtet from Dot11 layer.</em></strong></p>\n"}, {"tags": ["string", "postgresql", "go", "prepared-statement"], "comments": [{"owner": {"reputation": 873, "user_id": 307862, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/722274c13fd9a66e3d1fc70dca23c0a7?s=128&d=identicon&r=PG", "display_name": "anthony", "link": "https://stackoverflow.com/users/307862/anthony"}, "edited": false, "score": 1, "creation_date": 1499265137, "post_id": 44925875, "comment_id": 76833772, "body": "<code>QueryRow()</code> usually takes a query string, followed by n parameters. Not sure what <code>&quot;set&quot;</code> is doing. Did you mean to pass <code>theQuery</code>? Something like <code>QueryRow(theQuery,arg1,arg2)</code>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 873, "user_id": 307862, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/722274c13fd9a66e3d1fc70dca23c0a7?s=128&d=identicon&r=PG", "display_name": "anthony", "link": "https://stackoverflow.com/users/307862/anthony"}, "edited": false, "score": 0, "creation_date": 1499270567, "post_id": 44925875, "comment_id": 76837908, "body": "@anthony That is <code>Stmt.QueryRow()</code>, which takes just the args. The statement is already prepared. <a href=\"https://godoc.org/database/sql#Stmt.QueryRow\" rel=\"nofollow noreferrer\">godoc.org/database/sql#Stmt.QueryRow</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1499270738, "post_id": 44925875, "comment_id": 76838023, "body": "You are getting an error because you have two params ($1 and $2) in that statement, but you are only passing one (&quot;set&quot;). Why?"}, {"owner": {"reputation": 599, "user_id": 2417257, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/60113bef0d3c87b2c485ed413b84a34b?s=128&d=identicon&r=PG", "display_name": "Tutompita", "link": "https://stackoverflow.com/users/2417257/tutompita"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1499313867, "post_id": 44925875, "comment_id": 76855332, "body": "@RayfenWindspear Sorry, my mistakes. I write it wrong. Okay, I have edit the question. Actually I just find the solution. I&#39;ll answer it then."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1499315064, "post_id": 44939676, "comment_id": 76855642, "body": "That&#39;s actually very interesting that this fixes it. I wonder what the underlying cause is. Also, if you are using just the bare <code>database&#47;sql</code> package, might I suggest <code>github.com&#47;jmoiron&#47;sqlx</code>. It comes with some extra features which are nice to have. Unless you&#39;d rather not use a third party library."}, {"owner": {"reputation": 599, "user_id": 2417257, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/60113bef0d3c87b2c485ed413b84a34b?s=128&d=identicon&r=PG", "display_name": "Tutompita", "link": "https://stackoverflow.com/users/2417257/tutompita"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1499321846, "post_id": 44939676, "comment_id": 76857921, "body": "I also curious how using <code>$1</code> twice didn&#39;t work. I&#39;ll keep the question open hoping others may know it. Yeah, I&#39;m using <code>database&#47;sql</code> for now, I&#39;m keeping <code>github.com&#47;jmoiron&#47;sqlx</code> for next project though."}], "tags": [], "owner": {"reputation": 599, "user_id": 2417257, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/60113bef0d3c87b2c485ed413b84a34b?s=128&d=identicon&r=PG", "display_name": "Tutompita", "link": "https://stackoverflow.com/users/2417257/tutompita"}, "is_accepted": false, "score": 1, "last_activity_date": 1499314196, "creation_date": 1499314196, "answer_id": 44939676, "question_id": 44925875, "link": "https://stackoverflow.com/questions/44925875/passing-string-to-prepared-statement-in-golang/44939676#44939676", "title": "Passing String to Prepared Statement in Golang", "body": "<p>So, I just find the solution. Instead of using <code>$1</code> twice, the prepared statement will received 3 arguments:</p>\n\n<pre><code>var theQuery = `UPDATE process SET status=$1 WHERE status!=$2 AND id=$3 RETURNING id`\n</code></pre>\n\n<p>Then, I call the prepared statement like this.</p>\n\n<pre><code>status := \"set\"\nerr = statement.QueryRow(status, status, 12).Scan(&amp;id)\n</code></pre>\n\n<p>I know maybe this is not the best approach to solve the problem. But it worked for me.</p>\n"}], "owner": {"reputation": 599, "user_id": 2417257, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/60113bef0d3c87b2c485ed413b84a34b?s=128&d=identicon&r=PG", "display_name": "Tutompita", "link": "https://stackoverflow.com/users/2417257/tutompita"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 788, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1499314196, "creation_date": 1499256564, "last_edit_date": 1499313714, "question_id": 44925875, "link": "https://stackoverflow.com/questions/44925875/passing-string-to-prepared-statement-in-golang", "title": "Passing String to Prepared Statement in Golang", "body": "<p>The idea is I want to update the <code>status</code> and returning the id only if the <code>status</code> is different.</p>\n\n<p>So, I have a prepared statement like this:</p>\n\n<pre><code>var theQuery = `UPDATE process SET status=$1 WHERE status!=$1 AND id=$2 RETURNING id`\n</code></pre>\n\n<p>Then, I called it with this:</p>\n\n<pre><code>err = statement.QueryRow(\"set\", 12).Scan(&amp;id)\n</code></pre>\n\n<p>Then there is an error appear like this.</p>\n\n<pre><code>runtime error: invalid memory address or nil pointer dereference\n</code></pre>\n\n<p>When I tried:</p>\n\n<pre><code>var theQuery = `UPDATE process SET status='$1' WHERE status!='$1' AND id=$2 RETURNING id`\n</code></pre>\n\n<p>It runs. Then, when I run it again, I am expecting to get <code>no rows</code>, but it still returning the id. It looked like it still updating the rows and ignored the <code>status!='$1'</code> part.</p>\n\n<p>Thank you</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 1114, "user_id": 2121494, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9oGSP.png?s=128&g=1", "display_name": "euthimis87", "link": "https://stackoverflow.com/users/2121494/euthimis87"}, "is_accepted": true, "score": 2, "last_activity_date": 1518697067, "creation_date": 1518697067, "answer_id": 48807117, "question_id": 44924692, "link": "https://stackoverflow.com/questions/44924692/gorm-golang-one2many-same-table/48807117#48807117", "title": "gorm golang one2many same table", "body": "<p>Fortunately gorm have added lately this feature (reference: <a href=\"http://gorm.io/docs/many_to_many.html#Self-Referencing\" rel=\"nofollow noreferrer\">here</a>).</p>\n\n<p>In your case should be like this:</p>\n\n<pre><code>type Person struct {\n  gorm.Model\n  Name string\n  Children []*Person `gorm:\"many2many: children;association_jointable_foreignkey:children_id\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 996, "user_id": 1478734, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e7e6165d9ee3338be3582313ec6648ba?s=128&d=identicon&r=PG", "display_name": "ehrt1974", "link": "https://stackoverflow.com/users/1478734/ehrt1974"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1198, "favorite_count": 0, "accepted_answer_id": 48807117, "answer_count": 1, "score": 0, "last_activity_date": 1518697067, "creation_date": 1499253208, "last_edit_date": 1499253730, "question_id": 44924692, "link": "https://stackoverflow.com/questions/44924692/gorm-golang-one2many-same-table", "title": "gorm golang one2many same table", "body": "<p>I'm trying to create a self-reference in a (my)sql table using golang gorm. At the moment my code looks like this:</p>\n\n<pre><code>type Person struct {\n    gorm.Model\n    Name string\n    Children []*Person `gorm:\"ForeignKey:ParentID\"`\n    ParentID uint\n}\n\nfunc main() {\n    /* code to get database connection omitted */\n\n    p := &amp;Person{Name:\"Sally\"}\n    db.Create(p)\n\n    children := []*Person{ {Name:\"Jane\", ParentID:p.ID},\n        {Name:\"Tom\", ParentID:p.ID}}\n\n    for _, child := range children {\n        db.Create(child)\n    }\n\n    var children2 []*Person\n\n    db.Model(p).Related(children2, \"ParentID\")\n}\n</code></pre>\n\n<p>The code is failing with an error \"reflect.Value.Set using unaddressable value\".</p>\n\n<p>Does anybody know how to get this relationship working using go gorm?</p>\n\n<p>Many thanks in advance :)</p>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1499256661, "post_id": 44924628, "comment_id": 76827089, "body": "Probably the 50th duplicate."}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1499260120, "post_id": 44924628, "comment_id": 76829877, "body": "@Volker For the time.Parse layout, oh yes. But maybe not on parsing a clock to duration."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "edited": false, "score": 0, "creation_date": 1499277572, "post_id": 44924628, "comment_id": 76841922, "body": "@ANisus &quot;04:10 PM&quot; ist <i>not</i> a &quot;clock duration&quot; (for whatever definition of duration)."}], "answers": [{"comments": [{"owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "edited": false, "score": 0, "creation_date": 1499254909, "post_id": 44925159, "comment_id": 76825800, "body": "<code>15:04 PM</code> is strange way to write that time, although it seems to work. <code>03:04 PM</code> would seem more normal."}, {"owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "edited": false, "score": 0, "creation_date": 1499254927, "post_id": 44925159, "comment_id": 76825812, "body": "oh, you just fixed it :)"}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "reply_to_user": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "edited": false, "score": 0, "creation_date": 1499255059, "post_id": 44925159, "comment_id": 76825913, "body": "@jussius Ah, yes :) . I noticed my mistake. In my country we use hh:mm format."}, {"owner": {"reputation": 2724, "user_id": 354007, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/6c577241666b544e9fa19d9a013f964c?s=128&d=identicon&r=PG", "display_name": "IrishGringo", "link": "https://stackoverflow.com/users/354007/irishgringo"}, "edited": false, "score": 0, "creation_date": 1499439829, "post_id": 44925159, "comment_id": 76923140, "body": "Thanks for the code example... Question...  why &quot;03:04 PM&quot;, Why PM, and Why does my result change when I change PM to AM?"}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "reply_to_user": {"reputation": 2724, "user_id": 354007, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/6c577241666b544e9fa19d9a013f964c?s=128&d=identicon&r=PG", "display_name": "IrishGringo", "link": "https://stackoverflow.com/users/354007/irishgringo"}, "edited": false, "score": 1, "creation_date": 1500273783, "post_id": 44925159, "comment_id": 77244207, "body": "@IrishGringo: It is because Go uses a different way of defining layout. Instead of using placeholders like <code>hh</code> and <code>mm</code> (which is the common way to write time format layouts in other languages), Go uses a <i>reference date</i>; to be more exact <code>Mon Jan 2 15:04:05 -0700 MST 2006</code>. Type out that <i>specific</i> date and timezone in the way you want it to be displayed, and you have your layout string! The <i>reference date</i> is always 3:04 PM (15:04), never AM (03:04). It is always MST, never GMT. Always monday, never tuesday. And so on."}], "tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": false, "score": 6, "last_activity_date": 1499255161, "last_edit_date": 1499255161, "creation_date": 1499254613, "answer_id": 44925159, "question_id": 44924628, "link": "https://stackoverflow.com/questions/44924628/golang-time-parse-1122-pm-something-that-i-can-do-math-with/44925159#44925159", "title": "golang, time.Parse ( &quot;11:22 PM&quot; ) something that I can do math with", "body": "<p>The layout string for <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"noreferrer\"><code>time.Parse</code></a> does not handle the <code>\"hh:mm\"</code> format. In your case, the layout string would rather be <code>\"03:04 PM\"</code> as you can see in <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"noreferrer\">the documentation</a>.</p>\n\n<p>To get a <code>time.Duration</code> after parsing the string, you can substract your time with a reference time, in your case I would assume <code>\"12:00 AM\"</code>.</p>\n\n<p><strong>Working example:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    ref, _ := time.Parse(\"03:04 PM\", \"12:00 AM\")\n    t, err := time.Parse(\"03:04 PM\", \"11:22 PM\")\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(t.Sub(ref).Seconds())\n}\n</code></pre>\n\n<p><strong>Output:</strong></p>\n\n<blockquote>\n  <p>84120</p>\n</blockquote>\n\n<p><a href=\"https://play.golang.org/p/IKWPYAjHhQ\" rel=\"noreferrer\">Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "is_accepted": false, "score": 2, "last_activity_date": 1499254729, "creation_date": 1499254729, "answer_id": 44925195, "question_id": 44924628, "link": "https://stackoverflow.com/questions/44924628/golang-time-parse-1122-pm-something-that-i-can-do-math-with/44925195#44925195", "title": "golang, time.Parse ( &quot;11:22 PM&quot; ) something that I can do math with", "body": "<p>Did you read the documentation of time.Parse? In the very beginning it says:</p>\n\n<blockquote>\n  <p>The layout defines the format by showing how the reference time,\n  defined to be <code>Mon Jan 2 15:04:05 -0700 MST 2006</code> would be interpreted\n  if it were the value</p>\n</blockquote>\n\n<p>In the beginning of the package documentation there are more details about the layout string. Note that you can omit some of the fields (in your case days, years and timezeone) and those will then always get zero value.</p>\n\n<p>So <code>fmt.Println(time.Parse(\"3:04 PM\", \"07:50 PM\"))</code> should work.</p>\n"}, {"tags": [], "owner": {"reputation": 303, "user_id": 8008395, "user_type": "registered", "profile_image": "https://graph.facebook.com/1019408758194319/picture?type=large", "display_name": "Bohdan Kostko", "link": "https://stackoverflow.com/users/8008395/bohdan-kostko"}, "is_accepted": false, "score": 0, "last_activity_date": 1499254753, "creation_date": 1499254753, "answer_id": 44925199, "question_id": 44924628, "link": "https://stackoverflow.com/questions/44924628/golang-time-parse-1122-pm-something-that-i-can-do-math-with/44925199#44925199", "title": "golang, time.Parse ( &quot;11:22 PM&quot; ) something that I can do math with", "body": "<p>If you'll check again the documentation about time's <code>Parse</code> method you'll find the fact that Go's approach of parsing the time is totally different then the one that you used to work with in other languages. To provide the <code>Parse</code> function the layout of the time that you want to parse you need to transform one specific date (which is <code>Mon Jan 2 15:04:05 -0700 MST 2006</code>) into the layout that you're providing. In your case that would be \"03:04 PM\".</p>\n\n<p>The full code: <code>fmt.Println(time.Parse(\"03:04 PM\", m.Feed.Entry[i].GsxA100Time.T))</code></p>\n"}, {"tags": [], "owner": {"reputation": 2159, "user_id": 6183182, "user_type": "registered", "accept_rate": 30, "profile_image": "https://lh6.googleusercontent.com/-XSZxct_alBc/AAAAAAAAAAI/AAAAAAAAAgw/l470-GF6nW0/photo.jpg?sz=128", "display_name": "swayamraina", "link": "https://stackoverflow.com/users/6183182/swayamraina"}, "is_accepted": false, "score": 0, "last_activity_date": 1614335246, "creation_date": 1614335246, "answer_id": 66384064, "question_id": 44924628, "link": "https://stackoverflow.com/questions/44924628/golang-time-parse-1122-pm-something-that-i-can-do-math-with/66384064#66384064", "title": "golang, time.Parse ( &quot;11:22 PM&quot; ) something that I can do math with", "body": "<p>Just in case anyone is working with epoch times can use this,</p>\n<pre><code>func convert (in int64) string {\n    u := time.Unix(in/1000, in%1000)\n    ampm := &quot;AM&quot;\n    if u.Hour()/12 ==1 { ampm = &quot;PM&quot; }\n    th := u.Hour()%12\n    hh := strconv.Itoa(th)\n    if th &lt; 10 { hh = &quot;0&quot; + hh }\n    tm := u.Minute()\n    mm := strconv.Itoa(tm)\n    if tm &lt; 10 { mm = &quot;0&quot; + mm }\n    return hh + &quot;:&quot; + mm + &quot; &quot; + ampm\n}\n</code></pre>\n"}], "owner": {"reputation": 2724, "user_id": 354007, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/6c577241666b544e9fa19d9a013f964c?s=128&d=identicon&r=PG", "display_name": "IrishGringo", "link": "https://stackoverflow.com/users/354007/irishgringo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4148, "favorite_count": 0, "answer_count": 4, "score": 4, "last_activity_date": 1614335246, "creation_date": 1499253045, "last_edit_date": 1499255016, "question_id": 44924628, "link": "https://stackoverflow.com/questions/44924628/golang-time-parse-1122-pm-something-that-i-can-do-math-with", "title": "golang, time.Parse ( &quot;11:22 PM&quot; ) something that I can do math with", "body": "<p>I am importing a lot of fields of the format:</p>\n\n<p>09:02 AM<br>\n10:02 AM<br>\n12:30 PM<br>\n04:10 PM<br>\n04:50 PM<br>\n05:30 PM </p>\n\n<p>I would like to convert the fields into something I can do arithmetic on. For example, do a count down to when the event Occurs.  Thus, saving the field in microseconds... or even seconds.\nI have been trying to get the time.Parse to work...   no joy.</p>\n\n<pre><code>fmt.Println(time.Parse(\"hh:mm\", m.Feed.Entry[i].GsxA100Time.T))\n</code></pre>\n\n<p>returns...</p>\n\n<blockquote>\n  <p>0001-01-01 00:00:00 +0000 UTC parsing time \"07:50 PM\" as \"hh:mm\": cannot parse \"07:50 PM\" as \"hh:mm\"</p>\n</blockquote>\n\n<p>any suggestions?</p>\n"}, {"tags": ["go", "lambda", "closures", "dry"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1499249958, "post_id": 44923323, "comment_id": 76822349, "body": "In your examples, each method unconditionally calls itself, isn&#39;t that an endless &quot;recursion&quot;?"}, {"owner": {"reputation": 7265, "user_id": 3457177, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bae2e85ed6794ece744ee124d9ac7842?s=128&d=identicon&r=PG&f=1", "display_name": "Vitalii", "link": "https://stackoverflow.com/users/3457177/vitalii"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1499253853, "post_id": 44923323, "comment_id": 76825064, "body": "Good remark. I simplified it a lot. In fact it calls some internal layer. <code>s.internalLayer.CheckUser(i)</code> Corrected."}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 1, "last_activity_date": 1499251912, "creation_date": 1499251912, "answer_id": 44924219, "question_id": 44923323, "link": "https://stackoverflow.com/questions/44923323/something-like-lambda-expressions-in-go-merge-similar-methods/44924219#44924219", "title": "Something like lambda expressions in Go (merge similar methods)", "body": "<p>You can DRY it using closures:</p>\n\n<pre><code>func GetUser2(i int, s string) (*User, error) {\n    var u *User\n    err := do(func() error {\n        var err error\n        u, err = getUser(i, s)\n        return err\n    })\n    return u, err\n}\n\nfunc CheckUser2(i int) (bool, error) {\n    var b bool\n    err := do(func() error {\n        var err error\n        b, err = checkUser(i)\n        return err\n    })\n    return b, err\n}\n\nfunc do(f func() error) error {\n    CommonMethod1()\n    CommonMethod2()\n\n    err := f()\n    if err != nil {\n        CommonMethod3()\n    }\n    return err\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1499254991, "last_edit_date": 1499254991, "creation_date": 1499254609, "answer_id": 44925158, "question_id": 44923323, "link": "https://stackoverflow.com/questions/44923323/something-like-lambda-expressions-in-go-merge-similar-methods/44925158#44925158", "title": "Something like lambda expressions in Go (merge similar methods)", "body": "<p>If <code>CommonMethod1()</code> and <code>CommonMethod2()</code> calls do not have to precede the calls to the internal layer, basically they can be incorporated into a check function, and you don't even need closures or function values (there's also no need to return the passed error from <code>check()</code>):</p>\n\n<pre><code>func (s *service) GetUser(i int, s string) (*SomeObject, error) {\n    user, err := s.internalLayer.GetUser(i, s)\n    check(err)\n    return user, err\n}\n\nfunc (s *service) CheckUser(i int) (bool, error) {\n    exists, err := s.internalLayer.CheckUser(i)\n    check(err)\n    return exists, err\n}\n\nfunc check(err error) {\n    CommonMethod1()\n    CommonMethod2()\n    if err != nil {\n        CommonMethod3()\n    }\n}\n</code></pre>\n\n<p>If <code>CommonMethod1()</code> and <code>CommonMethod2()</code> calls must precede the calls to the internal layer, then you may use closures, but using <a href=\"https://golang.org/ref/spec#Function_types\" rel=\"nofollow noreferrer\">named result parameters</a> simplifies the code, and again, it's unnecessary to return the error from the common function:</p>\n\n<pre><code>func (s *service) GetUser(i int, s string) (user *SomeObject, err error) {\n    do(func() error {\n        user, err = s.internalLayer.GetUser(i, s)\n        return err\n    })\n    return\n}\n\nfunc (s *service) CheckUser(i int) (exists bool, err error) {\n    do(func() error {\n        exists, err = s.internalLayer.CheckUser(i)\n        return err\n    })\n    return\n}\n\nfunc do(f func() error) {\n    CommonMethod1()\n    CommonMethod2()\n\n    if err := f(); err != nil {\n        CommonMethod3()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 7265, "user_id": 3457177, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bae2e85ed6794ece744ee124d9ac7842?s=128&d=identicon&r=PG&f=1", "display_name": "Vitalii", "link": "https://stackoverflow.com/users/3457177/vitalii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 44924219, "answer_count": 2, "score": 2, "last_activity_date": 1499255103, "creation_date": 1499249694, "last_edit_date": 1499255103, "question_id": 44923323, "link": "https://stackoverflow.com/questions/44923323/something-like-lambda-expressions-in-go-merge-similar-methods", "title": "Something like lambda expressions in Go (merge similar methods)", "body": "<p>I have a struct in Go which has more than ten methods. And all of them are almost the same. In fact, the difference is only in one line.</p>\n\n<p>Let's see the simplified example. Here is the first method:</p>\n\n<pre><code>func (s *service) GetUser(i int, s string) (*SomeObject, error) {\n    CommonMethod1()\n    CommonMethod2()\n\n    user, err := s.internalLayer.GetUser(i, s)\n\n    if err != nil {\n        CommonMethod3()\n    }\n    return user, err\n}\n</code></pre>\n\n<p>And the second one:</p>\n\n<pre><code>func (s *service) CheckUser(i int) (bool, error) {\n    CommonMethod1()\n    CommonMethod2()\n\n    exists, err := s.internalLayer.CheckUser(i)\n\n    if err != nil {\n        CommonMethod3()\n    }\n    return exists, err\n}\n</code></pre>\n\n<p>And there are almost 10 others with a lot of copy and paste. I'd like to ameliorate this code and the idea is to create some common method that I'll call everywhere.</p>\n\n<p>It should</p>\n\n<ul>\n<li>call <code>CommonMethod1()</code></li>\n<li>call <code>CommonMethod2()</code></li>\n<li>call some method that I pass to it in the parameter</li>\n<li>call <code>CommonMethod3()</code> in case of error</li>\n<li>return parameters</li>\n</ul>\n\n<p>Can you tell me if it's possible to implement in Go such common method? </p>\n\n<pre><code>user, err := s.GetUser(i, s)\nexists, err := s.CheckUser(i)\n</code></pre>\n\n<p>Has different parameters count and different return types.</p>\n"}, {"tags": ["qt", "go", "jetbrains-ide", "goland"], "comments": [{"owner": {"reputation": 3514, "user_id": 2612002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/b5a04.png?s=128&g=1", "display_name": "iehrlich", "link": "https://stackoverflow.com/users/2612002/iehrlich"}, "edited": false, "score": 1, "creation_date": 1499245506, "post_id": 44921623, "comment_id": 76818888, "body": "What does it have to do with <code>C++</code>?"}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1499246722, "post_id": 44921623, "comment_id": 76819893, "body": "The GOPATH seems to be incorrectly configured as well as the project seems to be in the wrong place. The project GOPATH should be removed and the project should be created under /home/batis/gocode/src/your/project/path. Then, make sure you have the dependency under /home/batis/gocode/src/github.com/therecipe/qt"}, {"owner": {"reputation": 388, "user_id": 8052603, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EvYNCEagJqM/AAAAAAAAAAI/AAAAAAAAA-U/u7Ty5gFe6bA/photo.jpg?sz=128", "display_name": "Sergey Andrianov", "link": "https://stackoverflow.com/users/8052603/sergey-andrianov"}, "reply_to_user": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1499249881, "post_id": 44921623, "comment_id": 76822288, "body": "@dlsniper Moved the project to /home/batis/gocode/src/batis/Qt. Problem still exists. Tell me please how you can check the dependencies."}, {"owner": {"reputation": 388, "user_id": 8052603, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EvYNCEagJqM/AAAAAAAAAAI/AAAAAAAAA-U/u7Ty5gFe6bA/photo.jpg?sz=128", "display_name": "Sergey Andrianov", "link": "https://stackoverflow.com/users/8052603/sergey-andrianov"}, "edited": false, "score": 0, "creation_date": 1499250746, "post_id": 44921623, "comment_id": 76822908, "body": "project GOPATH deleted."}], "answers": [{"tags": [], "owner": {"reputation": 509, "user_id": 5462132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42bf54b25a6c3789897fc4b008aeaac1?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Zolotov", "link": "https://stackoverflow.com/users/5462132/alexander-zolotov"}, "is_accepted": true, "score": 8, "last_activity_date": 1499254494, "creation_date": 1499254494, "answer_id": 44925130, "question_id": 44921623, "link": "https://stackoverflow.com/questions/44921623/valid-methods-in-being-highlighted-in-red-unresolved-reference/44925130#44925130", "title": "Valid methods in being highlighted in red &#39;Unresolved Reference&#39;", "body": "<p>The methods are defined in a big generated file that is not indexed by Gogland. To change the limit you should change <a href=\"https://intellij-support.jetbrains.com/hc/en-us/articles/206544869-Configuring-JVM-options-and-platform-properties\" rel=\"noreferrer\"><code>idea.max.intellisense.filesize</code></a>.</p>\n\n<p>To do this, open custom properties file via <code>Help | Edit Custom Properties</code> menu and add something like this: <code>idea.max.intellisense.filesize=4500</code> for 4.5 MB limit. The size is in Kilobytes.</p>\n\n<p>Please use carefully, indexing large files may influence index update speed dramatically.</p>\n"}, {"comments": [{"owner": {"reputation": 1713, "user_id": 243831, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11f7be0cc892437ea95733a3ecdc9398?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/243831/mark"}, "edited": false, "score": 1, "creation_date": 1586790357, "post_id": 53605552, "comment_id": 108249953, "body": "This sorted me out after updating to 2020.1."}, {"owner": {"reputation": 161, "user_id": 4907070, "user_type": "registered", "profile_image": "https://graph.facebook.com/562550880554418/picture?type=large", "display_name": "Abiral", "link": "https://stackoverflow.com/users/4907070/abiral"}, "edited": false, "score": 4, "creation_date": 1587663796, "post_id": 53605552, "comment_id": 108607297, "body": "The option is present at :  Files &gt; Settings (Preferences) &gt; Go &gt; GOPATH"}], "tags": [], "owner": {"reputation": 612, "user_id": 5679246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/979dd4cb6efdef48f055d51bc144ef3e?s=128&d=identicon&r=PG&f=1", "display_name": "ataboo", "link": "https://stackoverflow.com/users/5679246/ataboo"}, "is_accepted": false, "score": 31, "last_activity_date": 1594233014, "last_edit_date": 1594233014, "creation_date": 1543896539, "answer_id": 53605552, "question_id": 44921623, "link": "https://stackoverflow.com/questions/44921623/valid-methods-in-being-highlighted-in-red-unresolved-reference/53605552#53605552", "title": "Valid methods in being highlighted in red &#39;Unresolved Reference&#39;", "body": "<p>Ran into this recently with a project in 'bitbucket.org' GOPATH not finding ones in 'github.com'.  Checked the &quot;Index entire GOPATH&quot; box and it fixed it.</p>\n<p>This option is present at: Files &gt; Settings (Preferences) &gt; Go &gt; GOPATH</p>\n"}, {"comments": [{"owner": {"reputation": 18142, "user_id": 1515819, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c7d0a1373a2312378f6563acf2a8f937?s=128&d=identicon&r=PG&f=1", "display_name": "St&#233;phane Bruckert", "link": "https://stackoverflow.com/users/1515819/st%c3%a9phane-bruckert"}, "edited": false, "score": 0, "creation_date": 1595843580, "post_id": 59142169, "comment_id": 111604017, "body": "what if this happens for 100 files?"}, {"owner": {"reputation": 902, "user_id": 2741745, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KvxU5.jpg?s=128&g=1", "display_name": "Eric Alford", "link": "https://stackoverflow.com/users/2741745/eric-alford"}, "edited": false, "score": 0, "creation_date": 1613158126, "post_id": 59142169, "comment_id": 116999555, "body": "This was the only thing that worked for me after trying the other avenues. Restarting didn&#39;t even work."}], "tags": [], "owner": {"reputation": 357, "user_id": 1461333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e22507765e19c12febc06a97816c8632?s=128&d=identicon&r=PG&f=1", "display_name": "Schparky", "link": "https://stackoverflow.com/users/1461333/schparky"}, "is_accepted": false, "score": 2, "last_activity_date": 1575300941, "creation_date": 1575300941, "answer_id": 59142169, "question_id": 44921623, "link": "https://stackoverflow.com/questions/44921623/valid-methods-in-being-highlighted-in-red-unresolved-reference/59142169#59142169", "title": "Valid methods in being highlighted in red &#39;Unresolved Reference&#39;", "body": "<p>Possibly not valid for the original context, but the workaround I discovered is to rename the file where the method or other identifier is defined, allow Goland to reindex, and then rename it back to the original name.</p>\n"}, {"tags": [], "owner": {"reputation": 18142, "user_id": 1515819, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c7d0a1373a2312378f6563acf2a8f937?s=128&d=identicon&r=PG&f=1", "display_name": "St&#233;phane Bruckert", "link": "https://stackoverflow.com/users/1515819/st%c3%a9phane-bruckert"}, "is_accepted": false, "score": 0, "last_activity_date": 1600246245, "creation_date": 1600246245, "answer_id": 63916474, "question_id": 44921623, "link": "https://stackoverflow.com/questions/44921623/valid-methods-in-being-highlighted-in-red-unresolved-reference/63916474#63916474", "title": "Valid methods in being highlighted in red &#39;Unresolved Reference&#39;", "body": "<p>This can also happen if <code>go.mod</code> is copied from another project without updating the project name:</p>\n<pre><code>// go.mod\n\nmodule github.com/org/new-project\n\ngo 1.15\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 8179458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f87c45af42f37afa3ac34fa2e0185d7?s=128&d=identicon&r=PG&f=1", "display_name": "Dmitry Rog", "link": "https://stackoverflow.com/users/8179458/dmitry-rog"}, "is_accepted": false, "score": 0, "last_activity_date": 1614505796, "creation_date": 1614505796, "answer_id": 66407763, "question_id": 44921623, "link": "https://stackoverflow.com/questions/44921623/valid-methods-in-being-highlighted-in-red-unresolved-reference/66407763#66407763", "title": "Valid methods in being highlighted in red &#39;Unresolved Reference&#39;", "body": "<p>For me, it was that I had GOPATH set to 1.15 but GOROOT set to 1.14, so you need to set them to the same version. You can find these settings in Preferences -&gt; Go -&gt; GOROOT or GOPATH.</p>\n<p>I use gvm - Go Version Manager, that's why I have multiple Go versions in my system.</p>\n"}, {"tags": [], "owner": {"reputation": 647, "user_id": 1540415, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a193205987f1f85cb1bbfadd9907dca4?s=128&d=identicon&r=PG", "display_name": "Siraf", "link": "https://stackoverflow.com/users/1540415/siraf"}, "is_accepted": false, "score": 0, "last_activity_date": 1619004355, "creation_date": 1619004355, "answer_id": 67194933, "question_id": 44921623, "link": "https://stackoverflow.com/questions/44921623/valid-methods-in-being-highlighted-in-red-unresolved-reference/67194933#67194933", "title": "Valid methods in being highlighted in red &#39;Unresolved Reference&#39;", "body": "<p>I had the same issue with Goland 2021.1 on Windows 10 with go SDK 1.13. I solved the problem by installing the latest go version 1.16.3 side by side to version 1.13 that I need for my projects.\nIt turned out that my Windows 10 OS was patched with security updates that are not compliant with GoLand 2021.1 and SDK 1.13</p>\n"}], "owner": {"reputation": 388, "user_id": 8052603, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EvYNCEagJqM/AAAAAAAAAAI/AAAAAAAAA-U/u7Ty5gFe6bA/photo.jpg?sz=128", "display_name": "Sergey Andrianov", "link": "https://stackoverflow.com/users/8052603/sergey-andrianov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8354, "favorite_count": 2, "accepted_answer_id": 44925130, "answer_count": 6, "score": 12, "last_activity_date": 1619004355, "creation_date": 1499245404, "last_edit_date": 1499248811, "question_id": 44921623, "link": "https://stackoverflow.com/questions/44921623/valid-methods-in-being-highlighted-in-red-unresolved-reference", "title": "Valid methods in being highlighted in red &#39;Unresolved Reference&#39;", "body": "<p>How to solve this problem? The program works. But the methods in Gogland are highlighted in red. Qt version 5.8 is added.</p>\n\n<pre><code>Gogland (1.0 Preview) 1.0 EAP\nBuild #GO-171.4694.61, built on June 27, 2017\nGogland EAP User\nExpiration date: September 25, 2017\nJRE: 1.8.0_112-release-736-b21 amd64\nJVM: OpenJDK 64-Bit Server VM by JetBrains s.r.o\nLinux 4.8.0-58-generic\n\n\nbatis@dev:~$ printenv | grep GO\nGOROOT=/usr/lib/go-1.8/\nGOPATH=/home/batis/gocode/\n\npackage main\n\nimport (\n    \"os\"\n    \"github.com/therecipe/qt/widgets\"\n)\n\nfunc main() {\n    widgets.NewQApplication(len(os.Args), os.Args)\n\n    //create a window\n    window := widgets.NewQMainWindow(nil, 0)\n\n    ......\n\n    widgets.QApplication_Exec()\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/Z8jd1.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/Z8jd1.png\" alt=\"Some image\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/rrAkA.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/rrAkA.png\" alt=\"GOPATH\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/Crf4d.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/Crf4d.png\" alt=\"Some image\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/nmbsp.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/nmbsp.png\" alt=\"Test run OK!\"></a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1499253138, "post_id": 44921193, "comment_id": 76824609, "body": "Please google &quot;what every computer scientist should know about floating-point arithmetic&quot; and keep a copy for reference."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1499261265, "post_id": 44921193, "comment_id": 76830718, "body": "<code>7&#47;23</code> or <code>sqrt(2)</code> also &quot;seem&quot; small enough to fit into 32 bit floats, but neither of those is going to give you a nice even result either."}], "answers": [{"comments": [{"owner": {"reputation": 4379, "user_id": 184176, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/811251725188ac87f9125177073c28d0?s=128&d=identicon&r=PG", "display_name": "sepehr", "link": "https://stackoverflow.com/users/184176/sepehr"}, "edited": false, "score": 0, "creation_date": 1499246858, "post_id": 44921845, "comment_id": 76820005, "body": "Still it&#39;s not clear to me the reason, maybe you can elaborate which part of wikipedia page can explain this behavior?"}, {"owner": {"reputation": 4379, "user_id": 184176, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/811251725188ac87f9125177073c28d0?s=128&d=identicon&r=PG", "display_name": "sepehr", "link": "https://stackoverflow.com/users/184176/sepehr"}, "edited": false, "score": 0, "creation_date": 1499308912, "post_id": 44921845, "comment_id": 76854149, "body": "Thanks @mattn for through explanation. I have one question: <code>float64(6301000)*float64(0.035)</code> results in <code>220535.00000000003</code> but I expect <code>220535</code>, if I use <code>float32(X)</code> on final result it gives the correct value, but since the float64 uses more bytes shouldn&#39;t it be safe to use it in arithmetic calculations?"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 4379, "user_id": 184176, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/811251725188ac87f9125177073c28d0?s=128&d=identicon&r=PG", "display_name": "sepehr", "link": "https://stackoverflow.com/users/184176/sepehr"}, "edited": false, "score": 1, "creation_date": 1499312515, "post_id": 44921845, "comment_id": 76855022, "body": "yes, this will occur even though using 64bit. but precision is better than 32bit."}], "tags": [], "owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "is_accepted": true, "score": 4, "last_activity_date": 1499249575, "last_edit_date": 1499249575, "creation_date": 1499245973, "answer_id": 44921845, "question_id": 44921193, "link": "https://stackoverflow.com/questions/44921193/golang-strconv-parsefloat-fails-to-parse-the-string-correctly-when-using-32-for/44921845#44921845", "title": "Golang strconv.ParseFloat fails to parse the string correctly when using 32 for bitSize parameter", "body": "<p>It is precision issue of 32bit variable. This is not an issue of Go. See following URLs.</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/IEEE_754\" rel=\"nofollow noreferrer\">IEEE 754 - Wikipedia</a></p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Single-precision_floating-point_format\" rel=\"nofollow noreferrer\">Single-precision floating-point format - Wikipedia</a></p>\n\n<p>You will understand what happen with 1.59 in this C code.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint\nmain(int argc, char* argv[]) {\n  float f = 1.59;\n  if (f == 1.59) {\n    puts(\"float: equal!\");\n  } else {\n    puts(\"float: not equal!\");\n  }\n\n  double d = 1.59;\n  if (d == 1.59) {\n    puts(\"double: equal!\");\n  } else {\n    puts(\"double: not equal!\");\n  }\n  return 0;\n}\n</code></pre>\n\n<p><a href=\"http://ideone.com/WobYbU\" rel=\"nofollow noreferrer\">http://ideone.com/WobYbU</a></p>\n\n<p>1.590000033378601 is 1.59 in 32bit variables. So you can use the value with cast to float32. i.e. float32(1.590000033378601)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    str := `1.59`\n    f64, err := strconv.ParseFloat(str, 32)\n    if err != nil {\n        fmt.Println(\"err: \", err)\n    }\n    f32 := float32(f64)\n    fmt.Printf(\"%T -&gt; %+v\\n\", f32, f32)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ml4O8CtjOK\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<h1>UPDATE</h1>\n\n<p>On Most of computer, floating point value is stored as following elements.</p>\n\n<ul>\n<li>Sign (zero or one)</li>\n<li>Significand (Coefficient)</li>\n<li>Exponent</li>\n</ul>\n\n<p>For example, representations 0.75 is <code>+1.1 x 2^-1</code></p>\n\n<p><code>+</code> is Sign, <code>.1</code> is Significand, <code>-1</code> is Exponent. This is stored like below on 32bit memory space. </p>\n\n<pre><code>Sign                                 Significand\n+-+               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n| | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | |\n  +-+-+-+-+-+-+-+-+\n      Exponent\n</code></pre>\n\n<p>For example, <code>0.75</code> is stored like below</p>\n\n<pre><code>0-01111110-10000000000000000000000\n\n     +- Significand\n     |\n+ 1[.1] x 2 ^ -1\n|         |    |\n+- Sign   |    +- Exponent\n          |\n          +------ Base\n</code></pre>\n\n<blockquote>\n  <p>+ 1.1 x 2^-1 = 1 x 2^0 + 1 x 2^-1 x 2^-1 = 0.75</p>\n</blockquote>\n\n<p>Since floating point value is represented as above, it is different between the mathematical value and the computer's value. This is precision issue.</p>\n"}, {"tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 1, "last_activity_date": 1499285425, "last_edit_date": 1499285425, "creation_date": 1499250607, "answer_id": 44923705, "question_id": 44921193, "link": "https://stackoverflow.com/questions/44921193/golang-strconv-parsefloat-fails-to-parse-the-string-correctly-when-using-32-for/44923705#44923705", "title": "Golang strconv.ParseFloat fails to parse the string correctly when using 32 for bitSize parameter", "body": "<p>The decimal number <code>1.59</code> look short, but that's only because we are using the <b>decimal number system</b>. </p>\n\n<p>When the computer tries to represent the same number in <b>binary scientific notation</b> (<code>a * 2^b</code>) it requires a lot more fractional digits: <code>1.1001011100001010001111010111000010100011110101110001 * 2^0</code>.</p>\n\n<p>If you round this value to 32 bits, store it in a variable of type <code>float32</code> and then print as decimal, you get <code>1.59</code>, but storing the same rounded value in a <code>float64</code> variable and printing as decimal, you get <code>1.590000033378601</code>.</p>\n\n<p>Function <code>strconv.ParseFloat</code> returns float64, but since you have specified 32 bits of precision, you are supposed to cast the value to float32 prior to using. </p>\n"}], "owner": {"reputation": 4379, "user_id": 184176, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/811251725188ac87f9125177073c28d0?s=128&d=identicon&r=PG", "display_name": "sepehr", "link": "https://stackoverflow.com/users/184176/sepehr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1433, "favorite_count": 1, "accepted_answer_id": 44921845, "answer_count": 2, "score": -3, "last_activity_date": 1499285425, "creation_date": 1499244255, "question_id": 44921193, "link": "https://stackoverflow.com/questions/44921193/golang-strconv-parsefloat-fails-to-parse-the-string-correctly-when-using-32-for", "title": "Golang strconv.ParseFloat fails to parse the string correctly when using 32 for bitSize parameter", "body": "<p>Why the converted float64 variable has <code>1.590000033378601</code> as value?\n<code>1.59</code> seems small enough to be fitted into 32 bits:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    str := `1.59`\n    float, err := strconv.ParseFloat(str, 32)\n    if err != nil {\n        fmt.Println(\"err: \", err)\n    }\n    fmt.Printf(\"%T -&gt; %+v\\n\", float, float)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/s8uUCsteao\" rel=\"nofollow noreferrer\">Go playground link</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 1, "creation_date": 1499240761, "post_id": 44919927, "comment_id": 76815704, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/34314975/go-get-path-parameters-from-http-request\">Go: Get path parameters from http.Request</a>"}], "answers": [{"comments": [{"owner": {"reputation": 99, "user_id": 7961353, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2c0d31851dd72635ee741200a6ce5747?s=128&d=identicon&r=PG&f=1", "display_name": "Onkar Banerjee", "link": "https://stackoverflow.com/users/7961353/onkar-banerjee"}, "edited": false, "score": 0, "creation_date": 1499241625, "post_id": 44920017, "comment_id": 76816317, "body": "Ya,  i had this down with gorilla Mux. But in std lib, the net/http package couldn&#39;t allow me such flexibility. I had to do with string trimming and splitting of the url path as suggested above by you. Just wanted to confirm if there is indeed any other way to get this done with anything from the std lib. I am new to GO, pardon my ignorance. The other thing i couldn&#39;t get was to have handlers based on methods.Need to access the mothod as well from the request object it seems."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "reply_to_user": {"reputation": 99, "user_id": 7961353, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2c0d31851dd72635ee741200a6ce5747?s=128&d=identicon&r=PG&f=1", "display_name": "Onkar Banerjee", "link": "https://stackoverflow.com/users/7961353/onkar-banerjee"}, "edited": false, "score": 0, "creation_date": 1499243795, "post_id": 44920017, "comment_id": 76817718, "body": "Don&#39;t worry. All golang Web developers have had the same thoughts. ;)"}], "tags": [], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "is_accepted": false, "score": 0, "last_activity_date": 1499240810, "creation_date": 1499240810, "answer_id": 44920017, "question_id": 44919927, "link": "https://stackoverflow.com/questions/44919927/path-param-in-url-in-go-without-any-web-framework/44920017#44920017", "title": "path param in URL in GO without any web framework", "body": "<p>Well this is why people use frameworks like <a href=\"https://github.com/gin-gonic\" rel=\"nofollow noreferrer\">gin-gonic</a> because this is not easy to do this in the <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">net/http</a> package IIUC.</p>\n\n<p>Otherwise, you would need to <code>strings.Split(r.URL.Path, \"/\")</code> and work from those elements.</p>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 2, "last_activity_date": 1499261329, "creation_date": 1499261329, "answer_id": 44927664, "question_id": 44919927, "link": "https://stackoverflow.com/questions/44919927/path-param-in-url-in-go-without-any-web-framework/44927664#44927664", "title": "path param in URL in GO without any web framework", "body": "<p>What I tend to do is nested handlers. \"/\" is handled by the root handler. It pops the first part of the path, assigns the rest back to <code>req.URL.Path</code> (effectively acting like <code>StripPrefix</code>), determines which handler handles routes by that prefix (if any), then chains the appropriate handler. If that handler needs to parse an ID out of the path, it can, by the same mechansim - pop the first part of the path, parse it as necessary, then act.</p>\n\n<p>This not only has no external dependencies, but it is faster than any router could ever be, because the routing is hard-coded rather than dynamic. Unless routing changes at runtime (which would be pretty unusual), there is no need for routing to be handled dynamically.</p>\n"}], "owner": {"reputation": 99, "user_id": 7961353, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2c0d31851dd72635ee741200a6ce5747?s=128&d=identicon&r=PG&f=1", "display_name": "Onkar Banerjee", "link": "https://stackoverflow.com/users/7961353/onkar-banerjee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2699, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1499261329, "creation_date": 1499240531, "last_edit_date": 1499258810, "question_id": 44919927, "link": "https://stackoverflow.com/questions/44919927/path-param-in-url-in-go-without-any-web-framework", "title": "path param in URL in GO without any web framework", "body": "<p>While developing a REST api in Go, how can we use path params? meaning to say what will be the format of the URI?</p>\n\n<pre><code>http://localhost:8765/myapp/{param1}/entries/{param2}\n</code></pre>\n\n<p>I tried using something like this to create the route but the handler function is not getting invoked.</p>\n\n<p>Please note that, i intent to use only the net/http package , not any other web framework like gorilla mux.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1499222727, "post_id": 44915945, "comment_id": 76808682, "body": "You can use selenium with go as well: google for &quot;go webdriver&quot; and pick the library you like more."}], "answers": [{"comments": [{"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499225436, "post_id": 44915969, "comment_id": 76809206, "body": "yes, but not dynamic"}], "tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": false, "score": 3, "last_activity_date": 1499225716, "last_edit_date": 1499225716, "creation_date": 1499219769, "answer_id": 44915969, "question_id": 44915945, "link": "https://stackoverflow.com/questions/44915945/how-to-scrape-dynamic-website-in-go/44915969#44915969", "title": "How to Scrape Dynamic Website in Go?", "body": "<p>Give it a try on Go lang selenium web drivers</p>\n\n<p><a href=\"https://github.com/knq/chromedp\" rel=\"nofollow noreferrer\">https://github.com/knq/chromedp</a> : Package chromedp is a faster, simpler way to drive browsers (Chrome, Edge, Safari, Android, etc) without external dependencies (ie, Selenium, PhantomJS, etc) using the Chrome Debugging Protocol.</p>\n\n<p><a href=\"https://github.com/sourcegraph/go-selenium\" rel=\"nofollow noreferrer\">https://github.com/sourcegraph/go-selenium</a> : Selenium WebDriver client for Go</p>\n\n<p><a href=\"https://github.com/tebeka/selenium\" rel=\"nofollow noreferrer\">https://github.com/tebeka/selenium</a> : Selenium/Webdriver client for Go</p>\n\n<hr>\n\n<p>Static Crawler Reference</p>\n\n<p>You can use <code>github.com/PuerkitoBio/gocrawl</code> library or built your custom crawler, basic idea is here <a href=\"https://tour.golang.org/concurrency/10\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/10</a>.</p>\n"}], "owner": {"reputation": 1640, "user_id": 5531595, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/455940914617164/picture?type=large", "display_name": "Rohman HM", "link": "https://stackoverflow.com/users/5531595/rohman-hm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1730, "favorite_count": 0, "closed_date": 1499240452, "answer_count": 1, "score": 0, "last_activity_date": 1499225716, "creation_date": 1499219529, "question_id": 44915945, "link": "https://stackoverflow.com/questions/44915945/how-to-scrape-dynamic-website-in-go", "closed_reason": "Not suitable for this site", "title": "How to Scrape Dynamic Website in Go?", "body": "<p>With NodeJS I can use PhantomJS to help me to scrape dynamic website, with Python I can use Selenium to do this job.</p>\n\n<p>How about in GoLang?</p>\n"}, {"tags": ["python", "unit-testing", "go"], "comments": [{"owner": {"reputation": 21707, "user_id": 1832539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2972ae1ab4d157c88bc94654b96d47be?s=128&d=identicon&r=PG", "display_name": "idjaw", "link": "https://stackoverflow.com/users/1832539/idjaw"}, "edited": false, "score": 0, "creation_date": 1499217093, "post_id": 44915711, "comment_id": 76807658, "body": "I would assume that doing this in go is not that different than Python, in which you would use some mocking library like one of these? <a href=\"https://github.com/golang/mock\" rel=\"nofollow noreferrer\">github.com/golang/mock</a>"}, {"owner": {"reputation": 2830, "user_id": 856070, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa3aeef5f536776e6a56b1581a2a0fee?s=128&d=identicon&r=PG", "display_name": "jcfollower", "link": "https://stackoverflow.com/users/856070/jcfollower"}, "edited": false, "score": 0, "creation_date": 1499434457, "post_id": 44915711, "comment_id": 76918960, "body": "What about adding a bool param that indicates whether to call the real Python module.  Then if not, call a function that returns mock results in the same format as the Python module would.  Have your unit tests tell it not to call the real Python module."}], "answers": [{"comments": [{"owner": {"reputation": 873, "user_id": 4509355, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/31648f80ef66006febaecde7c76b7319?s=128&d=identicon&r=PG&f=1", "display_name": "Nishant Roy", "link": "https://stackoverflow.com/users/4509355/nishant-roy"}, "edited": false, "score": 0, "creation_date": 1499296682, "post_id": 44919440, "comment_id": 76851233, "body": "How does this help me unit test? I don&#39;t want to actually call the function, I just want to mock the output."}, {"owner": {"reputation": 620, "user_id": 1322651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e59e59204a86ec3da94e49eaf68f932?s=128&d=identicon&r=PG", "display_name": "Lukas Isselb&#228;cher", "link": "https://stackoverflow.com/users/1322651/lukas-isselb%c3%a4cher"}, "reply_to_user": {"reputation": 873, "user_id": 4509355, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/31648f80ef66006febaecde7c76b7319?s=128&d=identicon&r=PG&f=1", "display_name": "Nishant Roy", "link": "https://stackoverflow.com/users/4509355/nishant-roy"}, "edited": false, "score": 0, "creation_date": 1499433951, "post_id": 44919440, "comment_id": 76918562, "body": "This helps because if the function returns an error (because the pythonfunction is not ready) the output is mocked."}], "tags": [], "owner": {"reputation": 620, "user_id": 1322651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e59e59204a86ec3da94e49eaf68f932?s=128&d=identicon&r=PG", "display_name": "Lukas Isselb&#228;cher", "link": "https://stackoverflow.com/users/1322651/lukas-isselb%c3%a4cher"}, "is_accepted": false, "score": 0, "last_activity_date": 1499434099, "last_edit_date": 1499434099, "creation_date": 1499239138, "answer_id": 44919440, "question_id": 44915711, "link": "https://stackoverflow.com/questions/44915711/golang-unit-testing-python-function/44919440#44919440", "title": "Golang unit testing python function", "body": "<p>You could wrap your function into a new moc function:</p>\n\n<pre><code>func CallPythonFunctionMoc() Result {\n    var res Result\n    var err error\n    res, err = CallPythonFunction()\n    if err != nil {\n        res = \"Moc value\"\n    }\n    return res\n</code></pre>\n\n<p>Edit:</p>\n\n<p>If you do NOT actually want to call the python function just return the moc-value:</p>\n\n<pre><code>func CallPythonFunctionMoc() Result {\n    res := \"Moc value\"\n    return res\n</code></pre>\n"}], "owner": {"reputation": 873, "user_id": 4509355, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/31648f80ef66006febaecde7c76b7319?s=128&d=identicon&r=PG&f=1", "display_name": "Nishant Roy", "link": "https://stackoverflow.com/users/4509355/nishant-roy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 175, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1499434099, "creation_date": 1499217011, "question_id": 44915711, "link": "https://stackoverflow.com/questions/44915711/golang-unit-testing-python-function", "title": "Golang unit testing python function", "body": "<p>I have an API handler in Golang that calls a python function. How can I mock the response from the python function to avoid dependence of that function running correctly to test the Golang function?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "edited": false, "score": 0, "creation_date": 1499212741, "post_id": 44915321, "comment_id": 76806882, "body": "Yes, my mistake I forgot to update code here for <code>return &quot;&quot;</code> , now removed and updated code and error. About <code>void</code> function how can I reference <code>db</code> to function ? I don&#39;t want to open &quot;db&quot; connection inside every function. I just want to reference it from main. Is it possible ?"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "edited": false, "score": 0, "creation_date": 1499213395, "post_id": 44915321, "comment_id": 76807019, "body": "homePage should return context.Handler."}, {"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "edited": false, "score": 0, "creation_date": 1499213833, "post_id": 44915321, "comment_id": 76807118, "body": "Yes I have already done that. But my error is on <code>homePage(db)</code> , is there any way, I can reference db from <code>main</code> function to <code>homePage</code> function ?"}, {"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "edited": false, "score": 0, "creation_date": 1499214148, "post_id": 44915321, "comment_id": 76807181, "body": "Thanks a lot! Also, how can I create variable where database column name has <code>_</code> (underscore) and fetch from database. As <code>go</code> warns me not to create variable with <code>_</code> in it. SnakeCase / CamelCase does not work while fetching from mysql."}, {"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "edited": false, "score": 0, "creation_date": 1499214367, "post_id": 44915321, "comment_id": 76807214, "body": "Sure! Thanks for helping out until here."}], "tags": [], "owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "is_accepted": true, "score": 2, "last_activity_date": 1499214096, "last_edit_date": 1499214096, "creation_date": 1499212458, "answer_id": 44915321, "question_id": 44915201, "link": "https://stackoverflow.com/questions/44915201/db-context-too-many-errors/44915321#44915321", "title": "DB &amp; context too many errors", "body": "<blockquote>\n  <p>./main.go:40: homePage(db) used as value</p>\n</blockquote>\n\n<p>homePage is void function. So you can't use it in function arguments.</p>\n\n<blockquote>\n  <p>./main.go:50: func literal evaluated but not used</p>\n</blockquote>\n\n<pre><code>func homePage(db *sql.DB) {\n    func(ctx context.Context) {\n        ...\n    }\n    return \"\"\n}\n</code></pre>\n\n<p>This is broken syntax. I suggest you to go <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">https://tour.golang.org/</a></p>\n\n<blockquote>\n  <p>./main.go:79: too many arguments to return\n      have (string)\n      want ()</p>\n</blockquote>\n\n<p>As I said in above, homePage is void function. So you can't use return with value. Below is code which I could suppose your code should be.</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"log\"\n\n    \"github.com/get-ion/ion\"\n    \"github.com/get-ion/ion/context\"\n    \"github.com/get-ion/ion/view\"\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nfunc main() {\n    app := ion.New()\n    app.RegisterView(view.HTML(\"./templates\", \".html\"))\n\n    db, err := sql.Open(\"mysql\", \"root:password@/database?charset=utf8&amp;parseTime=true&amp;loc=Local\")\n    if err != nil {\n        log.Fatalln(err)\n        panic(\"There was an error handling mysql connection!\")\n    }\n    defer db.Close()\n\n    allRoutes := app.Party(\"/\", logThisMiddleware)\n    {\n        allRoutes.Get(\"/\", homePage(db))\n    }\n\n    //app.Run(ion.Addr(\":8080\"))\n}\n\nfunc logThisMiddleware(ctx context.Context) {\n    ctx.Application().Logger().Infof(\"Path: %s | IP: %s\\n\", ctx.Path(), ctx.RemoteAddr())\n    ctx.Next()\n}\n\nfunc homePage(db *sql.DB) context.Handler {\n    return func(ctx context.Context) {\n        var (\n            id             int\n            title          string\n            featured_image string\n            created_at     string\n        )\n        rows, err := db.Query(\"SELECT id, title, featured_image, created_at from blogs order by crated_at desc limit 0,5\")\n        if err != nil {\n            ctx.Application().Logger().Fatalf(\"MySQL Error fetching row %s\\n\", err)\n        }\n        defer rows.Close()\n        blogData := map[int]map[int]string{}\n        for rows.Next() {\n            err := rows.Scan(&amp;id, &amp;title, &amp;featured_image, &amp;created_at)\n            if err != nil {\n                ctx.Application().Logger().Fatalf(\"Error while fetching row from blog: %s\\n\", err)\n            }\n            blogData[id][0] = title\n            blogData[id][1] = featured_image\n            blogData[id][2] = created_at\n        }\n        err = rows.Err()\n        if err != nil {\n            ctx.Application().Logger().Fatalf(\"Error while scanning Row : %s\\n\", err)\n        }\n        ctx.ViewData(\"blog\", blogData)\n        ctx.View(\"homepage.html\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 441, "favorite_count": 0, "accepted_answer_id": 44915321, "answer_count": 1, "score": -1, "last_activity_date": 1515147761, "creation_date": 1499211216, "last_edit_date": 1515147761, "question_id": 44915201, "link": "https://stackoverflow.com/questions/44915201/db-context-too-many-errors", "title": "DB &amp; context too many errors", "body": "<p>I am running below \"go\" code and getting lots of error :</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"log\"    \n    \"github.com/get-ion/ion\"\n    \"github.com/get-ion/ion/context\"\n    \"github.com/get-ion/ion/view\"\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nfunc main() {\n    app := ion.New()\n    app.RegisterView(view.HTML(\"./templates\", \".html\"))\n\n    db, err := sql.Open(\"mysql\", \"root:password@/database?charset=utf8&amp;parseTime=true&amp;loc=Local\")\n    if err != nil {\n        log.Fatalln(err)\n        panic(\"There was an error handling mysql connection!\")\n    }\n    defer db.Close()\n\n    allRoutes := app.Party(\"/\", logThisMiddleware)\n    {\n        allRoutes.Get(\"/\", homePage(db))\n    }\n}\n\nfunc logThisMiddleware(ctx context.Context) {\n    ctx.Application().Logger().Infof(\"Path: %s | IP: %s\\n\", ctx.Path(), ctx.RemoteAddr())\n    ctx.Next()\n}\n\nfunc homePage(db *sql.DB) {\n    func(ctx context.Context) {\n       var (\n            id             int\n            title          string\n            featured_image string\n            created_at     string\n        )\n        rows, err := db.Query(\"SELECT id, title, featured_image, created_at from blogs order by crated_at desc limit 0,5\")\n        if err != nil {\n            ctx.Application().Logger().Fatalf(\"MySQL Error fetching row %s\\n\", err)\n        }\n        defer rows.Close()\n        blogData := map[int]map[int]string{}\n        for rows.Next() {\n            err := rows.Scan(&amp;id, &amp;title, &amp;featured_image, &amp;created_at)\n            if err != nil {\n                ctx.Application().Logger().Fatalf(\"Error while fetching row from blog: %s\\n\", err)\n            }\n            blogData[id][0] = title\n            blogData[id][1] = featured_image\n            blogData[id][2] = created_at\n        }\n        err = rows.Err()\n        if err != nil {\n            ctx.Application().Logger().Fatalf(\"Error while scanning Row : %s\\n\", err)\n        }\n        ctx.ViewData(\"blog\", blogData)\n        ctx.View(\"homepage.html\")\n    }\n}\n</code></pre>\n\n<p>Errors are :-</p>\n\n<pre><code>./main.go:40: homePage(db) used as value\n./main.go:50: func literal evaluated but not used\n</code></pre>\n\n<p>All the values are fetched as mentioned in : <a href=\"http://go-database-sql.org/retrieving.html\" rel=\"nofollow noreferrer\">http://go-database-sql.org/retrieving.html</a> , Still not sure why undefined variable issue. I don't think, these variables are required to be created, but if in case it has to be , please let me know.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "resources"], "comments": [{"owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 0, "creation_date": 1499213727, "post_id": 44915103, "comment_id": 76807098, "body": "see <a href=\"https://github.com/jteeuwen/go-bindata\" rel=\"nofollow noreferrer\">github.com/jteeuwen/go-bindata</a> or other similar options to package your resources into the executable."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1499234582, "post_id": 44915103, "comment_id": 76812092, "body": "See some ideas in this possible duplicate: <a href=\"https://stackoverflow.com/questions/31059023/how-to-reference-a-relative-file-from-code-and-tests/31059125#31059125\">how to reference a relative file from code and tests</a>."}, {"owner": {"reputation": 3732, "user_id": 1493365, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a1c605226f3799430016e619bc331b8d?s=128&d=identicon&r=PG", "display_name": "Matt3o12", "link": "https://stackoverflow.com/users/1493365/matt3o12"}, "reply_to_user": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 0, "creation_date": 1499248602, "post_id": 44915103, "comment_id": 76821340, "body": "@superfell I am aware of go-bindata but that&#39;s not what I was looking for. I don&#39;t want to store data into go source files."}, {"owner": {"reputation": 3732, "user_id": 1493365, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a1c605226f3799430016e619bc331b8d?s=128&d=identicon&r=PG", "display_name": "Matt3o12", "link": "https://stackoverflow.com/users/1493365/matt3o12"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1499248620, "post_id": 44915103, "comment_id": 76821358, "body": "@icza this questions is very similar to mine but the questions already covers his answer in point one. I was hoping there was a better way"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1499261484, "creation_date": 1499261484, "answer_id": 44927721, "question_id": 44915103, "link": "https://stackoverflow.com/questions/44915103/golang-where-should-resources-be-kept/44927721#44927721", "title": "Golang -- where should resources be kept", "body": "<p>There is no \"should\". You can put them wherever you see fit. You can embed them if you want. The easiest is probably to make the path to your resources configurable with some sane default (like defaulting to \".\" or <code>runtime.Caller(0)</code>.</p>\n"}], "owner": {"reputation": 3732, "user_id": 1493365, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a1c605226f3799430016e619bc331b8d?s=128&d=identicon&r=PG", "display_name": "Matt3o12", "link": "https://stackoverflow.com/users/1493365/matt3o12"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1651, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1499261484, "creation_date": 1499210523, "question_id": 44915103, "link": "https://stackoverflow.com/questions/44915103/golang-where-should-resources-be-kept", "title": "Golang -- where should resources be kept", "body": "<p>For quite some time, I have been wondering where to save resources for my go package and I just cannot find a correct answer. </p>\n\n<p>Right now, resources are kept into</p>\n\n<ul>\n<li>main/module1/resources</li>\n<li>main/module2/resources</li>\n</ul>\n\n<p>When I just use <code>go run *.go</code> from main, it works fine. When I run tests, however, the resources cannot be found because Go changes the current working directory to the corresponding module. One workaround is to just os.Chdir('..') but doing that for every test seems kind of annoying. Furthermore, sometimes the resources are loaded as the package initializes. That means there is a global map with all templates (and their corresponding names):</p>\n\n<pre><code>package module2\n\nvar myTemplates = map[string]template { \"index\": loadTemplateFromFile() }\n</code></pre>\n\n<p>I know you should not be using globals in go because of concurrency but this variable is safe for concurrent reads (and it is only written to during startup). So I put the templates into a global var so that they can be loaded on startup and some errors are caught during startup and the template are already in memory.</p>\n\n<p>This means that I cannot change the working directory in time because the problem will already panic'd with an error telling me the file could not be found (this is the exact behavior I want).</p>\n\n<p>Later, I discovered a method <code>runtime.Caller</code> to get the path from where the go files were compiled (if available):</p>\n\n<pre><code>base := \".\"\nif _, filename, _, ok := runtime.Caller(0); ok {\n    base = path.Join(path.Dir(filename), \"..\")\n}\nfile := path.Join(base, \"module1\", \"resources\", ...)\n</code></pre>\n\n<p>Now, all tests work just fine and <code>go run *.go</code> also finds the correct resources. This method becomes an issue as soon as I start deploying my package. Because runtime.Caller uses the path which was used during compilation, I have to have the resources in the excact same location where I complied them. This means when I build the binary in <code>/home/matt3o12/go/src/domain.tld/matt3o12/mypackage</code>, I have to have all resource folders at the exact same path on the server.</p>\n\n<p>I also tried to use <code>os.Executable</code> but this is pretty pointless because it just points to some temporary path with the compiled executable inside (and no resources). Unless I compile a test package and run it manually but this is very work intense.</p>\n\n<p>I am also not looking to store the resources inside the binary (having a folder structure of the project resources is just fine).</p>\n\n<p>I do have some ideas to solve this problem but I don't think any of them are optional:</p>\n\n<ul>\n<li>Use a flag to point to the resource folder. This would work but using that for every test I run would be pretty annoying (because now everytime I use <code>go test ./...</code> or <code>go run *.go</code>, I have to worry about the proper resource path).</li>\n<li>Use \"magic\" to figure out if tests are run and change the path accordingling. I would hate to use that because I would have to place those checks all over my code and I hate to have many \"edge/special\" cases.</li>\n</ul>\n\n<p>This <strong>is not</strong> a duplicate of:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/19586827/where-should-resources-be-kept-in-golang\">Where should resources be kept in golang</a></li>\n<li><a href=\"https://github.com/golang/go/issues/3035\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/3035</a></li>\n<li><a href=\"https://stackoverflow.com/questions/21595295/golang-serve-static-files-from-memory\">Golang serve static files from memory</a></li>\n<li><a href=\"https://www.reddit.com/r/golang/comments/66uewv/golang_compile_static_files_in_app/\" rel=\"nofollow noreferrer\">https://www.reddit.com/r/golang/comments/66uewv/golang_compile_static_files_in_app/</a></li>\n</ul>\n"}, {"tags": ["nginx", "go", "centos7"], "comments": [{"owner": {"reputation": 5056, "user_id": 4276090, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/r87tb.jpg?s=128&g=1", "display_name": "Skam", "link": "https://stackoverflow.com/users/4276090/skam"}, "edited": false, "score": 0, "creation_date": 1499207118, "post_id": 44914491, "comment_id": 76805721, "body": "Just want to clarify, you have different domains e.g. <code>foo.com</code>, <code>bar.com</code>, not subdomains <code>app1.foo.com</code>, <code>app2.foo.com</code>, whose DNS resolves to your CENTOS server?"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 5056, "user_id": 4276090, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/r87tb.jpg?s=128&g=1", "display_name": "Skam", "link": "https://stackoverflow.com/users/4276090/skam"}, "edited": false, "score": 0, "creation_date": 1499207380, "post_id": 44914491, "comment_id": 76805774, "body": "@SeeDart I will have boths domains and subdomains for some apps"}, {"owner": {"reputation": 5056, "user_id": 4276090, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/r87tb.jpg?s=128&g=1", "display_name": "Skam", "link": "https://stackoverflow.com/users/4276090/skam"}, "edited": false, "score": 0, "creation_date": 1499208051, "post_id": 44914491, "comment_id": 76805930, "body": "Can you add your http block and verify the golang servers can be accessed from localhost?"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 5056, "user_id": 4276090, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/r87tb.jpg?s=128&g=1", "display_name": "Skam", "link": "https://stackoverflow.com/users/4276090/skam"}, "edited": false, "score": 0, "creation_date": 1499208368, "post_id": 44914491, "comment_id": 76806002, "body": "@SeeDart I added the HTTP block. I checked and the process of the Golang app is running. But if U try to access the application directly with <code>IP:port</code> from the browser I also cannot see the website"}, {"owner": {"reputation": 5056, "user_id": 4276090, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/r87tb.jpg?s=128&g=1", "display_name": "Skam", "link": "https://stackoverflow.com/users/4276090/skam"}, "edited": false, "score": 0, "creation_date": 1499210388, "post_id": 44914491, "comment_id": 76806426, "body": "If you can&#39;t access it from <code>ip:port</code> then it isn&#39;t an nginx issue and this question should be closed"}], "answers": [{"tags": [], "owner": {"reputation": 5056, "user_id": 4276090, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/r87tb.jpg?s=128&g=1", "display_name": "Skam", "link": "https://stackoverflow.com/users/4276090/skam"}, "is_accepted": false, "score": 3, "last_activity_date": 1499214760, "creation_date": 1499214760, "answer_id": 44915525, "question_id": 44914491, "link": "https://stackoverflow.com/questions/44914491/basic-configuration-of-golang-app-in-nginx/44915525#44915525", "title": "Basic Configuration of Golang App in Nginx", "body": "<p>Your server configuration looks okay and the <a href=\"https://stackoverflow.com/questions/5011632/502-http-status-code\">502 Status Code</a> means you didn't configure the Go servers correctly. Specifically, Nginx did exactly what you expected it to, proxied the request to and from your upstream, but received an invalid response from your Go server.</p>\n"}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2163, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1499265188, "creation_date": 1499205687, "last_edit_date": 1499265188, "question_id": 44914491, "link": "https://stackoverflow.com/questions/44914491/basic-configuration-of-golang-app-in-nginx", "title": "Basic Configuration of Golang App in Nginx", "body": "<p>I have a CentOS 7 server where I have running some Golang apps. As you know, every app is running on his own port, lets say: 9000,9100,9200 and so on.</p>\n\n<p>Now, I have installed Nginx to serve all the websites, I have a domain for every site and I want to receive all the petitions in the port 80 and then just based on the domain i have to redirect to the application that corresponds.</p>\n\n<p>By now,am trying to make it with one of the site that is running in the port 9094, I have no experience with Nginx so I was just reading to know what to do,but it seems like it's not working. in the file <code>nginx.conf</code> I added these lines:</p>\n\n<pre><code>server {\n                listen          80;\n                server_name     mydomain.com;\n                access_log      logs/mydomain.log main;\n\n                location / {\n                        proxy_pass      http://127.0.0.1:9094;\n                }\n        }\n</code></pre>\n\n<p>I have to mention that I didn't delete these lines that comes for default in the file:</p>\n\n<pre><code>  server {\n        listen       80 default_server;\n        listen       [::]:80 default_server;\n        server_name  _;\n        root         /usr/share/nginx/html;\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\n        location / {\n        }\n\n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n    }\n</code></pre>\n\n<p>Is the configuration ok? and will allow me to add more sites? Thank you\nIf I ping to the domain everything is ok, but if I open the domain in the browser then I get status code 502</p>\n\n<p><strong>EDIT:</strong></p>\n\n<pre><code>http {\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile            on;\n    tcp_nopush          on;\n    tcp_nodelay         on;\n    keepalive_timeout   65;\n    types_hash_max_size 2048;\n\n    include             /etc/nginx/mime.types;\n    default_type        application/octet-stream;\n\n    # Load modular configuration files from the /etc/nginx/conf.d directory.\n    # See http://nginx.org/en/docs/ngx_core_module.html#include\n    # for more information.\n    include /etc/nginx/conf.d/*.conf;\n\n        server {\n                listen          80;\n                server_name     mydomain.com;\n                access_log      logs/mydomain.log main;\n\n                location / {\n                        proxy_pass      http://127.0.0.1:9094;\n                }\n        }\n\n}\n</code></pre>\n"}, {"tags": ["go", "handler", "fileserver"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1499199329, "post_id": 44913349, "comment_id": 76803338, "body": "Well, you could <i>try</i> it..."}], "answers": [{"tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 1, "last_activity_date": 1499199904, "creation_date": 1499199904, "answer_id": 44913596, "question_id": 44913349, "link": "https://stackoverflow.com/questions/44913349/does-fileserver-handler-only-serve-what-is-inside-the-directory-you-specify/44913596#44913596", "title": "Does FileServer handler only serve what is inside the directory you specify?", "body": "<p>The http.FileServer inhibits a breakout of the root directory you specify.</p>\n\n<p>In contrast you could build your own file server with http.ServeFile which would potentially be a dangerous undertaking.</p>\n\n<p>See also <a href=\"https://stackoverflow.com/questions/28793619/golang-what-to-use-http-servefile-or-http-fileserver\">Golang. What to use? http.ServeFile(..) or http.FileServer(..)?</a></p>\n"}], "owner": {"reputation": 346, "user_id": 5735210, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b84bfb2c8eb3cebfdf62f514bee0b864?s=128&d=identicon&r=PG&f=1", "display_name": "Cit5", "link": "https://stackoverflow.com/users/5735210/cit5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 44913596, "answer_count": 1, "score": 0, "last_activity_date": 1499199904, "creation_date": 1499198572, "question_id": 44913349, "link": "https://stackoverflow.com/questions/44913349/does-fileserver-handler-only-serve-what-is-inside-the-directory-you-specify", "title": "Does FileServer handler only serve what is inside the directory you specify?", "body": "<p>For example, can a user put your url with linux commands to go up a folder/directory?</p>\n\n<p>Let's say my server consist of:</p>\n\n<pre><code>bin/\n    serverfile.go\n    ...\npublic/\n    index.html\n    style.css\n</code></pre>\n\n<p>\"www.example.com/../bin/etc\"</p>\n\n<p>with serverfile.go consisting of:</p>\n\n<pre><code> pacakage main\n import \"net/http\"\n\n func main() {\n     htttp.ListenAndServe(\":8000\", http.FileServer(http.Dir(\"public\")))\n }\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 426, "user_id": 2433331, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/B7ROj.jpg?s=128&g=1", "display_name": "shazbot", "link": "https://stackoverflow.com/users/2433331/shazbot"}, "edited": false, "score": 0, "creation_date": 1499193037, "post_id": 44912155, "comment_id": 76800816, "body": "Thanks very much! I wasted hours on this; it was the trailing comma getting me!"}, {"owner": {"reputation": 21378, "user_id": 3118209, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/3tgaf.jpg?s=128&g=1", "display_name": "Arpit Aggarwal", "link": "https://stackoverflow.com/users/3118209/arpit-aggarwal"}, "edited": false, "score": 0, "creation_date": 1499193232, "post_id": 44912155, "comment_id": 76800897, "body": "shorthand <code>test := Mappings{{&quot;France&quot;, &quot;Paris&quot;}, {&quot;Italy&quot;: &quot;Rome&quot;}}</code>"}, {"owner": {"reputation": 426, "user_id": 2433331, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/B7ROj.jpg?s=128&g=1", "display_name": "shazbot", "link": "https://stackoverflow.com/users/2433331/shazbot"}, "edited": false, "score": 0, "creation_date": 1499193621, "post_id": 44912155, "comment_id": 76801064, "body": "no that won&#39;t work, it would need to be <code>test := Mappings{{&quot;France&quot;, &quot;Paris&quot;}, {&quot;Italy&quot;: &quot;Rome&quot;},}</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "reply_to_user": {"reputation": 426, "user_id": 2433331, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/B7ROj.jpg?s=128&g=1", "display_name": "shazbot", "link": "https://stackoverflow.com/users/2433331/shazbot"}, "edited": false, "score": 3, "creation_date": 1499197578, "post_id": 44912155, "comment_id": 76802652, "body": "@shazbot The trailing comma is only necessary if you&#39;re using a line break because Go will implicitly add a <code>;</code> (statement terminator) to the end of every line that doesn&#39;t end with certain tokens. See the <a href=\"https://golang.org/ref/spec#Semicolons\" rel=\"nofollow noreferrer\">&quot;Semicolons&quot; section of the Go Programming Language Specification</a>"}], "tags": [], "owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "is_accepted": true, "score": 4, "last_activity_date": 1499192629, "creation_date": 1499192629, "answer_id": 44912155, "question_id": 44912001, "link": "https://stackoverflow.com/questions/44912001/assign-values-to-a-slice-struct-in-go-golang/44912155#44912155", "title": "Assign values to a slice struct in go ( golang )", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n)\ntype Mappings []struct {\n    PropA       string  \n    PropB       string \n}\n\nfunc main() {\n    var test Mappings\n    test = Mappings{\n        {PropA: \"foo\", PropB: \"bar\"},\n        {PropA: \"bar\", PropB: \"baz\"},\n    }\n    fmt.Println(test)\n}\n</code></pre>\n"}], "owner": {"reputation": 426, "user_id": 2433331, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/B7ROj.jpg?s=128&g=1", "display_name": "shazbot", "link": "https://stackoverflow.com/users/2433331/shazbot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1668, "favorite_count": 0, "accepted_answer_id": 44912155, "answer_count": 1, "score": 1, "last_activity_date": 1499192629, "creation_date": 1499191930, "question_id": 44912001, "link": "https://stackoverflow.com/questions/44912001/assign-values-to-a-slice-struct-in-go-golang", "title": "Assign values to a slice struct in go ( golang )", "body": "<p>How can I assign values to a var of type []struct ?</p>\n\n<pre><code>type Mappings []struct {\n    PropA       string  \n    PropB       string \n}\n\nfunc main() {\n    var test Mappings\n    test = ???\n}\n</code></pre>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["go", "websocket", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 377, "user_id": 4104109, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/J8mpK.jpg?s=128&g=1", "display_name": "Rico Berger", "link": "https://stackoverflow.com/users/4104109/rico-berger"}, "edited": false, "score": 1, "creation_date": 1499264165, "post_id": 44914055, "comment_id": 76832966, "body": "Thx for the reply. You are right the problem wasn&#39;t the stop signal. The problem was within the default statement, which was blocking. Only think I have to do was to pass the cursor for rethinkdb to the goroutine to close it from outside the goroutine. See also: <a href=\"https://stackoverflow.com/questions/38175743/how-to-stop-a-goroutine-that-is-listening-for-rethinkdb-changefeeds\" title=\"how to stop a goroutine that is listening for rethinkdb changefeeds\">stackoverflow.com/questions/38175743/&hellip;</a>"}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 1, "last_activity_date": 1499331229, "last_edit_date": 1499331229, "creation_date": 1499202778, "answer_id": 44914055, "question_id": 44911961, "link": "https://stackoverflow.com/questions/44911961/golang-non-blocking-channel-doesnt-work/44914055#44914055", "title": "Golang non blocking channel doesn&#39;t work", "body": "<p>First to make things easier:</p>\n\n<p>As far as I can see you do not need a global register for the quit channels. Just create a <code>ch := make(chan bool)</code> in main, pass it to <code>ListenToTable</code> (instead of the whole map of channels) and use it in the select. In main <code>close(ch)</code> it if you want to exit. But as you said, that doesn't solve your problem.</p>\n\n<p>Theoretically you are on the right track with closing the go routine. I took your sample code and made the following runnable code from it:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n\n    chClose := make(chan bool)\n    channel := make(chan string)\n\n    ListenToTable(\"somestring\", channel, chClose)\n\n    time.Sleep(3 * time.Second)\n    chClose &lt;- true\n    time.Sleep(1 * time.Second)\n}\n\nfunc ListenToTable(name string, ch chan string, chClose chan bool) {\n    go func(name string) {\n        for {\n            select {\n            case &lt;-chClose:\n                fmt.Println(\"QUIT GOROUTINE\")\n                return  // VERY IMPORTANT: not break!\n            default:\n            }\n        }\n    }(name)\n}\n</code></pre>\n\n<p>The problem must be with something else in you code, probably blocked by something in the <code>default</code> section and not even executing the select. Try printing <code>fmt.Println(\"something\")</code> before the <code>select {</code>. If that is not printed regularly then you have your answer.</p>\n\n<p>One more thing: As commented in the code above you cannot break out of a <code>for { select { ... } }</code> with a single <code>break</code>. You need to use a <code>return</code> (to exit the function) or another tactic (like a break with a label as Adrian suggested in the comments). The <code>break</code> will only exit the <code>select</code>, but not the <code>for</code> loop.</p>\n"}], "owner": {"reputation": 377, "user_id": 4104109, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/J8mpK.jpg?s=128&g=1", "display_name": "Rico Berger", "link": "https://stackoverflow.com/users/4104109/rico-berger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1242, "favorite_count": 0, "accepted_answer_id": 44914055, "answer_count": 1, "score": 1, "last_activity_date": 1499331229, "creation_date": 1499191734, "question_id": 44911961, "link": "https://stackoverflow.com/questions/44911961/golang-non-blocking-channel-doesnt-work", "title": "Golang non blocking channel doesn&#39;t work", "body": "<p>I work the first time with goroutines and channels in go and do not come any further.</p>\n\n<p>I have a websocket connection where every time a user connect a new goroutine is spawned. Now I want to stop this goroutine if the user disconnect from the websocket connection.</p>\n\n<p>To manage the stop signale I have create a map of channels. Each entry can be identified by the users websocket connection. I pass the websocket connection, the map of channels for the stop signal and two other parameters to the goroutine. But the goroutine doesn't receive any values from the quit channel and I don't know why.</p>\n\n<p>Here is the relevant code for the <code>main</code> package:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"time\"\n\n    \"github.com/gorilla/websocket\"\n)\n\nfunc wsHandler(w http.ResponseWriter, r *http.Request) {\n    ...\n    ws, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        return\n    }\n    defer ws.Close()\n\n    data.Quit[ws] = make(chan bool)\n\n    data.DB.ListenToTable(data.GetTableName(source), channel, data.Quit, ws)\n\n    for {\n        if _, _, err := ws.NextReader(); err != nil {\n            data.Quit[ws] &lt;- true\n\n            ws.Close()\n            break\n        }\n    }\n}\n</code></pre>\n\n<p>And the code of the <code>data</code> package where the goroutine is created:</p>\n\n<pre><code>package data\n\nvar Quit = make(map[*websocket.Conn](chan bool))\n\nfunc (db *rethinkDB) ListenToTable(name string, ch chan Data, quit map[*websocket.Conn](chan bool), ws *websocket.Conn) {\n    go func(name string, ws *websocket.Conn) {\n        for {\n            select {\n            case &lt;-quit[ws]:\n                fmt.Println(\"QUIT GOROUTINE\")\n                break\n            default:\n                res, err := r.Table(name).Changes().Run(db.session)\n                if err != nil {\n                    log.Fatalln(err)\n                }\n\n                var response DataFeed\n                for res.Next(&amp;response) {\n                    response.NewVal.WS = ws\n                    ch &lt;- response.NewVal\n                }\n\n                if res.Err() != nil {\n                    log.Println(res.Err())\n                }\n            }\n        }\n    }(name, ws)\n}\n</code></pre>\n\n<p>I have also tried buffered channels or pass the channel instead of the map of channels to the goroutine but without success. The <code>fmt.Println(\"QUIT GOROUTINE\")</code> command is never called and the goroutine isn't sopped.</p>\n\n<p>I hope someone can help me and sorry if this question was already ask but I haven't found a solution that solves my problem.</p>\n"}, {"tags": ["string", "go", "type-conversion", "biginteger"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1499194003, "creation_date": 1499194003, "answer_id": 44912429, "question_id": 44911902, "link": "https://stackoverflow.com/questions/44911902/best-way-to-convert-string-of-digits-into-its-numerical-big-rat-value/44912429#44912429", "title": "Best way to convert string of digits into its numerical big.Rat value", "body": "<p>You don't have to learn these methods and functions by heart, whenever you look for something, check the package documentation. The doc of the package in question can be found here: <a href=\"https://golang.org/pkg/math/big/\" rel=\"nofollow noreferrer\"><code>math/big</code></a>.</p>\n\n<p>As you can see in the doc, there is a <a href=\"https://golang.org/pkg/math/big/#Rat.SetString\" rel=\"nofollow noreferrer\"><code>Rat.SetString()</code></a> method for the <a href=\"https://golang.org/pkg/math/big/#Rat\" rel=\"nofollow noreferrer\"><code>big.Rat</code></a> type too which you can use for this purpose:</p>\n\n<blockquote>\n<pre><code>func (z *Rat) SetString(s string) (*Rat, bool)\n</code></pre>\n  \n  <p>SetString sets z to the value of s and returns z and a boolean indicating success. s can be given as a fraction \"a/b\" or as a floating-point number optionally followed by an exponent. The entire string (not just a prefix) must be valid for success. If the operation failed, the value of z is un- defined but the returned value is nil.</p>\n</blockquote>\n\n<p>Example using it:</p>\n\n<pre><code>r := big.NewRat(1, 1)\nif _, ok := r.SetString(\"2023930943509509\"); !ok {\n    fmt.Println(\"Failed to parse the string!\")\n}\nfmt.Println(r)\nfmt.Println(r.FloatString(2))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/XRr_Hajhui\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>2023930943509509/1\n2023930943509509.00\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8255328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/974443bf9ad5e6b0368d0ddb02fdef80?s=128&d=identicon&r=PG&f=1", "display_name": "Arnaud Grootendorst", "link": "https://stackoverflow.com/users/8255328/arnaud-grootendorst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 397, "favorite_count": 0, "accepted_answer_id": 44912429, "answer_count": 1, "score": 1, "last_activity_date": 1499194065, "creation_date": 1499191441, "last_edit_date": 1499194065, "question_id": 44911902, "link": "https://stackoverflow.com/questions/44911902/best-way-to-convert-string-of-digits-into-its-numerical-big-rat-value", "title": "Best way to convert string of digits into its numerical big.Rat value", "body": "<p>I'm working with <code>math/big</code>.</p>\n\n<p>I was wondering if somebody knows a short way to convert a <code>string</code> of digits like <code>\"2023930943509509\"</code> to a <code>big.Rat</code> type value.</p>\n\n<p>I know <code>.SetString()</code> can be used for <code>big.Int</code> types, but can the same be done for the <code>Rat</code> type?</p>\n"}, {"tags": ["go", "timeout"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1499262927, "post_id": 44911964, "comment_id": 76832001, "body": "I don&#39;t understand the argument against <code>WithTimeout</code>. It does exactly what OP wants, it&#39;s clear what it does, why not just use that instead of rewriting it inline using <code>WithDeadline</code>?"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1499264674, "post_id": 44911964, "comment_id": 76833409, "body": "I just wrote this since OP want."}], "tags": [], "owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "is_accepted": true, "score": 1, "last_activity_date": 1499191744, "creation_date": 1499191744, "answer_id": 44911964, "question_id": 44911726, "link": "https://stackoverflow.com/questions/44911726/the-best-way-to-set-the-timeout-on-built-in-http-request/44911964#44911964", "title": "The best way to set the timeout on built-in HTTP request", "body": "<p>Get new context from context.WithDeadline. See <a href=\"https://golang.org/pkg/context/#WithDeadline\" rel=\"nofollow noreferrer\">documentation</a>.\nWithTimeout just returns WithDeadline(parent, time.Now().Add(timeout)).</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"time\"\n)\n\nfunc getContent(ctx context.Context) {\n    req, err := http.NewRequest(\"GET\", \"http://example.com\", nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n    ctx, cancel := context.WithDeadline(ctx, time.Now().Add(3 * time.Second))\n    defer cancel()\n\n    req.WithContext(ctx)\n\n    resp, err := http.DefaultClient.Do(req)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer resp.Body.Close()\n    io.Copy(os.Stdout, resp.Body)\n}\n\nfunc main() {\n    ctx := context.Background()\n    getContent(ctx)\n}\n</code></pre>\n\n<p>If you want to make cancel trigger on main:</p>\n\n<pre><code>func main() {\n    ctx := context.Background()\n    ctx, cancel := context.WithCancel(ctx)\n\n    sc := make(chan os.Signal, 1)\n    signal.Notify(sc, os.Interrupt)\n    go func(){\n        &lt;-sc\n        cancel()\n    }()\n\n    getContent(ctx)\n}\n</code></pre>\n"}], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1951, "favorite_count": 0, "accepted_answer_id": 44911964, "answer_count": 1, "score": 1, "last_activity_date": 1499268434, "creation_date": 1499190554, "last_edit_date": 1499268434, "question_id": 44911726, "link": "https://stackoverflow.com/questions/44911726/the-best-way-to-set-the-timeout-on-built-in-http-request", "title": "The best way to set the timeout on built-in HTTP request", "body": "<p>What is the best way to setup a timeout on <strong>built-in</strong> http NewRequest? Currently, I'm using <code>http.Client</code>.Timeout which is cover the entire exchange, but is there something better for example <code>context.WithDeadline</code> or <code>context.WithTimeout</code>. If yes how is it working, how can I setup a <code>context.WithDeadline</code> solution for the <code>http.NewRequest</code>?</p>\n\n<p>There is my current solution:</p>\n\n<pre><code>func (c *Client) post(resource string, data url.Values, timeout time.Duration) ([]byte, error) {\n    url := c.getURL(resource)\n    client := &amp;http.Client{\n        Timeout: timeout * time.Millisecond,\n    }\n    req, err := http.NewRequest(\"POST\", url, strings.NewReader(data.Encode()))\n    if err != nil {\n        return nil, err\n    }\n    req.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\n    resp, err := client.Do(req)\n    if err != nil {\n        return nil, err\n    }\n    return ioutil.ReadAll(resp.Body)\n}\n</code></pre>\n"}, {"tags": ["select", "go", "concurrency"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1499183346, "post_id": 44909935, "comment_id": 76796621, "body": "Check out this question: <a href=\"https://stackoverflow.com/questions/36419054/go-projects-main-goroutine-sleep-forever/36419222#36419222\">Go project&#39;s main goroutine sleep forever?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "is_accepted": false, "score": 2, "last_activity_date": 1499183564, "creation_date": 1499183564, "answer_id": 44910099, "question_id": 44909935, "link": "https://stackoverflow.com/questions/44909935/what-does-select-do/44910099#44910099", "title": "What does select{} do?", "body": "<p>In generally, <code>select{}</code> is used for infinite loop.</p>\n"}], "owner": {"reputation": 6535, "user_id": 769262, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/148343ff4a9463abb627ceacf46711a1?s=128&d=identicon&r=PG", "display_name": "LodeRunner", "link": "https://stackoverflow.com/users/769262/loderunner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "closed_date": 1499198320, "answer_count": 1, "score": 0, "last_activity_date": 1499183564, "creation_date": 1499182925, "question_id": 44909935, "link": "https://stackoverflow.com/questions/44909935/what-does-select-do", "closed_reason": "Duplicate", "title": "What does select{} do?", "body": "<p>Reading <a href=\"https://golang.org/ref/mem#tmp_7\" rel=\"nofollow noreferrer\">The Go Memory Model</a>, I fell on this code snippet.</p>\n\n<pre><code>var limit = make(chan int, 3)\n\nfunc main() {\n    for _, w := range work {\n        go func(w func()) {\n            limit &lt;- 1\n            w()\n            &lt;-limit\n        }(w)\n    }\n    select{}\n}\n</code></pre>\n\n<p>I understand what this function is supposed to do \u2013 limit concurrency to 3 goroutines at any time \u2013 but I don't understand what the final <code>select{}</code> does. I expect this is some way to keep <code>main</code> alive until all goroutines have finished running, but I can't really say for sure.</p>\n\n<p>What happens in an empty <code>select</code>?</p>\n"}, {"tags": ["python", "go", "io", "gzip"], "answers": [{"comments": [{"owner": {"reputation": 723, "user_id": 5227605, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5a9774943e45531c3762b79b7b67cd23?s=128&d=identicon&r=PG&f=1", "display_name": "bkaankuguoglu", "link": "https://stackoverflow.com/users/5227605/bkaankuguoglu"}, "edited": false, "score": 0, "creation_date": 1499181577, "post_id": 44907984, "comment_id": 76795576, "body": "Thanks for the feedback! Before reading your comment I tried something else, which was pretty much avoiding the error, but it seems like it works in practice. I modified the error handler piece in the code as follows: <code>if err2 != nil &amp;&amp; err2 .Error() != &quot;gzip: invalid header&quot; { \t\tfmt.Println(&quot;error2: &quot;,err2) \t}</code>  and then I removed the line that removes the padding: <code>ciphertext = bytes.Trim(ciphertext, &quot;\\x00&quot;)</code> I&#39;m still confused how this works, to be honest. How likely is my approach to cause problems in the long run?"}, {"owner": {"reputation": 78348, "user_id": 1180620, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/FXaAg.jpg?s=128&g=1", "display_name": "Mark Adler", "link": "https://stackoverflow.com/users/1180620/mark-adler"}, "reply_to_user": {"reputation": 723, "user_id": 5227605, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5a9774943e45531c3762b79b7b67cd23?s=128&d=identicon&r=PG&f=1", "display_name": "bkaankuguoglu", "link": "https://stackoverflow.com/users/5227605/bkaankuguoglu"}, "edited": false, "score": 0, "creation_date": 1499182573, "post_id": 44907984, "comment_id": 76796174, "body": "That&#39;s a bad idea, since it will ignore a <i>real</i> invalid header error, where the data provided is not a gzip stream at all."}], "tags": [], "owner": {"reputation": 78348, "user_id": 1180620, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/FXaAg.jpg?s=128&g=1", "display_name": "Mark Adler", "link": "https://stackoverflow.com/users/1180620/mark-adler"}, "is_accepted": true, "score": 2, "last_activity_date": 1499176859, "creation_date": 1499176859, "answer_id": 44907984, "question_id": 44907323, "link": "https://stackoverflow.com/questions/44907323/golang-unexpected-eof-error-while-reading-gzip-reader/44907984#44907984", "title": "Golang: Unexpected EOF error while reading Gzip Reader", "body": "<p>When you think you're \"trimming the padding\", you're removing three zeros that belong on the end of the gzip stream. Just because it's a zero doesn't mean it's padding. Keep the three zeros after the 153.</p>\n\n<p>When you're not trimming the padding, a gzip decoder will look for another gzip stream after it successfully decompresses the first one. Seeing zeros instead of a gzip header results in the invalid gzip header error.</p>\n\n<p>You need to keep track of the size of the gzip stream, so that you know what's padding and what isn't. Or you can decode a gzip stream at a time, and when you see following zeros, you can conclude that that's padding.</p>\n"}], "owner": {"reputation": 723, "user_id": 5227605, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5a9774943e45531c3762b79b7b67cd23?s=128&d=identicon&r=PG&f=1", "display_name": "bkaankuguoglu", "link": "https://stackoverflow.com/users/5227605/bkaankuguoglu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1822, "favorite_count": 1, "accepted_answer_id": 44907984, "answer_count": 1, "score": 2, "last_activity_date": 1499176859, "creation_date": 1499174869, "question_id": 44907323, "link": "https://stackoverflow.com/questions/44907323/golang-unexpected-eof-error-while-reading-gzip-reader", "title": "Golang: Unexpected EOF error while reading Gzip Reader", "body": "<p>I'm currently working on a project in which a client python script compresses the input by using gzip package, then, encrypts the compressed data according to <code>AES</code>, and, finally, it encodes the encrypted data in <code>base64</code> encoding scheme. On the server side, which was written in <code>golang</code> I'm following the same steps in the reverse order to reach the original data. </p>\n\n<p>As can be seen from the output, I can decode, decrypt and decompress the data received from the client on my test script. However, while reading the <code>gzip.NewReader</code> type it throws <code>unexpected EOF error</code>. <em>(see the output at the very bottom of the question)</em></p>\n\n<p>So far, I've done it without trimming the padding, however, then it gave me an <code>invalid gzip header error</code>. Then, just to verify if there are any significant differences between a valid <code>gzip Reader</code> and the one being created by the script, I gzipped the original data into a compressed form. Apparently, there were no notable differences I could see from outputs, but the differences in bytes which were most likely caused by the change in time that the readers are created:</p>\n\n<blockquote>\n  <p>Original data: {\"i\": \"MB88\", \"p\": [{\"d\": [54.3, 0, 99, 49.35, 3, 99, 51.533, 1, 98, 28964, 7348, 43590, 97107, 10350, 55200, 49.7], \"t\": 1499089212.136789, \"dt\": \"p\"}]}</p>\n  \n  <p>Gzipped data: \"\\x1f\\x8b\\x08\\x00\\xf9w[Y\\x02\\xff%\\x8e=\\x0e\\xc30\\x08F\\xaf\\x82\\x98\\x91\\x05\\xe6\\xc7\\xa6c\\xf7\\x9e\\xa0\\xca\\x96\\xa5[\\x86lQ\\xee^\\xdcN\\xf0\\xf4\\xc1\\x83\\x0b?\\xf8\\x00|=\\xe7D\\x02&lt;\\n\\xde\\x17\\xee\\xab\\xb85%<code>\\x82L\\x02\\xcb\\xa6N\\xa0\\x7fri\\xae\\xd5K\\xe1$\\xe83\\xc3\\x08\\x86Z\\x81\\xa9g-y\\x88\\xf6\\x9a</code>\\xf5E\\xde\\x99\\x7f\\x96\\xb1\\xd5\\x99\\xb3\\xfcb\\x99\\x121D\\x1bG\\xe7^.\\xdcWPO\\xdc\\xdb\\xfd\\x05\\x0ev\\x15\\x1d\\x99\\x00\\x00\\x00\"</p>\n  \n  <p>Gzip Reader created from the request by client</p>\n  \n  <p>GzReader:  &amp;{{ [] 2017-07-03 15:40:12 +0200 CEST  255} 0xc42007e150 0xc4200a8000 0 0 [31 139 8 0 60 73 90 89 2 255 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]  true}</p>\n  \n  <p>Gzip Reader created by directly reading the original data</p>\n  \n  <p>GzReader2:  &amp;{{ [] 2017-07-04 13:11:53 +0200 CEST  255} 0xc4200741e0 0xc4200a9300 0 0 [31 139 8 0 249 119 91 89 2 255 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]  true}</p>\n</blockquote>\n\n<p>Now, I'm quite curious about what might be causing this error and how this issue can be solved. I couldn't post the original scripts here due to some restrictions but these are the actual test scripts that I'm currently testing my code. I've tried to give as much as information I could think of at the moment, however, please feel free to ask me if you need any more explanation. I'd really appreciate if you can help me solve this!</p>\n\n<p>Cheers!</p>\n\n<p><strong>Client Code (Tester):</strong>     </p>\n\n<pre><code>import time\nimport json\nimport requests\nimport random\nimport gzip\nimport base64\n\nfrom Crypto.Cipher import AES\n\nbaseurl = 'http://0.0.0.0:80'\nkey = b'TfvY7I358yospfWKcoviZizOShpm5hyH'\niv = b'mb13KcoviZizvYhp'\n\nMODE = AES.MODE_CFB\nBLOCK_SIZE = 16\nSEGMENT_SIZE = 128\n\n\ndef http_post(url, data):\n    print('Going to make a request to {} with the following data: {}'.format(url, data))\n    r = requests.post(url,\n                      data=data,\n                      headers={'Content-type': 'application/json; charset=utf-8',\n                               'Connection': 'keep-alive'}, )\n    if r.status_code != 200:\n        print('Server returned unexpected response code {}, and content: {}'.format(r.status_code, r.content))\n        return False\n    else:\n        data = r.json()\n        return data\n\n\ndef post_sample_data(key, iv):\n    fake_device_id = \"MB88\"\n    Load_VA_Total_Mean = random.randint(1000, 100000)\n    print('Data that should come back: {}'.format(Load_VA_Total_Mean))\n    data = {\"i\": fake_device_id, \"p\": [\n        {\"d\": [54.3, 0, 99, 49.35, 3, 99, 51.533, 1, 98, 28964, 7348, 43590, Load_VA_Total_Mean, 10350, 55200, 49.7],\n         \"t\": time.time(), \"dt\": \"p\"}]}\n    url = baseurl + '/realtimedata'\n    encryption_key_reference = 1\n    payload = '{}\\n{}'.format(convert_pack(data, key, iv), encryption_key_reference)\n    return http_post(url, payload)\n\n\ndef check_sample_request():\n    fake_device_id = \"MB88\"\n    url = baseurl + '/datapoints/powerzones/status'\n    data = [{\"name\": \"P1\", \"field\": \"Load_VA_Total_Mean\", \"devices\": [{\"id\": fake_device_id, \"multiplier\": 1}]}]\n    return http_post(url, json.dumps(data))\n\n\ndef convert_pack(inputdict, key, iv):\n    print('input: {}'.format(inputdict))\n    print('key: {}'.format(key))\n\n    jsonpayload = json.dumps(inputdict)  # encode dict to json string\n    print('json: {}'.format(jsonpayload))\n\n    gzippayload = gzip.compress(jsonpayload.encode('utf-8'))  # compress with gzip\n    print('gzip: {}'.format(gzippayload))\n\n    encryptedpayload = base64.b64encode(encrypt(key, iv, gzippayload))\n    print('encrypted: {}'.format(encryptedpayload))\n    return str(encryptedpayload, encoding='utf-8')    \n\n\ndef _pad_string(value):\n    length = len(value)\n    pad_size = BLOCK_SIZE - (length % BLOCK_SIZE)\n    return value.ljust(length + pad_size, b'\\x00')\n\n\ndef encrypt(key, iv, plaintext):\n    aes = AES.new(key, MODE, iv, segment_size=SEGMENT_SIZE)\n    plaintext = _pad_string(plaintext)\n    encrypted_text = aes.encrypt(plaintext)\n    return encrypted_text\n\n\npost_sample_data(key, iv)\ncheck_sample_request()\n</code></pre>\n\n<p><strong>Server Code (Tester):</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/aes\"\n    \"crypto/cipher\"\n    \"encoding/base64\"\n    \"fmt\"\n    \"compress/gzip\"\n    \"io/ioutil\"\n    \"bytes\"\n    \"strings\"\n)\n\nfunc main() {\n    //a sample input text generated by the client script\n    originalText := \"xhhpLqMJs4g8+8Hb751bcalljkeHDJfbGdMqr9E9im1OkiJzmdLr7pWv/Grh0+uzdeMQBMzefqzTrzetf1fZcBm93IEF6wl8WYE5x2uAZ5XY39bxlRWDt4cTNk/wWisbAMSzNJqQUq2UmqBLaWcI0LU1NGPZd8EKHK36Iwlp8NuP+YsQIJSmQdN2cvNFOLGv\"\n    fmt.Println(\"Original request: \", originalText)\n    key := []byte(\"TfvY7I358yospfWKcoviZizOShpm5hyH\")\n    text := decrypt(key, originalText)\n\n    gzReader, err1 := gzip.NewReader(bytes.NewReader(text))\n    fmt.Println(\"GzReader: \", gzReader) \n    if err1 != nil {\n        fmt.Println(\"error1: \", err1)\n    }\n\n    content, err2 := ioutil.ReadAll(gzReader)   \n    if err2 != nil {\n        fmt.Println(\"error2: \",err2)\n    }\n\n    fmt.Printf(\"\\nReading: \\n -&gt; Content in bytes: %v \\n -&gt; Content in string: %s\\n\", content, string(content)) \n}\n\nfunc decrypt(key []byte, cryptoText string) []byte {\n    ciphertext, _ := base64.StdEncoding.DecodeString(cryptoText)\n    fmt.Printf(\"\\nDecoding: \\n -&gt; Original: %v \\n -&gt; Decoded in bytes: %v \\n -&gt; Decoded in string: %s\\n\", cryptoText, ciphertext, ciphertext)\n    block, err := aes.NewCipher(key)\n    if err != nil {\n        panic(err)\n    }\n\n    iv := []byte(\"mb13KcoviZizvYhp\")    \n    stream := cipher.NewCFBDecrypter(block, iv)\n    stream.XORKeyStream(ciphertext, ciphertext)\n    fmt.Printf(\"\\nDecrypting: \\n -&gt; Decrypted in bytes: %v \\n -&gt; Decrypted in string: %s\\n\", ciphertext, ciphertext)\n\n    ciphertext = bytes.Trim(ciphertext, \"\\x00\")\n    fmt.Printf(\"\\nTrimming the padding: \\n -&gt; Decrypted in bytes: %v \\n -&gt; Decrypted in string: %s\\n\\n\", ciphertext, ciphertext)    \n    return ciphertext\n}\n</code></pre>\n\n<p><strong>The output in terminal:</strong></p>\n\n<blockquote>\n  <p>Original request:  </p>\n  \n  <p>xhhpLqMJs4g8+8Hb751bcalljkeHDJfbGdMqr9E9im1OkiJzmdLr7pWv/Grh0+uzdeMQBMzefqzTrzetf1fZcBm93IEF6wl8WYE5x2uAZ5XY39bxlRWDt4cTNk/wWisbAMSzNJqQUq2UmqBLaWcI0LU1NGPZd8EKHK36Iwlp8NuP+YsQIJSmQdN2cvNFOLGv</p>\n  \n  <p>Decoding: </p>\n  \n  <p>-> Original: xhhpLqMJs4g8+8Hb751bcalljkeHDJfbGdMqr9E9im1OkiJzmdLr7pWv/Grh0+uzdeMQBMzefqzTrzetf1fZcBm93IEF6wl8WYE5x2uAZ5XY39bxlRWDt4cTNk/wWisbAMSzNJqQUq2UmqBLaWcI0LU1NGPZd8EKHK36Iwlp8NuP+YsQIJSmQdN2cvNFOLGv </p>\n  \n  <p>-> Decoded in bytes: [198 24 105 46 163 9 179 136 60 251 193 219 239 157 91 113 169 101 142 71 135 12 151 219 25 211 42 175 209 61 138 109 78 146 34 115 153 210 235 238 149 175 252 106 225 211 235 179 117 227 16 4 204 222 126 172 211 175 55 173 127 87 217 112 25 189 220 129 5 235 9 124 89 129 57 199 107 128 103 149 216 223 214 241 149 21 131 183 135 19 54 79 240 90 43 27 0 196 179 52 154 144 82 173 148 154 160 75 105 103 8 208 181 53 52 99 217 119 193 10 28 173 250 35 9 105 240 219 143 249 139 16 32 148 166 65 211 118 114 243 69 56 177 175] </p>\n  \n  <p>-> Decoded in string: \ufffdi.\ufffd     \ufffd\ufffd&lt;\ufffd\ufffd\ufffd\ufffd[q\ufffde\ufffdG\ufffd\n                                                \ufffd\ufffd\ufffd*\ufffd\ufffd=\ufffdmN\ufffd\"s\ufffd\ufffd\ufffd\ue56f\ufffdj\ufffd\ufffd\ufffdu\ufffd\ufffd\ufffd~\ufffd\u04ef7\ufffdW\ufffdp\ufffd\u0701\ufffd    |Y\ufffd9\ufffdk\ufffdg\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd6O\ufffdZ+\u01334\ufffd\ufffdR\ufffd\ufffd\ufffd\ufffdKi\u043554c\ufffdw\ufffd\n  \ufffd\ufffd#     i\ufffd\u06cf\ufffd\ufffd \ufffd\ufffdA\ufffdvr\ufffdE8\ufffd\ufffd</p>\n  \n  <p>Decrypting: </p>\n  \n  <p>-> Decrypted in bytes: [31 139 8 0 60 73 90 89 2 255 37 142 49 14 2 65 8 69 175 66 168 201 4 6 88 192 210 222 19 152 237 182 177 179 176 219 236 221 101 180 130 151 15 15 78 124 225 13 240 113 207 68 2 124 55 60 79 60 86 113 27 74 192 4 85 4 86 67 157 64 255 228 50 92 187 151 198 36 152 89 155 17 132 90 131 169 215 90 10 225 232 9 86 111 114 159 204 63 75 236 125 230 211 126 177 42 206 154 50 135 232 22 217 90 60 86 208 79 92 251 245 5 234 198 128 61 153 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] \n  \ufffdq\ufffdD|7\n  \n  <p>Trimming the padding: </p>\n  \n  <p>-> Decrypted in bytes: [31 139 8 0 60 73 90 89 2 255 37 142 49 14 2 65 8 69 175 66 168 201 4 6 88 192 210 222 19 152 237 182 177 179 176 219 236 221 101 180 130 151 15 15 78 124 225 13 240 113 207 68 2 124 55 60 79 60 86 113 27 74 192 4 85 4 86 67 157 64 255 228 50 92 187 151 198 36 152 89 155 17 132 90 131 169 215 90 10 225 232 9 86 111 114 159 204 63 75 236 125 230 211 126 177 42 206 154 50 135 232 22 217 90 60 86 208 79 92 251 245 5 234 198 128 61 153] \n  \ufffdq\ufffdD|7\n  \n  <p>GzReader:  &amp;{{ [] 2017-07-03 15:40:12 +0200 CEST  255} 0xc42007e150 0xc4200a8000 0 0 [31 139 8 0 60 73 90 89 2 255 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]  true}</p>\n  \n  <p>error2:  unexpected EOF</p>\n  \n  <p>Reading:</p>\n  \n  <p>-> Content in bytes: [123 34 105 34 58 32 34 77 66 56 56 34 44 32 34 112 34 58 32 91 123 34 100 34 58 32 91 53 52 46 51 44 32 48 44 32 57 57 44 32 52 57 46 51 53 44 32 51 44 32 57 57 44 32 53 49 46 53 51 51 44 32 49 44 32 57 56 44 32 50 56 57 54 52 44 32 55 51 52 56 44 32 52 51 53 57 48 44 32 57 55 49 48 55 44 32 49 48 51 53 48 44 32 53 53 50 48 48 44 32 52 57 46 55 93 44 32 34 116 34 58 32 49 52 57 57 48 56 57 50 49 50 46 49 51 54 55 56 57 44 32 34 100 116 34 58 32 34 112 34 125 93 125] </p>\n  \n  <p>-> Content in string: {\"i\": \"MB88\", \"p\": [{\"d\": [54.3, 0, 99, 49.35, 3, 99, 51.533, 1, 98, 28964, 7348, 43590, 97107, 10350, 55200, 49.7], \"t\": 1499089212.136789, \"dt\": \"p\"}]}</p>\n</blockquote>\n"}, {"tags": ["macos", "go"], "comments": [{"owner": {"reputation": 4281, "user_id": 260574, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ooHys.png?s=128&g=1", "display_name": "n00b", "link": "https://stackoverflow.com/users/260574/n00b"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1499172389, "post_id": 44905618, "comment_id": 76789735, "body": "@JimB I don&#39;t think it&#39;s installed. My go installation via brew is 1.8.3. The version listed in /usr/local/go/VERSION is go1.7.3."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1499172751, "post_id": 44905618, "comment_id": 76790018, "body": "Run <code>go version</code>, and <code>go env</code>. You&#39;ve shown at least 2 versions, and if you&#39;re confused about what&#39;s running you should just clean out the old ones that aren&#39;t compatible anyway."}, {"owner": {"reputation": 4281, "user_id": 260574, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ooHys.png?s=128&g=1", "display_name": "n00b", "link": "https://stackoverflow.com/users/260574/n00b"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1499173045, "post_id": 44905618, "comment_id": 76790254, "body": "Ended up fixing it. Manually went through my utilities and isolated direnv (<a href=\"https://github.com/direnv/direnv\" rel=\"nofollow noreferrer\">github.com/direnv/direnv</a>) as the problematic utility. I must have compiled it using old Go version."}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499182882, "post_id": 44905618, "comment_id": 76796354, "body": "See <a href=\"https://github.com/golang/go/issues/20888\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/20888</a>"}, {"owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 0, "creation_date": 1557566388, "post_id": 44905618, "comment_id": 98814745, "body": "Please do confirm the go version. And make sure it should be <code>1.8.5</code> or higher."}], "answers": [{"tags": [], "owner": {"reputation": 138, "user_id": 4365856, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JcKcr.jpg?s=128&g=1", "display_name": "Joe Devine", "link": "https://stackoverflow.com/users/4365856/joe-devine"}, "is_accepted": false, "score": 0, "last_activity_date": 1556029769, "creation_date": 1556029769, "answer_id": 55813513, "question_id": 44905618, "link": "https://stackoverflow.com/questions/44905618/golang-error-in-terminal/55813513#55813513", "title": "Golang error in terminal", "body": "<p>Give <code>brew upgrade go</code> a try as this seems to be resolved in later versions, even if you didn't install with brew originally, the install path is the same so brew should solve it for you.</p>\n"}, {"tags": [], "owner": {"reputation": 4281, "user_id": 260574, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ooHys.png?s=128&g=1", "display_name": "n00b", "link": "https://stackoverflow.com/users/260574/n00b"}, "is_accepted": true, "score": 0, "last_activity_date": 1557713587, "creation_date": 1557713587, "answer_id": 56105020, "question_id": 44905618, "link": "https://stackoverflow.com/questions/44905618/golang-error-in-terminal/56105020#56105020", "title": "Golang error in terminal", "body": "<p>(Moving my comment as an answer to mark this question as resolved).</p>\n\n<p>Ended up fixing it. Manually went through my utilities and isolated direnv (github.com/direnv/direnv) as the problematic utility. I must have compiled it using old Go version.</p>\n"}], "owner": {"reputation": 4281, "user_id": 260574, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ooHys.png?s=128&g=1", "display_name": "n00b", "link": "https://stackoverflow.com/users/260574/n00b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 751, "favorite_count": 0, "accepted_answer_id": 56105020, "answer_count": 2, "score": 1, "last_activity_date": 1557713587, "creation_date": 1499170148, "question_id": 44905618, "link": "https://stackoverflow.com/questions/44905618/golang-error-in-terminal", "title": "Golang error in terminal", "body": "<p>I'm getting Golang errors in my OSX terminal when I press enter multiple times. There's a known issue with OSX Sierra and Golang version 1.4.2. I don't have Golang version 1.4.2 but the stacktrace is referring to that so my assumption is that there is an application somewhere using the old version. </p>\n\n<p>Is there a way I can enable verbose logging or find out the util/daemon that is causing the error? The stacktrace is below:</p>\n\n<pre><code>failed MSpanList_Insert 0x370000 0x672c197df0740 0x0\nfatal error: MSpanList_Insert\n\nruntime stack:\nruntime.throw(0x279a4b)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/panic.go:491 +0xad fp=0x7fff5fbff000 sp=0x7fff5fbfefd0\nruntime.MSpanList_Insert(0x298e28, 0x370000)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/mheap.c:692 +0x8f fp=0x7fff5fbff028 sp=0x7fff5fbff000\nMHeap_FreeSpanLocked(0x295a20, 0x370000, 0x100)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/mheap.c:583 +0x163 fp=0x7fff5fbff068 sp=0x7fff5fbff028\nMHeap_Grow(0x295a20, 0x8, 0x0)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/mheap.c:420 +0x1a8 fp=0x7fff5fbff0a8 sp=0x7fff5fbff068\nMHeap_AllocSpanLocked(0x295a20, 0x1, 0x0)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/mheap.c:298 +0x365 fp=0x7fff5fbff0e8 sp=0x7fff5fbff0a8\nmheap_alloc(0x295a20, 0x1, 0x12, 0x0)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/mheap.c:190 +0x121 fp=0x7fff5fbff110 sp=0x7fff5fbff0e8\nruntime.MHeap_Alloc(0x295a20, 0x1, 0x10000000012, 0x1f2e9)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/mheap.c:240 +0x66 fp=0x7fff5fbff148 sp=0x7fff5fbff110\nMCentral_Grow(0x29d798, 0x0)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/mcentral.c:197 +0x8b fp=0x7fff5fbff1b0 sp=0x7fff5fbff148\nruntime.MCentral_CacheSpan(0x29d798, 0x0)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/mcentral.c:85 +0x167 fp=0x7fff5fbff1e8 sp=0x7fff5fbff1b0\nruntime.MCache_Refill(0x36c000, 0x12, 0x0)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/mcache.c:90 +0xa0 fp=0x7fff5fbff210 sp=0x7fff5fbff1e8\nruntime.mcacheRefill_m()\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/malloc.c:368 +0x57 fp=0x7fff5fbff230 sp=0x7fff5fbff210\nruntime.onM(0x1f3ff8)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/asm_amd64.s:273 +0x9a fp=0x7fff5fbff238 sp=0x7fff5fbff230\nruntime.mallocgc(0x120, 0x198de0, 0x0, 0x0)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/malloc.go:178 +0x849 fp=0x7fff5fbff2e8 sp=0x7fff5fbff238\nruntime.newobject(0x198de0, 0x36c000)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/malloc.go:353 +0x49 fp=0x7fff5fbff310 sp=0x7fff5fbff2e8\nruntime.newG(0x3645a)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/proc.go:233 +0x2a fp=0x7fff5fbff328 sp=0x7fff5fbff310\nallocg(0x288380)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/proc.c:925 +0x1f fp=0x7fff5fbff338 sp=0x7fff5fbff328\nruntime.malg(0x8000, 0x288420)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/proc.c:2106 +0x1f fp=0x7fff5fbff368 sp=0x7fff5fbff338\nruntime.mpreinit(0x2887e0)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/os_darwin.c:137 +0x27 fp=0x7fff5fbff380 sp=0x7fff5fbff368\nmcommoninit(0x2887e0)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/proc.c:201 +0xc9 fp=0x7fff5fbff3a8 sp=0x7fff5fbff380\nruntime.schedinit()\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/proc.c:138 +0x55 fp=0x7fff5fbff3d0 sp=0x7fff5fbff3a8\nruntime.rt0_go(0x7fff5fbff408, 0x3, 0x7fff5fbff408, 0x0, 0x0, 0x3, 0x7fff5fbff608, 0x7fff5fbff60f, 0x7fff5fbff616, 0x0, ...)\n    /usr/local/Cellar/go/1.4.2/libexec/src/runtime/asm_amd64.s:95 +0x116 fp=0x7fff5fbff3d8 sp=0x7fff5fbff3d0\n</code></pre>\n"}, {"tags": ["pointers", "go", "interface", "go-templates", "go-interface"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1499169782, "post_id": 44905386, "comment_id": 76787893, "body": "It seems as if you know the actual type: Just type assert to that type and do whatever this type supports. If not: Full code you must show. BTW: Get rid of the empty <code>interface{}</code> and your code will be simpler."}, {"owner": {"reputation": 2696, "user_id": 1564840, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7374a0927a35e40deae799aa83977a1e?s=128&d=identicon&r=PG", "display_name": "Pascut", "link": "https://stackoverflow.com/users/1564840/pascut"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1499169871, "post_id": 44905386, "comment_id": 76787952, "body": "I can&#39;t just remove the interface{} because on each page the parameter type will be different. interface{} was the option that allowed me to accept all kind of arguments."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1499262451, "post_id": 44905386, "comment_id": 76831644, "body": "This has already been answered well but I wanted to suggest that maybe you should add a <code>SetHeaderCSS</code> method and pass in a <code>HeaderCSSSetter</code> interface that specifies that method. This would eliminate <i>all of the reflection</i> with a simple change, giving you better performance, better readability, and compile-time type safety."}, {"owner": {"reputation": 2696, "user_id": 1564840, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7374a0927a35e40deae799aa83977a1e?s=128&d=identicon&r=PG", "display_name": "Pascut", "link": "https://stackoverflow.com/users/1564840/pascut"}, "edited": false, "score": 0, "creation_date": 1499262898, "post_id": 44905386, "comment_id": 76831974, "body": "Good idea. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 2696, "user_id": 1564840, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7374a0927a35e40deae799aa83977a1e?s=128&d=identicon&r=PG", "display_name": "Pascut", "link": "https://stackoverflow.com/users/1564840/pascut"}, "edited": false, "score": 0, "creation_date": 1499171475, "post_id": 44905592, "comment_id": 76789107, "body": "Goog example. I edited my question, I added struct details. In my case I have a struct that extends another struct. Can you figure a way to make it work on that example also?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2696, "user_id": 1564840, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7374a0927a35e40deae799aa83977a1e?s=128&d=identicon&r=PG", "display_name": "Pascut", "link": "https://stackoverflow.com/users/1564840/pascut"}, "edited": false, "score": 1, "creation_date": 1499172059, "post_id": 44905592, "comment_id": 76789510, "body": "@Pascut But if you know the type, just use type assertion, it&#39;s much more easier. See edited answer again."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1499172229, "last_edit_date": 1499172229, "creation_date": 1499170080, "answer_id": 44905592, "question_id": 44905386, "link": "https://stackoverflow.com/questions/44905386/how-to-set-an-interface-parameter-by-reference/44905592#44905592", "title": "How to set an interface{} parameter by reference?", "body": "<p>Don't pass a pointer to interface. Instead the <code>interface{}</code> value should contain the pointer. And simply just hand over this <code>interface{}</code> value:</p>\n\n<pre><code>func LoadTemplate(templateData interface) {\n  appendCustomData(templateData)\n  ... //other functionality that is not relevant\n}\n</code></pre>\n\n<p>Even if you can't use a more concrete type than <code>interface{}</code> (because you must allow multiple types), you can still use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>, it will be \"super\" easy:</p>\n\n<pre><code>func appendCustomData(d interface{}) {\n    if ps, ok := d.(*pageStruct); ok {\n        ps.TemplateData.HeaderCSS += \"+new\"\n    }\n\n}\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/7c7ctLx4mf\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>If you must or want to use reflection, this is how <code>appendCustomData()</code> can be implemented:</p>\n\n<pre><code>type Data struct {\n    Name  string\n    Age   int\n    Marks []int\n}\n\nfunc appendCustomData(d interface{}) {\n    v := reflect.ValueOf(d).Elem()\n\n    if f := v.FieldByName(\"Name\"); f.IsValid() {\n        f.SetString(f.Interface().(string) + \"2\")\n    }\n\n    if f := v.FieldByName(\"Age\"); f.IsValid() {\n        f.SetInt(f.Int() + 2)\n    }\n\n    if f := v.FieldByName(\"Marks\"); f.IsValid() {\n        f.Set(reflect.ValueOf(append(f.Interface().([]int), 2)))\n    }\n\n    if f := v.FieldByName(\"Invalid\"); f.IsValid() {\n        f.Set(reflect.ValueOf(append(f.Interface().([]int), 2)))\n    }\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>d := &amp;Data{\n    Name:  \"Bob\",\n    Age:   22,\n    Marks: []int{5, 4, 3},\n}\nfmt.Printf(\"%+v\\n\", d)\nappendCustomData(d)\nfmt.Printf(\"%+v\\n\", d)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/ggvUqNV6IO\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&amp;{Name:Bob Age:22 Marks:[5 4 3]}\n&amp;{Name:Bob2 Age:24 Marks:[5 4 3 2]}\n</code></pre>\n\n<p><strong>Update:</strong></p>\n\n<p>To answer your edited question: there is no difference when the value passed is a struct that embeds another struct. But the value wrapped in the <code>interface{}</code> still must be a pointer.</p>\n\n<p>Example <code>appendCustomData()</code> that appends content to <code>pageStruct.TemplateData.HeaderCSS</code>:</p>\n\n<pre><code>func appendCustomData(d interface{}) {\n    v := reflect.ValueOf(d).Elem()\n\n    if f := v.FieldByName(\"TemplateData\"); f.IsValid() {\n        if f = f.FieldByName(\"HeaderCSS\"); f.IsValid() {\n            f.Set(reflect.ValueOf(f.Interface().(template.HTML) + \"+new\"))\n        }\n    }\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>ps := &amp;pageStruct{\n    TemplateData: TemplateData{\n        HeaderCSS: template.HTML(\"old\"),\n    },\n}\nfmt.Printf(\"%+v\\n\", ps)\nappendCustomData(ps)\nfmt.Printf(\"%+v\\n\", ps)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/qLNAnV2OxL\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&amp;{TemplateData:{FooterJS: HeaderJS: HeaderCSS:old} Form:}\n&amp;{TemplateData:{FooterJS: HeaderJS: HeaderCSS:old+new} Form:}\n</code></pre>\n"}], "owner": {"reputation": 2696, "user_id": 1564840, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7374a0927a35e40deae799aa83977a1e?s=128&d=identicon&r=PG", "display_name": "Pascut", "link": "https://stackoverflow.com/users/1564840/pascut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1543, "favorite_count": 0, "accepted_answer_id": 44905592, "answer_count": 1, "score": 1, "last_activity_date": 1499172229, "creation_date": 1499169416, "last_edit_date": 1499171422, "question_id": 44905386, "link": "https://stackoverflow.com/questions/44905386/how-to-set-an-interface-parameter-by-reference", "title": "How to set an interface{} parameter by reference?", "body": "<p>I have a function that has a parameter with the type <code>interface{}</code>. This parameter represents my template data. So on each page it stores different data types (mostly structs). I want to append some data to this parameter's data, but it's an <code>interface{}</code> type and I can't do it. </p>\n\n<p>This is what I tried:</p>\n\n<pre><code>func LoadTemplate(templateData interface) {\n  appendCustomData(&amp;templateData)\n  ... //other functionality that is not relevant\n}\n\nfunc appendCustomData(dst interface{}) {\n    // ValueOf to enter reflect-land\n    dstPtrValue := reflect.ValueOf(dst)\n    // need the type to create a value\n    dstPtrType := dstPtrValue.Type()\n    // *T -&gt; T, crashes if not a ptr\n    dstType := dstPtrType.Elem()\n    // the *dst in *dst = zero\n    dstValue := reflect.Indirect(dstPtrValue)\n    // the zero in *dst = zero\n    zeroValue := reflect.Zero(dstType)\n    // the = in *dst = 0\n\n    v := reflect.ValueOf(dst).Elem().Elem().FieldByName(\"HeaderCSS\")\n    if v.IsValid() {\n        v = reflect.ValueOf(\"new header css value\")\n    }\n\n    reflect.ValueOf(dst).Elem().Elem().FieldByName(\"HeaderCSS\").Set(reflect.ValueOf(v))\n\n    //dstValue.Set(zeroValue)\n    fmt.Println(\"new dstValue: \", dstValue)\n}\n</code></pre>\n\n<p>I can successfully get the <code>\"HeaderCSS\"</code> value. But I can't replace it with another value. What am I doing wrong?</p>\n\n<p>My templateData looks like this:</p>\n\n<p>I have a generic struct:</p>\n\n<pre><code>type TemplateData struct {\n    FooterJS template.HTML\n    HeaderJS template.HTML\n    HeaderCSS template.HTML\n    //and some more\n}\n</code></pre>\n\n<p>and I have another struct, such as:</p>\n\n<pre><code>type pageStruct struct {\n    TemplateData //extends the previous struct\n    Form template.HTML\n    // and some other maps/string\n}\n</code></pre>\n\n<p>I send this second struct as templateData argument.</p>\n\n<p>Right now I get this error:</p>\n\n<blockquote>\n  <p>\"reflect.Value.Set using unaddressable value\" at the line: reflect.ValueOf(dst).Elem().Elem().FieldByName(\"HeaderCSS\").Set(reflect.ValueOf(v))</p>\n</blockquote>\n\n<p>The code from above is inspired from this answer: <a href=\"https://stackoverflow.com/a/26824071/1564840\">https://stackoverflow.com/a/26824071/1564840</a></p>\n\n<p>I want to be able to append/edit values from this interface. Any idea how can I do it? Thanks.</p>\n"}, {"tags": ["mongodb", "go", "mongodb-query", "mgo"], "comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 1, "creation_date": 1499162867, "post_id": 44902874, "comment_id": 76782995, "body": "You are missing a <code>$</code>. So should be <code>$eq&quot;: [&quot;$$file.name&quot;,&quot;abc.xyz&quot;]</code> where it&#39;s <code>$$file</code> instead of <code>$file</code>. Also whilst this does work, it&#39;s actually not what you &quot;should&quot; be doing. The problem here is <code>$lookup</code> is returning &quot;all&quot; the documents matched by the foreign key, as opposed to also matching your given condition. In small result sets this is okay. But in real world cases you should do this differently."}, {"owner": {"reputation": 1, "user_id": 5288651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e78a88d2af6f41caf2d8ab422f09037?s=128&d=identicon&r=PG", "display_name": "Ganesh", "link": "https://stackoverflow.com/users/5288651/ganesh"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1499163067, "post_id": 44902874, "comment_id": 76783119, "body": "Please let me know how to do it differently? I am new to mongoDB and your suggestions will be appreciated"}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 1, "creation_date": 1499163758, "post_id": 44902874, "comment_id": 76783565, "body": "Read <a href=\"https://stackoverflow.com/questions/44888354/get-filtered-count-of-elements-in-array-from-lookup-along-with-the-whole-docume/44897438#44897438\">Get filtered count of elements in array from $lookup along with the whole document</a>. Just answered and it explains the correct way to filter the array as a result of <code>$lookup</code>."}], "answers": [{"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 0, "last_activity_date": 1499234325, "creation_date": 1499234325, "answer_id": 44918029, "question_id": 44902874, "link": "https://stackoverflow.com/questions/44902874/mongo-how-to-join-two-collection-and-add-condition-on-second-collection/44918029#44918029", "title": "Mongo how to join two collection and add condition on second collection", "body": "<blockquote>\n  <p>I want to find all the files whose file name \"abc.xyz\" \u2026 but getting all the files belong to user and not filtering it by name \"abc.xyz\"</p>\n</blockquote>\n\n<p>Based on your question above, it could also be interpreted as \"Find all files with name <code>abc.xyz</code> along with its owner information\". </p>\n\n<p>In which case, it would be better to filter the files collection first using <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/match/\" rel=\"nofollow noreferrer\">$match</a> to filter file name equal to <code>abc.xyz</code>. This would limit the number of documents to look-up into <code>users</code> collection, instead of perfoming lookup for both collections then perform filtering. </p>\n\n<p>For example: </p>\n\n<pre><code>db.files.aggregate([\n    {\"$match\": {\"name\":\"abc.xyz\"}},\n    {\"$lookup\": {\n                \"from\": \"users\", \n                \"localField\": \"userId\", \n                \"foreignField\": \"_id\", \n                \"as\": \"users\"\n                 }\n     }]);\n</code></pre>\n\n<p>Please note that the collection is now reversed, from <code>files</code> looking up into <code>users</code>. An example result would be: </p>\n\n<pre><code>  \"result\": [\n    {\n      \"_id\": 111,\n      \"userId\": 999,\n      \"name\": \"abc.xyz\",\n      \"owner\": [\n        {\n          \"_id\": 999,\n          \"name\": \"xmejx\"\n        }\n      ]\n    },\n    {\n      \"_id\": 222,\n      \"userId\": 998,\n      \"name\": \"abc.xyz\",\n      \"owner\": [\n        {\n          \"_id\": 998,\n          \"name\": \"kalwb\"\n        }\n      ]\n    }\n  ]\n</code></pre>\n\n<p>I would also recommend to check out: </p>\n\n<ul>\n<li><a href=\"https://docs.mongodb.com/manual/applications/data-models/\" rel=\"nofollow noreferrer\">Data Model Examples with Patterns</a> </li>\n<li><a href=\"https://docs.mongodb.com/manual/core/aggregation-pipeline-optimization/\" rel=\"nofollow noreferrer\">Aggregation Pipeline Optimisation</a></li>\n</ul>\n"}], "owner": {"reputation": 1, "user_id": 5288651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e78a88d2af6f41caf2d8ab422f09037?s=128&d=identicon&r=PG", "display_name": "Ganesh", "link": "https://stackoverflow.com/users/5288651/ganesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1717, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1499234325, "creation_date": 1499162545, "question_id": 44902874, "link": "https://stackoverflow.com/questions/44902874/mongo-how-to-join-two-collection-and-add-condition-on-second-collection", "title": "Mongo how to join two collection and add condition on second collection", "body": "<p>I have two collections \nusers{id, name} and files{id, userId, name} I want to find all the files whose file name \"abc.xyz\", I tried to write a code using $lookup but getting all the files belong to user and not filtering it by name  \"abc.xyz\", I have written following query. </p>\n\n<pre><code>db.user.aggregate([\n{\"$lookup\": \n    {\n        \"from\": \"files\", \n        \"localField\": \"id\", \n        \"foreignField\": \"userId\", \n        \"as\": \"fileList\"\n    }\n},\n{\"$project\": { \"filList\":{\n    \"$filter\": {\n                    \"input\":\"$fileList\",\n                    \"as\":\"file\"\n                    \"cond\": {\"$eq\": [\"$file.name\",\"abc.xyz\"]}\n           }\n             }\n         }\n}\n])\n</code></pre>\n\n<p>Thank you</p>\n"}, {"tags": ["git", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1499168414, "post_id": 44902378, "comment_id": 76786809, "body": "What is the output of <code>go get -v golang.org&#47;x&#47;text&#47;language</code>?"}, {"owner": {"reputation": 1953, "user_id": 877324, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/39796a9a10b92a4530fe3d00f4355ae2?s=128&d=identicon&r=PG", "display_name": "BumbleGee", "link": "https://stackoverflow.com/users/877324/bumblegee"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1499169247, "post_id": 44902378, "comment_id": 76787480, "body": "Just added the output to the original question, @icza"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499183260, "post_id": 44902378, "comment_id": 76796568, "body": "Did you try <code>git config --global http.https:&#47;&#47;go.googlesource.com.followRedirects true</code> ?"}, {"owner": {"reputation": 1953, "user_id": 877324, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/39796a9a10b92a4530fe3d00f4355ae2?s=128&d=identicon&r=PG", "display_name": "BumbleGee", "link": "https://stackoverflow.com/users/877324/bumblegee"}, "reply_to_user": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499239244, "post_id": 44902378, "comment_id": 76814674, "body": "I have now @mattn - thanks for the tip. Unfortunately, that didn&#39;t change anything for me. I&#39;m on a rather old git installation (1.7.11) and AFAIK, git stopped following redirects in a later version, didn&#39;t it?"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499242720, "post_id": 44902378, "comment_id": 76817016, "body": "Hmm, I have no idea. Sorry."}, {"owner": {"reputation": 594, "user_id": 1054114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc175ba42a40a2cd3d3ba24910f9bfa1?s=128&d=identicon&r=PG", "display_name": "orirawlings", "link": "https://stackoverflow.com/users/1054114/orirawlings"}, "edited": false, "score": 0, "creation_date": 1501683421, "post_id": 44902378, "comment_id": 77887387, "body": "What is the output of <code>wget https:&#47;&#47;go.googlesource.com&#47;text&#47;info&#47;refs</code>? Seems like maybe the first request is succeeding with 200 OK, but the request to look up the refs might be failing separately."}], "owner": {"reputation": 1953, "user_id": 877324, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/39796a9a10b92a4530fe3d00f4355ae2?s=128&d=identicon&r=PG", "display_name": "BumbleGee", "link": "https://stackoverflow.com/users/877324/bumblegee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1005, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1499169215, "creation_date": 1499161220, "last_edit_date": 1499169215, "question_id": 44902378, "link": "https://stackoverflow.com/questions/44902378/git-clone-for-go-googlesource-com-fails-on-machine-behind-proxy", "title": "git clone for go.googlesource.com fails on machine behind proxy", "body": "<p>I'm trying to clone go package (golang.org/x/text/language, stored on go.googlesource.com) on a RHEL6 server behind a corporate proxy but the go get command fails:</p>\n\n<pre><code>&gt; go get -v golang.org/x/text/language\nFetching https://golang.org/x/text/language?go-get=1\nParsing meta tags from https://golang.org/x/text/language?go-get=1 (status code 200)\nget \"golang.org/x/text/language\": found meta tag main.metaImport{Prefix:\"golang.org/x/text\", VCS:\"git\", RepoRoot:\"https://go.googlesource.com/text\"} at https://golang.org/x/text/language?go-get=1\nget \"golang.org/x/text/language\": verifying non-authoritative meta tag\nFetching https://golang.org/x/text?go-get=1\nParsing meta tags from https://golang.org/x/text?go-get=1 (status code 200)\ngolang.org/x/text (download)\n# cd .; git clone https://go.googlesource.com/text /local/home/me/dev/src/golang.org/x/text\nCloning into '/local/home/me/dev/src/golang.org/x/text'...\nerror: HTTP response code said error while accessing https://go.googlesource.com/text/info/refs\nfatal: HTTP request failed\npackage golang.org/x/text/language: exit status 128\n</code></pre>\n\n<p>I'm pretty sure this is related to git not being able to clone as the following command also fails:</p>\n\n<pre><code>git clone --verbose https://go.googlesource.com/text\nCloning into 'text'...\nerror: HTTP response code said error while accessing https://go.googlesource.com/text/info/refs\nfatal: HTTP request failed\n</code></pre>\n\n<p>I have set proxies both in my shell environment and for git (http and https) and they are working, as you can see here:</p>\n\n<pre><code>wget https://go.googlesource.com/text\n--2017-07-04 11:17:15--  https://go.googlesource.com/text\nResolving our.proxy.host ... 10.4.xxx.xxx\nConnecting to our.proxy.host|10.4.xxx.xxx|:8080... connected.\nProxy request sent, awaiting response... 200 OK\nLength: unspecified [text/html]\nSaving to: \u201ctext\u201d\n\n    [ &lt;=&gt;                                                                               ] 11,014      --.-K/s   in 0.02s\n\n2017-07-04 11:17:15 (622 KB/s) - \u201ctext\u201d saved [11014]\n</code></pre>\n\n<p>go get also seems to work fine, as I'm not getting any problems executing</p>\n\n<pre><code>go get github.com/stretch/testify\n</code></pre>\n\n<p>Any clues as to what might be the problem are greatly appreciated.</p>\n\n<p>Thanks in advance,\nGeorg</p>\n"}, {"tags": ["pointers", "go", "types", "interface", "null"], "comments": [{"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 0, "creation_date": 1499155639, "post_id": 44900065, "comment_id": 76778201, "body": "You are right .. let look at documentation: <a href=\"https://golang.org/pkg/reflect/#DeepEqual\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect/#DeepEqual</a> . At first paragraph is answer to your question -  Values of distinct types are never deeply equal. And rest of the answer is here <a href=\"https://golang.org/doc/faq#nil_error\" rel=\"nofollow noreferrer\">golang.org/doc/faq#nil_error</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1123, "user_id": 1595197, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AQsPO.jpg?s=128&g=1", "display_name": "Sander", "link": "https://stackoverflow.com/users/1595197/sander"}, "edited": false, "score": 0, "creation_date": 1499156733, "post_id": 44900370, "comment_id": 76778848, "body": "Thanks for the link on interfaces, I learned something new today!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1499156097, "last_edit_date": 1499156097, "creation_date": 1499155631, "answer_id": 44900370, "question_id": 44900065, "link": "https://stackoverflow.com/questions/44900065/nil-pointer-to-struct-not-deep-equal-to-nil/44900370#44900370", "title": "Nil pointer to struct not deep equal to nil?", "body": "<p>Everything you pass to <a href=\"https://golang.org/pkg/reflect/#DeepEqual\" rel=\"nofollow noreferrer\"><code>reflect.DeepEqual()</code></a> is wrapped in an <code>interface{}</code> value (if it's not already that):</p>\n\n<pre><code>func DeepEqual(x, y interface{}) bool\n</code></pre>\n\n<p><code>interface{}</code> values will be compared, where the first parameter value <strong>is not <code>nil</code></strong>, only the value wrapped in it.</p>\n\n<p>An interface value is represented as a <code>(type; value)</code> pair. The first value you pass to <code>reflect.DeepEqual()</code> is a pair of <code>(type; value)</code> being <code>(*Obj, nil)</code>, and the 2nd value is <code>nil</code>. They are not equal. The second value lacks type information.</p>\n\n<p>If you compare it to a \"typed\" <code>nil</code>, it will be <code>true</code>:</p>\n\n<pre><code>reflect.DeepEqual(c.O, (*Obj)(nil)) // This is true\n</code></pre>\n\n<p>See this example:</p>\n\n<pre><code>fmt.Println(\"c.O:\", c.O)\nfmt.Println(\"c.O == nil:\", c.O == nil)\nfmt.Println(\"c.O deep equal to nil:\", reflect.DeepEqual(c.O, nil))\nfmt.Println(\"c.O deep equal to (*Obj)(nil):\", reflect.DeepEqual(c.O, (*Obj)(nil)))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/vqXVOZpxNN\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>c.O: &lt;nil&gt;\nc.O == nil: true\nc.O deep equal to nil: false\nc.O deep equal to (*Obj)(nil): true\n</code></pre>\n\n<p>See this question for a deeper insight:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/29138591/hiding-nil-values-understanding-why-golang-fails-here/29138676#29138676\">Hiding nil values, understanding why golang fails here</a></p>\n\n<p>If you want to check if the value wrapped inside a non-<code>nil</code> interface is <code>nil</code>, you can use reflection: <a href=\"https://golang.org/pkg/reflect/#Value.IsNil\" rel=\"nofollow noreferrer\">reflect.Value.IsNil()</a>.</p>\n\n<p>For more details see: <a href=\"https://stackoverflow.com/questions/43895862/why-interface-type-doesnt-provide-an-isnil-method/43896204#43896204\">Why interface type doesn&#39;t provide an &quot;IsNil&quot; method?</a></p>\n"}], "owner": {"reputation": 1123, "user_id": 1595197, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AQsPO.jpg?s=128&g=1", "display_name": "Sander", "link": "https://stackoverflow.com/users/1595197/sander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1479, "favorite_count": 0, "accepted_answer_id": 44900370, "answer_count": 1, "score": 4, "last_activity_date": 1499156097, "creation_date": 1499154708, "last_edit_date": 1499155998, "question_id": 44900065, "link": "https://stackoverflow.com/questions/44900065/nil-pointer-to-struct-not-deep-equal-to-nil", "title": "Nil pointer to struct not deep equal to nil?", "body": "<p>If I have a struct containing a <code>nil</code> pointer of type <code>A</code>, using <code>reflect.DeepEqual</code> to check if that property is <code>nil</code> will result in <code>false</code>, which strikes me as odd behaviour.</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>type Container struct {\n    O *Obj\n}\n\ntype Obj struct {\n    Message string\n}\n\nvar c Container\neq := reflect.DeepEqual(c.O, nil)\nfmt.Printf(\"O value: %v, is nil: %t\", c.O, eq)\n// Prints: \"O value: &lt;nil&gt;, is nil: false\"\n</code></pre>\n\n<p>Specifically, I am marshaling a JSON object into a struct, where I would like to test that a specific property is <code>nil</code> when the corresponding JSON structure does not contain it. If <code>reflect.DeepEqual</code> is not the way to go, how should I do this?</p>\n"}, {"tags": ["variables", "go", "scope", "initialization"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1499151764, "last_edit_date": 1499151764, "creation_date": 1499151307, "answer_id": 44898907, "question_id": 44898833, "link": "https://stackoverflow.com/questions/44898833/variable-init-in-go/44898907#44898907", "title": "Variable init in Go", "body": "<p>They are equivalent.</p>\n\n<p>The <code>{...}</code> block has nothing to do with the variable declaration with the <code>var</code> keyword. It just happens to be written one after the other.</p>\n\n<p>The <code>{...}</code> is a simple <a href=\"https://golang.org/ref/spec#Blocks\" rel=\"nofollow noreferrer\">block</a>, nothing else. The <code>var</code> declaration does not require that block, and even if there is one, it is not related to the variable declaration. You can insert a block wherever you would insert a statement.</p>\n\n<p>The rare case when an explicit block is used (when there isn't required one) is to group statements, and to control the scope of the variables and other identifiers declared inside them, because the scope of the variables end at the end of the innermost containing block (<a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">Spec: Declarations and Scope</a>).</p>\n"}, {"comments": [{"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1499152449, "post_id": 44898923, "comment_id": 76775957, "body": "Code like that is usually a good indication you need to split the function in two."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1499152500, "post_id": 44898923, "comment_id": 76775987, "body": "Yes, it often \u2013 though not necessarily always \u2013 is @Schwern"}], "tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": true, "score": 2, "last_activity_date": 1499151340, "creation_date": 1499151340, "answer_id": 44898923, "question_id": 44898833, "link": "https://stackoverflow.com/questions/44898833/variable-init-in-go/44898923#44898923", "title": "Variable init in Go", "body": "<p>Adding a new block will create a new variable scope, and variables declared in that block will not be available outside of it:</p>\n\n<pre><code>var endpoints s.Endpoints\n{\n    repository := acl.NewRepository(db)\n    service := stat.NewService(repository)\n    endpoints = s.Endpoints{\n        GetEndpoint: s.MakeEndpoint(service),\n    }\n}\n\n// service and repository  variables are not defined here!\n</code></pre>\n\n<p>In your specific simplified example it makes little sense, but if you have other blocks with the same variables it makes more sense. For example:</p>\n\n<pre><code>var endpoints s.Endpoints\n{\n    repository := acl.NewRepository(db)\n    service := stat.NewService(repository)\n    endpoints = s.Endpoints{\n        GetEndpoint: s.MakeEndpoint(service),\n    }\n}\n\n // Get another repository\n{\n    repository := otherRepo.NewRepository(db)\n    repository.DoSomething()\n}\n</code></pre>\n\n<hr>\n\n<p>Some people consider this \"good hygiene\". Personally, I don't think it's worth the decrease in readability.</p>\n"}], "owner": {"reputation": 7265, "user_id": 3457177, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bae2e85ed6794ece744ee124d9ac7842?s=128&d=identicon&r=PG&f=1", "display_name": "Vitalii", "link": "https://stackoverflow.com/users/3457177/vitalii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 44898923, "answer_count": 2, "score": 1, "last_activity_date": 1499156247, "creation_date": 1499151095, "last_edit_date": 1499156247, "question_id": 44898833, "link": "https://stackoverflow.com/questions/44898833/variable-init-in-go", "title": "Variable init in Go", "body": "<p>I see following code (I simplified it a bit).</p>\n\n<pre><code>func getEndpoints(db *sqlx.DB) s.Endpoints {\n    var endpoints s.Endpoints\n    {\n        repository := acl.NewRepository(db)\n        service := stat.NewService(repository)\n        endpoints = s.Endpoints{\n            GetEndpoint: s.MakeEndpoint(service),\n        }\n    }\n\n    return endpoints \n}\n</code></pre>\n\n<p>If I understand this code correctly, code inside <code>var endpoints s.Endpoints{...}</code> is executed line by line and <code>endpoints = s.Endpoints ...</code> line initialises <code>var endpoints</code> variable declared above.</p>\n\n<p>I suppose that it's correct to rewrite it like this (correct me if I'm wrong):</p>\n\n<pre><code>func getEndpoints(db *sqlx.DB) s.Endpoints {\n\n    repository := acl.NewRepository(db)\n    service := stat.NewService(repository)\n    endpoints := s.Endpoints{\n        GetEndpoint: s.MakeEndpoint(service),\n    }\n\n    return endpoints \n}\n</code></pre>\n\n<p>So can somebody explain me why initialisation is written inside <code>var endpoints s.Endpoints{...}</code>. Is there any idea to do it like this? Am I missing something? </p>\n"}, {"tags": ["python", "python-2.7", "go", "grumpy"], "comments": [{"owner": {"reputation": 3009, "user_id": 3105954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/l1Ql1.jpg?s=128&g=1", "display_name": "Raptor", "link": "https://stackoverflow.com/users/3105954/raptor"}, "edited": false, "score": 0, "creation_date": 1499781532, "post_id": 44897218, "comment_id": 77047289, "body": "So far all I could find is this: <a href=\"https://github.com/google/grumpy/issues/43#issuecomment-289665238\" rel=\"nofollow noreferrer\">github.com/google/grumpy/issues/43#issuecomment-289665238</a>"}], "answers": [{"comments": [{"owner": {"reputation": 40406, "user_id": 459, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0db193fbf6f0929c49dd9704698204ff?s=128&d=identicon&r=PG", "display_name": "dlamblin", "link": "https://stackoverflow.com/users/459/dlamblin"}, "edited": false, "score": 0, "creation_date": 1527142665, "post_id": 50501834, "comment_id": 88016757, "body": "in the case of util.py in this package, I was able to take out the uses of <code>locale</code> and found <code>io</code> used in a block that should only run in python3, and removed that too. Then <code>grumpc -modname=pyments.util util.py &gt;util&#47;module.go</code> worked."}], "tags": [], "owner": {"reputation": 40406, "user_id": 459, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0db193fbf6f0929c49dd9704698204ff?s=128&d=identicon&r=PG", "display_name": "dlamblin", "link": "https://stackoverflow.com/users/459/dlamblin"}, "is_accepted": false, "score": 1, "last_activity_date": 1527145620, "last_edit_date": 1527145620, "creation_date": 1527140809, "answer_id": 50501834, "question_id": 44897218, "link": "https://stackoverflow.com/questions/44897218/install-a-python-package-in-grumpy/50501834#50501834", "title": "Install a python package in Grumpy", "body": "<p>Well... unlike what the readme says, there's a good amount of the <a href=\"https://github.com/google/grumpy/wiki/Missing-features\" rel=\"nofollow noreferrer\">standard library missing</a>. So more than likely you cannot.</p>\n\n<p>Here's my process for trying to turn <code>pygments</code> into an executable with go. It failed by the way. It is basically a manual process to take a package and make it build with go using Grumpy.</p>\n\n<p>I went to <a href=\"https://pypi.org/project/Pygments/#files\" rel=\"nofollow noreferrer\">pypi</a> and got the <a href=\"https://files.pythonhosted.org/packages/71/2a/2e4e77803a8bd6408a2903340ac498cb0a2181811af7c9ec92cb70b0308a/Pygments-2.2.0.tar.gz\" rel=\"nofollow noreferrer\">Pygments tar</a>.</p>\n\n<p>I followed the <a href=\"https://github.com/google/grumpy#method-2-grumpc-and-grumprun\" rel=\"nofollow noreferrer\">readme's</a>:</p>\n\n<pre><code>make\nexport PATH=$PWD/build/bin:$PATH\nexport GOPATH=$PWD/build\nexport PYTHONPATH=$PWD/build/lib/python2.7/site-packages\n</code></pre>\n\n<p>I tried to run something like:</p>\n\n<pre><code>echo 'import sys; print sys.version' | grumprun\n</code></pre>\n\n<p>Which was working.</p>\n\n<p>I untarred the pypi file, I read the <code>setup.py</code> etc and found I was primarily interested in the <code>pygments.cmdline</code>. So I copied the <code>pygments</code> directory into <code>$GOPATH/src/__python__/.</code></p>\n\n<p>Then I tried to build the cmdline as a module so that I could make it an executable by wrapping it with go the same way it'd been wrapped in a bash script before.</p>\n\n<pre><code>grumpc -modname=pygments.cmdline \\\n  $GOPATH/src/__python__/pygments/cmdline.py \\\n&gt; $GOPATH/src/__python__/pygments/cmdline/module.go\n</code></pre>\n\n<p>This did not work out due to <code>locale</code> missing.</p>\n\n<p>I changed into <code>$GOPATH/src/__python__/pygments</code> and looked for files without imports:</p>\n\n<pre><code>cd $GOPATH/src/__python__/pygments\ngrep -cr '^ *\\(from\\|import\\)' . &gt;imports\n</code></pre>\n\n<p>I identified the filter module had none so:</p>\n\n<pre><code>grumpc -modname=pygments.filter filter.py &gt;filter/module.go\n</code></pre>\n\n<p>Since this worked, I thought I was on to something, but I wasn't. Leading me to think if I just built things with few dependencies first, I could build up to the whole package (note <code>locale</code> isn't part of the package, so this was a bad plan):</p>\n\n<pre><code># Oh, this doesn't really handle the base __init__.py file well.\nfor f in *.py */*.py; do F=\"${f%%.py}\";\nif [ \"${f: -11}\" != \"__init__.py\" ];\nthen\n  mkdir -p \"$F\";\n  [ ! -s $F/module.go ] &amp;&amp; grumpc -modname=pygments.${F/\\//.} $f &gt; $F/module.go;\nelse\n  F=\"${F%%__init__}\";\n  [ ! -s ${F}module.go ] &amp;&amp; grumpc -modname=pygments.${F/\\//.} $f &gt; ./$F/module.go;\nfi\ndone\n</code></pre>\n\n<p>Here's a short list of the initial modules I would have needed to write a <a href=\"https://github.com/google/grumpy/wiki/Native-integration\" rel=\"nofollow noreferrer\">native implementation thereof</a>.</p>\n\n<blockquote>\n  <p>colorama.initialise<br>\n  codecs<br>\n  chardet<br>\n  pkg_resources<br>\n  docutils<br>\n  unicodedata<br>\n  locale<br>\n  ctags<br>\n  subprocess<br>\n  gzip<br>\n  urllib<br>\n  shutil<br>\n  gzip  </p>\n</blockquote>\n\n<p>I also got several other errors:</p>\n\n<blockquote>\n  <p><code>&lt;unknown&gt;:118:2235-118:2245: error: unicode character out of range</code><br>\n  <code>line 101: node not yet implemented: Exec</code><br>\n  <code>line 12: future feature division not yet implemented by grumpy</code><br>\n  <code>RuntimeError: maximum recursion depth exceeded while calling a Python object</code></p>\n</blockquote>\n\n<p>To be a little fair, there were a number of files that seemed to present no trouble (the ones that have a size) but there were 20 that did have issues, and they seem to include the cmdline, the core formatter, lexer, plugin, and main utils (the terminal, terminal256, bbcode, irc, mapping, rtf and svg formatters seemed okay\u2026):</p>\n\n<pre><code>$ wc `find . -name module.go`\n    2023     7797    63728 ./token/module.go\n       0        0        0 ./unistring/module.go\n    4510    16633   149451 ./filters/module.go\n    2221     7035    94627 ./lexers/idl/module.go\n       0        0        0 ./lexers/_lua_builtins/module.go\n     493     1941    18572 ./lexers/capnproto/module.go\n     788     3165    28867 ./lexers/hexdump/module.go\n    6437    22288   242059 ./lexers/pascal/module.go\n     572     2208    21237 ./lexers/inferno/module.go\n    1460     5853    60953 ./lexers/prolog/module.go\n    1610     5918    62664 ./lexers/esoteric/module.go\n     731     2700    27881 ./lexers/supercollider/module.go\n    5950    23129   218602 ./lexers/parsers/module.go\n    2579     7756   104501 ./lexers/_csound_builtins/module.go\n   14141    49681   644896 ./lexers/lisp/module.go\n    6336    23011   236369 ./lexers/modula2/module.go\n    5287    19964   200365 ./lexers/asm/module.go\n   10004    37737   340097 ./lexers/robotframework/module.go\n       0        0        0 ./lexers/_sourcemod_builtins/module.go\n    1621     6234    57562 ./lexers/textedit/module.go\n     644     2399    24139 ./lexers/go/module.go\n     350     1371    13898 ./lexers/apl/module.go\n    1325     4984    46972 ./lexers/nix/module.go\n    9008    34169   375371 ./lexers/scripting/module.go\n    1684     6706    66923 ./lexers/archetype/module.go\n     432     1690    16511 ./lexers/parasail/module.go\n    5941    18213   301062 ./lexers/ncl/module.go\n    4338    15189   259395 ./lexers/_cocoa_builtins/module.go\n    2433     9545    90020 ./lexers/textfmts/module.go\n    8056    29732   307645 ./lexers/python/module.go\n    5293    19344   210921 ./lexers/css/module.go\n    4641    16372   178991 ./lexers/c_like/module.go\n    1731     6533    67410 ./lexers/felix/module.go\n       0        0        0 ./lexers/_php_builtins/module.go\n    1966     7720    72987 ./lexers/fantom/module.go\n     311     1197    11568 ./lexers/trafficscript/module.go\n     595     2238    22795 ./lexers/chapel/module.go\n    7294    28597   273136 ./lexers/shell/module.go\n     285     1138    10140 ./lexers/web/module.go\n    1147     4478    43247 ./lexers/grammar_notation/module.go\n    4999    19994   205998 ./lexers/haxe/module.go\n    3382    12053   137873 ./lexers/theorem/module.go\n     818     3115    30130 ./lexers/dalvik/module.go\n    6599    24623   259510 ./lexers/perl/module.go\n    1415     5699    54536 ./lexers/smalltalk/module.go\n    2286     8370    84331 ./lexers/dylan/module.go\n    1524     5900    59673 ./lexers/pawn/module.go\n    6150    20492   311029 ./lexers/_vim_builtins/module.go\n    1325     5164    52099 ./lexers/rust/module.go\n     556     2137    20104 ./lexers/graph/module.go\n     524     2098    19189 ./lexers/other/module.go\n    2988    10857   123993 ./lexers/business/module.go\n    5703    21448   206789 ./lexers/erlang/module.go\n    2957     9869   126529 ./lexers/r/module.go\n    3273     9848   139052 ./lexers/_asy_builtins/module.go\n    4162    16299   158236 ./lexers/basic/module.go\n    9823    38671   401800 ./lexers/jvm/module.go\n     552     2175    21298 ./lexers/ambient/module.go\n    1169     4612    42833 ./lexers/diff/module.go\n    4003    14888   160168 ./lexers/objective/module.go\n     638     2463    24234 ./lexers/elm/module.go\n    1764     5371    71961 ./lexers/_tsql_builtins/module.go\n    4680    18630   176165 ./lexers/html/module.go\n     397     1581    14231 ./lexers/compiled/module.go\n    3834    14988   143117 ./lexers/crystal/module.go\n    1218     4584    44945 ./lexers/nimrod/module.go\n    2411     7267   117452 ./lexers/_mql_builtins/module.go\n    6289    24800   238668 ./lexers/haskell/module.go\n    2682     9870   111225 ./lexers/factor/module.go\n    2186     8504    81021 ./lexers/php/module.go\n    1403     5406    53632 ./lexers/varnish/module.go\n     364     1432    13878 ./lexers/rnc/module.go\n     612     2355    23021 ./lexers/ooc/module.go\n     188      740     6580 ./lexers/math/module.go\n    2235     8347    82881 ./lexers/modeling/module.go\n    2151     7910    87783 ./lexers/praat/module.go\n       0        0        0 ./lexers/special/module.go\n     251      993     8934 ./lexers/agile/module.go\n    5161    19940   196827 ./lexers/dotnet/module.go\n    1133     4277    43582 ./lexers/monte/module.go\n    1324     5218    50039 ./lexers/typoscript/module.go\n    1202     5339    60462 ./lexers/testing/module.go\n     740     2725    27378 ./lexers/oberon/module.go\n     796     2951    29702 ./lexers/verification/module.go\n    3054    12135   114894 ./lexers/clean/module.go\n    1171     4376    44599 ./lexers/tcl/module.go\n    5643    21530   202343 ./lexers/markup/module.go\n     865     3144    32057 ./lexers/ampl/module.go\n    1289     5014    48411 ./lexers/bibtex/module.go\n     989     3742    37888 ./lexers/qvt/module.go\n   11296    44649   438089 ./lexers/int_fiction/module.go\n     355     1392    13373 ./lexers/iolang/module.go\n    4353    17287   170343 ./lexers/ml/module.go\n    4231    12712   172022 ./lexers/_stata_builtins/module.go\n     632     2272    23038 ./lexers/smv/module.go\n    1393     4261    63346 ./lexers/_cl_builtins/module.go\n    1545     5885    55706 ./lexers/make/module.go\n    4918    16606   192919 ./lexers/matlab/module.go\n    1645     5625    63597 ./lexers/sas/module.go\n       0        0        0 ./lexers/_scilab_builtins/module.go\n    5438    20671   209628 ./lexers/configs/module.go\n     532     1948    19215 ./lexers/x10/module.go\n    3570    13980   137719 ./lexers/rebol/module.go\n    1862     6405    71722 ./lexers/fortran/module.go\n   19878    76674   719037 ./lexers/templates/module.go\n    3279     9851   165624 ./lexers/_openedge_builtins/module.go\n    1069     3241    48798 ./lexers/_stan_builtins/module.go\n     492     1819    18748 ./lexers/nit/module.go\n     406     1591    15567 ./lexers/snobol/module.go\n    2537     9157    99186 ./lexers/julia/module.go\n    9952    29904   499664 ./lexers/_lasso_builtins/module.go\n    2613     8174   119072 ./lexers/igor/module.go\n    1190     4456    45298 ./lexers/urbi/module.go\n    3312    12007   129704 ./lexers/hdl/module.go\n     421     1666    34239 ./lexers/foxpro/module.go\n    1227     5383    58804 ./lexers/automation/module.go\n       0        0        0 ./lexers/_postgres_builtins/module.go\n    6791    25704   260009 ./lexers/dsls/module.go\n     291     1156    10516 ./lexers/text/module.go\n    9626    38665   383525 ./lexers/javascript/module.go\n    2551    10063    99066 ./lexers/csound/module.go\n     483     1819    17444 ./lexers/roboconf/module.go\n     577     2206    24072 ./lexers/ezhil/module.go\n     771     3078    28434 ./lexers/resource/module.go\n     731     2804    27243 ./lexers/whiley/module.go\n       0        0        0 ./lexers/graphics/module.go\n     521     1925    19467 ./lexers/eiffel/module.go\n    4179    16387   156894 ./lexers/data/module.go\n     856     3182    32625 ./lexers/j/module.go\n     546     2165    22731 ./lexers/forth/module.go\n   10209    41331   393029 ./lexers/webmisc/module.go\n    1393     5279    56499 ./lexers/d/module.go\n    2480     9288    91522 ./lexers/c_cpp/module.go\n    1578     6503    62492 ./lexers/rdf/module.go\n    5282    20171   299945 ./lexers/_mapping/module.go\n     186      734     6614 ./lexers/functional/module.go\n    1128     3921    43138 ./lexers/ecl/module.go\n    5148    19594   192146 ./lexers/ruby/module.go\n    2040     7593    81180 ./lexers/actionscript/module.go\n    1974     7796    78115 ./lexers/installers/module.go\n    1226     4725    48193 ./lexers/algebra/module.go\n     590     2309    23425 ./lexers/console/module.go\n       0        0        0 ./lexers/module.go\n     639     2525    24688 ./lexers/stata/module.go\n    7116    25919   255452 ./lexers/sql/module.go\n       0        0        0 ./sphinxext/module.go\n       0        0        0 ./util/module.go\n    1482     5456    46562 ./regexopt/module.go\n       0        0        0 ./lexer/module.go\n       0        0        0 ./plugin/module.go\n    1580     5904    52942 ./formatters/svg/module.go\n    4294    16118   142678 ./formatters/terminal256/module.go\n    1641     5938    53535 ./formatters/rtf/module.go\n       0        0        0 ./formatters/latex/module.go\n    2149     8026    70726 ./formatters/irc/module.go\n       0        0        0 ./formatters/other/module.go\n    1561     5851    52413 ./formatters/terminal/module.go\n       0        0        0 ./formatters/html/module.go\n       0        0        0 ./formatters/img/module.go\n    1064     4241    38824 ./formatters/_mapping/module.go\n    1091     3974    35174 ./formatters/bbcode/module.go\n       0        0        0 ./formatters/module.go\n       0        0        0 ./cmdline/module.go\n    2164     7934    70484 ./style/module.go\n     339     1364    11693 ./styles/xcode/module.go\n     471     1922    16586 ./styles/vim/module.go\n     290     1151     9947 ./styles/vs/module.go\n     582     2426    20747 ./styles/pastie/module.go\n     362     1458    12394 ./styles/bw/module.go\n     493     2029    17533 ./styles/native/module.go\n    1076     4521    37325 ./styles/paraiso_light/module.go\n     566     2347    20186 ./styles/friendly/module.go\n     483     1988    17060 ./styles/autumn/module.go\n     647     2714    23016 ./styles/murphy/module.go\n     330     1331    11549 ./styles/fruity/module.go\n     383     1556    13367 ./styles/borland/module.go\n     305     1237    10664 ./styles/algol_nu/module.go\n     469     1928    16516 ./styles/trac/module.go\n     556     2302    19786 ./styles/default/module.go\n     887     3608    30851 ./styles/rainbow_dash/module.go\n     224      875     7492 ./styles/abap/module.go\n     855     3618    30861 ./styles/tango/module.go\n     567     2347    20158 ./styles/emacs/module.go\n     804     3371    27927 ./styles/arduino/module.go\n     508     2093    18035 ./styles/perldoc/module.go\n     559     2321    19905 ./styles/manni/module.go\n    1076     4521    37315 ./styles/paraiso_dark/module.go\n     304     1216    10415 ./styles/sas/module.go\n     219      851     7439 ./styles/rrt/module.go\n     647     2714    23036 ./styles/colorful/module.go\n     194      747     6446 ./styles/igor/module.go\n     871     3651    30445 ./styles/monokai/module.go\n     818     3418    28958 ./styles/lovelace/module.go\n     305     1238    10656 ./styles/algol/module.go\n     702     2507    22631 ./styles/module.go\n     263     1042     8927 ./styles/stata/module.go\n       0        0        0 ./formatter/module.go\n     785     2943    25598 ./filter/module.go\n     461     1656    13491 ./modeline/module.go\n    1023     3955    33738 ./scanner/module.go\n     962     3670    30137 ./console/module.go\n     761     2770    23417 ./module.go\n  440346  1641915 17381149 total\n</code></pre>\n\n<p>I moved on to making <code>util.py</code> not complain by removing the uses of <code>locale</code> and <code>io</code> as they were in try blocks or python 3 checks and had other paths to take.</p>\n\n<p>Then I got colorama from the pypi and moved the <code>colorama</code> dir from the tar into the <code>__python__</code> directory.</p>\n\n<p>This needed me to remove some uses of <code>ctypes</code> and basically gut the <code>win32.py</code> file. But it did respond well after that to:</p>\n\n<pre><code>for f in $GOPATH/build/src/__python__/colorama/*.py;\ndo\n  F=\"${f%%.py}\";\n  if [ \"${f: -11}\" != \"__init__.py\" ];\n  then\n    mkdir -p \"$F\";\n    [ ! -s $F/module.go ] &amp;&amp; grumpc -modname=${F/\\//.} $f &gt; $F/module.go;\n  else\n    F=\"${F%%/__init__}\";\n    [ ! -s $F/module.go ] &amp;&amp; grumpc -modname=${F/\\//.} $f &gt; $F/module.go;\n   fi\ndone\n</code></pre>\n\n<p>Now I thought I was at the least set to run a demo in the tar file's demo directory.</p>\n\n<pre><code>$ cat demo01.py |grumprun\n\u2026\ngrumpy.compiler.util.ImportError: line 12: no such module: fixpath\n# removed the import of fixpath\n$ cat demo01.py |grumprun\n        Traceback (most recent call last):\n  File \"/var/folders/gd/q65byyhs54g3qknbyv5r7q8r0000gp/T/tmpVK_oyV/src/__python__/module.py\", line 33, in &lt;module&gt;\n    sys.stdout.write('%s%-7s' % (foreground, NAMES[foreground]))\nNotImplementedError: conversion flags not yet supported\nexit status 1\n</code></pre>\n\n<p>Okay great, so even when something is in the standard library, parts of it are not implemented. This makes sense. But now I'm too frustrated to continue.</p>\n\n<p>Okay well, demos 2, 3, 4, 6, 7, and 8 seemed to work. Demo 5 failed on an import collision, probably because I'm on MacOS and it might work on linux.\nBut all the demos showed that the removal of <code>atexit</code> (and putting the <code>reset_all</code> into <code>deinit</code>) was affecting the behavior such that it does not set colors back to the original state.\n<a href=\"https://i.stack.imgur.com/7Wbrq.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/7Wbrq.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 3009, "user_id": 3105954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/l1Ql1.jpg?s=128&g=1", "display_name": "Raptor", "link": "https://stackoverflow.com/users/3105954/raptor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 454, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1527145620, "creation_date": 1499143561, "last_edit_date": 1527145003, "question_id": 44897218, "link": "https://stackoverflow.com/questions/44897218/install-a-python-package-in-grumpy", "title": "Install a python package in Grumpy", "body": "<p>I am using Fedora 25 and installed Grumpy in the following way:</p>\n\n<pre><code>git clone https://github.com/google/grumpy.git  \ncd grumpy  \nmake  \nexport GOPATH=$PWD/build  \nexport PYTHONPATH=$PWD/build/lib/python2.7/site-packages \n</code></pre>\n\n<p>also was able to create Go binary from a simple python file without any problem:</p>\n\n<pre><code>$tools/grumpc hello.py &gt; hello.go\n$ go build -o hello hello.go\n$ ./hello\nhello, world \n</code></pre>\n\n<p>However I do not have any clue about how to install a python package! Simple <code>pip install</code> didn't work out.</p>\n\n<p>I tried virtualenv but looks like that also didn't work. I checked the site-packages dir inside grumpy build which had the following only:</p>\n\n<pre><code>ll build/lib/python2.7/site-packages/\n&gt; drwxr-xr-x. 4 root root 4096 Jul  4 12:13 grumpy\n</code></pre>\n\n<p>How should a python package be install in Grumpy then?</p>\n"}, {"tags": ["go", "colors", "stdout", "stderr", "tty"], "answers": [{"comments": [{"owner": {"reputation": 3657, "user_id": 785259, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/zkWdu.jpg?s=128&g=1", "display_name": "kbirk", "link": "https://stackoverflow.com/users/785259/kbirk"}, "edited": false, "score": 0, "creation_date": 1499192284, "post_id": 44897333, "comment_id": 76800494, "body": "I&#39;m assuming you meant <code>w.file.Write</code> rather than <code>w.Write</code>? The output is the same as <code>fmt.Fprintf</code> unfortunately."}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 3657, "user_id": 785259, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/zkWdu.jpg?s=128&g=1", "display_name": "kbirk", "link": "https://stackoverflow.com/users/785259/kbirk"}, "edited": false, "score": 0, "creation_date": 1499192439, "post_id": 44897333, "comment_id": 76800554, "body": "Did you try? And what do you mean <code>qualify a TTY</code>? appear broken escape sequences?"}, {"owner": {"reputation": 3657, "user_id": 785259, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/zkWdu.jpg?s=128&g=1", "display_name": "kbirk", "link": "https://stackoverflow.com/users/785259/kbirk"}, "edited": false, "score": 0, "creation_date": 1499193741, "post_id": 44897333, "comment_id": 76801114, "body": "Yes I tried using <code>return w.file.Write(p)</code>. What I mean by <code>qualify as a TTY</code> is that if I wrap os.Stdout in a io.Writer interface and set <code>Cmd.Stdout</code> to it, it will <i>not</i> qualify as terminal."}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 3657, "user_id": 785259, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/zkWdu.jpg?s=128&g=1", "display_name": "kbirk", "link": "https://stackoverflow.com/users/785259/kbirk"}, "edited": false, "score": 2, "creation_date": 1499212136, "post_id": 44897333, "comment_id": 76806766, "body": "I understand what you mean <code>qualify as terminal</code>. Because it doesn&#39;t a *os.File. Maybe this can be your help? <a href=\"https://github.com/kr/pty\" rel=\"nofollow noreferrer\">github.com/kr/pty</a>"}], "tags": [], "owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "is_accepted": false, "score": 0, "last_activity_date": 1499144327, "creation_date": 1499144327, "answer_id": 44897333, "question_id": 44895757, "link": "https://stackoverflow.com/questions/44895757/proxy-exec-cmd-stdout-stderr-without-losing-tty/44897333#44897333", "title": "Proxy exec.Cmd Stdout / Stderr without losing TTY", "body": "<p>Replace</p>\n\n<pre><code>func (w *ProxyWriter) Write(p []byte) (int, error) {\n    // ... do something with bytes first\n    fmt.Fprintf(w.file, \"%s\", string(p))\n    return len(p), nil\n}\n</code></pre>\n\n<p>To</p>\n\n<pre><code>func (w *ProxyWriter) Write(p []byte) (int, error) {\n    return w.Write(p)\n}\n</code></pre>\n\n<p><code>fmt.Fprintf</code> have some logic to avoid terminal breaking.</p>\n"}], "owner": {"reputation": 3657, "user_id": 785259, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/zkWdu.jpg?s=128&g=1", "display_name": "kbirk", "link": "https://stackoverflow.com/users/785259/kbirk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 765, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1499193795, "creation_date": 1499132456, "last_edit_date": 1499193795, "question_id": 44895757, "link": "https://stackoverflow.com/questions/44895757/proxy-exec-cmd-stdout-stderr-without-losing-tty", "title": "Proxy exec.Cmd Stdout / Stderr without losing TTY", "body": "<p>I've got the following code that executes an arbitrary shell command and pipes the <code>stdout</code> and <code>stderr</code> to the terminal.:</p>\n\n<pre><code>c := exec.Command(\"/bin/sh\", \"-c\", cmd)\nc.Stdin = os.Stdin\nc.Stdout = os.Stdout\nc.Stderr = os.Stderr\n</code></pre>\n\n<p>However, I need to process the output before I print it, so I've wrapped it with a proxy io.Writer interface:</p>\n\n<pre><code>type ProxyWriter struct {\n    file   *os.File\n}\n\nfunc NewProxyWriter(file *os.File) *ProxyWriter {\n    return &amp;ProxyWriter{\n        file: file,\n    }\n}\n\nfunc (w *ProxyWriter) Write(p []byte) (int, error) {\n    // ... do something with bytes first\n    fmt.Fprintf(w.file, \"%s\", string(p))\n    return len(p), nil\n}\n</code></pre>\n\n<p>So the original code is now:</p>\n\n<pre><code>c := exec.Command(\"/bin/sh\", \"-c\", cmd)\nc.Stdin = os.Stdin\nc.Stdout = NewProxyWriter(os.Stdout)\nc.Stderr = NewProxyWriter(os.Stderr)\n</code></pre>\n\n<p>This works for the most part, however, <code>stdout</code> and <code>stderr</code> no longer seem to qualify as a TTY. Any previously styled or colored output is no longer styled or colored.</p>\n\n<p>I've confirmed that this is not an issue of my <code>ProxyWriter</code> simply messing with the formatting by setting the command to the following, which outputs the colored text correctly.</p>\n\n<pre><code>c := exec.Command(\"echo\", \"\\033[0;31mTEST\\033[0m\")\n</code></pre>\n\n<p>A more explicit test is:</p>\n\n<pre><code>c := exec.Command(\"/bin/sh\", \"-c\", \"if [ -t 1 ] ; then echo \\\"terminal\\\"; else echo \\\"not a terminal\\\"; fi\")\n</code></pre>\n\n<p>Which outputs:</p>\n\n<pre><code>not a terminal\n</code></pre>\n\n<p>Is there anyway I can wrap the commands stdout / stderr without losing the TTY status?</p>\n"}, {"tags": ["c", "arrays", "algorithm", "go", "tree"], "comments": [{"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "edited": false, "score": 0, "creation_date": 1499140733, "post_id": 44895747, "comment_id": 76771167, "body": "Shouldn&#39;t your example tree have in-order <code>1 3 2 10 3 7 4 15 5 5 5</code>, since a single child value is propagated to its parent? Furthermore, if <code>-</code> represents an empty node, your tree can be defined from the bottom up, level by level, as <code>1 2 3 4 5 - - -</code>, <code>3 7 5 -</code>, <code>10 5</code>, <code>5</code>. That order also represents a good logic for the implementation; if you keep each level in an array, the calculation to get the next level has all arguments consecutive in memory. In the file, you could save the nodes level by level, as <code>5</code>, <code>10 5</code>, <code>3 7 5 -</code>, <code>1 2 3 4 5 - - -</code>."}, {"owner": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "reply_to_user": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "edited": false, "score": 0, "creation_date": 1499159452, "post_id": 44895747, "comment_id": 76780614, "body": "Yes your in-order traversal is correct.  My array is an example solution, not a traversal.  I&#39;ll make this more clear. You are thinking in the same direction as I am with respect addressing entire rows at a time.  However, if I understand you then your solution still &quot;wastes space proportional to 2h - n&quot; (wikipedia), like a typical binary tree array.  The point here is I&#39;m trying to do better, no empty nodes, no repeated values."}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "edited": false, "score": 0, "creation_date": 1499161348, "post_id": 44895747, "comment_id": 76781957, "body": "If you consider each level in the tree a list, do you always merge consecutive members in the list, propagating the possible leftover member up to the next level? If you do, then you only need to store the number of nodes in the lowest level, and then the nodes in each level from left to right. The tree structure is then well defined (except for whether single child nodes hang off the left or the right member of the parent node)."}, {"owner": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "reply_to_user": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "edited": false, "score": 0, "creation_date": 1499162581, "post_id": 44895747, "comment_id": 76782810, "body": "Yes, that is correct, and if I allow copying (as apposed to writing into the pre-allocated final array) then it is easy to implement but costs a minimum of one allocation per row and a copy for every array element.  Also not bing top down addressable kind of kills any value of it being a tree, no?"}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "edited": false, "score": 0, "creation_date": 1499191982, "post_id": 44895747, "comment_id": 76800369, "body": "1) You only have a few dozen levels in your tree (on current 64-bit machines, at most 65) because your trees with <code>n</code> levels have at least <code>2**(n-1)+n-1</code> nodes total (at least <code>2**(k-1)+1</code> nodes on level <code>k</code>). An operation per level is insignificant overhead. 2) If a level has an odd number of nodes, and the final node is propagated up as-is, as the left child of the parent node if the parent node has no other children, the number of nodes on the most numerous level, defines the entire shape of the tree. Knowing this number, you can traverse the tree normally."}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "edited": false, "score": 0, "creation_date": 1499192102, "post_id": 44895747, "comment_id": 76800422, "body": "3) If we know the number of elements on the most numerous level, we can treat the entire tree as one linear array. Since each level has at most one odd element that is propagated upwards, this means at most one element copied per level. In summary, the only thing that would be needed, is the number of nodes on the most numerous level, for one to treat the linear array as a tree. None of the &quot;unused nodes&quot; (compared to a binary tree) are stored or reserved in the array."}], "answers": [{"comments": [{"owner": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "edited": false, "score": 0, "creation_date": 1499157335, "post_id": 44896545, "comment_id": 76779176, "body": "Thank you, but the succinct binary tree encoding discussed is capable of encoding binary trees of arbitrary structure.  My binary tree is more constrained so shouldn&#39;t need this information for every node.  For example for n &gt; 3 there is always one or more complete &amp; balanced binary trees of at most height-1 on the lower left hand side of the larger tree as in the subtree for 1-4 within the tree for 1-5 above."}, {"owner": {"reputation": 42504, "user_id": 1161878, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0157ddd785dc01e95342e3661d34b42a?s=128&d=identicon&r=PG", "display_name": "Gene", "link": "https://stackoverflow.com/users/1161878/gene"}, "reply_to_user": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "edited": false, "score": 0, "creation_date": 1499196011, "post_id": 44896545, "comment_id": 76802028, "body": "@JoshuaKolden Well then you should say that in the question. You said you&#39;d like to balance computations, but never that balance was guaranteed. There&#39;s nothing about expression trees that gives them structure beyond the fact that all internal nodes have 2 children."}], "tags": [], "owner": {"reputation": 42504, "user_id": 1161878, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0157ddd785dc01e95342e3661d34b42a?s=128&d=identicon&r=PG", "display_name": "Gene", "link": "https://stackoverflow.com/users/1161878/gene"}, "is_accepted": false, "score": 0, "last_activity_date": 1499138819, "creation_date": 1499138819, "answer_id": 44896545, "question_id": 44895747, "link": "https://stackoverflow.com/questions/44895747/a-succinct-binary-tree-of-sums-array-construction-and-addressing/44896545#44896545", "title": "A succinct binary tree of sums, array construction and addressing", "body": "<p>It sounds like you're asking for a succinct encoding of a binary tree.  For this it's sufficient to store the node data in pre-order with one additional bit to denote leaf vs internal node. The algorithms for encoding and decoding are rather simple and given in <a href=\"https://en.wikipedia.org/wiki/Binary_tree#Succinct_encodings\" rel=\"nofollow noreferrer\">a Wikipedia article</a>, so I won't repeat them here. This encoding is very close to the information-theoretic best possible. It's probably not worth looking for a better one.</p>\n"}, {"comments": [{"owner": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "edited": false, "score": 0, "creation_date": 1499343945, "post_id": 44913616, "comment_id": 76872615, "body": "Great answer, well presented. Of course trying to remove an O(log n) duplication was a frivolous optimization. Simply leaving them in makes this all very easy. I think I can figure it out, but do you have any suggestions for finding <code>N</code> from <code>total</code> for imperfect trees? (P.S. there&#39;s a small typo / inconsistency between your <code>while</code> loops)"}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "reply_to_user": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "edited": false, "score": 0, "creation_date": 1499362299, "post_id": 44913616, "comment_id": 76886385, "body": "@JoshuaKolden: Not all <code>total</code> are valid given the rules for the tree, but for those that are valid, I added a binary search. (It does less than 7 iterations for 2\u2076\u2074nodes, and fewer for smaller trees, so it is definitely efficient enough.) Also, I removed the inconsistency for clarity, but either way, the loops have (and had) the same number of iterations."}, {"owner": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "edited": false, "score": 0, "creation_date": 1499567027, "post_id": 44913616, "comment_id": 76959657, "body": "Thanks, but that doesn&#39;t seem to work either.  An <code>N</code> of 17 has a <code>total</code> of 37, but <code>(37-1)&#47;2 = 18</code>, perhaps it should be <code>Nmin = (total - log2(total)) &#47; 2</code>?"}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "reply_to_user": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "edited": false, "score": 0, "creation_date": 1499568781, "post_id": 44913616, "comment_id": 76959864, "body": "@JoshuaKolden: Whoops, I made a double-bug there. Should be fixed now. Let me explain. We have <code>T &gt;= 2*N-1</code> and <code>T &lt;= 2*N-1+log2(N)</code>. If we solve for <code>N</code>, the lower limit gives us the upper limit for <code>N</code>, <code>N &lt;= (T + 1)&#47;2</code>. The upper limit for <code>T</code> gives us the lower limit for <code>N</code>, <code>N &gt;= W(log(2)*2**(T+2)) &#47; (2*log(2))</code> where <code>W(x*exp(x)) = x</code> for all positive <code>x</code>. I am still verifying that <code>W(log(2)*2**(T+2))&#47;(2*log(2)) &gt;= (T + 1)&#47;2 - log2(T)</code>, but random testing on 62-bit <code>N</code> (so <code>T</code> does not overflow) says this works."}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "reply_to_user": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "edited": false, "score": 0, "creation_date": 1499569478, "post_id": 44913616, "comment_id": 76959958, "body": "@JoshuaKolden: <code>Nmax = (T + 1)&#47;2</code>, <code>Nmin = Nmax - log2(T)</code> should be correct. The ratio of <code>(T + 1)&#47;2 - log(T)&#47;log(2)</code> and <code>W(log(2)*2**(T+2))&#47;(2*log(2))</code> is 1 at <code>T == 1</code>, the limit of the ratio at <code>T</code> towards infinity is 1; and the ratio is less than 1 in between, according to Maple, so these limits should be correct."}], "tags": [], "owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "is_accepted": true, "score": 1, "last_activity_date": 1499568048, "last_edit_date": 1499568048, "creation_date": 1499199974, "answer_id": 44913616, "question_id": 44895747, "link": "https://stackoverflow.com/questions/44895747/a-succinct-binary-tree-of-sums-array-construction-and-addressing/44913616#44913616", "title": "A succinct binary tree of sums, array construction and addressing", "body": "<p>Let's assume your tree has <code>N</code> nodes on the final (most numerous) row.</p>\n\n<p>If you do store the nodes that are only propagated upwards, your tree has between <code>2*N-1</code> and <code>2*N-1+log2(N)</code> nodes, total. The exact total number of nodes is given by <a href=\"http://oeis.org/A120511\" rel=\"nofollow noreferrer\">OEIS A120511</a>. Of these, at most <code>floor(2 + log2(N-1))</code> are copied/propagated nodes.</p>\n\n<p>The tree has <code>floor(2 + log2(N-1))</code> rows. The number of rows as a function of  <code>N</code> (the number of elements on the final row) is <a href=\"http://oeis.org/A070941\" rel=\"nofollow noreferrer\">OEIS A070941</a>.</p>\n\n<p>The number of rows in such trees is quite low. For example, if you have 2<sup>40</sup> \u2248 1,000,000,000,000 nodes in the final row, you only have 42 rows in the tree. For 2<sup>64</sup> nodes, you have just 66. Therefore, if you need some operation per row, it is not a high overhead.</p>\n\n<p>A simple logarithmic-time function can compute the number of rows and the total number of nodes, given the number of nodes in the final row <code>N</code>:</p>\n\n<pre><code># Account for the root node\nrows = 1\ntotal = 1\n\ncurr_left = N\nWhile (curr_left &gt; 1):\n    rows = rows + 1\n    total = total + curr_left\n    curr_left = (curr_left + 1) / 2\nEnd While\n</code></pre>\n\n<p>where <code>/</code> denotes integer division, i.e. any fractional part is discarded/truncated/rounded towards zero. Again, for 2<sup>64</sup> nodes in the final row, the above loops only 65 times.</p>\n\n<p>When we know the total number of nodes in the tree, and the number of rows, we can use another logarithmic-time loop to compute the offset of the first element on each row of the tree, and the number of nodes on that row:</p>\n\n<pre><code>first_offset = []\nnodes = []\n\ncurr_row = rows - 1\ncurr_offset = total - N\ncurr_left = N\n\nWhile (curr_left &gt; 1):\n    nodes[curr_row] = curr_left\n    first_offset[curr_row] = curr_offset\n    curr_row = curr_row - 1\n    curr_left = (curr_left + 1) / 2\n    curr_offset = curr_offset - curr_left\n}\n\nfirst_offset[0] = 0\nnodes[0] = 1\n</code></pre>\n\n<p>As before, for 2<sup>64</sup> nodes in the final row, the above loops only 65 times.</p>\n\n<p>All elements on a row are consecutive in memory, and if we use zero-based indexing, and <code>N</code> is the number of nodes on the final row, and we apply the above, then</p>\n\n<ul>\n<li><p><code>rows</code> is the number of rows in the tree</p></li>\n<li><p><code>total</code> is the total number of nodes in the tree</p></li>\n<li><p>There are <code>nodes[r]</code> nodes on row <code>r</code>, if <code>r &gt;= 0</code> and <code>r &lt; rows</code></p></li>\n<li><p>Array index for node on row <code>r</code>, column <code>c</code> is <code>first_offset[r] + c</code></p></li>\n<li><p>Node on row <code>r</code>, column <code>c</code>, with <code>r &gt; 0</code>, has a parent on row <code>r-1</code>, column <code>c/2</code>, at array index <code>first_offset[r-1] + c/2</code></p></li>\n<li><p>Node on row <code>r</code>, column <code>c</code>, with <code>r &lt; rows - 1</code>, has a left child on row <code>r+1</code>, column <code>2*c</code>, at array index <code>first_offset[r+1] + 2*c</code></p></li>\n<li><p>Node on row <code>r</code>, column <code>c</code>, with <code>r &lt; rows - 1</code> and <code>c &lt; nodes[r] - 1</code>, has a right child on row <code>r+1</code>, column <code>2*c+1</code>, at array index <code>first_offset[r+1] + 2*c + 1</code></p></li>\n<li><p>Node on row <code>r</code>, column <code>c</code>, with <code>r &lt; rows - 1</code> and <code>c &lt; nodes[r] - 1</code>, has both a left and a right child</p></li>\n</ul>\n\n<p>This array is compact, and other than the nodes that get propagated upwards (so, maybe a few dozen nodes for a terabyte-sized dataset), wastes no storage.</p>\n\n<p>If the number of nodes in the final row is stored with the array (for example, as an extra <code>uint64_t</code> following the array data), all readers can recover <code>total</code>, <code>rows</code>, <code>first_offset[]</code>, and <code>nodes[]</code>, and easily navigate the tree. (However, note that instead of just the array index, you use the \"column\" and \"row\" instead, and derive the array index using those.)</p>\n\n<p>Because <code>first_offset[]</code> and <code>nodes[]</code> arrays have at most a few dozen entries, they should stay hot in caches, and using them should not harm performance.</p>\n\n<p>Note that not all tree sizes are valid for the rules stated in the second paragraph above. For example, a tree with two nodes makes no sense: why would you duplicate the root node?</p>\n\n<p>If you do know that the tree size (<code>total</code>) is valid, you can find <code>N</code> based on <code>total</code> in <code>O(log2(total)*log2log2(total))</code> time complexity using a binary search, or in <code>O((log2(total))\u00b2)</code> if you use a simple loop. Remember, <code>total</code> is between <code>2*N-1</code> and <code>2*N-1+log2(N)</code>. Conversely, <code>N</code> cannot be greater than <code>(N + 1)/2</code>, or smaller than <code>(N + 1)/2 - log2(total)</code>, because <code>total</code> is greater than <code>N</code>, and therefore <code>log2(N)</code> is less than <code>log2(total)</code>. So, a binary search could be implemented as</p>\n\n<pre><code>Function Find_N(total):\n    Nmax = (total + 1) / 2\n    Nmin = Nmax - log2(total)\n\n    t = Total(Nmin)\n    If t == total:\n        Return Nmin\n    Else if t &lt; total:\n        Return \"Bug!\"\n    End if\n\n    t = Total(Nmax)\n    if t == total:\n        Return Nmax\n    Else if t &gt; total:\n        Return \"Bug!\"\n    End if\n\n    Loop:\n\n        N = (Nmin + Nmax) / 2\n        If N == Nmin:\n            Return \"Invalid tree size!\"\n        End If\n\n        t = Total(N)\n        If t &gt; total:\n            Nmax = N\n        Else if t &lt; total:\n            Nmin = N\n        Else:\n            return N\n        End If            \n    End Loop\nEnd Function\n</code></pre>\n\n<p>Keep in mind that even with 2<sup>64</sup> nodes in the tree, the above function makes at most <code>1 + log2(64)</code> = 6 calls to <code>Total</code>, a function implementing the first pseudocode snippet in this answer. Since you typically need this only once per program invocation, the overhead is truly irrelevant.</p>\n\n<p>You can calculate <code>log2(x)</code> using <code>log(x)/log(2)</code>, using the <code>log2()</code> function from <code>&lt;math.h&gt;</code> since C99 (but since <code>double</code> has less precision than <code>uint64_t</code>, I would add <code>+1</code> to the result, or round it towards positive infinity using <code>ceil()</code>, just to be sure), or even using a simple loop:</p>\n\n<pre><code>Function ulog2(value):\n    result = 0\n    While (value &gt; 0):\n        result = result + 1\n        value = value / 2\n    End While\n    Return result\nEnd Function\n</code></pre>\n\n<p>where once again, <code>/</code> denotes integer division.</p>\n"}], "owner": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 44913616, "answer_count": 2, "score": 0, "last_activity_date": 1499568048, "creation_date": 1499132357, "last_edit_date": 1499163236, "question_id": 44895747, "link": "https://stackoverflow.com/questions/44895747/a-succinct-binary-tree-of-sums-array-construction-and-addressing", "title": "A succinct binary tree of sums, array construction and addressing", "body": "<p>Using 'sum' as a short hand for some arbitrary computation. I have a process that computes a single sum from a list of values by recursively summing pairs of values. Un-paired values are promoted up the tree unaltered until they can be paired. </p>\n\n<p>Given this computation, I'm in search of the best way to balance computation (i.e. number of operation required to access array elements/nodes), and the most succinct encoding of all nodes in a 1 dimensional array (i.e. no gaps, nil values, or repeated values), and preferably without an additional index array that cannot be easily derived from the succinct encoding so that it would have to be saved along with the array.</p>\n\n<p>Although the following are simple examples, in reality the number of values in the initial list can be extraordinarily large (2^47 or more). </p>\n\n<p>For example, given the list [1, 2, 3, 4], the array is trivial: [10, 3, 7, 1, 2, 3, 4], and split nicely into rows that are easy to address by node, or as a reference to the entire row.</p>\n\n<p>But for a 5 item list the tree looks like this:</p>\n\n<h3>Tree 1</h3>\n\n<pre><code>         15\n        /  \\\n       /    \\\n      /      \\\n     /        \\\n    10          5\n  /   \\       /   \\\n 3     7     5     -\n/ \\   / \\   / \\   / \\\n1  2  3  4 5   - -   -\n</code></pre>\n\n<p>The standard mapping <code>left = i*2+1</code>, <code>right = i*2+2</code> gives us this array:</p>\n\n<h3>Array 1</h3>\n\n<pre><code>[ 15, 10,  5,  3,   7,   5,  nil,   1,   2,   3,   4,   5,   nil,   nil, nil]\n</code></pre>\n\n<p>This array has 4 nil values, and the last element in the list '5' is repeated 2 times.</p>\n\n<p>To improve this we can imply the repetition of the 5, and remove the nil values:</p>\n\n<h3>Array 2</h3>\n\n<pre><code>[15, 10, 3, 7, 1, 2, 3, 4, 5]\n</code></pre>\n\n<p>Which is much more compact. This tree is the same, but conceptually looks a bit like:</p>\n\n<h3>Tree 2</h3>\n\n<pre><code>       15\n      / \\\n     /   \\\n    10    \\\n  /   \\    \\\n 3     7    \\\n/ \\   / \\    \\\n1  2  3  4    5\n</code></pre>\n\n<p>In the <strong>Array 2</strong> encoding I have 4 rows:</p>\n\n<pre><code>1. [1, 2, 3, 4]\n2. [3, 7]\n3. [10, 5]\n4. [15]\n</code></pre>\n\n<p>Rows 1, 2 and 4 can simply be references into <strong>Array 2</strong> allowing me to compute results 'in-place' with no allocations or copies. Very fast. Row 3 however, contains values in two non-contiguous cells. I have to break the simple logic used for the other rows, and possibly add copy, indexing or storage for a map.</p>\n\n<p>I can construct complete/balanced sub trees (such as indexes 1-7, the tree for 1, 2, 3, 4), but it seems like they will not always be so nicely aligned when the odd number of items appears at different rows depending on input length.  For example consider a tree with an initial list of 6 elements.</p>\n"}, {"tags": ["arrays", "json", "go", "struct", "unmarshalling"], "comments": [{"owner": {"reputation": 45, "user_id": 5461181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42adb435370c3709cec7c871b05d73e4?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Wood", "link": "https://stackoverflow.com/users/5461181/logan-wood"}, "edited": false, "score": 0, "creation_date": 1499129945, "post_id": 44895535, "comment_id": 76769060, "body": "Additional Links I have viewed with a very similar problem, but solutions don&#39;t quite fit my scenario: <a href=\"https://stackoverflow.com/questions/40626125/golang-unmarshal-json-cannot-unmarshal-array-into-go-value-of-type-main-moni\" title=\"golang unmarshal json cannot unmarshal array into go value of type main moni\">stackoverflow.com/questions/40626125/&hellip;</a>"}, {"owner": {"reputation": 45, "user_id": 5461181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42adb435370c3709cec7c871b05d73e4?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Wood", "link": "https://stackoverflow.com/users/5461181/logan-wood"}, "edited": false, "score": 0, "creation_date": 1499130041, "post_id": 44895535, "comment_id": 76769074, "body": "This link appears the closest, but I don&#39;t know how to create a custom unmarshaller as per their solution description... <a href=\"https://stackoverflow.com/questions/42377989/unmarshal-json-array-of-arrays-in-go\" title=\"unmarshal json array of arrays in go\">stackoverflow.com/questions/42377989/&hellip;</a>"}, {"owner": {"reputation": 45, "user_id": 5461181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42adb435370c3709cec7c871b05d73e4?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Wood", "link": "https://stackoverflow.com/users/5461181/logan-wood"}, "edited": false, "score": 0, "creation_date": 1499130671, "post_id": 44895535, "comment_id": 76769194, "body": "UPDATE: It still isn&#39;t working, but I have changed: <code>type WeatherData struct { \tWind    Wind \tSys     Sys \tWeather []Weather &#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47; this results in the values showing up, but I seem to lose the ability to identify the values based on their keys \tName    string </code>json:&quot;name&quot;` }`"}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 5461181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42adb435370c3709cec7c871b05d73e4?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Wood", "link": "https://stackoverflow.com/users/5461181/logan-wood"}, "edited": false, "score": 0, "creation_date": 1499131948, "post_id": 44895648, "comment_id": 76769403, "body": "Thank you for trying to help, but I have been able to do that and get the chunk of array data, however I still can&#39;t call an individual key/value for something like data.Weather.Descrip it returns error that it is undefined.  I&#39;ve also tried adding the type []map[string]interface{} which works to give me all key/value pairs, but I still can&#39;t call them. You can see my change here:  <a href=\"https://play.golang.org/p/MaZ5wMuJVA\" rel=\"nofollow noreferrer\">link</a>"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "reply_to_user": {"reputation": 45, "user_id": 5461181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42adb435370c3709cec7c871b05d73e4?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Wood", "link": "https://stackoverflow.com/users/5461181/logan-wood"}, "edited": false, "score": 0, "creation_date": 1499132608, "post_id": 44895648, "comment_id": 76769500, "body": "You need to access slice/array values via index, see here: <a href=\"https://play.golang.org/p/zks-JPQ1YY\" rel=\"nofollow noreferrer\">link</a>."}, {"owner": {"reputation": 45, "user_id": 5461181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42adb435370c3709cec7c871b05d73e4?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Wood", "link": "https://stackoverflow.com/users/5461181/logan-wood"}, "edited": false, "score": 0, "creation_date": 1499132969, "post_id": 44895648, "comment_id": 76769567, "body": "It works! Thank you so much. I had even gotten as far as accessing the whole thing by index 0, but didn&#39;t realize I could do dot notation on top of that. Thanks again!"}], "tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": true, "score": 3, "last_activity_date": 1499131282, "creation_date": 1499131282, "answer_id": 44895648, "question_id": 44895535, "link": "https://stackoverflow.com/questions/44895535/unmarshal-json-array-into-go-struct-array-is-in-the-middle-of-the-json-string/44895648#44895648", "title": "unmarshal json array into go struct (array is in the middle of the JSON string", "body": "<p>You have to define slice of <code>Weather</code> struct in <code>WeatherData</code>. </p>\n\n<p>Uncomment <code>Weather</code> struct and update <code>WeatherData</code> struct to following.</p>\n\n<pre><code>// WeatherData struct to collect data from the API call\ntype WeatherData struct {\n    Wind    Wind      `json:\"wind\"`\n    Sys     Sys       `json:\"sys\"`\n    Weather []Weather `json:\"weather\"`\n    Name    string    `json:\"name\"`\n}\n</code></pre>\n\n<p>Please have a look on example code: <a href=\"https://play.golang.org/p/4KFqRuxcx2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4KFqRuxcx2</a></p>\n"}], "owner": {"reputation": 45, "user_id": 5461181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42adb435370c3709cec7c871b05d73e4?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Wood", "link": "https://stackoverflow.com/users/5461181/logan-wood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1409, "favorite_count": 0, "accepted_answer_id": 44895648, "answer_count": 1, "score": 2, "last_activity_date": 1499131638, "creation_date": 1499129884, "last_edit_date": 1499131638, "question_id": 44895535, "link": "https://stackoverflow.com/questions/44895535/unmarshal-json-array-into-go-struct-array-is-in-the-middle-of-the-json-string", "title": "unmarshal json array into go struct (array is in the middle of the JSON string", "body": "<p>I am new to Go. I am working with a weather API. I have commented out the sections that cause the error. I have seen several other links that have a similar problem, however none of them seem to have the array in the middle of the JSON string. I'm sure there is a way to define the struct with a slice. I can't seem to get get the syntax to allow it. Here is where I'm stuck:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\n// WeatherData struct to collect data from the API call\ntype WeatherData struct {\n    Wind Wind\n    Sys  Sys\n    // Weather Weather\n    Name string `json:\"name\"`\n}\n\n////////////// ERROR when unmarshalling this struct /////////\n// Weather provides basic weather info\n// type Weather struct {\n//  ID      int    `json:\"id\"`\n//  Descrip string `json:\"description\"`\n//  Icon    string `json:\"icon\"`\n// }\n/////////////////////////////////////////////////////////////\n\n// Sys includes sunrise, sunset, country, etc.\ntype Sys struct {\n    Country string `json:\"country\"`\n}\n\n// Wind struct to get specific wind characteristics\ntype Wind struct {\n    Speed  float64 `json:\"speed\"`\n    Degree float64 `json:\"deg\"`\n    Gust   float64 `json:\"gust\"`\n}\n\nfunc main() {\n    res, getErr := http.Get(\"http://api.openweathermap.org/data/2.5/weather?zip=REMOVED,us&amp;appid=REMOVEDBUTWILLPOSTJSONData\")\n    if getErr != nil {\n        log.Fatalln(\"http.Get error: \", getErr)\n    }\n    defer res.Body.Close()\n    body, readErr := ioutil.ReadAll(res.Body)\n    if readErr != nil {\n        log.Fatalln(\"Read Error: \", readErr)\n    }\n//////////// UNABLE TO UNMARSHAL the array that passes through here ////\n    var data WeatherData\n    if err := json.Unmarshal(body, &amp;data); err != nil {\n        panic(err)\n    }\n\n    fmt.Println(\"Wind gusts: \", data.Wind.Gust)\n    fmt.Println(\"Wind speed: \", data.Wind.Speed)\n    fmt.Println(\"Wind degrees: \", data.Wind.Degree)\n\n    fmt.Println(\"Country is: \", data.Sys.Country)\n    fmt.Println(\"City is: \", data.Name)\n\n///////////////// CAN'T ACCESS Description...or anything in Weather\n// fmt.Println(\"Country is: \", data.Weather.Descrip) // cannot access due to this portion being inside an array\n\n}\n\n\n\n/////////////////THIS IS THE JSON DATA THAT IS AVAILABLE ///////////\n{\n  \"coord\": {\n    \"lon\": -97.31,\n    \"lat\": 32.94\n  },\n  \"weather\": [  // CAN'T ACCESS THIS CORRECTLY\n    {\n      \"id\": 800,\n      \"main\": \"Clear\",\n      \"description\": \"clear sky\",\n      \"icon\": \"01d\"\n    }\n  ],\n  \"base\": \"stations\",\n  \"main\": {\n    \"temp\": 306.46,\n    \"pressure\": 1014,\n    \"humidity\": 55,\n    \"temp_min\": 306.15,\n    \"temp_max\": 307.15\n  },\n  \"visibility\": 16093,\n  \"wind\": {\n    \"speed\": 5.1,\n    \"deg\": 150,\n    \"gust\": 7.2\n  },\n  \"clouds\": {\n    \"all\": 1\n  },\n  \"dt\": 1499120100,\n  \"sys\": {\n    \"type\": 1,\n    \"id\": 2597,\n    \"message\": 0.0225,\n    \"country\": \"US\",\n    \"sunrise\": 1499081152,\n    \"sunset\": 1499132486\n  },\n  \"id\": 0,\n  \"name\": \"Fort Worth\",\n  \"cod\": 200\n}\n</code></pre>\n"}, {"tags": ["go", "build"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1499159732, "post_id": 44895454, "comment_id": 76780818, "body": "I covered some of those topics in <a href=\"https://github.com/mh-cbon/go-github-release\" rel=\"nofollow noreferrer\">github.com/mh-cbon/go-github-release</a>, check also other alternatives as mentioned in below answer."}], "answers": [{"comments": [{"owner": {"reputation": 4977, "user_id": 912190, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d5982ff6b419c6445fe5668938e3d90?s=128&d=identicon&r=PG", "display_name": "V&#237;ctor Romero", "link": "https://stackoverflow.com/users/912190/v%c3%adctor-romero"}, "edited": false, "score": 0, "creation_date": 1499138654, "post_id": 44896302, "comment_id": 76770723, "body": "Looks pretty good indeed. Let me give it a try before accepting the answer."}], "tags": [], "owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "is_accepted": true, "score": 4, "last_activity_date": 1499137064, "creation_date": 1499137064, "answer_id": 44896302, "question_id": 44895454, "link": "https://stackoverflow.com/questions/44895454/examples-of-end-to-end-golang-build-pipeline/44896302#44896302", "title": "Examples of end-to-end GoLang build pipeline", "body": "<p>I am not sure if this is what you need, but you can take a look at this one <a href=\"https://github.com/goreleaser/goreleaser\" rel=\"nofollow noreferrer\">goreleaser</a>.</p>\n\n<blockquote>\n  <p>GoReleaser builds Go binaries for several platforms, creates a GitHub\n  release and then pushes a Homebrew formula to a repository. All that\n  wrapped in your favorite CI.</p>\n</blockquote>\n"}], "owner": {"reputation": 4977, "user_id": 912190, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d5982ff6b419c6445fe5668938e3d90?s=128&d=identicon&r=PG", "display_name": "V&#237;ctor Romero", "link": "https://stackoverflow.com/users/912190/v%c3%adctor-romero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 818, "favorite_count": 0, "accepted_answer_id": 44896302, "answer_count": 1, "score": 1, "last_activity_date": 1499137064, "creation_date": 1499129034, "question_id": 44895454, "link": "https://stackoverflow.com/questions/44895454/examples-of-end-to-end-golang-build-pipeline", "title": "Examples of end-to-end GoLang build pipeline", "body": "<p>There seems to be little information around examples and best practices when building an end-to-end pipeline for a Go Lang application that can:</p>\n\n<ul>\n<li>Calculate next version (ala <a href=\"https://github.com/semantic-release/semantic-release\" rel=\"nofollow noreferrer\">semantic-release</a>)</li>\n<li>Run all tests</li>\n<li>Build for the different supported platforms ((Linux, FreeBSD, Mac OS X, Windows) * (amd64, 386, arm, s390x, ppc64le))</li>\n<li>Tag and Release in a SCM (github | gitlab | bitbucket)</li>\n<li>Optionally create packages (deb, rpm, snaps, flatpaks, brew taps, Inno Setup).</li>\n<li>Run this integrated in (TravisCI | CircleCI | Jenkins | Bamboo | others)</li>\n</ul>\n\n<p>Is there any documentation, example project at this regard? I've checked some of the more famous Go projects (kubernetes, hashicorp/* and others) and they all seem to leave this part outside of the project.</p>\n"}, {"tags": ["go", "gorilla", "go-gorm"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1499115812, "post_id": 44893792, "comment_id": 76765676, "body": "Clarification. Are these GET parameters you are referring to?"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1499115933, "post_id": 44893792, "comment_id": 76765727, "body": "@RayfenWindspear yes, that are all the fields that conform the struct. And from the client side they can send me some of them with values to make the filter"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1499116404, "post_id": 44893792, "comment_id": 76765902, "body": "Then all you need is to map the <code>URL.Query()</code> <code>Values</code> to your struct? (<a href=\"https://godoc.org/net/url#URL.Query\" rel=\"nofollow noreferrer\">godoc.org/net/url#URL.Query</a>)"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1499116580, "post_id": 44893792, "comment_id": 76765948, "body": "@RayfenWindspear correct!"}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1499119790, "post_id": 44894392, "comment_id": 76766874, "body": "While I don&#39;t exactly advocate for using the <code>reflect</code> package unless necessary, I can&#39;t resist a fun challenge to use it. Using it sort of walks the lines of the &quot;here be dragons&quot; territory."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1499121315, "post_id": 44894392, "comment_id": 76767237, "body": "Another solution that would be easier to implement would be to <code>json.Marshal</code> the <code>url.Values</code> map, then <code>json.Unmarshal</code> it back into your struct. This method may actually be easier to implement, but the JSON encoder/decoder tends to be rather bulky and less efficient. It might be less than straightforward though because <code>url.Values</code> is a <code>map[string][]string</code> so it would Marshal the values as arrays. This is why I opted for directly using the <code>reflect</code> package, because I knew off the top of my head roughly how it would work (and that it would)."}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "edited": false, "score": 0, "creation_date": 1499127685, "post_id": 44894392, "comment_id": 76768621, "body": "finally I managed to use this library that I found <a href=\"http://godoc.org/github.com/mitchellh/mapstructure#Decode\" rel=\"nofollow noreferrer\">godoc.org/github.com/mitchellh/mapstructure#Decode</a> it makes the job"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "edited": false, "score": 2, "creation_date": 1499128144, "post_id": 44894392, "comment_id": 76768704, "body": "Hmm look at that. You found a nice library that does the same thing. It&#39;s usually best to use a lib rather than reinvent the wheel. I suggest you post this as an answer to your own question. It&#39;s a good library, as far as I can tell at first glance."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 1, "last_activity_date": 1499124419, "last_edit_date": 1499124419, "creation_date": 1499119498, "answer_id": 44894392, "question_id": 44893792, "link": "https://stackoverflow.com/questions/44893792/handle-dynamic-parameters-in-url-in-golang/44894392#44894392", "title": "Handle dynamic parameters in URL in Golang", "body": "<p>You could use the <code>reflect</code> package to iterate over the fields and set them by name. Be aware that the <code>reflect</code> package is arduous to use and comes with some dangers of <code>panic</code>s if not used properly.</p>\n\n<p>Also be aware that <code>url.Values.Get</code> only returns the first value (see <a href=\"https://godoc.org/net/url#Values.Get\" rel=\"nofollow noreferrer\">https://godoc.org/net/url#Values.Get</a> for details)</p>\n\n<p>EDIT: I added code to account for the pointers in the struct. They are handled differently.</p>\n\n<p><a href=\"https://play.golang.org/p/AO4lYx7xka\" rel=\"nofollow noreferrer\">https://play.golang.org/p/AO4lYx7xka</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/url\"\n    \"reflect\"\n    \"time\"\n)\n\ntype Media struct {\n    ID                         uint\n    Key                        string\n    RecordKey                  string\n    RecordID                   string\n    SystemMediaKey             string\n    MediaObjectID              string\n    ChangedByID                string\n    ChangedByKey               string\n    MediaCategory              string\n    MimeType                   string\n    ShortDescription           string\n    LongDescription            string\n    EntryTimestamp             time.Time\n    ModificationTimestamp      time.Time\n    DeletedAtTimestamp         *time.Time\n    MediaModificationTimestamp time.Time\n    MediaURL                   string\n    MediaHTML                  string\n    Order                      int\n    Group                      string\n    Width                      int\n    Height                     int\n    ImageSize                  string\n    ResourceName               string\n    ClassName                  string\n    Permission                 *string\n    MediaStatus                string\n}\n\nfunc main() {\n\n    testUrl := \"www.example.com/test?MimeType=themimetype&amp;Key=thekey&amp;Permission=admin\"\n\n    u, err := url.Parse(testUrl)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    params := u.Query()\n\n    media := &amp;Media{}\n\n    val := reflect.ValueOf(media)\n\n    for i := 0; i &lt; val.Elem().NumField(); i++ {\n        // get the reflect.StructField so we can get the Name\n        f := val.Elem().Type().Field(i)\n\n        // check if URL.Values contains the field\n        if v := params.Get(f.Name); v != \"\" {\n            // get the reflect.Value associated with the Field\n            field := val.Elem().FieldByName(f.Name)\n\n            kind := field.Kind()\n\n            // you must switch for each reflect.Kind (associated with the type in your struct)\n            // so you know which Set... method to call\n            switch kind {\n            case reflect.String:\n                field.SetString(v)\n            case reflect.Ptr:\n                // pointers are a special case that must be handled manually unfortunately.\n                // because they default to nil, calling Elem() won't reveal the underlying type\n                // so you must simply string match the struct values that are pointers.\n                switch f.Name {\n                case \"Permission\":\n                    newVal := reflect.New(reflect.TypeOf(v))\n                    newVal.Elem().SetString(v)\n                    field.Set(newVal.Elem().Addr())\n                case \"DeletedAtTimestamp\":\n                }\n            }\n\n        }\n    }\n\n    fmt.Printf(\"%#v\\n\", media)\n    fmt.Println(*media.Permission)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "is_accepted": false, "score": 0, "last_activity_date": 1499205161, "creation_date": 1499205161, "answer_id": 44914402, "question_id": 44893792, "link": "https://stackoverflow.com/questions/44893792/handle-dynamic-parameters-in-url-in-golang/44914402#44914402", "title": "Handle dynamic parameters in URL in Golang", "body": "<p>I finally managed to use <a href=\"http://%20godoc.org/github.com/mitchellh/mapstructure\" rel=\"nofollow noreferrer\">this library</a> that converts a map to a struct. The only thing, is that I had to pre-process the map that is returned by <code>URL.Query() Values</code> because it returns an array for each value and I needed only the value and not inside an array.</p>\n"}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1851, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1499205161, "creation_date": 1499115516, "question_id": 44893792, "link": "https://stackoverflow.com/questions/44893792/handle-dynamic-parameters-in-url-in-golang", "title": "Handle dynamic parameters in URL in Golang", "body": "<p>currently am working on an API Rest in Golang. I have the process to CRUD all the tables. Now someone is asking me to develop an endpoint to search in one of that tables based on the parameters send in the URL. Let's say that this is my struct for that table:</p>\n\n<pre><code>type Media struct {\n    ID                         uint       \n    Key                   string     \n    RecordKey           string     \n    RecordID            string     \n    SystemMediaKey      string          \n    MediaObjectID       string   \n    ChangedByID         string   \n    ChangedByKey        string   \n    MediaCategory              string   \n    MimeType                   string   \n    ShortDescription           string   \n    LongDescription            string   \n    EntryTimestamp             time.Time\n    ModificationTimestamp      time.Time  \n    DeletedAtTimestamp         *time.Time \n    MediaModificationTimestamp time.Time\n    MediaURL                   string   \n    MediaHTML                  string   \n    Order                      int      \n    Group                      string   \n    Width                      int      \n    Height                     int      \n    ImageSize                  string   \n    ResourceName               string  \n    ClassName                  string \n    Permission                 *string\n    MediaStatus                string\n}\n</code></pre>\n\n<p>Now, he can send me all or some of that fields in the URL, the I need to assign that values to my struct to be able to search in the database based on the data assigned to the object.</p>\n\n<p>I am using Gorm to handle everything with the database, gorilla/schema to assign the values on the POST requests and the Julien Schmidt Router. Now,my questions are:</p>\n\n<ol>\n<li>What should I configure in the route to accept dynamic parameters?</li>\n<li>How can I assign the values that comes in the URL to the a type Media object?\nThank you!</li>\n</ol>\n"}, {"tags": ["file", "go", "package", "directory"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1499113793, "post_id": 44893435, "comment_id": 76764923, "body": "No. From <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to write Go Code</a>: &quot;Each package consists of one or more Go source files in a single directory. &quot;"}, {"owner": {"reputation": 241, "user_id": 5672542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29ab50545414b03b9c669d03bb631019?s=128&d=identicon&r=PG&f=1", "display_name": "Chelovek", "link": "https://stackoverflow.com/users/5672542/chelovek"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1499114011, "post_id": 44893435, "comment_id": 76765018, "body": "That is sad. But thanks anyway! Can you post this answer as a separate answer, so that i can mark the question answered?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1499114448, "post_id": 44893435, "comment_id": 76765191, "body": "Well, of course you can, it just is not simple and requires invoking the Go compiler (not the go tool) by hand. You do not want to do this."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1499203795, "post_id": 44893435, "comment_id": 76804912, "body": "Why do you think this is sad? I know it is strange at the beginning, but packages are something you create lots of when writing go applications. So no need to have everything in one folder."}], "answers": [{"tags": [], "owner": {"reputation": 620, "user_id": 1322651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e59e59204a86ec3da94e49eaf68f932?s=128&d=identicon&r=PG", "display_name": "Lukas Isselb&#228;cher", "link": "https://stackoverflow.com/users/1322651/lukas-isselb%c3%a4cher"}, "is_accepted": true, "score": 18, "last_activity_date": 1499167644, "creation_date": 1499167644, "answer_id": 44904743, "question_id": 44893435, "link": "https://stackoverflow.com/questions/44893435/go-golang-package-consisting-of-several-folders/44904743#44904743", "title": "Go (golang) Package consisting of several folders", "body": "<p>No, this is not possible.</p>\n\n<p>If you want to use folders inside your go project you have to use several packages.</p>\n\n<p><strong>NOT VALID</strong></p>\n\n<pre><code>myproject\n| -- main.go (package main)\n| -- routes.go (package main)\n+ -- models\n     | -- db.go (package main)\n     | -- mymodel.go (package main)\n</code></pre>\n\n<p><strong>VALID</strong></p>\n\n<pre><code>myproject\n| -- main.go (package main)\n| -- routes.go (package main)\n+ -- models\n     | -- db.go (package models)\n     | -- mymodel.go (package models)\n</code></pre>\n"}], "owner": {"reputation": 241, "user_id": 5672542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29ab50545414b03b9c669d03bb631019?s=128&d=identicon&r=PG&f=1", "display_name": "Chelovek", "link": "https://stackoverflow.com/users/5672542/chelovek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3835, "favorite_count": 1, "accepted_answer_id": 44904743, "answer_count": 1, "score": 11, "last_activity_date": 1499167644, "creation_date": 1499113496, "question_id": 44893435, "link": "https://stackoverflow.com/questions/44893435/go-golang-package-consisting-of-several-folders", "title": "Go (golang) Package consisting of several folders", "body": "<p>Is it possible in Go (golang) to have a package consisting of several .go files from different folders?</p>\n\n<p>I am trying to make a subfolder inside of the main folder, and compiler says that it cannot find definitions (\"undefined\" error). When all the files are in the same folder, compilation does not give errors.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "expression", "rule-engine"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1499112880, "post_id": 44893202, "comment_id": 76764583, "body": "Just a comment on your example. Your example <code>birth_date</code> is <code>2017</code> but your query is <code>&gt;= 2016... AND &lt;= 2016....</code>"}, {"owner": {"reputation": 637, "user_id": 673895, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c5a872b8c1949ee382fd068cabb90663?s=128&d=identicon&r=PG&f=1", "display_name": "Here to Learn.", "link": "https://stackoverflow.com/users/673895/here-to-learn"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1499113189, "post_id": 44893202, "comment_id": 76764694, "body": "Thanks for suggesting that! Corrected it."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1499114499, "post_id": 44893202, "comment_id": 76765212, "body": "Comment to your edit. See what all three dates evaluate to after <code>strconv.ParseFloat</code>-ing them. Also, note that the README is not talking about the <code>strconv.ParseFloat</code> representation, but the <code>time</code> package&#39;s representation. Specifically the <code>Unix()</code> function representation."}, {"owner": {"reputation": 637, "user_id": 673895, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c5a872b8c1949ee382fd068cabb90663?s=128&d=identicon&r=PG&f=1", "display_name": "Here to Learn.", "link": "https://stackoverflow.com/users/673895/here-to-learn"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1499115152, "post_id": 44893202, "comment_id": 76765456, "body": "Ohh.. All three date constants are all evaluating to value 0 on passing to strconv.ParseFloat(&quot;{value}&quot;, 64).   My use case is that input birth_date that i receive from REST call has to be evaluated against this expression. Trying to figure out a way using parameters in govaluate.  Another way would be to write a custom function"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1499115669, "post_id": 44893202, "comment_id": 76765640, "body": "It seems that the documentation is saying that the query is correct, but in your map you need the <code>time.Parse().Unix()</code> value of the date, not the string value of the date. P.S. That&#39;s what you get for ignoring the <code>error</code> return value of <code>ParseFloat</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1880, "user_id": 860453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cb3c4c3709da31b1eadf45c38f63fc97?s=128&d=identicon&r=PG", "display_name": "Knetic", "link": "https://stackoverflow.com/users/860453/knetic"}, "is_accepted": true, "score": 2, "last_activity_date": 1499120283, "last_edit_date": 1499120283, "creation_date": 1499117679, "answer_id": 44894148, "question_id": 44893202, "link": "https://stackoverflow.com/questions/44893202/compare-date-values-in-expression-using-govaluate/44894148#44894148", "title": "Compare date values in expression using govaluate", "body": "<p>Cross-posting my answer from <a href=\"https://github.com/Knetic/govaluate/issues/62\" rel=\"nofollow noreferrer\">the associated github issue</a>, for future googlers;</p>\n\n<p>The library doesn't try to parse string parameters as dates - it expects that <code>birth_date</code> will be the <a href=\"https://golang.org/pkg/time/#Time.Unix\" rel=\"nofollow noreferrer\"><code>Unix()</code></a> value of that date. This means you'll have to parse the date before passing it to govaluate.</p>\n\n<p>If you're getting <code>birth_date</code> as part of a REST api, I'd suggest settling on one specific date format (such as ISO8601) and doing something like:</p>\n\n<pre><code>var birthDateString string // &lt;-- the birth_date string you get from the request\n\niso8601 := \"2006-01-02T15:04:05Z0700\"\n\nbirthDate, err := time.ParseInLocation(iso8601, birthDateString, \ntime.Local)\nparameters[\"birth_date\"] = birthDate.Unix()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 637, "user_id": 673895, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c5a872b8c1949ee382fd068cabb90663?s=128&d=identicon&r=PG&f=1", "display_name": "Here to Learn.", "link": "https://stackoverflow.com/users/673895/here-to-learn"}, "is_accepted": false, "score": 1, "last_activity_date": 1499117801, "creation_date": 1499117801, "answer_id": 44894162, "question_id": 44893202, "link": "https://stackoverflow.com/questions/44893202/compare-date-values-in-expression-using-govaluate/44894162#44894162", "title": "Compare date values in expression using govaluate", "body": "<p>Here is the working solution:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/Knetic/govaluate\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc main()  {\n    expression, err := govaluate.NewEvaluableExpression(\"first_name == 'Julian' &amp;&amp; emp_id == 302 &amp;&amp; birth_date &gt;= '2016-12-15' &amp;&amp; birth_date &lt;= '2016-12-25'\")\n\n    parameters := make(map[string]interface{}, 8)\n    parameters[\"first_name\"] = \"Julian\"\n    parameters[\"emp_id\"] = 302\n    iso8601 := \"2006-01-02\"\n    birthDate, err := time.ParseInLocation(iso8601, \"2016-12-15\", time.Local)\n    parameters[\"birth_date\"] = birthDate.Unix()\n    result, err := expression.Evaluate(parameters)\n\n    if err != nil {\n        fmt.Println(\"Error while evaluating the expression\")\n    }\n\n    if result.(bool) {\n        fmt.Println(\"Condition is evaluated to true\")\n    } else {\n        fmt.Println(\"Condition is evaluated to false\")\n    }\n}\n</code></pre>\n\n<p>Thank you Library owner and @RayfenWindspear for helping me out on this! Really appreciate!</p>\n"}], "owner": {"reputation": 637, "user_id": 673895, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c5a872b8c1949ee382fd068cabb90663?s=128&d=identicon&r=PG&f=1", "display_name": "Here to Learn.", "link": "https://stackoverflow.com/users/673895/here-to-learn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 0, "accepted_answer_id": 44894148, "answer_count": 2, "score": 1, "last_activity_date": 1499120283, "creation_date": 1499112416, "last_edit_date": 1499114220, "question_id": 44893202, "link": "https://stackoverflow.com/questions/44893202/compare-date-values-in-expression-using-govaluate", "title": "Compare date values in expression using govaluate", "body": "<p>I am trying to build a rule engine using govaluate: <a href=\"https://github.com/Knetic/govaluate\" rel=\"nofollow noreferrer\">https://github.com/Knetic/govaluate</a></p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/Knetic/govaluate\"\n    \"fmt\"\n)\n\nfunc main()  {\n    expression, err := govaluate.NewEvaluableExpression(\"first_name == 'Julian' &amp;&amp; emp_id == 302 &amp;&amp; birth_date &gt;= '2016-12-12' &amp;&amp; birth_date &lt;= '2016-12-25'\")\n\n    parameters := make(map[string]interface{}, 8)\n    parameters[\"first_name\"] = \"Julian\"\n    parameters[\"emp_id\"] = 302\n    parameters[\"birth_date\"] = \"2016-12-15\"\n    result, err := expression.Evaluate(parameters)\n\n    if err != nil {\n        fmt.Println(\"Error while evaluating the expression\")\n    }\n\n    if result.(bool) {\n        fmt.Println(\"Condition is evaluated to true\")\n    } else {\n        fmt.Println(\"Condition is evaluated to false\")\n    }\n}\n</code></pre>\n\n<p>While browsing through govaluate Types documentation (<a href=\"https://github.com/Knetic/govaluate/blob/master/MANUAL.md\" rel=\"nofollow noreferrer\">https://github.com/Knetic/govaluate/blob/master/MANUAL.md</a>), I noticed this statement \"<em>Any string literal (not parameter) which is interpretable as a date will be converted to a float64 representation of that date's unix time.</em>\"</p>\n\n<p>When i execute the above program, i see an issue with result being null:</p>\n\n<pre><code>Error while evaluating the expression\npanic: interface conversion: interface is nil, not bool\n</code></pre>\n\n<p>My question is whether date value can be passed in as a parameter? As i want to compare date values in runtime, this functionality would be needed.</p>\n\n<p>Is there a way to achieve it? May be my usage pattern is wrong. Please suggest.</p>\n\n<p><strong>Edit:</strong></p>\n\n<pre><code>expression, err := govaluate.NewEvaluableExpression(\"first_name == 'Julian' &amp;&amp; emp_id == 302 &amp;&amp; birth_date &gt;= '2016-12-12' &amp;&amp; birth_date &lt;= '2016-12-25'\")\ndateFloat, _ := strconv.ParseFloat(\"2016-12-15\", 64)\nparameters[\"birth_date\"] = dateFloat\nresult, err := expression.Evaluate(parameters)\n</code></pre>\n\n<p>Changed the date to float format and invoked Evaluate function. Now the condition is evaluated to false. But logically,  2016-12-15 falls between 2016-12-12 and 2016-12-25. The expression should be evaluated to true.</p>\n\n<p>Thanks in advance!  </p>\n"}, {"tags": ["json", "go", "marshalling", "rpc", "json-rpc"], "comments": [{"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499109981, "post_id": 44892236, "comment_id": 76763306, "body": "Current implementation of net/rpc/jsonrpc take 1 argument for struct argument. <a href=\"https://github.com/golang/go/blob/5fea2ccc77eb50a9704fa04b7c61755fe34e1d95/src/net/rpc/jsonrpc/server.go#L91-L97\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/&hellip;</a> If you want to pass named arguments, please pass as slice of struct."}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 1, "last_activity_date": 1499109395, "creation_date": 1499109395, "answer_id": 44892588, "question_id": 44892236, "link": "https://stackoverflow.com/questions/44892236/json-rpc-cannot-unmarshal-object/44892588#44892588", "title": "JSON-RPC, &quot;cannot unmarshal object&quot;", "body": "<p>Your code seems fine.</p>\n\n<p>But in the request, <code>params</code> is expected to be an array containing the actual parameters.</p>\n\n<p>Try with the following payload and it should work:</p>\n\n<pre><code>{ \n  \"jsonrpc\":\"2.0\",\n  \"method\":\"Arithmetic.Multiply\", \n  \"params\": [ { \"A\": 5, \"B\": 6 } ], \n  \"id\":1 \n} \n</code></pre>\n\n<p>(Note the \"[\" and \"]\" enclosing the actual param)</p>\n"}], "owner": {"reputation": 241, "user_id": 5672542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29ab50545414b03b9c669d03bb631019?s=128&d=identicon&r=PG&f=1", "display_name": "Chelovek", "link": "https://stackoverflow.com/users/5672542/chelovek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 952, "favorite_count": 0, "accepted_answer_id": 44892588, "answer_count": 1, "score": 0, "last_activity_date": 1499110649, "creation_date": 1499107826, "last_edit_date": 1499110649, "question_id": 44892236, "link": "https://stackoverflow.com/questions/44892236/json-rpc-cannot-unmarshal-object", "title": "JSON-RPC, &quot;cannot unmarshal object&quot;", "body": "<p>I am trying to learn how JSON-RPC works and am testing it in Go language (golang). The Go program works fine. It does what it should do. But when I try to make a raw request via telnet, it gives an error.</p>\n\n<p>The working and super simple JSON-RPC server is described here:</p>\n\n<pre><code>    // rpc_json_server.go\n\n    package main\n\n    import (\n        \"log\"\n        \"net\"\n        \"net/http\"\n        \"net/rpc\"\n        \"net/rpc/jsonrpc\"\n    )\n\n    //------------------------------------------------------------------------------\n    // Types\n    //------------------------------------------------------------------------------\n\n    type Arithmetic int // Used as RPC Service called 'Arithmetic'\n\n    type Arguments struct {\n        A int\n        B int\n    }\n\n    type Result int\n\n    //------------------------------------------------------------------------------\n    // Methods\n    //------------------------------------------------------------------------------\n\n    func (t *Arithmetic) Multiply(args *Arguments, res *Result) error {\n\n        *res = Result(args.A * args.B)\n\n        return nil\n    }\n\n    //------------------------------------------------------------------------------\n\n    func main() {\n\n        var srv *rpc.Server\n        var err error\n        var arith *Arithmetic\n        var listener net.Listener\n        var codec rpc.ServerCodec\n        var srv_conntype, srv_host, srv_port, srv_addr, srv_path string\n        var srv_debugPath string\n        var connection net.Conn\n\n        srv_conntype = \"tcp\"\n        srv_host = \"0.0.0.0\"\n        srv_port = \"3000\"\n        srv_addr = srv_host + \":\" + srv_port\n        srv_path = \"/\"\n        srv_debugPath = \"/debug\"\n\n        // Create Server, register Service\n        srv = rpc.NewServer()\n        arith = new(Arithmetic)\n        err = srv.Register(arith)\n        if err != nil {\n            log.Fatalf(\"Error. Service Format is not correct. %s\\r\\n\", err) //dbg\n        }\n\n        // Handle, listen\n        srv.HandleHTTP(srv_path, srv_debugPath)\n        listener, err = net.Listen(srv_conntype, srv_addr)\n        if err != nil {\n            log.Fatalf(\"Error. Can not listen on %s. %s\\r\\n\", srv_addr, err) //dbg\n        }\n        log.Printf(\"Started RPC Handler at %s.\\r\\n\", srv_addr) //dbg\n\n        // Serve\n        for {\n\n            connection, err = listener.Accept()\n            if err != nil {\n                log.Fatal(err)\n            }\n\n            codec = jsonrpc.NewServerCodec(connection)\n\n            go srv.ServeCodec(codec)\n        }\n\n        err = http.Serve(listener, nil)\n        if err != nil {\n            log.Fatalf(\"Serve Error. %s\\r\\n\", err) //dbg\n        }\n    }\n\n    //------------------------------------------------------------------------------\n</code></pre>\n\n<p>The working and super simple JSON-RPC client's code is following:</p>\n\n<pre><code>    // rpc_json_client.go\n\n    package main\n\n    import (\n        \"fmt\"\n        \"log\"\n        \"net\"\n        \"net/rpc\"\n        \"net/rpc/jsonrpc\"\n    )\n\n    //------------------------------------------------------------------------------\n    // Types\n    //------------------------------------------------------------------------------\n\n    type Arithmetic int // Used as RPC Service called 'Arithmetic'\n\n    type Arguments struct {\n        A int\n        B int\n    }\n\n    type Result int\n\n    //------------------------------------------------------------------------------\n    // Methods\n    //------------------------------------------------------------------------------\n\n    func main() {\n\n        var err error\n        var srv_conntype, srv_host, srv_port, srv_addr string\n        //var srv_path string\n        var client *rpc.Client\n        var args Arguments\n        var result Result\n        var serviceName, methodName, funcName string\n        var connection net.Conn\n\n        srv_conntype = \"tcp\"\n        srv_host = \"0.0.0.0\"\n        srv_port = \"3000\"\n        srv_addr = srv_host + \":\" + srv_port\n        //srv_path = \"/\"\n\n        // Connect to RPC Server\n        connection, err = net.Dial(srv_conntype, srv_addr)\n        if err != nil {\n            log.Fatalf(\"Error. Can not connect to %s. %s\\r\\n\", srv_addr, err) //dbg\n        }\n        defer connection.Close()\n\n        // Client\n        client = jsonrpc.NewClient(connection)\n\n        // Prepare Call\n        serviceName = \"Arithmetic\"\n        methodName = \"Multiply\"\n        funcName = serviceName + \".\" + methodName\n        args.A = 7\n        args.B = 8\n\n        // Call remote Procedure\n        err = client.Call(funcName, args, &amp;result)\n        if err != nil {\n            log.Fatalf(\"Error. %s\\r\\n\", err) //dbg\n        }\n\n        // Show Results\n        fmt.Printf(\"[%d; %d] -&gt; [%d].\\r\\n\", args.A, args.B, result) //dbg\n    }\n</code></pre>\n\n<p>Once again. This golang program works fine.</p>\n\n<p>But the next thing I cannot understand.</p>\n\n<pre><code>    telnet localhost 3000\n    Trying 127.0.0.1...\n    Connected to localhost.\n    Escape character is '^]'.\n    {\n    \"jsonrpc\":\"2.0\", \n    \"method\":\"Arithmetic.Multiply\", \n    \"params\": { \"A\": 5, \"B\": 6 },\n    \"id\":1\n    }\n    {\"id\":1,\"result\":null,\"error\":\"json: cannot unmarshal object into Go value of type [1]interface {}\"}\n</code></pre>\n\n<p>Please, give me some advice or the reason for such an error. What is wrong in the raw request?</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1499103036, "post_id": 44891030, "comment_id": 76760178, "body": "I personally don&#39;t allow nulls in my DB when the main interfacing language is Go. I purposefully normalize the DB such that this is possible. I realize this isn&#39;t applicable to everyone, so it&#39;s just a suggestion."}], "answers": [{"comments": [{"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 1, "creation_date": 1499155719, "post_id": 44891218, "comment_id": 76778237, "body": "So how would you rewrite the query above?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1499158784, "post_id": 44891218, "comment_id": 76780178, "body": "@Karlom The query is the same, you just use a <code>sql.NullString</code> field instead of <code>*string</code> in the <code>interface{}</code> you pass to it to populate."}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1499166747, "post_id": 44891218, "comment_id": 76785605, "body": "Please provide the code. I&#39;m unable to follow your instructions."}, {"owner": {"reputation": 665, "user_id": 1928660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/rnpOq.png?s=128&g=1", "display_name": "ATN", "link": "https://stackoverflow.com/users/1928660/atn"}, "edited": false, "score": 1, "creation_date": 1509967240, "post_id": 44891218, "comment_id": 81220705, "body": "In more details: <a href=\"https://medium.com/aubergine-solutions/how-i-handled-null-possible-values-from-database-rows-in-golang-521fb0ee267\" rel=\"nofollow noreferrer\">medium.com/aubergine-solutions/&hellip;</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 665, "user_id": 1928660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/rnpOq.png?s=128&g=1", "display_name": "ATN", "link": "https://stackoverflow.com/users/1928660/atn"}, "edited": false, "score": 0, "creation_date": 1509967810, "post_id": 44891218, "comment_id": 81221065, "body": "@ATN Thanks for that, I&#39;ll include it in the answer, though I still personally advocate for non-null databases, I realize their usefulness in determining if a value was set or if a zero value was actually the real value."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 17, "last_activity_date": 1509967889, "last_edit_date": 1509967889, "creation_date": 1499103148, "answer_id": 44891218, "question_id": 44891030, "link": "https://stackoverflow.com/questions/44891030/scan-error-unsupported-scan-storing-driver-value-type-nil-into-type-string/44891218#44891218", "title": "Scan error: unsupported Scan, storing driver.Value type &lt;nil&gt; into type *string", "body": "<p>Use <code>sql.NullString</code>.</p>\n\n<p><a href=\"https://godoc.org/database/sql#NullString\" rel=\"noreferrer\">https://godoc.org/database/sql#NullString</a></p>\n\n<p>Personally, I hate this solution, which is why I normalize my DB so that there are no <code>NULL</code>s.</p>\n\n<p>Either change </p>\n\n<pre><code>var result []Article\n</code></pre>\n\n<p>To</p>\n\n<pre><code>var result []sql.NullString\n</code></pre>\n\n<p>Then take those results and make a <code>[]Article</code> using the checks from the documentation.</p>\n\n<p>Or in your struct, change</p>\n\n<pre><code>Photo *string\n</code></pre>\n\n<p>To</p>\n\n<pre><code>Photo sql.NullString\n</code></pre>\n\n<p>And deal with the annoyance of it being a struct instead of a <code>*string</code></p>\n\n<p>Thanks to ATN, see here for a guide <a href=\"https://medium.com/aubergine-solutions/how-i-handled-null-possible-values-from-database-rows-in-golang-521fb0ee267\" rel=\"noreferrer\">https://medium.com/aubergine-solutions/how-i-handled-null-possible-values-from-database-rows-in-golang-521fb0ee267</a></p>\n"}, {"comments": [{"owner": {"reputation": 826, "user_id": 559525, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/b2a0958f5742f5226ae0acb3ea07cf8c?s=128&d=identicon&r=PG", "display_name": "Eradicatore", "link": "https://stackoverflow.com/users/559525/eradicatore"}, "edited": false, "score": 1, "creation_date": 1601562753, "post_id": 59907621, "comment_id": 113451758, "body": "yes, coalesce works great for times like this for me!"}], "tags": [], "owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "is_accepted": false, "score": 1, "last_activity_date": 1579941210, "creation_date": 1579941210, "answer_id": 59907621, "question_id": 44891030, "link": "https://stackoverflow.com/questions/44891030/scan-error-unsupported-scan-storing-driver-value-type-nil-into-type-string/59907621#59907621", "title": "Scan error: unsupported Scan, storing driver.Value type &lt;nil&gt; into type *string", "body": "<p>You can use any of the below two solutions:-</p>\n\n<ol>\n<li>You can use <code>sql.NullString</code> to handle the field before using scan(). OR</li>\n<li>You can replace all the possible <code>NULL</code> values with the desired string say <code>''</code> from the query itself.</li>\n</ol>\n\n<p>For implementing the 1st solution refer to the @RayfenWindspear answer.\nFor the 2nd solution update the query as below:-</p>\n\n<pre><code>SELECT colm1, colm2, COALESCE(photo, '') photo, colm4 FROM Article WHERE photo IS NULL\n</code></pre>\n\n<p><strong>For MySQL</strong> use <code>IFNULL()</code> or <code>COALESCE()</code> function to return an alternative value if an expression is NULL:</p>\n\n<p><strong>For SQL Server</strong> use <code>IFNULL()</code> or <code>COALESCE()</code> function for the same result</p>\n\n<p><strong>MS Access</strong> use <code>IsNull</code> function for the same result</p>\n\n<p><strong>For Oracle</strong> use <code>NVL()</code> function for the same result</p>\n\n<p>Reference: <a href=\"https://www.w3schools.com/sql/sql_isnull.asp\" rel=\"nofollow noreferrer\">https://www.w3schools.com/sql/sql_isnull.asp</a></p>\n"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17868, "favorite_count": 0, "accepted_answer_id": 44891218, "answer_count": 2, "score": 13, "last_activity_date": 1608172189, "creation_date": 1499102406, "question_id": 44891030, "link": "https://stackoverflow.com/questions/44891030/scan-error-unsupported-scan-storing-driver-value-type-nil-into-type-string", "title": "Scan error: unsupported Scan, storing driver.Value type &lt;nil&gt; into type *string", "body": "<p>When I try to fetch Articles without photo from mysql database:</p>\n\n<pre><code>func ArticlesAllText() ([]Article, error) {\n    var err error\n    var result []Article\n    err = database.SQL.Select(&amp;result, \"SELECT * FROM Article WHERE photo IS NULL\")\n    if err != nil {\n        log.Println(err)\n    }\n    return result, standardizeError(err)\n}\n</code></pre>\n\n<p>I get </p>\n\n<blockquote>\n  <p>sql: Scan error on column index 10: unsupported Scan, storing\n  driver.Value type  into type *string</p>\n</blockquote>\n\n<p>When the field value is <code>NULL</code>. </p>\n\n<p>How can I fix this? </p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1499101539, "post_id": 44890827, "comment_id": 76759530, "body": "That JSON object is invalid."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1499101733, "post_id": 44890827, "comment_id": 76759635, "body": "If you want consultation or example code, try the documentation. If you have tried to implement something and you&#39;re running into a problem, post a question."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1499111702, "post_id": 44890997, "comment_id": 76764079, "body": "I find myself wondering if we should advocate for less hand-holding in the go tagged questions... At the same time though, I would rather see more adoption of the language. Tough call."}], "tags": [], "owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "is_accepted": true, "score": 1, "last_activity_date": 1499102252, "creation_date": 1499102252, "answer_id": 44890997, "question_id": 44890827, "link": "https://stackoverflow.com/questions/44890827/how-i-can-encode-json-with-multiple-elements-in-go-lang/44890997#44890997", "title": "How I can encode JSON with multiple elements in Go Lang", "body": "<p>Here you are.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"time\"\n)\n\ntype Elememt struct {\n    ID int `json:\"id\"`\n    FirstName string `json:\"first_name\"`\n    LastName string `json:\"last_name\"`\n    Time time.Time `json:\"time\"`\n    Count int `json:\"count\"`\n    Payout string `json:\"payout\"`\n}\n\nfunc main() {\n    elements := []Elememt {\n        {\n            ID: 1,\n            FirstName: \"Dmitriy\",\n            LastName: \"Groschovskiy\",\n            Time: time.Now(),\n            Count: 1,\n            Payout: \"200\",\n        },\n        {\n            ID: 2,\n            FirstName: \"Yasuhiro\",\n            LastName: \"Matsumoto\",\n            Time: time.Now(),\n            Count: 2,\n            Payout: \"150\",\n        },\n    }\n\n    var buf bytes.Buffer\n    err := json.NewEncoder(&amp;buf).Encode(elements)\n    if err != nil {\n        log.Fatal(err)\n    }\n    req, err := http.NewRequest(\"POST\", \"http://httpbin.org/post\", &amp;buf)\n    if err != nil {\n        log.Fatal(err)\n    }\n    resp, err := http.DefaultClient.Do(req)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer resp.Body.Close()\n\n    io.Copy(os.Stdout, resp.Body)\n}\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 4443005, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/bCcyL.jpg?s=128&g=1", "display_name": "Dmitriy Groschovskiy", "link": "https://stackoverflow.com/users/4443005/dmitriy-groschovskiy"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "closed_date": 1499105854, "accepted_answer_id": 44890997, "answer_count": 1, "score": -6, "last_activity_date": 1499102252, "creation_date": 1499101461, "question_id": 44890827, "link": "https://stackoverflow.com/questions/44890827/how-i-can-encode-json-with-multiple-elements-in-go-lang", "closed_reason": "Needs details or clarity", "title": "How I can encode JSON with multiple elements in Go Lang", "body": "<p>I need consultation or sample code how I can send to customer multiple elements in JSON. Thank you!</p>\n\n<p>I need next JSON structure:</p>\n\n<pre><code>{{\"id\":123,\"first_name\":\"Demo\",\"last_name\":\"User\",\"time\":\"2017-07-03T16:36:41.4101847Z\",\"count\":1,\"payout\":\"839`\"},{\"id\":124,\"first_name\":\"Demo\",\"last_name\":\"User1\",\"time\":\"2017-07-03T16:36:41.4101847Z\",\"count\":1,\"payout\":\"839`\"},{\"id\":125,\"first_name\":\"Demo\",\"last_name\":\"User2\",\"time\":\"2017-07-03T16:36:41.4101847Z\",\"count\":1,\"payout\":\"839`\"}}\n</code></pre>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1499096212, "post_id": 44889361, "comment_id": 76756821, "body": "If you want JSON arrays, why are you using maps? Do you need to start with that exact data structure?"}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 1, "creation_date": 1499096259, "post_id": 44889361, "comment_id": 76756854, "body": "^. You need to use slices/arrays instead of maps. A map correlates to a JSON object, whereas a slice/array correlates to a list. Try <code>[]interface{}</code>, as opposed to <code>map[int]string</code> or <code>map[int]float32</code>, since you have a list of variable types."}, {"owner": {"reputation": 1729, "user_id": 1219163, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wPEsh.jpg?s=128&g=1", "display_name": "Li3ro", "link": "https://stackoverflow.com/users/1219163/li3ro"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1499096359, "post_id": 44889361, "comment_id": 76756919, "body": "@JimB yes, I need that exact struct. Can&#39;t figure a way to &quot;unmarshal&quot; it.."}, {"owner": {"reputation": 1729, "user_id": 1219163, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wPEsh.jpg?s=128&g=1", "display_name": "Li3ro", "link": "https://stackoverflow.com/users/1219163/li3ro"}, "reply_to_user": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1499096400, "post_id": 44889361, "comment_id": 76756942, "body": "@Lansana could u please show an example?"}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 1, "creation_date": 1499096442, "post_id": 44889361, "comment_id": 76756964, "body": "You may need an adapter method that will convert one structure to another so that it will be unmarshalled correctly. You cannot have a direct 1:1 mapping for unmarshal in some cases based on unique requirements of data types, and yours may be such a case. For instance, pass in a slice of structs, return a slice of interface{} where the values are the values of the structs."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1499096490, "post_id": 44889361, "comment_id": 76756995, "body": "@Li3ro, your struct is a completely different structure form the JSON. Marshal/unmarshal with a structure that matches the JSON."}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 1, "creation_date": 1499097095, "post_id": 44889361, "comment_id": 76757343, "body": "Let me know if my answer works for you."}, {"owner": {"reputation": 1729, "user_id": 1219163, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wPEsh.jpg?s=128&g=1", "display_name": "Li3ro", "link": "https://stackoverflow.com/users/1219163/li3ro"}, "edited": false, "score": 0, "creation_date": 1499097323, "post_id": 44889361, "comment_id": 76757463, "body": "Tnx- sorry for stalling.. checking your answer now. again Tnx m8!"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 1, "creation_date": 1499097900, "post_id": 44889361, "comment_id": 76757775, "body": "please update <code>x := []MyStruct{{Zero: map[int]string{0: &quot;str&quot;}, One: map[int]float32{1: 5.6}, Two: map[int]float32{1: 5.88}}}</code> this as your expected"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 1, "creation_date": 1499097926, "post_id": 44889361, "comment_id": 76757788, "body": "I don&#39;t understand why Two have key 1."}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 1, "creation_date": 1499098010, "post_id": 44889361, "comment_id": 76757837, "body": "maybe your Zero/One/Two should be slice not map."}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 1, "creation_date": 1499098056, "post_id": 44889361, "comment_id": 76757860, "body": "I&#39;m confusing why you expect <code>[]MyStruct</code> ?"}], "answers": [{"comments": [{"owner": {"reputation": 1729, "user_id": 1219163, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wPEsh.jpg?s=128&g=1", "display_name": "Li3ro", "link": "https://stackoverflow.com/users/1219163/li3ro"}, "edited": false, "score": 0, "creation_date": 1499098163, "post_id": 44889636, "comment_id": 76757927, "body": "this compiles.. and I guess will work! but I cant test it since this little struct is part of a monster tree of structs I use, and when I need to unmarshal, It will unmarshal them all together. I wonder if there is a way to call this function on unmarshaling.."}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "reply_to_user": {"reputation": 1729, "user_id": 1219163, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wPEsh.jpg?s=128&g=1", "display_name": "Li3ro", "link": "https://stackoverflow.com/users/1219163/li3ro"}, "edited": false, "score": 1, "creation_date": 1499098296, "post_id": 44889636, "comment_id": 76757996, "body": "Oh I see.. hmm yeah I don&#39;t believe there is any sort of &quot;callback&quot; for unmarshal that gives you lifecycle access to do something like that. But you can try to call the adapter method on the monster struct recursively for every <code>Timestamp</code> property before unmarshalling."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1499101491, "post_id": 44889636, "comment_id": 76759513, "body": "@Lansana, of course there is. That&#39;s what the <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\"><code>Marshaler</code></a> and <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\"><code>Unmarshaler</code></a> interfaces are."}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1499103213, "post_id": 44889636, "comment_id": 76760268, "body": "@JimB Ah, good catch! I have not yet been exposed to those interfaces."}], "tags": [], "owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "is_accepted": false, "score": 2, "last_activity_date": 1499097283, "last_edit_date": 1499097283, "creation_date": 1499096753, "answer_id": 44889636, "question_id": 44889361, "link": "https://stackoverflow.com/questions/44889361/unmarshaling-array-of-objects-in-go/44889636#44889636", "title": "Unmarshaling array of objects in Go", "body": "<p>The problem you are having is you're trying to unmarshal a map, and a map will correlate to a JSON object. Your desired output is a list, so you need to unmarshal an array or a slice to get a list as your values.</p>\n\n<p>Try making an adapter.</p>\n\n<p>Small example:</p>\n\n<pre><code>type Object struct {\n    Base   float32 \n    Radius float32 \n    Height float32 \n    X      float32 \n    Y      float32 \n}\n\nfunc (obj *Object) ToCircle() *Circle {\n    return &amp;Circle{\n        Radius: obj.Radius,\n        X:      obj.X,\n        Y:      obj.Y,\n    }\n}\n\nfunc (obj *Object) ToRectangle() *Rectangle {\n    return &amp;Rectangle{\n        Base:   obj.Base,\n        Height: obj.Height,\n        X:      obj.X,\n        Y:      obj.Y,\n    }\n}\n</code></pre>\n\n<p>In the example above, <code>Object</code> is converted to a <code>Rectangle</code> or a <code>Circle</code> using the <code>ToRectangle()</code> and <code>ToCircle()</code> adapters, respectively. In your case, you need to convert <code>Timestamp</code> to a <code>[]interface{}</code>. Then you can unmarshal and you'll just get a list of whatever values are in that slice, which is your desired output in this case.</p>\n\n<p>For intsance, the signature if your adapter could look like this:</p>\n\n<pre><code>func (t *Timestamp) ToFoo() []interface{} {\n    var ret []interface{}\n\n    // Do some stuff to take values of 't' and append to 'ret'\n\n    return ret\n}\n\nfunc main() {\n    var result []interface{}\n\n    json.Unmarshal(t.ToFoo(), &amp;result)\n\n    // ...\n}\n</code></pre>\n\n<p>I'll leave the implementation details for you.</p>\n"}, {"comments": [{"owner": {"reputation": 1729, "user_id": 1219163, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wPEsh.jpg?s=128&g=1", "display_name": "Li3ro", "link": "https://stackoverflow.com/users/1219163/li3ro"}, "edited": false, "score": 0, "creation_date": 1499173023, "post_id": 44890106, "comment_id": 76790237, "body": "This worked for me so this is the accepted answer. Thank you both"}], "tags": [], "owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "is_accepted": true, "score": 4, "last_activity_date": 1499098555, "creation_date": 1499098555, "answer_id": 44890106, "question_id": 44889361, "link": "https://stackoverflow.com/questions/44889361/unmarshaling-array-of-objects-in-go/44890106#44890106", "title": "Unmarshaling array of objects in Go", "body": "<p>Maybe this is your expected. It's possible to implement custom MarshalJSON/UnmarshalJSON.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"errors\"\n    \"fmt\"\n    \"log\"\n)\n\ntype Timestamp struct {\n    Zero []string\n    One  []float32\n    Two  []float32\n}\n\nfunc (t *Timestamp) UnmarshalJSON(b []byte) error {\n    var arr [][3]interface{}\n    err := json.Unmarshal(b, &amp;arr)\n    if err != nil {\n        return nil\n    }\n    t.Zero = nil\n    t.One = nil\n    t.Two = nil\n    for _, v := range arr {\n        if len(v) != 3 {\n            return errors.New(\"invalid json\")\n        }\n        if s, ok := v[0].(string); ok {\n            t.Zero = append(t.Zero, s)\n        }\n        if f, ok := v[1].(float64); ok {\n            t.One = append(t.One, float32(f))\n        }\n        if f, ok := v[2].(float64); ok {\n            t.Two = append(t.Two, float32(f))\n        }\n    }\n    return nil\n}\n\nfunc (t *Timestamp) MarshalJSON() ([]byte, error) {\n    var arr [][3]interface{}\n    var max int\n    if max &lt; len(t.Zero) {\n        max = len(t.Zero)\n    }\n    if max &lt; len(t.One) {\n        max = len(t.One)\n    }\n    if max &lt; len(t.Two) {\n        max = len(t.Two)\n    }\n    for i := 0; i &lt; max; i++ {\n        var v [3]interface{}\n        if i &lt; len(t.Zero) {\n            v[0] = t.Zero[i]\n        }\n        if i &lt; len(t.One) {\n            v[1] = t.One[i]\n        }\n        if i &lt; len(t.Two) {\n            v[2] = t.Two[i]\n        }\n        arr = append(arr, v)\n    }\n    return json.Marshal(arr)\n}\n\nconst j = `[[\"my\",257.14,257.24],[\"txt\", 121.11, 65.555]]`\n\nfunc main() {\n    var ts Timestamp\n    err := json.Unmarshal([]byte(j), &amp;ts)\n    if err != nil {\n        log.Fatal(err)\n    }\n    b, err := json.Marshal(&amp;ts)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(string(b))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/WtVEja1JDY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WtVEja1JDY</a></p>\n"}], "owner": {"reputation": 1729, "user_id": 1219163, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wPEsh.jpg?s=128&g=1", "display_name": "Li3ro", "link": "https://stackoverflow.com/users/1219163/li3ro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1386, "favorite_count": 0, "accepted_answer_id": 44890106, "answer_count": 2, "score": 1, "last_activity_date": 1499098555, "creation_date": 1499095910, "question_id": 44889361, "link": "https://stackoverflow.com/questions/44889361/unmarshaling-array-of-objects-in-go", "title": "Unmarshaling array of objects in Go", "body": "<p>in GO, I've tried to produce the following json :</p>\n\n<pre><code>[[\"my\",257.14,257.24],[\"txt\", 121.11, 65.555]]\n</code></pre>\n\n<p>from a struct that's undergo unmarshaling - and i'm failing to do so.</p>\n\n<p>Here is what I tried:</p>\n\n<pre><code>x := []MyStruct{{Zero: map[int]string{0: \"str\"}, One: map[int]float32{1: 5.6}, Two: map[int]float32{1: 5.88}}}\n</code></pre>\n\n<p>where MyStruct is :</p>\n\n<pre><code>type Timestamp struct {\n  Zero      map[int]string      `json:\"0\"`\n  One       map[int]float32     `json:\"1\"`\n  Two       map[int]float32     `json:\"2\"`\n}\n</code></pre>\n\n<p>this produces the wrong json structure:</p>\n\n<pre><code>\"myStruct\":[{\"0\":{\"0\":\"has\"},\"1\":{\"1\":5.6},\"2\":{\"1\":5.88}}]\n</code></pre>\n\n<p>tried <a href=\"https://stackoverflow.com/questions/33031354/how-to-create-array-of-objects-in-golang\">this</a> as well</p>\n\n<p>any clue in the right direction will be highly appreciated.</p>\n"}, {"tags": ["node.js", "go", "architecture", "server", "client"], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 2767079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31b04c8a2143f5372e582f589cee17df?s=128&d=identicon&r=PG&f=1", "display_name": "tcsullens", "link": "https://stackoverflow.com/users/2767079/tcsullens"}, "is_accepted": true, "score": 0, "last_activity_date": 1499101354, "creation_date": 1499101354, "answer_id": 44890804, "question_id": 44889128, "link": "https://stackoverflow.com/questions/44889128/basic-client-server-architecture-interactions/44890804#44890804", "title": "Basic Client/Server Architecture &amp; Interactions", "body": "<ol start=\"4\">\n<li>The client ACKs (responds to server) that it has also updated local state to be synchronous with the server.</li>\n</ol>\n\n<p>If 4. doesn't happen, then the server rolls back the transaction done in 1. and the entire operation of 1 - 4 is atomic.</p>\n"}], "owner": {"reputation": 288, "user_id": 4404508, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/77b6a8b0a98654e2e4622954e3c928db?s=128&d=identicon&r=PG&f=1", "display_name": "Sam S.", "link": "https://stackoverflow.com/users/4404508/sam-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 44890804, "answer_count": 1, "score": 0, "last_activity_date": 1499101354, "creation_date": 1499095196, "last_edit_date": 1499097079, "question_id": 44889128, "link": "https://stackoverflow.com/questions/44889128/basic-client-server-architecture-interactions", "title": "Basic Client/Server Architecture &amp; Interactions", "body": "<p>I'm trying to implement a client and server and define their interactions. The client is designed using Golang, the server is designed in Node.js, and they interact using gRPC.</p>\n\n<p>So the basic gist is:</p>\n\n<ol>\n<li>Client contacts server to update backend DB</li>\n<li>Client receives success response from server</li>\n<li>Client then itself changes the state of the overall system that the DB now reflects</li>\n</ol>\n\n<p>But say something were to happen such that the process dies between steps 2 and 3 (Client process is terminated somehow). What is the best way to ensure that my backend DB doesn't reflect a system state that is inconsistent with reality? I'm sure this isn't a novel problem and would just like a couple pointers to how people typically cope with this type of design.</p>\n\n<p>\nSo I've already thought of redesigning this interaction such that the server is the entity that will handle the system changes\u2014 that way everything is handled in the same request and on the backend\u2014 but I'm using an open source technology that is designed in Go (so I can easily wrap it in my Go client). In other words, the client <b>must</b> be the entity that performs that system-change operation.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1499090050, "post_id": 44887356, "comment_id": 76752764, "body": "your declaration of <code>CmdArgs</code> creates a new type. Why are you creating a new type?"}, {"owner": {"reputation": 1640, "user_id": 5531595, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/455940914617164/picture?type=large", "display_name": "Rohman HM", "link": "https://stackoverflow.com/users/5531595/rohman-hm"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1499090265, "post_id": 44887356, "comment_id": 76752922, "body": "I don&#39;t know what this kind you called.  <code>func (ca CmdArgs) Len() int { \treturn len(ca) }</code> I have plan to use that."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1499090652, "post_id": 44887356, "comment_id": 76753216, "body": "What is your plan to use that? The only reason to declare a new type is to replace the method set from the underlying type, but there is rarely any reason to do this. You can make a type that can be converted with the same underlying type, which would be less confusing, but again one normally would just use <code>cli.Args</code> if you&#39;re interoperating with that particular <code>cli</code> package."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1499090578, "creation_date": 1499090578, "answer_id": 44887583, "question_id": 44887356, "link": "https://stackoverflow.com/questions/44887356/go-cannot-use-as-type-in-assignment/44887583#44887583", "title": "Go - Cannot use as type in assignment", "body": "<p>The error means exactly what it says: you're trying to assign the return value of a function to a variable that's of a different type than the return value, which is invalid. When you define a new type, it's a new type, and not directly assignable. You can <em>cast</em> between them, but there is <em>no implicit casting in Go</em> - the cast <em>must</em> be done explicitly:</p>\n\n<pre><code>    var args CmdArgs\n    normalArgs := cmd.Args()\n    args = CmdArgs(normalArgs)\n</code></pre>\n\n<p>Though I have to wonder why you're creating a new type <code>CmdArgs</code> to begin with, but I assume there's some reason that's not indicated in the code example. You might have an easier time embedding rather than aliasing, however.</p>\n"}, {"tags": [], "owner": {"reputation": 620, "user_id": 1322651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e59e59204a86ec3da94e49eaf68f932?s=128&d=identicon&r=PG", "display_name": "Lukas Isselb&#228;cher", "link": "https://stackoverflow.com/users/1322651/lukas-isselb%c3%a4cher"}, "is_accepted": false, "score": 1, "last_activity_date": 1499090734, "creation_date": 1499090734, "answer_id": 44887626, "question_id": 44887356, "link": "https://stackoverflow.com/questions/44887356/go-cannot-use-as-type-in-assignment/44887626#44887626", "title": "Go - Cannot use as type in assignment", "body": "<p><code>args</code> is a variable of type <code>CmdArgs</code> which has a vairable of type <code>cli.Args</code></p>\n\n<p>Change your function to </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    \"github.com/urfave/cli\"\n)\n\nfunc main() {\n    program := cli.NewApp()\n    program.Action = func(cmd *cli.Context) error {\n        args := cmd.Args()\n        return nil\n    }\n\n    program.Run(os.Args)\n}\n</code></pre>\n\n<p>and it should run.</p>\n"}], "owner": {"reputation": 1640, "user_id": 5531595, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/455940914617164/picture?type=large", "display_name": "Rohman HM", "link": "https://stackoverflow.com/users/5531595/rohman-hm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4511, "favorite_count": 0, "accepted_answer_id": 44887583, "answer_count": 2, "score": 1, "last_activity_date": 1499090734, "creation_date": 1499089974, "question_id": 44887356, "link": "https://stackoverflow.com/questions/44887356/go-cannot-use-as-type-in-assignment", "title": "Go - Cannot use as type in assignment", "body": "<p>I'm new in Go Lang.</p>\n\n<p>I confused why this error message still coming.</p>\n\n<blockquote>\n  <p>cannot use cmd.Args() (type cli.Args) as type CmdArgs in assignment</p>\n</blockquote>\n\n<p>The error message explain that <code>cmd.Args() (type cli.Args)</code> cannot assignment to <code>type CmdArgs</code> which is <code>type CmdArgs</code> is <code>cli.Args</code>.</p>\n\n<p>I have read <a href=\"https://stackoverflow.com/questions/43900806/cannot-use-as-type-in-assignment-in-go\">Cannot use as type in assignment in go</a>, but it does not make me understand where's my wrong is. I think that's a different matter with me.</p>\n\n<p>Any solution please?</p>\n\n<p>Here's my code.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    \"github.com/urfave/cli\"\n)\n\n// CmdArgs is command arguments\ntype CmdArgs cli.Args\n\nfunc main() {\n    program := cli.NewApp()\n    program.Action = func(cmd *cli.Context) error {\n        var args CmdArgs\n        args = cmd.Args()\n               \u25bc\u25bc\u25bc\u25bc\u25bc\u25bc\u25bc\u25bc\u25bc\n               cannot use cmd.Args() (type cli.Args) as type CmdArgs in assignment\n\n        return nil\n    }\n\n    program.Run(os.Args)\n}\n</code></pre>\n\n<p>Thanks for your attention.</p>\n"}, {"tags": ["go", "pipe", "fifo"], "comments": [{"owner": {"reputation": 119, "user_id": 8226831, "user_type": "registered", "profile_image": "https://graph.facebook.com/1072421991/picture?type=large", "display_name": "Zhivko Angelov", "link": "https://stackoverflow.com/users/8226831/zhivko-angelov"}, "edited": false, "score": 0, "creation_date": 1499086461, "post_id": 44886135, "comment_id": 76750220, "body": "FD 5 is opened by the parent process."}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 6, "last_activity_date": 1499089683, "last_edit_date": 1499089683, "creation_date": 1499086504, "answer_id": 44886153, "question_id": 44886135, "link": "https://stackoverflow.com/questions/44886135/how-to-write-to-already-opened-fd-in-golang/44886153#44886153", "title": "How to write to already opened FD in golang", "body": "<p>Use <a href=\"https://godoc.org/os#NewFile\" rel=\"noreferrer\"><code>os.NewFile</code></a> to \"open\" an existing file by its file descriptor:</p>\n\n<blockquote>\n<pre><code>func NewFile(fd uintptr, name string) *File\n</code></pre>\n  \n  <p>NewFile returns a new File with the given file descriptor and name.</p>\n</blockquote>\n\n<pre><code>file := os.NewFile(5, \"pipe\")\n_, err := file.Write([]byte(`my data`))\nif err != nil {\n    panic(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 119, "user_id": 8226831, "user_type": "registered", "profile_image": "https://graph.facebook.com/1072421991/picture?type=large", "display_name": "Zhivko Angelov", "link": "https://stackoverflow.com/users/8226831/zhivko-angelov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1945, "favorite_count": 1, "accepted_answer_id": 44886153, "answer_count": 1, "score": 6, "last_activity_date": 1499089683, "creation_date": 1499086416, "question_id": 44886135, "link": "https://stackoverflow.com/questions/44886135/how-to-write-to-already-opened-fd-in-golang", "title": "How to write to already opened FD in golang", "body": "<p>I have the following opened FD (lsof output):</p>\n\n<pre><code>auth    11780 root    5w  FIFO               0,10      0t0  72061824 pipe\n</code></pre>\n\n<p>I need to write something in FD 5 (FIFO) in go. In C it is performed by the syscall write():</p>\n\n<pre><code>19270 write(5, \"*************\", 12 &lt;unfinished ...&gt;\n</code></pre>\n\n<p>Thank you in advance!</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 417, "user_id": 7293425, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/DFFOL.jpg?s=128&g=1", "display_name": "Indu Pillai", "link": "https://stackoverflow.com/users/7293425/indu-pillai"}, "edited": false, "score": 0, "creation_date": 1499085960, "post_id": 44885877, "comment_id": 76749870, "body": "I tried the same before but it didn&#39;t work, but now when I copied and pasted it, it worked. May be there was a typo.  Thank you!"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 2, "last_activity_date": 1499085722, "creation_date": 1499085722, "answer_id": 44885877, "question_id": 44885848, "link": "https://stackoverflow.com/questions/44885848/how-would-you-solve-the-following-golang-challenge/44885877#44885877", "title": "How would you solve the following Golang challenge?", "body": "<pre><code>func Print(d Displayable) {\n     d.Display()\n}\n</code></pre>\n"}], "owner": {"reputation": 417, "user_id": 7293425, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/DFFOL.jpg?s=128&g=1", "display_name": "Indu Pillai", "link": "https://stackoverflow.com/users/7293425/indu-pillai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 44885877, "answer_count": 1, "score": -3, "last_activity_date": 1499085769, "creation_date": 1499085626, "last_edit_date": 1499085769, "question_id": 44885848, "link": "https://stackoverflow.com/questions/44885848/how-would-you-solve-the-following-golang-challenge", "title": "How would you solve the following Golang challenge?", "body": "<p>I have to solve following TreeHouse Go challenge, but I'm stuck in the Print method.</p>\n\n<p>The requirement:</p>\n\n<blockquote>\n  <p>In the <code>clock</code> and <code>calendar</code> packages, we've defined <code>Clock</code> and <code>Calendar</code> types, both of which have a <code>Display</code> method that you can call to print them.\n  In the <code>schedule</code> package, define a <code>Displayable</code> interface that is satisfied by the <code>Display</code> methods on both the <code>Clock</code> and <code>Calendar</code> types. (Don't make any changes to the <code>clock</code> or <code>calendar</code> packages.) Then, still in the <code>schedule</code> package, define a <code>Print</code> function that takes a <code>Displayable</code> value and calls <code>Display</code> on it.</p>\n</blockquote>\n\n<p>clock.go:</p>\n\n<pre><code>package clock\n\nimport \"fmt\"\n\ntype Clock struct {\n  Hours int\n  Minutes int\n}\n\nfunc (c Clock) Display() {\n  fmt.Printf(\"%02d:%02d\", c.Hours, c.Minutes)\n}\n</code></pre>\n\n<p>calendar.go:</p>\n\n<pre><code>package calendar\n\nimport \"fmt\"\n\ntype Calendar struct {\n  Year int\n  Month int\n  Day int\n}\n\nfunc (c Calendar) Display() {\n  fmt.Printf(\"%04d-%02d-%02d\", c.Year, c.Month, c.Day)\n}\n</code></pre>\n\n<p>schedule.go:</p>\n\n<pre><code>package schedule\n\n// DECLARE A Displayable INTERFACE HERE\ntype Displayable interface {\n    Display()\n}\n\n// DECLARE A Print FUNCTION HERE (I'm stuck here)\n</code></pre>\n\n<p>Thank you!</p>\n"}, {"tags": ["python", "go", "io", "null", "gzip"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1499082689, "post_id": 44884766, "comment_id": 76747701, "body": "you show that it returns an error (which should be checked first) so what exactly is the problem?"}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 1, "creation_date": 1499083027, "post_id": 44884766, "comment_id": 76747935, "body": "Print the actual error message and it will tell you exactly why it failed. &quot;some text here&quot; is not a vaild input to gzip."}, {"owner": {"reputation": 723, "user_id": 5227605, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5a9774943e45531c3762b79b7b67cd23?s=128&d=identicon&r=PG&f=1", "display_name": "bkaankuguoglu", "link": "https://stackoverflow.com/users/5227605/bkaankuguoglu"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1499083056, "post_id": 44884766, "comment_id": 76747953, "body": "@JimB I edited my question now, thanks for your feedback!"}, {"owner": {"reputation": 723, "user_id": 5227605, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5a9774943e45531c3762b79b7b67cd23?s=128&d=identicon&r=PG&f=1", "display_name": "bkaankuguoglu", "link": "https://stackoverflow.com/users/5227605/bkaankuguoglu"}, "reply_to_user": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1499083303, "post_id": 44884766, "comment_id": 76748092, "body": "@Art Yes, I know. There are multiple steps in the process, but I just wanted to cut the parts that I encode and encrypt the bytes. I figured the problem is most likely due to gzip. Here is a proper gzip: b&#39;\\x1f\\x8b\\x08\\x00\\xcd1ZY\\x02\\xff%\\x8e\\xb1\\x0e\\xc3@\\x08C\\x7f&zwnj;&#8203;\\x051\\xa3\\x13w@\\x0e:&zwnj;&#8203;v\\xef\\x17T\\xd9\\xb2t\\&zwnj;&#8203;xcb\\x90-\\xca\\xbf\\xd7&zwnj;&#8203;i\\&#39;xX\\xb69\\xf9\\xc3\\x&zwnj;&#8203;0f\\xe2\\xd73\\x93\\x85x&zwnj;&#8203;\\x07\\xbcO\\xde\\xee\\x1&zwnj;&#8203;1\\xdeLH\\x85\\xaa\\x84\\&zwnj;&#8203;xbc\\x9a\\x85\\x90\\xfd)&zwnj;&#8203;z\\x0b\\xc3\\xde\\x81)4\\&zwnj;&#8203;xb2\\x16\\x17\\x9a\\xe6\\&zwnj;&#8203;x00\\xb7(\\x98F,P\\xbbZ&zwnj;&#8203;\\x00&quot;\\x86\\xea/d\\xaeh&zwnj;&#8203;9\\x10\\xdf\\xbdJ\\xd3F\\&zwnj;&#8203;xb7\\x96\\x05\\xfb\\xc4}&zwnj;&#8203;\\xbb\\x05\\xfcp\\xad\\xd&zwnj;&#8203;7\\x17\\x19o\\xdd\\xe7\\x&zwnj;&#8203;98\\x00\\x00\\x00&#39;"}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 1, "creation_date": 1499084422, "post_id": 44884766, "comment_id": 76748772, "body": "@bkaankuguoglu It would help immensely if the question you ask actually contains the actual question you want to ask instead of a different question. As it is (after fixing the problems that makes the question not even compile), the answer to the question as asked right now is: your input is not valid gzip. Now, that string you pasted into the comment might be an encoding of a valid gzip string (at least the header is there). How do you input it into the program?"}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1499085004, "post_id": 44884766, "comment_id": 76749185, "body": "@bkaankuguoglu Here is a fixed test program with a fixed up string (since the one in the comment was messed up by formatting): <a href=\"https://play.golang.org/p/UUI7nz06gs\" rel=\"nofollow noreferrer\">play.golang.org/p/UUI7nz06gs</a>   Works For Me."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1499085004, "post_id": 44884766, "comment_id": 76749186, "body": "The nil error is a red herring, you&#39;re getting an error from <code>gzip.NewReader</code> then you continue trying to process, which definitely won&#39;t work. Once you get an error you should print <i>the actual error message</i>, then stop trying to use the results of a failed operation."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1499085676, "post_id": 44884766, "comment_id": 76749692, "body": "Ok. Now, as edited, it is pretty clear that after the first round of base64 decoding the input what comes out is another base64 encoded string. This doesn&#39;t smell right."}, {"owner": {"reputation": 723, "user_id": 5227605, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5a9774943e45531c3762b79b7b67cd23?s=128&d=identicon&r=PG&f=1", "display_name": "bkaankuguoglu", "link": "https://stackoverflow.com/users/5227605/bkaankuguoglu"}, "reply_to_user": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1499085681, "post_id": 44884766, "comment_id": 76749694, "body": "@Art After comparing my input text sent from my client script and some other gzip outputs, I assume that my input may not be a valid gzip stream."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1499086869, "post_id": 44884766, "comment_id": 76750494, "body": "Yay. Now that you posted the python script, I see that my guess was right. The output is base64 encoded twice."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1499087105, "post_id": 44884766, "comment_id": 76750661, "body": "And after decrypting that what comes out is a string that contains &quot;The answer is no&quot;. Considering that the python script doesn&#39;t do anything with <code>gzippayload</code>, and encrypts something called <code>message</code> (that doesn&#39;t appear anywhere else in the script), that&#39;s not too surprising."}, {"owner": {"reputation": 723, "user_id": 5227605, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5a9774943e45531c3762b79b7b67cd23?s=128&d=identicon&r=PG&f=1", "display_name": "bkaankuguoglu", "link": "https://stackoverflow.com/users/5227605/bkaankuguoglu"}, "reply_to_user": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1499087269, "post_id": 44884766, "comment_id": 76750789, "body": "@Art Yeah, I deleted that extra line but now new error occurred. I&#39;ll post the final version after I fixed those errors. Thanks!"}, {"owner": {"reputation": 723, "user_id": 5227605, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5a9774943e45531c3762b79b7b67cd23?s=128&d=identicon&r=PG&f=1", "display_name": "bkaankuguoglu", "link": "https://stackoverflow.com/users/5227605/bkaankuguoglu"}, "reply_to_user": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1499087357, "post_id": 44884766, "comment_id": 76750862, "body": "@Art I wasn&#39;t using that variable in any part of the script. I used that to verify if my encrypt/decrypt functions work."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1499087390, "post_id": 44884766, "comment_id": 76750887, "body": "I bet that is not the full Python script, instead the actual Python script contained code copy-pasted from some pycrypto tutorial that uses the string &quot;The answer is no&quot; as their test string."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1499087786, "post_id": 44884766, "comment_id": 76751162, "body": "Btw. Stop converting things to/from strings and byte arrays all the time. The beauty of interfaces in Go and especially <code>io.Reader</code> is composition. Your code should look something like this: <a href=\"https://play.golang.org/p/M9jTbAdWja\" rel=\"nofollow noreferrer\">play.golang.org/p/M9jTbAdWja</a>"}], "answers": [{"comments": [{"owner": {"reputation": 723, "user_id": 5227605, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5a9774943e45531c3762b79b7b67cd23?s=128&d=identicon&r=PG&f=1", "display_name": "bkaankuguoglu", "link": "https://stackoverflow.com/users/5227605/bkaankuguoglu"}, "edited": false, "score": 0, "creation_date": 1499083857, "post_id": 44884981, "comment_id": 76748425, "body": "Thanks for the answer! In my program, firstly, I gzip the input string, then encrypt using aes256 and finally encode the text in base64. I&#39;ve checked the last two steps that I encrypt and encode my date, it seems like it works fine without the gzip step. What is a valid gzip stream? Something like this?  \\x1f\\x8b\\x08\\x00\\xcd1ZY\\x02\\xff%\\x8e\\xb1..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 723, "user_id": 5227605, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5a9774943e45531c3762b79b7b67cd23?s=128&d=identicon&r=PG&f=1", "display_name": "bkaankuguoglu", "link": "https://stackoverflow.com/users/5227605/bkaankuguoglu"}, "edited": false, "score": 0, "creation_date": 1499084639, "post_id": 44884981, "comment_id": 76748919, "body": "@bkaankuguoglu I don&#39;t know the gzip spec by heart, I can&#39;t tell just from the bytes. If it&#39;s valid, the <code>gzip</code> package should accept it. If it doesn&#39;t accept it, it&#39;s most likely it&#39;s not valid. In your example you should reverse the steps: first base64 decode, then aes256 decode, and then you can pass the result to gzip decoding."}, {"owner": {"reputation": 723, "user_id": 5227605, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5a9774943e45531c3762b79b7b67cd23?s=128&d=identicon&r=PG&f=1", "display_name": "bkaankuguoglu", "link": "https://stackoverflow.com/users/5227605/bkaankuguoglu"}, "edited": false, "score": 0, "creation_date": 1499085187, "post_id": 44884981, "comment_id": 76749324, "body": "I added the full version of my script. I&#39;m doing the steps in the order you described."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1499083023, "creation_date": 1499083023, "answer_id": 44884981, "question_id": 44884766, "link": "https://stackoverflow.com/questions/44884766/gzip-newreader-returns-nil-when-a-type-reader-is-given-as-input/44884981#44884981", "title": "gzip.NewReader() returns nil when a type Reader is given as input", "body": "<p>The problem is that the \"content\" produced by the reader you pass to <code>gz.NewReader()</code> is not a valid gzip stream (data). If <code>gzip.NewReader()</code> returns a non-<code>nil</code> error (as it does in your case), the returned <code>gzReader</code> may be <code>nil</code> (and it usually is).</p>\n\n<p>If you pass a valid gzip stream to <code>gzip.NewReader()</code>, the returned <code>gzReader</code> will not be <code>nil</code>, and decoding will succeed.</p>\n\n<p>For example the gzip encoded form of the text <code>\"hello\"</code> is:</p>\n\n<pre><code>[31 139 8 0 0 0 0 0 0 255 203 72 205 201 201 7 0 134 166 16 54 5 0 0 0]\n</code></pre>\n\n<p>Using this as the input:</p>\n\n<pre><code>data := []byte{31, 139, 8, 0, 0, 0, 0, 0, 0,\n    255, 203, 72, 205, 201, 201, 7, 0, 134, 166, 16, 54, 5, 0, 0, 0}\nreader := bytes.NewReader(data)\n// The rest is unchanged\n</code></pre>\n\n<p>It works, and the output is (try it on the <a href=\"https://play.golang.org/p/wvjlodJOWq\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&amp;{[31 139 8 0 0 0 0 0 0 255 203 72 205 201 201 7 0 134 166 16 54 5 0 0 0] 0 -1}\n&amp;{{ [] 0001-01-01 00:00:00 +0000 UTC  255} 0x10440260 0x10462000 0 0 [31 139 8 0 0 0 0 0 0 255 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] &lt;nil&gt; true}\nhello\n</code></pre>\n"}], "owner": {"reputation": 723, "user_id": 5227605, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5a9774943e45531c3762b79b7b67cd23?s=128&d=identicon&r=PG&f=1", "display_name": "bkaankuguoglu", "link": "https://stackoverflow.com/users/5227605/bkaankuguoglu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1120, "favorite_count": 0, "accepted_answer_id": 44884981, "answer_count": 1, "score": 0, "last_activity_date": 1607447684, "creation_date": 1499082440, "last_edit_date": 1607447684, "question_id": 44884766, "link": "https://stackoverflow.com/questions/44884766/gzip-newreader-returns-nil-when-a-type-reader-is-given-as-input", "title": "gzip.NewReader() returns nil when a type Reader is given as input", "body": "<p>I've come across a problem while uncompressing a stream of bytes that are previously compressed. Basically, I'm trying to create a Reader using the function <code>bytes.NewReader()</code> and then to unzip the stream by using <code>gzip.NewReader()</code> function. At last, I'd like to return the real values in either string or byte format. </p>\n\n<p>I know <code>gzip.NewReader</code> requires <code>io.Reader</code> as an input, however, as far as I know, type <code>Reader</code> implements the interface <code>io.Reader</code>. I assume this should not cause any errors but I wonder what might be the problem in this case. I'd really appreciate if you help me out with this!</p>\n\n<p>In case you wonder what this piece of text is, </p>\n\n<blockquote>\n  <p>\"amZzRUR2NHVtcVpiZHNROHJiTTNYeGdUSndGTlVDZC9jaElSK1lXcFlJOD0=\" </p>\n</blockquote>\n\n<p>it's a sample input sent from my client python script. It compresses by using gzip, does encryption by using AES128 and finally encodes in base64, in this order.</p>\n\n<p>The client code:</p>\n\n<pre><code>import time\nimport json\nimport requests\nimport random\nimport gzip\nimport base64\n\nfrom Crypto.Cipher import AES\n\nbaseurl = 'http://0.0.0.0:80'\nkey = 'TfvY7I358yospfWKcoviZizOShpm5hyH'\niv = 'mb13KcoviZizvYhp'\n\nMODE = AES.MODE_CFB\nBLOCK_SIZE = 16\nSEGMENT_SIZE = 128\n\ndef http_post(url, data):\n    print('Going to make a request to {} with the following data: {}'.format(url, data))\n    r = requests.post(url,\n                  data=data,\n                  headers={'Content-type': 'application/json; charset=utf-8',\n                           'Connection': 'keep-alive'}, )\n    if r.status_code != 200:\n        print('Server returned unexpected response code {}, and content: {}'.format(r.status_code, r.content))\n        return False\n    else:\n        data = r.json()\n        return data\n\n\ndef post_sample_data(key, iv):\n    fake_device_id = \"MB88\"\n    Load_VA_Total_Mean = random.randint(1000, 100000)\n    print('Data that should come back: {}'.format(Load_VA_Total_Mean))\n    data = {'i': fake_device_id, 'p': [\n    {'d': [54.3, 0, 99, 49.35, 3, 99, 51.533, 1, 98, 28964, 7348, 43590, Load_VA_Total_Mean, 10350, 55200, 49.7],\n     't': time.time(), 'dt': 'p'}]}\n    url = baseurl + '/realtimedata'\n    encryption_key_reference = 1\n    payload = '{}\\n{}'.format(convert_pack(data, key, iv), encryption_key_reference)\n    return http_post(url, payload)\n\n\ndef convert_pack(inputdict, key, iv):\n    jsonpayload = json.dumps(inputdict)  # encode dict to json string\n    gzippayload = gzip.compress(jsonpayload.encode('utf-8'))  # compress with gzip\n    encryptedpayload = base64.b64encode(encrypt(key, iv, message))\n    encoded = base64.b64encode(encryptedpayload)\n    print('encoded: {}'.format(encoded))\n\n    return str(encoded, encoding='utf-8')\n\n\ndef _pad_string(value):\n    length = len(value)\n    pad_size = BLOCK_SIZE - (length % BLOCK_SIZE)\n    return value.ljust(length + pad_size, '\\x00')\n\n\ndef encrypt(key, iv, plaintext):\n    aes = AES.new(key, MODE, iv, segment_size=SEGMENT_SIZE)\n    plaintext = _pad_string(plaintext)\n    encrypted_text = aes.encrypt(plaintext)\n    return encrypted_text\n\n\npost_sample_data(key, iv)\n</code></pre>\n\n<p>The server code:</p>\n\n<pre><code>package main\n\nimport (\n\"crypto/aes\"\n\"crypto/cipher\"\n\"crypto/rand\"\n\"encoding/base64\"\n\"fmt\"\n\"io\"\n\"compress/gzip\"\n\"io/ioutil\"\n\"bytes\"\n)\n\nfunc main() {\n    receivedText := \"amZzRUR2NHVtcVpiZHNROHJiTTNYeGdUSndGTlVDZC9jaElSK1lXcFlJOD0=\"\n    fmt.Println(\"encrypted + encoded + gzipped: \", originalText)\n    key := []byte(\"TfvY7I358yospfWKcoviZizOShpm5hyH\")\n\n    text := decrypt(key, originalText)\n    fmt.Println(\"decrypted: \", string(text))\n    reader := bytes.NewReader(text)\n    gzReader, err1 := gzip.NewReader(reader)\n    fmt.Println(gzReader)\n\n    if err1 != nil {\n        fmt.Println(\"error1\")\n    }\n\n    content, err2 := ioutil.ReadAll(gzReader)\n\n    if err2 != nil {\n        fmt.Println(\"error2\")\n    }\n\n    fmt.Println(string(content))\n}\n\nfunc decrypt(key []byte, cryptoText string) []byte {\n    ciphertext, _ := base64.StdEncoding.DecodeString(cryptoText)\n    fmt.Println(\"decoded: \", string(ciphertext))\n    block, err := aes.NewCipher(key)\n    if err != nil {\n        panic(err)\n    }\n\n    iv := []byte(\"mb13KcoviZizvYhp\")\n    stream := cipher.NewCFBDecrypter(block, iv)\n    stream.XORKeyStream(ciphertext, ciphertext)\n\n    return ciphertext\n}\n</code></pre>\n\n<p>The output:</p>\n\n<pre><code>&lt;nil&gt;\nerror1\npanic: runtime error: invalid memory address or nil pointer dereference [recovered]\n    panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x288 pc=0x10a9167]\n\ngoroutine 1 [running]:\nio/ioutil.readAll.func1(0xc420037dd0)\n    /usr/local/go/src/io/ioutil/ioutil.go:30 +0x119\npanic(0x10c4580, 0x1154d00)\n    /usr/local/go/src/runtime/panic.go:489 +0x2cf\ncompress/gzip.(*Reader).Read(0x0, 0xc420092000, 0x200, 0x200, 0x1024ade, 0xc400000008, 0xc4200120c0)\n    /usr/local/go/src/compress/gzip/gunzip.go:247 +0x37\nbytes.(*Buffer).ReadFrom(0xc420037d28, 0x11451a0, 0x0, 0xc420092000, 0x0, 0x200)\n    /usr/local/go/src/bytes/buffer.go:179 +0x160\nio/ioutil.readAll(0x11451a0, 0x0, 0x200, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/io/ioutil/ioutil.go:33 +0x150\nio/ioutil.ReadAll(0x11451a0, 0x0, 0x1, 0x7, 0x0, 0x0, 0x20)\n    /usr/local/go/src/io/ioutil/ioutil.go:42 +0x3e\nmain.main()\n    /Users/bkaankuguoglu/Desktop/Go-dev/tool-backend/tester.go:43 \n+0x404\nexit status 2\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499078214, "post_id": 44883077, "comment_id": 76744937, "body": "As far as I can see, package name of <code>area_mock.go</code> should be area not area_test. And package name of <code>area_mock_test.go</code> should be area_test not area."}, {"owner": {"reputation": 1174, "user_id": 1438735, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/304d6cf1abce29ed9d38688f7975c690?s=128&d=identicon&r=PG", "display_name": "Ratatouille", "link": "https://stackoverflow.com/users/1438735/ratatouille"}, "reply_to_user": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499078423, "post_id": 44883077, "comment_id": 76745061, "body": "@mattn why is that I&#39;m kind of relatively new in go. my understanding is that <code>package</code> name mention inside the file take the package under which the file belong. And area_mock.go has <code>package &#39;area_test&#39;</code>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1499079233, "post_id": 44883077, "comment_id": 76745509, "body": "You workspace setup is totally wrong. Your go source code files go below $GOPATH/**src**. Read <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a> and stick to to it. And please take a look at how the std lib does it&#39;s testing. That&#39;s how it is done."}], "answers": [{"comments": [{"owner": {"reputation": 1174, "user_id": 1438735, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/304d6cf1abce29ed9d38688f7975c690?s=128&d=identicon&r=PG", "display_name": "Ratatouille", "link": "https://stackoverflow.com/users/1438735/ratatouille"}, "edited": false, "score": 0, "creation_date": 1499082225, "post_id": 44884018, "comment_id": 76747396, "body": "Schwern For development purpose do one always have to do <code>go build</code> for packages. one can just import without <code>go build</code> as well right ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1174, "user_id": 1438735, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/304d6cf1abce29ed9d38688f7975c690?s=128&d=identicon&r=PG", "display_name": "Ratatouille", "link": "https://stackoverflow.com/users/1438735/ratatouille"}, "edited": false, "score": 0, "creation_date": 1499088032, "post_id": 44884018, "comment_id": 76751338, "body": "@Ratatouille: <code>go build</code> or <code>go install</code> is how you compile the code, or you could also run <code>go test</code> if everything you want has a test fixture. What would it mean to import code without compiling it?"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 1174, "user_id": 1438735, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/304d6cf1abce29ed9d38688f7975c690?s=128&d=identicon&r=PG", "display_name": "Ratatouille", "link": "https://stackoverflow.com/users/1438735/ratatouille"}, "edited": false, "score": 0, "creation_date": 1499109839, "post_id": 44884018, "comment_id": 76763242, "body": "@Ratatouille Yes, <code>go build</code> will build any imported packages, if necessary."}], "tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": true, "score": 2, "last_activity_date": 1499080374, "last_edit_date": 1499080374, "creation_date": 1499080038, "answer_id": 44884018, "question_id": 44883077, "link": "https://stackoverflow.com/questions/44883077/package-import-error-on-golang/44884018#44884018", "title": "Package Import error on Golang", "body": "<p>Your project structure isn't the one Go expects.</p>\n\n<p><code>area_test/</code> are not the tests for <code>area</code>. I'm going to guess you ran <code>go test ./area_test</code>. That tells Go that <code>./area_test</code> is a project. It tried to compile <code>area_mock.go</code> and tried to use <code>area_mock_test.go</code> and <code>area_suite_test.go</code> as its tests. The error you got is Go's awkward way of telling you that it did not expect to find a package named <code>*_test</code> in a project file.</p>\n\n<hr>\n\n<p><code>area.go</code> is also a problem. You have it using <code>package main</code>, but then try to test with <code>package area_test</code>. They don't match and Go won't like it. A package directory contains <strong><em>one package</em></strong>. Its tests must use either that package or <code>thatpackage_test</code>. This enforces that a package directory does one thing. Its either a library to import, or its a program to run. Not both.</p>\n\n<p>Also the project directory is called <code>square</code>, but the package is <code>area</code>. It's ok to have files that don't match the project name, and its fine to have multiple files in one package, but using a package than the project directory name is not good practice.</p>\n\n<hr>\n\n<p>There's another problem. Go expects source files to be in <code>$GOPATH/src</code>. You have them directly in <code>$GOPATH</code>. Import statements won't find them.</p>\n\n<hr>\n\n<p>Go's project structure can take a bit of getting used to, and it has very firm ideas about how projects and packages are to be structured (Go has very firm ideas about how code is to be written, and how it isn't). Don't fight it. Do yourself a favor and use the default <code>GOPATH</code> of <code>~/go</code> and put your code in <code>~/go/src/</code>.</p>\n\n<p>You'd write the square library like so.</p>\n\n<pre><code>~/go/src/square/\n|--- square.go\n|--- square_test.go\n</code></pre>\n\n<p>square.go might look like this.</p>\n\n<pre><code>package square\n\ntype Square struct {\n    Side float32\n}\n\nfunc (s Square) Area() float32 {\n    return s.Side * s.Side\n}\n</code></pre>\n\n<p>Note that <code>Side</code> must be capitalized for it to be a public data member. Also note that its passed by value, in Go the style is to only pass by pointer if you intend to modify the struct.</p>\n\n<p>square_test.go might look like this.</p>\n\n<pre><code>package square_test\n\nimport(\n    \"testing\"\n    \"square\"\n    \"github.com/stvp/assert\"\n)\n\nfunc TestArea( t *testing.T ) {\n    sq := square.Square{Side: 5}\n\n    assert.Equal( t, sq.Area(), float32(25) )\n}\n</code></pre>\n\n<p>Go does not come with any asserts. <a href=\"https://github.com/stvp/assert\" rel=\"nofollow noreferrer\"><code>github.com/stvp/assert</code></a> provides the basics and removes a lot of tedium. You can get it with <code>go get github.com/stvp/assert</code>.</p>\n\n<p>Note that it is in <code>package square_test</code> to make this a blackbox test which can only use the public interface of <code>square</code>. If you wanted a glassbox/internal test, it would use <code>package square</code> and go in its own file like <code>square_internal_test.go</code>.</p>\n\n<p>If you want a program that uses square, that would be in its own separate package directory. It would have a <code>main.go</code> with <code>package main</code> and <code>import \"square\"</code>.</p>\n\n<p><a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How To Write Go</a> explains this in more detail.</p>\n"}], "owner": {"reputation": 1174, "user_id": 1438735, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/304d6cf1abce29ed9d38688f7975c690?s=128&d=identicon&r=PG", "display_name": "Ratatouille", "link": "https://stackoverflow.com/users/1438735/ratatouille"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6312, "favorite_count": 0, "accepted_answer_id": 44884018, "answer_count": 1, "score": 1, "last_activity_date": 1499080374, "creation_date": 1499077036, "last_edit_date": 1499077269, "question_id": 44883077, "link": "https://stackoverflow.com/questions/44883077/package-import-error-on-golang", "title": "Package Import error on Golang", "body": "<p>My post has 2 question</p>\n\n<p>I'm essentially trying to understand how to use gomock with gingko</p>\n\n<p>GOPATH</p>\n\n<p><code>/Users/Ratatouille/Desktop/test/goExample</code></p>\n\n<p>The following project is located at</p>\n\n<p><code>/Users/Ratatouille/Desktop/test/goExample/square</code> </p>\n\n<p>which has following project structure</p>\n\n<pre><code>.\n\u251c\u2500\u2500 area.go\n\u2514\u2500\u2500 area_test\n    \u251c\u2500\u2500 area_mock.go\n    \u251c\u2500\u2500 area_mock_test.go\n    \u2514\u2500\u2500 area_suite_test.go\n</code></pre>\n\n<p>what I'm not able to understand why I'm getting following error </p>\n\n<pre><code>Failed to compile area_test:\n\ncan't load package: package ./area_test: found packages area_test (area_mock.go) and area (area_mock_test.go) in /Users/Ratatouille/Desktop/test/goExample/square/area_test\n\nGinkgo ran 1 suite in 303.243871ms\nTest Suite Failed\n</code></pre>\n\n<p>my second question is project repo has area.go file which look like this</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Square struct {\n    side float32\n}\n\nfunc (s *Square) Area() float32 {\n    return s.side * s.side\n}\n\nfunc (s *Square) CalculateArea(shaper Shaper) float32 {\n    shaper.Area()\n}\n\ntype Shaper interface {\n    Area() float32\n}\n\nfunc main() {\n    sq1 := new(Square)\n    sq1.side = 2\n\n    var areaIntf Shaper\n    areaIntf = sq1\n    fmt.Println(areaIntf.Area())\n}\n</code></pre>\n\n<p>My question is how do I <strong>import</strong> <code>main</code> package inside <code>area_mock_test.go</code></p>\n"}, {"tags": ["pointers", "go", "reflection", "slice"], "answers": [{"tags": [], "owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "is_accepted": true, "score": 4, "last_activity_date": 1499076827, "creation_date": 1499076827, "answer_id": 44882993, "question_id": 44882827, "link": "https://stackoverflow.com/questions/44882827/how-to-remove-all-the-element-in-the-slice-with-reflect-package-in-golang/44882993#44882993", "title": "How to remove all the element in the slice with reflect package in Golang?", "body": "<p>use <code>reflect.MakeSlice</code> instead.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc resetSlice(slice interface{}) {\n    v := reflect.ValueOf(slice)\n    v.Elem().Set(reflect.MakeSlice(v.Type().Elem(), 0, v.Elem().Cap()))\n}\n\n\nfunc main() {\n    a := []string{\"foo\", \"bar\", \"baz\"}  \n    resetSlice(&amp;a)\n    fmt.Println(a)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/JNWE0hCsQp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/JNWE0hCsQp</a></p>\n"}], "owner": {"reputation": 1475, "user_id": 5203951, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/fd9dc7df52e3a9be33094cd877e3f8fb?s=128&d=identicon&r=PG", "display_name": "Yami Odymel", "link": "https://stackoverflow.com/users/5203951/yami-odymel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 846, "favorite_count": 0, "accepted_answer_id": 44882993, "answer_count": 1, "score": 0, "last_activity_date": 1499076827, "creation_date": 1499076300, "question_id": 44882827, "link": "https://stackoverflow.com/questions/44882827/how-to-remove-all-the-element-in-the-slice-with-reflect-package-in-golang", "title": "How to remove all the element in the slice with reflect package in Golang?", "body": "<p>I'm trying to create a function that can reset a passed slice like this:</p>\n\n<pre><code>func resetSlice(slice interface{}) {\n    v := reflect.ValueOf(slice)\n    s := v.Type().Elem() \n    // QUESTION: How to reset the slice here?\n}\n\nusernames := []string{\"Hello\", \"World\"}\nresetSlice(&amp;usernames)\n\nfmt.Println(usernames) // OUTPUT  : [Hello World]\n                       // EXPECTED: []\n</code></pre>\n\n<p>But I have no idea about how to reset a pointer slice. Maybe create a new slice which has the same type as the pointer slice with</p>\n\n<pre><code>reflect.New(v.Type().Elem())\n</code></pre>\n\n<p>then replace the the pointer slice? But how?</p>\n"}, {"tags": ["session", "go", "gorilla"], "comments": [{"owner": {"reputation": 11, "user_id": 7718522, "user_type": "registered", "profile_image": "https://graph.facebook.com/1460829883927611/picture?type=large", "display_name": "Jangwook Kim", "link": "https://stackoverflow.com/users/7718522/jangwook-kim"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1499085404, "post_id": 44881423, "comment_id": 76749493, "body": "@Flimzy Oh, when I wrote the code, there are no errors. I thought <code>session, _ := store.Get(r, SessionName)</code> is correct, so I&#39;m not wrote that. Sorry."}, {"owner": {"reputation": 11, "user_id": 7718522, "user_type": "registered", "profile_image": "https://graph.facebook.com/1460829883927611/picture?type=large", "display_name": "Jangwook Kim", "link": "https://stackoverflow.com/users/7718522/jangwook-kim"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1499129485, "post_id": 44881423, "comment_id": 76768961, "body": "There are no errors occured when I wrote that codes. So I omitted <code>err</code> statement when I wrote this question. I thought <code>req, err := http.NewRequest(&lt;method&gt;, &lt;url&gt;, &lt;body&gt;)</code> statement creates new request, and server creates new session for request. I wrote wrong title for this question. Sorry. I meant <code>I want to use client.Do() method using existing request </code>. My English skill is so terrible, so I couldn&#39;t describe that I wanted. I really appreciate you, Flimzy. Thank you."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1499168230, "post_id": 44881423, "comment_id": 76786674, "body": "Makes sense. Unfortunately, we don&#39;t know that... so it&#39;s always best to use your <i>actual</i> code."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 7718522, "user_type": "registered", "profile_image": "https://graph.facebook.com/1460829883927611/picture?type=large", "display_name": "Jangwook Kim", "link": "https://stackoverflow.com/users/7718522/jangwook-kim"}, "is_accepted": false, "score": 0, "last_activity_date": 1499130542, "creation_date": 1499130542, "answer_id": 44895592, "question_id": 44881423, "link": "https://stackoverflow.com/questions/44881423/want-to-get-session-values-when-client-sends-new-request/44895592#44895592", "title": "Want to get session values when client sends new request", "body": "<p>I wrote some codes and it moves.\nIs it correct way?</p>\n\n<p>Client</p>\n\n<pre><code>func cTest(w http.ResponseWrite, r *http.Request) {\n    serverURL := \"http://localhost:8080/test\"\n    r.Method = http.MethodGet\n    r.Host = serverURL  // server\n    v, err := url.Parse(serverURL)\n    if err != nil {\n        log.Println(\"url parsing error occurred : \", err.Error())\n        return\n    }\n    c := &amp;http.Client{Transport: &amp;http.Transport{}}\n    resp, err := c.Transport.RoundTrip(r)\n    if err != nil {\n        log.Println(\"client roundtrip error occurred : \", err.Error())\n        return\n    }\n    defer resp.Body.Close()\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Println(\"response body reading error occurred : \", err.Error())\n        return\n    }\n    w.Write(body)\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 7718522, "user_type": "registered", "profile_image": "https://graph.facebook.com/1460829883927611/picture?type=large", "display_name": "Jangwook Kim", "link": "https://stackoverflow.com/users/7718522/jangwook-kim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 677, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1499130542, "creation_date": 1499072131, "last_edit_date": 1499090626, "question_id": 44881423, "link": "https://stackoverflow.com/questions/44881423/want-to-get-session-values-when-client-sends-new-request", "title": "Want to get session values when client sends new request", "body": "<p>I want to get server's session value when client creates a new request.</p>\n\n<p>But, server returns nil always.</p>\n\n<p>I don't know what is the problem in this case.</p>\n\n<hr>\n\n<h2>Client</h2>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n    \"github.com/gorilla/securecookie\"\n    \"github.com/gorilla/sessions\"\n)\n\nvar (\n    store       *sessions.CookieStore = sessions.NewCookieStore(securecookie.GenerateRandomKey(64))\n    session     *sessions.Session\n    SessionName = \"client\"\n)\n\nfunc main() {\n    store.Options = &amp;sessions.Options{\n        Path:     \"/\",\n        MaxAge:   60 * 15,\n        Secure:   false,\n        HttpOnly: true,\n    }\n    router := mux.NewRouter()\n    router.HandleFunc(\"/\", cIndex)\n    router.HandleFunc(\"/test\", cTest)\n    http.ListenAndServe(\":7000\", router)\n}\n\nfunc cIndex(w http.ResponseWriter, r *http.Request) {\n    session, err := store.Get(r, SessionName)\n    if err != nil {\n        log.Println(\"cIndex Session Error : \", err.Error())\n        return\n    }\n    session.Values[\"foo\"] = \"bar\"\n    session.Save(r, w)\n    w.Header().Set(\"Location\", \"http://localhost:8080?foo=bar\")\n    w.Header().Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n    w.WriteHeader(http.StatusFound)\n\n}\n\nfunc cTest(w http.ResponseWriter, r *http.Request) {\n    req, err := http.NewRequest(\"GET\", \"http://localhost:8080/test\", nil)\n    if err != nil {\n        log.Println(\"cTest Request Error : \", err.Error())\n        return\n    }\n    req.SetBasicAuth(\"sample_id\", \"sample_secret\")\n    req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n    c := &amp;http.Client{\n        Transport: &amp;http.Transport{},\n    }\n    resp, err := c.Do(req)\n    if err != nil {\n        log.Println(\"cTest Response Error : \", err.Error())\n        return\n    }\n    defer resp.Body.Close()\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Println(\"cTest Body Error : \", err.Error())\n        return\n    }\n    log.Println(string(body))\n}\n</code></pre>\n\n<hr>\n\n<h2>Server</h2>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n    \"github.com/gorilla/securecookie\"\n    \"github.com/gorilla/sessions\"\n)\n\nvar (\n    store       *sessions.CookieStore = sessions.NewCookieStore(securecookie.GenerateRandomKey(64))\n    session     *sessions.Session\n    SessionName = \"server\"\n)\n\nfunc main() {\n    store.Options = &amp;sessions.Options{\n        Path:     \"/\",\n        MaxAge:   60 * 15,\n        Secure:   false,\n        HttpOnly: true,\n    }\n    router := mux.NewRouter()\n    router.HandleFunc(\"/\", sIndex)\n    router.HandleFunc(\"/test\", sTest)\n    http.ListenAndServe(\":8080\", router)\n}\n\nfunc sIndex(w http.ResponseWriter, r *http.Request) {\n    r.ParseForm()\n    v := r.FormValue(\"foo\")\n    session, err := store.Get(r, SessionName)\n    if err != nil {\n        log.Println(\"sIndex Session Error : \", err.Error())\n        return\n    }\n    session.Values[\"foo\"] = v\n    session.Save(r, w)\n    w.Header().Set(\"Location\", \"http://localhost:7000/test\")\n    w.Header().Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n    w.WriteHeader(http.StatusFound)\n}\n\nfunc sTest(w http.ResponseWriter, r *http.Request) {\n    session, err := store.Get(r, SessionName)\n    if err != nil {\n        log.Println(\"sTest Session Error : \", err.Error())\n        return\n    }\n    v, ok := session.Values[\"foo\"].(string)\n    if !ok {\n        log.Printf(\"foo = %v\\n\", v)\n    }\n    data := struct {\n        Foo string\n    }{\n        v, // I expected v is bar,but v was nil.\n    }\n\n    bytes, err := json.Marshal(data)\n    if err != nil {\n        log.Println(\"sTest JSON Error : \", err.Error())\n        return\n    }\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.WriteHeader(http.StatusOK)\n    w.Write(bytes)\n}\n</code></pre>\n\n<hr>\n\n<h2>Details</h2>\n\n<ol>\n<li><p>Client sends request to server with query <code>foo=bar</code>.</p></li>\n<li><p>Server receives the request and parsing.</p></li>\n<li><p>Server saves query parameter in session.(I used <code>gorilla/session</code>)</p></li>\n<li><p>Client makes <code>*http.Client</code> and send new Request to server.</p></li>\n<li><p>Server receives request, and loads value in session, and set the value at response.</p></li>\n<li><p>Client receives value <code>bar</code></p></li>\n</ol>\n\n<hr>\n\n<p>In 5, I expected that server can load the value <code>bar</code> from session, but session value was nil.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 43895, "user_id": 25645, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b02cab91fb3c5604163c116c494de2a5?s=128&d=identicon&r=PG", "display_name": "Nathan H", "link": "https://stackoverflow.com/users/25645/nathan-h"}, "edited": false, "score": 0, "creation_date": 1499071087, "post_id": 44880581, "comment_id": 76740268, "body": "I agree that the linked question answers mine as well."}], "answers": [{"comments": [{"owner": {"reputation": 43895, "user_id": 25645, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b02cab91fb3c5604163c116c494de2a5?s=128&d=identicon&r=PG", "display_name": "Nathan H", "link": "https://stackoverflow.com/users/25645/nathan-h"}, "edited": false, "score": 0, "creation_date": 1499070312, "post_id": 44880697, "comment_id": 76739804, "body": "The tutorial did not cover <code>WaitGroup</code> yet, but thank you to both of you, at least I understand the issue now."}, {"owner": {"reputation": 38497, "user_id": 104014, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3d186f3c6ad2de59b356c1cfad9af404?s=128&d=identicon&r=PG", "display_name": "Artem Barger", "link": "https://stackoverflow.com/users/104014/artem-barger"}, "edited": false, "score": 0, "creation_date": 1499070889, "post_id": 44880697, "comment_id": 76740144, "body": "you can use channel instead of <code>WaitGroup</code>, the essence here, is the fact you need to wait for go routine to complete"}, {"owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "reply_to_user": {"reputation": 43895, "user_id": 25645, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b02cab91fb3c5604163c116c494de2a5?s=128&d=identicon&r=PG", "display_name": "Nathan H", "link": "https://stackoverflow.com/users/25645/nathan-h"}, "edited": false, "score": 0, "creation_date": 1499070964, "post_id": 44880697, "comment_id": 76740194, "body": "@NathanH You&#39;re welcome and keep going:)"}], "tags": [], "owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "is_accepted": false, "score": 2, "last_activity_date": 1499070909, "last_edit_date": 1499070909, "creation_date": 1499069671, "answer_id": 44880697, "question_id": 44880581, "link": "https://stackoverflow.com/questions/44880581/why-doesnt-go-subroutine-get-executed/44880697#44880697", "title": "Why doesn&#39;t Go subroutine get executed", "body": "<p>Your goroutines started, but ended before doing what you want to do because your <code>main()</code> finished. Execution of goroutines is independent of the main program like threads, but will be terminated when program stops. So you need a <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>WaitGroup</code></a> to wait for the goroutines to finish their jobs or simply call <code>time.Sleep()</code> to make the main program sleep for a while.</p>\n"}, {"tags": [], "owner": {"reputation": 38497, "user_id": 104014, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3d186f3c6ad2de59b356c1cfad9af404?s=128&d=identicon&r=PG", "display_name": "Artem Barger", "link": "https://stackoverflow.com/users/104014/artem-barger"}, "is_accepted": false, "score": 1, "last_activity_date": 1499069930, "creation_date": 1499069930, "answer_id": 44880774, "question_id": 44880581, "link": "https://stackoverflow.com/questions/44880581/why-doesnt-go-subroutine-get-executed/44880774#44880774", "title": "Why doesn&#39;t Go subroutine get executed", "body": "<p>There is nothing to make sure that all your go routines ends before your program finishes, I'd refactor your code to something similar to this:</p>\n\n<pre><code>func Crawl(url string, depth int, fetcher Fetcher) {\n    fmt.Println(\"Hello from Crawl\")\n    if depth &lt;= 0 {\n        return\n    }\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Printf(\"found: %s %q\\n\", url, body)\n   // Adding waiting group to make sure go routines finishes\n    wg := sync.WaitGroup{}\n    wg.Add(len(urls))\n    for _, u := range urls {\n        fmt.Println(\"in loop with u = %s\", u)\n        go func() {\n           defer wg.Done()\n           Crawl(u, depth-1, fetcher)\n        }()\n    }\n    wg.Wait()\n}\n</code></pre>\n"}], "owner": {"reputation": 43895, "user_id": 25645, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b02cab91fb3c5604163c116c494de2a5?s=128&d=identicon&r=PG", "display_name": "Nathan H", "link": "https://stackoverflow.com/users/25645/nathan-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "closed_date": 1499073418, "answer_count": 2, "score": 0, "last_activity_date": 1499070909, "creation_date": 1499069283, "question_id": 44880581, "link": "https://stackoverflow.com/questions/44880581/why-doesnt-go-subroutine-get-executed", "closed_reason": "Duplicate", "title": "Why doesn&#39;t Go subroutine get executed", "body": "<p>I'm learning go, following the online tutorial \"A tour of Go\".</p>\n\n<p>In this excercise: <a href=\"https://tour.golang.org/concurrency/10\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/10</a></p>\n\n<p>Before going on to solve the problem, I wanted to try something simple:</p>\n\n<pre><code>func Crawl(url string, depth int, fetcher Fetcher) {\n    fmt.Println(\"Hello from Crawl\")\n    if depth &lt;= 0 {\n        return\n    }\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Printf(\"found: %s %q\\n\", url, body)\n    for _, u := range urls {\n        fmt.Println(\"in loop with u = %s\", u)\n        go Crawl(u, depth-1, fetcher) //I added \"go\" here\n    }\n}\n</code></pre>\n\n<p>The only thing I added is the <code>go</code> command right before the recursive call to <code>Crawl</code>. I expected it should not change much to the behavior.</p>\n\n<p>However the printout is:</p>\n\n<pre><code>Hello from Crawl\nfound: http://golang.org/ \"The Go Programming Language\"\nin loop with u =  http://golang.org/pkg/\nin loop with u =  http://golang.org/cmd/\n</code></pre>\n\n<p>I expected to see <code>Hello from Crawl</code> for each iteration of the loop. \nWhy doesn't my <code>Crawl</code> subroutine get executed?</p>\n"}, {"tags": ["sql", "database", "pointers", "go", "copy"], "comments": [{"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 1, "creation_date": 1499065477, "post_id": 44879548, "comment_id": 76737196, "body": "When err is returned, rows will be nil, the dereference <code>*rows</code> make crash, I guess."}], "answers": [{"tags": [], "owner": {"reputation": 7911, "user_id": 2788297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/549bf8eda231e57a7ccbaf226e44bb02?s=128&d=identicon&r=PG&f=1", "display_name": "zeppelin", "link": "https://stackoverflow.com/users/2788297/zeppelin"}, "is_accepted": true, "score": 2, "last_activity_date": 1499092399, "creation_date": 1499092399, "answer_id": 44888235, "question_id": 44879548, "link": "https://stackoverflow.com/questions/44879548/reuse-or-copy-sql-rows-in-golang/44888235#44888235", "title": "Reuse or copy *sql.Rows in Golang", "body": "<p>The <code>database/sql</code> package does not provide any means to <code>rewind</code> the Rows, after you have read them, i.e. it is a \"forward only\" result set.</p>\n\n<p>Moreover, it will maintain a link to the underlying (physical) database connection, inside it, making it a bad idea to copy it or pass it around.</p>\n\n<p>If you need to apply multiple functions to your data, just <code>Scan</code> all the rows, to get a slice of data objects, and then pass this around.</p>\n\n<p>Scan will make a copy of the data you read:</p>\n\n<blockquote>\n  <p>Scan copies the columns from the matched row into the values pointed at by dest.</p>\n</blockquote>\n\n<p>so you can then safely <code>Close</code> your <code>Rows</code> object (releasing any associated database resources).</p>\n\n<p>You should watch out for errors too, after executing the Query (<code>err</code>) and after reading the rows, via <code>rows.Err()</code>.</p>\n"}], "owner": {"reputation": 1475, "user_id": 5203951, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/fd9dc7df52e3a9be33094cd877e3f8fb?s=128&d=identicon&r=PG", "display_name": "Yami Odymel", "link": "https://stackoverflow.com/users/5203951/yami-odymel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 886, "favorite_count": 0, "accepted_answer_id": 44888235, "answer_count": 1, "score": 0, "last_activity_date": 1499092399, "creation_date": 1499065310, "last_edit_date": 1499069491, "question_id": 44879548, "link": "https://stackoverflow.com/questions/44879548/reuse-or-copy-sql-rows-in-golang", "title": "Reuse or copy *sql.Rows in Golang", "body": "<p>Is it possible to reuse the same <code>*sql.Rows</code> after the <code>*sql.Rows.Next()</code> was called so I could pass it to another function? </p>\n\n<pre><code>rows, err := db.Query(...)\nfor rows.Next() {\n    // rows.Scan()\n}\nanotherFunction(rows) // NOT WORKING: This rows became empty.\n</code></pre>\n\n<p>I tried to make another copy of the <code>*sql.Rows</code> but it didn't work.</p>\n\n<pre><code>rows, err := db.Query(...)\nanotherRows := *rows\n// PANIC: call of load copies lock value: database/sql.Rows contains sync.RWMutex\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1499062668, "post_id": 44878486, "comment_id": 76735795, "body": "Because cover rewrites the sources and works on a different directory than plain <code>go test</code>. (Not worth an answer.)"}, {"owner": {"reputation": 95, "user_id": 5449397, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7CJrP.jpg?s=128&g=1", "display_name": "Vicky", "link": "https://stackoverflow.com/users/5449397/vicky"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1499076774, "post_id": 44878486, "comment_id": 76744094, "body": "What should I do so that cover will rewrite the source in same location?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1499079083, "post_id": 44878486, "comment_id": 76745426, "body": "You cannot and there is no need too. (Or you have to patch the go tool.)"}, {"owner": {"reputation": 95, "user_id": 5449397, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7CJrP.jpg?s=128&g=1", "display_name": "Vicky", "link": "https://stackoverflow.com/users/5449397/vicky"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1499169138, "post_id": 44878486, "comment_id": 76787399, "body": "Please suggest some links regarding unit testing and mocking of variables."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1499198133, "post_id": 44878486, "comment_id": 76802867, "body": "Your original question is pretty much unrelated to testing. <code>runtime.caller(0)</code> is <b>not</b> the right way to determine the current working directory (CWD). The CWD is set properly during <code>go test</code>, no matter whether <code>--cover</code> is used or not. Take a look at how the std library approaches testing. Most probably you are looking for <code>.&#47;testdir</code>."}, {"owner": {"reputation": 95, "user_id": 5449397, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7CJrP.jpg?s=128&g=1", "display_name": "Vicky", "link": "https://stackoverflow.com/users/5449397/vicky"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1499245225, "post_id": 44878486, "comment_id": 76818702, "body": "Thanks for help, some how I solve it by using os.Getwd()."}], "answers": [{"tags": [], "owner": {"reputation": 95, "user_id": 5449397, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7CJrP.jpg?s=128&g=1", "display_name": "Vicky", "link": "https://stackoverflow.com/users/5449397/vicky"}, "is_accepted": true, "score": 0, "last_activity_date": 1499246737, "creation_date": 1499246737, "answer_id": 44922169, "question_id": 44878486, "link": "https://stackoverflow.com/questions/44878486/why-runtime-caller0-is-giving-different-path-with-cover-argument-in-unit-t/44922169#44922169", "title": "Why runtime.caller(0) is giving different path with &#39;--cover&#39; argument in unit testing", "body": "<p>It worked by using os.Getwd() and runtime.caller  with a variable to diffrentiate between testing and normal running.  </p>\n"}], "owner": {"reputation": 95, "user_id": 5449397, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7CJrP.jpg?s=128&g=1", "display_name": "Vicky", "link": "https://stackoverflow.com/users/5449397/vicky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 44922169, "answer_count": 1, "score": -1, "last_activity_date": 1499246737, "creation_date": 1499060568, "last_edit_date": 1499065052, "question_id": 44878486, "link": "https://stackoverflow.com/questions/44878486/why-runtime-caller0-is-giving-different-path-with-cover-argument-in-unit-t", "title": "Why runtime.caller(0) is giving different path with &#39;--cover&#39; argument in unit testing", "body": "<p>When trying to execute a unit test function without any argument it  give following output path</p>\n\n<pre><code>C:/Program Files (x86)/Go1.8\\bin\\go.exe\" test -v gclassec/skyline/loggers -run ^TestCreateLogFilesPath$\n\nfilePath:=== C:/GerritNew/goclassec/src/gclassec/skyline/loggers/logs.go\n</code></pre>\n\n<p>But when I try to run it with any argument such as <code>--cover</code> the file path value changes as below:</p>\n\n<pre><code>\"C:/Program Files (x86)/Go1.8\\bin\\go.exe\" test -v --cover gclassec/skyline/loggers -run ^TestCreateLogFilesPath$\n\nfilePath:=== gclassec/skyline/loggers/_test/_obj_test/logs.go\n</code></pre>\n\n<p>I am using <code>runtime.caller(0)</code> to get file path. </p>\n"}, {"tags": ["go", "tcp-ip", "unix-socket"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1499085277, "post_id": 44876666, "comment_id": 76749403, "body": "Can you define &quot;not working&quot; within the question itself?"}], "answers": [{"comments": [{"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499047613, "post_id": 44876827, "comment_id": 76732108, "body": "if expect string, it prefer <code>chan string</code>."}, {"owner": {"reputation": 1674, "user_id": 6640806, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/10207119967343824/picture?type=large", "display_name": "Boris Le M&#233;ec", "link": "https://stackoverflow.com/users/6640806/boris-le-m%c3%a9ec"}, "edited": false, "score": 0, "creation_date": 1499048089, "post_id": 44876827, "comment_id": 76732200, "body": "Thank you, the whole code is garbage with html and whatever, unreadable. I use your code, but it produces nothing, i have no more message in my file..."}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "reply_to_user": {"reputation": 1674, "user_id": 6640806, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/10207119967343824/picture?type=large", "display_name": "Boris Le M&#233;ec", "link": "https://stackoverflow.com/users/6640806/boris-le-m%c3%a9ec"}, "edited": false, "score": 0, "creation_date": 1499048246, "post_id": 44876827, "comment_id": 76732226, "body": "@BorisLeM&#233;ec I&#39;m sorry, what are you trying to say?"}, {"owner": {"reputation": 1674, "user_id": 6640806, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/10207119967343824/picture?type=large", "display_name": "Boris Le M&#233;ec", "link": "https://stackoverflow.com/users/6640806/boris-le-m%c3%a9ec"}, "edited": false, "score": 0, "creation_date": 1499048435, "post_id": 44876827, "comment_id": 76732252, "body": "Sorry, my english is a total disaster tonight. I haven&#39;t published the entire code because it would be unreadable. Anyway i tried your code but now I can&#39;t even receive one message from the server, at the end of the execution, the file in tmp is still empty"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1499048997, "post_id": 44876827, "comment_id": 76732343, "body": "I do not have knowledge on your code.  However I will create generic TCP socket read and will update the answer. Then you can customize it for your need."}], "tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": true, "score": 2, "last_activity_date": 1499114632, "last_edit_date": 1499114632, "creation_date": 1499047423, "answer_id": 44876827, "question_id": 44876666, "link": "https://stackoverflow.com/questions/44876666/channels-in-golang-with-tcp-ip-socket-not-working/44876827#44876827", "title": "Channels in Golang with TCP/IP socket not working", "body": "<p>Channel usage looks alright, however retrieving value from channel would overwrite previously read value at <code>buf := &lt;-read</code> since your waiting for newline.</p>\n\n<p>Also you can use <code>bufio.Reader</code> to read string upto newline.</p>\n\n<p>Your code snippet is partial so its not feasible to execute, try and let me know:</p>\n\n<pre><code>func reader(r io.Reader, channel chan&lt;- string) {\n    bufReader := bufio.NewReader(conn)\n    for {\n        msg, err := bufReader.ReadString('\\n')\n        if err != nil { // connection error or connection reset error, etc\n           break\n        }\n        channel &lt;- msg\n    }\n}\n\nfunc client(e *gowd.Element) {\n    f, err := os.Create(\"/tmp/dat2\")\n    if err != nil {\n        log.Fatal()\n    }\n    read := make(chan string)\n    c, err := net.Dial(\"tcp\", \"127.0.0.1:4242\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    go reader(c, read)\n    for {\n        msg := &lt;-read\n        if msg == \"WELCOME\" {\n            fmt.Fprint(c, \"GRAPHIC\\n\")\n        }\n        f.WriteString(msg + \"\\n\")\n    }\n    //...\n}\n</code></pre>\n\n<hr>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Please find example of generic TCP client to read data. Also I have removed scanner from above code snippet and added buffer reader.</p>\n\n<pre><code>func main() {\n    conn, err := net.Dial(\"tcp\", \"127.0.0.1:4242\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    reader := bufio.NewReader(conn)\n    for {\n        msg, err := reader.ReadString('\\n')\n        if err != nil {\n            break\n        }\n        fmt.Println(msg)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1674, "user_id": 6640806, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/10207119967343824/picture?type=large", "display_name": "Boris Le M&#233;ec", "link": "https://stackoverflow.com/users/6640806/boris-le-m%c3%a9ec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2736, "favorite_count": 1, "accepted_answer_id": 44876827, "answer_count": 1, "score": 0, "last_activity_date": 1499114632, "creation_date": 1499045645, "last_edit_date": 1499108080, "question_id": 44876666, "link": "https://stackoverflow.com/questions/44876666/channels-in-golang-with-tcp-ip-socket-not-working", "title": "Channels in Golang with TCP/IP socket not working", "body": "<p>I just started writting a Golang client for a server that I've made in C with TCP/IP sockets, then I figured out that my channel wasn't working.</p>\n\n<p>Any ideas why ?</p>\n\n<pre><code>func reader(r io.Reader, channel chan&lt;- []byte) {\n  buf := make([]byte, 2048)\n  for {\n    n, err := r.Read(buf[:])\n    if err != nil {\n        return\n    }\n    channel &lt;- buf[0:n]\n  }\n}\nfunc client(e *gowd.Element) {\n f, err := os.Create(\"/tmp/dat2\")\n if err != nil {\n    log.Fatal()\n }\n read := make(chan []byte)\n c, err := net.Dial(\"tcp\", \"127.0.0.1:4242\")\n if err != nil {\n    log.Fatal(err)\n }\n go reader(c, read)\n for {\n    buf := &lt;-read\n    n := strings.Index(string(buf), \"\\n\")\n    if n == -1 {\n        continue\n }\n msg := string(buf[0:n])\n if msg == \"WELCOME\" {\n    fmt.Fprint(c, \"GRAPHIC\\n\")\n }\n f.WriteString(msg + \"\\n\")\n}\n</code></pre>\n\n<p>Testing my server with netcat results in the following output : \n<a href=\"http://pasted.co/a37b2954\" rel=\"nofollow noreferrer\">http://pasted.co/a37b2954</a></p>\n\n<p>But i only have : <a href=\"http://pasted.co/f13d56b4\" rel=\"nofollow noreferrer\">http://pasted.co/f13d56b4</a></p>\n\n<p>I'm new to chan in Golang so maybe I'm wrong (I probably am)</p>\n"}, {"tags": ["json", "go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": true, "score": 3, "last_activity_date": 1499041942, "creation_date": 1499041942, "answer_id": 44876353, "question_id": 44876315, "link": "https://stackoverflow.com/questions/44876315/golang-unmarshal-slice-of-slice-of-ints/44876353#44876353", "title": "Golang Unmarshal slice of slice of ints", "body": "<p>It seems there is a three issues in your provided code snippet.</p>\n\n<ul>\n<li>Struct field have to be exported, refer to <a href=\"https://www.goinggo.net/2014/03/exportedunexported-identifiers-in-go.html\" rel=\"nofollow noreferrer\">Exported vs Unexported</a> identifiers</li>\n<li>Your JSON data is invalid <code>invalid character '[' after array element {[]}</code></li>\n<li>Field data type definition</li>\n</ul>\n\n<p>I have updated your code here <a href=\"https://play.golang.org/p/zX7KEPKB8H\" rel=\"nofollow noreferrer\">https://play.golang.org/p/zX7KEPKB8H</a></p>\n\n<p>Output <code>{[[1 2] [3 4]]}</code></p>\n"}], "owner": {"reputation": 1917, "user_id": 3158028, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ea4a357ca24f6f6b54ee9bc5061aef40?s=128&d=identicon&r=PG&f=1", "display_name": "Soubriquet", "link": "https://stackoverflow.com/users/3158028/soubriquet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 541, "favorite_count": 0, "accepted_answer_id": 44876353, "answer_count": 1, "score": -1, "last_activity_date": 1499041942, "creation_date": 1499041396, "question_id": 44876315, "link": "https://stackoverflow.com/questions/44876315/golang-unmarshal-slice-of-slice-of-ints", "title": "Golang Unmarshal slice of slice of ints", "body": "<p>How do you unmarshal a JSON into a slice of slices of ints? I keep on getting a blank struct:\n<a href=\"https://play.golang.org/p/Ch4k4BH_9C\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Hgnh5C9FN_</a></p>\n\n<p>Also is it possible to unmarshal something like [[1 2][3 4]] without a key e.g. {\"key\":[[1 2][3 4]]}?</p>\n"}, {"tags": ["go", "gcloud", "grpc", "bigtable"], "comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1499076216, "post_id": 44874705, "comment_id": 76743700, "body": "how do you integrate the &quot;createBigTable&quot; function in flow/main?"}, {"owner": {"reputation": 1326, "user_id": 789125, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7484bfbfd4f46d5621315de848b5a996?s=128&d=identicon&r=PG", "display_name": "Jenny Blunt", "link": "https://stackoverflow.com/users/789125/jenny-blunt"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1499077556, "post_id": 44874705, "comment_id": 76744555, "body": "It&#39;s in the init function actually with a couple of other things. It&#39;s not just BigTable though - adding a connector to PubSub creates the issue too."}, {"owner": {"reputation": 1326, "user_id": 789125, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7484bfbfd4f46d5621315de848b5a996?s=128&d=identicon&r=PG", "display_name": "Jenny Blunt", "link": "https://stackoverflow.com/users/789125/jenny-blunt"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1499080048, "post_id": 44874705, "comment_id": 76746009, "body": "PS. I&#39;ve moved the call around and it&#39;s still interfering."}, {"owner": {"reputation": 1326, "user_id": 789125, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7484bfbfd4f46d5621315de848b5a996?s=128&d=identicon&r=PG", "display_name": "Jenny Blunt", "link": "https://stackoverflow.com/users/789125/jenny-blunt"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1499204655, "post_id": 44874705, "comment_id": 76805159, "body": "I just explained that it&#39;s called in the init function which is called before the main function. I&#39;ve updated regardless."}, {"owner": {"reputation": 1326, "user_id": 789125, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7484bfbfd4f46d5621315de848b5a996?s=128&d=identicon&r=PG", "display_name": "Jenny Blunt", "link": "https://stackoverflow.com/users/789125/jenny-blunt"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1499205770, "post_id": 44874705, "comment_id": 76805389, "body": "Obviously before the main function?"}, {"owner": {"reputation": 1326, "user_id": 789125, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7484bfbfd4f46d5621315de848b5a996?s=128&d=identicon&r=PG", "display_name": "Jenny Blunt", "link": "https://stackoverflow.com/users/789125/jenny-blunt"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1499206668, "post_id": 44874705, "comment_id": 76805610, "body": "Yes but I think you&#39;re missing the point."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1499207082, "post_id": 44874705, "comment_id": 76805713, "body": "Just wanted to make sure. Sorry if that sounded like I thought you didn&#39;t know what you where doing. Do you know where exactly the &quot;whole think blocks&quot;?"}, {"owner": {"reputation": 1326, "user_id": 789125, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7484bfbfd4f46d5621315de848b5a996?s=128&d=identicon&r=PG", "display_name": "Jenny Blunt", "link": "https://stackoverflow.com/users/789125/jenny-blunt"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1499241662, "post_id": 44874705, "comment_id": 76816340, "body": "If I knew that, I wouldn&#39;t have asked the question."}, {"owner": {"reputation": 4055, "user_id": 2598037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWCTo.jpg?s=128&g=1", "display_name": "Carl Mastrangelo", "link": "https://stackoverflow.com/users/2598037/carl-mastrangelo"}, "edited": false, "score": 0, "creation_date": 1499295469, "post_id": 44874705, "comment_id": 76850890, "body": "Jenny: Can you press Ctrl \\  (SIG QUIT) while running and get a dump of all Go routines stacks?  That would give a lot of clarity as to what it is blocking on."}, {"owner": {"reputation": 1326, "user_id": 789125, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7484bfbfd4f46d5621315de848b5a996?s=128&d=identicon&r=PG", "display_name": "Jenny Blunt", "link": "https://stackoverflow.com/users/789125/jenny-blunt"}, "reply_to_user": {"reputation": 4055, "user_id": 2598037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWCTo.jpg?s=128&g=1", "display_name": "Carl Mastrangelo", "link": "https://stackoverflow.com/users/2598037/carl-mastrangelo"}, "edited": false, "score": 0, "creation_date": 1499332260, "post_id": 44874705, "comment_id": 76864414, "body": "@CarlMastrangelo Thanks, I didn&#39;t know you could do this. Think I can see the block, have updated the question."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1499373380, "post_id": 44874705, "comment_id": 76892144, "body": "Can you provide full runnable code on <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">play.golang.org</a>? So that we can test local."}, {"owner": {"reputation": 1326, "user_id": 789125, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7484bfbfd4f46d5621315de848b5a996?s=128&d=identicon&r=PG", "display_name": "Jenny Blunt", "link": "https://stackoverflow.com/users/789125/jenny-blunt"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1499522791, "post_id": 44874705, "comment_id": 76948232, "body": "@reticentroot not really since I cannot import all the dependancies. However, I&#39;ve added something here for good measure. <a href=\"https://play.golang.org/p/XeQ0bGcEmt\" rel=\"nofollow noreferrer\">play.golang.org/p/XeQ0bGcEmt</a>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1499549603, "post_id": 44874705, "comment_id": 76956837, "body": "I&#39;m still giving it a look... obviously its contained to your flow function, which isn&#39;t very big..can you use a timeout or rate limit..perhaps too many connections are being open too fast  <a href=\"https://stackoverflow.com/questions/26081073/how-do-i-read-a-udp-connection-until-a-timeout-is-reached\" title=\"how do i read a udp connection until a timeout is reached\">stackoverflow.com/questions/26081073/&hellip;</a>, I&#39;d also check your machines ulimit and perhaps increase it.. and or also lower the amount of connections being opened."}, {"owner": {"reputation": 1326, "user_id": 789125, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7484bfbfd4f46d5621315de848b5a996?s=128&d=identicon&r=PG", "display_name": "Jenny Blunt", "link": "https://stackoverflow.com/users/789125/jenny-blunt"}, "edited": false, "score": 0, "creation_date": 1499592500, "post_id": 44874705, "comment_id": 76963848, "body": "Appreciate it. It&#39;s not the throttle - it&#39;s getting less than 1 per 10 seconds. And it&#39;s fine without the gcloud addition."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1499708953, "post_id": 44874705, "comment_id": 77011065, "body": "Can you use delve to debug... if you don&#39;t have delve or have never used it then perhaps you should learn about it... in the mean time place print statements above and below each line of code to figure the exact line that is blocking.. if it can be narrows down to a line or two then the misbehaving function can be pin pointed. I&#39;ve made some modifications to the example you provide. <a href=\"https://play.golang.org/p/J0FNV33kB0\" rel=\"nofollow noreferrer\">play.golang.org/p/J0FNV33kB0</a>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1499710117, "post_id": 44874705, "comment_id": 77011784, "body": "Also in your big table function. You create a context with background. Instead create the context with timeout.. Perhaps one of 1 second. You can skip around in this video <a href=\"https://youtu.be/c5ufcpTGIJM\" rel=\"nofollow noreferrer\">youtu.be/c5ufcpTGIJM</a> but it shows a Google tool being initialized with timeout instead of background. The table could fail to initialize in a timely fashion causing your IO block error in the stack trace you provided."}], "answers": [{"comments": [{"owner": {"reputation": 1326, "user_id": 789125, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7484bfbfd4f46d5621315de848b5a996?s=128&d=identicon&r=PG", "display_name": "Jenny Blunt", "link": "https://stackoverflow.com/users/789125/jenny-blunt"}, "edited": false, "score": 0, "creation_date": 1499723180, "post_id": 44999537, "comment_id": 77018551, "body": "Looks like this has sorted it, I cannot test properly but using nc - it works. Thanks !!!!"}], "tags": [], "owner": {"reputation": 7660, "user_id": 2350684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yuQa5.jpg?s=128&g=1", "display_name": "Oliver", "link": "https://stackoverflow.com/users/2350684/oliver"}, "is_accepted": true, "score": 0, "last_activity_date": 1499623931, "creation_date": 1499623931, "answer_id": 44999537, "question_id": 44874705, "link": "https://stackoverflow.com/questions/44874705/golang-listenudp-multiple-ports-blocking-with-bigtable-connection/44999537#44999537", "title": "Golang listenUDP multiple ports blocking with BigTable connection", "body": "<p>In your playground example, you're using <code>for {}</code> to keep the server running for forever.\nThis seems to deprive the goroutines from ever getting to run.\nTry using e.g. a <code>WaitGroup</code> to yield control from the <code>main()</code> routine and let the <code>flow()</code> routines handle the incoming UDP packets.</p>\n\n<pre><code>import (\n    ...\n    \"sync\"\n    ...\n)\n\n...\n\nfunc main() {\n\n    fmt.Print(\"Starting server.\")\n    for i := *Start; i &lt;= *End; i++ {\n        x := strconv.Itoa(i)\n        go flow(x)\n    }\n\n    var wg sync.WaitGroup\n    wg.Add(1)\n    wg.Wait()\n}\n</code></pre>\n"}], "owner": {"reputation": 1326, "user_id": 789125, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7484bfbfd4f46d5621315de848b5a996?s=128&d=identicon&r=PG", "display_name": "Jenny Blunt", "link": "https://stackoverflow.com/users/789125/jenny-blunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 554, "favorite_count": 1, "accepted_answer_id": 44999537, "answer_count": 1, "score": 3, "last_activity_date": 1499623931, "creation_date": 1499025454, "last_edit_date": 1499332362, "question_id": 44874705, "link": "https://stackoverflow.com/questions/44874705/golang-listenudp-multiple-ports-blocking-with-bigtable-connection", "title": "Golang listenUDP multiple ports blocking with BigTable connection", "body": "<p>I'm creating a simple udp client that listens on multiple ports and saves the request to bigtable.</p>\n\n<p>It's essential to listen on different ports before you ask.</p>\n\n<p>Everything was working nicely until I included bigtable. After doing so, the listeners block completely.</p>\n\n<p>My stripped down code, without bigtable, looks like this:</p>\n\n<pre><code>func flow(port string) {\n\n    protocol := \"udp\"\n    udpAddr, err := net.ResolveUDPAddr(protocol, \"0.0.0.0:\"+port)\n    if err != nil {\n        fmt.Println(\"Wrong Address\")\n        return\n    }\n\n    udpConn, err := net.ListenUDP(protocol, udpAddr)\n    if err != nil {\n        fmt.Println(err)\n    }\n    defer udpConn.Close()\n\n    for {\n        Publish(udpConn, port)\n    }\n}\n\nfunc main() {\n\n    fmt.Print(\"Starting server.........\")\n    for i := *Start; i &lt;= *End; i++ {\n        x := strconv.Itoa(i)\n        go flow(x)\n    }\n}\n</code></pre>\n\n<p>This works fine however, as soon as I add the following for bigtable, the whole thing blocks. If I remove the go routine that creates the listener (which means I can't listen on multiple ports) it works.</p>\n\n<pre><code>func createBigTable() {\n    ctx := context.Background()\n\n    client, err := bigtable.NewClient(ctx, *ProjectID, *Instance)\n    if err != nil {\n        log.Fatal(\"Bigtable NewClient:\", err)\n    }\n\n    Table = client.Open(\"x\")\n\n}\n</code></pre>\n\n<p>I managed to get it working by adding a query in the createBigTable func but the program still blocks later on.</p>\n\n<p>I have no idea if this is an issue with bigtable, grpc or just the way I'm doing it.</p>\n\n<p>Would really appreciate some advise about how to fix.</p>\n\n<p>--- UPDATE ---</p>\n\n<p>I've discovered the issue isn't just with BigTable - I also have the same issue when I call gcloud pubsub.</p>\n\n<p>--- UPDATE 2 ---</p>\n\n<p>createBigtable is called in the init function (BEFORE THE MAIN FUNCTION):</p>\n\n<pre><code>func init() {\n    createBigTable\n}\n</code></pre>\n\n<p>--- Update 3 ---</p>\n\n<p>Output from sigquit can be found here:</p>\n\n<p><a href=\"https://pastebin.com/fzixqmiA\" rel=\"nofollow noreferrer\">https://pastebin.com/fzixqmiA</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1499028524, "post_id": 44874566, "comment_id": 76728534, "body": "Provide an example of data you get back at the moment together with the expected result. From the query in the code you provided it&#39;s not obvious what kind of duplicates you&#39;re observing: the only way you may have got those is only in case if your original data contains duplicates."}, {"owner": {"reputation": 6155, "user_id": 4378314, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7935867003690df779b06563293f6293?s=128&d=identicon&r=PG", "display_name": "MarsAndBack", "link": "https://stackoverflow.com/users/4378314/marsandback"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1499029172, "post_id": 44874566, "comment_id": 76728710, "body": "Edited OP with SQL rows output."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1499029229, "post_id": 44874566, "comment_id": 76728726, "body": "I don&#39;t see duplicate rows there: every row is a unique combination of values in what you&#39;ve just posted."}, {"owner": {"reputation": 6155, "user_id": 4378314, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7935867003690df779b06563293f6293?s=128&d=identicon&r=PG", "display_name": "MarsAndBack", "link": "https://stackoverflow.com/users/4378314/marsandback"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1499029424, "post_id": 44874566, "comment_id": 76728782, "body": "You are correct regarding the rows. However do you see my ultimate JSON output, and the fact that there are multiple identical location entries occurring? Now multiple by 100&#39;s of locations and 10,000 events, and you can see the issue."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1499029527, "post_id": 44874566, "comment_id": 76728806, "body": "If you need 2 different result sets, simply run 2 different queries: one extracts locations, another extracts events. Fetching everything once not only is more complicated, but makes really little sense. <i>UPD</i>: exactly as Eugene Lisitsky explained in their answer."}], "answers": [{"comments": [{"owner": {"reputation": 6155, "user_id": 4378314, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7935867003690df779b06563293f6293?s=128&d=identicon&r=PG", "display_name": "MarsAndBack", "link": "https://stackoverflow.com/users/4378314/marsandback"}, "edited": false, "score": 0, "creation_date": 1499027514, "post_id": 44874736, "comment_id": 76728241, "body": "Hi I&#39;ve tried this approach, however unsuccessful. Using GROUP BY with a particular field ends up eliminating rows. Using multiple fields with GROUP BY does help to sort the rows by group. See OP edit."}, {"owner": {"reputation": 21, "user_id": 7424919, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-7Tm7satJXDg/AAAAAAAAAAI/AAAAAAAAAWk/Ing0pEr5epw/photo.jpg?sz=128", "display_name": "Skov", "link": "https://stackoverflow.com/users/7424919/skov"}, "reply_to_user": {"reputation": 6155, "user_id": 4378314, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7935867003690df779b06563293f6293?s=128&d=identicon&r=PG", "display_name": "MarsAndBack", "link": "https://stackoverflow.com/users/4378314/marsandback"}, "edited": false, "score": 0, "creation_date": 1499028945, "post_id": 44874736, "comment_id": 76728650, "body": "Aah, I studied your table structure in more details this time. You made a many-to-many connection between location and event. Can the event really be held at multiple locations? Or is it only the same location that can be used for many event?"}, {"owner": {"reputation": 21, "user_id": 7424919, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-7Tm7satJXDg/AAAAAAAAAAI/AAAAAAAAAWk/Ing0pEr5epw/photo.jpg?sz=128", "display_name": "Skov", "link": "https://stackoverflow.com/users/7424919/skov"}, "reply_to_user": {"reputation": 6155, "user_id": 4378314, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7935867003690df779b06563293f6293?s=128&d=identicon&r=PG", "display_name": "MarsAndBack", "link": "https://stackoverflow.com/users/4378314/marsandback"}, "edited": false, "score": 0, "creation_date": 1499030218, "post_id": 44874736, "comment_id": 76728943, "body": "Then I would just make two queries. 1) Get a list of locations as in code example above and 2) A new query containing all the events and include the location.Id"}, {"owner": {"reputation": 21, "user_id": 7424919, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-7Tm7satJXDg/AAAAAAAAAAI/AAAAAAAAAWk/Ing0pEr5epw/photo.jpg?sz=128", "display_name": "Skov", "link": "https://stackoverflow.com/users/7424919/skov"}, "reply_to_user": {"reputation": 6155, "user_id": 4378314, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7935867003690df779b06563293f6293?s=128&d=identicon&r=PG", "display_name": "MarsAndBack", "link": "https://stackoverflow.com/users/4378314/marsandback"}, "edited": false, "score": 0, "creation_date": 1499030358, "post_id": 44874736, "comment_id": 76728976, "body": "Besides - it seems to me that you only need a one-to-many relation between location and event (not many-to-many). That would make a query even easier."}], "tags": [], "owner": {"reputation": 21, "user_id": 7424919, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-7Tm7satJXDg/AAAAAAAAAAI/AAAAAAAAAWk/Ing0pEr5epw/photo.jpg?sz=128", "display_name": "Skov", "link": "https://stackoverflow.com/users/7424919/skov"}, "is_accepted": false, "score": 0, "last_activity_date": 1499025739, "creation_date": 1499025739, "answer_id": 44874736, "question_id": 44874566, "link": "https://stackoverflow.com/questions/44874566/go-removing-duplicate-rows-after-sql-join-result/44874736#44874736", "title": "Go: Removing duplicate rows after SQL join result", "body": "<p>If you are querying the database yourself, you should be able to avoid any duplicates in the first place.\nIn the end of your query add \"GROUP BY {unique field}\". </p>\n\n<p>Example that should give a unique list of locations that are on you event list </p>\n\n<pre><code>SELECT location.* \nFROM location.ID, location.Title, location.Latlng\n  INNER JOIN event ON event.ID=location.ID\nGROUP BY location.ID\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 2, "last_activity_date": 1499029500, "creation_date": 1499029500, "answer_id": 44875208, "question_id": 44874566, "link": "https://stackoverflow.com/questions/44874566/go-removing-duplicate-rows-after-sql-join-result/44875208#44875208", "title": "Go: Removing duplicate rows after SQL join result", "body": "<p>I think you can split your request in two: locations (<code>SELECT * FROM locations</code>) and events (<code>SELECT * FROM events</code>) and then pass them to JSON marshaller.\nThese 2 requests will be very easy and fast for database to perform. Next they will be easier to cache intermediate results.</p>\n\n<blockquote>\n  <p>but now I'm running multiple SQL queries, something I wanted to avoid.</p>\n</blockquote>\n\n<p>Could you pls clarify this moment - why do you want to avoid multiple queries? What task do you want to solve and what limitations have? Sometimes set of small easy queries are better than one overcomplicated.</p>\n"}], "owner": {"reputation": 6155, "user_id": 4378314, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7935867003690df779b06563293f6293?s=128&d=identicon&r=PG", "display_name": "MarsAndBack", "link": "https://stackoverflow.com/users/4378314/marsandback"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 606, "favorite_count": 0, "accepted_answer_id": 44875208, "answer_count": 2, "score": 0, "last_activity_date": 1499029712, "creation_date": 1499024491, "last_edit_date": 1499029142, "question_id": 44874566, "link": "https://stackoverflow.com/questions/44874566/go-removing-duplicate-rows-after-sql-join-result", "title": "Go: Removing duplicate rows after SQL join result", "body": "<p>I\u2019m running a joined SQL query for locations and events (occuring at the locations). In the results, naturally the location data is replicated per row, as there\u2019s a one-to-many relationship: one location holds multiple events.</p>\n\n<p>What\u2019s an optimal approach to clean up the multiplied location data?</p>\n\n<p>Staying with a single SQL operation, what makes the most sense is performing a check while looping through the query results (rows).</p>\n\n<p>However I cannot seem to access the locations object to check for a pre-existing location ID.</p>\n\n<p><strong>Edit:</strong>\nThis is the SQL output. As you see, location data naturally occurs multiple times, because it's shared across events. Ultimately this will be sent out as JSON eventually, with nested structs, one for locations, one for events.</p>\n\n<pre><code>id  title           latlng                  id  title           locationid  \n1   Fox Thea...     43.6640673,-79.4213863  1   Bob's Event     1\n1   Fox Thea...     43.6640673,-79.4213863  2   Jill's Event    1\n2   Wrigley ...     43.6640673,-79.4213863  3   Mary's Event    2\n3   Blues Bar       43.6640673,-79.4213863  4   John's Event    3\n1   Fox Thea...     43.6640673,-79.4213863  5   Monthly G...    1\n1   Fox Thea...     43.6640673,-79.4213863  6   A Special...    1\n1   Fox Thea...     43.6640673,-79.4213863  7   The Final...    1\n</code></pre>\n\n<p>The JSON output. As you see location data is multiplied making for a larger JSON file. </p>\n\n<pre><code>   {\n        \"Locations\": [\n            {\n                \"ID\": 1,\n                \"Title\": \"Fox Theatre\",\n                \"Latlng\": \"43.6640673,-79.4213863\",\n            },\n            {\n                \"ID\": 1,\n                \"Title\": \"Fox Theatre\",\n                \"Latlng\": \"43.6640673,-79.4213863\",\n            },\n            {\n                \"ID\": 2,\n                \"Title\": \"Wrigley Field\",\n                \"Latlng\": \"43.6640673,-79.4213863\",\n            },\n            {\n                \"ID\": 3,\n                \"Title\": \"Blues Bar\",\n                \"Latlng\": \"43.6640673,-79.4213863\",\n            },\n            {\n                \"ID\": 1,\n                \"Title\": \"Fox Theatre\",\n                \"Latlng\": \"43.6640673,-79.4213863\",\n            },\n            {\n                \"ID\": 1,\n                \"Title\": \"Fox Theatre\",\n                \"Latlng\": \"43.6640673,-79.4213863\",\n            },\n            {\n                \"ID\": 1,\n                \"Title\": \"Fox Theatre\",\n                \"Latlng\": \"43.6640673,-79.4213863\",\n            }\n        ],\n        \"Events\": [\n            {\n                \"ID\": 1,\n                \"Title\": \"Bob's Event\",\n                \"Location\": 1\n            },\n            {\n                \"ID\": 2,\n                \"Title\": \"Jill's Event\",\n                \"Location\": 1\n            },\n            {\n                \"ID\": 3,\n                \"Title\": \"Mary's Event\",\n                \"Location\": 2\n            },\n            {\n                \"ID\": 4,\n                \"Title\": \"John's Event\",\n                \"Location\": 3\n            },\n            {\n                \"ID\": 5,\n                \"Title\": \"Monthly Gathering\",\n                \"Location\": 1\n            },\n            {\n                \"ID\": 6,\n                \"Title\": \"A Special Event\",\n                \"Location\": 1\n            },\n            {\n                \"ID\": 7,\n                \"Title\": \"The Final Contest\",\n                \"Location\": 1\n            }\n        ]\n\n    }\n</code></pre>\n\n<p>Structs:</p>\n\n<pre><code>// Event type\ntype Event struct {\n    ID int `schema:\"id\"`\n    Title string `schema:\"title\"`\n    LocationID int `schema:\"locationid\"`\n}\n\n// Location type\ntype Location struct {\n    ID int `schema:\"id\"`\n    Title string `schema:\"title\"`\n    Latlng string `schema:\"latlng\"`\n}\n\n// LocationsEvents type\ntype LocationsEvents struct {\n    Locations []Location `schema:\"locations\"`\n    Events []Event `schema:\"events\"`\n}\n</code></pre>\n\n<p>Function running the query and looping through rows:</p>\n\n<pre><code>func getLocationsEvents(db *sql.DB, start, count int) ([]Location, []Event, error) {\n\n    var locations = []Location{}\n    var events = []Event{}\n\n    rows, err := db.Query(\"SELECT locations.id, locations.title, locations.latlng, events.id, events.title, events.locationid FROM locations LEFT JOIN events ON locations.id = events.locationid LIMIT ? OFFSET ?\", count, start)\n    if err != nil {\n        return locations, events, err\n    }\n    defer rows.Close()\n\n    for rows.Next() {\n        var location Location\n        var event Event\n\n        err := rows.Scan(&amp;location.ID, &amp;location.Title, &amp;location.Latlng, &amp;event.ID, &amp;event.Title, &amp;event.LocationID);\n        if err != nil {\n                return locations, events, err\n        }\n\n    // Here I can print locations and see it getting longer with each loop iteration\n    fmt.Println(locations)\n\n    // How can I check if an ID exists in locations?\n    // Ideally, if location.ID already exists in locations, then only append event, otherwise, append both the location and event\n\n        locations = append(locations, location)\n        events = append(events, event)\n    }\n\n    return locations, events, nil\n}\n</code></pre>\n\n<p>Function called on by router:</p>\n\n<pre><code>func (a *App) getLocationsEventsJSON(w http.ResponseWriter, r *http.Request) {\n\ncount := 99\nstart := 0\n\n    if count &gt; 10 || count &lt; 1 {\n        count = 10\n    }\n    if start &lt; 0 {\n        start = 0\n    }\n\n    locations, events, err := getLocationsEvents(a.DB, start, count)\n    if err != nil {\n        respondWithError(w, http.StatusInternalServerError, err.Error())\n        return\n    }\n\n    var locationsEvents LocationsEvents\n\n    locationsEvents.Locations = locations\n    locationsEvents.Events = events\n\n    respondWithJSON(w, http.StatusOK, locationsEvents)\n}\n</code></pre>\n\n<p>Function sending data out as JSON (part of REST API):</p>\n\n<pre><code>func respondWithJSON(w http.ResponseWriter, code int, payload interface{}) {\n    response, _ := json.Marshal(payload)\n\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.WriteHeader(code)\n    w.Write(response)\n}\n</code></pre>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>Reverting to doing this with the SQL query, what are the possibilities? Using GROUP BY? Here is an example SQL:</p>\n\n<p>SELECT locations.id, locations.title, locations.latlng, events.id, events.title, events.locationid\nFROM locations\nLEFT JOIN events ON locations.id = events.locationid\nGROUP BY locations.id, events.id</p>\n\n<p>The result set still contains duplicated location data, however it's nicely grouped and sorted.</p>\n\n<p>Then there's the possibility of sub-queries:\n<a href=\"http://www.w3resource.com/sql/subqueries/understanding-sql-subqueries.php\" rel=\"nofollow noreferrer\">http://www.w3resource.com/sql/subqueries/understanding-sql-subqueries.php</a> but now I'm running multiple SQL queries, something I wanted to avoid.</p>\n\n<p>In reality I don't think I can avoid the duplicated location data when using a single join query like I am. How else would I receive a resultset of joined data, without having location data replicated? Having the SQL server send me pre-made JSON data as I need it (locations and events seperated)? From my understanding it's better doing that work after receiving results.</p>\n"}, {"tags": ["go", "goroutine", "cancellation", "tui"], "answers": [{"tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 2, "last_activity_date": 1499077668, "creation_date": 1499077668, "answer_id": 44883288, "question_id": 44874456, "link": "https://stackoverflow.com/questions/44874456/cancel-a-context-context-more-than-once/44883288#44883288", "title": "Cancel a context.Context more than once?", "body": "<p>What about using a channel to cancel the goroutine?</p>\n\n<pre><code>select {\ncase &lt;-chClose:\n    return\ndefault:\n}\n</code></pre>\n\n<p>Your cancel() call could simply close the channel:</p>\n\n<pre><code>close(chClose)\n</code></pre>\n\n<p>but then you cannot close it again! So you need to make sure your new album has a new chClose. Depending on your code structure this might be the cleaner solution.</p>\n\n<p>Alternatively you can just send a value on chClose to initiate a stop of the go routine:</p>\n\n<pre><code>chClose &lt;- 1\n</code></pre>\n\n<p>You can do that as often as you want.</p>\n\n<p>Note that if there is no goroutine listening, this will block (or if you have a buffer, you will end up closing routines that have not even startet yet. --> You need a clean architecture!!)</p>\n"}], "owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2645, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1499077668, "creation_date": 1499023764, "last_edit_date": 1499031595, "question_id": 44874456, "link": "https://stackoverflow.com/questions/44874456/cancel-a-context-context-more-than-once", "title": "Cancel a context.Context more than once?", "body": "<p>I'm working on a console music player in <code>Go</code>. Whenever the user selects and plays an album, I <strong>launch a goroutine</strong> to <strong>loop</strong> over a playlist.</p>\n\n<pre><code>playlist := make([]*Media, 0)\nfor _, path := range album.Paths {\n    media, err := NewMediaFromPath(path)\n    // return err\n\n    playlist = append(playlist, media)\n}\n\nfor idx := range playlist {\n    player.SetMedia(playlist[idx])\n    err = player.Play()\n    // check err\n\n    status, err := player.MediaState()\n    // check err\n\n    for status != MediaEnded &amp;&amp; status != MediaStopped {\n        // update UI and check player status\n        // loop until the song finishes\n        status, err = player.MediaState()\n    }\n}\n</code></pre>\n\n<p>I need a way of <strong>canceling</strong> this goroutine when the user <strong>selects a new album</strong>. I'm using <code>context.Context</code> to do so (but I'm not convinced it's the best solution).</p>\n\n<p>I create the <code>ctx</code></p>\n\n<pre><code>    ctx, cancel := context.WithCancel(context.Background())\n</code></pre>\n\n<p>So in the UI event handler, the <code>play()</code> <code>func</code> will <code>cancel()</code> the goroutine.</p>\n\n<p>This works once I check inside the update UI <code>for</code> loop:</p>\n\n<pre><code>        select {\n        case &lt;-ctx.Done():\n            return err\n        default:\n            time.Sleep(50 * time.Millisecond)\n        }\n</code></pre>\n\n<p>Then the channel <code>ctx.Done()</code> is closed and the next albums played will always return instead of loop.</p>\n\n<p>Is there a way to recancel a <code>context.Context</code>? </p>\n\n<p>If not, is there a better way to cancel this goroutine (and the following goroutines)?</p>\n\n<p>Alternatively I've tried to use waitgroups,</p>\n\n<pre><code>    go func() {\n        wg.Wait()\n        wg.Add(1)\n        err = playAlbum(\n            done,\n            player,\n            *albums[s],\n            list,\n            status,\n        )\n        wg.Done()\n        // handle err\n     }()\n</code></pre>\n\n<p>But then I get a <code>sync: WaitGroup is reused before previous Wait has returned</code> panic</p>\n"}, {"tags": ["go", "timestamp", "unix-timestamp"], "answers": [{"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 2, "creation_date": 1531799784, "post_id": 44873901, "comment_id": 89717715, "body": "could you please explain the frase &quot; it is the same UTC time, just in different places on Earth&quot; UTC wasn&#39;t meant to be universal? <a href=\"https://www.youtube.com/watch?v=pOGL7oqZqEc\" rel=\"nofollow noreferrer\">youtube.com/watch?v=pOGL7oqZqEc</a>"}, {"owner": {"reputation": 2012, "user_id": 30767, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/zEqpG.jpg?s=128&g=1", "display_name": "Zunino", "link": "https://stackoverflow.com/users/30767/zunino"}, "edited": false, "score": 2, "creation_date": 1543349716, "post_id": 44873901, "comment_id": 93884691, "body": "A given moment or point in time is a unique instance which can be represented in various ways, according to the point of reference. E.g. some event taking place at noon time somewhere where the timezone is GMT-2 would be referred to or represented as 15 hours (3pm) by someone on GMT+1 timezone, as 17 hours (5pm) by someone on GMT+3 timezone and so on. So, different references to a single point in time. I hope this helps somewhat."}], "tags": [], "owner": {"reputation": 1054, "user_id": 6444852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78e304c11f81effb074bc80f7a5597e3?s=128&d=identicon&r=PG", "display_name": "Constantin S. Pan", "link": "https://stackoverflow.com/users/6444852/constantin-s-pan"}, "is_accepted": true, "score": 65, "last_activity_date": 1499019711, "creation_date": 1499019711, "answer_id": 44873901, "question_id": 44873825, "link": "https://stackoverflow.com/questions/44873825/how-to-get-timestamp-of-utc-time-with-golang/44873901#44873901", "title": "How to get Timestamp of UTC time with Golang?", "body": "<p><code>Unix()</code> always returns the number of seconds elapsed since January 1, 1970 UTC. So it does not matter whether you give it <code>time.Now()</code> or <code>time.Now().UTC()</code>, it is the same UTC time, just in different places on Earth. What you get as the result is correct.</p>\n"}], "owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47872, "favorite_count": 3, "accepted_answer_id": 44873901, "answer_count": 1, "score": 30, "last_activity_date": 1499019711, "creation_date": 1499019220, "question_id": 44873825, "link": "https://stackoverflow.com/questions/44873825/how-to-get-timestamp-of-utc-time-with-golang", "title": "How to get Timestamp of UTC time with Golang?", "body": "<p>I want to convert UTC time string to unix timestamp.\nI do this </p>\n\n<pre><code>fmt.Printf(\"%s %d\\n\", time.Now().String(), time.Now().Unix())\nfmt.Printf(\"%s %s\\n\", time.Now().UTC().String(), time.Now().UTC().Unix())\n</code></pre>\n\n<p>But I got same unix timestamp <code>1499018765</code></p>\n\n<blockquote>\n  <p>2017-07-02 20:06:05.5582802 +0200 CEST 1499018765 </p>\n  \n  <p>2017-07-02 18:06:05.791337 +0000 UTC 1499018765</p>\n</blockquote>\n"}, {"tags": ["go", "etcd3"], "answers": [{"tags": [], "owner": {"reputation": 146, "user_id": 1493661, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae03eb47606f4e0125268d39f8aebfad?s=128&d=identicon&r=PG", "display_name": "ymmt2005", "link": "https://stackoverflow.com/users/1493661/ymmt2005"}, "is_accepted": true, "score": 1, "last_activity_date": 1528870928, "last_edit_date": 1528870928, "creation_date": 1528869814, "answer_id": 50830039, "question_id": 44873514, "link": "https://stackoverflow.com/questions/44873514/etcd3-go-client-how-to-paginate-large-sets-of-keys/50830039#50830039", "title": "etcd3 Go Client - How to paginate large sets of keys?", "body": "<p>Looking at the following clientv3 code, the next key can be computed by appending <code>0x00</code> to the last key.</p>\n\n<p><a href=\"https://github.com/coreos/etcd/blob/88acced1cd7ad670001d1280b97de4fe7b647687/clientv3/op.go#L353\" rel=\"nofollow noreferrer\">https://github.com/coreos/etcd/blob/88acced1cd7ad670001d1280b97de4fe7b647687/clientv3/op.go#L353</a></p>\n\n<p>That said, I prefer ignoring the first key from the 2nd and following pages.</p>\n"}], "owner": {"reputation": 4929, "user_id": 1258009, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a5aea8e10a42f4d35aad5376df882b63?s=128&d=identicon&r=PG", "display_name": "Pyramid Newbie", "link": "https://stackoverflow.com/users/1258009/pyramid-newbie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 823, "favorite_count": 1, "accepted_answer_id": 50830039, "answer_count": 1, "score": 1, "last_activity_date": 1528870928, "creation_date": 1499017093, "question_id": 44873514, "link": "https://stackoverflow.com/questions/44873514/etcd3-go-client-how-to-paginate-large-sets-of-keys", "title": "etcd3 Go Client - How to paginate large sets of keys?", "body": "<p>It seems that pagination through a large set of keys involve using WithFromKey() and WithLimit() options to Get(). For example if I want to fetch 2 pages of 10 items I would do something like:</p>\n\n<pre><code>opts := []clientv3.OpOption {\n    clientv3.WithPrefix(),\n    clientv3.WithSort(clientv3.SortByKey, clientv3.SortAscend),\n    clientv3.WithLimit(10),\n}\n\ngr, err := kv.Get(ctx, \"key\", opts...)\nif err != nil {\n    log.Fatal(err)\n}\n\nfmt.Println(\"--- First page ---\")\nfor _, item := range gr.Kvs {\n    fmt.Println(string(item.Key), string(item.Key))\n}\n\nlastKey := string(gr.Kvs[len(gr.Kvs)-1].Value)\n\nfmt.Println(\"--- Second page ---\")\nopts = append(opts, clientv3.WithFromKey())\ngr, _ = kv.Get(ctx, lastKey, opts...)\n\n// Skipping the first item, which the last item from from the previous Get\nfor _, item := range gr.Kvs[1:] {\n    fmt.Println(string(item.Key), string(item.Value))\n}\n</code></pre>\n\n<p>The problem is that the last key is fetched agains as the first item of the second page, which I need to skip and only 9 new items.</p>\n\n<p>Is that the proper way to paginate or am I missing something? </p>\n"}, {"tags": ["winapi", "go"], "comments": [{"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499016376, "post_id": 44873287, "comment_id": 76725224, "body": "You&#39;ve better to use Window Class Name instead of Caption. Because you my open text editor with filename <code>Firefox.txt</code>. And you should implement API wrapper of MoveWIndow to move the windows. And  GetSystemMetrics to get screen size."}, {"owner": {"reputation": 746, "user_id": 787791, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/2013f8a42905f3da0f97622c09d47704?s=128&d=identicon&r=PG", "display_name": "grackkle", "link": "https://stackoverflow.com/users/787791/grackkle"}, "reply_to_user": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499018523, "post_id": 44873287, "comment_id": 76725804, "body": "the classname is definitely helpful. However, I still have two Atom handles (and only one window). Any idea how to get the screen sizes of the two?"}, {"owner": {"reputation": 10424, "user_id": 3408572, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f3a08b145553b98749d3d0572d01265?s=128&d=identicon&r=PG&f=1", "display_name": "andlabs", "link": "https://stackoverflow.com/users/3408572/andlabs"}, "edited": false, "score": 0, "creation_date": 1499034135, "post_id": 44873287, "comment_id": 76729819, "body": "The follow-up questions are extremely vague. There&#39;s a lot you can do with a window and a lot you can get out of it. You&#39;re better off sticking to what you want to know. Also note: when calling functions like <code>GetWindowTextW()</code>, you have to check MSDN to make sure the length you&#39;re passing is properly accounting for the terminating NUL character (integer value 0) that comes at the end of C strings but that <code>syscall.UTF16ToString()</code> strips. There are ways to get the precise length you need as well."}, {"owner": {"reputation": 10424, "user_id": 3408572, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f3a08b145553b98749d3d0572d01265?s=128&d=identicon&r=PG&f=1", "display_name": "andlabs", "link": "https://stackoverflow.com/users/3408572/andlabs"}, "edited": false, "score": 0, "creation_date": 1499034200, "post_id": 44873287, "comment_id": 76729832, "body": "And yes, this kind of thing will require understanding Windows closely. You should read somethng like Programming Windows: 5th Edition."}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499040618, "post_id": 44873287, "comment_id": 76730942, "body": "You can get screen size with like this: <a href=\"https://github.com/mattn/gopher/blob/ca807c5d98431662634aa7e060dce4c031b1eb2d/cmd/gopher/bitmap.go#L127-L129\" rel=\"nofollow noreferrer\">github.com/mattn/gopher/blob/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 746, "user_id": 787791, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/2013f8a42905f3da0f97622c09d47704?s=128&d=identicon&r=PG", "display_name": "grackkle", "link": "https://stackoverflow.com/users/787791/grackkle"}, "edited": false, "score": 0, "creation_date": 1499346613, "post_id": 44875736, "comment_id": 76874737, "body": "good solution although by now I found <a href=\"https://github.com/AllenDang/w32\" rel=\"nofollow noreferrer\">github.com/AllenDang/w32</a> which makes my life a lot easier in general"}], "tags": [], "owner": {"reputation": 10424, "user_id": 3408572, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f3a08b145553b98749d3d0572d01265?s=128&d=identicon&r=PG&f=1", "display_name": "andlabs", "link": "https://stackoverflow.com/users/3408572/andlabs"}, "is_accepted": true, "score": 1, "last_activity_date": 1499034806, "last_edit_date": 1499034806, "creation_date": 1499034440, "answer_id": 44875736, "question_id": 44873287, "link": "https://stackoverflow.com/questions/44873287/getting-window-geometry-in-go-for-windows/44875736#44875736", "title": "Getting window geometry in Go for Windows", "body": "<p><code>GetWindowRect()</code> writes the geometry to the <code>RECT</code> structure you pass the pointer to in. It operates exactly like the <code>GetWindowText()</code> call you already have; the difference is you have to provide the <code>RECT</code> structure yourself.</p>\n\n<p>You <em>should</em> be able to just get away with copying the structure verbatim. To substitute data types, use <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa383751(v=vs.85).aspx\" rel=\"nofollow noreferrer\">this page</a>. The definition for <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd162897(v=vs.85).aspx\" rel=\"nofollow noreferrer\"><code>RECT</code></a> says all the fields are <code>LONG</code>, which that page says is \"[a] 32-bit signed integer\". So this <em>should</em> suffice:</p>\n\n<pre><code>type RECT struct {\n    left   int32 // or Left, Top, etc. if this type is to be exported\n    top    int32\n    right  int32\n    bottom int32\n}\n</code></pre>\n\n<p>(Most likely irrelevant, but it's worth pointing out that <code>RECT</code> operates identically to <code>image.Rectangle</code>, with <code>left</code> and <code>top</code> being <code>Min</code> and <code>right</code> and <code>bottom</code> being <code>Max</code>. They are not identical because <code>image.Rectangle</code> uses <code>int</code>, so you may want to consider providing conversion functions if you want to use <code>image</code>'s geometry functions to manipulate rectangles instead of GDI's.)</p>\n"}], "owner": {"reputation": 746, "user_id": 787791, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/2013f8a42905f3da0f97622c09d47704?s=128&d=identicon&r=PG", "display_name": "grackkle", "link": "https://stackoverflow.com/users/787791/grackkle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 537, "favorite_count": 2, "accepted_answer_id": 44875736, "answer_count": 1, "score": 0, "last_activity_date": 1499034806, "creation_date": 1499015499, "question_id": 44873287, "link": "https://stackoverflow.com/questions/44873287/getting-window-geometry-in-go-for-windows", "title": "Getting window geometry in Go for Windows", "body": "<p>I want to create a tool with Go that lets me resize multiple windows on my screen. As an example lets assume that I want to find my Firefox window and my Atom (text editor) window and place them, so that they take up exactly half of my screen (FF left, Atom right).</p>\n\n<p>So far I realized, that I need to use the Windows API for that. I created a method that gives me all handles and the titles of all windows, but I'm struggling with geometry information. I understand that the api call <code>GetWindowRect</code> will help, but how can I get the information out of a pointer to a rect?</p>\n\n<p>Follow up question 1: what other information can I get about the windows?\nFollow up question 2: How do I resize the window so that it takes exactly half my screen size? I guess, I need another call to get the monitor dimensions.</p>\n\n<p>What I have so far is the code below. The main program finds all handles and displays those containing 'Atom' in the title. The windows package contains the code accessing the windows API.</p>\n\n<p>My current result is that I get 2 handles for atom (why not just 1?). I guess, I have to learn more about the Windows API, too. Are there good summaries to understand the basics?</p>\n\n<p><strong>main.go:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"resizer/windows\"\n    \"fmt\"\n    \"log\"\n    \"strings\"\n)\n\nfunc main() {\n    const title = \"Atom\"    \n    m := windows.GetAllWindows()\n    fmt.Printf(\"Map of windows: \\n\")\n    for handle := range m {\n        if strings.Contains(m[handle].Title(), title) {\n            fmt.Printf(\"'%v'\\n\", m[handle])\n        }\n    }\n}\n</code></pre>\n\n<p><strong>windows.go:</strong></p>\n\n<pre><code>package windows\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"syscall\"\n    \"unsafe\"\n)\n\nvar (\n    user32             = syscall.MustLoadDLL(\"user32.dll\")\n    procEnumWindows    = user32.MustFindProc(\"EnumWindows\")\n    procGetWindowTextW = user32.MustFindProc(\"GetWindowTextW\")\n)\n\n// Window represents any Window that is opened in the Windows OS\ntype Window struct {\n    handle syscall.Handle\n    title  string\n}\n\n// Title returns the title of the window\nfunc (w Window) Title() string {\n    return w.title\n}\n\n// GetAllWindows finds all currently opened windows\nfunc GetAllWindows() map[syscall.Handle]Window {\n    m := make(map[syscall.Handle]Window)\n    cb := syscall.NewCallback(func(h syscall.Handle, p uintptr) uintptr {\n        bytes := make([]uint16, 200)\n        _, err := GetWindowText(h, &amp;bytes[0], int32(len(bytes)))\n        title := \"||| no title found |||\"\n        if err == nil {\n            title = syscall.UTF16ToString(bytes)\n        }\n        m[h] = Window{h, title}\n        return 1 // continue enumeration\n    })\n    EnumWindows(cb, 0)\n    return m\n}\n\n// EnumWindows loops through all windows and calls a callback function on each\nfunc EnumWindows(enumFunc uintptr, lparam uintptr) (err error) {\n    r1, _, e1 := syscall.Syscall(procEnumWindows.Addr(), 2, uintptr(enumFunc), uintptr(lparam), 0)\n    if r1 == 0 {\n        if e1 != 0 {\n            err = error(e1)\n        } else {\n            err = syscall.EINVAL\n        }\n    }\n    return\n}\n\n// GetWindowText gets the title of a Window given by a certain handle\nfunc GetWindowText(hwnd syscall.Handle, str *uint16, maxCount int32) (len int32, err error) {\n    r0, _, e1 := syscall.Syscall(procGetWindowTextW.Addr(), 3, uintptr(hwnd), uintptr(unsafe.Pointer(str)), uintptr(maxCount))\n    len = int32(r0)\n    if len == 0 {\n        if e1 != 0 {\n            err = error(e1)\n        } else {\n            err = syscall.EINVAL\n        }\n    }\n    return\n}\n</code></pre>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1499085492, "post_id": 44872739, "comment_id": 76749550, "body": "A struct value is a struct value, not a pointer to a struct value; a pointer to a struct value is a pointer, not a pointer to a pointer. What in the Go documentation gives the impression that a normal struct value is a pointer?"}], "answers": [{"comments": [{"owner": {"reputation": 527, "user_id": 3591466, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/977d21dd4dde36df3ae73e9bef6ecf49?s=128&d=identicon&r=PG&f=1", "display_name": "user3591466", "link": "https://stackoverflow.com/users/3591466/user3591466"}, "edited": false, "score": 0, "creation_date": 1499012268, "post_id": 44872811, "comment_id": 76724107, "body": "But internally a variable containing struct is just a pointer to the struct right?"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 527, "user_id": 3591466, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/977d21dd4dde36df3ae73e9bef6ecf49?s=128&d=identicon&r=PG&f=1", "display_name": "user3591466", "link": "https://stackoverflow.com/users/3591466/user3591466"}, "edited": false, "score": 1, "creation_date": 1499012342, "post_id": 44872811, "comment_id": 76724121, "body": "As I said in above, passing struct make copy of value."}, {"owner": {"reputation": 527, "user_id": 3591466, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/977d21dd4dde36df3ae73e9bef6ecf49?s=128&d=identicon&r=PG&f=1", "display_name": "user3591466", "link": "https://stackoverflow.com/users/3591466/user3591466"}, "edited": false, "score": 0, "creation_date": 1499012449, "post_id": 44872811, "comment_id": 76724159, "body": "So it creates a new struct that has the same value with different address?"}], "tags": [], "owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "is_accepted": false, "score": 5, "last_activity_date": 1499012070, "creation_date": 1499012070, "answer_id": 44872811, "question_id": 44872739, "link": "https://stackoverflow.com/questions/44872739/what-is-the-difference-between-passing-a-struct-and-pointer-of-the-struct-are-t/44872811#44872811", "title": "What is the difference between passing a struct and pointer of the struct, are they not both pointers?", "body": "<p>Passing struct to function argument makes copy of values. And passing pointer of struct doesn't. So passing struct can't update field value.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Foo struct {\n    value int\n}\n\nfunc PassStruct(foo Foo) {\n    foo.value = 1\n}\n\nfunc PassStructPointer(foo *Foo) {\n    foo.value = 1\n}\n\nfunc main() {\n    var foo Foo\n\n    fmt.Printf(\"before PassStruct: %v\\n\", foo.value)\n    PassStruct(foo)\n    fmt.Printf(\"after PassStruct: %v\\n\", foo.value)\n\n    fmt.Printf(\"before PassStructPointer: %v\\n\", foo.value)\n    PassStructPointer(&amp;foo)\n    fmt.Printf(\"after PassStructPointer: %v\\n\", foo.value)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/AM__JwyaJa\" rel=\"noreferrer\">https://play.golang.org/p/AM__JwyaJa</a></p>\n"}, {"comments": [{"owner": {"reputation": 85, "user_id": 2612567, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/14f3aea7c67292857cf07553c6aadccd?s=128&d=identicon&r=PG", "display_name": "Sauraus", "link": "https://stackoverflow.com/users/2612567/sauraus"}, "edited": false, "score": 0, "creation_date": 1552957746, "post_id": 44873573, "comment_id": 97198610, "body": "Does this also hold true when the struct contains more complex data structures like a gocv.Mat (<a href=\"https://godoc.org/gocv.io/x/gocv#Mat\" rel=\"nofollow noreferrer\">godoc.org/gocv.io/x/gocv#Mat</a>)?"}, {"owner": {"reputation": 4661, "user_id": 1692706, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GyaAv.png?s=128&g=1", "display_name": "Debosmit Ray", "link": "https://stackoverflow.com/users/1692706/debosmit-ray"}, "reply_to_user": {"reputation": 85, "user_id": 2612567, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/14f3aea7c67292857cf07553c6aadccd?s=128&d=identicon&r=PG", "display_name": "Sauraus", "link": "https://stackoverflow.com/users/2612567/sauraus"}, "edited": false, "score": 0, "creation_date": 1580236746, "post_id": 44873573, "comment_id": 106029218, "body": "@Sauraus yes, depends on how you are storing references inside the complex type"}, {"owner": {"reputation": 131, "user_id": 5051764, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh6.googleusercontent.com/-vzIaLBTxfM4/AAAAAAAAAAI/AAAAAAAAABg/Nf5NBks1CW8/photo.jpg?sz=128", "display_name": "Farheen Nilofer", "link": "https://stackoverflow.com/users/5051764/farheen-nilofer"}, "reply_to_user": {"reputation": 90, "user_id": 1566364, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b6fdf6c98b253f827447c11d27ee539?s=128&d=identicon&r=PG", "display_name": "Nick Peirson", "link": "https://stackoverflow.com/users/1566364/nick-peirson"}, "edited": false, "score": 0, "creation_date": 1592987308, "post_id": 44873573, "comment_id": 110618529, "body": "@Nick    I have been passing a struct by value to a function. Intermittenlty I am loosing some part of the data( a key with very large string is lost). Can this be because of &quot;copy of the entire object is made and, if it is too big, memory becomes a concern.&quot;?"}, {"owner": {"reputation": 5455, "user_id": 703529, "user_type": "registered", "accept_rate": 74, "profile_image": "https://lh3.googleusercontent.com/-G-kFsAfpLpU/AAAAAAAAAAI/AAAAAAAAAJE/8uMPWwMFaD0/photo.jpg?sz=128", "display_name": "serkan", "link": "https://stackoverflow.com/users/703529/serkan"}, "edited": false, "score": 0, "creation_date": 1593699405, "post_id": 44873573, "comment_id": 110876614, "body": "&quot;There&#39;s only one way of passing arguments in Go and that is by value.&quot;  This statement is wrong and sadly used by many.  maps, slices and pointers are reference types."}], "tags": [], "owner": {"reputation": 985, "user_id": 1513091, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6c747a3ab3055cba5e470d31b1a547b?s=128&d=identicon&r=PG", "display_name": "bogdanciobanu", "link": "https://stackoverflow.com/users/1513091/bogdanciobanu"}, "is_accepted": true, "score": 63, "last_activity_date": 1593699432, "last_edit_date": 1593699432, "creation_date": 1499017515, "answer_id": 44873573, "question_id": 44872739, "link": "https://stackoverflow.com/questions/44872739/what-is-the-difference-between-passing-a-struct-and-pointer-of-the-struct-are-t/44873573#44873573", "title": "What is the difference between passing a struct and pointer of the struct, are they not both pointers?", "body": "<p>When you pass a pointer as an argument, what happens under the hood is that a copy of that pointer is created and passed to the underlying function. It should not be confused with pass-by-reference.</p>\n<p>Let's look at an example to better grasp it:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n)\n\ntype Point struct {\n    x int\n    y int\n}\n\nfunc (p Point) String() string {\n    return fmt.Sprintf(&quot;(%d, %d)&quot;, p.x, p.y)\n}\n\nfunc modifyValue(point Point) {\n    point.x += 10\n}\n\nfunc modifyPointer(point *Point) {\n    point.x = 5\n    point.y = 5\n}\n\nfunc modifyReference(point *Point) {\n    point = &amp;Point{5, 5}\n}\n\nfunc main() {\n    p := Point{0, 0}\n    fmt.Println(p) // prints (0, 0)\n    \n    modifyValue(p)\n    fmt.Println(p) // prints (0, 0)\n    \n    modifyPointer(&amp;p)\n    fmt.Println(p) // prints (5, 5)\n    \n    p = Point{0, 0}\n    modifyReference(&amp;p)\n    fmt.Println(p) // prints (0, 0)\n}\n</code></pre>\n<p>What happens inside the <strong>modifyValue</strong> function is that a totally different instance of a Point structure is modified, so the value passed when calling the function is unaffected.</p>\n<p>In the second example, a pointer to the structure is passed so the fields of the structure can be modified in a way that is visible from outside.</p>\n<p>The most interesting point is made by the last function, <strong>modifyReference</strong>. If you are familiar with the pass by reference paradigm available in other languages you would expect to be able to modify the referenced object altogether, but this doesn't happen. It's because you're modifying a <strong>copy</strong> of the pointer passed as argument.</p>\n<p>You may wonder, if everything is passed by value, when should you pass pointers and when values. Passing values assures the caller function that the passed structure cannot suffer any changes, so when you need this behaviour, go for the value. The downside of this is that a copy of the entire object is made and, if it is too big, memory becomes a concern.</p>\n<p>If you're passing a big structure as an argument, using a pointer is better because it saves space, but you lose the guarantee that the object won't suffer any changes.</p>\n"}], "owner": {"reputation": 527, "user_id": 3591466, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/977d21dd4dde36df3ae73e9bef6ecf49?s=128&d=identicon&r=PG&f=1", "display_name": "user3591466", "link": "https://stackoverflow.com/users/3591466/user3591466"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16097, "favorite_count": 9, "accepted_answer_id": 44873573, "answer_count": 2, "score": 18, "last_activity_date": 1593699432, "creation_date": 1499011567, "question_id": 44872739, "link": "https://stackoverflow.com/questions/44872739/what-is-the-difference-between-passing-a-struct-and-pointer-of-the-struct-are-t", "title": "What is the difference between passing a struct and pointer of the struct, are they not both pointers?", "body": "<p>For example</p>\n\n<pre><code>var myStructRef *Vertex\nvar myStruct Vertex\nmyStructRef = &amp;Vertex{2, 3}\nmyStruct = Vertex{2, 3}\n\nfmt.Println(myStructRef)\nfmt.Println(myStruct)\nchangeByReferenceStruct(myStructRef)\nchangeByValueStruct(myStruct)\nfmt.Println(myStructRef)\nfmt.Println(myStruct)\n</code></pre>\n\n<p>And </p>\n\n<pre><code>func changeByValueStruct(myStruct Vertex) {\n    myStruct.X = 5\n    fmt.Println(myStruct)\n}\n\n\nfunc changeByReferenceStruct(myStruct *Vertex) {\n    myStruct.X = 7\n    fmt.Println(myStruct)\n}\n</code></pre>\n\n<p>Isn't both <code>myStructRef *Vertex</code> and <code>myStruct Vertex</code> a pointer pointing to the struct itself? Why is there a discrepancy in behavior when I modify the struct in a function?</p>\n\n<p>Is golang creating a new struct in <code>changeByValueStruct</code> when it resolves the parameter?</p>\n"}, {"tags": ["go", "gonum"], "comments": [{"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499011350, "post_id": 44872665, "comment_id": 76723875, "body": "What interface of plotutil.AddLinePoints? variadic function? then pass like <code>plotutil.AddLinePoints(p,         &quot;Test&quot;, getPoints(processes[1])...)</code>"}, {"owner": {"reputation": 3, "user_id": 8244734, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/024260f26a0dd1424dac27411740a3a9?s=128&d=identicon&r=PG&f=1", "display_name": "user8244734", "link": "https://stackoverflow.com/users/8244734/user8244734"}, "reply_to_user": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499012637, "post_id": 44872665, "comment_id": 76724214, "body": "Variadic. I could remove the titles as I technically don&#39;t need them."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 8244734, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/024260f26a0dd1424dac27411740a3a9?s=128&d=identicon&r=PG&f=1", "display_name": "user8244734", "link": "https://stackoverflow.com/users/8244734/user8244734"}, "edited": false, "score": 0, "creation_date": 1499014673, "post_id": 44872993, "comment_id": 76724771, "body": "This did exactly what I was looking to do."}], "tags": [], "owner": {"reputation": 636, "user_id": 1695784, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb781a195c97a5945823cb3fc0f408b8?s=128&d=identicon&r=PG", "display_name": "Brendan Tracey", "link": "https://stackoverflow.com/users/1695784/brendan-tracey"}, "is_accepted": true, "score": 0, "last_activity_date": 1499013399, "creation_date": 1499013399, "answer_id": 44872993, "question_id": 44872665, "link": "https://stackoverflow.com/questions/44872665/gonum-plot-loop-through-slice/44872993#44872993", "title": "Gonum Plot Loop Through Slice", "body": "<p>I think you want to first extract your data into a <code>[]interface{}</code>, and then call into AddLinePoints. Roughly (I didn't test):</p>\n\n<pre><code>lines := make([]interface{},0)\nfor i, v := range processes { \n    lines = append(lines, \"Title\" + strconv.Itoa(i))\n    lines = append(lines, getPoints(v))\n}\nplotutil.AddLinePoints(p, lines...)\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 8244734, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/024260f26a0dd1424dac27411740a3a9?s=128&d=identicon&r=PG&f=1", "display_name": "user8244734", "link": "https://stackoverflow.com/users/8244734/user8244734"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 44872993, "answer_count": 1, "score": 0, "last_activity_date": 1503982238, "creation_date": 1499010998, "last_edit_date": 1503982238, "question_id": 44872665, "link": "https://stackoverflow.com/questions/44872665/gonum-plot-loop-through-slice", "title": "Gonum Plot Loop Through Slice", "body": "<p>I'm trying to add multiple plots by using a loop, but I can't seem to figure out how to put the lines in. Here is the code I'm working on:</p>\n\n<pre><code>func plot_stochastic_processes(processes [][]float64, title string) {\n    p, err := plot.New()\n    if err != nil {\n        panic(err)\n    }\n\n    p.Title.Text = title\n    p.X.Label.Text = \"X\"\n    p.Y.Label.Text = \"Y\"\n\n    err = plotutil.AddLinePoints(p,\n        \"Test\", getPoints(processes[1]),\n        //Need to figure out how to loop through processes\n    )\n    if err != nil {\n        panic(err)\n    }\n\n    // Save the plot to a PNG file.\n    if err := p.Save(4*vg.Inch, 4*vg.Inch, \"points.png\"); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>My getPoints function looks like this:</p>\n\n<pre><code>func getPoints(line []float64) plotter.XYs {\n    pts := make(plotter.XYs, len(line))\n    for j, k := range line {\n        pts[j].X = float64(j)\n        pts[j].Y = k\n    }\n    return pts\n}\n</code></pre>\n\n<p>I get an error when trying to put a loop where the commented section is. I know this should be fairly straightforward. Perhaps a loop prior to this to get the list of lines?</p>\n\n<p>Something like</p>\n\n<pre><code>for i, process := range processes {\n    return \"title\", getPoints(process),\n}\n</code></pre>\n\n<p>Obviously I know that isn't correct, but not I'm not sure how to go about it.</p>\n"}, {"tags": ["go", "websocket", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1499015264, "post_id": 44872832, "comment_id": 76724930, "body": "Unix time is seconds since Jan 01 1970 (UTC).  I am asking you to check that the clock on your system is set to within 20 seconds of the correct time."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1499020955, "post_id": 44872832, "comment_id": 76726450, "body": "The error message is telling you that the timestamp is more than 20 seconds away from the current time.  Your system time must be set correctly to the second."}, {"owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1499022681, "post_id": 44872832, "comment_id": 76727001, "body": "You are right ! I update my system time, It&#39;s OK. Thank&#39;s for your help."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1499020861, "last_edit_date": 1499020861, "creation_date": 1499012190, "answer_id": 44872832, "question_id": 44872595, "link": "https://stackoverflow.com/questions/44872595/golang-gorilla-cex-io-websocket-authentication-error/44872832#44872832", "title": "Golang Gorilla CEX.IO Websocket authentication error", "body": "<p>The error message is telling you that the timestamp is more than 20 seconds away from the current time.</p>\n\n<p>The API expects time in seconds, not nanoseconds.  Use <a href=\"http://godoc.org/time#Time.Unix\" rel=\"nofollow noreferrer\">Unix</a> to get the time in seconds.</p>\n\n<pre><code>     nonce := time.Now().Unix()\n</code></pre>\n\n<p>Unix time is is seconds since Jan 01 1970 UTC.</p>\n\n<p>If this fails, then check that your system time is set correctly down to the second.</p>\n"}], "owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 0, "accepted_answer_id": 44872832, "answer_count": 1, "score": 0, "last_activity_date": 1499020861, "creation_date": 1499010475, "last_edit_date": 1499014366, "question_id": 44872595, "link": "https://stackoverflow.com/questions/44872595/golang-gorilla-cex-io-websocket-authentication-error", "title": "Golang Gorilla CEX.IO Websocket authentication error", "body": "<p>I'm currently trying to connect to the CEX.IO bitcoin exchange's websocket.\nWebsocket connection is OK but at the time of authentication, I have the error: <code>Timestamp is not in 20sec range</code>. I don't know what this error.</p>\n\n<p>Test case 1 &amp; 2 for createSignature is OK (<a href=\"https://cex.io/websocket-api#authentication\" rel=\"nofollow noreferrer\">https://cex.io/websocket-api#authentication</a>). </p>\n\n<p>Authentication Go code :</p>\n\n<pre><code>func toHmac256(message string, secret string) string {\n    key := []byte(secret)\n    h := hmac.New(sha256.New, key)\n    h.Write([]byte(message))\n    return strings.ToUpper(hex.EncodeToString(h.Sum(nil)))\n}\n\nfunc Signature() (string, string) {\n    nonce := time.Now().Unix()  // Edit with Cerise Lim\u00f3n answer\n    message := strconv.FormatInt(nonce, 10) + \"API-KEY\"\n    signature := api.toHmac256(message, \"SECRET-KEY\")\n    return signature, nonce\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499011570, "post_id": 44872645, "comment_id": 76723926, "body": "It should make a request to studentpercentagejson.com/Roll1,Roll2,Roll3 (all RollNo. that we got in step1), how can we achieve this?"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499011822, "post_id": 44872645, "comment_id": 76723995, "body": "I don&#39;t know how the server works. If the server accept multiple parameters which can pass all of RollNo(s), just add request parameters. If not, you should make loop to get response, and append to the list."}, {"owner": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499012023, "post_id": 44872645, "comment_id": 76724046, "body": "the server can accept multiple rollno,(upto 200) separated by &quot;,&quot;  so we can use the roll no. we got in step#1 and can extract the percentage in a csv"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499012459, "post_id": 44872645, "comment_id": 76724163, "body": "Sorry, I&#39;m confusing where to go next step. What is you problem?"}, {"owner": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499012635, "post_id": 44872645, "comment_id": 76724213, "body": "I am unable to find a way on how to seperate Rollno. we got in step#1 (key.rollno) with &quot;,&quot; and use it as studentpercentagejson.com/Roll1,Roll2,Roll3,..."}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499012924, "post_id": 44872645, "comment_id": 76724304, "body": "Do you mean how to make request URI from objects? <a href=\"https://play.golang.org/p/LFl9q4MQpS\" rel=\"nofollow noreferrer\">play.golang.org/p/LFl9q4MQpS</a>"}, {"owner": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499013206, "post_id": 44872645, "comment_id": 76724374, "body": "In the code  i have records := [][]string{{key.fname, key.marks, key.rollno}}, which stores key.fname, key.marks, key.rollno . Now,for step#2 we need key.rollno and use that in studentpercentagejson.com/Roll1,Roll2,Roll3 ..."}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499013324, "post_id": 44872645, "comment_id": 76724409, "body": "then, I guess it should be <code>for _, v := range arr { rollnos = append(rollnos, v[2]) }</code>"}, {"owner": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499013525, "post_id": 44872645, "comment_id": 76724464, "body": "I think you are confusing, i have edited the question, please check &quot;This is what I am doing&quot; and then read the codes"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499013974, "post_id": 44872645, "comment_id": 76724567, "body": "What do you mean <code>print</code>? write to http response? or print into stdout?"}, {"owner": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499014268, "post_id": 44872645, "comment_id": 76724655, "body": "if you mean &quot; fmt.Fprintf(w, key.fname, key.marks, key.rollno) &quot; then its writing to http response,its working perfectly, and key.rollno has the values we need in step#2"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499014759, "post_id": 44872645, "comment_id": 76724794, "body": "In my code above, you can see <code>s.Allmarks[N].RollNo</code> is that."}, {"owner": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499015084, "post_id": 44872645, "comment_id": 76724889, "body": "why we need <code>s.Allmarks[N].RollNo</code> ? we need to use the values for  <code>key.rollno</code> in my code in the request <code>studentpercentagejson.com&#47;Roll1,Roll2,Roll3</code>"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499015295, "post_id": 44872645, "comment_id": 76724938, "body": "If you have already <code>[][]string{{key.fname, key.marks, key.rollno}}</code> , should be v[N][2] see <a href=\"https://stackoverflow.com/questions/44872060/save-json-data-using-go-language/44872645?noredirect=1#comment76724409_44872645\">my comment</a> above."}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499015746, "post_id": 44872645, "comment_id": 76725056, "body": "I can&#39;t do correctly. because I still not understand what you want to do."}, {"owner": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499020670, "post_id": 44872645, "comment_id": 76726375, "body": "ok,now step#3 Extract Name &amp; Percentage fields from JSON response &amp; save in a csv"}, {"owner": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499071967, "post_id": 44872645, "comment_id": 76740807, "body": "In step#3 how can we extract name and percentage field from JSON response and save in csv?"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499072544, "post_id": 44872645, "comment_id": 76741191, "body": "Sorry, I don&#39;t understand what you want. I guess that you can do it in your-self. There are enough code to do, I think."}, {"owner": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "edited": false, "score": 0, "creation_date": 1499072869, "post_id": 44872645, "comment_id": 76741396, "body": "yup,everything is working perfectly,after decoding the JSON body we need to extract the &quot;percentage&quot; and save it in a csv,the example JSON response is in my question"}], "tags": [], "owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "is_accepted": false, "score": 0, "last_activity_date": 1499040309, "last_edit_date": 1499040309, "creation_date": 1499010857, "answer_id": 44872645, "question_id": 44872060, "link": "https://stackoverflow.com/questions/44872060/save-json-data-using-go-language/44872645#44872645", "title": "Save Json Data Using Go language", "body": "<p>I don't understand what you're doing using server APIs. But I answer how to decode JSON from http response.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n)\n\ntype object []struct {\n}\n\ntype ObjectsAPIResponse struct {\n    Allmarks []object\n}\n\nfunc main() {\n    res, err := http.Get(\"https://studentpercentagejson.com/key.rollno\")\n    if err != nil {\n        panic(err.Error())\n    }\n    defer res.Body.Close()\n\n    var s ObjectsAPIResponse\n    err = json.NewDecoder(res.Body).Decode(&amp;s)\n    if err != nil {\n        fmt.Println(\"whoops:\", err)\n    }\n    fmt.Println(s.Allmarks)\n}\n</code></pre>\n\n<h2>Collect RollNo(s)</h2>\n\n<pre><code>var rollNos []string\nfor i := 0; i &lt; length; i++ {\n    key := UID[i]\n\n    fmt.Fprintf(w, key.fname, key.marks, key.rollno) \n\n    records := [][]string{{key.fname, key.marks, key.rollno}}\n\n    rollNos = append(rollNos, key.rollno)\n\n    for _, record := range records {\n        err := writer.Write(record)\n        if err != nil {\n            fmt.Println(\"Error:\", err)\n            return\n        }\n    }\n}\nuri := \"http://studentpercentagejson.com/\" + strings.Join(rollNos, \",\")\nres, err := http.Get(uri)\nif err != nil {\n    log.Fatal(err)\n}\ndefer res.Body.Close()\n\nvar s ObjectsAPIResponse\nerr = json.NewDecoder(res.Body).Decode(&amp;s)\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Println(s.Allmarks[0].Name)\nfmt.Println(s.Allmarks[0].Percentage)\nfmt.Println(s.Allmarks[0].RollNo)\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 6649089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00feea639ca8ba7e0c4b20f23c6f7a03?s=128&d=identicon&r=PG&f=1", "display_name": "Nancy", "link": "https://stackoverflow.com/users/6649089/nancy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1499040309, "creation_date": 1499006993, "last_edit_date": 1499013142, "question_id": 44872060, "link": "https://stackoverflow.com/questions/44872060/save-json-data-using-go-language", "title": "Save Json Data Using Go language", "body": "<p>I am trying to Parse Json &amp; save Student Pecentage to a csv file using GO language .</p>\n\n<p>With below code i am able to print and save Rollno. and marks in a csv successfully .</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc PageRequest(w http.ResponseWriter, r *http.Request) {\n    // Default page number is 1\n    if len(r.URL.Path) &lt;= 1 {\n        r.URL.Path = \"/1\"\n    }\n\n    // Page number is not negative or 0\n    page.Abs(page)\n    if page.Cmp(one) == -1 {\n        page.SetInt64(1)\n    }\n\n    // Page header\n    fmt.Fprintf(w, PageHeader, pages, previous, next)\n\n    // Save in csv\n    csvfile, err := os.OpenFile(\"marks.csv\", os.O_WRONLY|os.O_CREATE|os.O_APPEND, 0666)\n    if err != nil {\n        fmt.Println(\"Error:\", err)\n        return\n    }\n    defer csvfile.Close()\n\n    writer := csv.NewWriter(csvfile)\n    defer writer.Flush()\n\n    // Marks for UID\n    UID, length := compute(start)\n    for i := 0; i &lt; length; i++ {\n        key := UID[i]\n\n        fmt.Fprintf(w, key.fname, key.marks, key.rollno) \n\n\n\n        records := [][]string{{key.fname, key.marks, key.rollno}}\n\n        for _, record := range records {\n            err := writer.Write(record)\n            if err != nil {\n                fmt.Println(\"Error:\", err)\n                return\n            }\n        }\n\n\n    }\n\n    // Page Footer\n    fmt.Fprintf(w, PageFooter, previous, next)\n}\n</code></pre>\n\n<p>This is what I am doing</p>\n\n<ol>\n<li><p>Visitor visits studentmarks.com/page=1 RollNo. &amp; Marks for 10 students are displayed and it is also saved in a CSV [Working Perfectly with above code]</p></li>\n<li><p>It Makes a request to studentpercentagejson.com/Roll1,Roll2,Roll3 (all RollNo. that we got in step1)\nThe Json response would be like</p>\n\n<pre><code>[{\"name\":\"James\",\"Percentage\":96.5,\"RollNo\":101}, \n{\"name\":\"William\",\"Percentage\":36.0,\"RollNo\":102}, \n{\"name\":\"Jacob\",\"Percentage\":63.0,\"RollNo\":103}, \n{\"name\":\"Wilson\",\"Percentage\":69.3,\"RollNo\":104}, \n{\"name\":\"Kurtson\",\"Percentage\":16.9,\"RollNo\":105}, \n{\"name\":\"Tom\",\"Percentage\":86.3,\"RollNo\":106}]\n</code></pre></li>\n<li><p>Extract Name &amp; Percentage fields &amp; save in a csv .</p></li>\n</ol>\n\n<p>progress so far -</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n)\n\ntype object []struct {\n    Name       string  `json:\"name\"`\n    Percentage float64 `json:\"Percentage\"`\n    RollNo     int     `json:\"RollNo\"`\n}\n\nfunc main() {\nhttp.HandleFunc(\"/\", PageRequest)\n    res, err := http.Get(\"https://studentpercentagejson.com/key.rollno\")\n    if err != nil {\n        panic(err.Error())\n    }\n    defer res.Body.Close()\n\n\n    err = json.NewDecoder(res.Body).Decode(&amp;s)\n    if err != nil {\n        fmt.Println(\"whoops:\", err)\n    }\nlog.Println(\"Listening\")\nlog.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>How can I print and save Percentage extracted from the JSON Response using go language?</p>\n"}, {"tags": ["json", "go", "struct", "interface", "unmarshalling"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1499008746, "post_id": 44871357, "comment_id": 76723129, "body": "<code>Polygon</code> is an interface, you can&#39;t pass <code>interface</code> to unmarshaler. You must pass <i>a concrete</i> type. <i>Quick</i> solution is unmarshal it to <code>[]map[string]interface{}</code>,  but then you need to <i>convert</i> it to struct manually. If you&#39;re allowed to change the data structure, use <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\"><code>json.RawMessage</code> to delay parsing part of your JSON</a>"}], "answers": [{"comments": [{"owner": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "edited": false, "score": 0, "creation_date": 1499006878, "post_id": 44871903, "comment_id": 76722524, "body": "I wanted to avoid a solution in this form since it could be less efficient to have a struct that can hold all possible values. Also, it just doesn&#39;t look as pretty (in my opinion). It should work though, since polygons don&#39;t have so many different kinds of values it&#39;s not so bad."}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "edited": false, "score": 0, "creation_date": 1499008463, "post_id": 44871903, "comment_id": 76723029, "body": "added another approach."}, {"owner": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "edited": false, "score": 0, "creation_date": 1499013522, "post_id": 44871903, "comment_id": 76724462, "body": "Depending on rectangles having radius = 0 and such conditions still doesn&#39;t sound very appealing to me. At that point, I&#39;d find it easier to specify the type of the struct that is being defined and parse the map manually."}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "edited": false, "score": 0, "creation_date": 1499013810, "post_id": 44871903, "comment_id": 76724532, "body": "second approach doesn&#39;t look <code>radius = 0</code>. so I guess you want the second."}, {"owner": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "edited": false, "score": 0, "creation_date": 1499014339, "post_id": 44871903, "comment_id": 76724673, "body": "Checking whether the value is there at all is pretty much the same. In this example it could be fine, but in general some &quot;polygons&quot; (as in, the general type) could share elements from others. Adding new ones would change the whole convert functions, making them harder to maintain."}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "edited": false, "score": 0, "creation_date": 1499014878, "post_id": 44871903, "comment_id": 76724827, "body": "That is unreasonable thing. Because your JSON does not have type information or kind of struct."}, {"owner": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "reply_to_user": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1499016450, "post_id": 44871903, "comment_id": 76725245, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/148177/discussion-between-mjgalindo-and-mattn\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "is_accepted": true, "score": 1, "last_activity_date": 1499008449, "last_edit_date": 1499008449, "creation_date": 1499006023, "answer_id": 44871903, "question_id": 44871357, "link": "https://stackoverflow.com/questions/44871357/golang-unmarshal-slice-of-type-interface/44871903#44871903", "title": "Golang Unmarshal slice of type interface", "body": "<p>Thought that way to distinguish whether the json is Circle or Rectangle. In your JSON, there is no identify for the struct which can detect kind of objects. So let's make rules.</p>\n\n<ul>\n<li>Rectangle have base and height both greater than 0</li>\n<li>Circle have radius greater than 0</li>\n</ul>\n\n<p>To unmarshal JSON, it should have commonly fields like below.</p>\n\n<pre><code>type Object struct {\n    Base   float32 `json:\"base,omitempty\"`\n    Radius float32 `json:\"radius,omitempty\"`\n    Height float32 `json:\"height,omitempty\"`\n    X      float32 `json:\"x\"`\n    Y      float32 `json:\"y\"`\n}\n</code></pre>\n\n<p>This struct can be stored Rectangle or Circle both. Then, add method IsCircle and IsRectangle.</p>\n\n<pre><code>func (obj *Object) IsCircle() bool {\n    return obj.Radius &gt; 0\n}\n\nfunc (obj *Object) IsRectangle() bool {\n    return obj.Base &gt; 0 &amp;&amp; obj.Height &gt; 0\n}\n</code></pre>\n\n<p>You can make method like Kind() to return identity of struct instead. As you think best. Finally, you should add ToCircle/ToRectangle methods.</p>\n\n<pre><code>func (obj *Object) ToCircle() *Circle {\n    return &amp;Circle{\n        Radius: obj.Radius,\n        X:      obj.X,\n        Y:      obj.Y,\n    }\n}\n\nfunc (obj *Object) ToRectangle() *Rectangle {\n    return &amp;Rectangle{\n        Base:   obj.Base,\n        Height: obj.Height,\n        X:      obj.X,\n        Y:      obj.Y,\n    }\n}\n</code></pre>\n\n<p>If you want slice of Polygon interface, you should convert this slice of Object to the slice of Polygon like below.</p>\n\n<pre><code>var polygons []Polygon\nfor _, obj := range newSlice {\n    if obj.IsCircle() {\n        polygons = append(polygons, obj.ToCircle())\n    } else if obj.IsRectangle() {\n        polygons = append(polygons, obj.ToRectangle())\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/kO_F4GTYdA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/kO_F4GTYdA</a></p>\n\n<h2>UPDATE</h2>\n\n<p>One another approach. Make converters which convert from map[string]interface{}. The converter can detect the struct with looking fields exists.</p>\n\n<pre><code>var converters = []func(map[string]interface{}) Polygon{\n    func(m map[string]interface{}) Polygon {\n        rectangle := new(Rectangle)\n        if base, ok := m[\"base\"]; ok {\n            rectangle.Base = toFloat32(base)\n        } else {\n            return nil\n        }\n        if height, ok := m[\"height\"]; ok {\n            rectangle.Height = toFloat32(height)\n        } else {\n            return nil\n        }\n        if x, ok := m[\"x\"]; ok {\n            rectangle.X = toFloat32(x)\n        }\n        if y, ok := m[\"y\"]; ok {\n            rectangle.Y = toFloat32(y)\n        }\n        return rectangle\n    },\n    func(m map[string]interface{}) Polygon {\n        circle := new(Circle)\n        if radius, ok := m[\"radius\"]; ok {\n            circle.Radius = toFloat32(radius)\n        } else {\n            return nil\n        }\n        if x, ok := m[\"x\"]; ok {\n            circle.X = toFloat32(x)\n        }\n        if y, ok := m[\"y\"]; ok {\n            circle.Y = toFloat32(y)\n        }\n        return circle\n    },\n}\n</code></pre>\n\n<p>And do convert</p>\n\n<pre><code>var polygons []Polygon\nfor _, obj := range newSlice {\n    m, ok := obj.(map[string]interface{})\n    if !ok {\n        panic(\"invalid struct\")\n    }\n    var p Polygon\n    for _, converter := range converters {\n        p = converter(m)\n        if p != nil {\n            break\n        }\n    }\n    if p == nil {\n        panic(\"unknown polygon\")\n    }\n    polygons = append(polygons, p)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/PrxiMOa_1F\" rel=\"nofollow noreferrer\">https://play.golang.org/p/PrxiMOa_1F</a></p>\n"}], "owner": {"reputation": 818, "user_id": 4287267, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/MxZkq.png?s=128&g=1", "display_name": "mjgalindo", "link": "https://stackoverflow.com/users/4287267/mjgalindo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1931, "favorite_count": 0, "accepted_answer_id": 44871903, "answer_count": 1, "score": 2, "last_activity_date": 1499008449, "creation_date": 1499002394, "question_id": 44871357, "link": "https://stackoverflow.com/questions/44871357/golang-unmarshal-slice-of-type-interface", "title": "Golang Unmarshal slice of type interface", "body": "<p>In this example, I would be trying to load 2D scenes that contain polygons. In the code, I would have many different structs such as Circle, Square, Rectangle, Pentagon, etc.. \nAll would share common <em>funcs</em>, such as Area and Perimeter. \nThe scene itself would be stored as a slice of the interface Polygon.</p>\n\n<p>Here is the code I'm using to test this:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"math\"\n)\n\ntype Polygon interface {\n    Area() float32\n}\n\ntype Rectangle struct {\n    Base   float32 `json:\"base\"`\n    Height float32 `json:\"height\"`\n    X      float32 `json:\"x\"`\n    Y      float32 `json:\"y\"`\n}\n\nfunc (r *Rectangle) Area() float32 {\n    return r.Base * r.Height\n}\n\ntype Circle struct {\n    Radius float32 `json:\"radius\"`\n    X      float32 `json:\"x\"`\n    Y      float32 `json:\"y\"`\n}\n\nfunc (c *Circle) Area() float32 {\n    return c.Radius * c.Radius * math.Pi\n}\n\nfunc main() {\n    rect := Rectangle{Base: 10, Height: 10, X: 10, Y: 10}\n    circ := Circle{Radius: 10, X: 0, Y: 0}\n\n    sliceOfPolygons := make([]Polygon, 0, 2)\n\n    sliceOfPolygons = append(sliceOfPolygons, &amp;rect, &amp;circ)\n\n    jsonData, err := json.Marshal(sliceOfPolygons)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(string(jsonData))\n\n    newSlice := make([]Polygon, 0)\n\n    err = json.Unmarshal(jsonData, &amp;newSlice)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>In this example, I setup a slice of 2 polygons, marshal it and then try to unmarshal it again. \nThe marshal-ed string is:</p>\n\n<pre><code>[{\"base\":10,\"height\":10,\"x\":10,\"y\":10},{\"radius\":10,\"x\":0,\"y\":0}]\n</code></pre>\n\n<p>But when I try to <code>Unmarshal</code> it panics:</p>\n\n<pre><code>panic: json: cannot unmarshal object into Go value of type main.Polygon\n</code></pre>\n\n<p>If this worked it would be really useful and simple to use. I'd say that <code>Unmarshall</code> can't distinguish between a <code>Rectangle</code> and a <code>Circle</code> from the json string so it can't possibly know what struct to build. </p>\n\n<p>Is there any way to tag the struct or tell <code>Unmarshal</code> how to distinguish this structs?</p>\n"}, {"tags": ["oop", "go"], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 2767079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31b04c8a2143f5372e582f589cee17df?s=128&d=identicon&r=PG&f=1", "display_name": "tcsullens", "link": "https://stackoverflow.com/users/2767079/tcsullens"}, "is_accepted": false, "score": 1, "last_activity_date": 1499006110, "creation_date": 1499006110, "answer_id": 44871916, "question_id": 44870902, "link": "https://stackoverflow.com/questions/44870902/golang-tree-structure-abstraction/44871916#44871916", "title": "golang - tree structure abstraction", "body": "<p>Your <code>CreateNode()</code> function operates on a type of <code>node</code>, which does not have a <code>Description</code> field.\nChanging the signature to:\n<code>\nfunc (t *nodeExtension) CreateNode()\n</code>\nwill operate how you want it to in this scenario: it will print out the entire <code>nodeExtension</code> struct:\n<a href=\"https://play.golang.org/p/nLxblNySB9\" rel=\"nofollow noreferrer\">https://play.golang.org/p/nLxblNySB9</a></p>\n\n<p>I'm not entirely sure what you're trying to accomplish here, but maybe having an interface of type <code>node</code> and which implements a <code>String()</code> method and then have like a <code>simpleNode</code> and <code>extendedNode</code> would be something you could look at?</p>\n"}], "owner": {"reputation": 21, "user_id": 3055541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4add86c4c07981a9466a6c5e4a0eeca?s=128&d=identicon&r=PG", "display_name": "chizik", "link": "https://stackoverflow.com/users/3055541/chizik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 479, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1499006110, "creation_date": 1498999072, "question_id": 44870902, "link": "https://stackoverflow.com/questions/44870902/golang-tree-structure-abstraction", "title": "golang - tree structure abstraction", "body": "<p>i'm trying to code a tree structure where each node should have an id and parent ref/id params. </p>\n\n<p>by extending a node struct you should be able to add some custom parameters (like title, icon, color...). it should be inlined and inserted with mgo later on...</p>\n\n<p>you can find the code below or here: <a href=\"https://play.golang.org/p/bbvs2iM3ri\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bbvs2iM3ri</a></p>\n\n<p>i'm trying to avoid adding methods to the nodeExtension struct and sharing it through the node struct. but, the CreateNode method is getting only the node data and not the wrapping struct.</p>\n\n<p>any ideas how to implement this algorithm without loosing the custom parameters (Description in this case)?</p>\n\n<p>thanks</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype item struct {\n    ID string\n}\n\ntype node struct {\n    item   `bson:,inline`\n    Parent string\n}\n\nfunc (t *node) CreateNode() {\n    fmt.Printf(\"Node: %+v\\n\", t)\n}\n\ntype nodeExtension struct {\n    node        `bson:,inline`\n    Description string\n}\n\nfunc main() {\n    i := &amp;nodeExtension{\n        node: node{\n            item: item{\n                ID: \"1\",\n            },\n            Parent: \"\",\n        },\n        Description: \"Root node\",\n    }\n    i.CreateNode()\n\n    i = &amp;nodeExtension{\n        node: node{\n            item: item{\n                ID: \"2\",\n            },\n            Parent: \"1\",\n        },\n        Description: \"Another node\",\n    }\n    i.CreateNode()\n}\n\n\n// output:\n// Node: &amp;{item:{ID:1} Parent:}\n// Node: &amp;{item:{ID:2} Parent:1}\n\n// both without description :/\n</code></pre>\n"}, {"tags": ["mysql", "sql", "database", "go", "query-notifications"], "owner": {"reputation": 1271, "user_id": 2295672, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4ab40e6b657e0bc91bf4961450f96420?s=128&d=identicon&r=PG", "display_name": "Avi", "link": "https://stackoverflow.com/users/2295672/avi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1498993101, "creation_date": 1498993101, "question_id": 44870067, "link": "https://stackoverflow.com/questions/44870067/listening-for-dml-queries-on-a-mysql-database-in-golang", "title": "Listening for DML queries on a MySQL database in Golang", "body": "<p>I am using <a href=\"https://github.com/go-sql-driver/mysql\" rel=\"nofollow noreferrer\">go-sql-driver/mysql</a> driver for connecting to a MySQL database in Golang. \nI wonder is there a way to listen for DML queries on the database such that the <strong>client gets notified/triggered</strong> when any such query occurs.\nI am using the inbuilt <code>database/sql</code> package for connection. </p>\n\n<p>Similar: <a href=\"https://softwareengineering.stackexchange.com/questions/283177/\">[1]</a></p>\n"}, {"tags": ["go", "error-handling", "base64"], "answers": [{"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1498996423, "post_id": 44870207, "comment_id": 76719619, "body": "You are relying on a particular implementation at a particular point in time. Don&#39;t do that."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1499002935, "last_edit_date": 1499002935, "creation_date": 1498994140, "answer_id": 44870207, "question_id": 44870022, "link": "https://stackoverflow.com/questions/44870022/handling-errors-from-base64-decode-in-go/44870207#44870207", "title": "Handling errors from base64 decode in Go", "body": "<p>Looking at the implementation (unexported <code>base64.Encoding.decode()</code> method), if that method returns an error, it can only be of concrete type <a href=\"https://golang.org/pkg/encoding/base64/#CorruptInputError\" rel=\"nofollow noreferrer\"><code>base64.CorruptInputError</code></a>. This error type always produces the following error string:</p>\n\n<pre><code>func (e CorruptInputError) Error() string {\n    return \"illegal base64 data at input byte \" + strconv.FormatInt(int64(e), 10)\n}\n</code></pre>\n\n<p>So beside some extreme circumstances (like out of memory error, modified execution code etc.) if <code>base64.StdEncoding.DecodeString()</code> returns an error, its error string will <strong>always</strong> contain the string <code>\"illegal base64 data at input byte \"</code> (in the current version).</p>\n\n<p>It's needless to check its error string, you can treat any non-<code>nil</code> returned error as the input being invalid. And the error string is an implementation detail, so you shouldn't rely on it anyway. The error string is for <em>humans</em>, not for <em>code</em>. This is how the <code>encoding/base64</code> package is implemented, you can't do any finer error handling beside this (and usually there is no need to distinguish separate error cases in case of <code>Encoding.DecodeString()</code>).</p>\n\n<p>When a package does give distinct error values for different error cases, there are techniques to handle them well. For details, check out this question:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/30177860/does-go-have-standard-err-variables/30178766#30178766\">Does go have standard Err variables?</a></p>\n\n<p>As mentioned, in case of the <code>encoding/base64</code> package a value of the concrete <code>base64.CorruptInputError</code> type is returned, you can use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> to check for that. See peterSO's answer for that.</p>\n"}, {"comments": [{"owner": {"reputation": 19351, "user_id": 4148708, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/jLI9o.jpg?s=128&g=1", "display_name": "evilSnobu", "link": "https://stackoverflow.com/users/4148708/evilsnobu"}, "edited": false, "score": 0, "creation_date": 1498996820, "post_id": 44870250, "comment_id": 76719727, "body": "Ah yes, definitely, errors have types in Go. I guess read manual first, ask questions later. Thanks!"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1498994434, "creation_date": 1498994434, "answer_id": 44870250, "question_id": 44870022, "link": "https://stackoverflow.com/questions/44870022/handling-errors-from-base64-decode-in-go/44870250#44870250", "title": "Handling errors from base64 decode in Go", "body": "<p>Look at the error type. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/base64\"\n    \"fmt\"\n)\n\nfunc main() {\n    encoded := \"XXXXXaGVsbG8=\" // corrupt\n    decoded, err := base64.StdEncoding.DecodeString(encoded)\n    if err != nil {\n        if _, ok := err.(base64.CorruptInputError); ok {\n            panic(\"\\nbase64 input is corrupt, check service Key\")\n        }\n        panic(err)\n    }\n    fmt.Println(string(decoded))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>panic: \nbase64 input is corrupt, check service Key\n</code></pre>\n"}], "owner": {"reputation": 19351, "user_id": 4148708, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/jLI9o.jpg?s=128&g=1", "display_name": "evilSnobu", "link": "https://stackoverflow.com/users/4148708/evilsnobu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2168, "favorite_count": 1, "accepted_answer_id": 44870250, "answer_count": 2, "score": 3, "last_activity_date": 1499002935, "creation_date": 1498992831, "question_id": 44870022, "link": "https://stackoverflow.com/questions/44870022/handling-errors-from-base64-decode-in-go", "title": "Handling errors from base64 decode in Go", "body": "<p>Consider this simple base64 decode snippet:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/base64\"\n)\n\nfunc main() {\n    const encoded string = \"aGVsbG8=\" // hello\n    decoded, err := base64.StdEncoding.DecodeString(encoded)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(decoded))\n}\n</code></pre>\n\n<p>This produces <em>hello</em> as expected.\nNow, if i intentionally pass in corrupt input, e.g.</p>\n\n<pre><code>const encoded string = \"XXXXXaGVsbG8=\"\n</code></pre>\n\n<p>then i hit the panic line which gives me:</p>\n\n<pre><code>panic: illegal base64 data at input byte 11\n\ngoroutine 1 [running]:\nmain.main()\n    /tmp/sandbox422941756/main.go:12 +0x140\n</code></pre>\n\n<p>Looking at the <a href=\"https://github.com/golang/go/issues/10290\" rel=\"nofollow noreferrer\">source code</a> and <a href=\"https://github.com/golang/go/issues/10290\" rel=\"nofollow noreferrer\">this issue</a>, seems there is not much to go by here other than matching the string literal and returning a more meaningful error message to the caller:</p>\n\n<pre><code>if err != nil {\n    if strings.Contains(err.Error(), \"illegal base64 data at input byte\") {\n        panic(\"\\nbase64 input is corrupt, check service Key\")\n    }\n}\n</code></pre>\n\n<p>There has to be a more elegant way to do this other than string matching.\nWhat is the <strong>go</strong>-esque way to achieve this?</p>\n"}, {"tags": ["docker", "go", "moby"], "answers": [{"comments": [{"owner": {"reputation": 4565, "user_id": 206479, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/72562d2e1fb45be3e000db0b5a81dc59?s=128&d=identicon&r=PG", "display_name": "carillonator", "link": "https://stackoverflow.com/users/206479/carillonator"}, "edited": false, "score": 0, "creation_date": 1555437078, "post_id": 53983430, "comment_id": 98108503, "body": "Only in the ImagePull and Push func docs do they tell you that the &quot;privileged function&quot; is only called if the first attempt was unauthorized, after which it tries again: <a href=\"https://godoc.org/github.com/docker/docker/client#Client.ImagePull\" rel=\"nofollow noreferrer\">godoc.org/github.com/docker/docker/client#Client.ImagePull</a>. I have no idea in what situation that is needed."}], "tags": [], "owner": {"reputation": 31, "user_id": 5473527, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ddf02c20498c212958bb20dd8e42ce2?s=128&d=identicon&r=PG&f=1", "display_name": "bartgrantham", "link": "https://stackoverflow.com/users/5473527/bartgrantham"}, "is_accepted": false, "score": 2, "last_activity_date": 1546350988, "last_edit_date": 1546350988, "creation_date": 1546228422, "answer_id": 53983430, "question_id": 44869498, "link": "https://stackoverflow.com/questions/44869498/google-container-registry-golang-moby-authentication/53983430#53983430", "title": "Google container registry golang moby authentication", "body": "<p>(I assume you've already figured it out or have figured out an alternative method, but I'll document it here for the next person)</p>\n\n<p>You need to <strong>marshal it to JSON, then base64 encode it</strong>.  I haven't seen this documented anywhere except <a href=\"https://github.com/docker/cli/blob/master/cli/command/registry.go#L42\" rel=\"nofollow noreferrer\">the code for the docker cli</a>.</p>\n\n<p>Unfortunately, when I tried to include <code>github.com/docker/cli/cli/command</code> I got this error, due to the way the cli repo's vendor directory gets included in go's package source path:</p>\n\n<pre><code>./gcp.go:73:47: cannot use authc (type \"github.com/docker/docker/api/types\".AuthConfig)\nas type \"github.com/docker/cli/vendor/github.com/docker/docker/api/types\".AuthConfig\nin argument to command.EncodeAuthToBase64\n</code></pre>\n\n<p>The Go compiler doesn't recognize that they are the same type, which is annoying.  But it's simple enough to replicate the functionality:</p>\n\n<pre><code>buf, _ = json.Marshal(authConfig)\n\nregauth := base64.URLEncoding.EncodeToString(buf)\n\npullopts := types.ImagePullOptions{RegistryAuth:regauth}\n\nresponseBody, err := engine.Client.ImagePull(ctx, image, pullopts)\n\n...\n</code></pre>\n\n<p>*IMHO, a better implementation would be to have a <a href=\"https://godoc.org/github.com/docker/docker/api/types#RequestPrivilegeFunc\" rel=\"nofollow noreferrer\">types.RequestPrivilegeFunc</a> in the pullopts that gets the <code>access_token</code> field from <code>http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token</code> on the fly.  That way there's no app credentials to worry about securing.  I haven't tried that yet, myself.</p>\n\n<p>Hopefully that helps, despite it being 18 months late. :)</p>\n\n<p>FWIW, Google support wasn't able to provide <em>any</em> information about this, and the gcr.io and docker documentation didn't provide much to go on, either.  The solution was in getting the <a href=\"https://cloud.google.com/container-registry/docs/advanced-authentication\" rel=\"nofollow noreferrer\">cli auth set up</a> and then hacking a custom version of the docker cli tool so that I could see what was really going on.</p>\n\n<p><strong>*EDIT</strong>: So I tried this but AFAICT the <code>PrivilegeFunc</code> function declared in PullOptions is never called.  I have no idea why.  Too bad, it seemed like a much cleaner solution.  The procedural code above works for me, though.</p>\n"}], "owner": {"reputation": 754, "user_id": 497677, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5b903e474a608780f86aed033c61bf9e?s=128&d=identicon&r=PG", "display_name": "chvck", "link": "https://stackoverflow.com/users/497677/chvck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 634, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1546350988, "creation_date": 1498989093, "question_id": 44869498, "link": "https://stackoverflow.com/questions/44869498/google-container-registry-golang-moby-authentication", "title": "Google container registry golang moby authentication", "body": "<p>I'm using google container registry to host my docker images. I'm also using the moby client for golang to interact with it. I'm using the <a href=\"https://cloud.google.com/container-registry/docs/advanced-authentication\" rel=\"noreferrer\">JSON service key approach</a> which seems to work fine with RegistryLogin. The response text is Login Successful. However, I have no idea how to use the returned authentication key with ImagePull. Under the hood setting RegistryAuth appears to set whatever string passed as the X-Registry-Auth header, Google doesn't seem to mention this anywhere.</p>\n\n<p>I've tried passing the returned key as RegistryAuth, I've tried running RegistryLogin and then just pulling without RegistryAuth. I've tried base64 encoding my auth config and sending that in RegistryAuth. No matter what I try I get \"Error response from daemon: repository xxx not found: does not exist or no pull access\". Running docker login and then docker pull with the same details works fine on cli. My code is:</p>\n\n<pre><code>authConfig := types.AuthConfig{\n    Username:      \"_json_key\",\n    Password:      string(decodedKey),\n    ServerAddress: \"https://gcr.io\",\n}\n\n_, err = engine.Client.RegistryLogin(ctx, authConfig)\nif err != nil {\n    return err\n}\n\nresponseBody, err := engine.Client.ImagePull(ctx, image, types.ImagePullOptions{\n})\ndefer responseBody.Close()\n\nif err != nil {\n    return err\n}\n</code></pre>\n\n<p>decodedKey is the JSON key file content. Any ideas how to get this to work?</p>\n"}, {"tags": ["postgresql", "go"], "answers": [{"comments": [{"owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "edited": false, "score": 0, "creation_date": 1498983340, "post_id": 44868666, "comment_id": 76716436, "body": "hi @VonC, I looked at my Gopath, when i run:      go get -u -t github.com/vattle/sqlboiler  the sqlboiler binary file located in <b>/home/go/bin</b> , but somehow when runing <b>go generate</b>, I looked up to <b>/usr/local/go/bin</b>. Thank for your help"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 3, "last_activity_date": 1498982647, "creation_date": 1498982647, "answer_id": 44868666, "question_id": 44868580, "link": "https://stackoverflow.com/questions/44868580/exec-sqlboiler-executable-file-not-found-in-path/44868666#44868666", "title": "exec: &quot;sqlboiler&quot;: executable file not found in $PATH", "body": "<p>The <a href=\"https://www.youtube.com/watch?v=fKmRemtmi0Y&amp;feature=youtu.be\" rel=\"nofollow noreferrer\">screencast</a> starts with </p>\n\n<pre><code>go get -u -t github.com/vattle/sqlboiler\n</code></pre>\n\n<p>That step alone should compile and install <code>sqlboiler</code> in your <code>$GOPATH/bin</code> folder. Make sure that folder is part of your <code>PATH</code>.</p>\n"}], "owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1314, "favorite_count": 1, "accepted_answer_id": 44868666, "answer_count": 1, "score": 1, "last_activity_date": 1498982647, "creation_date": 1498981878, "question_id": 44868580, "link": "https://stackoverflow.com/questions/44868580/exec-sqlboiler-executable-file-not-found-in-path", "title": "exec: &quot;sqlboiler&quot;: executable file not found in $PATH", "body": "<p>After installed <a href=\"https://github.com/vattle/sqlboiler\" rel=\"nofollow noreferrer\">SqlBoiler</a>.</p>\n\n<p>Copy and paste simple codes in main.go and execute postgresql to create databases.</p>\n\n<p>I generated Go models by doing:</p>\n\n<pre><code>go generate\n</code></pre>\n\n<p>I got an error:</p>\n\n<pre><code>running \"sqlboiler\": exec: \"sqlboiler\": executable file not found in $PATH\n</code></pre>\n\n<p>I've watched <a href=\"https://www.youtube.com/watch?v=fKmRemtmi0Y&amp;feature=youtu.be\" rel=\"nofollow noreferrer\">SQLBoiler Screencast</a> but it's assumed user pre configured Sql Boiler</p>\n\n<p>What am i missing?</p>\n"}, {"tags": ["reactjs", "google-app-engine", "go", "react-router", "browser-history"], "answers": [{"comments": [{"owner": {"reputation": 3588, "user_id": 157541, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/f71466071ebc4f8f582a0bb5c3efc1bf?s=128&d=identicon&r=PG", "display_name": "sissonb", "link": "https://stackoverflow.com/users/157541/sissonb"}, "edited": false, "score": 0, "creation_date": 1498965637, "post_id": 44867107, "comment_id": 76713544, "body": "That part is working, but what I&#39;m trying to do is something like this, <code>http.Handle(&quot;&#47;*&quot;, http.StripPrefix(&quot;&#47;*&quot;, fs))</code> where the * would be a wildcard."}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "reply_to_user": {"reputation": 3588, "user_id": 157541, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/f71466071ebc4f8f582a0bb5c3efc1bf?s=128&d=identicon&r=PG", "display_name": "sissonb", "link": "https://stackoverflow.com/users/157541/sissonb"}, "edited": false, "score": 0, "creation_date": 1498965891, "post_id": 44867107, "comment_id": 76713564, "body": "Okay I understand. Just to clarify do you mean root <code>&#47;</code> and underneath is for serving static files?"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "reply_to_user": {"reputation": 3588, "user_id": 157541, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/f71466071ebc4f8f582a0bb5c3efc1bf?s=128&d=identicon&r=PG", "display_name": "sissonb", "link": "https://stackoverflow.com/users/157541/sissonb"}, "edited": false, "score": 0, "creation_date": 1498966876, "post_id": 44867107, "comment_id": 76713686, "body": "Additions to the answer, please have a look."}, {"owner": {"reputation": 3588, "user_id": 157541, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/f71466071ebc4f8f582a0bb5c3efc1bf?s=128&d=identicon&r=PG", "display_name": "sissonb", "link": "https://stackoverflow.com/users/157541/sissonb"}, "edited": false, "score": 0, "creation_date": 1498967610, "post_id": 44867107, "comment_id": 76713784, "body": "This is how my Go server is currently setup. Checkout my second example in the question"}, {"owner": {"reputation": 3588, "user_id": 157541, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/f71466071ebc4f8f582a0bb5c3efc1bf?s=128&d=identicon&r=PG", "display_name": "sissonb", "link": "https://stackoverflow.com/users/157541/sissonb"}, "edited": false, "score": 0, "creation_date": 1498967973, "post_id": 44867107, "comment_id": 76713832, "body": "I added another example to clarify the issue"}], "tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": false, "score": -2, "last_activity_date": 1498968548, "last_edit_date": 1498968548, "creation_date": 1498964805, "answer_id": 44867107, "question_id": 44867052, "link": "https://stackoverflow.com/questions/44867052/how-to-serve-dynamically-created-url-paths-with-go/44867107#44867107", "title": "How to Serve Dynamically Created URL Paths with Go?", "body": "<p><code>http.FileServer</code> is good choice for serving static files from directory and it's subdirectories.</p>\n\n<pre><code>func main() {\n  http.Handle(\"/static/\", http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"static\"))))\n\n  log.Println(\"Listening...\")\n  if err := http.ListenAndServe(\":8080\", nil); err != nil {\n     log.Fatal(err)\n  }\n}\n</code></pre>\n\n<p>It will serve any files under <code>/static/*</code> directory and its subdirectories via <code>http://localhost:8080/static/&lt;path-to-file&gt;</code>. </p>\n\n<p>So design your directory structure and map it via one or more file server handler.</p>\n\n<hr>\n\n<p><strong>EDIT:</strong></p>\n\n<p>As asked in the comment. Serve static files form root and underneath.</p>\n\n<pre><code>http.Handle(\"/\", http.StripPrefix(\"/\", http.FileServer(http.Dir(\"web\"))))\n</code></pre>\n\n<p>It means files under <code>web/*</code> will be served from root <code>/</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 3588, "user_id": 157541, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/f71466071ebc4f8f582a0bb5c3efc1bf?s=128&d=identicon&r=PG", "display_name": "sissonb", "link": "https://stackoverflow.com/users/157541/sissonb"}, "edited": false, "score": 0, "creation_date": 1498974676, "post_id": 44867551, "comment_id": 76714828, "body": "Thanks! I was able to get the file server to work without the mux server object, but if I ever want to add any services then I&#39;ll need to use it. I added the code I&#39;m using to my question"}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 3, "last_activity_date": 1498971116, "last_edit_date": 1498971116, "creation_date": 1498970676, "answer_id": 44867551, "question_id": 44867052, "link": "https://stackoverflow.com/questions/44867052/how-to-serve-dynamically-created-url-paths-with-go/44867551#44867551", "title": "How to Serve Dynamically Created URL Paths with Go?", "body": "<p>If you want to serve static contents with URL pattern <code>/*</code> to a specific directory, then use the answer provided by jeevatkm. </p>\n\n<p>If you need slightly customizable version, you need a kind of <em>adapter</em> that map the URL path to static file handler (<code>http.FileServer</code>). The example code looks like:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"regexp\"\n)\n\nfunc helloHandler(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Hello world!\"))\n}\n\nfunc adaptFileServer(fs http.Handler, mux http.Handler) http.Handler {\n    fn := func(w http.ResponseWriter, req *http.Request) {\n        //Use your Path matcher here.\n        //For demonstration, REGEX match is used\n        //and it's probably not the most efficient.\n        staticRegex := regexp.MustCompile(\"^/static-page-[0-9]+/\")\n        if matches := staticRegex.FindStringSubmatch(req.URL.Path); matches != nil {\n            log.Printf(\"Match: %v, %v\", req.URL.Path, matches[0])\n            fsHandler := http.StripPrefix(matches[0], fs)\n            fsHandler.ServeHTTP(w, req)\n        } else if mux != nil {\n            log.Printf(\"Doesn't match, pass to other MUX: %v\", req.URL.Path)\n            mux.ServeHTTP(w, req)\n        } else {\n            http.Error(w, \"Page Not Found\", http.StatusNotFound)\n        }\n    }\n    return http.HandlerFunc(fn)\n}\n\nfunc init() {\n    //Usual routing definition with MUX\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/hello\", helloHandler)\n\n    //\"Dynamic\" static file server.\n    fs := http.FileServer(http.Dir(\"web\"))\n    http.Handle(\"/\", adaptFileServer(fs, mux))\n}\n\nfunc main() {\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>In the above adapter example, if request path match to a specific <em>pattern</em> (<code>/static-page-*/</code> in the above example), it will be passed to <code>http.FileServer</code>. If doesn't match, and if a multiplexer is specified, it will call <code>mux.ServeHTTP</code>. Otherwise it will return <code>404</code> error. </p>\n\n<p>If you want another matching rule, just change the <code>regex</code> pattern (or use your custom matcher). </p>\n\n<p><strong>Note:</strong><br>\nPlease don't use a same handler instance for <code>FileServer</code> and <code>mux</code>. For example, when you call <code>http.Handle</code>, it use <code>http.DefaultServeMux</code> to handle routing. If you pass <code>http.DefaultServeMux</code> as the second argument of <code>adaptFileServer</code> you may end up with endless recursion.</p>\n"}, {"tags": [], "owner": {"reputation": 47233, "user_id": 119081, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4fa5be67e1e4b49c0765d218cfe7689b?s=128&d=identicon&r=PG", "display_name": "Blixt", "link": "https://stackoverflow.com/users/119081/blixt"}, "is_accepted": false, "score": 1, "last_activity_date": 1546952700, "creation_date": 1546952700, "answer_id": 54092459, "question_id": 44867052, "link": "https://stackoverflow.com/questions/44867052/how-to-serve-dynamically-created-url-paths-with-go/54092459#54092459", "title": "How to Serve Dynamically Created URL Paths with Go?", "body": "<p>First of all, the <a href=\"http://www.gorillatoolkit.org/pkg/mux\" rel=\"nofollow noreferrer\"><code>gorilla/mux</code> package</a> is great for dynamic routing support. But it still doesn't let you strip prefixes from dynamic routes. Here's how you can get that to work:</p>\n\n<pre><code>fileServer := http.FileServer(http.Dir(\"static\"))\nr.PathPrefix(\"/user/{name}/\").HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    // Figure out what the resolved prefix was.\n    name := mux.Vars(r)[\"name\"]\n    prefix := fmt.Sprintf(\"/user/%s/\", name)\n    // Strip it the normal way.\n    http.StripPrefix(prefix, fileServer).ServeHTTP(w, r)\n})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 343, "user_id": 8411263, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nLuEd7kVkpA/AAAAAAAAAAI/AAAAAAAAACI/XGfe0AyH8n8/photo.jpg?sz=128", "display_name": "Manouchehr Rasouli", "link": "https://stackoverflow.com/users/8411263/manouchehr-rasouli"}, "is_accepted": false, "score": 0, "last_activity_date": 1594826242, "creation_date": 1594826242, "answer_id": 62918193, "question_id": 44867052, "link": "https://stackoverflow.com/questions/44867052/how-to-serve-dynamically-created-url-paths-with-go/62918193#62918193", "title": "How to Serve Dynamically Created URL Paths with Go?", "body": "<p>A simple way to server dynamic link in golang file server is as follow</p>\n<p>first of all you have to implement a middle ware to recognize the dynamic link, or query link, for example, we generate a file with dynamic link <code>/some-hex-decimal</code> which leads to file</p>\n<p>and also you have a shortner which is a map from this <code>hex-decimal</code> to actual path</p>\n<p>code is as follow</p>\n<pre><code>func (us *urlSplitter) splitUrl(next http.Handler) http.Handler {\n  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    //============== Read requested query string\n    exn := r.URL.Query().Get(&quot;dynamic-link&quot;)\n    if exn == &quot;&quot; {\n        responseJsonStatus(w, &quot;access-file&quot;,\n            &quot;query string 'exn' not found&quot;,\n            &quot;&quot;, http.StatusBadRequest, nil)\n        return\n    }\n\n    //============== Remove query string\n    r.URL.Query().Del(&quot;exn&quot;)\n\n    //============== Generate file access path\n    supplier := func() (filter interface{}) {\n        return bson.D{\n            {&quot;exn&quot;, exn},\n        }\n    }\n    ifu := us.repo.FindExportationWithFilter(r.Context(), supplier).Get()\n\n    if ifu.Data() == nil {\n        responseJsonStatus(w, &quot;access-file&quot;,\n            &quot;request file not found&quot;,\n            &quot;&quot;, http.StatusNotFound, nil)\n        return\n    }\n\n    foundEx := ifu.Data().(*entitie) // stored data in cache or any other where\n\n    if foundEx.ExportationStatus.StatusName == utils.InTemporaryRepo ||\n        foundEx.ExportationStatus.StatusName == utils.FileManagementFailed {\n        responseJsonStatus(w, &quot;access-file&quot;,\n            &quot;file is not server-able&quot;,\n            &quot;&quot;, http.StatusBadRequest, nil)\n    }\n\n    //============== Call next handler to take care of request\n    r2 := new(http.Request)\n    *r2 = *r\n    r2.URL = new(url.URL)\n    *r2.URL = *r.URL\n    r2.URL.Path = foundEx.ServeUrl\n\n    next.ServeHTTP(w, r2)\n})\n}\n</code></pre>\n<p>now for using this middle ware we have to chain it up on http.server as follow</p>\n<pre><code>func (s *Server) Start() {\n    add := fmt.Sprintf(&quot;%s:%d&quot;, s.host, s.port)\n\n    log.GLog.Logger.Info(&quot;Starting HttpFileHandler&quot;, &quot;fn&quot;, &quot;httpFileServer.Start&quot;,\n        &quot;address&quot;, add, &quot;servePath&quot;, s.servePath)\n\n    //============== Initial Middleware\n    sp := newSplitter(s.repo)\n    au := newAuth(s.usCli)\n\n    fs := http.FileServer(http.Dir(s.servePath))\n\n    http.Handle(&quot;/&quot;, sp.splitUrl(fs)))\n\n    err := http.ListenAndServe(add, nil)\n    if err != nil {\n        log.GLog.Logger.Error(&quot;Error on starting file http server&quot;,\n            &quot;fn&quot;, &quot;httpFileServer.init&quot;,\n            &quot;err&quot;, err)\n        os.Exit(1)\n    }\n}\n</code></pre>\n<p>you now can change dynamic link middle ware to handle you dynamics in any shape which is to lead fileserver to correct file path.</p>\n"}], "owner": {"reputation": 3588, "user_id": 157541, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/f71466071ebc4f8f582a0bb5c3efc1bf?s=128&d=identicon&r=PG", "display_name": "sissonb", "link": "https://stackoverflow.com/users/157541/sissonb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2581, "favorite_count": 1, "accepted_answer_id": 44867551, "answer_count": 4, "score": 2, "last_activity_date": 1594826242, "creation_date": 1498963746, "last_edit_date": 1498973247, "question_id": 44867052, "link": "https://stackoverflow.com/questions/44867052/how-to-serve-dynamically-created-url-paths-with-go", "title": "How to Serve Dynamically Created URL Paths with Go?", "body": "<p>I am using react-router and <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/History_API\" rel=\"nofollow noreferrer\">browserHistory</a>'s pushState in a reactjs project. This project lets a user create a note which creates a new path. To serve this type of site I need to serve the same HTML file to every path besides the static content. So my nodejs code looks like this.</p>\n\n<pre><code>// Serve the static content\napp.use('/static/css/', express.static(path.join(__dirname, '../../react-ui/build/static/css')));\napp.use('/static/js/', express.static(path.join(__dirname, '../../react-ui/build/static/js')));\napp.use('/static/media/', express.static(path.join(__dirname, '../../react-ui/build/static/media')));\napp.use('/static/img/', express.static(path.join(__dirname, '../../react-ui/build/static/img')));\napp.use('/img/', express.static(path.join(__dirname, '../../react-ui/build/img')));\n\n// Serve the same HTML file to everything else\napp.use('*', express.static(path.join(__dirname, '../../react-ui/build'))); \n</code></pre>\n\n<p>I don't see any wildcard support for the Go FileServer. Currently I have all the static pages served using Go code similar to this.</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n)\n\nfunc init(){\n    fs := http.FileServer(http.Dir(\"web\"))\n    http.Handle(\"/\", fs)\n    http.Handle(\"/static-page-1/\", http.StripPrefix(\"/static-page-1/\", fs))\n    http.Handle(\"/static-page-2/\", http.StripPrefix(\"/static-page-2/\", fs))\n    http.Handle(\"/static-page-3/\", http.StripPrefix(\"/static-page-3/\", fs))\n}\n</code></pre>\n\n<p>Is it possible to serve content to dynamically generated URL paths with a Go server?</p>\n\n<p>If the Handle method supported variables then I'd write the code like this</p>\n\n<pre><code>fs := http.FileServer(http.Dir(\"web\"))\nhttp.Handle(\"/static/\", fs)\nhttp.Handle(\"/{unknownUserPath}\", http.StripPrefix(\"/{unknownUserPath}\", fs))\n</code></pre>\n\n<p>{unknownUserPath} would be any path that a user types in that is not under /static/ path.</p>\n\n<p>Here's the go project structure</p>\n\n<p><a href=\"https://i.stack.imgur.com/xN4uC.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xN4uC.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here's the server based on @putu answer</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"strings\"\n)\n\nfunc adaptFileServer(fs http.Handler) http.Handler {\n    fn := func(w http.ResponseWriter, req *http.Request) {\n        staticIndex := strings.Index(req.URL.Path, \"/static/\");\n        imgIndex := strings.Index(req.URL.Path, \"/img/\");\n\n        if staticIndex == -1 &amp;&amp; imgIndex == -1 {\n            fsHandler := http.StripPrefix(req.URL.Path, fs)\n            fsHandler.ServeHTTP(w, req)\n        } else {\n            fs.ServeHTTP(w, req)\n        }\n    }\n    return http.HandlerFunc(fn)\n}\n\nfunc init() {\n    fs := http.FileServer(http.Dir(\"web\"))\n    http.Handle(\"/\", adaptFileServer(fs))\n}\n</code></pre>\n"}, {"tags": ["go", "webserver", "http-status-code-404", "fileserver"], "answers": [{"comments": [{"owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "edited": false, "score": 0, "creation_date": 1498965410, "post_id": 44867077, "comment_id": 76713521, "body": "But I want my root directory to redirect to home/, accessing the website with your imlementation will give me a 404, Not found, and the favicon.ico will not be loaded either"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "reply_to_user": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "edited": false, "score": 0, "creation_date": 1498966596, "post_id": 44867077, "comment_id": 76713646, "body": "Added further details to the answer, please have a look."}], "tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": true, "score": 0, "last_activity_date": 1498966559, "last_edit_date": 1498966559, "creation_date": 1498964161, "answer_id": 44867077, "question_id": 44866837, "link": "https://stackoverflow.com/questions/44866837/fileserver-returns-404-for-all-files/44867077#44867077", "title": "Fileserver returns 404 for all files", "body": "<p>The issue I see in your code</p>\n\n<pre><code>r.Handle(\"/\", RedirectRoot(ServeFiles))\n</code></pre>\n\n<p>It will match every route, may produce unexpected results. Instead map your routes clearly and explicitly then it will work as you expect.</p>\n\n<p><strong>For eg.:</strong> Let's maps the handler with responsibility. This approach based on your directory structure.</p>\n\n<p>It will only expose <code>static</code> directory via file server, remaining files and root directory is safe.</p>\n\n<pre><code>func main()  {\n   r := mux.NewRouter()\n   r.Handle(\"/static/\", http.StripPrefix(\"/static/\",    http.FileServer(http.Dir(\"static\"))))\n   r.HandleFunc(\"/home\", Home)\n   r.NotFoundHandler = http.HandlerFunc(NotFound)\n\n   fmt.Printf(\"Listening ...\")\n   IfError(http.ListenAndServe(\":8081\", r), true)\n}\n</code></pre>\n\n<p><code>RedirectRoot</code> may not be needed for your purpose.</p>\n\n<p>Now, <code>/static/*</code> served by <code>http.FileServer</code> and <code>/home</code> handled by <code>Home</code>.</p>\n\n<hr>\n\n<p><strong>EDIT:</strong></p>\n\n<p>As asked in the comment. To map root <code>/</code> to home handler and <code>/favicon.ico</code>, add following in-addition to above code snippet.</p>\n\n<pre><code>func favIcon(w http.ResponseWriter, r *http.Request) {\n    http.ServeFile(w, r, \"static/favicon.ico\")\n} \n\nr.HandleFunc(\"/favicon.ico\", favIcon)\nr.HandleFunc(\"/\", Home)\n</code></pre>\n\n<p><code>favicon.ico</code> served from <code>static</code> directory.</p>\n"}], "owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1177, "favorite_count": 0, "accepted_answer_id": 44867077, "answer_count": 1, "score": 0, "last_activity_date": 1498989609, "creation_date": 1498960789, "last_edit_date": 1498989609, "question_id": 44866837, "link": "https://stackoverflow.com/questions/44866837/fileserver-returns-404-for-all-files", "title": "Fileserver returns 404 for all files", "body": "<p>So whenever I try to access any files in my static sub-directory, I just get a 404, Not Found, Accessing Home/ on the other hand works just fine, but a picture that I call from the home file is simply broken :(, So I'd like to know what to change so that I can serve files and redirect my root directory at the same time.</p>\n\n<p>My Path structure:</p>\n\n<pre><code>root/\n-&gt;html\n-&gt;static\n-&gt;entry.go\n</code></pre>\n\n<p>I saw the other threads on here, they all recommend that I do r.PathPrefix(\"/\").Handler(...), but doing that makes it so accessing any file outside static returns NIL, including my html files which are in a separate html file in the root of my project, furthermore, redirecting to any of them returns 404, Not Found.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"net/http\"\n  \"html/template\"\n  \"github.com/gorilla/mux\"\n  \"os\"\n)\n\nfunc IfError(err error, quit bool) {\n  if err != nil {\n    fmt.Println(err.Error())\n    if(quit) {\n      os.Exit(1);\n    }\n  }\n}\n\nfunc NotFound(w http.ResponseWriter, r *http.Request) {\n  w.WriteHeader(404)\n  t, _ := template.ParseFiles(\"html/404\")\n  err := t.Execute(w, nil)\n  IfError(err, false)\n}\n\nfunc Home(w http.ResponseWriter, r *http.Request) {\n  t, _ := template.ParseFiles(\"html/home\")\n  err := t.Execute(w, nil)\n  IfError(err, false)\n}\n\nfunc RedirectRoot(servefile http.Handler) http.Handler {\n  return http.HandlerFunc(func (w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path == \"/\" {\n      redirect := r.URL.Host+\"/home\"\n      http.Redirect(w, r, redirect, http.StatusSeeOther)\n    } else {\n      servefile.ServeHTTP(w, r)\n    }\n  })\n}\n\nfunc main()  {\n  r := mux.NewRouter()\n  ServeFiles := http.StripPrefix(\"/\", http.FileServer(http.Dir(\"static/\")))\n  r.Handle(\"/\", RedirectRoot(ServeFiles))\n  r.HandleFunc(\"/home\", Home)\n  r.NotFoundHandler = http.HandlerFunc(NotFound)\n\n  fmt.Printf(\"Listening ...\")\n  IfError(http.ListenAndServe(\":8081\", r), true)\n}\n</code></pre>\n\n<p>Thank you very much</p>\n"}, {"tags": ["http", "go", "localhost", "webserver", "http2"], "answers": [{"tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": true, "score": 2, "last_activity_date": 1498956063, "last_edit_date": 1498956063, "creation_date": 1498955632, "answer_id": 44866526, "question_id": 44866396, "link": "https://stackoverflow.com/questions/44866396/http2-not-enabled-by-default-on-localhost/44866526#44866526", "title": "HTTP2 not enabled by default on localhost", "body": "<p>Yes, its enabled by default when you use with SSL certs.</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/net/http/#pkg-overview\" rel=\"nofollow noreferrer\">Doc Reference</a>: Starting with Go 1.6, the http package has transparent\n  support for the HTTP/2 protocol when using HTTPS.</p>\n</blockquote>\n\n<pre><code>err := http.ListenAndServeTLS(\":8081\", \"server.crt\", \"server.key\", handler)\nif err != nil &amp;&amp; err != http.ErrServerClosed {\n    log.Fatal(\"ListenAndServe: \", err)\n}\n</code></pre>\n\n<p>Then, access it via</p>\n\n<pre><code>https://localhost:8081/\n</code></pre>\n"}], "owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2731, "favorite_count": 1, "accepted_answer_id": 44866526, "answer_count": 1, "score": 0, "last_activity_date": 1498989663, "creation_date": 1498953902, "last_edit_date": 1498989663, "question_id": 44866396, "link": "https://stackoverflow.com/questions/44866396/http2-not-enabled-by-default-on-localhost", "title": "HTTP2 not enabled by default on localhost", "body": "<p>I might be just clueless on this but my basic localhost server doesn't have HTTP2 Enabled for some odd reason, I normally proxy behind Caddy, but as I don't want to use my domain for this side project, I created a basic server in Go, and ran it, it works okay, but the headers show HTTP/1.1 instead of 2.0, what's wrong?</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"net/http\"\n  \"html/template\"\n  \"os\"\n)\n\nfunc IfError(err error, Quit bool) {\n  if err != nil {\n    fmt.Println(err.Error())\n    if(Quit) {\n      os.Exit(1);\n    }\n  }\n}\n\nfunc ServeHome(w http.ResponseWriter, r *http.Request) {\n  t, err := template.ParseFiles(\"html/home\")\n  IfError(err, false)\n  err = t.Execute(w, nil)\n  IfError(err, false)\n}\n\nfunc RedirectRoot(fs http.Handler, home http.Handler) http.Handler {\n  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path == \"/\" {\n      home.ServeHTTP(w, r)\n    } else {\n      fs.ServeHTTP(w, r)\n    }\n  })\n}\n\nfunc main()  {\n  proto := \":8081\"\n  ServeFiles := http.FileServer(http.Dir(\"static/\"))\n  http.Handle(\"/\", RedirectRoot(ServeFiles, http.HandlerFunc(ServeHome)))\n  fmt.Printf(\"Listening on ... %s\", proto)\n  IfError(http.ListenAndServe(proto, nil), true)\n}\n</code></pre>\n\n<p>Very basic stuff, but doesn't work even thought the documentation says it works by default. Also, my go version is 1.8.3</p>\n"}, {"tags": ["postgresql", "amazon-web-services", "go"], "comments": [{"owner": {"reputation": 7931, "user_id": 441099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d18ac367611aeb431cef6e156525d5a?s=128&d=identicon&r=PG", "display_name": "Guy Sirton", "link": "https://stackoverflow.com/users/441099/guy-sirton"}, "edited": false, "score": 0, "creation_date": 1498951597, "post_id": 44866015, "comment_id": 76711821, "body": "It can&#39;t connect.  Can you ping that other machine from the same EC2 instance?  Can you try a different pgsql client from the same EC2 instance?  Double check your parameters and setup."}, {"owner": {"reputation": 415, "user_id": 6021348, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/ddc2ecdf76091c717de352c775ee9e55?s=128&d=identicon&r=PG&f=1", "display_name": "amanda45", "link": "https://stackoverflow.com/users/6021348/amanda45"}, "reply_to_user": {"reputation": 7931, "user_id": 441099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d18ac367611aeb431cef6e156525d5a?s=128&d=identicon&r=PG", "display_name": "Guy Sirton", "link": "https://stackoverflow.com/users/441099/guy-sirton"}, "edited": false, "score": 0, "creation_date": 1498952434, "post_id": 44866015, "comment_id": 76711938, "body": "@GuySirton- I cant seem to ping my ec2 or my Database instance from my machine. I am able to connect to the Database instance using PgAdmin from my mac"}, {"owner": {"reputation": 162605, "user_id": 174777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6PnNW.jpg?s=128&g=1", "display_name": "John Rotenstein", "link": "https://stackoverflow.com/users/174777/john-rotenstein"}, "edited": false, "score": 0, "creation_date": 1498958698, "post_id": 44866015, "comment_id": 76712785, "body": "Ping protocol is normally disabled in AWS Security Groups. If your database is running on an Amazon EC2 instance and you wish to enable Ping, add <code>ICMP</code> to your Inbound Security Group."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1498974225, "post_id": 44866015, "comment_id": 76714752, "body": "Just before <code>db.Ping()</code>, try <code>_, err := db.Exec(&quot;SELECT 1&quot;)</code>, then check <code>err</code> whether it is <code>nil</code> or not. If it is not nil, perhaps <code>Ping()</code> doesn&#39;t act as what we think."}], "owner": {"reputation": 415, "user_id": 6021348, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/ddc2ecdf76091c717de352c775ee9e55?s=128&d=identicon&r=PG&f=1", "display_name": "amanda45", "link": "https://stackoverflow.com/users/6021348/amanda45"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 578, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1551727257, "creation_date": 1498949291, "last_edit_date": 1498958864, "question_id": 44866015, "link": "https://stackoverflow.com/questions/44866015/unable-to-connect-to-postgres-database-via-golang", "title": "Unable to connect to Postgres database via Golang", "body": "<p>I am using Golang to connect to a Postgres DB instance.</p>\n\n<p>When the code below is executed from an Amazon EC2 instance, the error is <code>not nil after sql.open()</code>.</p>\n\n<pre><code>db, err := sql.Open(\"postgres\", \"postgres://username:mypassword@xxxxxx.xxxxxxxxxx.xx-xxxx-x.xxx.xxxxxxxxx.xxx/postgres?sslmode=disable\")\n\n    if err != nil {\n        check(err)\n        panic(err)\n    }\n\n    err = db.Ping()\n\n    if err != nil {\n        check(err)\n        panic(err)\n    }\n</code></pre>\n\n<p>However, when I run <code>db.Ping()</code> it doesn't do anything. The code after <code>db.ping()</code> doesn't seem to be executed. After a while I get <code>getsockopt: connection timed out</code> in the terminal window.</p>\n\n<p>What could be the problem? Also even when I use the wrong password, the error is still <code>not nil</code>.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 184, "user_id": 8242401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FbBjK.jpg?s=128&g=1", "display_name": "luki", "link": "https://stackoverflow.com/users/8242401/luki"}, "edited": false, "score": 0, "creation_date": 1498946800, "post_id": 44865723, "comment_id": 76711005, "body": "Thanks, that fixes it. Are you able to explain why changing to (&amp;fl).Start() does not fix it? I though in Go it will return me the underlying structure."}], "tags": [], "owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "is_accepted": true, "score": 2, "last_activity_date": 1498946491, "last_edit_date": 1498946491, "creation_date": 1498946077, "answer_id": 44865723, "question_id": 44865693, "link": "https://stackoverflow.com/questions/44865693/goroutine-called-in-a-loop-on-function-with-pointer-overwrites-value/44865723#44865723", "title": "Goroutine called in a loop on function with pointer overwrites value?", "body": "<p><a href=\"https://github.com/golang/go/wiki/CommonMistakes\" rel=\"nofollow noreferrer\">Using goroutines on loop iterator variables is a common mistake.</a></p>\n\n<p>Call <code>.Start</code> on the element of <code>Fl2</code> by the range index, instead of the range value (<a href=\"https://play.golang.org/p/T7LzoWSscv\" rel=\"nofollow noreferrer\">playground</a>):</p>\n\n<pre><code>for i := range Fl2 {\n    Fl2[i].Start()\n}\n</code></pre>\n\n<p>However, the output might still not become exactly as you expect,\ndue to the scheduling of the goroutines,\nfor example it might be like this:</p>\n\n<pre><code>F1  &amp;{1}\nF1  &amp;{2}\nF1  &amp;{3}\nF2  &amp;{3}\nF2  &amp;{1}\nF2  &amp;{2}\n</code></pre>\n"}], "owner": {"reputation": 184, "user_id": 8242401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FbBjK.jpg?s=128&g=1", "display_name": "luki", "link": "https://stackoverflow.com/users/8242401/luki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "accepted_answer_id": 44865723, "answer_count": 1, "score": 1, "last_activity_date": 1498946491, "creation_date": 1498945677, "question_id": 44865693, "link": "https://stackoverflow.com/questions/44865693/goroutine-called-in-a-loop-on-function-with-pointer-overwrites-value", "title": "Goroutine called in a loop on function with pointer overwrites value?", "body": "<p>I have just started playing with Go and stumbled upon problem how the pointers are handled in this language.</p>\n\n<p>I have such code and can`t figure out how to fix it to get the correct response. </p>\n\n<p>Changing <code>func (me *Str) Start()</code> to <code>func (me Str) Start()</code> fixes the problem, but I need this as reference to write this structure (it will have channel in it).</p>\n\n<p>Sample code (<a href=\"https://play.golang.org/p/EsPejyCrX7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/EsPejyCrX7</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nvar wg1 sync.WaitGroup\n\ntype Str struct {\n    id int\n}\n\nfunc (me *Str) Start() {\n    wg1.Add(1)\n    fmt.Println(\"F1 \", me)\n    go me.startFn()\n}\n\nfunc (me *Str) startFn() {\n    defer wg1.Done()\n    fmt.Println(\"F2 \", me)\n}\n\nfunc main() {\n    Fl2 := []Str{\n        {1},\n        {2},\n        {3},\n    }\n\n    for _, fl := range Fl2 {\n        fl.Start()\n    }\n    wg1.Wait()\n}\n</code></pre>\n\n<p>Response:</p>\n\n<pre><code>F1  &amp;{1}\nF1  &amp;{2}\nF1  &amp;{3}\nF2  &amp;{3}\nF2  &amp;{3}\nF2  &amp;{3}\n</code></pre>\n\n<p>Expected response (F2 can be random):</p>\n\n<pre><code>F1  &amp;{1}\nF1  &amp;{2}\nF1  &amp;{3}\nF2  &amp;{3}\nF2  &amp;{2}\nF2  &amp;{1}\n</code></pre>\n"}, {"tags": ["html", "go", "cgo", "go-templates"], "comments": [{"owner": {"reputation": 47294, "user_id": 3885376, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/XgeJ5.png?s=128&g=1", "display_name": "ROMANIA_engineer", "link": "https://stackoverflow.com/users/3885376/romania-engineer"}, "edited": false, "score": 0, "creation_date": 1498939573, "post_id": 44864972, "comment_id": 76709281, "body": "I just have to change an existing Go application, but I don&#39;t have a technical background in this language. Also, I&#39;ll be thankful if someone can edit my question to make it more clear because I don&#39;t know the Go language terminology."}], "answers": [{"comments": [{"owner": {"reputation": 47294, "user_id": 3885376, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/XgeJ5.png?s=128&g=1", "display_name": "ROMANIA_engineer", "link": "https://stackoverflow.com/users/3885376/romania-engineer"}, "edited": false, "score": 0, "creation_date": 1498943116, "post_id": 44865080, "comment_id": 76710187, "body": "Based on this approach, if I just want to use the value for <code>Something</code>, is it better to have something like <code>{{$x := .Something}}</code> and inside the <code>{{range ...}}</code> block to use just <code>{{$x}}</code>?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 47294, "user_id": 3885376, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/XgeJ5.png?s=128&g=1", "display_name": "ROMANIA_engineer", "link": "https://stackoverflow.com/users/3885376/romania-engineer"}, "edited": false, "score": 0, "creation_date": 1498948041, "post_id": 44865080, "comment_id": 76711251, "body": "The {{$x := .Something}} will have a very small performance benefit. I recommend using whatever makes the code easiest to understand."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1498940873, "last_edit_date": 1498940873, "creation_date": 1498940385, "answer_id": 44865080, "question_id": 44864972, "link": "https://stackoverflow.com/questions/44864972/use-go-variable-inside-range-block-in-thtml-file/44865080#44865080", "title": "Use Go .Variable inside range block in THTML file", "body": "<p>The cursor is modified by {{range}}.  Assign the cursor to a variable and use that variable inside the range.</p>\n\n<pre><code>...\n&lt;div&gt;\n    &lt;p&gt;{{.Something}}&lt;/p&gt;        \n    {{$x := .}}    &lt;!-- assign cursor to variable $x --&gt;\n    {{range ...}}\n        &lt;p&gt;{{$x.Something}}&lt;/p&gt;    \n    {{end}}\n&lt;/div&gt;\n...\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/tQnOzB78VE\" rel=\"nofollow noreferrer\">playground example</a></p>\n\n<p>If the starting cursor in this snippet is the starting value of the template, then use the <code>$</code> variable:</p>\n\n<pre><code>...\n&lt;div&gt;\n    &lt;p&gt;{{$.Something}}&lt;/p&gt;     &lt;!-- the variable $ is the starting value for the template --&gt;    \n    {{range ...}}\n        &lt;p&gt;{{$.Something}}&lt;/p&gt;    \n    {{end}}\n&lt;/div&gt;\n...\n</code></pre>\n"}], "owner": {"reputation": 47294, "user_id": 3885376, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/XgeJ5.png?s=128&g=1", "display_name": "ROMANIA_engineer", "link": "https://stackoverflow.com/users/3885376/romania-engineer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 1, "accepted_answer_id": 44865080, "answer_count": 1, "score": -1, "last_activity_date": 1498940873, "creation_date": 1498939479, "question_id": 44864972, "link": "https://stackoverflow.com/questions/44864972/use-go-variable-inside-range-block-in-thtml-file", "title": "Use Go .Variable inside range block in THTML file", "body": "<p>I have a .thtml file:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>...\n&lt;div&gt;\n    &lt;p&gt;{{.Something}}&lt;/p&gt;        &lt;!-- It works here! --&gt;\n    {{range ...}}\n        &lt;p&gt;{{.Something}}&lt;/p&gt;    &lt;!-- It DOESN't work here! --&gt;\n    {{end}}\n&lt;/div&gt;\n...\n</code></pre>\n\n<p>If I use the value of <code>.Something</code> inside the .thtml file it works fine, but it doesn't work if it is used in the same way inside a <code>{{range ...}}</code> block.</p>\n\n<p>How can I use it?</p>\n"}, {"tags": ["pointers", "go", "typechecking"], "answers": [{"tags": [], "owner": {"reputation": 76, "user_id": 1273924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MB98V.jpg?s=128&g=1", "display_name": "LucianoQ", "link": "https://stackoverflow.com/users/1273924/lucianoq"}, "is_accepted": false, "score": 1, "last_activity_date": 1498938843, "creation_date": 1498938843, "answer_id": 44864862, "question_id": 44864790, "link": "https://stackoverflow.com/questions/44864790/why-cant-i-use-a-pointer-to-a-specific-type-where-interface-is-expected/44864862#44864862", "title": "Why can&#39;t I use a pointer to a specific type where *interface{} is expected?", "body": "<p><code>interface{}</code> could also contain a pointer with no problem.\nBut there is nothing like a pointer to <code>interface{}</code></p>\n\n<p>See these:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/27178635/cast-a-struct-pointer-to-interface-pointer-in-golang\">Cast a struct pointer to interface pointer in Golang</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/13511203/why-cant-i-assign-a-struct-to-an-interface\">Why can&#39;t I assign a *Struct to an *Interface?</a></p>\n"}, {"comments": [{"owner": {"reputation": 1487, "user_id": 607434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0b458e94231d885c11b9d87773264bd?s=128&d=identicon&r=PG", "display_name": "andy mango", "link": "https://stackoverflow.com/users/607434/andy-mango"}, "edited": false, "score": 2, "creation_date": 1498959278, "post_id": 44865347, "comment_id": 76712853, "body": "Love the extremes of the Haskell / C contrast."}], "tags": [], "owner": {"reputation": 12763, "user_id": 1097065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e26becbd681062e6da684a000c6b03ea?s=128&d=identicon&r=PG", "display_name": "andybalholm", "link": "https://stackoverflow.com/users/1097065/andybalholm"}, "is_accepted": true, "score": 10, "last_activity_date": 1498942642, "creation_date": 1498942642, "answer_id": 44865347, "question_id": 44864790, "link": "https://stackoverflow.com/questions/44864790/why-cant-i-use-a-pointer-to-a-specific-type-where-interface-is-expected/44865347#44865347", "title": "Why can&#39;t I use a pointer to a specific type where *interface{} is expected?", "body": "<p>The genericity of interface types in Go is not passed on to derived types. This applies to pointers (as you noticed), and also to slices, channels, etc. For example, you can't assign a <code>[]string</code> to a <code>[]interface{}</code>.</p>\n\n<p>There are various ways to explain this. For a Haskell programmer:</p>\n\n<p>Go does not have covariant or contravariant types. All type constructors (such as the <code>*</code> that creates a pointer type) are invariant. So even though <code>Account</code> and <code>*Account</code> (and all other types) are subtypes of <code>interface{}</code>, nothing is a subtype of <code>*interface{}</code> or <code>[]interface{}</code>. This is sometimes inconvenient, but it keeps Go's type system and assignability rules much simpler.</p>\n\n<p>For a C programmer:</p>\n\n<p>An <code>interface{}</code> can hold a value of any type, but it does not hold it directly. Rather than being a variable-sized magic container, it is just a struct consisting of a pointer to a type and a pointer to a value. When you assign a concrete type to an <code>interface{}</code>, both of these fields are filled in. <code>*interface{}</code> is a pointer to one of these structs. When you try to assign a <code>*Account</code> to a <code>*interface{}</code>, there is nowhere to put the type information, because the <code>*interface{}</code> is a single machine word that just holds a pointer. So the compiler won't let you do that.</p>\n"}], "owner": {"reputation": 11415, "user_id": 675311, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/5e4575fdaacc879dc2199490417d170a?s=128&d=identicon&r=PG", "display_name": "bigblind", "link": "https://stackoverflow.com/users/675311/bigblind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2426, "favorite_count": 0, "accepted_answer_id": 44865347, "answer_count": 2, "score": 5, "last_activity_date": 1498942642, "creation_date": 1498938293, "question_id": 44864790, "link": "https://stackoverflow.com/questions/44864790/why-cant-i-use-a-pointer-to-a-specific-type-where-interface-is-expected", "title": "Why can&#39;t I use a pointer to a specific type where *interface{} is expected?", "body": "<p>I have the following function:</p>\n\n<pre><code>func bytesToData(data interface{}, b []byte) error {\n    buf := bytes.NewBuffer(b)\n    dec := gob.NewDecoder(buf)\n    return dec.Decode(data)\n}\n</code></pre>\n\n<p>I use this for getting struct data in and out of boltdb. What I'd like to do, is change that signature to:</p>\n\n<pre><code>func bytesToData(data *interface{}, b []byte) error\n</code></pre>\n\n<p>And then I'd like to be able to call it like this (<code>b</code> in this case is a gob-encoded <code>Account</code>)</p>\n\n<pre><code>acc := &amp;Account{}\nerr := bytesToData(acc, b)\n</code></pre>\n\n<p>But when I do that, I get an error like <code>Cannot use *Account for type *interface{}</code>.</p>\n\n<p>For now, I've just changed it back to <code>interface{}</code>. But then, if I pass in an <code>Account</code> or some other type directly without making it a pointer, gob throws an error. It seems like this should be checkable at compile time. And given that an argument of type <code>interface{}</code> accepts anything, why doesn't an argument of type <code>*interface{}</code> accept a pointer to anything?</p>\n"}, {"tags": ["postgresql", "sockets", "google-app-engine", "go", "google-cloud-sql"], "answers": [{"comments": [{"owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1559841238, "post_id": 44864583, "comment_id": 99554780, "body": "app engine standard seems to say to use a socket for postgres <a href=\"https://cloud.google.com/sql/docs/postgres/connect-app-engine\" rel=\"nofollow noreferrer\">cloud.google.com/sql/docs/postgres/connect-app-engine</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1559860880, "post_id": 44864583, "comment_id": 99561924, "body": "With the 2nd gen instances they released some time ago, the connection string is different. Now it&#39;s &quot;@unix(/cloudsql/&lt;your instance name&gt;)&quot;. Updating answer, thanks."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 0, "last_activity_date": 1569339574, "last_edit_date": 1569339574, "creation_date": 1498936865, "answer_id": 44864583, "question_id": 44863620, "link": "https://stackoverflow.com/questions/44863620/socket-operation-not-permitted-when-connecting-to-cloudsql/44864583#44864583", "title": "socket: operation not permitted when connecting to cloudsql", "body": "<p>My App Engine projects use MySQL, but connections should theoretically be the same. Here is how I connect. Let me know if this doesn't work with Postgres</p>\n\n<p><strong>EDIT for 2nd gen instances</strong></p>\n\n<pre><code>connString:= \"@unix(/cloudsql/&lt;your instance&gt;)\"\nif appengine.IsDevAppServer() {\n    connString = \"@tcp(&lt;instance ip&gt;:port)\"\n}\nsqlUser := \"&lt;your user&gt;\"\nsqlPass := \"&lt;your pass&gt;\"\nconnString = sqlUser + \":\" + sqlPass + connString\n\n// connect main db\ndb, err := sqlx.Connect(\"mysql\", connString)\nif err != nil {\n    return nil, err\n}\n</code></pre>\n\n<p><strong>Old string for 1st gen:</strong>\n<code>connString := \"@cloudsql(&lt;your instance&gt;)\"</code></p>\n"}, {"comments": [{"owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1559840992, "post_id": 44897248, "comment_id": 99554667, "body": "I think it&#39;s allowed now."}], "tags": [], "owner": {"reputation": 1463, "user_id": 401051, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/df69b56fd9507e1ea6adb03b78c5a47d?s=128&d=identicon&r=PG", "display_name": "Carrotman42", "link": "https://stackoverflow.com/users/401051/carrotman42"}, "is_accepted": false, "score": 0, "last_activity_date": 1499143757, "creation_date": 1499143757, "answer_id": 44897248, "question_id": 44863620, "link": "https://stackoverflow.com/questions/44863620/socket-operation-not-permitted-when-connecting-to-cloudsql/44897248#44897248", "title": "socket: operation not permitted when connecting to cloudsql", "body": "<p>Unfortunately, Cloud SQL+postgres is not supported on AppEngine standard yet:</p>\n\n<p>\"Note: Connection from an App Engine standard environment application to a PostgreSQL instance is not supported\"</p>\n\n<p><a href=\"https://cloud.google.com/sql/docs/postgres/connect-app-engine\" rel=\"nofollow noreferrer\">https://cloud.google.com/sql/docs/postgres/connect-app-engine</a></p>\n"}, {"tags": [], "owner": {"reputation": 453, "user_id": 7177984, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nCfgIsKg9hM/AAAAAAAAAAI/AAAAAAAAAJ8/5JCQDBFe_BM/photo.jpg?sz=128", "display_name": "Omkar Yadav", "link": "https://stackoverflow.com/users/7177984/omkar-yadav"}, "is_accepted": false, "score": 0, "last_activity_date": 1521646735, "last_edit_date": 1521646735, "creation_date": 1521636699, "answer_id": 49406824, "question_id": 44863620, "link": "https://stackoverflow.com/questions/44863620/socket-operation-not-permitted-when-connecting-to-cloudsql/49406824#49406824", "title": "socket: operation not permitted when connecting to cloudsql", "body": "<p><code>NOTE: This is for mysql second version db</code></p>\n\n<p>main.go</p>\n\n<pre><code>import (\n    _ \"github.com/go-sql-driver/mysql\",\n    \"database/sql\"\n)\n\nfunc InitDB() (err error, db *DB) {\n    db, err = sql.Open(\"mysql\", os.Getenv(\"SQL_STRING\"))\n}\n</code></pre>\n\n<p><code>SQL_STRING: 'username:password@cloudsql(project:region:instance_id)/db'</code></p>\n\n<p>For more ref <a href=\"https://cloud.google.com/appengine/docs/standard/go/cloud-sql/reference\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/standard/go/cloud-sql/reference</a></p>\n"}], "owner": {"reputation": 71, "user_id": 7045315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a300e253294f18494980abc8006cdec?s=128&d=identicon&r=PG&f=1", "display_name": "crispmark", "link": "https://stackoverflow.com/users/7045315/crispmark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 652, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1569339574, "creation_date": 1498929588, "question_id": 44863620, "link": "https://stackoverflow.com/questions/44863620/socket-operation-not-permitted-when-connecting-to-cloudsql", "title": "socket: operation not permitted when connecting to cloudsql", "body": "<p>When trying to connect with the following settings I get a <code>socket:operation not permitted</code> error on app engine, but not locally when using cloud-sql-proxy. The following code works locally but not with app engine:</p>\n\n<pre><code>connString = \"user=USER_NAME password=PASSWORD host=/cloudsql/INSTANCE_NAME dbname=DB_NAME\"\nDBCon, err2 = sql.Open(\"postgres\", connString)\n</code></pre>\n\n<p>Both the app engine and cloud sql are in the same project. Does anyone have any insight on what I am missing?</p>\n"}, {"tags": ["cookies", "go", "web", "backend"], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 7794030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-x_0Be_wIKoo/AAAAAAAAAAI/AAAAAAAAAN8/PSsGQJ36U5U/photo.jpg?sz=128", "display_name": "Cleo Rebert", "link": "https://stackoverflow.com/users/7794030/cleo-rebert"}, "edited": false, "score": 0, "creation_date": 1498937407, "post_id": 44864577, "comment_id": 76708671, "body": "Wow it seems to work everytime now. I still don&#39;t get why it sometimes worked and other didn&#39;t. Thank you very much!"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "reply_to_user": {"reputation": 5, "user_id": 7794030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-x_0Be_wIKoo/AAAAAAAAAAI/AAAAAAAAAN8/PSsGQJ36U5U/photo.jpg?sz=128", "display_name": "Cleo Rebert", "link": "https://stackoverflow.com/users/7794030/cleo-rebert"}, "edited": false, "score": 0, "creation_date": 1498938208, "post_id": 44864577, "comment_id": 76708885, "body": "You&#39;re welcome. Print the <code>elapsedHours</code> and your previously calculated value <code>time.Since(SecureDevice.Token.StartingDate)*time.Hour</code> to see the difference."}], "tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": true, "score": 0, "last_activity_date": 1498936801, "creation_date": 1498936801, "answer_id": 44864577, "question_id": 44863386, "link": "https://stackoverflow.com/questions/44863386/user-cookie-verification-fails-randomly/44864577#44864577", "title": "User cookie verification fails randomly", "body": "<p>Your issue might be, the way you handle <a href=\"https://golang.org/pkg/time/#Since\" rel=\"nofollow noreferrer\">time.Since</a> return value for comparison.</p>\n\n<p><code>time.Since</code> method returns type <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"nofollow noreferrer\">Duration</a> and internally represented as type <code>int64</code>. Value is in Nanoseconds.</p>\n\n<p>Try this-</p>\n\n<pre><code>elapsedHours := int64(time.Since(SecureDevice.Token.StartingDate).Hours())\nif elapsedHours &gt;= 168 {\n    //...\n} else if elapsedHours &gt;= 30 {\n   //...\n} else if elapsedHours &lt;= 1 {\n   //...\n}\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 7794030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-x_0Be_wIKoo/AAAAAAAAAAI/AAAAAAAAAN8/PSsGQJ36U5U/photo.jpg?sz=128", "display_name": "Cleo Rebert", "link": "https://stackoverflow.com/users/7794030/cleo-rebert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 44864577, "answer_count": 1, "score": 0, "last_activity_date": 1498936801, "creation_date": 1498928141, "last_edit_date": 1498929059, "question_id": 44863386, "link": "https://stackoverflow.com/questions/44863386/user-cookie-verification-fails-randomly", "title": "User cookie verification fails randomly", "body": "<p>I'm using two structs to hold user's info</p>\n\n<pre><code>// SecureDevice holds a user's device's infos\ntype SecureDevice struct {\n    Name     string // Defined by the user\n    DeviceIP string\n    Token    struct {\n        Token        string\n        StartingDate time.Time // The token is supposed to last only a week before becoming invalid\n    }\n}\n\n// GlobalUser is a struct defining all user's infos registered inside the server\ntype GlobalUser struct {\n    Username          string\n    Password          string\n    Salt              string\n    Mail              string\n    ValidationToken   string // Used to validate the user's mail adress\n    Lang              string\n    ConversationsID   []int // The private messages the user has part in\n    SecureDevicesList []SecureDevice\n}\n</code></pre>\n\n<p>And I'm using a function to check if the user is logged in</p>\n\n<pre><code>// IsLoggedIn checks if client's token is valid\nfunc IsLoggedIn(r *http.Request) string {\n    ips := strings.Split(r.Header.Get(\"X-Forwarded-For\"), \", \")\n    ip := ips[0]\n    cookie, err := r.Cookie(\"auth\")\n    if err != nil {\n        return \"ERR$\" + \"not_connected\"\n    }\n    cookieValue := strings.Split(cookie.Value, \"$\")\n    println(cookie.Value)\n    user := GetUser(cookieValue[0])\n    userToken := cookieValue[1]\n    if user.Username == \"\" {\n        return \"ERR$\" + \"error\"\n    }\n    for _, SecureDevice := range user.SecureDevicesList {\n        if SecureDevice.DeviceIP == ip &amp;&amp; SecureDevice.Token.Token == userToken { // We make sure that the token provided is actually the user's token\n            if time.Since(SecureDevice.Token.StartingDate)*time.Hour &gt;= 168 { // If token is older than 1 week, we throw it away\n                return \"ERR$\" + \"error_token_expired\"\n            } else if time.Since(SecureDevice.Token.StartingDate)*time.Second &gt;= 30 { // If it's age is between 1 hour and one week, we renew it\n                db, err := scribble.New(\"./brony/db\", nil)\n                if err != nil {\n                    return \"ERR$\" + \"error_internal\"\n                }\n                tokenBytes, err := GenerateRandomBytes(64) // Generates a salt\n                if err != nil {\n                    return \"ERR$\" + \"error_internal\"\n                }\n                token := base64.URLEncoding.EncodeToString(tokenBytes)\n                SecureDevice.Token.Token = token\n                SecureDevice.Token.StartingDate = time.Now()\n                errr := db.Write(\"users\", user.Username, user)\n                if errr != nil {\n                    return \"ERR$\" + \"error_internal\"\n                }\n                return \"TOK$\" + user.Username + \"$\" + SecureDevice.Token.Token\n            } else if time.Since(SecureDevice.Token.StartingDate)*time.Hour &lt;= 1 {\n                return \"NIL$\"\n            }\n        } else if SecureDevice.DeviceIP == ip {\n            return \"ERR$\" + \"error_bad_token\"\n        }\n    }\n    return \"ERR$\" + \"error_device_not_registered\"\n}\n</code></pre>\n\n<p>But almost always when I load the page with</p>\n\n<pre><code>status := IsLoggedIn(r)\nprintln(status)\n</code></pre>\n\n<p>It often gives me an error, since I'm printing \"IsLoggedIn\" to understand where the problem comes from</p>\n\n<pre><code>test$ppDXRggtztyA9OBbdZh1t1ESqRo2XvuOBt4xlDai9kVxwq-_3zlWyvgNgA7AZcSpasJ_YnXZvoG                                                                                                                                                             qlz1syF9X8g==\nNIL$\n\ntest$ppDXRggtztyA9OBbdZh1t1ESqRo2XvuOBt4xlDai9kVxwq-_3zlWyvgNgA7AZcSpasJ_YnXZvoG                                                                                                                                                             qlz1syF9X8g==\nERR$error_token_expired\n\ntest$ppDXRggtztyA9OBbdZh1t1ESqRo2XvuOBt4xlDai9kVxwq-_3zlWyvgNgA7AZcSpasJ_YnXZvoG                                                                                                                                                             qlz1syF9X8g==\nNIL$\n\ntest$ppDXRggtztyA9OBbdZh1t1ESqRo2XvuOBt4xlDai9kVxwq-_3zlWyvgNgA7AZcSpasJ_YnXZvoG                                                                                                                                                             qlz1syF9X8g==\nERR$error_token_expired\ntest$ppDXRggtztyA9OBbdZh1t1ESqRo2XvuOBt4xlDai9kVxwq-_3zlWyvgNgA7AZcSpasJ_YnXZvoG                                                                                                                                                             qlz1syF9X8g==\nERR$error_token_expired\n\ntest$ppDXRggtztyA9OBbdZh1t1ESqRo2XvuOBt4xlDai9kVxwq-_3zlWyvgNgA7AZcSpasJ_YnXZvoG                                                                                                                                                             qlz1syF9X8g==\nERR$error_token_expired\n\ntest$ppDXRggtztyA9OBbdZh1t1ESqRo2XvuOBt4xlDai9kVxwq-_3zlWyvgNgA7AZcSpasJ_YnXZvoG                                                                                                                                                             qlz1syF9X8g==\nERR$error_token_expired\n\ntest$ppDXRggtztyA9OBbdZh1t1ESqRo2XvuOBt4xlDai9kVxwq-_3zlWyvgNgA7AZcSpasJ_YnXZvoG                                                                                                                                                             qlz1syF9X8g==\nERR$error_token_expired\n\ntest$ppDXRggtztyA9OBbdZh1t1ESqRo2XvuOBt4xlDai9kVxwq-_3zlWyvgNgA7AZcSpasJ_YnXZvoG                                                                                                                                                             qlz1syF9X8g==\nNIL$\n</code></pre>\n\n<p>At first I thought it was my token's renewal code which was faulty, but while beeing faulty and unfinished, it doesn't seem to be it's fault since after a few f5, it said that the cookie was ok. I really don't understand where the fault is, and it's starting to get really annoying, as I can't just let it be, it would be very annoying to say the least for a user to do f5 everytime and hope that when the page will refresh, it will miraculously work. The code runs on a debian server</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1498928922, "post_id": 44863276, "comment_id": 76706418, "body": "You&#39;re asking too many questions at once. What do you want to know here?  Why this design decision, or how to handle multiple projects with different versions of Go?"}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 1, "creation_date": 1498941802, "post_id": 44863276, "comment_id": 76709855, "body": "When you&#39;ve built those binaries, you can copy them wherever you want, such as $HOME/bin/ and add that to your PATH, or even copy them to /usr/bin/"}, {"owner": {"reputation": 1923, "user_id": 1351876, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/8028d0785748380250974c5424b07af2?s=128&d=identicon&r=PG", "display_name": "Nithin", "link": "https://stackoverflow.com/users/1351876/nithin"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1498947359, "post_id": 44863276, "comment_id": 76711113, "body": "@Flimzy I have edited the question to be more clear. Yes, my question is about this design decision and how people avoid having to <code>go get</code> the same tools especially when they have different projects in different GOPATHs. Hope I am clear."}, {"owner": {"reputation": 1923, "user_id": 1351876, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/8028d0785748380250974c5424b07af2?s=128&d=identicon&r=PG", "display_name": "Nithin", "link": "https://stackoverflow.com/users/1351876/nithin"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1498947766, "post_id": 44863276, "comment_id": 76711193, "body": "@nos I didnt know that could be done. So if i compile say, golint and put it to usr/bin/ would editors like vscode or atom be able to use it?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1498947888, "post_id": 44863276, "comment_id": 76711219, "body": "@Nithin if you don&#39;t follow the conventional way of doing stuff - prepare to suffer. Battling GOPATH is much more time consuming than just having a single GOPATH as intended. The same is applied for almost everything else: if you don&#39;t follow the &quot;go-way&quot; it would hurt."}, {"owner": {"reputation": 1923, "user_id": 1351876, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/8028d0785748380250974c5424b07af2?s=128&d=identicon&r=PG", "display_name": "Nithin", "link": "https://stackoverflow.com/users/1351876/nithin"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1498948338, "post_id": 44863276, "comment_id": 76711313, "body": "@zerkms I totally understand your point. But i still dont understand why a tool like a linter cant be a binary, they dont need to change the source like <code>go test</code> does, do they? Its just a linter after all."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1498952067, "post_id": 44863276, "comment_id": 76711875, "body": "Speculation on my part, but they might be external tools because they simply aren&#39;t a required part of the core of Go. I myself have never needed any of these alternate tools. Everything encompassed in the <code>go</code> command has been enough. So my speculation is that they are simply slimming the main tools down. Also, a change to the source of one of said tools would require a new Go version (kind of a big deal), and everyone&#39;s systems would update for the changes. Having them external allows for more agile development of these individual tools."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1498958027, "post_id": 44863276, "comment_id": 76712704, "body": "@Nithin it can be distributed as a binary. Ask your OS package manager team to bundle it for you or build a package yourself."}], "answers": [{"comments": [{"owner": {"reputation": 1923, "user_id": 1351876, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/8028d0785748380250974c5424b07af2?s=128&d=identicon&r=PG", "display_name": "Nithin", "link": "https://stackoverflow.com/users/1351876/nithin"}, "edited": false, "score": 0, "creation_date": 1498993934, "post_id": 44867509, "comment_id": 76718997, "body": "so there is no particular reason as to why golang tools installed like libraries and not as binaries somewhere global? Its just a matter of convenience?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 1923, "user_id": 1351876, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/8028d0785748380250974c5424b07af2?s=128&d=identicon&r=PG", "display_name": "Nithin", "link": "https://stackoverflow.com/users/1351876/nithin"}, "edited": false, "score": 0, "creation_date": 1498995036, "post_id": 44867509, "comment_id": 76719270, "body": "@Nithin <a href=\"https://golang.org/doc/code.html#Overview\" rel=\"nofollow noreferrer\">golang.org/doc/code.html#Overview</a>: &quot;Go programmers typically keep all their Go code in a single workspace.&quot; For that reason, libraries and tools alike are installed in the same workspace."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 1923, "user_id": 1351876, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/8028d0785748380250974c5424b07af2?s=128&d=identicon&r=PG", "display_name": "Nithin", "link": "https://stackoverflow.com/users/1351876/nithin"}, "edited": false, "score": 0, "creation_date": 1498995087, "post_id": 44867509, "comment_id": 76719288, "body": "@Nithin My point, with this answer, is that you can have two separate workspaces for two different usages."}, {"owner": {"reputation": 1923, "user_id": 1351876, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/8028d0785748380250974c5424b07af2?s=128&d=identicon&r=PG", "display_name": "Nithin", "link": "https://stackoverflow.com/users/1351876/nithin"}, "edited": false, "score": 0, "creation_date": 1499021162, "post_id": 44867509, "comment_id": 76726509, "body": "Can you update your answer to mention that these tools can be compiled to binaries and if those binaries are available in $PATH, most editors, as far as I tested (based on your post), both vscode and atom (go-plus) will work and wont <code>go get</code> them again.  As to why they are not binaries in the first place, I think it mostly comes the maintainer&#39;s  decision. I will also add that its easier to update if they are treated like libraries. (I mean <code>go get</code>)"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 1923, "user_id": 1351876, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/8028d0785748380250974c5424b07af2?s=128&d=identicon&r=PG", "display_name": "Nithin", "link": "https://stackoverflow.com/users/1351876/nithin"}, "edited": false, "score": 0, "creation_date": 1499021317, "post_id": 44867509, "comment_id": 76726550, "body": "@Nithin Good points. I have included your comment in the answer for more visibility."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 3, "last_activity_date": 1499021297, "last_edit_date": 1592644375, "creation_date": 1498970210, "answer_id": 44867509, "question_id": 44863276, "link": "https://stackoverflow.com/questions/44863276/how-to-install-golang-tools-globally-and-then-use-them-in-multiple-projects-in-d/44867509#44867509", "title": "How to install golang tools globally and then use them in multiple projects in different GOPATH?", "body": "<blockquote>\n<p>so I am having to install these tools into every single project so that I can lint or have auto completions.</p>\n</blockquote>\n<p>No you don't: see how Visual Studio Code does it through its <a href=\"https://github.com/Microsoft/vscode-go\" rel=\"nofollow noreferrer\">Microsoft <code>vscode-go</code></a> plugin (since its 0.6.53 version, January 2017).</p>\n<blockquote>\n<p>New setting <code>go.toolsGopath</code>,  for providing an alternate location to install all the Go tools that the extension depends on, if you don't want them cluttering your <code>GOPATH</code>.<br />\nSee <a href=\"https://github.com/Microsoft/vscode-go/pull/351\" rel=\"nofollow noreferrer\">PR 351</a> and <a href=\"https://github.com/Microsoft/vscode-go/pull/737\" rel=\"nofollow noreferrer\">PR 737</a></p>\n</blockquote>\n<p>The tools installed in that one common `` folder are:</p>\n<pre><code>'gocode': 'github.com/nsf/gocode',\n'gopkgs': 'github.com/tpng/gopkgs',\n'go-outline': 'github.com/ramya-rao-a/go-outline',\n'go-symbols': 'github.com/acroca/go-symbols',\n'guru': 'golang.org/x/tools/cmd/guru',\n'gorename': 'golang.org/x/tools/cmd/gorename',\n'gomodifytags': 'github.com/fatih/gomodifytags',\n'impl': 'github.com/josharian/impl'\n</code></pre>\n<p>(and a few others, around <code>godoc</code>, <code>goimports</code> or <code>goreturns</code>, <code>dlv</code>, ...),</p>\n<p>That means your <code>GOPATH</code> is composed of:</p>\n<ul>\n<li>your project-specific workspace folder</li>\n<li>a global <code>go.toolsGopath</code> workspace folder dedicated to tools used by all projects.<br />\nThe tools are installed/updated in the <code>bin/</code> subfolder of that latter workspace.</li>\n</ul>\n<p>You can do that manually too (without Visual Studio Code): simply set <code>GOPATH</code> to that global tools folder whenever you want to install/update the tools.</p>\n<p>Then reset <code>GOPATH</code> to <code>my/project/dedicated/workspace;/tools/workspace</code>, and add both <code>bin/</code> subfolders to your <code>$PATH</code>/<code>%PATH%</code>.</p>\n<p>The <a href=\"https://stackoverflow.com/users/1351876/nithin\">OP Nithin</a> adds <a href=\"https://stackoverflow.com/questions/44863276/why-are-golang-tools-installed-like-libraries-and-not-as-binaries-somewhere-glob/44867509#comment76726509_44867509\">in the comments</a>:</p>\n<blockquote>\n<p>these tools can be compiled to binaries and if those binaries are available in <code>$PATH</code>, most editors, as far as I tested (based on your post), both vscode and atom (go-plus) will work and wont <code>go get</code> them again.</p>\n<p>It is easier to update if they are treated like libraries. (I mean <code>go get</code>)</p>\n</blockquote>\n"}], "owner": {"reputation": 1923, "user_id": 1351876, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/8028d0785748380250974c5424b07af2?s=128&d=identicon&r=PG", "display_name": "Nithin", "link": "https://stackoverflow.com/users/1351876/nithin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6656, "favorite_count": 1, "accepted_answer_id": 44867509, "answer_count": 1, "score": 1, "last_activity_date": 1499091241, "creation_date": 1498927462, "last_edit_date": 1499091241, "question_id": 44863276, "link": "https://stackoverflow.com/questions/44863276/how-to-install-golang-tools-globally-and-then-use-them-in-multiple-projects-in-d", "title": "How to install golang tools globally and then use them in multiple projects in different GOPATH?", "body": "<p>Most of the golang tools like golint, gopkgs etc are installed like libraries with <code>go get</code> for instance, <code>go get -v github.com/golang/lint/golint</code> or <code>go get -v github.com/tpng/gopkgs</code>. I wonder why these are not just binaries that run through the source code, like <code>go fmt</code>, for example?</p>\n\n<p>Since I work on multiple Go projects at the same time, I prefer having different <code>GOPATH</code> for different projects and so I am having to install these tools into every single project so that I can lint or have auto completions.</p>\n\n<p>Am I doing something wrong or is there a way to install these tools globally and then just use them in multiple projects? How do people handling multiple projects manage this?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I am not asking about vendoring of libraries or about projects using different versions of Go at the same time. My question is about having to install tools like lint and gopkgs into every GOPATH, why they were designed to be treated like libraries instead of being provided as a global binary like <code>go fmt</code> which then could've been used in multiple projects, just like we use <code>go fmt</code></p>\n"}, {"tags": ["arrays", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 435, "user_id": 5967025, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/L8xlW.jpg?s=128&g=1", "display_name": "vildhjarta", "link": "https://stackoverflow.com/users/5967025/vildhjarta"}, "edited": false, "score": 0, "creation_date": 1498928087, "post_id": 44863318, "comment_id": 76706200, "body": "Thanks for your explanation and the other related existing questions."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1498928206, "last_edit_date": 1498928206, "creation_date": 1498927653, "answer_id": 44863318, "question_id": 44862762, "link": "https://stackoverflow.com/questions/44862762/how-does-the-slices-behave-when-their-capacity-reduce/44863318#44863318", "title": "How does the slices behave when their capacity reduce?", "body": "<p>Rules of slicing is described in the <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">Spec: Slice expressions</a>.</p>\n\n<p>In your example <code>numbers</code> is an <a href=\"https://golang.org/ref/spec#Array_types\" rel=\"nofollow noreferrer\">array</a>. When you slice an array, the resulting slice's capacity will be the number of elements from the resulting slice's first element till the last element of the array. When you're slicing a <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">slice</a>, the capacity of the result is the number of elements from the first element till the capacity of the original slice.</p>\n\n<p>So <code>numbers2 := numbers[:4]</code>, low index is omitted and therefore defaults to <code>0</code>, so the result will have a capacity of <code>8 - 0 = 8</code> (the size of <code>numbers</code> array).</p>\n\n<p>In <code>numbers3 := numbers[1:5]</code>, the result will have a capacity of <code>7</code>, because the first element in the result is at index <code>1</code>, so <code>8 - 1 = 7</code>.</p>\n\n<p>In <code>numbers4 := numbers[3:8]</code>, the capacity will be <code>8 - 3 = 5</code>.</p>\n\n<p><strong>Note:</strong> This is when you use a \"simple\" slice expression, that is when you only provide 2 indices in the slice expression (which has the form of <code>a[low : high]</code>). There is also a \"full\" slice expression which has the form of <code>a[low : high : max]</code>, which additionally controls the resulting slice's capacity by setting it to <code>max - low</code>. </p>\n\n<p><strong>See related questions:</strong></p>\n\n<p><a href=\"https://stackoverflow.com/questions/36683911/go-slices-capacity-length/36689864#36689864\">Go slices - capacity/length?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/31685620/go-slice-length-is-capacity-1-why/31685840#31685840\">Go slice length is capacity -1, why?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/33859066/slicing-out-of-bounds-error-in-go/33859638#33859638\">Slicing: Out of bounds error in Go</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/28176059/slices-in-go-why-does-it-allow-appending-more-than-the-capacity-allows/28176246#28176246\">Slices in Go: why does it allow appending more than the capacity allows?</a></p>\n"}], "owner": {"reputation": 435, "user_id": 5967025, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/L8xlW.jpg?s=128&g=1", "display_name": "vildhjarta", "link": "https://stackoverflow.com/users/5967025/vildhjarta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1498930922, "creation_date": 1498924107, "last_edit_date": 1498930922, "question_id": 44862762, "link": "https://stackoverflow.com/questions/44862762/how-does-the-slices-behave-when-their-capacity-reduce", "title": "How does the slices behave when their capacity reduce?", "body": "<p>I have already read <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">this blog post</a>. Every explanation is so clear and understandable. And I got the point that how slices are acting when their capacity is increasing. But I have a question about the opposite of this behaviour. How do the slices behave when their capacity is reduced? Considering this example:</p>\n\n<pre><code>var numbers = [8]int{1, 11, 78, 81, 101, 344, 65, 13}\nfmt.Printf(\"len=%d, cap=%d\\n\", len(numbers), cap(numbers)) // len=8, cap=8\n\nnumbers2 := numbers[:4]\nfmt.Printf(\"len=%d, cap=%d\\n\", len(numbers2), cap(numbers2)) // len=4, cap=8\n</code></pre>\n\n<p>For <code>numbers2</code> it is so obvious. The capacity of the newly created array will be set to two folds the number of elements in the new slice. But considering this example its acting differently:</p>\n\n<pre><code>numbers3 := numbers[1:5]\nfmt.Printf(\"len=%d, cap=%d\\n\", len(numbers3), cap(numbers3)) // len=4, cap=7\n\nnumbers4 := numbers[3:8]\nfmt.Printf(\"len=%d, cap=%d\\n\", len(numbers4), cap(numbers4)) // len=5, cap=5\n</code></pre>\n\n<p>I was wondering about that what was the point? Is there any proper way of capacity calculation formula like increasing? </p>\n"}, {"tags": ["loops", "go", "append", "slice"], "answers": [{"tags": [], "owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "is_accepted": true, "score": 0, "last_activity_date": 1498915926, "creation_date": 1498915926, "answer_id": 44861519, "question_id": 44861213, "link": "https://stackoverflow.com/questions/44861213/golang-reslicing-issue/44861519#44861519", "title": "Golang Reslicing Issue", "body": "<p>I finally figured it out!</p>\n\n<p>I needed to use the <code>copy</code> function instead of initializing my local slices using <code>:=</code>.</p>\n\n<p>Go Playground Link: <a href=\"https://play.golang.org/p/N9RzHOibdI\" rel=\"nofollow noreferrer\">https://play.golang.org/p/N9RzHOibdI</a></p>\n"}], "owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 44861519, "answer_count": 1, "score": 0, "last_activity_date": 1498916372, "creation_date": 1498913970, "last_edit_date": 1498916372, "question_id": 44861213, "link": "https://stackoverflow.com/questions/44861213/golang-reslicing-issue", "title": "Golang Reslicing Issue", "body": "<p>I'm currently looping over a slice and removing the first element each time.</p>\n\n<p>To do so, I am using the following code:</p>\n\n<pre><code>mySlice = append(mySlice[1:])\n</code></pre>\n\n<p>Everything goes fine for the first few iterations, but on later ones, some elements get removed and some get duplicated:</p>\n\n<p>Before:</p>\n\n<pre><code>40.917\n37.6384\n41.2783\n38.1481\n</code></pre>\n\n<p>After:</p>\n\n<pre><code>40.917\n37.6384\n41.2783\n37.6384\n41.2783\n38.1481\n</code></pre>\n\n<p>I printed the <code>len</code> and <code>cap</code> of the slice for all iterations, but they seem to be decrementing by <code>1</code> for each iteration as expected.</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>I figured out the problem: It seems that even though I am simply passing my slice to another function to create a local slice, if I manipulate the local slice, my original slice gets affected as well (D'oh!).</p>\n\n<p>Go Playground Link: <a href=\"https://play.golang.org/p/ca57tgusXD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ca57tgusXD</a></p>\n"}, {"tags": ["json", "string", "dictionary", "go", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 177, "user_id": 5395433, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-6-U7i6GI7U8/AAAAAAAAAAI/AAAAAAAAACk/V2Rf_c3c-H0/photo.jpg?sz=128", "display_name": "Valentin Ouvrard", "link": "https://stackoverflow.com/users/5395433/valentin-ouvrard"}, "edited": false, "score": 0, "creation_date": 1498908353, "post_id": 44860164, "comment_id": 76700434, "body": "Thanks a lot, it work but It&#39;s not exactly what I want,  How Can I have a map like this :   <a href=\"https://pastebin.com/6EJX01D6\" rel=\"nofollow noreferrer\">pastebin.com/6EJX01D6</a>"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "reply_to_user": {"reputation": 177, "user_id": 5395433, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-6-U7i6GI7U8/AAAAAAAAAAI/AAAAAAAAACk/V2Rf_c3c-H0/photo.jpg?sz=128", "display_name": "Valentin Ouvrard", "link": "https://stackoverflow.com/users/5395433/valentin-ouvrard"}, "edited": false, "score": 0, "creation_date": 1498909280, "post_id": 44860164, "comment_id": 76700718, "body": "<code>mm</code> is your expected?"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1498909909, "post_id": 44860164, "comment_id": 76700878, "body": "I think he want <i>flatten map</i>, i.e. the JSON key is combined <i>recursively</i> with &quot;-&quot; as the separator."}, {"owner": {"reputation": 177, "user_id": 5395433, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-6-U7i6GI7U8/AAAAAAAAAAI/AAAAAAAAACk/V2Rf_c3c-H0/photo.jpg?sz=128", "display_name": "Valentin Ouvrard", "link": "https://stackoverflow.com/users/5395433/valentin-ouvrard"}, "edited": false, "score": 0, "creation_date": 1498910684, "post_id": 44860164, "comment_id": 76701082, "body": "Yes , It&#39;s exactly what I need, but I can&#39;t make it work :p"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1498911971, "post_id": 44860164, "comment_id": 76701497, "body": "Ah, I understand you want just now."}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1498912150, "post_id": 44860164, "comment_id": 76701554, "body": "But you will have problem when writing config file, I guess. Most of case, you can solve the xpath like solution. For example, json-pointer (<a href=\"https://github.com/mattn/go-jsonpointer\" rel=\"nofollow noreferrer\">github.com/mattn/go-jsonpointer</a>) or something similar (<a href=\"https://github.com/mattn/go-scan\" rel=\"nofollow noreferrer\">github.com/mattn/go-scan</a>)"}], "tags": [], "owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "is_accepted": true, "score": 2, "last_activity_date": 1498919682, "last_edit_date": 1498919682, "creation_date": 1498906824, "answer_id": 44860164, "question_id": 44860050, "link": "https://stackoverflow.com/questions/44860050/create-a-map-of-string-from-a-json-with-unknow-key-values-in-go/44860164#44860164", "title": "create a map of string from a JSON with unknow key-values in Go", "body": "<p>Easy to do. Simply convert.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\nconst s = `\n{\n         \"localhost\":\n        {\n                \"tag\": \"dev_latest\",\n                \"vhost\": \"localhost.com\"\n        },\n        \"development\":\n        {\n                \"tag\": \"dev_latest\",\n                \"vhost\": \"dev.com\"\n        }\n}\n`\n\nfunc main() {\n    var m map[string]interface{}\n    err := json.Unmarshal([]byte(s), &amp;m)\n    if err != nil {\n        log.Fatal(err)\n    }\n    mm := make(map[string]string)\n    for k, v := range m {\n        mm[k] = fmt.Sprint(v)\n    }\n    fmt.Println(mm)\n}\n</code></pre>\n\n<h1>UPDATE</h1>\n\n<p>Wrote flatten (maybe works as charm)</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"reflect\"\n)\n\nconst s = `\n{\n         \"localhost\":\n        {\n                \"tag\": \"dev_latest\",\n                \"vhost\": \"localhost.com\"\n        },\n        \"development\":\n        {\n                \"tag\": \"dev_latest\",\n                \"vhost\": \"dev.com\"\n        }\n}\n`\n\nfunc flatten(m map[string]interface{}) map[string]string {\n    mm := make(map[string]string)\n    for k, v := range m {\n        switch reflect.TypeOf(v).Kind() {\n        case reflect.Map:\n            mv := flatten(v.(map[string]interface{}))\n            for kk, vv := range mv {\n                mm[k+\"-\"+kk] = vv\n            }\n        case reflect.Array, reflect.Slice:\n            for kk, vv := range m {\n                if reflect.TypeOf(vv).Kind() == reflect.Map {\n                    mv := flatten(vv.(map[string]interface{}))\n                    for kkk, vvv := range mv {\n                        mm[k+\"-\"+kkk] = vvv\n                    }\n                } else {\n                    mm[k+\"-\"+kk] = fmt.Sprint(vv)\n                }\n            }\n        default:\n            mm[k] = fmt.Sprint(v)\n        }\n    }\n    return mm\n}\n\nfunc main() {\n    var m map[string]interface{}\n    err := json.Unmarshal([]byte(s), &amp;m)\n    if err != nil {\n        log.Fatal(err)\n    }\n    b, _ := json.MarshalIndent(flatten(m), \"\", \"  \")\n    println(string(b))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 177, "user_id": 5395433, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-6-U7i6GI7U8/AAAAAAAAAAI/AAAAAAAAACk/V2Rf_c3c-H0/photo.jpg?sz=128", "display_name": "Valentin Ouvrard", "link": "https://stackoverflow.com/users/5395433/valentin-ouvrard"}, "edited": false, "score": 0, "creation_date": 1498945972, "post_id": 44860821, "comment_id": 76710850, "body": "Thanks a lot, it&#39;s perfect !"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1498911657, "last_edit_date": 1498911657, "creation_date": 1498911265, "answer_id": 44860821, "question_id": 44860050, "link": "https://stackoverflow.com/questions/44860050/create-a-map-of-string-from-a-json-with-unknow-key-values-in-go/44860821#44860821", "title": "create a map of string from a JSON with unknow key-values in Go", "body": "<p>You can't have this automatically, but you can range over the \"internal\" maps, and combine the outer keys with the inner keys using simple string concatenation (<code>+</code> operator). Also it's recommended to unmarshal directly into a value of <code>map[string]map[string]string</code> so you don't need to use type assertions. Also no need to use any external libraries for this, the standard <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>encoding/json</code></a> package is perfectly enough for this.</p>\n\n<p>Example:</p>\n\n<pre><code>var mm map[string]map[string]string\nif err := json.Unmarshal([]byte(src), &amp;mm); err != nil {\n    panic(err)\n}\nconfig := map[string]string{}\nfor mk, m := range mm {\n    for k, v := range m {\n        config[mk+\"-\"+k] = v\n    }\n}\nfmt.Println(config)\n</code></pre>\n\n<p>Output is as expected (try it on the <a href=\"https://play.golang.org/p/ECMg7lgaKx\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>map[localhost-tag:dev_latest localhost-vhost:localhost.com\n    development-tag:dev_latest development-vhost:dev.com]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": false, "score": 0, "last_activity_date": 1498918505, "last_edit_date": 1498918505, "creation_date": 1498913502, "answer_id": 44861146, "question_id": 44860050, "link": "https://stackoverflow.com/questions/44860050/create-a-map-of-string-from-a-json-with-unknow-key-values-in-go/44861146#44861146", "title": "create a map of string from a JSON with unknow key-values in Go", "body": "<p>Since in the question you mentioned <em>undefined number of unknown key-values</em>, you may need to deal with JSON document with unknown number of nesting level and having a value other than <code>string</code>. In this case, you need to <code>Unmarshal</code> json to <code>map[string]interface{}</code>, then use recursion to make <em>flat</em> map. Once the json document unmrashaled to <code>map[string]interface{}</code>, use the following function:</p>\n\n<pre><code>func flatMap(src map[string]interface{}, baseKey, sep string, dest map[string]string) {\n    for key, val := range src {\n        if len(baseKey) != 0 {\n            key = baseKey + sep + key\n        }\n        switch val := val.(type) {\n        case map[string]interface{}:\n            flatMap(val, key, sep, dest)\n        case string:\n            dest[key] = val\n        case fmt.Stringer:\n            dest[key] = val.String()\n        default:\n            //TODO: You may need to handle ARRAY/SLICE\n\n            //simply convert to string using `Sprintf`\n            //NOTE: modify as needed.\n            dest[key] = fmt.Sprintf(\"%v\", val)\n        }\n    }\n}\n</code></pre>\n\n<p>The working solution adapted from mattn answer at <a href=\"https://play.golang.org/p/9SQsbAUFdY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/9SQsbAUFdY</a></p>\n\n<p>As pointed by mattn, you may have problem when you want to writeback the configuration value. In that case, use the existing library/framework. </p>\n"}], "owner": {"reputation": 177, "user_id": 5395433, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-6-U7i6GI7U8/AAAAAAAAAAI/AAAAAAAAACk/V2Rf_c3c-H0/photo.jpg?sz=128", "display_name": "Valentin Ouvrard", "link": "https://stackoverflow.com/users/5395433/valentin-ouvrard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1780, "favorite_count": 0, "accepted_answer_id": 44860164, "answer_count": 3, "score": 2, "last_activity_date": 1498919682, "creation_date": 1498905967, "last_edit_date": 1498911422, "question_id": 44860050, "link": "https://stackoverflow.com/questions/44860050/create-a-map-of-string-from-a-json-with-unknow-key-values-in-go", "title": "create a map of string from a JSON with unknow key-values in Go", "body": "<p>I try to create a map of strings from a JSON with an undefined number of unknow key-values.</p>\n\n<p>Here is my example JSON file:</p>\n\n<pre><code>{\n         \"localhost\":\n        {\n                \"tag\": \"dev_latest\",\n                \"vhost\": \"localhost.com\"\n        },\n        \"development\":\n        {\n                \"tag\": \"dev_latest\",\n                \"vhost\": \"dev.com\"\n        }\n}\n</code></pre>\n\n<p>I want to create a <code>map[string]string</code> with value like this:</p>\n\n<pre><code>config := map[string]string{\n    \"localhost-tag\":      \"dev_latest\",\n    \"localhost-vhost\": \"localhost.com,\n    \"development-tag\":   \"dev_latest,\n    ...\n}\n</code></pre>\n\n<p>To parse a JSON with <code>\"github.com/jmoiron/jsonq\"</code> with known values, is quite easy, but in this case, <code>localhost</code> can be anything and <code>tag</code> can be any other thing.  </p>\n\n<p>My entry point in my Go code is like this:</p>\n\n<pre><code>func ParseJson(){\n    configPath := GetConfigPath()\n    b, err := ioutil.ReadFile(configPath) \n\n     //  Here, I need to create my map of strings..\n\n    return configKeyStr\n\n}\n</code></pre>\n\n<p>Any help will be really appreciate.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "mac-address"], "answers": [{"tags": [], "owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "is_accepted": true, "score": 9, "last_activity_date": 1498901865, "creation_date": 1498901865, "answer_id": 44859459, "question_id": 44859156, "link": "https://stackoverflow.com/questions/44859156/get-permanent-mac-address/44859459#44859459", "title": "Get permanent MAC address", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net\"\n)\n\nfunc getMacAddr() ([]string, error) {\n    ifas, err := net.Interfaces()\n    if err != nil {\n        return nil, err\n    }\n    var as []string\n    for _, ifa := range ifas {\n        a := ifa.HardwareAddr.String()\n        if a != \"\" {\n            as = append(as, a)\n        }\n    }\n    return as, nil\n}\n\nfunc main() {\n    as, err := getMacAddr()\n    if err != nil {\n        log.Fatal(err)\n    }\n    for _, a := range as {\n        fmt.Println(a)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 175, "user_id": 7679359, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f520fabd06a63cff622926ad580f909d?s=128&d=identicon&r=PG&f=1", "display_name": "Simone Romani", "link": "https://stackoverflow.com/users/7679359/simone-romani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5827, "favorite_count": 2, "accepted_answer_id": 44859459, "answer_count": 1, "score": 4, "last_activity_date": 1498912495, "creation_date": 1498899658, "last_edit_date": 1498912495, "question_id": 44859156, "link": "https://stackoverflow.com/questions/44859156/get-permanent-mac-address", "title": "Get permanent MAC address", "body": "<p>Is there an easy way to get the permanent MAC Address using Go?</p>\n"}, {"tags": ["sql", "database", "postgresql", "go", "transactions"], "comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 3, "creation_date": 1498896866, "post_id": 44858531, "comment_id": 76697644, "body": "how about splitting your function in two and running one after another in separate transactions? if the first one fails do not run the second."}, {"owner": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1498901091, "post_id": 44858531, "comment_id": 76698593, "body": "See my comment to your answer."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 2, "creation_date": 1498902169, "post_id": 44858531, "comment_id": 76698864, "body": "See <a href=\"https://github.com/golang/go/issues/7898\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/7898</a>. Sub(nested)-transaction is not yet supported, but you can use <code>SAVEPOINT</code> in PostgreSQL."}, {"owner": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1498905960, "post_id": 44858531, "comment_id": 76699792, "body": "@putu, is the solution I proposed the way to go?"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1498920809, "post_id": 44858531, "comment_id": 76703985, "body": "Yes, use the proposed method."}], "answers": [{"comments": [{"owner": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "edited": false, "score": 0, "creation_date": 1498901001, "post_id": 44858828, "comment_id": 76698562, "body": "The reason I&#39;d like to avoid this is that I insert a new row in Point A, and do not want that row to be modified before Point B is complete. If I have two distinct transactions, then someone else could possibly mess around with the row from Point B. Is it possible to use nested transactions?"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "edited": false, "score": 1, "creation_date": 1498906382, "post_id": 44858828, "comment_id": 76699903, "body": "In this case your possible solution using safepoints should work (if your database supports safepoints)."}, {"owner": {"reputation": 213390, "user_id": 642706, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/ZWEI3.jpg?s=128&g=1", "display_name": "Basil Bourque", "link": "https://stackoverflow.com/users/642706/basil-bourque"}, "edited": false, "score": 1, "creation_date": 1498926563, "post_id": 44858828, "comment_id": 76705780, "body": "Make that <a href=\"https://www.postgresql.org/docs/current/static/sql-savepoint.html\" rel=\"nofollow noreferrer\"><code>savepoint</code></a> (\u201cv\u201d not &quot;f\u201d)."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 2, "last_activity_date": 1498926453, "last_edit_date": 1498926453, "creation_date": 1498897085, "answer_id": 44858828, "question_id": 44858531, "link": "https://stackoverflow.com/questions/44858531/what-is-an-easy-way-to-commit-work-half-way-through-a-transaction-but-then-cont/44858828#44858828", "title": "What is an easy way to commit work half way through a transaction, but then continue to", "body": "<h1>Multiple transactions</h1>\n\n<p>You can split your work in two transactions:</p>\n\n<pre><code>func (s *store) SampleFunc(ctx context.Context) error {\n    err := s.runInTransaction(ctx,func(tx *sqlx.Tx) error {\n        // Point A: Do some database work\n    })\n    if err != nil {\n        return err\n    }\n    return s.runInTransaction(ctx,func(tx *sqlx.Tx) error {\n        // Point B: Do some more database work, which may return an error\n    })\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 1, "last_activity_date": 1498978346, "creation_date": 1498978346, "answer_id": 44868208, "question_id": 44858531, "link": "https://stackoverflow.com/questions/44858531/what-is-an-easy-way-to-commit-work-half-way-through-a-transaction-but-then-cont/44868208#44868208", "title": "What is an easy way to commit work half way through a transaction, but then continue to", "body": "<p>I had the problem alike: I had a lots of steps in one transaction. \nAfter starting transaction:</p>\n\n<ul>\n<li><code>BEGIN</code></li>\n<li><p>In loop:</p>\n\n<ul>\n<li><code>SAVEPOINT s1</code></li>\n<li>Some actions ....</li>\n<li>If I get an error: <code>ROLLBACK TO SAVEPOINT s1</code>  </li>\n<li>If OK go to next step</li>\n</ul></li>\n<li><p>Finally <code>COMMIT</code></p></li>\n</ul>\n\n<p>This approach gives me ability to perform all steps one-by-one. If some steps got failed I can throw away only them, keeping others. And finally commit all \"good\" work.</p>\n"}], "owner": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 856, "favorite_count": 0, "accepted_answer_id": 44868208, "answer_count": 2, "score": 3, "last_activity_date": 1499067446, "creation_date": 1498894605, "last_edit_date": 1499067446, "question_id": 44858531, "link": "https://stackoverflow.com/questions/44858531/what-is-an-easy-way-to-commit-work-half-way-through-a-transaction-but-then-cont", "title": "What is an easy way to commit work half way through a transaction, but then continue to", "body": "<h2>Background</h2>\n\n<p>I am using the <code>github.com/jmoiron/sqlx</code> golang package with a Postgres database. </p>\n\n<p>I have the following wrapper function to run SQL code in a transaction:</p>\n\n<pre><code>func (s *postgresStore) runInTransaction(ctx context.Context, fn func(*sqlx.Tx) error) error {\n    tx, err := s.db.Beginx()\n    if err != nil {\n        return err\n    }\n    defer func() {\n        if err != nil {\n            tx.Rollback()\n            return\n        }\n        err = tx.Commit()\n    }()\n    err = fn(tx)\n    return err\n}\n</code></pre>\n\n<p>Given this, consider the following code:</p>\n\n<pre><code>func (s *store) SampleFunc(ctx context.Context) error {\n    err := s.runInTransaction(ctx,func(tx *sqlx.Tx) error {\n\n        // Point A: Do some database work\n\n        if err := tx.Commit(); err != nil {\n            return err\n        }\n\n        // Point B: Do some more database work, which may return an error\n    })\n}\n</code></pre>\n\n<h2>Desired behavior</h2>\n\n<ul>\n<li>If there is an error at Point A, then the transaction should have done zero work</li>\n<li>If there is an error at Point B, then the transaction should still have completed the work at Point A.</li>\n</ul>\n\n<h2>Problem with current code</h2>\n\n<p>The code does not work as intended at the moment, because I am committing the transaction twice (once in <code>runInTransaction</code>, once in <code>SampleFunc</code>).</p>\n\n<h2>A Possible Solution</h2>\n\n<p>Where I commit the transaction, I could instead run something like <code>tx.Exec(\"SAVEPOINT my_savepoint\")</code>, then <code>defer tx.Exec(\"ROLLBACK TO SAVEPOINT my_savepoint\")</code></p>\n\n<p>After the code at Point B, I could run: <code>tx.Exec(\"RELEASE SAVEPOINT my_savepoint\")</code></p>\n\n<p>So, if the code at Point B runs without error, I will fail to <code>ROLLBACK</code> to my savepoint. </p>\n\n<h2>Problems with Possible Solution</h2>\n\n<p>I'm not sure if using savepoints will mess with the database/sql package's behavior. Also, my solution seems a bit messy -- surely there is a cleaner way to do this!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1498894100, "post_id": 44858142, "comment_id": 76697031, "body": "Just to make sure, how did you install the third party libraries? <code>go get github.com&#47;wayneashleyberry&#47;terminal-dimensions</code> ?"}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1498894184, "post_id": 44858142, "comment_id": 76697053, "body": "Look at <code>go run -x proj.go</code> and post the output here. Maybe there is something, that helps to find an answer."}, {"owner": {"reputation": 1872, "user_id": 4091324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/razpB.jpg?s=128&g=1", "display_name": "Darth Kotik", "link": "https://stackoverflow.com/users/4091324/darth-kotik"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1498895103, "post_id": 44858142, "comment_id": 76697262, "body": "@putu, yes, exactly"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1498895401, "post_id": 44858142, "comment_id": 76697328, "body": "How if you remove the <code>GOBIN</code> environment variable? I suppose you set both <code>GOPATH</code> and <code>GOBIN</code> in your bash env. Just remove the <code>GOBIN</code> part, then run <code>source</code> to update the env. If it&#39;s not the case, just ignore my comment."}, {"owner": {"reputation": 1872, "user_id": 4091324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/razpB.jpg?s=128&g=1", "display_name": "Darth Kotik", "link": "https://stackoverflow.com/users/4091324/darth-kotik"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1498895720, "post_id": 44858142, "comment_id": 76697413, "body": "@putu I manually ran <code>unset GOBIN</code>, now go env shows <code>GOBIN=&quot;&quot;</code>, but <code>go run</code> result is exactly the same"}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1498905431, "post_id": 44858142, "comment_id": 76699643, "body": "Try <code>go list -f {{.Dir}} github.com&#47;wayneashleyberry&#47;terminal-dimensions</code> and post the output."}, {"owner": {"reputation": 1872, "user_id": 4091324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/razpB.jpg?s=128&g=1", "display_name": "Darth Kotik", "link": "https://stackoverflow.com/users/4091324/darth-kotik"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1498907133, "post_id": 44858142, "comment_id": 76700104, "body": "@Krom, edited my question again. Also, Is it important that i have a subpackage inside my <code>proj</code> and i&#39;m importing <code>wayneashleyberry&#47;terminal-dimensions</code> inside it?"}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1498907339, "post_id": 44858142, "comment_id": 76700169, "body": "Do you make symbolic-link between GOPATH/GOROOT?"}, {"owner": {"reputation": 1872, "user_id": 4091324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/razpB.jpg?s=128&g=1", "display_name": "Darth Kotik", "link": "https://stackoverflow.com/users/4091324/darth-kotik"}, "reply_to_user": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 0, "creation_date": 1498907401, "post_id": 44858142, "comment_id": 76700190, "body": "@mattn, No, It&#39;s to different folders, no symlink"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1498958981, "post_id": 44858142, "comment_id": 76712817, "body": "It&#39;s quite strange behavior. How did you install <code>go</code>? from source or binary? If possible, try install another version of go. You can use <a href=\"https://github.com/moovweb/gvm\" rel=\"nofollow noreferrer\">Go Version Manager</a> to easily manage and install multiple version of go, and it will be installed under <code>~&#47;.gvm</code>."}, {"owner": {"reputation": 1872, "user_id": 4091324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/razpB.jpg?s=128&g=1", "display_name": "Darth Kotik", "link": "https://stackoverflow.com/users/4091324/darth-kotik"}, "edited": false, "score": 0, "creation_date": 1498981749, "post_id": 44858142, "comment_id": 76716125, "body": "Unfortunately I don&#39;t remember Ho did I install go, I&#39;m pretty sure I installed it from some ppa. I&#39;ll try to reinstall it"}, {"owner": {"reputation": 1872, "user_id": 4091324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/razpB.jpg?s=128&g=1", "display_name": "Darth Kotik", "link": "https://stackoverflow.com/users/4091324/darth-kotik"}, "edited": false, "score": 0, "creation_date": 1498983460, "post_id": 44858142, "comment_id": 76716470, "body": "I purged go and intalled it using <code>snap</code>.  It helped for some reason! Thank you!"}], "owner": {"reputation": 1872, "user_id": 4091324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/razpB.jpg?s=128&g=1", "display_name": "Darth Kotik", "link": "https://stackoverflow.com/users/4091324/darth-kotik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 114, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1507456047, "creation_date": 1498891561, "last_edit_date": 1507456047, "question_id": 44858142, "link": "https://stackoverflow.com/questions/44858142/third-party-packages-seems-to-be-searched-in-goroot", "title": "Third party packages seems to be searched in $GOROOT", "body": "<p>I created my first go project and try to use some external package </p>\n\n<pre><code>import terminal \"github.com/wayneashleyberry/terminal-dimensions\"\n</code></pre>\n\n<p>My project is in <code>/home/noname/Workspace/go/src/proj/proj.go</code></p>\n\n<p>go env looks fine </p>\n\n<pre><code>$ go env\nGOARCH=\"amd64\"\nGOBIN=\"/home/noname/Workspace/go/bin\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/noname/Workspace/go\"\nGORACE=\"\"\nGOROOT=\"/usr/lib/go-1.8\"\nGOTOOLDIR=\"/usr/lib/go-1.8/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build163861736=/tmp/go-build -gno-record-gcc-switches\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nPKG_CONFIG=\"pkg-config\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\n</code></pre>\n\n<p>but when I try to run it I see </p>\n\n<pre><code>$ go run proj.go \n# command-line-arguments\n/usr/lib/go-1.8/pkg/tool/linux_amd64/link: cannot open file /usr/lib/go-1.8/pkg/linux_amd64/github.com/wayneashleyberry/terminal-dimensions.a: open /usr/lib/go-1.8/pkg/linux_amd64/github.com/wayneashleyberry/terminal-dimensions.a: no such file or directory\n</code></pre>\n\n<p>This happens with any third-party library not necessary this one and I don't understand why. Seems like go searches for third-party package in <code>$GOROOT</code>  while package actually located exactly where docs says it should be </p>\n\n<pre><code>$ file $GOPATH/pkg/linux_amd64/github.com/wayneashleyberry/terminal-dimensions.a \n/home/noname/Workspace/go/pkg/linux_amd64/github.com/wayneashleyberry/terminal-dimensions.a: current ar archive\n</code></pre>\n\n<p>Sorry for newbie question</p>\n\n<p>EDIT: </p>\n\n<pre><code>$ go run -x proj.go \nWORK=/tmp/go-build340740598\nmkdir -p $WORK/_/home/noname/Workspace/go/src/proj/shell/_obj/\nmkdir -p $WORK/_/home/noname/Workspace/go/src/proj/\ncd /home/noname/Workspace/go/src/proj/shell\n/usr/lib/go-1.8/pkg/tool/linux_amd64/compile -o $WORK/_/home/noname/Workspace/go/src/proj/shell.a -trimpath $WORK -p _/home/noname/Workspace/go/src/proj/shell -complete -buildid efa1c0a0a5d82b27eb41cb592f4cb626ff98c64f -D _/home/noname/Workspace/go/src/proj/shell -I $WORK -I /home/noname/Workspace/go/pkg/linux_amd64 -pack ./input.go ./shell.go\nmkdir -p $WORK/command-line-arguments/_obj/\nmkdir -p $WORK/command-line-arguments/_obj/exe/\ncd /home/noname/Workspace/go/src/proj\n/usr/lib/go-1.8/pkg/tool/linux_amd64/compile -o $WORK/command-line-arguments.a -trimpath $WORK -p main -complete -buildid b280c68738f8469c481a1c4c407f43b16a476fdc -D _/home/noname/Workspace/go/src/proj -I $WORK -I \"\" -pack ./proj.go\ncd .\n/usr/lib/go-1.8/pkg/tool/linux_amd64/link -o $WORK/command-line-arguments/_obj/exe/proj -L $WORK -L \"\" -w -extld=gcc -buildmode=exe -buildid=b280c68738f8469c481a1c4c407f43b16a476fdc $WORK/command-line-arguments.a\n# command-line-arguments\n/usr/lib/go-1.8/pkg/tool/linux_amd64/link: cannot open file /usr/lib/go-1.8/pkg/linux_amd64/github.com/wayneashleyberry/terminal-dimensions.a: open /usr/lib/go-1.8/pkg/linux_amd64/github.com/wayneashleyberry/terminal-dimensions.a: no such file or directory\n</code></pre>\n\n<p>EDIT2: </p>\n\n<pre><code>$ go list -f {{.Dir}} github.com/wayneashleyberry/terminal-dimensions\n/home/noname/Workspace/go/src/github.com/wayneashleyberry/terminal-dimensions\n</code></pre>\n"}, {"tags": ["javascript", "jquery", "go", "jsonp"], "answers": [{"tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": false, "score": 1, "last_activity_date": 1498888274, "last_edit_date": 1498888274, "creation_date": 1498887813, "answer_id": 44857760, "question_id": 44857638, "link": "https://stackoverflow.com/questions/44857638/how-to-receive-a-jsonp-request-in-golang/44857760#44857760", "title": "How to receive a jsonp request in golang", "body": "<p><code>JSONP</code> is to receive data from the server not the other way around.</p>\n\n<p>You can read more about JSONP - <a href=\"https://en.wikipedia.org/wiki/JSONP\" rel=\"nofollow noreferrer\">Wikipedia</a>, <a href=\"https://stackoverflow.com/a/2067584\">SO Post</a> and <a href=\"https://www.sitepoint.com/jsonp-examples/\" rel=\"nofollow noreferrer\">JSONP examples</a>.</p>\n\n<p>Actually it's not specific to Go language, you can implement JSONP handling in any server-side programing.</p>\n\n<hr>\n\n<p>For your purpose, it seems you need JSON Post request from JavaScript/Jquery. And on Go lang handler do-</p>\n\n<pre><code>func recordGeo(w http.ResponseWriter, req *http.Request) {\n    decoder := json.NewDecoder(req.Body)\n    var geoRec geoData\n    if err := decoder.Decode(&amp;geoRec); err != nil {\n        fmt.Println(err)\n    }\n    defer req.Body.Close()\n    fmt.Println(geoRec)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "edited": false, "score": 0, "creation_date": 1498913468, "post_id": 44857811, "comment_id": 76701930, "body": "Even with removing the info.Println i still have the same EOF error ..."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "reply_to_user": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "edited": false, "score": 0, "creation_date": 1498914459, "post_id": 44857811, "comment_id": 76702195, "body": "@user462794 to debug, just after <code>recordGeo</code> function, use <a href=\"https://golang.org/pkg/io/ioutil/#ReadAll\" rel=\"nofollow noreferrer\">ioutil.ReadAll</a> to read the content of the request body, then print it to the console and post it here."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "reply_to_user": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "edited": false, "score": 1, "creation_date": 1498917072, "post_id": 44857811, "comment_id": 76702921, "body": "@user462794 I&#39;ve edit the answer, please take a look"}, {"owner": {"reputation": 288, "user_id": 1792397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/975e56903102e58d3ffd73a756ed28f5?s=128&d=identicon&r=PG", "display_name": "spekary", "link": "https://stackoverflow.com/users/1792397/spekary"}, "edited": false, "score": 1, "creation_date": 1514014440, "post_id": 44857811, "comment_id": 82870804, "body": "fmt.Sprintf rather than fmt.Printf near the end"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "reply_to_user": {"reputation": 288, "user_id": 1792397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/975e56903102e58d3ffd73a756ed28f5?s=128&d=identicon&r=PG", "display_name": "spekary", "link": "https://stackoverflow.com/users/1792397/spekary"}, "edited": false, "score": 0, "creation_date": 1514091940, "post_id": 44857811, "comment_id": 82885687, "body": "@spekary, Thank you. Answer was modified."}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 1, "last_activity_date": 1514091857, "last_edit_date": 1514091857, "creation_date": 1498888317, "answer_id": 44857811, "question_id": 44857638, "link": "https://stackoverflow.com/questions/44857638/how-to-receive-a-jsonp-request-in-golang/44857811#44857811", "title": "How to receive a jsonp request in golang", "body": "<p>There is a problem in your <code>golang</code> code, the following lines:</p>\n\n<pre><code>decoder := json.NewDecoder(r.Body)\nInfo.Println(r.Body)\nerr := decoder.Decode(&amp;geoRec)\n</code></pre>\n\n<p>Both <code>Info.Println</code> and <code>decoder.Decode</code> read from request body which is an <code>io.Reader</code>. After the execution of <code>Info.Println</code>, the reader is at <code>EOF</code> state. From this point, any further <code>Read</code> will result in <code>EOF</code> error, the error you saw in your application. If you remove (comment out) <code>Info.Println</code>, you will be able to decode the data to the struct. </p>\n\n<p><strong>EDIT:</strong><br>\nI forgot and didn't paying attention that JSONP is <code>GET</code> request. The JSON data is embedded in the query. Try the following approach to extract JSON data (please adapt to your need).</p>\n\n<pre><code>//snippet inside recordGeo function\n//...\n\ncallback := \"\"\ngeoRec := geoData{}\nqueries := r.URL.Query()\n\n//See http://api.jquery.com/jQuery.ajax/\n//for 'jsonp' data type parameters.\nfor key, val := range queries {\n    if key == \"callback\" {\n        callback = val[0]\n    } else if key == \"_\" {\n        //the Timestamp\n    } else {\n        //JSON data in the key\n        dec := json.NewDecoder(bytes.NewBufferString(key))\n        err := dec.Decode(&amp;geoRec)\n        if err != nil {\n            log.Println(err)\n        }\n        log.Printf(\"DATA=%#v\", geoRec)\n    }\n}\n\n//...\n//do some processing\nresponse := \"{YOUR RESPONSE DATA}\"\nif callback != \"\" {\n    w.Header().Set(\"Content-Type\", \"application/javascript\")\n    response = fmt.Sprintf(\"%s(%s);\", callback, response)\n}\nw.Write([]byte(response))\n</code></pre>\n\n<p>If in the client side you set the data as <code>data: pfg</code> (without <code>JSON.stringify</code>), then in the server side, each parameter will be accessible through query parameter: </p>\n\n<pre><code>//\nlon := queries.Get(\"lo\")\nlat := queries.Get(\"la\")\nacc := queries.Get(\"ac\")\n</code></pre>\n\n<p>OR, if you set the AJAX request data as <code>data: \"mydata=\" + JSON.stringify(pfg)</code>, then you can extract the data as:</p>\n\n<pre><code>mydata := queries.Get(\"mydata\")\ndec := json.NewDecoder(bytes.NewBufferString(mydata))\nerr := dec.Decode(&amp;geoRec)\n</code></pre>\n\n<p>After processing, you need to send a proper JSONP response to the client, i.e. <code>callback(DATA);</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 300, "user_id": 1123059, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bb7L2.jpg?s=128&g=1", "display_name": "Zalberth", "link": "https://stackoverflow.com/users/1123059/zalberth"}, "is_accepted": false, "score": 1, "last_activity_date": 1542542204, "creation_date": 1542542204, "answer_id": 53360594, "question_id": 44857638, "link": "https://stackoverflow.com/questions/44857638/how-to-receive-a-jsonp-request-in-golang/53360594#53360594", "title": "How to receive a jsonp request in golang", "body": "<p>I've encountered the same issue. Then I found the echo framework (namely <code>github.com/labstack/echo</code> package and its middleware) which can perfectly handle the jsonp request. Here is the demo, <a href=\"https://echo.labstack.com/cookbook/jsonp\" rel=\"nofollow noreferrer\">cook for jsonp</a></p>\n\n<p>Hope this could help.</p>\n"}], "owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1152, "favorite_count": 1, "accepted_answer_id": 44857811, "answer_count": 3, "score": 0, "last_activity_date": 1542542204, "creation_date": 1498886647, "last_edit_date": 1498913810, "question_id": 44857638, "link": "https://stackoverflow.com/questions/44857638/how-to-receive-a-jsonp-request-in-golang", "title": "How to receive a jsonp request in golang", "body": "<p>I send some data using jquery in the jsonp format  : </p>\n\n<pre><code>console.log(data.location.lng);\nconsole.log(data.location.lat);\nconsole.log(data.accuracy);\nvar urlgr = \"http://127.0.0.1:9220/geo/rec_geo/\";\nvar pfg = {\n    //lo: data.location.lng,\n    lo: 1.0,\n    //la: data.location.lat,\n    la: 2.0,\n    //ac: data.accuracy,\n    ac: 3,\n};\n$.ajax({\n    type: 'GET',\n    url: urlgr,\n    crossDomain: true,\n    data: JSON.stringify(pfg),\n    dataType: 'jsonp',\n    contentType: \"application/json; charset=utf-8\",\n    success: function (data) {\n        console.log(\"data rec geo\");\n        console.log(data);\n\n    }\n});\n</code></pre>\n\n<p>here is my code in golang to receive it  :</p>\n\n<pre><code>type geoData struct {\n    Long float32 `json:\"lo\"`\n    Lat   float32  `json:\"la\"`\n    Accuracy  int `json:\"ac\"`\n}\n\nfunc recordGeo(w http.ResponseWriter, r *http.Request) {\n    s := strings.Split(r.RemoteAddr, \":\")\n    ip := s[0]\n    Info.Println(\"4\")\n    var geoRec geoData\n    decoder := json.NewDecoder(r.Body)\n    err := decoder.Decode(&amp;geoRec)\n    fmt.Println(\"geoRec\")\n    fmt.Println(geoRec)\n    checkErr(err)\n}\n</code></pre>\n\n<p>but i have a EOF error  :</p>\n\n<pre><code>2017/07/01 07:16:22 http: panic serving 127.0.0.1:50680: EOF\n</code></pre>\n\n<p>So my question is how to properly receive a jsonp request in golang and parse it to a struct ?</p>\n\n<p>here is the request that i get in the golang server side  :</p>\n\n<pre><code>GET /geo/rec_geo/?callback=jQuery31108538596418163691_1498913991164&amp;{%22lo%22:1,%22la%22:2,%22ac%22:3}&amp;_=1498913991166 HTTP/1.1\nHost: 127.0.0.1:9220\nuser-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36\naccept-encoding: gzip, deflate, sdch, br\naccept-language: fr-FR,fr;q=0.8,en-US;q=0.6,en;q=0.4\nreferer: http://localhost:8080/\ncookie: csrftoken=Y7WA181u22l9sScw9UbPxM38wCGQzjaLMMysAesJSWZm89Pj6CCdBkEF01ibpUjW\nalexatoolbar-alx_ns_ph: AlexaToolbar/alx-4.0.1\nconnection: keep-alive\n</code></pre>\n\n<p>edit removed the : \nInfo.Println line\nbut i still have the same error</p>\n\n<p>thanks</p>\n"}, {"tags": ["linux", "bash", "go", "command-line"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 6, "last_activity_date": 1498887397, "last_edit_date": 1498887397, "creation_date": 1498886983, "answer_id": 44857672, "question_id": 44857538, "link": "https://stackoverflow.com/questions/44857538/building-all-code-with-go-and/44857672#44857672", "title": "Building all code with Go and &#39;./...&#39;", "body": "<p>That will install any \"<code>main</code>\" packages found in the current or subdirectories, </p>\n\n<p>\"subdirectories\": that is what the <code>./...</code> syntax means.<br>\nIt forces <code>go install</code> to consider not just the current folder/package ('.'), but also the ones in the sub-folders: \"<code>...</code>\"</p>\n\n<p>See \"<a href=\"https://stackoverflow.com/a/14870666/6309\">What is a sensible way to layout a Go project</a>\": you can have multiple packages \"<code>main</code>\", in a library driven development:</p>\n\n<blockquote>\n  <p>Moving the <code>main.go</code> file out of your root allows you to build your application from the perspective of a library. Your application binary is simply a client of your application\u2019s library.</p>\n  \n  <p>Sometimes you might want users to interact in multiple ways so you create multiple binaries.<br>\n  For example, if you had an \u201cadder\u201d package that that let users add numbers together, you may want to release a command line version as well as a web version.<br>\n  You can easily do this by organizing your project like this:</p>\n</blockquote>\n\n<pre><code>adder/\n  adder.go\n  cmd/\n    adder/\n      main.go\n    adder-server/\n      main.go\n</code></pre>\n\n<blockquote>\n  <p>Users can install your \u201cadder\u201d application binaries with \u201cgo get\u201d using an ellipsis:</p>\n\n<pre><code>$ go get github.com/benbjohnson/adder/...\n</code></pre>\n  \n  <p>And voila, your user has \u201cadder\u201d and \u201cadder-server\u201d installed!</p>\n</blockquote>\n\n<p>Similarly, a <code>go install -v ./...</code> would install \u201cadder\u201d and \u201cadder-server\u201d as well.</p>\n\n<p>Note: the <code>-v</code> print the names of packages as they are compiled.</p>\n"}], "owner": {"reputation": 53, "user_id": 4010104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e508eb43d1d709aa7809963a8c506319?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Shen", "link": "https://stackoverflow.com/users/4010104/jason-shen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 1, "accepted_answer_id": 44857672, "answer_count": 1, "score": 5, "last_activity_date": 1498887830, "creation_date": 1498885616, "last_edit_date": 1498887830, "question_id": 44857538, "link": "https://stackoverflow.com/questions/44857538/building-all-code-with-go-and", "title": "Building all code with Go and &#39;./...&#39;", "body": "<p>According to <a href=\"https://github.com/ethereum/go-ethereum/wiki/Developers&#39;-Guide\" rel=\"nofollow noreferrer\">Ethereum Developers' Guide</a>:</p>\n\n<blockquote>\n  <p>You can build all code using the go tool, placing the resulting binary\n  in $GOPATH/bin.</p>\n\n<pre><code>go install -v ./...\n</code></pre>\n</blockquote>\n\n<p>What does <code>./...</code> do in the context of:</p>\n\n<pre><code>go install -v ./...\n</code></pre>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 1, "creation_date": 1498871968, "post_id": 44856124, "comment_id": 76693686, "body": "just a friendly reminder Cgo is not Go <a href=\"https://dave.cheney.net/2016/01/18/cgo-is-not-go\" rel=\"nofollow noreferrer\">dave.cheney.net/2016/01/18/cgo-is-not-go</a> <a href=\"https://blog.golang.org/c-go-cgo\" rel=\"nofollow noreferrer\">blog.golang.org/c-go-cgo</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 1, "creation_date": 1498875053, "post_id": 44856124, "comment_id": 76694115, "body": "Why is there no +10 option for your comment? I&#39;d pay rep to upvote that even once more. @YandryPozo"}, {"owner": {"reputation": 61, "user_id": 3827422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/608d8a8c668ad3684adb7f380142eda9?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaoqin Zhu", "link": "https://stackoverflow.com/users/3827422/xiaoqin-zhu"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1498891858, "post_id": 44856124, "comment_id": 76696464, "body": "@YandryPozo Appreciated, just experienced &quot;Combing Go code and C code results in the intersection of both worlds, not the union; the memory safety of C, and the debuggability of a Go program.&quot; in past few days... although I love the first paragraph most :)"}], "answers": [{"tags": [], "owner": {"reputation": 141, "user_id": 1527420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2cfb4f09c60d3ea8ef1dd5ea0c773d6?s=128&d=identicon&r=PG", "display_name": "James Fennell", "link": "https://stackoverflow.com/users/1527420/james-fennell"}, "is_accepted": false, "score": 1, "last_activity_date": 1617927887, "creation_date": 1617927887, "answer_id": 67013491, "question_id": 44856124, "link": "https://stackoverflow.com/questions/44856124/can-i-change-default-compiler-used-by-cgo/67013491#67013491", "title": "Can I change default compiler used by cgo?", "body": "<p>The C or C++ compiler used by <code>cgo</code> can be specified using the <code>CC</code> and <code>CXX</code> environment variables respectively. For example, to use Clang:</p>\n<pre><code>CC=clang go build path/to/cgo/dependent/code.go\n</code></pre>\n<p>The variables can also specify flags to be passed to the compilers; for example, to run GCC with optimizations:</p>\n<pre><code>CC=&quot;gcc -O2&quot; go build path/to/cgo/dependent/code.go\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 3827422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/608d8a8c668ad3684adb7f380142eda9?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaoqin Zhu", "link": "https://stackoverflow.com/users/3827422/xiaoqin-zhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1824, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1617927887, "creation_date": 1498866815, "question_id": 44856124, "link": "https://stackoverflow.com/questions/44856124/can-i-change-default-compiler-used-by-cgo", "title": "Can I change default compiler used by cgo?", "body": "<p>I am trying to execute cgo code under ubuntu 14.04, it seems like cgo assume <code>CC/CXX</code> to be <code>gcc/g++</code>. And I need to explicitly specify <code>CC/CXX</code> in order to use, say, clang. Can I configure default compiler used through go's build constraints?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "apache-zookeeper", "apache-curator"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 3, "creation_date": 1498878965, "post_id": 44856087, "comment_id": 76694493, "body": "I&#39;m not familiar with these libraries, but after perusing the code for a bit I have a question. Do you need it to discard the <code>zk.Conn</code> entirely and dial up a new one, or do you need it to persist and allow for reconnection. If you want to discard, then your issue is likely with <code>github.com&#47;curator-go&#47;curator</code>, else the issue lies in <code>github.com&#47;samuel&#47;go-zookeeper</code>. I&#39;m not sure if I can really help much here, but it might be something you can address with the other library."}, {"owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1499047955, "post_id": 44856087, "comment_id": 76732177, "body": "I think either would work. That distinction makes sense to me as a good starting point for solving this."}, {"owner": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 2, "creation_date": 1499073545, "post_id": 44856087, "comment_id": 76741876, "body": "I think that easy way to solve this problem is make fork of go-zookeeper since this issue has been filed in a long time ago. <a href=\"https://github.com/samuel/go-zookeeper/issues/148\" rel=\"nofollow noreferrer\">github.com/samuel/go-zookeeper/issues/148</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 6973, "user_id": 720391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lGHly.png?s=128&g=1", "display_name": "mattn", "link": "https://stackoverflow.com/users/720391/mattn"}, "edited": false, "score": 1, "creation_date": 1499122456, "post_id": 44856087, "comment_id": 76767499, "body": "I agree with @mattn that forking it and fixing it for your use-case might be the easiest solution short-term, but you could run into trouble down the line unless you fully understand the ramifications of the changes you make. Use caution, minimize the modifications, and test as best as you can."}], "answers": [{"tags": [], "owner": {"reputation": 1157, "user_id": 5932433, "user_type": "registered", "profile_image": "https://graph.facebook.com/10102241209130737/picture?type=large", "display_name": "thejohnbackes", "link": "https://stackoverflow.com/users/5932433/thejohnbackes"}, "is_accepted": false, "score": 1, "last_activity_date": 1519072414, "creation_date": 1519072414, "answer_id": 48873753, "question_id": 44856087, "link": "https://stackoverflow.com/questions/44856087/how-to-avoid-double-connection-close-upon-regaining-connectivity/48873753#48873753", "title": "How to avoid double connection close upon regaining connectivity?", "body": "<p>zk.Conn has a State() method that returns an enum \"State\", which is one of the following:</p>\n\n<pre><code>type State int32\nconst (\n    StateUnknown           State = -1\n    StateDisconnected      State = 0\n    StateConnecting        State = 1\n    StateAuthFailed        State = 4\n    StateConnectedReadOnly State = 5\n    StateSaslAuthenticated State = 6\n    StateExpired           State = -112\n\n    StateConnected  = State(100)\n    StateHasSession = State(101)\n)\n</code></pre>\n\n<p>What state is \"conn\" in when goroutine B calls conn.Close()?</p>\n\n<p>A possible solution would be to add a switch to goroutine B whereby you do not call conn.Close() if you are in conn.StateConnecting.</p>\n"}], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 844, "favorite_count": 2, "answer_count": 1, "score": 12, "last_activity_date": 1520219110, "creation_date": 1498866397, "last_edit_date": 1520219110, "question_id": 44856087, "link": "https://stackoverflow.com/questions/44856087/how-to-avoid-double-connection-close-upon-regaining-connectivity", "title": "How to avoid double connection close upon regaining connectivity?", "body": "<p>Under these circumstances:</p>\n\n<ol>\n<li>The client loses network connectivity to zk.</li>\n<li>One minute passes.</li>\n<li>The client regains network connectivity to zk.</li>\n</ol>\n\n<p>I'm getting the following panic:</p>\n\n<pre><code>panic: close of closed channel\n\ngoroutine 2849 [running]:\ngithub.com/samuel/go-zookeeper/zk.(*Conn).Close(0xc420795180)\n  github.com/samuel/go-zookeeper/zk/conn.go:253 47\ngithub.com/curator-go/curator.(*handleHolder).internalClose(0xc4203058f0, 0xc420302470, 0x0)\n  github.com/curator-go/curator/state.go:136 +0x8d\ngithub.com/curator-go/curator.(*handleHolder).closeAndReset(0xc4203058f0, 0xc42587cd00, 0x1e)\n  github.com/curator-go/curator/state.go:122 +0x2f\ngithub.com/curator-go/curator.(*connectionState).reset(0xc420302420, 0x1b71d87, 0xf)\n  github.com/curator-go/curator/state.go:234 +0x55\ngithub.com/curator-go/curator.(*connectionState).handleExpiredSession(0xc420302420)\n  github.com/curator-go/curator/state.go:351 +0xd9\ngithub.com/curator-go/curator.(*connectionState).checkState(0xc420302420, 0xffffff90, 0x0, 0x0, 0xc425ed2600, 0xed0e5250a)\n  github.com/curator-go/curator/state.go:318 +0x9c\ngithub.com/curator-go/curator.(*connectionState).process(0xc420302420, 0xc425ed2680)\n  github.com/curator-go/curator/state.go:299 +0x16d\ncreated by github.com/curator-go/curator.(*Watchers).Fire\n  github.com/curator-go/curator/watcher.go:64 +0x96\n</code></pre>\n\n<p>This is the detailed sequence of events:</p>\n\n<ol>\n<li>The client loses network connectivity to zk.</li>\n<li>One minute passes.</li>\n<li>The client regains network connectivity to zk.</li>\n<li>goroutine A calls <code>s.ReregisterAll()</code> -> <code>Conn()</code> -> <code>checkTimeout()</code> -> <code>reset</code> (bc 1 minute has elapsed) -> <code>closeAndReset()</code> -> <code>conn.Close()</code> <strong>which can block for a second</strong></li>\n<li>goroutine B handles <code>zk.StateExpired</code> (zk cluster sends this bc it considers this client as dead since it didn't ping during 2.) -> <code>reset</code> -> <code>closeAndReset()</code> -> <code>conn.Close()</code> which causes a panic because <code>conn.Close()</code> already closed the connection's <code>c.shouldQuit</code> channel AND <code>s.zooKeeper.getZookeeperConnection</code> was never called by goroutine A because it was blocking for the second so there's no new connection.</li>\n</ol>\n\n<p>A naive solution I tried is to just use a mutex on <code>reset</code>, but now I'm getting <code>helper.GetConnectionString()</code> equal to empty string. What's the best way to avoid this crash and try to get into a good state when the client loses and then regains network connectivity? Should the fix be in <a href=\"http://github.com/samuel/go-zookeeper\" rel=\"noreferrer\">github.com/samuel/go-zookeeper</a>'s implementation of not letting you close an already closed connection?</p>\n\n<p>(I've filed this issue <a href=\"https://github.com/curator-go/curator/issues/4\" rel=\"noreferrer\">here</a>, but the project seems to be lacking in terms of discussion so I'm asking on SO.)</p>\n"}]