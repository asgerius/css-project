[{"tags": ["go", "xml-parsing"], "answers": [{"comments": [{"owner": {"reputation": 4438, "user_id": 1406230, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/8fbcc1549468867effa0faa392015033?s=128&d=identicon&r=PG", "display_name": "Bilal Akil", "link": "https://stackoverflow.com/users/1406230/bilal-akil"}, "edited": false, "score": 1, "creation_date": 1478754454, "post_id": 40520055, "comment_id": 68281809, "body": "Ohhh, this is a great start! I&#39;ll look for any ways to make it more pretty and get back to you :D Thanks so much!"}, {"owner": {"reputation": 4438, "user_id": 1406230, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/8fbcc1549468867effa0faa392015033?s=128&d=identicon&r=PG", "display_name": "Bilal Akil", "link": "https://stackoverflow.com/users/1406230/bilal-akil"}, "edited": false, "score": 0, "creation_date": 1478756431, "post_id": 40520055, "comment_id": 68282322, "body": "Let&#39;s pretend we&#39;re working with <code>os.Stdin</code> here - so you can&#39;t quite open it as two files (unless there was a way to do that? :O), but you could do something similar if you were tricky. Looks like that&#39;s what the multiwriter is doing anyway."}, {"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "reply_to_user": {"reputation": 4438, "user_id": 1406230, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/8fbcc1549468867effa0faa392015033?s=128&d=identicon&r=PG", "display_name": "Bilal Akil", "link": "https://stackoverflow.com/users/1406230/bilal-akil"}, "edited": false, "score": 0, "creation_date": 1478756585, "post_id": 40520055, "comment_id": 68282369, "body": "ah, then yes I think you&#39;ll need that copying to <code>ioutil.Discard</code> sillyness after all"}], "tags": [], "owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "is_accepted": false, "score": 1, "last_activity_date": 1478754538, "last_edit_date": 1478754538, "creation_date": 1478752687, "answer_id": 40520055, "question_id": 40517885, "link": "https://stackoverflow.com/questions/40517885/retrieving-the-outerxml-of-an-element-like-innerxml-but-including-the-elemen/40520055#40520055", "title": "Retrieving the &quot;outerxml&quot; of an element (like innerxml, but including the element itself)", "body": "<p>A rather crude approach is to save the offsets and just read those bytes, by asking the decoder for <a href=\"https://golang.org/pkg/encoding/xml/#Decoder.InputOffset\" rel=\"nofollow noreferrer\">the offset</a> before the start element and after the end element.</p>\n\n<p>See <a href=\"https://play.golang.org/p/1n-I44oeDZ\" rel=\"nofollow noreferrer\">this playground example</a>, which fans out the reader into two pipes, one of which goes to the XML decoder while the other pipeline is buffered and then used for extracting byte ranges corresponding to XML elements.</p>\n\n<p>The XML decoding routine then writes pairs of offsets on a channel, which another thread uses to skip or output regions of interest from the copy of the reader stream. This should probably be done more seriously than the hack job I did, i.e. by using a stack and matching filter criteria.</p>\n\n<p>This solution assumes <code>Seek</code>/<code>ReadAt</code> are not viable, in retrospect I probably overdid it there, this would be much simpler if you just opened the file twice, assuming it is a file.</p>\n"}, {"tags": [], "owner": {"reputation": 4438, "user_id": 1406230, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/8fbcc1549468867effa0faa392015033?s=128&d=identicon&r=PG", "display_name": "Bilal Akil", "link": "https://stackoverflow.com/users/1406230/bilal-akil"}, "is_accepted": true, "score": 2, "last_activity_date": 1478776547, "creation_date": 1478776547, "answer_id": 40526247, "question_id": 40517885, "link": "https://stackoverflow.com/questions/40517885/retrieving-the-outerxml-of-an-element-like-innerxml-but-including-the-elemen/40526247#40526247", "title": "Retrieving the &quot;outerxml&quot; of an element (like innerxml, but including the element itself)", "body": "<p>Inspired by @nothingmuch's usage of <code>decoder.InputOffset</code>, I use a <code>TeeReader</code> to split the input <code>Reader</code> into two: the standard which gets parsed through the decoder, and a buffer that we'll use to output the exact element (which lies between the <code>decoder.InputOffset</code> before and after the element is encountered).</p>\n\n<p>To minimise memory usage, the buffer is continuously cleared <em>only up to the point we know is not potentially matching</em>. We maintain offsets to keep track of this. This added complexity is necessary because the decoder can grab bytes from the reader further ahead of the token at hand, so we need to be careful not to clear something we actually need.</p>\n\n<p>So the additional memory usage is only as much as:</p>\n\n<ol>\n<li>The largest two tokens that may be simultaneously stored in the buffer before it's cleared back to one.</li>\n<li>The size of the actual element being output.</li>\n</ol>\n\n<p>Here's an updated playground with the solution:</p>\n\n<p><a href=\"https://play.golang.org/p/H8WVDWI57r\" rel=\"nofollow noreferrer\">https://play.golang.org/p/H8WVDWI57r</a></p>\n"}], "owner": {"reputation": 4438, "user_id": 1406230, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/8fbcc1549468867effa0faa392015033?s=128&d=identicon&r=PG", "display_name": "Bilal Akil", "link": "https://stackoverflow.com/users/1406230/bilal-akil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 40526247, "answer_count": 2, "score": 1, "last_activity_date": 1478776547, "creation_date": 1478735162, "last_edit_date": 1478756385, "question_id": 40517885, "link": "https://stackoverflow.com/questions/40517885/retrieving-the-outerxml-of-an-element-like-innerxml-but-including-the-elemen", "title": "Retrieving the &quot;outerxml&quot; of an element (like innerxml, but including the element itself)", "body": "<p>I've got a Go program that's working with an input stream, i.e. <code>os.Stdin</code>: a very large XML file, so I can't process it all at once.</p>\n\n<p>I'm wanting to extract all XML elements of a certain nature for post-processing.</p>\n\n<p>I've got no trouble identifying the elements for extraction, and getting the related start and end element. However I'm not sure how to dump the <em>whole element</em> as a string, as opposed to only the inner XML.</p>\n\n<p>For instance, imagine I have the following XML:</p>\n\n<pre><code>&lt;a&gt;\n  &lt;b somethingUseful=\"1\"&gt;\n    &lt;c&gt;Hello&lt;/c&gt;\n    &lt;d&gt;world&lt;/d&gt;\n  &lt;/b&gt;\n  &lt;e&gt;\n    &lt;foo/&gt;\n  &lt;/e&gt;\n  &lt;!-- Imagine there were 1 billion lines in between -\n       I need to stream this! --&gt;\n  &lt;b somethingUseful=\"321\"&gt;\n    &lt;c&gt;Hello again&lt;/c&gt;\n  &lt;/b&gt;\n&lt;/a&gt;\n</code></pre>\n\n<p>In this example, I want to output each of the <code>&lt;b&gt;</code> elements, from start to finish.</p>\n\n<p>Using <code>innerxml</code> with <code>DecodeElement</code>, I'm able to get this far, in a streaming fashion:</p>\n\n<pre><code>Here comes a B:\n\n    &lt;c&gt;Hello&lt;/c&gt;\n    &lt;d&gt;world&lt;/d&gt;\n\nHere comes a B:\n\n    &lt;c&gt;Hello again&lt;/c&gt;\n</code></pre>\n\n<p>So close, but it's missing the <code>&lt;b&gt;</code> tag (and attributes) itself. I haven't been able to figure out how to make that last step without sacrificing the streaming nature of the decoding.</p>\n\n<p>To be clear, the output that I desire is something like:</p>\n\n<pre><code>Here comes a B:\n  &lt;b somethingUseful=\"1\"&gt;\n    &lt;c&gt;Hello&lt;/c&gt;\n    &lt;d&gt;world&lt;/d&gt;\n  &lt;/b&gt;\nHere comes a B:\n  &lt;b somethingUseful=\"321\"&gt;\n    &lt;c&gt;Hello again&lt;/c&gt;\n  &lt;/b&gt;\n</code></pre>\n\n<p>Here's a playground that enunciates this example and what I've done in getting this far:</p>\n\n<p><a href=\"https://play.golang.org/p/XqJY_1pa9j\" rel=\"nofollow noreferrer\">https://play.golang.org/p/XqJY_1pa9j</a></p>\n"}, {"tags": ["google-maps", "go"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 7138537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6ede12e9ff8dcbb9f15c1b3e5155184?s=128&d=identicon&r=PG&f=1", "display_name": "user7138537", "link": "https://stackoverflow.com/users/7138537/user7138537"}, "is_accepted": false, "score": -1, "last_activity_date": 1478745352, "creation_date": 1478745352, "answer_id": 40519140, "question_id": 40516804, "link": "https://stackoverflow.com/questions/40516804/golang-google-maps-api-arrive-by/40519140#40519140", "title": "Golang Google Maps API Arrive By", "body": "<p>It would appear this is a limitation of the Google Maps API, not the Go client. For those who see this question in the future, experiment with different combinations of parameters (leaving different ones out) until it works.</p>\n"}], "owner": {"reputation": 1, "user_id": 7138537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6ede12e9ff8dcbb9f15c1b3e5155184?s=128&d=identicon&r=PG&f=1", "display_name": "user7138537", "link": "https://stackoverflow.com/users/7138537/user7138537"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 476, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1478745352, "creation_date": 1478729156, "question_id": 40516804, "link": "https://stackoverflow.com/questions/40516804/golang-google-maps-api-arrive-by", "title": "Golang Google Maps API Arrive By", "body": "<p>I've written some code in Golang to get directions from one place to another using the Google Maps API. According to the <a href=\"https://godoc.org/googlemaps.github.io/maps#DirectionsRequest\" rel=\"nofollow noreferrer\">Godoc</a>, both the <code>DepartureTime</code> and <code>ArrivalTime</code> parameters are optional. However, if I try to make any request without specifying the departure time, the code fails, giving me the following error message: <code>INVALID_REQUEST - Invalid request. Missing the 'departure_time' parameter</code>. Here's the relevant code:</p>\n\n<pre><code>client, err := maps.NewClient(maps.WithAPIKey(apiKey), maps.WithRateLimit(2))\ncheck(err, \"new maps client\")\n\nr := &amp;maps.DirectionsRequest{\n    Origin:       origin,\n    Destination:  destination,\n    ArrivalTime:  arrivalTime,\n    Alternatives: alternatives,\n    Mode:         maps.TravelModeDriving,\n}\n\nlookupTrafficModel(trafficModel, r)\n\nif avoid != \"\" {\n    lookupAvoidPoints(avoid, r)\n}\n\n//THIS LINE IS WHERE THE ERROR IS THROWN\nroutes, waypoints, err := client.Directions(context.Background(), r)\ncheck(err, \"getting directions\")\n\nfmt.Println(waypoints)\nfmt.Println(routes)\n</code></pre>\n\n<p>Note that if I comment out the <code>ArrivalTime</code> parameter and instead use <code>DepartureTime: \"now\",</code> (as per the Godoc), this code works as expected. </p>\n"}, {"tags": ["c++", "arrays", "go", "reference"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1478720652, "post_id": 40514555, "comment_id": 68271221, "body": "Have you gone through any of the documentation, like the <a href=\"https://golang.org/doc/effective_go.html#slices\" rel=\"nofollow noreferrer\">Slices section in &quot;Effective Go&quot;</a>, the <a href=\"https://tour.golang.org/moretypes/7\" rel=\"nofollow noreferrer\">&quot;Tour of Go&quot; section on slices</a>, the <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">Slice specification</a>, or even the <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">Go blog post about slices</a>?"}], "answers": [{"tags": [], "owner": {"reputation": 8852, "user_id": 1383240, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/41093f55db0d5feaa0012ed6b5c3ca5c?s=128&d=identicon&r=PG&f=1", "display_name": "NiVeR", "link": "https://stackoverflow.com/users/1383240/niver"}, "is_accepted": false, "score": 1, "last_activity_date": 1478720575, "creation_date": 1478720575, "answer_id": 40514752, "question_id": 40514555, "link": "https://stackoverflow.com/questions/40514555/golang-passing-arrays-to-the-function-and-modifying-it/40514752#40514752", "title": "Golang passing arrays to the function and modifying it", "body": "<p>What you are defining is not <code>array</code> but a <code>slice</code> of an array which is passed by reference as specified in golang documentation. Check <a href=\"https://tour.golang.org/moretypes/6\" rel=\"nofollow noreferrer\">this</a> link.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1478796022, "last_edit_date": 1495540414, "creation_date": 1478720586, "answer_id": 40514753, "question_id": 40514555, "link": "https://stackoverflow.com/questions/40514555/golang-passing-arrays-to-the-function-and-modifying-it/40514753#40514753", "title": "Golang passing arrays to the function and modifying it", "body": "<p>The explanation is rather simple: <em>there isn't a single <a href=\"https://golang.org/ref/spec#Array_types\" rel=\"noreferrer\">array</a> declared or used explicitly in your code above</em>. Your <code>tab</code> local variable and the <code>tab</code> parameter are <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"noreferrer\"><em>slices</em></a>.</p>\n\n<p>In Go the length of an array is part of the type, e.g. <code>[3]int</code> (this is true to an extent that for example <code>[2]int</code> and <code>[3]int</code> are 2 different / distinct array types). If the length is not present (either explicit like <code>[2]int</code> or implicit like in the <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"noreferrer\">composite literal</a> <code>[...]int{1, 2, 3}</code>), then that is not an array type but a slice type.</p>\n\n<p>Yes, as you read, an array value means all its elements, and when passed around (or assigned), all its elements are copied. Slices however are just small descriptors, headers, describing a contiguous section of an array; and when slices are passed around (or assigned), only this header is copied (the pointer included), which will point to the same underlying array. And so if you modify the elements of the slice-copy, the changes will be reflected in the original slice as there is only one backing array that holds the elements.</p>\n\n<p><sup>If you want to know what's in a slice header exactly, you may check out the <a href=\"https://golang.org/pkg/reflect/#SliceHeader\" rel=\"noreferrer\"><code>reflect.SliceHeader</code></a> type: it's a <code>struct</code> containing the pointer to the first element of the slice, the length and the capacity of the slice.</sup></p>\n\n<p><strong>Please read the following blog posts which explain this in great details:</strong></p>\n\n<p><a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"noreferrer\">Go Slices: usage and internals</a></p>\n\n<p><a href=\"https://blog.golang.org/slices\" rel=\"noreferrer\">Arrays, slices (and strings): The mechanics of 'append'</a></p>\n\n<p><strong>Also see these related questions for more details:</strong></p>\n\n<p><a href=\"https://stackoverflow.com/questions/38645175/why-have-arrays-in-go\">Why have arrays in Go?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/39993688/are-golang-slices-pass-by-value\">Are golang slices pass by value?</a></p>\n"}], "owner": {"reputation": 560, "user_id": 5232293, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/gSyD1.jpg?s=128&g=1", "display_name": "Jakub Kopy\u015b", "link": "https://stackoverflow.com/users/5232293/jakub-kopy%c5%9b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4280, "favorite_count": 0, "accepted_answer_id": 40514753, "answer_count": 2, "score": 2, "last_activity_date": 1478796022, "creation_date": 1478719671, "last_edit_date": 1478720032, "question_id": 40514555, "link": "https://stackoverflow.com/questions/40514555/golang-passing-arrays-to-the-function-and-modifying-it", "title": "Golang passing arrays to the function and modifying it", "body": "<p>In most languages (like c++) passing arrays result in implicitly passing it by a reference, so any changes to the passed array in the function will result in changing the original one. I am learning Golang, and In the book \"The Go Programming Language\" by Alan A.A. Donovan and Brian W. Kernighan It is said, that its behaviour is different from other languages - It does not implicitly pass array by reference.</p>\n\n<p>It is confusing me a bit - doesn't that mean that passing an array without the reference should not modify the array itself? Let me illustrate that:</p>\n\n<pre><code>func main() {\n    tab := []int{1, 2, 3}\n    fmt.Println(tab)\n    // Results in [1 2 3]\n    reverse(tab)\n    fmt.Println(tab)\n    // Results in [3 2 1]\n}\n\nfunc reverse(tab []int) {\n    for i, j := 0, len(tab)-1; i &lt; j; i, j = i+1, j-1 {\n        tab[i], tab[j] = tab[j], tab[i]\n    }\n}\n</code></pre>\n\n<p>In code above array is not passed by the reference, but the reverse function modifies the original one, so It works somewhat like C++ program would do. Could anyone explain me the difference?</p>\n\n<p>PS: Sorry if it is a dummy question, I am totally new to the Golang and trying to understand the basics well.</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-endpoints", "google-app-engine-go"], "answers": [{"comments": [{"owner": {"reputation": 14155, "user_id": 632088, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4b02313659bcb668d49a0075c2de0bc1?s=128&d=identicon&r=PG", "display_name": "robert king", "link": "https://stackoverflow.com/users/632088/robert-king"}, "edited": false, "score": 1, "creation_date": 1490226613, "post_id": 40535627, "comment_id": 73023547, "body": "That isn&#39;t &quot;Google cloud endpoints&quot;. That sample example uses <a href=\"https://github.com/gorilla/mux\" rel=\"nofollow noreferrer\">github.com/gorilla/mux</a> which is just a go library for apis. Don&#39;t expect that to handle users, api explorers, api keys, discovery, multiple backends/frontends etc."}], "tags": [], "owner": {"reputation": 449, "user_id": 3034042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30a9a0a09fb8473eafdb9385a884fb69?s=128&d=identicon&r=PG&f=1", "display_name": "Wesley Wong", "link": "https://stackoverflow.com/users/3034042/wesley-wong"}, "is_accepted": false, "score": 2, "last_activity_date": 1478806500, "creation_date": 1478806500, "answer_id": 40535627, "question_id": 40513743, "link": "https://stackoverflow.com/questions/40513743/are-cloud-endpoints-with-go-google-app-engine-standard-possible/40535627#40535627", "title": "Are Cloud Endpoints with Go Google App Engine Standard possible?", "body": "<p>Only Python and Java are supported on GAE Standard via the Endpoints Frameworks. However, Go is supported on GAE Flexible.</p>\n\n<p>Here is the Go GAE Flexible sample:\n<a href=\"https://github.com/GoogleCloudPlatform/golang-samples/tree/master/endpoints/getting-started\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/golang-samples/tree/master/endpoints/getting-started</a></p>\n"}, {"tags": [], "owner": {"reputation": 43, "user_id": 7020329, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-eW6Dylubl0g/AAAAAAAAAAI/AAAAAAAABt4/Tg0B95t07gg/photo.jpg?sz=128", "display_name": "Daniel Barron", "link": "https://stackoverflow.com/users/7020329/daniel-barron"}, "is_accepted": true, "score": 2, "last_activity_date": 1480681329, "creation_date": 1480681329, "answer_id": 40932155, "question_id": 40513743, "link": "https://stackoverflow.com/questions/40513743/are-cloud-endpoints-with-go-google-app-engine-standard-possible/40932155#40932155", "title": "Are Cloud Endpoints with Go Google App Engine Standard possible?", "body": "<p>After much research and trial and error, the simple answer is <strong>\"No.\"</strong> - as of Dec 2016.</p>\n\n<p>The longer answer is it's possible if you want to put far too much effort into making up to date libraries of your own. There is basically no support, even in alpha, for the <strong>current</strong> Google Cloud Endpoints using <strong>Go</strong> with Google App Engine <strong>Standard</strong>.</p>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 7020329, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-eW6Dylubl0g/AAAAAAAAAAI/AAAAAAAABt4/Tg0B95t07gg/photo.jpg?sz=128", "display_name": "Daniel Barron", "link": "https://stackoverflow.com/users/7020329/daniel-barron"}, "edited": false, "score": 0, "creation_date": 1491389811, "post_id": 42993836, "comment_id": 73528080, "body": "It&#39;s possible but libraries might be outdated.... I.e. it&#39;s not possible in any useful way."}], "tags": [], "owner": {"reputation": 984, "user_id": 1729543, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aLkIU.jpg?s=128&g=1", "display_name": "Slava Medvediev", "link": "https://stackoverflow.com/users/1729543/slava-medvediev"}, "is_accepted": false, "score": 1, "last_activity_date": 1490340789, "creation_date": 1490340789, "answer_id": 42993836, "question_id": 40513743, "link": "https://stackoverflow.com/questions/40513743/are-cloud-endpoints-with-go-google-app-engine-standard-possible/42993836#42993836", "title": "Are Cloud Endpoints with Go Google App Engine Standard possible?", "body": "<p>It's possible to run Go+endpoints on GAE Standard environment, however libraries might be outdated now.<br>\nLibraries and sample app can be found on github:<br>\n<a href=\"https://github.com/GoogleCloudPlatform/go-endpoints\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/go-endpoints</a><br>\nI have successfully deployed \"Greetings\" as AppEngine SE app, and it works.</p>\n"}], "owner": {"reputation": 43, "user_id": 7020329, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-eW6Dylubl0g/AAAAAAAAAAI/AAAAAAAABt4/Tg0B95t07gg/photo.jpg?sz=128", "display_name": "Daniel Barron", "link": "https://stackoverflow.com/users/7020329/daniel-barron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 0, "accepted_answer_id": 40932155, "answer_count": 3, "score": 1, "last_activity_date": 1490340789, "creation_date": 1478716484, "question_id": 40513743, "link": "https://stackoverflow.com/questions/40513743/are-cloud-endpoints-with-go-google-app-engine-standard-possible", "title": "Are Cloud Endpoints with Go Google App Engine Standard possible?", "body": "<p>I have implemented a simple API in Go on Google App Engine Standard using just:</p>\n\n<pre><code>func init() {\n    http.HandleFunc(\"/api/v1/resource\",submitResource)\n}\n</code></pre>\n\n<p>Nothing special. However I want to port this code to using Cloud Endpoints instead in order to get the better monitoring and diagnostics.</p>\n\n<p>Is it even possible with STANDARD instances or must I move to FLEXIBLE?</p>\n\n<p>I can't find any documentation on this. Nor answers to this seemingly simple question. At the moment I half wish I had chosen Python because its support seems more mature. I chose Go because it seems more appropriate for API-like code because my minimal research suggested Go offered better performance.</p>\n\n<p>If it is possible, are there any pointers to how please?</p>\n"}, {"tags": ["go", "consul-template"], "answers": [{"tags": [], "owner": {"reputation": 4130, "user_id": 267490, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/3b8fe1f84ce87327580c2ca51c222770?s=128&d=identicon&r=PG", "display_name": "Eli", "link": "https://stackoverflow.com/users/267490/eli"}, "is_accepted": false, "score": 0, "last_activity_date": 1478727210, "creation_date": 1478727210, "answer_id": 40516385, "question_id": 40512918, "link": "https://stackoverflow.com/questions/40512918/build-a-dynamic-string-from-vault-kv-values/40516385#40516385", "title": "build a dynamic string from vault KV values", "body": "<p>I found the answer if anyone is looking to do something similar</p>\n\n<pre><code>{{with secret \"secret/data\"}}\n    {{range $k, $v := .Data}}\n        {{if eq $k \"db-primary\"}}\n            {{with $secret := secret (printf \"mysql-%s/creds/primary\" $v)}}\n                {{$secret.username}}:{{$secret.password}}\n            {{end}}\n        {{end}}\n    {{end}}\n{{end}}\n</code></pre>\n\n<p>using <code>printf</code> lets me replace and inject the value dynamically.</p>\n"}], "owner": {"reputation": 4130, "user_id": 267490, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/3b8fe1f84ce87327580c2ca51c222770?s=128&d=identicon&r=PG", "display_name": "Eli", "link": "https://stackoverflow.com/users/267490/eli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 240, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1545498748, "creation_date": 1478713126, "last_edit_date": 1545498748, "question_id": 40512918, "link": "https://stackoverflow.com/questions/40512918/build-a-dynamic-string-from-vault-kv-values", "title": "build a dynamic string from vault KV values", "body": "<p>I'm trying to create something similar to this:</p>\n\n<pre><code>{{with secret \"secret/data\"}}\n    {{range $k, $v := .Data}}\n        {{if eq $k \"db-primary\"}}\n            {{with $secret := secret \"mysql-$v/creds/primary\"}}\n                {{$secret.username}}:{{$secret.password}}\n            {{end}}\n        {{end}}\n    {{end}}\n{{end}}\n</code></pre>\n\n<p>where <code>$v</code> is a dynamic value. I can't figure out how to have the nested <code>with</code> statement parse the vlaue of <code>$v</code> into its arguments.</p>\n"}, {"tags": ["go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 754, "user_id": 3476897, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/57E2l.png?s=128&g=1", "display_name": "Kugel", "link": "https://stackoverflow.com/users/3476897/kugel"}, "edited": false, "score": 0, "creation_date": 1478713914, "post_id": 40512599, "comment_id": 68267977, "body": "Exactly what I was looking for. Thank you :)"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 10, "last_activity_date": 1478719321, "last_edit_date": 1478719321, "creation_date": 1478711939, "answer_id": 40512599, "question_id": 40512323, "link": "https://stackoverflow.com/questions/40512323/golang-cast-interface-back-to-its-original-type/40512599#40512599", "title": "Golang: cast interface back to its original type", "body": "<p>You can't assert a type from an interface without knowing what that type is at compile time, but you can set a value from an interface via reflection. Here's an example without any error checks, which panics when any parameters don't match:</p>\n\n<pre><code>var m = map[string]interface{}{}\n\nfunc put(k string, v interface{}) {\n    m[k] = v\n}\n\nfunc pop(k string, o interface{}) {\n    reflect.ValueOf(o).Elem().Set(reflect.ValueOf(m[k]))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ORcKhtU_3O\" rel=\"noreferrer\">https://play.golang.org/p/ORcKhtU_3O</a></p>\n"}], "owner": {"reputation": 754, "user_id": 3476897, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/57E2l.png?s=128&g=1", "display_name": "Kugel", "link": "https://stackoverflow.com/users/3476897/kugel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4452, "favorite_count": 2, "accepted_answer_id": 40512599, "answer_count": 1, "score": 9, "last_activity_date": 1478719321, "creation_date": 1478711003, "last_edit_date": 1478711089, "question_id": 40512323, "link": "https://stackoverflow.com/questions/40512323/golang-cast-interface-back-to-its-original-type", "title": "Golang: cast interface back to its original type", "body": "<p>I couldn't really find an answer to this, even though I looked up the Go documentation and examples. Is it possible to cast an interface back to its original type, dynamically? I know I can do something like this:</p>\n\n<pre><code>var myint int = 5\nvar myinterface interface{}\nmyinterface = myint\nrecovered, _ := myinterface.(int)\nfmt.Println(recovered)\n</code></pre>\n\n<p>But here I know the type. I would like to have a map of unknown types (interfaces) and cast them back by using reflection, like this:</p>\n\n<pre><code>// put/pop writes/read to/from a map[string]interface{}\nvar myint int = 5\nput(\"key\" myint)\npop(\"key\", &amp;myint) // this should also work for objects or any other type\n</code></pre>\n\n<p>Like this it would by possible to store anything within a single map. The type will be handed in by the user when calling pop() (second argument is an interface). Is it possible to achive this using reflection?</p>\n"}, {"tags": ["go", "pact"], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 505977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77971f4b535cbb8b09773f7b806335d6?s=128&d=identicon&r=PG", "display_name": "pratik", "link": "https://stackoverflow.com/users/505977/pratik"}, "edited": false, "score": 0, "creation_date": 1478728087, "post_id": 40515718, "comment_id": 68274839, "body": "Hey Matthew,   Thanks for sending over the example, always helps when communicating.  We are currently following that exact pattern in our spike.  We will have a common use case where by there will be multiple states for a test.  This will not be a one off edge case, but definitely pervasive enough that we&#39;ve given it thought about what could help in writing and maintaining our tests.   In addition, the ability to mix and match params for a given state is simplified with this feature."}], "tags": [], "owner": {"reputation": 2503, "user_id": 1008568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32ca6dc55ad8675eaea178f42926f608?s=128&d=identicon&r=PG", "display_name": "Matthew Fellows", "link": "https://stackoverflow.com/users/1008568/matthew-fellows"}, "is_accepted": false, "score": 2, "last_activity_date": 1478724291, "creation_date": 1478724291, "answer_id": 40515718, "question_id": 40512183, "link": "https://stackoverflow.com/questions/40512183/allow-multiple-provider-states-with-parameters-golang/40515718#40515718", "title": "Allow multiple provider states with parameters ( Golang )", "body": "<p>You are correct in that it won't be available until version 3.</p>\n\n<p>You can still achieve what you are after, however. The state itself is just a handle for the <em>Consumer</em> to some set of data on the <em>Provider</em> - that can be a one-to-one or one-to-many mapping - it's completely up to you.</p>\n\n<p>Typically the <em>Provider</em> is notified of the state during verification, it will then setup a test data fixture (often seeding a database) that sets up the 'state' of the entire system based on that reference, which allows the <em>Consumer</em> test to run.</p>\n\n<p>Whilst the ability to pass through parameters and multiple states is nice, it's somewhat an advanced feature and I very much doubt this will be the first problem you run into as a team. I've never needed to use them myself.</p>\n\n<p>For a crude but effective example of this, take a look at the <a href=\"https://github.com/pact-foundation/pact-go/blob/master/examples/gin/provider/user_service_test.go#L47-L59\" rel=\"nofollow noreferrer\">gin</a> code in the <a href=\"https://github.com/pact-foundation/pact-go/tree/master/examples\" rel=\"nofollow noreferrer\">examples</a> folder of the project.</p>\n"}], "owner": {"reputation": 121, "user_id": 505977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77971f4b535cbb8b09773f7b806335d6?s=128&d=identicon&r=PG", "display_name": "pratik", "link": "https://stackoverflow.com/users/505977/pratik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1478735923, "creation_date": 1478710501, "last_edit_date": 1478735923, "question_id": 40512183, "link": "https://stackoverflow.com/questions/40512183/allow-multiple-provider-states-with-parameters-golang", "title": "Allow multiple provider states with parameters ( Golang )", "body": "<p>As our team ( namely myself and two other developers ) spiked on PACT past week or so, one of the areas of concern is not having the ability associate parameters to provider states.   The absence of this key feature ( which is slated for version 3 release ), we likely will not get buy in from each of our respective service sub-teams.  </p>\n\n<p>@MattFellows -  Any projections on when version 3 might be available for Go?  Any chance we can get this feature earlier?</p>\n\n<p><strong>Allow multiple provider states with parameters\nIn previous versions, provider states are defined as a descriptive string. There is no way to infer the data required for the state without encoding the values into the description.</strong></p>\n\n<pre><code>{\n  \"providerState\": \"an alligator with the given name Mary exists and the user Fred is logged in\"\n}\nThe change would be:\n\n{\n  \"providerStates\": [\n    {\n      \"name\": \"an alligator with the given name exists\",\n      \"params\": {\"name\" : \"Mary\"}\n    }, {\n      \"name\": \"the user is logged in\",\n      \"params\" : { \"username\" : \"Fred\"}\n    }\n  ]\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 1, "creation_date": 1478717587, "post_id": 40511495, "comment_id": 68269736, "body": "I suggest you reuse your sessions instead of calling copy/close on them to reduce the number of open sockets. This is likely the cause of &quot;too many open files&quot;. I read on the docs that a session is thread-safe."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1478718920, "post_id": 40511495, "comment_id": 68270402, "body": "I thought that by copying them I was reusing them.  Can you provide a small example? @squiguy"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1478720380, "post_id": 40511495, "comment_id": 68271071, "body": "Is this the different between Clone and Copy? Your comment guided my search queries and that&#39;s what i stumbled on."}, {"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1478720873, "post_id": 40511495, "comment_id": 68271335, "body": "I haven&#39;t used MongoDB myself, but I personally would just share my session and avoid using clone or copy. This is what I have been reading: <a href=\"https://godoc.org/gopkg.in/mgo.v2#Session\" rel=\"nofollow noreferrer\">godoc.org/gopkg.in/mgo.v2#Session</a>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1478721250, "post_id": 40511495, "comment_id": 68271519, "body": "I am using a session. It&#39;s part of my DataStore struct. But to use the session it has to be cloned or copied per request otherwise it returns the error session closed. I&#39;m even using the Monotonic mode as suggested."}], "answers": [{"comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1478796011, "post_id": 40521765, "comment_id": 68305294, "body": "So I&#39;ve modded my code.  I instantiate a session object at the top of each requests and passed a clone of the session into the method for use.  I didn&#39;t copy the session because i&#39;m spinning these off as go routines and the mongo call is an insert so I don&#39;t need to wait for any return data.  Thank you for advice :-)"}], "tags": [], "owner": {"reputation": 885, "user_id": 990212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b4e9e0cbad55fb36be31c38b79562f0?s=128&d=identicon&r=PG", "display_name": "Yadvendar", "link": "https://stackoverflow.com/users/990212/yadvendar"}, "is_accepted": true, "score": 1, "last_activity_date": 1478761665, "creation_date": 1478761665, "answer_id": 40521765, "question_id": 40511495, "link": "https://stackoverflow.com/questions/40511495/i-think-my-go-server-is-killing-my-mongo-servers/40521765#40521765", "title": "I think my Go server is killing my Mongo servers", "body": "<ol>\n<li>You should use copy only once per request-response cycle. Using it in each call to models will result in consuming a lot of sockets. Each model call is opening a socket and closing it(using defer) while exiting the routine. Try to reuse a copied session across multiple calls to your db in the same request-response cycle. </li>\n<li>From the logs and the code snippet, it looks like that you should take care of 1 until unless in each request-response cycle you are calling your model routines to perform CRUD only once.</li>\n<li>Copy uses a new socket to open connection preserving the auth credentials from the parent session while clone uses the same socket as the parent session(while using the cloned session one of the parent/child will have to wait on the socket until the other one is done with it). Hence, to process multiple requests to your server in parallel its better to use copy per request handler.(<a href=\"https://godoc.org/gopkg.in/mgo.v2#Session.Clone\" rel=\"nofollow noreferrer\">https://godoc.org/gopkg.in/mgo.v2#Session.Clone</a>)</li>\n<li>After increasing the ulimit on a machine do make sure it gets reflected immediately - <a href=\"http://lzone.de/blog/Apply-changes-to-limits.conf-immediately\" rel=\"nofollow noreferrer\">http://lzone.de/blog/Apply-changes-to-limits.conf-immediately</a>. </li>\n</ol>\n"}], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 40521765, "answer_count": 1, "score": -1, "last_activity_date": 1478761665, "creation_date": 1478708245, "last_edit_date": 1478711021, "question_id": 40511495, "link": "https://stackoverflow.com/questions/40511495/i-think-my-go-server-is-killing-my-mongo-servers", "title": "I think my Go server is killing my Mongo servers", "body": "<p>So long story short, I have many servers across 3 AWS regions.  In an effort to reduce servers, which are written in Node, I've rewritten them in Go.  To my delight and surprise 1 Go server can handle what 10 Node servers handle with lower CPU utilization and less ELB latency.  This is AWESOME lol.  However, I think maybe that they are too fast lol.  We have a single (yes I know very bad) MongoDB server used to log data.  Every request that comes in is logged in a particular way and sent to this server. Since adding just 2 Go servers that MongoDB server has started to crash.</p>\n\n<p><strong>TRACEBACK</strong></p>\n\n<pre><code>2016-11-09T03:06:41.240-0500 I JOURNAL  [journal writer] warning couldn't write to / rename file /data/data/db/journal/prealloc.2: Couldn't open directory '/data/data/db/journal' for flushing: errno:24 Too many open files\n2016-11-09T03:06:41.240-0500 I JOURNAL  [journal writer] warning exception opening journal file couldn't open file /data/data/db/journal/j._213 for writing errno:9 Bad file descriptor\n2016-11-09T03:06:41.240-0500 I JOURNAL  [journal writer] error exception in dur::journal couldn't open file /data/data/db/journal/j._213 for writing errno:9 Bad file descriptor\n2016-11-09T03:06:41.242-0500 F JOURNAL  [journal writer] dbexception in journalWriterThread causing immediate shutdown: 13516 couldn't open file /data/data/db/journal/j._213 for writing errno:9 Bad file descriptor\n2016-11-09T03:06:41.242-0500 I -        [journal writer] Invariant failure false src/mongo/db/storage/mmap_v1/dur_journal_writer.cpp 258\n2016-11-09T03:06:41.246-0500 I JOURNAL  [durability] warning couldn't write to / rename file /data/data/db/journal/prealloc.2: couldn't open file /data/data/db/journal/prealloc.2 for writing errno:9 Bad file descriptor\n2016-11-09T03:06:41.246-0500 F JOURNAL  [durability] dbexception in durThread causing immediate shutdown: 13516 couldn't open file /data/data/db/journal/j._213 for writing errno:9 Bad file descriptor\n2016-11-09T03:06:41.246-0500 I -        [durability] Invariant failure false src/mongo/db/storage/mmap_v1/dur.cpp 862\n2016-11-09T03:06:41.246-0500 I CONTROL  [journal writer]\n 0xf51949 0xef1671 0xed6192 0xd17613 0xf9f9b4 0x7fd09697d184 0x7fd09544337d\n----- BEGIN BACKTRACE -----\n{\"backtrace\":[{\"b\":\"400000\",\"o\":\"B51949\"},{\"b\":\"400000\",\"o\":\"AF1671\"},{\"b\":\"400000\",\"o\":\"AD6192\"},{\"b\":\"400000\",\"o\":\"917613\"},{\"b\":\"400000\",\"o\":\"B9F9B4\"},{\"b\":\"7FD096975000\",\"o\":\"8184\"},{\"b\":\"7FD095349000\",\"o\":\"FA37D\"}],\"processInfo\":{ \"mongodbVersion\" : \"3.0.3\", \"gitVersion\" : \"b40106b36eecd1b4407eb1ad1af6bc60593c6105\", \"uname\" : { \"sysname\" : \"Linux\", \"release\" : \"3.13.0-54-generic\", \"version\" : \"#91-Ubuntu SMP Tue May 26 19:15:08 UTC 2015\", \"machine\" : \"x86_64\" }, \"somap\" : [ { \"elfType\" : 2, \"b\" : \"400000\", \"buildId\" : \"F56F80CB96B4DBFC070BEB0ADAC7D6B274BFC6B1\" }, { \"b\" : \"7FFF14FD0000\", \"elfType\" : 3, \"buildId\" : \"1C0D0A18FF043EED9EE11DB5E5E90A3F74729341\" }, { \"b\" : \"7FD096975000\", \"path\" : \"/lib/x86_64-linux-gnu/libpthread.so.0\", \"elfType\" : 3, \"buildId\" : \"31E9F21AE8C10396171F1E13DA15780986FA696C\" }, { \"b\" : \"7FD096716000\", \"path\" : \"/lib/x86_64-linux-gnu/libssl.so.1.0.0\", \"elfType\" : 3, \"buildId\" : \"74864DB9D5F69D39A67E4755012FB6573C469B3D\" }, { \"b\" : \"7FD09633A000\", \"path\" : \"/lib/x86_64-linux-gnu/libcrypto.so.1.0.0\", \"elfType\" : 3, \"buildId\" : \"AAE7CFF8351B730830BDBCE0DCABBE06574B7144\" }, { \"b\" : \"7FD096132000\", \"path\" : \"/lib/x86_64-linux-gnu/librt.so.1\", \"elfType\" : 3, \"buildId\" : \"E2A6DD5048A0A051FD61043BDB69D8CC68192AB7\" }, { \"b\" : \"7FD095F2E000\", \"path\" : \"/lib/x86_64-linux-gnu/libdl.so.2\", \"elfType\" : 3, \"buildId\" : \"DA9B8C234D0FE9FD8CAAC8970A7EC1B6C8F6623F\" }, { \"b\" : \"7FD095C2A000\", \"path\" : \"/usr/lib/x86_64-linux-gnu/libstdc++.so.6\", \"elfType\" : 3, \"buildId\" : \"76190E922AF7457D078F75C9B15FA184E83EB506\" }, { \"b\" : \"7FD095924000\", \"path\" : \"/lib/x86_64-linux-gnu/libm.so.6\", \"elfType\" : 3, \"buildId\" : \"D144258E614900B255A31F3FD2283A878670D5BC\" }, { \"b\" : \"7FD09570E000\", \"path\" : \"/lib/x86_64-linux-gnu/libgcc_s.so.1\", \"elfType\" : 3, \"buildId\" : \"36311B4457710AE5578C4BF00791DED7359DBB92\" }, { \"b\" : \"7FD095349000\", \"path\" : \"/lib/x86_64-linux-gnu/libc.so.6\", \"elfType\" : 3, \"buildId\" : \"CF699A15CAAE64F50311FC4655B86DC39A479789\" }, { \"b\" : \"7FD096B93000\", \"path\" : \"/lib64/ld-linux-x86-64.so.2\", \"elfType\" : 3, \"buildId\" : \"D0F537904076D73F29E4A37341F8A449E2EF6CD0\" } ] }}\n mongod(_ZN5mongo15printStackTraceERSo+0x29) [0xf51949]\n mongod(_ZN5mongo10logContextEPKc+0xE1) [0xef1671]\n mongod(_ZN5mongo15invariantFailedEPKcS1_j+0xB2) [0xed6192]\n mongod(_ZN5mongo3dur13JournalWriter20_journalWriterThreadEv+0x953) [0xd17613]\n mongod(+0xB9F9B4) [0xf9f9b4]\n libpthread.so.0(+0x8184) [0x7fd09697d184]\n libc.so.6(clone+0x6D) [0x7fd09544337d]\n</code></pre>\n\n<p>In an efforts to fix this I increased the ulimit on that machine. However I think something can also be done from the programmic side. </p>\n\n<p><strong>Here is my mongo package</strong></p>\n\n<pre><code>package mongo\n\nimport (\n    \"time\"\n\n    \"gopkg.in/mgo.v2\"\n)\n\nvar (\n    // TagDB ...\n    TagDB DataStore\n    // LogDB ...\n    LogDB DataStore\n)\n\nfunc init() {\n    TagDB.ConnectToTagserver()\n    LogDB.ConnectToLogServer()\n}\n\n// DataStore containing a pointer to a mgo session\ntype DataStore struct {\n    Session *mgo.Session\n}\n\n// ConnectToTagserver is a helper method that connections to pubgears' tagserver\n// database\nfunc (ds *DataStore) ConnectToTagserver() {\n    mongoDBDialInfo := &amp;mgo.DialInfo{\n        Addrs:    []string{\"some_IP\"},\n        Timeout:  60 * time.Second,\n        Database: \"tagserver\",\n    }\n    sess, err := mgo.DialWithInfo(mongoDBDialInfo)\n    if err != nil {\n        panic(err)\n    }\n    sess.SetMode(mgo.Monotonic, true)\n    TagDB.Session = sess\n}\n\n\n// database SERVER IN QUESTION\nfunc (ds *DataStore) ConnectToLogServer() {\n    mongoDBDialInfo := &amp;mgo.DialInfo{\n        Addrs:    []string{\"some_IP\"}, \n        Timeout:  60 * time.Second,\n        Database: \"nginx_logs\",\n    }\n    sess, err := mgo.DialWithInfo(mongoDBDialInfo)\n    if err != nil {\n        println(1)\n        panic(err)\n    }\n    sess.SetMode(mgo.Monotonic, true)\n    LogDB.Session = sess\n}\n\n// Close is a helper method that ensures the session is properly terminated\nfunc (ds *DataStore) Close() {\n    ds.Session.Close()\n}\n</code></pre>\n\n<p><strong>Here is the file that used that package</strong></p>\n\n<pre><code>package models\n\nimport (\n    \"errors\"\n    \"fmt\"\n    \"strconv\"\n    \"time\"\n\n    \"gopkg.in/mgo.v2/bson\"\n\n    \"./mongo\"\n)\n\n// RawRequests ...\ntype RawRequests struct {\n    TagServer   string            `json:\"tag_server\"`\n    Server      string            `json:\"server\"`\n    Slug        string            `json:\"slug\"`\n    Zone        string            `json:\"zone\"`\n    Size        string            `json:\"size\"`\n    Network     string            `json:\"network\"`\n    TagHash     string            `json:\"tag_hash\"`\n    Extra       string            `json:\"extra\"`\n    Logged      time.Time         `json:\"logged\"`\n    Date        string            `json:\"date\"`\n    Hour        int               `json:\"hour\"`\n    QueryParams map[string]string `json:\"query_params\"`\n}\n\n// RawTagRequests ...\ntype RawTagRequests struct {\n    TagServer   string            `json:\"tag_server\"`\n    Server      string            `json:\"server\"`\n    Slug        string            `json:\"slug\"`\n    Zone        string            `json:\"zone\"`\n    Size        string            `json:\"size\"`\n    Network     string            `json:\"network\"`\n    TagHash     string            `json:\"tag_hash\"`\n    Extra       string            `json:\"extra\"`\n    Logged      time.Time         `json:\"logged\"`\n    Date        string            `json:\"date\"`\n    Hour        int               `json:\"hour\"`\n    QueryParams map[string]string `json:\"query_params\"`\n    ChainNext   string            `json:\"chain_next\"`\n}\n\n// LogRequest ...\nfunc LogRequest(tagServer string, server string, slug string, zone string, size string, network string, extra string, tagHash string, queryParams map[string]string) error {\n    dbsession := mongo.LogDB.Session.Copy()\n    defer dbsession.Close()\n    logCollection := dbsession.DB(\"nginx_logs\").C(\"raw_requests\")\n    d := time.Now()\n    hour, _, _ := d.Clock()\n    year, month, day, _ := formatDate(d.Year(), int(d.Month()), d.Day())\n    date := fmt.Sprintf(\"%s-%s-%s\", year, month, day)\n    return logCollection.Insert(bson.M{\"tag_server\": tagServer, \"server\": server, \"slug\": slug, \"zone\": zone, \"size\": size, \"network\": network, \"tag_hash\": tagHash, \"extra\": extra, \"logged\": time.Now(), \"date\": date, \"hour\": hour, \"query_params\": queryParams})\n}\n\n// LogTagRequests ...\nfunc LogTagRequests(tagServer string, server string, slug string, zone string, size string, network string, extra string, tagHash string, queryParams map[string]string, chainHash string) error {\n    dbsession := mongo.LogDB.Session.Copy()\n    defer dbsession.Close()\n    logCollection := dbsession.DB(\"nginx_logs\").C(\"raw_tag_requests\")\n    d := time.Now()\n    hour, _, _ := d.Clock()\n    year, month, day, _ := formatDate(d.Year(), int(d.Month()), d.Day())\n    date := fmt.Sprintf(\"%s-%s-%s\", year, month, day)\n    return logCollection.Insert(bson.M{\"tag_server\": tagServer, \"server\": server, \"slug\": slug, \"zone\": zone, \"size\": size, \"network\": network, \"tag_hash\": tagHash, \"extra\": extra, \"logged\": time.Now(), \"date\": date, \"hour\": hour, \"query_params\": queryParams, \"chain_hash\": chainHash})\n}\n\nfunc formatDate(year int, month int, day int) (y string, m string, d string, err error) {\n    var tmonth, tday, tyear string\n    tyear = strconv.Itoa(year)\n    // convert the month and year and replace with the correct number of digits\n    if month &lt; 10 {\n        tmonth = \"0\" + strconv.Itoa(int(month))\n    } else {\n        tmonth = strconv.Itoa(int(month))\n    }\n    if day &lt; 10 {\n        tday = \"0\" + strconv.Itoa(int(day))\n    } else {\n        tday = strconv.Itoa(int(day))\n    }\n    if len(tmonth) == 2 &amp;&amp; len(tday) == 2 &amp;&amp; len(tyear) == 4 {\n        return tyear, tmonth, tday, nil\n    }\n    return tyear, tmonth, tday, errors.New(\"One of the values passed in does not meet the time format requirement month-day-year --&gt; 1991-01-15\")\n}\n</code></pre>\n\n<p>Lastly within my route, I simply call my method <code>go LogRequest(tagServer, host, site, channel, adSize, network, tagExtra, tagHash, queryParams)</code></p>\n"}, {"tags": ["json", "go", "struct", "merge"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1478703884, "post_id": 40509575, "comment_id": 68261983, "body": "What would be wrong with <code>fmt.Sprintf(&quot;{\\&quot;name\\&quot;:%q,\\&quot;description\\&quot;:%q}&quot;, a.Name, b.Description)</code> ?  Some things <b>do</b> require some coding..."}], "answers": [{"comments": [{"owner": {"reputation": 399, "user_id": 4034917, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-bZwdXgIm38k/AAAAAAAAAAI/AAAAAAAABAk/lVdH3NHbDFE/photo.jpg?sz=128", "display_name": "Dmitry Kapsamun", "link": "https://stackoverflow.com/users/4034917/dmitry-kapsamun"}, "edited": false, "score": 0, "creation_date": 1478766550, "post_id": 40510269, "comment_id": 68286517, "body": "It&#39;s completely what I need! Thank you!"}, {"owner": {"reputation": 4447, "user_id": 616290, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Px1aG.jpg?s=128&g=1", "display_name": "Dmytro Boichenko", "link": "https://stackoverflow.com/users/616290/dmytro-boichenko"}, "edited": false, "score": 0, "creation_date": 1610968752, "post_id": 40510269, "comment_id": 116291444, "body": "Problems could appear if you have <code>omitempty</code> json tag in your struct. If so the nil values won&#39;t be erased."}], "tags": [], "owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "is_accepted": false, "score": 14, "last_activity_date": 1478704480, "creation_date": 1478704480, "answer_id": 40510269, "question_id": 40509575, "link": "https://stackoverflow.com/questions/40509575/how-can-i-merge-two-structs-in-golang/40510269#40510269", "title": "How can I merge two structs in Golang?", "body": "<p>It's a bit convoluted but I suppose you could do something like this:</p>\n\n<pre><code>    a := struct {\n        Name string `json:\"name\"`\n    }{\"my name\"}\n\n    b := struct {\n        Description string `json:\"description\"`\n    }{\"my description\"}\n\n    var m map[string]string\n\n    ja, _ := json.Marshal(a)\n    json.Unmarshal(ja, &amp;m)\n    jb, _ := json.Marshal(b)\n    json.Unmarshal(jb, &amp;m)\n\n    jm, _ := json.Marshal(m)\n    fmt.Println(string(jm))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 399, "user_id": 4034917, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-bZwdXgIm38k/AAAAAAAAAAI/AAAAAAAABAk/lVdH3NHbDFE/photo.jpg?sz=128", "display_name": "Dmitry Kapsamun", "link": "https://stackoverflow.com/users/4034917/dmitry-kapsamun"}, "edited": false, "score": 0, "creation_date": 1478766504, "post_id": 40510391, "comment_id": 68286489, "body": "The nuance is in that the struct is anonymous. I don&#39;t know it&#39;s name. So I can&#39;t use embedding."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 399, "user_id": 4034917, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-bZwdXgIm38k/AAAAAAAAAAI/AAAAAAAABAk/lVdH3NHbDFE/photo.jpg?sz=128", "display_name": "Dmitry Kapsamun", "link": "https://stackoverflow.com/users/4034917/dmitry-kapsamun"}, "edited": false, "score": 1, "creation_date": 1478782382, "post_id": 40510391, "comment_id": 68296282, "body": "@DmitryKapsamun: Can&#39;t you create a type? Why is the struct anonymous?"}, {"owner": {"reputation": 4957, "user_id": 13161155, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4SPLU.jpg?s=128&g=1", "display_name": "Yagiz Degirmenci", "link": "https://stackoverflow.com/users/13161155/yagiz-degirmenci"}, "edited": false, "score": 0, "creation_date": 1607511513, "post_id": 40510391, "comment_id": 115293470, "body": "Elegant, I love the simplicity of this kind of operations in GO."}], "tags": [], "owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "is_accepted": false, "score": 22, "last_activity_date": 1478704861, "creation_date": 1478704861, "answer_id": 40510391, "question_id": 40509575, "link": "https://stackoverflow.com/questions/40509575/how-can-i-merge-two-structs-in-golang/40510391#40510391", "title": "How can I merge two structs in Golang?", "body": "<p>You can <a href=\"https://play.golang.org/p/s5U5Y_p26_\" rel=\"noreferrer\">embed both structs in another</a>.</p>\n\n<pre><code>type name struct {\n    Name string `json:\"name\"`\n}\n\ntype description struct {\n    Description string `json:\"description\"`\n}\n\ntype combined struct {\n    name\n    description\n}\n</code></pre>\n\n<p>The JSON package will treat embedded structs kind of like unions, but this can get clunky pretty quickly.</p>\n"}, {"comments": [{"owner": {"reputation": 386, "user_id": 1359876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40741f2e530c398d996ff4329b3b4076?s=128&d=identicon&r=PG", "display_name": "tutley", "link": "https://stackoverflow.com/users/1359876/tutley"}, "edited": false, "score": 0, "creation_date": 1509321652, "post_id": 40512151, "comment_id": 80959584, "body": "if you marshal o into json what would that string look like?"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 386, "user_id": 1359876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40741f2e530c398d996ff4329b3b4076?s=128&d=identicon&r=PG", "display_name": "tutley", "link": "https://stackoverflow.com/users/1359876/tutley"}, "edited": false, "score": 0, "creation_date": 1509358322, "post_id": 40512151, "comment_id": 80971612, "body": "@tutley: try it on go playground. It will/should look like this: <code>{&quot;name&quot;: &quot;Name value&quot;, &quot;description&quot;: &quot;Description val&quot;}</code>. The other types are not exported, embedded structs"}], "tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": false, "score": 7, "last_activity_date": 1478710395, "creation_date": 1478710395, "answer_id": 40512151, "question_id": 40509575, "link": "https://stackoverflow.com/questions/40509575/how-can-i-merge-two-structs-in-golang/40512151#40512151", "title": "How can I merge two structs in Golang?", "body": "<p>Go is all about composition over inheritance. Sadly, you're using anonymous structs, but given that you're clearly trying to json marshal them, you're better of defining them as types:</p>\n\n<pre><code>type name struct {\n    Name string `json:\"name\"`\n}\ntype desc struct {\n    Description string `json:\"description\"`\n}\n</code></pre>\n\n<p>You can initialize them in the same way as you're currently doing, but instead of <code>struct{&lt;fields&gt;}{init}</code>, you'll just write</p>\n\n<pre><code>a := name{\"foo\"}\nb := desc{\"Description\"}\n</code></pre>\n\n<p>You can then combine them in any way you like by writing:</p>\n\n<pre><code>c := struct {\n    name\n    description\n}{a, b}\n</code></pre>\n\n<p>One quirk (that might trip you up at first) you have to get used to when composing types like this is how you initialize the members. Say you decide to create a type that combines the other two structs:</p>\n\n<pre><code>type foo struct {\n    name\n    description\n}\n</code></pre>\n\n<p>You cannot initialize it like this:</p>\n\n<pre><code>o := foo{\"Name value\", \"description value\"}\n</code></pre>\n\n<p>Go will complain about you using type string as type <code>name</code>. You'll have to write something like this:</p>\n\n<pre><code>o := foo{\n    name{\"Name value\"},\n    description{Description: \"Description val\"},//optional with field names\n}\n</code></pre>\n\n<p>An in-line composite built using existing objects (cf <code>c := struct{}{a, b}</code>) does this already.<br>\nDepending on what you're trying to do, it sometimes is easier to write something like this:</p>\n\n<pre><code>func (s *MyCompositeType) CopyName(n name) {\n    s.Name = n.Name\n    //copy other fields\n}\n</code></pre>\n\n<p>It makes life easier when you're nesting composite types several levels deep.</p>\n"}, {"tags": [], "owner": {"reputation": 500, "user_id": 7101880, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209175470396691/picture?type=large", "display_name": "Adrien Parrochia", "link": "https://stackoverflow.com/users/7101880/adrien-parrochia"}, "is_accepted": false, "score": 4, "last_activity_date": 1511975631, "creation_date": 1511975631, "answer_id": 47558189, "question_id": 40509575, "link": "https://stackoverflow.com/questions/40509575/how-can-i-merge-two-structs-in-golang/47558189#47558189", "title": "How can I merge two structs in Golang?", "body": "<p>You can merge two struct like this :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\n\ntype b struct {\n    Name string  `json:\"name\"`\n    Description string\n    Url string\n}\n\ntype a struct {\n    *b\n    MimeType string  `json:\"mimeType\"`\n}\n\nfunc main() {\n    bc := b{\"test\", \"testdecription\", \"testurl\"}\n    ac := a{nil, \"jpg\"}\n\n    ac.b = &amp;bc\n\n    js, _ := json.Marshal(ac)\n\n    fmt.Println(string(js) )\n}\n</code></pre>\n"}], "owner": {"reputation": 399, "user_id": 4034917, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-bZwdXgIm38k/AAAAAAAAAAI/AAAAAAAABAk/lVdH3NHbDFE/photo.jpg?sz=128", "display_name": "Dmitry Kapsamun", "link": "https://stackoverflow.com/users/4034917/dmitry-kapsamun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32526, "favorite_count": 3, "answer_count": 4, "score": 19, "last_activity_date": 1511975631, "creation_date": 1478702419, "question_id": 40509575, "link": "https://stackoverflow.com/questions/40509575/how-can-i-merge-two-structs-in-golang", "title": "How can I merge two structs in Golang?", "body": "<p>I have two json-marshallable anonymous structs.</p>\n\n<pre><code>a := struct {\n    Name string `json:\"name\"`\n}{\"my name\"}\n\nb := struct {\n    Description string `json:\"description\"`\n}{\"my description\"}\n</code></pre>\n\n<p>Is there any way to merge them into json to get something like that:</p>\n\n<pre><code>{\n    \"name\":\"my name\",\n    \"description\":\"my description\"\n}\n</code></pre>\n"}, {"tags": ["jquery", "ajax", "go", "long-polling", "revel"], "comments": [{"owner": {"reputation": 10840, "user_id": 6099347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ilLdR.png?s=128&g=1", "display_name": "Aniket Sahrawat", "link": "https://stackoverflow.com/users/6099347/aniket-sahrawat"}, "edited": false, "score": 0, "creation_date": 1478696589, "post_id": 40507502, "comment_id": 68257483, "body": "Data must be in key-&gt;value pair. Inside ajax function rename <code>data: ODRequest</code> to <code>data: { control: &#39;ODRequest&#39;}</code> and update the necessary server side must be updated too. Also add <code>dataType: &#39;json&#39;</code> to ajax function"}, {"owner": {"reputation": 1254, "user_id": 2870438, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/3c587da2b868b56e3afb188bff722e8f?s=128&d=identicon&r=PG&f=1", "display_name": "Eloy Fern&#225;ndez Franco", "link": "https://stackoverflow.com/users/2870438/eloy-fern%c3%a1ndez-franco"}, "reply_to_user": {"reputation": 10840, "user_id": 6099347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ilLdR.png?s=128&g=1", "display_name": "Aniket Sahrawat", "link": "https://stackoverflow.com/users/6099347/aniket-sahrawat"}, "edited": false, "score": 0, "creation_date": 1478696701, "post_id": 40507502, "comment_id": 68257555, "body": "Hi @AniketSahrawat ODRequest is a json object. And in the server I can get all the fields... so I think it is not the thing now. Thanks anyway."}, {"owner": {"reputation": 1426, "user_id": 1520594, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1fcaa128750715b5631f1c2c109e4eb?s=128&d=identicon&r=PG", "display_name": "algrebe", "link": "https://stackoverflow.com/users/1520594/algrebe"}, "edited": false, "score": 0, "creation_date": 1478699205, "post_id": 40507502, "comment_id": 68259089, "body": "it looks like you want to <code>stream</code> the data.. you&#39;re able to see curl printing response by response because it is streaming. I&#39;m not sure about the ajax way, but if it isn&#39;t a strong requirement, you could write the responses via a websocket."}], "answers": [{"comments": [{"owner": {"reputation": 1254, "user_id": 2870438, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/3c587da2b868b56e3afb188bff722e8f?s=128&d=identicon&r=PG&f=1", "display_name": "Eloy Fern&#225;ndez Franco", "link": "https://stackoverflow.com/users/2870438/eloy-fern%c3%a1ndez-franco"}, "edited": false, "score": 0, "creation_date": 1478703049, "post_id": 40508021, "comment_id": 68261433, "body": "Hi @korchemkin. No... my app doesn&#39;t work in this way. The js must to do only one request (when a user clicks on a button). This request arrives to the server that has to build the response, and this response is made by three chunks. This chunks (by the internal processing) have a different delay between them, but the server throws each chunk as soon as it is built. And in the case you expose it seems that the js makes the ajax calling recursively."}], "tags": [], "owner": {"reputation": 187, "user_id": 6700018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ffbddff3782fff4077bcdc87b1cf6c0?s=128&d=identicon&r=PG", "display_name": "Dmitri", "link": "https://stackoverflow.com/users/6700018/dmitri"}, "is_accepted": false, "score": 0, "last_activity_date": 1478697621, "creation_date": 1478697621, "answer_id": 40508021, "question_id": 40507502, "link": "https://stackoverflow.com/questions/40507502/long-polling-between-javascript-and-revel-golang-server/40508021#40508021", "title": "Long polling between javascript and revel golang server", "body": "<p>Please, describe the procedure more precisely, your application works the same way, like this?</p>\n\n<p>Js script should send a request to the server, and when the response is received is again send a request.</p>\n\n<pre><code>var ajaxFunc = function () {\n  // handle response and again call\n  ajaxFunc();\n};\n</code></pre>\n\n<p>When the server receives a request, it must run an loop for a certain time (may be 20-30 seconds), and send updates to the client</p>\n"}], "owner": {"reputation": 1254, "user_id": 2870438, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/3c587da2b868b56e3afb188bff722e8f?s=128&d=identicon&r=PG&f=1", "display_name": "Eloy Fern&#225;ndez Franco", "link": "https://stackoverflow.com/users/2870438/eloy-fern%c3%a1ndez-franco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 322, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1478697621, "creation_date": 1478695955, "question_id": 40507502, "link": "https://stackoverflow.com/questions/40507502/long-polling-between-javascript-and-revel-golang-server", "title": "Long polling between javascript and revel golang server", "body": "<p>I am trying to make an ajax calling (using jquery) and render the responses from the server as soon as they are arriving. In the server I send the different responses as soon as they are ready. If I make a request using curl I can see how they are going printing in screen response by response. But I can't do something similar using jquery ajax.</p>\n\n<p>The code on the server is like this:</p>\n\n<pre><code>flusher, ok := app.Response.Out.(http.Flusher)\nif !ok {\n  panic(\"expected http.ResponseWriter to be an http.Flusher\")\n}\n\napp.Response.Out.Header().Set(\"Connection\", \"Keep-Alive\")\napp.Response.Out.Header().Set(\"Transfer-Encoding\", \"chunked\")\napp.Response.Out.Header().Set(\"X-Content-Type-Options\", \"nosniff\")\nfmt.Fprintf(app.Response.Out, string(JsonOffers))\nflusher.Flush()\n</code></pre>\n\n<p>This snippet of code is calling into a loop. <code>app.Response.Out</code> is a <code>http.ResponseWriter</code>.</p>\n\n<p>The request I do, is a normal jquery.ajax function:</p>\n\n<pre><code>  jQuery.ajax({\n    url: '/ndc',\n    type: \"POST\",\n    data: ODRequest,\n    success: function(offers){\n      console.log( 'Offers', offers )\n    },\n    error: function(x,y,z){console.log(\"ERROR\", x);}\n  })\n</code></pre>\n\n<p>With this I get all the offers, but only when the last response is processed, and not one by one.</p>\n\n<p>One thing more... (I don't know if it could be important) on the server console I can see this, in each request:</p>\n\n<pre><code>server.go:2161: http: multiple response.WriteHeader calls\n</code></pre>\n"}, {"tags": ["amazon-web-services", "file-upload", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "edited": false, "score": 0, "creation_date": 1478694197, "post_id": 40506123, "comment_id": 68256060, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/32377782/how-to-do-a-pre-signed-post-upload-to-aws-s3-in-go\">How to do a Pre-signed POST upload to AWS S3 in Go?</a>"}, {"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "reply_to_user": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "edited": false, "score": 0, "creation_date": 1478697866, "post_id": 40506123, "comment_id": 68258269, "body": "I suspect presigned form <code>POST</code> uploads are limited to 5GB @fl0cke."}, {"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 0, "creation_date": 1478704297, "post_id": 40506123, "comment_id": 68262265, "body": "I don&#39;t think there&#39;s an easy answer, because amazon tends to engineer things so that the burden of coordinating things like this is placed on the user, this is how they manage to scale. You might find <a href=\"https://www.hashicorp.com/blog/consul-s3-multipart.html\" rel=\"nofollow noreferrer\">this hashicorp blog post, discussing the same problem</a> which also explains how they solved it (spoiler: with lots of code)"}, {"owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "reply_to_user": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 1, "creation_date": 1478717079, "post_id": 40506123, "comment_id": 68269509, "body": "@Michael-sqlbot Are you sure about that? There are also lots of javascript libs out there that handle uploading to S3. <a href=\"https://github.com/TTLabs/EvaporateJS\" rel=\"nofollow noreferrer\">EvaporateJS</a>, <a href=\"http://fineuploader.com/\" rel=\"nofollow noreferrer\">FineUploader</a>, <a href=\"https://github.com/cinely/mule-uploader\" rel=\"nofollow noreferrer\">mule-uploader</a> and more"}, {"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "reply_to_user": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "edited": false, "score": 0, "creation_date": 1478723108, "post_id": 40506123, "comment_id": 68272425, "body": "@fl0cke If we&#39;re talking about <a href=\"http://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-authentication-HTTPPOST.html\" rel=\"nofollow noreferrer\">native form post uploads</a> without another library (<i>&quot;an URL where I can just direct a POST in a html form&quot;</i>), then I&#39;m reasonably confident that nothing larger is supported, though it&#39;s not easy to find something specific to <code>POST</code> uploads in the docs. Looking, not finding."}], "answers": [{"tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": true, "score": 1, "last_activity_date": 1493943525, "creation_date": 1493943525, "answer_id": 43794641, "question_id": 40506123, "link": "https://stackoverflow.com/questions/40506123/upload-big-file-to-s3-without-passing-through-server/43794641#43794641", "title": "Upload big file to S3 without passing through server", "body": "<p>@michael-sqlbot was right. Just doing posts there's a limit of 5GB per file. You can do a multipart upload if you presign each request before uploading, which means you need to manage the splitting of the file and asking the server to sign each request before uploading.</p>\n\n<p>I ended up following @fl0cke advice and using <a href=\"https://github.com/TTLabs/EvaporateJS\" rel=\"nofollow noreferrer\">https://github.com/TTLabs/EvaporateJS</a> to manage the upload. It does all the file managing and you just have to implement the server side function to sign the request for each file.</p>\n"}, {"comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 3, "creation_date": 1598513908, "post_id": 63611234, "comment_id": 112484744, "body": "Is there anything which this answer contributes in addition to the older and accepted answer?"}, {"owner": {"reputation": 5170, "user_id": 2645713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efef9add043f756851612ae611f282f7?s=128&d=identicon&r=PG", "display_name": "Markus Zeller", "link": "https://stackoverflow.com/users/2645713/markus-zeller"}, "edited": false, "score": 1, "creation_date": 1598515244, "post_id": 63611234, "comment_id": 112485438, "body": "While this link may answer the question, it is better to include the essential parts of the answer here and provide the link for reference.  Link-only answers can become invalid if the linked page changes. - <a href=\"/review/low-quality-posts/27030140\">From Review</a>"}], "tags": [], "owner": {"reputation": 1, "user_id": 4306027, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xNYHsruxTx4/AAAAAAAAAAI/AAAAAAAAGXQ/VkgEC_Hv3Dw/photo.jpg?sz=128", "display_name": "Sreedhar", "link": "https://stackoverflow.com/users/4306027/sreedhar"}, "is_accepted": false, "score": 0, "last_activity_date": 1598518718, "last_edit_date": 1598518718, "creation_date": 1598513624, "answer_id": 63611234, "question_id": 40506123, "link": "https://stackoverflow.com/questions/40506123/upload-big-file-to-s3-without-passing-through-server/63611234#63611234", "title": "Upload big file to S3 without passing through server", "body": "<p>The limit for each object to the store is 5TB, Here you can found the reference <a href=\"https://aws.amazon.com/s3/faqs/\" rel=\"nofollow noreferrer\">link</a></p>\n"}], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1198, "favorite_count": 2, "accepted_answer_id": 43794641, "answer_count": 2, "score": 1, "last_activity_date": 1598518718, "creation_date": 1478691590, "question_id": 40506123, "link": "https://stackoverflow.com/questions/40506123/upload-big-file-to-s3-without-passing-through-server", "title": "Upload big file to S3 without passing through server", "body": "<p>I'm developing a web app that allows users to upload big files to the server and I'm using S3 to store those files. In order to be able to upload files of any size, I'm using <code>s3manager.Uploader</code> to simplify doing the multipart upload.</p>\n\n<p>Because some of the files are going to be big (~15gb) I wanted to know if it's possible to do something like the presigned URLs, but for multipart uploads? I want to avoid having to upload the data to my server and then upload it to S3. Ideally I would want an URL where I can just direct a <code>POST</code> in a html form and avoid using my web server as a proxy for the files.</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1478689795, "post_id": 40505410, "comment_id": 68253656, "body": "Use <code>map[string]whateverstruct</code> to unmarshal objects with various keys."}, {"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1478698232, "post_id": 40505410, "comment_id": 68258513, "body": "Thank you @Volker, you saved my day. I modified accordingly and it worked. Could you add it as the answer, and I would accept it."}], "answers": [{"comments": [{"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1478690499, "post_id": 40505694, "comment_id": 68254059, "body": "Sorry, the coma was invalid, when I trimmed down the json. I will correct it. But since the json is having variable keys that is not known at the time of generation, I cannot hardcode the server1.example.com into the struct. That can change."}, {"owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "reply_to_user": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1478690616, "post_id": 40505694, "comment_id": 68254115, "body": "You&#39;re right. The tool is still a great tool for when the JSON format is known in advance."}, {"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1478690648, "post_id": 40505694, "comment_id": 68254131, "body": "Yes, agree. +1 for suggesting such a handy tool :-)"}], "tags": [], "owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "is_accepted": false, "score": 0, "last_activity_date": 1478690232, "creation_date": 1478690232, "answer_id": 40505694, "question_id": 40505410, "link": "https://stackoverflow.com/questions/40505410/trouble-unmarshalling-nested-json-with-unknown-keys/40505694#40505694", "title": "Trouble unmarshalling nested json with unknown keys", "body": "<p>You JSON is not valid with superfluous comma after the second ]\nOnce you correct the JSON, you can use the excellent <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a> to build the following Go struct</p>\n\n<pre><code>type AutoGenerated struct {\n    Message struct {\n        Server1ExampleCom []struct {\n            Application string `json:\"application\"`\n            Host struct {\n                Name string `json:\"name\"`\n            } `json:\"host\"`\n            Owner string `json:\"owner\"`\n            Project string `json:\"project\"`\n            Subowner string `json:\"subowner\"`\n        } `json:\"Server1.example.com\"`\n        Server2ExampleCom []struct {\n            Application string `json:\"application\"`\n            Host struct {\n                Name string `json:\"name\"`\n            } `json:\"host\"`\n            Owner string `json:\"owner\"`\n            Project string `json:\"project\"`\n            Subowner string `json:\"subowner\"`\n        } `json:\"Server2.example.com\"`\n    } `json:\"message\"`\n    ResponseMs int `json:\"response_ms\"`\n    Success bool `json:\"success\"`\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 211, "user_id": 2326871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c0ff00678bef5223a31cb621a455fdd?s=128&d=identicon&r=PG", "display_name": "user2326871", "link": "https://stackoverflow.com/users/2326871/user2326871"}, "is_accepted": true, "score": 3, "last_activity_date": 1478702354, "creation_date": 1478702354, "answer_id": 40509559, "question_id": 40505410, "link": "https://stackoverflow.com/questions/40505410/trouble-unmarshalling-nested-json-with-unknown-keys/40509559#40509559", "title": "Trouble unmarshalling nested json with unknown keys", "body": "<p>You could include a map[string]ServerStruct to fullfill your requirements.</p>\n\n<p>your struct could look like this:</p>\n\n<pre><code>type YourStruct struct {\n    Success bool\n    ResponseMS int\n    Servers map[string]*ServerStruct\n}\n\ntype ServerStruct struct {\n    Application string\n    Owner string\n    [...]\n}\n</code></pre>\n\n<p>With some additional json tags, you will be able to parse your json.</p>\n"}], "owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 768, "favorite_count": 0, "accepted_answer_id": 40509559, "answer_count": 2, "score": 0, "last_activity_date": 1558421906, "creation_date": 1478689399, "last_edit_date": 1558421906, "question_id": 40505410, "link": "https://stackoverflow.com/questions/40505410/trouble-unmarshalling-nested-json-with-unknown-keys", "title": "Trouble unmarshalling nested json with unknown keys", "body": "<p>I am having trouble unmarshalling a json data of the below format to a struct. The structure of the json looks a bit confusing to me, so apologies for all the dumb things I am doing to unmarshal it.</p>\n\n<pre><code>{\n  \"message\": {\n    \"Server1.example.com\": [\n      {\n        \"application\": \"Apache\", \n        \"host\": {\n          \"name\": \"/^Server-[13456]/\"\n        }, \n        \"owner\": \"User1\", \n        \"project\": \"Web\", \n        \"subowner\": \"User2\"\n      }\n    ], \n    \"Server2.example.com\": [\n      {\n        \"application\": \"Mysql\", \n        \"host\": {\n          \"name\": \"/^Server[23456]/\"\n        }, \n        \"owner\": \"User2\", \n        \"project\": \"DB\", \n        \"subowner\": \"User3\"\n      }\n    ] \n  }, \n  \"response_ms\": 659, \n  \"success\": true\n}\n</code></pre>\n\n<p>I am trying to unmarshal it using the following struct.</p>\n\n<pre><code>type ServerDetails struct  {\n  Message  struct{\n    Hostname struct{\n      Details struct{\n        Application string `json:\"application\"`\n        }`json:\"-\"`\n       }`json:\"-\"`\n     }`json:\"message\"`\n}\n</code></pre>\n\n<p>The fields <code>Server[0-9].example.com</code> will be unknown at the time of generating, and will change, and there is this field </p>\n\n<pre><code>      {\n    \"application\": \"Apache\", \n    \"host\": {\n      \"name\": \"/^Server-[13456]/\"\n    },\n</code></pre>\n\n<p>just after the server name that doesn't have a key outside, which again looks confusing to me. I tried a good number of combinations to understand how this could be unmarshalled, but I failed.</p>\n\n<p>What is a working approach to get the json fields unmarshal into a struct?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 9, "creation_date": 1478686363, "post_id": 40504253, "comment_id": 68251640, "body": "I believe it&#39;s a right way. Just make the variable lower case so it&#39;s not accessible outside of package."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1478686486, "post_id": 40504253, "comment_id": 68251723, "body": "Related / possible duplicate of <a href=\"http://stackoverflow.com/questions/37385007/golang-creating-a-constant-type-and-restricting-the-types-values\">Golang: Creating a Constant Type and Restricting the Type&#39;s Values</a>."}, {"owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "edited": false, "score": 0, "creation_date": 1478686997, "post_id": 40504253, "comment_id": 68252057, "body": "You might want to look at this <a href=\"http://stackoverflow.com/questions/14426366/what-is-an-idiomatic-way-of-representing-enums-in-go\" title=\"what is an idiomatic way of representing enums in go\">stackoverflow.com/questions/14426366/&hellip;</a>"}, {"owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "edited": false, "score": 0, "creation_date": 1616674500, "post_id": 40504253, "comment_id": 118080022, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/37385007/creating-a-constant-type-and-restricting-the-types-values\">Creating a Constant Type and Restricting the Type&#39;s Values</a>"}], "answers": [{"comments": [{"owner": {"reputation": 691, "user_id": 4457241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f54c5d492ac81e8b425bd2fefcc9eb1?s=128&d=identicon&r=PG&f=1", "display_name": "leesio", "link": "https://stackoverflow.com/users/4457241/leesio"}, "edited": false, "score": 2, "creation_date": 1523971797, "post_id": 40509644, "comment_id": 86774608, "body": "This doesn&#39;t actually solve the problem. In the case of <code>foo(&quot;jop&quot;)</code> <code>&quot;jop&quot;</code> will be case to <code>MyString</code> type, so it will compile."}], "tags": [], "owner": {"reputation": 211, "user_id": 2326871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c0ff00678bef5223a31cb621a455fdd?s=128&d=identicon&r=PG", "display_name": "user2326871", "link": "https://stackoverflow.com/users/2326871/user2326871"}, "is_accepted": true, "score": -5, "last_activity_date": 1478702599, "creation_date": 1478702599, "answer_id": 40509644, "question_id": 40504253, "link": "https://stackoverflow.com/questions/40504253/how-can-i-restrict-value-of-variables-in-golang/40509644#40509644", "title": "How can I restrict value of variables in Golang?", "body": "<p>Short awnser:</p>\n\n<pre><code>type MyString string\nconst (\n    YES MyString = \"yes\"\n    NO = \"no\"\n    DONTKNOW = \"i dont know\"\n)\n\nfunc foo(arg MyString){\n    fmt.Print(arg)\n}\n\nfoo(YES) //success, prints \"yes\"\n\nfoo(\"jop\") //fails to compile\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "is_accepted": false, "score": 0, "last_activity_date": 1521501528, "creation_date": 1521501528, "answer_id": 49373941, "question_id": 40504253, "link": "https://stackoverflow.com/questions/40504253/how-can-i-restrict-value-of-variables-in-golang/49373941#49373941", "title": "How can I restrict value of variables in Golang?", "body": "<p>A nicer way of implementing this could be to allow any value, and then validating when the value is used. A short example:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"os\"\n)\n\nfunc main() {\n  fmt.Println(\"First try\")\n  if err := doSomething(\"foo\"); err != nil {\n    fmt.Fprintf(os.Stderr, \"%v\\n\", err)\n  }\n\n  fmt.Println()\n\n  fmt.Println(\"Second try\")\n  if err := doSomething(\"Yes\"); err != nil {\n    fmt.Fprintf(os.Stderr, \"%v\\n\", err)\n  }\n}\n\nfunc doSomething(s string) error {\n  switch s {\n  case \"Yes\", \"No\", \"I don't know\":\n    fmt.Println(\"Success!\")\n    return nil\n  default:\n    return fmt.Errorf(\"unsupported value: %q\", s)\n  }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>First try\nunsupported value: \"foo\"\n\nSecond try\nSuccess!\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/nt8J9wdlZkp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/nt8J9wdlZkp</a></p>\n\n<p>If you insist on implementing it in the way you suggest, perhaps your <code>SetVariable</code> method would become a little bit tidier if you used a <code>switch</code> statement as in the above example.</p>\n"}], "owner": {"reputation": 91, "user_id": 5100374, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/M22Xo.jpg?s=128&g=1", "display_name": "arzonus", "link": "https://stackoverflow.com/users/5100374/arzonus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2883, "favorite_count": 2, "accepted_answer_id": 40509644, "answer_count": 2, "score": 3, "last_activity_date": 1583703485, "creation_date": 1478685767, "last_edit_date": 1583703485, "question_id": 40504253, "link": "https://stackoverflow.com/questions/40504253/how-can-i-restrict-value-of-variables-in-golang", "title": "How can I restrict value of variables in Golang?", "body": "<p>I know Go idiomatic don't have setter and getter. But I need to restrict value of variables in Go.</p>\n\n<p>I defined new type</p>\n\n<pre><code>type MyNewStringType string\n</code></pre>\n\n<p>And variables, that was defined as MyStringType, need to restrict value.</p>\n\n<p>Variables of MyStringType can have only 3 values:\n\"Yes\", \"No\", \"I don't know\"</p>\n\n<p>How can I do it in Golang?\nIn Java, C++ I have setter and getter, but in Golang is not normal.</p>\n\n<p>I know, I can create</p>\n\n<pre><code>type MyNewStringType struct {\n   Variable string\n}\n</code></pre>\n\n<p>and create </p>\n\n<pre><code>func(m *MyNewStringType) SetVariable(newVar string) error {\n  if newVar == \"Yes\" || newVar == \"No\" || newVar == \"I don't know\" {\n    m.Variable = newVar\n    return nil\n  } else {\n    return errors.New(\"Wrong value\")\n  }\n</code></pre>\n\n<p>But I think it's wrong way. </p>\n"}, {"tags": ["nginx", "go", "lets-encrypt"], "answers": [{"tags": [], "owner": {"reputation": 7907, "user_id": 1592008, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4e208220f7cb95e6854adb653663736a?s=128&d=identicon&r=PG", "display_name": "Oleg Neumyvakin", "link": "https://stackoverflow.com/users/1592008/oleg-neumyvakin"}, "is_accepted": true, "score": 1, "last_activity_date": 1478681481, "creation_date": 1478681481, "answer_id": 40502927, "question_id": 40502926, "link": "https://stackoverflow.com/questions/40502926/how-to-use-golang-lego-lets-encrypt-client-behind-nginx/40502927#40502927", "title": "How to use golang lego let&#39;s encrypt client behind nginx?", "body": "<p>You need to add in :80 and :443 virtual servers following location:</p>\n\n<pre><code># http and https nginx servers\nlocation /.well-known/acme-challenge/ {\n    proxy_set_header Host $host;\n    proxy_pass http://127.0.0.1:4000$request_uri;\n}\n</code></pre>\n\n<p>And run lego binary:</p>\n\n<pre><code>./lego.amd64 --http 127.0.0.1:4000 --email=\"your@address.tld\" --domains domain.tld --domains some.domain.tld run\n</code></pre>\n\n<p>Your certificate files stored in:</p>\n\n<pre><code># ls -la .lego/certificates/\ntotal 20\ndrwx------ 2 root root 4096 Nov  9 08:06 .\ndrwx------ 4 root root 4096 Nov  9 08:06 ..\n-rw------- 1 root root 3477 Nov  9 08:15 domain.tld.crt\n-rw------- 1 root root  226 Nov  9 08:15 domain.tld.json\n-rw------- 1 root root 1679 Nov  9 08:15 domain.tld.key\n</code></pre>\n\n<p>In case nginx already works with valid SSL/TLS certificate and you want to add new domain name in certificate you need to exclude <code>tls-sni-01</code> solver:</p>\n\n<pre><code>./lego.amd64 --exclude=tls-sni-01  --http 127.0.0.1:4000  --email=\"your@address.com\" --domains domain.tld --domains new.domain.tld run\n</code></pre>\n"}], "owner": {"reputation": 7907, "user_id": 1592008, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4e208220f7cb95e6854adb653663736a?s=128&d=identicon&r=PG", "display_name": "Oleg Neumyvakin", "link": "https://stackoverflow.com/users/1592008/oleg-neumyvakin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1300, "favorite_count": 0, "accepted_answer_id": 40502927, "answer_count": 1, "score": 0, "last_activity_date": 1478681481, "creation_date": 1478681481, "question_id": 40502926, "link": "https://stackoverflow.com/questions/40502926/how-to-use-golang-lego-lets-encrypt-client-behind-nginx", "title": "How to use golang lego let&#39;s encrypt client behind nginx?", "body": "<p>I'd like to setup Let's Encrypt certificate to live server with nginx with lego client written in Go <a href=\"https://github.com/xenolf/lego/\" rel=\"nofollow noreferrer\">https://github.com/xenolf/lego/</a></p>\n\n<p>What I'll to do with nginx config to get certificate?</p>\n"}, {"tags": ["pointers", "go", "struct", "build", "interface"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1478685440, "post_id": 40502863, "comment_id": 68251111, "body": "Because it is forbidden."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 6507836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/80a17bb7ecb37f2f1f0e2906b0e2c253?s=128&d=identicon&r=PG", "display_name": "Sotter.liu", "link": "https://stackoverflow.com/users/6507836/sotter-liu"}, "edited": false, "score": 0, "creation_date": 1478683815, "post_id": 40502992, "comment_id": 68250156, "body": "type IFile interface {         Read() (n int, err error)         Write() (n int, err error)     }      type FileImp {         string file_name          .....     }      type TestFile struct {         IFile     }       f := TestFile{IFile : FileIml}  Does f contains  FileImp field&#39;s memory copy ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 95, "user_id": 6507836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/80a17bb7ecb37f2f1f0e2906b0e2c253?s=128&d=identicon&r=PG", "display_name": "Sotter.liu", "link": "https://stackoverflow.com/users/6507836/sotter-liu"}, "edited": false, "score": 0, "creation_date": 1478683943, "post_id": 40502992, "comment_id": 68250229, "body": "@sotter The <code>f.IFile</code> field is an interface type, it contains the copy of <code>FileImpl</code>, so yes, <code>f</code> contains a copy of <code>FileImpl</code>. If you don&#39;t want that, use a poitner, e.g. <code>&amp;FileImpl</code>, so only a copy of the pointer will be stored, but it will point to the same <code>FileImpl</code> value."}, {"owner": {"reputation": 95, "user_id": 6507836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/80a17bb7ecb37f2f1f0e2906b0e2c253?s=128&d=identicon&r=PG", "display_name": "Sotter.liu", "link": "https://stackoverflow.com/users/6507836/sotter-liu"}, "edited": false, "score": 0, "creation_date": 1478684607, "post_id": 40502992, "comment_id": 68250605, "body": "thanks , I understand that, however, ` f := TestFile{IFile : &amp;FileIml}` can not build.  In c++\uff0c Interface is a Pointer, that&#39;s why i want to <code>type TestFile struct { *IFile}</code> in golang."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1492942856, "last_edit_date": 1492942856, "creation_date": 1478681752, "answer_id": 40502992, "question_id": 40502863, "link": "https://stackoverflow.com/questions/40502863/go-error-embedded-type-cannot-be-a-pointer-to-interface/40502992#40502992", "title": "Go error: &quot;embedded type cannot be a pointer to interface&quot;", "body": "<p>The language spec does not allow it. Relevant section from the spec: <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">Struct types:</a></p>\n\n<blockquote>\n  <p>A field declared with a type but no explicit field name is an <em>anonymous</em> field, also called an <em>embedded</em> field or an embedding of the type in the struct. An embedded type must be specified as a type name <code>T</code> or as a <strong>pointer to a non-interface</strong> type name <code>*T</code>, and <code>T</code> itself may not be a pointer type. The unqualified type name acts as the field name.</p>\n</blockquote>\n\n<p>A pointer to an interface type is very rarely useful, as an interface type may hold a pointer or a non-pointer value.</p>\n\n<p>Having said that, if a concrete type that implements your <code>IFile</code> type is a pointer type, then a pointer value will be wrapped in an interface value of type <code>IFile</code>, so you still have to embed <code>IFile</code>, just the value that implements <code>IFile</code> will be a pointer value, e.g.</p>\n\n<pre><code>// Let's say *FileImpl implements IFile:\nf := TestFile{IFile: &amp;FileImpl{}}\n</code></pre>\n\n<p><strong>Edit:</strong> Answer to your comment:</p>\n\n<p>First, this is Go, not C++. In Go, interfaces are not pointers, but they are represented as a pair of <code>(type;value)</code>, where \"value\" may be pointer or non-pointer. More about this in blog post: <a href=\"https://blog.golang.org/laws-of-reflection#TOC_3.\" rel=\"nofollow noreferrer\">The Laws of Reflection: The representation of an interface</a>.</p>\n\n<p>Second, if <code>FileImpl</code> is a type, <code>f := TestFile{IFile : &amp;FileIml}</code> is obviously a compile-time error, you need a value of <code>*FileImpl</code> and <code>&amp;FileImpl</code> clearly isn't. You need for example a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a> which is in the form of <code>&amp;FileImpl{}</code>, so it should be as I posted above.</p>\n"}], "owner": {"reputation": 95, "user_id": 6507836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/80a17bb7ecb37f2f1f0e2906b0e2c253?s=128&d=identicon&r=PG", "display_name": "Sotter.liu", "link": "https://stackoverflow.com/users/6507836/sotter-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1383, "favorite_count": 0, "accepted_answer_id": 40502992, "answer_count": 1, "score": 1, "last_activity_date": 1492942856, "creation_date": 1478681243, "last_edit_date": 1478682579, "question_id": 40502863, "link": "https://stackoverflow.com/questions/40502863/go-error-embedded-type-cannot-be-a-pointer-to-interface", "title": "Go error: &quot;embedded type cannot be a pointer to interface&quot;", "body": "<p>The following code gives compile-time error:</p>\n\n<pre><code>type IFile interface {\n    Read() (n int, err error)\n    Write() (n int, err error)\n}\n\ntype TestFile struct {\n   *IFile\n}\n</code></pre>\n\n<p>Error:</p>\n\n<blockquote>\n  <p>./test.go:18: embedded type cannot be a pointer to interface</p>\n</blockquote>\n\n<p>Why can't I embed <code>*IFile</code>?</p>\n"}, {"tags": ["go", "time-format"], "answers": [{"tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": false, "score": 1, "last_activity_date": 1478679936, "creation_date": 1478679936, "answer_id": 40502582, "question_id": 40502309, "link": "https://stackoverflow.com/questions/40502309/how-can-i-set-the-logrus-time-to-utc/40502582#40502582", "title": "How can I set the logrus time to UTC", "body": "<p>You need to write your own implimentation of <code>logrus.Formatter</code>.</p>\n\n<pre><code>type Formatter interface {\n    Format(*Entry) ([]byte, error)\n}\n</code></pre>\n\n<p><a href=\"https://github.com/Sirupsen/logrus/issues/293\" rel=\"nofollow noreferrer\">Source</a></p>\n"}, {"comments": [{"owner": {"reputation": 98, "user_id": 3600716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcf75d8900076a133d2394ea3980cc69?s=128&d=identicon&r=PG&f=1", "display_name": "Gustavo Poscidonio", "link": "https://stackoverflow.com/users/3600716/gustavo-poscidonio"}, "edited": false, "score": 2, "creation_date": 1498414480, "post_id": 40502637, "comment_id": 76479453, "body": "That&#39;s so clean. I love it."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1478680209, "creation_date": 1478680209, "answer_id": 40502637, "question_id": 40502309, "link": "https://stackoverflow.com/questions/40502309/how-can-i-set-the-logrus-time-to-utc/40502637#40502637", "title": "How can I set the logrus time to UTC", "body": "<p>Time zone setting is not supported directly, but you may use a custom <a href=\"https://godoc.org/github.com/Sirupsen/logrus#Formatter\" rel=\"noreferrer\"><code>log.Formatter</code></a> in which you may \"switch\" to the time zone of your choice, UTC included.</p>\n\n<p>A simple usage that uses the local time zone (not UTC) may look like this:</p>\n\n<pre><code>import (\n    log \"github.com/Sirupsen/logrus\"\n)\n\nfunc main() {\n    log.SetFormatter(&amp;log.JSONFormatter{})\n    log.Info(\"Testing\")\n}\n</code></pre>\n\n<p>Output (time is formatted using my <code>+01</code> local timezone):</p>\n\n<pre><code>{\"level\":\"info\",\"msg\":\"Testing\",\"time\":\"2016-11-09T09:28:02+01:00\"}\n</code></pre>\n\n<p>Now let's create a custom <code>log.Formatter</code> which switches to UTC:</p>\n\n<pre><code>type UTCFormatter struct {\n    log.Formatter\n}\n\nfunc (u UTCFormatter) Format(e *log.Entry) ([]byte, error) {\n    e.Time = e.Time.UTC()\n    return u.Formatter.Format(e)\n}\n\nfunc main() {\n    log.SetFormatter(UTCFormatter{&amp;log.JSONFormatter{}})\n    log.Info(\"Testing\")\n}\n</code></pre>\n\n<p>Output (time is formatted in UTC timezone):</p>\n\n<pre><code>{\"level\":\"info\",\"msg\":\"Testing\",\"time\":\"2016-11-09T08:28:09Z\"}\n</code></pre>\n"}], "owner": {"reputation": 1001, "user_id": 4160965, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/fbb0ff599a13cc579cbac731d8d38a81?s=128&d=identicon&r=PG&f=1", "display_name": "want_to_be_calm", "link": "https://stackoverflow.com/users/4160965/want-to-be-calm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2648, "favorite_count": 2, "accepted_answer_id": 40502637, "answer_count": 2, "score": 4, "last_activity_date": 1478680209, "creation_date": 1478678613, "question_id": 40502309, "link": "https://stackoverflow.com/questions/40502309/how-can-i-set-the-logrus-time-to-utc", "title": "How can I set the logrus time to UTC", "body": "<p>I am using Go with logrus, however I found the time field is always formatted in local time. How can I change the time to UTC time for logrus?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "is_accepted": false, "score": 1, "last_activity_date": 1478703818, "last_edit_date": 1478703818, "creation_date": 1478703260, "answer_id": 40509868, "question_id": 40502111, "link": "https://stackoverflow.com/questions/40502111/how-to-pass-a-url-containing-slashes-as-a-path-parameter-in-go/40509868#40509868", "title": "How to pass a url containing slashes as a path parameter in GO?", "body": "<p><code>StrictSlashes</code> has to do with a single trailing slash, not with whether or not slashes are matched inside of a parameter (they aren't). You need to use <a href=\"http://www.gorillatoolkit.org/pkg/mux#Route.PathPrefix\" rel=\"nofollow noreferrer\"><code>PathPrefix</code></a>:</p>\n\n<pre><code>const (\n    imagesPrefix = \"/myproject/v1/image/\"  // note no {url}\n)\n\nfunc main() {\n    router := mux.NewRouter()\n\n    router.PathPrefix(imagesPrefix).Handler(\n        http.StripPrefix(imagesPrefix, GetHandler),\n    )\n}\n\nfunc GetImage (w http.ResponseWriter, r *http.Request) {\n    // r.URL.Path should contain the image path.\n}\n</code></pre>\n"}], "owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 777, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1478703818, "creation_date": 1478677626, "question_id": 40502111, "link": "https://stackoverflow.com/questions/40502111/how-to-pass-a-url-containing-slashes-as-a-path-parameter-in-go", "title": "How to pass a url containing slashes as a path parameter in GO?", "body": "<p>I want to send an url such as \"Documents/folder1/folder2/file.txt\" or it can have less slashes such as \"Documents/folder1/file.txt\", and I want to pass this url as a path parameter, such as <code>router.HandleFunc(\"/myproject/v1/image/{url}\", GetImage)</code></p>\n\n<p>but when doing this it treats to go to the url for ex: /myproject/v1/image/Documents/folder1/file.txt and it does not find it so it returns 404.</p>\n\n<p>I am using gorilla mux:</p>\n\n<pre><code>func main(){\n   router := mux.NewRouter().StrictSlash(true)\n   router.HandleFunc(\"/myproject/v1/image/{url}\", GetImage)\n}\n</code></pre>\n\n<p>I thought  that it was from the strictslash but when I set it false I remain getting 404</p>\n"}, {"tags": ["go", "ubuntu-16.04", "hyperledger", "hyperledger-fabric"], "answers": [{"tags": [], "owner": {"reputation": 15819, "user_id": 1149423, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KmNLc.png?s=128&g=1", "display_name": "Sufiyan Ghori", "link": "https://stackoverflow.com/users/1149423/sufiyan-ghori"}, "is_accepted": true, "score": 1, "last_activity_date": 1478663827, "creation_date": 1478663827, "answer_id": 40500009, "question_id": 40499958, "link": "https://stackoverflow.com/questions/40499958/cannot-run-hyperledger-chaincode-from-my-own-github-on-ubuntu-terminal/40500009#40500009", "title": "cannot run hyperledger chaincode from my own github on Ubuntu terminal", "body": "<p>First of all, you may want to use the latest version of fabric from its official repository. \nSecondly, the error is self-explanatory,</p>\n\n<pre><code>  *SimpleChaincode does not implement shim.Chaincode (wrong type for Init method)\n        have Init(*shim.ChaincodeStub, string, []string) ([]byte, error)\n        want Init(shim.ChaincodeStubInterface, string, []string) ([]byte, error)\n</code></pre>\n\n<p>You need to replace  <code>stub *shim.ChaincodeStub</code> with <code>stub shim.ChaincodeStubInterface</code> everywhere in your go file. Please read this as well, <a href=\"https://github.com/IBM-Blockchain/ibm-blockchain-issues/issues/29\" rel=\"nofollow noreferrer\">https://github.com/IBM-Blockchain/ibm-blockchain-issues/issues/29</a></p>\n"}], "owner": {"reputation": 101, "user_id": 7089821, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/t2QzE.png?s=128&g=1", "display_name": "Jeffy", "link": "https://stackoverflow.com/users/7089821/jeffy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 0, "accepted_answer_id": 40500009, "answer_count": 1, "score": 1, "last_activity_date": 1478663827, "creation_date": 1478663405, "question_id": 40499958, "link": "https://stackoverflow.com/questions/40499958/cannot-run-hyperledger-chaincode-from-my-own-github-on-ubuntu-terminal", "title": "cannot run hyperledger chaincode from my own github on Ubuntu terminal", "body": "<p>I can run the chaincode from the following official path:\n<a href=\"https://github.com/ibm-blockchain/learn-chaincode/finished\" rel=\"nofollow noreferrer\">https://github.com/ibm-blockchain/learn-chaincode/finished</a>\ngithub.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02</p>\n\n<pre><code># peer chaincode deploy -p github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02 -c '{\"Function\":\"init\", \"Args\": [\"a\",\"100\", \"b\", \"200\"]}'\n</code></pre>\n\n<p>but cannot run chainncode from my own github path:\n<a href=\"https://github.com/jeffyxia/hyperledger/trade\" rel=\"nofollow noreferrer\">https://github.com/jeffyxia/hyperledger/trade</a></p>\n\n<pre><code># peer chaincode deploy -p https://github.com/jeffyxia/hyperledger/trade -c '{\"Function\":\"init\", \"Args\": [\"a\",\"100\", \"b\", \"200\"]}'\n</code></pre>\n\n<p>the error info is: </p>\n\n<p>Error: Error building chaincode: rpc error: code = 2 desc = Error getting </p>\n\n<pre><code>chaincode package bytes: Error getting code 'go get' failed with error: \"exit status 2\"\n# github.com/jeffyxia/hyperledger/hello_world\n/go/_usercode_/519629987/src/github.com/jeffyxia/hyperledger/hello_world/chaincode_example01.go:31: cannot use new(SimpleChaincode) (type *SimpleChaincode) as type shim.Chaincode in argument to shim.Start:\n    *SimpleChaincode does not implement shim.Chaincode (wrong type for Init method)\n        have Init(*shim.ChaincodeStub, string, []string) ([]byte, error)\n        want Init(shim.ChaincodeStubInterface, string, []string) ([]byte, error)\n</code></pre>\n\n<p>supplement info:\nUbuntu 16.04 without go language environment, use PBFT algrithm.</p>\n\n<p>how to fix this problem, thx.</p>\n"}, {"tags": ["sql", "database", "go"], "answers": [{"tags": [], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "is_accepted": false, "score": 1, "last_activity_date": 1478819522, "last_edit_date": 1478819522, "creation_date": 1478668766, "answer_id": 40500532, "question_id": 40499717, "link": "https://stackoverflow.com/questions/40499717/how-to-reset-the-connection-status-getting-from-go-database-sql-pool/40500532#40500532", "title": "How to reset the connection status getting from go database/sql pool?", "body": "<p>The correct way is to set a timezone in the connection string:</p>\n\n<pre><code>sql.Open(\"mysql\", \"root@tcp(127.0.0.1:3306)/dbname?charset=utf8&amp;parseTime=true&amp;time_zone=%2B00%3A00\")\n</code></pre>\n\n<p>Note that time_zone value must be urlencoded.\nAlso you can set other system variables in conn string.</p>\n"}], "owner": {"reputation": 1, "user_id": 6502093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edf584ada161bc481e7b1e344b46c232?s=128&d=identicon&r=PG&f=1", "display_name": "user6502093", "link": "https://stackoverflow.com/users/6502093/user6502093"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1478819639, "creation_date": 1478661131, "last_edit_date": 1478819639, "question_id": 40499717, "link": "https://stackoverflow.com/questions/40499717/how-to-reset-the-connection-status-getting-from-go-database-sql-pool", "title": "How to reset the connection status getting from go database/sql pool?", "body": "<p>If I exec a <code>db.exec(\"set time_zone = \"+00:00\"\")</code>,\nthe status time_zone of connection to exec the SQL will change \nand will the connection be put back to the pool?</p>\n\n<p>If so, will it be reused by another processor who doesn't know the status of connection has been changed?</p>\n"}, {"tags": ["go", "signals", "interrupt", "interrupt-handling"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1478658270, "post_id": 40498371, "comment_id": 68242776, "body": "What do you mean by a &quot;top-level interrupt signal&quot;? SIGINT is just like any other signal."}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 3242022, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/54bAn.jpg?s=128&g=1", "display_name": "getting_better", "link": "https://stackoverflow.com/users/3242022/getting-better"}, "edited": false, "score": 0, "creation_date": 1596647271, "post_id": 40499817, "comment_id": 111880959, "body": "Unfortunately neither this nor the solution below works on windows."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 17, "last_activity_date": 1478662381, "last_edit_date": 1478662381, "creation_date": 1478661935, "answer_id": 40499817, "question_id": 40498371, "link": "https://stackoverflow.com/questions/40498371/how-to-send-an-interrupt-signal/40499817#40499817", "title": "How to send an interrupt signal", "body": "<p>Get the process using <a href=\"https://godoc.org/os#FindProcess\" rel=\"noreferrer\">FindProcess</a>, <a href=\"https://godoc.org/os#StartProcess\" rel=\"noreferrer\">StartProcess</a> or some other means.  Call <a href=\"https://godoc.org/os#Process.Signal\" rel=\"noreferrer\">Signal</a> to send the interrupt:</p>\n\n<pre><code> err := p.Signal(os.Interrupt)\n</code></pre>\n\n<p>This will send the signal to the target process (assuming the calling process has permission to do so) and invoke whatever signal handlers the target process may have for SIGINT.</p>\n"}, {"comments": [{"owner": {"reputation": 704, "user_id": 4792552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a528513962a9c962ff32df92a1a350b?s=128&d=identicon&r=PG", "display_name": "Berkant Ipek", "link": "https://stackoverflow.com/users/4792552/berkant-ipek"}, "edited": false, "score": 8, "creation_date": 1552986764, "post_id": 47951462, "comment_id": 97207540, "body": "Why the buffer is 2?"}, {"owner": {"reputation": 4866, "user_id": 215713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaa4a82dca6b5d2d0b58e784231caf3a?s=128&d=identicon&r=PG", "display_name": "rfay", "link": "https://stackoverflow.com/users/215713/rfay"}, "edited": false, "score": 2, "creation_date": 1561153674, "post_id": 47951462, "comment_id": 99984751, "body": "Note that syscall.Kill() is not available on Windows."}, {"owner": {"reputation": 452, "user_id": 5141875, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xJ1vr6IsVfo/AAAAAAAAAAI/AAAAAAAAACM/3h4GSMEpdlc/photo.jpg?sz=128", "display_name": "Tyler Kropp", "link": "https://stackoverflow.com/users/5141875/tyler-kropp"}, "reply_to_user": {"reputation": 704, "user_id": 4792552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a528513962a9c962ff32df92a1a350b?s=128&d=identicon&r=PG", "display_name": "Berkant Ipek", "link": "https://stackoverflow.com/users/4792552/berkant-ipek"}, "edited": false, "score": 0, "creation_date": 1610419897, "post_id": 47951462, "comment_id": 116121046, "body": "@BerkantIpek The documentation states, &quot;Package signal will not block sending to c: the caller must ensure that c has sufficient buffer space to keep up with the expected signal rate.&quot; Because there are multiple signals being handled in this example, one may expect to handle a higher throughput, too. At least that&#39;s my guess."}], "tags": [], "owner": {"reputation": 849, "user_id": 4469269, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/eeeca66bea8c16ff9db75f54a964c14b?s=128&d=identicon&r=PG&f=1", "display_name": "Debasish Mitra", "link": "https://stackoverflow.com/users/4469269/debasish-mitra"}, "is_accepted": false, "score": 38, "last_activity_date": 1514356920, "last_edit_date": 1514356920, "creation_date": 1514022775, "answer_id": 47951462, "question_id": 40498371, "link": "https://stackoverflow.com/questions/40498371/how-to-send-an-interrupt-signal/47951462#47951462", "title": "How to send an interrupt signal", "body": "<p>Assuming you are using something like this for capturing interrupt signal</p>\n\n<pre><code>var stopChan = make(chan os.Signal, 2)\nsignal.Notify(stopChan, os.Interrupt, syscall.SIGTERM, syscall.SIGINT)\n\n&lt;-stopChan // wait for SIGINT\n</code></pre>\n\n<p>Use below from anywhere in your code to send interrupt signal to above wait part.</p>\n\n<pre><code>syscall.Kill(syscall.Getpid(), syscall.SIGINT)\n</code></pre>\n\n<p>Or if you are in the same package where where stopChan variable is defined. Thus making it accessible. You can do this.</p>\n\n<pre><code>stopChan &lt;- syscall.SIGINT\n</code></pre>\n\n<p>Or you can define stopChan as a global variable (making the first letter in Capital letter will achieve the same), then you can send interrupt signal from a different package too.</p>\n\n<pre><code>Stopchan &lt;- syscall.SIGINT\n</code></pre>\n"}], "owner": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 22473, "favorite_count": 4, "accepted_answer_id": 40499817, "answer_count": 2, "score": 15, "last_activity_date": 1602590285, "creation_date": 1478649069, "last_edit_date": 1602590285, "question_id": 40498371, "link": "https://stackoverflow.com/questions/40498371/how-to-send-an-interrupt-signal", "title": "How to send an interrupt signal", "body": "<p>I'm trying to implement a function that would call an interrupt signal in Go. I know how to intercept interrupt signals from the console, by using <code>signal.Notify(interruptChannel, os.Interrupt)</code>, however, I can't find a way to actually send the interrupt signals around. I've found that you <a href=\"https://golang.org/pkg/os/#Process.Signal\" rel=\"nofollow noreferrer\">can send a signal to a process</a>, but I'm not sure if this can be used to send a top-level interrupt signal.</p>\n<p>Is there a way to send an interrupt signal from within a Go function that could be captured by anything that is listening for system interrupt signals, or is that something that's not supported in Go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 619, "user_id": 442952, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/adcdd4080503216e19cee81f413e6eb3?s=128&d=identicon&r=PG", "display_name": "George Antoniadis", "link": "https://stackoverflow.com/users/442952/george-antoniadis"}, "edited": false, "score": 0, "creation_date": 1500424223, "post_id": 40497498, "comment_id": 77326689, "body": "Did you by any chance figure this one out? :)"}], "owner": {"reputation": 11, "user_id": 7133999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30c799a268b500db52a08c7f1431b6bf?s=128&d=identicon&r=PG&f=1", "display_name": "Divyag", "link": "https://stackoverflow.com/users/7133999/divyag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 169, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1478644538, "creation_date": 1478643963, "last_edit_date": 1478644538, "question_id": 40497498, "link": "https://stackoverflow.com/questions/40497498/how-to-create-pgp-keys-from-tls-cert-and-key-and-use-the-pgp-private-key-for-dec", "title": "How to create PGP keys from tls cert and key and use the PGP private key for decrypting a PGP message in golang?", "body": "<p>started with the following logic,</p>\n\n<p>(based on: RSA key part is common for TLS and PGP)</p>\n\n<pre><code>tlsCert, err := tls.LoadX509KeyPair(certFilePath, keyFilePath)\nif err != nil {\n    return\n}\ncertx509, _ := ioutil.ReadFile(certFilePath)\n\nblock, _ := pem.Decode([]byte(certx509))\ncertTest, err := x509.ParseCertificate(block.Bytes)\nif err != nil {\n    return\n}\n\nprivateKeyTest := tlsCert.PrivateKey\n\nconfig = &amp;packet.Config{}\nconfig.DefaultCompressionAlgo = 1\nconfig.DefaultCipher = 9\nconfig.DefaultHash = 3\nentity, _ = openpgp.NewEntity(\"\", \"\", \"\", config)\nentity.PrimaryKey.PublicKey = (certTest.PublicKey).(*rsa.PublicKey)\nentity.PrivateKey.PrivateKey = privateKeyTest.(*rsa.PrivateKey)\n\nentitylist := make(openpgp.EntityList, 1)\nentitylist[0] = entity\n\nmd, err := openpgp.ReadMessage(encryptedmessagebytes, entitylist , nil, config)\n</code></pre>\n\n<p>openpgp.ReadMessage returns the following error</p>\n\n<p>openpgp: invalid data: tag byte does not have MSB set</p>\n\n<p>I think I'm missing something while creating the entity. Can you please help me with this?</p>\n"}, {"tags": ["go", "struct", "go-templates", "go-html-template"], "answers": [{"comments": [{"owner": {"reputation": 1143, "user_id": 3531138, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/61f1adc040dee23c6d050af20826cd92?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/3531138/steve"}, "edited": false, "score": 0, "creation_date": 1478636916, "post_id": 40495123, "comment_id": 68235801, "body": "Oh wow, Thank you so much, that worked and makes perfect sense."}, {"owner": {"reputation": 58753, "user_id": 33522, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/3MBg6.png?s=128&g=1", "display_name": "chovy", "link": "https://stackoverflow.com/users/33522/chovy"}, "edited": false, "score": 0, "creation_date": 1614858301, "post_id": 40495123, "comment_id": 117516433, "body": "i don&#39;t understand."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1478634478, "last_edit_date": 1478634478, "creation_date": 1478634125, "answer_id": 40495123, "question_id": 40494828, "link": "https://stackoverflow.com/questions/40494828/simple-if-not-working-go-template/40495123#40495123", "title": "Simple if not working go template", "body": "<p>You have to export all the fields you want to access from templates: change its first letter to capital <code>I</code>:</p>\n\n<pre><code>type Category struct {\n    ImageURL      string\n    Title         string\n    Description   string\n    IsOrientRight bool\n}\n</code></pre>\n\n<p>And every reference to it:</p>\n\n<pre><code>{{range .Categories}}\n    {{if .IsOrientRight}}\n       Hello\n    {{end}}\n    {{if eq .IsOrientRight true}}\n       Hello\n    {{end}}\n\n   &lt;!-- Print nothing --&gt;\n   {{ printf .IsOrientRight }} \n\n{{end}}\n</code></pre>\n\n<p>Every unexported field can only be accessed from the declaring package. Your package declares the <code>Category</code> type, and <a href=\"https://golang.org/pkg/text/template/\" rel=\"noreferrer\"><code>text/template</code></a> and <a href=\"https://golang.org/pkg/html/template/\" rel=\"noreferrer\"><code>html/template</code></a> are different packages, so you need to export it if you want those packages to have access to it.</p>\n\n<p><a href=\"https://golang.org/pkg/text/template/#Template.Execute\" rel=\"noreferrer\"><code>Template.Execute()</code></a> returns an error, should you have stored / examined its return value, you would have found this out immediately, as you'd get an error similar to this one:</p>\n\n<blockquote>\n  <p>template: :2:9: executing \"\" at &lt;.isOrientRight>: isOrientRight is an unexported field of struct type main.Category</p>\n</blockquote>\n\n<p>See a working example of your code on the <a href=\"https://play.golang.org/p/zOlYNNppSb\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1036, "user_id": 750425, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/COaxk.jpg?s=128&g=1", "display_name": "karora", "link": "https://stackoverflow.com/users/750425/karora"}, "is_accepted": false, "score": 1, "last_activity_date": 1521211198, "creation_date": 1521211198, "answer_id": 49323368, "question_id": 40494828, "link": "https://stackoverflow.com/questions/40494828/simple-if-not-working-go-template/49323368#49323368", "title": "Simple if not working go template", "body": "<p>If life inflicts templates on you which for some reason have lower-case variable names - perhaps constructed from a Pug template source that is also used for other things - there is a way around this issue...</p>\n\n<p>You can use a <code>map[string]interface{}</code> to hold the values to be passed into the template, so in the example above:</p>\n\n<pre><code>juiceCategory := map[string]interface{}{\n    \"ImageURL\": \"lemon.png\",\n    \"Title\":    \"Juices and Mixes\",\n    \"Description\": `Explore our wide assortment of juices and mixes expected by\n                        today's lemonade stand clientelle. Now featuring a full line of\n                        organic juices that are guaranteed to be obtained from trees that\n                        have never been treated with pesticides or artificial\n                        fertilizers.`,\n    \"isOrientRight\": true,\n}\n</code></pre>\n\n<p>and now there is no need to change your template...</p>\n"}], "owner": {"reputation": 1143, "user_id": 3531138, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/61f1adc040dee23c6d050af20826cd92?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/3531138/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2901, "favorite_count": 0, "accepted_answer_id": 40495123, "answer_count": 2, "score": 5, "last_activity_date": 1538480754, "creation_date": 1478632862, "last_edit_date": 1538480754, "question_id": 40494828, "link": "https://stackoverflow.com/questions/40494828/simple-if-not-working-go-template", "title": "Simple if not working go template", "body": "<p>So I am doing a simple if check on a bool from a struct but it doesn't seem to work, it just stop rendering the HTML.</p>\n\n<p>So the following struct is like this:</p>\n\n<pre><code>type Category struct {\n    ImageURL      string\n    Title         string\n    Description   string\n    isOrientRight bool\n}\n</code></pre>\n\n<p>Now I have a slice of that Category struct which I get to display with a range. </p>\n\n<p>Bellow is an example of one struct:</p>\n\n<pre><code>juiceCategory := Category{\n    ImageURL: \"lemon.png\",\n    Title:    \"Juices and Mixes\",\n    Description: `Explore our wide assortment of juices and mixes expected by\n                        today's lemonade stand clientelle. Now featuring a full line of\n                        organic juices that are guaranteed to be obtained from trees that\n                        have never been treated with pesticides or artificial\n                        fertilizers.`,\n    isOrientRight: true,\n}\n</code></pre>\n\n<p>I've tried multiple ways, like below, but none of them worked:</p>\n\n<pre><code>{{range .Categories}}\n    {{if .isOrientRight}}\n       Hello\n    {{end}}\n    {{if eq .isOrientRight true}}\n       Hello\n    {{end}}\n\n   &lt;!-- Print nothing --&gt;\n   {{ printf .isOrientRight }} \n\n{{end}}\n</code></pre>\n"}, {"tags": ["linux", "shell", "go", "docker"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478627182, "post_id": 40492724, "comment_id": 68230760, "body": "You&#39;re &quot;command&quot; is <code>&#47;bin&#47;bash</code>,  so you&#39;re getting the exit code from the bash process. If you want the exit code from the command, run the command directly. You also need to wait for the container to stop before reading the exit code."}, {"owner": {"reputation": 21, "user_id": 7083650, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OOuTbg8w00Q/AAAAAAAAAAI/AAAAAAAAABI/5fBW0UCvjJg/photo.jpg?sz=128", "display_name": "VOID 001", "link": "https://stackoverflow.com/users/7083650/void-001"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478627517, "post_id": 40492724, "comment_id": 68230955, "body": "The fact is I can get the correct exit code sometime(not the command in the testcase, I mean another command), so I don&#39;t think it&#39;s a matter of command &quot;/bin/bash&quot; and thanks :)"}, {"owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1478629856, "post_id": 40492724, "comment_id": 68232126, "body": "@VOID001, JimB is correct, /bin/bash will give exit codes like 233 when a child exits and it is suppose to exit as well.  Docker is running a exec.Command of /bin/bash in that case. So if you change it to a different command, the exit code is the code that command exits with."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478629924, "post_id": 40492724, "comment_id": 68232162, "body": "Yes, in this case bash returns from the <code>exit</code> call, or it will return the code from the final command, but depending on what you&#39;re providing as the argument to <code>-c</code>, you may not get what you expect. Regardless, you wait for the <i>container</i> to stop the get the exit code. I don&#39;t know wich client package you&#39;re using, but did you search for <code>Wait</code> in the documentation (waiting on a container is a standard part of the API)?"}, {"owner": {"reputation": 21, "user_id": 7083650, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OOuTbg8w00Q/AAAAAAAAAAI/AAAAAAAAABI/5fBW0UCvjJg/photo.jpg?sz=128", "display_name": "VOID 001", "link": "https://stackoverflow.com/users/7083650/void-001"}, "edited": false, "score": 0, "creation_date": 1478653176, "post_id": 40492724, "comment_id": 68241745, "body": "I use the official github.com/docker/engine-api and I am not waiting the &quot;container&quot; to exit so the containerWait is not useful for me, Cause the command exit but the container  is stll running"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478701460, "post_id": 40492724, "comment_id": 68260448, "body": "just FYI, that package is marked as deprecated, and you should use the current client from <code>github.com&#47;docker&#47;docker&#47;client</code>. I don&#39;t think there&#39;s any way to wait on a process run via <code>exec</code> inside a running container, other than polling its <code>Running</code> status.  The method for waiting on a docker process is by executing it as a container. Exec is targeted more for interactive inspection of a container (the primary use of <code>docker exec</code> is starting an interactive shell or quick changes for troubleshooting), and there isn&#39;t really any process control around it."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 7083650, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OOuTbg8w00Q/AAAAAAAAAAI/AAAAAAAAABI/5fBW0UCvjJg/photo.jpg?sz=128", "display_name": "VOID 001", "link": "https://stackoverflow.com/users/7083650/void-001"}, "edited": false, "score": 0, "creation_date": 1478747200, "post_id": 40519347, "comment_id": 68280194, "body": "The code is using deprecated github.com/docker/engine-api, I will try it with github.com/docker/docker again and post my result"}], "tags": [], "owner": {"reputation": 21, "user_id": 7083650, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OOuTbg8w00Q/AAAAAAAAAAI/AAAAAAAAABI/5fBW0UCvjJg/photo.jpg?sz=128", "display_name": "VOID 001", "link": "https://stackoverflow.com/users/7083650/void-001"}, "is_accepted": false, "score": 0, "last_activity_date": 1478747078, "creation_date": 1478747078, "answer_id": 40519347, "question_id": 40492724, "link": "https://stackoverflow.com/questions/40492724/docker-api-containerexecinspect-cannot-get-correct-exit-code/40519347#40519347", "title": "docker api ContainerExecInspect cannot get correct exit code", "body": "<p>I think now I can solve my problem</p>\n\n<p>The main point is when using containerExecAttach it will exposed the hijacked connection and, I can judge whether the command exit by read from the connection until EOF</p>\n\n<p>There are a few point to set then</p>\n\n<ol>\n<li>Should set ExecConfig AttachStdout to true</li>\n<li>Then read from hijacked conn</li>\n</ol>\n\n<p>Here is a sample code</p>\n\n<pre><code>atinfo, err := cli.ContainerExecAttach(ctx, execID, ec)\n\n// error handling\n\ndefer atinfo.Close()\nc = atinfo.Conn \n\none := make([]byte, 1)\n_, err = c.Read(one)\n\nif err == io.EOF {\n    println(\"Connection closed\")\n}\n</code></pre>\n\n<p>This will wait until the command execute complete</p>\n\n<p>ExecConfig is set to</p>\n\n<pre><code>ec.Detach = false\nec.Tty = false\nec.AttachStdout = true\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 7083650, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OOuTbg8w00Q/AAAAAAAAAAI/AAAAAAAAABI/5fBW0UCvjJg/photo.jpg?sz=128", "display_name": "VOID 001", "link": "https://stackoverflow.com/users/7083650/void-001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 769, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1478747078, "creation_date": 1478625152, "last_edit_date": 1478655492, "question_id": 40492724, "link": "https://stackoverflow.com/questions/40492724/docker-api-containerexecinspect-cannot-get-correct-exit-code", "title": "docker api ContainerExecInspect cannot get correct exit code", "body": "<p>I am using docker engine-api(github.com/docker/engine-api) to execute some command</p>\n\n<p>I use client.ContainerExecCreate  and then client.ContainerExecInspect to run my command and then get the command exit code(I run multiple commands in the same container so the exit code get from ContainerInspect is useless for me.)</p>\n\n<p>This is my function use to execute command in container </p>\n\n<p><a href=\"http://pastebin.com/rTNVuv9T\" rel=\"nofollow noreferrer\">http://pastebin.com/rTNVuv9T</a></p>\n\n<p>but ContainerExecInspect return wrong values sometime, because sometimes ContainerExecInspect is called before the command exit and it said exit code is zero, which is wrong</p>\n\n<p>And I wrote a testcase to test it</p>\n\n<p><a href=\"http://pastebin.com/PED1Rf4k\" rel=\"nofollow noreferrer\">http://pastebin.com/PED1Rf4k</a></p>\n\n<p>And the result will not be 233, it will be 0</p>\n\n<p>I have set ExecConfig.Detach = true and ExecStartCheck.Detach = true, but no helps</p>\n\n<p>Is there any way to wait until the command exit then get the exit code?</p>\n\n<p>Addition:</p>\n\n<p>For some of my command running is shell script not a executable, so I think I need to prefix /bin/bash, and wait the <strong>container</strong> exit, is not what I want, I want to wait the <strong>command</strong> exit, and the container is still running </p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 3, "creation_date": 1478624177, "post_id": 40491438, "comment_id": 68228915, "body": "Can you explain more about what you want to do and what you&#39;re having trouble with?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1478630067, "post_id": 40491438, "comment_id": 68232227, "body": "You could read the incoming JSON into a <code>map[string]interface{}</code> then iterate that map comparing the keys to field names on the struct and assigning to the struct if there is a match, assuming a type assert on the value succeeds. If the incoming JSON is arbitrary and can include nesting you&#39;ll have to use a recursive algorithm to ensure you reach all nested keys."}, {"owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "edited": false, "score": 0, "creation_date": 1478634386, "post_id": 40491438, "comment_id": 68234520, "body": "So I got as far as reading the incoming JSON into <code>map[string]interface{}</code> as you suggest, but then got stuck on the iteration part.  I checked out the mergo library, as well as a bunch of stack overflow answers and such, but coming from a ruby background it all seems a bit more difficult than in ruby :)"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1478635924, "post_id": 40491438, "comment_id": 68235281, "body": "I can give you some guidance in an answer but don&#39;t have the time to write hardened code in answer. I would say it&#39;s fairly hard logic to implement."}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1478659675, "post_id": 40491438, "comment_id": 68243024, "body": "@Frap when you say arbitrary JSON, can it be anything ? Or would it still have a certain <code>pattern</code> ? For example, do you plan to support something like <code>[{a:1,b:2}]</code> as well as <code>{a:1,b:2}</code>."}], "answers": [{"comments": [{"owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "edited": false, "score": 0, "creation_date": 1478785122, "post_id": 40499635, "comment_id": 68297993, "body": "In terms of requirements, I have an app: <a href=\"https://github.com/jaxxstorm/sensu-wrapper\" rel=\"nofollow noreferrer\">github.com/jaxxstorm/sensu-wrapper</a> which allows a user to build a JSON string and send it to either a socket or stdout.  The reason I specify arbitrary JSON is because every user has different fields that they might want to send with the monitoring check. If they were fixed fields, I figure it&#39;d be quite easy, but arbitrary JSON and typing seems to be difficult!"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "edited": false, "score": 0, "creation_date": 1478791324, "post_id": 40499635, "comment_id": 68302167, "body": "Can you add a sample of an arbitrary input json in the question ? And yes arbitrary JSON can be difficult to handle in Go."}, {"owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "edited": false, "score": 0, "creation_date": 1478799374, "post_id": 40499635, "comment_id": 68307283, "body": "An example would be: <code>{&quot;environment&quot;: &quot;production&quot;, &quot;runbook&quot;:&quot;http:&#47;&#47;url&quot;, &quot;message&quot;, &quot;there is a problem&quot;}</code>"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "edited": false, "score": 0, "creation_date": 1478891681, "post_id": 40499635, "comment_id": 68347569, "body": "I&#39;ve updated the answer. Let me know if it cover&#39;s your use case."}, {"owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "edited": false, "score": 0, "creation_date": 1479016912, "post_id": 40499635, "comment_id": 68378054, "body": "Thanks for the update! One question, if I unmarshal the JSON into a struct, I can add each struct value from the original manually, but is there a way to simple merge the two structs and finish with a final struct I can marshal into JSON again?"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "edited": false, "score": 0, "creation_date": 1479017686, "post_id": 40499635, "comment_id": 68378216, "body": "No. Since your input JSON is arbitrary, the only option we can use is a <code>map[string]interface{}</code> and since you cannot let repeating values in the input JSON overwrite the values defined in <code>Output</code>, this is the only way."}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "edited": false, "score": 0, "creation_date": 1479017762, "post_id": 40499635, "comment_id": 68378229, "body": "One thing you can do is to skip using <code>Output</code> struct and instead directly write the values into the map once it&#39;s unmarshaled with with input JSON."}, {"owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "edited": false, "score": 2, "creation_date": 1479017827, "post_id": 40499635, "comment_id": 68378246, "body": "Excellent, appreciate your help and responses! Have accepted your answer!"}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 9, "last_activity_date": 1478856984, "last_edit_date": 1478856984, "creation_date": 1478660208, "answer_id": 40499635, "question_id": 40491438, "link": "https://stackoverflow.com/questions/40491438/merging-two-json-strings-in-golang/40499635#40499635", "title": "Merging two JSON strings in golang", "body": "<p>Input JSON :</p>\n\n<pre><code>{\n    \"environment\": \"production\",\n    \"runbook\": \"http://url\",\n    \"message\": \"there is a problem\"\n}\n</code></pre>\n\n<p>It's better to unmarshal the input JSON and combine the two structures before marshaling <code>Output</code> struct.</p>\n\n<p>Sample Code</p>\n\n<pre><code>inputJSON := `{\"environment\": \"production\", \"runbook\":\"http://url\",\"message\":\"there is a problem\"}`\nout := map[string]interface{}{}\njson.Unmarshal([]byte(inputJSON), &amp;out)\n\nout[\"name\"] = sensu_values.Name\nout[\"command\"] = sensu_values.Command\nout[\"status\"] = sensu_values.Status\n\noutputJSON, _ := json.Marshal(out)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/n_oq89ybA5\" rel=\"noreferrer\">Play Link</a></p>\n"}], "owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12447, "favorite_count": 4, "accepted_answer_id": 40499635, "answer_count": 1, "score": 5, "last_activity_date": 1478856984, "creation_date": 1478621061, "question_id": 40491438, "link": "https://stackoverflow.com/questions/40491438/merging-two-json-strings-in-golang", "title": "Merging two JSON strings in golang", "body": "<p>I have a struct which I convert to JSON in the old fashioned way:</p>\n\n<pre><code>type Output struct {\n    Name     string   `json:\"name\"`\n    Command  string   `json:\"command\"`\n    Status   int      `json:\"status\"`\n    Output   string   `json:\"output\"`\n    Ttl      int      `json:\"ttl,omitempty\"`\n    Source   string   `json:\"source,omitempty\"`\n    Handlers []string `json:\"handlers,omitempty\"`\n  }\n\nsensu_values := &amp;Output{\n      Name:     name,\n      Command:  command,\n      Status:   status,\n      Output:   output,\n      Ttl:      ttl,\n      Source:   source,\n      Handlers: [handlers],\n    }\n</code></pre>\n\n<p>I want to read an arbitrary JSON file from the filesystem, which can be defined as anything by the user, and then add it to the existing JSON string, taking the duplicates from the original.</p>\n\n<p>How can I do this?</p>\n"}, {"tags": ["postgresql", "go", "transactions"], "comments": [{"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1478618054, "post_id": 40490050, "comment_id": 68224581, "body": "I don&#39;t think is possible to share a transaction through different connections. Please explain better what you want to do, maybe adding an example in order to make it easy to understand."}, {"owner": {"reputation": 53, "user_id": 2639808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beafcf612e792185a147660701fc0b19?s=128&d=identicon&r=PG", "display_name": "MasterJ", "link": "https://stackoverflow.com/users/2639808/masterj"}, "reply_to_user": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1478618556, "post_id": 40490050, "comment_id": 68224917, "body": "I have a golang command which parses set of csv files and populates appropriate tables in database. These files a very big. Parser reads files row by row and puts them  to the channel.  Four goroutines takes these results from a channel and make Exec(). If I do  db.Exec() whole process takes 25 minuts, if tx.Exec() more than 4 hours."}, {"owner": {"reputation": 53, "user_id": 2639808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beafcf612e792185a147660701fc0b19?s=128&d=identicon&r=PG", "display_name": "MasterJ", "link": "https://stackoverflow.com/users/2639808/masterj"}, "reply_to_user": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1478618786, "post_id": 40490050, "comment_id": 68225066, "body": "moreover I can&#39;t proceed different files in different transactions, because handling of current file must see changes that done by previous files. (Postgres doesn&#39;t support READ UNCOMMITED) As a result for whole process I can use only one connection."}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 2639808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beafcf612e792185a147660701fc0b19?s=128&d=identicon&r=PG", "display_name": "MasterJ", "link": "https://stackoverflow.com/users/2639808/masterj"}, "edited": false, "score": 0, "creation_date": 1478619335, "post_id": 40490705, "comment_id": 68225443, "body": "Thank you. I also thought about it. But why do you think that transaction did not need? By requirements if process fails in some point, we should get database in previous condition."}, {"owner": {"reputation": 23, "user_id": 7132262, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZLp68RvJ_28/AAAAAAAAAAI/AAAAAAAAAGs/-I5KcIIxaDk/photo.jpg?sz=128", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u041d\u0438\u043a\u043e\u043b\u0430\u0435\u0432", "link": "https://stackoverflow.com/users/7132262/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9-%d0%9d%d0%b8%d0%ba%d0%be%d0%bb%d0%b0%d0%b5%d0%b2"}, "reply_to_user": {"reputation": 53, "user_id": 2639808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beafcf612e792185a147660701fc0b19?s=128&d=identicon&r=PG", "display_name": "MasterJ", "link": "https://stackoverflow.com/users/2639808/masterj"}, "edited": false, "score": 0, "creation_date": 1478691828, "post_id": 40490705, "comment_id": 68254780, "body": "I assume that you perform the necessary checks on the downloaded data is not in the business logic layer, or in the stage table, and then load them outside of the transaction.  In any case, long-running transaction over large volumes of data will lead to degradation of performance DBMS."}, {"owner": {"reputation": 23, "user_id": 7132262, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZLp68RvJ_28/AAAAAAAAAAI/AAAAAAAAAGs/-I5KcIIxaDk/photo.jpg?sz=128", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u041d\u0438\u043a\u043e\u043b\u0430\u0435\u0432", "link": "https://stackoverflow.com/users/7132262/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9-%d0%9d%d0%b8%d0%ba%d0%be%d0%bb%d0%b0%d0%b5%d0%b2"}, "reply_to_user": {"reputation": 53, "user_id": 2639808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beafcf612e792185a147660701fc0b19?s=128&d=identicon&r=PG", "display_name": "MasterJ", "link": "https://stackoverflow.com/users/2639808/masterj"}, "edited": false, "score": 0, "creation_date": 1478695388, "post_id": 40490705, "comment_id": 68256752, "body": "You can try to play with the levels of insulation.  1. Select the desired number of connections (the number of threads). Set them to the isolation level &quot;Read uncommitted&quot; <a href=\"https://www.postgresql.org/docs/9.6/static/transaction-iso.html\" rel=\"nofollow noreferrer\">link</a> to see the changes made in another threads 2. In each of them start a transaction 3. When the thread complete load data, it must wait for the others and did not commit the transaction 4. When all the threads done - perform commit at all threads.  In the case of SQL-error in one of the thread rollback changes to all threads."}], "tags": [], "owner": {"reputation": 23, "user_id": 7132262, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZLp68RvJ_28/AAAAAAAAAAI/AAAAAAAAAGs/-I5KcIIxaDk/photo.jpg?sz=128", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u041d\u0438\u043a\u043e\u043b\u0430\u0435\u0432", "link": "https://stackoverflow.com/users/7132262/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9-%d0%9d%d0%b8%d0%ba%d0%be%d0%bb%d0%b0%d0%b5%d0%b2"}, "is_accepted": false, "score": 1, "last_activity_date": 1478619003, "creation_date": 1478619003, "answer_id": 40490705, "question_id": 40490050, "link": "https://stackoverflow.com/questions/40490050/is-it-possible-multiple-connections-per-one-transaction-in-postgres-golang-usag/40490705#40490705", "title": "Is it possible multiple connections per one transaction in Postgres? Golang usage", "body": "<p>I am confident that the transaction did not need to. </p>\n\n<p>But if much want to - you can make a staging table, fill it with several routines, and then in a transaction to transfer data in bulk by using such \"insert from select\"</p>\n"}], "owner": {"reputation": 53, "user_id": 2639808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beafcf612e792185a147660701fc0b19?s=128&d=identicon&r=PG", "display_name": "MasterJ", "link": "https://stackoverflow.com/users/2639808/masterj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1084, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1478619003, "creation_date": 1478616994, "question_id": 40490050, "link": "https://stackoverflow.com/questions/40490050/is-it-possible-multiple-connections-per-one-transaction-in-postgres-golang-usag", "title": "Is it possible multiple connections per one transaction in Postgres? Golang usage", "body": "<p>I need to populate table in Postgres concurrently by using multiple connections but in scope of single transaction. Is it possible?</p>\n\n<p>I don't see any way to avoid this bottleneck.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["authentication", "go", "web-scraping", "ntlm"], "answers": [{"comments": [{"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1529589593, "post_id": 40488871, "comment_id": 88937127, "body": "@John i have tried the same code but it did not work for me, now here the thing is sometimes the authentication happens and sometimes not, please suggest"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1529993934, "post_id": 40488871, "comment_id": 89063831, "body": "@VijayKumar I have not provided error handling in the example code. Try checking the errors to see what&#39;s wrong."}, {"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1530183405, "post_id": 40488871, "comment_id": 89150552, "body": "@JohnSPerayil error says 401 unauthorized, its an https domain. Do we need to modify anything for an https domain"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 1, "creation_date": 1530250491, "post_id": 40488871, "comment_id": 89177642, "body": "@VijayKumar HTTPS shouldn&#39;t be a problem, besides the server is returning Unauthorised. But would need more details to debug the issue since you said it happens only sometimes.  This comment box is not the right place to discuss it are so create a question on SO with more details or create a room on <a href=\"https://chat.stackoverflow.com\">chat.stackoverflow.com</a> and invite me so that we can discuss it."}, {"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1530265458, "post_id": 40488871, "comment_id": 89185063, "body": "@JohnSPerayil i have created a group and invited you there, please join in"}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 3, "last_activity_date": 1478614874, "last_edit_date": 1478614874, "creation_date": 1478613698, "answer_id": 40488871, "question_id": 40488583, "link": "https://stackoverflow.com/questions/40488583/golang-web-scraper-ntlm-authentication/40488871#40488871", "title": "Golang web scraper NTLM authentication", "body": "<p>You can use a package like <a href=\"https://github.com/Azure/go-ntlmssp\" rel=\"nofollow noreferrer\"><code>Azure/go-ntlmssp</code></a> to authenticate before you start scraping.</p>\n\n<pre><code>url, username, password := \"http://www.some-website.com\", \"admin\", \"12345\"\n\nclient := &amp;http.Client{\n    Transport: ntlmssp.Negotiator{\n        RoundTripper:&amp;http.Transport{},\n    },\n}\n\nreq, _ := http.NewRequest(\"GET\", url, nil)\nreq.SetBasicAuth(username, password)\n\nres, _ := client.Do(req)\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 6579787, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qkiyO.jpg?s=128&g=1", "display_name": "Abdelrahman Abdelhafez", "link": "https://stackoverflow.com/users/6579787/abdelrahman-abdelhafez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1664, "favorite_count": 0, "accepted_answer_id": 40488871, "answer_count": 1, "score": 2, "last_activity_date": 1498762630, "creation_date": 1478612902, "last_edit_date": 1478614234, "question_id": 40488583, "link": "https://stackoverflow.com/questions/40488583/golang-web-scraper-ntlm-authentication", "title": "Golang web scraper NTLM authentication", "body": "<p>A Golang web scraper needs to extract information from a webpage that is NTLM-authenticated.</p>\n\n<p>Having a valid username &amp; password, how can the web scraper perform the NTLM 4-way handshake with the server in order to gain access to the protected webpage behind?</p>\n\n<pre><code>url, username, password := \"http://www.some-website.com\", \"admin\", \"12345\"\n\nclient := &amp;http.Client{}\nreq, _ := http.NewRequest(\"GET\", url, nil)\nreq.Header.Set(\"Authorization\", \"NTLM\")\nres, _ := client.Do(req)\n</code></pre>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1478614231, "post_id": 40488409, "comment_id": 68221755, "body": "Why are <code>Split</code> and <code>Trim</code>/<code>TrimSpace</code> not a good idea?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4734497"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478619723, "post_id": 40488409, "comment_id": 68225730, "body": "@JimB I think I&#39;ll get much more memory allocation that I can avoid by using <code>Scanner</code>."}, {"owner": {"reputation": 35134, "user_id": 50543, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RCFWL.jpg?s=128&g=1", "display_name": "Julian Reschke", "link": "https://stackoverflow.com/users/50543/julian-reschke"}, "edited": false, "score": 2, "creation_date": 1478621198, "post_id": 40488409, "comment_id": 68226907, "body": "You can&#39;t use anything that simply splits on strings, as cache control values can use quoted-string syntax, which would allow a &quot;,&quot; inside a value"}], "answers": [{"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1478619911, "post_id": 40489624, "comment_id": 68225870, "body": "It fails for the valid header value <code>public,max-age=3600</code>."}, {"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1478620681, "post_id": 40489624, "comment_id": 68226506, "body": "@MellowMarmot that is correct. I always thought the space is required, but the specs say otherwise (<a href=\"https://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2\" rel=\"nofollow noreferrer\">w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2</a>)"}, {"owner": {"reputation": 35134, "user_id": 50543, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RCFWL.jpg?s=128&g=1", "display_name": "Julian Reschke", "link": "https://stackoverflow.com/users/50543/julian-reschke"}, "edited": false, "score": 0, "creation_date": 1478621052, "post_id": 40489624, "comment_id": 68226786, "body": "@TheHippo that&#39;s not the spec (anymore)"}, {"owner": {"reputation": 35134, "user_id": 50543, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RCFWL.jpg?s=128&g=1", "display_name": "Julian Reschke", "link": "https://stackoverflow.com/users/50543/julian-reschke"}, "edited": false, "score": 2, "creation_date": 1478629854, "post_id": 40489624, "comment_id": 68232124, "body": "it&#39;ll fail for Cache-Control parameters using quoted-string values, which might contain a comma."}], "tags": [], "owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "is_accepted": false, "score": -1, "last_activity_date": 1478620866, "last_edit_date": 1478620866, "creation_date": 1478615814, "answer_id": 40489624, "question_id": 40488409, "link": "https://stackoverflow.com/questions/40488409/golang-http-parsing-header-with-multiple-values/40489624#40489624", "title": "golang http parsing header with multiple values", "body": "<p>Nothing wrong with:</p>\n\n<pre><code>url := \"https://accounts.google.com/.well-known/openid-configuration\"\nresp, err := http.Get(url)\nfields := strings.Split(resp.Header.Get(\"Cache-Control\"), \",\")\nfor i, field := range field {\n    fields[i] = strings.Trim(field, \" \")\n}\n</code></pre>\n\n<p><strong>Edit:</strong> Edit now works if space after comma is missing</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4734497"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1579, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1478642269, "creation_date": 1478612399, "last_edit_date": 1478642269, "question_id": 40488409, "link": "https://stackoverflow.com/questions/40488409/golang-http-parsing-header-with-multiple-values", "title": "golang http parsing header with multiple values", "body": "<p>How can I obtain value from header that have multiple comma separated values. For instance,</p>\n\n<pre><code>url := \"https://accounts.google.com/.well-known/openid-configuration\"\nresp, err := http.Get(url)\nfield := resp.Header.Get(\"Cache-Control\") // \"public, max-age=3600\"\n</code></pre>\n\n<p>In this case I want get <code>max-age</code> value. I see 2 cases:</p>\n\n<ul>\n<li>using <code>strings.Split()</code>, <code>Trim()</code> and etc (I think it's not good idea)</li>\n<li>using <code>bufio.Scanner</code> with <code>SplitFunc</code> (little bit better)</li>\n</ul>\n\n<p>Any good idea or best practice?</p>\n\n<p><strong>Edit 1.</strong> Using <code>strings.FieldsFunc()</code></p>\n\n<pre><code>const input = \"   public,max-age=3000,   anothercase   \"\n\nsep := func(c rune) bool {\n    return c == ',' || c == ' '\n}\nvalues := strings.FieldsFunc(input, sep)\n</code></pre>\n\n<p>Regarding benchmarks</p>\n\n<pre><code>BenchmarkTrim-4  2000000  861 ns/op  48 B/op  1 allocs/op\n</code></pre>\n\n<p><strong>Edit 2.</strong> Using <code>Scaner()</code></p>\n\n<p>So lets benchmark it</p>\n\n<pre><code>func ScanHeaderValues(data []byte, atEOF bool) (advance int, token []byte, err error) {\n    // Skip leading spaces.\n    var start int\n    for start = 0; start &lt; len(data); start++ {\n        if data[start] != ' ' {\n            break\n        }\n    }\n    // Scan until comma\n    for i := start; i &lt; len(data); i++ {\n        if data[i] == ',' {\n            return i + 1, data[start:i], nil\n        }\n    }\n    // If we're at EOF, we have a final, non-empty, non-terminated word. Return it.\n    if atEOF &amp;&amp; len(data) &gt; start {\n        return len(data), data[start:], nil\n    }\n    // Request more data.\n    return start, nil, nil\n}\n\nfunc BenchmarkScanner(b *testing.B) {\n    const input = \"   public,max-age=3000,   anothercase   \"\n    scanner := bufio.NewScanner(strings.NewReader(input))\n    split := func(data []byte, atEOF bool) (advance int, token []byte, err error) {\n        advance, token, err = ScanHeaderValues(data, atEOF)\n        return\n    }\n    scanner.Split(split)\n\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        for scanner.Scan() {\n            // a := scanner.Text()\n            // b.Logf(\"%+v\\n\", a)\n        }\n    }\n}\n</code></pre>\n\n<p>And result:</p>\n\n<pre><code>BenchmarkTrim-4     2000000   861  ns/op  48 B/op  1 allocs/op\nBenchmarkScanner-4  50000000  21.2 ns/op  0  B/op  0 allocs/op\n</code></pre>\n\n<p>If you have any other better solution I would like see it.</p>\n"}, {"tags": ["logging", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1478613312, "last_edit_date": 1495540386, "creation_date": 1478613007, "answer_id": 40488616, "question_id": 40488027, "link": "https://stackoverflow.com/questions/40488027/limitations-of-go-lang-log-package/40488616#40488616", "title": "Limitations of GO lang log package", "body": "<p>Logging to file using the builtin <a href=\"https://golang.org/pkg/log/\" rel=\"nofollow noreferrer\"><code>log</code></a> package is not an issue, you can use <a href=\"https://golang.org/pkg/log/#SetOutput\" rel=\"nofollow noreferrer\"><code>log.SetOutput()</code></a> or <a href=\"https://golang.org/pkg/log/#Logger.SetOutput\" rel=\"nofollow noreferrer\"><code>Logger.SetOutput()</code></a> to set a destination <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\"><code>io.Writer</code></a> other than the default <code>os.Stderr</code>, for example a file <a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\"><code>*os.File</code></a>.</p>\n\n<p>What's missing and often whished for is leveled logging (e.g. <code>INFO</code>, <code>WARN</code>, <code>DEBUG</code>, <code>ERROR</code> etc.). For a reasoning, read blog post <a href=\"http://dave.cheney.net/2015/11/05/lets-talk-about-logging\" rel=\"nofollow noreferrer\">Dave Cheney: Let's talk about logging</a>.</p>\n\n<p>You also can't enforce a specific <a href=\"https://golang.org/pkg/log/#Logger\" rel=\"nofollow noreferrer\"><code>log.Logger</code></a> to be used by designated packages unless those packages \"willing\" to cooperate (e.g. they provide a <code>SetLogger()</code> function).</p>\n\n<p>Rolling log files is also a missing feature.</p>\n\n<p>On the other hand, it's also very easy to \"extend\" the standard logger to log into MongoDB for example, for details see <a href=\"https://stackoverflow.com/questions/40396499/go-create-io-writer-inteface-for-logging-to-mongodb-database\">Go: Create io.Writer inteface for logging to mongodb database</a>. Using MongoDB you can also use a <a href=\"https://docs.mongodb.com/manual/core/capped-collections/\" rel=\"nofollow noreferrer\">Capped collection</a> which will implicitly give you a \"rolling file\" functionality.</p>\n"}, {"tags": [], "owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "is_accepted": false, "score": 2, "last_activity_date": 1478619788, "last_edit_date": 1478619788, "creation_date": 1478619474, "answer_id": 40490844, "question_id": 40488027, "link": "https://stackoverflow.com/questions/40488027/limitations-of-go-lang-log-package/40490844#40490844", "title": "Limitations of GO lang log package", "body": "<p>Logging to file can be done multiple ways.  </p>\n\n<p>The 12-factor-app way (not just the 12 factor app way, but 12 factor apps make a point of doing it this way) of doing it would be to log to STDOUT and/or STDERR and then piping it elsewhere for deployment.  This also makes development easy.  Also if you're using something like containers to deploy your program, they log the container's STDOUT and STDERR to a file to begin with.</p>\n\n<p>The std lib <code>log</code> package has two ways to change output to a file.</p>\n\n<p>One way is as follows:</p>\n\n<pre><code>log.SetOutput(&lt;something that implements io.Writer, probably os.File&gt;)\n\nlog.Println(\"some message\")\n</code></pre>\n\n<p>The other is:</p>\n\n<pre><code>logger := log.New(&lt;something that implements io.Writer, probably os.File&gt;, &lt;a prefix String&gt;, &lt;some flag, see https://golang.org/pkg/log/#pkg-constants&gt;)\n\nlogger.Println(\"some message\")\n</code></pre>\n\n<p>The second option is also how you can implement different log levels (i.e. INFO, DEBUG, WARN, ERROR, etc) by having each level be its own logger.</p>\n\n<p>However logrus gives you a lot of this already for you, so that is probably your best bet if you just want to have logging implemented quickly.</p>\n"}], "owner": {"reputation": 622, "user_id": 5604249, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7bed34ebe08c34a10addbea1bf85ff17?s=128&d=identicon&r=PG&f=1", "display_name": "Pharaoh", "link": "https://stackoverflow.com/users/5604249/pharaoh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1714, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1478619788, "creation_date": 1478611269, "question_id": 40488027, "link": "https://stackoverflow.com/questions/40488027/limitations-of-go-lang-log-package", "title": "Limitations of GO lang log package", "body": "<p>I am implementing logger in Go. I am thinking of using logrus for this. I wanted to understand limitations of the built in log package. </p>\n\n<p>I know that if we want to write logs to file or implement rolling file logs etc we would need to add this feature manually. Is there any other limitations for which we have to choose an external log package?</p>\n"}, {"tags": ["javascript", "go", "cors"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1478603547, "post_id": 40485248, "comment_id": 68214435, "body": "show the go setup for the cors please."}, {"owner": {"reputation": 593, "user_id": 8960344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6a4695a4739b1539ab219c4d10459c7?s=128&d=identicon&r=PG", "display_name": "Nima Ghotbi", "link": "https://stackoverflow.com/users/8960344/nima-ghotbi"}, "edited": false, "score": 0, "creation_date": 1478604341, "post_id": 40485248, "comment_id": 68214890, "body": "<code>Access-Control-Allow-Origin</code> is not a request header it should be on the server response. read <a href=\"https://en.wikipedia.org/wiki/Cross-origin_resource_sharing#Simple_example\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/&hellip;</a>"}, {"owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "edited": false, "score": 0, "creation_date": 1478607386, "post_id": 40485248, "comment_id": 68216893, "body": "<code>Fetch API cannot load http:&#47;&#47;localhost:8080&#47;login. Response for preflight has invalid HTTP status code 401</code> is the error message that I get if I add <code>w.Header().Set(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)</code> in the server HTTP handler. As of now the server code does not have any CORS related code and I am looking for that exactly."}], "answers": [{"comments": [{"owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "edited": false, "score": 0, "creation_date": 1478607301, "post_id": 40485707, "comment_id": 68216847, "body": "I have tried this earlier and it did not work. I get: <code>Fetch API cannot load http:&#47;&#47;localhost:8080&#47;login. Response for preflight has invalid HTTP status code 401 </code> in the chrome. <code>ok</code> still remains false in the server side."}, {"owner": {"reputation": 441, "user_id": 4016841, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/AHRZN.png?s=128&g=1", "display_name": "PiMaker", "link": "https://stackoverflow.com/users/4016841/pimaker"}, "reply_to_user": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "edited": false, "score": 0, "creation_date": 1478607648, "post_id": 40485707, "comment_id": 68217073, "body": "What you&#39;re looking at is an error message from the CORS Preflight check. See <a href=\"http://stackoverflow.com/questions/22972066/how-to-handle-preflight-cors-requests-on-a-go-server\" title=\"how to handle preflight cors requests on a go server\">stackoverflow.com/questions/22972066/&hellip;</a> on how to implement that in Go."}, {"owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "edited": false, "score": 0, "creation_date": 1478609977, "post_id": 40485707, "comment_id": 68218612, "body": "I get only one <code>New incoming request</code> on the server side logs, for each request from the browser. Not two requests (one r.POST and another r.OPTIONS) are coming as per the server side logs."}, {"owner": {"reputation": 441, "user_id": 4016841, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/AHRZN.png?s=128&g=1", "display_name": "PiMaker", "link": "https://stackoverflow.com/users/4016841/pimaker"}, "reply_to_user": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "edited": false, "score": 0, "creation_date": 1478610052, "post_id": 40485707, "comment_id": 68218655, "body": "Yes, you get the OPTIONS request after which the browser aborts. If you implement the preflight correctly, the browser will continue to send the actual fetch request."}, {"owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "edited": false, "score": 0, "creation_date": 1478612070, "post_id": 40485707, "comment_id": 68220188, "body": "Can you update your code to include OPTIONS handling ? Whatever I have tried seem to not fix the issue. All the code that my server currently has is in the question."}, {"owner": {"reputation": 441, "user_id": 4016841, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/AHRZN.png?s=128&g=1", "display_name": "PiMaker", "link": "https://stackoverflow.com/users/4016841/pimaker"}, "reply_to_user": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "edited": false, "score": 0, "creation_date": 1478613096, "post_id": 40485707, "comment_id": 68220946, "body": "I have updated the answer although you might have to specify your methods/headers explicitly instead of *"}, {"owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "edited": false, "score": 0, "creation_date": 1478714463, "post_id": 40485707, "comment_id": 68268253, "body": "The * was the culprit. Chrome seem to block that for some reason. The server code should return: <code>w.Header().Set(&quot;Access-Control-Allow-Headers&quot;, &quot;Authorization&quot;)</code> This is all that is needed. Can you update the code ? I will accept it."}, {"owner": {"reputation": 441, "user_id": 4016841, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/AHRZN.png?s=128&g=1", "display_name": "PiMaker", "link": "https://stackoverflow.com/users/4016841/pimaker"}, "reply_to_user": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "edited": false, "score": 0, "creation_date": 1478714746, "post_id": 40485707, "comment_id": 68268391, "body": "Like this? Also, glad to help"}], "tags": [], "owner": {"reputation": 441, "user_id": 4016841, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/AHRZN.png?s=128&g=1", "display_name": "PiMaker", "link": "https://stackoverflow.com/users/4016841/pimaker"}, "is_accepted": true, "score": 1, "last_activity_date": 1478714695, "last_edit_date": 1478714695, "creation_date": 1478604380, "answer_id": 40485707, "question_id": 40485248, "link": "https://stackoverflow.com/questions/40485248/cors-on-golang-server-javascript-fetch-frontend/40485707#40485707", "title": "CORS on golang server &amp; javascript fetch frontend", "body": "<p>The <code>Access-Control-Allow-Origin: *</code> has to be sent from the server, not by the client. Assuming you are in a standard <code>net/http</code> handler function, try this code:</p>\n\n<pre><code>func handler(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    if (r.Method == \"OPTIONS\") {\n        w.Header().Set(\"Access-Control-Allow-Headers\", \"Authorization\") // You can add more headers here if needed\n    } else {\n        // Your code goes here\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 5735917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5893d12ced67ac3ee82a50d0c8b9b8ad?s=128&d=identicon&r=PG&f=1", "display_name": "Reviashko", "link": "https://stackoverflow.com/users/5735917/reviashko"}, "is_accepted": false, "score": 0, "last_activity_date": 1594330136, "last_edit_date": 1594330136, "creation_date": 1593363167, "answer_id": 62625552, "question_id": 40485248, "link": "https://stackoverflow.com/questions/40485248/cors-on-golang-server-javascript-fetch-frontend/62625552#62625552", "title": "CORS on golang server &amp; javascript fetch frontend", "body": "<p>First - you need to use schema in your handler:</p>\n<pre><code>w.Header().Set(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)\n    if (r.Method == &quot;OPTIONS&quot;) {\n        w.Header().Set(&quot;Access-Control-Allow-Headers&quot;, &quot;Authorization&quot;) // You can add more headers here if needed\n    } else {\n        // Your code goes here\n    }\n</code></pre>\n<p>But before it you need to specify in main &quot;OPTIONS&quot;:</p>\n<pre><code>router.HandleFunc(&quot;/your_route/&quot;, your_method).Methods(&quot;POST&quot;, &quot;OPTIONS&quot;)\n</code></pre>\n<p>It's because your browser doing 2 request - first to check ability to use some headers (Authorization for example) and next step is posting data</p>\n"}], "owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3336, "favorite_count": 0, "accepted_answer_id": 40485707, "answer_count": 2, "score": 1, "last_activity_date": 1613841682, "creation_date": 1478603082, "question_id": 40485248, "link": "https://stackoverflow.com/questions/40485248/cors-on-golang-server-javascript-fetch-frontend", "title": "CORS on golang server &amp; javascript fetch frontend", "body": "<p>I have a golang HTTP server with code like:</p>\n\n<pre><code>    http.HandleFunc(\"/login\", func(w http.ResponseWriter, r *http.Request) {\n    log.Println(\"New incoming request\")\n\n    // Authenticate\n    if u, p, ok := r.BasicAuth(); ok {\n      log.Println(\"Success\")\n      return\n    }\n    log.Println(\"Failed\")\n</code></pre>\n\n<p>I call this HTTP endpoint from a JS frontend, a react app deployed on port 3000, using code:</p>\n\n<pre><code>      fetch('http://localhost:8080/login', {\n            method: 'post',\n            headers: {\n                'Authorization': 'Basic ' + btoa(authHeader),\n                'Content-Type': 'application/x-www-form-urlencoded',\n                'Access-Control-Allow-Origin': '*'\n            },\n                body: 'A=1&amp;B=2'\n            })\n            .then(function (response) {\n                console.log(\"Authentication Success\")\n            })\n            .catch(function (err) {\n                console.log(\"Authentication fail\", err)\n            });\n</code></pre>\n\n<p>The above code fails with the following logs. </p>\n\n<p>On the server side:</p>\n\n<pre><code>New incoming request\nFailed\n</code></pre>\n\n<p>On the browser, in the developer tools logs:</p>\n\n<pre><code>Fetch API cannot load http://localhost:8080/login. Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://localhost:3000' is therefore not allowed access. The response had HTTP status code 401. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.\n</code></pre>\n\n<p>Can someone help fix the authentication problem ? I am not sure if I am missing something related to CORS on the server side or doing bad authentication on the client side. Any help ? Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1478603093, "post_id": 40485179, "comment_id": 68214183, "body": "<a href=\"https://golang.org/pkg/log/#New\" rel=\"nofollow noreferrer\">golang.org/pkg/log/#New</a>"}, {"owner": {"reputation": 5193, "user_id": 5996587, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d15f53deb1b5f2cab3534565c91c5394?s=128&d=identicon&r=PG&f=1", "display_name": "codec", "link": "https://stackoverflow.com/users/5996587/codec"}, "reply_to_user": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1478603240, "post_id": 40485179, "comment_id": 68214261, "body": "Thanks but I am not logging. These are print statements"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1478603317, "post_id": 40485179, "comment_id": 68214304, "body": "Sorry. Missed that. But it&#39;s the same <a href=\"https://golang.org/pkg/fmt/#Fprint\" rel=\"nofollow noreferrer\">concept.</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1478603902, "post_id": 40485179, "comment_id": 68214647, "body": "No. Too short for an answer."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1478604253, "last_edit_date": 1478604253, "creation_date": 1478603741, "answer_id": 40485489, "question_id": 40485179, "link": "https://stackoverflow.com/questions/40485179/how-to-capture-fmt-print-ouput-in-a-text-file-in-golang/40485489#40485489", "title": "How to capture fmt.Print ouput in a text file in Golang", "body": "<p>Use the <a href=\"https://golang.org/pkg/fmt/#Fprint\" rel=\"nofollow noreferrer\"><code>fmt.Fprint()</code></a> method for calls you want to save to a file. There are also <a href=\"https://golang.org/pkg/fmt/#Fprintf\" rel=\"nofollow noreferrer\"><code>fmt.Fprintf()</code></a> and <a href=\"https://golang.org/pkg/fmt/#Fprintln\" rel=\"nofollow noreferrer\"><code>fmt.Fprintln()</code></a>.</p>\n\n<p>These functions take a destination <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\"><code>io.Writer</code></a> as the first argument, to which you can pass your file (<a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\"><code>*os.File</code></a>).</p>\n\n<p>For example:</p>\n\n<pre><code>f, err := os.Open(\"data.txt\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer f.Close()\n\nfmt.Println(\"This goes to standard output.\")\nfmt.Fprintln(f, \"And this goes to the file\")\nfmt.Fprintf(f, \"Also to file, with some formatting. Time: %v, line: %d\\n\",\n    time.Now(), 2)\n</code></pre>\n\n<p>If you want all <code>fmt.PrintXX()</code> calls to go to the file which you have no control over (e.g. you can't change them to <code>fmt.FprintXX()</code> because they are part of another library), you may change <code>os.Stdout</code> temporarily, so all further <code>fmt.PrintXX()</code> calls will write to the output you set, e.g.:</p>\n\n<pre><code>// Temporarily set your file as the standard output (and save the old)\nold, os.Stdout = os.Stdout, f\n\n// Now all fmt.PrintXX() calls output to f\nsomelib.DoSomething()\n\n// Restore original standard output\nos.Stdout = old\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": true, "score": 4, "last_activity_date": 1478606420, "last_edit_date": 1478606420, "creation_date": 1478603800, "answer_id": 40485511, "question_id": 40485179, "link": "https://stackoverflow.com/questions/40485179/how-to-capture-fmt-print-ouput-in-a-text-file-in-golang/40485511#40485511", "title": "How to capture fmt.Print ouput in a text file in Golang", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    file, err := os.Create(\"myfile\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    mw := io.MultiWriter(os.Stdout, file)\n    fmt.Fprintln(mw, \"This line will be written to stdout and also to a file\")\n}\n</code></pre>\n"}], "owner": {"reputation": 5193, "user_id": 5996587, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d15f53deb1b5f2cab3534565c91c5394?s=128&d=identicon&r=PG&f=1", "display_name": "codec", "link": "https://stackoverflow.com/users/5996587/codec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1632, "favorite_count": 0, "accepted_answer_id": 40485511, "answer_count": 2, "score": 0, "last_activity_date": 1478606420, "creation_date": 1478602859, "last_edit_date": 1478603253, "question_id": 40485179, "link": "https://stackoverflow.com/questions/40485179/how-to-capture-fmt-print-ouput-in-a-text-file-in-golang", "title": "How to capture fmt.Print ouput in a text file in Golang", "body": "<p>There are certain <code>fmt.Print</code> statements that I want to save into a .txt file. </p>\n\n<p>I don't want to store all print statments. Can I do this ?</p>\n"}, {"tags": ["mongodb", "go", "mongodb-query", "aggregation-framework", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 1360, "user_id": 923275, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bdff2cc237e0f423706563be675e6648?s=128&d=identicon&r=PG", "display_name": "17xande", "link": "https://stackoverflow.com/users/923275/17xande"}, "is_accepted": true, "score": 8, "last_activity_date": 1478605786, "creation_date": 1478605786, "answer_id": 40486198, "question_id": 40484271, "link": "https://stackoverflow.com/questions/40484271/mongodb-aggregate-lookup-in-go-mgo-v2/40486198#40486198", "title": "MongoDB Aggregate lookup in Go (mgo.v2)", "body": "<p>Found the solution!</p>\n\n<p>The trick was to create the query in a slice (<code>[]bson.M</code>) and change the structure of the query a bit:</p>\n\n<pre><code>query := []bson.M{{\n  \"$lookup\": bson.M{ // lookup the documents table here\n    \"from\":         \"documents\",\n    \"localField\":   \"_id\",\n    \"foreignField\": \"folderID\",\n    \"as\":           \"documents\",\n  }},\n  {\"$match\": bson.M{\n    \"level\": bson.M{\"$lte\": user.Level},\n    \"userIDs\": user.ID,\n}}}\n\npipe := collection.Pipe(query)\nerr := pipe.All(&amp;folders)\n</code></pre>\n\n<p>I found a clue in <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.Pipe\" rel=\"noreferrer\">mgo's Pipe function docs</a>. Also, I had to change the tags for the <code>Documents</code> field in my <code>Folders</code> struct for mgo to pupolate that field:</p>\n\n<pre><code>type Folder struct {\n  ID        bson.ObjectId   `json:\"id\" bson:\"_id\"`\n  Name      string          `json:\"name\"`\n  Level     int             `json:\"level\"`\n  UserIDs   []bson.ObjectId `json:\"userIDs\" bson:\"userIDs\"`\n  Users     []User          `json:\"-\" bson:\"-\"` // doesn't get stored in the database\n  Documents []Document      // `json:\"-\" bson:\"-\" Removed this so that mgo can unmarshal\n                            // the documents correctly\n}\n</code></pre>\n\n<p>Now I just have to figure out a way to not store the <code>Documents</code> field in the database when I save a <code>Folder</code>.</p>\n"}], "owner": {"reputation": 1360, "user_id": 923275, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bdff2cc237e0f423706563be675e6648?s=128&d=identicon&r=PG", "display_name": "17xande", "link": "https://stackoverflow.com/users/923275/17xande"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4860, "favorite_count": 0, "accepted_answer_id": 40486198, "answer_count": 1, "score": 4, "last_activity_date": 1478605786, "creation_date": 1478600113, "last_edit_date": 1478600877, "question_id": 40484271, "link": "https://stackoverflow.com/questions/40484271/mongodb-aggregate-lookup-in-go-mgo-v2", "title": "MongoDB Aggregate lookup in Go (mgo.v2)", "body": "<p>I'm trying to implement <code>$lookup</code> functionality in one of my mongoDB queries in go (golang) using the <a href=\"https://godoc.org/gopkg.in/mgo.v2\" rel=\"nofollow noreferrer\">mgo</a> package.</p>\n\n<p>Below are my collections:</p>\n\n<p><strong>folders:</strong></p>\n\n<pre><code>\"_id\"    : ObjectId(\"22222222222222\"),\n\"name\"   : \"Media\",\n\"level\"  : 1,\n\"userIDs\": [ObjectId(\"4444444444444\")]\n</code></pre>\n\n<p><strong>documents:</strong></p>\n\n<pre><code>\"_id\"      : ObjectId(\"11111111111111\"),\n\"title\"    : \"Media Management\",\n\"body\"     : BinData(0,\"PvQ6z2NBm4265duo/e2XsYxA5bXKo=\"),\n\"level\"    : 1,\n\"folderID\" : ObjectId(\"22222222222222\"), // Foreign Key/Field\n\"userIDs\"  : [ObjectId(\"44444444444444\")]\n</code></pre>\n\n<p>Below is the query I've written that successfully runs on the shell:</p>\n\n<pre><code>var query = [\n{ \n  \"$lookup\": {\n    \"from\":         \"documents\",\n    \"localField\":   \"_id\",\n    \"foreignField\": \"folderID\",\n    \"as\":           \"documents\",\n  }\n}\n ,{\n   \"$match\": {\n      \"userIDs\": ObjectId(\"userIdHere\"), // filder by a userID\n      \"level\": {$gte: 0},                // filter by a folder level\n    },\n  }\n];\n\ndb.folders.aggregate(query).pretty().shellPrint();\n</code></pre>\n\n<p>If I run this script on the shell, I get the desired result. Basically, the <code>folder</code> collection is returned to me containing the full relevant <code>documents</code> that were linked through the <code>$lookup</code>. I'm not including it here because this question already seems too long.</p>\n\n<p>I've tried to translate this query into something that <em>mgo</em> would be able to parse and execute. Here it is below in go code:</p>\n\n<pre><code>query := bson.M{\n  \"$lookup\": bson.M{ // lookup the documents table here\n  \"from\":         \"documents\",\n  \"localField\":   \"_id\",\n  \"foreignField\": \"folderID\",\n  \"as\":           \"documents\",\n},\n  \"$match\": bson.M{\n    \"level\":   bson.M{\"$gte\": user.Level}, // filter by level\n    \"userIDs\": user.ID,                    // filter by user\n  },\n}\n\npipe := collection.Pipe(query) // querying the \"folders\" collection\nerr := pipe.All(&amp;result)\n</code></pre>\n\n<p>I always get the same error: <strong>wrong type for field (pipeline) 3 != 4</strong></p>\n\n<p>If I understand correctly, it's because it can't properly parse the result back into the $result object. I've done everything I can to ensure the struct has the exact structure that is required. I've also tried to pass in a genereric <code>[]interface{}</code> and an empty <code>bson.M{}</code> objects. Still receive the same error.</p>\n\n<p>Below is my Folders struct:</p>\n\n<pre><code>type Folder struct {\n  ID        bson.ObjectId   `json:\"id\" bson:\"_id\"`\n  Name      string          `json:\"name\"`\n  Level     int             `json:\"level\"`\n  UserIDs   []bson.ObjectId `json:\"userIDs\" bson:\"userIDs\"`\n  Users     []User          `json:\"-\" bson:\"-\"` // doesn't get stored in the database\n  Documents []Document      `json:\"-\" bson:\"-\"` // doesn't get stored in the database\n}\n</code></pre>\n\n<p>I've also removed the <code>$match</code> clause to see if I could get anything at all back from that <code>$lookup</code> query. But I still get the same error.</p>\n\n<p>Perhaps the mgo package doesn't support <code>$lookup</code>? If so, would there be another way? <strong>Perhaps I could send the raw query text to mongo and receive the raw response and parse it myself?</strong></p>\n"}, {"tags": ["postgresql", "go"], "answers": [{"tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 3, "last_activity_date": 1478600890, "creation_date": 1478600890, "answer_id": 40484570, "question_id": 40483087, "link": "https://stackoverflow.com/questions/40483087/how-to-identify-the-last-row-in-the-result-set-postgres/40484570#40484570", "title": "How to identify the last row in the result set postgres?", "body": "<p>You can impliment something like a do while loop in go.</p>\n\n<pre><code>notLast := rows.Next()\nfor notLast {\n    //... rows.Scan\n    notLast = rows.next()\n    if notLast {\n        fmt.Println(id + \"I am not last\")\n    } else {\n        fmt.Println(id + \"I am last\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 5193, "user_id": 5996587, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d15f53deb1b5f2cab3534565c91c5394?s=128&d=identicon&r=PG&f=1", "display_name": "codec", "link": "https://stackoverflow.com/users/5996587/codec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 717, "favorite_count": 0, "accepted_answer_id": 40484570, "answer_count": 1, "score": 3, "last_activity_date": 1478602636, "creation_date": 1478596797, "last_edit_date": 1478602636, "question_id": 40483087, "link": "https://stackoverflow.com/questions/40483087/how-to-identify-the-last-row-in-the-result-set-postgres", "title": "How to identify the last row in the result set postgres?", "body": "<p>I am using Postgres 9.5 with and using golang library lib/pq to interact with database. I execute a select query which returns multiple rows and then I iterate using <code>for rows.Next()</code> Is there anyway I ca stop before the lat record. I want to print something else on console if its the last record. Something like the following:</p>\n\n<pre><code>for rows.Next() {\n\n    var id string\n    err = rows.Scan(&amp;id)\n    if err != nil {\n        log.Printf(\"Error in rows.Scan: %s\\n\", err)\n    }\n\n    if (row is not last) {\n        fmt.Println(id + \"I am not last\")\n    } else {\n        fmt.Println(id + \"I am last\")\n    }\n}\n</code></pre>\n"}, {"tags": ["hadoop", "go", "hdfs", "failover"], "answers": [{"tags": [], "owner": {"reputation": 218, "user_id": 3019120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5308caf334d5a410706905f99364377?s=128&d=identicon&r=PG&f=1", "display_name": "JQian", "link": "https://stackoverflow.com/users/3019120/jqian"}, "is_accepted": true, "score": 0, "last_activity_date": 1478888952, "creation_date": 1478888952, "answer_id": 40554053, "question_id": 40480134, "link": "https://stackoverflow.com/questions/40480134/hdfs-exclude-datanodes-in-addblockrequestproto/40554053#40554053", "title": "HDFS exclude datanodes in AddblockRequestProto", "body": "<p>I found the solution that, first abandon the block and then request the new block. In the previous design, the new requested block cannot replace the old one</p>\n"}], "owner": {"reputation": 218, "user_id": 3019120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5308caf334d5a410706905f99364377?s=128&d=identicon&r=PG&f=1", "display_name": "JQian", "link": "https://stackoverflow.com/users/3019120/jqian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 40554053, "answer_count": 1, "score": 0, "last_activity_date": 1478888952, "creation_date": 1478585537, "last_edit_date": 1478586201, "question_id": 40480134, "link": "https://stackoverflow.com/questions/40480134/hdfs-exclude-datanodes-in-addblockrequestproto", "title": "HDFS exclude datanodes in AddblockRequestProto", "body": "<p>I am implementing a datanode failover for writing in HDFS, that HDFS can still write a block when the first datanode of the block fails.</p>\n\n<p>The algorithm is. First, the failure node would be identified. Then, a new block is requested. The HDFS port api provides <code>excludeNodes</code>, which I used to tell Namenode not to allocate new block there. <code>failedDatanodes</code> are identified failed datanodes, and they are correct in logs.</p>\n\n<pre><code>req := &amp;hdfs.AddBlockRequestProto{\n    Src:           proto.String(bw.src),\n    ClientName:    proto.String(bw.clientName),\n    ExcludeNodes:  failedDatanodes,\n}\n</code></pre>\n\n<p>But, the namenode still locates the block to the failed datanodes. </p>\n\n<p>Anyone knows why? Did I miss anything here?\nThank you.</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1478583156, "post_id": 40479579, "comment_id": 68203314, "body": "You&#39;ve got <code>Outer</code> fields declared backwards, e.g. should have <code>members [][]Inner</code> not <code>Inner [][]member</code>, and <code>row int</code> not <code>int row</code>."}, {"owner": {"reputation": 147, "user_id": 6095667, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8134f9a6838e4f785fc12ee73d9257e9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/6095667/ron"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1478583211, "post_id": 40479579, "comment_id": 68203337, "body": "Thanks, editing them now"}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1478583267, "post_id": 40479579, "comment_id": 68203369, "body": "Also, you can construct a <code>[row][col]</code> sized 2-d slice of <code>Inner</code>s, but what <code>val</code> would you pass to the <code>newInner</code> constructor if your plan was to use the constructor?  <code>newOuter</code> doesn&#39;t take in any <code>val</code> argument that would be natural to pass to the <code>newInner</code> constructor."}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1478583387, "post_id": 40479579, "comment_id": 68203420, "body": "You didn&#39;t edit as per my suggested correction.  And there are other compilation errors.  It&#39;s always helpful if you can post code that compiles."}, {"owner": {"reputation": 147, "user_id": 6095667, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8134f9a6838e4f785fc12ee73d9257e9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/6095667/ron"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1478583453, "post_id": 40479579, "comment_id": 68203452, "body": "I was planning to initialize  all &quot;val&quot; to 100"}, {"owner": {"reputation": 147, "user_id": 6095667, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8134f9a6838e4f785fc12ee73d9257e9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/6095667/ron"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1478583592, "post_id": 40479579, "comment_id": 68203505, "body": "I corrected the members variable, appreciate your input."}, {"owner": {"reputation": 147, "user_id": 6095667, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8134f9a6838e4f785fc12ee73d9257e9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/6095667/ron"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1478583808, "post_id": 40479579, "comment_id": 68203582, "body": "I corrected the compiler errors too."}], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 6095667, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8134f9a6838e4f785fc12ee73d9257e9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/6095667/ron"}, "edited": false, "score": 0, "creation_date": 1478584806, "post_id": 40479908, "comment_id": 68203960, "body": "thanks, but will all the elements of the matrix point to the same Inner variable? I ask this because all elements of members[][] are initialized to defaultInner"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 147, "user_id": 6095667, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8134f9a6838e4f785fc12ee73d9257e9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/6095667/ron"}, "edited": false, "score": 0, "creation_date": 1478584876, "post_id": 40479908, "comment_id": 68203994, "body": "They are initialised to <code>*defaultInner</code> which denotes it&#39;s value and not the address."}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 147, "user_id": 6095667, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8134f9a6838e4f785fc12ee73d9257e9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/6095667/ron"}, "edited": false, "score": 0, "creation_date": 1478687991, "post_id": 40479908, "comment_id": 68252693, "body": "@Ron Is there anything else to clear up in the answer ?"}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 1, "last_activity_date": 1478588087, "last_edit_date": 1478588087, "creation_date": 1478584390, "answer_id": 40479908, "question_id": 40479579, "link": "https://stackoverflow.com/questions/40479579/nested-array-of-struct-initialization-how-to-do-if-constructors-for-both-struct/40479908#40479908", "title": "Nested array of struct initialization: how to do if constructors for both struct are available?", "body": "<p>You can use <code>make</code> and then iterate through the matrix to initialize it.</p>\n\n<pre><code>    defaultInner := newInner(100)\n    o.members = make([][]Inner, o.row)\n    for i := 0; i &lt; o.row; i++ {\n        o.members[i] = make([]Inner, o.col)\n        for j := 0; j &lt; o.col; j++ {\n            o.members[i][j] = *defaultInner\n        }\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "is_accepted": false, "score": 1, "last_activity_date": 1478587896, "creation_date": 1478587896, "answer_id": 40480655, "question_id": 40479579, "link": "https://stackoverflow.com/questions/40479579/nested-array-of-struct-initialization-how-to-do-if-constructors-for-both-struct/40480655#40480655", "title": "Nested array of struct initialization: how to do if constructors for both struct are available?", "body": "<pre><code>func newOuter(row int, col int) *Outer {\n    o:=new(Outer)\n    o.row=row\n    o.col=col\n\n    //how do I initialize a 2d array of size [row][col] and \n    //using the constructor for inner?...\n    //\n    //here's one way:\n\n    o.members = make([][]Inner, row)\n    for i := 0; i &lt; row; i++ {\n        memberRow := make([]Inner, col)\n        for j := 0; j &lt; col; j++ {\n            memberRow[j] = *newInner(100)\n        }\n        o.members[i] = memberRow\n    }\n\n    return o  \n}\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 6095667, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8134f9a6838e4f785fc12ee73d9257e9?s=128&d=identicon&r=PG&f=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/6095667/ron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 40479908, "answer_count": 2, "score": 0, "last_activity_date": 1478588087, "creation_date": 1478582732, "last_edit_date": 1478583516, "question_id": 40479579, "link": "https://stackoverflow.com/questions/40479579/nested-array-of-struct-initialization-how-to-do-if-constructors-for-both-struct", "title": "Nested array of struct initialization: how to do if constructors for both struct are available?", "body": "<p>New to golang. I have two struct types (called Inner, Outer), and have constructors for each of them that I would like to use. Outer struct \"has-a\" 2d array of Inner struct. How do  I use the constructor for the inner type inside the constructor of outer struct, to initialize the array of inner?</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>type Inner struct {\r\n  val int\r\n}\r\n\r\nfunc newInner(val int) *Inner {\r\n  i:=new(Inner)\r\n  i.val=val\r\n  return i\r\n}\r\n\r\n\r\ntype Outer struct {\r\n  members [][]Inner\r\n  row int\r\n  col int\r\n}\r\n\r\nfunc newOuter(row int, col int) *Outer {\r\n  o:=new(Outer)\r\n  o.row=row\r\n  o.col=col\r\n  //how do I initialize a 2d array of size [row][col] and \r\n  //using the constructor for inner?\r\n  return o  \r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": ["go", "websocket", "sockjs"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1478579465, "post_id": 40478810, "comment_id": 68202232, "body": "&quot;To support non-compliant browsers&quot; which one ?"}, {"owner": {"reputation": 4878, "user_id": 106716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84b86f7e739f0826554499cef9e5862b?s=128&d=identicon&r=PG", "display_name": "ShawnMilo", "link": "https://stackoverflow.com/users/106716/shawnmilo"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1478619789, "post_id": 40478810, "comment_id": 68225772, "body": "Yandry: I don&#39;t know. I think it&#39;s just a fallback to support whatever we have to support. It&#39;s a very popular public site, so we probably get every browser possible, on every desktop and mobile OS possible."}, {"owner": {"reputation": 479, "user_id": 2911436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7440d55bf27c1d2b26fae3af24ca2fff?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/2911436/john"}, "edited": false, "score": 0, "creation_date": 1582773641, "post_id": 40478810, "comment_id": 106895483, "body": "In the far future, but it looks like there are now a couple SockJS Go client libraries, mainly <a href=\"https://github.com/third-light/sockjs-go-client\" rel=\"nofollow noreferrer\">third-light/sockjs-go-client</a>"}], "owner": {"reputation": 4878, "user_id": 106716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84b86f7e739f0826554499cef9e5862b?s=128&d=identicon&r=PG", "display_name": "ShawnMilo", "link": "https://stackoverflow.com/users/106716/shawnmilo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 705, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1596650293, "creation_date": 1478578272, "question_id": 40478810, "link": "https://stackoverflow.com/questions/40478810/how-can-i-connect-to-sockjs-from-a-client-written-in-go", "title": "How can I connect to sockJS from a client written in Go?", "body": "<p>I have a server that uses websockets. It is written in Go. For testing, I have another application written in Go. To test, I start the server, then run the test client. The test client creates websocket connections to the server and does things (basically impersonating user activity). Both the client and the server are using the gorilla/websockets library, and standard browsers also work fine with the server.</p>\n\n<p>This was all working beautifully.</p>\n\n<p>To support non-compliant browsers, I was asked to start using the <a href=\"https://github.com/igm/sockjs-go/\" rel=\"nofollow noreferrer\">SockJS</a> Go server library. I did this and the new version works just fine when used from a browser by clients using the <a href=\"http://sockjs.org\" rel=\"nofollow noreferrer\">SockJS</a> library.</p>\n\n<p>Now for the problem. SockJS does <em>not</em> accept incoming websocket connections. Only connections from the SockJS client. So my testing application doesn't work, and I'm unable to test.</p>\n\n<p>I could recover the old version of my connection code from git and make a separate connection type that uses gorilla/websockets and have my server listen on an additional port that only listens on localhost. This would allow me to test the functionality. The downside is that I have to maintain two versions of essentially the same code, and I wouldn't be testing the real user experience and possibly not find bugs until production.</p>\n\n<p>Ideally the SockJS server, considering it still <em>uses</em> gorilla/websockets as a dependency would automatically accept proper websocket connections, but barring that it seems I'd need a SockJS client library in Go which, as far as I can tell, doesn't exist.</p>\n\n<p>Does anyone have a solution for this? Thanks!</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 1524, "user_id": 6935674, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/0b6349b1a4f55680020d28656e4bfd9a?s=128&d=identicon&r=PG", "display_name": "Parshuram Kalvikatte", "link": "https://stackoverflow.com/users/6935674/parshuram-kalvikatte"}, "edited": false, "score": 0, "creation_date": 1478605832, "post_id": 40478523, "comment_id": 68215870, "body": "Add &quot;Certificate&quot;:  &quot;$Leave.certificate&quot; in your $project stage"}], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 5024301, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/836491216400010/picture?type=large", "display_name": "Rajesh Kumar", "link": "https://stackoverflow.com/users/5024301/rajesh-kumar"}, "edited": false, "score": 0, "creation_date": 1478598625, "post_id": 40482391, "comment_id": 68211219, "body": "Thanks for helping me ...Sorry....My certificate is not displaying if i use like this...I m only getting the values of leave....and have one more doubt..If i dont check the name and just display the details of all the employees with their details in the format which i asked for,is it possible...."}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "reply_to_user": {"reputation": 157, "user_id": 5024301, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/836491216400010/picture?type=large", "display_name": "Rajesh Kumar", "link": "https://stackoverflow.com/users/5024301/rajesh-kumar"}, "edited": false, "score": 0, "creation_date": 1478599165, "post_id": 40482391, "comment_id": 68211553, "body": "I used your example document exactly as you posted, so if you don&#39;t get the same result, it&#39;s something to do with your code. Check the capitalisation of <code>$leave</code> vs <code>$Leave</code>. Failing that, post your input documents, and exact output of the code above. I don&#39;t understand your second question, could you elaborate that with examples ."}, {"owner": {"reputation": 157, "user_id": 5024301, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/836491216400010/picture?type=large", "display_name": "Rajesh Kumar", "link": "https://stackoverflow.com/users/5024301/rajesh-kumar"}, "edited": false, "score": 0, "creation_date": 1478660638, "post_id": 40482391, "comment_id": 68243202, "body": "Thanks...I did something wrong in my code.After rectifying it its working.Thanks very much.....I will give your answer as the right one.Once again thanks..."}], "tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": true, "score": 1, "last_activity_date": 1478594500, "creation_date": 1478594500, "answer_id": 40482391, "question_id": 40478523, "link": "https://stackoverflow.com/questions/40478523/need-to-project-nested-array-using-mgo/40482391#40482391", "title": "need to project nested array using mgo", "body": "<p>Using on your document structure example above, you just have to expose <code>certificate</code> through <code>$project</code> as below: </p>\n\n<pre><code>pipeline := []bson.M{\n                {\"$match\": bson.M{\"name\":\"string\"}},\n                {\"$unwind\": \"$Leave\"},\n                {\"$project\": bson.M{\n                        \"_id\":          false,\n                        \"name\":         1,\n                        \"Id\":           \"$Leave.id\",\n                        \"Total\":        \"$Leave.total\",\n                        \"Days\":         \"$Leave.days\",\n                        \"Status\":       \"$Leave.status\",\n                        \"Certificate\":  \"$Leave.certificate\"},\n                },\n           }\npipe := collection.Pipe(pipeline)\nresponse := []bson.M{}\nerr = pipe.All(&amp;response)\n</code></pre>\n\n<p>As you already use <code>$unwind</code> on <code>Leave</code>, you have individual documents per leave request. The output of the above aggregation would be: </p>\n\n<pre><code> {\n  \"name\": \"string\",\n  \"Id\": 0,\n  \"Total\": 20,\n  \"Days\": 0,\n  \"Status\": \"\",\n  \"Certificate\": [\n    {\n      \"filename\": \"malaysia\",\n      \"filetype\": \".zip\",\n      \"filesize\": 1234\n    },\n    {\n      \"filename\": \"singapore\",\n      \"filetype\": \".zip\",\n      \"filesize\": 1234\n    }\n  ]\n},\n{\n  \"name\": \"string\",\n  \"Id\": 1,\n  \"Total\": 19,\n  \"Days\": 1,\n  \"Status\": \"Processing\",\n  \"Certificate\": [\n    {\n      \"filename\": \"germany\",\n      \"filetype\": \".zip\",\n      \"filesize\": 1234\n    },\n    {\n      \"filename\": \"england\",\n      \"filetype\": \".zip\",\n      \"filesize\": 1234\n    }\n  ]\n},\n{\n  \"name\": \"string\",\n  \"Id\": 2,\n  \"Total\": 18,\n  \"Days\": 1,\n  \"Status\": \"Processing\",\n  \"Certificate\": [\n    {\n      \"filename\": \"india\",\n      \"filetype\": \".zip\",\n      \"filesize\": 1234\n    },\n    {\n      \"filename\": \"france\",\n      \"filetype\": \".zip\",\n      \"filesize\": 1234\n    }\n  ]\n}\n</code></pre>\n\n<p>Where each leave request, has their own corresponding certificates associated with the leave. </p>\n"}], "owner": {"reputation": 157, "user_id": 5024301, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/836491216400010/picture?type=large", "display_name": "Rajesh Kumar", "link": "https://stackoverflow.com/users/5024301/rajesh-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 691, "favorite_count": 0, "accepted_answer_id": 40482391, "answer_count": 1, "score": 0, "last_activity_date": 1478594500, "creation_date": 1478576170, "last_edit_date": 1478592174, "question_id": 40478523, "link": "https://stackoverflow.com/questions/40478523/need-to-project-nested-array-using-mgo", "title": "need to project nested array using mgo", "body": "<p>I m using go lang as the back end of my application and mongoDB as the database.I am facing a problem where i compare the name and project the leave array and inside that i also need to project the certificates for that leave.Since i need only little info from the employee struct i wanted to implement using pipe and project.</p>\n\n<pre><code> type (\n        Employee struct {\n            Name               string\n            Password           string\n           EmailAddress       string\n           Position           string\n           Gender             string\n           Nationality        string\n           Department         string\n           MaritalStatus      string\n           Approvedby         string\n           JoinDate           time.Time\n           ConfirmationDate   time.Time\n           EndDate            time.Time\n            Leave             []*LeaveInfo  \n        }\n        LeaveInfo struct {\n            Total        float64\n            Id           int\n            Days         float64\n            From        time.Time\n             To          time.Time  \n            Status       string\n            Certificate  []*CertificateInfo\n        }\n        CertificateInfo struct {\n            FileName string\n            FileType string\n            FileSize int\n\n        }\n</code></pre>\n\n<p>The database structure is as follows </p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"58213e14927a62f3cf04e05b\"),\n    \"name\" : \"string\",\n    \"password\" : \"string\",\n    \"emailaddress\" : \"string\",\n    \"position\" : \"string\",\n    \"gender\" : \"string\",\n    \"maritalstatus\" : \"string\",\n    \"approvedby\" : \"string\",\n    \"nationality\" : \"german\",\n    \"department\" : \"account\",\n    \"joindate\" : ISODate(\"2016-09-19T00:00:00.000Z\"),\n    \"confirmationdate\" : Date(-62135596800000),\n    \"enddate\" : Date(-62135596800000),\n    \"Leave\" : [ \n        {\n            \"total\" : 20.0,\n            \"id\" : 0,\n            \"days\" : 0.0,\n            \"type\" : \"\",\n            \"from\" : ISODate(\"2016-12-12T00:00:00.000Z\"),\n            \"to\" : ISODate(\"2016-12-12T00:00:00.000Z\"),\n            \"status\" : \"\",\n            \"certificate\" : [\n                    {\n                    \"filename\" : \"malaysia\",\n                    \"filetype\" : \".zip\",\n                    \"filesize\" : 1234\n                }, \n                {\n                    \"filename\" : \"singapore\",\n                    \"filetype\" : \".zip\",\n                    \"filesize\" : 1234\n                }\n             ]\n        }, \n        {\n            \"total\" : 19.0,\n            \"id\" : 1,\n            \"days\" : 1.0,\n\n            \"from\" : ISODate(\"2016-12-12T00:00:00.000Z\"),\n            \"to\" : ISODate(\"2016-12-12T00:00:00.000Z\"),\n            \"applieddate\" : ISODate(\"2016-11-08T02:53:38.902Z\"),\n            \"status\" : \"Processing\",\n            \"approveddate\" : Date(-62135596800000),\n            \"certificate\" : [ \n                {\n                    \"filename\" : \"germany\",\n                    \"filetype\" : \".zip\",\n                    \"filesize\" : 1234\n                }, \n                {\n                    \"filename\" : \"england\",\n                    \"filetype\" : \".zip\",\n                    \"filesize\" : 1234\n                }\n            ]\n        }, \n        {\n            \"total\" : 18.0,\n            \"id\" : 2,\n            \"days\" : 1.0,\n            \"mdays\" : 0.0,\n            \"type\" : \"annualleave\",\n            \"daytype\" : \"FullDay\",\n            \"from\" : ISODate(\"2016-12-12T00:00:00.000Z\"),\n            \"to\" : ISODate(\"2016-12-12T00:00:00.000Z\"),\n            \"applieddate\" : ISODate(\"2016-11-08T05:36:21.579Z\"),\n            \"status\" : \"Processing\",\n            \"approveddate\" : Date(-62135596800000),\n            \"certificate\" : [\n                   {\n                    \"filename\" : \"india\",\n                    \"filetype\" : \".zip\",\n                    \"filesize\" : 1234\n                   }, \n                   {\n                    \"filename\" : \"france\",\n                    \"filetype\" : \".zip\",\n                    \"filesize\" : 1234\n                   }\n                 ]\n             }\n         ]\n     }\n</code></pre>\n\n<p>My code in golang is as follows </p>\n\n<pre><code>pipe3 := c.Pipe([]bson.M{\n            {\n                \"$match\": bson.M{\n\n                   \"name\":name\n                 },\n            },\n            {\n                \"$unwind\": \"$leave\",\n            },\n\n            {\n                \"$project\": bson.M{\n                    \"_id\":          false,\n\n                    \"name\":         1,\n                    \"Id\":           \"$leave.id\",\n                    \"Total\":        \"$leave.total\",\n                    \"Days\":         \"$leave.days\",\n                    \"Status\":       \"$leave.status\",\n                },\n            },\n       })\n</code></pre>\n\n<p>The problem here is i dont know how to retrieve all the info of the certificates related to that particular leave.Please note that the certificate is an array with atleast two index in it...</p>\n\n<pre><code>I need an output similar to this. \n                    \"name\":        \"John\",\n                    \"Id\":           \"1\",\n                    \"Total\":        \"10.0\",\n                    \"Days\":         \"2.0\",\n                    \"Status\":       \"Process\",\n                    \"Certificate\" : [\n                      {\n                     \"filename\":\"certificate1\",\n                     \"filesize\":\"size1\"\n                     },\n                    {\n                        \"filename\":\"certificate2\",\n                        \"filesize\":\"size2\"\n                     }\n                      ]\n\n\n                 \"name\":        \"John\",\n                \"Id\":           \"2\",\n                \"Total\":        \"8.0\",\n                \"Days\":         \"2.0\",\n                \"Status\":       \"Process\",\n                \"Certificate\" : [\n                  {\n                 \"filename\":\"certificate1\",\n                 \"filesize\":\"size1\"\n                 },\n                {\n                    \"filename\":\"certificate2\",\n                    \"filesize\":\"size2\"\n                 }\n                  ]\n</code></pre>\n\n<p>Is this possible using project.or is there any other way to do this.Appreciate any help.Please.Thanks</p>\n"}, {"tags": ["http", "go", "multiplexing", "servemux"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 10, "creation_date": 1478572645, "post_id": 40478027, "comment_id": 68200615, "body": "When you do that, you&#39;re using the multiplexer \u2014 namely, <code>http.DefaultServeMux</code>."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 1, "creation_date": 1478572789, "post_id": 40478027, "comment_id": 68200652, "body": "ListenAndServe will use http.DefaultServeMux if you pass <b>nil</b> as the second parameter"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1478582346, "post_id": 40478027, "comment_id": 68203028, "body": "A request multiplexer is also called a request router.  It routes incoming requests to a handler using some set of rules."}], "answers": [{"tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 9, "last_activity_date": 1614174137, "last_edit_date": 1614174137, "creation_date": 1478585518, "answer_id": 40480130, "question_id": 40478027, "link": "https://stackoverflow.com/questions/40478027/what-is-an-http-request-multiplexer/40480130#40480130", "title": "What is an http request multiplexer?", "body": "<p>From <code>net/http</code> GoDoc and Source.</p>\n<p><code>ListenAndServe starts an HTTP server with a given address and handler. The handler is usually nil, which means to use DefaultServeMux. Handle and HandleFunc add handlers to DefaultServeMux</code></p>\n<p><code>DefaultServeMux</code> is just a predefined <code>http.ServeMux</code></p>\n<pre><code>var DefaultServeMux = &amp;defaultServeMux\nvar defaultServeMux ServeMux\n</code></pre>\n<p>As you can see <code>http.Handle</code> calls <code>DefaultServeMux</code> internally.</p>\n<p><code>func Handle(pattern string, handler Handler) { DefaultServeMux.Handle(pattern, handler) }</code></p>\n<p>The purpose of <code>http.NewServeMux()</code> is to have your own instance of <code>http.ServerMux</code> for instances like when you require two <code>http.ListenAndServe</code> functions listening to different ports with different routes.</p>\n"}, {"tags": [], "owner": {"reputation": 343, "user_id": 8411263, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nLuEd7kVkpA/AAAAAAAAAAI/AAAAAAAAACI/XGfe0AyH8n8/photo.jpg?sz=128", "display_name": "Manouchehr Rasouli", "link": "https://stackoverflow.com/users/8411263/manouchehr-rasouli"}, "is_accepted": false, "score": 2, "last_activity_date": 1580927677, "creation_date": 1580927677, "answer_id": 60082059, "question_id": 40478027, "link": "https://stackoverflow.com/questions/40478027/what-is-an-http-request-multiplexer/60082059#60082059", "title": "What is an http request multiplexer?", "body": "<p>the multiplexer in Golang is some things like multiplexer in hardware which multiply some inputs into some outputs</p>\n\n<p>i gave you a simple exampe</p>\n\n<pre><code>type CustomMultiplexer struct {\n}\n</code></pre>\n\n<p>the given multiplexer have to implement the <code>ServeHTTP</code> method to be registered int http to server inputs</p>\n\n<pre><code>func (mux CustomMultiplexer) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path == \"/\" {\n        SimpleRequestHandler(w, r)\n        return\n    }\n    http.NotFound(w, r)\n    return\n}\n</code></pre>\n\n<p>my <code>SimpleRequestHandler</code> is a method as follow</p>\n\n<pre><code>func SimpleRequestHandler(w http.ResponseWriter, r *http.Request) {\n    switch r.Method {\n    case http.MethodGet:\n        mySimpleGetRequestHandler(w, r)\n        break\n    default:\n        http.Error(w, \"method not allowed\", http.StatusMethodNotAllowed)\n        break\n    }\n}\n</code></pre>\n\n<p>know i can use my <code>CustomMultiplxere</code> to do multiplexing between incoming requested</p>\n\n<pre><code>func main() {\n    customServer := CustomServer{}\n    err := http.ListenAndServe(\":9001\", &amp;customServer)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>the <code>http.HandleFunc</code> method works as my given simple multiplexer.</p>\n"}], "owner": {"reputation": 988, "user_id": 6149170, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bc071a84d9b5d4ec115745e1d0922b29?s=128&d=identicon&r=PG", "display_name": "hermancain", "link": "https://stackoverflow.com/users/6149170/hermancain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5977, "favorite_count": 2, "accepted_answer_id": 40480130, "answer_count": 2, "score": 18, "last_activity_date": 1614174137, "creation_date": 1478572482, "question_id": 40478027, "link": "https://stackoverflow.com/questions/40478027/what-is-an-http-request-multiplexer", "title": "What is an http request multiplexer?", "body": "<p>I've been studying golang and I noticed a lot of people create servers by using the <code>http.NewServeMux()</code> function and I don't really understand what it does.</p>\n\n<p>I read this:</p>\n\n<blockquote>\n  <p>In go ServeMux is an HTTP request multiplexer. It matches the URL of\n  each incoming request against a list of registered patterns and calls\n  the handler for the pattern that most closely matches the URL.</p>\n</blockquote>\n\n<p>How is that different than just doing something like:</p>\n\n<pre><code>http.ListenAndServe(addr, nil)\nhttp.Handle(\"/home\", home)\nhttp.Handle(\"/login\", login)\n</code></pre>\n\n<p>What is the purpose of using multiplexing?</p>\n"}, {"tags": ["sockets", "networking", "go"], "comments": [{"owner": {"reputation": 325, "user_id": 5017655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/68dR5.jpg?s=128&g=1", "display_name": "HelloNewWorld", "link": "https://stackoverflow.com/users/5017655/hellonewworld"}, "edited": false, "score": 0, "creation_date": 1478568694, "post_id": 40476513, "comment_id": 68199597, "body": "Maybe this link will help.<a href=\"https://groups.google.com/forum/#!topic/golang-nuts/Vk6Q9W0fpyo\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/Vk6Q9W0fpyo</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "is_accepted": true, "score": 2, "last_activity_date": 1478572423, "creation_date": 1478572423, "answer_id": 40478024, "question_id": 40476513, "link": "https://stackoverflow.com/questions/40476513/listen-from-all-the-ports/40478024#40478024", "title": "Listen from all the ports", "body": "<p>You can't bind to all ports at once without listening on them separately, and I'm pretty sure that's not what you mean in the last sentence of your question.</p>\n\n<p>I think what you're really after is a packet capture library, like <a href=\"https://godoc.org/github.com/google/gopacket/pcap\" rel=\"nofollow noreferrer\">gopacket/pcap</a>.</p>\n"}], "owner": {"reputation": 11185, "user_id": 1055637, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8a8b9e4daac99ea95aa3e8e246716e73?s=128&d=identicon&r=PG", "display_name": "Mazzy", "link": "https://stackoverflow.com/users/1055637/mazzy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 40478024, "answer_count": 1, "score": -6, "last_activity_date": 1478572423, "creation_date": 1478561291, "question_id": 40476513, "link": "https://stackoverflow.com/questions/40476513/listen-from-all-the-ports", "title": "Listen from all the ports", "body": "<p>I'm writing a program which listen all the packets which come out from an interface. I've read the <code>net</code> godoc but all the possible methods I've found there require the <code>addr</code> in the form <code>host:port</code>. I would read all the packets which go out from one network interface. Do you have any suggestions?</p>\n"}, {"tags": ["go", "exec", "stdio"], "comments": [{"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 1, "creation_date": 1478572007, "post_id": 40476346, "comment_id": 68200475, "body": "This is because of the nature of the scp program, it <a href=\"http://stackoverflow.com/questions/1340366/how-to-make-ssh-receive-the-password-from-stdin\">doesn&#39;t just read the password normally</a>. There are various security considerations, so make sure you look into the details."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478614498, "post_id": 40476346, "comment_id": 68221941, "body": "<code>scp</code> is just a utility that uses <code>ssh</code> as a transport. Automate it the same way you would ssh, which preferably is with publickey authentication."}], "answers": [{"tags": [], "owner": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "is_accepted": true, "score": 0, "last_activity_date": 1478652908, "creation_date": 1478652908, "answer_id": 40498839, "question_id": 40476346, "link": "https://stackoverflow.com/questions/40476346/writing-twice-to-the-same-sub-process-golang/40498839#40498839", "title": "writing twice to the same sub process golang", "body": "<p>So I was able to find a work around by instead of trying to send the password to <code>stdin</code> I create a ssh session and <code>scp</code> a file through the ssh session. Here is the new <code>scpFile</code> function:</p>\n\n<pre><code>func scpFile(filePath, destinationPath string, session *ssh.Session) error {\n    defer session.Close()\n\n    f, err := os.Open(filePath)\n    if err != nil {\n        return err\n    }\n    defer f.Close()\n\n    s, err := f.Stat()\n    if err != nil {\n        return err\n    }\n\n    go func() {\n        w, _ := session.StdinPipe()\n        defer w.Close()\n        fmt.Fprintf(w, \"C%#o %d %s\\n\", s.Mode().Perm(), s.Size(), path.Base(filePath))\n        io.Copy(w, f)\n        fmt.Fprint(w, \"\\x00\")\n    }()\n    cmd := fmt.Sprintf(\"scp -t %s\", destinationPath)\n    if err := session.Run(cmd); err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>This could probably be made better but the main idea is there</p>\n"}], "owner": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 40498839, "answer_count": 1, "score": 0, "last_activity_date": 1478652908, "creation_date": 1478560192, "question_id": 40476346, "link": "https://stackoverflow.com/questions/40476346/writing-twice-to-the-same-sub-process-golang", "title": "writing twice to the same sub process golang", "body": "<p>I have a simple <code>scp</code> function that is just a wrapper over the <code>scp</code> cli tool.</p>\n\n<pre><code>type credential struct {\n    username string\n    password string\n    host     string\n    port     string\n}\n\nfunc scpFile(filepath, destpath string, c *credential) error {\n    cmd := exec.Command(\"scp\", filepath, c.username+\"@\"+c.host+\":\"+destpath)\n\n    if err := cmd.Run(); err != nil {\n        return err\n    }\n\n    fmt.Println(\"done\")\n    return nil\n}\n</code></pre>\n\n<p>This works just fine now I want to add the capability of putting in a password the SSH if scp needs it. This is what I came up with</p>\n\n<pre><code>func scpFile(filepath, destpath string, c *credential) error {\n    cmd := exec.Command(\"scp\", filepath, c.username+\"@\"+c.host+\":\"+destpath)\n    stdin, err := cmd.StdinPipe()\n    if err != nil {\n        return err\n    }\n    defer stdin.Close()\n\n    if err := cmd.Start(); err != nil {\n        return err\n    }\n\n    io.WriteString(stdin, c.password+\"\\n\")\n    cmd.Wait()\n    fmt.Println(\"done\")\n    return nil\n}\n</code></pre>\n\n<p>This does not work as the password prompt just hangs there. I tried adding a 1 second sleep before I re write to <code>stdin</code> thinking maybe I was writing the password to fast but did not make a difference. </p>\n"}, {"tags": ["go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 167, "user_id": 2413915, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/mLiG5.jpg?s=128&g=1", "display_name": "fvarj", "link": "https://stackoverflow.com/users/2413915/fvarj"}, "edited": false, "score": 0, "creation_date": 1531624005, "post_id": 40474803, "comment_id": 89663086, "body": "Is possible to remove the reflect.SliceOf(typ) and get the same result?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 167, "user_id": 2413915, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/mLiG5.jpg?s=128&g=1", "display_name": "fvarj", "link": "https://stackoverflow.com/users/2413915/fvarj"}, "edited": false, "score": 1, "creation_date": 1531749469, "post_id": 40474803, "comment_id": 89699295, "body": "@fvarj: I&#39;m not sure what you mean, since you can&#39;t make a slice without a type. Have you tried to see what happens?"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1478553443, "creation_date": 1478553443, "answer_id": 40474803, "question_id": 40474682, "link": "https://stackoverflow.com/questions/40474682/reflect-set-slice-of-structs-value-to-a-struct-without-type-assertion-because/40474803#40474803", "title": "reflect.Set slice-of-structs value to a struct, without type assertion (because it&#39;s unknown)", "body": "<p>You're calling <code>reflect.TypeOf</code> on a <code>reflect.Value</code>, which is where <code>**reflect.rtype</code> is coming from.</p>\n\n<p>Call your <code>One</code> function wth the <code>like</code> value directly, and assign that result to the slice.</p>\n\n<pre><code>func One(like interface{}) interface{} {\n    typ := reflect.TypeOf(like)\n    one := reflect.New(typ)\n\n    return one.Interface()\n}\n\nfunc Many(num int, like interface{}) interface{} {\n    typ := reflect.TypeOf(like)\n    many := reflect.MakeSlice(reflect.SliceOf(typ), num, num)\n\n    for i := 0; i &lt; num; i++ {\n        one := One(like)\n        many.Index(i).Set(reflect.ValueOf(one).Elem())\n    }\n\n    return many.Interface()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/fHF_zrymcI\" rel=\"nofollow noreferrer\">https://play.golang.org/p/fHF_zrymcI</a></p>\n"}], "owner": {"reputation": 3000, "user_id": 1335245, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b201e069f3e6868c1c0285f6e31801c?s=128&d=identicon&r=PG", "display_name": "Charney Kaye", "link": "https://stackoverflow.com/users/1335245/charney-kaye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1211, "favorite_count": 0, "accepted_answer_id": 40474803, "answer_count": 1, "score": 0, "last_activity_date": 1478553687, "creation_date": 1478553013, "last_edit_date": 1478553687, "question_id": 40474682, "link": "https://stackoverflow.com/questions/40474682/reflect-set-slice-of-structs-value-to-a-struct-without-type-assertion-because", "title": "reflect.Set slice-of-structs value to a struct, without type assertion (because it&#39;s unknown)", "body": "<p>I'm creating a helper package to pop payloads from a queue. It's essential that this helper be agnostic to the struct used by the application importing it.</p>\n\n<p>This (no-op, just example) function will provide a single payload from the queue, of the provided type <code>like interface{}</code>:</p>\n\n<pre><code>func One(like interface{}) interface{} {\n    typ := reflect.TypeOf(like)\n    one := reflect.New(typ)\n\n    return one.Interface()\n}\n</code></pre>\n\n<p>This function provides many payloads:</p>\n\n<pre><code>func Many(num int, like interface{}) interface{} {\n    typ := reflect.TypeOf(like)\n    many := reflect.MakeSlice(reflect.SliceOf(typ), num, num)\n\n    for i := 0; i &lt; num; i++ {\n        one := One(typ)\n        many.Index(i).Set(one)\n    }\n\n    return many.Interface()\n}\n</code></pre>\n\n<p>An example of usage is:</p>\n\n<pre><code>type Payload struct {\n    Id int\n    Text string\n}\n\nfunc main() {\n    Many(4, Payload{})\n}\n</code></pre>\n\n<p>However, the above results in:</p>\n\n<pre><code>panic: reflect.Set: value of type **reflect.rtype is not assignable to type main.Payload\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ud23ZlD3Bx\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ud23ZlD3Bx</a></p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1478548896, "post_id": 40473565, "comment_id": 68191700, "body": "Are you running this all on the same machine?  You can get different results if running on machines in different time zones or if one is out of sync with its NTP server."}, {"owner": {"reputation": 3315, "user_id": 1664109, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/JAlH9.jpg?s=128&g=1", "display_name": "RockOnGom", "link": "https://stackoverflow.com/users/1664109/rockongom"}, "reply_to_user": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1478548929, "post_id": 40473565, "comment_id": 68191722, "body": "Yes, on same machine"}, {"owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1478549112, "post_id": 40473565, "comment_id": 68191838, "body": "The driver might be passing that in as a string and then parsing it into a time.Time constructor, which would convert it to UTC.  Although time.Time#Local() returns a time.Time. Hmmm"}, {"owner": {"reputation": 3315, "user_id": 1664109, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/JAlH9.jpg?s=128&g=1", "display_name": "RockOnGom", "link": "https://stackoverflow.com/users/1664109/rockongom"}, "reply_to_user": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1478549395, "post_id": 40473565, "comment_id": 68191984, "body": "Probably that will be the reason."}, {"owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 5, "creation_date": 1478550792, "post_id": 40473565, "comment_id": 68192778, "body": "What&#39;s the aversion to UTC?  Generally speaking, UTC is best practice, as it gives you a single source of truth."}, {"owner": {"reputation": 3315, "user_id": 1664109, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/JAlH9.jpg?s=128&g=1", "display_name": "RockOnGom", "link": "https://stackoverflow.com/users/1664109/rockongom"}, "reply_to_user": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1478581695, "post_id": 40473565, "comment_id": 68202819, "body": "Upps, you&#39;r right! Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "is_accepted": true, "score": 8, "last_activity_date": 1553665279, "last_edit_date": 1553665279, "creation_date": 1478573516, "answer_id": 40478160, "question_id": 40473565, "link": "https://stackoverflow.com/questions/40473565/go-mysql-driver-doesnt-set-time-correctly/40478160#40478160", "title": "Go MySql driver doesn&#39;t set time correctly", "body": "<p>The mysql driver has a <a href=\"https://github.com/go-sql-driver/mysql/blob/1fbca2aabb09915d4f1006d01b271ad7778eec4f/dsn.go#L43\" rel=\"noreferrer\">configuration parameter for the default time zone</a>, which you can set to <code>time.Local</code> (the default is <code>time.UTC</code>). When you are saving the value, it first <a href=\"https://github.com/go-sql-driver/mysql/blob/ce924a41eea897745442daaa1739089b0f3f561d/packets.go#L1047\" rel=\"noreferrer\">converts the time stamp to the UTC time zone</a> and then sends it off to the database.</p>\n\n<p>As has been already stated in the comments, a much more robust approach would be to accept the default <code>Loc</code>, and standardize on UTC in the database. This greatly simplifies anything having to do with date math further down the line, and doesn't make assumptions about the time zone of the person viewing the data if you just convert it from UTC to local when displaying the value.</p>\n"}], "owner": {"reputation": 3315, "user_id": 1664109, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/JAlH9.jpg?s=128&g=1", "display_name": "RockOnGom", "link": "https://stackoverflow.com/users/1664109/rockongom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4893, "favorite_count": 1, "accepted_answer_id": 40478160, "answer_count": 1, "score": 6, "last_activity_date": 1553665279, "creation_date": 1478548725, "question_id": 40473565, "link": "https://stackoverflow.com/questions/40473565/go-mysql-driver-doesnt-set-time-correctly", "title": "Go MySql driver doesn&#39;t set time correctly", "body": "<p>I have been developing a micro service that interact mysql for a while in golang, and i love this talented language. Anyway have a problem and do not know where is the problem, in my code, in mysql driver else in mysql. So my machine timezone utc+3, i am sharing some result may be it helps</p>\n\n<pre><code>//created_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP\nmysql&gt; select now();\n\"2016-11-07 22:43:02\", //that is correct.\n</code></pre>\n\n<p>in go</p>\n\n<pre><code>fmt.PrintLn(time.Now().Local())\n\"2016-11-07 22:51:02\" //that is correct too\n</code></pre>\n\n<p>But when i added the entity into db, mysql workbench shows me wrong datetime.</p>\n\n<pre><code>\"2016-11-07 19:51:02\" // \n</code></pre>\n\n<p>Go code:</p>\n\n<pre><code>func (this *AppLogHandler) addLog(_log *AppLog) (int64, error){\n    fmt.Println(\"addLog\")\n    db:= this.Context.DB\n    stmt, err := db.Prepare(\"INSERT tbl_logs SET user_id=?,ip_proxy=?, ip_original=?, end_point=?, http_method=?, message=?, status=?, created_date=?\")\n    if(err != nil){\n        log.Println(err)\n        return -1, err\n    }\n    defer stmt.Close()\n    res, err := stmt.Exec(&amp;_log.UserID, &amp;_log.IPProxy, &amp;_log.IPOriginal, &amp;_log.Endpoint, &amp;_log.HttpMethod, &amp;_log.Message, &amp;_log.Status, &amp;_log.CreatedDate)\n    if(err != nil){\n        log.Println(err)\n        return -1, err\n    }\n    return res.LastInsertId()\n}\n\n/// some code here\n    app_log := AppLog{}\n    app_log.IPProxy = r.RemoteAddr\n    app_log.IPOriginal = r.Header.Get(\"X-Forwarded-For\")\n    app_log.CreatedDate = time.Now().Local()\n    app_log.UserID = user_id\n    app_log.Endpoint = r.URL.Path\n    app_log.HttpMethod = r.Method\n    fmt.Println(app_log.CreatedDate)\n    return this.addLog(&amp;app_log)\n</code></pre>\n\n<p>So guys i need your helps. I couldn't solve the problem for hours. </p>\n\n<pre><code>mysql=&gt;  Ver 14.14 Distrib 5.7.15, for osx10.11 (x86_64) using  EditLine wrapper\ngo =&gt; 1.7\nmysql driver =&gt; 1.2, https://github.com/go-sql-driver/mysql/\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "is_accepted": false, "score": 2, "last_activity_date": 1478770547, "last_edit_date": 1478770547, "creation_date": 1478535909, "answer_id": 40469872, "question_id": 40469427, "link": "https://stackoverflow.com/questions/40469427/golang-return-mapstringinterface-returning-variable-struct/40469872#40469872", "title": "Golang return map[string]interface{} returning variable struct", "body": "<p>Basically, you need to tell the compiler that all your types (instances in the map) will always have an Init method. For that you declare an interface with the Init method and build a map of that interface.\nSince your receivers work on a pointer *xxx, you need to add the pointers of the objects to the map (not the objects themselves) by adding &amp; in front of them.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype initializer interface {\n    Init()\n}\n\nvar factory map[string]initializer = map[string]initializer{\n    \"Date\":     &amp;Date{},\n    \"DateTime\": &amp;DateTime{},\n}\n\ntype Date struct {\n    year  int //xsd:int Year (e.g., 2009)\n    month int //xsd:int Month (1..12)\n    day   int //xsd:int Day number\n}\n\nfunc (d *Date) Init() {\n    d.year = 2009\n    d.month = 1\n    d.day = 1\n}\n\ntype DateTime struct {\n    date       Date   //Date\n    hour       int    //xsd:int\n    minute     int    //xsd:int\n    second     int    //xsd:int\n    timeZoneID string //xsd:string\n}\n\nfunc (d *DateTime) Init() {\n    d.hour = 0\n    d.minute = 0\n    d.second = 0\n\n}\n\nfunc main() {\n    obj := factory[\"Date\"]\n    obj.Init()\n    fmt.Println(obj)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 437, "user_id": 686334, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/bd88dca6931036c734fdfc34535277aa?s=128&d=identicon&r=PG", "display_name": "CrabbyPete", "link": "https://stackoverflow.com/users/686334/crabbypete"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2847, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1479254001, "creation_date": 1478534561, "last_edit_date": 1479254001, "question_id": 40469427, "link": "https://stackoverflow.com/questions/40469427/golang-return-mapstringinterface-returning-variable-struct", "title": "Golang return map[string]interface{} returning variable struct", "body": "<p>I need a big table of structs and I need to work off the struct returned.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nvar factory map[string]interface{} = map[string]interface{}{\n    \"Date\":                                 Date{},\n    \"DateTime\":                             DateTime{},\n}\n\ntype Date struct {\n    year  int //xsd:int Year (e.g., 2009)\n    month int //xsd:int Month (1..12)\n    day   int //xsd:int Day number\n}\n\nfunc( d *Date ) Init(){\n    d.year = 2009\n    d.month = 1\n    d.day = 1\n}\n\ntype DateTime struct {\n    date       Date   //Date\n    hour       int    //xsd:int\n    minute     int    //xsd:int\n    second     int    //xsd:int\n    timeZoneID string //xsd:string\n}\n\nfunc( d *DateTime ) Init(){\n    d.hour = 0\n    d.minute = 0\n    d.second = 0\n\n}\n\nfunc main() {\n    obj := factory[\"Date\"]\n    obj.Init()\n    fmt.Println( obj ) \n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/69sINN8xK\" rel=\"nofollow noreferrer\">Go Playground</a>\nbut I get the error obj.Init undefined (type interface {} is interface with no methods) Is there a way to do this?</p>\n"}, {"tags": ["bash", "go", "buffer"], "comments": [{"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 5, "creation_date": 1478531554, "post_id": 40468404, "comment_id": 68181130, "body": "What do you mean by written in a cleared buffer?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5349891"}, "reply_to_user": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 0, "creation_date": 1478531641, "post_id": 40468404, "comment_id": 68181207, "body": "I&#39;ve editted the question."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1478531928, "post_id": 40468404, "comment_id": 68181404, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/22891644/how-can-i-clear-the-terminal-screen-in-go\">How can I clear the terminal screen in Go?</a>; and <a href=\"http://stackoverflow.com/questions/19209425/how-can-i-clear-the-console-with-golang-in-windows\">How can I clear the console with golang in windows?</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478531956, "post_id": 40468404, "comment_id": 68181419, "body": "You do it the same is you would in any language. See also <a href=\"https://stackoverflow.com/questions/2084508/clear-terminal-in-python\" title=\"clear terminal in python\">stackoverflow.com/questions/2084508/clear-terminal-in-python</a>"}], "answers": [{"tags": [], "owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "is_accepted": false, "score": 1, "last_activity_date": 1478532034, "last_edit_date": 1495539941, "creation_date": 1478532034, "answer_id": 40468644, "question_id": 40468404, "link": "https://stackoverflow.com/questions/40468404/golang-open-file-in-an-empty-bash-window/40468644#40468644", "title": "golang - open file in an empty bash window", "body": "<p>If clearing the terminal is truly part of your program's responsibility then check out the answers in this question <a href=\"https://stackoverflow.com/questions/22891644/how-can-i-clear-the-terminal-screen-in-go\">How can I clear the terminal screen in Go?</a></p>\n\n<p>However if you're just wanting to clear the screen as part of your development process then I would keep it simple and do something like this</p>\n\n<pre><code>clear &amp;&amp; go run *.go\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5349891"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1478532034, "creation_date": 1478531250, "last_edit_date": 1478531611, "question_id": 40468404, "link": "https://stackoverflow.com/questions/40468404/golang-open-file-in-an-empty-bash-window", "title": "golang - open file in an empty bash window", "body": "<p>lets say I have this code:</p>\n\n<pre><code>package main \n\nimport (\n     \"io/ioutil\" \n     \"fmt\"\n)\nfunc check(err error) {\n     if err != nil {\n         panic(err)\n     }\n} \nfunc main() {\n     file, err := ioutil.ReadFile(\"test.txt\")\n     check(err)\n     fmt.Print(string(file))\n}\n</code></pre>\n\n<p>when running it with <code>go run</code> I want it to be written in a cleared bash window. Is it possible to do so without using any additional open-source repositories? </p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["oracle", "go"], "comments": [{"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 0, "creation_date": 1478521442, "post_id": 40464950, "comment_id": 68174446, "body": "The user from you are executing the command is a part of ORACLE group?"}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 7328932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/35WjQ.png?s=128&g=1", "display_name": "sbr", "link": "https://stackoverflow.com/users/7328932/sbr"}, "is_accepted": false, "score": 1, "last_activity_date": 1499350317, "creation_date": 1499350317, "answer_id": 44951375, "question_id": 40464950, "link": "https://stackoverflow.com/questions/40464950/how-can-i-connect-to-oracle-database/44951375#44951375", "title": "How can I connect to Oracle database?", "body": "<p>What did you put in your oci8.pc file?</p>\n\n<p>I've just got this working with the below.  Keeping in mind I have only the oracle 11.2 instant client installed under the prefix path.  I assume you would have to change the version number to the appropriate number.</p>\n\n<pre><code>prefix=/home/sbr/wk/apps/oracle/product/11.2.0/client_1\nexec_prefix=${prefix}\nlibdir=${prefix}\nincludedir=${prefix}/sdk/include\n\nglib_genmarshal=glib-genmarshal\ngobject_query=gobject-query\nglib_mkenums=glib-mkenums\n\nName: oci8\nDescription: oci8 library\nLibs: -L${libdir} -lclntsh\nCflags: -I${includedir}\nVersion: 11.2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 5761434, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-LIPKBXYePIY/AAAAAAAAAAI/AAAAAAAAAFI/MKsQEoGdf34/photo.jpg?sz=128", "display_name": "\u866b\u5b50\u6a31\u6843", "link": "https://stackoverflow.com/users/5761434/%e8%99%ab%e5%ad%90%e6%a8%b1%e6%a1%83"}, "is_accepted": false, "score": 0, "last_activity_date": 1560867687, "creation_date": 1560867687, "answer_id": 56651295, "question_id": 40464950, "link": "https://stackoverflow.com/questions/40464950/how-can-i-connect-to-oracle-database/56651295#56651295", "title": "How can I connect to Oracle database?", "body": "<p>1\u3001install <a href=\"https://gopkg.in/goracle.v2\" rel=\"nofollow noreferrer\">goracle</a> </p>\n\n<p>2\u3001install <a href=\"https://sourceforge.net/projects/tdm-gcc/\" rel=\"nofollow noreferrer\">TMD GCC</a>.</p>\n\n<p>3\u3001use sql.open to connect to Oracle.here is a little Example.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"database/sql\"\n    _ \"gopkg.in/goracle.v2\"\n)\n\nfunc main(){\n\n    db, err := sql.Open(\"goracle\", \"scott/tiger@10.0.1.127:1521/orclpdb1\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer db.Close()\n\n\n    rows,err := db.Query(\"select sysdate from dual\")\n    if err != nil {\n        fmt.Println(\"Error running query\")\n        fmt.Println(err)\n        return\n    }\n    defer rows.Close()\n\n    var thedate string\n    for rows.Next() {\n\n        rows.Scan(&amp;thedate)\n    }\n    fmt.Printf(\"The date is: %s\\n\", thedate)\n}\n</code></pre>\n\n<p>from <a href=\"https://blogs.oracle.com/developers/how-to-connect-a-go-program-to-oracle-database-using-goracle\" rel=\"nofollow noreferrer\">oracle blog</a></p>\n"}], "owner": {"reputation": 43, "user_id": 7126136, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eKNDyna6uSg/AAAAAAAAAAI/AAAAAAAAAPU/_9U9DJDJNxE/photo.jpg?sz=128", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u0410\u0441\u0442\u0430\u0444\u044c\u0435\u0432", "link": "https://stackoverflow.com/users/7126136/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9-%d0%90%d1%81%d1%82%d0%b0%d1%84%d1%8c%d0%b5%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1947, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1560880461, "creation_date": 1478520838, "last_edit_date": 1592644375, "question_id": 40464950, "link": "https://stackoverflow.com/questions/40464950/how-can-i-connect-to-oracle-database", "title": "How can I connect to Oracle database?", "body": "<p>I am using Fedora 23 and installed <code>Oracle 12.1</code> and <code>Go 1.7.1</code></p>\n<p>When I run:</p>\n<pre><code>go get github.com/mattn/go-oci8\n</code></pre>\n<p>I am getting an error:</p>\n<blockquote>\n<p>/usr/bin/ld: skipping incompatible /usr/lib/oracle/12.1/client64/lib/libclntsh.so when searching for -lclntsh</p>\n<p>/usr/bin/ld: cannot find -lclntsh</p>\n<p>collect2: error: execution of ld completed with return code 1</p>\n</blockquote>\n"}, {"tags": ["go", "server"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1478486256, "post_id": 40456757, "comment_id": 68159654, "body": "This is likely to be closed for being too broad, but a few tips: go executables require nothing to be installed on the server itself. You can just drop an executable from your dev machine or build server and it will run."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1478486304, "post_id": 40456757, "comment_id": 68159662, "body": "I have installed go apps as windows services using nssm, or the native service manager apis, but that can be tricky."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1478486381, "post_id": 40456757, "comment_id": 68159682, "body": "I like to deploy go apps with html/css/js actually compiled into the main binary (true single file deploys). Using tools like <a href=\"https://github.com/jteeuwen/go-bindata\" rel=\"nofollow noreferrer\">github.com/jteeuwen/go-bindata</a>. My app will serve them as part of it&#39;s normal routes."}], "answers": [{"tags": [], "owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "is_accepted": false, "score": 5, "last_activity_date": 1478490095, "creation_date": 1478490095, "answer_id": 40457498, "question_id": 40456757, "link": "https://stackoverflow.com/questions/40456757/working-with-golang-and-a-windows-server-machine/40457498#40457498", "title": "Working with Golang and a Windows Server Machine", "body": "<p>This is as much a general dev ops question as it is specific to Go. A lot of things to consider here and everyone will have varying preferences but here are some guidelines I'd recommend:</p>\n\n<ul>\n<li>It's not necessary to install the Go tool chain on your production server. You then have to maintain your Go installation on both your development and production environments and if your production server is a different OS than your Windows computer (eg. a Linux distribution) this will get out of hand quickly. Instead, just develop on your local and <a href=\"http://dave.cheney.net/2015/08/22/cross-compilation-with-go-1-5\" rel=\"noreferrer\">cross compile</a> to the OS of your production server.</li>\n<li>One thing you will need to keep on your production server is whatever DB you choose to work with your Go program.</li>\n<li>You can then <code>sftp</code> or transfer through a method of your choice your compiled binary over to your production server along with your static web files. Once the binary is on your production server you can fire it up when you're SSH'ed in eg. <code>./programname</code></li>\n<li>Depending on how you want to use Go, you don't need Apache. Use the <a href=\"https://golang.org/pkg/net/http/\" rel=\"noreferrer\">net/http</a> package to serve up your Html, CSS and JS files. You can transfer these static files over after you've worked on them on your local or you can just keep them in a Github repo and <code>git pull</code> them from your prod server as needed, assuming you've installed git there.</li>\n<li>You generally don't need to worry about keeping it \"running\" on your production server. <a href=\"https://golang.org/pkg/net/http/#Server.ListenAndServe\" rel=\"noreferrer\"><code>http.ListenAndServe</code></a> listens on your port for incoming requests. If your server reboots or shuts downs you can automatically have your compiled binary start up along with it.</li>\n</ul>\n\n<p>You can also work with things like Vagrant, Virtual Box and Ansible for high quality mimicking of your production environment and spinning up new servers according to your desired specs.</p>\n"}], "owner": {"reputation": 25, "user_id": 5658024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e66d6274ab4deeead16301ac4e3e4f?s=128&d=identicon&r=PG&f=1", "display_name": "buklaou", "link": "https://stackoverflow.com/users/5658024/buklaou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2478, "favorite_count": 1, "closed_date": 1479218793, "answer_count": 1, "score": 0, "last_activity_date": 1572983657, "creation_date": 1478483820, "last_edit_date": 1572983657, "question_id": 40456757, "link": "https://stackoverflow.com/questions/40456757/working-with-golang-and-a-windows-server-machine", "closed_reason": "Needs more focus", "title": "Working with Golang and a Windows Server Machine", "body": "<p>I am fairly new and interested in the Go programming language. I have the intention of using it to code a simple website that includes a shopping cart.</p>\n\n<ul>\n<li>How to install golang on windows server? Is it the same process as a regular computer? </li>\n<li>What steps do I take to deploy the website using the Windows server once it is finished. </li>\n<li>To what extend is it required to use html, css, or javascript? </li>\n<li>How can I keep the site running on the server for other users in our network/LAN to access it?</li>\n</ul>\n\n<p>Any helpful information regarding web apps and/or windows server machines is appreciated!</p>\n"}, {"tags": ["windows", "file", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1478484413, "last_edit_date": 1478484413, "creation_date": 1478483947, "answer_id": 40456772, "question_id": 40456725, "link": "https://stackoverflow.com/questions/40456725/read-an-xml-file-in-go/40456772#40456772", "title": "Read an XML file in Go", "body": "<p>A string literal between double quotes is an <em>interpreted</em> string literal where backslash is a special character denoting escape sequences. See <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">Spec: String literals</a>:</p>\n\n<blockquote>\n  <p>The text between the quotes forms the value of the literal, with backslash escapes interpreted as they are in <a href=\"https://golang.org/ref/spec#Rune_literals\" rel=\"nofollow noreferrer\">rune literals</a> (except that \\' is illegal and \\\" is legal), with the same restrictions.</p>\n</blockquote>\n\n<p>Either double quote your backslashes:</p>\n\n<pre><code>input, err := os.Open(\"C:\\\\GoWork\\\\toy\\\\lang.xml\")\n</code></pre>\n\n<p>Or easier: use a <em>raw</em> string literal (backticks) where backslash has no special meaning:</p>\n\n<pre><code>input, err := os.Open(`C:\\GoWork\\toy\\lang.xml`)\n</code></pre>\n\n<p>Also you should close your file, preferably as a deferred statement:</p>\n\n<pre><code>input, err := os.Open(`C:\\GoWork\\toy\\lang.xml`)\nif err != nil {\n    log.Fatal(err)\n}\ndefer input.Close()\nio.Copy(os.Stdout, input)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 261, "user_id": 1732600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sNkL2.jpg?s=128&g=1", "display_name": "Brij", "link": "https://stackoverflow.com/users/1732600/brij"}, "is_accepted": false, "score": 0, "last_activity_date": 1480410171, "last_edit_date": 1480410171, "creation_date": 1478500623, "answer_id": 40459156, "question_id": 40456725, "link": "https://stackoverflow.com/questions/40456725/read-an-xml-file-in-go/40459156#40459156", "title": "Read an XML file in Go", "body": "<p>Currently this is mix of two literal forms</p>\n\n<pre><code>input, err := os.Open(\"C:\\GoWork\\toy\\lang.xml\")\n</code></pre>\n\n<p>There are basically two forms of string literals:\na. raw string literals \nb. interpreted string literals</p>\n\n<p>either use raw string literal with back quotes, as in `foo` and the value of literal has no special meaning between the quotes</p>\n\n<p>or interpreted string literals with double quotes, as in \"bar\" but take precaution because the value are interpreted as in <a href=\"https://golang.org/ref/spec#Rune_literals\" rel=\"nofollow noreferrer\">rune literals</a> </p>\n"}], "owner": {"reputation": 27, "user_id": 6093554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdb3401bda5e687bd17d89e96ae8d724?s=128&d=identicon&r=PG", "display_name": "Vinicius de Andrade", "link": "https://stackoverflow.com/users/6093554/vinicius-de-andrade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1480410171, "creation_date": 1478483554, "last_edit_date": 1478497057, "question_id": 40456725, "link": "https://stackoverflow.com/questions/40456725/read-an-xml-file-in-go", "title": "Read an XML file in Go", "body": "<p>I did a small code in Go, that I thought it was good enough to read an XML file.</p>\n\n<p>Can someone know what is happing?</p>\n\n<p>XML file:</p>\n\n<pre><code>&lt;Lang&gt;\n    &lt;Name&gt; Go &lt;/Name&gt;\n    &lt;Year&gt; 2009 &lt;/Year&gt;\n    &lt;URL&gt; http://golang.org/ &lt;/URL&gt;\n\n&lt;/Lang&gt;\n</code></pre>\n\n<p>Go code:</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    input, err := os.Open(\"C:\\GoWork\\toy\\lang.xml\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    io.Copy(os.Stdout, input)\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/ABKTi.jpg\" rel=\"nofollow noreferrer\">Error message:</a></p>\n\n<pre><code>.\\xmltoStruct.go:11: unknown escape sequence: G\n.\\xmltoStruct.go:11: unknown escape sequence: l\n</code></pre>\n"}, {"tags": ["testing", "go", "reflection", "tdd"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478460446, "post_id": 40453298, "comment_id": 68152490, "body": "You have to pass a pointer to unmarshal into"}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478460890, "post_id": 40453298, "comment_id": 68152658, "body": "<code>err := json.Unmarshal(actualBody, &amp;receivedev)</code> this does not work either @JimB"}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 4, "last_activity_date": 1478464232, "creation_date": 1478464232, "answer_id": 40454189, "question_id": 40453298, "link": "https://stackoverflow.com/questions/40453298/how-to-unmarshal-a-reflect-value-in-golang/40454189#40454189", "title": "How to unmarshal a reflect.Value in Golang", "body": "<p>Use <code>reflect.New</code> rather than <code>reflect.Zero</code> to get a pointer:</p>\n\n<pre><code>thetype := reflect.TypeOf(i)\nreceivedev := reflect.New(thetype)\nerr := json.Unmarshal(actualBody, receivedev.Interface())\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/pGXRWpBFiF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pGXRWpBFiF</a>.</p>\n"}], "owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 634, "favorite_count": 1, "accepted_answer_id": 40454189, "answer_count": 1, "score": 2, "last_activity_date": 1478464232, "creation_date": 1478458963, "last_edit_date": 1478459487, "question_id": 40453298, "link": "https://stackoverflow.com/questions/40453298/how-to-unmarshal-a-reflect-value-in-golang", "title": "How to unmarshal a reflect.Value in Golang", "body": "<p>I got this test</p>\n\n<pre><code>func (t *DeviceTests) CreatePublicDevice() {\n    registerRegularDevice := tester.TableTest{\n        Method:      \"POST\",\n        Path:        \"/iot/devices\",\n        Status:      http.StatusOK,\n        Name:        \"CreatePublicDevice\",\n        Description: \"register Regular Device has to return 200\",\n        Body:        PublicDevice,\n    }\n    resp := registerRegularDevice.DoubleSpin(t.Test)\n    log.Println(resp.(types.Device).ID)\n\n}\n</code></pre>\n\n<p>I want to keep this in a separate package so I can reuse on diferent projects.</p>\n\n<pre><code>func (test TableTest) DoubleSpin(t *testing.T) interface{} {\n    actualBody := test.innnerSpin(t)\n    log.Print(string(actualBody))\n    thetype := reflect.TypeOf(test.Body)\n    log.Println(thetype)\n    receivedev := reflect.Zero(thetype)\n    err := json.Unmarshal(actualBody, receivedev.Interface())\n    assert.NoError(t, err)\n    log.Println(receivedev)\n    return receivedev.Interface()\n}\n</code></pre>\n\n<p>Logs say:</p>\n\n<pre><code>2016/11/06 16:54:01 {\"id\":\"581f7c49b2c79a543c627474\",\"hostname\":\"Shriekersolar\",\"alias\":\"my PublicDevice\",\"channels\":8,\"owner\":\"public\",\"location\":{}}\n2016/11/06 16:54:01 types.Device\n2016/11/06 16:54:01 {ObjectIdHex(\"\")   0  map[]}\n2016/11/06 16:54:01 ObjectIdHex(\"\")\n</code></pre>\n\n<p>Where a device looks like:</p>\n\n<pre><code>type Device struct {\n    ID       bson.ObjectId     `json:\"id\" bson:\"_id,omitempty\"`\n    Hostname string            `json:\"hostname\"`\n    Alias    string            `json:\"alias\"`\n    Channels int               `json:\"channels\"`\n    Owner    string            `json:\"owner\"`\n    Location map[string]string `json:\"location\"`\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2052, "user_id": 639559, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3adac89e63229dfeb3c56db48502148c?s=128&d=identicon&r=PG", "display_name": "nilsmagnus", "link": "https://stackoverflow.com/users/639559/nilsmagnus"}, "edited": false, "score": 0, "creation_date": 1478457657, "post_id": 40453049, "comment_id": 68151510, "body": "The question is &quot;what is a goroutine&quot;. Have a look at <a href=\"https://gobyexample.com/goroutines\" rel=\"nofollow noreferrer\">gobyexample.com/goroutines</a> ."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1478464419, "post_id": 40453049, "comment_id": 68153820, "body": "If you are new to Go than take the Tour of Go <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">tour.golang.org</a>, then play around and take the tour a second time. Then ask on SO."}, {"owner": {"reputation": 19, "user_id": 5323506, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/ouJjb.jpg?s=128&g=1", "display_name": "michael", "link": "https://stackoverflow.com/users/5323506/michael"}, "reply_to_user": {"reputation": 2052, "user_id": 639559, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3adac89e63229dfeb3c56db48502148c?s=128&d=identicon&r=PG", "display_name": "nilsmagnus", "link": "https://stackoverflow.com/users/639559/nilsmagnus"}, "edited": false, "score": 0, "creation_date": 1478468822, "post_id": 40453049, "comment_id": 68155409, "body": "@nilsmagnus Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "is_accepted": false, "score": 1, "last_activity_date": 1478458455, "last_edit_date": 1478458455, "creation_date": 1478458120, "answer_id": 40453175, "question_id": 40453049, "link": "https://stackoverflow.com/questions/40453049/whats-the-difference-in-golang-to-run-a-function-with-or-without-go/40453175#40453175", "title": "What&#39;s the difference in Golang to run a function with or without go", "body": "<p><code>test()</code> will run when you call it. <code>go test()</code> will run asynchronously on its own completely independent of <code>test()</code>.</p>\n\n<p>If you have a program like this:</p>\n\n<pre><code>func main() {\n   test(\"bob\")\n   go test(\"sue\")\n}\n\nfunc test(msg string) {\n  fmt.Printf(\"hello %v\", msg)\n}\n</code></pre>\n\n<p>You will only see output </p>\n\n<blockquote>\n  <p>hello bob</p>\n</blockquote>\n\n<p>since the <code>main</code> function execution jumps right through to the end. There is nothing waiting for <code>go test(\"sue\")</code> to complete since it's its own independent function.</p>\n\n<p>You can block for <code>go test(\"sue\")</code> by putting in a <code>time.Sleep</code> or a command line input with <code>fmt.Scanln(&amp;input)</code></p>\n\n<p><a href=\"https://play.golang.org/p/je5lifQO2S\" rel=\"nofollow noreferrer\">Go playground</a></p>\n"}], "owner": {"reputation": 19, "user_id": 5323506, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/ouJjb.jpg?s=128&g=1", "display_name": "michael", "link": "https://stackoverflow.com/users/5323506/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "answer_count": 1, "score": -7, "last_activity_date": 1478458455, "creation_date": 1478457436, "question_id": 40453049, "link": "https://stackoverflow.com/questions/40453049/whats-the-difference-in-golang-to-run-a-function-with-or-without-go", "title": "What&#39;s the difference in Golang to run a function with or without go", "body": "<p>I am new to Go. My question is what's the difference to run a function with or without Go. For example in a .go file I have one test() function, when I call this function what's the difference for \"test()\" and \"go test()\".</p>\n"}, {"tags": ["http", "url", "go"], "answers": [{"tags": [], "owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "is_accepted": false, "score": 2, "last_activity_date": 1478451640, "last_edit_date": 1478451640, "creation_date": 1478450616, "answer_id": 40451836, "question_id": 40451625, "link": "https://stackoverflow.com/questions/40451625/nested-values-in-url-values/40451836#40451836", "title": "Nested values in url.Values", "body": "<p>You are not using properly the <code>url.Values</code>, according to the source code (url package, url.go):  </p>\n\n<pre><code>// Values maps a string key to a list of values.\n// It is typically used for query parameters and form values.\n// Unlike in the http.Header map, the keys in a Values map\n// are case-sensitive.\ntype Values map[string][]string\n</code></pre>\n\n<p>But <code>arguments</code> is not compliant with the definition because the object of <code>arguments</code> is not an array of strings.</p>\n"}, {"tags": [], "owner": {"reputation": 705, "user_id": 3987092, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9740934435748644c491a2e120608d0c?s=128&d=identicon&r=PG&f=1", "display_name": "Connor Hicks", "link": "https://stackoverflow.com/users/3987092/connor-hicks"}, "is_accepted": false, "score": 3, "last_activity_date": 1478451288, "creation_date": 1478451288, "answer_id": 40451941, "question_id": 40451625, "link": "https://stackoverflow.com/questions/40451625/nested-values-in-url-values/40451941#40451941", "title": "Nested values in url.Values", "body": "<p>I was able to figure this out on my own! The answer is to struct all-the-things!</p>\n\n<pre><code>type Command struct {\n    Method          string      `json:\"method,omitempty\"`\n    Arguments       Arguments   `json:\"arguments,omitempty\"`\n}\n\ntype Arguments struct {\n    DownloadDir     string      `json:\"download-dir,omitempty\"`\n    Filename        string      `json:\"filename,omitempty\"`\n    Paused          bool        `json:\"paused,omitempty\"`\n}\n</code></pre>\n\n<p>Then, when creating your PostForm:</p>\n\n<pre><code>jsonBody, err := json.Marshal(reqBody) // reqBody is a Command\n\nif (err != nil) {\n    return false\n}\n\nreq, err := http.NewRequest(\"POST\", c.Url, strings.NewReader(string(jsonBody)))\n</code></pre>\n\n<p>Hope this helps!</p>\n"}, {"tags": [], "owner": {"reputation": 839, "user_id": 6191855, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/u8HTb.jpg?s=128&g=1", "display_name": "Julien Salinas", "link": "https://stackoverflow.com/users/6191855/julien-salinas"}, "is_accepted": false, "score": 0, "last_activity_date": 1510064746, "creation_date": 1510064746, "answer_id": 47160312, "question_id": 40451625, "link": "https://stackoverflow.com/questions/40451625/nested-values-in-url-values/47160312#47160312", "title": "Nested values in url.Values", "body": "<p>I used <code>NewRequest</code> as Connor mentions in his answer but using a <code>struct</code> and then marshalling it seems an unnecessary step to me.</p>\n\n<p>I passed my nested json string straight to <code>strings.NewReader</code>:</p>\n\n<pre><code>import (\n    \"net/http\"\n    \"strings\"\n)\n\nreqBody := strings.NewReader(`{\n    \"method\": {\"server-method\"},\n    \"arguments\": {\n        \"download-dir\": {\"/path/to/downloads/dir\"},\n        \"paused\":       {\"false\"},\n    },\n}`)\n\nreq, err := http.NewRequest(\"POST\", \"https://httpbin.org/post\", reqBody)\n</code></pre>\n\n<p>Hope it helps those who are stuck with Go's http PostForm which only accepts <code>url.Values</code> as argument while <code>url.Values</code> cannot generate nested json. </p>\n"}], "owner": {"reputation": 705, "user_id": 3987092, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9740934435748644c491a2e120608d0c?s=128&d=identicon&r=PG&f=1", "display_name": "Connor Hicks", "link": "https://stackoverflow.com/users/3987092/connor-hicks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1308, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1510064746, "creation_date": 1478449473, "question_id": 40451625, "link": "https://stackoverflow.com/questions/40451625/nested-values-in-url-values", "title": "Nested values in url.Values", "body": "<p>I'm working on an API client and I need to be able to send a nested JSON structure with a client.PostForm request. The issue I'm encountering is this:</p>\n\n<pre><code>reqBody := url.Values{\n    \"method\": {\"server-method\"},\n    \"arguments\": {\n        \"download-dir\": {\"/path/to/downloads/dir\"},\n        \"filename\":     {variableWithURL},\n        \"paused\":       {\"false\"},\n    },\n}\n</code></pre>\n\n<p>When I try to <code>go build</code> this, I get the following errors:</p>\n\n<pre><code>./transmission.go:17: syntax error: unexpected :, expecting }\n./transmission.go:24: non-declaration statement outside function body\n./transmission.go:26: non-declaration statement outside function body\n./transmission.go:27: non-declaration statement outside function body\n./transmission.go:29: non-declaration statement outside function body\n./transmission.go:38: non-declaration statement outside function body\n./transmission.go:39: syntax error: unexpected }\n</code></pre>\n\n<p>I'm wondering what the correct way to created a nested set of values in this scenario. Thanks in advance!</p>\n"}, {"tags": ["go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1478442279, "post_id": 40449972, "comment_id": 68146177, "body": "technically those are not the same type: <a href=\"https://play.golang.org/p/9Xk1Mdrg_V\" rel=\"nofollow noreferrer\">play.golang.org/p/9Xk1Mdrg_V</a> (though the original question is making the same value vs pointer too)"}, {"owner": {"reputation": 8073, "user_id": 2852624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/682806d261e4f00f77aa8633689a9558?s=128&d=identicon&r=PG&f=1", "display_name": "Matthias247", "link": "https://stackoverflow.com/users/2852624/matthias247"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1478442502, "post_id": 40449972, "comment_id": 68146255, "body": "If he wants a value instead of a pointer he can use <code>reflect.Zero</code>. However as his source code uses <code>new</code> I imagined he wanted a pointer."}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478443758, "post_id": 40449972, "comment_id": 68146653, "body": "@JimB at first I thought that you were the one that answered as usual."}], "tags": [], "owner": {"reputation": 8073, "user_id": 2852624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/682806d261e4f00f77aa8633689a9558?s=128&d=identicon&r=PG&f=1", "display_name": "Matthias247", "link": "https://stackoverflow.com/users/2852624/matthias247"}, "is_accepted": true, "score": 2, "last_activity_date": 1478439713, "creation_date": 1478439713, "answer_id": 40449972, "question_id": 40449695, "link": "https://stackoverflow.com/questions/40449695/how-to-get-a-new-variable-of-the-same-type-of-another-variable-with-golang/40449972#40449972", "title": "How to get a new variable of the same type of another variable with Golang", "body": "<p>If you want to create a new value from a <code>reflect.Type</code> you can do it with <code>reflect.New</code>:</p>\n\n<pre><code>thetype := reflect.TypeOf(hey)\nBB:= reflect.New(thetype)\n</code></pre>\n\n<p>This returns a <code>reflect.Value</code><br>\nYou can then for example use <code>.Interface()</code> and type assertions to get back to the original type.</p>\n\n<p>Example on Go playground: <a href=\"https://play.golang.org/p/rL-Hm0IUpd\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rL-Hm0IUpd</a></p>\n"}], "owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1210, "favorite_count": 0, "accepted_answer_id": 40449972, "answer_count": 1, "score": 0, "last_activity_date": 1478496109, "creation_date": 1478437766, "last_edit_date": 1478496109, "question_id": 40449695, "link": "https://stackoverflow.com/questions/40449695/how-to-get-a-new-variable-of-the-same-type-of-another-variable-with-golang", "title": "How to get a new variable of the same type of another variable with Golang", "body": "<p>How can I do this? I want a function to return a variable with the same type as one of its arguments. I need something like the below:</p>\n\n<pre><code>type Whatever struct {\n    Title string\n}\n\nhey:= Whatever{Title:\"YAY\"}\nthetype := reflect.ValueOf(hey).Kind()\n\n// This does not work\nBB:= new(thetype)\n</code></pre>\n"}, {"tags": ["go", "amazon-redshift"], "answers": [{"comments": [{"owner": {"reputation": 1893, "user_id": 127958, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0846808c184064b26729044cdeb75a5d?s=128&d=identicon&r=PG", "display_name": "kadalamittai", "link": "https://stackoverflow.com/users/127958/kadalamittai"}, "edited": false, "score": 0, "creation_date": 1478471491, "post_id": 40447096, "comment_id": 68156244, "body": "Well, template string is my first pass, when statement.Exec invoked- Copy command will not have {{. stageTable}} substring. Template gets parsed and substituted with a table name."}], "tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": false, "score": 0, "last_activity_date": 1478418286, "creation_date": 1478418286, "answer_id": 40447096, "question_id": 40446879, "link": "https://stackoverflow.com/questions/40446879/golang-copy-command-prepared-statement-not-working/40447096#40447096", "title": "GoLang Copy Command Prepared Statement Not working", "body": "<p>lib/pq is indeed parsing it correctly, the problem is you're creating an invalid query template, first: <code>{{.stageTable}}</code> is for formal <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">templates</a>, second: dollars (<strong>$1</strong>) notation doesn't work for table names in <strong>FROM</strong> statement and not sure if the other **$**s will work</p>\n"}], "owner": {"reputation": 1893, "user_id": 127958, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0846808c184064b26729044cdeb75a5d?s=128&d=identicon&r=PG", "display_name": "kadalamittai", "link": "https://stackoverflow.com/users/127958/kadalamittai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 276, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1478418286, "creation_date": 1478416100, "question_id": 40446879, "link": "https://stackoverflow.com/questions/40446879/golang-copy-command-prepared-statement-not-working", "title": "GoLang Copy Command Prepared Statement Not working", "body": "<p>I am writing a simple Golang based Redshift DataLoader. I have to use Redshift Copy From S3 command as Prepared statement so that I can pass credentials as part of an argument. </p>\n\n<p>I see lib/pq is not parsing the SQL template correctly. Any thoughts would be appreciated</p>\n\n<pre><code>    COPY_FROM_S3 = `\n    COPY {{.stageTable}}\n    FROM $1\n    WITH CREDENTIALS AS $2\n    DELIMITER $3\n    IGNOREBLANKLINES ACCEPTINVCHARS BLANKSASNULL\n    EMPTYASNULL ACCEPTANYDATE ESCAPE MAXERROR 50\n    STATUPDATE ON\n`\n  stmt , _ := redshiftDB.Prepare(COPY_FROM_S3)\n  stmt.Exec(s3File, awsCreds, delimter)\n</code></pre>\n\n<p>Getting Syntax error </p>\n\n<pre><code>panic: pq: syntax error at or near \"$1\"\n\ngoroutine 1 [running]:\n</code></pre>\n"}, {"tags": ["macos", "go", "go-guru"], "answers": [{"tags": [], "owner": {"reputation": 699, "user_id": 5215366, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AHxA6zWr1Ms/AAAAAAAAAAI/AAAAAAAACpA/LR6pkPJOeY4/photo.jpg?sz=128", "display_name": "Andrea Sessa", "link": "https://stackoverflow.com/users/5215366/andrea-sessa"}, "is_accepted": true, "score": 8, "last_activity_date": 1478393142, "creation_date": 1478393142, "answer_id": 40444875, "question_id": 40444260, "link": "https://stackoverflow.com/questions/40444260/cannot-get-golang-oracle-package/40444875#40444875", "title": "Cannot get GoLang oracle package", "body": "<p>You are trying to install a deprecated library. oracle has been superseded by guru and was deleted on 1 oct 2016.</p>\n\n<p><a href=\"https://golang.org/s/using-guru\" rel=\"noreferrer\">https://golang.org/s/using-guru</a></p>\n"}], "owner": {"reputation": 4897, "user_id": 1113997, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0b81915021f87732e45938efc6942947?s=128&d=identicon&r=PG", "display_name": "ghostrider", "link": "https://stackoverflow.com/users/1113997/ghostrider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1315, "favorite_count": 0, "accepted_answer_id": 40444875, "answer_count": 1, "score": 5, "last_activity_date": 1478414677, "creation_date": 1478387621, "last_edit_date": 1478414677, "question_id": 40444260, "link": "https://stackoverflow.com/questions/40444260/cannot-get-golang-oracle-package", "title": "Cannot get GoLang oracle package", "body": "<p>I am completely new to GoLang, so chances are I messed up my setup.</p>\n\n<p>Here is what I have :</p>\n\n<pre><code>echo $GOPATH\n/Users/name/Documents/Developer/Go_Workspace\n</code></pre>\n\n<p>This one worked.</p>\n\n<pre><code>name$ go get -v golang.org/x/tools/cmd/oracle\n</code></pre>\n\n<p>It created 2 subfolders inside the Go_Workspace --> src, bin , pkg.</p>\n\n<p>Then when I try :</p>\n\n<pre><code>go get -u golang.org/x/tools/cmd/oracle\npackage golang.org/x/tools/cmd/oracle: cannot find package \"golang.org/x/tools/cmd/oracle\" in any of:\n    /usr/local/go/src/golang.org/x/tools/cmd/oracle (from $GOROOT)\n    /Users/name/Documents/Developer/Go_Workspace/src/golang.org/x/tools/cmd/oracle (from $GOPATH)\n</code></pre>\n\n<p>When enable <code>-v</code> I see :</p>\n\n<pre><code>Fetching https://golang.org/x/tools/cmd/oracle?go-get=1\nParsing meta tags from https://golang.org/x/tools/cmd/oracle?go-get=1 (status code 200)\nget \"golang.org/x/tools/cmd/oracle\": found meta tag main.metaImport{Prefix:\"golang.org/x/tools\", VCS:\"git\", RepoRoot:\"https://go.googlesource.com/tools\"} at https://golang.org/x/tools/cmd/oracle?go-get=1\nget \"golang.org/x/tools/cmd/oracle\": verifying non-authoritative meta tag\nFetching https://golang.org/x/tools?go-get=1\nParsing meta tags from https://golang.org/x/tools?go-get=1 (status code 200)\ngolang.org/x/tools (download)\npackage golang.org/x/tools/cmd/oracle: cannot find package \"golang.org/x/tools/cmd/oracle\" in any of:\n    /usr/local/go/src/golang.org/x/tools/cmd/oracle (from $GOROOT)\n    /Users/name/Documents/Developer/Go_Workspace/src/golang.org/x/tools/cmd/oracle (from $GOPATH)\n</code></pre>\n\n<p>Here is my <code>.bash_profile</code></p>\n\n<pre><code>1 PATH=/usr/local/bin:/usr/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin\n  2 export GOPATH=$HOME/Documents/Developer/Go_Workspace\n  3 export PATH=$PATH:/usr/local/go/bin\n  4 export PATH=$PATH:$GOPATH/bin\n</code></pre>\n\n<p>Can you help me with this? What did I mess up?</p>\n\n<p>I am running on bash terminal on a MacOS.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "is_accepted": false, "score": 9, "last_activity_date": 1478461124, "last_edit_date": 1478461124, "creation_date": 1478453150, "answer_id": 40452289, "question_id": 40443881, "link": "https://stackoverflow.com/questions/40443881/how-to-write-log-into-log-files-in-golang/40452289#40452289", "title": "How to write log into .log files in golang?", "body": "<p>You're trying so many different things it's hard to tell what you're aiming for specifically, but if you simply want to write logs to a file, here is an example:</p>\n\n<pre><code>package main\n\nimport (\n        \"log\"\n        \"os\"\n)\n\nfunc main() {\n\n        //create your file with desired read/write permissions\n        f, err := os.OpenFile(\"filename\", os.O_WRONLY|os.O_CREATE|os.O_APPEND, 0644)\n        if err != nil {\n                log.Fatal(err)\n        }   \n\n        //defer to close when you're done with it, not because you think it's idiomatic!\n        defer f.Close()\n\n        //set output of logs to f\n        log.SetOutput(f)\n\n        //test case\n        log.Println(\"check to make sure it works\")\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2245, "user_id": 479213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb5e966ed938c254a8846613fa110030?s=128&d=identicon&r=PG", "display_name": "johnzachary", "link": "https://stackoverflow.com/users/479213/johnzachary"}, "is_accepted": false, "score": 1, "last_activity_date": 1478466287, "creation_date": 1478466287, "answer_id": 40454516, "question_id": 40443881, "link": "https://stackoverflow.com/questions/40443881/how-to-write-log-into-log-files-in-golang/40454516#40454516", "title": "How to write log into .log files in golang?", "body": "<p>I recommend taking a look at <a href=\"https://github.com/natefinch/lumberjack\" rel=\"nofollow noreferrer\">Lumberjack</a>.  It handles rolling logs with several file conditions quite nicely. I'm using it for a streaming network sensor.</p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 4780955, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh6.googleusercontent.com/-x6VZfsNx5bY/AAAAAAAAAAI/AAAAAAAAQ80/Upuy-T4hutg/photo.jpg?sz=128", "display_name": "Gentry Rolofson", "link": "https://stackoverflow.com/users/4780955/gentry-rolofson"}, "is_accepted": false, "score": 0, "last_activity_date": 1478480925, "last_edit_date": 1478480925, "creation_date": 1478467177, "answer_id": 40454657, "question_id": 40443881, "link": "https://stackoverflow.com/questions/40443881/how-to-write-log-into-log-files-in-golang/40454657#40454657", "title": "How to write log into .log files in golang?", "body": "<p>I have my logger do this, here is an example.\nSend message sends error to my IRC and sendSMS sends error to my phone.\nin my config file I have:</p>\n\n<pre><code>var ErrorFile = \"error.log\"\n\ntype errorLog struct {\n}\n\nfunc (e errorLog) Write(p []byte) (n int, err error) {\nfmt.Println(\"Error: \" + string(p))\nif config.Verbose == 0 {\n    file, _ := os.OpenFile(config.ErrorFile, os.O_RDWR|os.O_APPEND|os.O_CREATE, 0666)\n    file.WriteString(string(p))\n    sendMSG(string(p))\n    sendSMS(string(p))\n    // Close the file when the surrounding function exists\n    defer file.Close()\n}\n\n   return n, err\n}\n\n// Logger is a helpper method to print out a more useful error message\nvar Logger = log.New(errorLog{}, \"\", log.Lmicroseconds|log.Lshortfile)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 106, "user_id": 4710662, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206249203887928/picture?type=large", "display_name": "\u0414\u0435\u043d\u0438\u0441 \u0421\u043c\u0430\u043b\u044c", "link": "https://stackoverflow.com/users/4710662/%d0%94%d0%b5%d0%bd%d0%b8%d1%81-%d0%a1%d0%bc%d0%b0%d0%bb%d1%8c"}, "is_accepted": false, "score": 2, "last_activity_date": 1506688523, "last_edit_date": 1506688523, "creation_date": 1506688180, "answer_id": 46488870, "question_id": 40443881, "link": "https://stackoverflow.com/questions/40443881/how-to-write-log-into-log-files-in-golang/46488870#46488870", "title": "How to write log into .log files in golang?", "body": "<pre><code>import (\n    \"os/exec\"\n)\n\nfunc main() {\n    // check error here...\n    exec.Command(\"/bin/sh\", \"-c\", \"echo \"+err.Error()+\" &gt;&gt; log.log\").Run()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 50, "user_id": 10399490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iGFiC.jpg?s=128&g=1", "display_name": "MartinZ", "link": "https://stackoverflow.com/users/10399490/martinz"}, "is_accepted": false, "score": 0, "last_activity_date": 1608813073, "creation_date": 1608813073, "answer_id": 65438355, "question_id": 40443881, "link": "https://stackoverflow.com/questions/40443881/how-to-write-log-into-log-files-in-golang/65438355#65438355", "title": "How to write log into .log files in golang?", "body": "<p>I have a small project that uses the log.Logger as following:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;errors&quot;\n    &quot;log&quot;\n    &quot;os&quot;\n)\n\nconst (\n    logNone     = iota\n    logInfo\n    logWarning\n    logError\n    logVerbose\n    logDebug\n)\n\ntype myFileLogger struct {\n    logger       *log.Logger\n    logFile      *os.File\n    logLevel     int\n}\n\nfunc newFileLogger() *myFileLogger {\n    return &amp;myFileLogger{\n        logger:   nil,\n        logFile:  nil,\n        logLevel: logNone,\n    }\n}\n\nfunc (myLogger *myFileLogger) startLog(level int, file string) error {\n    f, err := os.OpenFile(file, os.O_WRONLY|os.O_CREATE|os.O_APPEND, os.ModePerm)\n    if err != nil {\n        return err\n    }\n    myLogger.logger = log.New(f, &quot;&quot;, 0)\n    myLogger.logLevel = level\n    myLogger.logFile = f\n    return nil\n}\nfunc (myLogger *myFileLogger) stopLog() error {\n    if myLogger.logFile != nil {\n        return myLogger.logFile.Close()\n    }\n    return nil\n}\n// You can add a log of auxiliary functions here to make the log more easier\nfunc (myLogger *myFileLogger) log(level int, msg string) error {\n    if myLogger.logger == nil {\n        return errors.New(&quot;myFileLogger is not initialized correctly&quot;)\n    }\n    if level &gt;= myLogger.logLevel {\n        myLogger.logger.Print(msg) // maybe you want to include the loglevel here, modify it as you want\n    }\n    return nil\n}\n\nfunc main() {\n\n    logger := newFileLogger()\n    if err := logger.startLog(logError, &quot;myLogFile.log&quot;); err != nil {\n        panic(err.Error())\n    }\n\n    defer func() {\n        logger.stopLog()\n    }()\n\n    logger.log(logInfo, &quot;Info level log msg\\n&quot;) // this will be ignored\n    logger.log(logError, &quot;Error: error message\\n&quot;) // this should included in the log file\n\n}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 2683053, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/1291442302/picture?type=large", "display_name": "firman", "link": "https://stackoverflow.com/users/2683053/firman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11400, "favorite_count": 3, "answer_count": 5, "score": 0, "last_activity_date": 1608813073, "creation_date": 1478384712, "last_edit_date": 1478407655, "question_id": 40443881, "link": "https://stackoverflow.com/questions/40443881/how-to-write-log-into-log-files-in-golang", "title": "How to write log into .log files in golang?", "body": "<p>I'am new use go language, still learn and need help. How can I write my application logs in go language into \".log\" files similiar like PHP phalcon framework ?</p>\n\n<p>I have searching google and get go language tutorials, but there is no simple understanding example. I have try some example but the logs text doesn't write continously. Here's the example that I used to learn for logging log, and I think it's completly wrong.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"time\"\n)\n\nfunc check(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\n\n\n\nfunc main() {\n\n    now := time.Now()\n    dt := now.Format(\"2006-01-02\")\n\n    dt2 := now.Format(\"2006-01-02 15:04:05\")\n\n    // To start, here's how to dump a string (or just\n    // bytes) into a file.\n    d1 := []byte(\"hello\\ngo11\\n\" + dt2)\n    err := ioutil.WriteFile(\"/Users/my/Documents/work/src/logs/log-\"+dt+\".log\", d1, 0644)\n    check(err)\n\n    // For more granular writes, open a file for writing.\n    f, err := os.Create(\"/Users/my/Documents/work/src/logs/log1.log\")\n    check(err)\n\n    // It's idiomatic to defer a `Close` immediately\n    // after opening a file.\n    defer f.Close()\n\n    // You can `Write` byte slices as you'd expect.\n    d2 := []byte{115, 111, 109, 101, 10}\n    n2, err := f.Write(d2)\n    check(err)\n    fmt.Printf(\"wrote %d bytes\\n\", n2)\n\n    // A `WriteString` is also available.\n    n3, err := f.WriteString(\"writes\\n\" + dt)\n    fmt.Printf(\"wrote %d bytes\\n\", n3)\n\n    // Issue a `Sync` to flush writes to stable storage.\n    f.Sync()\n\n    // `bufio` provides buffered writers in addition\n    // to the buffered readers we saw earlier.\n    w := bufio.NewWriter(f)\n    n4, err := w.WriteString(\"buffered\\n\")\n    fmt.Printf(\"wrote %d bytes\\n\", n4)\n\n    // Use `Flush` to ensure all buffered operations have\n    // been applied to the underlying writer.\n    w.Flush()\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1478378452, "post_id": 40442971, "comment_id": 68132482, "body": "<a href=\"https://godoc.org/bufio#Reader.ReadString\" rel=\"nofollow noreferrer\">&quot;ReadString reads until the first occurrence of delim in the input, returning a string containing the data up to and including the delimiter&quot;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1357, "user_id": 6296447, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82effc47b88672178fa310dc2452e92a?s=128&d=identicon&r=PG&f=1", "display_name": "Vinyl Warmth", "link": "https://stackoverflow.com/users/6296447/vinyl-warmth"}, "edited": false, "score": 0, "creation_date": 1478378850, "post_id": 40443010, "comment_id": 68132610, "body": "Thanks, I&#39;ve just tried this but I&#39;m getting the same result?"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 1357, "user_id": 6296447, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82effc47b88672178fa310dc2452e92a?s=128&d=identicon&r=PG&f=1", "display_name": "Vinyl Warmth", "link": "https://stackoverflow.com/users/6296447/vinyl-warmth"}, "edited": false, "score": 1, "creation_date": 1478378967, "post_id": 40443010, "comment_id": 68132639, "body": "Works for me, I actually tested my change by C&amp;P the revised code in the answer."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 1357, "user_id": 6296447, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82effc47b88672178fa310dc2452e92a?s=128&d=identicon&r=PG&f=1", "display_name": "Vinyl Warmth", "link": "https://stackoverflow.com/users/6296447/vinyl-warmth"}, "edited": false, "score": 1, "creation_date": 1478379103, "post_id": 40443010, "comment_id": 68132674, "body": "(Is it possible you are on windows, and getting the MS-style \\r in your ReadString() return value as well?   If so, change the -1 to a -2, or better - use the Trim() function as I suggest."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 1357, "user_id": 6296447, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82effc47b88672178fa310dc2452e92a?s=128&d=identicon&r=PG&f=1", "display_name": "Vinyl Warmth", "link": "https://stackoverflow.com/users/6296447/vinyl-warmth"}, "edited": false, "score": 0, "creation_date": 1478379155, "post_id": 40443010, "comment_id": 68132695, "body": "<code>text = strings.ToLower(strings.Trim(text,&quot; \\r\\n&quot;))</code>"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 1357, "user_id": 6296447, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82effc47b88672178fa310dc2452e92a?s=128&d=identicon&r=PG&f=1", "display_name": "Vinyl Warmth", "link": "https://stackoverflow.com/users/6296447/vinyl-warmth"}, "edited": false, "score": 1, "creation_date": 1478379212, "post_id": 40443010, "comment_id": 68132716, "body": "Let me know if the second change works - that&#39;s super-quirky on the part of <code>strings</code> if so, IMHO...  or maybe not, depending on perspective."}, {"owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1478380325, "post_id": 40443010, "comment_id": 68133079, "body": "I&#39;d recommend using Scanner to prevent issues with platforms. <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"nofollow noreferrer\">golang.org/pkg/bufio/#Scanner</a>"}], "tags": [], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "is_accepted": false, "score": 4, "last_activity_date": 1478379523, "last_edit_date": 1478379523, "creation_date": 1478378642, "answer_id": 40443010, "question_id": 40442971, "link": "https://stackoverflow.com/questions/40442971/why-is-my-go-lang-string-comparison-not-working-as-expected/40443010#40443010", "title": "Why is my go lang string comparison not working as expected?", "body": "<p>You most likely want something like:</p>\n\n<pre><code>reader := bufio.NewReader(os.Stdin)\nfmt.Print(\"(y / n): \")\ntext, _ := reader.ReadString('\\n')\ntext = strings.ToLower(text[0:len(text)-1])\n\nif strings.Compare(text, \"y\") == 0 { \n   fmt.Println(\"True\")\n} else {\n   fmt.Println(\"Else\")\n}\n</code></pre>\n\n<p>As the comment above says, <code>ReadString()</code> returns the delimiter as part of the string.  So you're getting \"y\\n\" and comparing to \"y\" - the result is false.  (You might rather use the <code>Trim()</code> function to remove all whitespace from either side of the input,instead!)</p>\n\n<p>Edit:   The <code>Trim()</code> suggestion should always be preferred over the original suggestion.  To do otherwise produces non-portable code, as illustrated in the comments to this answer.   The complete revised code:</p>\n\n<pre><code>reader := bufio.NewReader(os.Stdin)\nfmt.Print(\"(y / n): \")\ntext, _ := reader.ReadString('\\n')  \ntext = strings.ToLower(strings.Trim(text,\" \\r\\n\"))\n\nif strings.Compare(text, \"y\") == 0 { \n   fmt.Println(\"True\")\n} else {\n   fmt.Println(\"Else\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "is_accepted": false, "score": 3, "last_activity_date": 1478380454, "creation_date": 1478380454, "answer_id": 40443270, "question_id": 40442971, "link": "https://stackoverflow.com/questions/40442971/why-is-my-go-lang-string-comparison-not-working-as-expected/40443270#40443270", "title": "Why is my go lang string comparison not working as expected?", "body": "<p>As @TimCooper pointed out in a comment, \n<a href=\"https://godoc.org/bufio#Reader.ReadString\" rel=\"nofollow noreferrer\"><em>\"ReadString reads until the first occurrence of delim in the input, returning a string containing the data up to and including the delimiter\"</em></a>.\nThat means, as your delimiter is <code>\\n</code>, it will get included in the <code>text</code> read, so you need to consider that when making comparisons, or strip it out.</p>\n\n<p>As revealed by the discussion on the other answer, simply stripping <code>\\n</code> is not enough. This is probably because the line ending of user input from <code>stdin</code> may be different depending on the operating system. In UNIX it's <code>\\n</code>, in Windows it's <code>\\r\\n</code>.\nHere's a more portable solution:</p>\n\n<pre><code>if strings.TrimRight(text, \"\\r\\n\") == \"y\" {\n</code></pre>\n\n<p>I also changed the use of <code>strings.Compare</code> to a more direct, simpler comparison with <code>\"y\"</code> directly.</p>\n"}], "owner": {"reputation": 1357, "user_id": 6296447, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82effc47b88672178fa310dc2452e92a?s=128&d=identicon&r=PG&f=1", "display_name": "Vinyl Warmth", "link": "https://stackoverflow.com/users/6296447/vinyl-warmth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2247, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1478380454, "creation_date": 1478378374, "last_edit_date": 1478378575, "question_id": 40442971, "link": "https://stackoverflow.com/questions/40442971/why-is-my-go-lang-string-comparison-not-working-as-expected", "title": "Why is my go lang string comparison not working as expected?", "body": "<p>I am dipping my toe with <code>Go</code> and have written some code to check if <strong>y</strong> or <strong>n</strong> is input:</p>\n\n<pre><code>reader := bufio.NewReader(os.Stdin)\nfmt.Print(\"(y / n): \")\ntext, _ := reader.ReadString('\\n')\ntext = strings.ToLower(text)\n\nif strings.Compare(text, \"y\") == 0 { \n    fmt.Println(\"True\")\n} else {\n    fmt.Println(\"Else\")\n}\n</code></pre>\n\n<p>When I run this code &amp; type <code>y</code> (and press enter) I expect to see <code>True</code> but I get <code>Else</code> - can anyone see why?</p>\n"}, {"tags": ["for-loop", "dictionary", "go", "foreach", "concurrency"], "comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1478418910, "post_id": 40442846, "comment_id": 68140343, "body": "According to this maps can have multiple concurrent readers - no writes. (<a href=\"https://groups.google.com/forum/#!msg/golang-nuts/HpLWnGTp-n8/hyUYmnWJqiQJ\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!msg/golang-nuts/HpLWnGTp-n8/&hellip;</a>)"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1478439214, "post_id": 40442846, "comment_id": 68145167, "body": "Of course, the very first paragraph I posted says as much.  That does not answer my question.   I need to know if the entire body section of the <code>for-range</code> statement is considered a &quot;read&quot;, or just the start/ends of the iterations of that loop.   Please do look at my code above."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1478500532, "post_id": 40442846, "comment_id": 68163398, "body": "I did look. And I wasn&#39;t sure. That&#39;s why I just put a comment for then going &amp; investigating - and I&#39;ve found what&#39;s described in second answer."}], "answers": [{"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478448093, "post_id": 40450876, "comment_id": 68148032, "body": "Reading from my buffered bool channel &quot;locks&quot; the critical.  Writing to it &quot;unlocks&quot; - I am not locking after the read."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478448195, "post_id": 40450876, "comment_id": 68148057, "body": "The question is if iterations - specifically what parts of the iteration loop - count as &quot;reads&quot; or not wrt map concurrency.   Now, from what you pasted:  &quot; If map entries that have not yet been reached are removed during iteration, the corresponding iteration values will not be produced. If map entries are created during iteration, that entry may be produced during the iteration or may be skipped&quot; - it sounds like /none/ of the iteration process is a read, and it is explicitly threadsafe (in so far as operations are atomic and have well-defined semantics)."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478448287, "post_id": 40450876, "comment_id": 68148106, "body": "But, your claim that the &quot;fatal error&quot; is produced contradicts this.   So, my question still stands - when or at what point in a map iteration is the map &quot;read&quot;?   (If your first code example - and mine - are valid, the answer is &quot;only the start/end of the loop cycle implies a map read&quot;.  I think this is probably the case!  But I do not see this stated explicitly, anywhere.   I want to be certain.)"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478454504, "post_id": 40450876, "comment_id": 68150335, "body": "@BadZen: Your code doesn&#39;t compile and doesn&#39;t run: <a href=\"http://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example.</a>."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478455019, "post_id": 40450876, "comment_id": 68150526, "body": "@BadZen: Iteration values are produced for each iteration."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 1, "creation_date": 1478464099, "post_id": 40450876, "comment_id": 68153697, "body": "There isn&#39;t an MCVE because there isn&#39;t an unexpected behavior I&#39;m saying.   I&#39;m asking a conceptual question about Go map concurrency.   Just for you though:  <a href=\"https://play.golang.org/p/ZkWWvZZ2sv\" rel=\"nofollow noreferrer\">play.golang.org/p/ZkWWvZZ2sv</a>"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478464156, "post_id": 40450876, "comment_id": 68153718, "body": "&quot;Iteration values are produced for each iteration&quot; does not answer the question of if the entire lifetime of a for/range is considered a read or just the start/end of the loop body each cycle.  Again, that is what I am asking."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1478447026, "last_edit_date": 1478447026, "creation_date": 1478445055, "answer_id": 40450876, "question_id": 40442846, "link": "https://stackoverflow.com/questions/40442846/concurrent-access-to-maps-with-range-in-go/40450876#40450876", "title": "Concurrent access to maps with &#39;range&#39; in Go", "body": "<p>The unit of concurrent access for a <code>for</code> <code>range</code> loop over a <code>map</code> is the map. <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow noreferrer\">Go maps in action</a>.</p>\n\n<p>A map is a dynamic data structure that changes for inserts, updates and deletes.  <a href=\"https://www.youtube.com/watch?v=Tl7mi9QmLns\" rel=\"nofollow noreferrer\">Inside the Map Implementation</a>. For example,</p>\n\n<blockquote>\n  <p>The iteration order over maps is not specified and is not guaranteed\n  to be the same from one iteration to the next. If map entries that\n  have not yet been reached are removed during iteration, the\n  corresponding iteration values will not be produced. If map entries\n  are created during iteration, that entry may be produced during the\n  iteration or may be skipped. The choice may vary for each entry\n  created and from one iteration to the next. If the map is nil, the\n  number of iterations is 0. <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow noreferrer\">For statements, The Go Programming\n  Language Specification</a></p>\n</blockquote>\n\n<p>Reading a map with a <code>for</code> <code>range</code> loop with interleaved inserts, updates and deletes is unlikely to be useful.</p>\n\n<p>Lock the map:</p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n)\n\nvar racer map[int]int\n\nvar race sync.RWMutex\n\nfunc Reader() {\n    race.RLock() // Lock map\n    for k, v := range racer {\n        _, _ = k, v\n    }\n    race.RUnlock()\n}\n\nfunc Write() {\n    for i := 0; i &lt; 1e6; i++ {\n        race.Lock()\n        racer[i/2] = i\n        race.Unlock()\n    }\n}\n\nfunc main() {\n    racer = make(map[int]int)\n    Write()\n    go Write()\n    Reader()\n}\n</code></pre>\n\n<p>Don't lock after the read -- <code>fatal error: concurrent map iteration and map write</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n)\n\nvar racer map[int]int\n\nvar race sync.RWMutex\n\nfunc Reader() {\n    for k, v := range racer {\n        race.RLock() // Lock after read\n        _, _ = k, v\n        race.RUnlock()\n    }\n}\n\nfunc Write() {\n    for i := 0; i &lt; 1e6; i++ {\n        race.Lock()\n        racer[i/2] = i\n        race.Unlock()\n    }\n}\n\nfunc main() {\n    racer = make(map[int]int)\n    Write()\n    go Write()\n    Reader()\n}\n</code></pre>\n\n<p>Use the <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">Go Data Race Detector</a>. Read <a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">Introducing the Go Race Detector</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478485850, "post_id": 40456170, "comment_id": 68159556, "body": "Thanks, this answers my question I think. To clear two things up - 1) I am not expecting the&quot;concurrent modification&quot; to never happen in my code - of course it can /will!  I am expecting the error to be handled without a concurrent read/write fatal error or possible race condition (ie.  well-defined &quot;fail fast&quot; semantics)  &quot;Come, modify the map now if you dare!&quot; is exactly right - this is probably not idiomatic in Go but is very much the way Java maps work.  The iterator must detect another thread taking up the dare and refuse to emit any more iterated values, because the iterator is &quot;broken&quot;."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478485988, "post_id": 40456170, "comment_id": 68159589, "body": "Second, I definitely &quot;unlock&quot; before returning the error.   The way I use the buffered bool channel there, the read &quot;locks&quot; and the write &quot;unlocks&quot;.  When the <code>iteratorChannel &lt;- k</code> is blocked, the critical section is unlocked, since <code>testMapLock &lt;- true</code> already unlocked the critical - other goroutines may then modify the map and &quot;break&quot; all of the &quot;open&quot; iterators.   This is exactly the behavior I want."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478487102, "post_id": 40456170, "comment_id": 68159833, "body": "To be clear:  &quot;do you think the map is read by the fo/range statement between t1 and t2&quot; - that&#39;s the crux of this.  I want to make sure the answer is &quot;no&quot;.   One can see many ways that what you are calling the &quot;pointer&quot; to the map (a C-implemented <code>hash_iter*</code>, really) carries state that may be corrupted / produce undefined behavior, if you look at <code>hashmap.c</code>.  Add to that the weirdness of /the runtime trying to detect concurrent r/w/ - of course all kinds of complexities here.  I want to know I&#39;ll always see my &quot;concurrent modification&quot; and never a segfault or that &quot;fatal error&quot;."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478487223, "post_id": 40456170, "comment_id": 68159851, "body": "(the race cond analyzer on my code has always run cleanly - or of course I wouldn&#39;t have even posted this question!  but just because it runs cleanly doesn&#39;t mean there is not an undetected possible race condition.   I need the specification (or a v. painful code audit of Go source) to assure me there isn&#39;t.  The race detector is best-effort, and not exact.)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 1, "creation_date": 1478508598, "post_id": 40456170, "comment_id": 68167015, "body": "@BadZen <i>&quot;Second, I definitely &quot;unlock&quot; before returning the error.&quot;</i> I don&#39;t think you do. As you wrote, <i>the read &quot;locks&quot; and the write &quot;unlocks&quot;</i>. Inside your <code>for</code>, you first write (unlock), then you do something (deliver <code>k</code>), then you read (lock). After the lock you test something with <code>if</code>, and if condition is <code>true</code>, you return without unlocking. This seems to me in case of error your last action is &quot;lock&quot;, so it remains locked."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478522500, "post_id": 40456170, "comment_id": 68175092, "body": "Oh, I see what you are saying.   That&#39;s correct.   Yeah.  I&#39;ll fix in an edit above."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478523159, "post_id": 40456170, "comment_id": 68175521, "body": "@BadZen Added a &quot;Final thoughts&quot; section. Also note that if no error is detected, your <code>IterateMapKeys()</code> function again will return having the map locked, so as suggested in my answer, you should really use a <code>defer</code> unlocking at the beginning of your function after you successfully locked it, and then it won&#39;t matter if you return &quot;early&quot; due to an error, or if the <code>for</code> loop completes successfully (or even if your code panics \u2013 defer will run and unlock the map before it returns)."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478524043, "post_id": 40456170, "comment_id": 68176122, "body": "Yeah.   Global var channels are not a great way to lock this, I was just trying to come up with a &quot;simple&quot; example - there are higher-level concurrency interfaces in my actual code.  The problem with the defer pattern is that it will also run if the code exits while unlocked by iterator (say caller closes the iteratorChannel) and that might erroneously unlock - an execution path that did not enter the critical section would exit it.   (FYI, the problem for me with RWMutex is you can&#39;t timed-wait on it - or get condition variable / notify functionality.)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478525049, "post_id": 40456170, "comment_id": 68176779, "body": "@BadZen You&#39;re right. Then in your case it might be better not to use <code>defer</code> (but then you have to unlock after the <code>for</code>); or you may still use <code>defer</code> and perform a non-blocking send in it (using a <code>select</code> + <code>default</code> branch), so if somehow the code panicked when the map was unlocked, the non-blocking send will be a no-op."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478525460, "post_id": 40456170, "comment_id": 68177027, "body": "I did a <code>select</code> at first above, actually - then realized that it didn&#39;t fix the problem - a second iterator might have already locked at  the point the defer enters.  Some additional state is necessary (I have re-entrant mutexes with &quot;keys&quot; in the actual thing - since there is nothing analogous to a &#39;thread id&#39;... key &lt;a&gt; only unlocks / decrs lock counter if mutex is currently locked by &lt;a&gt;, etc...)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478525641, "post_id": 40456170, "comment_id": 68177143, "body": "@BadZen If you have / need re-entrant locks, that warrants for a refactoring. See related question: <a href=\"http://stackoverflow.com/questions/14670979/recursive-locking-in-go\">Recursive locking in Go</a>"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478525976, "post_id": 40456170, "comment_id": 68177358, "body": "I&#39;ve heard this &quot;recursive mutexes are always un-necessary&quot; argument and frankly think it&#39;s bizarre in the extreme.   While there are in fact well documented anti-patterns and pitfalls (often these result in possible deadlock), they definitely have a place and proper use.   (Turn the argument in that Q on its head: &#39;if they weren&#39;t necessary, they wouldn&#39;t have been added to every other major concurrent language...&#39;)  Like a lot of other &quot;&lt;X&gt; is always bad&quot; rules in programming, it should be softened to &quot;&lt;X&gt; needs to be carefully considered&quot;.   This is a discussion for another time, though..."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478526169, "post_id": 40456170, "comment_id": 68177475, "body": "To make a finer point, the argument&#39;s summary there is &quot;Recursive mutexes do not protect invariants. Mutexes have only one job, and recursive mutexes don&#39;t do it.&quot;.   In reality, it&#39;s &quot;recursive mutexes do not protect invariants with improper use&quot;, and &quot;Mutexes have only one job&quot; is completely bogus.  (Or circular/semantic reasoning, at best...)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 15, "last_activity_date": 1536010120, "last_edit_date": 1536010120, "creation_date": 1478478596, "answer_id": 40456170, "question_id": 40442846, "link": "https://stackoverflow.com/questions/40442846/concurrent-access-to-maps-with-range-in-go/40456170#40456170", "title": "Concurrent access to maps with &#39;range&#39; in Go", "body": "<p>You are using a <code>for</code> statement with a <code>range</code> expression. Quoting from <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"noreferrer\">Spec: For statements:</a></p>\n\n<blockquote>\n  <p><strong>The range expression is evaluated once before beginning the loop</strong>, with one exception: if the range expression is an array or a pointer to an array and at most one iteration variable is present, only the range expression's length is evaluated; if that length is constant, <a href=\"https://golang.org/ref/spec#Length_and_capacity\" rel=\"noreferrer\">by definition</a> the range expression itself will not be evaluated.</p>\n</blockquote>\n\n<p>We're ranging over a map, so it's not an exception: the range expression is evaluated only once before beginning the loop. The range expression is simply a map variable <code>testMap</code>:</p>\n\n<pre><code>for k, _ := range testMap {}\n</code></pre>\n\n<p>The map value does not include the key-value pairs, it only <em>points</em> to a data structure that does. Why is this important? Because the map value is only evaluated once, and if later pairs are added to the map, the map value \u2013evaluated once before the loop\u2013 will be a map that still points to a data structure that includes those new pairs. This is in contrast to ranging over a slice (which would be evaluated once too), which is also only a header pointing to a backing array holding the elements; but if elements are added to the slice during the iteration, <em>even</em> if that does not result in allocating and copying over to a new backing array, they will not be included in the iteration (because the slice header also contains the length - already evaluated). Appending elements to a slice may result in a new slice value, but adding pairs to a map will not result in a new map value.</p>\n\n<p>Now on to iteration:</p>\n\n<pre><code>for k, v := range testMap {\n    t1 := time.Now()\n    someFunction()\n    t2 := time.Now()\n}\n</code></pre>\n\n<p>Before we enter into the block, before the <code>t1 := time.Now()</code> line <code>k</code> and <code>v</code> variables are holding the values of the iteration, they are <em>already read out</em> from the map (else they couldn't hold the values). Question: do you think the map is read by the <code>for ... range</code> statement <em>between</em> <code>t1</code> and <code>t2</code>? Under what circumstances could that happen? We have here a <em>single</em> goroutine that is executing <code>someFunc()</code>. To be able to <em>access</em> the map by the <code>for</code> statement, that would either require <em>another</em> goroutine, or it would require to <em>suspend</em> <code>someFunc()</code>. Obviously neither of those happen. (The <code>for ... range</code> construct is not a multi-goroutine monster.) No matter how many iterations there are, <strong>while <code>someFunc()</code> is executed, the map is not accessed by the <code>for</code> statement</strong>.</p>\n\n<p>So to answer one of your questions: the map is not accessed inside the <code>for</code> block when executing an iteration, but it is accessed when the <code>k</code> and <code>v</code> values are set (assigned) for the next iteration. This implies that the following iteration over the map is <em>safe for concurrent access</em>:</p>\n\n<pre><code>var (\n    testMap         = make(map[int]int)\n    testMapLock     = &amp;sync.RWMutex{}\n)\n\nfunc IterateMapKeys(iteratorChannel chan int) error {\n    testMapLock.RLock()\n    defer testMapLock.RUnlock()\n    for k, v := range testMap {\n        testMapLock.RUnlock()\n        someFunc()\n        testMapLock.RLock()\n        if someCond {\n            return someErr\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>Note that unlocking in <code>IterateMapKeys()</code> should (must) happen as a deferred statement, as in your original code you may return \"early\" with an error, in which case you didn't unlock, which means the map remained locked! (Here modeled by <code>if someCond {...}</code>).</p>\n\n<p>Also note that this type of locking only ensures locking in case of concurrent access. <strong>It does not prevent a concurrent goroutine to modify (e.g. add a new pair) the map.</strong> The modification (if properly guarded with write lock) will be safe, and the loop may continue, but there is no guarantee that the for loop will iterate over the new pair:</p>\n\n<blockquote>\n  <p>If map entries that have not yet been reached are removed during iteration, the corresponding iteration values will not be produced. If map entries are created during iteration, that entry may be produced during the iteration or may be skipped. The choice may vary for each entry created and from one iteration to the next.</p>\n</blockquote>\n\n<p>The write-lock-guarded modification may look like this:</p>\n\n<pre><code>func WriteTestMap(k, v int) {\n    testMapLock.Lock()\n    defer testMapLock.Unlock()\n    testMap[k] = v\n}\n</code></pre>\n\n<p>Now if you release the read lock in the block of the <code>for</code>, a concurrent goroutine is free to grab the write lock and make modifications to the map. In your code:</p>\n\n<pre><code>testMapLock &lt;- true\niteratorChannel &lt;- k\n&lt;-testMapLock\n</code></pre>\n\n<p>When sending <code>k</code> on the <code>iteratorChannel</code>, a concurrent goroutine may modify the map. This is not just an \"unlucky\" scenario, sending a value on a channel is often a \"blocking\" operation, if the channel's buffer is full, another goroutine must be ready to receive in order for the send operation to proceed. Sending a value on a channel is a good scheduling point for the runtime to run other goroutines even on the same OS thread, not to mention if there are multiple OS threads, of which one may already be \"waiting\" for the write lock in order to carry out a map modification.</p>\n\n<p>To sum the last part: you releasing the read lock inside the <code>for</code> block is like yelling to others: \"Come, modify the map now if you dare!\" Consequently in your code encountering that <code>mySeq != testMapSequence</code> is very likely. See this runnable example to demonstrate it (it's a variation of your example):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"sync\"\n)\n\nvar (\n    testMap         = make(map[int]int)\n    testMapLock     = &amp;sync.RWMutex{}\n    testMapSequence int\n)\n\nfunc main() {\n    go func() {\n        for {\n            k := rand.Intn(10000)\n            WriteTestMap(k, 1)\n        }\n    }()\n\n    ic := make(chan int)\n    go func() {\n        for _ = range ic {\n        }\n    }()\n\n    for {\n        if err := IterateMapKeys(ic); err != nil {\n            fmt.Println(err)\n        }\n    }\n}\n\nfunc WriteTestMap(k, v int) {\n    testMapLock.Lock()\n    defer testMapLock.Unlock()\n    testMap[k] = v\n    testMapSequence++\n}\n\nfunc IterateMapKeys(iteratorChannel chan int) error {\n    testMapLock.RLock()\n    defer testMapLock.RUnlock()\n    mySeq := testMapSequence\n    for k, _ := range testMap {\n        testMapLock.RUnlock()\n        iteratorChannel &lt;- k\n        testMapLock.RLock()\n        if mySeq != testMapSequence {\n            //close(iteratorChannel)\n            return fmt.Errorf(\"concurrent modification %d\", testMapSequence)\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>Example output:</p>\n\n<pre><code>concurrent modification 24\nconcurrent modification 41\nconcurrent modification 463\nconcurrent modification 477\nconcurrent modification 482\nconcurrent modification 496\nconcurrent modification 508\nconcurrent modification 521\nconcurrent modification 525\nconcurrent modification 535\nconcurrent modification 541\nconcurrent modification 555\nconcurrent modification 561\nconcurrent modification 565\nconcurrent modification 570\nconcurrent modification 577\nconcurrent modification 591\nconcurrent modification 593\n</code></pre>\n\n<p>We're encountering concurrent modification quite often!</p>\n\n<p>Do you want to avoid this kind of concurrent modification? The solution is quite simple: don't release the read lock inside the <code>for</code>. Also run your app with the <code>-race</code> option to detect race conditions: <code>go run -race testmap.go</code></p>\n\n<p><strong>Final thoughts</strong></p>\n\n<p>The language spec clearly allows you to modify the map <em>in the same goroutine</em> while ranging over it, this is what the previous quote relates to (<em>\"If map entries that have not yet been reached are removed during iteration.... If map entries are created during iteration...\"</em>). Modifying the map in the same goroutine is allowed and is safe, but how it is handled by the iterator logic is not defined.</p>\n\n<p>If the map is modified in another goroutine, if you use proper synchronization, <a href=\"https://golang.org/ref/mem\" rel=\"noreferrer\">The Go Memory Model</a> guarantees that the goroutine with the <code>for ... range</code> will observe all modifications, and the iterator logic will see it just as if \"its own\" goroutine would have modified it \u2013 which is allowed as stated before.</p>\n"}], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9411, "favorite_count": 4, "accepted_answer_id": 40456170, "answer_count": 2, "score": 17, "last_activity_date": 1536010120, "creation_date": 1478377535, "last_edit_date": 1495541629, "question_id": 40442846, "link": "https://stackoverflow.com/questions/40442846/concurrent-access-to-maps-with-range-in-go", "title": "Concurrent access to maps with &#39;range&#39; in Go", "body": "<p>The \"<a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"noreferrer\">Go maps in action</a>\" entry in the Go blog states: </p>\n\n<blockquote>\n  <p>Maps are not safe for concurrent use: it's not defined what happens when you read and write to them simultaneously. If you need to read from and write to a map from concurrently executing goroutines, the accesses must be mediated by some kind of synchronization mechanism. One common way to protect maps is with sync.RWMutex.</p>\n</blockquote>\n\n<p>However, one common way to access maps is to iterate over them with the <code>range</code> keyword. It is not clear if for the purposes of concurrent access, execution inside a <code>range</code> loop is a \"read\", or just the \"turnover\" phase of that loop.  For example, the following code may or may not run afoul of the \"no concurrent r/w on maps\" rule, depending on the specific semantics / implementation of the <code>range</code> operation:</p>\n\n<pre><code> var testMap map[int]int\n testMapLock := make(chan bool, 1)\n testMapLock &lt;- true\n testMapSequence := 0\n</code></pre>\n\n<p>...</p>\n\n<pre><code> func WriteTestMap(k, v int) {\n    &lt;-testMapLock\n    testMap[k] = v\n    testMapSequence++\n    testMapLock&lt;-true\n }\n\n func IterateMapKeys(iteratorChannel chan int) error {\n    &lt;-testMapLock\n    defer func() { \n       testMapLock &lt;- true\n    }\n    mySeq := testMapSequence\n    for k, _ := range testMap {\n       testMapLock &lt;- true\n       iteratorChannel &lt;- k\n       &lt;-testMapLock\n       if mySeq != testMapSequence {\n           close(iteratorChannel)\n           return errors.New(\"concurrent modification\")\n       }\n    }\n    return nil\n }\n</code></pre>\n\n<p>The idea here is that the <code>range</code> \"iterator\" is open when the second function is waiting for a consumer to take the next value, and the writer is not blocked at that time.   However, it is never the case that two reads in a single iterator are on either side of a write - this is a \"fail fast\" iterator, the borrow a Java term.</p>\n\n<p>Is there anything anywhere in the language specification or other documents that indicates if this is a legitimate thing to do, however?   I could see it going either way, and the above quoted document is not clear on exactly what consititutes a \"read\". The documentation seems totally quiet on the concurrency aspects of the <code>for</code>/<code>range</code> statement. </p>\n\n<p>(Please note this question is about the currency of <code>for/range</code>, but not a duplicate of: <a href=\"https://stackoverflow.com/questions/34080734/golang-concurrent-map-access-with-range\">Golang concurrent map access with range</a> - the use case is completely different and I am asking about the precise locking requirement wrt the 'range' keyword here!)</p>\n"}, {"tags": ["go", "sqlite"], "comments": [{"owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "edited": false, "score": 0, "creation_date": 1478354210, "post_id": 40437057, "comment_id": 68125135, "body": "I see the question was downvoted. Could anybody please explain why?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1478373671, "post_id": 40437057, "comment_id": 68131072, "body": "I didn&#39;t downvote, but I am wondering what a Model&#39;s role here is. I could see it used as an abstract class in an object-oriented language, but I don&#39;t see how it would be useful as anything other that. What exactly does a Model do?"}, {"owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "edited": false, "score": 0, "creation_date": 1478374316, "post_id": 40437057, "comment_id": 68131260, "body": "@ChronoKitsune, perhaps I wasn&#39;t clear enough. I don&#39;t want to create an abstract class. I&#39;ve updated the code sample in the question, please, take a look. I have several structs. And have very similar functions and methods to get data from the DB. Each such function has identical structure but different <i>query string</i> and different <i>type</i>. So I think these funcs don&#39;t have to be different funcs, they could be the only set of CRUD funcs but with different variables. But I&#39;m stuck in implementing this."}, {"owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "edited": false, "score": 0, "creation_date": 1478378745, "post_id": 40437057, "comment_id": 68132571, "body": "@ChronoKitsune, when I was answering you the post had been deleted. Don&#39;t know who and why."}], "answers": [{"tags": [], "owner": {"reputation": 7537, "user_id": 4263818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AzSa2.jpg?s=128&g=1", "display_name": "R Menke", "link": "https://stackoverflow.com/users/4263818/r-menke"}, "is_accepted": false, "score": 0, "last_activity_date": 1478385052, "creation_date": 1478385052, "answer_id": 40443919, "question_id": 40437057, "link": "https://stackoverflow.com/questions/40437057/how-to-implement-basic-crud-actions-for-any-model-in-golang/40443919#40443919", "title": "How to implement basic CRUD actions for any model in Golang?", "body": "<p>I haven't tested this, but it should work. If you receive the table and column names (or you know them) for each request and you can just fetch from the db as <code>interface</code> passing the table and column as variables.</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"errors\"\n    \"fmt\"\n\n    \"github.com/jmoiron/sqlx\"\n)\n\nfunc selectAll(table string) string {\n    return fmt.Sprintf(\"SELECT * FROM %s\", table)\n}\n\nfunc selectWhere(table string, column string) string {\n    return fmt.Sprintf(\"SELECT * FROM %s WHERE %s = ?\", table, column)\n}\n\nfunc validTableStr(table string) bool {\n    // real validation here\n    return true\n}\n\nfunc validColumnStr(table string, column string) bool {\n    // real validation here\n    return true\n}\n\nfunc GetAll(db *sqlx.DB, table string) ([]interface{}, error) {\n\n    if !validTableStr(table) {\n        return nil, errors.New(\"invalid table name\")\n    }\n\n    items := []interface{}{}\n    err := db.Select(&amp;items, selectAll(table))\n    return items, err\n}\n\nfunc GetWhere(db *sqlx.DB, table string, column string, value interface{}) ([]interface{}, error) {\n\n    if !validTableStr(table) {\n        return nil, errors.New(\"invalid table name\")\n    }\n\n    if !validColumnStr(table, column) {\n        return nil, errors.New(\"invalid column name\")\n    }\n\n    items := []interface{}{}\n    err := db.Select(&amp;items, selectWhere(table, column), value)\n    return items, err\n}\n</code></pre>\n"}], "owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 633, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1478385052, "creation_date": 1478341138, "last_edit_date": 1478374046, "question_id": 40437057, "link": "https://stackoverflow.com/questions/40437057/how-to-implement-basic-crud-actions-for-any-model-in-golang", "title": "How to implement basic CRUD actions for any model in Golang?", "body": "<p>I'm implementing a database API. I have models. I need to implement CRUD actions to each model. For now I create an individual <code>GetAllModels</code> function and <code>Get</code> method for each model. How could I do that once for all models and just pass around some variables if needed?</p>\n\n<p>The pattern below I use for each model:</p>\n\n<pre><code>type City struct {\n    Attr1 string\n    Attr2 string\n}\n\ntype Country struct {\n    Attr1 string\n    Attr2 string\n}\n\nfunc GetAllCities(db *sqlx.DB) ([]*City, error) {\n    items := []*City{}\n    err := db.Select(&amp;items, \"SELECT * FROM cities\")\n    // check err\n    return items, nil\n}\n\nfunc (m *City) Get(db *sqlx.DB, id string) error {\n    if err := db.Get(m, \"SELECT FROM cities WHERE id = ?\", id); err != nil {\n        return err\n    }\n    return nil\n}\n\nfunc GetAllCountries(db *sqlx.DB) ([]*Country, error) {\n    items := []*Country{}\n    err := db.Select(&amp;items, \"SELECT * FROM countries\")\n    // check err\n    return items, nil\n}\n\nfunc (m *Country) Get(db *sqlx.DB, id string) error {\n    if err := db.Get(m, \"SELECT FROM countries WHERE id = ?\", id); err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>But what actually changes from model to model is a <em>query string</em> and a <em>type</em> of slice objects.</p>\n\n<p>How to make one universal <code>GetAll</code> function and <code>Get</code> method for all future models?</p>\n"}, {"tags": ["regex", "go", "capture-group"], "comments": [{"owner": {"reputation": 7975, "user_id": 3836111, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/bc8e3526756540925b0536455b280205?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian Proske", "link": "https://stackoverflow.com/users/3836111/sebastian-proske"}, "edited": false, "score": 1, "creation_date": 1478326263, "post_id": 40435274, "comment_id": 68118396, "body": "You can repeadetly match a capturing group, but it will only store the last match for that group. I&#39;d say there is no way around first capturing all the nodes in one turn, then split them in a second turn."}, {"owner": {"reputation": 121, "user_id": 962561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c41fed5ba827084b71a9ecad1b23bd1?s=128&d=identicon&r=PG", "display_name": "mindrunner", "link": "https://stackoverflow.com/users/962561/mindrunner"}, "reply_to_user": {"reputation": 7975, "user_id": 3836111, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/bc8e3526756540925b0536455b280205?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian Proske", "link": "https://stackoverflow.com/users/3836111/sebastian-proske"}, "edited": false, "score": 0, "creation_date": 1478326934, "post_id": 40435274, "comment_id": 68118492, "body": "Thanks. I guess that will save me some brain wracking. Cheers!"}], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 962561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c41fed5ba827084b71a9ecad1b23bd1?s=128&d=identicon&r=PG", "display_name": "mindrunner", "link": "https://stackoverflow.com/users/962561/mindrunner"}, "edited": false, "score": 0, "creation_date": 1478442292, "post_id": 40442229, "comment_id": 68146179, "body": "You are correct. Changing the regex is actually the better solution. Thank you for this code. I will sure keep it for future reference."}], "tags": [], "owner": {"reputation": 2714, "user_id": 752297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/lDqC1.jpg?s=128&g=1", "display_name": "ripat", "link": "https://stackoverflow.com/users/752297/ripat"}, "is_accepted": true, "score": 5, "last_activity_date": 1478420959, "last_edit_date": 1592644375, "creation_date": 1478373537, "answer_id": 40442229, "question_id": 40435274, "link": "https://stackoverflow.com/questions/40435274/how-to-capture-multiple-repeated-groups-with-regular-expressions/40442229#40442229", "title": "How to capture &#39;multiple&#39; repeated groups with Regular Expressions", "body": "<p>If you want to capture the group name and all possible node names, you should work with a different regex pattern. This one should capture all of them in one go. No need to work with named capture groups but you can if you want to.</p>\n<pre><code>hostGroupExp := regexp.MustCompile(`host_group_([[:alnum:]]+)|([[:alnum:]]+) `)\n\nhostGroupLine := &quot;host_group_lbnorth = ( lba050 lbhou002 lblon003 )&quot;\nhostGroupMatch := hostGroupExp.FindAllStringSubmatch(hostGroupLine, -1)\n\nfmt.Printf(&quot;GroupName: %s\\n&quot;, hostGroupMatch[0][1])\nfor i := 1; i &lt; len(hostGroupMatch); i++ {\n    fmt.Printf(&quot;  Node: %s\\n&quot;, hostGroupMatch[i][2])\n}\n</code></pre>\n<p>See it in action in <a href=\"https://play.golang.org/p/k4qUc-Qw4y\" rel=\"noreferrer\" title=\"playground\">playground</a></p>\n<h3>Alternative:</h3>\n<p>You can also work the way <a href=\"https://www.gnu.org/software/gawk/manual/gawk.html\" rel=\"noreferrer\">awk</a> would do the parsing: use a regexp expression to split the lines in tokens and print the tokens you need. Of course the line layout should be the same as the one given in your example.</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;regexp&quot;\n)\n\nfunc printGroupName(tokens []string) {\n    fmt.Printf(&quot;GroupName: %s\\n&quot;, tokens[2])\n    for i := 5; i &lt; len(tokens)-1; i++ {\n        fmt.Printf(&quot;  Node: %s\\n&quot;, tokens[i])\n    }\n}\n\nfunc main() {\n\n    // regexp line splitter (either _ or space)\n    r := regexp.MustCompile(`_| `)\n\n    // lines to parse\n    hostGroupLines := []string{\n        &quot;host_group_lbnorth = ( lba050 lbhou002 lblon003 )&quot;,\n        &quot;host_group_web = ( web44 web125 )&quot;,\n        &quot;host_group_web = ( web44 )&quot;,\n        &quot;host_group_lbnorth = ( )&quot;,\n    }\n\n    // split lines on regexp splitter and print result\n    for _, line := range hostGroupLines {\n        hostGroupMatch := r.Split(line, -1)\n        printGroupName(hostGroupMatch)\n    }\n\n}\n</code></pre>\n<p>See it in action in <a href=\"https://play.golang.org/p/0A1V-d3YrL\" rel=\"noreferrer\">playground</a></p>\n"}], "owner": {"reputation": 121, "user_id": 962561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c41fed5ba827084b71a9ecad1b23bd1?s=128&d=identicon&r=PG", "display_name": "mindrunner", "link": "https://stackoverflow.com/users/962561/mindrunner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5652, "favorite_count": 0, "accepted_answer_id": 40442229, "answer_count": 1, "score": 4, "last_activity_date": 1565937262, "creation_date": 1478325643, "last_edit_date": 1565937262, "question_id": 40435274, "link": "https://stackoverflow.com/questions/40435274/how-to-capture-multiple-repeated-groups-with-regular-expressions", "title": "How to capture &#39;multiple&#39; repeated groups with Regular Expressions", "body": "<p>I have the following text file I would like to parse out to get the individual fields:</p>\n\n<pre><code>host_group_web = ( )\nhost_group_lbnorth = ( lba050 lbhou002 lblon003 )\n</code></pre>\n\n<p>The fields that I would like to extract are in bold</p>\n\n<ul>\n<li>host_group_<strong>web</strong> = ( )</li>\n<li>host_group_<strong>lbnorth</strong> = ( <strong>lba505</strong> <strong>lbhou002</strong> <strong>lblon003</strong> )</li>\n</ul>\n\n<p>host_group_web has no items in between the <strong>( )</strong>, so that portion would be ignored</p>\n\n<p>I've named the first group as <strong>nodegroup</strong> and the items in between the () as <strong>nodes</strong></p>\n\n<p>I am reading the file line by line, and storing the results for further processing.</p>\n\n<p>In Golang, This is the snippet of Regex I am using:</p>\n\n<pre><code>hostGroupLine := \"host_group_lbnorth = ( lba050 lbhou002 lblon003 )\"\nhostGroupExp := regexp.MustCompile(`host_group_(?P&lt;nodegroup&gt;[[:alnum:]]+)\\s*=\\s*\\(\\s*(?P&lt;nodes&gt;[[:alnum:]]+\\s*)`)\nhostGroupMatch := hostGroupExp.FindStringSubmatch(hostGroupLine)\n\nfor i, name := range hostGroupExp.SubexpNames() {\n  if i != 0 {\n    fmt.Println(\"GroupName:\", name, \"GroupMatch:\", hostGroupMatch[i])\n  }\n}\n</code></pre>\n\n<p>I get the following output, which is missing the rest of the matches for the <strong>nodes</strong> named group.</p>\n\n<pre><code>GroupName: nodegroup GroupMatch: lbnorth\nGroupName: nodes GroupMatch: lba050\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/oOJ3Ex9aVf\" rel=\"nofollow noreferrer\" title=\"Regex Problem\">The Snippet in Golang Playground</a></p>\n\n<p>My question is, how do I get a Regex in Golang that would match the <strong>nodegroup</strong> and all the <strong>nodes</strong> that maybe in the line, e.g lba050 lbhou002 lblon003.\nThe amount of nodes will vary, from 0 - as many.</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 1, "creation_date": 1478322478, "post_id": 40434959, "comment_id": 68117837, "body": "Yes ! You&#39;re right. it works like expected. I&#39;m sorry i&#39;m currently trying to learn go. Thanks again."}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 3, "last_activity_date": 1478322288, "creation_date": 1478322288, "answer_id": 40434959, "question_id": 40434913, "link": "https://stackoverflow.com/questions/40434913/decoding-a-complex-json-correctly-using-golang/40434959#40434959", "title": "Decoding a complex JSON correctly using Golang", "body": "<p>All your json tags need to be <code>json:\"&lt;name&gt;\"</code>  not <code>json=\"&lt;name&gt;\"</code></p>\n"}], "owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 40434959, "answer_count": 1, "score": 0, "last_activity_date": 1478322925, "creation_date": 1478321799, "last_edit_date": 1478322925, "question_id": 40434913, "link": "https://stackoverflow.com/questions/40434913/decoding-a-complex-json-correctly-using-golang", "title": "Decoding a complex JSON correctly using Golang", "body": "<p>I'm trying to parse a JSON from a URL. But I'm facing a problem while decoding values. Some are correct and the others are nil (empty strings or nil values for float64).</p>\n\n<p>The JSON fetched from the URL is like this:</p>\n\n<pre><code>{\n    \"status\":\"success\", \n    \"data\":{ \n        \"coin\":{ \n            \"name\":\"Bitcoin\",\n            \"abbr\":\"BTC\",\n            \"logo\":\"\",\n            \"homepage\":\"\"\n        },\n        \"volume\":{\n            \"current\":15967300,\n            \"all\":21000000,\n            \"perc\":76.03\n        },\n        \"markets\":{\n            \"btce\":{ \n                \"name\":\"BTC-e\",\n                \"last_update_utc\":\"2016-11-05T01:25:02Z\",\n                \"value\":694.696,\n                \"currency\":\"USD\",\n                \"daily_change\":{\n                    \"value\":\"699.05600000\",\n                    \"perc\":-0.62,\n                    \"diff\":-4.36\n                }\n            },\n            \"coinbase\":{\n                \"name\":\"Coinbase\",\n                \"last_update_utc\":\"2016-11-05T01:25:02Z\",\n                \"value\":705.65,\n                \"currency\":\"USD\",\n                \"daily_change\":{ \n                    \"value\":\"700.87000000\",\n                    \"perc\":0.68000000000001,\n                    \"diff\":4.78\n                }\n            }\n        },\n        \"last_block\":{ \n            \"nb\":437388,\n            \"time_utc\":\"2016-11-05T01:27:32Z\",\n            \"nb_txs\":570,\n            \"fee\":\"0.06545766\",\n            \"difficulty\":\"253618246641.490000000000000\"\n        },\n        \"next_difficulty\":{ \n            \"difficulty\":255675205724.12,\n            \"retarget_in\":84,\n            \"retarget_block\":437472,\n            \"perc\":0.81104538410295\n        },\n        \"websocket\":{\n            \"ws_url\":\"ws:\\/\\/btc.blockr.io:9081\",\n            \"wss_url\":\"wss:\\/\\/btc.blockr.io:8081\"\n        }\n    },\n    \"code\":200,\n    \"message\":\"\"\n}\n</code></pre>\n\n<p>My Go structs are:</p>\n\n<pre><code>type ResponseInfo struct {\n    Status  string  `json:\"status\"`\n    Data    Info    `json:\"data\"`                       \n    Code    float64 `json:\"code\"`\n    Message string  `json:\"message,omitempty\"`\n}\n\ntype Info struct {\n    Coin      _Coin      `json:\"coin\"`                  \n    Volume    _Volume    `json:\"volume\"`                \n    Markets   _Markets   `json:\"markets\"`               \n    LastBlock _LastBlock `json:\"last_block\"`            \n    NextDiff  _NextDiff  `json:\"next_difficulty\"`       \n    WebSocket _WebSocket `json:\"websocket\"`             \n}\n\ntype _Coin struct {\n    Name     string `json:\"name\"`\n    Abbr     string `json:\"abbr\"`\n    Logo     string `json:\"logo\"`\n    HomePage string `json:\"homepage,omitempty\"`\n}\n\ntype _Volume struct {\n    Current float64 `json:\"current\"`\n    All     float64 `json:\"all\"`\n    Perc    float64 `json:\"perc\"`\n}\n\ntype _Markets struct {\n    Btce     _BtceInfo     `json:\"btce\"`                \n    Coinbase _CoinbaseInfo `json:\"coinbase\"`            \n}\n\ntype _BtceInfo struct {\n    Name        string     `json:\"name\"`\n    LastUpdate  string     `json:\"last_update_utc\"`\n    Value       float64    `json:\"value\"`\n    Currency    string     `json:\"currency\"`\n    DailyChange _BtceDaily `json:\"daily_change,omitempty\"`      \n}\n\ntype _BtceDaily struct {\n    Value string  `json:\"value\"`\n    Prec  float64 `json:\"prec\"`\n    Diff  float64 `json:\"diff\"`\n}\n\ntype _CoinbaseInfo struct {\n    Name        string         `json:\"name\"`\n    LastUpdate  string         `json:\"last_update_utc\"`\n    Value       float64        `json:\"value\"`\n    Currency    string         `json:\"currency\"`\n    DailyChange _CoinbaseDaily `json:\"daily_change\"`\n}\n\ntype _CoinbaseDaily struct {\n    Value string `json:\"value\"`\n    Prec  float64 `json:\"prec\"`\n    Diff  float64 `json:\"diff\"`\n}\n\ntype _LastBlock struct {\n    Nb         float64 `json:\"nb\"`\n    Time       string  `json:\"time_utc\"`\n    NbTxs      float64 `json:\"nb_txs\"`\n    Fee        string `json:\"fee\"`\n    Difficulty string `json:\"difficulty\"`\n}\n\ntype _NextDiff struct {\n    Difficulty    float64 `json:\"difficulty\"`\n    RetargetIn    float64 `json:\"retarget_in\"`\n    RetargetBlock float64 `json:\"retarget_block\"`\n    Perc          float64 `json:\"perc\"`\n}\n\ntype _WebSocket struct {\n    Wsurl  string `json:\"ws_url\"`\n    WssUrl string `json:\"wss_url\"`\n}\n</code></pre>\n\n<p>My incorrect output is:</p>\n\n<pre><code>{success {{Bitcoin BTC  } {1.59675375e+07 2.1e+07 76.04} {{BTC-e  694 USD { 0 0}} {Coinbase  704.2 USD { 0 0}}} {0  0  } {0 0 0 0} { }} 200 }\n</code></pre>\n\n<p>Edit1: \nSorry the ouput my change because i'm parsing directly from the URL (<a href=\"http://btc.blockr.io/api/v1/coin/info\" rel=\"nofollow noreferrer\">http://btc.blockr.io/api/v1/coin/info</a>)</p>\n\n<p>Edit2:\nThanks to @John S Perayil who found the mistake.\nMy JSON Tags need to be <code>json:\"&lt;name&gt;\"</code> not <code>json=\"&lt;name&gt;\"</code></p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "compilation"], "answers": [{"comments": [{"owner": {"reputation": 377, "user_id": 6723763, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/1r3OV.gif?s=128&g=1", "display_name": "Rtsne42", "link": "https://stackoverflow.com/users/6723763/rtsne42"}, "edited": false, "score": 0, "creation_date": 1478318450, "post_id": 40434551, "comment_id": 68117357, "body": "Thanks for the answer. When is the temporary executable deleted? Right after the command or at some other time?"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 377, "user_id": 6723763, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/1r3OV.gif?s=128&g=1", "display_name": "Rtsne42", "link": "https://stackoverflow.com/users/6723763/rtsne42"}, "edited": false, "score": 0, "creation_date": 1478318986, "post_id": 40434551, "comment_id": 68117415, "body": "I&#39;m not sure about that. But I&#39;m guessing it would be deleted just after execution ends."}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 1, "last_activity_date": 1478318895, "last_edit_date": 1478318895, "creation_date": 1478317705, "answer_id": 40434551, "question_id": 40434532, "link": "https://stackoverflow.com/questions/40434532/what-happens-to-the-executable-when-using-the-run-command-in-the-go-compiler/40434551#40434551", "title": "What happens to the executable when using the run command in the go compiler?", "body": "<p>A temporary executable is created.\nThe same is the case for go test.</p>\n\n<p>Documentation on <code>go test</code></p>\n\n<p><code>The package is built in a temporary directory so it does not interfere with the non-test installation.</code></p>\n\n<p><a href=\"https://golang.org/cmd/go/\" rel=\"nofollow noreferrer\">Source</a></p>\n\n<p>You can also run <code>fmt.Println(os.Args[0])</code> to see the executable file that is being created.</p>\n"}], "owner": {"reputation": 377, "user_id": 6723763, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/1r3OV.gif?s=128&g=1", "display_name": "Rtsne42", "link": "https://stackoverflow.com/users/6723763/rtsne42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "accepted_answer_id": 40434551, "answer_count": 1, "score": -1, "last_activity_date": 1478318895, "creation_date": 1478317493, "question_id": 40434532, "link": "https://stackoverflow.com/questions/40434532/what-happens-to-the-executable-when-using-the-run-command-in-the-go-compiler", "title": "What happens to the executable when using the run command in the go compiler?", "body": "<p>Using the <code>go build myprogam.go</code> produces an executable file, which is what I'm familiar with when working with compilers.</p>\n\n<p>However, using <code>go run myprogram.go</code> doesn't create any executable files and still runs the program. </p>\n\n<p>How exactly does this work, is the executable created and then deleted or does it run the code like an interpreter would?</p>\n"}, {"tags": ["html", "amazon-web-services", "go", "amazon-s3"], "answers": [{"comments": [{"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1478321073, "post_id": 40434581, "comment_id": 68117689, "body": "I removed the comment when I realized <code>req.SignedHeaderVals.Add</code> isn&#39;t the correct solution.  You&#39;re adding something related to a header -- not a query string parameter -- which is what <code>response-content-disposition</code> is.  <code>ResponseContentDisposition</code> needs to be passed as an argument to <a href=\"https://github.com/aws/aws-sdk-go/blob/master/service/s3/api.go#L7495-L7570\" rel=\"nofollow noreferrer\"><code>GetObjectInput</code></a>.  Feel free to take this info and revise your answer accordingly."}, {"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1478321206, "post_id": 40434581, "comment_id": 68117698, "body": "...assuming you concur.  Docs for <a href=\"http://docs.aws.amazon.com/sdk-for-go/api/service/s3/#GetObjectInput\" rel=\"nofollow noreferrer\">GetObjectInput</a> says this &quot;sets the header of the response&quot; which is potentially misleading.  <i>Requests that S3 override the header in the response to this request</i> would be more precise, if this works the way it seems like it does."}], "tags": [], "owner": {"reputation": 5312, "user_id": 6720449, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x5YGn.jpg?s=128&g=1", "display_name": "Chris Simon", "link": "https://stackoverflow.com/users/6720449/chris-simon"}, "is_accepted": true, "score": 9, "last_activity_date": 1478321905, "last_edit_date": 1478321905, "creation_date": 1478318077, "answer_id": 40434581, "question_id": 40434525, "link": "https://stackoverflow.com/questions/40434525/download-s3-file-with-a-different-filename-than-the-bucket-key/40434581#40434581", "title": "Download S3 file with a different filename than the bucket key", "body": "<p>According to the <a href=\"http://docs.aws.amazon.com/AmazonS3/latest/API/RESTObjectGET.html\" rel=\"noreferrer\">Amazon GET Object Docs</a>, the parameter you need is actually <code>response-content-disposition</code>.</p>\n\n<p>According to the <a href=\"http://docs.aws.amazon.com/sdk-for-go/api/service/s3/#GetObjectInput\" rel=\"noreferrer\">GetObjectInput</a> docs, <code>GetObjectInput</code> has a parameter to set the <code>ResponseContentDisposition</code> value.</p>\n\n<p>Try:</p>\n\n<pre><code>params := &amp;s3.GetObjectInput{\n    Bucket: aws.String(a bucket name),\n    Key:    aws.String(key),\n    ResponseContentDisposition: \"attachment; filename=the filename I want\",\n}\n\nreq, _ := svc.GetObjectRequest(params)\nstr, err := req.Presign(15 * time.Minute)\n</code></pre>\n\n<p>(Note: the usage of <code>SignedHeaderVals</code> is not required).</p>\n\n<p>Thanks to michael for the correction to my original answer.</p>\n"}], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2784, "favorite_count": 0, "accepted_answer_id": 40434581, "answer_count": 1, "score": 0, "last_activity_date": 1478321905, "creation_date": 1478317405, "question_id": 40434525, "link": "https://stackoverflow.com/questions/40434525/download-s3-file-with-a-different-filename-than-the-bucket-key", "title": "Download S3 file with a different filename than the bucket key", "body": "<p>I'm trying to change the name of a file I'm downloading from S3, but it keeps getting the bucket key as filename instead.</p>\n\n<p>I'm using this function to get a Signed URL to download things from my S3 bucket.</p>\n\n<pre><code>func GetFileLink(url, filename string) (string, error) {\n    svc := s3.New(some params)\n\n    params := &amp;s3.GetObjectInput{\n        Bucket: aws.String(a bucket name),\n        Key:    aws.String(key),\n    }\n\n    req, _ := svc.GetObjectRequest(params)\n    req.SignedHeaderVals = make(map[string][]string)\n    req.SignedHeaderVals.Add(\"Content-Disposition\", \"filename=the filename I want\")\n    str, err := req.Presign(15 * time.Minute)\n    if err != nil {\n        global.Log(\"[AWS GET LINK]:\", params, err)\n    }\n\n    return str, err\n}\n</code></pre>\n\n<p>And I'm using this in my HTML file to download the file with another name:</p>\n\n<pre><code>&lt;a href=\"Link given by the function\" download=\"the filename I want\"&gt;Download the file.&lt;/a&gt;\n</code></pre>\n\n<p>But I keep getting the file named as the bucket key. How can I change the name of the file being downloaded?</p>\n"}, {"tags": ["go", "testify"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478308694, "post_id": 40433788, "comment_id": 68116096, "body": "Does <code>-m</code> do what you expect? From the documentation: <code>Regular expression to select the methods of test suites specified command-line argument &quot;-m&quot;</code> maybe combined with <code>-run</code> to specify the suite?"}, {"owner": {"reputation": 7915, "user_id": 494343, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/446b5d6d3a019f8219b5d8102c1d4bbc?s=128&d=identicon&r=PG", "display_name": "Schultz9999", "link": "https://stackoverflow.com/users/494343/schultz9999"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478323548, "post_id": 40433788, "comment_id": 68117998, "body": "According to help, &quot;<code>run</code> is to  - Run only those tests and examples matching the regular expression.&quot; The content of the file only has one test that calls the suite method. So <code>go test</code> after analyzing files may just not find matches if it looks for something like <code>func TestBlah(t *testing.T)</code>..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478444354, "post_id": 40433788, "comment_id": 68146831, "body": "yes, <code>-run</code> picks the <code>Test*</code> function to run, which starts a particular suite, and the <code>-m</code> flag will filter which suite methods to execute."}], "answers": [{"comments": [{"owner": {"reputation": 7915, "user_id": 494343, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/446b5d6d3a019f8219b5d8102c1d4bbc?s=128&d=identicon&r=PG", "display_name": "Schultz9999", "link": "https://stackoverflow.com/users/494343/schultz9999"}, "edited": false, "score": 0, "creation_date": 1478567512, "post_id": 40473895, "comment_id": 68199265, "body": "Interesting. Perhaps <code>TestSuite2&#47;third</code> is the key. I&#39;ll try. Thank you!"}], "tags": [], "owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "is_accepted": false, "score": 2, "last_activity_date": 1478550059, "creation_date": 1478550059, "answer_id": 40473895, "question_id": 40433788, "link": "https://stackoverflow.com/questions/40433788/can-i-run-a-single-test-in-a-suite/40473895#40473895", "title": "Can I run a single test in a suite?", "body": "<p>i think you're SOL with that package but here's a similar approach with go 1.7's stock testing tools:</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc TestSuite1(t *testing.T) {\n    t.Run(\"first test\", func(t *testing.T) { t.Fail() })\n    t.Run(\"second test\", func(t *testing.T) { t.Fail() })\n}\n\nfunc TestSuite2(t *testing.T) {\n    t.Run(\"third test\", func(t *testing.T) { t.Fatal(\"3\") })\n    t.Run(\"fourth test\", func(t *testing.T) { t.Fatal(\"4\") })\n}\n</code></pre>\n\n<p>Example output for one suite:</p>\n\n<pre><code> therealplato/stack-suites \u2126 go test -run TestSuite1       \n--- FAIL: TestSuite1 (0.00s)\n    --- FAIL: TestSuite1/first_test (0.00s)\n    --- FAIL: TestSuite1/second_test (0.00s)\nFAIL\nexit status 1\nFAIL    github.com/therealplato/stack-suites    0.005s\n</code></pre>\n\n<p>Example output for one test:</p>\n\n<pre><code> therealplato/stack-suites \u2126 go test -run TestSuite2/third \n--- FAIL: TestSuite2 (0.00s)\n    --- FAIL: TestSuite2/third_test (0.00s)\n        main_test.go:11: 3\nFAIL\nexit status 1\nFAIL    github.com/therealplato/stack-suites    0.005s\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2047, "user_id": 1171280, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/T1FbP.jpg?s=128&g=1", "display_name": "Alberto Meg&#237;a", "link": "https://stackoverflow.com/users/1171280/alberto-meg%c3%ada"}, "edited": false, "score": 0, "creation_date": 1508188768, "post_id": 43312451, "comment_id": 80504373, "body": "Now the flag has been changed to -m (go version go1.9)"}, {"owner": {"reputation": 822, "user_id": 304627, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c3c7937727245441d3d064072e1cf552?s=128&d=identicon&r=PG", "display_name": "Landon Poch", "link": "https://stackoverflow.com/users/304627/landon-poch"}, "edited": false, "score": 0, "creation_date": 1520031532, "post_id": 43312451, "comment_id": 85163323, "body": "It&#39;s a shame that you can&#39;t just mark a test with .only or something like you can do in other test frameworks."}], "tags": [], "owner": {"reputation": 350, "user_id": 1480906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f54b576c9d6c524b000b55114ac700b?s=128&d=identicon&r=PG", "display_name": "Andy McCall", "link": "https://stackoverflow.com/users/1480906/andy-mccall"}, "is_accepted": false, "score": 15, "last_activity_date": 1498759511, "last_edit_date": 1498759511, "creation_date": 1491775727, "answer_id": 43312451, "question_id": 40433788, "link": "https://stackoverflow.com/questions/40433788/can-i-run-a-single-test-in-a-suite/43312451#43312451", "title": "Can I run a single test in a suite?", "body": "<p>You can run single methods by specifying the <code>-testify.m</code> argument.</p>\n\n<p>to run <a href=\"https://github.com/vektra/mockery/blob/b6f6c13c25c3f0a17724553fa01580f328158d7a/mockery/generator_test.go#L104-L132\" rel=\"noreferrer\">this suite method</a> the command is:</p>\n\n<p><code>go test -v github.com/vektra/mockery/mockery -run ^TestGeneratorSuite$ -testify.m TestGenerator</code></p>\n"}], "owner": {"reputation": 7915, "user_id": 494343, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/446b5d6d3a019f8219b5d8102c1d4bbc?s=128&d=identicon&r=PG", "display_name": "Schultz9999", "link": "https://stackoverflow.com/users/494343/schultz9999"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7744, "favorite_count": 1, "answer_count": 2, "score": 11, "last_activity_date": 1498759511, "creation_date": 1478307850, "question_id": 40433788, "link": "https://stackoverflow.com/questions/40433788/can-i-run-a-single-test-in-a-suite", "title": "Can I run a single test in a suite?", "body": "<p>I have setup a test suite for my struct (<a href=\"https://github.com/stretchr/testify#suite-package\" rel=\"noreferrer\">https://github.com/stretchr/testify#suite-package</a>). Before I was able to run a single test by specifying just a pattern:</p>\n\n<pre><code>go test -v ./services/gateways/... -run mytest\n</code></pre>\n\n<p>This approach doesn't work after conversion. Bad luck or is there a way?</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1478292569, "post_id": 40431396, "comment_id": 68111432, "body": "let&#39;s say you use that slice as a stack that grows and shrinks. you&#39;ve popped the last element from the stack, it&#39;s len is 0. now you push some items to it. performance would be disastrous if we&#39;d need to start allocating and growing the capacity again in that case."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1478294429, "post_id": 40431396, "comment_id": 68112175, "body": "Here&#39;s a use of <code>[:0]</code>: <a href=\"http://stackoverflow.com/a/40234309/1705598\">Write to beginning of the buffer in Golang?</a> Also related: <a href=\"http://stackoverflow.com/a/40036950/1705598\">Concatenate two slices in Go</a>"}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 1, "creation_date": 1478357232, "post_id": 40431396, "comment_id": 68126032, "body": "Great question! The following blog post is also worth reading: <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">blog.golang.org/go-slices-usage-and-internals</a>"}], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 2, "last_activity_date": 1478293432, "last_edit_date": 1478293432, "creation_date": 1478293083, "answer_id": 40431598, "question_id": 40431396, "link": "https://stackoverflow.com/questions/40431396/why-the-slices-capacity-does-not-decrease-with-0/40431598#40431598", "title": "why the slice&#39;s capacity does not decrease with `[:0]`", "body": "<p>The choice to not modify the capacity is likely a performance optimization. Slices are basically 'dynamic arrays', they intend to provide the abstraction that the array's capacity is unlimited. In reality, capacity is of course limited by system memory, however if a slice is at capacity and you <code>append</code> an item to it, Go will allocate new memory for the array to provide that capacity (assuming it's available, if it's not your app will ofc panic).</p>\n\n<p>The length represents the actual indexable item count in the slice, while the capacity tells you how much underlying memory is there. When you do those reslicing operations, there is no immediate need to free the memory and therefor it remains allocated, that is why the slices capacity remains unchanged but the length goes to zero.</p>\n\n<p>Overall, this likely leads to better application performance since the memory is still available should subsequent statements append items to the slice. In practice you generally don't need to worry about capacity. I would recommend keeping it in the back of your mind however.</p>\n\n<p>The times where it's most relevant, imo, is when you're reading data from some source and you know the size of that data, or at least have a rough idea, and you're putting that into a slice. In such a circumstance your application will perform better if you initialize the slice with an appropriate capacity. If you provide no length or capacity arguments (capacity defaults to length if only length is provided) then you may find the default slice growth is fairly inefficient, or at the very least, is introducing inefficiency that can quite easily be avoided.</p>\n"}, {"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 5, "last_activity_date": 1478301617, "creation_date": 1478301617, "answer_id": 40433028, "question_id": 40431396, "link": "https://stackoverflow.com/questions/40431396/why-the-slices-capacity-does-not-decrease-with-0/40433028#40433028", "title": "why the slice&#39;s capacity does not decrease with `[:0]`", "body": "<p>You can actually use the three-index slicing to get the zero-capped slice:</p>\n\n<pre><code>s = s[:0:0]\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/YetCdJVWrB\" rel=\"noreferrer\">https://play.golang.org/p/YetCdJVWrB</a>.</p>\n"}], "owner": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 40431598, "answer_count": 2, "score": 0, "last_activity_date": 1478301617, "creation_date": 1478292166, "question_id": 40431396, "link": "https://stackoverflow.com/questions/40431396/why-the-slices-capacity-does-not-decrease-with-0", "title": "why the slice&#39;s capacity does not decrease with `[:0]`", "body": "<p>I am reading <a href=\"https://tour.golang.org/moretypes/11\" rel=\"nofollow noreferrer\">A Tour of Go</a> and get confused about a slicing case</p>\n\n<pre><code>s = s[:0]\n</code></pre>\n\n<p>After this operation, the <code>len()</code> of <code>s</code> becomes 0 but the <code>cap()</code> does not. Why is the capacity not decreased? When would one want to use this 'feature'?</p>\n"}, {"tags": ["go", "dependency-management", "govendor"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1478292185, "post_id": 40431320, "comment_id": 68111276, "body": "Related blog post: <a href=\"http://dave.cheney.net/2016/06/24/gophers-please-tag-your-releases\" rel=\"nofollow noreferrer\">Dave Cheney: Gophers, please tag your releases</a>"}], "owner": {"reputation": 69, "user_id": 4100624, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1035444390/picture?type=large", "display_name": "Geoffrey Hendrey", "link": "https://stackoverflow.com/users/4100624/geoffrey-hendrey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 662, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1478292214, "creation_date": 1478291753, "last_edit_date": 1478292214, "question_id": 40431320, "link": "https://stackoverflow.com/questions/40431320/why-doesnt-go-vendor-add-work-with-a-revision-number", "title": "Why doesn&#39;t &quot;go vendor add&quot; work with a revision number", "body": "<p>I was getting a compile error which led me to believe that I had the wrong version of a library in my vendor folder. The first task was to determine what revision of the library was correct. I needed to find the version of the library source that contained the string \"VolumeCreateRequest\". For that I used this trick from the root folder of the library:</p>\n\n<pre><code>git rev-list --all | xargs git grep VolumeCreateRequest\n</code></pre>\n\n<p>From that I found the version hash: <code>06f160237426e705ed214a4f087d4aeea32c0a8b</code>:</p>\n\n<p>So then I tried to add that version into my vendor folder\n<code>go vendor add github.com/docker/docker/...@06f160237426e705ed214a4f087d4aeea32c0a8b</code></p>\n\n<p>But it doesn't work. When I check the library's version using git it does <em>not</em> report the version I just fetched. </p>\n\n<pre><code>git log -n 1 --pretty=format:\"%H\"\n</code></pre>\n\n<p>The vendor.json file also contains the wrong version</p>\n\n<p>so what's up? After carefully reading the docs I see go vender <em>add</em> just silently ignores the <code>@06f160237426e705ed214a4f087d4aeea32c0a8b</code> on the end of my fetch URI.</p>\n\n<p>The correct command is go vendor <strong>fetch</strong> which supports the @version</p>\n\n<p><code>govendor fetch  github.com/docker/docker/...@06f160237426e705ed214a4f087d4aeea32c0a8b</code> </p>\n\n<p>Another way to accomplish this is to git checkout the version you want of the library, in your GOPATH (i.e. not in your vendor folder), then <code>govendor add</code> the package from your GOPATH</p>\n\n<p>So now I check the git version and we are all good. Then the next problem occurred. Our generate.go file (invoked by <code>go generate</code>) is going in and overwriting the desired version in my <code>vendor.json</code> with what was on my GOPATH.</p>\n\n<p>The sequence in our <code>generate.go</code> is:</p>\n\n<pre><code>//go:generate govendor add +external\n//go:generate govendor fetch +missing\n//go:generate go vendor sync\n</code></pre>\n\n<p>This turned out to be wrong because the add would overwrite my changes, then the sync is ineffectual because vendor.json already infected with wrong version.</p>\n\n<p>The correct sequence is this:</p>\n\n<pre><code>//go:generate govendor sync\n//go:generate govendor add +external\n//go:generate govendor fetch +missing\n</code></pre>\n\n<p>In this way, your customized vendor.json will sync the vendor folder to what is <em>desired</em> first, and only <em>after</em> that will external and missing dependencies be downloaded.</p>\n\n<p>Finally, several dependencies actually would not compile at all do to platform specific stuff. To cure this, I add these lines in generate.go to remove those broken dependencies, <em>after</em> I sync, add, fetch</p>\n\n<pre><code>//go:generate govendor remove github.com/docker/docker/runconfig\n//go:generate govendor remove github.com/docker/docker/libcontainerd\n//go:generate govendor remove github.com/docker/libcompose/test\n//go:generate govendor remove github.com/Microsoft/...\n</code></pre>\n"}, {"tags": ["algorithm", "go", "statistics", "normal-distribution"], "comments": [{"owner": {"reputation": 30659, "user_id": 1210053, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/8cee821e7bf4acaa7f0de12d603b9f1d?s=128&d=identicon&r=PG", "display_name": "Nico Schertler", "link": "https://stackoverflow.com/users/1210053/nico-schertler"}, "edited": false, "score": 0, "creation_date": 1478301423, "post_id": 40430738, "comment_id": 68114480, "body": "I don&#39;t understand your requirements. Could you clarify? What does it mean for an element to be part of a normal distribution? By appending the weight, do you mean simple string concatenation? Maybe you could post an example."}, {"owner": {"reputation": 4034, "user_id": 697364, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d74e445b43c9fcc11524fa8c382409b3?s=128&d=identicon&r=PG", "display_name": "blueblank", "link": "https://stackoverflow.com/users/697364/blueblank"}, "reply_to_user": {"reputation": 30659, "user_id": 1210053, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/8cee821e7bf4acaa7f0de12d603b9f1d?s=128&d=identicon&r=PG", "display_name": "Nico Schertler", "link": "https://stackoverflow.com/users/1210053/nico-schertler"}, "edited": false, "score": 0, "creation_date": 1478350210, "post_id": 40430738, "comment_id": 68123978, "body": "The code isn&#39;t as important as the question &amp; concepts, it is just a crap first pass whack at the concept in something else I&#39;m working on."}, {"owner": {"reputation": 30659, "user_id": 1210053, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/8cee821e7bf4acaa7f0de12d603b9f1d?s=128&d=identicon&r=PG", "display_name": "Nico Schertler", "link": "https://stackoverflow.com/users/1210053/nico-schertler"}, "edited": false, "score": 0, "creation_date": 1478351513, "post_id": 40430738, "comment_id": 68124360, "body": "Is it just about calculating the weights (then use the normal distribution formula with appropriate mean and variance) or about sampling from this distribution (then use a random generator for normal distributions)?"}, {"owner": {"reputation": 4034, "user_id": 697364, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d74e445b43c9fcc11524fa8c382409b3?s=128&d=identicon&r=PG", "display_name": "blueblank", "link": "https://stackoverflow.com/users/697364/blueblank"}, "reply_to_user": {"reputation": 30659, "user_id": 1210053, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/8cee821e7bf4acaa7f0de12d603b9f1d?s=128&d=identicon&r=PG", "display_name": "Nico Schertler", "link": "https://stackoverflow.com/users/1210053/nico-schertler"}, "edited": false, "score": 0, "creation_date": 1478351931, "post_id": 40430738, "comment_id": 68124489, "body": "It is mostly about calculating the weights."}], "answers": [{"tags": [], "owner": {"reputation": 30659, "user_id": 1210053, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/8cee821e7bf4acaa7f0de12d603b9f1d?s=128&d=identicon&r=PG", "display_name": "Nico Schertler", "link": "https://stackoverflow.com/users/1210053/nico-schertler"}, "is_accepted": true, "score": 0, "last_activity_date": 1478352616, "creation_date": 1478352616, "answer_id": 40438797, "question_id": 40430738, "link": "https://stackoverflow.com/questions/40430738/weighting-a-flat-list-to-the-normal-distribution/40438797#40438797", "title": "weighting a flat list to the normal distribution", "body": "<p>If you just want to calculate the weights for a given list, then you need the following things:</p>\n\n<ul>\n<li>The mean of the normal distribution</li>\n<li>The variance of the normal distribution</li>\n<li>A discretizer for the values</li>\n</ul>\n\n<p>The first one is quite simple. You want the mean to be in the center of the list. Therefore (assuming zero-based indexing):</p>\n\n<pre><code>mean = (list.size - 1) / 2\n</code></pre>\n\n<p>The second is kind of arbitrary and depends on how steep you want your weights to fall off. Weights of the normal distribution are practically zero beyond a distance of <code>3 * standard_deviation</code> from the <code>mean</code>. So a good standard deviation in most cases is probably something between a fourth and a sixth list length:</p>\n\n<pre><code>standard_deviation = (1/4 .. 1/6) * list.size\nvariance = standard_deviation^2\n</code></pre>\n\n<p>Assuming that you want integer weights, you need to discretize the weights from the normal distribution. The easiest way to do this is by specifying the maximum weight (of the element at the mean position).</p>\n\n<p>That's it. The weight for an element at position <code>i</code> is then:</p>\n\n<pre><code>weight[i] = round(max_weight * exp(-(i - mean)^2 / (2 * variance)))\n</code></pre>\n"}], "owner": {"reputation": 4034, "user_id": 697364, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d74e445b43c9fcc11524fa8c382409b3?s=128&d=identicon&r=PG", "display_name": "blueblank", "link": "https://stackoverflow.com/users/697364/blueblank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 40438797, "answer_count": 1, "score": 0, "last_activity_date": 1478352616, "creation_date": 1478289059, "last_edit_date": 1478349923, "question_id": 40430738, "link": "https://stackoverflow.com/questions/40430738/weighting-a-flat-list-to-the-normal-distribution", "title": "weighting a flat list to the normal distribution", "body": "<p>I have list of string items of any length, I need to \"normalize\" this list so that each item is part of a normal distribution, appending the weight to the string. </p>\n\n<p>What is more effective and mathematical/statistical way to go about this other than what I have below?</p>\n\n<pre><code>func normalizeAppend(in []string, shuffle bool) []string {\n    var ret []string\n\n    if shuffle {\n        shuffleStrings(in)\n    }\n\n    l := len(in)\n    switch {\n    case remain(l, 3) == 0:\n        l3 := (l / 3)\n        var low, mid, high []string\n        for i, v := range in {\n            o := i + 1\n            switch {\n            case o &lt;= l3:\n                low = append(low, v)\n            case o &gt; l3 &amp;&amp; o &lt;= l3*2:\n                mid = append(mid, v)\n            case o &gt;= l3*2:\n                high = append(high, v)\n            }\n        }\n\n        q1 := 1600 / len(low)\n        q2 := 6800 / len(mid)\n        q3 := 1600 / len(high)\n\n        for _, v := range low {\n            ret = append(ret, fmt.Sprintf(\"%s_%d\", v, q1))\n        }\n\n        for _, v := range mid {\n            ret = append(ret, fmt.Sprintf(\"%s_%d\", v, q2))\n        }\n\n        for _, v := range high {\n            ret = append(ret, fmt.Sprintf(\"%s_%d\", v, q3))\n        }\n    case remain(l, 2) == 0 &amp;&amp; l &gt;= 4:\n        l4 := (l / 4)\n        var first, second, third, fourth []string\n        for i, v := range in {\n            o := i + 1\n            switch {\n            case o &lt;= l4:\n                first = append(first, v)\n            case o &gt; l4 &amp;&amp; o &lt;= l4*2:\n                second = append(second, v)\n            case o &gt; l4*2 &amp;&amp; o &lt;= l4*3:\n                third = append(third, v)\n            case o &gt; l4*3:\n                fourth = append(fourth, v)\n            }\n        }\n        q1 := 1600 / len(first)\n        q2 := 3400 / len(second)\n        q3 := 3400 / len(third)\n        q4 := 1600 / len(fourth)\n\n        for _, v := range first {\n            ret = append(ret, fmt.Sprintf(\"%s_%d\", v, q1))\n        }\n\n        for _, v := range second {\n            ret = append(ret, fmt.Sprintf(\"%s_%d\", v, q2))\n        }\n\n        for _, v := range third {\n            ret = append(ret, fmt.Sprintf(\"%s_%d\", v, q3))\n        }\n\n        for _, v := range fourth {\n            ret = append(ret, fmt.Sprintf(\"%s_%d\", v, q4))\n        }\n    default:\n        var first, second, third []string\n        q1 := (1 + math.Floor(float64(l)*.16))\n        q3 := (float64(l) - math.Floor(float64(l)*.16))\n        var o float64\n        for i, v := range in {\n            o = float64(i + 1)\n            switch {\n            case o &lt;= q1:\n                first = append(first, v)\n            case o &gt; q1 &amp;&amp; o &lt; q3:\n                second = append(second, v)\n            case o &gt;= q3:\n                third = append(third, v)\n            }\n        }\n        lq1 := 1600 / len(first)\n        lq2 := 3400 / len(second)\n        lq3 := 1600 / len(third)\n        for _, v := range first {\n            ret = append(ret, fmt.Sprintf(\"%s_%d\", v, lq1))\n        }\n\n        for _, v := range second {\n            ret = append(ret, fmt.Sprintf(\"%s_%d\", v, lq2))\n        }\n\n        for _, v := range third {\n            ret = append(ret, fmt.Sprintf(\"%s_%d\", v, lq3))\n        }\n\n    }\n\n    return ret\n}\n</code></pre>\n\n<p>Some requested clarification:</p>\n\n<p>I have a list of items that will chosen from the list many times one at a time by weighted selection, to start with I have a list with (implied) weights of 1:</p>\n\n<p>[a_1, b_1, c_1, d_1, e_1, f_1, g_1, h_1, i_1, j_1, k_1]</p>\n\n<p>I'm looking for a better way to make that list into something producing a more 'normal' distribution of weighting for selection:</p>\n\n<p>[a_1, b_2, c_3, d_5, e_14, f_30, g_14, h_5, i_3, j_2, k_1]</p>\n\n<p>or perhaps it is likely I need to change my methods to something more grounded statistically. Bottom line is I want to control selection from a list of items in many ways, one of which here is ensuring that items are returned in way approximating a normal curve.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 583, "user_id": 2362525, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ee17973702491f1e574c33b908e8ee38?s=128&d=identicon&r=PG", "display_name": "Bento", "link": "https://stackoverflow.com/users/2362525/bento"}, "edited": false, "score": 0, "creation_date": 1478346995, "post_id": 40430184, "comment_id": 68123076, "body": "So easy, yet is cost me hours to figure this stuff out hehe. Thanks!"}, {"owner": {"reputation": 56566, "user_id": 3055, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/104c34a4803355ade79413372205138a?s=128&d=identicon&r=PG", "display_name": "chakrit", "link": "https://stackoverflow.com/users/3055/chakrit"}, "edited": false, "score": 0, "creation_date": 1570441500, "post_id": 40430184, "comment_id": 102901456, "body": "Got error <code>bind: cannot assign requested address</code>, should I replace <code>0</code> with a random port?"}, {"owner": {"reputation": 123, "user_id": 3338591, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-k3Mf15ARaSg/AAAAAAAAAAI/AAAAAAAAAs8/uPXB8iLjH2U/photo.jpg?sz=128", "display_name": "Amin Karbas", "link": "https://stackoverflow.com/users/3338591/amin-karbas"}, "edited": false, "score": 0, "creation_date": 1601236243, "post_id": 40430184, "comment_id": 113336915, "body": "Thanks man! I also spent hours trying to figure out why I was getting <code>mismatched address type</code> :facepalm:"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1478286631, "creation_date": 1478286631, "answer_id": 40430184, "question_id": 40430098, "link": "https://stackoverflow.com/questions/40430098/dial-tcp-mismatched-local-address-type-172-29-4-175/40430184#40430184", "title": "dial tcp: mismatched local address type 172.29.4.175", "body": "<p>Nearly 100% of the time, an HTTP Dial is going to be connecting via TCP. You're only providing an IP address with the <code>ip</code> network type, yet a TCP address required the <code>tcp</code> network type and a port number.</p>\n\n<p>You can either substitute <code>net.TCPAddr</code> for <code>net.IPAddr</code>, or start with <code>net.ResolveTCPAddr</code> to create the correct type.</p>\n\n<pre><code>addr := &amp;net.TCPAddr{net.IP{172, 29, 4, 175}, 0, \"\"}\n</code></pre>\n\n<p>or </p>\n\n<pre><code>addr, _ := net.ResolveTCPAddr(\"tcp\", \"172.29.4.175:0\")\n</code></pre>\n"}], "owner": {"reputation": 583, "user_id": 2362525, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ee17973702491f1e574c33b908e8ee38?s=128&d=identicon&r=PG", "display_name": "Bento", "link": "https://stackoverflow.com/users/2362525/bento"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 747, "favorite_count": 0, "accepted_answer_id": 40430184, "answer_count": 1, "score": 0, "last_activity_date": 1478286631, "creation_date": 1478286280, "question_id": 40430098, "link": "https://stackoverflow.com/questions/40430098/dial-tcp-mismatched-local-address-type-172-29-4-175", "title": "dial tcp: mismatched local address type 172.29.4.175", "body": "<p>I'm getting this error with the following code: dial tcp: mismatched local address type 172.29.4.175</p>\n\n<p>Any idea on how to fix this? Couldn't find anything useful online other than <a href=\"http://oocms.org/question/763660/dial-with-a-specific-address-interface-golang\" rel=\"nofollow noreferrer\">http://oocms.org/question/763660/dial-with-a-specific-address-interface-golang</a> but that didn't work.</p>\n\n<p>The IP 172.29.4.175 is currently the IP of my Macbooks wifi interface.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"net/http\"\n)\n\nvar url = \"https://httpbin.org/get\"\n\nfunc main() {\n\n    q := net.ParseIP(\"172.29.4.175\")\n    addr := &amp;net.IPAddr{q, \"\"}\n\n    var transport = &amp;http.Transport{\n        DialContext: (&amp;net.Dialer{\n            LocalAddr: addr,\n        }).DialContext,\n    }\n\n    var httpclient = &amp;http.Client{\n        Transport: transport,\n    }\n\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    req.Header.Set(\"User-Agent\", \"Test-Agent\")\n\n    resp, err := httpclient.Do(req)\n    fmt.Println(resp, err)\n}\n</code></pre>\n"}, {"tags": ["c++", "go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478286011, "post_id": 40429968, "comment_id": 68108415, "body": "Does <code>${SRCDIR}</code> not do what you want? <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">golang.org/cmd/cgo</a>"}, {"owner": {"reputation": 566, "user_id": 633735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58c6208b793e7d01a8a24ab4079a3466?s=128&d=identicon&r=PG", "display_name": "Ross Hemsley", "link": "https://stackoverflow.com/users/633735/ross-hemsley"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478453961, "post_id": 40429968, "comment_id": 68150151, "body": "Thanks, <code>${SRCDIR}</code> helps. I can get things built that way. <code>go test</code> has problems still."}], "owner": {"reputation": 566, "user_id": 633735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58c6208b793e7d01a8a24ab4079a3466?s=128&d=identicon&r=PG", "display_name": "Ross Hemsley", "link": "https://stackoverflow.com/users/633735/ross-hemsley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 419, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1478285779, "creation_date": 1478285779, "question_id": 40429968, "link": "https://stackoverflow.com/questions/40429968/using-go-with-dynamically-linked-c-libraries-and-multiple-projects", "title": "Using go with dynamically linked C libraries and multiple projects", "body": "<p>A useful pattern we have adopted is using Go to build interfaces around our internal C++11 shared libraries using cgo.</p>\n\n<p>We simply add a <code>/gointerface</code> dir to our C++ project, add a <code>main.go</code>, copy in <code>libfoo.so</code>, run <code>go build .</code> then zip it &amp; ship it.</p>\n\n<p>Unfortunately, when we want to use other Go dependencies, things start getting complicated because Go has strong opinions about where code should live and how it should be built.</p>\n\n<p>When building multiple packages from a <code>$GOPATH</code>, <code>go build .</code> builds out-of-source. This invalidates the paths to our dynamic library - the linker flags are all relative to the source dir, not the build dir.</p>\n\n<p>In particular, the <code>-L</code> path that previously worked in the flat project no longer refers to the correct place, since it is taken relative to the build directory.</p>\n\n<p><code>// #cgo LDFLAGS: -Wl,-rpath -Wl,\\$ORIGIN -L. -lfoo</code></p>\n\n<p>This issue has been raised and shot down before, e.g.\n<a href=\"https://go-review.googlesource.com/#/c/1756/\" rel=\"nofollow noreferrer\">https://go-review.googlesource.com/#/c/1756/</a></p>\n\n<p>But I've yet to find any good solution to it. Currently the path of least resistance is to just flatten all dependencies into the same project... which is undesirable.</p>\n\n<p>Is there a solution that doesn't involve hacking absolute paths into environment variables or subverting the Go build system?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 1064, "user_id": 2317487, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/S9GeT.jpg?s=128&g=1", "display_name": "Aus", "link": "https://stackoverflow.com/users/2317487/aus"}, "edited": false, "score": 0, "creation_date": 1478283411, "post_id": 40429296, "comment_id": 68107089, "body": "In myStruct, annotate the variable count to be omitted if not present. Add this in front of your variable <code>json:&quot;,omitempty&quot;</code>"}, {"owner": {"reputation": 1933, "user_id": 6342826, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/iSdHY.jpg?s=128&g=1", "display_name": "Leticia Esperon", "link": "https://stackoverflow.com/users/6342826/leticia-esperon"}, "reply_to_user": {"reputation": 1064, "user_id": 2317487, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/S9GeT.jpg?s=128&g=1", "display_name": "Aus", "link": "https://stackoverflow.com/users/2317487/aus"}, "edited": false, "score": 0, "creation_date": 1478283981, "post_id": 40429296, "comment_id": 68107396, "body": "I don&#39;t have a definition of MyStruct since it can be absolutely anything. I just need to include that count key to whatever json the string represents. But thanks for the comment."}], "answers": [{"comments": [{"owner": {"reputation": 3658, "user_id": 763962, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/afaad2085b607363aedaf8b923fd63c1?s=128&d=identicon&r=PG", "display_name": "Micha Roon", "link": "https://stackoverflow.com/users/763962/micha-roon"}, "edited": false, "score": 2, "creation_date": 1508941842, "post_id": 40429618, "comment_id": 80817428, "body": "side note: only the capitalized attributes in the struct will be included into the JSON. Private attributes will be ignored by the marshaller"}, {"owner": {"reputation": 804, "user_id": 6875688, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e46e6b2da3f3fc933ea112f88e4a3a1d?s=128&d=identicon&r=PG", "display_name": "Hugo L.M", "link": "https://stackoverflow.com/users/6875688/hugo-l-m"}, "edited": false, "score": 0, "creation_date": 1532588955, "post_id": 40429618, "comment_id": 90033453, "body": "Thanks, it worked for me too: <b>` \t\t\tb, err := ioutil.ReadFile(reportPath) \t\t\tbAstring := string(b[:]) \t\t\tprintln(bAstring) \t\t\tlog.Debug(err) \t\t\tdata := e2e.E2eTask{} \t\t\terror := json.Unmarshal([]byte(bAstring), &amp;data ) \t\t\tlog.Debug(error) \t\t\tfmt.Println(&quot;Data status: &quot; + data.Status)`</b>."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 69, "last_activity_date": 1478284297, "creation_date": 1478284297, "answer_id": 40429618, "question_id": 40429296, "link": "https://stackoverflow.com/questions/40429296/decode-json-with-unknown-structure/40429618#40429618", "title": "Decode JSON with unknown structure", "body": "<p>You really just need a single struct, and as mentioned in the comments the correct annotations on the field will yield the desired results. JSON is not some extremely variant data format, it is well defined and any piece of json, no matter how complicated and confusing it might be to you can be represented fairly easily and with 100% accuracy both by a schema and in objects in Go and most other OO programming languages. Here's an example;</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype Data struct {\n    Votes *Votes `json:\"votes\"`\n    Count string `json:\"count,omitempty\"`\n}\n\ntype Votes struct {\n    OptionA string `json:\"option_A\"`\n}\n\nfunc main() {\n    s := `{ \"votes\": { \"option_A\": \"3\" } }`\n    data := &amp;Data{\n        Votes: &amp;Votes{},\n    }\n    err := json.Unmarshal([]byte(s), data)\n    fmt.Println(err)\n    fmt.Println(data.Votes)\n    s2, _ := json.Marshal(data)\n    fmt.Println(string(s2))\n    data.Count = \"2\"\n    s3, _ := json.Marshal(data)\n    fmt.Println(string(s3))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ScuxESTW5i\" rel=\"noreferrer\">https://play.golang.org/p/ScuxESTW5i</a></p>\n\n<p>Based on your most recent comment you could address that by using an <code>interface{}</code> to represent data besides the count, making the count a string and having the rest of the blob shoved into the <code>interface{}</code> which will accept essentially anything. That being said, Go is a statically typed language with a fairly strict type system and to reiterate, your comments stating 'it can be anything' are not true. JSON cannot be anything. For any piece of JSON there is schema and a single schema can define many many variations of JSON. I advise you take the time to understand the structure of your data rather than hacking something together under the notion that it cannot be defined when it absolutely can and is probably quite easy for someone who knows what they're doing.</p>\n"}, {"comments": [{"owner": {"reputation": 2502, "user_id": 3589054, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2af7ed5cc40b1b8479cd082ca3e0c4af?s=128&d=identicon&r=PG&f=1", "display_name": "NinjaGaiden", "link": "https://stackoverflow.com/users/3589054/ninjagaiden"}, "edited": false, "score": 6, "creation_date": 1494379372, "post_id": 40429627, "comment_id": 74799116, "body": "elegant! and easy to understand"}, {"owner": {"reputation": 365, "user_id": 4162799, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b1e96859c217b1c4b8ae0eebff56559d?s=128&d=identicon&r=PG", "display_name": "Fares", "link": "https://stackoverflow.com/users/4162799/fares"}, "edited": false, "score": 0, "creation_date": 1574551826, "post_id": 40429627, "comment_id": 104274009, "body": "It would be nice if you add error handling in the call of Unmarshall on json !"}], "tags": [], "owner": {"reputation": 4918, "user_id": 795876, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c5d0d7600171a1ae7adadca3287dafa4?s=128&d=identicon&r=PG", "display_name": "fsenart", "link": "https://stackoverflow.com/users/795876/fsenart"}, "is_accepted": false, "score": 85, "last_activity_date": 1588766706, "last_edit_date": 1588766706, "creation_date": 1478284322, "answer_id": 40429627, "question_id": 40429296, "link": "https://stackoverflow.com/questions/40429296/decode-json-with-unknown-structure/40429627#40429627", "title": "Decode JSON with unknown structure", "body": "<pre><code>package main\n\nimport \"encoding/json\"\n\nfunc main() {\n    in := []byte(`{ \"votes\": { \"option_A\": \"3\" } }`)\n    var raw map[string]interface{}\n    if err := json.Unmarshal(in, &amp;raw); err != nil {\n        panic(err)\n    }\n    raw[\"count\"] = 1\n    out, err := json.Marshal(raw)\n    if err != nil {\n        panic(err)\n    }\n    println(string(out))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/o8ZwvgsQmoO\" rel=\"noreferrer\">https://play.golang.org/p/o8ZwvgsQmoO</a></p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1606785239, "last_edit_date": 1606785239, "creation_date": 1606774655, "answer_id": 65081958, "question_id": 40429296, "link": "https://stackoverflow.com/questions/40429296/decode-json-with-unknown-structure/65081958#65081958", "title": "Decode JSON with unknown structure", "body": "<p>The issue I had is that sometimes I will need to get at a value that is deeply\nnested. Normally you would need to do a type assertion at each level, so I went\nahead and just made a method that takes a <code>map[string]interface{}</code> and a\n<code>string</code> key, and returns the resulting <code>map[string]interface{}</code>.</p>\n<p>The issue that cropped up for me was that at some depths you will encounter a\nSlice instead of Map. So I also added methods to return a Slice from Map, and\nMap from Slice. I didnt do one for Slice to Slice, but you could easily add that\nif needed. Here are the methods:</p>\n<pre><code>package main\ntype Slice []interface{}\ntype Map map[string]interface{}\n\nfunc (m Map) M(s string) Map {\n   return m[s].(map[string]interface{})\n}\n\nfunc (m Map) A(s string) Slice {\n   return m[s].([]interface{})\n}\n\nfunc (a Slice) M(n int) Map {\n   return a[n].(map[string]interface{})\n}\n</code></pre>\n<p>and example code:</p>\n<pre><code>package main\n\nimport (\n   &quot;encoding/json&quot;\n   &quot;fmt&quot;\n   &quot;log&quot;\n   &quot;os&quot;\n)\n\nfunc main() {\n   o, e := os.Open(&quot;a.json&quot;)\n   if e != nil {\n      log.Fatal(e)\n   }\n   in_m := Map{}\n   json.NewDecoder(o).Decode(&amp;in_m)\n   out_m := in_m.\n      M(&quot;contents&quot;).\n      M(&quot;sectionListRenderer&quot;).\n      A(&quot;contents&quot;).\n      M(0).\n      M(&quot;musicShelfRenderer&quot;).\n      A(&quot;contents&quot;).\n      M(0).\n      M(&quot;musicResponsiveListItemRenderer&quot;).\n      M(&quot;navigationEndpoint&quot;).\n      M(&quot;browseEndpoint&quot;)\n   fmt.Println(out_m)\n}\n</code></pre>\n"}], "owner": {"reputation": 1933, "user_id": 6342826, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/iSdHY.jpg?s=128&g=1", "display_name": "Leticia Esperon", "link": "https://stackoverflow.com/users/6342826/leticia-esperon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121919, "favorite_count": 10, "accepted_answer_id": 40429618, "answer_count": 3, "score": 53, "last_activity_date": 1606785239, "creation_date": 1478283107, "last_edit_date": 1606773655, "question_id": 40429296, "link": "https://stackoverflow.com/questions/40429296/decode-json-with-unknown-structure", "title": "Decode JSON with unknown structure", "body": "<p>I want to get a string that represents a json like this one:</p>\n<pre><code>{ &quot;votes&quot;: { &quot;option_A&quot;: &quot;3&quot; } }\n</code></pre>\n<p><strong>and include a &quot;count&quot; key in it</strong> so it ends like this:</p>\n<pre><code>{ &quot;votes&quot;: { &quot;option_A&quot;: &quot;3&quot; }, &quot;count&quot;: &quot;1&quot; }\n</code></pre>\n<p>This is why I planned to convert it to json so I could add the count and then\nmake it a string again. <strong>The problem is I don't know the structure of that\nJSON</strong>, so I can't use <code>json.Unmarshal(in, &amp;myStruct)</code> because that struct\nvaries. How can I do this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1478283002, "post_id": 40429072, "comment_id": 68106862, "body": "You&#39;re not breaking on a non-EOF error, which can get stuck, and you&#39;re not checking the Write count or error. Why not just use io.Copy or io.CopyBuffer?"}, {"owner": {"reputation": 598, "user_id": 1692500, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6adc7f8116739bf3ba98ace33e30667c?s=128&d=identicon&r=PG", "display_name": "azizulhakim", "link": "https://stackoverflow.com/users/1692500/azizulhakim"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478283218, "post_id": 40429072, "comment_id": 68106979, "body": "Yes, I&#39;m not breaking on non-EOF error. But I&#39;m printing if there is any error. So in error case, I&#39;m expecting to see something on the console. It is just a test application and I don&#39;t need it be perfect. I just need to understand why the file transfer gets stuck on some occasion. Also I&#39;m using the io.Copy and printing the number of bytes sent from the client side, which is correct always."}, {"owner": {"reputation": 8073, "user_id": 2852624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/682806d261e4f00f77aa8633689a9558?s=128&d=identicon&r=PG&f=1", "display_name": "Matthias247", "link": "https://stackoverflow.com/users/2852624/matthias247"}, "edited": false, "score": 0, "creation_date": 1478283556, "post_id": 40429072, "comment_id": 68107173, "body": "You should definitely check the error before writing to the file. And in case of an error (where <code>n</code> is not necessarily defined) never write to a file."}], "answers": [{"comments": [{"owner": {"reputation": 598, "user_id": 1692500, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6adc7f8116739bf3ba98ace33e30667c?s=128&d=identicon&r=PG", "display_name": "azizulhakim", "link": "https://stackoverflow.com/users/1692500/azizulhakim"}, "edited": false, "score": 0, "creation_date": 1478284342, "post_id": 40429443, "comment_id": 68107577, "body": "I appreciate it. that is a better and cleaner code and I&#39;ll replace my code with that. But I also want to know what is going wrong with my code. Nothing seems to be incorrect here."}, {"owner": {"reputation": 598, "user_id": 1692500, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6adc7f8116739bf3ba98ace33e30667c?s=128&d=identicon&r=PG", "display_name": "azizulhakim", "link": "https://stackoverflow.com/users/1692500/azizulhakim"}, "edited": false, "score": 0, "creation_date": 1478285616, "post_id": 40429443, "comment_id": 68108225, "body": "yes, that could be a reason except that it is not. Because I&#39;ve a print after each read. So if it were infinite loop, I would see infinite print on the console. To double check, I removed the new buffer allocation and put some extra print which confirmed it is not the case in my code."}, {"owner": {"reputation": 598, "user_id": 1692500, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6adc7f8116739bf3ba98ace33e30667c?s=128&d=identicon&r=PG", "display_name": "azizulhakim", "link": "https://stackoverflow.com/users/1692500/azizulhakim"}, "edited": false, "score": 0, "creation_date": 1478287049, "post_id": 40429443, "comment_id": 68108905, "body": "In fact I&#39;m having the same issue with your piece of code. It gets stuck at some point. Not sure whats going wrong."}, {"owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "reply_to_user": {"reputation": 598, "user_id": 1692500, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6adc7f8116739bf3ba98ace33e30667c?s=128&d=identicon&r=PG", "display_name": "azizulhakim", "link": "https://stackoverflow.com/users/1692500/azizulhakim"}, "edited": false, "score": 0, "creation_date": 1478287219, "post_id": 40429443, "comment_id": 68109006, "body": "It sounds like there is something wrong with your connection (either a problem with the sender, the network, or your connection.Read() method)."}], "tags": [], "owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "is_accepted": false, "score": 3, "last_activity_date": 1478286885, "last_edit_date": 1478286885, "creation_date": 1478283625, "answer_id": 40429443, "question_id": 40429072, "link": "https://stackoverflow.com/questions/40429072/golang-file-transfer-stops-without-any-error/40429443#40429443", "title": "GoLang File Transfer Stops Without Any Error", "body": "<p>TL;DR: This should be all you need to copy a file.</p>\n\n<pre><code>if _, err := io.Copy(file, connection); err != nil {\n    // handle error\n}\n</code></pre>\n\n<p>If you need to copy in chunks while doing some logic in between copies (for example, printing the bytes read), you can use <a href=\"http://godoc.org/io#CopyN\" rel=\"nofollow noreferrer\"><code>io.CopyN</code></a></p>\n\n<pre><code>totalRead := int64(0)\nfor {\n    n, err := io.CopyN(outfile, infile, 1024)\n    totalRead += n\n    // print bytes read followed by a carriage return\n    fmt.Printf(\"Bytes read: %d\\r\", totalRead)\n    if err != nil {\n        if err == io.EOF {\n            fmt.Println() // print a newline\n            break\n        }\n        // handle error\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 598, "user_id": 1692500, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6adc7f8116739bf3ba98ace33e30667c?s=128&d=identicon&r=PG", "display_name": "azizulhakim", "link": "https://stackoverflow.com/users/1692500/azizulhakim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1478286885, "creation_date": 1478282341, "last_edit_date": 1478283156, "question_id": 40429072, "link": "https://stackoverflow.com/questions/40429072/golang-file-transfer-stops-without-any-error", "title": "GoLang File Transfer Stops Without Any Error", "body": "<p>I've running a simple file transfer code in <code>go</code>. From the server side I try to read 1024 bytes of data at a time. From client side I'm using the <code>io.Copy</code> function to transfer the file. The file transfer completes successfully 70% of the time. But in 30% of time it fails. It gets stuck on <code>connection.Read</code> function. Through some experiments I saw that it happens only on the occasion where previous <code>Read</code> operation reads less than <code>1024</code> bytes of data.</p>\n\n<p>So from my code, ideally it should read <code>1024</code> bytes of data on all successive <code>Read</code> except the very last <code>Read</code> where the file transfer is complete. But on some occasion if it reads less than <code>1024</code> bytes, the next <code>Read</code> operation gets stuck without throwing any error. Here is my code:</p>\n\n<ol>\n<li><p>Server.go</p>\n\n<pre><code>fileBuffer := make([]byte, BUFFER_SIZE)     //BUFFER_SIZE is a constant of 1024\nbytesRead := int64(0)\ncount := 0\nfor {\n    if fileSize-bytesRead &lt; int64(BUFFER_SIZE) {        //fileSize is the size of file in bytes, which I calculated earlier.\n        fileBuffer = make([]byte, fileSize-bytesRead)\n    }\n\n    fmt.Println(\"Reading \", BUFFER_SIZE, \" bytes of data\")\n\n    n, err := connection.Read(fileBuffer)\n\n    count++\n\n    fmt.Println(\"Completed reading\", n, \" bytes of data, count=\", count)\n\n    file.Write(fileBuffer[0:n])\n\n    bytesRead += int64(n)\n    fmt.Println(\"So far read\", bytesRead, \" bytes of data\")\n\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    if err == io.EOF {\n        result.Message = \"File transfer incomplete\"\n        break\n    }\n\n    if bytesRead &gt;= fileSize {\n        result.Message = \"File transfer complete\"\n        break\n    }\n}\n</code></pre></li>\n<li><p>Client.go</p>\n\n<pre><code>n, err := io.Copy(conn, file)\nfmt.Println(n, \" bytes sent\")\n</code></pre></li>\n</ol>\n\n<p>For my case, number of sent bytes is correct, number of received bytes is also correct on successful transfer. The problem happens for the same file.</p>\n"}, {"tags": ["mysql", "go", "utf8mb4"], "comments": [{"owner": {"reputation": 3194, "user_id": 4991677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7dabe78477c4b3697c3284fb556b1eca?s=128&d=identicon&r=PG&f=1", "display_name": "FDavidov", "link": "https://stackoverflow.com/users/4991677/fdavidov"}, "edited": false, "score": 0, "creation_date": 1478281994, "post_id": 40428852, "comment_id": 68106381, "body": "I had the same issue and it turned out that, somehow, control characters were being introduced into the string (in my particular case, when copying <i>formatted</i> text from MS-Word into an input field of my Web page). In my case, the solution was to filter out control characters at the client side."}], "answers": [{"tags": [], "owner": {"reputation": 10424, "user_id": 3408572, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f3a08b145553b98749d3d0572d01265?s=128&d=identicon&r=PG&f=1", "display_name": "andlabs", "link": "https://stackoverflow.com/users/3408572/andlabs"}, "is_accepted": true, "score": 6, "last_activity_date": 1478285975, "last_edit_date": 1478285975, "creation_date": 1478281799, "answer_id": 40428928, "question_id": 40428852, "link": "https://stackoverflow.com/questions/40428852/golang-mysql-1366-incorrect-string-value-error/40428928#40428928", "title": "Golang MySQL 1366 incorrect string value error", "body": "<p>Those are not valid UTF-8 strings; those are binary data (the first is a PNG file!). You'll need to store them in a real binary column, since MySQL does do UTF-8-specific operations like case folding and language collation. (Go does not enforce UTF-8 encoding on strings, so Go doesn't complain. Go only uses UTF-8 to encode string literals, but the <code>\\x</code> escape sequence overrides this. And of course, <code>range</code>, <code>[]rune</code> conversion, and various packages assume strings are UTF-8.)</p>\n\n<p>You can check if a string is a valid sequence with <a href=\"https://golang.org/pkg/unicode/utf8/#ValidString\" rel=\"noreferrer\"><code>utf8.ValidString()</code></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "is_accepted": false, "score": 2, "last_activity_date": 1538264146, "last_edit_date": 1538264146, "creation_date": 1478376539, "answer_id": 40442705, "question_id": 40428852, "link": "https://stackoverflow.com/questions/40428852/golang-mysql-1366-incorrect-string-value-error/40442705#40442705", "title": "Golang MySQL 1366 incorrect string value error", "body": "<p>Use a <code>BLOB</code> (maybe <code>MEDIUMBLOB</code>) datatype for the column containing images.  Using <code>TEXT</code> leads to checking the encoding.  A PNG does not contain correctly encoded utf8 characters, hence the errors.</p>\n\n<p>The rest of your usage of utf8mb4 is probably fine.</p>\n"}], "owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2309, "favorite_count": 0, "accepted_answer_id": 40428928, "answer_count": 2, "score": 3, "last_activity_date": 1538264146, "creation_date": 1478281488, "question_id": 40428852, "link": "https://stackoverflow.com/questions/40428852/golang-mysql-1366-incorrect-string-value-error", "title": "Golang MySQL 1366 incorrect string value error", "body": "<p>I am inserting strings into my database but getting the MySQL 1366 error for invalid string byte sequences.</p>\n\n<pre><code>2016/11/04 13:33:40 Error 1366: Incorrect string value: '\\x89PNG\\x0D\\x0A...' for column 'text' at row 1\n2016/11/04 13:33:56 Error 1366: Incorrect string value: '\\xB6\\xEB\\xE4\\x0B\\x92\\xEE...' for column 'text' at row 1\n2016/11/04 13:33:56 Error 1366: Incorrect string value: '\\xFF\\xD8\\xFF\\xE0\\x00\\x10...' for column 'text' at row 1\n2016/11/04 13:34:35 Error 1366: Incorrect string value: '\\x9C]\\x91\\xD1k\\xC2...' for column 'text' at row 1\n</code></pre>\n\n<p>My MySQL config is set for utf8mb4 as shown below:</p>\n\n<pre><code>mysql&gt; SHOW VARIABLES LIKE 'character_set%';\n+--------------------------+----------------------------+\n| Variable_name            | Value                      |\n+--------------------------+----------------------------+\n| character_set_client     | utf8mb4                    |\n| character_set_connection | utf8mb4                    |\n| character_set_database   | utf8mb4                    |\n| character_set_filesystem | binary                     |\n| character_set_results    | utf8mb4                    |\n| character_set_server     | utf8mb4                    |\n| character_set_system     | utf8                       |\n| character_sets_dir       | /usr/share/mysql/charsets/ |\n+--------------------------+----------------------------+\n8 rows in set (0.00 sec)\n</code></pre>\n\n<p>My database connection pool looks like this:</p>\n\n<pre><code>db, err = sql.Open(\"mysql\", config.User+\":\"+config.Password+\"@tcp(\"+config.Host+\")/\"+config.Database)\nif err != nil {\n    log.Fatal(err)\n}\n\ndb.Exec(\"SET NAMES 'utf8mb4'; SET CHARACTER SET utf8mb4;\")\n</code></pre>\n\n<p>What am I still missing?</p>\n"}, {"tags": ["go", "protocol-buffers"], "answers": [{"tags": [], "owner": {"reputation": 1529, "user_id": 3029676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qTCxh.png?s=128&g=1", "display_name": "wgoodall01", "link": "https://stackoverflow.com/users/3029676/wgoodall01"}, "is_accepted": false, "score": -1, "last_activity_date": 1542068754, "creation_date": 1542068754, "answer_id": 53272048, "question_id": 40428691, "link": "https://stackoverflow.com/questions/40428691/specifying-the-json-name-for-protobuf-extension/53272048#53272048", "title": "Specifying the JSON name for protobuf extension", "body": "<p>One option would be to use Go's <code>encoding/json</code> package and a tagged struct to decode/marshal the json yourself, something like this:</p>\n\n<pre><code>type Example struct {\n    ExtMessageName string `json:\"extension_message_name\"`\n}\n\nmsg := Example{ExtMessageName: \"This is a test\"}\n\njsonBytes, err := json.Marshal(msg)\n\nif err != nil {\n    fmt.Printf(\"error: %v\", err)\n    return\n}\n\nfmt.Println(string(jsonBytes))\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/qXNaXWoKyF5\" rel=\"nofollow noreferrer\">example on play.golang.org</a></p>\n\n<p>which then outputs:</p>\n\n<pre><code>{\"extension_message_name\":\"This is a test\"}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6761, "user_id": 664345, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/34de936228acd10be7665e5c73c53d92?s=128&d=identicon&r=PG", "display_name": "Liyan Chang", "link": "https://stackoverflow.com/users/664345/liyan-chang"}, "is_accepted": false, "score": 0, "last_activity_date": 1567478641, "creation_date": 1567478641, "answer_id": 57764448, "question_id": 40428691, "link": "https://stackoverflow.com/questions/40428691/specifying-the-json-name-for-protobuf-extension/57764448#57764448", "title": "Specifying the JSON name for protobuf extension", "body": "<p>You've got some options but that's because none of them are good:</p>\n\n<ol>\n<li><p>Create a new struct with different json struct tags and then use reflection to overlay one struct onto the other.</p></li>\n<li><p>Use <a href=\"https://github.com/favadi/protoc-go-inject-tag\" rel=\"nofollow noreferrer\">https://github.com/favadi/protoc-go-inject-tag</a> to inject custom struct tags, but you'll probably find that you need to use a different tag then json to avoid conflicts and then find a json library that allows for a custom struct tag</p></li>\n<li><p>Rewrite the json bytes after you marshaled it to find and replace in the stringified text.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 754, "user_id": 9811316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9e8849ebed49c133a3cda4db917e840?s=128&d=identicon&r=PG&f=1", "display_name": "abcalphabet", "link": "https://stackoverflow.com/users/9811316/abcalphabet"}, "is_accepted": false, "score": 1, "last_activity_date": 1606419454, "last_edit_date": 1606419454, "creation_date": 1589542121, "answer_id": 61818138, "question_id": 40428691, "link": "https://stackoverflow.com/questions/40428691/specifying-the-json-name-for-protobuf-extension/61818138#61818138", "title": "Specifying the JSON name for protobuf extension", "body": "<p>As per the <a href=\"https://developers.google.com/protocol-buffers/docs/proto3#json\" rel=\"nofollow noreferrer\">language guide</a>:</p>\n<blockquote>\n<p>Message field names are mapped to lowerCamelCase and become JSON object keys. If the json_name field option is specified, the specified value will be used as the key instead.</p>\n</blockquote>\n<p>So tagging your field with <code>json_name</code> should do the trick, for example this:</p>\n<pre><code>message TestMessage {\n    string myField = 1 [json_name=&quot;my_special_field_name&quot;];\n}\n</code></pre>\n<p>Should make <code>myField</code> have the name <code>my_special_field_name</code> when marshalled to JSON.</p>\n"}], "owner": {"reputation": 360, "user_id": 5872318, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IB6RdimFijs/AAAAAAAAAAI/AAAAAAAAAFU/Xk-uMkbay2g/photo.jpg?sz=128", "display_name": "MffnMn", "link": "https://stackoverflow.com/users/5872318/mffnmn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1252, "favorite_count": 1, "answer_count": 3, "score": 7, "last_activity_date": 1606419454, "creation_date": 1478280844, "question_id": 40428691, "link": "https://stackoverflow.com/questions/40428691/specifying-the-json-name-for-protobuf-extension", "title": "Specifying the JSON name for protobuf extension", "body": "<p>I've added an extending message to a message and need to marshal it as a json. However the field name for the extension message is <code>[message.extension_message_name]</code>.</p>\n\n<p>I would prefer it to be named just <code>extension_message_name</code>, without the braces and prefix, since this extension message exists elsewhere in our API and and having this weird name adds confusion.</p>\n\n<p>As far as I can tell the bit of code responsible is in <a href=\"https://github.com/golang/protobuf/blob/master/jsonpb/jsonpb.go#L256\" rel=\"noreferrer\" title=\"jsonpb marshaller\">protobuf/jsonpb</a>, where the JSONName is set with <code>fmt.Sprintf(\"[%s]\", desc.Name</code> and cannot be overwritten it seems.</p>\n\n<p>Anyone have a workaround for this?</p>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1478271422, "post_id": 40425699, "comment_id": 68099774, "body": "How about the latest version of this question from a day ago? <a href=\"https://stackoverflow.com/questions/40388246/convert-string-to-time-and-parse-in-golang\" title=\"convert string to time and parse in golang\">stackoverflow.com/questions/40388246/&hellip;</a>"}, {"owner": {"reputation": 1064, "user_id": 3281507, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/zD3kX.png?s=128&g=1", "display_name": "rafaelmorais", "link": "https://stackoverflow.com/users/3281507/rafaelmorais"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478272502, "post_id": 40425699, "comment_id": 68100501, "body": "So, it has to be that date specifically? :O"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1478273245, "post_id": 40425699, "comment_id": 68101034, "body": "How else is the function supposed to know the difference in each field if there&#39;s no defined value?"}], "answers": [{"comments": [{"owner": {"reputation": 1064, "user_id": 3281507, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/zD3kX.png?s=128&g=1", "display_name": "rafaelmorais", "link": "https://stackoverflow.com/users/3281507/rafaelmorais"}, "edited": false, "score": 0, "creation_date": 1478272559, "post_id": 40426078, "comment_id": 68100547, "body": "Do you know why the layout needs to have this specific date?"}, {"owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "reply_to_user": {"reputation": 1064, "user_id": 3281507, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/zD3kX.png?s=128&g=1", "display_name": "rafaelmorais", "link": "https://stackoverflow.com/users/3281507/rafaelmorais"}, "edited": false, "score": 3, "creation_date": 1478272773, "post_id": 40426078, "comment_id": 68100700, "body": "It is inspired from Unix&#39;s epoch time <a href=\"https://en.wikipedia.org/wiki/Unix_time\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Unix_time</a>. It is Go&#39;s version. Go needs to have a set reference time for layout or else every programmer would just choose some arbitrary reference date."}, {"owner": {"reputation": 3420, "user_id": 424632, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ec99692fd9664c4f4558a6d0d020a058?s=128&d=identicon&r=PG", "display_name": "musiphil", "link": "https://stackoverflow.com/users/424632/musiphil"}, "edited": false, "score": 2, "creation_date": 1504824305, "post_id": 40426078, "comment_id": 79175294, "body": "It&#39;s not anything like the epoch, and that point in time doesn&#39;t mean anything like the Unix epoch does, but it&#39;s just a mnemonic for the elements of time (month, day, etc.). Think of it as <code>01&#47;02 03:04:05PM &#39;06 -0700</code> (1-2-3-4-5-6-7), and as long as you remember that single sequence, you can write <code>1</code>, <code>01</code>, <code>Jan</code>, or <code>January</code> without having to remember<code>%m</code>, <code>%b</code>, or <code>%B</code> as in <code>strftime</code>."}, {"owner": {"reputation": 374, "user_id": 2484029, "user_type": "registered", "profile_image": "https://graph.facebook.com/564038402/picture?type=large", "display_name": "kio", "link": "https://stackoverflow.com/users/2484029/kio"}, "edited": false, "score": 1, "creation_date": 1599070768, "post_id": 40426078, "comment_id": 112662857, "body": "this should help: <a href=\"https://golang.org/src/time/format.go?s=25155:25201#L92\" rel=\"nofollow noreferrer\">golang.org/src/time/format.go?s=25155:25201#L92</a>"}], "tags": [], "owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "is_accepted": true, "score": 22, "last_activity_date": 1478272406, "creation_date": 1478272406, "answer_id": 40426078, "question_id": 40425699, "link": "https://stackoverflow.com/questions/40425699/go-time-parse-getting-month-out-of-range-error/40426078#40426078", "title": "Go time.Parse() getting &quot;month out of range&quot; error", "body": "<p>You're using the wrong reference time in the <code>layout</code> parameter of <code>time.Parse</code> which should be <code>Jan 2, 2006 at 3:04pm (MST)</code></p>\n\n<p>Change your <code>begin</code> line to the following and it will work:</p>\n\n<p><code>begin, err := time.Parse(\"2006-01-02 15:04:05\", \"2016-12-25 \"+string(start)+\":00\")</code></p>\n\n<p><a href=\"https://golang.org/pkg/time/#Parse\" rel=\"noreferrer\">func Parse</a></p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1609012424, "creation_date": 1609012424, "answer_id": 65460135, "question_id": 40425699, "link": "https://stackoverflow.com/questions/40425699/go-time-parse-getting-month-out-of-range-error/65460135#65460135", "title": "Go time.Parse() getting &quot;month out of range&quot; error", "body": "<p>To avoid having to remember the special date, I usually wrap the logic in a\nfunction:</p>\n<pre><code>package main\n\nimport (\n   &quot;fmt&quot;\n   &quot;log&quot;\n   &quot;time&quot;\n)\n\nfunc ParseDate(value string) (time.Time, error) {\n   layout := time.RFC3339[:len(value)]\n   return time.Parse(layout, value)\n}\n\nfunc main() {\n   start := &quot;15:04&quot;\n   o, e := ParseDate(&quot;2016-12-25T&quot; + start)\n   if e != nil {\n      log.Fatal(e)\n   }\n   fmt.Println(o)\n}\n</code></pre>\n<p><a href=\"https://89z.github.io/autumn/string-to-date-object/go\" rel=\"nofollow noreferrer\">https://89z.github.io/autumn/string-to-date-object/go</a></p>\n"}], "owner": {"reputation": 1064, "user_id": 3281507, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/zD3kX.png?s=128&g=1", "display_name": "rafaelmorais", "link": "https://stackoverflow.com/users/3281507/rafaelmorais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11952, "favorite_count": 3, "accepted_answer_id": 40426078, "answer_count": 2, "score": 14, "last_activity_date": 1609012424, "creation_date": 1478271328, "last_edit_date": 1495541208, "question_id": 40425699, "link": "https://stackoverflow.com/questions/40425699/go-time-parse-getting-month-out-of-range-error", "title": "Go time.Parse() getting &quot;month out of range&quot; error", "body": "<p>I'm new to Go and I was creating a little console script. You can check my code here:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"time\"\n)\n\nfunc main() {\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Println(\"Calculate\")\n    fmt.Print(\"Hours and minutes: \")\n    start, _, _ := reader.ReadLine()\n    begin, err := time.Parse(\"2016-12-25 00:00:00\", \"2016-12-25 \"+string(start)+\":00\")\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(begin)\n}\n</code></pre>\n\n<p>I've seen a related <a href=\"https://stackoverflow.com/questions/39589594/golang-time-error-month-out-of-range\">question</a> but I couldn't understand why.</p>\n\n<p>This is the error I'm getting after running my code:</p>\n\n<pre><code>parsing time \"2016-12-25 22:40:00\": month out of range\n0001-01-01 00:00:00 +0000 UTC\n</code></pre>\n\n<p>Any ideas on what am I doing wrong?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478271341, "post_id": 40425479, "comment_id": 68099712, "body": "You should now use <code>DialContext</code>. See the definition for DefaultTransport in the <a href=\"https://golang.org/pkg/net/http/#RoundTripper\" rel=\"nofollow noreferrer\"><code>http</code> package</a> for an example."}, {"owner": {"reputation": 583, "user_id": 2362525, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ee17973702491f1e574c33b908e8ee38?s=128&d=identicon&r=PG", "display_name": "Bento", "link": "https://stackoverflow.com/users/2362525/bento"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478271823, "post_id": 40425479, "comment_id": 68100032, "body": "Getting the same error when using DialContext as with @T.Claverie&#39;s answer:   Error: dial tcp: mismatched local address type 192.168.0.1"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478273376, "post_id": 40425479, "comment_id": 68101143, "body": "That&#39;s has nothing to do with using the DialContext or not. I&#39;m just informing you that Dial is deprecated and you should prefer DialContext."}], "answers": [{"comments": [{"owner": {"reputation": 583, "user_id": 2362525, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ee17973702491f1e574c33b908e8ee38?s=128&d=identicon&r=PG", "display_name": "Bento", "link": "https://stackoverflow.com/users/2362525/bento"}, "edited": false, "score": 0, "creation_date": 1478271404, "post_id": 40425653, "comment_id": 68099757, "body": "Thanks that produces no error. Only somehow the http.Get never reaches the server defined in var url. When checking http logs I see no requests and  fmt.Println(response) procudes: &lt;nil&gt;  Error: dial tcp: mismatched local address type 192.168.0.1"}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "reply_to_user": {"reputation": 583, "user_id": 2362525, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ee17973702491f1e574c33b908e8ee38?s=128&d=identicon&r=PG", "display_name": "Bento", "link": "https://stackoverflow.com/users/2362525/bento"}, "edited": false, "score": 0, "creation_date": 1478271594, "post_id": 40425653, "comment_id": 68099899, "body": "This issue is unrelated to this thread, maybe you should post another question."}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 3, "last_activity_date": 1478271185, "creation_date": 1478271185, "answer_id": 40425653, "question_id": 40425479, "link": "https://stackoverflow.com/questions/40425479/net-ip-does-not-implement-net-addr-missing-network-method/40425653#40425653", "title": "net.IP does not implement net.Addr (missing Network method)", "body": "<p>According to the documentation, indeed the <code>IP</code> type does not implement <code>Addr</code>. However, the type <code>IPAddr</code> does:</p>\n\n<pre><code>type IPAddr struct {\n    IP   IP\n    Zone string // IPv6 scoped addressing zone\n}\n</code></pre>\n\n<p>Therefore, your code becomes:</p>\n\n<pre><code>q := net.ParseIP(\"192.168.0.1\")\naddr := &amp;net.IPAddr{q,\"\"}\n\nvar transport = &amp;http.Transport{\n    Dial: (&amp;net.Dialer{\n        LocalAddr: addr,\n    }).Dial,\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 3, "last_activity_date": 1478271192, "creation_date": 1478271192, "answer_id": 40425655, "question_id": 40425479, "link": "https://stackoverflow.com/questions/40425479/net-ip-does-not-implement-net-addr-missing-network-method/40425655#40425655", "title": "net.IP does not implement net.Addr (missing Network method)", "body": "<p>Use the Docs, Luke...</p>\n\n<p><a href=\"https://golang.org/pkg/net/#ResolveIPAddr\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/#ResolveIPAddr</a></p>\n\n<p>If you use the IPAddr struct, that should solve your problem.</p>\n"}], "owner": {"reputation": 583, "user_id": 2362525, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ee17973702491f1e574c33b908e8ee38?s=128&d=identicon&r=PG", "display_name": "Bento", "link": "https://stackoverflow.com/users/2362525/bento"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3699, "favorite_count": 0, "accepted_answer_id": 40425653, "answer_count": 2, "score": 2, "last_activity_date": 1478271192, "creation_date": 1478270591, "question_id": 40425479, "link": "https://stackoverflow.com/questions/40425479/net-ip-does-not-implement-net-addr-missing-network-method", "title": "net.IP does not implement net.Addr (missing Network method)", "body": "<p>I have the following code. I'm getting this error:</p>\n\n<p>testdl.go:17: cannot use q (type net.IP) as type net.Addr in field value:\n    net.IP does not implement net.Addr (missing Network method)</p>\n\n<p>Any idea how to put a hardcoded IP into LocalAddr?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"net/http\"\n)\n\nvar url = \"http://URL/api.xml\"\n\nfunc main() {\n\n    q := net.ParseIP(\"192.168.0.1\")\n\n    var transport = &amp;http.Transport{\n        Dial: (&amp;net.Dialer{\n            LocalAddr: q,\n        }).Dial,\n    }\n    var httpclient = &amp;http.Client{\n        Transport: transport,\n    }\n\n    response, err := httpclient.Get(url)\n    fmt.Println(response)\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1478271450, "post_id": 40424864, "comment_id": 68099793, "body": "Have you considered storing the JSON in NoSQL storage? Writing all those file to disk seems a bit wasteful (and error-prone IMO)"}], "answers": [{"comments": [{"owner": {"reputation": 27533, "user_id": 998117, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/bfe07f542ce4f5d75e4262e188691fd5?s=128&d=identicon&r=PG&f=1", "display_name": "Doug Smith", "link": "https://stackoverflow.com/users/998117/doug-smith"}, "edited": false, "score": 0, "creation_date": 1478269598, "post_id": 40424932, "comment_id": 68098465, "body": "But what if I don&#39;t want the file to be temporary?"}, {"owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "edited": false, "score": 2, "creation_date": 1478269893, "post_id": 40424932, "comment_id": 68098694, "body": "It&#39;s not temporary in that it will auto delete at some point in the future. You have to explicitly delete it when you&#39;re done with it <code>os.Remove(f.Name())</code> but it will stay otherwise."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 27533, "user_id": 998117, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/bfe07f542ce4f5d75e4262e188691fd5?s=128&d=identicon&r=PG&f=1", "display_name": "Doug Smith", "link": "https://stackoverflow.com/users/998117/doug-smith"}, "edited": false, "score": 2, "creation_date": 1478270045, "post_id": 40424932, "comment_id": 68098797, "body": "@DougSmith: the only other time it would be temporary in some sense, is if you don&#39;t specify a directory and the file is put into an ephemeral temp dir by default, i.e. some systems may periodically clean out <code>$TMPDIR</code>."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1478269003, "creation_date": 1478269003, "answer_id": 40424932, "question_id": 40424864, "link": "https://stackoverflow.com/questions/40424864/repeatedly-storing-json-logs-as-files-with-go-and-ensuring-unique-filenames/40424932#40424932", "title": "Repeatedly storing JSON logs as files with Go and ensuring unique filenames", "body": "<p>Whether it's agood idea or not is subjective, but you can use <a href=\"https://golang.org/pkg/io/ioutil/#TempFile\" rel=\"nofollow noreferrer\"><code>ioutil.TempFile</code></a> to ensure you have unique filenames. <code>TempFile</code> will append a guaranteed unique suffix to the file prefix you choose.</p>\n\n<pre><code>f, err := ioutil.TempFile(storeDirectory, fileName)\n</code></pre>\n"}], "owner": {"reputation": 27533, "user_id": 998117, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/bfe07f542ce4f5d75e4262e188691fd5?s=128&d=identicon&r=PG&f=1", "display_name": "Doug Smith", "link": "https://stackoverflow.com/users/998117/doug-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25, "favorite_count": 0, "accepted_answer_id": 40424932, "answer_count": 1, "score": 0, "last_activity_date": 1478269003, "creation_date": 1478268789, "question_id": 40424864, "link": "https://stackoverflow.com/questions/40424864/repeatedly-storing-json-logs-as-files-with-go-and-ensuring-unique-filenames", "title": "Repeatedly storing JSON logs as files with Go and ensuring unique filenames", "body": "<p>A bit of a newcomer to Go, and I'm effectively receiving a small (~1KB) JSON file from an API repeatedly that is effectively a log, and I want to keep each one of these files. </p>\n\n<p>I'm thinking just storing each JSON block as a unique file (in lieu of using a database, which seems unnecessary) in a specific directory. </p>\n\n<p>First off, is this an okay idea? There could be potentially a few hundred per day.</p>\n\n<p>More importantly, how do I ensure uniqueness across filenames? Obviously I can't just save each one as <code>log.json</code> and call it a day, as there would be conflicts. How would I ensure uniqueness?</p>\n"}, {"tags": ["go", "deadlock", "goroutine"], "comments": [{"owner": {"reputation": 10078, "user_id": 2709018, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p98Vl.png?s=128&g=1", "display_name": "myaut", "link": "https://stackoverflow.com/users/2709018/myaut"}, "edited": false, "score": 1, "creation_date": 1478265653, "post_id": 40423461, "comment_id": 68095631, "body": "At first sight you write to <code>done</code> at least 5 times, but read from it only once."}, {"owner": {"reputation": 341, "user_id": 762819, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c6844ebd54cc6a24fa258376445066db?s=128&d=identicon&r=PG", "display_name": "Pratyush", "link": "https://stackoverflow.com/users/762819/pratyush"}, "reply_to_user": {"reputation": 10078, "user_id": 2709018, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p98Vl.png?s=128&g=1", "display_name": "myaut", "link": "https://stackoverflow.com/users/2709018/myaut"}, "edited": false, "score": 0, "creation_date": 1478266724, "post_id": 40423461, "comment_id": 68096381, "body": "@myaut , That is the intention. I am only interested in the first instance of data being written to done."}], "answers": [{"comments": [{"owner": {"reputation": 341, "user_id": 762819, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c6844ebd54cc6a24fa258376445066db?s=128&d=identicon&r=PG", "display_name": "Pratyush", "link": "https://stackoverflow.com/users/762819/pratyush"}, "edited": false, "score": 0, "creation_date": 1478267512, "post_id": 40423745, "comment_id": 68096900, "body": "Thanks for the answer with WaitGroup. I think that is a better solution to synchronize multiple goroutines."}, {"owner": {"reputation": 341, "user_id": 762819, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c6844ebd54cc6a24fa258376445066db?s=128&d=identicon&r=PG", "display_name": "Pratyush", "link": "https://stackoverflow.com/users/762819/pratyush"}, "edited": false, "score": 0, "creation_date": 1478267715, "post_id": 40423745, "comment_id": 68097060, "body": "&quot;<i>because nothing is receiving on the other side</i>&quot;  According to the code there was 1 line which was actually receiving data on the other side <code>fmt.Println( &quot;...........&gt;&quot;, &lt;- done )</code>. I moved the line up in the execution order and it worked fine. I suppose a channel needs to have consumer while data is being written and not sometime in the future."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 341, "user_id": 762819, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c6844ebd54cc6a24fa258376445066db?s=128&d=identicon&r=PG", "display_name": "Pratyush", "link": "https://stackoverflow.com/users/762819/pratyush"}, "edited": false, "score": 0, "creation_date": 1478267795, "post_id": 40423745, "comment_id": 68097126, "body": "@Pratyush: yes, there was 1 receive, but you need to receive continuously to keep those for loops going."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1478266778, "last_edit_date": 1478266778, "creation_date": 1478265645, "answer_id": 40423745, "question_id": 40423461, "link": "https://stackoverflow.com/questions/40423461/goroutine-asleep-deadlock/40423745#40423745", "title": "goroutine asleep - deadlock", "body": "<p>You're blocking the iteration over the channel in your handle function with the send on the <code>done</code> channel, because nothing is receiving on the other side.</p>\n\n<p>Those extra channels aren't really doing anything, and you could just add a <code>WaitGroup</code> to synchronize the handler's exit, then you can remove the <code>done</code> channel which will allow the handler to continue. </p>\n\n<pre><code>func handle(queue chan *Request, i int, wg *sync.WaitGroup) {\n    defer wg.Done()\n\n    for r := range queue {\n        fmt.Println(i, \"---\", r)\n    }\n}\n\nfunc Serve(clientRequests chan *Request, wg *sync.WaitGroup) {\n    // Start handlers\n    for i := 0; i &lt; MaxOutstanding; i++ {\n        wg.Add(1)\n        go handle(clientRequests, i, wg)\n\n    }\n}\n\nfunc main() {\n    clientRequests := make(chan *Request)\n    var wg sync.WaitGroup\n\n    go Serve(clientRequests, &amp;wg)\n\n    for i := int32(0); i &lt; 50; i++ {\n        clientRequests &lt;- &amp;Request{i}\n    }\n\n    close(clientRequests)\n    wg.Wait()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/oUFjZONjhk\" rel=\"nofollow noreferrer\">https://play.golang.org/p/oUFjZONjhk</a> (note that in the playground, this example seems to currently favor a single goroutine being the receiver. Normally the blocked goroutines will receive randomly, and you can see that behavior if you compile and run normally)</p>\n"}, {"comments": [{"owner": {"reputation": 341, "user_id": 762819, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c6844ebd54cc6a24fa258376445066db?s=128&d=identicon&r=PG", "display_name": "Pratyush", "link": "https://stackoverflow.com/users/762819/pratyush"}, "edited": false, "score": 1, "creation_date": 1478266437, "post_id": 40423754, "comment_id": 68096164, "body": "If I change the for loop in the main function to <code>for i := 0; i &lt; 100; i++</code> I get the deadlock error - <a href=\"https://play.golang.org/p/rT2aa-sllX\" rel=\"nofollow noreferrer\">play.golang.org/p/rT2aa-sllX</a>"}, {"owner": {"reputation": 341, "user_id": 762819, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c6844ebd54cc6a24fa258376445066db?s=128&d=identicon&r=PG", "display_name": "Pratyush", "link": "https://stackoverflow.com/users/762819/pratyush"}, "edited": false, "score": 1, "creation_date": 1478267334, "post_id": 40423754, "comment_id": 68096782, "body": "I moved the code to drain up in the queue <code>done</code> up in the execution order and it seems to work fine. <a href=\"https://play.golang.org/p/UxCu1220--\" rel=\"nofollow noreferrer\">play.golang.org/p/UxCu1220--</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 341, "user_id": 762819, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c6844ebd54cc6a24fa258376445066db?s=128&d=identicon&r=PG", "display_name": "Pratyush", "link": "https://stackoverflow.com/users/762819/pratyush"}, "edited": false, "score": 1, "creation_date": 1478267723, "post_id": 40423754, "comment_id": 68097071, "body": "@Pratyush:  doesn&#39;t really work with the final <code>&lt;-done</code> at the end because you&#39;re racing another deadlock: <a href=\"https://play.golang.org/p/_hzsC3LKIs\" rel=\"nofollow noreferrer\">play.golang.org/p/_hzsC3LKIs</a>"}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 1, "last_activity_date": 1478265672, "creation_date": 1478265672, "answer_id": 40423754, "question_id": 40423461, "link": "https://stackoverflow.com/questions/40423461/goroutine-asleep-deadlock/40423754#40423754", "title": "goroutine asleep - deadlock", "body": "<p>Inside the for loop you are handling the channel operation only to the 5th element, however in the main function you are trying to send over the value to the channel, which is closed.</p>\n\n<p>To overcome this situation you can send the request value inside a for loop:</p>\n\n<pre><code>for i := 0; i &lt; MaxOutstanding; i++ {\n        clientRequests &lt;- &amp;Request{int32(i)}\n}\n</code></pre>\n\n<p>Here is the working code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Request struct {\n    int32\n}\n\nvar MaxOutstanding = 10\n\nfunc handle(queue chan *Request, i int, done chan bool) {\n    for r := range queue {\n        fmt.Println(i, \"---\", r)\n        done &lt;- true\n    }\n}\n\nfunc Serve(clientRequests chan *Request, quit, done chan bool) {\n    // Start handlers\n    for i := 0; i &lt; MaxOutstanding; i++ {\n        go handle(clientRequests, i, done)\n    }\n    &lt;-quit // Wait to be told to exit.\n}\n\nfunc main() {\n    clientRequests := make(chan *Request)\n    quit := make(chan bool)\n    done := make(chan bool)\n\n    go Serve(clientRequests, quit, done)\n    for i := 0; i &lt; MaxOutstanding; i++ {\n        clientRequests &lt;- &amp;Request{int32(i)}\n    }\n\n    fmt.Println(\"...........&gt;\", &lt;-done)\n    close(clientRequests)\n    close(done)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/L5Y2YoFNvz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/L5Y2YoFNvz</a></p>\n"}], "owner": {"reputation": 341, "user_id": 762819, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c6844ebd54cc6a24fa258376445066db?s=128&d=identicon&r=PG", "display_name": "Pratyush", "link": "https://stackoverflow.com/users/762819/pratyush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 40423745, "answer_count": 2, "score": 1, "last_activity_date": 1478267885, "creation_date": 1478264774, "last_edit_date": 1478267885, "question_id": 40423461, "link": "https://stackoverflow.com/questions/40423461/goroutine-asleep-deadlock", "title": "goroutine asleep - deadlock", "body": "<p>In the following code I am trying to spawn <code>MaxOutstanding</code> number of handlers. Each handler loops over items in the queue <code>queue</code> and prints them out, I also write <code>true</code> to the <code>done</code> channel.</p>\n\n<p>In my main function, I start the handlers and write 9 elements to the <code>queue</code> and wait for the 1st element to be written to the <code>done</code> queue.</p>\n\n<pre><code>package main\n\n\nimport \"fmt\"\n\ntype Request struct {\n        int32\n}\nvar MaxOutstanding = 5\nfunc handle(queue chan *Request, i int, done chan bool) {\n    for r := range queue {\n        fmt.Println(i, \"---\", r)\n        done &lt;- true\n    }\n}\n\nfunc Serve(clientRequests chan *Request, quit, done chan bool) {\n    // Start handlers\n    for i := 0; i &lt; MaxOutstanding; i++ {\n        go handle(clientRequests, i, done)\n    }\n    &lt;-quit  // Wait to be told to exit.\n}\n\n\nfunc main() {\n    clientRequests := make(chan *Request)\n    quit := make(chan bool)\n    done := make(chan bool)\n\n    go Serve(clientRequests, quit, done)\n\n    clientRequests &lt;- &amp;Request{4}\n    clientRequests &lt;- &amp;Request{1}\n    clientRequests &lt;- &amp;Request{2}\n    clientRequests &lt;- &amp;Request{3}\n\n    clientRequests &lt;- &amp;Request{5}\n    clientRequests &lt;- &amp;Request{6}\n    clientRequests &lt;- &amp;Request{7}\n    clientRequests &lt;- &amp;Request{8}\n    clientRequests &lt;- &amp;Request{9}\n    fmt.Println( \"...........&gt;\", &lt;- done )\n    close(clientRequests)\n    close(done)\n}\n</code></pre>\n\n<p>On execution I get the following error. I don't see whats wrong with the implementation, I am even closing the channel.</p>\n\n<pre><code>4 --- &amp;{4}\n0 --- &amp;{1}\n1 --- &amp;{2}\n2 --- &amp;{3}\n3 --- &amp;{5}\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan send]:\nmain.main()\n        /home/ubuntu/digs-svc/src/digs/go1.go:45 +0x251\n\ngoroutine 5 [chan receive]:\nmain.Serve(0xc82004c060, 0xc82004c0c0, 0xc82004c120)\n        /home/ubuntu/digs-svc/src/digs/go1.go:28 +0x92\ncreated by main.main\n        /home/ubuntu/digs-svc/src/digs/go1.go:37 +0xb9\n\ngoroutine 6 [chan send]:\nmain.handle(0xc82004c060, 0x0, 0xc82004c120)\n        /home/ubuntu/digs-svc/src/digs/go1.go:16 +0x23b\ncreated by main.Serve\n        /home/ubuntu/digs-svc/src/digs/go1.go:25 +0x5b\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>Apparently, the <code>fmt.Println(\"....\", &lt;- done)</code> wasn't enough to signify that there is a consumer to the <code>done</code> channel. I moved the code up in the execution order. A consumer needs to be \"listening\" on the channel when data is written to it. In my earlier code, the when the first data was written there were no consumer.</p>\n\n<p>Working code.</p>\n\n<p><a href=\"https://play.golang.org/p/98l2M4XO9t\" rel=\"nofollow noreferrer\">https://play.golang.org/p/98l2M4XO9t</a></p>\n"}, {"tags": ["asynchronous", "go", "zeromq"], "comments": [{"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1478263369, "post_id": 40422572, "comment_id": 68094202, "body": "It should be blocking by default, as <i>zeromq</i> is blocking by default. Please share a code example."}, {"owner": {"reputation": 2118, "user_id": 6360083, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1f8b36d7776a9f46b9206cdfa036c38?s=128&d=identicon&r=PG&f=1", "display_name": "Techradar", "link": "https://stackoverflow.com/users/6360083/techradar"}, "reply_to_user": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1478263906, "post_id": 40422572, "comment_id": 68094532, "body": "@Mario Santini Did update the initial post ;-)"}, {"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1478266982, "post_id": 40422572, "comment_id": 68096551, "body": "I don&#39;t think your issue is with the zeromq asynchrounous staff. Instead of <i>zmq4.DONTWAIT</i> you could pass 0. Now it is asynchronous because you pass the <i>DONTWAIT</i> flag."}, {"owner": {"reputation": 2118, "user_id": 6360083, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1f8b36d7776a9f46b9206cdfa036c38?s=128&d=identicon&r=PG&f=1", "display_name": "Techradar", "link": "https://stackoverflow.com/users/6360083/techradar"}, "reply_to_user": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1478522078, "post_id": 40422572, "comment_id": 68174846, "body": "That was part of my questions, if theres something to set it to block (the 0 for example)."}], "answers": [{"comments": [{"owner": {"reputation": 2118, "user_id": 6360083, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1f8b36d7776a9f46b9206cdfa036c38?s=128&d=identicon&r=PG&f=1", "display_name": "Techradar", "link": "https://stackoverflow.com/users/6360083/techradar"}, "edited": false, "score": 0, "creation_date": 1478522039, "post_id": 40429820, "comment_id": 68174815, "body": "Thanks a lot for this answer! Helped a lot!"}], "tags": [], "owner": {"reputation": 1, "user_id": 3666197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79fc6c23061326c7e6a6f82a1663634b?s=128&d=identicon&r=PG", "display_name": "user3666197", "link": "https://stackoverflow.com/users/3666197/user3666197"}, "is_accepted": true, "score": 2, "last_activity_date": 1494691049, "last_edit_date": 1495540503, "creation_date": 1478285104, "answer_id": 40429820, "question_id": 40422572, "link": "https://stackoverflow.com/questions/40422572/golang-zeromq-req-rep-senseless-non-blocking/40429820#40429820", "title": "Golang ZeroMQ: REQ/REP senseless non-blocking", "body": "<p>ZeroMQ trivial elementary archetypes are more <strong>a set of building blocks</strong> than a production-grade solution to any need.</p>\n\n<p>Go-lang is a very powerful, modern language with coroutines and other smart tools for a controlled concurrency, so forgive me to state the following list of recommendations:</p>\n\n<ul>\n<li><p><strong>avoid blocking designs</strong> wherever one can ( a non-blocking design leaves one in full control of all things as they come ... <strong>not \"hanging\" in any</strong> infinite/uncontrollable <strong>waiting loop</strong>, the worse in an already developed deadlock )</p></li>\n<li><p><strong>avoid relying on a SLOC examples</strong> with a single, elementary type of a Formal Communication Pattern, one shall rather develop a <strong>robust survivability-handler strategy</strong> for all the cases where something may go wrong ( Loss-of-Signal in transport network, Loss-of-Message, DDoS-level of resources overloads, ... )</p></li>\n</ul>\n\n<hr>\n\n<h2>Redesign hint - do not use <strong><code>REQ/REP</code></strong> at all. Yes, never...</h2>\n\n<p>ZeroMQ Scaleable Formal Communication Pattern <code>REQ/REP</code> is fine for learning ZeroMQ, but is lethal in real production grade deployment. <a href=\"https://stackoverflow.com/a/40429335/3666197\">For details, read here</a>.</p>\n\n<p>Next think about internally unconditional patterns, alike <strong><code>PAIR</code></strong> ( though marked <em>experimental</em>, for some use-cases it works great ), <strong><code>XREQ/XREP</code></strong>, <strong><code>PUSH/PULL</code></strong> or some composite signalling/transport multi-socket custom-designed own pattern.</p>\n\n<h2>The best next step?</h2>\n\n<p><a href=\"https://stackoverflow.com/a/25742744/3666197\">What I can do for your further questions right now is to direct you to see a bigger picture on this subject</a> with more arguments, a simple signalling-plane / messaging-plane illustration and a direct link to a must-read book from Pieter HINTJENS.</p>\n\n<p>The book is worth one's time and efforts. If one is serious into distributed systems design, you will love it altogether with Pieter's passion for Zero-sharing, Zero-blocking, (almost) Zero-copy et al.</p>\n"}], "owner": {"reputation": 2118, "user_id": 6360083, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1f8b36d7776a9f46b9206cdfa036c38?s=128&d=identicon&r=PG&f=1", "display_name": "Techradar", "link": "https://stackoverflow.com/users/6360083/techradar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2036, "favorite_count": 1, "accepted_answer_id": 40429820, "answer_count": 1, "score": 2, "last_activity_date": 1494691049, "creation_date": 1478262169, "last_edit_date": 1478283923, "question_id": 40422572, "link": "https://stackoverflow.com/questions/40422572/golang-zeromq-req-rep-senseless-non-blocking", "title": "Golang ZeroMQ: REQ/REP senseless non-blocking", "body": "<p>On Python, the ZeroMQ <strong><code>.recv()/.send()</code></strong> operations are blocking, which is just perfect for <strong><code>REQ/REP</code></strong>.<br>In Golang, I must pass a <strong><code>zmq.DONTWAIT</code></strong> to the <code>.recv()</code> and <code>.send()</code> operation in order to make it work.</p>\n\n<p>But the thing is, the flow needs to be lock step, so:</p>\n\n<ol>\n<li><code>server.recv()</code></li>\n<li><code>client.send()</code></li>\n<li><code>client.recv()</code></li>\n<li><code>server.send()</code></li>\n</ol>\n\n<p>And between 3 and 4 the weirdness starts, because they are async.</p>\n\n<p>When the client has sent a message and the server has not received it yet but client tries to receive a response, the lock step is no lock step any more. </p>\n\n<p>Is there some kind of <strong><code>zmq.DOBLOCK</code></strong> in contrast to <strong><code>zmq.DONTWAIT</code></strong>?</p>\n\n<p>Or did I get something wrong here?</p>\n\n<hr>\n\n<p><strong><code>EDIT:</code></strong> </p>\n\n<p>I am using this go binding in C for zeromq: <a href=\"https://godoc.org/github.com/pebbe/zmq4#Type\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/pebbe/zmq4#Type</a></p>\n\n<p>As you can see here the <strong><code>.recv()</code></strong> needs a input <code>flag</code>, which is one of the both on the second ref:</p>\n\n<p>Recv: <a href=\"https://godoc.org/github.com/pebbe/zmq4#Socket.Recv\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/pebbe/zmq4#Socket.Recv</a></p>\n\n<p>Flags to be passed: <a href=\"https://github.com/pebbe/zmq4/blob/master/zmq4.go#L403\" rel=\"nofollow noreferrer\">https://github.com/pebbe/zmq4/blob/master/zmq4.go#L403</a></p>\n\n<p>This is the current code I got to make a workaround which feels somewhat ugly:</p>\n\n<pre><code>package connection\n\nimport (\n  \"zmq4\"\n  \"fmt\"\n  \"time\"\n)\n\n\nconst ERRTMPUNAV=\"resource temporarily unavailable\"\n\n\nfunc checkError(e error){\n  if e != nil {\n    panic(e)\n  }\n}\n\n\nfunc CreateRepNode(address string,onMessage chan&lt;- string,send &lt;-chan string,closeConn &lt;-chan bool){\n  stop:=false\n  socket,err:=zmq4.NewSocket(zmq4.REP)\n  checkError(err)\n  err=socket.Bind(address)\n  checkError(err)\n  go func(socket *zmq4.Socket){\n    for {\n      msg,err:=socket.Recv(zmq4.DONTWAIT)\n      fmt.Println(\"server message\"+msg)\n      if stop==true {\n        return\n      }\n      if err != nil {\n        rateLimit := time.Tick(100 * time.Millisecond)\n    &lt;-rateLimit\n    continue\n      }\n      checkError(err)\n      onMessage&lt;-msg\n      rep:=&lt;-send\n      _,err=socket.Send(rep,zmq4.DONTWAIT)\n    }\n  }(socket)\n  &lt;-closeConn\n  stop=true\n}\n\n\nfunc CreateReqNode(address string,onMessage chan&lt;- string,send &lt;-chan string,closeConn &lt;-chan bool){\n  stop:=false\n  socket,err:=zmq4.NewSocket(zmq4.REQ)\n  checkError(err)\n  err=socket.Connect(address)\n  checkError(err)\n  go func(){\n    for {\n      msg:=&lt;-send\n      if stop==true {\n        return\n      }\n      _,err:=socket.Send(msg,zmq4.DONTWAIT)\n      for {\n        msg,err=socket.Recv(zmq4.DONTWAIT)\n        fmt.Println(\"client got message \"+msg)\n        if err!=nil {\n          if err.Error()==ERRTMPUNAV {\n            w:=time.Tick(100*time.Millisecond)\n            &lt;-w\n            continue\n          }\n        }\n        break\n      }\n      onMessage&lt;-msg\n    }\n  }()\n\n  &lt;-closeConn\n  stop=true\n}\n</code></pre>\n"}, {"tags": ["mysql", "go"], "answers": [{"tags": [], "owner": {"reputation": 49, "user_id": 1627505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5954ba1c44f6a60f2fff629c08b47627?s=128&d=identicon&r=PG", "display_name": "DenisG", "link": "https://stackoverflow.com/users/1627505/denisg"}, "is_accepted": false, "score": 0, "last_activity_date": 1478262824, "creation_date": 1478262824, "answer_id": 40422792, "question_id": 40421204, "link": "https://stackoverflow.com/questions/40421204/invalid-memory-address-or-nil-pointer-dereference-with-sql-db/40422792#40422792", "title": "invalid memory address or nil pointer dereference with sql.DB", "body": "<p>You are right about your DB handle not being saved. You are defining your methods on a value receiver. Therefore you receive a copy inside the <code>Connect</code> method and modify said copy. This copy is then dropped at the end of the <code>Connect</code> method. </p>\n\n<p>You have to define your method on a pointer to your structure:</p>\n\n<pre><code>func (dbUtil *DBUtils) Connect() {\n  var err error\n  dbUtil.Handle, err = sql.Open(\"mysql\", dbUtil.User + \":\" + dbUtil.Password + \"@tcp(\" + dbUtil.Host + \")/\" + dbUtil.Database)\n  if err != nil {\n    panic(err.Error()) \n  }\n\n  err = dbUtil.Handle.Ping()\n  if err != nil {\n    panic(err.Error())\n  }\n\n  fmt.Printf(\"%v\", dbUtil)\n}\n</code></pre>\n\n<p>For further information see <a href=\"https://golang.org/doc/faq#methods_on_values_or_pointers\" rel=\"nofollow noreferrer\">https://golang.org/doc/faq#methods_on_values_or_pointers</a>.</p>\n\n<p>Note: I noticed your usage of <code>QueryRow</code>. It accepts arguments for parameters in your prepare statement. You have no parameters there, so I think you should not pass any parameters. You should also check the <code>Scan</code> result for errors (see <a href=\"https://golang.org/pkg/database/sql/#Stmt\" rel=\"nofollow noreferrer\">https://golang.org/pkg/database/sql/#Stmt</a>).</p>\n"}, {"comments": [{"owner": {"reputation": 151, "user_id": 2225581, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b71541dcd4f33c2c2c3a811d5957334f?s=128&d=identicon&r=PG", "display_name": "ovmcit5eoivc4", "link": "https://stackoverflow.com/users/2225581/ovmcit5eoivc4"}, "edited": false, "score": 0, "creation_date": 1478952877, "post_id": 40426020, "comment_id": 68362334, "body": "Thanks for the very nice explanation! Though I think   func (dbUtil *DBUtils) Connect() { is a weird structure of definition of class-related methods if you&#39;re more familiar with anything C like.  Is func (dbUtil *DBUtils) / func (dbUtil DBUtils) something like static functions in classes in PHP?"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 151, "user_id": 2225581, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b71541dcd4f33c2c2c3a811d5957334f?s=128&d=identicon&r=PG", "display_name": "ovmcit5eoivc4", "link": "https://stackoverflow.com/users/2225581/ovmcit5eoivc4"}, "edited": false, "score": 0, "creation_date": 1478953945, "post_id": 40426020, "comment_id": 68362626, "body": "@user2225581: Not really. Static methods in PHP don&#39;t give you access to a particular instance of the object, only its static/global state. Go structs don&#39;t really have that kind of state. In both <code>func (o Oject) FuncName(){}</code> and <code>func (o *Object) FuncName(){}</code> you&#39;ll get access to a specific instance. The difference between the two is that the latter gives you access via a pointer, the first version creates a <i>copy</i> of the object. You can modify the object in both cases, but if you&#39;re working on a copy, the original object is not affected."}, {"owner": {"reputation": 151, "user_id": 2225581, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b71541dcd4f33c2c2c3a811d5957334f?s=128&d=identicon&r=PG", "display_name": "ovmcit5eoivc4", "link": "https://stackoverflow.com/users/2225581/ovmcit5eoivc4"}, "edited": false, "score": 0, "creation_date": 1478956561, "post_id": 40426020, "comment_id": 68363312, "body": "Ah, now I understand. Thank you so much and have a nice day!"}], "tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": true, "score": 2, "last_activity_date": 1478272243, "creation_date": 1478272243, "answer_id": 40426020, "question_id": 40421204, "link": "https://stackoverflow.com/questions/40421204/invalid-memory-address-or-nil-pointer-dereference-with-sql-db/40426020#40426020", "title": "invalid memory address or nil pointer dereference with sql.DB", "body": "<p>Your <code>Connect</code> method is not changing the state of the object you're calling the method on. You're working on a copy of the type. If you want a method to change the object itself, you'll have to define it on a pointer:</p>\n\n<pre><code>func (dbUtil *DBUtils) Connect() {\n//instead of\nfunc (dbUtil DBUtils) Connect() {\n</code></pre>\n\n<p>If you're familiar with C or C++, your current method works similarly to something like:</p>\n\n<pre><code>void connect_db(struct db_utils db_util)\n{}\n</code></pre>\n\n<p>When you call a function like that, you're creating a copy of the argument, and push that on to the stack. The <code>connect_db</code> function will work with that, and after it returns, the copy is deallocated.</p>\n\n<p>compare it to this C code:</p>\n\n<pre><code>struct foo {\n    int bar;\n};\nstatic\nvoid change_copy(struct foo bar)\n{\n    bar.bar *= 2;\n}\n\nstatic\nvoid change_ptr(struct foo *bar)\n{\n    bar-&gt;bar *= 2;\n}\n\nint main ( void )\n{\n    struct foo bar = {10};\n    printf(\"%d\\n\", bar.bar);//prints 10\n    change_copy(bar);//pass by value\n    printf(\"%d\\n\", bar.bar);//still prints 10\n    change_ptr(&amp;bar);\n    printf(\"%d\\n\", bar.bar);//prints 20\n    return 0;\n}\n</code></pre>\n\n<p>The same thing happens in go. The object on which you define the method can only change state of the instance if it has access to the instance. If not, it can't update that part of the memory.</p>\n\n<p>In case you're wondering, this method doesn't need to be defined on the pointer type:</p>\n\n<pre><code>func (dbUtil DBUtils) Close() {\n  dbUtil.Handle.Close()\n}\n</code></pre>\n\n<p>The reason for this being that <code>DBUtils.Handle</code> is a pointer type. A copy of that pointer will always point to the same resource.</p>\n\n<p>I will say this, though: given that you're essentially wrapping the handle, and you're exposing the <code>Connect</code> and <code>Close</code> methods, the member itself really shouldn't be exported. I'd change it to lower-case <code>handle</code></p>\n"}], "owner": {"reputation": 151, "user_id": 2225581, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b71541dcd4f33c2c2c3a811d5957334f?s=128&d=identicon&r=PG", "display_name": "ovmcit5eoivc4", "link": "https://stackoverflow.com/users/2225581/ovmcit5eoivc4"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1675, "favorite_count": 0, "accepted_answer_id": 40426020, "answer_count": 2, "score": 1, "last_activity_date": 1478272243, "creation_date": 1478257924, "question_id": 40421204, "link": "https://stackoverflow.com/questions/40421204/invalid-memory-address-or-nil-pointer-dereference-with-sql-db", "title": "invalid memory address or nil pointer dereference with sql.DB", "body": "<p>I'm learning Go at the moment and trying to make a little SQL-toolset:</p>\n\n<pre><code>type DBUtils struct {\n  User string\n  Password string\n  Host string\n  Database string\n  Handle *sql.DB\n}\n\nfunc (dbUtil DBUtils) Connect() {\n  var err error\n  dbUtil.Handle, err = sql.Open(\"mysql\", dbUtil.User + \":\" + dbUtil.Password + \"@tcp(\" + dbUtil.Host + \")/\" + dbUtil.Database)\n  if err != nil {\n    panic(err.Error()) \n  }\n\n  err = dbUtil.Handle.Ping()\n  if err != nil {\n    panic(err.Error())\n  }\n\n  fmt.Printf(\"%v\", dbUtil)\n}\n\nfunc (dbUtil DBUtils) Close() {\n  dbUtil.Handle.Close()\n}\n\nfunc (dbUtil DBUtils) GetString(what string, from string, where string, wherevalue string) string {\n  var username string\n\n  fmt.Printf(\"%v\", dbUtil)\n\n  stmtOut, err := dbUtil.Handle.Prepare(\"SELECT \" + what + \" FROM \" + from + \" WHERE \" + where + \" = \" + wherevalue)\n  if err != nil {\n      panic(err.Error()) // proper error handling instead of panic in your app\n  }\n\n  err = stmtOut.QueryRow(1).Scan(&amp;username)\n\n  return username\n}\n</code></pre>\n\n<p>So when using this with the following code:</p>\n\n<pre><code>db := databaseutils.DBUtils{\"root\", \"root\", \"127.0.0.1:3306\", \"gotest\", nil}    \ndb.Connect() // I get: {root root 127.0.0.1:3306 gotest 0xc42019d600}\nfmt.Printf(\"%v\", db) // I get {root root 127.0.0.1:3306 gotest &lt;nil&gt;}\nx := db.GetString(\"username\", \"users\", \"id\", \"1\") // Doesn't work: panic: runtime error: invalid memory address or nil pointer dereference\nfmt.Println(x)\n</code></pre>\n\n<p>For me it seems like my DB handle isn't saved properly? Does anyone have an idea - I'm pretty new to go and there are many things looking different to PHP, JS, C++ etc.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["go", "hyperledger"], "comments": [{"owner": {"reputation": 15819, "user_id": 1149423, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KmNLc.png?s=128&g=1", "display_name": "Sufiyan Ghori", "link": "https://stackoverflow.com/users/1149423/sufiyan-ghori"}, "edited": false, "score": 0, "creation_date": 1478329965, "post_id": 40420278, "comment_id": 68119048, "body": "are you referring to something like this <a href=\"https://github.com/hyperledger-archives/fabric/pull/1388\" rel=\"nofollow noreferrer\">github.com/hyperledger-archives/fabric/pull/1388</a>"}, {"owner": {"reputation": 95, "user_id": 6885518, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/63662fe1e11e34d65b5c465c4989df25?s=128&d=identicon&r=PG&f=1", "display_name": "Hitarshi Buch", "link": "https://stackoverflow.com/users/6885518/hitarshi-buch"}, "reply_to_user": {"reputation": 15819, "user_id": 1149423, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KmNLc.png?s=128&g=1", "display_name": "Sufiyan Ghori", "link": "https://stackoverflow.com/users/1149423/sufiyan-ghori"}, "edited": false, "score": 0, "creation_date": 1478490155, "post_id": 40420278, "comment_id": 68160460, "body": "The non-deterministic behavior test kind of answers my second question. But the first question still remains: how can we call an external web service or API from hyperledger chaincode? Is that kind of integration with external systems allowed because in Ethereum this is not possible."}, {"owner": {"reputation": 61, "user_id": 4775144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aeeb23b73785bba31e5d03d694d745f2?s=128&d=identicon&r=PG&f=1", "display_name": "Leon Matthews", "link": "https://stackoverflow.com/users/4775144/leon-matthews"}, "edited": false, "score": 0, "creation_date": 1485963011, "post_id": 40420278, "comment_id": 71144775, "body": "It is possible - I believe it&#39;s in the Hyperledger presentations - but you have a constraint that any peer must be able to call the same endpoint and must return the same response. Otherwise, as you say, you would be at risk of non-deterministic behavior on each individual peer."}], "answers": [{"tags": [], "owner": {"reputation": 572, "user_id": 2188181, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vFgsB.jpg?s=128&g=1", "display_name": "Kim", "link": "https://stackoverflow.com/users/2188181/kim"}, "is_accepted": false, "score": 4, "last_activity_date": 1495147019, "creation_date": 1495147019, "answer_id": 44058834, "question_id": 40420278, "link": "https://stackoverflow.com/questions/40420278/hyperledger-chaincode-external-service-calls/44058834#44058834", "title": "Hyperledger chaincode external service calls", "body": "<p>There is always the opportunity for two asset updates from different sources to hit two endorsers in a different order. That will create read/write sets that do not match. This can cause both to fail if the endorsement policy requires that all endorsers achieve the same r/w set. Adding reads of external data that can change or can fail owing to any number of momentary issues just exacerbates this issue.</p>\n\n<p>But the changes will be handled correctly no matter which endorsement policy is in effect because only endorsed r/w sets get committed.</p>\n\n<p>Now, if you decide to <strong>write</strong> to an external database from a chaincode, then all bets are off. A last minute failure because of key clashes in the same block (fabric v1 requires that updates targeting the same keys never be processed together and thus must be flow controlled) will cause the transaction to never get committed. </p>\n\n<p>When that happens, the external writes should be rolled back, but the chaincode is long done executing and so the total dataset has now been corrupted. This is a non starter.</p>\n\n<p>However, should someone decide to tempt fate and build an elaborate system where chaincode updates external data, the failure can be detected and the updates rolled back <strong>so long as the transaction ID is part of the journal entry for the update</strong>. This solution is unspeakably brittle, and if you try it then you will likely be sorry :-)</p>\n"}, {"comments": [{"owner": {"reputation": 572, "user_id": 2188181, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vFgsB.jpg?s=128&g=1", "display_name": "Kim", "link": "https://stackoverflow.com/users/2188181/kim"}, "edited": false, "score": 0, "creation_date": 1513016890, "post_id": 47648156, "comment_id": 82479419, "body": "Very dangerous to state that API calls can be made without stating why they are so dangerous and so likely to fail in practice."}], "tags": [], "owner": {"reputation": 432, "user_id": 3398743, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/1151161767/picture?type=large", "display_name": "Adesh Shah", "link": "https://stackoverflow.com/users/3398743/adesh-shah"}, "is_accepted": false, "score": -1, "last_activity_date": 1512462895, "last_edit_date": 1512462895, "creation_date": 1512458531, "answer_id": 47648156, "question_id": 40420278, "link": "https://stackoverflow.com/questions/40420278/hyperledger-chaincode-external-service-calls/47648156#47648156", "title": "Hyperledger chaincode external service calls", "body": "<ol>\n<li>Yes. We can make external API calls. for ease i prefer node sdk instead of go lang for chaincode</li>\n<li>Normally chain code is executed on one of the peers, and so is the external api call. Once the result is derived, the transaction is broadcast in the network. Other peers validate the transaction by chain of hash. So the API call is not executed on all validating peers.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 9082809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/883711dc4f56c84721f8ac7726a5435e?s=128&d=identicon&r=PG&f=1", "display_name": "David Sanchez-Seco", "link": "https://stackoverflow.com/users/9082809/david-sanchez-seco"}, "is_accepted": false, "score": 2, "last_activity_date": 1516029772, "creation_date": 1516029772, "answer_id": 48265881, "question_id": 40420278, "link": "https://stackoverflow.com/questions/40420278/hyperledger-chaincode-external-service-calls/48265881#48265881", "title": "Hyperledger chaincode external service calls", "body": "<p>It is possible and doesn't break Fabric. Fabric doesn't have to be deterministic as the RW set is check on all endorsers but it's not replayed, only it's check that the READ replica set is the same when the transaction proposal is submited.</p>\n\n<p>On the receivers endorser the READ replica is check and if the local and the proposed have same versions the transaction is valid.</p>\n\n<p>On Solidity's smartcontracts the transaction is replayed, that's why it must be deterministic.</p>\n"}, {"tags": [], "owner": {"reputation": 877, "user_id": 1291234, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ww6O2.jpg?s=128&g=1", "display_name": "hsnkhrmn", "link": "https://stackoverflow.com/users/1291234/hsnkhrmn"}, "is_accepted": false, "score": 0, "last_activity_date": 1594286915, "creation_date": 1594286915, "answer_id": 62811759, "question_id": 40420278, "link": "https://stackoverflow.com/questions/40420278/hyperledger-chaincode-external-service-calls/62811759#62811759", "title": "Hyperledger chaincode external service calls", "body": "<p>I think calling external APIs approach is not totally evil. It's perfect way to validate endorsing peers that really data retrieved from external source. i.e getting today's $/\u20ac rate from a trusted global source. Parties cannot say that: &quot;Hey you made up the currency, you're corrupt&quot;, if all endorsing peers got the same result from same source.</p>\n<p>According to this <a href=\"https://hyperledger.github.io/composer/latest/integrating/call-out\" rel=\"nofollow noreferrer\">Hyperledger-Composer Documentation</a>, the section discusses: if external-api calls are possible, how and when to use it, when to avoid it, pros and cons, etc. I want to emphasize this section as an answer:</p>\n<blockquote>\n<p>HTTP requests may result in different responses for multiple reasons:</p>\n<ul>\n<li>Peer nodes in different organisations may run in different data\ncenters, in different countries, in different time zones.</li>\n<li>Peer nodes in different organisations may not have access to the HTTP server\ndepending on public internet access and firewall restrictions.</li>\n<li>Peer nodes in different organisations may authenticate to the HTTP server\nas different users, resulting in different HTTP responses.</li>\n</ul>\n<p>In order to minimize the risks of consensus failures when making HTTP requests\nfrom a transaction processor function, it is recommended you use make\nHTTP requests that are either:</p>\n<ul>\n<li>Safe, in that the HTTP request does not modify any state on the HTTP\nserver.</li>\n<li>Idempotent, in that the same HTTP request can be made many\ntimes without different outcomes.</li>\n</ul>\n</blockquote>\n"}], "owner": {"reputation": 95, "user_id": 6885518, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/63662fe1e11e34d65b5c465c4989df25?s=128&d=identicon&r=PG&f=1", "display_name": "Hitarshi Buch", "link": "https://stackoverflow.com/users/6885518/hitarshi-buch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1184, "favorite_count": 2, "answer_count": 4, "score": 6, "last_activity_date": 1594286915, "creation_date": 1478255117, "question_id": 40420278, "link": "https://stackoverflow.com/questions/40420278/hyperledger-chaincode-external-service-calls", "title": "Hyperledger chaincode external service calls", "body": "<p>Is it possible to make external service calls from chaincode? For example, if I need to lookup the current exchange rate or today's temperature using a public API how can I make that call from the chaincode?</p>\n\n<p>If external calls are allowed then there is a chance of each node providing a different output (non-deterministic behavior). So how will consensus be reached?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1478251764, "post_id": 40419047, "comment_id": 68087153, "body": "That&#39;s how the type system works. <code>make(chan ...)</code> makes kinda &quot;undirected&quot; (not bidirectional, undirected) channel which is assignable to a directed channel while <code>chList</code> is a slice of bidirectional channels, unassignable to a receive only channel. You can do <code>chList := []&lt;-chan int{make(chan int), make(chan int)}</code>."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 1839287, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/65316fcac73630ff6b5d52999b2723bc?s=128&d=identicon&r=PG", "display_name": "olovp", "link": "https://stackoverflow.com/users/1839287/olovp"}, "edited": false, "score": 0, "creation_date": 1478251819, "post_id": 40419112, "comment_id": 68087194, "body": "But then I can&#39;t send on the channels (send to receive-only type &lt;-chan int). And why does it work when not putting them into a slice?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1478285704, "post_id": 40419112, "comment_id": 68108272, "body": "You should never <code>make</code> a directional channel, since it&#39;s pretty much useless."}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 0, "last_activity_date": 1478251598, "creation_date": 1478251598, "answer_id": 40419112, "question_id": 40419047, "link": "https://stackoverflow.com/questions/40419047/how-can-i-pass-a-channel-slice-to-a-function-as-variadic/40419112#40419112", "title": "How can I pass a channel slice to a function as variadic?", "body": "<p>you missed the direction,</p>\n\n<pre><code>package main\nfunc f(in ...&lt;-chan int) {\n    // do something\n}\n\nfunc main() {\n    chList := []&lt;-chan int{make(&lt;-chan int), make(&lt;-chan int)}\n    f(make(&lt;-chan int), make(&lt;-chan int)) \n    f(chList...) \n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 81, "user_id": 1839287, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/65316fcac73630ff6b5d52999b2723bc?s=128&d=identicon&r=PG", "display_name": "olovp", "link": "https://stackoverflow.com/users/1839287/olovp"}, "is_accepted": false, "score": 2, "last_activity_date": 1478253666, "last_edit_date": 1495542798, "creation_date": 1478253666, "answer_id": 40419798, "question_id": 40419047, "link": "https://stackoverflow.com/questions/40419047/how-can-i-pass-a-channel-slice-to-a-function-as-variadic/40419798#40419798", "title": "How can I pass a channel slice to a function as variadic?", "body": "<p>Ok, so it seems it has to do with <a href=\"https://stackoverflow.com/questions/3839335/any-sensible-solution-to-the-lack-of-array-slice-covariance-in-go\">lack</a> of <a href=\"https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)\" rel=\"nofollow noreferrer\">slice covariance in go</a>. My solution is to type convert the slice of \"nondirectional\" channels into a slice of readonly channels. Full example below:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc f(in ...&lt;-chan int) chan int {\n    fmt.Println(\"number of channels:\", len(in))\n    out := make(chan int)\n    for _, ch := range in {\n        go func(ch &lt;-chan int) {\n            for i := range ch {\n                out &lt;- i\n            }\n        }(ch)\n    }\n    return out\n}\n\nfunc chConv(channels ...chan int) []&lt;-chan int {\n    ret := make([]&lt;-chan int, len(channels))\n    for n, ch := range channels {\n        ret[n] = ch\n    }\n    return ret\n}\n\nfunc main() {\n    chList := []chan int{make(chan int), make(chan int)}\n    roChans := chConv(chList...)\n    agg := f(roChans...)\n    go func() {\n        for i := range agg {\n            fmt.Println(\"got:\", i)\n        }\n    }()\n    for i := 0; i &lt; 10; i++ {\n        for _, ch := range chList {\n            ch &lt;- i\n        }\n    }\n    time.Sleep(1 * time.Second)\n}\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 1839287, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/65316fcac73630ff6b5d52999b2723bc?s=128&d=identicon&r=PG", "display_name": "olovp", "link": "https://stackoverflow.com/users/1839287/olovp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 491, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1478253666, "creation_date": 1478251404, "question_id": 40419047, "link": "https://stackoverflow.com/questions/40419047/how-can-i-pass-a-channel-slice-to-a-function-as-variadic", "title": "How can I pass a channel slice to a function as variadic?", "body": "<p>If I have a function that takes a number of read only channels (for example for channel aggregation), why can't I call this function with a slice of channels, like</p>\n\n<pre><code>package main\nfunc f(in ...&lt;-chan int) {\n    // do something\n}\n\nfunc main() {\n    chList := []chan int{make(chan int), make(chan int)}\n    f(make(chan int), make(chan int)) // works\n    f(chList...) // cannot use chList (type []chan int) as type []&lt;-chan int in argument to f\n}\n</code></pre>\n\n<p>It seems I'm missing something fundamental but I can't figure out what. If the function can't take unidirectional channels, why can it take them when not in the first case?</p>\n"}, {"tags": ["mysql", "sql", "go"], "comments": [{"owner": {"reputation": 32469, "user_id": 1529673, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/O6MQS.jpg?s=128&g=1", "display_name": "Strawberry", "link": "https://stackoverflow.com/users/1529673/strawberry"}, "edited": false, "score": 0, "creation_date": 1478246915, "post_id": 40415293, "comment_id": 68084822, "body": "Are there any examples out there that store appointments this way. And money uses a DECIMAL system, which might be a clue to its data type."}], "answers": [{"tags": [], "owner": {"reputation": 6054, "user_id": 832991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd3057ea53cccfcab8b7ef18baa9faa9?s=128&d=identicon&r=PG", "display_name": "Eralper", "link": "https://stackoverflow.com/users/832991/eralper"}, "is_accepted": false, "score": 0, "last_activity_date": 1478238203, "creation_date": 1478238203, "answer_id": 40416024, "question_id": 40415293, "link": "https://stackoverflow.com/questions/40415293/sql-structure-and-calendar/40416024#40416024", "title": "SQL structure and Calendar?", "body": "<p>In SQL Server you can create date tables and date time interval tables too easily.</p>\n\n<p>You can check how I implemented <a href=\"http://www.kodyaz.com/t-sql/create-date-time-intervals-table-in-sql-server.aspx\" rel=\"nofollow noreferrer\">time interval table in SQL Server</a> in referenced document.</p>\n\n<p>I joined a numbers table with 24 rows matching to hours and a second numbers table reference with 365 rows matching to dates in a year</p>\n\n<p>You need to convert below T-SQL to use it in your mySQL statements</p>\n\n<pre><code>declare @date datetime = '20100101'\n\nSELECT\n dt.number+1 DayNo,\n tt.number+1 HourNo,\n dateadd(dd,dt.number,@date) [date],\n dateadd(hh,tt.number,dateadd(dd,dt.number,@date)) [start],\n dateadd(hh,tt.number+1,dateadd(dd,dt.number,@date)) [end]\nFROM master..spt_values dt, master..spt_values tt\nWHERE\n dt.Type = 'P' AND\n tt.Type = 'P' AND\n dt.number &lt; 365 AND\n tt.number &lt; 24 AND\n dateadd(dd,dt.number,@date) &lt; dateadd(yy,1,@date)\nORDER BY dt.Number, tt.Number\n</code></pre>\n"}], "owner": {"reputation": 1229, "user_id": 6336858, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ebcd58007a9088efe7c1605069558559?s=128&d=identicon&r=PG&f=1", "display_name": "omgj", "link": "https://stackoverflow.com/users/6336858/omgj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1478333634, "creation_date": 1478233737, "last_edit_date": 1478333634, "question_id": 40415293, "link": "https://stackoverflow.com/questions/40415293/sql-structure-and-calendar", "title": "SQL structure and Calendar?", "body": "<p>I'm having trouble unpacking a calendar structure from sql into golang structs, here is what I have.   </p>\n\n<pre><code>type year struct {\nyear int\nmonths []month\n}\n\ntype month struct {\nmonth int\ndays []day\n}\n\ntype day struct {\nday int\nhours map[int]bool\n}\n</code></pre>\n\n<p>I'm planning an appointment calendar, each day may have 10:00, 11:00, 12:00, 13:00 etc. and I will read out a maximum of 3 months at a time. I cannot figure out how to unpack the following schema:</p>\n\n<pre><code>CREATE TABLE appointments (\nid INT,\nyear INT,\nmonth INT,\nday INT,\nhour INT,\nteacher INT, (id of teacher)\nstudent INT, (id of student)\namount DECIMAL, (amount charged for the appointment)\nbooked BOOL, (records availability)\n)\n</code></pre>\n\n<p>The query:</p>\n\n<p><code>SELECT year, month, day, hour, booked FROM appointments a WHERE a.teacher = ? ORDERY BY day, month, year;</code></p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 2, "creation_date": 1478229447, "post_id": 40414685, "comment_id": 68079377, "body": "the method ListenAndServe() does that for you, we don&#39;t have to deal with that just remember that each handler is running in a different goroutine"}], "answers": [{"tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 9, "last_activity_date": 1478268220, "last_edit_date": 1478268220, "creation_date": 1478241284, "answer_id": 40416663, "question_id": 40414685, "link": "https://stackoverflow.com/questions/40414685/should-i-be-using-goroutines-with-http-listenandserve/40416663#40416663", "title": "Should I be using goroutines with http.ListenAndServe?", "body": "<p>Short answer, No</p>\n\n<p>GoDoc from <code>http.Serve</code> : </p>\n\n<p><code>Serve accepts incoming HTTP connections on the listener l, creating a new service goroutine for each. The service goroutines read requests and then call handler to reply to them.</code></p>\n\n<p>However as mentioned in the question linked by <code>@Mellow Marmot</code>, there might be cases where you might want to spawn a goroutine to do some processing while you return from the handler so that the requester does not have to wait for all the processing to be done to get a response.</p>\n"}], "owner": {"reputation": 27533, "user_id": 998117, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/bfe07f542ce4f5d75e4262e188691fd5?s=128&d=identicon&r=PG&f=1", "display_name": "Doug Smith", "link": "https://stackoverflow.com/users/998117/doug-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1404, "favorite_count": 0, "accepted_answer_id": 40416663, "answer_count": 1, "score": 2, "last_activity_date": 1478274998, "creation_date": 1478228955, "last_edit_date": 1478274998, "question_id": 40414685, "link": "https://stackoverflow.com/questions/40414685/should-i-be-using-goroutines-with-http-listenandserve", "title": "Should I be using goroutines with http.ListenAndServe?", "body": "<p>If I'm using <code>http.ListenAndServe</code> to provide responses when the user hits a URL, should I be firing off the corresponding actions in the function as a goroutine ?</p>\n\n<p>For instance, say I'm listening at <code>/</code>:</p>\n\n<pre><code>func main() {\n    http.HandleFunc(\"/\", provideMainContent)\n}\n\nfunc provideMainContent(w http.ResponseWriter, r *http.Request) {\n    /// Bunch of code, looks up details in databases, parses, then returns\n}\n</code></pre>\n\n<p>Should the bunch of code in <code>provideMainContent</code> be wrapped in a goroutine so it doesn't slow down any potential requests that come after the fact ?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "is_accepted": false, "score": 3, "last_activity_date": 1478232074, "creation_date": 1478232074, "answer_id": 40415079, "question_id": 40414643, "link": "https://stackoverflow.com/questions/40414643/how-do-i-properly-use-these-variables-in-a-separate-function-in-go/40415079#40415079", "title": "How do I properly use these variables in a separate function in Go?", "body": "<p>Your signature looks fine. One part many people overlook when they first start doing web work in Go is that the <code>writer http.ResponseWriter</code> is an interface value. In Go interface values are reference types meaning that the <code>writer</code> variable you're being passed already internally contains a pointer to the concrete value that's satisfying that interface. You can feel free to pass your <code>writer</code> on to <code>commonFunction</code> and it's already a reference.</p>\n"}], "owner": {"reputation": 27533, "user_id": 998117, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/bfe07f542ce4f5d75e4262e188691fd5?s=128&d=identicon&r=PG&f=1", "display_name": "Doug Smith", "link": "https://stackoverflow.com/users/998117/doug-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1478427856, "creation_date": 1478228648, "question_id": 40414643, "link": "https://stackoverflow.com/questions/40414643/how-do-i-properly-use-these-variables-in-a-separate-function-in-go", "title": "How do I properly use these variables in a separate function in Go?", "body": "<p>Apologies for what is likely a very elementary question.</p>\n\n<p>I'm using <code>http</code>'s <code>listenAndServe</code>, and it calls the following function:</p>\n\n<pre><code>func library(writer http.ResponseWriter, request *http.Request)\n</code></pre>\n\n<p>A lot of the code contained in that function applies elsewhere, so I wanted to bring it out into another function, such as:</p>\n\n<pre><code>func commonFunction(doThing bool, writer http.ResponseWriter, request *http.Request)\n</code></pre>\n\n<p>But is that function header for <code>commonFunction</code> correct if I'm passing those two variables from <code>library</code> into it? </p>\n\n<p>Would I call it as <code>commonFunction(true, writer, request)</code>? </p>\n\n<p>I'm mostly confused if I should be passing pointers to these variables? It would make sense not to for <code>http.Request</code> as it's already a pointer, but what about <code>http.ResponseWriter</code>, surely I don't want to recreate the variable?</p>\n"}, {"tags": ["unit-testing", "testing", "go", "report", "command-line-interface"], "answers": [{"comments": [{"owner": {"reputation": 7225, "user_id": 84540, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/8425457b7317576680146aa8149be472?s=128&d=identicon&r=PG", "display_name": "nybon", "link": "https://stackoverflow.com/users/84540/nybon"}, "edited": false, "score": 0, "creation_date": 1478569564, "post_id": 40415554, "comment_id": 68199846, "body": "No, I don&#39;t think the <code>go test -v</code> prints any of these stats, it only prints each test name and if individual test passes or not, but there is no summary for the test suite, as I mentioned in the question, I would like to have a minimal summary including the number of tests, number of succeeded tests, number of failed tests."}], "tags": [], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "is_accepted": false, "score": 1, "last_activity_date": 1478235384, "creation_date": 1478235384, "answer_id": 40415554, "question_id": 40414392, "link": "https://stackoverflow.com/questions/40414392/recommendation-for-go-test-cli-test-reporter/40415554#40415554", "title": "Recommendation for `go test` CLI test reporter", "body": "<p>The <code>go test</code> command has a variety of <a href=\"https://golang.org/cmd/go/#hdr-Description_of_testing_flags\" rel=\"nofollow\">flags</a> which includes <code>-v</code> verbose flag. This option prints test specifics as well as test suite stats. </p>\n"}, {"tags": [], "owner": {"reputation": 1488, "user_id": 324445, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/804aee742efaa7a85465e07f45fbac25?s=128&d=identicon&r=PG", "display_name": "Andre Soares", "link": "https://stackoverflow.com/users/324445/andre-soares"}, "is_accepted": true, "score": 2, "last_activity_date": 1588948039, "creation_date": 1588948039, "answer_id": 61681408, "question_id": 40414392, "link": "https://stackoverflow.com/questions/40414392/recommendation-for-go-test-cli-test-reporter/61681408#61681408", "title": "Recommendation for `go test` CLI test reporter", "body": "<p>There is <code>gotestsum</code>, <a href=\"https://github.com/gotestyourself/gotestsum\" rel=\"nofollow noreferrer\">https://github.com/gotestyourself/gotestsum</a></p>\n\n<p><strong>Description at github:</strong></p>\n\n<blockquote>\n  <p><code>go test</code> runner with output optimized for humans, JUnit XML for CI integration, and a summary of the test results.\n  \"</p>\n</blockquote>\n"}], "owner": {"reputation": 7225, "user_id": 84540, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/8425457b7317576680146aa8149be472?s=128&d=identicon&r=PG", "display_name": "nybon", "link": "https://stackoverflow.com/users/84540/nybon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 784, "favorite_count": 0, "accepted_answer_id": 61681408, "answer_count": 2, "score": 3, "last_activity_date": 1588948039, "creation_date": 1478226682, "last_edit_date": 1478569725, "question_id": 40414392, "link": "https://stackoverflow.com/questions/40414392/recommendation-for-go-test-cli-test-reporter", "title": "Recommendation for `go test` CLI test reporter", "body": "<p>I plan to use the golang's <code>testing</code> package and <code>go test</code> for writing unit tests. I find <code>go test</code> only provides coverage report in the CLI, but I cannot find any  <code>go test</code> option allowing me to get a summary report for the test suite.</p>\n\n<p>For example, after running tests, I would like to see a minimal test report including the following information:</p>\n\n<ul>\n<li>how many tests in the test suite</li>\n<li>how many of them pass</li>\n<li>how many of them fail</li>\n</ul>\n\n<p>I did some web search, but cannot find any good golang native option/third party tool/library to support this. And I only found a library <a href=\"https://github.com/jstemmer/go-junit-report\" rel=\"nofollow noreferrer\">https://github.com/jstemmer/go-junit-report</a> that allows me to convert the results into JUnit XML which requires me to do some further processing to get the summary, which is not convenient enough.</p>\n\n<p>I would like to know when working with <code>go test</code> and the <code>testing</code> package, what is the tool/library people typically use for such test report generation purpose, in particular when running via CLI? Thanks.</p>\n"}, {"tags": ["c++", "go", "swig"], "owner": {"reputation": 342, "user_id": 7112540, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gfS_KhkuJ1E/AAAAAAAAAAI/AAAAAAAAADY/86eDu2MUdaw/photo.jpg?sz=128", "display_name": "Tc Zhong", "link": "https://stackoverflow.com/users/7112540/tc-zhong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 241, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1478218741, "creation_date": 1478218741, "question_id": 40413399, "link": "https://stackoverflow.com/questions/40413399/is-it-possible-to-pass-slice-to-slice-from-golang-to-c-through-swig", "title": "Is it possible to pass slice to slice from golang to c++ through swig", "body": "<p>I have known how to use swig to combine go and c++ together.\nBut now I have a go function\n<code>func encode(demo [][]byte)</code>, in this function I want to pass demo to c++ function.\nIn c++, my function is like this <code>void encode(unsigned char** demo)</code>\nSo how can I do this, or is there any document tell me how to do this?</p>\n"}, {"tags": ["go", "mapping", "fifo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1478218823, "post_id": 40412953, "comment_id": 68076664, "body": "Related / possible duplicate of <a href=\"http://stackoverflow.com/questions/28930416/why-cant-go-iterate-maps-in-insertion-order\">Why can&#39;t Go iterate maps in insertion order?</a>; and <a href=\"http://stackoverflow.com/questions/39450120/golang-map-in-order-range-loop\">Golang map in order range loop</a>."}], "answers": [{"comments": [{"owner": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 0, "creation_date": 1478293595, "post_id": 40413172, "comment_id": 68111853, "body": "Thanks for the quick response. It would appear that my hope of making something easily unmarshal-able for a json list that would enable iterable mapping by FIFO is not going to be easy and probably best to ignore atm. But thanks. This helped a lot."}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 0, "creation_date": 1478317441, "post_id": 40413172, "comment_id": 68117266, "body": "It would be possible if you implement the <code>json.Unmarshaler</code> interface.  But how easy it would be, depends on your exact problem."}, {"owner": {"reputation": 2245, "user_id": 479213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb5e966ed938c254a8846613fa110030?s=128&d=identicon&r=PG", "display_name": "johnzachary", "link": "https://stackoverflow.com/users/479213/johnzachary"}, "edited": false, "score": 2, "creation_date": 1478466780, "post_id": 40413172, "comment_id": 68154717, "body": "Note that if your map is big, then maintaining a sorted list of keys will slow things down.  I hit this problem with a hashmap on the order of 10M entries and had to rethink this approach.  In the end, a combined hashmap and queue data structure worked like a charm."}, {"owner": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 0, "creation_date": 1478548047, "post_id": 40413172, "comment_id": 68191195, "body": "right but I&#39;m basically taking a list of jobs from a yaml/json file and trying to keep them in order and this appears to make my job more difficult, not less."}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "edited": false, "score": 1, "creation_date": 1478572140, "post_id": 40413172, "comment_id": 68200499, "body": "@RichardJohnCatalano If you can share the structure, I can see if implimenting the <code>json.Unmarshaler</code> interface can solve your problem."}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 4, "last_activity_date": 1478926140, "last_edit_date": 1495540942, "creation_date": 1478217305, "answer_id": 40413172, "question_id": 40412953, "link": "https://stackoverflow.com/questions/40412953/how-to-fifo-order-a-map-during-unmarshalling/40413172#40413172", "title": "How to FIFO Order a Map during Unmarshalling", "body": "<p>You would need to hold the keys in a separate slice and work with that.</p>\n\n<pre><code>type fifoJob struct {\n    m map[string]*Job\n    order []string\n    result []string\n    // Not sure where JobVars will go. \n}\n\nfunc (str *fifoJob) Enqueue(key string, val *Job) {\n    str.m[key] = val\n    str.order = append(str.order, key)\n}\n\nfunc (str *fifoJob) Dequeue() {\n    if len(str.order) &gt; 0 {\n        delete(str.m, str.order[0])\n        str.order = str.order[1:]\n    }\n}\n</code></pre>\n\n<p>Anyways if you're using <code>viper</code> you can use something like the <code>fifoJob</code> struct defined above. Also note that I'm making a few assumptions here.</p>\n\n<pre><code>type Package struct {\n    Account   string\n    Jobs      *fifoJob\n    Libraries map[string]string\n}\n\nvar config Package\nconfig.Jobs = fifoJob{}\nconfig.Jobs.m = map[string]*Job{}\n\n// Your config file would need to store the order in an array.\n// Would've been easy if viper had a getSlice method returning []interface{}\nconfig.Jobs.order = viper.GetStringSlice(\"package.jobs.order\") \n\nfor k,v := range viper.GetStringMap(\"package.jobs.jobmap\") {\n\n    if job, ok := v.(Job); ok {\n        config.Jobs.m[k] = &amp;job\n    }\n}\n</code></pre>\n\n<p>for </p>\n\n<p>PS: You're giving too many irrelevant details in your question. I was asking for a <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "is_accepted": false, "score": 0, "last_activity_date": 1478217505, "creation_date": 1478217505, "answer_id": 40413210, "question_id": 40412953, "link": "https://stackoverflow.com/questions/40412953/how-to-fifo-order-a-map-during-unmarshalling/40413210#40413210", "title": "How to FIFO Order a Map during Unmarshalling", "body": "<p>Maps are by nature unordered but you can fill up a slice instead with your keys. Then you can range over your slice and sort it however you like. You can pull out specific elements in your slice with [i].</p>\n\n<p>Check out pages 170, 203, or 204 of some great examples of this:</p>\n\n<p><a href=\"http://books.google.de/books?id=HW-5SZ1HKusC&amp;pg=PT217&amp;lpg=PT217&amp;dq=%224.3.4%20Key-Ordered%20Map%20Iteration%22&amp;source=bl&amp;ots=Fp7245_0iv&amp;sig=IhJnSkLX2hFA021V2XkBPRiREf4&amp;hl=de#v=onepage&amp;q=%224.3.4%20Key-Ordered%20Map%20Iteration%22&amp;f=false\" rel=\"nofollow noreferrer\">Programming in Go</a></p>\n"}], "owner": {"reputation": 349, "user_id": 1862123, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/17a3486a39c8d9d47d10e9c76a31d9d1?s=128&d=identicon&r=PG", "display_name": "Richard John Catalano", "link": "https://stackoverflow.com/users/1862123/richard-john-catalano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1028, "favorite_count": 0, "accepted_answer_id": 40413172, "answer_count": 2, "score": 1, "last_activity_date": 1614248363, "creation_date": 1478215883, "last_edit_date": 1614248363, "question_id": 40412953, "link": "https://stackoverflow.com/questions/40412953/how-to-fifo-order-a-map-during-unmarshalling", "title": "How to FIFO Order a Map during Unmarshalling", "body": "<p>I know from reading around that Maps are intentionally unordered in Go, but they offer a lot of benefits that I would like to use for this problem I'm working on. My question is how might I order a map FIFO style? Is it even worth trying to make this happen? Specifically I am looking to make it so that I can unmarshal into a set of structures hopefully off of an interface.</p>\n<p>I have:</p>\n<pre><code>type Package struct {\n    Account   string\n    Jobs      []*Jobs\n    Libraries map[string]string\n}\n\ntype Jobs struct {\n// Name of the job\n     JobName string `mapstructure:&quot;name&quot; json:&quot;name&quot; yaml:&quot;name&quot; toml:&quot;name&quot;`\n// Type of the job. should be one of the strings outlined in the job struct (below)\n     Job *Job `mapstructure:&quot;job&quot; json:&quot;job&quot; yaml:&quot;job&quot; toml:&quot;job&quot;`\n// Not marshalled\n     JobResult string\n// For multiple values\n     JobVars []*Variable\n}\n\ntype Job struct {\n// Sets/Resets the primary account to use\n    Account *Account `mapstructure:&quot;account&quot; json:&quot;account&quot; yaml:&quot;account&quot; toml:&quot;account&quot;`\n// Set an arbitrary value\n    Set *Set `mapstructure:&quot;set&quot; json:&quot;set&quot; yaml:&quot;set&quot; toml:&quot;set&quot;`\n// Contract compile and send to the chain functions\n    Deploy *Deploy `mapstructure:&quot;deploy&quot; json:&quot;deploy&quot; yaml:&quot;deploy&quot; toml:&quot;deploy&quot;`\n// Send tokens from one account to another\n    Send *Send `mapstructure:&quot;send&quot; json:&quot;send&quot; yaml:&quot;send&quot; toml:&quot;send&quot;`\n// Utilize eris:db's native name registry to register a name\n    RegisterName *RegisterName `mapstructure:&quot;register&quot; json:&quot;register&quot; yaml:&quot;register&quot; toml:&quot;register&quot;`\n// Sends a transaction which will update the permissions of an account. Must be sent from an account which\n// has root permissions on the blockchain (as set by either the genesis.json or in a subsequence transaction)\n    Permission *Permission `mapstructure:&quot;permission&quot; json:&quot;permission&quot; yaml:&quot;permission&quot; toml:&quot;permission&quot;`\n// Sends a bond transaction\n    Bond *Bond `mapstructure:&quot;bond&quot; json:&quot;bond&quot; yaml:&quot;bond&quot; toml:&quot;bond&quot;`\n// Sends an unbond transaction\n    Unbond *Unbond `mapstructure:&quot;unbond&quot; json:&quot;unbond&quot; yaml:&quot;unbond&quot; toml:&quot;unbond&quot;`\n// Sends a rebond transaction\n    Rebond *Rebond `mapstructure:&quot;rebond&quot; json:&quot;rebond&quot; yaml:&quot;rebond&quot; toml:&quot;rebond&quot;`\n// Sends a transaction to a contract. Will utilize eris-abi under the hood to perform all of the heavy lifting\n    Call *Call `mapstructure:&quot;call&quot; json:&quot;call&quot; yaml:&quot;call&quot; toml:&quot;call&quot;`\n// Wrapper for mintdump dump. WIP\n    DumpState *DumpState `mapstructure:&quot;dump-state&quot; json:&quot;dump-state&quot; yaml:&quot;dump-state&quot; toml:&quot;dump-state&quot;`\n// Wrapper for mintdum restore. WIP\n    RestoreState *RestoreState `mapstructure:&quot;restore-state&quot; json:&quot;restore-state&quot; yaml:&quot;restore-state&quot; toml:&quot;restore-state&quot;`\n// Sends a &quot;simulated call&quot; to a contract. Predominantly used for accessor functions (&quot;Getters&quot; within contracts)\n    QueryContract *QueryContract `mapstructure:&quot;query-contract&quot; json:&quot;query-contract&quot; yaml:&quot;query-contract&quot; toml:&quot;query-contract&quot;`\n// Queries information from an account.\n    QueryAccount *QueryAccount `mapstructure:&quot;query-account&quot; json:&quot;query-account&quot; yaml:&quot;query-account&quot; toml:&quot;query-account&quot;`\n// Queries information about a name registered with eris:db's native name registry\n    QueryName *QueryName `mapstructure:&quot;query-name&quot; json:&quot;query-name&quot; yaml:&quot;query-name&quot; toml:&quot;query-name&quot;`\n// Queries information about the validator set\n    QueryVals *QueryVals `mapstructure:&quot;query-vals&quot; json:&quot;query-vals&quot; yaml:&quot;query-vals&quot; toml:&quot;query-vals&quot;`\n// Makes and assertion (useful for testing purposes)\n    Assert *Assert `mapstructure:&quot;assert&quot; json:&quot;assert&quot; yaml:&quot;assert&quot; toml:&quot;assert&quot;`\n}\n</code></pre>\n<p>What I would like to do is to have jobs contain a map of string to Job and eliminate the <code>job</code> field, while maintaining order in which they were placed in from the config file. (Currently using viper). Any and all suggestions for how to achieve this are welcome.</p>\n"}, {"tags": ["http", "ssl", "go"], "comments": [{"owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "edited": false, "score": 0, "creation_date": 1478549978, "post_id": 40412270, "comment_id": 68192282, "body": "Is there a reason that you don&#39;t use <code>go fmt</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1478644892, "post_id": 40487991, "comment_id": 68239471, "body": "hi, thanks for feedback, really appreciated, unfortunately it really does not help me as i previously did use that code to create a <a href=\"https://github.com/mh-cbon/sscg\" rel=\"nofollow noreferrer\">binary</a> tool generate those certificates as plain file, so i knew it was working. I m really looking to implement this GetCert method in the same fashion as <a href=\"https://godoc.org/golang.org/x/crypto/acme/autocert\" rel=\"nofollow noreferrer\">this</a>. Maybe i should have precised in my original post."}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1478658658, "post_id": 40487991, "comment_id": 68242857, "body": "Updated. I&#39;m guessing this is the issue."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1478686936, "post_id": 40487991, "comment_id": 68252019, "body": "Yeah! I see the problem now, i was generating a new cert every time so the browser was mixing up when the subsequent requests were coming into. I still have the error <code>2016&#47;11&#47;09 11:18:36 http2: server: error reading preface from client 127.0.0.1:41748: remote error: tls: unknown certificate authority</code>, but this is a problem for another question i guess. Thanks!"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1478687234, "post_id": 40487991, "comment_id": 68252225, "body": "Are you setting <code>Certopts.IsCA</code> as <code>true</code>, in your config ?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1478687778, "post_id": 40487991, "comment_id": 68252571, "body": "I was not, you are right again!!! : ) i ll be able to pack it in a package now. Many thanks!"}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 4, "last_activity_date": 1478657128, "last_edit_date": 1478657128, "creation_date": 1478611174, "answer_id": 40487991, "question_id": 40412270, "link": "https://stackoverflow.com/questions/40412270/implement-tls-config-getcertificate-with-self-signed-certificates/40487991#40487991", "title": "implement tls.Config.GetCertificate with self signed certificates", "body": "<p>Your implementation of <code>tls.Config.GetCertificate</code> is causing the problem.</p>\n\n<p>You are generating a certificate each time <code>tls.Config.GetCertificate</code> is called. You need to generate the certificate once and then return it in the anonymous function.</p>\n\n<p>In <code>gssc.GetCertificate</code> :</p>\n\n<pre><code>cert, err := generate(opts)\n\nreturn func(clientHello *tls.ClientHelloInfo) (*tls.Certificate, error) {\n        if err != nil {\n            return nil, err\n        }\n        return cert, err\n    }\n</code></pre>\n"}], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1534, "favorite_count": 2, "accepted_answer_id": 40487991, "answer_count": 1, "score": 4, "last_activity_date": 1478657128, "creation_date": 1478211913, "last_edit_date": 1478552197, "question_id": 40412270, "link": "https://stackoverflow.com/questions/40412270/implement-tls-config-getcertificate-with-self-signed-certificates", "title": "implement tls.Config.GetCertificate with self signed certificates", "body": "<p>I m trying to figure out how i can implement a function to feed to <code>tls.Config.GetCertificate</code> with self signed certificates.</p>\n\n<p>I used this bin source as a base, <a href=\"https://golang.org/src/crypto/tls/generate_cert.go\" rel=\"nofollow noreferrer\">https://golang.org/src/crypto/tls/generate_cert.go</a></p>\n\n<p>Also read this,\n<a href=\"https://ericchiang.github.io/tls/go/https/2015/06/21/go-tls.html\" rel=\"nofollow noreferrer\">https://ericchiang.github.io/tls/go/https/2015/06/21/go-tls.html</a></p>\n\n<p>Unfortunately, so far i m stuck with this error\n<code>2016/11/03 23:18:20 http2: server: error reading preface from client 127.0.0.1:34346: remote error: tls: unknown certificate authority</code></p>\n\n<p>I think i need to generate a CA cert and then sign the key with it, but i m not sure how to proceed (....).</p>\n\n<p>Here is my code, can someone help with that ?</p>\n\n<pre><code>package gssc\n\nimport (\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"crypto/tls\"\n    \"crypto/x509\"\n    \"crypto/x509/pkix\"\n    \"github.com/pkg/errors\"\n    \"math/big\"\n    \"net\"\n    \"strings\"\n    \"time\"\n)\n\nfunc GetCertificate(arg interface{}) func(clientHello *tls.ClientHelloInfo) (*tls.Certificate, error) {\n    var opts Certopts\n    var err error\n    if host, ok := arg.(string); ok {\n        opts = Certopts{\n            RsaBits:   2048,\n            Host:      host,\n            ValidFrom: time.Now(),\n        }\n    } else if o, ok := arg.(Certopts); ok {\n        opts = o\n    } else {\n        err = errors.New(\"Invalid arg type, must be string(hostname) or Certopt{...}\")\n    }\n    return func(clientHello *tls.ClientHelloInfo) (*tls.Certificate, error) {\n        if err != nil {\n            return nil, err\n        }\n        return generate(opts)\n    }\n}\n\ntype Certopts struct {\n    RsaBits   int\n    Host      string\n    IsCA      bool\n    ValidFrom time.Time\n    ValidFor  time.Duration\n}\n\nfunc generate(opts Certopts) (*tls.Certificate, error) {\n\n    priv, err := rsa.GenerateKey(rand.Reader, opts.RsaBits)\n    if err != nil {\n        return nil, errors.Wrap(err, \"failed to generate private key\")\n    }\n\n    notAfter := opts.ValidFrom.Add(opts.ValidFor)\n\n    serialNumberLimit := new(big.Int).Lsh(big.NewInt(1), 128)\n    serialNumber, err := rand.Int(rand.Reader, serialNumberLimit)\n    if err != nil {\n        return nil, errors.Wrap(err, \"Failed to generate serial number\\n\")\n    }\n\n    template := x509.Certificate{\n        SerialNumber: serialNumber,\n        Subject: pkix.Name{\n            Organization: []string{\"Acme Co\"},\n        },\n        NotBefore: opts.ValidFrom,\n        NotAfter:  notAfter,\n\n        KeyUsage:              x509.KeyUsageKeyEncipherment | x509.KeyUsageDigitalSignature,\n        ExtKeyUsage:           []x509.ExtKeyUsage{x509.ExtKeyUsageServerAuth},\n        BasicConstraintsValid: true,\n    }\n\n    hosts := strings.Split(opts.Host, \",\")\n    for _, h := range hosts {\n        if ip := net.ParseIP(h); ip != nil {\n            template.IPAddresses = append(template.IPAddresses, ip)\n        } else {\n            template.DNSNames = append(template.DNSNames, h)\n        }\n    }\n\n    if opts.IsCA {\n        template.IsCA = true\n        template.KeyUsage |= x509.KeyUsageCertSign\n    }\n\n    derBytes, err := x509.CreateCertificate(rand.Reader, &amp;template, &amp;template, &amp;priv.PublicKey, priv)\n    if err != nil {\n        return nil, errors.Wrap(err, \"Failed to create certificate\")\n    }\n\n    return &amp;tls.Certificate{\n        Certificate: [][]byte{derBytes},\n        PrivateKey:  priv,\n    }, nil\n}\n</code></pre>\n\n<p>This is the test code i use</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"github.com/mh-cbon/gssc\"\n    \"net/http\"\n)\n\ntype ww struct{}\n\nfunc (s *ww) ServeHTTP(w http.ResponseWriter, req *http.Request) {\n    w.Header().Set(\"Content-Type\", \"text/plain\")\n    w.Write([]byte(\"This is an example server.\\n\"))\n}\n\nfunc main() {\n    s := &amp;http.Server{\n        Handler: &amp;ww{},\n        Addr:    \":8080\",\n        TLSConfig: &amp;tls.Config{\n            InsecureSkipVerify: true,\n            GetCertificate:     gssc.GetCertificate(\"example.org\"),\n        },\n    }\n    s.ListenAndServeTLS(\"\", \"\")\n\n}\n</code></pre>\n\n<p>Thanks a lot!</p>\n"}, {"tags": ["go", "web-frameworks", "beego"], "comments": [{"owner": {"reputation": 4254, "user_id": 1351597, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e2b94150c4f96fe11dae1494a054f7b?s=128&d=identicon&r=PG", "display_name": "Dekker1", "link": "https://stackoverflow.com/users/1351597/dekker1"}, "edited": false, "score": 1, "creation_date": 1478210210, "post_id": 40411832, "comment_id": 68073985, "body": "I think you&#39;re missing an &#39;m&#39;: <code>go get github.com&#47;beego&#47;bee</code>. And according to the instructions it&#39;s <code>go get github.com&#47;astaxie&#47;beego</code>"}], "answers": [{"tags": [], "owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "is_accepted": false, "score": 0, "last_activity_date": 1478216795, "creation_date": 1478216795, "answer_id": 40413105, "question_id": 40411832, "link": "https://stackoverflow.com/questions/40411832/why-is-my-installation-of-the-beego-web-framework-not-working/40413105#40413105", "title": "WHY is my installation of the beego web framework not working?", "body": "<p>That is not the url path for Beego. You also have a typo after your <code>go get</code> command.</p>\n\n<p>You need to run this from your command line:</p>\n\n<p><code>go get github.com/astaxie/beego</code></p>\n\n<p><a href=\"https://beego.me/docs/install/\" rel=\"nofollow noreferrer\">Installation directions from Beego</a></p>\n"}], "owner": {"reputation": 41, "user_id": 6601433, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/09d30ca94559ce16f42e1c883db65d39?s=128&d=identicon&r=PG&f=1", "display_name": "iivri  andre", "link": "https://stackoverflow.com/users/6601433/iivri-andre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 456, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1478216795, "creation_date": 1478209802, "question_id": 40411832, "link": "https://stackoverflow.com/questions/40411832/why-is-my-installation-of-the-beego-web-framework-not-working", "title": "WHY is my installation of the beego web framework not working?", "body": "<p><code>Andres-Air:~ iivri.andre$ go get github.co/beego/bee\npackage github.co/beego/bee: unrecognized import path \"github.co/beego/bee\" (https fetch: Get https://github.co/beego/bee?go-get=1: dial tcp 199.59.243.120:443: i/o timeout</code></p>\n\n<p>It keeps showing me this 'error' Is anyone here familiar with the installation process? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3240, "user_id": 2694306, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/a36c65851474c1cca6200426379fd82f?s=128&d=identicon&r=PG&f=1", "display_name": "user2694306", "link": "https://stackoverflow.com/users/2694306/user2694306"}, "edited": false, "score": 0, "creation_date": 1478275390, "post_id": 40410087, "comment_id": 68102639, "body": "I&#39;m getting the following error when I try your first solution: <code>arg.foo1 undefined (type interface {} is interface with no methods)</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 3240, "user_id": 2694306, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/a36c65851474c1cca6200426379fd82f?s=128&d=identicon&r=PG&f=1", "display_name": "user2694306", "link": "https://stackoverflow.com/users/2694306/user2694306"}, "edited": false, "score": 0, "creation_date": 1478275617, "post_id": 40410087, "comment_id": 68102769, "body": "@user2694306: please show what you&#39;ve tried. This works: <a href=\"https://play.golang.org/p/-wqJ9SPOwj\" rel=\"nofollow noreferrer\">play.golang.org/p/-wqJ9SPOwj</a>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 9, "last_activity_date": 1478202680, "creation_date": 1478202680, "answer_id": 40410087, "question_id": 40409945, "link": "https://stackoverflow.com/questions/40409945/golang-function-with-multiple-input-types/40410087#40410087", "title": "Golang - Function with multiple input types", "body": "<p>You can either use a type assertion to extract the value from an <code>interface{}</code></p>\n\n<pre><code>func updateval(arg interface{}) {\n    switch arg := arg.(type) {\n    case *FooStructOld:\n        arg.foo1 = 1\n    case *FooStructNew:\n        arg.foo1 = 1\n    }\n}\n</code></pre>\n\n<p>Or you could implement an interface that does the update</p>\n\n<pre><code>type FooUpdater interface {\n    UpdateFoo()\n}\n\ntype FooStructOld struct {\n    foo1, foo2, foo3 int\n}\n\nfunc (f *FooStructOld) UpdateFoo() {\n    f.foo1 = 1\n}\n\ntype FooStructNew struct {\n    foo1, foo2 int\n}\n\nfunc (f *FooStructNew) UpdateFoo() {\n    f.foo1 = 1\n}\n\nfunc updateval(arg FooUpdater) {\n    arg.UpdateFoo()\n}\n</code></pre>\n"}], "owner": {"reputation": 3240, "user_id": 2694306, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/a36c65851474c1cca6200426379fd82f?s=128&d=identicon&r=PG&f=1", "display_name": "user2694306", "link": "https://stackoverflow.com/users/2694306/user2694306"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1723, "favorite_count": 0, "accepted_answer_id": 40410087, "answer_count": 1, "score": 1, "last_activity_date": 1478202680, "creation_date": 1478202187, "question_id": 40409945, "link": "https://stackoverflow.com/questions/40409945/golang-function-with-multiple-input-types", "title": "Golang - Function with multiple input types", "body": "<p>I'm brand new to go and can't figure out how to do something pretty basic. Let's say that I have the following two structs:</p>\n\n<pre><code>type FooStructOld struct {\n    foo1, foo2, foo3 int\n}\n\ntype FooStructNew struct {\n    foo1, foo2 int\n}\n</code></pre>\n\n<p>I then want to have a function that updates the input. For example for a single type:</p>\n\n<pre><code>func updateval(arg *FooStructOld) {\n    arg.foo1 = 1\n}\n</code></pre>\n\n<p>This works as expected. However I would like the function <code>updateval</code> to take either FooStructOld or FooStructNew as an input. I know that I should be using an interface type but I can't quite get it to work. For example, when I try the following:</p>\n\n<p>I get this error:</p>\n\n<pre><code>arg.foo1 undefined (type interface {} is interface with no methods)\ncannot assign interface {} to a (type *FooStructOld) in multiple assignment: need type assertion\n</code></pre>\n\n<p>Does anyone know a solution for this?</p>\n"}, {"tags": ["go", "struct", "properties"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1478198813, "post_id": 40409054, "comment_id": 68068216, "body": "The answer depends solely on the type you unmarshal your JSON into. E.g. if you struct contains no pointers than there can be no nil pointer exception. Please show code."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1478198954, "post_id": 40409054, "comment_id": 68068299, "body": "@Volker isn&#39;t that the structs definition there? It has no pointers... to the OP, the only thing you really need to check is that <code>lenght(Data) &gt; x</code>"}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1478199003, "post_id": 40409054, "comment_id": 68068331, "body": "In the struct above you would check that len(data) &gt; 0; Images, Fixed_height, and Url will always have values (even if they don&#39;t exist in the JSON they will be initialized to their zero value in the struct)."}, {"owner": {"reputation": 2726, "user_id": 1533010, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/544d0b0c1e2a6b945ee40af8befd4710?s=128&d=identicon&r=PG", "display_name": "Austin Davis", "link": "https://stackoverflow.com/users/1533010/austin-davis"}, "edited": false, "score": 0, "creation_date": 1478199236, "post_id": 40409054, "comment_id": 68068449, "body": "Sorry I&#39;m coming from the javascript world where everything needs to be checked against ie to the keys existed and do they match the type."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1478206253, "post_id": 40409054, "comment_id": 68072231, "body": "@AustinDavis that&#39;s really just static vs dynamic typing. One works really well, the other attempts to make things easier for developers while actually adding no value and inadvertently conditioning them to write egregiously shitty code :D"}, {"owner": {"reputation": 2726, "user_id": 1533010, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/544d0b0c1e2a6b945ee40af8befd4710?s=128&d=identicon&r=PG", "display_name": "Austin Davis", "link": "https://stackoverflow.com/users/1533010/austin-davis"}, "edited": false, "score": 0, "creation_date": 1478207934, "post_id": 40409054, "comment_id": 68073065, "body": "so just to confirm if for some reason the giphy api decides to send down some partial JSON like Data[x].Images but none of the elements in the array have the property &quot;fixed_height&quot; the json.Unmarshal method will not add them to the struct?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1478209883, "post_id": 40409054, "comment_id": 68073848, "body": "No, the struct will have <code>fixed_height</code> which will have a string <code>Url</code> and that string will be empty. Everything will be there, nothing will be null, they will have default values."}], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 3, "last_activity_date": 1478199061, "creation_date": 1478199061, "answer_id": 40409161, "question_id": 40409054, "link": "https://stackoverflow.com/questions/40409054/how-to-check-for-the-existence-of-key-in-a-nested-struct/40409161#40409161", "title": "How to check for the existence of key in a nested struct", "body": "<p>The only required check (based on the definition of that struct) is that <code>len(Data) &gt; x</code>. Beyond that, everything is a value type so there is no risk of a nil reference panic happening.</p>\n\n<pre><code>if len(Data) &gt; x {\n    // access\n    fmt.Println(Data[x].Images.Fixed_height.Url)\n} else {\n   // do other stuff you to mitigate unexpected input\n}\n</code></pre>\n"}], "owner": {"reputation": 2726, "user_id": 1533010, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/544d0b0c1e2a6b945ee40af8befd4710?s=128&d=identicon&r=PG", "display_name": "Austin Davis", "link": "https://stackoverflow.com/users/1533010/austin-davis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 897, "favorite_count": 0, "accepted_answer_id": 40409161, "answer_count": 1, "score": -1, "last_activity_date": 1478199149, "creation_date": 1478198637, "last_edit_date": 1478199149, "question_id": 40409054, "link": "https://stackoverflow.com/questions/40409054/how-to-check-for-the-existence-of-key-in-a-nested-struct", "title": "How to check for the existence of key in a nested struct", "body": "<p>I have the following struct</p>\n\n<pre><code>   type GiphyJson struct {\n        Type string `json:\"type\"`\n        Data []struct {\n            Images struct {\n                Fixed_height struct {\n                    Url string `json:\"url\"`\n                } `json:\"fixed_height\"`\n            } `json:\"images\"`\n        } `json:\"data\"`\n    }\n</code></pre>\n\n<p>and I need to access <code>Data[x].Images.Fixed_height.Url</code>. Ideally I'd like to be able to check for the existence of each of the Properties 'Data, Images, ,Fixed_height' before accessing Url to ensure I don't have a nil pointer exceptions. Since I'm fairly new to the language I was curious what the idiomatic way of doing this would be.</p>\n\n<p>The following is how i'm using the struct.</p>\n\n<pre><code>var err error\nvar giphyJson GiphyJson\nkeyword = url.QueryEscape(keyword)\nresp, err := http.Get(\"http://api.giphy.com/v1/gifs/search?q=\" + keyword + \"&amp;api_key=dc6zaTOxFJmzC&amp;limit=100\")\nif err != nil {\n    err = errors.New(\"An error occured trying to contact giphy\")\n    return \"\", err\n}\ndefer resp.Body.Close()\nbodyBytes, err := ioutil.ReadAll(resp.Body)\nerr = json.Unmarshal(bodyBytes, &amp;giphyJson)\n</code></pre>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "edited": false, "score": 0, "creation_date": 1478219321, "post_id": 40408081, "comment_id": 68076788, "body": "you can throw each line into a slice and then print [len(slice)-2]"}], "answers": [{"tags": [], "owner": {"reputation": 2998, "user_id": 633969, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GAal0.jpg?s=128&g=1", "display_name": "Andrey Moiseev", "link": "https://stackoverflow.com/users/633969/andrey-moiseev"}, "is_accepted": false, "score": 2, "last_activity_date": 1478196517, "last_edit_date": 1478196517, "creation_date": 1478195745, "answer_id": 40408242, "question_id": 40408081, "link": "https://stackoverflow.com/questions/40408081/get-next-to-last-line-from-a-file/40408242#40408242", "title": "Get next-to-last line from a file", "body": "<p>Just save the current line every iteration, so that when you encounter the last one, you can return <code>prev_line</code>:</p>\n\n<pre><code>func next_to_last(z string) string {\n    f, err := os.Open(z)\n    if err != nil {\n        log.Fatal(err)\n    }\n    bf := bufio.NewReader(f)\n    prev_line := \"\"\n\n    for {\n        switch line, err := bf.ReadString('\\n'); err {\n\n        case nil:\n        // valid line, echo it.  note that line contains trailing \\n.\n        fmt.Println(line)\n        prev_line = line // Save line as previous\n\n        case io.EOF:\n            if line &gt; \"\" {\n                // last line of file missing \\n, but still valid\n                    fmt.Println(line, \"in func\")\n            }\n            return  prev_line // Return previous line\n\n        default:\n            log.Fatal(err)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 7111390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9f2a9f74b1115c2a0156f832ba89264?s=128&d=identicon&r=PG&f=1", "display_name": "user7111390", "link": "https://stackoverflow.com/users/7111390/user7111390"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1478208119, "creation_date": 1478195143, "last_edit_date": 1478208119, "question_id": 40408081, "link": "https://stackoverflow.com/questions/40408081/get-next-to-last-line-from-a-file", "title": "Get next-to-last line from a file", "body": "<p>I found a method how to read last line in file, but last line in my file is empty, I need to read the next-to-last line and I have no idea how to do it, please help a bit.</p>\n\n<pre><code>func ll(z string) string {\n\n    f, err := os.Open(z)\n    if err != nil {\n        log.Fatal(err)\n    }\n    bf := bufio.NewReader(f)\n    for {\n        switch line, err := bf.ReadString('\\n'); err {\n        case nil:\n        // valid line, echo it.  note that line contains trailing \\n.\n        fmt.Println(line)\n\n        case io.EOF:\n            if line &gt; \"\" {\n                // last line of file missing \\n, but still valid\n                    fmt.Println(line, \"in func\")\n            }\n            return  line\n        default:\n            log.Fatal(err)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["encryption", "go", "base64"], "answers": [{"tags": [], "owner": {"reputation": 1426, "user_id": 1520594, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1fcaa128750715b5631f1c2c109e4eb?s=128&d=identicon&r=PG", "display_name": "algrebe", "link": "https://stackoverflow.com/users/1520594/algrebe"}, "is_accepted": true, "score": 1, "last_activity_date": 1478270510, "last_edit_date": 1495535272, "creation_date": 1478270067, "answer_id": 40425299, "question_id": 40407819, "link": "https://stackoverflow.com/questions/40407819/golang-illegal-base64-data-at-input-byte-0/40425299#40425299", "title": "golang illegal base64 data at input byte 0", "body": "<p>You need to unquote the <code>encrypted_text</code> returned from the scanner.\nHere's a <a href=\"https://play.golang.org/p/o_8tAoZxsL\" rel=\"nofollow noreferrer\">minimal example</a></p>\n\n<p>Modify your <code>scanner.Scan()</code> if block to look like this</p>\n\n<pre><code>    if scanner.Scan() { //&lt;==========READ FROM FILE\n        encrypted_text = scanner.Text()\n        fmt.Println(\"encrypted_text from file: \", encrypted_text)\n\n        // Unquoting, don't forget to import strconv !\n        encrypted_text, err := strconv.Unquote(`\"` + encrypted_text + `\"`)\n        check(err)\n    }\n</code></pre>\n\n<blockquote>\n  <p>why you need to unquote</p>\n</blockquote>\n\n<p>I'm guessing your file <code>test.txt</code> contains the raw string</p>\n\n<pre><code>\\xf2F\\xbc\\x15\\x9d\\xaf\\xceQ\\xa3L(&gt;%\\xa2\\x94\\x03_\\x99\\u007fG\\xd8\\v\\xbf\\t#u\\xf8:\\xc0D\\u007f\n</code></pre>\n\n<p>When scanner reads this from the file, it is reading a <code>\\</code> as a <code>\\</code>.</p>\n\n<p>However, when you hardcode it in your code like this</p>\n\n<pre><code>encrypted_text  = \"\\xf2F\\xbc\\x15\\x9d\\xaf\\xce\u03d8\\xa3L(&gt;%\\xa2\\x94\\x03_\\x99\\u007fG\\xd8\\v\\xbf\\t#u\\xf8:\\xc0D\\u007f\"\n</code></pre>\n\n<p>You are using double quotes <code>\"</code>, so a <code>\\</code> isn't a <code>\\</code>. It interprets the escape sequences. If you were to use a backquote as follows</p>\n\n<pre><code>encrypted_text  = `\\xf2F\\xbc\\x15\\x9d\\xaf\\xce\u03d8\\xa3L(&gt;%\\xa2\\x94\\x03_\\x99\\u007fG\\xd8\\v\\xbf\\t#u\\xf8:\\xc0D\\u007f`\n</code></pre>\n\n<p>you would face the same issue.</p>\n\n<p>The solution is to unquote this string using <a href=\"https://golang.org/pkg/strconv/#Unquote\" rel=\"nofollow noreferrer\">strconv.Unquote</a></p>\n\n<p>Also, take a look at <a href=\"https://stackoverflow.com/questions/35519106/how-to-decode-a-string-containing-backslash-encoded-unicode-characters/35519469\">This SO question</a></p>\n"}], "owner": {"reputation": 70, "user_id": 2464808, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d7b141dcfd50db5d97b2d075b4bc5d78?s=128&d=identicon&r=PG", "display_name": "Vincent Li", "link": "https://stackoverflow.com/users/2464808/vincent-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10453, "favorite_count": 0, "accepted_answer_id": 40425299, "answer_count": 1, "score": 2, "last_activity_date": 1478270510, "creation_date": 1478194225, "question_id": 40407819, "link": "https://stackoverflow.com/questions/40407819/golang-illegal-base64-data-at-input-byte-0", "title": "golang illegal base64 data at input byte 0", "body": "<p>I have a go test program to read encrypted content from file and decrypt it, but it get output like below:</p>\n\n<p>illegal base64 data at input byte 0</p>\n\n<p>if  I hard code the encrypted content in a golang string variable, it can decrypt it fine. what I am missing here? I searched similar error in stackoverflow, there is similar report, but not exact the same problem I have. the test code like below:</p>\n\n<pre><code>package main\n\nimport (\n\"crypto/aes\"\n\"crypto/cipher\"\n\"crypto/rand\"\n\"encoding/base64\"\n\"errors\"\n\"fmt\"\n\"io\"\n\"bufio\"\n\"os\"\n\"log\"\n\n)\n\n\nfunc check(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\n\nfunc main() {\n    plaintext := []byte(\"textstring\")\n    key := []byte(\"a very very very very very secre\")\n    fmt.Printf(\"%s\\n\", plaintext)\n\n    fh, err := os.Open(\"./test.txt\")\n    check(err)\n    scanner := bufio.NewScanner(fh)\n    var encrypted_text string\n    if scanner.Scan() { //&lt;==========READ FROM FILE\n    encrypted_text = scanner.Text()\n        fmt.Println(\"encrypted_text from file: \", encrypted_text)\n    } else { //&lt;===========HARD CODE HERE\n        encrypted_text  = \"\\xf2F\\xbc\\x15\\x9d\\xaf\\xce\u03d8\\xa3L(&gt;%\\xa2\\x94\\x03_\\x99\\u007fG\\xd8\\v\\xbf\\t#u\\xf8:\\xc0D\\u007f\"\n        fmt.Println(\"encrypted_text hard coded: \", encrypted_text)\n    }\n\n    encrypted_byte  := []byte(encrypted_text)\n    fmt.Printf(\"encrypted_byte: %s\\n\", encrypted_byte)\n    result, err := decrypt(key, encrypted_byte)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"result %s\\n\", string(result))\n}\n\nfunc encrypt(key, text []byte) ([]byte, error) {\n    block, err := aes.NewCipher(key)\n    if err != nil {\n        return nil, err\n    }\n    b := base64.StdEncoding.EncodeToString(text)\n    ciphertext := make([]byte, aes.BlockSize+len(b))\n    iv := ciphertext[:aes.BlockSize]\n    if _, err := io.ReadFull(rand.Reader, iv); err != nil {\n        return nil, err\n    }\n    cfb := cipher.NewCFBEncrypter(block, iv)\n    cfb.XORKeyStream(ciphertext[aes.BlockSize:], []byte(b))\n    return ciphertext, nil\n}\n\nfunc decrypt(key, text []byte) ([]byte, error) {\n    block, err := aes.NewCipher(key)\n    if err != nil {\n        return nil, err\n    }\n    if len(text) &lt; aes.BlockSize {\n        return nil, errors.New(\"ciphertext too short\")\n    }\n    iv := text[:aes.BlockSize]\n    text = text[aes.BlockSize:]\n    cfb := cipher.NewCFBDecrypter(block, iv)\n    cfb.XORKeyStream(text, text)\n    data, err := base64.StdEncoding.DecodeString(string(text))\n    if err != nil {\n        return nil, err\n    }\n    return data, nil\n}\n</code></pre>\n"}, {"tags": ["api", "go", "mattermost"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1478193287, "post_id": 40407347, "comment_id": 68065204, "body": "It&#39;s likely that the example you&#39;re looking at is just old and out of date. Looking at the docs, <a href=\"https://godoc.org/github.com/mattermost/platform/model#ChannelList\" rel=\"nofollow noreferrer\"><code>ChannelList</code></a> is a <code>[]*Channel</code> slice, so just range over that."}], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 6325807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad027a7a382fffb7ea4237a6af7494d5?s=128&d=identicon&r=PG&f=1", "display_name": "Harrison Healey", "link": "https://stackoverflow.com/users/6325807/harrison-healey"}, "is_accepted": false, "score": 0, "last_activity_date": 1478531277, "creation_date": 1478531277, "answer_id": 40468412, "question_id": 40407347, "link": "https://stackoverflow.com/questions/40407347/unable-to-get-a-list-of-mattermost-channels-in-golang/40468412#40468412", "title": "Unable to get a list of mattermost channels in golang", "body": "<p>JimB is correct. The <code>model.ChannelList</code> type used to be a struct, but it recently changed to <code>[]*model.Channel</code>. You'll want to change</p>\n\n<pre><code>for _, channel := range channelList.Channels {\n</code></pre>\n\n<p>to</p>\n\n<pre><code>for _, channel := range *channelList {\n</code></pre>\n"}], "owner": {"reputation": 597, "user_id": 1460991, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/a8c1a4a881ddda8411db0c59c6678cf9?s=128&d=identicon&r=PG", "display_name": "FlowRaja", "link": "https://stackoverflow.com/users/1460991/flowraja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 232, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1478531277, "creation_date": 1478192649, "question_id": 40407347, "link": "https://stackoverflow.com/questions/40407347/unable-to-get-a-list-of-mattermost-channels-in-golang", "title": "Unable to get a list of mattermost channels in golang", "body": "<p>I am trying to create a bot and retrieve the list of channels.\nI used the <a href=\"https://github.com/mattermost/mattermost-bot-sample-golang/blob/master/bot_sample.go\" rel=\"nofollow noreferrer\">bot example</a> in repository and it is mostly working, except for the part where it has to get the list of channels.</p>\n\n<p>Either I am doing something silly or <a href=\"https://godoc.org/github.com/mattermost/platform/model#Client.GetChannels\" rel=\"nofollow noreferrer\">GetChannels API</a> really does not work the way it is described in bot_sample.go .\nI made a smaller <a href=\"https://gist.github.com/prateeksriv/65093eb187edf56bfacebabbf32abfea\" rel=\"nofollow noreferrer\">separate function</a> to test that part.</p>\n\n<p>Adding code here for better readability:</p>\n\n<pre><code>func mattermostPrintChannels(client *mattermost.Client) {\n    channelsResult, err := client.GetChannels(\"\")\n    if err != nil {\n        fmt.Print(\"Couldn't get channels: \", err)\n        return\n    }\n    channelList := channelsResult.Data.(*mattermost.ChannelList)\n    fmt.Print(\"Channels:\")\n    for _, channel := range channelList.Channels {\n        fmt.Printf(\"%s -&gt; %s\", channel.Id, channel.DisplayName)\n    }\n}\n</code></pre>\n\n<p>This code gives me the error:</p>\n\n<blockquote>\n  <p>./mattermost.go:30: channelList.Channels undefined (type\n  *model.ChannelList has no field or method Channels)</p>\n</blockquote>\n\n<p>Now if I just print the contents of ChannelList variable (using spew), I get the following:</p>\n\n<pre><code>channelList:  :  ([]interface {}) (len=1 cap=1) {\n (*model.ChannelList)(&lt;nil&gt;)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1478199801, "post_id": 40406519, "comment_id": 68068792, "body": "Out of curiosity, what could be more simple than an if/else statement? It may be different in other languages, but in Go if/else is perfectly idiomatic."}, {"owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "reply_to_user": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1478244094, "post_id": 40406519, "comment_id": 68083676, "body": "@SamWhited in this case its simple  but I am not asking this question specifically for this case, I am asking this question for the case when you have a structure containing fields that are pointers and you want to log them instead logging their addresses"}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1478269672, "post_id": 40406519, "comment_id": 68098527, "body": "maybe I&#39;m still misunderstanding then; I don&#39;t understand why this would be any different with more pointers or structs. Are you just wanting a different syntax for if/else like the ternary operator (?:) suggested in one of the answers?"}, {"owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "reply_to_user": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1478274941, "post_id": 40406519, "comment_id": 68102308, "body": "@SamWhited no, what I need is to be able to create a method or to use some library that have a method that takes any structure and loops into its elements and log/print them;"}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1478277477, "post_id": 40406519, "comment_id": 68103900, "body": "Ah, I see, thank you; that was not at all clear to me from the example (which doesn&#39;t even contain a struct) or the text; maybe you could the example and phrase it how you did in that comment? It would be much clearer."}], "answers": [{"comments": [{"owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "edited": false, "score": 0, "creation_date": 1478244231, "post_id": 40406653, "comment_id": 68083725, "body": "in this case its simple but I am not asking this question specifically for this case, I am asking this question for the case when you have a structure containing fields that are pointers and you want to log them instead logging their addresses so if I want to use some method it should loop over all elements of any structure"}], "tags": [], "owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "is_accepted": false, "score": 1, "last_activity_date": 1478190358, "creation_date": 1478190358, "answer_id": 40406653, "question_id": 40406519, "link": "https://stackoverflow.com/questions/40406519/how-can-i-log-the-value-of-a-pointer-if-it-is-not-nil-otherwise-log-nil-in-go/40406653#40406653", "title": "How can I log the value of a pointer if it is not nil, otherwise log nil in GO?", "body": "<p>Since there is no <code>?:</code> operator in Go, the best way is to write a function:</p>\n\n<pre><code>func StringPtrToString(p *string) string {\n    if p != nil { return *p }\n    return \"(nil)\"\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "edited": false, "score": 0, "creation_date": 1478244313, "post_id": 40413352, "comment_id": 68083759, "body": "in this case it&#39;s simple but I am not asking this question specifically for this case, I am asking this question for the case when you have a structure containing fields that are pointers and you want to log them instead logging their addresses"}, {"owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "reply_to_user": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "edited": false, "score": 0, "creation_date": 1478268009, "post_id": 40413352, "comment_id": 68097297, "body": "It wasn&#39;t clear in your original post that you were looking for examples of pointers inside a struct. In any case, I edited my answer with the variables in a struct. It works the same way."}, {"owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "edited": false, "score": 0, "creation_date": 1478274742, "post_id": 40413352, "comment_id": 68102156, "body": "thank you but when I meant structure I meant any structure so I can create a method or something that takes any structure and loops on the structure elements and log them. But I will upvote your answer thank you"}, {"owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "reply_to_user": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "edited": false, "score": 0, "creation_date": 1478275110, "post_id": 40413352, "comment_id": 68102440, "body": "@user6638204 Do you mean putting multiple instances of a <code>struct</code> as I suggested above into a dynamic array (slice) and writing a function that loops (ranges) through it printing the contents?"}], "tags": [], "owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "is_accepted": false, "score": 1, "last_activity_date": 1478267916, "last_edit_date": 1478267916, "creation_date": 1478218442, "answer_id": 40413352, "question_id": 40406519, "link": "https://stackoverflow.com/questions/40406519/how-can-i-log-the-value-of-a-pointer-if-it-is-not-nil-otherwise-log-nil-in-go/40413352#40413352", "title": "How can I log the value of a pointer if it is not nil, otherwise log nil in GO?", "body": "<p>You should probably use if/else in this case BUT if you have many potential \"if\" conditions for each of <code>point</code> and <code>point2</code> you can use Switch statements.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n    type Points struct {\n        Point  *string\n        Point2 *string\n    }\n\n    p := \"hi\"\n    pts := Points{nil, &amp;p}\n\n    switch pts.Point {\n    case nil:\n        fmt.Printf(\"%v is empty\", pts.Point)\n    default:\n        fmt.Printf(\"%v\", *pts.Point)\n\n    }\n\n    fmt.Println()\n\n    switch pts.Point2 {\n    case nil:\n        fmt.Printf(\"%v is empty\", pts.Point2)\n    default:\n        fmt.Printf(\"%v\", *pts.Point2)\n\n    }\n\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>&lt;nil&gt; is empty\nhi\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/1TL_kmFpe8\" rel=\"nofollow noreferrer\">Go playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 3406, "user_id": 110186, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/AemXl.jpg?s=128&g=1", "display_name": "Feckmore", "link": "https://stackoverflow.com/users/110186/feckmore"}, "is_accepted": false, "score": 1, "last_activity_date": 1570458618, "creation_date": 1570458618, "answer_id": 58271681, "question_id": 40406519, "link": "https://stackoverflow.com/questions/40406519/how-can-i-log-the-value-of-a-pointer-if-it-is-not-nil-otherwise-log-nil-in-go/58271681#58271681", "title": "How can I log the value of a pointer if it is not nil, otherwise log nil in GO?", "body": "<p>For a more general way to log out values of pointers or even pointers within structs you can marshal to JSON and log the results.</p>\n\n<p>Here's an example that prints individual pointer &amp; non-pointer values, as well as a struct using this method.</p>\n\n<pre><code>type Line struct {\n    Point1 *string\n    Point2 *string\n    Name   string\n}\n\nfunc main() {\n    point1 := \"one\"\n    line := Line{&amp;point1, nil, \"fancy\"}\n\n    printJSON(line.Point1, line.Point2, line.Name)\n    printJSON(line)\n}\n\nfunc printJSON(i ...interface{}) {\n    if b, err := json.Marshal(i); err == nil {\n        log.Println(string(b))\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ziEoRVPfaYm\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}], "owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1071, "favorite_count": 1, "answer_count": 3, "score": 5, "last_activity_date": 1570458618, "creation_date": 1478189960, "last_edit_date": 1478195197, "question_id": 40406519, "link": "https://stackoverflow.com/questions/40406519/how-can-i-log-the-value-of-a-pointer-if-it-is-not-nil-otherwise-log-nil-in-go", "title": "How can I log the value of a pointer if it is not nil, otherwise log nil in GO?", "body": "<p>Hi I want to log the value of a variable if it is not nil otherwise I want to print anything else</p>\n\n<p>for example:</p>\n\n<pre><code>var point *string\nvar point2 *string\n\np:=\"hi\"\n\npoint2=&amp;p\n\nfmt.Printf(\"%v,%v\",*point,*point2)\n</code></pre>\n\n<p>in this case I will have an error since point is nill, so is there any way to print the value of the variable if it is not nil or print anything else if it is nil?</p>\n\n<p>I want to do this in a simple way instead of creating an if/else statement to check if the variable is nil </p>\n"}, {"tags": ["go", "ip", "cidr"], "answers": [{"comments": [{"owner": {"reputation": 445, "user_id": 2960066, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/05fd25313e5fb4858702554800d4c397?s=128&d=identicon&r=PG", "display_name": "faersons", "link": "https://stackoverflow.com/users/2960066/faersons"}, "edited": false, "score": 0, "creation_date": 1478194535, "post_id": 40406619, "comment_id": 68065824, "body": "Thank you very much! Some tests scenarios for your solution can be found here: <a href=\"https://play.golang.org/p/Q4J-JEN3sF\" rel=\"nofollow noreferrer\">play.golang.org/p/Q4J-JEN3sF</a>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1478191080, "last_edit_date": 1478191080, "creation_date": 1478190282, "answer_id": 40406619, "question_id": 40406230, "link": "https://stackoverflow.com/questions/40406230/net-ipnet-inside-other-net-ipnet/40406619#40406619", "title": "net.IPNet inside other net.IPNet?", "body": "<p>Check that the mask for the outer subnet is the same size or smaller than the inner, then verify that the starting address for the inner subnet is contained in the outer:</p>\n\n<pre><code>func ContainsCIDR(ipnet1, ipnet2 *net.IPNet) bool {\n    ones1, _ := ipnet1.Mask.Size()\n    ones2, _ := ipnet2.Mask.Size()\n    return ones1 &lt;= ones2 &amp;&amp; ipnet1.Contains(ipnet2.IP)\n}\n</code></pre>\n"}], "owner": {"reputation": 445, "user_id": 2960066, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/05fd25313e5fb4858702554800d4c397?s=128&d=identicon&r=PG", "display_name": "faersons", "link": "https://stackoverflow.com/users/2960066/faersons"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 0, "accepted_answer_id": 40406619, "answer_count": 1, "score": 0, "last_activity_date": 1478191080, "creation_date": 1478189030, "question_id": 40406230, "link": "https://stackoverflow.com/questions/40406230/net-ipnet-inside-other-net-ipnet", "title": "net.IPNet inside other net.IPNet?", "body": "<p>In <code>net.IPNet</code> type we have the Contains method to check if a <code>net.IP</code> is inside it. But what I want is to know if a <code>net.IPNet</code> is inside another <code>net.IPNet</code>. I tried a solution working with <code>big.Int</code> but it didn't work (also, the function interface was terrible). Any ideas?</p>\n\n<pre><code>// ipnet2 contains ipnet1 ?\nfunc ContainsCIDR(ipnet1, ipnet2 net.IPNet) bool {\n    var begin big.Int\n    begin.SetBytes([]byte(ipnet1.IP))\n\n    var mask big.Int\n    mask.SetBytes([]byte(ipnet1.Mask))\n\n    var diff big.Int\n    diff.Xor(&amp;begin, &amp;mask)\n\n    var end big.Int\n    end.Add(&amp;begin, &amp;diff)\n\n    ipBegin := net.IP(begin.Bytes())\n    ipEnd := net.IP(end.Bytes())\n\n    return ipnet2.Contains(ipBegin) &amp;&amp; ipnet2.Contains(ipEnd)\n}\n</code></pre>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 3, "creation_date": 1478187141, "post_id": 40405407, "comment_id": 68061197, "body": "The error message is pretty clear. Type assertions are for interface types only. Also, this check can be done at compile time with <code>var _ work = &amp;organ{}</code>."}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 4, "creation_date": 1478187742, "post_id": 40405407, "comment_id": 68061606, "body": "If you just have a variable of type &quot;organ&quot; you already know the type, so there&#39;s no need to assert that it&#39;s a worker (just call filter and if it&#39;s not a worker the build will fail). Casting a concrete type to an interface and then checking it is code smell in Go; there may be uses for it, but it&#39;s probably best if you let the compiler sort it out for you instead."}, {"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1583548037, "post_id": 40405407, "comment_id": 107165158, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/27803654/explanation-of-checking-if-value-implements-interface\">Explanation of checking if value implements interface</a>"}], "answers": [{"tags": [], "owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "is_accepted": true, "score": 7, "last_activity_date": 1478187769, "last_edit_date": 1478187769, "creation_date": 1478187422, "answer_id": 40405643, "question_id": 40405407, "link": "https://stackoverflow.com/questions/40405407/usage-of-interface-on-a-struct-to-check-if-it-satisfies-an-interface-in-golang/40405643#40405643", "title": "usage of interface{} on a struct to check if it satisfies an interface in golang", "body": "<p>TL;DR If you always know the concrete type (e.g., <code>kidney</code>), then you don't need a type assertion; just pass it into your <code>work</code> variable and carry on--the compiler will guarantee that <code>kidney</code> satisfies the <code>work</code> interface, otherwise your program won't compile.</p>\n\n<p>The reason you must first convert the <em>concrete type</em> into an <code>interface{}</code> is because type assertions (i.e., <em>dynamic type checks</em>) only make sense between <em>dynamic types</em> (i.e., interfaces). It doesn't make sense to do a runtime type check on a thing the compiler can guarantee at compile time. Hopefully this makes sense?</p>\n"}], "owner": {"reputation": 3480, "user_id": 2686821, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/5dd46afe4f5a75f2667569582b20ac9b?s=128&d=identicon&r=PG&f=1", "display_name": "soupybionics", "link": "https://stackoverflow.com/users/2686821/soupybionics"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1662, "favorite_count": 0, "accepted_answer_id": 40405643, "answer_count": 1, "score": 4, "last_activity_date": 1534393175, "creation_date": 1478186756, "last_edit_date": 1534393175, "question_id": 40405407, "link": "https://stackoverflow.com/questions/40405407/usage-of-interface-on-a-struct-to-check-if-it-satisfies-an-interface-in-golang", "title": "usage of interface{} on a struct to check if it satisfies an interface in golang", "body": "<p>Given the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype work interface {\n    filter() bool\n}\n\ntype organ struct {\n    name string\n}\n\nfunc (s *organ) filter () bool {\n    return true;\n}\n\n\nfunc main() {\n    kidney := &amp;organ {\n            name : \"kidney\",    \n        }\n\n    _, ok := interface{}(kidney).(work)\n    fmt.Println(ok);\n}\n</code></pre>\n\n<p>I did not fully get the following part:</p>\n\n<pre><code>_, ok := interface{}(kidney).(work)\n</code></pre>\n\n<p>It seems to me, it is converting struct to the <code>interface{}</code> type, which I understand, but why is it required to convert to an <code>interface{}</code> type to check if it satisfies another interface. More specifically, why the following code fails?</p>\n\n<pre><code>ok := kidney.(work)\n</code></pre>\n\n<p>with error </p>\n\n<p><code>invalid type assertion: kidney.(work) (non-interface type *organ on left)</code></p>\n"}, {"tags": ["mysql", "sql", "go", "orm"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1478189599, "post_id": 40405389, "comment_id": 68062852, "body": "Have you checked projects like <a href=\"https://github.com/Masterminds/squirrel\" rel=\"nofollow noreferrer\">github.com/Masterminds/squirrel</a> or <a href=\"https://github.com/gocraft/dbr\" rel=\"nofollow noreferrer\">github.com/gocraft/dbr</a> ?"}, {"owner": {"reputation": 1434, "user_id": 3218277, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2thlD.jpg?s=128&g=1", "display_name": "Bloomca", "link": "https://stackoverflow.com/users/3218277/bloomca"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1478190412, "post_id": 40405389, "comment_id": 68063409, "body": "I&#39;ve seen them, but due to educational purposes I&#39;ve decided to go with plain SQL. So, any of these libraries is good enough to use as SQL builder?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1478193871, "post_id": 40405389, "comment_id": 68065470, "body": "I have preference for dbr, I m no one to say if there are good to use, i trust others for that, i can only tell they are helpful to manage the pain of sql. BTW, for education purpose I found this very interesting <a href=\"http://go-database-sql.org/\" rel=\"nofollow noreferrer\">go-database-sql.org</a>"}], "owner": {"reputation": 1434, "user_id": 3218277, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2thlD.jpg?s=128&g=1", "display_name": "Bloomca", "link": "https://stackoverflow.com/users/3218277/bloomca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 825, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1478186694, "creation_date": 1478186694, "question_id": 40405389, "link": "https://stackoverflow.com/questions/40405389/construct-dynamic-sql-queries-in-go", "title": "Construct dynamic SQL queries in Go", "body": "<p>I am not very experienced developer in backend, and I am trying to build the simple CMS. I use go and gin framework, and database/sql package to interact with DB. So, the question is that sometimes I have to perform very similar queries, but they are slightly different.\nFor example, sometimes I want to add <code>where</code> clause dynamically, or simply omit it. Or I have to create new row or updating existing \u2013 despite different query, they basically perform similar operations. Or I want to add <code>or</code> clause.</p>\n\n<p>So, I write a lot of duplicated code. What is the best way to avoid it?</p>\n"}, {"tags": ["multithreading", "go", "concurrency", "channel", "goroutine"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1478186817, "post_id": 40405132, "comment_id": 68060967, "body": "Related: <a href=\"http://stackoverflow.com/questions/38170852/is-this-an-idiomatic-worker-thread-pool-in-go\">Is this an idiomatic worker thread pool in Go?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 977, "user_id": 936933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ba6837a7a02272ffd568e729bff958e?s=128&d=identicon&r=PG", "display_name": "FryDay", "link": "https://stackoverflow.com/users/936933/fryday"}, "edited": false, "score": 0, "creation_date": 1478187804, "post_id": 40405584, "comment_id": 68061650, "body": "That worked, thank you so much! I knew I was close :P"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1478190408, "last_edit_date": 1495540844, "creation_date": 1478187271, "answer_id": 40405584, "question_id": 40405132, "link": "https://stackoverflow.com/questions/40405132/simple-worker-pool-in-go/40405584#40405584", "title": "Simple worker pool in Go", "body": "<p>The problem is that you only start \"draining\" the <code>results</code> channel, once you successfully sent all jobs on the <code>jobs</code> channel. But for you to be able to send all jobs, either the <code>jobs</code> channel must have big enough buffer, or worker goroutines must be able to consume jobs from it.</p>\n\n<p>But a worker goroutines when consuming a job, before it could take the next one, sends the result on the <code>results</code> channel. If the buffer of the <code>results</code> channel is full, sending the result will block.</p>\n\n<p>But the last part \u2013 a worker goroutine blocked in sending the result \u2013 can only be \"unblocked\" by receiving from the <code>results</code> channel \u2013 which you don't until you can send all the jobs. Deadlock if the buffer of the <code>jobs</code> channel and the <code>results</code> channel cannot hold all your jobs. This also explains why it works if you increase the buffer size to a big value: if the jobs can fit into the buffers, deadlock will not occur, and after all jobs are sent successfully, your final loop will drain the <code>results</code> channel.</p>\n\n<p>The solution? Run generating-and-sending jobs in its own goroutine, so you can start receiving from the <code>results</code> channel \"immediately\" without having to wait to send all jobs, which means the worker goroutines will not get blocked forever trying to send results:</p>\n\n<pre><code>go func() {\n    for j := 0; j &lt; len(images); j++ {\n        jobs &lt;- imageMessage{path: paths[j], img: images[j]}\n    }\n    close(jobs)\n}()\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/jvitOGmzpl\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Also check out a similar implementation in <a href=\"https://stackoverflow.com/questions/38170852/is-this-an-idiomatic-worker-thread-pool-in-go/38172204#38172204\">Is this an idiomatic worker thread pool in Go?</a></p>\n"}], "owner": {"reputation": 977, "user_id": 936933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ba6837a7a02272ffd568e729bff958e?s=128&d=identicon&r=PG", "display_name": "FryDay", "link": "https://stackoverflow.com/users/936933/fryday"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1016, "favorite_count": 1, "accepted_answer_id": 40405584, "answer_count": 1, "score": 3, "last_activity_date": 1478190408, "creation_date": 1478185991, "last_edit_date": 1478188096, "question_id": 40405132, "link": "https://stackoverflow.com/questions/40405132/simple-worker-pool-in-go", "title": "Simple worker pool in Go", "body": "<p>I am trying to implement a simple worker pool in go and keep running into issues. All I want to do is have a set number of workers that do a set amount of work before getting more work to do. The code I am using looks similar to:</p>\n\n<pre><code>    jobs := make(chan imageMessage, 1)\n    results := make(chan imageMessage, 1)\n\n    for w := 0; w &lt; 2; w++ {\n        go worker(jobs, results)\n    }\n\n    for j := 0; j &lt; len(images); j++ {\n        jobs &lt;- imageMessage{path: paths[j], img: images[j]}\n    }\n    close(jobs)\n\n    for r := 0; r &lt; len(images); r++ {\n        &lt;-results\n    }\n}\n\nfunc worker(jobs &lt;-chan imageMessage, results chan&lt;- imageMessage) {\n    for j := range jobs {\n        processImage(j.path, j.img)\n        results &lt;- j\n    }\n}\n</code></pre>\n\n<p>My understanding is that this should create 2 workers that can do 1 \"thing\" at a time and will continue to get more work as they complete that 1 thing until there is nothing else to do. However, I get <code>fatal error: all goroutines are asleep - deadlock!</code></p>\n\n<p>If I set the buffer to something huge like 100, this works, but I want to be able to limit the work done at a time.</p>\n\n<p>I feel like I'm close, but obviously missing something.</p>\n"}, {"tags": ["go", "rethinkdb"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1478182444, "post_id": 40403594, "comment_id": 68057574, "body": "The term you want to search for is &quot;Transliteration&quot;"}, {"owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "edited": false, "score": 6, "creation_date": 1478182459, "post_id": 40403594, "comment_id": 68057584, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/26722450/remove-diacritics-using-go\">Remove diacritics using Go</a>"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1478184484, "post_id": 40403594, "comment_id": 68059181, "body": "The duplicate suggestion is correct, however this is usually handled by the database&#39;s own collation settings. If you can get rethink&#39;s index to do this for you regardless of the client side implementation, it&#39;s a better option."}, {"owner": {"reputation": 770, "user_id": 5347945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/314fa7f57283b7ee9f1a207bb9d44828?s=128&d=identicon&r=PG&f=1", "display_name": "Fantasim", "link": "https://stackoverflow.com/users/5347945/fantasim"}, "reply_to_user": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "edited": false, "score": 0, "creation_date": 1478201128, "post_id": 40403594, "comment_id": 68069462, "body": "@jussius How can use this function with rethinkdb ?"}], "owner": {"reputation": 770, "user_id": 5347945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/314fa7f57283b7ee9f1a207bb9d44828?s=128&d=identicon&r=PG&f=1", "display_name": "Fantasim", "link": "https://stackoverflow.com/users/5347945/fantasim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1478202445, "creation_date": 1478181931, "last_edit_date": 1478202445, "question_id": 40403594, "link": "https://stackoverflow.com/questions/40403594/search-by-start-string-with-accent", "title": "Search by start string with accent", "body": "<p>I'm trying to remove accents of occurrences looked somewhat the same way that the function downcase.</p>\n\n<p>Currently searching for all results starting with a string like that :</p>\n\n<pre><code>r.Table(\"places\").Filter(func(customer r.Term) interface{}{\n             return customer.Field(\"Name\").Downcase().Match(\"^\" + strings.ToLower(value))\n         })\n</code></pre>\n\n<p>but it does not work with words with an accent in the word.</p>\n\n<p>Example : with search word \"yes\", it'll find : </p>\n\n<pre><code>\"yes\"   \"yesy\"   \"yessss\"\n</code></pre>\n\n<p>but not </p>\n\n<pre><code>\"y\u00e9s\"\n</code></pre>\n\n<p>What is the best way to remove accents in query to pick them up, too?</p>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"reputation": 996, "user_id": 4720042, "user_type": "registered", "accept_rate": 95, "profile_image": "https://lh4.googleusercontent.com/-HJtrEmnS3s8/AAAAAAAAAAI/AAAAAAAABUo/w4vFRFBUbqE/photo.jpg?sz=128", "display_name": "Gaurav Ojha", "link": "https://stackoverflow.com/users/4720042/gaurav-ojha"}, "edited": false, "score": 1, "creation_date": 1478167712, "post_id": 40398706, "comment_id": 68047455, "body": "do a log.Println(err) and see the contents of it, you can also customize the way errors are displayed - <a href=\"https://blog.golang.org/error-handling-and-go\" rel=\"nofollow noreferrer\">blog.golang.org/error-handling-and-go</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1478167954, "post_id": 40398706, "comment_id": 68047615, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/37560534/golang-postgres-error-constants\">Golang postgres error constants?</a>"}, {"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 0, "creation_date": 1478175131, "post_id": 40398706, "comment_id": 68052214, "body": "I would not check the message, but the error <i>code</i>."}], "answers": [{"comments": [{"owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "edited": false, "score": 0, "creation_date": 1478177539, "post_id": 40399075, "comment_id": 68053975, "body": "thank you, but I was hoping to find something other than this"}], "tags": [], "owner": {"reputation": 332, "user_id": 6546677, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/de651bfc703df6b36099a32d569d8737?s=128&d=identicon&r=PG&f=1", "display_name": "George H", "link": "https://stackoverflow.com/users/6546677/george-h"}, "is_accepted": false, "score": 1, "last_activity_date": 1478168633, "creation_date": 1478168633, "answer_id": 40399075, "question_id": 40398706, "link": "https://stackoverflow.com/questions/40398706/what-is-the-name-of-this-error-update-or-delete-on-table-tablename-violates-f/40399075#40399075", "title": "What is the name of this error `update or delete on table &quot;tablename&quot; violates foreign key constraint` in GO?", "body": "<p>Maybe I'm not understanding your question but from what I get you simply want to test if the error has something to do with the foreign key column in your table. So why not find a common \"phrase\" that all the foreign key related errors have and do something like:</p>\n\n<pre><code>import (\n   //...\n   \"string\"\n)\n\nvar foreignKeyError = \"Here we have a substring that always appears in this type of errors\"\n\n//...\nif err != nil {\n\n    if strings.Contains(err.Error(), foreignKeyError) {\n        specialFunctionThatHandlesThisTypeOfError(err)\n    } \n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "is_accepted": true, "score": 5, "last_activity_date": 1478187089, "last_edit_date": 1478187089, "creation_date": 1478186183, "answer_id": 40405207, "question_id": 40398706, "link": "https://stackoverflow.com/questions/40398706/what-is-the-name-of-this-error-update-or-delete-on-table-tablename-violates-f/40405207#40405207", "title": "What is the name of this error `update or delete on table &quot;tablename&quot; violates foreign key constraint` in GO?", "body": "<p>Good question! My best guess is that this is a <code>github.com/lib/pq.Error</code>, but you can confirm this by pasting <code>fmt.Printf(\"%T\\n\", err)</code> at the error site. Going off this assumption, we can <a href=\"https://godoc.org/github.com/lib/pq#Error\" rel=\"noreferrer\">check the properties of this type</a>:</p>\n\n<pre><code>type Error struct {\n    Severity         string\n    Code             ErrorCode\n    Message          string\n    Detail           string\n    Hint             string\n    Position         string\n    InternalPosition string\n    InternalQuery    string\n    Where            string\n    Schema           string\n    Table            string\n    Column           string\n    DataTypeName     string\n    Constraint       string\n    File             string\n    Line             string\n    Routine          string\n}\n</code></pre>\n\n<p>Cool! Looks like we have an <code>ErrorCode</code> member. We can then check <a href=\"https://www.postgresql.org/docs/9.4/static/errcodes-appendix.html\" rel=\"noreferrer\">Postgres's error code list</a>, where we find <code>23503 | foreign_key_violation</code>. Putting all this together, it looks like you can do this:</p>\n\n<pre><code>const foreignKeyViolationErrorCode = ErrorCode(\"23503\")\nif err != nil {\n    if pgErr, isPGErr := err.(pq.Error); isPGErr {\n        if pgErr.ErrorCode != foreignKeyViolationErrorCode {\n            // handle foreign_key_violation errors here\n        }\n    }\n    // handle non-foreign_key_violation errors\n}\n</code></pre>\n\n<p><strong>NOTE:</strong> there may be other error conditions under the rubric of \"foreign key violations\" besides the one you're trying to handle. Consider exploring the other fields of the <code>pq.Error</code> struct to narrow in on the specific error case that interests you.</p>\n"}], "owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 719, "favorite_count": 0, "accepted_answer_id": 40405207, "answer_count": 2, "score": 1, "last_activity_date": 1478187089, "creation_date": 1478167536, "question_id": 40398706, "link": "https://stackoverflow.com/questions/40398706/what-is-the-name-of-this-error-update-or-delete-on-table-tablename-violates-f", "title": "What is the name of this error `update or delete on table &quot;tablename&quot; violates foreign key constraint` in GO?", "body": "<p>Hi I am using database/sql package in GO, and I want to handle this error,\nwhat is the best way to do it?</p>\n\n<pre><code>rows, err := transaction.Stmt(MypreparedStmt).Exec(id)\nif err!=nil{\n    // here I want to check if the error is something with the foreign key so I want something like \n     //if err==something{\n           //do something\n    //}\n}\n</code></pre>\n"}, {"tags": ["go", "return-value", "deferred-execution"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 16, "last_activity_date": 1478166584, "last_edit_date": 1478166584, "creation_date": 1478165832, "answer_id": 40398093, "question_id": 40397781, "link": "https://stackoverflow.com/questions/40397781/gometalinter-errcheck-returns-a-warning-on-deferring-a-func-which-returns-a-va/40398093#40398093", "title": "gometalinter / errcheck returns a warning on deferring a func which returns a variable", "body": "<p>If a deferred function has any return values, they are discarded when the function completes (for more details check <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"noreferrer\">Spec: Defer statements</a>).</p>\n\n<p>So the only way to check the return value is to store it, and it is only possible if not the function itself is deferred, but another function that calls it.</p>\n\n<p>One way to do it is using an anonymous function as you did, which may be slightly simplified:</p>\n\n<pre><code>defer func() {\n    if err := r.Body.Close(); err != nil {\n        fmt.Println(\"Error when closing:\", err)\n    }\n}()\n</code></pre>\n\n<p>Or you may create a helper function for it:</p>\n\n<pre><code>func Check(f func() error) {\n    if err := f(); err != nil {\n        fmt.Println(\"Received error:\", err)\n    }\n}\n</code></pre>\n\n<p>And using it:</p>\n\n<pre><code>defer Check(r.Body.Close)\n</code></pre>\n\n<p>The helper function of course can be used multiple times, e.g.:</p>\n\n<pre><code>defer Check(r.Body.Close)\ndefer Check(SomeOtherFunc)\n</code></pre>\n\n<p>For which you may also create a modified helper function, which may accept multiple functions:</p>\n\n<pre><code>func Checks(fs ...func() error) {\n    for i := len(fs) - 1; i &gt;= 0; i-- {\n        if err := fs[i](); err != nil {\n            fmt.Println(\"Received error:\", err)\n        }\n    }\n}\n</code></pre>\n\n<p>And using it:</p>\n\n<pre><code>defer Checks(r.Body.Close, SomeOtherFunc)\n</code></pre>\n\n<p>Note that I intentionally used a downward loop in <code>Checks()</code> to mimic the <em>first-in-last-out</em> nature of the execution of deferred functions, because the last <code>defer</code> will be executed first, and so using a downward loop the last function value passed to <code>Checks()</code> will be executed first.</p>\n"}], "owner": {"reputation": 699, "user_id": 5215366, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AHxA6zWr1Ms/AAAAAAAAAAI/AAAAAAAACpA/LR6pkPJOeY4/photo.jpg?sz=128", "display_name": "Andrea Sessa", "link": "https://stackoverflow.com/users/5215366/andrea-sessa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2347, "favorite_count": 1, "accepted_answer_id": 40398093, "answer_count": 1, "score": 7, "last_activity_date": 1593295146, "creation_date": 1478164924, "last_edit_date": 1478166808, "question_id": 40397781, "link": "https://stackoverflow.com/questions/40397781/gometalinter-errcheck-returns-a-warning-on-deferring-a-func-which-returns-a-va", "title": "gometalinter / errcheck returns a warning on deferring a func which returns a variable", "body": "<p><code>gometalinter</code> and <code>errcheck</code> return me a warning about deferring a function which returns a variable.</p>\n\n<p>Example in a web request:</p>\n\n<pre><code>defer r.Body.Close()\n</code></pre>\n\n<p>In this case, <code>Close</code> returns an error variable and it's not checked.</p>\n\n<p>Is the best method / idiomatic to defer it inside another function?</p>\n\n<pre><code>defer func() {\n    err := r.Body.Close()\n    if err != nil {\n        // fmt, panic or whatever\n    }\n}()\n</code></pre>\n"}, {"tags": ["asynchronous", "go", "request"], "answers": [{"comments": [{"owner": {"reputation": 1254, "user_id": 2870438, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/3c587da2b868b56e3afb188bff722e8f?s=128&d=identicon&r=PG&f=1", "display_name": "Eloy Fern&#225;ndez Franco", "link": "https://stackoverflow.com/users/2870438/eloy-fern%c3%a1ndez-franco"}, "edited": false, "score": 0, "creation_date": 1478174794, "post_id": 40397840, "comment_id": 68051983, "body": "Hi @SimoEndre I am not sure about how to do that. I had been testing the example (server.go) and 1) it doesn&#39;t work to me (always get 0 results). And  2) the most important, I download the google package code, and modify in the way I need (this is my new code <a href=\"http://pasted.co/2f56d290\" rel=\"nofollow noreferrer\">pasted.co/2f56d290</a>), and it works exactly like before. It makes the request and the server sends two responses (first with one second of response time, and the second 6 seconds) and the go http client waits for the last to print them. Can you take a look to my code please?? Thanks."}, {"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "reply_to_user": {"reputation": 1254, "user_id": 2870438, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/3c587da2b868b56e3afb188bff722e8f?s=128&d=identicon&r=PG&f=1", "display_name": "Eloy Fern&#225;ndez Franco", "link": "https://stackoverflow.com/users/2870438/eloy-fern%c3%a1ndez-franco"}, "edited": false, "score": 0, "creation_date": 1478180620, "post_id": 40397840, "comment_id": 68056222, "body": "I&#39;m afraid that the api server is serving your request in different time intervals. In this case there is nothing you can do. Or did i missed something?"}, {"owner": {"reputation": 1254, "user_id": 2870438, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/3c587da2b868b56e3afb188bff722e8f?s=128&d=identicon&r=PG&f=1", "display_name": "Eloy Fern&#225;ndez Franco", "link": "https://stackoverflow.com/users/2870438/eloy-fern%c3%a1ndez-franco"}, "edited": false, "score": 0, "creation_date": 1478180749, "post_id": 40397840, "comment_id": 68056313, "body": "Thanks @SimoEndre I am going to talk with the server development team."}, {"owner": {"reputation": 1254, "user_id": 2870438, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/3c587da2b868b56e3afb188bff722e8f?s=128&d=identicon&r=PG&f=1", "display_name": "Eloy Fern&#225;ndez Franco", "link": "https://stackoverflow.com/users/2870438/eloy-fern%c3%a1ndez-franco"}, "edited": false, "score": 0, "creation_date": 1478610728, "post_id": 40397840, "comment_id": 68219186, "body": "Hi again @SimoEndre I resolved it.  The problem was (is) that there is a proxy between me and the final server, and this proxy is which waits for all the responses from the final server. Thank you very much."}, {"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "reply_to_user": {"reputation": 1254, "user_id": 2870438, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/3c587da2b868b56e3afb188bff722e8f?s=128&d=identicon&r=PG&f=1", "display_name": "Eloy Fern&#225;ndez Franco", "link": "https://stackoverflow.com/users/2870438/eloy-fern%c3%a1ndez-franco"}, "edited": false, "score": 0, "creation_date": 1478613674, "post_id": 40397840, "comment_id": 68221343, "body": "No problem, thanks for the feedback :) and glad you resolved the issue."}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 1, "last_activity_date": 1478165097, "creation_date": 1478165097, "answer_id": 40397840, "question_id": 40397076, "link": "https://stackoverflow.com/questions/40397076/asynchronous-request-for-multiple-response-golang/40397840#40397840", "title": "Asynchronous request for multiple response golang", "body": "<p>The <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\">context</a> package is what you are looking for. </p>\n\n<p>The <code>context</code> package is responsible for signal cancelation and operation deadlines for processes and server requests. This has two public methods: <code>WithCancel</code> and <code>WithTimeout</code>. The <code>Context</code> associated with an incoming request is typically canceled when the request handler returns.</p>\n\n<p>For your specific case you can use the <code>WithTimeout</code> method for setting a deadline on requests to backend servers.</p>\n\n<pre><code>// WithTimeout returns a copy of parent whose Done channel is closed as soon as\n// parent.Done is closed, cancel is called, or timeout elapses. The new\n// Context's Deadline is the sooner of now+timeout and the parent's deadline, if\n// any. If the timer is still running, the cancel function releases its\n// resources.\nfunc WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc)\n</code></pre>\n\n<p>And here is a snippet taken from <a href=\"https://blog.golang.org/context/server/server.go\" rel=\"nofollow noreferrer\">https://blog.golang.org/context/server/server.go</a></p>\n\n<pre><code>timeout, err := time.ParseDuration(req.FormValue(\"timeout\")) // set a time limit in your post\nif err == nil {\n    // The request has a timeout, so create a context that is\n    // canceled automatically when the timeout expires.\n    ctx, cancel = context.WithTimeout(context.Background(), timeout)\n} else {\n    ctx, cancel = context.WithCancel(context.Background())\n}\ndefer cancel() // Cancel ctx as soon as handleSearch returns.\n</code></pre>\n\n<p>For further reading take a look at this article:\n<a href=\"https://blog.golang.org/context\" rel=\"nofollow noreferrer\">https://blog.golang.org/context</a></p>\n"}, {"tags": [], "owner": {"reputation": 1254, "user_id": 2870438, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/3c587da2b868b56e3afb188bff722e8f?s=128&d=identicon&r=PG&f=1", "display_name": "Eloy Fern&#225;ndez Franco", "link": "https://stackoverflow.com/users/2870438/eloy-fern%c3%a1ndez-franco"}, "is_accepted": true, "score": 4, "last_activity_date": 1478689317, "creation_date": 1478689317, "answer_id": 40505387, "question_id": 40397076, "link": "https://stackoverflow.com/questions/40397076/asynchronous-request-for-multiple-response-golang/40505387#40505387", "title": "Asynchronous request for multiple response golang", "body": "<p>Finally my code , is like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"bytes\"\n    \"strings\"\n    \"bufio\"\n    \"net/http\"\n)\n\nfunc main() {\n  var body = \"The body\"\n  RequestReader := bytes.NewReader([]byte(body))\n  req, err := http.NewRequest(\"POST\", \"the_url\", RequestReader)\n  if err != nil {\n    log.Fatal(err)\n  }\n  req.Header.Add(\"Accept\", \"application/xml\")\n  req.Header.Add(\"Content-Type\", \"application/xml\")\n  req.Header.Add(\"AG-Authorization\", \"key\")\n  req.Header.Add(\"AG-Forwarded-Hosts\", \"*\")\n\n  resp, err := (&amp;http.Client{}).Do(req)\n  if err != nil {\n    log.Fatal(err)\n  }\n  reader := bufio.NewReader(resp.Body)\n  message := \"\"\n  for {\n    line, err := reader.ReadBytes('\\n')\n    if err != nil {\n      log.Fatal(err)\n }\n    message = message + string(line)\n    if strings.Contains(message, \"&lt;!-- End mark for each message --&gt;\"){\n        fmt.Println(message)\n        message = \"\"\n    }\n  }\n}\n</code></pre>\n\n<p>Thank everyone.</p>\n"}], "owner": {"reputation": 1254, "user_id": 2870438, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/3c587da2b868b56e3afb188bff722e8f?s=128&d=identicon&r=PG&f=1", "display_name": "Eloy Fern&#225;ndez Franco", "link": "https://stackoverflow.com/users/2870438/eloy-fern%c3%a1ndez-franco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2953, "favorite_count": 0, "accepted_answer_id": 40505387, "answer_count": 2, "score": 1, "last_activity_date": 1478689317, "creation_date": 1478162715, "last_edit_date": 1478164253, "question_id": 40397076, "link": "https://stackoverflow.com/questions/40397076/asynchronous-request-for-multiple-response-golang", "title": "Asynchronous request for multiple response golang", "body": "<p>I need to make a request to a server that return different responses at different times. I mean, the server generate different responses and these responses take different execution time, so server return the responses as soon as they are available.  </p>\n\n<p>And I want print in the screen (by the moment, I'd settle with that) these responses as soon as the server returns me.  </p>\n\n<p>All what I could do until now is print the responses but only when the server returns all the responses. So if the first response take 1sec, and the last response take 10sec, my code needs to wait 10sec to print all the messages.  </p>\n\n<p><strong>EDIT</strong>: to add code I have:</p>\n\n<pre><code>//Config is gotten from yml file\nRestConfig       = Config[\"rest\"].(map[string]interface{})\nServerConfig     = Config[\"server\"].(map[string]interface{})\nRequestUrl      := ServerConfig[\"url\"]\n\nRequestReader   := bytes.NewReader(body)\nRequest, _      := http.NewRequest(\"POST\", RequestUrl.(string), RequestReader)\n\n//AppendHeaders append the needing headers to the request \nclient.AppendHeaders(Request, RestConfig[\"headers\"])\n\n//the type of client.HttpClient is *http.Client\nResponse, _     := client.HttpClient.Do(Request)\n\n//And to print in the screen\ndefer Response.Body.Close()\n\nfmt.Println( \"-&gt; Receiving response:\\n---\\n\" )\nfmt.Println( Response , \"\\n---\\n-&gt; Response body:\\n---\\n\")\nbody_resp, _ := ioutil.ReadAll(Response.Body)\nfmt.Println( string(body_resp) )\nfmt.Println( \"\\n--\\n\")\n</code></pre>\n\n<p>Any way to do it??</p>\n\n<p>Thank you very much.</p>\n"}]