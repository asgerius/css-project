[{"tags": ["go", "openshift-origin"], "answers": [{"tags": [], "owner": {"reputation": 331, "user_id": 2229089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RDPrP.png?s=128&g=1", "display_name": "jim-minter", "link": "https://stackoverflow.com/users/2229089/jim-minter"}, "is_accepted": true, "score": 2, "last_activity_date": 1495187649, "last_edit_date": 1495187649, "creation_date": 1484081300, "answer_id": 41578114, "question_id": 35760596, "link": "https://stackoverflow.com/questions/35760596/list-openshift-objects-via-go-client-api/41578114#41578114", "title": "List Openshift objects via Go client API", "body": "<p>You were ever so close and the issue was a tiny one: you needed to include the following additional import:</p>\n\n<pre><code>import _ \"github.com/openshift/origin/pkg/api/install\"\n</code></pre>\n\n<p>I'm not fully clear what the import actually does, but evidently it causes necessary additional functionality to be linked into the binary, without which the OpenShift client doesn't work (returns empty lists).</p>\n\n<p>All of the OpenShift command line tools include that import, and as of writing many include some/all of the following as well:</p>\n\n<pre><code>import (\n    _ \"github.com/openshift/origin/pkg/api/install\"\n    _ \"k8s.io/kubernetes/pkg/api/install\"\n    _ \"k8s.io/kubernetes/pkg/apis/autoscaling/install\"\n    _ \"k8s.io/kubernetes/pkg/apis/batch/install\"\n    _ \"k8s.io/kubernetes/pkg/apis/extensions/install\"\n)\n</code></pre>\n\n<p>Finally, here's a full code example which works for me (updated against origin v3.6.0-alpha):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    _ \"github.com/openshift/origin/pkg/api/install\"\n    \"github.com/openshift/origin/pkg/cmd/util/clientcmd\"\n    \"github.com/spf13/pflag\"\n    \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n)\n\nfunc main() {\n    factory := clientcmd.New(pflag.CommandLine)\n    pflag.Parse()\n\n    oc, kc, err := factory.Clients()\n    if err != nil {\n        panic(err)\n    }\n\n    namespace, _, err := factory.DefaultNamespace()\n    if err != nil {\n        panic(err)\n    }\n\n    pods, err := kc.Core().Pods(namespace).List(v1.ListOptions{})\n    if err != nil {\n        panic(err)\n    }\n\n    for _, pod := range pods.Items {\n        fmt.Printf(\"Pod: %s\\n\", pod.Name)\n    }\n\n    buildconfigs, err := oc.BuildConfigs(namespace).List(v1.ListOptions{})\n    if err != nil {\n        panic(err)\n    }\n\n    for _, buildconfig := range buildconfigs.Items {\n        fmt.Printf(\"BuildConfig: %s\\n\", buildconfig.Name)\n    }\n}\n</code></pre>\n\n<p>To run this example, you will currently need to vendor OpenShift and its dependencies.  One very hacky way to do this is as follows:</p>\n\n<pre><code>rm -rf vendor\nmkdir -p vendor/github.com/openshift/origin\nln -s $GOPATH/src/github.com/openshift/origin/vendor/* vendor\nln -s $GOPATH/src/github.com/openshift/origin/vendor/github.com/* vendor/github.com\nln -s $GOPATH/src/github.com/openshift/origin/vendor/github.com/openshift/* vendor/github.com/openshift\nln -s $GOPATH/src/github.com/openshift/origin/pkg vendor/github.com/openshift/origin\n</code></pre>\n\n<p>Finally, it is intended to make a proper standalone Go client for OpenShift - the backlog card for this is at <a href=\"https://trello.com/c/PTDrY0GF/794-13-client-provide-go-client-similar-to-kubernetes\" rel=\"nofollow noreferrer\">https://trello.com/c/PTDrY0GF/794-13-client-provide-go-client-similar-to-kubernetes</a>.</p>\n"}], "owner": {"reputation": 1798, "user_id": 4391298, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh3.googleusercontent.com/-HnoLQXIa8Io/AAAAAAAAAAI/AAAAAAAAAIY/Iqji42x6zyc/photo.jpg?sz=128", "display_name": "Danielle Madeley", "link": "https://stackoverflow.com/users/4391298/danielle-madeley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1966, "favorite_count": 2, "accepted_answer_id": 41578114, "answer_count": 1, "score": 2, "last_activity_date": 1495187649, "creation_date": 1456962831, "question_id": 35760596, "link": "https://stackoverflow.com/questions/35760596/list-openshift-objects-via-go-client-api", "title": "List Openshift objects via Go client API", "body": "<p>Trying to write a microservice to manage imagestreams on my Openshift cluster. I read the <code>oc</code> client code to work out how to read my <code>kubeconfig</code> and create the <a href=\"https://godoc.org/github.com/openshift/origin/pkg/client#Client\" rel=\"nofollow\"><code>Client</code></a>.</p>\n\n<p>I can make requests with the Kubernetes <a href=\"https://godoc.org/k8s.io/kubernetes/pkg/client/unversioned#Client\" rel=\"nofollow\"><code>Client</code></a> to get the Kubernetes objects, e.g. pods, but any requests I make with the Openshift <a href=\"https://godoc.org/github.com/openshift/origin/pkg/client#Client\" rel=\"nofollow\"><code>Client</code></a> returns back an empty list.</p>\n\n<p>I'm new to Go as well, so I'm sure I'm doing something wrong. Here's what I have so far:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/spf13/pflag\"\n\n    kapi \"k8s.io/kubernetes/pkg/api\"\n\n    \"github.com/openshift/origin/pkg/cmd/util/clientcmd\"\n)\n\nfunc main() {\n    flags := pflag.FlagSet{}\n    factory := clientcmd.New(&amp;flags)\n    osclient, kclient, err := factory.Clients()\n    if err != nil {\n        log.Fatalln(\"Error:\", err)\n    }\n\n    config, _ := factory.ClientConfig()\n    fmt.Println(\"KClient config\", config)\n    config, _ = factory.OpenShiftClientConfig.ClientConfig()\n    fmt.Println(\"OSClient config\", config)\n\n    // Empty list!\n    projects, err := osclient.Projects().List(kapi.ListOptions{})\n    if err != nil {\n        log.Println(\"Error:\", err)\n    } else {\n        fmt.Println(\"Projects\", projects, len(projects.Items))\n    }\n\n    // Also empty list\n    buildconfigs, err := osclient.BuildConfigs(\"my-project\").List(kapi.ListOptions{})\n    if err != nil {\n        log.Println(\"Error:\", err)\n    } else {\n        fmt.Println(\"Buildconfigs\", buildconfigs, len(buildconfigs.Items))\n    }\n\n    // Works!\n    pods, err := kclient.Pods(\"my-project\").List(kapi.ListOptions{})\n    if err != nil {\n        log.Println(\"Error:\", err)\n    } else {\n        fmt.Println(\"Pods\", len(pods.Items))\n        for _, pod := range pods.Items {\n            fmt.Println(pod.ObjectMeta.Name)\n        }\n    }\n\n    // Permission error, as expected\n    namespaces, err := kclient.Namespaces().List(kapi.ListOptions{})\n    if err != nil {\n        log.Println(\"Error:\", err)\n    } else {\n        fmt.Println(\"Namespaces\", namespaces, len(namespaces.Items))\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "coding-style"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 3, "creation_date": 1456968566, "post_id": 35760047, "comment_id": 59196049, "body": "Don&#39;t use a format string to build your SQL queries. I cannot stress how dangerous this can be. <a href=\"http://blog.codinghorror.com/give-me-parameterized-sql-or-give-me-death/\" rel=\"nofollow noreferrer\">blog.codinghorror.com/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3728, "user_id": 2073991, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/hjYJt.jpg?s=128&g=1", "display_name": "Yi Jiang", "link": "https://stackoverflow.com/users/2073991/yi-jiang"}, "edited": false, "score": 0, "creation_date": 1456962160, "post_id": 35760084, "comment_id": 59194054, "body": "Great!!! Thank you! I spend hours on manually format strings with stupid way yesterday....."}], "tags": [], "owner": {"reputation": 32805, "user_id": 4257, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e326ede439e929b12e36d8508de54040?s=128&d=identicon&r=PG", "display_name": "pkaeding", "link": "https://stackoverflow.com/users/4257/pkaeding"}, "is_accepted": false, "score": 1, "last_activity_date": 1456960305, "creation_date": 1456960305, "answer_id": 35760084, "question_id": 35760047, "link": "https://stackoverflow.com/questions/35760047/in-golang-what-is-nice-format-to-write-json-and-mysql-query-string/35760084#35760084", "title": "In golang, what is nice format to write JSON and MySQL query string?", "body": "<p>You can use backticks to write a multiline <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow\">string literal</a>, like so:</p>\n\n<pre><code>json := `\n{\n    \"hello\": \"world\",\n    \"foo\": \"bar\"\n}`\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/bU5q6tx8Jx\" rel=\"nofollow\">https://play.golang.org/p/bU5q6tx8Jx</a></p>\n\n<p>The backticks in your SQL example might be problematic, though...</p>\n"}], "owner": {"reputation": 3728, "user_id": 2073991, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/hjYJt.jpg?s=128&g=1", "display_name": "Yi Jiang", "link": "https://stackoverflow.com/users/2073991/yi-jiang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 737, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1456960305, "creation_date": 1456960142, "question_id": 35760047, "link": "https://stackoverflow.com/questions/35760047/in-golang-what-is-nice-format-to-write-json-and-mysql-query-string", "title": "In golang, what is nice format to write JSON and MySQL query string?", "body": "<p>It is really hard to read an extremely long string of JSON or DB query in golang source code.</p>\n\n<p>JSON Example:  </p>\n\n<pre><code>\"{\\\"task\\\":\\\"send_sms\\\",\\\"t_id\\\":988110,\\\"req\\\":{\\\"node\\\":1,\\\"msg_id\\\":987654321,\\\"m_num\\\":\\\"+61433092888\\\",\\\"p_num\\\":\\\"Private\\\",\\\"msg\\\":\\\"Hello world.\\\"}}      \"\n</code></pre>\n\n<p>DB Query Example: </p>\n\n<pre><code>dbQuery = fmt.Sprintf(\"INSERT INTO `ms_message` (`task_id`, `panel_phone_num` ,`user_mobile_num`,`message_content`,`receiver_node_id`,`modem_index`,`generate_datetime` ) SELECT * FROM (SELECT %d, \\\"%s\\\", \\\"%s\\\", \\\"%s\\\", %d,%d,\\\"%s\\\") AS tmp WHERE NOT EXISTS ( SELECT * FROM `ms_message` WHERE `receiver_node_id` = %d AND `task_id` = %d ) LIMIT 1\", taskId, panelNumber, mobileNumber, messageContent, nodeId, modemId, dateTime, nodeId, taskId)\n</code></pre>\n\n<p>What way is nice to make above strings looks reader friendly?</p>\n"}, {"tags": ["go", "opus"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1456958882, "post_id": 35759443, "comment_id": 59192763, "body": "Opus files use OGG as a container. You will have to use an OGG library to extract the Opus stream."}, {"owner": {"reputation": 5427, "user_id": 721386, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/990a96e6875ad1319af43b61b8d090b7?s=128&d=identicon&r=PG", "display_name": "Dustin", "link": "https://stackoverflow.com/users/721386/dustin"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1457008927, "post_id": 35759443, "comment_id": 59216211, "body": "@TimCooper Could something like that be done with ffmpeg instead?"}], "answers": [{"tags": [], "owner": {"reputation": 1060, "user_id": 1727288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6f87f7fef5f4704e31d3ebf93b33f8f?s=128&d=identicon&r=PG", "display_name": "bain", "link": "https://stackoverflow.com/users/1727288/bain"}, "is_accepted": false, "score": 0, "last_activity_date": 1593009311, "creation_date": 1593009311, "answer_id": 62557556, "question_id": 35759443, "link": "https://stackoverflow.com/questions/35759443/how-to-binary-read-an-opus-file/62557556#62557556", "title": "How to binary read an Opus file", "body": "<p>Use <a href=\"https://github.com/hraban/opus\" rel=\"nofollow noreferrer\">https://github.com/hraban/opus</a>. From the docs at that link:</p>\n<p>To decode a .opus file (or .ogg with Opus data), or to decode a &quot;Opus stream&quot; (which is a Ogg stream with Opus data), use the Stream interface. It wraps an io.Reader providing the raw stream bytes and returns the decoded Opus data.</p>\n<p>A crude example for reading from a .opus file:</p>\n<pre><code>f, err := os.Open(fname)\nif err != nil {\n    ...\n}\ns, err := opus.NewStream(f)\nif err != nil {\n    ...\n}\ndefer s.Close()\nbuf := make([]byte, 16384)\nfor {\n    n, err = s.Read(buf)\n    if err == io.EOF {\n        break\n    } else if err != nil {\n        ...\n    }\n    pcm := buf[:n*channels]\n\n    // send pcm to audio device here, or write to a .wav file\n\n}\n</code></pre>\n"}], "owner": {"reputation": 5427, "user_id": 721386, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/990a96e6875ad1319af43b61b8d090b7?s=128&d=identicon&r=PG", "display_name": "Dustin", "link": "https://stackoverflow.com/users/721386/dustin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 735, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1593009311, "creation_date": 1456957671, "question_id": 35759443, "link": "https://stackoverflow.com/questions/35759443/how-to-binary-read-an-opus-file", "title": "How to binary read an Opus file", "body": "<p>In still learning Go, I'm trying to read an Opus file correctly and send it up the Voice channel of <a href=\"https://discordapp.com/\" rel=\"nofollow\">Discord</a> (which only supports an Opus codec). Originally using <a href=\"https://github.com/bwmarrin/dgvoice/blob/master/dgvoice.go#L53-L99\" rel=\"nofollow\">this</a> script I was able to pass a WAV and the script would encode it to Opus and then send it through the channel to Discord. Instead I'd like to send a ready made Opus file. However, instead I hear garbled noise meaning I've done something wrong reading it.</p>\n\n<p>This is a cut down but full working example (minus the email, password, and server id), magic happens in <code>playSong</code>. I have a feeling it has something to do with my audio buffer, but again still learning the tricks. </p>\n\n<p>What would be the correct method to reading an opus file and passing it to a channel? If in need of an opus file to test, find one <a href=\"https://dl.dropboxusercontent.com/u/9235267/test.opus\" rel=\"nofollow\">here</a>. Any help is appreciated. Thanks!</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/binary\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"os/exec\"\n    \"runtime\"\n    \"strings\"\n\n    \"github.com/bwmarrin/discordgo\"\n    \"github.com/oleiade/lane\"\n)\n\ntype voiceInstancesMap map[string]*VoiceInstance\n\nvar (\n    run            *exec.Cmd\n    voiceInstances = voiceInstancesMap{}\n)\n\nconst (\n    email     string = \"\"\n    password  string = \"\"\n    serverID  string = \"\"\n    channels  int    = 2     // 1 for mono, 2 for stereo\n    frameRate int    = 48000 // audio sampling rate\n)\n\ntype VoiceInstance struct {\n    discord  *discordgo.Session\n    queue    *lane.Queue\n    serverID string\n}\n\nfunc (vi *VoiceInstance) playSong() {\n    f, err := os.Open(\"./test.opus\")\n    defer f.Close()\n\n    audiobuf := make([]byte, 1024)\n\n    vi.discord.Voice.Speaking(true)\n    defer vi.discord.Voice.Speaking(false)\n\n    for {\n        err = binary.Read(f, binary.LittleEndian, &amp;audiobuf)\n        if err == io.EOF || err == io.ErrUnexpectedEOF {\n            break\n        }\n        if err != nil {\n            fmt.Println(\"error reading from ffmpeg stdout :\", err)\n            break\n        }\n\n        fmt.Println(\"Sending audio\")\n        vi.discord.Voice.OpusSend &lt;- audiobuf\n    }\n}\n\nfunc (vi *VoiceInstance) connectVoice() {\n    vi.discord, _ = discordgo.New(email, password)\n\n    // Open the websocket and begin listening.\n    err := vi.discord.Open()\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    channels, err := vi.discord.GuildChannels(vi.serverID)\n\n    var voiceChannel string\n    voiceChannels := []string{}\n    for _, channel := range channels {\n        if channel.Type == \"voice\" {\n            voiceChannels = append(voiceChannels, channel.ID)\n            if strings.Contains(strings.ToLower(channel.Name), \"music\") &amp;&amp; voiceChannel == \"\" {\n                voiceChannel = channel.ID\n            }\n        }\n    }\n\n    if voiceChannel == \"\" {\n        fmt.Println(\"Selecting first channel\")\n        voiceChannel = voiceChannels[0]\n    }\n\n    err = vi.discord.ChannelVoiceJoin(vi.serverID, voiceChannel, false, true)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    // Hacky loop to prevent sending on a nil channel.\n    // TODO: Find a better way.\n    for vi.discord.Voice.Ready == false {\n        runtime.Gosched()\n    }\n}\n\nfunc main() {\n    vi := new(VoiceInstance)\n    voiceInstances[serverID] = vi\n\n    fmt.Println(\"Connecting Voice...\")\n    vi.serverID = serverID\n    vi.queue = lane.NewQueue()\n    vi.connectVoice()\n    vi.playSong()\n}\n</code></pre>\n"}, {"tags": ["c++", "go", "cuda"], "comments": [{"owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "edited": false, "score": 3, "creation_date": 1456955408, "post_id": 35758750, "comment_id": 59190992, "body": "I&#39;m not familiar with go, but it may be a C vs. C++ linking issue.  Try wrapping your <code>test_add()</code> prototype in <code>extern &quot;C&quot; { ... }</code>"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "edited": false, "score": 0, "creation_date": 1456955448, "post_id": 35758750, "comment_id": 59191025, "body": "@RobertCrovella: Where do you see C code? CUDA is C++ based."}, {"owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1456955665, "post_id": 35758750, "comment_id": 59191139, "body": "@Olaf where did I say &quot;I see C code.&quot; ?  I&#39;m aware that CUDA uses C++ style linkage.  If by chance <a href=\"https://golang.org/cmd/cgo/#hdr-Go_references_to_C\" rel=\"nofollow noreferrer\">the go import of <code>C</code> is expecting the function to be provided with C style linkage</a>, then you would run into this problem.  It&#39;s just a guess."}, {"owner": {"reputation": 157, "user_id": 6010103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-Kniu6vzIoug/AAAAAAAAAAI/AAAAAAAAAI0/XZIAzGnidyk/photo.jpg?sz=128", "display_name": "Peter Veselinovi\u0107", "link": "https://stackoverflow.com/users/6010103/peter-veselinovi%c4%87"}, "reply_to_user": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "edited": false, "score": 0, "creation_date": 1456956233, "post_id": 35758750, "comment_id": 59191469, "body": "@RobertCrovella: thanks man, I tried your suggestion and it works. You&#39;re a life saver : )"}, {"owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "edited": false, "score": 3, "creation_date": 1456958330, "post_id": 35758750, "comment_id": 59192510, "body": "kudos for providing an <a href=\"http://stackoverflow.com/help/mcve\">MCVE</a> in your very first SO posting."}], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 6010103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-Kniu6vzIoug/AAAAAAAAAAI/AAAAAAAAAI0/XZIAzGnidyk/photo.jpg?sz=128", "display_name": "Peter Veselinovi\u0107", "link": "https://stackoverflow.com/users/6010103/peter-veselinovi%c4%87"}, "edited": false, "score": 0, "creation_date": 1457039450, "post_id": 35763142, "comment_id": 59237565, "body": "For me the solution works if I use <code>extern &quot;C&quot; {...code...} </code> in test.cu file. But if I include <code>extern &quot;C&quot;</code> in header test.h I get an error <code>.&#47;test.h:1:8: error: expected identifier or &#39;(&#39; before string constant</code>. So I will go with <code>extern &quot;C&quot;</code> in cuda files (.cu) which seems to work for me. Thanks again for helping out."}, {"owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "reply_to_user": {"reputation": 157, "user_id": 6010103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-Kniu6vzIoug/AAAAAAAAAAI/AAAAAAAAAI0/XZIAzGnidyk/photo.jpg?sz=128", "display_name": "Peter Veselinovi\u0107", "link": "https://stackoverflow.com/users/6010103/peter-veselinovi%c4%87"}, "edited": false, "score": 1, "creation_date": 1457044014, "post_id": 35763142, "comment_id": 59239983, "body": "Thanks.  I&#39;ve updated the answer to reflect your usage.  I&#39;m not an expert in this but I think your question could be useful for future readers as a canonical &quot;how do I connect go to CUDA&quot; type question."}], "tags": [], "owner": {"reputation": 119299, "user_id": 1695960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f557c03db19232aa410540af2f966?s=128&d=identicon&r=PG", "display_name": "Robert Crovella", "link": "https://stackoverflow.com/users/1695960/robert-crovella"}, "is_accepted": true, "score": 4, "last_activity_date": 1457043991, "last_edit_date": 1457043991, "creation_date": 1456978885, "answer_id": 35763142, "question_id": 35758750, "link": "https://stackoverflow.com/questions/35758750/golang-calling-cuda-library/35763142#35763142", "title": "Golang calling CUDA library", "body": "<p>It appears, at least in this case, that  <a href=\"https://golang.org/cmd/cgo/#hdr-Go_references_to_C\" rel=\"nofollow\">the go import of <code>C</code> is expecting the function to be provided with C style linkage</a>.</p>\n\n<p>CUDA (i.e. nvcc) mainly follows C++ patterns and provides by default C++ style linkage (including function name mangling, etc.)  </p>\n\n<p>It's possible to force a section of code to be provided externally using C rather than C++ style linkage using <code>extern \"C\" {...code...}</code>.   This is a C++ language feature and not specific to CUDA or nvcc.</p>\n\n<p>Therefore it appears the problem can be solved via the following modification to the test.cu:</p>\n\n<pre><code>extern \"C\" { int test_add(void) { ... code ... }; }\n</code></pre>\n"}], "owner": {"reputation": 157, "user_id": 6010103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-Kniu6vzIoug/AAAAAAAAAAI/AAAAAAAAAI0/XZIAzGnidyk/photo.jpg?sz=128", "display_name": "Peter Veselinovi\u0107", "link": "https://stackoverflow.com/users/6010103/peter-veselinovi%c4%87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4376, "favorite_count": 2, "accepted_answer_id": 35763142, "answer_count": 1, "score": 10, "last_activity_date": 1457043991, "creation_date": 1456955252, "last_edit_date": 1456955402, "question_id": 35758750, "link": "https://stackoverflow.com/questions/35758750/golang-calling-cuda-library", "title": "Golang calling CUDA library", "body": "<p>I am trying to call a CUDA function from my Go code.\nI have the following three files.</p>\n\n<p>test.h:</p>\n\n<pre><code>int test_add(void);\n</code></pre>\n\n<p>test.cu:</p>\n\n<pre><code>__global__ void add(int *a, int *b, int *c){\n       *c = *a + *b;\n}\n\nint test_add(void) {\n       int a, b, c; // host copies of a, b, c\n       int *d_a, *d_b, *d_c; // device copies of a, b, c\n       int size = sizeof(int);\n       // Allocate space for device copies of a, b, c\n       cudaMalloc((void **)&amp;d_a, size);\n       cudaMalloc((void **)&amp;d_b, size);\n       cudaMalloc((void **)&amp;d_c, size);\n      // Setup input values\n      a = 2;\n      b = 7;\n\n      // Copy inputs to device\n      cudaMemcpy(d_a, &amp;a, size, cudaMemcpyHostToDevice);\n      cudaMemcpy(d_b, &amp;b, size, cudaMemcpyHostToDevice);\n      // Launch add() kernel on GPU\n     add&lt;&lt;&lt;1,1&gt;&gt;&gt;(d_a, d_b, d_c);\n     // Copy result back to host\n     cudaMemcpy(&amp;c, d_c, size, cudaMemcpyDeviceToHost);\n     // Cleanup\n     cudaFree(d_a); cudaFree(d_b); cudaFree(d_c);\n    return 0;\n}\n</code></pre>\n\n<p>test.go:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n//#cgo CFLAGS: -I.\n//#cgo LDFLAGS: -L. -ltest\n//#cgo LDFLAGS: -lcudart\n//#include &lt;test.h&gt;\nimport \"C\"\n\n\nfunc main() {\n     fmt.Printf(\"Invoking cuda library...\\n\")\n     fmt.Println(\"Done \", C.test_add())\n}\n</code></pre>\n\n<p>I am compiling CUDA code with:</p>\n\n<pre><code>nvcc -m64 -arch=sm_20 -o libtest.so --shared -Xcompiler -fPIC test.cu\n</code></pre>\n\n<p>All three files - test.h, test.cu and test.go are in the same directory.\nThe error I am getting when I try to build with go is \"undefined reference to `test_add'\".</p>\n\n<p>I have very little experience with C/C++ and am a total novice in CUDA.</p>\n\n<p>I've been trying to solve my problem for two days now and would be\nvery grateful for any input.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 132964, "user_id": 171318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ePRKy.jpg?s=128&g=1", "display_name": "hek2mgl", "link": "https://stackoverflow.com/users/171318/hek2mgl"}, "edited": false, "score": 3, "creation_date": 1456948529, "post_id": 35756696, "comment_id": 59186982, "body": "What kind of string do you think the following regex should deliver? <code>.*</code>"}, {"owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "edited": false, "score": 0, "creation_date": 1456948786, "post_id": 35756696, "comment_id": 59187123, "body": "Do you want a <i>random</i> string or an arbitrary string? For example,  if you returned the same thing every time for a given regex, would that work?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456948871, "post_id": 35756696, "comment_id": 59187177, "body": "since you&#39;d have to have very limited regexes to constrain the output within reason, why not just define the format of the random characters you want in the first place?"}, {"owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 0, "creation_date": 1456950066, "post_id": 35756696, "comment_id": 59187914, "body": "Somehow I get the feeling that this might be an <a href=\"http://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">XY problem</a>. I&#39;m curious to know what this would be used for..."}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "reply_to_user": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "edited": false, "score": 0, "creation_date": 1456950680, "post_id": 35756696, "comment_id": 59188265, "body": "@merlin2011 I guess random would be better than arbitrary because there might be a conflict using the same string(though it&#39;s not always the case). I&#39;ve updated the question with further details about the use case."}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "reply_to_user": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 0, "creation_date": 1456950702, "post_id": 35756696, "comment_id": 59188274, "body": "@Aedolon I&#39;ve updated the question with the use case details."}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "reply_to_user": {"reputation": 132964, "user_id": 171318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ePRKy.jpg?s=128&g=1", "display_name": "hek2mgl", "link": "https://stackoverflow.com/users/171318/hek2mgl"}, "edited": false, "score": 0, "creation_date": 1456950961, "post_id": 35756696, "comment_id": 59188416, "body": "cc @hek2mgl: I&#39;ve updated the question with the use case details. I guess some sensible default limits/flags could be put in place but the generator should try to produce a small/ efficient output."}, {"owner": {"reputation": 2363, "user_id": 3585432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b382bb722b7d630854ce0371d91120a1?s=128&d=identicon&r=PG&f=1", "display_name": "Aleksei Shestakov", "link": "https://stackoverflow.com/users/3585432/aleksei-shestakov"}, "edited": false, "score": 0, "creation_date": 1456951034, "post_id": 35756696, "comment_id": 59188461, "body": "The only solution i see is to convert a regex to a finite automata (which is  done in any regex library) and find a path from the initial state to any final state. That path will be a string that matches the regex."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 2, "creation_date": 1456951182, "post_id": 35756696, "comment_id": 59188539, "body": "<a href=\"https://github.com/sethgrid/xeger\" rel=\"nofollow noreferrer\"><b>Xeger</b></a>. It does not work in Go yet, but the <a href=\"https://pypi.python.org/pypi/xeger\" rel=\"nofollow noreferrer\">Python version</a> is working."}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1456951657, "post_id": 35756696, "comment_id": 59188805, "body": "Xeger looks great but unfortunately as you said it&#39;s not working in Go. I can&#39;t use Python  b/c I can&#39;t run os/exec"}, {"owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 1, "creation_date": 1456953650, "post_id": 35756696, "comment_id": 59189984, "body": "I&#39;m  not convinced that what you&#39;re asking for is actually a good solution for your use case. Generating all kinds of random strings is easy, but regexps aren&#39;t great for <i>strict</i> matching of email addresses and phone numbers anyway, so I don&#39;t see why those random strings would need to be particularly strictly formatted either. (Writing a regexp that can validate an email address is <i>incredibly</i> complicated...)"}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "reply_to_user": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 0, "creation_date": 1456953955, "post_id": 35756696, "comment_id": 59190174, "body": "@Aedolon, what&#39;s the alternative? Writing a &quot;custom&quot; generator for each kind of pattern I need? (e.g. phone number generator, string 10 chars, string 1 char etc). And what if the test case needs to be declarative?(i.e. in a json file). I believe regex are the only way to express patterns declaratively, at least that I&#39;m aware of."}, {"owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 1, "creation_date": 1456956932, "post_id": 35756696, "comment_id": 59191810, "body": "@Theu, I&#39;d probably write a couple of custom generators (email, phone) and some generic &quot;give me a string of length N composed of [xyz] characters&quot; functions. Do you really need a fake phone number that&#39;s formatted in some <i>exact</i> manner? Do you know how many ways to represent a valid phone number there are in the world?"}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1456957294, "post_id": 35756696, "comment_id": 59192019, "body": "` &quot;give me a string of length N composed of [xyz] characters&quot;` sounds like a lightweight regex... why not supporting the full regex (if such a package would be available) so that I can use it for both on simple string generation and  less common cases (i.e. an email address)? Complex input types such  email and phone numbers are not that common but still they have a regex . I don&#39;t see much value reinventing the regex in a simpler form. If you need simple strings then you can use simple regex.  Concerning the phone number example there might be many formats but I don&#39;t need to test them all."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456957898, "post_id": 35756696, "comment_id": 59192317, "body": "Also, if you&#39;re doing this for testing it might not be that helpful, since you&#39;re only generating input that you know will pass the regex. You&#39;re not going to get a full range of possible emails unless your email regex truly going to validate all emails. This is why you use a parser and not a regex for email: <a href=\"http://www.ex-parrot.com/pdw/Mail-RFC822-Address.html\" rel=\"nofollow noreferrer\">ex-parrot.com/pdw/Mail-RFC822-Address.html</a> (sorry, that was probably too far OT)"}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456962869, "post_id": 35756696, "comment_id": 59194337, "body": "@JimB the testing framework/tool I&#39;m developing is meant to mainly test the logic of the application not really the validation rules. Randomness it&#39;s a feature to address the conflicting and stale data. For rule validations I think a specialized tool is required, perhaps something like/based on Go Fuzz github.com/dvyukov/go-fuzz ). Shortly said the random input generator would answer this demand: <code>Give me a valid [phone number&#47;email etc] that was not used before!</code> so that I can use it to register a fake/test user. The input generated must be random (like GUID) to avoid a db conn."}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 5987281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90f1fc62eef6a6992a58670627bdae1b?s=128&d=identicon&r=PG&f=1", "display_name": "Lucas Jones", "link": "https://stackoverflow.com/users/5987281/lucas-jones"}, "is_accepted": false, "score": 3, "last_activity_date": 1457013077, "creation_date": 1457013077, "answer_id": 35774048, "question_id": 35756696, "link": "https://stackoverflow.com/questions/35756696/random-generator-matching-regexp/35774048#35774048", "title": "Random generator matching regexp?", "body": "<p><a href=\"https://github.com/lucasjones/reggen\" rel=\"nofollow\">Reggen</a> is a library that I've written that can generate strings from regular expressions. It can be used to generate the email addresses/phone numbers you need, and anything else specified with a regular expression.</p>\n\n<p>In general the more specific the provided regular expressions are, the better results it gives. For example, the regex <code>.*@.*\\..*</code> might generate something like <code>F$-^@A\"%mk.^uv</code>, but <code>[a-z]+@[a-z]+\\.(com|net|org)</code> should result in something more readable like <code>bfeujqp@qtpqby.com</code></p>\n\n<p>Generating an email address with the library:</p>\n\n<pre><code>import \"github.com/lucasjones/reggen\"\n\nfunc main() {\n    str, err := reggen.Generate(\"^[a-z]{5,10}@[a-z]{5,10}\\\\.(com|net|org)$\", 10)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(str)\n}\n</code></pre>\n\n<p>Typical output:</p>\n\n<pre><code>tpbry@sfmxet.net\n</code></pre>\n"}], "owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1901, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1457013077, "creation_date": 1456947982, "last_edit_date": 1456952262, "question_id": 35756696, "link": "https://stackoverflow.com/questions/35756696/random-generator-matching-regexp", "title": "Random generator matching regexp?", "body": "<p>Is there any go package that receives a <a href=\"https://golang.org/pkg/regexp/#Regexp\" rel=\"nofollow\">regex</a> as input and returns a random string matching that regex or can you direct me how such a solution can be implemented? </p>\n\n<p>My first thought is to generate random bytes in a loop from /dev/rand and then return one that matches the regex but I think this kind of brute-force would be time consuming until I find one such string matching the regex. </p>\n\n<p><strong>Use case:</strong></p>\n\n<p>I'm planning to use this for a web service testing library. </p>\n\n<ul>\n<li><p>Some API calls such registering an user account requires unique fields such an email address, phone number etc thus the need of a random input generator based on a patter/regex.</p></li>\n<li><p>The random property also helps to safeguard against stale data /false positives (i.e. data that was stored before the current test suite). I guess the generator doesn't need to provide cryptography level randomness but rather something like GUID.</p></li>\n</ul>\n"}, {"tags": ["git", "github", "go"], "answers": [{"comments": [{"owner": {"reputation": 175871, "user_id": 454533, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7715e765817254e0534f89a4092c0aa?s=128&d=identicon&r=PG", "display_name": "Explosion Pills", "link": "https://stackoverflow.com/users/454533/explosion-pills"}, "edited": false, "score": 0, "creation_date": 1456943156, "post_id": 35755158, "comment_id": 59183650, "body": "When I do <code>go get github.com&#47;ajcrites&#47;apex&#47;cmd&#47;apex</code> the origin remote <i>is</i> already set to <code>https:&#47;&#47;github.com&#47;ajcrites&#47;apex</code> (not ssh, another annoyance). This doesn&#39;t solve the issue -- I think it is an issue related to Go/Godeps and has nothing to do with git really."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 175871, "user_id": 454533, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7715e765817254e0534f89a4092c0aa?s=128&d=identicon&r=PG", "display_name": "Explosion Pills", "link": "https://stackoverflow.com/users/454533/explosion-pills"}, "edited": false, "score": 0, "creation_date": 1456943226, "post_id": 35755158, "comment_id": 59183690, "body": "@ExplosionPills: sorry, pasted the wrong URL in there. You want to keep the upstream path, so use <code>github.com&#47;apex&#47;apex</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 175871, "user_id": 454533, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7715e765817254e0534f89a4092c0aa?s=128&d=identicon&r=PG", "display_name": "Explosion Pills", "link": "https://stackoverflow.com/users/454533/explosion-pills"}, "edited": false, "score": 0, "creation_date": 1456943304, "post_id": 35755158, "comment_id": 59183745, "body": "@ExplosionPills: oh, and you didn&#39;t mention <code>godeps</code>. I don&#39;t use that very often, so there might be a better way to handle forks in that tool specifically. My recommendations were for go in general."}, {"owner": {"reputation": 175871, "user_id": 454533, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7715e765817254e0534f89a4092c0aa?s=128&d=identicon&r=PG", "display_name": "Explosion Pills", "link": "https://stackoverflow.com/users/454533/explosion-pills"}, "edited": false, "score": 0, "creation_date": 1456944778, "post_id": 35755158, "comment_id": 59184671, "body": "Sorry for not mentioning <code>godeps</code>; I don&#39;t really know that much about go at this point and I thought godeps was pretty much standard. apex is using godeps though; I didn&#39;t choose to do that one way or the other."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 1, "last_activity_date": 1456944600, "last_edit_date": 1456944600, "creation_date": 1456942873, "answer_id": 35755158, "question_id": 35755073, "link": "https://stackoverflow.com/questions/35755073/go-get-workflow-for-forked-repo/35755158#35755158", "title": "Go get workflow for forked repo", "body": "<p>If you don't want to change the import paths in your code, or vendor the source in your project, don't change directory where the code lies in GOPATH. If you want to change the import path, you will need to rewrite that in all the source, or you end up importing multiple versions of the package. </p>\n\n<p>Go into the <code>$GOPATH/src/github.com/apex/apex</code> directory and change the <code>origin</code> remote to your forked repo. By convention, I also add the original repo as an <code>upstream</code> remote, so I can conveniently fetch and merge changes from there as well. </p>\n\n<p>Since vendoring is enabled by default since go1.6, you can put the source in a <code>vendor/</code> directory under your control, and make your modifications there. Using git submodules can also allow you to keep it under separate version control, but linked to your project. </p>\n"}, {"comments": [{"owner": {"reputation": 175871, "user_id": 454533, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7715e765817254e0534f89a4092c0aa?s=128&d=identicon&r=PG", "display_name": "Explosion Pills", "link": "https://stackoverflow.com/users/454533/explosion-pills"}, "edited": false, "score": 0, "creation_date": 1456944974, "post_id": 35755773, "comment_id": 59184787, "body": "Thanks; they don&#39;t recommend you use a fork? I think that this also doesn&#39;t really solve the problem of being able to test local changes while still keeping the stable binary installed."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 175871, "user_id": 454533, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7715e765817254e0534f89a4092c0aa?s=128&d=identicon&r=PG", "display_name": "Explosion Pills", "link": "https://stackoverflow.com/users/454533/explosion-pills"}, "edited": false, "score": 1, "creation_date": 1456945059, "post_id": 35755773, "comment_id": 59184848, "body": "You have two options: re-install the stable binary once done via <code>git checkout master &amp;&amp; go install .&#47;...</code> or alternatively you re-vendor that new branch into your project. Using forks means you have to re-write all of the URLs not just in your project, but also within any subpackages of the library you&#39;re trying to modify (as it might import its own helper libraries)."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": false, "score": 0, "last_activity_date": 1456944989, "last_edit_date": 1456944989, "creation_date": 1456944918, "answer_id": 35755773, "question_id": 35755073, "link": "https://stackoverflow.com/questions/35755073/go-get-workflow-for-forked-repo/35755773#35755773", "title": "Go get workflow for forked repo", "body": "<p>Here's the flow I recommend and use for managing the Gorilla organization on GitHub:</p>\n\n<pre><code>$ go get github.com/gorilla/csrf\n$ cd $GOPATH/src/github.com/gorilla/csrf\n\n# Alternatively, you can git remote remove origin + re-add as SSH\n$ git remote add elithrar git@github.com:elithrar/csrf.git\n\n$ git checkout -b new-feature-X\n$ &lt;do some work on it&gt;\n\n# Install those changes.\n$ go install ./...\n</code></pre>\n\n<p>That's it. No need to change import paths in any existing programs. If you're vendoring the dependencies, you can just change it in the vendored copy.</p>\n"}], "owner": {"reputation": 175871, "user_id": 454533, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c7715e765817254e0534f89a4092c0aa?s=128&d=identicon&r=PG", "display_name": "Explosion Pills", "link": "https://stackoverflow.com/users/454533/explosion-pills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1456944989, "creation_date": 1456942647, "question_id": 35755073, "link": "https://stackoverflow.com/questions/35755073/go-get-workflow-for-forked-repo", "title": "Go get workflow for forked repo", "body": "<p>I am using <a href=\"https://github.com/apex/apex\" rel=\"nofollow\"><code>apex</code></a> and have installed it with <code>go get github.com/apex/apex/cmd/apex</code>. I have <code>$GOPATH/bin/apex</code> which works great. I wanted to make some contributions to apex, so I forked it and ran <code>go get github.com/ajcrites/apex/cmd/apex</code>. So far so good.</p>\n\n<p>The problem comes when I want to actually test my local changes to the project. There are three issues I can see:</p>\n\n<ol>\n<li>Running <code>go build</code> locally doesn't work because the <code>main.go</code> file imports directly from <code>$GOPATH/src/github.com/apex</code>. I need it to import from <code>$GOPATH/src/github.com/ajcrites</code> for the purposes of testing</li>\n<li>Changing <code>main.go</code> manually to import from <code>ajcrites</code> is wonky since I can't/shouldn't commit these changes. Moreover even though it does build with my files -- I can tell because it lints them -- the binary that is emitted doesn't work at all.</li>\n<li>Changing <code>$GOPATH/src/github.com/ajcrites</code> to <code>/apex</code> and building that way does work, but there are two issues:\n\n<ul>\n<li>The file system directory doesn't match the actual repo name which is weird</li>\n<li>I still want to be able to use the actual binary from <code>/apex</code> without clobbering it just for the purposes of testing local changes</li>\n</ul></li>\n</ol>\n\n<p>Is there a recommended way to clone forked <code>go</code> repositories and build/test locally?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1456941337, "post_id": 35754563, "comment_id": 59182515, "body": "Under Windows the <code>EOF</code> is mapped Ctrl+Z as far as I know. Maybe your terminal remap it to something else, check out its configuration."}, {"owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 0, "creation_date": 1456941537, "post_id": 35754563, "comment_id": 59182639, "body": "Are you sure you&#39;re typing Ctrl+Z at the <i>beginning of a new line</i>? That may be required for Scan to actually receive EOF."}], "answers": [{"comments": [{"owner": {"reputation": 860, "user_id": 1061040, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/506889370ecfc0f3ac5aff4644bf03fa?s=128&d=identicon&r=PG", "display_name": "sager89", "link": "https://stackoverflow.com/users/1061040/sager89"}, "edited": false, "score": 0, "creation_date": 1456970846, "post_id": 35759721, "comment_id": 59196714, "body": "This is typically what&#39;s used for EOF in C, although I ran into the same issue above with golang on Windows 7."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1456962289, "last_edit_date": 1456962289, "creation_date": 1456958734, "answer_id": 35759721, "question_id": 35754563, "link": "https://stackoverflow.com/questions/35754563/golang-how-to-terminate-the-bufio-scan-from-terminal/35759721#35759721", "title": "Golang: How to terminate the bufio Scan() from terminal?", "body": "<p>For Windows, on a new line,</p>\n\n<pre><code>&lt;Ctrl+Z&gt;&lt;Enter&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 93, "user_id": 6153200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ade034c47c02f41b0d0fc8e4c967b5ec?s=128&d=identicon&r=PG&f=1", "display_name": "Tony Antoniani", "link": "https://stackoverflow.com/users/6153200/tony-antoniani"}, "is_accepted": false, "score": 9, "last_activity_date": 1459714433, "creation_date": 1459714433, "answer_id": 36390602, "question_id": 35754563, "link": "https://stackoverflow.com/questions/35754563/golang-how-to-terminate-the-bufio-scan-from-terminal/36390602#36390602", "title": "Golang: How to terminate the bufio Scan() from terminal?", "body": "<p>No one asked but I had this problem in OSX and this came up in a search. Mac OSX terminals recognize EOF when control-D is pressed at the beginning of a line.</p>\n"}, {"tags": [], "owner": {"reputation": 9256, "user_id": 1522019, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a7406677cd64e10ff15953539205791?s=128&d=identicon&r=PG", "display_name": "alucic", "link": "https://stackoverflow.com/users/1522019/alucic"}, "is_accepted": false, "score": 3, "last_activity_date": 1553912319, "creation_date": 1553912319, "answer_id": 55427560, "question_id": 35754563, "link": "https://stackoverflow.com/questions/35754563/golang-how-to-terminate-the-bufio-scan-from-terminal/55427560#55427560", "title": "Golang: How to terminate the bufio Scan() from terminal?", "body": "<p><code>ctrl + shift + d</code> will send EOF to the terminal if it's the first character in a new line.</p>\n\n<pre><code>go run main.go\n\n&gt; line one\n&gt; another line\n&gt; another line\n&gt; ctrl + shift + d\n</code></pre>\n\n<p>And you should see the output </p>\n\n<pre><code>2 another line\n</code></pre>\n\n<p>As described in this comment <a href=\"https://stackoverflow.com/a/21658005/1522019\">https://stackoverflow.com/a/21658005/1522019</a> .<br>\nYou can use <code>stty all</code> to find EOF combination. I kept doing <code>ctrl + d</code> which in my mind is the same as <code>ctrl + D</code>.</p>\n"}], "owner": {"reputation": 71, "user_id": 6009300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b29a8bd17b5c613fbde2414cccd983e2?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Guo", "link": "https://stackoverflow.com/users/6009300/andrew-guo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1568, "favorite_count": 4, "answer_count": 3, "score": 7, "last_activity_date": 1559875049, "creation_date": 1456941008, "last_edit_date": 1457027967, "question_id": 35754563, "link": "https://stackoverflow.com/questions/35754563/golang-how-to-terminate-the-bufio-scan-from-terminal", "title": "Golang: How to terminate the bufio Scan() from terminal?", "body": "<p>I am running the <a href=\"https://github.com/adonovan/gopl.io/blob/master/ch1/dup1/main.go\" rel=\"noreferrer\">dup1 example</a> from <a href=\"http://www.gopl.io/\" rel=\"noreferrer\">The Go Programming Language</a> book (related code shown below):</p>\n\n<pre><code>for input.Scan() {\n    counts[input.Text()]++\n}\n</code></pre>\n\n<p>After typing some lines of text, I want to terminate the <code>Scan()</code> method. I've tried Ctrl+D, Ctrl+Z and many other key combinations without luck. Only Ctrl+C works but that also terminates the program.</p>\n\n<p>How can I terminate the <code>Scan()</code> from terminal without exiting the program?</p>\n\n<p>I am developing on Windows 7 using os.Stdin.</p>\n\n<p>[Edit]</p>\n\n<p><code>Ctrl+Z</code> doesn't work:</p>\n\n<p>Thanks. But that doesn't work for me:</p>\n\n<pre><code>C:\\prj\\src\\gopl\\&gt;go run dup1.go\nI have tried all these combinations from the terminal\n^Z\n^X\n^V\n^B\n^N\n\n^A\n^D\n^F\n^G\n\n^K\n^L\n^Q\n^W\n^E\n^R\n^T\n^Y\n^U\n^O\n^P\n2(Notes: only Ctrl + C works here)\n\nC:\\prj\\src\\gopl\\&gt;\n</code></pre>\n\n<p>If I run this program in Ubuntu, only <code>Ctrl + D</code> works, <code>Ctrl + Z</code> will <strong>Stop</strong> the program and <code>Ctrl + C</code> will terminate it.</p>\n"}, {"tags": ["audio", "go", "ffmpeg"], "answers": [{"comments": [{"owner": {"reputation": 10401, "user_id": 681044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OWZ3c.jpg?s=128&g=1", "display_name": "kwarunek", "link": "https://stackoverflow.com/users/681044/kwarunek"}, "edited": false, "score": 0, "creation_date": 1456951663, "post_id": 35754624, "comment_id": 59188810, "body": "try to be more verbose with an answer"}, {"owner": {"reputation": 5427, "user_id": 721386, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/990a96e6875ad1319af43b61b8d090b7?s=128&d=identicon&r=PG", "display_name": "Dustin", "link": "https://stackoverflow.com/users/721386/dustin"}, "edited": false, "score": 0, "creation_date": 1457031141, "post_id": 35754624, "comment_id": 59232569, "body": "@Mulvya This definitely outputs an opus file in an ogg container, thanks for that! Though is it possible that it outputs the raw opus encoded data without an ogg container?"}, {"owner": {"reputation": 61761, "user_id": 5726027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a15e6b3536ef969cf3a9828a0542aac2?s=128&d=identicon&r=PG", "display_name": "Gyan", "link": "https://stackoverflow.com/users/5726027/gyan"}, "edited": false, "score": 0, "creation_date": 1457032076, "post_id": 35754624, "comment_id": 59233107, "body": "You can try <code>-map 0:a -f data pipe:1</code>"}], "tags": [], "owner": {"reputation": 61761, "user_id": 5726027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a15e6b3536ef969cf3a9828a0542aac2?s=128&d=identicon&r=PG", "display_name": "Gyan", "link": "https://stackoverflow.com/users/5726027/gyan"}, "is_accepted": true, "score": 2, "last_activity_date": 1456984581, "last_edit_date": 1456984581, "creation_date": 1456941197, "answer_id": 35754624, "question_id": 35754212, "link": "https://stackoverflow.com/questions/35754212/not-outputting-opus-raw-audio/35754624#35754624", "title": "Not outputting Opus raw audio", "body": "<p>Try</p>\n\n<pre><code>ffmpeg -i - -sample_fmt s16 -ar 48000 -ac 2 -acodec libopus -b:a 192k -vbr on -compression_level 10 -f opus pipe:1\n</code></pre>\n\n<p>You can't use <code>-f s16le</code> as that specifies an uncompressed output format (of a specific sample type), whereas you need a compressed data stream of a certain codec. Instead, you can use <code>sample_fmt</code> and <code>-f opus</code></p>\n"}], "owner": {"reputation": 5427, "user_id": 721386, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/990a96e6875ad1319af43b61b8d090b7?s=128&d=identicon&r=PG", "display_name": "Dustin", "link": "https://stackoverflow.com/users/721386/dustin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1230, "favorite_count": 0, "accepted_answer_id": 35754624, "answer_count": 1, "score": 2, "last_activity_date": 1457035782, "creation_date": 1456939934, "last_edit_date": 1457035782, "question_id": 35754212, "link": "https://stackoverflow.com/questions/35754212/not-outputting-opus-raw-audio", "title": "Not outputting Opus raw audio", "body": "<p>I'm currently writing a small script that coverts an MP4 to Opus audio on the fly and sends it to <a href=\"https://github.com/bwmarrin/discordgo\" rel=\"nofollow\">Discord</a> in golang. Initially my script would pass an MP4 as it was downloading to ffmpeg through stdin and then pass stdout to an Opus encoder, then to Discord (exactly like <a href=\"https://github.com/bwmarrin/dgvoice/blob/master/dgvoice.go#L53-L98\" rel=\"nofollow\">this</a>). After learning I could build ffmpeg with Opus, I'd like to cut out the opus encoder I previous had and pass ffmpeg's output directly to Discord.</p>\n\n<p>Previous, my ffmpeg command looked like this (with using the second opus encoder)</p>\n\n<pre><code>ffmpeg -i - -f s16le -ar 48000 -ac 2 pipe:1\n</code></pre>\n\n<p>Now, without the encoder and letting ffmpeg do all the work, this is what I've come up with so far.</p>\n\n<pre><code>ffmpeg -i - -f s16le -ar 48000 -ac 2 -acodec libopus -b:a 192k -vbr on -compression_level 10 pipe:1\n</code></pre>\n\n<p>With this command however the audio doesn't get accepted by Discord's server, meaning I'm suspecting opus audio isn't coming out the other end. No errors outputted. Have I done something wrong with ffmpeg that could of caused this?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 2353, "user_id": 331873, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c6a1791b0833d8f85f9e1dff5dc3ad47?s=128&d=identicon&r=PG", "display_name": "hyprnick", "link": "https://stackoverflow.com/users/331873/hyprnick"}, "edited": false, "score": 0, "creation_date": 1456939187, "post_id": 35753957, "comment_id": 59181116, "body": "I just tried to Marshal a single Post and that doesn&#39;t work either.  I&#39;m missing something."}], "answers": [{"comments": [{"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "reply_to_user": {"reputation": 2353, "user_id": 331873, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c6a1791b0833d8f85f9e1dff5dc3ad47?s=128&d=identicon&r=PG", "display_name": "hyprnick", "link": "https://stackoverflow.com/users/331873/hyprnick"}, "edited": false, "score": 0, "creation_date": 1456941114, "post_id": 35754127, "comment_id": 59182358, "body": "Well, an unexported field is the <code>private</code> equivalent of other languages, so it is absolutely normal another package can&#39;t see it. It would defy the definition of <code>private</code> attribute otherwise\u2026"}, {"owner": {"reputation": 2353, "user_id": 331873, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c6a1791b0833d8f85f9e1dff5dc3ad47?s=128&d=identicon&r=PG", "display_name": "hyprnick", "link": "https://stackoverflow.com/users/331873/hyprnick"}, "edited": false, "score": 0, "creation_date": 1456942057, "post_id": 35754127, "comment_id": 59182962, "body": "I was referring to using style (Capitalization) to change behavior rather than a keyword (private like you said) or a symbol (Nim language uses *). Just something to figure out when learning a new language :)"}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "reply_to_user": {"reputation": 2353, "user_id": 331873, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c6a1791b0833d8f85f9e1dff5dc3ad47?s=128&d=identicon&r=PG", "display_name": "hyprnick", "link": "https://stackoverflow.com/users/331873/hyprnick"}, "edited": false, "score": 0, "creation_date": 1456942870, "post_id": 35754127, "comment_id": 59183474, "body": "Well\u2026 not adding a keyword or symbol to denote private state is shorter to write, faster to read, and in the end simpler. That may be the best example of &quot;Convention over configuration&quot;."}], "tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": true, "score": 1, "last_activity_date": 1456939659, "creation_date": 1456939659, "answer_id": 35754127, "question_id": 35753957, "link": "https://stackoverflow.com/questions/35753957/create-json-from-sql-result-for-api/35754127#35754127", "title": "Create JSON from SQL result for API", "body": "<p>Your fields aren't exported, so the <code>json</code> package can't see them.</p>\n\n<p>See <a href=\"http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/index.html#unexp_struct_field_enc\" rel=\"nofollow\">50 Shades of Go</a> for a longer explanation and others common gotchas.</p>\n"}], "owner": {"reputation": 2353, "user_id": 331873, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c6a1791b0833d8f85f9e1dff5dc3ad47?s=128&d=identicon&r=PG", "display_name": "hyprnick", "link": "https://stackoverflow.com/users/331873/hyprnick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 35754127, "answer_count": 1, "score": 0, "last_activity_date": 1456939659, "creation_date": 1456939126, "question_id": 35753957, "link": "https://stackoverflow.com/questions/35753957/create-json-from-sql-result-for-api", "title": "Create JSON from SQL result for API", "body": "<p>I'm very new to Go so hopefully this is simple to fix. I want to build a JSON value from rows in an SQL database. It doesn't have to be SQL but I'm looking for a way to generate a list of structs or a container that holds many values in order to generate JSON from it.  </p>\n\n<p>For example, an HTTP GET request to \"/post\" would return:  </p>\n\n<pre><code>{\n  \"posts\": [\n    { \"title\": \"First title\", \"created_by\": \"User1\" },\n    { \"title\": \"My second post\", \"created_by\": \"User1\"}\n  ]\n}\n</code></pre>\n\n<p>I don't know what's the proper way to do this. I've tried other ways using an array of pointers but it doesn't come out correctly.  So far it prints out the correct values for each struct but the resulting Marshal is empty <code>[{},{},{}]</code></p>\n\n<p>Please go easy on me :)  </p>\n\n<p><strong>example.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n    \"time\"\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\n\ntype Post struct {\n    name string `json:\"name\"`\n    created_by string `json:\"created_by\"`\n    created_at time.Time `json:\"created_at\"`\n}\n\ntype Posts []Post\n\nfunc main() {\n\n    db, err := sql.Open(\"mysql\", \"root:1234@/blog?parseTime=true\")\n    if err != nil { panic(err.Error()) }\n    defer db.Close()\n\n    err = db.Ping()\n    if err != nil { panic(err.Error()) }\n\n    rows, err := db.Query(\"select title, created_by, created_at from post\")\n    if err != nil { panic(err.Error()) }\n    defer rows.Close()\n\n    var posts Posts\n    for rows.Next() {            \n        var post Post\n        err := rows.Scan(&amp;post.name, &amp;post.created_by, &amp;post.created_at)\n        if err != nil { panic(err.Error()) }\n        fmt.Printf(\"name=%s, created_by=%s, created_at=%s\\n\", post.name, post.created_by, post.created_at)\n        posts = append(posts, post)                  \n    }    \n\n    data, err := json.Marshal(posts)    \n    if err != nil { panic(err.Error()) }\n    fmt.Printf(\"%s\\n\", data)\n}\n</code></pre>\n"}, {"tags": ["parsing", "go", "hex"], "answers": [{"comments": [{"owner": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "edited": false, "score": 3, "creation_date": 1530514526, "post_id": 35754071, "comment_id": 89245787, "body": "this returned <code>uint64</code> but I want &#39;uint16&#39;. How can I earn to it?"}], "tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": true, "score": 11, "last_activity_date": 1602186685, "last_edit_date": 1602186685, "creation_date": 1456939502, "answer_id": 35754071, "question_id": 35753904, "link": "https://stackoverflow.com/questions/35753904/how-do-i-convert-a-string-value-in-uint16-in-go-lang/35754071#35754071", "title": "How do I convert a string value in uint16 in Go lang?", "body": "<p>Use <code>strconv.ParseUint</code> (<a href=\"https://godoc.org/strconv#ParseUint\" rel=\"nofollow noreferrer\">doc</a>).</p>\n<pre><code>var s = &quot;05f8&quot;\nvar base = 16\nvar size = 16\nvalue, err := strconv.ParseUint(s, base, size)\nvalue2 := uint16(value) // done!\n</code></pre>\n<p>Note that the output value is an <code>uint64</code>, you have to cast it to you type before using it.</p>\n<p>Note (bis) that the size parameter control the maximum size of the uint to convert to, so the overflow check is done correctly.</p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 1, "last_activity_date": 1615736544, "creation_date": 1615736544, "answer_id": 66626409, "question_id": 35753904, "link": "https://stackoverflow.com/questions/35753904/how-do-i-convert-a-string-value-in-uint16-in-go-lang/66626409#66626409", "title": "How do I convert a string value in uint16 in Go lang?", "body": "<p>If you are interested in turning a <code>string</code> into <code>[]uint16</code>, you can do:</p>\n<pre><code>package main\n\nimport (\n   &quot;fmt&quot;\n   &quot;golang.org/x/sys/windows&quot;\n   &quot;log&quot;\n)\n\nfunc main() {\n   a, e := windows.UTF16FromString(&quot;05f8&quot;)\n   if e != nil {\n      log.Fatal(e)\n   }\n   fmt.Println(a) // [48 53 102 56 0]\n}\n</code></pre>\n<p>or, if you are certain <code>string</code> contains no NUL bytes, you can do this:</p>\n<pre><code>package main\n\nimport (\n   &quot;fmt&quot;\n   &quot;golang.org/x/sys/windows&quot;\n)\n\nfunc main() {\n   a := windows.StringToUTF16(&quot;05f8&quot;)\n   fmt.Println(a) // [48 53 102 56 0]\n}\n</code></pre>\n<ul>\n<li><a href=\"https://pkg.go.dev/golang.org/x/sys/windows#StringToUTF16\" rel=\"nofollow noreferrer\">https://pkg.go.dev/golang.org/x/sys/windows#StringToUTF16</a></li>\n<li><a href=\"https://pkg.go.dev/golang.org/x/sys/windows#UTF16FromString\" rel=\"nofollow noreferrer\">https://pkg.go.dev/golang.org/x/sys/windows#UTF16FromString</a></li>\n</ul>\n"}], "owner": {"reputation": 286, "user_id": 5899150, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4380bc3fef16ee11788a3efea8e1cf0?s=128&d=identicon&r=PG&f=1", "display_name": "Majonsi", "link": "https://stackoverflow.com/users/5899150/majonsi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6259, "favorite_count": 1, "accepted_answer_id": 35754071, "answer_count": 2, "score": 5, "last_activity_date": 1615736544, "creation_date": 1456938924, "last_edit_date": 1456997536, "question_id": 35753904, "link": "https://stackoverflow.com/questions/35753904/how-do-i-convert-a-string-value-in-uint16-in-go-lang", "title": "How do I convert a string value in uint16 in Go lang?", "body": "<p>I'm researching a solution in order to convert a string (in my case the string is \"05f8\") into a uint16.I made research but I don't find a solution.Does anyone know how to do this?</p>\n\n<p>Thanks for your help!</p>\n"}, {"tags": ["generics", "reflection", "go", "interface"], "answers": [{"tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": false, "score": 0, "last_activity_date": 1456938951, "creation_date": 1456938951, "answer_id": 35753909, "question_id": 35753768, "link": "https://stackoverflow.com/questions/35753768/invoke-a-function-which-is-received-as-an-interface-variable-in-golang/35753909#35753909", "title": "Invoke a function which is received as an interface variable in golang", "body": "<p>You need to declare the parameter <code>fn</code> as a function, not as <code>interface{}</code>. How is <code>fn(args...)</code> supposed to work for <code>PrintThis</code>, with one argument, and also with <code>PrintThisAndThat</code>, with two arguments? You need to decide which type of function you want to receive and declare that as the parameter.</p>\n"}, {"comments": [{"owner": {"reputation": 1516, "user_id": 3074624, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/eca9b92bb23c77aa71a707584db33ec7?s=128&d=identicon&r=PG&f=1", "display_name": "Manu Viswam", "link": "https://stackoverflow.com/users/3074624/manu-viswam"}, "edited": false, "score": 0, "creation_date": 1456940842, "post_id": 35754301, "comment_id": 59182170, "body": "Is there a way to scale this approach to handle any type of functions? I have shown only two functions for simplicity.  something similar to <code>m := fn.(reflect.TypeOf(fn))</code>"}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 1516, "user_id": 3074624, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/eca9b92bb23c77aa71a707584db33ec7?s=128&d=identicon&r=PG&f=1", "display_name": "Manu Viswam", "link": "https://stackoverflow.com/users/3074624/manu-viswam"}, "edited": false, "score": 0, "creation_date": 1456941024, "post_id": 35754301, "comment_id": 59182300, "body": "@ManuViswam there might be, I&#39;m on mobile so it&#39;s hard to playground, but it&#39;s kind of hard because it&#39;s strongly typed so the compiler wants to know what things are at compile time. Why are you using this approach anyways there has to be a better way to do this."}, {"owner": {"reputation": 1516, "user_id": 3074624, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/eca9b92bb23c77aa71a707584db33ec7?s=128&d=identicon&r=PG&f=1", "display_name": "Manu Viswam", "link": "https://stackoverflow.com/users/3074624/manu-viswam"}, "edited": false, "score": 0, "creation_date": 1456941419, "post_id": 35754301, "comment_id": 59182567, "body": "I&#39;m writing a plugin for a test runner. The test core will send you a function object and its arguments, I have to receive it and execute the function. I&#39;m trying to write a generic method for doing this."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 1516, "user_id": 3074624, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/eca9b92bb23c77aa71a707584db33ec7?s=128&d=identicon&r=PG&f=1", "display_name": "Manu Viswam", "link": "https://stackoverflow.com/users/3074624/manu-viswam"}, "edited": false, "score": 0, "creation_date": 1456943010, "post_id": 35754301, "comment_id": 59183566, "body": "@ManuViswam check out jims answer probably better suited for that, I thought you knew the functions being passed. I suggest reading <a href=\"http://blog.golang.org/laws-of-reflection\" rel=\"nofollow noreferrer\">blog.golang.org/laws-of-reflection</a> as reflection can be dangerous"}], "tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": false, "score": 5, "last_activity_date": 1456940169, "creation_date": 1456940169, "answer_id": 35754301, "question_id": 35753768, "link": "https://stackoverflow.com/questions/35753768/invoke-a-function-which-is-received-as-an-interface-variable-in-golang/35754301#35754301", "title": "Invoke a function which is received as an interface variable in golang", "body": "<p>You can use a type switch like so <a href=\"http://play.golang.org/p/opotbIGdrA\" rel=\"noreferrer\">http://play.golang.org/p/opotbIGdrA</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc PrintThis(arg string) {\n    fmt.Printf(\"I'm printing %s\", arg)\n}\n\nfunc PrintThisAndThat(arg1, arg2 string) {\n    fmt.Printf(\"Now printing %s and %s\", arg1, arg2)\n}\n\nfunc Invoke(fn interface{}, args ...string) {\n    switch m := fn.(type) {\n    case func(string):\n        m(args[0])\n    case func(string, string):\n        m(args[0], args[1])\n    default:\n\n    }\n}\n\nfunc main() {\n    Invoke(PrintThis, \"foo\")\n    Invoke(PrintThisAndThat, \"foo\", \"bar\")\n}\n</code></pre>\n\n<p>But you kind of need to know what functions will be passed to make this work properly. </p>\n\n<p>Btw you can turn <code>PrintThis</code> into a variadic function by using <code>...string</code> instead of multiple string arguments. </p>\n"}, {"comments": [{"owner": {"reputation": 1516, "user_id": 3074624, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/eca9b92bb23c77aa71a707584db33ec7?s=128&d=identicon&r=PG&f=1", "display_name": "Manu Viswam", "link": "https://stackoverflow.com/users/3074624/manu-viswam"}, "edited": false, "score": 0, "creation_date": 1456983728, "post_id": 35754987, "comment_id": 59200651, "body": "Exactly what I was looking for. Thank you."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 8, "last_activity_date": 1456942407, "creation_date": 1456942407, "answer_id": 35754987, "question_id": 35753768, "link": "https://stackoverflow.com/questions/35753768/invoke-a-function-which-is-received-as-an-interface-variable-in-golang/35754987#35754987", "title": "Invoke a function which is received as an interface variable in golang", "body": "<p>You use the <a href=\"https://golang.org/pkg/reflect/#Value.Call\" rel=\"noreferrer\"><code>Call</code></a> or <a href=\"https://golang.org/pkg/reflect/#Value.CallSlice\" rel=\"noreferrer\"><code>CallSlice</code></a> methods of the <code>reflect.Value</code> to call it as a function. As with all <code>reflect.Value</code> methods, this panics is <code>fn</code> is the wrong type.</p>\n\n<pre><code>func Invoke(fn interface{}, args ...string) {\n    v := reflect.ValueOf(fn)\n    rargs := make([]reflect.Value, len(args))\n    for i, a := range args {\n        rargs[i] = reflect.ValueOf(a)\n    }\n    v.Call(rargs)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/xGmNLDcLL_\" rel=\"noreferrer\">http://play.golang.org/p/xGmNLDcLL_</a></p>\n"}], "owner": {"reputation": 1516, "user_id": 3074624, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/eca9b92bb23c77aa71a707584db33ec7?s=128&d=identicon&r=PG&f=1", "display_name": "Manu Viswam", "link": "https://stackoverflow.com/users/3074624/manu-viswam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3273, "favorite_count": 2, "accepted_answer_id": 35754987, "answer_count": 3, "score": 9, "last_activity_date": 1456942407, "creation_date": 1456938547, "question_id": 35753768, "link": "https://stackoverflow.com/questions/35753768/invoke-a-function-which-is-received-as-an-interface-variable-in-golang", "title": "Invoke a function which is received as an interface variable in golang", "body": "<p>I have a code which is similar to the following</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc PrintThis(arg string) {\n    fmt.Printf(\"I'm printing %s\", arg)\n}\n\nfunc PrintThisAndThat(arg1, arg2 string) {\n    fmt.Printf(\"Now printing %s and %s\", arg1, arg2)\n}\n\nfunc Invoke(fn interface{}, args ...string) {\n    //fn(args...)\n}\n\nfunc main() {\n    Invoke(PrintThis, \"foo\")\n    Invoke(PrintThisAndThat, \"foo\", \"bar\")\n}\n</code></pre>\n\n<p>This is not the actual production code, but this is a simplified version.</p>\n\n<p>Question :- If I uncomment the line <code>//fn(args...)</code> I get a compile error <code>prog.go:14: cannot call non-function fn (type interface {})</code></p>\n\n<p>How do I execute the function which is received as the argument tho the Invoke() function? </p>\n\n<p>What is the right way to achieve this?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 934, "user_id": 3239666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638873245dd9cdc579bf551818c11fb3?s=128&d=identicon&r=PG&f=1", "display_name": "GarMan", "link": "https://stackoverflow.com/users/3239666/garman"}, "edited": false, "score": 1, "creation_date": 1456936073, "post_id": 35752532, "comment_id": 59178881, "body": "You want to use pprof to find leaks, the symptoms are definitely indicative of leaks."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456936128, "post_id": 35752532, "comment_id": 59178931, "body": "Is the 5000req/sec to a single host, or many?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 934, "user_id": 3239666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638873245dd9cdc579bf551818c11fb3?s=128&d=identicon&r=PG&f=1", "display_name": "GarMan", "link": "https://stackoverflow.com/users/3239666/garman"}, "edited": false, "score": 0, "creation_date": 1456936625, "post_id": 35752532, "comment_id": 59179319, "body": "@GarMan: I&#39;m not sure how you intend to use pprof to show where a file descriptor wasn&#39;t closed, but a sampled memory or cpu profile is generally not useful in this case."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456936710, "post_id": 35752532, "comment_id": 59179390, "body": "@Cphilo: You ask about the proxy, but does using the proxy change the behavior you see? (it could have an effect, but I&#39;m not sure what your actual problem is yet)"}, {"owner": {"reputation": 934, "user_id": 3239666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638873245dd9cdc579bf551818c11fb3?s=128&d=identicon&r=PG&f=1", "display_name": "GarMan", "link": "https://stackoverflow.com/users/3239666/garman"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456938425, "post_id": 35752532, "comment_id": 59180592, "body": "@JimB using the inuse_objects pprof heap profiler, and then rerunning it some time later using the <code>-base</code> argument you can compare memory at different points. A leak is very clear to see in almost every example I have tried this with."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 934, "user_id": 3239666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638873245dd9cdc579bf551818c11fb3?s=128&d=identicon&r=PG&f=1", "display_name": "GarMan", "link": "https://stackoverflow.com/users/3239666/garman"}, "edited": false, "score": 0, "creation_date": 1456939602, "post_id": 35752532, "comment_id": 59181377, "body": "@GarMan: OK good point, but it still doesn&#39;t show where the cleanup is being missed (and in the case of FDs, lsof or a stacktrace usually shows the same info; but maybe I just have too much practice at reading those)."}, {"owner": {"reputation": 46, "user_id": 2698777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/404c6969720ef6a12d29a16c2afc2920?s=128&d=identicon&r=PG&f=1", "display_name": "Cphilo", "link": "https://stackoverflow.com/users/2698777/cphilo"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456970958, "post_id": 35752532, "comment_id": 59196737, "body": "@JimB, to a single host using http proxy"}, {"owner": {"reputation": 46, "user_id": 2698777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/404c6969720ef6a12d29a16c2afc2920?s=128&d=identicon&r=PG&f=1", "display_name": "Cphilo", "link": "https://stackoverflow.com/users/2698777/cphilo"}, "reply_to_user": {"reputation": 934, "user_id": 3239666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638873245dd9cdc579bf551818c11fb3?s=128&d=identicon&r=PG&f=1", "display_name": "GarMan", "link": "https://stackoverflow.com/users/3239666/garman"}, "edited": false, "score": 0, "creation_date": 1456971333, "post_id": 35752532, "comment_id": 59196824, "body": "@GarMan, I will try using pprof to debug this problem"}, {"owner": {"reputation": 46, "user_id": 2698777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/404c6969720ef6a12d29a16c2afc2920?s=128&d=identicon&r=PG&f=1", "display_name": "Cphilo", "link": "https://stackoverflow.com/users/2698777/cphilo"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456974579, "post_id": 35752532, "comment_id": 59197750, "body": "@JimB, <code>crawlerConsumers</code> is 5000. And <code>MaxIdleConnsPerHost</code> is greater than <code>crawlerConsumers</code>."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1456974867, "post_id": 35752532, "comment_id": 59197851, "body": "SendRequest function has an infinite for loop. Is this intentional?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456975310, "post_id": 35752532, "comment_id": 59197979, "body": "@Cphilo: sorry, missed that in the example. Have you confirmed all the FDs are taken by http connections to the host or proxy (does this ssdb do anything over the network, or are any files involved?)? Also, are you sure that 5000 concurrent connections is efficient? Fewer connections in parallel may make better use of IO and CPU."}, {"owner": {"reputation": 46, "user_id": 2698777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/404c6969720ef6a12d29a16c2afc2920?s=128&d=identicon&r=PG&f=1", "display_name": "Cphilo", "link": "https://stackoverflow.com/users/2698777/cphilo"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456975563, "post_id": 35752532, "comment_id": 59198050, "body": "@JimB: Yes, ssdb client use redis connection pool, I&#39;ve check this connection numbers. What do you mean fewer connections in parallel?"}, {"owner": {"reputation": 46, "user_id": 2698777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/404c6969720ef6a12d29a16c2afc2920?s=128&d=identicon&r=PG&f=1", "display_name": "Cphilo", "link": "https://stackoverflow.com/users/2698777/cphilo"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1456975766, "post_id": 35752532, "comment_id": 59198117, "body": "@Mark: yes, It is intentional."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456976359, "post_id": 35752532, "comment_id": 59198274, "body": "@Cphilo: I mean why is <code>crawlerConsumers</code> 5000? Making 5000 requests in parallel isn&#39;t usually faster (though if you&#39;ve tested this, and the connections are slow enough, that&#39;s fine). My hunch is that the contention on the idle connection pool from having so many consumers is preventing connections from being recycled fast enough, which would cause surges in the number of open connections. Maybe try fewer consumers and/or multiple http client+transports."}, {"owner": {"reputation": 46, "user_id": 2698777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/404c6969720ef6a12d29a16c2afc2920?s=128&d=identicon&r=PG&f=1", "display_name": "Cphilo", "link": "https://stackoverflow.com/users/2698777/cphilo"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456984505, "post_id": 35752532, "comment_id": 59200926, "body": "@JimB, I take your advice. <code>crawlerConsumers</code> 5000, 500 <code>crawlerConsumers</code> per http client, total 10 http client. Yeah, network utilization seems to be improved. But it did not solve this problem. Goroutines continue growing and the process file handles continue growing into the ulimit value.  In the cpu profile attachment, https request seems cost much time, any ideas about https request? Or should I improve ulimit value?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1457016764, "post_id": 35752532, "comment_id": 59222281, "body": "@Cphilo: are you on a very old version of go? Those timeouts should have been set by default (though slightly longer)."}, {"owner": {"reputation": 46, "user_id": 2698777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/404c6969720ef6a12d29a16c2afc2920?s=128&d=identicon&r=PG&f=1", "display_name": "Cphilo", "link": "https://stackoverflow.com/users/2698777/cphilo"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1457019902, "post_id": 35752532, "comment_id": 59224929, "body": "@JimB, go version go1.5.1 linux/amd64. Indeed, <code>DefaultTransport</code> have default <code>TLSHandshakeTimeout </code> value (<a href=\"https://golang.org/src/net/http/transport.go\" rel=\"nofollow noreferrer\">golang.org/src/net/http/transport.go</a>). But I use my own <code>Transport</code> and I did not set the<code>TLSHandshakeTimeout</code> value."}], "answers": [{"comments": [{"owner": {"reputation": 438, "user_id": 4608131, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153027846165155/picture?type=large", "display_name": "Cody Jacques", "link": "https://stackoverflow.com/users/4608131/cody-jacques"}, "edited": false, "score": 0, "creation_date": 1528308727, "post_id": 50726959, "comment_id": 88462080, "body": "<a href=\"https://oroboro.com/file-handle-leaks-server/\" rel=\"nofollow noreferrer\">oroboro.com/file-handle-leaks-server</a> that kind of explains the ways you might be able to get that error"}], "tags": [], "owner": {"reputation": 438, "user_id": 4608131, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153027846165155/picture?type=large", "display_name": "Cody Jacques", "link": "https://stackoverflow.com/users/4608131/cody-jacques"}, "is_accepted": false, "score": 0, "last_activity_date": 1528308692, "creation_date": 1528308692, "answer_id": 50726959, "question_id": 35752532, "link": "https://stackoverflow.com/questions/35752532/golang-http-too-many-files/50726959#50726959", "title": "golang http too many files", "body": "<p>have you looked at this yet:\n<a href=\"http://craigwickesser.com/2015/01/golang-http-to-many-open-files/\" rel=\"nofollow noreferrer\">http://craigwickesser.com/2015/01/golang-http-to-many-open-files/</a></p>\n\n<p>basically he suggests using <code>req.Header.Set(\"Connection\", \"close\")</code></p>\n\n<p>I wonder if you're connections are staying open until the timeout/keepalive is hit, so manually setting it to less than the default is closing the connection fast enough where you don't overflow?</p>\n"}], "owner": {"reputation": 46, "user_id": 2698777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/404c6969720ef6a12d29a16c2afc2920?s=128&d=identicon&r=PG&f=1", "display_name": "Cphilo", "link": "https://stackoverflow.com/users/2698777/cphilo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1261, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1528308692, "creation_date": 1456935231, "last_edit_date": 1457006846, "question_id": 35752532, "link": "https://stackoverflow.com/questions/35752532/golang-http-too-many-files", "title": "golang http too many files", "body": "<p>In my project, I need send http requests 5000 times/s. I did read some blogs and questions about the problem, and I try things:</p>\n\n<ol>\n<li>change process ulimit to 10^5</li>\n<li>close <code>content.Body</code></li>\n<li>use one http client and reuse connection</li>\n</ol>\n\n<p>But they just don't work. Indeed, my app can run for several minutes or hours, then it reach to the ulimit value in my settings(first 50000, late 100000, use shell cmd <code>ls -l /proc/PID/fd | wc -l</code>). The http request is as follows:</p>\n\n<pre><code>package http\n\nimport \"downloader/request\"\nimport \"downloader/response\"\nimport \"downloader/proxy\"\nimport \"downloader/ssdb\"\nimport \"net/http\"\nimport \"net/url\"\nimport \"time\"\nimport \"fmt\"\nimport \"strings\"\nimport \"io/ioutil\"\nimport \"errors\"\n\nfunc getProxy(ssdbClients []*ssdb.SSDBClient, proxyName string, reqUrl string) (string, error){\n    var err error\n    p := \"\"\n    url := \"\"\n    if proxyName != \"\" {\n        p, err = proxy.GetOne(ssdbClients,proxyName)\n        if err != nil {\n            return url, err\n        }\n        if strings.HasPrefix(reqUrl, \"https\") {\n            url = fmt.Sprintf(\"https://%s\", p)\n        } else if strings.HasPrefix(reqUrl, \"http\") {\n            url = fmt.Sprintf(\"http://%s\", p)\n        } else {\n            return url,errors.New(fmt.Sprintf(\"reqUrl %s not valid\", reqUrl))\n        }\n        return url, err\n    }\n    return url, err\n}\n\nfunc customProxy(req *http.Request) (*url.URL, error) {\n    httpProxy := req.Header.Get(\"HttpProxy\")\n    if httpProxy == \"\" {\n        return nil, nil\n    } else {\n        return url.Parse(httpProxy)\n    }\n}\n\nfunc GetClient() *http.Client {\n    var client http.Client\n    client = http.Client{\n        Timeout: 15 * time.Second,\n    }\n    transport :=  http.Transport{\n        Proxy: customProxy,\n        DisableCompression: false,\n        MaxIdleConnsPerHost: 10000,\n    }\n    client.Transport = &amp;transport\n    return &amp;client\n}\n\nfunc structResponse(req *request.HttpRequest, content *http.Response, proxy string) (response.HttpResponse, error) {\n    var resp response.HttpResponse\n    data, err := ioutil.ReadAll(content.Body)\n    if err != nil {\n        return resp, err\n    }\n    header := make(map[string]interface{})\n    for k, v := range content.Header {\n        if len(v) &gt; 0 {\n            header[k] = v[0]\n        }\n    }\n    var encoding string\n    encoding = content.Header.Get(\"Content-Encoding\")\n    resp = response.HttpResponse {\n        Request: *req,\n        ErrorCode: 0,\n        ErrorMsg: \"\",\n        StatusCode: content.StatusCode,\n        Reason: content.Status,\n        Html: string(data),\n        Headers: header,\n        Encoding: encoding,\n        Url: req.Url,\n        CrawlerName: req.CrawlerName,\n        ProxyName: req.ProxyName,\n        HttpProxy: proxy,\n    }\n    return resp, err\n}\n\nfunc Send(ssdbClients []*ssdb.SSDBClient, r *request.HttpRequest, httpClient *http.Client) (response.HttpResponse, error) {\n    var resp response.HttpResponse\n    var err error\n    var httpProxy string\n\n    httpProxy, err = getProxy(ssdbClients, r.ProxyName, r.Url)\n    if err != nil {\n        return resp, err\n    }\n\n    req, err := http.NewRequest(r.Method, r.Url, strings.NewReader(r.Data))\n    if err != nil {\n        return resp, err\n    }\n\n    u, err := url.Parse(r.Url)\n    if err != nil {\n        return resp, err\n    }\n\n    defaultHeaders := map[string] string {\n        \"User-Agent\": `Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_1) \n        AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.109 Safari/537.36`,\n        \"Upgrade-Insecure-Requests\": \"1\",\n        \"Connection\": \"keep-alive\",\n        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",\n        \"Accept-Language\": \"zh-CN,zh;q=0.8,en;q=0.6\",\n        \"Cache-Control\": \"max-age=0\",\n        \"Host\": u.Host,\n        \"HttpProxy\": httpProxy,\n    }\n\n    for k, v := range defaultHeaders {\n        req.Header.Set(k, v)\n    }\n\n    for k, v := range r.Headers {\n        req.Header.Set(k, fmt.Sprintf(\"%v\", v))\n    }\n\n    for k, v := range r.Cookies {\n        req.Header.Set(\"Cookie\", fmt.Sprintf(\"%s=%v\", k, v))\n    }\n\n\n    values := req.URL.Query()\n    for k, v := range r.Params {\n        values.Add(k, fmt.Sprintf(\"%v\", v))\n    }\n    req.URL.RawQuery = values.Encode()\n\n    content, err := httpClient.Do(req)\n    if err != nil {\n        return resp, err\n    }\n    defer content.Body.Close()\n    resp, err = structResponse(r, content, httpProxy)\n    if err != nil {\n        return resp, err\n    }\n    respCookies := make(map[string] interface{})\n    if httpClient.Jar != nil {\n        cookies := httpClient.Jar.Cookies(req.URL)\n        for _, cookie := range cookies {\n            respCookies[cookie.Name] = cookie.Value\n        }\n        resp.Cookies = respCookies\n    }\n    return resp, err\n}\n</code></pre>\n\n<p>And I use my http library as follows:</p>\n\n<pre><code>func sendRequest(clients []*ssdb.SSDBClient, r *request.HttpRequest, httpClient *http.Client) {\n    for {\n        resp, err := http.Send(clients, *r, httpClient)\n        if err != nil {\n            utils.Error.Println(\"http send fail \", err.Error())\n        } else {\n            if resp.StatusCode == 200 {\n                utils.Info.Println(\"status 200, success\")\n            } else {\n                utils.Warning.Println(\"status \", resp.StatusCode, resp.Reason)\n            }\n        }\n    }\n}\nfunc main() {\n    httpClient := http.GetClient()\n    var wg sync.WaitGroup\n    wg.Add(1)\n    for i:=0;i&lt;crawlerConsumers;i++ {\n        go sendRequest(clients, r, httpClient)\n    }\n    wg.Wait()\n}\n</code></pre>\n\n<p>Can anyone have any ideas or suggestions? </p>\n\n<ul>\n<li>Adding proxy have effects on http client connections?</li>\n<li>Do my app have to reach the ulimit value because my app send requests\n5000 times per second and one request have 15 seconds timeout?</li>\n<li>Do I close all the file handles?</li>\n<li>Do I forget to handle some exceptions?</li>\n</ul>\n\n<p>Add Some profile info with pprof</p>\n\n<pre><code>/debug/pprof/\n\nprofiles:\n0   block\n99490   goroutine(This number is growing constantly, very strange)\n1640    heap\n14  threadcreate\n\n# runtime.MemStats\n# Alloc = 210967776\n# TotalAlloc = 3673382376\n# Sys = 646805032\n# Lookups = 29226\n# Mallocs = 15590422\n# Frees = 14236863\n# HeapAlloc = 210967776\n# HeapSys = 331415552\n# HeapIdle = 72081408\n# HeapInuse = 259334144\n# HeapReleased = 0\n# HeapObjects = 1353559\n# Stack = 283049984 / 283049984\n# MSpan = 4007136 / 4112384\n# MCache = 9664 / 16384\n# BuckHashSys = 1575958\n# NextGC = 306292818\n# PauseNs = [2096153 2554867 2962532 4711468 3373778 3548443 1764893 1961992 2434108 2658626 2627832 2564733 2610212 3278169 2954882 2847604 4443650 3582780 3557718 4201288 4762243 8349689 3812924 5098353 5196422 4494087 5209715 5978150 5060982 4825367 6529020 5738726 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n# NumGC = 32\n# EnableGC = true\n# DebugGC = false\n\n\n# runtime.MemStats\n# Alloc = 334390488\n# TotalAlloc = 7408124464\n# Sys = 963748912\n# Lookups = 64289\n# Mallocs = 31759565\n# Frees = 29798637\n# HeapAlloc = 334390488\n# HeapSys = 536903680\n# HeapIdle = 171114496\n# HeapInuse = 365789184\n# HeapReleased = 0\n# HeapObjects = 1960928\n# Stack = 381648896 / 381648896\n# MSpan = 4958240 / 5160960\n# MCache = 9664 / 16384\n# BuckHashSys = 1625694\n# NextGC = 337299393\n# PauseNs = [2096153 2554867 2962532 4711468 3373778 3548443 1764893 1961992 2434108 2658626 2627832 2564733 2610212 3278169 2954882 2847604 4443650 3582780 3557718 4201288 4762243 8349689 3812924 5098353 5196422 4494087 5209715 5978150 5060982 4825367 6529020 5738726 5563959 6997601 6906020 6778559 7592484 7193865 7198439 7815078 7217336 6923856 7127406 7491410 7029097 7757883 6861948 7295746 7245947 9037505 7656431 7322897 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n# NumGC = 52\n# EnableGC = true\n# DebugGC = false\n\n# runtime.MemStats\n# Alloc = 468642296\n# TotalAlloc = 25479911160\n# Sys = 1185490448\n# Lookups = 278984\n# Mallocs = 119997794\n# Frees = 117189156\n# HeapAlloc = 468642296\n# HeapSys = 680919040\n# HeapIdle = 174424064\n# HeapInuse = 506494976\n# HeapReleased = 0\n# HeapObjects = 2808638\n# Stack = 448397312 / 448397312\n# MSpan = 6943104 / 7061504\n# MCache = 9664 / 16384\n# BuckHashSys = 1757422\n# NextGC = 485127068\n# PauseNs = [2096153 2554867 2962532 4711468 3373778 3548443 1764893 1961992 2434108 2658626 2627832 2564733 2610212 3278169 2954882 2847604 4443650 3582780 3557718 4201288 4762243 8349689 3812924 5098353 5196422 4494087 5209715 5978150 5060982 4825367 6529020 5738726 5563959 6997601 6906020 6778559 7592484 7193865 7198439 7815078 7217336 6923856 7127406 7491410 7029097 7757883 6861948 7295746 7245947 9037505 7656431 7322897 7155298 7288230 8027051 7442561 7528532 8418744 7847097 8791562 7242055 8418159 7677703 8662475 8408315 8562446 8110168 7308570 8593523 7820707 8734530 8981041 8721316 8152324 8390552 8603397 9059668 8153933 7986519 7744819 8491656 8562181 7816543 9145512 7902742 7780778 7636659 13573779 12684501 94808535 9443609 8257986 9072718 9634563 9229626 9449536 8644605 8898286 8499036 13101964 8743251 9119720 9267487 8178551 8444107 8362330 8447271 8558115 8788773 9977627 9058283 8743149 8508649 9099904 9382220 9684119 9789404 9730475 8506223 10363233 9979499 9033233 9634088 9739395 9129433 9122154 8615491 9632523 9314836 9845890 9888849 10034358 10207887 10073912 9892683 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n# NumGC = 135\n# EnableGC = true\n# DebugGC = false\n</code></pre>\n\n<p>Add cpu profile .svg file <a href=\"https://docs.google.com/uc?authuser=0&amp;id=0BzYJEkEc-oEtTXZ1UHhDblBqSWM&amp;export=download\" rel=\"nofollow\">attachment</a></p>\n\n<p>Finally, I figure it out that I should add timeout to the http client as follows:</p>\n\n<pre><code>transport :=  http.Transport{\n    Proxy: customProxy,\n    DisableCompression: false,\n    MaxIdleConnsPerHost: 10000,\n    Dial: (&amp;net.Dialer{\n                Timeout:   15 * time.Second,\n                KeepAlive: 15 * time.Second,\n            }).Dial,\n    TLSHandshakeTimeout: 5 * time.Second,\n}\n</code></pre>\n"}, {"tags": ["function", "go"], "comments": [{"owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "edited": false, "score": 3, "creation_date": 1456923057, "post_id": 35747467, "comment_id": 59168647, "body": "What&#39;s the error you&#39;re getting?"}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "edited": false, "score": 0, "creation_date": 1456923390, "post_id": 35747467, "comment_id": 59168866, "body": "Your function <code>GetAllJobs</code> should receive a <code>*gojenkins.Jenkins</code> pointer instead, since that is what is returned by <code>gojenkins.CreateJenkins(url)</code> . You have not declared <code>jobs</code> yet (<code>jobs := actions.GetAllJobs(jenkins)</code>) . And <code>jenkins.GetAllJobNames()</code> doesn&#39;t return a <code>gojenkins.Job</code> value."}, {"owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 0, "creation_date": 1456923825, "post_id": 35747467, "comment_id": 59169164, "body": "Go certainly has objects. An object is nothing more than a combination of state and behaviour, i.e. a value of a type with methods defined on it."}, {"owner": {"reputation": 590, "user_id": 1384890, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c050d31929bf518cf68d4b34aa4a7f3e?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1384890/eric"}, "reply_to_user": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "edited": false, "score": 0, "creation_date": 1456924300, "post_id": 35747467, "comment_id": 59169492, "body": "@cd1 the error I&#39;m getting follows:     pwd ${HOME}/go/src/bitbucket.org/elsammons/senjink/actions [esammons@bender actions]$ go build # bitbucket.org/elsammons/senjink/actions ./search.go:10: syntax error: unexpected gojenkins after top level declaration"}, {"owner": {"reputation": 590, "user_id": 1384890, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c050d31929bf518cf68d4b34aa4a7f3e?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1384890/eric"}, "edited": false, "score": 0, "creation_date": 1456924899, "post_id": 35747467, "comment_id": 59169904, "body": "I have been able to make progress by removing the return values and changing AllJobs(jenkins gojenkins.Jenkins) to GetAllJobs(jenkins *gojenkins.Jenkins).  The last piece is the return piece, I  typoed the declaration of jobs, however, I worry that I still have that wrong because Job related items are defined in gojenkins, <a href=\"https://github.com/bndr/gojenkins/blob/master/job.go\" rel=\"nofollow noreferrer\">github.com/bndr/gojenkins/blob/master/job.go</a>."}, {"owner": {"reputation": 590, "user_id": 1384890, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c050d31929bf518cf68d4b34aa4a7f3e?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1384890/eric"}, "edited": false, "score": 0, "creation_date": 1456925362, "post_id": 35747467, "comment_id": 59170263, "body": "modified search.go, attempting to implement the return <code>func GetAllJobs(jenkins *gojenkins.Jenkins) *gojenkins.Job { return jenkins.GetAllJobs() } </code>  I&#39;m still missing something because I get the following error ./search.go:11: cannot use jenkins.GetAllJobs (type func() ([]*gojenkins.Job, error)) as type *gojenkins.Job in return argument."}], "answers": [{"comments": [{"owner": {"reputation": 590, "user_id": 1384890, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c050d31929bf518cf68d4b34aa4a7f3e?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1384890/eric"}, "edited": false, "score": 0, "creation_date": 1456925712, "post_id": 35748480, "comment_id": 59170539, "body": "I have made some progress, not getting an error, too many arguments to return.  New search.go code, <code>func GetAllJobs(jenkins *gojenkins.Jenkins) (*gojenkins.Job) { \treturn jenkins.GetAllJobs() }</code>"}, {"owner": {"reputation": 590, "user_id": 1384890, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c050d31929bf518cf68d4b34aa4a7f3e?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1384890/eric"}, "edited": false, "score": 0, "creation_date": 1456926097, "post_id": 35748480, "comment_id": 59170836, "body": "The following may help, it is the gojenkins library i&#39;m using,  github.com/bndr/gojenkins/blob/master/job.go"}, {"owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "reply_to_user": {"reputation": 590, "user_id": 1384890, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c050d31929bf518cf68d4b34aa4a7f3e?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1384890/eric"}, "edited": false, "score": 1, "creation_date": 1456927272, "post_id": 35748480, "comment_id": 59171771, "body": "You need to match exactly the object types. The function gojenkins.Jenkins.GetAllJobs() return the type []*gojenkins.Job; your function returns what that function returns; so your function has to return that same type as well, instead of *gojenkins.Job."}, {"owner": {"reputation": 590, "user_id": 1384890, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c050d31929bf518cf68d4b34aa4a7f3e?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1384890/eric"}, "edited": false, "score": 0, "creation_date": 1456933437, "post_id": 35748480, "comment_id": 59176787, "body": "So I got the above working, thank you @cd1.  I have since branched out a bit and am trying to actually do something that isn&#39;t already being done by gojenkins.  <code>jobs, _ := jenkins.GetAllJobNames() j := actions.SearchJobsByName(jobs)</code>  When I&#39;m done I will return []gojenkins.job containing only those Jobs where name matches search.  The issue is in my search.go <code>func SearchJobsByName(jobs []gojenkins.job) []gojenkins.job</code> I get the error cannot refer to unexported name gojenkins.job; however, <a href=\"https://github.com/bndr/gojenkins/blob/master/job.go#L37\" rel=\"nofollow noreferrer\">github.com/bndr/gojenkins/blob/master/job.go#L37</a> so I&#39;m now officially confused."}, {"owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "reply_to_user": {"reputation": 590, "user_id": 1384890, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c050d31929bf518cf68d4b34aa4a7f3e?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1384890/eric"}, "edited": false, "score": 0, "creation_date": 1456934784, "post_id": 35748480, "comment_id": 59177818, "body": "There&#39;s a bad design decision there in returning an unexported type by an exported function..."}], "tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": true, "score": 1, "last_activity_date": 1456924995, "creation_date": 1456924995, "answer_id": 35748480, "question_id": 35747467, "link": "https://stackoverflow.com/questions/35747467/trying-to-pass-a-type-object-created-in-program-1-to-a-function-in-program-2/35748480#35748480", "title": "Trying to pass a type (&quot;object&quot;) created in program 1 to a function in program 2", "body": "<p>For the error you provided,</p>\n\n<pre><code>bitbucket.org/elsammons/senjink/actions ./search.go:10: syntax error: unexpected gojenkins after top level declaration\n</code></pre>\n\n<p>You should fix the syntax of your function's return type. If <code>jobNames</code> is the name of your return variable (which, by the way, isn't a recommended practice..), <a href=\"https://golang.org/ref/spec#Function_types\" rel=\"nofollow\">you should surround both variable name and type with parentheses</a>:</p>\n\n<pre><code>func GetAllJobs(jenkins gojenkins.Jenkins) (jobNames gojenkins.Job) {\n</code></pre>\n\n<p>There seems to be other compile errors in your code (e.g. the return of <code>GetAllJobs</code> doesn't match the return of <code>gojenkins.Jenkins.GetAllJobNames</code>), but this should fix what you're asking for now.</p>\n\n<p>Regarding your question, about passing an object from one program/library to another one, Golang does it just like every language: just pass the object with the exact type that the other side is expecting and you should be fine.</p>\n"}], "owner": {"reputation": 590, "user_id": 1384890, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c050d31929bf518cf68d4b34aa4a7f3e?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1384890/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2715, "favorite_count": 0, "accepted_answer_id": 35748480, "answer_count": 1, "score": 0, "last_activity_date": 1456924995, "creation_date": 1456922272, "question_id": 35747467, "link": "https://stackoverflow.com/questions/35747467/trying-to-pass-a-type-object-created-in-program-1-to-a-function-in-program-2", "title": "Trying to pass a type (&quot;object&quot;) created in program 1 to a function in program 2", "body": "<p>I have spent quite some time with python and am now trying to learn golang.  I'm trying to do something in golang that I do often with python; essentially create an object in one program but then pass that object to a method (or function) in another.</p>\n\n<p>I know golang doesn't have objects, but I'm also of the opinion that I should not have to define a type that has already been defined.  My sample code follows:</p>\n\n<p>program 1:</p>\n\n<pre><code>import (\n    \"github.com/bndr/gojenkins\"\n    \"bitbucket.org/elsammons/senjink/actions\"\n)\n\nfunc main () {\n\n    jenkins := gojenkins.CreateJenkins(url)\n    _, err := jenkins.Init()\n\n    if err != nil {\n        panic(err)\n    }\n\n    jobs = actions.GetAllJobs(jenkins)\n}\n</code></pre>\n\n<p>Program 2:</p>\n\n<pre><code>package actions\n\nimport (\n    \"github.com/bndr/gojenkins\"\n)\n\n//type Jenkins gojenkins.Jenkins\n//type Jobs gojenkins.Job\n\nfunc GetAllJobs(jenkins gojenkins.Jenkins) jobNames gojenkins.Job {\n    return jenkins.GetAllJobNames()\n}\n</code></pre>\n\n<p>I have tried other approaches as well, just as defining the type as commented out and using (jenkins *Jenkins) etc...  However I continue to get errors so I'm obviously missing something.</p>\n\n<p>Appreciate any instruction here that might help me on my journey.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "is_accepted": true, "score": 3, "last_activity_date": 1456923528, "creation_date": 1456923528, "answer_id": 35747922, "question_id": 35746895, "link": "https://stackoverflow.com/questions/35746895/best-practice-to-partially-implement-an-interface/35747922#35747922", "title": "Best practice to partially implement an interface", "body": "<p>In my opinion what you're trying to do isn't very Go-like.</p>\n\n<p><code>ToggleSwitch</code> defines four methods that clearly work on some state. In order to provide an implementation for <em>any</em> of these methods, you also need to implement that state (even if that state's non-existent, e.g. by defining those methods as no-ops), but at that point, it simply doesn't make sense not to provide <em>all</em> those methods.</p>\n\n<p>With Go-like type composition the embedded types should generally be \"whole\", complete and useful on their own. Methods provided by the embedded type only work on that field alone, there's no way to get to the \"parent\" or its methods. </p>\n\n<p>If <code>ToggleSwitch</code> also had other methods that didn't deal with that state, then it'd make sense to provide only a partial implementation of the interface, but at that point an even better and much more idiomatic solution would be to define <code>ToggleSwitch</code> as a combination of two separate interfaces.</p>\n\n<p>In other words, I don't think there's a \"Go way\" to provide a partial implementation of an interface (that's not composed of several interfaces), because it's idiomatic in Go to define interfaces that are as small as possible.</p>\n"}, {"comments": [{"owner": {"reputation": 1636, "user_id": 636849, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/2XgPY.jpg?s=128&g=1", "display_name": "Lucas Cimon", "link": "https://stackoverflow.com/users/636849/lucas-cimon"}, "edited": false, "score": 0, "creation_date": 1556870033, "post_id": 35749848, "comment_id": 98581740, "body": "The issue with this solution is that it is impossible to store a <code>DummyDriver</code> in a variable of type <code>ToggleSwitch</code> : <code>var d ToggleSwitch; d = DummyDriver{state: false}</code>"}, {"owner": {"reputation": 128, "user_id": 4012426, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000105441681/picture?type=large", "display_name": "Hutch Moore", "link": "https://stackoverflow.com/users/4012426/hutch-moore"}, "edited": false, "score": 0, "creation_date": 1572447960, "post_id": 35749848, "comment_id": 103564076, "body": "This is also wrong because DummyDriver&#39;s state field isn&#39;t used. The underlying DefaultDriver works with it&#39;s own state, not DummyDriver&#39;s. Proof: <a href=\"https://play.golang.org/p/NxyuG0zLNB9\" rel=\"nofollow noreferrer\">play.golang.org/p/NxyuG0zLNB9</a>"}], "tags": [], "owner": {"reputation": 21, "user_id": 6008206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce61fe149fb25640937d4b50914b353c?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/6008206/david"}, "is_accepted": false, "score": 2, "last_activity_date": 1456928599, "creation_date": 1456928599, "answer_id": 35749848, "question_id": 35746895, "link": "https://stackoverflow.com/questions/35746895/best-practice-to-partially-implement-an-interface/35749848#35749848", "title": "Best practice to partially implement an interface", "body": "<p>Personnally, I would implement the Toggle, IsOn, TurnOn and TurnOff methods for the DefaultDriver type, so it would satisfy the ToggleSwitch interface.</p>\n\n<p>Then, the DummyDriver type would embed the DefaultDriver type.</p>\n\n<p>This way, you could implement the specialized methods for the DummyDriver type, as you desire.</p>\n\n<p>The result would be something along these lines:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype ToggleSwitch interface {\n    TurnOn()\n    TurnOff()\n    IsOn() bool\n    Toggle()\n}\n\ntype DefaultDriver struct {\n    state bool\n}\n\nfunc (d *DefaultDriver) Toggle() {\n    state := d.IsOn()\n    fmt.Println(\"generic toogle -&gt;\", state)\n    if state {\n        d.TurnOff()\n    } else {\n        d.TurnOn()\n    }\n}\n\nfunc (d *DefaultDriver) IsOn() bool {\n    return d.state\n}\n\nfunc (d *DefaultDriver) TurnOff() {\n    d.state = false\n}\n\nfunc (d *DefaultDriver) TurnOn() {\n    d.state = true\n}\n\ntype DummyDriver struct {\n    DefaultDriver\n    state bool\n}\n\n// Uncomment me to optimize me...\n//func (d *DummyDriver) Toggle() {\n//  fmt.Println(\"specialized toogle -&gt;\", d.state)\n//  d.state = !d.state\n//}\n\nfunc main() {\n    d := DummyDriver{state: false}\n    d.Toggle()\n    d.Toggle()\n    d.Toggle()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Xm-8A0xoRb\" rel=\"nofollow\">https://play.golang.org/p/Xm-8A0xoRb</a></p>\n"}], "owner": {"reputation": 4827, "user_id": 303726, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/5c9c83c99715bf38dd62c7ae20da3dd7?s=128&d=identicon&r=PG", "display_name": "Julio Guerra", "link": "https://stackoverflow.com/users/303726/julio-guerra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5994, "favorite_count": 0, "accepted_answer_id": 35747922, "answer_count": 2, "score": 6, "last_activity_date": 1456928599, "creation_date": 1456920713, "question_id": 35746895, "link": "https://stackoverflow.com/questions/35746895/best-practice-to-partially-implement-an-interface", "title": "Best practice to partially implement an interface", "body": "<p>What would be the go-way of <strong>partly</strong> providing a default implementation?</p>\n\n<p>To illustrate, the following simple example of a toggle switch driver is the dead-end I ended with by following my OO intuition... Of course it does not compile (I know why) and I am not necessarily willing to do so. <strong>Any other solution</strong> better fitting into the go philosophy would be in fact even better to correctly understand the go-way for this common need.</p>\n\n<hr>\n\n<p>The complete example can also be found at <a href=\"https://play.golang.org/p/MYED1PB-dS\" rel=\"noreferrer\">https://play.golang.org/p/MYED1PB-dS</a></p>\n\n<p>Given the following interface:</p>\n\n<pre><code>type ToggleSwitch interface {\n    TurnOn()\n    TurnOff()\n    IsOn() bool\n    Toggle()\n}\n</code></pre>\n\n<p><code>Toggle()</code> is a good candidate to be provided a default implementation (ie, according to the current state, turn on or off the switch):</p>\n\n<pre><code>// The Toggle() method can already be defined using TurnOn, TurnOff() and IsOn().\ntype DefaultDriver struct {\n}\n\n// The following implementation would be fine for non-optimized cases:\nfunc (d *DefaultDriver) Toggle() {\n    state := d.IsOn()\n    fmt.Println(\"generic toogle -&gt;\", state)\n    if state {\n        d.TurnOff()\n    } else {\n        d.TurnOn()\n    }\n}\n</code></pre>\n\n<p>And then an actual driver could use it or not:</p>\n\n<pre><code>// Example of an actual ToggleDriver which should fully implement the interface\n// based on the default implementation or not.\n// For example, if the toggle switch device has a bult-in toggle command, the\n// Toggle() method could be optimized to directly use it.\ntype DummyDriver struct {\n    *DefaultDriver // promote DefaultDriver methods\n    state bool\n}\n\nfunc (d *DummyDriver) IsOn() bool {\n    return d.state\n}\n\nfunc (d *DummyDriver) TurnOff() {\n    d.state = false\n}\n\nfunc (d *DummyDriver) TurnOn() {\n    d.state = false\n}\n\n// Uncomment me to optimize me...\n//func (d *DummyDriver) Toggle() {\n//  fmt.Println(\"specialized toogle -&gt;\", d.state)\n//  d.state = !d.state\n//}\n</code></pre>\n"}, {"tags": ["file", "go", "directory", "equivalent", "dirname"], "answers": [{"comments": [{"owner": {"reputation": 42205, "user_id": 130638, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/9400cb5aeb155ccec614652542fd274d?s=128&d=identicon&r=PG", "display_name": "balupton", "link": "https://stackoverflow.com/users/130638/balupton"}, "edited": false, "score": 1, "creation_date": 1558450409, "post_id": 35742238, "comment_id": 99100806, "body": "Isn&#39;t that more <code>process.cwd()</code> rather than <code>__dirname</code>. <code>__dirname</code> is the directory of the source file, whereas a working directory as the docs indicate for <code>os.Getwd</code> is the user&#39;s current working directory (what is executing the program)"}, {"owner": {"reputation": 36339, "user_id": 30946, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/350f30695a2ab75b99d3fce947e856b9?s=128&d=identicon&r=PG", "display_name": "jcollum", "link": "https://stackoverflow.com/users/30946/jcollum"}, "edited": false, "score": 0, "creation_date": 1592946013, "post_id": 35742238, "comment_id": 110606164, "body": "I agree, in practice <code>.Getwd</code> and <code>__dirname__</code> are not the same."}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": true, "score": 10, "last_activity_date": 1456908259, "creation_date": 1456908259, "answer_id": 35742238, "question_id": 35741934, "link": "https://stackoverflow.com/questions/35741934/dirname-equivalent-in-go/35742238#35742238", "title": "dirname equivalent in Go", "body": "<p>In Go you can use <a href=\"https://golang.org/pkg/os/#Getwd\"><code>os.Getwd</code></a> which returns a rooted path name corresponding to the current directory.</p>\n\n<pre><code>dir, err := os.Getwd()\nif err != nil {\n    fmt.Errorf(\"Dir %v does not exists\", err)\n}\n</code></pre>\n"}], "owner": {"reputation": 2495, "user_id": 4760425, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/1415935128722296/picture?type=large", "display_name": "necroface", "link": "https://stackoverflow.com/users/4760425/necroface"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 681, "favorite_count": 1, "accepted_answer_id": 35742238, "answer_count": 1, "score": 0, "last_activity_date": 1459895531, "creation_date": 1456907278, "last_edit_date": 1459895531, "question_id": 35741934, "link": "https://stackoverflow.com/questions/35741934/dirname-equivalent-in-go", "title": "dirname equivalent in Go", "body": "<p>I'm studying Go, I don't know if I missed something, but after searching, I wonder: Does dirname in NodeJS have an equivalent in Go? How to get current directory in Go code, or I have to implement one?</p>\n"}, {"tags": ["c++", "go", "protocol-buffers", "grpc"], "comments": [{"owner": {"reputation": 18300, "user_id": 212870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51619fe88436dc413b2c6e9498835646?s=128&d=identicon&r=PG", "display_name": "Alan Stokes", "link": "https://stackoverflow.com/users/212870/alan-stokes"}, "edited": false, "score": 0, "creation_date": 1456903765, "post_id": 35740720, "comment_id": 59155435, "body": "Do you have <code>grpc_cpp_plugin</code>? Is it executable?"}, {"owner": {"reputation": 1703, "user_id": 1336962, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7e5a1b6c0b2cbec48a5768822ec57493?s=128&d=identicon&r=PG", "display_name": "Nitesh", "link": "https://stackoverflow.com/users/1336962/nitesh"}, "reply_to_user": {"reputation": 18300, "user_id": 212870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51619fe88436dc413b2c6e9498835646?s=128&d=identicon&r=PG", "display_name": "Alan Stokes", "link": "https://stackoverflow.com/users/212870/alan-stokes"}, "edited": false, "score": 0, "creation_date": 1456904303, "post_id": 35740720, "comment_id": 59155709, "body": "I installed protoc 3.0.0 and then followed the way it was saying to run MAKE. But seems like it has not created cpp_plugin."}], "answers": [{"tags": [], "owner": {"reputation": 327, "user_id": 5986090, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bPdMk.jpg?s=128&g=1", "display_name": "Peter Silon", "link": "https://stackoverflow.com/users/5986090/peter-silon"}, "is_accepted": true, "score": 2, "last_activity_date": 1456908609, "creation_date": 1456908609, "answer_id": 35742352, "question_id": 35740720, "link": "https://stackoverflow.com/questions/35740720/unable-to-generate-client-code-using-proto-3-0-buffer-in-grpc/35742352#35742352", "title": "Unable to generate client code using proto 3.0 buffer in gRPC", "body": "<p>Check your <code>/usr/local/bin</code>. It should be there along with plugins for other languages.</p>\n\n<p><code>/usr/local/bin &gt; ll\ntotal 71144\n-rwxr-xr-x  1 root root 12721867 Oct 23 10:44 grpc_cpp_plugin*\n-rwxr-xr-x  1 root root 14509678 Oct 23 10:44 grpc_csharp_plugin*\n-rwxr-xr-x  1 root root 13339870 Oct 23 10:44 grpc_objective_c_plugin*\n-rwxr-xr-x  1 root root 12569518 Oct 23 10:44 grpc_python_plugin*\n-rwxr-xr-x  1 root root 12393363 Oct 23 10:44 grpc_ruby_plugin*</code></p>\n\n<p>If you do have other plugins but not cpp you probably overlooked something while installing.</p>\n\n<p>If it's there try to specify full path when compiling (i.e. <code>--plugin=protoc-gen-grpc=/usr/local/bin/grpc_cpp_plugin</code>)</p>\n\n<p>If you have multiple version of protobuf check if you use protoc and plugin from the same one.</p>\n"}], "owner": {"reputation": 1703, "user_id": 1336962, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7e5a1b6c0b2cbec48a5768822ec57493?s=128&d=identicon&r=PG", "display_name": "Nitesh", "link": "https://stackoverflow.com/users/1336962/nitesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3178, "favorite_count": 0, "accepted_answer_id": 35742352, "answer_count": 1, "score": 2, "last_activity_date": 1456908609, "creation_date": 1456902811, "last_edit_date": 1456903714, "question_id": 35740720, "link": "https://stackoverflow.com/questions/35740720/unable-to-generate-client-code-using-proto-3-0-buffer-in-grpc", "title": "Unable to generate client code using proto 3.0 buffer in gRPC", "body": "<p>I am trying to generate client and server code in gRPC. I have installed grpc directory from github and trying to generate <code>C++</code> code. I installed proto compiler 3.0.0. </p>\n\n<p>When I am executing protoc i am getting below error</p>\n\n<pre><code>$ protoc -I ../../protos/ --grpc_out=. --plugin=protoc-gen-grpc=grpc_cpp_plugin                                                                                                                                                  ../../protos/helloworld.proto\ngrpc_cpp_plugin: program not found or is not executable\n--grpc_out: protoc-gen-grpc: Plugin failed with status code 1.\n</code></pre>\n\n<p>Any idea why I am not able to generate client/server code</p>\n"}, {"tags": ["go", "openshift-origin", "godeps"], "comments": [{"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 0, "creation_date": 1456902161, "post_id": 35738489, "comment_id": 59154715, "body": "Just guessing here, but: Try a <code>godep restore</code> with the <code>github.com&#47;openshift&#47;origin</code> package, which should install the packaged Kubernetes to your <code>GOPATH</code>. Then a <code>godep save</code> in your package."}, {"owner": {"reputation": 1798, "user_id": 4391298, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh3.googleusercontent.com/-HnoLQXIa8Io/AAAAAAAAAAI/AAAAAAAAAIY/Iqji42x6zyc/photo.jpg?sz=128", "display_name": "Danielle Madeley", "link": "https://stackoverflow.com/users/4391298/danielle-madeley"}, "reply_to_user": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 0, "creation_date": 1456911715, "post_id": 35738489, "comment_id": 59160387, "body": "I discovered for the moment I can <code>export GOPATH=$GOPATH:${godep path}</code> which is letting me get the job done."}], "owner": {"reputation": 1798, "user_id": 4391298, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh3.googleusercontent.com/-HnoLQXIa8Io/AAAAAAAAAAI/AAAAAAAAAIY/Iqji42x6zyc/photo.jpg?sz=128", "display_name": "Danielle Madeley", "link": "https://stackoverflow.com/users/4391298/danielle-madeley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1456892748, "creation_date": 1456892748, "question_id": 35738489, "link": "https://stackoverflow.com/questions/35738489/writing-an-openshift-extension", "title": "Writing an openshift extension", "body": "<p>Trying to understand how one builds a tool consuming the Openshift Origin and Kubernetes APIs (I'm new to Go). It seems that I have a version of Kubernetes installed from Openshift and another version installed by <code>godep</code> and I'm getting all sorts of exciting version mismatches.</p>\n\n<p>Here's my code so far:</p>\n\n<pre><code>package main\n\nimport (\n    kclient \"k8s.io/kubernetes/pkg/client/unversioned\"\n    client \"github.com/openshift/origin/pkg/client\"\n)\n\nfunc main() {\n    config := kclient.Config{\n        Host: \"...\",\n    }\n\n    client.SetOpenShiftDefaults(&amp;config)\n    client := client.NewOrDie(&amp;config)\n}\n</code></pre>\n\n<p>I then did a <code>go get github.com/openshift/origin</code> which I can see has a copy of Kubernetes in it's <code>Godeps/_workspace/src</code> directory.</p>\n\n<p>However when I do a <code>godep save</code> I get:</p>\n\n<pre><code>godep: Package (k8s.io/kubernetes/pkg/client/unversioned) not found\n</code></pre>\n\n<p>If I do a <code>go get</code> to install Kubernetes I get a version that doesn't match with the version used by Openshift. What's the correct way to do this?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 1, "creation_date": 1456891044, "post_id": 35738111, "comment_id": 59150397, "body": "Your <code>json</code> doesn&#39;t appear to be valid, <code>Unmarshal</code> returns an err, so throw an <code>err := </code> in front of that <code>Unmarshal</code> and I&#39;m sure you&#39;ll be able to debug it yourself, but for now I don&#39;t really understand your question, you&#39;re using a <code>float</code> in place of an <code>int32</code> and your <code>json</code> doesn&#39;t appear to be valid."}, {"owner": {"reputation": 83, "user_id": 5865819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9eadb4643b08dcf737a316f0f63f6f35?s=128&d=identicon&r=PG&f=1", "display_name": "windy_zhh", "link": "https://stackoverflow.com/users/5865819/windy-zhh"}, "reply_to_user": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1456891957, "post_id": 35738111, "comment_id": 59150666, "body": "THANK YOU. I modified my code, it can compile and run now."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1456891680, "creation_date": 1456891680, "answer_id": 35738330, "question_id": 35738111, "link": "https://stackoverflow.com/questions/35738111/how-to-set-default-value-to-map-value-when-doing-json-unmarshal-in-golang/35738330#35738330", "title": "How to set default value to map value when doing json Unmarshal in golang?", "body": "<p>Write an unmarshal function to set the default values:</p>\n\n<pre><code>func (o *operation) UnmarshalJSON(b []byte) error {\n    type xoperation operation\n    xo := &amp;xoperation{Width: 500, Height: 500}\n    if err := json.Unmarshal(b, xo); err != nil {\n        return err\n    }\n    *o = operation(*xo)\n    return nil\n}\n</code></pre>\n\n<p>I created a <a href=\"http://play.golang.org/p/L232knrhi2\" rel=\"nofollow\">playground example</a> with modifications to the JSON to make it runnable.</p>\n"}], "owner": {"reputation": 83, "user_id": 5865819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9eadb4643b08dcf737a316f0f63f6f35?s=128&d=identicon&r=PG&f=1", "display_name": "windy_zhh", "link": "https://stackoverflow.com/users/5865819/windy-zhh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3415, "favorite_count": 0, "accepted_answer_id": 35738330, "answer_count": 1, "score": 3, "last_activity_date": 1456891893, "creation_date": 1456890272, "last_edit_date": 1456891893, "question_id": 35738111, "link": "https://stackoverflow.com/questions/35738111/how-to-set-default-value-to-map-value-when-doing-json-unmarshal-in-golang", "title": "How to set default value to map value when doing json Unmarshal in golang?", "body": "<p>I have a struct like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype request struct {\n    Version    string               `json:\"version\"`\n    Operations map[string]operation `json:\"operations\"`\n}\ntype operation struct {\n    Type   string `json:\"type\"`\n    Width  int    `json:\"width\"`\n    Height int    `json:\"height\"`\n}\n\nfunc main() {\n    jsonStr := \"{\\\"version\\\": \\\"1.0\\\", \\\"operations\\\": {\\\"0\\\": {\\\"type\\\": \\\"type1\\\", \\\"width\\\": 100}, \\\"1\\\": {\\\"type\\\": \\\"type2\\\", \\\"height\\\": 200}}}\"\n    req := request{\n         Version: \"1.0\",\n    }\n    err := json.Unmarshal([]byte(jsonStr), &amp;req)\n    if err != nil {\n        fmt.Println(err.Error())\n    } else {\n        fmt.Println(req)\n    }\n}\n</code></pre>\n\n<p>I can set Version = \"1.0\" as its default value, but how can I set default value to Width and Height?</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1456890585, "post_id": 35737796, "comment_id": 59150274, "body": "Send the process a SIGQUIT to find out where the goroutines are waiting. I don&#39;t see any code that receives from the channel.  Are the groutines stuck at the end of <code>fetch</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": true, "score": 4, "last_activity_date": 1456891468, "creation_date": 1456891468, "answer_id": 35738300, "question_id": 35737796, "link": "https://stackoverflow.com/questions/35737796/golang-how-to-close-the-channel-after-all-goroutines-are-finished/35738300#35738300", "title": "golang: how to close the channel after all goroutines are finished?", "body": "<p>To me it doesn't look like you're reading from your channel, and because it is a synchronous channel (you never declared a length on it) it will block if it receives a value. So you need to be reading from your <code>c</code> by <code>value &lt;- c</code> or your fetch function will just hang at <code>c &lt;- *e</code></p>\n\n<p>This is causing your <code>sync.WaitGroup</code> to never <code>wg.Done()</code> which never decrements the counter, which never causes the <code>wg.Wait()</code> to stop blocking, which causes your <code>close(c)</code> to never get called</p>\n"}, {"tags": [], "owner": {"reputation": 2576, "user_id": 631612, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b7d2a769fa193f9efa36668148deb9f5?s=128&d=identicon&r=PG", "display_name": "quanta", "link": "https://stackoverflow.com/users/631612/quanta"}, "is_accepted": false, "score": 0, "last_activity_date": 1456899050, "creation_date": 1456899050, "answer_id": 35739772, "question_id": 35737796, "link": "https://stackoverflow.com/questions/35737796/golang-how-to-close-the-channel-after-all-goroutines-are-finished/35739772#35739772", "title": "golang: how to close the channel after all goroutines are finished?", "body": "<p>My original code is something like this:</p>\n\n<pre><code>e_hrefs := findHrefs(u)\nw := csv.NewWriter(file)\nfor e_href, name := range e_hrefs {\n    wg.Add(1)\n    go fetch(parsedUrl.Scheme+\"://\"+parsedUrl.Host+e_href, name, &amp;wg, c)\n    e := &lt;-c\n    w.Write([]string{name, \"'\" + e.tax_code, e.group, e.capital})\n    w.Flush()\n}\nwg.Wait()\n</code></pre>\n\n<p>and you can see, it's not concurrency.</p>\n\n<p>I've just fixed by using the <a href=\"https://github.com/golang/go/wiki/Range\" rel=\"nofollow\">range</a> clause to iterate over channel:</p>\n\n<pre><code>e_hrefs := findHrefs(u)\nfor e_href, name := range e_hrefs {\n    wg.Add(1)\n    go fetch(parsedUrl.Scheme+\"://\"+parsedUrl.Host+e_href, name, &amp;wg, c)\n}\ngo func() {\n    wg.Wait()\n    close(c)\n}()\n\nw := csv.NewWriter(file)\nfor e := range c {\n    w.Write([]string{e.name, \"'\" + e.tax_code, e.group, e.capital})\n    w.Flush()\n}\n</code></pre>\n"}], "owner": {"reputation": 2576, "user_id": 631612, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b7d2a769fa193f9efa36668148deb9f5?s=128&d=identicon&r=PG", "display_name": "quanta", "link": "https://stackoverflow.com/users/631612/quanta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1472, "favorite_count": 0, "accepted_answer_id": 35738300, "answer_count": 2, "score": 1, "last_activity_date": 1456899050, "creation_date": 1456888325, "question_id": 35737796, "link": "https://stackoverflow.com/questions/35737796/golang-how-to-close-the-channel-after-all-goroutines-are-finished", "title": "golang: how to close the channel after all goroutines are finished?", "body": "<p>I would like to write a simple web scraper in Go by:</p>\n\n<ul>\n<li>get all href with a pattern from an URL</li>\n<li>extract some specific fields</li>\n<li>and write to a CSV file</li>\n</ul>\n\n<p>Here's my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"flag\"\n    \"fmt\"\n    \"github.com/PuerkitoBio/goquery\"\n    \"log\"\n    \"net/http\"\n    \"net/url\"\n    \"os\"\n    \"strings\"\n    \"sync\"\n)\n\ntype Enterprise struct {\n    name     string\n    tax_code string\n    group    string\n    capital  string\n}\n\nvar u, f string\nvar name, tax_code, group, capital string\n\nfunc init() {\n    flag.StringVar(&amp;u, \"u\", \"\", \"Which URL to download from\")\n    flag.StringVar(&amp;f, \"f\", \"\", \"Path to the csv file to write the output to\")\n}\n\nfunc check(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\n\nfunc findHrefs(u string) map[string]string {\n    resp, err := http.Get(u)\n    check(err)\n\n    doc, err := goquery.NewDocumentFromResponse(resp)\n    check(err)\n\n    e_hrefs := make(map[string]string)\n    doc.Find(\"td div a\").Each(func(_ int, s *goquery.Selection) {\n        e_href, _ := s.Attr(\"href\")\n        if strings.HasPrefix(e_href, \"/Thong-tin-doanh-nghiep\") &amp;&amp; s.Text() != \"\" {\n            e_hrefs[e_href] = s.Text()\n        }\n    })\n    return e_hrefs\n}\n\nfunc fetch(url string, name string, file *os.File, wg *sync.WaitGroup, c chan Enterprise) {\n    defer wg.Done()\n\n    log.Println(\"Fetching URL\", url)\n    resp, err := http.Get(url)\n    check(err)\n\n    doc, err := goquery.NewDocumentFromResponse(resp)\n    check(err)\n    e := new(Enterprise)\n    doc.Find(\"td\").Each(func(_ int, s *goquery.Selection) {\n        if s.Text() == \"M\u00e3 s\u1ed1 thu\u1ebf:\" {\n            e.tax_code = s.Next().Text()\n        }\n        if s.Text() == \"T\u00ean ng\u00e0nh c\u1ea5p 2:\" {\n            e.group = s.Next().Text()\n        }\n        if s.Text() == \"S\u1edf h\u1eefu v\u1ed1n:\" {\n            e.capital = s.Next().Text()\n        }\n    })\n    w := csv.NewWriter(file)\n    w.Write([]string{name, \"'\" + e.tax_code, e.group, e.capital})\n    w.Flush()\n    c &lt;- *e\n}\n\nfunc getDoc(u, f string) {\n    parsedUrl, err := url.Parse(u)\n    check(err)\n\n    file, err := os.Create(f)\n    check(err)\n    defer file.Close()\n\n    var wg sync.WaitGroup\n    c := make(chan Enterprise)\n\n    e_hrefs := findHrefs(u)\n    for e_href, name := range e_hrefs {\n        wg.Add(1)\n        go fetch(parsedUrl.Scheme+\"://\"+parsedUrl.Host+e_href, name, file, &amp;wg, c)\n    }\n    wg.Wait()\n}\n\nfunc main() {\n    flag.Parse()\n    if u == \"\" || f == \"\" {\n        fmt.Println(\"-u=&lt;URL to download from&gt; -f=&lt;Path to the CSV file&gt;\")\n        os.Exit(1)\n    }\n    getDoc(u, f)\n}\n</code></pre>\n\n<p>The problem is channel was not closed after all goroutines are finished and I have to press <kbd>control</kbd>+<kbd>C</kbd> to get my shell prompt back:</p>\n\n<pre><code>2016/03/02 09:34:05 Fetching URL ...\n2016/03/02 09:34:05 Fetching URL ...\n2016/03/02 09:34:05 Fetching URL ...\n^Csignal: interrupt\n</code></pre>\n\n<p>By reading <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow\">this</a>, I change the last line in <code>getDoc</code> func to something like:</p>\n\n<pre><code>go func() {\n    wg.Wait()\n    close(c)\n}()\n</code></pre>\n\n<p>Now I can get my shell prompt back when running but the channel was closed before all goroutines are finished and nothing write to CSV file.</p>\n\n<p>Where did I go wrong?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 146934, "user_id": 166339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d1152398d84f15b76eb25f13e825cda?s=128&d=identicon&r=PG", "display_name": "Asaph", "link": "https://stackoverflow.com/users/166339/asaph"}, "edited": false, "score": 2, "creation_date": 1456880590, "post_id": 35736368, "comment_id": 59147454, "body": "Apparently Go&#39;s flavor of regex doesn&#39;t support <a href=\"http://www.regular-expressions.info/backref.html\" rel=\"nofollow noreferrer\">backreferences</a> which would normally be the way to solve this problem."}], "answers": [{"tags": [], "owner": {"reputation": 7290, "user_id": 4785110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1bae5c00f27770d807c943268438bb6?s=128&d=identicon&r=PG&f=1", "display_name": "maraca", "link": "https://stackoverflow.com/users/4785110/maraca"}, "is_accepted": false, "score": 3, "last_activity_date": 1456880617, "creation_date": 1456880617, "answer_id": 35736603, "question_id": 35736368, "link": "https://stackoverflow.com/questions/35736368/regex-to-match-repeated-characters/35736603#35736603", "title": "Regex to match repeated characters", "body": "<p>Here is the ugly solution, you could automatically generate it:</p>\n\n<pre><code>A{3,}|B{3,}|...|Z{3,}|a{3,}|b{3,}|...|z{3,}|0{3,}|1{3,}|...|9{3,}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "is_accepted": true, "score": 8, "last_activity_date": 1456880705, "creation_date": 1456880705, "answer_id": 35736619, "question_id": 35736368, "link": "https://stackoverflow.com/questions/35736368/regex-to-match-repeated-characters/35736619#35736619", "title": "Regex to match repeated characters", "body": "<p>What you're asking for cannot be done with <em>true</em> regular expressions, what you need are (irregular) backreferences. While many regexp engines implement them, RE2 used by Go does not. RE2 is a fast regexp engine that guarantees linear time string processing, but there's no known way to implement backreferences with such efficiency. (See <a href=\"https://swtch.com/~rsc/regexp/\" rel=\"noreferrer\">https://swtch.com/~rsc/regexp/</a> for further information.)</p>\n\n<p>To solve your problem you may want to search for some other regexp library. I believe bindings for PCRE can be found, but I've no personal experience from them.</p>\n\n<p>Another approach would be to parse the string manually without using (ir)regular expressions.</p>\n"}, {"tags": [], "owner": {"reputation": 2349, "user_id": 653331, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8a4bf914078e4f4732891156dd917d69?s=128&d=identicon&r=PG&f=1", "display_name": "p_mcp", "link": "https://stackoverflow.com/users/653331/p-mcp"}, "is_accepted": false, "score": 3, "last_activity_date": 1456881636, "creation_date": 1456881636, "answer_id": 35736747, "question_id": 35736368, "link": "https://stackoverflow.com/questions/35736368/regex-to-match-repeated-characters/35736747#35736747", "title": "Regex to match repeated characters", "body": "<p>Due to the problems stated, I eventually settled on the following non-regex solution:</p>\n\n<pre><code>norm = \"this it a ttttt\"\nrepeatCount := 1\nthresh := 3\nlastChar := \"\"\nfor _, r := range norm {\n    c := string(r)\n    if c == lastChar {\n        repeatCount++\n        if repeatCount == thresh {\n            break\n        }\n    } else {\n        repeatCount = 1\n    }\n    lastChar = c\n}\n</code></pre>\n"}], "owner": {"reputation": 2349, "user_id": 653331, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8a4bf914078e4f4732891156dd917d69?s=128&d=identicon&r=PG&f=1", "display_name": "p_mcp", "link": "https://stackoverflow.com/users/653331/p-mcp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1732, "favorite_count": 0, "accepted_answer_id": 35736619, "answer_count": 3, "score": 6, "last_activity_date": 1456881636, "creation_date": 1456879048, "last_edit_date": 1456880493, "question_id": 35736368, "link": "https://stackoverflow.com/questions/35736368/regex-to-match-repeated-characters", "title": "Regex to match repeated characters", "body": "<p>I am trying to create a regex that matches a string if it has a 3 or more repetitive characters in a row (e.g. aaaaaa, testtttttt, otttttter). </p>\n\n<p>I have tried the following:</p>\n\n<pre><code>regexp.Compile(\"[A-Za-z0-9]{3,}\")\nregexp.Compile(\"(.){3,}\")\nregexp.Compile(\"(.)\\\\1{3,}\")\n</code></pre>\n\n<p>which matches <em>any</em> 3 characters in a row, but not <em>consecutive</em> characters... Where am I going wrong?</p>\n"}, {"tags": ["go", "dsl", "shadowing"], "comments": [{"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "edited": false, "score": 0, "creation_date": 1456870163, "post_id": 35734475, "comment_id": 59143547, "body": "Depending on how secure this needs to be (e.g., are you executing arbitrary code in a way that needs to not escape a sandbox or something?), you might want to consider blacklisting certain packages."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1456872285, "post_id": 35734475, "comment_id": 59144524, "body": "Yes: Don&#39;t export BFunc."}], "answers": [{"tags": [], "owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "is_accepted": false, "score": 2, "last_activity_date": 1456872461, "creation_date": 1456872461, "answer_id": 35735157, "question_id": 35734475, "link": "https://stackoverflow.com/questions/35734475/shadowing-a-global-function/35735157#35735157", "title": "Shadowing a global function", "body": "<p>If you don't want users of a library to use a function, then don't export that function.</p>\n\n<p>Shadowing identifiers defined in another package is impossible. Shadowing named functions is impossible even in the same package.</p>\n"}], "owner": {"reputation": 16400, "user_id": 350542, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/024d1da9fad214ca44af8fcc649ebb86?s=128&d=identicon&r=PG", "display_name": "jayunit100", "link": "https://stackoverflow.com/users/350542/jayunit100"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1456872461, "creation_date": 1456869749, "last_edit_date": 1456870290, "question_id": 35734475, "link": "https://stackoverflow.com/questions/35734475/shadowing-a-global-function", "title": "Shadowing a global function", "body": "<p>Is there a way to shadow a function at global scope in a golang package?  In some go file, I DONT want users to be able to call BFunc... That is, I want to wrap it...</p>\n\n<pre><code>// Lets say this package provides BFunc() \n// And I have a naughty user who wants to import it\n. \"github.com/a/bfunc\"\n</code></pre>\n\n<p>So, In another go file at global scope, I might do:</p>\n\n<pre><code>func BFunc() { fmt.Print(\"haha I tricked you\") }\n</code></pre>\n\n<p>When I try this, I get an error that there is a previous declaration of the same function, referring specifically to the <code>.</code> import.</p>\n\n<p>Would there be a syntactical hack I can do to prevent users from globally importing the bfunc.BFunc() method into their code?</p>\n\n<p><em>UPDATE</em></p>\n\n<p>This can be described using a simpler snippet.</p>\n\n<pre><code>package main\nimport . \"fmt\"\nfunc Print(t string) { \n   Print(\"ASDF\")\n}\nfunc main() {\n    Print(\"ASDF\")\n}\n</code></pre>\n\n<p>Which doesn't work, because Print is redeclared.  If there is a way to hack around this so that Print can be redeclared, then that would answer my original question effectively. </p>\n"}, {"tags": ["go", "interface", "faye"], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 5323316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79aaf598fc82d558b868736966ea03b?s=128&d=identicon&r=PG&f=1", "display_name": "komatsu", "link": "https://stackoverflow.com/users/5323316/komatsu"}, "edited": false, "score": 0, "creation_date": 1456869947, "post_id": 35733492, "comment_id": 59143441, "body": "Sorry I should have mentioned that I tried that too, but it complains that <code>func(Message) != func(wray.Message)</code>... updated the question."}], "tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": false, "score": 4, "last_activity_date": 1456921341, "last_edit_date": 1456921341, "creation_date": 1456866355, "answer_id": 35733492, "question_id": 35733002, "link": "https://stackoverflow.com/questions/35733002/how-to-use-an-interface-in-a-callback-with-golang/35733492#35733492", "title": "How to use an interface in a callback with Golang?", "body": "<p><code>FayeClient.Subscribe</code> implements:</p>\n\n<pre><code>Subscribe(string, bool, func(wray.Message)) (wray.SubscriptionPromise, error)\n</code></pre>\n\n<p>and your interface Subscriber requires the function:</p>\n\n<pre><code>Subscribe(string, bool, func(Message)) (Promise, error)\n</code></pre>\n\n<p>Notice the different parameters of the callback function (<code>Message</code> != <code>wray.Message</code>, <code>Promise</code> != <code>wray.SubscriptionPromise</code>), and that's why your code won't compile.</p>\n\n<p>You don't need to declare the interfaces <code>Message</code> and <code>Promise</code> again, just use the ones from the library. </p>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 5323316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79aaf598fc82d558b868736966ea03b?s=128&d=identicon&r=PG&f=1", "display_name": "komatsu", "link": "https://stackoverflow.com/users/5323316/komatsu"}, "edited": false, "score": 0, "creation_date": 1456888859, "post_id": 35735421, "comment_id": 59149803, "body": "So if I make the argument in the callback an interface it should work?  Aren&#39;t I just going to have the same problem in that it would be asking for the <code>wray.MessageInterface</code> (for example) to be in the signature?"}], "tags": [], "owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "is_accepted": false, "score": 0, "last_activity_date": 1456873651, "creation_date": 1456873651, "answer_id": 35735421, "question_id": 35733002, "link": "https://stackoverflow.com/questions/35733002/how-to-use-an-interface-in-a-callback-with-golang/35735421#35735421", "title": "How to use an interface in a callback with Golang?", "body": "<p>Despite what you claim, <code>wray.FayeClient</code> doesn't implement your <code>Subscriber</code> interface, because it's <code>Subscribe</code> method has a different signature from the one defined in your interface.</p>\n\n<p><code>Subscribe(string, bool, func(wray.Message)) (wray.SubscriptionPromise, error)</code> simply is not the same thing as <code>Subscribe(string, bool, func(Message)) (Promise, error)</code>. <code>wray.Message</code> may implement <code>Message</code>, but it's still a <em>different type</em>. Same goes for <code>wray.SubscriptionPromise</code> and <code>Promise</code>.</p>\n\n<p>If you want to make your library more conducive to interfaces, you need to change the library itself to accept interface arguments and return interfaces instead of concrete types.</p>\n"}], "owner": {"reputation": 73, "user_id": 5323316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79aaf598fc82d558b868736966ea03b?s=128&d=identicon&r=PG&f=1", "display_name": "komatsu", "link": "https://stackoverflow.com/users/5323316/komatsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1909, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1456921341, "creation_date": 1456864706, "last_edit_date": 1456869858, "question_id": 35733002, "link": "https://stackoverflow.com/questions/35733002/how-to-use-an-interface-in-a-callback-with-golang", "title": "How to use an interface in a callback with Golang?", "body": "<p>I am trying to use a <a href=\"https://github.com/AutogrowSystems/wray\" rel=\"nofollow\">Faye client for Go</a> but when I try to make an interface for the client it seems to fail due to to the type in the callback:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/autogrowsystems/wray\"\n)\n\ntype Message interface {\n    Data() map[string]interface{}\n}\n\ntype Promise interface {\n    Successful() bool\n}\n\ntype Subscriber interface {\n    Subscribe(string, bool, func(Message)) (Promise, error)\n}\n\nfunc subscribeMe(subber Subscriber) {\n    subber.Subscribe(\"/my/chan\", false, func(msg Message) {\n        fmt.Printf(\"got data: %+v\", msg.Data())\n    })\n}\n\nfunc main() {\n    subscribeMe(wray.NewFayeClient(\"http://localhost/faye\"))\n    fmt.Println(\"all good!\")\n}\n</code></pre>\n\n<p>At that point it fails with the following error:</p>\n\n<pre><code># command-line-arguments\nmain/fayetest.go:27: cannot use wray.NewFayeClient(\"http://localhost/faye\") (type *wray.FayeClient) as type Subscriber in argument to subscribeMe:\n    *wray.FayeClient does not implement Subscriber (wrong type for Subscribe method)\n            have Subscribe(string, bool, func(wray.Message)) (wray.SubscriptionPromise, error)\n            want Subscribe(string, bool, func(Message)) (Promise, error)\n</code></pre>\n\n<p>It seems as though it should work as the client does satisfy the interface:</p>\n\n<pre><code>// wray.go - wray.FayeClient\nfunc (self *FayeClient) Subscribe(channel string, force bool, callback func(Message)) (promise SubscriptionPromise, err error) {\n}\n\n// response.go - wray.Message \nfunc (self Message) Data() map[string]interface{} {\n}\n\n// wray.go - wray.SubscriptionPromise\nfunc (self SubscriptionPromise) Successful() bool {\n}\n</code></pre>\n\n<p>It should work right?  Or does the callback mess up the satisfaction of the interface?</p>\n\n<p><strong>Edit:</strong> as an aside, I am the author of that fork of the Faye Client, is there anything I can do to make it conducive to interfaces?  Apart from ditching callbacks?</p>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1456862422, "post_id": 35732261, "comment_id": 59139247, "body": "If they are all numeric <code>Id</code>&#39;s couldn&#39;t you potentially add them all to an array and set the key to the numeric Id?"}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "reply_to_user": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1456862513, "post_id": 35732261, "comment_id": 59139294, "body": "@OliverQueen something like <code>make(map[uint16]Connection)</code>?"}, {"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1456862681, "post_id": 35732261, "comment_id": 59139392, "body": "YES, exactly what I was saying"}], "answers": [{"comments": [{"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 0, "creation_date": 1456862568, "post_id": 35732350, "comment_id": 59139328, "body": "Yah, I just realized when OliverQueen asked me in the comments :D"}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 0, "creation_date": 1456863386, "post_id": 35732350, "comment_id": 59139767, "body": "is it possible to have this map globally?"}, {"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1456863495, "post_id": 35732350, "comment_id": 59139839, "body": "The way this happens, if you initialize the arr outside of the func, then set the global initialized arr&#39;s value to the new one declared within the main function, it should work."}], "tags": [], "owner": {"reputation": 2925, "user_id": 660675, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/8qJ6x.jpg?s=128&g=1", "display_name": "resilva87", "link": "https://stackoverflow.com/users/660675/resilva87"}, "is_accepted": true, "score": 2, "last_activity_date": 1456862542, "creation_date": 1456862542, "answer_id": 35732350, "question_id": 35732261, "link": "https://stackoverflow.com/questions/35732261/golang-map-or-struct-to-add-or-remove-from-list/35732350#35732350", "title": "Golang map or struct to add or remove from list", "body": "<p>Why not identify each <code>Connection</code> in a map by its <code>Id</code>?</p>\n\n<pre><code>package main\n\ntype Connection struct {\n   Id uint16\n   X string\n}\n\nvar connections map[uint16]Connection\n\nfunc main() {\n    connections = make(map[uint16]Connection)\n    connections[1] = Connection{}\n}\n</code></pre>\n"}], "owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 0, "accepted_answer_id": 35732350, "answer_count": 1, "score": 0, "last_activity_date": 1456862542, "creation_date": 1456862252, "question_id": 35732261, "link": "https://stackoverflow.com/questions/35732261/golang-map-or-struct-to-add-or-remove-from-list", "title": "Golang map or struct to add or remove from list", "body": "<p>I have a server and I wan't each connection to be saved into a list. Lets say:</p>\n\n<pre><code>type Connection struct {\n   Id uint16\n   Conn *conn.TCP\n}\n\nvar connections []Connection\n</code></pre>\n\n<p>But what I wanted to remove / fetch the specific connection id? What should I use?</p>\n\n<p>I was thinking of something like:</p>\n\n<pre><code>func GetConnectionById(id uint16) Connection {\n    for k, v := range connections {\n       if v.Id == id {\n          return v\n       }\n    }\n}\n</code></pre>\n\n<p>Is there a better approach?</p>\n"}, {"tags": ["validation", "go", "beego"], "comments": [{"owner": {"reputation": 3448, "user_id": 5466118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c5af41e2f2230c199ad274d363eda32?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Zabel", "link": "https://stackoverflow.com/users/5466118/martin-zabel"}, "edited": false, "score": 0, "creation_date": 1456862208, "post_id": 35731806, "comment_id": 59139105, "body": "I am not familiar with Beego, but I think, your question misses an example of <i>invalid data</i> which gets accepted."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 6158875, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QJZBr3MIWzw/AAAAAAAAAAI/AAAAAAAAADI/6lbdrjS3KSc/photo.jpg?sz=128", "display_name": "Patrick Mark Mazo", "link": "https://stackoverflow.com/users/6158875/patrick-mark-mazo"}, "is_accepted": false, "score": 0, "last_activity_date": 1469697177, "creation_date": 1469697177, "answer_id": 38631967, "question_id": 35731806, "link": "https://stackoverflow.com/questions/35731806/beego-validation-accepts-invalid-data/38631967#38631967", "title": "Beego validation accepts invalid data", "body": "<p>It's because your struct has a data type with map[string]interface{} which accepts any data type and converting it into a string try to be specific in data type</p>\n"}], "owner": {"reputation": 1, "user_id": 2127399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad42504ce46157d4b38104c7211f442a?s=128&d=identicon&r=PG", "display_name": "Dionys Rosario", "link": "https://stackoverflow.com/users/2127399/dionys-rosario"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 848, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1469697177, "creation_date": 1456860791, "last_edit_date": 1456866246, "question_id": 35731806, "link": "https://stackoverflow.com/questions/35731806/beego-validation-accepts-invalid-data", "title": "Beego validation accepts invalid data", "body": "<p>I am trying to validate some forms using Beego validation, but it is not working at all: invalid data passes without errors.</p>\n\n<p>This the relevant code, I don't know what is wrong. Can you point me at the mistake?</p>\n\n<p><a href=\"https://github.com/dionyself/golang-cms/blob/master/models/form.go\" rel=\"nofollow\">https://github.com/dionyself/golang-cms/blob/master/models/form.go</a></p>\n\n<pre><code>package models\n\nimport (\n    \"github.com/astaxie/beego\"\n    \"github.com/astaxie/beego/validation\"\n)\n\ntype BaseForm struct {\n    Errors map[string]string\n}\n\nfunc (form *BaseForm) Validate() bool {\n    valid := validation.Validation{}\n    b, err := valid.Valid(form)\n    if err != nil {\n        beego.Error(err)\n    }\n    if !b {\n        for _, err := range valid.Errors {\n            form.Errors[err.Key] = err.Message\n            beego.Debug(err.Key, err.Message)\n        }\n    }\n    return b\n}\n\ntype RegisterForm struct {\n    BaseForm\n    Username   string `form:\"username\" valid:\"Required; AlphaNumeric; MinSize(4); MaxSize(300)\"`\n    Password   string `form:\"password\" valid:\"Required; MinSize(4); MaxSize(30)\"`\n    PasswordRe string `form:\"passwordre\" valid:\"Required; MinSize(4); MaxSize(30)\"`\n}\n\nfunc (form *RegisterForm) Valid(v *validation.Validation) {\n    // Check if passwords of two times are same.\n    if form.Password != form.PasswordRe {\n        v.SetError(\"PasswordRe\", \"Passwords did not match\")\n        return\n    }\n}\n\ntype ArticleForm struct {\n    BaseForm\n    Id            int    `form:\"-\"`\n    Title         string `form:\"title\" valid:\"Required;MinSize(4);MaxSize(300)\"`\n    Category      int    `form:\"category\"`\n    Content       string `form:\"content\" valid:\"Required; MinSize(50); MaxSize(2000)\"`\n    TopicTags     string `form:\"topic-tags\" valid:\"MinSize(4); MaxSize(300)\"`\n    TaggedUsers   string `form:\"tagged-users\" valid:\"MinSize(4); MaxSize(300)\"`\n    AllowReviews  bool   `form:\"allow-reviews\" valid:\"Required\"`\n    AllowComments bool   `form:\"allow-comments\" valid:\"Required\"`\n    Errors        map[string]string\n}\n\nfunc (form *ArticleForm) Valid(v *validation.Validation) {\n    if form.Category &gt;= 0 {\n        v.SetError(\"Category\", \"Invalid category\")\n        return\n    }\n}\n</code></pre>\n\n<p>Some documentation:\n<a href=\"http://beego.me/docs/mvc/controller/validation.md\" rel=\"nofollow\">http://beego.me/docs/mvc/controller/validation.md</a></p>\n\n<p>This is the code that parses the form:</p>\n\n<pre><code>func (this *ArticleController) Post() {\n    form := models.ArticleForm{}\n    Art := new(models.Article)\n    if err := this.ParseForm(&amp;form); err != nil {\n        this.Abort(\"401\")\n    } else {\n        db := this.GetDB()\n        if !form.Validate() {\n            this.Data[\"form\"] = form\n            var cats []*models.Category\n            db.QueryTable(\"category\").All(&amp;cats)\n            this.Data[\"Categories\"] = cats\n            this.ConfigPage(\"article-editor.html\")\n            for key, msg := range form.Errors {\n                fmt.Println(key, msg)\n            }\n        } else {\n            db.Insert(Art)\n            this.Data[\"Article\"] = Art\n            this.ConfigPage(\"article.html\")\n        }\n    }\n}\n</code></pre>\n\n<p>Note: FormData is always accepted (even an empty form), form.Validate() is always returning 'true'... 0 errors on logs. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1456858954, "post_id": 35731099, "comment_id": 59137110, "body": "The <code>error</code> type has just one method. It might suit your needs. On any case: Take the Tour of Go. Twice."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "edited": false, "score": 0, "creation_date": 1456859169, "post_id": 35731099, "comment_id": 59137257, "body": "<code>error.Error()</code> will give you the string value. Problem solved."}], "answers": [{"tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": false, "score": 0, "last_activity_date": 1456921497, "creation_date": 1456921497, "answer_id": 35747193, "question_id": 35731099, "link": "https://stackoverflow.com/questions/35731099/save-error-in-database-golang/35747193#35747193", "title": "Save error in database Golang", "body": "<p>Use the function:</p>\n\n<pre><code>error.Error()\n</code></pre>\n\n<p>to get a string representation of the error.</p>\n\n<p><em>Tip:</em> avoid naming variables with existing type names. <code>error</code> is a type name and it's also your variable name, which might lead to confusion.</p>\n"}], "owner": {"reputation": 83, "user_id": 5999997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f01e22b4ed35e81ca8c936491b5bab71?s=128&d=identicon&r=PG&f=1", "display_name": "Jess J", "link": "https://stackoverflow.com/users/5999997/jess-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 317, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1456921497, "creation_date": 1456858558, "question_id": 35731099, "link": "https://stackoverflow.com/questions/35731099/save-error-in-database-golang", "title": "Save error in database Golang", "body": "<p>I'm running http request in golang </p>\n\n<pre><code>resp, err := client.Do(req)\n    if err != nil {\n        return \"\", err\n    }\n</code></pre>\n\n<p>So, it returns error back to the main function, that attempts to store it in the database:</p>\n\n<pre><code>_, err = db.Exec(\"UPDATE test SET error = $1 WHERE id = $2\", error, id)\n</code></pre>\n\n<p>I receive the following error: <code>sql: converting Exec argument #1's type: unsupported type errors.errorString, a struct exit status 1</code></p>\n\n<p>So, I understand, that error has a different type, but I can't find information on how to pass the value of the error to the string. Could someone direct me in a right way.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 4, "last_activity_date": 1456856282, "creation_date": 1456856282, "answer_id": 35730394, "question_id": 35730198, "link": "https://stackoverflow.com/questions/35730198/how-to-invoke-a-golang-func-likezremkey-string-members-string/35730394#35730394", "title": "How to invoke a golang func like&quot;ZRem(key string, members ...string)&quot;?", "body": "<pre><code> ZRem(\"user_queue\", task_ids...)\n</code></pre>\n"}], "owner": {"reputation": 371, "user_id": 5725927, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/gW2Pd.jpg?s=128&g=1", "display_name": "rongdong.bai", "link": "https://stackoverflow.com/users/5725927/rongdong-bai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 35730394, "answer_count": 1, "score": 0, "last_activity_date": 1456857147, "creation_date": 1456855671, "question_id": 35730198, "link": "https://stackoverflow.com/questions/35730198/how-to-invoke-a-golang-func-likezremkey-string-members-string", "title": "How to invoke a golang func like&quot;ZRem(key string, members ...string)&quot;?", "body": "<p>I want to invoke a method like \"ZRem(key string, members ...string)\" with key=\"user_queue\" and members=[\"v1\", \"v2\",... \"v50\"].</p>\n\n<p>I have tried something like</p>\n\n<pre><code>func ZRem(key string, members ...string){\n    // do something\n}\nfunc main(){\n    // do something\n    // task_ids is a []string\n    ZRem(\"user_queue\", task_ids[0], task_ids[1:]...)\n}\n</code></pre>\n\n<p>but receive a compile error.</p>\n\n<pre><code>too many arguments in call to ZRem\n</code></pre>\n"}, {"tags": ["go", "thrift"], "comments": [{"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1456853952, "post_id": 35729593, "comment_id": 59134162, "body": "Is the payload json?"}, {"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 2, "creation_date": 1456853987, "post_id": 35729593, "comment_id": 59134189, "body": "Also, please post what you&#39;ve already tried in <code>GO</code>"}, {"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1456855699, "post_id": 35729593, "comment_id": 59135258, "body": "Check out gRPC. <a href=\"http://www.grpc.io/faq/\" rel=\"nofollow noreferrer\">grpc.io/faq</a>"}, {"owner": {"reputation": 105, "user_id": 5140108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/330a3b70c6cf72f4568e25b2c5f7e9b2?s=128&d=identicon&r=PG&f=1", "display_name": "Rebecca", "link": "https://stackoverflow.com/users/5140108/rebecca"}, "reply_to_user": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1456856451, "post_id": 35729593, "comment_id": 59135694, "body": "@OliverQueen no the payload is binary"}, {"owner": {"reputation": 105, "user_id": 5140108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/330a3b70c6cf72f4568e25b2c5f7e9b2?s=128&d=identicon&r=PG&f=1", "display_name": "Rebecca", "link": "https://stackoverflow.com/users/5140108/rebecca"}, "reply_to_user": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1456856530, "post_id": 35729593, "comment_id": 59135733, "body": "@voutasaurus i&#39;m receiving the data from Kafka - i don&#39;t have control over the transport layer"}, {"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1456856838, "post_id": 35729593, "comment_id": 59135901, "body": "have you ventured into this? <a href=\"https://github.com/Shopify/sarama\" rel=\"nofollow noreferrer\">github.com/Shopify/sarama</a>"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1456856847, "post_id": 35729593, "comment_id": 59135905, "body": "@Rebecca Are you using the generated code from the thrift-go compiler?"}, {"owner": {"reputation": 105, "user_id": 5140108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/330a3b70c6cf72f4568e25b2c5f7e9b2?s=128&d=identicon&r=PG&f=1", "display_name": "Rebecca", "link": "https://stackoverflow.com/users/5140108/rebecca"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1456858477, "post_id": 35729593, "comment_id": 59136816, "body": "@sberry Yes, I&#39;ve got the generated code. I&#39;ve got a byte array, and the generated code, and I don&#39;t know how to convert the byte array into the thrift object."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1456859324, "post_id": 35729593, "comment_id": 59137363, "body": "@Rebecca if you have the <code>[]byte</code> slice, you probably will be doing something like this: <a href=\"https://github.com/glycerine/golang-thrift-minimal-example/blob/master/serialize.go#L35\" rel=\"nofollow noreferrer\">github.com/glycerine/golang-thrift-minimal-example/blob/mast&zwnj;&#8203;er/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 5140108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/330a3b70c6cf72f4568e25b2c5f7e9b2?s=128&d=identicon&r=PG&f=1", "display_name": "Rebecca", "link": "https://stackoverflow.com/users/5140108/rebecca"}, "edited": false, "score": 0, "creation_date": 1456874889, "post_id": 35731595, "comment_id": 59145694, "body": "You have a small typo: <code>proto := thrift.NewTCompactProtocol(transp)</code>, but otherwise this worked perfectly!"}], "tags": [], "owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "is_accepted": true, "score": 4, "last_activity_date": 1456876018, "last_edit_date": 1456876018, "creation_date": 1456860057, "answer_id": 35731595, "question_id": 35729593, "link": "https://stackoverflow.com/questions/35729593/how-do-i-decode-an-apache-thrift-payload-in-go/35731595#35731595", "title": "How do I decode an Apache Thrift payload in Go?", "body": "<pre><code>var data []byte //that's the byte array you received\n\ntransp := &amp;TMemoryBuffer{Buffer: bytes.NewBuffer(data)}\nproto := NewTCompactProtocol(transp)\n\nae := NewAnalyticEventBatch()\nae.Read(proto)\n</code></pre>\n\n<p>It would be cleaner if you could read from file/socket directly. Then you would only need thrift <code>StreamTransport</code> </p>\n"}], "owner": {"reputation": 105, "user_id": 5140108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/330a3b70c6cf72f4568e25b2c5f7e9b2?s=128&d=identicon&r=PG&f=1", "display_name": "Rebecca", "link": "https://stackoverflow.com/users/5140108/rebecca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 707, "favorite_count": 0, "accepted_answer_id": 35731595, "answer_count": 1, "score": 1, "last_activity_date": 1456876018, "creation_date": 1456853768, "question_id": 35729593, "link": "https://stackoverflow.com/questions/35729593/how-do-i-decode-an-apache-thrift-payload-in-go", "title": "How do I decode an Apache Thrift payload in Go?", "body": "<p>This is the working JavaScript version of what I'm trying to do in Go. </p>\n\n<pre><code>let next = TBufferedTransport.receiver(data =&gt; {\n\n let proto = new TCompactProtocol(data)\n let ae = new AnalyticEventBatch()\n\n ae.read(proto)\n});\n</code></pre>\n\n<p>Using Go, I can't get Thrift to decode the payload - what should I be doing?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 384, "user_id": 4255909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/msCBN.png?s=128&g=1", "display_name": "aurelien", "link": "https://stackoverflow.com/users/4255909/aurelien"}, "edited": false, "score": 1, "creation_date": 1456856385, "post_id": 35729092, "comment_id": 59135658, "body": "Thanks that make the job!"}], "tags": [], "owner": {"reputation": 934, "user_id": 3239666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638873245dd9cdc579bf551818c11fb3?s=128&d=identicon&r=PG&f=1", "display_name": "GarMan", "link": "https://stackoverflow.com/users/3239666/garman"}, "is_accepted": true, "score": 4, "last_activity_date": 1456852257, "creation_date": 1456852257, "answer_id": 35729092, "question_id": 35728814, "link": "https://stackoverflow.com/questions/35728814/how-to-set-one-pointer-to-multiply-function/35729092#35729092", "title": "How to set one pointer to multiply function?", "body": "<p><code>:=</code> does two things, it creates a variable and assigns a value to it. You are trying to create a new variable called <code>h</code> in the second line and the compiler is telling you that it would not create a new variable.</p>\n\n<p>Just replace that <code>:=</code> with <code>=</code></p>\n"}], "owner": {"reputation": 384, "user_id": 4255909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/msCBN.png?s=128&g=1", "display_name": "aurelien", "link": "https://stackoverflow.com/users/4255909/aurelien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 1, "closed_date": 1457184039, "accepted_answer_id": 35729092, "answer_count": 1, "score": -2, "last_activity_date": 1502138304, "creation_date": 1456851453, "last_edit_date": 1502138304, "question_id": 35728814, "link": "https://stackoverflow.com/questions/35728814/how-to-set-one-pointer-to-multiply-function", "closed_reason": "Duplicate", "title": "How to set one pointer to multiply function?", "body": "<p>How can I set one pointer to multiply function?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Cube struct {\n    u int\n}\n\nfunc (h *Cube) space() int {\n        return h.u * h.u * h.u\n}\n\nfunc main() {\n        h := Cube {\n                u: 10,\n        }\n        fmt.Println(h.space())\n\n        h := Cube {\n                u: 100,\n        }\n        fmt.Println(h.space())\n}\n</code></pre>\n\n<p>The first request of println give back 1000, but with the second println it goes wrong telling no new variables on left side of :=\nbut I want the pointer to use all same just the u: to 100 change</p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "edited": false, "score": 2, "creation_date": 1456847750, "post_id": 35727109, "comment_id": 59129772, "body": "Go is about getting things done, if it works, its the Go way ;-)."}, {"owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 0, "creation_date": 1456856671, "post_id": 35727109, "comment_id": 59135820, "body": "kostya&#39;s answer is a good one. Don&#39;t over-engineer and force your program to do everything with channels and goroutines, thinking that&#39;s the Go Way. There&#39;s nothing wrong with having global state guarded with mutexes; often that&#39;s the most simple, direct and effective way to get things done. If you need to have a goroutine that watches for hardware updates, then have just that and have it update the global state."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1456877652, "post_id": 35727109, "comment_id": 59146621, "body": "If you have a reproducer, I suggest to file a bug about Lock() calls failing to unblock."}], "answers": [{"tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 1, "last_activity_date": 1456856114, "creation_date": 1456856114, "answer_id": 35730339, "question_id": 35727109, "link": "https://stackoverflow.com/questions/35727109/managing-multiple-channels-in-go/35730339#35730339", "title": "Managing multiple channels in Go", "body": "<p>I would not use channels for this at all.</p>\n\n<p>You can update and read shared state from the same variable from multiple go-routines and use sync.RWMutex for synchronization.</p>\n"}], "owner": {"reputation": 13036, "user_id": 2008384, "user_type": "registered", "accept_rate": 39, "profile_image": "https://i.stack.imgur.com/xZb4I.png?s=128&g=1", "display_name": "Kryten", "link": "https://stackoverflow.com/users/2008384/kryten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1456858461, "creation_date": 1456846803, "last_edit_date": 1456858461, "question_id": 35727109, "link": "https://stackoverflow.com/questions/35727109/managing-multiple-channels-in-go", "title": "Managing multiple channels in Go", "body": "<p>I'm a newbie to Go &amp; I'm writing a simple web application. The basic idea is this:</p>\n\n<p>goroutine #1 is the HTTP server</p>\n\n<p>goroutine #2 is a function which manages the state of the application. It needs to poll some hardware for values periodically, so it needs to run in its own thread.</p>\n\n<p>When a user makes an HTTP request, the server will request updated information from the state goroutine, then return an HTML page to the client.</p>\n\n<p>It all works very well except for one thing: there are currently six different possible signals sent by the server and returned from the state thread, with both a request and a response channel, for a total of 12 channels (and I'm going to be adding at least one or two more signals). It may be possible to consolidate some of the signals, but many of them are different types.</p>\n\n<p>As I said, it works, but it's getting rather ugly.</p>\n\n<p>It looks something like this:</p>\n\n<p><strong>main.go</strong> includes declarations to instantiate the channels:</p>\n\n<pre><code>// a shutdown signal\nshutdown := make(chan bool)\n\n// request the current state of a sensor\nsensorRequest := make(chan string)\nsensorResponse := make(chan Sensor)\n\n// request the current state of ALL sensors\nsensorListRequest := make(chan bool)\nsensorListResponse := make(chan []Sensor)\n\n// request the current state of the application (active or inactive)\nstatusRequest := make(chan bool)\nstatusResponse := make(chan bool)\n\n// and a few more...\n\n// start the \"state manager\" goroutine\ngo ManageState(shutdown, sensorRequest, sensorResponse, sensorListRequest, sensorListResponse, statusRequest, statusResponse)\n\n// start the \"HTTP server\" goroutine\ngo ManageHTTP(shutdown, sensorRequest, sensorResponse, sensorListRequest, sensorListResponse, statusRequest, statusResponse)\n</code></pre>\n\n<p>So, a couple of questions:</p>\n\n<ol>\n<li><p>is it necessary to have separate request &amp; response channels? Given that the request and response are different types, I can't see an obvious way to use the same channel in both directions (that isn't hacky).</p></li>\n<li><p>I considered putting all the channels into a struct which could be passed to all the goroutines, but I'm not sure that's going to be any real benefit - it doesn't seem much clearer than what I'm doing now.</p></li>\n<li><p>What is <strong>the Go way</strong>&trade; of doing this?</p></li>\n</ol>\n\n<p><strong>Update</strong></p>\n\n<p>Thanks to @kostya and @Aedolon for suggesting a global state with <code>sync.Mutex</code> for locking/unlocking. That was actually my first approach, but I ran into a serious problem: my Mutex <code>Lock()</code> calls were randomly failing to unblock when the lock was released. This code will be running on a Raspberry Pi, and I suspect there's a bug somewhere (either in the package I'm using to read the hardware state or in the Go ARM binaries). But after spending a bunch of time trying to trace the problem, I decided to try something different.</p>\n\n<p>At any rate, after reading (many times) that I should \"not communicate by sharing memory; instead, share memory by communicating\" (<a href=\"https://blog.golang.org/share-memory-by-communicating\" rel=\"nofollow\">The Go Blog</a>), I decided to attempt to implement it this way. And now that I'm doing it this way, I find that I like this approach :-)</p>\n"}, {"tags": ["go", "profiling"], "answers": [{"tags": [], "owner": {"reputation": 1509, "user_id": 4897, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4mbYz.jpg?s=128&g=1", "display_name": "Mike Reedell", "link": "https://stackoverflow.com/users/4897/mike-reedell"}, "is_accepted": false, "score": 5, "last_activity_date": 1456846129, "creation_date": 1456846129, "answer_id": 35726865, "question_id": 35726455, "link": "https://stackoverflow.com/questions/35726455/difference-between-net-http-pprof-and-runtime-pprof/35726865#35726865", "title": "Difference between net/http/pprof and runtime/pprof", "body": "<p><code>net/http/pprof</code> exposes the pprof profiler data via a web interface.  If you're writing a server-based system, this may be useful since you may not have access to the host.</p>\n\n<p><code>runtime/pprof</code> will write the profiler data to a data file that you can then convert into various image or document types.  If you're writing a system that can't or won't have a web interface, this is probably the one to use.  Either way they expose the same data.</p>\n"}], "owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 323, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1456846129, "creation_date": 1456844981, "question_id": 35726455, "link": "https://stackoverflow.com/questions/35726455/difference-between-net-http-pprof-and-runtime-pprof", "title": "Difference between net/http/pprof and runtime/pprof", "body": "<p>I have been reading about the profiling here it is explained using <a href=\"https://golang.org/pkg/net/http/pprof/\" rel=\"nofollow\">net_http_pprof</a> and here <a href=\"https://golang.org/pkg/runtime/pprof/\" rel=\"nofollow\">runtime_pprof</a>. So, what are difference between these two and which one should be prefer over another. And please don't paste the overview definition from the given links</p>\n"}, {"tags": ["go", "go-echo"], "comments": [{"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 1, "creation_date": 1456840349, "post_id": 35722459, "comment_id": 59124150, "body": "The Logger seems to be an HTTP access_log logger.  If you want to log manually, maybe you should try logger like <a href=\"https://github.com/Sirupsen/logrus\" rel=\"nofollow noreferrer\">logrus</a>"}, {"owner": {"reputation": 838, "user_id": 5989200, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0dgxm.jpg?s=128&g=1", "display_name": "nekketsuuu", "link": "https://stackoverflow.com/users/5989200/nekketsuuu"}, "reply_to_user": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1521882896, "post_id": 35722459, "comment_id": 85928970, "body": "@holys Although <a href=\"https://echo.labstack.com/middleware/logger\" rel=\"nofollow noreferrer\">the Logger middleware</a> is for it, <a href=\"https://echo.labstack.com/guide/customization\" rel=\"nofollow noreferrer\"><code>echo.Logger</code></a> is not."}], "answers": [{"comments": [{"owner": {"reputation": 838, "user_id": 5989200, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0dgxm.jpg?s=128&g=1", "display_name": "nekketsuuu", "link": "https://stackoverflow.com/users/5989200/nekketsuuu"}, "edited": false, "score": 0, "creation_date": 1521881140, "post_id": 41551718, "comment_id": 85928541, "body": "It is used by <a href=\"https://echo.labstack.com/guide/customization#custom-logger\" rel=\"nofollow noreferrer\"><code>echo.Logger</code></a> (see <a href=\"https://github.com/labstack/echo/blob/60f88a7a1c4beaf04b6f9254c8d72b45a2ab161e/log.go\" rel=\"nofollow noreferrer\">this</a>)."}], "tags": [], "owner": {"reputation": 737, "user_id": 6275844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f7071f7e0149f02e945420a120a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Dan 0", "link": "https://stackoverflow.com/users/6275844/dan-0"}, "is_accepted": false, "score": 6, "last_activity_date": 1483976945, "creation_date": 1483976945, "answer_id": 41551718, "question_id": 35722459, "link": "https://stackoverflow.com/questions/35722459/how-to-use-logging-middleware/41551718#41551718", "title": "How to use logging middleware", "body": "<p>I just started using Echo and don't know if anything has changed since this was posted, but I've found you can just import labstack's logger:</p>\n\n<pre><code>import \"github.com/labstack/gommon/log\"\n</code></pre>\n\n<p>Then use it: </p>\n\n<pre><code>log.Debug(\"Created user\", id)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1075, "user_id": 258086, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d4d84d18294812314864d50635d054b4?s=128&d=identicon&r=PG", "display_name": "vs4vijay", "link": "https://stackoverflow.com/users/258086/vs4vijay"}, "is_accepted": false, "score": 1, "last_activity_date": 1589530118, "creation_date": 1589530118, "answer_id": 61814638, "question_id": 35722459, "link": "https://stackoverflow.com/questions/35722459/how-to-use-logging-middleware/61814638#61814638", "title": "How to use logging middleware", "body": "<p>By Default echo uses \"INFO\" Log Level. So anything below \"INFO\" Level gets displayed.</p>\n\n<p>If you want to see \"DEBUG\" Logs as well, You need to set the level to \"DEBUG\":</p>\n\n<pre><code>import \"github.com/labstack/gommon/log\"\ne.Logger.SetLevel(log.DEBUG)\n</code></pre>\n\n<p>Hierarchy:</p>\n\n<pre><code>DEBUG\nINFO\nWARN\nERROR\nOFF\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 46, "user_id": 15314666, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DH9erRrXZWo/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuck1Scc6eiAZV0Uy5YRlRC17OpHHLw/s96-c/photo.jpg?sz=128", "display_name": "Muhammad Iqbal Ali", "link": "https://stackoverflow.com/users/15314666/muhammad-iqbal-ali"}, "is_accepted": false, "score": 1, "last_activity_date": 1617264405, "creation_date": 1617264405, "answer_id": 66900660, "question_id": 35722459, "link": "https://stackoverflow.com/questions/35722459/how-to-use-logging-middleware/66900660#66900660", "title": "How to use logging middleware", "body": "<p>you can use 3rd party logging middleware such as <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">https://github.com/sirupsen/logrus</a></p>\n<p><code>import log &quot;github.com/sirupsen/logrus&quot;</code></p>\n<p>example</p>\n<p>create log entry function:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func makeLogEntry(c echo.Context) *log.Entry {\n    if c == nil {\n        return log.WithFields(log.Fields{\n            &quot;at&quot;: time.Now().Format(&quot;2006-01-02 15:04:05&quot;),\n        })\n    }\n\n    return log.WithFields(log.Fields{\n        &quot;at&quot;:     time.Now().Format(&quot;2006-01-02 15:04:05&quot;),\n        &quot;method&quot;: c.Request().Method,\n        &quot;uri&quot;:    c.Request().URL.String(),\n        &quot;ip&quot;:     c.Request().RemoteAddr,\n    })\n}\n</code></pre>\n<p>then:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func middlewareLogging(next echo.HandlerFunc) echo.HandlerFunc {\n    return func(c echo.Context) error {\n        makeLogEntry(c).Info(&quot;incoming request&quot;)\n        return next(c)\n    }\n}\n\nfunc errorHandler(err error, c echo.Context) {\n    report, ok := err.(*echo.HTTPError)\n    if ok {\n        report.Message = fmt.Sprintf(&quot;http error %d - %v&quot;, report.Code, report.Message)\n    } else {\n        report = echo.NewHTTPError(http.StatusInternalServerError, err.Error())\n    }\n\n    makeLogEntry(c).Error(report.Message)\n    c.HTML(report.Code, report.Message.(string))\n}\n</code></pre>\n<p>and then in main() function:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    e := echo.New()\n\n    e.Use(middlewareLogging)\n    e.HTTPErrorHandler = errorHandler\n\n    e.GET(&quot;/index&quot;, func(c echo.Context) error {\n        return c.JSON(http.StatusOK, true)\n    })\n\n    lock := make(chan error)\n    go func(lock chan error) {\n        lock &lt;- e.Start(&quot;:9000&quot;)\n    }(lock)\n\n    time.Sleep(1 * time.Millisecond)\n    makeLogEntry(nil).Warning(&quot;application started without ssl/tls enabled&quot;)\n\n    err := &lt;-lock\n    if err != nil {\n        makeLogEntry(nil).Panic(&quot;failed to start application&quot;)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7662, "favorite_count": 0, "answer_count": 3, "score": 6, "last_activity_date": 1617264405, "creation_date": 1456833964, "last_edit_date": 1521026762, "question_id": 35722459, "link": "https://stackoverflow.com/questions/35722459/how-to-use-logging-middleware", "title": "How to use logging middleware", "body": "<p>Here below is the entry point of my web application written in Go using Labstack's Echo:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/labstack/echo\"\n    mw \"github.com/labstack/echo/middleware\"\n)\n\nfunc main() {\n    controller := controllers.NewUserController(getSession())\n\n    app := echo.New()\n\n    app.Use(mw.Logger())\n    app.Use(mw.Recover())\n    app.SetDebug(true)\n\n    app.Post(\"/users\", controller.CreateUser)\n    app.Get(\"/users\", controller.ListUsers)\n    app.Get(\"/users/:id\", controller.GetUser)\n    app.Patch(\"/users/:id\", controller.UpdateUser)\n    app.Delete(\"/users/:id\", controller.DeleteUser)\n\n    app.Run(\":8000\")\n}\n</code></pre>\n\n<p>How do I reuse the logging middleware instantiated in the <code>Echo</code> application? I've tried this:</p>\n\n<p>package controllers</p>\n\n<pre><code>import (\n    \"net/http\"\n\n    \"github.com/labstack/echo\"\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\ntype (\n    UserController struct {\n        session *mgo.Session\n    }\n)\n\nfunc NewUserController(s *mgo.Session) *UserController {\n    return &amp;UserController{s}\n}\n\nfunc (userController UserController) CreateUser(context *echo.Context) error {\n    user := &amp;models.User{}\n\n    if err := context.Bind(user); err != nil {\n        context.Echo().Logger().Error(\"Error creating user\")\n        return err\n    }\n\n    user.Id = bson.NewObjectId()\n\n    userController.session.DB(\"test\").C(\"users\").Insert(user)\n    context.Echo().Logger().Debug(\"Created user\", id)\n\n    return context.JSON(http.StatusCreated, user)\n}\n</code></pre>\n\n<p>Even if the code above compiles, the statement</p>\n\n<pre><code>context.Echo().Logger().Debug(\"Created user\", id)\n</code></pre>\n\n<p><strong>doesn't</strong> produce any output... while the following statement <strong>does</strong>:</p>\n\n<pre><code>context.Echo().Logger().Info(\"Created user\", id)\n</code></pre>\n\n<p>Am I missing something?</p>\n"}, {"tags": ["windows", "go", "tls1.2"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1456833916, "post_id": 35721859, "comment_id": 59119461, "body": "There is no error on the server side as you simply ignore the error returned by ListenAndServeTLS."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 3, "creation_date": 1456839080, "post_id": 35721859, "comment_id": 59123170, "body": "I&#39;d expect some sort of firewall subsystem error preventing a process supposedly running in a lowered permissions mode (even if the user has administrative credentials) from binding to a privileged (below 1024) port. (Note that with the UAC turned on even administrators by default possess a security token with a lowered credentials and elevating them requires consent from the user in the form of a system-modal dialog.)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1456839249, "post_id": 35721859, "comment_id": 59123306, "body": "If my guess is a spot on, I&#39;d try to combine <a href=\"http://stackoverflow.com/a/25604878/720999\">this</a> with <a href=\"http://researchaholic.com/2010/07/15/how-to-set-an-exe-to-require-admin-authority-uac-on-launch/\" rel=\"nofollow noreferrer\">this</a> for a start."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1456839453, "post_id": 35721859, "comment_id": 59123454, "body": "And by the way, the example in the [<code>net&#47;http</code> documentation]() uses <code>log.Fatal(s.ListenAndServe())</code> to trap and display andy error possibly returned from <code>ListenAndServe()</code>. You <i>must</i> check errors in all the places they may arise."}, {"owner": {"reputation": 21, "user_id": 6002098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7d64eefcbb275fa162125d799e96240?s=128&d=identicon&r=PG&f=1", "display_name": "DaFont", "link": "https://stackoverflow.com/users/6002098/dafont"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1456840272, "post_id": 35721859, "comment_id": 59124096, "body": "@kostix On the port 8443, the servers works. Thanks !"}], "owner": {"reputation": 21, "user_id": 6002098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7d64eefcbb275fa162125d799e96240?s=128&d=identicon&r=PG&f=1", "display_name": "DaFont", "link": "https://stackoverflow.com/users/6002098/dafont"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 140, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1456832243, "creation_date": 1456832243, "question_id": 35721859, "link": "https://stackoverflow.com/questions/35721859/http-listenandservetls-doesnt-works-on-windows-8-1", "title": "http.ListenAndServeTLS doesn&#39;t works on WIndows 8.1", "body": "<p>The following code works on Linux(docker golang:latest) but not with Windows 8.1:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"fmt\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hi %s!\", r.URL.Path[1:])\n}\n\nfunc main() {\n    m := http.NewServeMux()\n    m.HandleFunc(\"/\", handler)\n    http.ListenAndServeTLS(\":443\", \"ssl/localhost.cert\", \"ssl/localhost.key\", m)\n }\n</code></pre>\n\n<p>On Windows, the server returns a 403 status code. No error on server side.</p>\n\n<p>go version </p>\n\n<pre><code>go1.6 windows/amd64\n</code></pre>\n\n<p>Certificate is generated using <a href=\"http://www.selfsignedcertificate.com/\" rel=\"nofollow\">http://www.selfsignedcertificate.com/</a></p>\n\n<p>What i'm doing wrong ?</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 3305, "user_id": 439189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a37ac47f749d07e74b36ecb1866a8265?s=128&d=identicon&r=PG", "display_name": "Ash Berlin-Taylor", "link": "https://stackoverflow.com/users/439189/ash-berlin-taylor"}, "is_accepted": false, "score": 0, "last_activity_date": 1463945906, "creation_date": 1463945906, "answer_id": 37378812, "question_id": 35719394, "link": "https://stackoverflow.com/questions/35719394/define-variable-in-cgo/37378812#37378812", "title": "Define variable in cgo", "body": "<p>It appears this is not possible as cgo does some mangling/parsing -- can you get away with just a normal <code>#define LOG \"common\"</code> (i.e. not use the CGO special flags).</p>\n\n<p>Or failing that You can invoke <code>go run</code>/<code>go build</code> like this: <code>CGO_CFLAGS='-DLOG=\"common\"' go run so.go</code></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 8854189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25bc3dbbfed1cd21fe7ad0ea88e905f9?s=128&d=identicon&r=PG&f=1", "display_name": "pinocchio.", "link": "https://stackoverflow.com/users/8854189/pinocchio"}, "is_accepted": false, "score": 0, "last_activity_date": 1564035196, "last_edit_date": 1564035196, "creation_date": 1564029091, "answer_id": 57194363, "question_id": 35719394, "link": "https://stackoverflow.com/questions/35719394/define-variable-in-cgo/57194363#57194363", "title": "Define variable in cgo", "body": "<p>you could define a variable in cgo same as define it in c code, </p>\n\n<p>example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\n/*\nint initflag=2;\n\nint GetInitFlag(){\n   return initflag;\n}\n*/\nimport \"C\"\nimport \"fmt\"\n\n// CFlag get c flag\nfunc CFlag() int {\n\n    value := C.GetInitFlag()\n\n    return int(value)\n}\n\nfunc main() {\n    fmt.Println(CFlag())\n}\n</code></pre>\n\n<p>string type must convert char*  in c to string</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// C string to Go string\nfunc C.GoString(*C.char) string\n</code></pre>\n\n<p><a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">https://golang.org/cmd/cgo/</a></p>\n"}], "owner": {"reputation": 439, "user_id": 2424276, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/14b57849c70f78693780d986c9d98d2c?s=128&d=identicon&r=PG", "display_name": "user2424276", "link": "https://stackoverflow.com/users/2424276/user2424276"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 637, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1564035196, "creation_date": 1456825366, "question_id": 35719394, "link": "https://stackoverflow.com/questions/35719394/define-variable-in-cgo", "title": "Define variable in cgo", "body": "<p>I want, at build time, to define a string variable in cgo. None of the following approaches works.</p>\n\n<ol>\n<li><pre><code>#cgo CFLAGS: -DLOG=\"common\"  \n</code></pre>\n\n<p>'common' undeclared (first use in this function)  </p></li>\n<li><pre><code>#cgo CFLAGS: -DLOG=common\n</code></pre>\n\n<p>'common' undeclared (first use in this function)</p></li>\n<li><pre><code>#cgo CFLAGS: -DLOG=\\\"common\\\"\n</code></pre>\n\n<p>malformed #cgo argument: -DLOG=\"common\"</p></li>\n</ol>\n"}, {"tags": ["go", "coap"], "comments": [{"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 3, "creation_date": 1456792877, "post_id": 35712433, "comment_id": 59101910, "body": "What&#39;s your question?"}, {"owner": {"reputation": 17, "user_id": 5753461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14398b82b9028624ff338ab2deaf9d8e?s=128&d=identicon&r=PG&f=1", "display_name": "Ekaku509", "link": "https://stackoverflow.com/users/5753461/ekaku509"}, "reply_to_user": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 0, "creation_date": 1456793302, "post_id": 35712433, "comment_id": 59102022, "body": "I want to create a map and then store client connection and their associated payload information each sent in a key value pair fashion"}], "owner": {"reputation": 17, "user_id": 5753461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14398b82b9028624ff338ab2deaf9d8e?s=128&d=identicon&r=PG&f=1", "display_name": "Ekaku509", "link": "https://stackoverflow.com/users/5753461/ekaku509"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1456829681, "creation_date": 1456791683, "last_edit_date": 1456829681, "question_id": 35712433, "link": "https://stackoverflow.com/questions/35712433/creating-a-map-with-udpconnection-and-associated-payload-information", "title": "creating a map with udpconnection and associated payload information", "body": "<p>I am trying to create a map to save the key as the connected client and its payload information. this is my code.  How do I go about it</p>\n\n<p>The code allows the client to send payload information to the server</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net\"\n\n    \"github.com/dustin/go-coap\"\n)\n\nfunc main() {\n    //listening for inconming request\n    log.Fatal(coap.ListenAndServe(\"udp\", \":5683\",\n        //function to handle incoming Client COAP Request u...dpconnection from          Remote Host &amp; the udp address of remote\n        coap.FuncHandler(func(l *net.UDPConn, a *net.UDPAddr, m *coap.Message) *coap.Message {\n            log.Printf(\"Got message path=%q: %#v from %v\", m.Path(), m, a)\n\n            var connection = make(map[net.UDPConn]coap.Message)\n\n            fmt.Println(connection)\n\n            // connection[l]= m.Payload[]\n            fmt.Println(\"The connecion is \", connection)\n            //var connection =make(map[]m) //check if the message of client is confirmed with the\n\n            if m.IsConfirmable() {\n\n                res := &amp;coap.Message{\n                    Type:      coap.Acknowledgement,\n                    Code:      coap.Content,\n                    MessageID: m.MessageID,\n                    Token:     m.Token,\n                    Payload:   []byte(\"Acknowledgement from Sever : hello to you!\")}\n\n                res.SetOption(coap.ContentFormat, coap.TextPlain)\n\n                log.Printf(\"Got it client %s %T\", m.Payload, &amp;res)\n                return res\n            }\n\n            return nil\n        })))\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 3, "creation_date": 1456788555, "post_id": 35711767, "comment_id": 59100360, "body": "You might find this helpful: <a href=\"https://golang.org/pkg/net/http/#Header\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Header</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1942, "user_id": 1209272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97e49723c518649025bd10ea6bf113b5?s=128&d=identicon&r=PG", "display_name": "Chief", "link": "https://stackoverflow.com/users/1209272/chief"}, "is_accepted": false, "score": 0, "last_activity_date": 1456833279, "creation_date": 1456833279, "answer_id": 35722235, "question_id": 35711767, "link": "https://stackoverflow.com/questions/35711767/golang-transform-http-header-into-array/35722235#35722235", "title": "Golang transform http.Header into array", "body": "<p>You can retrieve the response header's first value with <code>resp.Header().Get()</code>, which returns <code>\"\"</code> if the header key has no values.</p>\n\n<p>Hence, in your case</p>\n\n<pre><code>var a [2]string\na[0] = resp.Header().Get(\"server\")\na[1] = resp.Header().Get(\"date\")\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 379, "user_id": 2918731, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6mtoN.png?s=128&g=1", "display_name": "TheLebDev", "link": "https://stackoverflow.com/users/2918731/thelebdev"}, "edited": false, "score": 0, "creation_date": 1562147439, "post_id": 35747382, "comment_id": 100283550, "body": "<code>resp.Header()[..]</code> is not going to work. Header is a non-function, what you&#39;re looking for is <code>resp.Header.Get(&quot;whatever&quot;)</code>"}], "tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": false, "score": 9, "last_activity_date": 1456922004, "creation_date": 1456922004, "answer_id": 35747382, "question_id": 35711767, "link": "https://stackoverflow.com/questions/35711767/golang-transform-http-header-into-array/35747382#35747382", "title": "Golang transform http.Header into array", "body": "<p><code>resp.Header</code> is of type <a href=\"http://golang.org/pkg/net/http/#Header\" rel=\"noreferrer\"><code>http.Header</code></a>. You can see in the documentation that this type is also a <code>map</code>, so you can access it in two different ways:</p>\n\n<p>1) By using <code>http.Header</code>'s methods:</p>\n\n<pre><code>serverValue := resp.Header().Get(\"Server\")\ndataValue := resp.Header().Get(\"Date\")\n</code></pre>\n\n<p>If the header exists, you'll get its first value (keep in mind that there might be multiple values for a single header name); otherwise you'll get an empty string.</p>\n\n<p>2) By using <code>map</code>'s methods:</p>\n\n<pre><code>serverValue, ok := resp.Header()[\"Server\"]\ndataValue, ok := resp.Header()[\"Date\"]\n</code></pre>\n\n<p>If the header exists, <code>ok</code> will be <code>true</code> (i.e. the header <em>exists</em>) and you'll get a slice of strings containing all the values for that header; otherwise, <code>ok</code> will be <code>false</code> (i.e. the header <em>doesn't exist</em>).</p>\n\n<p>Use whichever method you prefer.</p>\n\n<p>If you need to iterate over all the header values, you can do it with something like:</p>\n\n<pre><code>for name, value := range resp.Header() {\n    fmt.Printf(\"%v: %v\\n\", name, value)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1219, "user_id": 3864339, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aQ1gO.jpg?s=128&g=1", "display_name": "Juan Cespedes", "link": "https://stackoverflow.com/users/3864339/juan-cespedes"}, "is_accepted": false, "score": 7, "last_activity_date": 1462370424, "creation_date": 1462370424, "answer_id": 37030039, "question_id": 35711767, "link": "https://stackoverflow.com/questions/35711767/golang-transform-http-header-into-array/37030039#37030039", "title": "Golang transform http.Header into array", "body": "<p>You could use a function like this one:</p>\n\n<pre><code>func HeaderToArray(header http.Header) (res []string) {\n    for name, values := range header {\n        for _, value := range values {\n            res = append(res, fmt.Sprintf(\"%s: %s\", name, value))\n        }\n    }\n    return\n}\n</code></pre>\n\n<p>It should return an array like the one you want.</p>\n"}, {"tags": [], "owner": {"reputation": 2303, "user_id": 1184206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba9e9c0ec646cd83d9cd6398ebffdbaa?s=128&d=identicon&r=PG", "display_name": "S.Mishra", "link": "https://stackoverflow.com/users/1184206/s-mishra"}, "is_accepted": false, "score": 1, "last_activity_date": 1573658306, "creation_date": 1573658306, "answer_id": 58840201, "question_id": 35711767, "link": "https://stackoverflow.com/questions/35711767/golang-transform-http-header-into-array/58840201#58840201", "title": "Golang transform http.Header into array", "body": "<h1>This solutions is for <code>go version go1.13 windows/amd64</code>.</h1>\n\n<p>The request object from <code>http.Request</code> contains <code>Header</code> object. We are using <code>net/http</code> package here. You can get values of all headers by name using following method:</p>\n\n<pre><code>import(\n    \"net/http\"\n)\n\ntype RequestHeaders struct {\n    ContentType      string      `json: \"content-type\"`\n    Authorization    string      `json: \"authorization\"`\n}\n\nfunc getHeaders(r *http.Request) RequestHeaders {\n        contentType := r.Header.Get(\"Content-Type\")\n        authorization := r.Header.Get(\"Authorization\")\n        headers := RequestHeaders{\n                        Content-Type: contentType,\n                        Authorization: authorization}\n        return headers\n}\n</code></pre>\n\n<p>You can see that we are using <code>r.Header.Get(\"Content-Type\")</code> method to get value of the header. </p>\n\n<p><em>If the header is missing the <code>Get()</code> method will return empty string.</em></p>\n"}], "owner": {"reputation": 83, "user_id": 5999997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f01e22b4ed35e81ca8c936491b5bab71?s=128&d=identicon&r=PG&f=1", "display_name": "Jess J", "link": "https://stackoverflow.com/users/5999997/jess-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9407, "favorite_count": 0, "answer_count": 4, "score": 5, "last_activity_date": 1573658306, "creation_date": 1456788227, "question_id": 35711767, "link": "https://stackoverflow.com/questions/35711767/golang-transform-http-header-into-array", "title": "Golang transform http.Header into array", "body": "<p>I'm sending POST request:</p>\n\n<pre><code>req, err := http.NewRequest(\"POST\", link, bytes.NewBuffer(jsonStr))\nclient := &amp;http.Client{Timeout: tm}\nresp, err := client.Do(req)\n</code></pre>\n\n<p>I receive <code>resp.Header</code> in format with type <code>http.Header</code></p>\n\n<p>I need to something like this:</p>\n\n<pre><code>[\n    \"Server: nginx/1.4.4\",\n    \"Date: Wed, 24 Feb 2016 19:09:49 GMT\"\n]\n</code></pre>\n\n<p>I don't know how to approach this problem, because I don't know how to deal with <code>http.Header</code> datatype. Could someone help please</p>\n"}, {"tags": ["json", "excel", "go", "xlsx"], "comments": [{"owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 0, "creation_date": 1456783461, "post_id": 35710401, "comment_id": 59098028, "body": "I find the question unclear... what kind of result do you actually want to see?"}, {"owner": {"reputation": 31, "user_id": 5775945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MFgLv.jpg?s=128&g=1", "display_name": "Isaac Melton", "link": "https://stackoverflow.com/users/5775945/isaac-melton"}, "reply_to_user": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 0, "creation_date": 1456784914, "post_id": 35710401, "comment_id": 59098757, "body": "Something like this:    {&quot;foo&quot;:&quot;cell1&quot;, &quot;bar&quot;:&quot;cell2&quot;}"}, {"owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 0, "creation_date": 1456801459, "post_id": 35710401, "comment_id": 59104378, "body": "Where do foo and bar come from in your example? The JSON you&#39;re emitting has keys &quot;d_name&quot; and &quot;name&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": false, "score": 0, "last_activity_date": 1456819189, "creation_date": 1456819189, "answer_id": 35717517, "question_id": 35710401, "link": "https://stackoverflow.com/questions/35710401/combining-data-from-multiple-cells-into-one-json-object/35717517#35717517", "title": "Combining data from multiple cells into one JSON object", "body": "<p>If I right understand your request you just need to define root element, add cells into it and marshal this element rather than individual cells.</p>\n\n<pre><code>root := []map[string]string{}\nfor x, cell := range row.Cells {\n    if x == 3 || x == 5 {\n        root = append(root, map[string]string{\"d_name\": cell.String(), \"name\": cell.String()})\n    }\n}\njson_data, _ := json.Marshal(root)\nfmt.Println(string(json_data))\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/SHnShHvW_0\" rel=\"nofollow\">http://play.golang.org/p/SHnShHvW_0</a></p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 0, "last_activity_date": 1475960725, "creation_date": 1475960725, "answer_id": 39937369, "question_id": 35710401, "link": "https://stackoverflow.com/questions/35710401/combining-data-from-multiple-cells-into-one-json-object/39937369#39937369", "title": "Combining data from multiple cells into one JSON object", "body": "<p>You may use</p>\n\n<pre><code>a, err := row.Cells[3].String()\nb, err := row.Cells[5].String()\n</code></pre>\n\n<p>Like this working code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n\n    \"github.com/tealeg/xlsx\"\n)\n\nfunc main() {\n    xlFile, err := xlsx.OpenFile(`Test_Data.xlsx`)\n    if err != nil {\n        panic(err)\n    }\n    for _, sheet := range xlFile.Sheets {\n        for _, row := range sheet.Rows {\n            //for x, cell := range row.Cells {\n            //if x == 3 || x == 5 {\n            a, err := row.Cells[3].String()\n            if err != nil {\n                panic(err)\n            }\n            b, err := row.Cells[5].String()\n            if err != nil {\n                panic(err)\n            }\n            data := map[string]string{\"d_name\": a, \"name\": b}\n            json_data, err := json.Marshal(data)\n            if err != nil {\n                panic(err)\n            }\n            fmt.Println(string(json_data))\n            //}\n            //}\n        }\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>{\"d_name\":\"1000\",\"name\":\"a\"}\n{\"d_name\":\"2000\",\"name\":\"b\"}\n{\"d_name\":\"3000\",\"name\":\"c\"}\n{\"d_name\":\"4000\",\"name\":\"d\"}\n{\"d_name\":\"5000\",\"name\":\"e\"}\n</code></pre>\n\n<p>input file content:</p>\n\n<pre><code>1   10  100 1000    10000   a\n2   20  200 2000    20000   b\n3   30  300 3000    30000   c\n4   40  400 4000    40000   d\n5   50  500 5000    50000   e\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 5775945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MFgLv.jpg?s=128&g=1", "display_name": "Isaac Melton", "link": "https://stackoverflow.com/users/5775945/isaac-melton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1212, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1475961080, "creation_date": 1456782614, "last_edit_date": 1475961080, "question_id": 35710401, "link": "https://stackoverflow.com/questions/35710401/combining-data-from-multiple-cells-into-one-json-object", "title": "Combining data from multiple cells into one JSON object", "body": "<p>I am trying to combine data from multiple cells from an excel spreadsheet into one JSON encoded string. I cannot figure out how to do so, the code below is creating a new JSON object per cell. How do I differentiate the cells to combine into the same JSON string?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/tealeg/xlsx\"\n    \"encoding/json\"\n\n)\n\nfunc main() {\n    excelFileName := \"/Users/isaacmelton/Desktop/Test_Data.xlsx\"\n    xlFile, err := xlsx.OpenFile(excelFileName)\n    if err != nil {\n        fmt.Printf(\"Cannot parse data\")\n    }\n    for _, sheet := range xlFile.Sheets {\n        for _, row := range sheet.Rows {\n\n            fmt.Printf(\"\\n\")\n            for x, cell := range row.Cells {\n                if x == 3 || x == 5 {\n                    data := map[string]string{\"d_name\": cell.String(), \"name\": cell.String()}\n                    json_data, _ := json.Marshal(data)\n\n                    fmt.Println(string(json_data))\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Running the above code results in the following:</p>\n\n<pre><code>{\"foo\":\"cell1\",\"bar\":\"cell1\"}\n{\"foo\":\"cell2\",\"bar\":\"cell2\"}\n</code></pre>\n\n<p>I expect something like this:  </p>\n\n<pre><code>{\"foo\":\"cell1\", \"bar\":\"cell2\"}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "edited": false, "score": 1, "creation_date": 1456776867, "post_id": 35708608, "comment_id": 59094175, "body": "Why not do it like <code>database&#47;sql</code>? Have the &quot;core&quot; (i.e. <code>database&#47;sql</code>), have your &quot;plugins&quot; (e.g. <code>github.com&#47;lib&#47;pq</code>), have your &quot;main&quot; which imports the &quot;core&quot; and all &quot;plugins&quot; you want to use. No need for symlinking."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1456778735, "post_id": 35708608, "comment_id": 59095276, "body": "you can have <code>go generate</code> render a main file that imports the plugins, and in each plugin&#39;s <code>init()</code> function register it in the main repository. The importing, even as <code>import _ &quot;foo&#47;bar&#47;plugin&quot;</code> will cause the init func to run on start and register the plugins."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 5, "creation_date": 1456778806, "post_id": 35708608, "comment_id": 59095322, "body": "See this answer <a href=\"http://stackoverflow.com/questions/28001872/golang-events-eventemitter-dispatcher-for-plugin-architecture/28003144#28003144\" title=\"golang events eventemitter dispatcher for plugin architecture\">stackoverflow.com/questions/28001872/&hellip;</a>"}, {"owner": {"reputation": 13632, "user_id": 1071383, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f4bf0fbd4cc6de6159d78f9f9fb3aa6?s=128&d=identicon&r=PG", "display_name": "jabclab", "link": "https://stackoverflow.com/users/1071383/jabclab"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1456861442, "post_id": 35708608, "comment_id": 59138657, "body": "@Not_a_Golfer thanks :-) would this approach allow the external plugins to be compilable standalone? Would they not fail to compile due to the registry variable not being present? If not, I guess the <code>&#47;&#47;go:generate</code> could either be (a) in the plugin itself, or (b) in the core app which then built further on your <code>import _ &quot;foo&#47;bar&#47;plugin&quot;</code> in that it would also generate the addition of the plugin&#39;s <code>type</code> to the plugin registry."}, {"owner": {"reputation": 1364, "user_id": 313754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01b3e7f117dfdbd060d35d8527ea342b?s=128&d=identicon&r=PG", "display_name": "Bactisme", "link": "https://stackoverflow.com/users/313754/bactisme"}, "edited": false, "score": 1, "creation_date": 1474370876, "post_id": 35708608, "comment_id": 66494486, "body": "This thread on reddit detailed the options for a plugin architecture. Go lang <i>will have</i>, in its further releases a buildmode allowing externally loaded plugin. <a href=\"https://www.reddit.com/r/golang/comments/3xyaro/plugins_in_golang/\" rel=\"nofollow noreferrer\">reddit.com/r/golang/comments/3xyaro/plugins_in_golang</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "is_accepted": false, "score": 3, "last_activity_date": 1478548775, "last_edit_date": 1478548775, "creation_date": 1478209418, "answer_id": 40411737, "question_id": 35708608, "link": "https://stackoverflow.com/questions/35708608/idiomatic-approach-to-a-go-plugin-based-system/40411737#40411737", "title": "Idiomatic approach to a Go plugin-based system", "body": "<p>This is one of my favorite issues in Go.  I have an open source project that has to deal with this as well (<a href=\"https://github.com/cpg1111/maestrod\" rel=\"nofollow noreferrer\">https://github.com/cpg1111/maestrod</a>), it has pluggable DB and Runtime (Docker, k8s, Mesos, etc) clients.  Prior to the plugin package that is in the master branch of Go (so it should be coming to a stable release soon) I just compiled all of the plugins into the binary and allowed configuration decide which to use.</p>\n\n<p>As of the plugin package, <a href=\"https://tip.golang.org/pkg/plugin/\" rel=\"nofollow noreferrer\">https://tip.golang.org/pkg/plugin/</a>, you can use dynamic linking for plugins, so similar to C's <code>dlopen()</code> in its loading, and the behavior of go's plugin package is pretty well outlined in the documentation.</p>\n\n<p>Additionally I recommend taking a look at how Hashicorp addresses this by doing RPC over a local unix socket.  <a href=\"https://github.com/hashicorp/go-plugin\" rel=\"nofollow noreferrer\">https://github.com/hashicorp/go-plugin</a></p>\n\n<p>The added benefit of running a plugin as a separate process like Hashicorp's model does, is that you get great stability in the event that the plugin fails but the main process is able to handle that failure.</p>\n\n<p>I should also mention Docker does its plugins in Go similarly, except Docker uses HTTP instead of RPC.  Additionally, a Docker engineer has posted about embedding a Javascript interpreter for dynamic logic in the past <a href=\"http://crosbymichael.com/category/go.html\" rel=\"nofollow noreferrer\">http://crosbymichael.com/category/go.html</a>.</p>\n\n<p>The issue I wanted to point out with the sql package's pattern that was mentioned in the comments is that that's not a plugin architecture really, you're still limited to whatever is in your imports, so you could have multiple main.go's but that's not a plugin, the point of a plugin is such that the same program can run either one piece of code or another.  What you have with things like the sql package is flexibility where a separate package determines what DB driver to use.  Nonetheless, you end up modifying code to change what driver you are using.</p>\n\n<p>I want to add, with all of these plugin patterns, aside from the compiling into the same binary and using configuration to choose, each <em>can</em> have its own build, test and deployment (i.e. their own CI/CD) but not necessarily.</p>\n"}], "owner": {"reputation": 13632, "user_id": 1071383, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f4bf0fbd4cc6de6159d78f9f9fb3aa6?s=128&d=identicon&r=PG", "display_name": "jabclab", "link": "https://stackoverflow.com/users/1071383/jabclab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1614, "favorite_count": 0, "answer_count": 1, "score": 10, "last_activity_date": 1478548775, "creation_date": 1456776349, "question_id": 35708608, "link": "https://stackoverflow.com/questions/35708608/idiomatic-approach-to-a-go-plugin-based-system", "title": "Idiomatic approach to a Go plugin-based system", "body": "<p>I have a Go project I would like to open source but there are certain elements which are not suitable for OSS, e.g. company specific logic etc.</p>\n\n<p>I have conceived of the following approach:</p>\n\n<ul>\n<li><code>interface</code>s are defined in the core repository.</li>\n<li>Plugins can then be standalone repositories whose <code>type</code>s implement the <code>interface</code>s defined in core. This allows the plugins to be housed in completely separate modules and therefore have their own CI jobs etc.</li>\n<li>Plugins are compiled into the final binary via symlinks.</li>\n</ul>\n\n<p>This would result in a directory structure something like the following:</p>\n\n<pre><code>|- $GOPATH\n  |- src\n    |- github.com\n      |- jabclab\n        |- core-system\n          |- plugins &lt;-----|\n      |- xxx               | \n        |- plugin-a ------&gt;| ln -s\n      |- yyy               |  \n        |- plugin-b ------&gt;|\n</code></pre>\n\n<p>With an example workflow of:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ go get git@github.com:jabclab/core-system.git\n$ go get git@github.com:xxx/plugin-a.git\n$ go get git@github.com:yyy/plugin-b.git\n$ cd $GOPATH/src/github.com\n$ ln -s ./xxx/plugin-a/*.go ./jabclab/core-system/plugins\n$ ln -s ./yyy/plugin-b/*.go ./jabclab/core-system/plugins\n$ cd jabclab/core-system\n$ go build\n</code></pre>\n\n<p>The one issue I'm not sure about is how to make the types defined in plugins available at runtime in core. I'd rather not use <a href=\"https://golang.org/pkg/reflect/\" rel=\"noreferrer\"><code>reflect</code></a> but can't think of a better way at the moment. If I was doing the code in one repo I would use something like:</p>\n\n<pre><code>package plugins\n\ntype Plugin interface {\n  Exec(chan&lt;- string) error\n}\n\nvar Registry map[string]Plugin\n\n// plugin_a.go\nfunc init() { Registry[\"plugin_a\"] = PluginA{} }\n\n// plugin_b.go\nfunc init() { Registry[\"plugin_b\"] = PluginB{} }\n</code></pre>\n\n<p>In addition to the above question would this overall approach be considered idiomatic?</p>\n"}, {"tags": ["python", "go"], "comments": [{"owner": {"reputation": 538898, "user_id": 104349, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0f4cefeedec5163556751d61625eedd0?s=128&d=identicon&r=PG", "display_name": "Daniel Roseman", "link": "https://stackoverflow.com/users/104349/daniel-roseman"}, "edited": false, "score": 4, "creation_date": 1456777334, "post_id": 35708494, "comment_id": 59094453, "body": "goroutines are not threads."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1456778239, "post_id": 35708494, "comment_id": 59094969, "body": "Except they&#39;re threads. If it looks like a duck, swims like a duck, and quacks like a duck, then it probably is a duck"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1456781460, "post_id": 35708494, "comment_id": 59096914, "body": "You can monkey-patch threads in Python to be green-threads and not &quot;really threads&quot; and the question still applies. Re the question - a waitgroup is more like a semaphore or a condition than joining threads, it&#39;s really apples and oranges."}], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 3, "last_activity_date": 1456777400, "creation_date": 1456777400, "answer_id": 35708905, "question_id": 35708494, "link": "https://stackoverflow.com/questions/35708494/is-waitgroup-in-golang-a-step-backward-compare-to-other-languages-like-python/35708905#35708905", "title": "Is WaitGroup in golang a step backward compare to other languages like Python?", "body": "<p>No, it's just a different thing that does a different thing. They're not even really comparable, since a <code>WaitGroup</code> by its nature waits on multiple things (and can have things added to it during its lifetime) and a python thread's <code>join</code> always just waits on that one thing.</p>\n\n<p>That said, Go's library is more about giving you the primitive things that you need to do more advanced things, while Python's has more of a \"batteries included\" philosophy. Using what Go gives you, you could create a type that acts quite a bit like a python <code>Thread</code>. It's probably not the best way to make use of Go, but you're given the tools to do it if you want. However the standard library isn't going to standardize on such a thing.</p>\n"}, {"tags": [], "owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "is_accepted": false, "score": 5, "last_activity_date": 1496887192, "last_edit_date": 1496887192, "creation_date": 1456779214, "answer_id": 35709422, "question_id": 35708494, "link": "https://stackoverflow.com/questions/35708494/is-waitgroup-in-golang-a-step-backward-compare-to-other-languages-like-python/35709422#35709422", "title": "Is WaitGroup in golang a step backward compare to other languages like Python?", "body": "<blockquote>\n  <p>why it was designed this way</p>\n</blockquote>\n\n<p>That's actually been explained many times by the golang team - why can't we kill goroutines, why doesn't they have an ID which we can read, why can't we wait for goroutine explicitly like with thread's <code>Join</code>.</p>\n\n<p>It was explained multiple times but I could find only <a href=\"https://youtu.be/dKGmK_Z1Zl0?t=1203\" rel=\"nofollow noreferrer\">this</a>. Basically, the authors didn't want you to depend on thread locality - to lock on a specific thread/goroutine, have a local storage only for it etc. When you don't have any means to know in which goroutine you're actually running you're forced to design your application in a truly concurent way. Your code is composed of truly independend pieces that run concurently and they don't care how exactly. You don't care which goroutine picks up your code, you don't care which OS thread is running your code. That's where channels, select and other primitives come in. They help you build your application in such a way. And I'm sure it doesn't stop there. </p>\n"}, {"tags": [], "owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "is_accepted": false, "score": 1, "last_activity_date": 1456783030, "creation_date": 1456783030, "answer_id": 35710494, "question_id": 35708494, "link": "https://stackoverflow.com/questions/35708494/is-waitgroup-in-golang-a-step-backward-compare-to-other-languages-like-python/35710494#35710494", "title": "Is WaitGroup in golang a step backward compare to other languages like Python?", "body": "<p>The answers from hobbs and creker especially are excellent, but I feel there's more to be said.</p>\n\n<p>There's a very common notion that WaitGroup is <em>the</em> way to manage multiple goroutines - it certainly is commonly used and even idiomatic in a number of situations. And you know what? Being able to call thread.join() may indeed be superior to dealing with WaitGroups when just waiting on a bunch of threads/goroutines launched earlier.</p>\n\n<p>But there's <em>so much more</em> to Go's concurrency model than that. </p>\n\n<p>Goroutines were specifically designed to <em>not</em> have concepts of ownership or hierarchy or handles. They are independent, equal and responsible for ending their own execution. That, combined with strong concurrency primitives, gives Go's model almost unparalleled flexibility.</p>\n\n<p>Therefore, if you find yourself using WaitGroups almost every time you're using goroutines, you're probably not taking advantage of concurrency <em>in modeling and structuring your programs</em> - it's more likely you're just using goroutines to parallelize computation.</p>\n\n<p>To answer your question more directly, WaitGroups are rather primitive compared to stuff like thread.join(), but primitive, low-level building blocks are much more useful with Go's concurrency model. After all, goroutines are not threads, and they're not meant to be used exactly the same way.</p>\n"}, {"tags": [], "owner": {"reputation": 929, "user_id": 8109026, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jomoj.jpg?s=128&g=1", "display_name": "Raed Shomali", "link": "https://stackoverflow.com/users/8109026/raed-shomali"}, "is_accepted": false, "score": 0, "last_activity_date": 1496881965, "creation_date": 1496881965, "answer_id": 44424816, "question_id": 35708494, "link": "https://stackoverflow.com/questions/35708494/is-waitgroup-in-golang-a-step-backward-compare-to-other-languages-like-python/44424816#44424816", "title": "Is WaitGroup in golang a step backward compare to other languages like Python?", "body": "<blockquote>\n  <p>As far as I know, the goroutine needs to have reference to the WaitGroup object to call Done(), which means, I have to either make the goroutine to accept a WaitGroup object, or make WaitGroup object global to the goroutine.</p>\n</blockquote>\n\n<p>I disagree that <code>WaitGroup</code> is a step backward when compared to other languages. I really like its simplicity. However, I do agree that passing the <code>WaitGroup</code> object around would mean that the concurrency logic would be mixed with your business logic and I did not like that.</p>\n\n<p>So I came up with this generic function to solve this problem for me:</p>\n\n<pre><code>// Parallelize parallelizes the function calls\nfunc Parallelize(functions ...func()) {\n    var waitGroup sync.WaitGroup\n    waitGroup.Add(len(functions))\n\n    defer waitGroup.Wait()\n\n    for _, function := range functions {\n        go func(copy func()) {\n            defer waitGroup.Done()\n            copy()\n        }(function)\n    }\n}\n</code></pre>\n\n<p>Here is an example:</p>\n\n<pre><code>func1 := func() {\n        for char := 'a'; char &lt; 'a' + 3; char++ {\n            fmt.Printf(\"%c \", char)\n        }\n}\n\nfunc2 := func() {\n        for number := 1; number &lt; 4; number++ {\n            fmt.Printf(\"%d \", number)\n        }\n}\n\nParallelize(func1, func2)  // a 1 b 2 c 3\n</code></pre>\n\n<p>If you would like to use it, you can find it here <a href=\"https://github.com/shomali11/util\" rel=\"nofollow noreferrer\">https://github.com/shomali11/util</a></p>\n"}], "owner": {"reputation": 19827, "user_id": 342553, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/zjZ6d.jpg?s=128&g=1", "display_name": "James Lin", "link": "https://stackoverflow.com/users/342553/james-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 941, "favorite_count": 1, "accepted_answer_id": 35708905, "answer_count": 4, "score": -1, "last_activity_date": 1496887192, "creation_date": 1456775975, "last_edit_date": 1456778477, "question_id": 35708494, "link": "https://stackoverflow.com/questions/35708494/is-waitgroup-in-golang-a-step-backward-compare-to-other-languages-like-python", "title": "Is WaitGroup in golang a step backward compare to other languages like Python?", "body": "<p>I am very new to golang and I was trying out goroutine, while it's quite easy to run things concurrently, I am a bit surprised the way golang to \"join the threads\" using <code>WaitGroup</code>.</p>\n\n<p>As far as I know, the goroutine needs to have reference to the WaitGroup object to call <code>Done()</code>, which means, I have to either make the goroutine to accept a <code>WaitGroup</code> object, or make <code>WaitGroup</code> object global to the goroutine.</p>\n\n<p>But in other languages like Python, you call <code>thread.join()</code>, the \"controlling\" part sits outside of the thread code.</p>\n\n<p>Like I said, I am very new to golang, I don't know why it was designed this way, could someone please shed some light on this aspect?</p>\n\n<p><strong>UPDATE</strong>:\nI hope the argument is not based on 'Goroutine vs Thread', at the end of the day they both try to achieve (some kind of) 'concurrency', my question is more about controlling the program flow.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1456774485, "post_id": 35707946, "comment_id": 59092703, "body": "What is the <code>rw</code> variable? Also, <code>Copy</code> function has two arguments - destination and source. You&#39;re using <code>stdout</code> as a source which is obviously wrong."}, {"owner": {"reputation": 1986, "user_id": 4180276, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f34129a97d735e6e19247c911626cb9a?s=128&d=identicon&r=PG&f=1", "display_name": "nadermx", "link": "https://stackoverflow.com/users/4180276/nadermx"}, "reply_to_user": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1456775340, "post_id": 35707946, "comment_id": 59093255, "body": "rw is is <code>rw web.ResponseWriter</code>, and in this case not sure using <code>stdout</code> is wrong as I am piping the application"}], "answers": [{"comments": [{"owner": {"reputation": 1986, "user_id": 4180276, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f34129a97d735e6e19247c911626cb9a?s=128&d=identicon&r=PG&f=1", "display_name": "nadermx", "link": "https://stackoverflow.com/users/4180276/nadermx"}, "edited": false, "score": 0, "creation_date": 1456775243, "post_id": 35708055, "comment_id": 59093196, "body": "using defer in this use case has a higher overhead, so not sure that it would be the right use case to just use defer."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1986, "user_id": 4180276, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f34129a97d735e6e19247c911626cb9a?s=128&d=identicon&r=PG&f=1", "display_name": "nadermx", "link": "https://stackoverflow.com/users/4180276/nadermx"}, "edited": false, "score": 1, "creation_date": 1456777700, "post_id": 35708055, "comment_id": 59094650, "body": "@nadermx what overhead are you referring to? The there&#39;s no reason to make a function this slow more complicated just to save a few nanoseconds. This is exactly the case where you should use defer."}], "tags": [], "owner": {"reputation": 7731, "user_id": 1614378, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/lOzxR.png?s=128&g=1", "display_name": "dieter", "link": "https://stackoverflow.com/users/1614378/dieter"}, "is_accepted": true, "score": 1, "last_activity_date": 1456774489, "creation_date": 1456774489, "answer_id": 35708055, "question_id": 35707946, "link": "https://stackoverflow.com/questions/35707946/am-i-closing-this-function-correctly/35708055#35708055", "title": "Am I closing this function correctly?", "body": "<p>use <code>defer</code> statement like google <a href=\"http://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow\">advises</a>:</p>\n\n<pre><code>func CopyFile(dstName, srcName string) (written int64, err error) {\n    src, err := os.Open(srcName)\n    if err != nil {\n        return\n    }\n    defer src.Close()\n\n    dst, err := os.Create(dstName)\n    if err != nil {\n        return\n    }\n    defer dst.Close()\n\n    return io.Copy(dst, src)\n}\n</code></pre>\n"}], "owner": {"reputation": 1986, "user_id": 4180276, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f34129a97d735e6e19247c911626cb9a?s=128&d=identicon&r=PG&f=1", "display_name": "nadermx", "link": "https://stackoverflow.com/users/4180276/nadermx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 35708055, "answer_count": 1, "score": 1, "last_activity_date": 1456774489, "creation_date": 1456774122, "question_id": 35707946, "link": "https://stackoverflow.com/questions/35707946/am-i-closing-this-function-correctly", "title": "Am I closing this function correctly?", "body": "<p>I keep getting an error after a few hours that I have too many open files.</p>\n\n<p>I have already edited the <code>ulimit -n</code> but that only seems to prolong the time before the error occurs and crashes the process.</p>\n\n<p>I believe I have narrowed it down to this function, I just am not sure if I am closing it right.</p>\n\n<p>I currently have a function </p>\n\n<pre><code>go func() {\n    if _, err := io.Copy(rw, stdout); err != nil {\n        if !WritePipeBroken.MatchString(err.Error()) &amp;&amp;\n            !ConnectionResetByPeer.MatchString(err.Error()) {\n            rollbar.Error(rollbar.ERR, err)\n        }\n        log.Printf(\"pipeThruFfmpegToMp3: %v\\n\", err)\n        if err := ffmpeg.Process.Kill(); err != nil {\n            log.Printf(\"pipeThruFfmpegToMp3: %v\\n\", err)\n        }\n    }\n    rw.Flush()\n    wg.Done()\n}()\n</code></pre>\n\n<p>I believe that it is hanging, so should I do this instead</p>\n\n<pre><code>go func() {\n    if _, err := io.Copy(rw, stdout); err != nil {\n        if !WritePipeBroken.MatchString(err.Error()) &amp;&amp;\n            !ConnectionResetByPeer.MatchString(err.Error()) {\n            rollbar.Error(rollbar.ERR, err)\n        }\n        log.Printf(\"pipeThruFfmpegToMp3: %v\\n\", err)\n        if err := ffmpeg.Process.Kill(); err != nil {\n            log.Printf(\"pipeThruFfmpegToMp3: %v\\n\", err)\n        }\n    }\n    if ffmpeg.Process != nil {\n        ffmpeg.Process.Kill()\n    }\n    if stdout != nil {\n        stdin.Close()\n    }\n    rw.Flush()\n    wg.Done()\n}()\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 9, "creation_date": 1456771974, "post_id": 35707222, "comment_id": 59091177, "body": "The compiler uses a register as a temporary store, like a temporary variable"}, {"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 2, "creation_date": 1456772001, "post_id": 35707222, "comment_id": 59091197, "body": "Make this into an executable, then disassemble it"}, {"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 0, "creation_date": 1456772034, "post_id": 35707222, "comment_id": 59091216, "body": "or <code>go tool compile -S file</code>"}, {"owner": {"reputation": 1836, "user_id": 1574034, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/e5ec2a91be754c20903349048d16ed2a?s=128&d=identicon&r=PG", "display_name": "Naveen Ramanathan", "link": "https://stackoverflow.com/users/1574034/naveen-ramanathan"}, "reply_to_user": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 1, "creation_date": 1456772470, "post_id": 35707222, "comment_id": 59091478, "body": "I got a .o file with this. Is there a way to disassemble/decompile it"}], "answers": [{"comments": [{"owner": {"reputation": 598, "user_id": 9552116, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Coconut", "link": "https://stackoverflow.com/users/9552116/coconut"}, "edited": false, "score": 2, "creation_date": 1551344964, "post_id": 35707958, "comment_id": 96608833, "body": "Is C, as well, capable of achieving this? With a high-level abstraction as opposed to machine codes, Golang is able to instruct the CPU to read two or more values/variables at one time."}, {"owner": {"reputation": 71, "user_id": 860476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c062d6447ad7ed3e4885a498cc7b221a?s=128&d=identicon&r=PG", "display_name": "MCG", "link": "https://stackoverflow.com/users/860476/mcg"}, "edited": false, "score": 1, "creation_date": 1586712731, "post_id": 35707958, "comment_id": 108223593, "body": "There&#39;s no such thing as CPU being smart! CPU has no hint to not overwrite values, and it&#39;ll happily do so. The first write will either be eliminated during uop generation, or will be fused into a macro uop. uarch issues aside, what happens here is the compiler generates the code such that the the swapped values are assigned directly to the return tuple. The compiler can do so because the swapping is done within the function. If you perform the swap operation in a separate function, you&#39;ll see that the compiler will make use of an additional temporary register."}], "tags": [], "owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "is_accepted": true, "score": 33, "last_activity_date": 1456785703, "last_edit_date": 1456785703, "creation_date": 1456774171, "answer_id": 35707958, "question_id": 35707222, "link": "https://stackoverflow.com/questions/35707222/swap-two-numbers-golang/35707958#35707958", "title": "Swap two numbers golang", "body": "<p><strong>TL;DR</strong>: The disassembly shows that the CPU must be smart enough to see what's happening and use a register to avoid overwriting the existing value in memory.</p>\n\n<hr>\n\n<p>This question helped me learn a little more about Golang, so thank you!</p>\n\n<p>To figure out how the compiler makes native code, we need to look at the assembly code it generates, which is turned into machine code by the linker.</p>\n\n<p>I wrote a little Go program to help with this:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(myfunction())\n}\n\nfunc myfunction() []int {\n    a, b := 10, 5\n    b, a = a, b\n    return []int{a, b}\n}\n</code></pre>\n\n<p>Using <code>go tool compile -S &gt; swap.s</code>, I then <kbd>CTRL - F</kbd>'d for <code>myfunction</code> (which was the point of that name: easily searchable), and found these four lines, which correspond to the first two lines of <code>myfunction</code> in the Go code: (note this is for my 64-bit machine; the output will differ on other architechtures like 32-bit)</p>\n\n<pre><code>0x0028 00040 (swap.go:10)   MOVQ    $10, CX         ; var a = 10\n0x002f 00047 (swap.go:10)   MOVQ    $5, AX          ; var b = 5\n0x0036 00054 (swap.go:11)   MOVQ    CX, \"\".b+16(SP) ; copy a to *b+16\n0x003b 00059 (swap.go:11)   MOVQ    AX, \"\".a+24(SP) ; copy b to *a+24 \n</code></pre>\n\n<p>Go's disassembly is so helpful to debugging :D</p>\n\n<p>Looking at <a href=\"https://golang.org/doc/asm\" rel=\"noreferrer\">the Golang docs on asm</a>, we can see the assembler uses indirection to juggle the values.</p>\n\n<p>When the program runs, the CPU is smart enough to see what's happening and use a register to avoid overwriting the existing value.</p>\n\n<p><a href=\"http://pastebin.com/3pH8Bjt7\" rel=\"noreferrer\">Here's the full disassembly, if you're interested.</a></p>\n"}], "owner": {"reputation": 1836, "user_id": 1574034, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/e5ec2a91be754c20903349048d16ed2a?s=128&d=identicon&r=PG", "display_name": "Naveen Ramanathan", "link": "https://stackoverflow.com/users/1574034/naveen-ramanathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8042, "favorite_count": 5, "accepted_answer_id": 35707958, "answer_count": 1, "score": 20, "last_activity_date": 1456785703, "creation_date": 1456771756, "question_id": 35707222, "link": "https://stackoverflow.com/questions/35707222/swap-two-numbers-golang", "title": "Swap two numbers golang", "body": "<p>I am trying to understand the internals of go. Consider the following code</p>\n\n<pre><code>a,b := 10,5\nb,a = a,b\n</code></pre>\n\n<p>The above code swaps 2 number perfectly and a becomes 5 and b becomes 10. I am not able to understand how this works. Considering in the second line of code, if a is assigned to b first, then b would be 10. Now if we assign b to a then shouldn't a be 10 too.</p>\n\n<p>Please help me understand how this works</p>\n\n<p>Thanks</p>\n"}, {"tags": ["unicode", "go", "binary"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1456770362, "post_id": 35706545, "comment_id": 59090179, "body": "Yes, there is indeed a sign bit (but it might not work quite how you think; read on). Your converter is returning an <code>int64</code>; <a href=\"https://en.wikipedia.org/wiki/Sign_extension\" rel=\"nofollow noreferrer\">sign extension</a> is why those top bits are 1 not 0. Sign extension is an aspect of <a href=\"https://en.wikipedia.org/wiki/Two%27s_complement\" rel=\"nofollow noreferrer\">two&#39;s complement math</a>, where <code>0-1</code> &quot;wraps around&quot; (as it does for unsigned) and -1 is represented as all 1 bits internally."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1456770571, "post_id": 35706545, "comment_id": 59090317, "body": "When your program runs, no bits are reserved to distinguish between the <code>rune</code> and the <code>int32</code>--the difference is entirely at compile time, when the compiler, e.g. ensures any <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">assignments</a> are proper and chooses the right compiled code to output for, say, <a href=\"http://stackoverflow.com/questions/34861479/how-to-detect-when-bytes-cant-be-converted-to-string-in-go\"><code>string</code> iteration or <code>[]rune</code> to <code>string</code> conversaion</a>."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1456770826, "post_id": 35706545, "comment_id": 59090496, "body": "Note that UTF-8 is a <i>different</i> encoding from what you see in a <code>rune</code>. <a href=\"https://en.wikipedia.org/wiki/UTF-8\" rel=\"nofollow noreferrer\">It&#39;s byte-oriented</a> and it matches <a href=\"http://blog.golang.org/strings\" rel=\"nofollow noreferrer\">how the bytes in a <code>string</code> exist in memory</a>. The 32-bit <code>rune</code> tends to be a type you use during text processing when, e.g. you need to actually know the code point of a CJK character, not just the sequence of bytes representing it."}, {"owner": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1456771009, "post_id": 35706545, "comment_id": 59090612, "body": "And am I right in thinking that a CJK (Chinese, Japanese, Korean, for those finding this via Google) character is likely a multibyte character and can be represented by a single <code>rune</code>, but not a single <code>byte</code>?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1456771050, "post_id": 35706545, "comment_id": 59090635, "body": "Yep, that&#39;s correct."}, {"owner": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1456771254, "post_id": 35706545, "comment_id": 59090757, "body": "Then is there something in the bit representation of that <code>rune</code> that allows Go to display it as, say, a <code>\u60a8</code> (binary <code>110000010101000</code>, found <a href=\"http://software.ellerton.net/txt2bin/\" rel=\"nofollow noreferrer\">here</a>) and not <code>24744</code>, the decimal representation of that binary, if <code>rune</code> and <code>int32</code> are aliases?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1456771586, "post_id": 35706545, "comment_id": 59090925, "body": "No, there&#39;s nothing in the bit representation of the <code>rune</code> in memory at run time. At <i>compile time</i> Go knows <code>rune</code>s should have different checks applied to them and special code emitted for them in some cases (like <a href=\"https://golang.org/ref/spec#Conversions_to_and_from_a_string_type\" rel=\"nofollow noreferrer\"><code>[]rune</code> to <code>string</code> conversion</a>). (And in reality, <code>fmt.Println(&#39;\u60a8&#39;)</code> <a href=\"http://play.golang.org/p/3JDXBjzxgj\" rel=\"nofollow noreferrer\">does output the number</a>, but I think the point that type can be a purely compile-time difference, unlike in Ruby/JS/Python, bears understanding separately from the specifics here.)"}, {"owner": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1456771788, "post_id": 35706545, "comment_id": 59091056, "body": "This sentence: &quot;At compile time Go knows runes should have different checks applied to them and special code emitted for them in some cases than int32s.&quot; I think <i>that&#39;s</i> the crux of my question. What <i>are</i> those checks? How does that work at a low level? Or is that too complicated to explain?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1456771979, "post_id": 35706545, "comment_id": 59091179, "body": "Yeah, you need to read about how statically vs. dynamically typed languages work under the hood to understand that--once you do, the <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">spec</a> is surprisingly concise and illuminates the Go-specific stuff. Alternately, just playing around in Go or another statically typed language may help to develop your intuition here. The <a href=\"http://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">Tour</a>, if you haven&#39;t done it, is a great place to start."}, {"owner": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1456849497, "post_id": 35706545, "comment_id": 59131103, "body": "@twotwotwo Any ideas for resources on &quot;how statically vs. dynamically typed languages work under the hood&quot;? With that, and if you put all your comments together as an answer, I&#39;ll mark it correct."}], "owner": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 141, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1456769570, "creation_date": 1456769570, "last_edit_date": 1495535283, "question_id": 35706545, "link": "https://stackoverflow.com/questions/35706545/go-rune-int32-and-binary-encoding", "title": "Go: Rune, Int32, and binary encoding", "body": "<p>I get that a <code>rune</code> is an alias for <code>int32</code> because it's supposed to <a href=\"https://stackoverflow.com/a/24714789/931934\">hold all valid Unicode code points</a>. There are apparently <a href=\"https://stackoverflow.com/a/24714722/931934\">about 1,114,112 Unicode code points</a> currently, so it would make sense that they would have to be stored in four bits, or an <code>int32</code>-sized register, which can store an integer up to 2,147,483,647.</p>\n\n<p>I have a few questions about binary encoding of UTF-8 characters and integers, however.</p>\n\n<ul>\n<li>It appears that both <code>rune</code> and <code>int32</code> both occupy four bytes. If 2147483647 is the highest integer able to be represented in four bytes (four bit octets), why is its binary representation <code>1111111111111111111111111111111</code>, i.e., 31 1's instead of 32? Is there a bit reserved for its sign? It's possible that there's a bug in the <a href=\"http://www.binaryhexconverter.com/decimal-to-binary-converter\" rel=\"nofollow noreferrer\">binary converter I used</a>, because -2147483648 should still be able to be represented in 4 bytes (as it's still able to be represented in the <code>int32</code> type), but it is output there as <code>1111111111111111111111111111111110000000000000000000000000000000</code>, i.e., 33 1's and 31 0's which clearly overruns a four byte allowance. What's the story there?</li>\n<li>In the binary conversion, how would the compiler differentiate between a <code>rune</code> like 'C' (<code>01000011</code>, according to the <a href=\"http://www.utf8-chartable.de/unicode-utf8-table.pl?utf8=bin\" rel=\"nofollow noreferrer\">unicode to binary table</a> and the integer 67 (also <code>01000011</code>, according to the <a href=\"http://www.binaryhexconverter.com/binary-to-decimal-converter\" rel=\"nofollow noreferrer\">binary to decimal</a> converter I used). Intuition tells me that some of the bits must be reserved for that information. Which ones?</li>\n</ul>\n\n<p>I've done a fair amount of Googling, but I'm obviously missing the resources that explain this well, so feel free to explain like I'm 5. Please also feel free to correct terminology misuses.</p>\n"}, {"tags": ["dictionary", "go", "assertion"], "comments": [{"owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "edited": false, "score": 1, "creation_date": 1456771408, "post_id": 35706501, "comment_id": 59090834, "body": "So why don&#39;t you use <code>map[string]float64</code> as your fields type instead of <code>interface{}</code>?"}, {"owner": {"reputation": 737, "user_id": 5998704, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2bb384518ab3b658ffe63bac77bafddf?s=128&d=identicon&r=PG&f=1", "display_name": "rodrigolece", "link": "https://stackoverflow.com/users/5998704/rodrigolece"}, "reply_to_user": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "edited": false, "score": 0, "creation_date": 1456775521, "post_id": 35706501, "comment_id": 59093377, "body": "Because it&#39;s not the only kind of data that I parse from JSON, it can also be a <code>string</code> or an <code>int</code>. I should rephrase, &quot;it can sometimes be a map, and when it is, JSON puts it inside a <code>map[string]inteface{}</code>.&quot;"}, {"owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "edited": false, "score": 0, "creation_date": 1456775798, "post_id": 35706501, "comment_id": 59093551, "body": "Do you know what type it will be before parsing the JSON?"}, {"owner": {"reputation": 2028, "user_id": 711336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b48c9965a4ceb5193259840d3abdf38b?s=128&d=identicon&r=PG", "display_name": "s7anley", "link": "https://stackoverflow.com/users/711336/s7anley"}, "edited": false, "score": 0, "creation_date": 1456778074, "post_id": 35706501, "comment_id": 59094875, "body": "Can you provide sample JSON data and struct to which you are trying to Unmarshal? From your example it&#39;s not really clear what you want to achieve."}, {"owner": {"reputation": 737, "user_id": 5998704, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2bb384518ab3b658ffe63bac77bafddf?s=128&d=identicon&r=PG&f=1", "display_name": "rodrigolece", "link": "https://stackoverflow.com/users/5998704/rodrigolece"}, "reply_to_user": {"reputation": 2028, "user_id": 711336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b48c9965a4ceb5193259840d3abdf38b?s=128&d=identicon&r=PG", "display_name": "s7anley", "link": "https://stackoverflow.com/users/711336/s7anley"}, "edited": false, "score": 0, "creation_date": 1456792448, "post_id": 35706501, "comment_id": 59101760, "body": "No, I do not know in advance. @s7anley, I edited my comment to show the actual data."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1456794587, "post_id": 35706501, "comment_id": 59102402, "body": "Type assertion won&#39;t do it; you have to actually loop over the <code>map[string]interface{}</code> and create a map with float keys. That&#39;s because <code>map[string]interface{}</code> and <code>map[string]float64</code> actually have different representations in memory; it can&#39;t just treat one as the other. (And <code>encoding&#47;json</code> makes a map <code>interface{}</code> keys because Go doesn&#39;t know what type the keys will be when it creates the <code>map</code>.)"}], "answers": [{"comments": [{"owner": {"reputation": 737, "user_id": 5998704, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2bb384518ab3b658ffe63bac77bafddf?s=128&d=identicon&r=PG&f=1", "display_name": "rodrigolece", "link": "https://stackoverflow.com/users/5998704/rodrigolece"}, "edited": false, "score": 0, "creation_date": 1457107952, "post_id": 35719624, "comment_id": 59271062, "body": "Yes I think I can do a little bit of plumbing to define <code>Content</code> as <code>map[string]float64</code>. It&#39;s gonna save me the new map and it&#39;s worth it. Thanks!"}], "tags": [], "owner": {"reputation": 2028, "user_id": 711336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b48c9965a4ceb5193259840d3abdf38b?s=128&d=identicon&r=PG", "display_name": "s7anley", "link": "https://stackoverflow.com/users/711336/s7anley"}, "is_accepted": true, "score": 6, "last_activity_date": 1457864839, "last_edit_date": 1457864839, "creation_date": 1456825911, "answer_id": 35719624, "question_id": 35706501, "link": "https://stackoverflow.com/questions/35706501/go-type-assertion-for-maps/35719624#35719624", "title": "Go: type assertion for maps", "body": "<p>You cannot type assert <code>map[string]interface{}</code> to <code>map[string]float64</code>. You need to manually create new map.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nvar exampleResponseData = `{\n        \"Data\":[\n            {\n                \"Type\":\"pos\",\n                \"Content\":{\n                    \"x\":0.5,\n                    \"y\":0.3\n                }\n            },\n            {\n                \"Type\":\"vel\",\n                \"Content\":{\n                    \"vx\":0.1,\n                    \"vy\":-0.2\n                }\n            }\n        ]\n    }`\n\ntype response struct {\n    Data []struct {\n        Type    string\n        Content interface{}\n    }\n}\n\nfunc main() {\n    var response response\n    err := json.Unmarshal([]byte(exampleResponseData), &amp;response)\n    if err != nil {\n        fmt.Println(\"Cannot process not valid json\")\n    }\n\n    for i := 0; i &lt; len(response.Data); i++ {\n        response.Data[i].Content = convertMap(response.Data[i].Content)\n    }\n}\n\nfunc convertMap(originalMap interface{}) map[string]float64 {\n    convertedMap := map[string]float64{}\n    for key, value := range originalMap.(map[string]interface{}) {\n        convertedMap[key] = value.(float64)\n    }\n\n    return convertedMap\n}\n</code></pre>\n\n<p>Are you sure you cannot define <code>Content</code> as  <code>map[string]float64</code>? See example below. If not, how can you know that you can cast it in the first place? </p>\n\n<pre><code>type response struct {\n    Data []struct {\n        Type    string\n        Content map[string]float64\n    }\n}\n\nvar response response\nerr := json.Unmarshal([]byte(exampleResponseData), &amp;response)\n</code></pre>\n"}], "owner": {"reputation": 737, "user_id": 5998704, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2bb384518ab3b658ffe63bac77bafddf?s=128&d=identicon&r=PG&f=1", "display_name": "rodrigolece", "link": "https://stackoverflow.com/users/5998704/rodrigolece"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7030, "favorite_count": 1, "accepted_answer_id": 35719624, "answer_count": 1, "score": 5, "last_activity_date": 1457864839, "creation_date": 1456769425, "last_edit_date": 1456792352, "question_id": 35706501, "link": "https://stackoverflow.com/questions/35706501/go-type-assertion-for-maps", "title": "Go: type assertion for maps", "body": "<p>I'm reading data structures from JSON. There's a little bit of conversions going on and at the end I have a <code>struct</code> where one of the fields is of type <code>interface{}</code>. It's actually a map, so JSON puts it inside a <code>map[string]inteface{}</code>. </p>\n\n<p>I actually know that the underlying structure is <code>map[string]float64</code> and I would like to use it like that, so I try to do an assertion. The following code reproduces the behaviour:</p>\n\n<pre><code>type T interface{}\n\nfunc jsonMap() T {\n    result := map[string]interface{}{\n        \"test\": 1.2,\n    }\n    return T(result)\n}\n\nfunc main() {\n    res := jsonMap()\n\n    myMap := res.(map[string]float64)\n\n    fmt.Println(myMap)\n}\n</code></pre>\n\n<p>I get the error:</p>\n\n<pre><code>panic: interface conversion: main.T is map[string]interface {}, not map[string]float64\n</code></pre>\n\n<p>I can do the following:</p>\n\n<pre><code>func main() {\n    // A first assertion\n    res := jsonMap().(map[string]interface{})\n\n    myMap := map[string]float64{\n        \"test\": res[\"test\"].(float64), // A second assertion\n    }\n\n    fmt.Println(myMap)\n}\n</code></pre>\n\n<p>This works fine, but I find it very ugly since I need to reconstruct the whole map and use two assertions. Is there a correct way to force the first assertion to drop the <code>interface{}</code> and use <code>float64</code>? In other words, what is the correct way to do the original assertion <code>.(map[string]float64)</code>?</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>The actual data I'm parsing looks like this:</p>\n\n<pre><code>[\n {\"Type\":\"pos\",\n \"Content\":{\"x\":0.5 , y: 0.3}} ,\n\n{\"Type\":\"vel\",\n\"Content\":{\"vx\": 0.1, \"vy\": -0.2}}\n]\n</code></pre>\n\n<p>In Go I use a <code>struct</code> and <code>encoding/json</code> in the following way. </p>\n\n<pre><code>type data struct {\n    Type string\n    Content interface{}\n}\n\n// I read the JSON from a WebSocket connection\n_, event, _ := c.ws.ReadMessage()\n\nj := make([]data,0)\njson.Unmarshal(event, &amp;j)\n</code></pre>\n"}, {"tags": ["go", "docker"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456770885, "post_id": 35706289, "comment_id": 59090538, "body": "<code>-i</code> runs <code>go install</code> . If you need to fetch the dependencies, you need <code>go get</code>"}, {"owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456774929, "post_id": 35706289, "comment_id": 59092992, "body": "my troubleshooting attempt went into the wrong direction - I can see that now. I am going to rewrite the question..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456778564, "post_id": 35706289, "comment_id": 59095168, "body": "You need the toolchain built for the target platform. There used to be images tagged with <code>-cross</code> which had the toolchain pre-built for cross compilation, but it seems they no longer provide those."}, {"owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456778833, "post_id": 35706289, "comment_id": 59095344, "body": "my understanding is that they do not provide the xy-cross containers since this is covered by the standard ones. The error message does not indicate anything missing in the toolchain."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456779310, "post_id": 35706289, "comment_id": 59095647, "body": "Oh, you&#39;re right. The problem is your executing <code>go build</code> locally, not in the container."}], "owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1456775200, "creation_date": 1456768731, "last_edit_date": 1456775200, "question_id": 35706289, "link": "https://stackoverflow.com/questions/35706289/cant-figure-out-how-to-cross-compile-using-docker-container", "title": "cant figure out how to cross compile using docker container", "body": "<p>I am trying to cross compile some Go code to a windows target (based on this guide <a href=\"https://hub.docker.com/_/golang/\" rel=\"nofollow\">https://hub.docker.com/_/golang/</a>):</p>\n\n<pre><code>$ docker run --rm -v \"$PWD\":/usr/src/myapp -w /usr/src/myapp -e GOOS=windows -e GOARCH=386 golang:1.5 go get github.com/gorilla/websocket &amp;&amp; go build -v\nconn.go:8:2: cannot find package \"github.com/gorilla/websocket\" in any of:\n/usr/lib/go/src/github.com/gorilla/websocket (from $GOROOT)\n/home/mark/devel/gocode/src/github.com/gorilla/websocket (from $GOPATH)\n</code></pre>\n\n<p>I try to compile this: <a href=\"https://github.com/gorilla/websocket/tree/master/examples/chat\" rel=\"nofollow\">https://github.com/gorilla/websocket/tree/master/examples/chat</a>) \n...but I can not figure out the correct command line :(</p>\n"}, {"tags": ["datetime", "go"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 4, "last_activity_date": 1456982043, "creation_date": 1456982043, "answer_id": 35763731, "question_id": 35705146, "link": "https://stackoverflow.com/questions/35705146/convert-date-from-human-readable-format-golang/35763731#35763731", "title": "Convert date from human readable format golang", "body": "<p>This is tricky because those libraries (like <a href=\"https://github.com/xeonx/timeago\" rel=\"nofollow\"><code>timeago</code></a>) would also translate time in \"less than a minute ago\" (which you cannot translate back into an exact time)</p>\n\n<p>For exact expressions (like \"3 months ago\"), you need to use <a href=\"https://golang.org/pkg/time/#Time.AddDate\" rel=\"nofollow\"><code>time.AddDate()</code></a> (here <code>t.AddDate(0, -3, 0).Month()</code>)</p>\n\n<p>Then you can format the resulting time into any date format you want with <a href=\"https://golang.org/pkg/time/#example_Time_Format\" rel=\"nofollow\"><code>Time.Format</code></a> or <a href=\"https://github.com/metakeule/fmtdate\" rel=\"nofollow\"><code>metakeule/fmtdate</code></a>.</p>\n"}], "owner": {"reputation": 378, "user_id": 4584060, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f92ddb544499541e5451d408832ac134?s=128&d=identicon&r=PG&f=1", "display_name": "RuslanN", "link": "https://stackoverflow.com/users/4584060/ruslann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1562, "favorite_count": 3, "accepted_answer_id": 35763731, "answer_count": 1, "score": 4, "last_activity_date": 1456982043, "creation_date": 1456765072, "last_edit_date": 1456769400, "question_id": 35705146, "link": "https://stackoverflow.com/questions/35705146/convert-date-from-human-readable-format-golang", "title": "Convert date from human readable format golang", "body": "<p>I know that there is a <a href=\"https://github.com/dustin/go-humanize\" rel=\"nofollow\">library</a> for doing opposite. I need to format string, for example, \"a year ago\" to any date format \"29/02/15\".</p>\n"}, {"tags": ["google-app-engine", "go", "google-compute-engine", "google-managed-vm"], "owner": {"reputation": 47233, "user_id": 119081, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4fa5be67e1e4b49c0765d218cfe7689b?s=128&d=identicon&r=PG", "display_name": "Blixt", "link": "https://stackoverflow.com/users/119081/blixt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1456764526, "creation_date": 1456764526, "question_id": 35704956, "link": "https://stackoverflow.com/questions/35704956/managed-vm-running-go-1-6-having-issues-maintaining-http-2-clients", "title": "Managed VM running Go 1.6 having issues maintaining HTTP/2 clients", "body": "<p>I'm trying to send requests to Apple's APNS service using their HTTP/2 API, and my service is working fine locally, but once it's on a Managed VM it seems the underlying sockets are dying after a few minutes and the Go HTTP library is unable to handle it gracefully.</p>\n\n<p>What I see is the requests working fine (getting responses) for a while, but if it's idle for a few minutes the connections will take minutes to time out with <code>read tcp 172.17.0.4:35395-&gt;17.172.234.19:443: read: connection timed out</code> (apparently ignoring the 10 second timeout I specified).</p>\n\n<p>I've previously had keep-alive issues with Managed VMs specifically, but Google has indicated it should be fixed. Does anyone know how to avoid this issue?</p>\n\n<p>I'm creating an HTTP/2 client in this way:</p>\n\n<pre><code>func NewClient() *http.Client {\n    cert, err := tls.LoadX509KeyPair(\"secrets/prod_voip.pem\", \"secrets/prod_voip.key\")\n    if err != nil {\n        log.Fatalln(err)\n    }\n    config := &amp;tls.Config{\n        Certificates: []tls.Certificate{cert},\n    }\n    config.BuildNameToCertificate()\n    dialer := &amp;net.Dialer{\n        Timeout: 10 * time.Second,\n    }\n    transport := &amp;http.Transport{\n        Dial:            dialer.Dial,\n        TLSClientConfig: config,\n    }\n    // Explicitly enable HTTP/2 as TLS-configured clients don't auto-upgrade.\n    // See: https://github.com/golang/go/issues/14275\n    if err := http2.ConfigureTransport(transport); err != nil {\n        log.Fatalln(err)\n    }\n    return &amp;http.Client{Transport: transport}\n}\n</code></pre>\n"}, {"tags": ["arrays", "go", "range", "slice"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1456793001, "last_edit_date": 1456793001, "creation_date": 1456767117, "answer_id": 35705756, "question_id": 35704948, "link": "https://stackoverflow.com/questions/35704948/generate-array-with-with-range-of-integers/35705756#35705756", "title": "Generate array with with range of integers", "body": "<p>You can make use of the <code>for ... range</code> construct to make it more compact and maybe even faster:</p>\n\n<pre><code>lo, hi := 3, 6\ns := make([]int, hi-lo+1)\nfor i := range s {\n    s[i] = i + lo\n}\n</code></pre>\n\n<p>As a matter of curiosity, the loop can be implemented without a loop variable, but it will be slower, and the code longer. By decrementing <code>hi</code>:</p>\n\n<pre><code>for ; hi &gt;= lo; hi-- {\n    s[hi-len(s)+1] = hi\n}\n</code></pre>\n\n<p>Or incrementing <code>lo</code>:</p>\n\n<pre><code>for ; lo &lt;= hi; lo++ {\n    s[len(s)-1-hi+lo] = lo\n}\n</code></pre>\n"}], "owner": {"reputation": 390, "user_id": 5605294, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/HRKeI.jpg?s=128&g=1", "display_name": "barthr", "link": "https://stackoverflow.com/users/5605294/barthr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 0, "accepted_answer_id": 35705756, "answer_count": 1, "score": 0, "last_activity_date": 1483017773, "creation_date": 1456764482, "last_edit_date": 1483017773, "question_id": 35704948, "link": "https://stackoverflow.com/questions/35704948/generate-array-with-with-range-of-integers", "title": "Generate array with with range of integers", "body": "<p>I have two values:</p>\n\n<blockquote>\n  <p>[3:6]</p>\n</blockquote>\n\n<p>I was trying to play something around in Golang but I can't manage to find a good method to create an array according to those values.</p>\n\n<p>This what I would like to achieve:</p>\n\n<pre><code>[3,4,5,6]\n</code></pre>\n"}, {"tags": ["go", "aws-sdk", "terraform", "aws-sdk-go"], "comments": [{"owner": {"reputation": 1251, "user_id": 3655695, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/42f05fe122cfe8437cfcf79be6631b74?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3655695/sam"}, "edited": false, "score": 0, "creation_date": 1456745414, "post_id": 35696531, "comment_id": 59073307, "body": "Added more finding in the actual question."}], "answers": [{"comments": [{"owner": {"reputation": 1251, "user_id": 3655695, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/42f05fe122cfe8437cfcf79be6631b74?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3655695/sam"}, "edited": false, "score": 0, "creation_date": 1456823231, "post_id": 35705171, "comment_id": 59112704, "body": "yes i have called go get -u github.com/aws/aws-sdk-go after this i can see latest aws-sdk-go in my \\github.com\\aws\\aws-sdk-go . Then i called godep update however getting message as no package can be updated. added the image in the question. Thanks for your time."}, {"owner": {"reputation": 1251, "user_id": 3655695, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/42f05fe122cfe8437cfcf79be6631b74?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3655695/sam"}, "edited": false, "score": 0, "creation_date": 1456847250, "post_id": 35705171, "comment_id": 59129378, "body": "with more googling i think the idea is as below to update the deps                go get [your deps] cd $GOPATH/src/github.com/[deps path] godep save . then we should able to see latest version in Godep.json file . in my case its coming as blank . trying to figure out as why?"}, {"owner": {"reputation": 934, "user_id": 3239666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638873245dd9cdc579bf551818c11fb3?s=128&d=identicon&r=PG&f=1", "display_name": "GarMan", "link": "https://stackoverflow.com/users/3239666/garman"}, "reply_to_user": {"reputation": 1251, "user_id": 3655695, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/42f05fe122cfe8437cfcf79be6631b74?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3655695/sam"}, "edited": false, "score": 0, "creation_date": 1456852123, "post_id": 35705171, "comment_id": 59133016, "body": "Is aws-sdk-go in your <code>Godeps&#47;Godeps.json</code> ?"}, {"owner": {"reputation": 934, "user_id": 3239666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638873245dd9cdc579bf551818c11fb3?s=128&d=identicon&r=PG&f=1", "display_name": "GarMan", "link": "https://stackoverflow.com/users/3239666/garman"}, "reply_to_user": {"reputation": 1251, "user_id": 3655695, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/42f05fe122cfe8437cfcf79be6631b74?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3655695/sam"}, "edited": false, "score": 0, "creation_date": 1456852146, "post_id": 35705171, "comment_id": 59133030, "body": "You shouldn&#39;t need to cd into your deps, you should be able to just do everything in the main folder of your app. I should note that I have never used godeps on windows, and I don&#39;t know if that is the cause of the problem or not, it shouldn&#39;t be."}, {"owner": {"reputation": 1251, "user_id": 3655695, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/42f05fe122cfe8437cfcf79be6631b74?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3655695/sam"}, "edited": false, "score": 0, "creation_date": 1457070119, "post_id": 35705171, "comment_id": 59248117, "body": "I am now able to call go get -u github.com/aws/aws-sdk-go and godep update. But to do this i had to call go get ./... before as per link hint  <a href=\"http://stackoverflow.com/questions/35766457/godep-save-seems-not-working-for-https-github-com-hashicorp-terraform/35766543?noredirect=1#comment59206420_35766543\" title=\"godep save seems not working for https github com hashicorp terraform\">stackoverflow.com/questions/35766457/&hellip;</a>"}, {"owner": {"reputation": 1251, "user_id": 3655695, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/42f05fe122cfe8437cfcf79be6631b74?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3655695/sam"}, "edited": false, "score": 0, "creation_date": 1457070195, "post_id": 35705171, "comment_id": 59248146, "body": "Now next i can see Godeps/Godeps.json has latest deps which i have verified with git  master. Now when i call godep go build it should replace my old deps with new one  but this is not happening. any guess for this ?"}], "tags": [], "owner": {"reputation": 934, "user_id": 3239666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638873245dd9cdc579bf551818c11fb3?s=128&d=identicon&r=PG&f=1", "display_name": "GarMan", "link": "https://stackoverflow.com/users/3239666/garman"}, "is_accepted": false, "score": 0, "last_activity_date": 1456765145, "creation_date": 1456765145, "answer_id": 35705171, "question_id": 35696531, "link": "https://stackoverflow.com/questions/35696531/terraform-process-to-update-vendor-aws-sdk-go-dependencies-to-latest/35705171#35705171", "title": "Terraform - Process to Update vendor aws-sdk-go dependencies to latest", "body": "<p><code>godep update</code> will update the vendored version from your global gopath version. To get the latest version in your gopath run something like <code>go get -u github.com/aws/aws-sdk-go</code> then you can run your <code>godep update</code> </p>\n"}], "owner": {"reputation": 1251, "user_id": 3655695, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/42f05fe122cfe8437cfcf79be6631b74?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3655695/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 366, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1489195062, "creation_date": 1456739800, "last_edit_date": 1592644375, "question_id": 35696531, "link": "https://stackoverflow.com/questions/35696531/terraform-process-to-update-vendor-aws-sdk-go-dependencies-to-latest", "title": "Terraform - Process to Update vendor aws-sdk-go dependencies to latest", "body": "<p>Hi I am trying to understand as how to update the aws-sdk-go dependencies for terraform. To do this i have configured the</p>\n<ol>\n<li><p>GOPATH as per instruction given below.</p>\n<p><a href=\"http://www.wadewegner.com/2014/12/easy-go-programming-setup-for-windows/\" rel=\"nofollow noreferrer\">http://www.wadewegner.com/2014/12/easy-go-programming-setup-for-windows/</a></p>\n</li>\n<li><p>I have installed and configured &quot;godep&quot; in $path.\nSo now i am able to run &quot;go&quot; and &quot;godep&quot; from cmd.</p>\n</li>\n</ol>\n<p>as per development terraform section\\guideline given at\n<a href=\"https://github.com/hashicorp/terraform\" rel=\"nofollow noreferrer\">https://github.com/hashicorp/terraform</a> i have git cloned\nit at  <code>$GOPATH/src/github.com/hashicorp/terraform</code></p>\n<p>again as per guideline i just want to update aws-sdk-go deps. so i am running</p>\n<pre><code>godep update github.com\\aws\\aws-sdk-go \n</code></pre>\n<p>getting below message on cmd</p>\n<pre><code>godep: not in manifest: github.com\\aws\\aws-sdk-go\n\ngodep: Package (github.com/Azure/azure-sdk-for-go/Godeps/_workspace/src/github.com/Azure/go-autorest/autorest) not found \n</code></pre>\n<p>I have also verified that path</p>\n<pre><code> D:\\Ampush\\Projects\\GO\\src\\github.com\\hashicorp\\terraform\\vendor\\github.com\\Azure\\azure-sdk-for-go\\Godeps\\_workspace\\src\\github.com\\Azure\\go-autorest\\autorest\n</code></pre>\n<p>exists on my machine.</p>\n<p>I am running command from below path</p>\n<pre><code>D:\\Ampush\\Projects\\GO\\src\\github.com\\hashicorp\\terraform&gt;\n</code></pre>\n<p>Updating this further with more findings</p>\n<p>if i run first godep restore -v then it has downloaded many stuffs.\nthen i figured out that my command was wrong now i updated it to</p>\n<pre><code>godep update github.com/aws/aws-sdk-go/aws  //hint saw in Godep.json\n</code></pre>\n<p>Now i am getting</p>\n<pre><code>godep: no packages can be updated\n</code></pre>\n<p>i guess that somewhere i have to mention as to which version i should update default i was assuming it will take latest from the master.</p>\n<p><a href=\"https://i.stack.imgur.com/hHeig.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hHeig.png\" alt=\"cmd image\" /></a>\nCould you please let me know if i am missing something. Thanks</p>\n"}, {"tags": ["memory", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1456735975, "post_id": 35694703, "comment_id": 59067438, "body": "How do you measure &quot;increase of memory&quot; and which type of memory are you talking about. Most probably everything is fine; skimming your code it looks okay. And of course your code will consume more memory if you allocate 2 billion ints as this is 8 GByte at least."}, {"owner": {"reputation": 1426, "user_id": 1520594, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1fcaa128750715b5631f1c2c109e4eb?s=128&d=identicon&r=PG", "display_name": "algrebe", "link": "https://stackoverflow.com/users/1520594/algrebe"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1456736314, "post_id": 35694703, "comment_id": 59067652, "body": "@Volker I start a htop and monitor RES memory. Yes, on a 64 bit machine it takes around 16 GB at startup, but the moment I start reading from stdin it shoots up and never stops . (Updated question to reflect comment as well )."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1456738265, "post_id": 35694703, "comment_id": 59068827, "body": "Are you sure it really doesn&#39;t stop? To take a look at memory follow <a href=\"http://dave.cheney.net/2015/11/29/a-whirlwind-tour-of-gos-runtime-environment-variables\" rel=\"nofollow noreferrer\">dave.cheney.net/2015/11/29/&hellip;</a> especially GODEBUG and gctrace which is much more helpful than (h)top"}, {"owner": {"reputation": 1426, "user_id": 1520594, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1fcaa128750715b5631f1c2c109e4eb?s=128&d=identicon&r=PG", "display_name": "algrebe", "link": "https://stackoverflow.com/users/1520594/algrebe"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1456741454, "post_id": 35694703, "comment_id": 59070867, "body": "@Volker  just to confirm - a continuous increase in RES for this process establishes the fact that memory is increasing. I will have to use godebug and gctrace to find out the reason for it right ? Also, &quot;doesn&#39;t really stop&quot; is what I assumed when it increased from 16 (what it is supposed to be )  to 32 gigs ( my ram limit ) after which it went into swap so I killed it."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1456742359, "post_id": 35694703, "comment_id": 59071457, "body": "Not necessarily. The concept of &quot;memory&quot; is complicated, e.g. Go reservers large junks but may not use it and may or may not return them to the OS which is unproblematic. What&#39;s definitively &quot;wrong&quot; with your code that you allocate 2*8GByte of continuous memory but your machine has just 32GByte: You pin 50% of the total RAM for two very large (but completely unused) int slices. As you did not state why you do this I&#39;d just recommend to simply not do this (or use much shorter slices or a different data structure which doesn&#39;t need continuous memory)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1456742781, "post_id": 35694703, "comment_id": 59071724, "body": "To see what is going on and what Go does with the memory given to it from the OS htop is insufficient. Use GODEBUG=&quot;gctrace=1&quot; to see &quot;inside&quot; Go&#39;s garbage collector. Probably you&#39;ll find that GC doesn&#39;t run &quot;often enough&quot;: The default for GOGC is 100 which means GC is not triggered until the heap has doubled. Probably heap doubling happens very late as you block 16GByte initially: Maybe GC doesn&#39;t kick in until 32 GByte are used which is too much for your machine. Either reduce GOGC (e.g. to 25) or as said above: To not pin 16 GByte of continuous memory into your 32GByte RAM."}, {"owner": {"reputation": 1426, "user_id": 1520594, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1fcaa128750715b5631f1c2c109e4eb?s=128&d=identicon&r=PG", "display_name": "algrebe", "link": "https://stackoverflow.com/users/1520594/algrebe"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1456743461, "post_id": 35694703, "comment_id": 59072141, "body": "@volker thank you . I shall try the gctrace and gogc  as I require the 2 continuous arrays for Union find on one billion numbers. Will post my findings here."}, {"owner": {"reputation": 1426, "user_id": 1520594, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1fcaa128750715b5631f1c2c109e4eb?s=128&d=identicon&r=PG", "display_name": "algrebe", "link": "https://stackoverflow.com/users/1520594/algrebe"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1456752465, "post_id": 35694703, "comment_id": 59077784, "body": "@Volker that did the trick ! I&#39;ve captured it in an answer for others"}], "answers": [{"comments": [{"owner": {"reputation": 1426, "user_id": 1520594, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1fcaa128750715b5631f1c2c109e4eb?s=128&d=identicon&r=PG", "display_name": "algrebe", "link": "https://stackoverflow.com/users/1520594/algrebe"}, "edited": false, "score": 0, "creation_date": 1456752287, "post_id": 35700697, "comment_id": 59077646, "body": "@Volker thank you for all the help. I&#39;ve tried to capture it as best I can in this answer. If you have anything more useful to add feel free to edit !"}], "tags": [], "owner": {"reputation": 1426, "user_id": 1520594, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1fcaa128750715b5631f1c2c109e4eb?s=128&d=identicon&r=PG", "display_name": "algrebe", "link": "https://stackoverflow.com/users/1520594/algrebe"}, "is_accepted": true, "score": 2, "last_activity_date": 1456752239, "last_edit_date": 1495540124, "creation_date": 1456752239, "answer_id": 35700697, "question_id": 35694703, "link": "https://stackoverflow.com/questions/35694703/continuous-memory-increase-when-declaring-very-large-array-and-iterating-over-st/35700697#35700697", "title": "Continuous memory increase when declaring very large array and iterating over stdin", "body": "<p>Thank you <a href=\"https://stackoverflow.com/users/1266756/volker\" title=\"Volker\">Volker</a> for your above comments. I wanted to capture the process of debugging this as an answer.</p>\n\n<p>The RES <code>top / htop</code> just tells you at a process level what is going on with memory. GODEBUG=\"gctrace=1\" gives you more insight into how the memory is being handled.</p>\n\n<p>A simple run with gctrace set gives the following</p>\n\n<pre><code>root@localhost ~ # yes \"12345678901234567890123456789012\" | GODEBUG=\"gctrace=1\" go run badcase.go\nstarting...\nallocating\ninitializing mystruct arr1...\ninitializing mystruct arr2...\ngc 1 @0.050s 0%: 0.19+0.23+0.068 ms clock, 0.58+0.016/0.16/0.25+0.20 ms cpu, 7629-&gt;7629-&gt;7629 MB, 7630 MB goal, 8 P\ndone initializing ...\ngc 2 @0.100s 0%: 0.070+2515+0.23 ms clock, 0.49+0.025/0.096/0.24+1.6finished allocating..1000000000 1000000000\n ms cpu, 15258-&gt;15258reading from stdin...\n-&gt;15258 MB, 15259read 0 lines...\n MB goal, 8 P\ngc 3 @2.620s 0%: 0.009+0.32+0.23 ms clock, 0.072+0/0.20/0.11+1.8 ms cpu, 15259-&gt;15259-&gt;15258 MB, 30517 MB goal, 8 P\n\nread 1000000 lines...\nread 2000000 lines...\nread 3000000 lines...\nread 4000000 lines...\n....\nread 51000000 lines...\nread 52000000 lines...\nread 53000000 lines...\nread 54000000 lines...\n</code></pre>\n\n<blockquote>\n  <p>What does this mean ?</p>\n</blockquote>\n\n<p>As you can see, the gc hasn't been called for a while now. This means that all the garbage generated from reader.ReadString hasn't been collected and free'd.</p>\n\n<blockquote>\n  <p>Why isn't the garbage collector collecting this garbage ?</p>\n</blockquote>\n\n<p>From <a href=\"https://blog.golang.org/go15gc\" rel=\"nofollow noreferrer\">The go gc</a></p>\n\n<blockquote>\n  <p>Instead we provide a single knob, called GOGC. This value controls\n  the total size of the heap relative to the size of reachable objects.\n  The default value of 100 means that total heap size is now 100% bigger\n  than (i.e., twice) the size of the reachable objects after the last\n  collection.</p>\n</blockquote>\n\n<p>Since GOGC wasn't set - the default was 100%. So, it would have collected the garbage only when it reached ~32GB. ( Since initially the two arrays give you 16GB of heap space - only when heap doubles will the gc trigger ).</p>\n\n<blockquote>\n  <p>How can I change this ?\n  Try setting the GOGC=25.</p>\n</blockquote>\n\n<p>With the GOGC as 25</p>\n\n<pre><code>root@localhost ~ # yes \"12345678901234567890123456789012\" | GODEBUG=\"gctrace=1\" GOGC=25 go run badcase.go\nstarting...\nallocating\ninitializing mystruct arr1...\ninitializing mystruct arr2...\ngc 1 @0.051s 0%: 0.14+0.30+0.11 ms clock, 0.42+0.016/0.31/0.094+0.35 ms cpu, 7629-&gt;7629-&gt;7629 MB, 7630 MB goal, 8 P\ndone initializing ...\nfinished allocating..1000000000 1000000000\ngc 2 @0.102s reading from stdin...\n12%: 0.058+2480+0.26 ms clock, 0.40+0.022/2480/0.10+1.8 ms cpu, 15258-&gt;15258-&gt;15258 MB, 15259 MB goal, 8 P\nread 0 lines...\ngc 3 @2.584s 12%: 0.009+0.20+0.22 ms clock, 0.075+0/0.24/0.046+1.8 ms cpu, 15259-&gt;15259-&gt;15258 MB, 19073 MB goal, 8 P\nread 1000000 lines...\nread 2000000 lines...\nread 3000000 lines...\nread 4000000 lines...\n....\nread 19000000 lines...\nread 20000000 lines...\ngc 4 @6.539s 4%: 0.019+2.3+0.23 ms clock, 0.15+0/2.1/12+1.8 ms cpu, 17166-&gt;17166-&gt;15258 MB, 19073 MB goal, 8 P\n</code></pre>\n\n<p>As you can see, another gc was triggered.</p>\n\n<blockquote>\n  <p>But top/htop shows it stable at ~20 GB instead of the calculated 16GB.</p>\n</blockquote>\n\n<p>The garbage collector doesn't \"have\" to give it back to the OS. It will sometimes keep it to use efficiently for the future. It doesn't have to keep taking from the OS and giving back - The extra 4 gb is in its pool of free space to use before asking the OS again.</p>\n"}], "owner": {"reputation": 1426, "user_id": 1520594, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1fcaa128750715b5631f1c2c109e4eb?s=128&d=identicon&r=PG", "display_name": "algrebe", "link": "https://stackoverflow.com/users/1520594/algrebe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1703, "favorite_count": 4, "accepted_answer_id": 35700697, "answer_count": 1, "score": 3, "last_activity_date": 1575278313, "creation_date": 1456733786, "last_edit_date": 1592644375, "question_id": 35694703, "link": "https://stackoverflow.com/questions/35694703/continuous-memory-increase-when-declaring-very-large-array-and-iterating-over-st", "title": "Continuous memory increase when declaring very large array and iterating over stdin", "body": "<p>The following code declares two arrays, and then iterates over stdin ( just blindly iterates over the file - no interaction with the arrays ).</p>\n<p>This is causing continuous increase in memory.</p>\n<p>However, if I just declare two arrays and sleep - there is no increase in memory.</p>\n<p>Similarly, if I just iterate over stdin - there is no increase in memory.</p>\n<p>But together ( apart from the memory allocated for the arrays) there is a continuous increase.</p>\n<p>I measure this by looking at the RES memory using top tool.</p>\n<p>I have commented out the first few lines in <code>func doSomething()</code> to show that there is no memory increase when it is commented. Uncommenting the lines and running will cause an increase.</p>\n<blockquote>\n<p>NOTE: This was run on go 1.4.2, 1.5.3 and 1.6</p>\n<p>NOTE: You will need to recreate this on a machine with at least 16GB RAM as I have observed it only on the array size of 1 billion.</p>\n</blockquote>\n<pre class=\"lang-go prettyprint-override\"><code>package main\n\nimport (\n    &quot;bufio&quot;\n    &quot;fmt&quot;\n    &quot;io&quot;\n    &quot;os&quot;\n)\n\ntype MyStruct struct {\n    arr1 []int\n    arr2 []int\n}\n\nfunc (ms *MyStruct) Init(size int, arr1 []int, arr2 []int) error {\n    fmt.Printf(&quot;initializing mystruct arr1...\\n&quot;)\n    ms.arr1 = arr1\n    if ms.arr1 == nil {\n        ms.arr1 = make([]int, size, size)\n    }\n    fmt.Printf(&quot;initializing mystruct arr2...\\n&quot;)\n    ms.arr2 = arr2\n    if ms.arr2 == nil {\n        ms.arr2 = make([]int, size, size)\n    }\n    fmt.Printf(&quot;done initializing ...\\n&quot;)\n    for i := 0; i &lt; size; i++ {\n        ms.arr1[i] = 0\n        ms.arr2[i] = 0\n    }\n    return nil\n}\n\nfunc doSomething() error {\n    fmt.Printf(&quot;starting...\\n&quot;)\n    fmt.Printf(&quot;allocating\\n&quot;)\n    /* NOTE WHEN UNCOMMENTED CAUSES MEMORY INCREASE \n    ms := &amp;MyStruct{}\n    size := 1000000000\n    ms.Init(size, nil, nil)\n    */\n\n    fmt.Printf(&quot;finished allocating..%d %d\\n&quot;, len(ms.arr1), len(ms.arr2))\n\n    fmt.Printf(&quot;reading from stdin...\\n&quot;)\n    reader := bufio.NewReader(os.Stdin)\n\n    var line string\n    var readErr error\n    var lineNo int = 0\n    for {\n        if lineNo%1000000 == 0 {\n            fmt.Printf(&quot;read %d lines...\\n&quot;, lineNo)\n        }\n        lineNo++\n\n        line, readErr = reader.ReadString('\\n')\n        if readErr != nil {\n            fmt.Printf(&quot;break at %s\\n&quot;, line)\n            break\n        }\n    }\n\n    if readErr == io.EOF {\n        readErr = nil\n    }\n\n    if readErr != nil {\n        return readErr\n    }\n\n    return nil\n}\n\nfunc main() {\n    if err := doSomething(); err != nil {\n        panic(err)\n    }\n    fmt.Printf(&quot;done...\\n&quot;)\n}\n</code></pre>\n<ol>\n<li>Is this an issue with my code ? Or is the go system doing something unintended ?</li>\n<li>If its the latter, how can I go about debugging this ?</li>\n</ol>\n<p>To make it easier to replicate here are pastebin files for good case ( commented portion of the above code) and bad case ( with uncommented portion )</p>\n<pre class=\"lang-bash prettyprint-override\"><code>wget http://pastebin.com/raw/QfG22xXk -O badcase.go\nyes &quot;1234567890&quot; | go run badcase.go\n\nwget http://pastebin.com/raw/G9xS2fKy -O goodcase.go\nyes &quot;1234567890&quot; | go run goodcase.go\n</code></pre>\n"}, {"tags": ["authentication", "go", "oauth-2.0", "authorization"], "comments": [{"owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "edited": false, "score": 0, "creation_date": 1456746535, "post_id": 35694470, "comment_id": 59073969, "body": "<a href=\"https://github.com/RangelReale/osin\" rel=\"nofollow noreferrer\">github.com/RangelReale/osin</a>"}, {"owner": {"reputation": 2684, "user_id": 784519, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8ed38b4892e7d5f106d8dfde7a4df4fe?s=128&d=identicon&r=PG", "display_name": "davidkomer", "link": "https://stackoverflow.com/users/784519/davidkomer"}, "reply_to_user": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "edited": false, "score": 0, "creation_date": 1456746628, "post_id": 35694470, "comment_id": 59074031, "body": "works on top of existing system (i.e. doesn&#39;t take over how passwords are stored etc.)?"}, {"owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "edited": false, "score": 0, "creation_date": 1456753611, "post_id": 35694470, "comment_id": 59078653, "body": "Check out the examples on how to integrate."}, {"owner": {"reputation": 2684, "user_id": 784519, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8ed38b4892e7d5f106d8dfde7a4df4fe?s=128&d=identicon&r=PG", "display_name": "davidkomer", "link": "https://stackoverflow.com/users/784519/davidkomer"}, "reply_to_user": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "edited": false, "score": 0, "creation_date": 1456755834, "post_id": 35694470, "comment_id": 59080164, "body": "Yeah - seems like it might be a good solution, thanks. Still looking for answers to the question though just in case I need to roll my own ;)"}, {"owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "edited": false, "score": 1, "creation_date": 1456756141, "post_id": 35694470, "comment_id": 59080376, "body": "I could answer that as well, as i did exactly that. However it would be way to long as an answer here. So if you have specific questions regarding oauth2  in go, just ask per question. I can tell you though, you will not get around reading the spec if you intend to implement it."}], "owner": {"reputation": 2684, "user_id": 784519, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8ed38b4892e7d5f106d8dfde7a4df4fe?s=128&d=identicon&r=PG", "display_name": "davidkomer", "link": "https://stackoverflow.com/users/784519/davidkomer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 344, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1456734684, "creation_date": 1456732777, "last_edit_date": 1456734684, "question_id": 35694470, "link": "https://stackoverflow.com/questions/35694470/add-oauth2-provider-to-existing-user-system", "title": "Add oauth2 provider to existing user system", "body": "<p>Searching for oauth2 stuff seems to bring up dozens of <code>Q&amp;A</code>'s on <code>client-side</code> integration (like how to authorize with <code>google/facebook apis</code>) or using existing providers (like solutions for popular frameworks), but I am having a hard time finding info on building a solution on top of a <code>pre-existing user/pw db</code>.</p>\n\n<p>Can someone please outline the bullet points of exactly what it needs to do in order to extend the existing system to provide <code>oauth2 authorization?</code> i.e. the existing system already provides registration, password recovery, <code>login</code>, <code>forgot email</code> - all that stuff without a framework (<code>golang</code> and password is hashed with <code>first x bytes</code> as <code>salt</code>, in case it matters). I don't want to toss it all out in place of an out-of-the-box solution which covers all that + oauth2. I want to add oauth2 by hand (or using <em>minimal</em> <code>golang libraries</code>) on top of the existing system.</p>\n\n<p>I'm currently trying to reverse engineer and look at existing code, but it's a bit confusing and when it comes to authorization/security stuff I don't want to be making guesses, even educated ones. Could look at the spec too but I don't really need cover everything in there, just the bare minimum to let another site authenticate (by calling a \"getprofile\" API after authorized, maybe I'll make that compliant with <code>openid</code> connect but never mind that for now unless there's no increase in steps).</p>\n\n<p>Sample code or libraries if any are preferred in go-lang since that's what I'm building in, but pseudo-code or vanilla code in other languages is fine too</p>\n"}, {"tags": ["go", "naming-conventions"], "answers": [{"comments": [{"owner": {"reputation": 5713, "user_id": 846163, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/623857ee8390f91edba65fcac0d152ab?s=128&d=identicon&r=PG", "display_name": "sschmeck", "link": "https://stackoverflow.com/users/846163/sschmeck"}, "edited": false, "score": 5, "creation_date": 1456732963, "post_id": 35694239, "comment_id": 59065957, "body": "Thanks. In the standard library I found only few examples and the didn&#39;t use underscores, e.g. <code>ast&#47;commentmap.go</code>. I assumed that underscores are used only for tests and platform specific implementations."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 5713, "user_id": 846163, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/623857ee8390f91edba65fcac0d152ab?s=128&d=identicon&r=PG", "display_name": "sschmeck", "link": "https://stackoverflow.com/users/846163/sschmeck"}, "edited": false, "score": 7, "creation_date": 1456733146, "post_id": 35694239, "comment_id": 59066047, "body": "There&#39;s still a big mix across the std. lib. Source file names are usually kept short, so in your case I would tend to call it <code>find.go</code> in package <code>weightedunion</code>."}, {"owner": {"reputation": 2187, "user_id": 83005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/878681330e7daa75c0767b8b129df8b8?s=128&d=identicon&r=PG", "display_name": "\u03f9\u03bf\u03b4\u03b5M\u03b5\u03b4\u03b9\u03f2", "link": "https://stackoverflow.com/users/83005/%cf%b9%ce%bf%ce%b4%ce%b5m%ce%b5%ce%b4%ce%b9%cf%b2"}, "edited": false, "score": 8, "creation_date": 1558344006, "post_id": 35694239, "comment_id": 99056212, "body": "I am not sure this is the correct answer; <code>_</code> does have a special meaning in golang, when it comes to conditional compilation   <a href=\"https://dave.cheney.net/2013/10/12/how-to-use-conditional-compilation-with-the-go-build-tool\" rel=\"nofollow noreferrer\">dave.cheney.net/2013/10/12/&hellip;</a> . Kebab case too seems unpopular with gophers. This leaves the preferred choice to be <code>weightedunionfind.go</code>; not liking it personally, but not that bothered when working with a decent IDE. Quite like mixed case, but I haven&#39;t seen many examples from others. @elithrar&#39;s comments are spot on; the idea is to make better use of packages when you are tempted to name it long."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 43, "last_activity_date": 1456755816, "last_edit_date": 1456755816, "creation_date": 1456731734, "answer_id": 35694239, "question_id": 35694137, "link": "https://stackoverflow.com/questions/35694137/file-name-convention-for-compound-words/35694239#35694239", "title": "File name convention for compound words?", "body": "<p>Although it's not formally specified in <a href=\"https://golang.org/doc/code.html#Overview\" rel=\"noreferrer\">https://golang.org/doc/code.html#Overview</a> - <code>snake_case</code> is the convention across the most of the standard library and most third party libraries. </p>\n"}], "owner": {"reputation": 5713, "user_id": 846163, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/623857ee8390f91edba65fcac0d152ab?s=128&d=identicon&r=PG", "display_name": "sschmeck", "link": "https://stackoverflow.com/users/846163/sschmeck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 20407, "favorite_count": 4, "accepted_answer_id": 35694239, "answer_count": 1, "score": 43, "last_activity_date": 1511938532, "creation_date": 1456731291, "last_edit_date": 1511938532, "question_id": 35694137, "link": "https://stackoverflow.com/questions/35694137/file-name-convention-for-compound-words", "title": "File name convention for compound words?", "body": "<p>Is there a common convention in Go to name files that contain compound words?</p>\n\n<p>For example I wrote an implementation of the <em>Weighted Union Find</em> algorithm and put it into its own source file. How should I name the file?</p>\n\n<pre><code>// mixed case\nweightedUnionFind.go\n\n// lower case\nweightedunionfind.go\n\n// snake case\nweighted_union_find.go\n</code></pre>\n\n<p>I found only a convention regarding <a href=\"https://blog.golang.org/package-names\" rel=\"noreferrer\">package names</a> and the following question about file naming conventions in general, <a href=\"https://stackoverflow.com/questions/25161774/what-are-conventions-for-filenames-in-go\">What are conventions for filenames in Go?</a>. </p>\n\n<p>Therefore I grepped through Go package source files and ended up with <code>weightedunionfind.go</code>.</p>\n"}, {"tags": ["javascript", "html", "go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "is_accepted": true, "score": 2, "last_activity_date": 1456733437, "last_edit_date": 1456733437, "creation_date": 1456733125, "answer_id": 35694544, "question_id": 35694126, "link": "https://stackoverflow.com/questions/35694126/how-to-use-dynamic-golang-html-template-id-with-javascript/35694544#35694544", "title": "How to use dynamic golang html template id with javascript?", "body": "<p>Give those buttons a class.</p>\n\n<pre><code>{{range $i, $e := .Process}}\n   &lt;input id=\"{{.}}\" class=\"img-buttons\" type=\"image\" src=\"/images/icons/pencil.png\" alt=\"edit\" width=\"15\" height=\"15\"&gt;\n{{end}}\n</code></pre>\n\n<p>In javascript you can do,</p>\n\n<pre><code>$(\".img-buttons\").click ( function() {\n    $(this).attr( \"id\" ); // get Id\n});\n</code></pre>\n\n<p>Instead of the id you can use html <a href=\"https://developer.mozilla.org/en/docs/Web/Guide/HTML/Using_data_attributes\" rel=\"nofollow\">data attributes</a> if that suits you better.</p>\n\n<p>HTML:</p>\n\n<pre><code>{{range $i, $e := .Process}}\n   &lt;input data-id=\"{{.}}\" class=\"img-buttons\" type=\"image\" src=\"/images/icons/pencil.png\" alt=\"edit\" width=\"15\" height=\"15\"&gt;\n{{end}}\n</code></pre>\n\n<p>JS:</p>\n\n<pre><code>$(\".img-buttons\").click ( function() {\n    $(this).data( \"id\" ); // get Id\n});\n</code></pre>\n"}], "owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2414, "favorite_count": 0, "accepted_answer_id": 35694544, "answer_count": 1, "score": 1, "last_activity_date": 1456733437, "creation_date": 1456731258, "question_id": 35694126, "link": "https://stackoverflow.com/questions/35694126/how-to-use-dynamic-golang-html-template-id-with-javascript", "title": "How to use dynamic golang html template id with javascript?", "body": "<p>Hi I have a html image button with dynamic id inside range in golang template. I need to add a javascript function to it. But the problem is that how could I use this dynamic Id in javascript?</p>\n\n<p>My HTML</p>\n\n<pre><code>{{range $i, $e := .Process}}\n   &lt;input id=\"id{{.}}\" type=\"image\" src=\"/images/icons/pencil.png\" alt=\"edit\" width=\"15\" height=\"15\"&gt;\n{{end}}\n</code></pre>\n\n<p>JavaScript</p>\n\n<pre><code>&lt;script type=\"text/javascript\"&gt;\n       $().ready(function() {\n            $('#id{{.}}').click(function() {\n                $('#hidebody').toggle();\n\n            });\n        });\n    &lt;/script&gt;   \n</code></pre>\n\n<p>How to solve this? Is there any better way to do this?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1456728158, "post_id": 35693027, "comment_id": 59063920, "body": "Thank you so much for writing this and the helpful link. I now understand about the binding of the variable vs its value (something I was wrongly assuming) and the fact that a variable can be masked with another variable of the same name in an inner block (I was wrong assuming that the iterative variable was scoped inside the loop block.) Thanks!"}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 5, "last_activity_date": 1456726419, "creation_date": 1456726419, "answer_id": 35693027, "question_id": 35692726, "link": "https://stackoverflow.com/questions/35692726/i-need-to-assign-a-variable-to-itself-when-iterating-for-the-closure-context-to/35693027#35693027", "title": "I need to assign a variable to itself when iterating for the closure context to keep the correct value", "body": "<p>The easiest way to visualize what is going on is to change the output of your functions to:</p>\n\n<pre><code>newElem(func(v int) { fmt.Printf(\"plus %d - %d+%d\\n\", i+v, i, v) })\nnewElem(func(v int) { fmt.Printf(\"times %d - %d*%d\\n\", i*v, i , v) })\n</code></pre>\n\n<p>With this change the output becomes:</p>\n\n<pre><code>plus 3 - 3+0\ntimes 3 - 3*1\nplus 5 - 3+2\ntimes 9 - 3*3\nplus 7 - 3+4\ntimes 15 - 3*5\n</code></pre>\n\n<p>So, as you can see, <code>i</code> is 3 in all cases.  This is because you are creating closures around the <code>i</code> variable, so the functions will use the current value of <code>i</code> when they run, which is 3 by the time the functions actually use <code>i</code>.  </p>\n\n<p>You can again see this if you change your code like the following:</p>\n\n<p><a href=\"http://play.golang.org/p/FRhr0n2oi7\" rel=\"noreferrer\">http://play.golang.org/p/FRhr0n2oi7</a></p>\n\n<p>The reason the assignment <code>i := i</code> inside your loop fixes the problem is because you are creating a new variable <code>i</code> inside the scope of your loop which is still closed over by the functions, but doesn't ever change.  Each new iteration of the loop creates a new <code>i</code> so no previous <code>i</code> changes value.</p>\n\n<p>Although this document describes a common mistake when dealing with goroutines and closures, it should shed a bit more light on the issue and potential solutions.</p>\n\n<p><a href=\"https://github.com/golang/go/wiki/CommonMistakes\" rel=\"noreferrer\">https://github.com/golang/go/wiki/CommonMistakes</a></p>\n"}], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 2, "accepted_answer_id": 35693027, "answer_count": 1, "score": 1, "last_activity_date": 1456726419, "creation_date": 1456724691, "question_id": 35692726, "link": "https://stackoverflow.com/questions/35692726/i-need-to-assign-a-variable-to-itself-when-iterating-for-the-closure-context-to", "title": "I need to assign a variable to itself when iterating for the closure context to keep the correct value", "body": "<p>Without i := i, I get an incorrect result (3, 3, 5, 9, 7, 15). With it, I get (0, 0, 3, 3, 6, 10), which is correct. Removing the assignment is similar to getting the value of i at the end of the loop. Why?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Handler interface {\n    Handle(v int)\n}\n\ntype Elem struct {\n    Handler Handler\n}\n\nvar elems []*Elem\n\ntype handlerFunc func(v int)\n\nfunc (h handlerFunc) Handle(v int) { h(v) }\n\nfunc main() {\n    newElem := func(fn handlerFunc) {\n        elem := &amp;Elem{Handler: handlerFunc(fn)}\n        elems = append(elems, elem)\n    }\n\n    for i := 0; i &lt; 3; i++ {\n        i := i // *** Why? ***\n        newElem(func(v int) { fmt.Printf(\"%d, \", i+v) })\n        newElem(func(v int) { fmt.Printf(\"%d, \", i*v) })\n    }\n\n    for n, e := range elems {\n        if e.Handler != nil {\n            e.Handler.Handle(n)\n        }\n    }\n    fmt.Printf(\"\\n\")\n}\n</code></pre>\n"}, {"tags": ["go", "docker"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 3, "last_activity_date": 1456733349, "creation_date": 1456733349, "answer_id": 35694591, "question_id": 35692667, "link": "https://stackoverflow.com/questions/35692667/in-docker-cpu-usage-calculation-what-are-totalusage-systemusage-percpuusage-a/35694591#35694591", "title": "In docker cpu usage calculation what are: TotalUsage, SystemUsage, PercpuUsage and what does the calculation means?", "body": "<p>There was a similar discussion in <a href=\"https://github.com/docker/docker/issues/18615\" rel=\"nofollow\">issue 18615</a> which led to <a href=\"https://github.com/docker/docker/pull/13627\" rel=\"nofollow\">PR 13627 \"Update \"docker stats \" calculations\"</a></p>\n\n<blockquote>\n  <p>I think <code>cpuPercent = (cpuDelta / systemDelta) * float64(len(v.CpuStats.CpuUsage.PercpuUsage))</code> is right, because:</p>\n  \n  <ul>\n  <li><code>cpuDelta</code> is total time consumed of all cores and </li>\n  <li><code>systemDelta</code> is also the total time consumed of all cores, </li>\n  </ul>\n  \n  <p>so <code>(cpuDelta / systemDelta)</code> is the average cpu usage of each core, so it need multiply the number of cpu cores to calculate the total cpu usage. </p>\n  \n  <p>for example, on a 4-core system, cpu usage can be anywhere between 0 and 400%, so it has to be multiplied by the number of cores.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 96, "user_id": 3378004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f19af6bb70259e1641b20cab217bf6f?s=128&d=identicon&r=PG&f=1", "display_name": "The Flaw Detector", "link": "https://stackoverflow.com/users/3378004/the-flaw-detector"}, "is_accepted": false, "score": 5, "last_activity_date": 1516043574, "creation_date": 1516043574, "answer_id": 48269325, "question_id": 35692667, "link": "https://stackoverflow.com/questions/35692667/in-docker-cpu-usage-calculation-what-are-totalusage-systemusage-percpuusage-a/48269325#48269325", "title": "In docker cpu usage calculation what are: TotalUsage, SystemUsage, PercpuUsage and what does the calculation means?", "body": "<p>Below mention points will give an clear idea about CPU utilization calculation in docker:</p>\n\n<ol>\n<li>Metric with \"system\" keyword always refer to the HOST metric on which docker is running.</li>\n<li>Metric without the keyword \"system\" always refer to the metric related with\nCONTAINER running inside docker.</li>\n<li><p><a href=\"https://i.stack.imgur.com/vv56K.png\" rel=\"noreferrer\">REMEMBER the percentage formula</a></p></li>\n<li><p>SystemUsage = The CPU utilization of the HOST on which docker is running.This is equivalent to \"WHOLE\" in the percentage formula.</p></li>\n<li>TotalUsage = The CPU utilization per core of the CONTAINER which is running inside docker.This is equivalent to \"PART\" in the percentage formula.</li>\n<li>PercpuUsage = Individual utilization of CPU cores allocated to the CONTAINER.This also let us know the number of CPU cores allocated to the CONTAINER. </li>\n<li><p>Change in CONTAINER CPU per core utilization </p>\n\n<p>= Previous value of CONTAINER CPU - Current value of CONTAINER CPU</p></li>\n<li><p>Change in HOST CPU utilization </p>\n\n<p>= Previous value of HOST CPU - Current value of HOST CPU</p></li>\n<li>Total change in CONTAINER CPU utilization= Change in CONTAINER CPU per core utilization * Number of core allocated to container[PercpuUsage core count]</li>\n<li>CPU utilization(%)=(Total change in CONTAINER CPU utilization / Change in HOST CPU utilization) * 100 </li>\n</ol>\n\n<p>The CPU utilization code written for docker in golang makes it easier to understand the terminologies mentioned above:\n<a href=\"https://github.com/moby/moby/blob/eb131c5383db8cac633919f82abad86c99bffbe5/cli/command/container/stats_helpers.go#L175-L188\" rel=\"noreferrer\">https://github.com/moby/moby/blob/eb131c5383db8cac633919f82abad86c99bffbe5/cli/command/container/stats_helpers.go#L175-L188</a></p>\n\n<pre><code>func calculateCPUPercentUnix(previousCPU, previousSystem uint64, v *types.StatsJSON) float64 {\n    var (\n        cpuPercent = 0.0\n        // calculate the change for the cpu usage of the container in between readings\n        cpuDelta = float64(v.CPUStats.CPUUsage.TotalUsage) - float64(previousCPU)\n        // calculate the change for the entire system between readings\n        systemDelta = float64(v.CPUStats.SystemUsage) - float64(previousSystem)\n    )\n\n    if systemDelta &gt; 0.0 &amp;&amp; cpuDelta &gt; 0.0 {\n        cpuPercent = (cpuDelta / systemDelta) * float64(len(v.CPUStats.CPUUsage.PercpuUsage)) * 100.0\n    }\n    return cpuPercent\n}\n</code></pre>\n\n<p>CPU stats from Docker stats API</p>\n\n<pre><code> \"cpu_stats\": {\n    \"cpu_usage\": {\n      \"total_usage\": 18730109057613,\n      \"percpu_usage\": [\n        2037710936955,\n        1481642385431,\n        1344435820732,\n        1163032744042,\n        1204372068508,\n        5758852306067,\n        1170010183583,\n        988020711114,\n        1191435357423,\n        743892480387,\n        715658853679,\n        931045209692\n      ],\n      \"usage_in_kernelmode\": 856990000000,\n      \"usage_in_usermode\": 17572550000000\n    },\n    \"system_cpu_usage\": 123541016890000000,\n    \"throttling_data\": {\n      \"periods\": 0,\n      \"throttled_periods\": 0,\n      \"throttled_time\": 0\n    }\n  },\n</code></pre>\n\n<p>Previous CPU stats from Docker stats API  [Which is required to calculate the initial and final difference]</p>\n\n<pre><code>\"precpu_stats\": {\n    \"cpu_usage\": {\n      \"total_usage\": 18730095876882,\n      \"percpu_usage\": [\n        2037709694286,\n        1481641884454,\n        1344434727538,\n        1163031727858,\n        1204370950455,\n        5758849538503,\n        1170009778051,\n        988019895578,\n        1191434644418,\n        743892204863,\n        715658782597,\n        931042048281\n      ],\n      \"usage_in_kernelmode\": 856980000000,\n      \"usage_in_usermode\": 17572550000000\n    },\n    \"system_cpu_usage\": 123541004930000000,\n    \"throttling_data\": {\n      \"periods\": 0,\n      \"throttled_periods\": 0,\n      \"throttled_time\": 0\n    }\n  },\n</code></pre>\n"}], "owner": {"reputation": 12424, "user_id": 345859, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/cdb711788e4473ecd856108533787144?s=128&d=identicon&r=PG&f=1", "display_name": "Jas", "link": "https://stackoverflow.com/users/345859/jas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2204, "favorite_count": 2, "accepted_answer_id": 35694591, "answer_count": 2, "score": 4, "last_activity_date": 1516043574, "creation_date": 1456724371, "last_edit_date": 1456726008, "question_id": 35692667, "link": "https://stackoverflow.com/questions/35692667/in-docker-cpu-usage-calculation-what-are-totalusage-systemusage-percpuusage-a", "title": "In docker cpu usage calculation what are: TotalUsage, SystemUsage, PercpuUsage and what does the calculation means?", "body": "<p>I see in <a href=\"https://github.com/docker/docker/blob/master/api/client/stats.go#L311\" rel=\"nofollow\">docker sources for cpu calculation</a> but I don't get what are exactly</p>\n\n<ol>\n<li>TotalUsage</li>\n<li>SystemUsage</li>\n<li>PercpuUsage</li>\n</ol>\n\n<p>why is <code>cpuDelta</code> divided by <code>SystemDelta</code> and also why then multiplied by <code>PercpuUsage</code>?</p>\n\n<p>The documentation says for <code>cpuDelta</code></p>\n\n<blockquote>\n  <p>// calculate the change for the cpu usage of the container in between\n  readings</p>\n</blockquote>\n\n<p>and for <code>systemDelta</code>:</p>\n\n<blockquote>\n  <p>// calculate the change for the entire system between readings</p>\n</blockquote>\n\n<p>so shouldn't these delta's both be summed and divided by the total cpu (or total nanoseconds passed) during that delta time? after all the <code>container</code> was consuming both the <code>cpuDelta</code> and also <code>systemDelta</code></p>\n\n<p><strong>Update</strong>: I think I get it the totalUsage is the container usage and the SystemUsage is not the <code>systemCPU</code> used by the container but the whole system beyond the container cpu this is why they are divided.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "edited": false, "score": 0, "creation_date": 1456719199, "post_id": 35691811, "comment_id": 59061136, "body": "It seems like you have properly branched, why not just do a type conversion in each branch to pull out the email?"}, {"owner": {"reputation": 31539, "user_id": 367985, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/761edb9c3cf7a0a643e73ef40666a1f7?s=128&d=identicon&r=PG", "display_name": "CuriousMind", "link": "https://stackoverflow.com/users/367985/curiousmind"}, "reply_to_user": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "edited": false, "score": 0, "creation_date": 1456719270, "post_id": 35691811, "comment_id": 59061154, "body": "^^How, that&#39;s where I am stuck."}], "answers": [{"tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": false, "score": 3, "last_activity_date": 1456719420, "creation_date": 1456719420, "answer_id": 35691892, "question_id": 35691811, "link": "https://stackoverflow.com/questions/35691811/golang-unmarshal-json-map-array/35691892#35691892", "title": "Golang unmarshal json map &amp; array", "body": "<p>Is this what you wanted? <a href=\"http://play.golang.org/p/8yrirlUAnp\" rel=\"nofollow\">http://play.golang.org/p/8yrirlUAnp</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    b := []byte(`[{\"email\":\"example@test.com\"}]`)\n    c := []byte(`{\"email\":\"example@test.com\"}`)\n\n    var m interface{}\n\n    json.Unmarshal(b, &amp;m)\n    switch v := m.(type) {\n    case []interface{}:\n        for _, x := range v {\n            fmt.Println(\"this is b\", x.(map[string]interface{})[\"email\"])\n        }\n    default:\n        fmt.Println(\"No type found\")\n    }\n\n    json.Unmarshal(c, &amp;m)\n    switch v := m.(type) {\n    case map[string]interface{}:\n        fmt.Println(\"this is c\", v[\"email\"])\n    default:\n        fmt.Println(\"No type found\")\n    }\n\n}\n</code></pre>\n\n<p>Edit: missed the loop part, added it.</p>\n"}, {"tags": [], "owner": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "is_accepted": false, "score": 2, "last_activity_date": 1456720183, "creation_date": 1456720183, "answer_id": 35691996, "question_id": 35691811, "link": "https://stackoverflow.com/questions/35691811/golang-unmarshal-json-map-array/35691996#35691996", "title": "Golang unmarshal json map &amp; array", "body": "<p>This is not the most idiomatic, but another way to do it is to try and marshal into the type that you want. The advantage here is there is no extra reflection beyond what is needed.</p>\n\n<p><a href=\"http://play.golang.org/p/dV5qCu3tKk\" rel=\"nofollow\">http://play.golang.org/p/dV5qCu3tKk</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(extract([]byte(`[{\"email\":\"example@test.com\"}]`)))\n    fmt.Println(extract([]byte(`{\"email\":\"example@test.com\"}`)))\n}\n\nfunc extract(b []byte) string {\n    var m map[string]string\n\n    err := json.Unmarshal(b, &amp;m)\n    if err == nil {\n        return m[\"email\"]\n    }\n\n    var nested []map[string]string\n\n    err = json.Unmarshal(b, &amp;nested)\n    if err == nil {\n        for _, m := range nested {\n            return m[\"email\"]\n        }\n    }\n    return \"\"\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 442, "user_id": 720333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/433e107664a2cf66c07da341ddef5f5d?s=128&d=identicon&r=PG", "display_name": "yeer", "link": "https://stackoverflow.com/users/720333/yeer"}, "is_accepted": true, "score": 5, "last_activity_date": 1456724978, "creation_date": 1456724978, "answer_id": 35692780, "question_id": 35691811, "link": "https://stackoverflow.com/questions/35691811/golang-unmarshal-json-map-array/35692780#35692780", "title": "Golang unmarshal json map &amp; array", "body": "<p>In my experience, using interface{} to handle json decoding may cause some strange problem, which I tend to avoid it. Although there are ways to achieve it using the reflect package. </p>\n\n<p>Here is a solution for you problem base on your origin solution, hope it helps. </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Item struct {\n    Email string `json:email`\n}\n\nfunc main() {\n    b := []byte(`[{\"email\":\"example_in_array@test.com\"}]`)\n    //b := []byte(`{\"email\":\"example@test.com\"}`)\n\n    var m = &amp;Item{}\n    var ms = []*Item{}\n    err := json.Unmarshal(b, &amp;m)\n    if err != nil {\n        err = json.Unmarshal(b, &amp;ms)\n        if err != nil {\n            panic(err)\n        }\n        for _, m := range ms {\n            fmt.Println(m.Email)\n        }\n    } else {\n        fmt.Println(m.Email)\n    }\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 136, "user_id": 1428224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phT3Y.jpg?s=128&g=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1428224/andrey"}, "is_accepted": false, "score": 2, "last_activity_date": 1456922674, "creation_date": 1456922674, "answer_id": 35747598, "question_id": 35691811, "link": "https://stackoverflow.com/questions/35691811/golang-unmarshal-json-map-array/35747598#35747598", "title": "Golang unmarshal json map &amp; array", "body": "<p>You can try <a href=\"https://github.com/firewut/go-json-map\" rel=\"nofollow\">this package</a></p>\n\n<pre><code>b := []byte(`[{\"email\":\"example@test.com\"}]`)\nc := []byte(`{\"email\":\"example@test.com\"}`)\n\nvar m interface{}\nvar mm interface{}\njson.Unmarshal(b, &amp;m)\njson.Unmarshal(c, &amp;mm)\n\nx := map[string]interface{}{\n   \"wrapped\": m,\n}\nxx := map[string]interface{}{\n   \"wrapped\": mm,\n} \n\nvar email string\nif email_interface, err := GetProperty(x, \"wrapped[0].email\"); err == nil {\n  email, _ = email_interface.(string)\n}\nif email_interface, err := GetProperty(xx, \"wrapped.email\"); err == nil {\n  email, _ = email_interface.(string)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2178, "user_id": 3858203, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/Os9fr.jpg?s=128&g=1", "display_name": "samadadi", "link": "https://stackoverflow.com/users/3858203/samadadi"}, "is_accepted": false, "score": 0, "last_activity_date": 1538759555, "creation_date": 1538759555, "answer_id": 52670450, "question_id": 35691811, "link": "https://stackoverflow.com/questions/35691811/golang-unmarshal-json-map-array/52670450#52670450", "title": "Golang unmarshal json map &amp; array", "body": "<p>The <strong>Idiomatic</strong> way: implement <strong>Unmarshaler</strong> interface:</p>\n\n<pre><code>type Email struct {\n    Val string `json:\"email\"`\n}\n\nfunc (this *Email) UnmarshalJSON(jsonBytes []byte) error {\n    var err error\n    type EmailStruct Email\n    bytesBuffer := bytes.Buffer{}\n    if jsonBytes[0] == '[' {\n        emails := []EmailStruct{}\n        err = json.Unmarshal(jsonBytes, &amp;emails)\n        if err != nil {\n            return err\n        }\n\n        encoder := gob.NewEncoder(&amp;bytesBuffer)\n        err = encoder.Encode(&amp;emails[0])\n        if err != nil {\n            return err\n        }\n\n        decoder := gob.NewDecoder(&amp;bytesBuffer)\n        err = decoder.Decode(this)\n        if err != nil {\n            return err\n        }\n\n        return err\n    }\n\n    email := EmailStruct{}\n    err = json.Unmarshal(jsonBytes, &amp;email)\n    if err != nil {\n        return err\n    }\n\n    encoder := gob.NewEncoder(&amp;bytesBuffer)\n    err = encoder.Encode(&amp;email)\n    if err != nil {\n        return err\n    }\n\n    decoder := gob.NewDecoder(&amp;bytesBuffer)\n    err = decoder.Decode(this)\n    if err != nil {\n        return err\n    }\n\n    return err\n}\n</code></pre>\n\n<p>Use \"<strong>json.Unmarshal(jsonBytes, location)</strong>\" to decode json bytes.</p>\n\n<pre><code>email := Email{}\njson.Unmarshal(jsonBytes, &amp;email)\n</code></pre>\n\n<p><strong>OR</strong></p>\n\n<pre><code>emails := []Email{}\njson.Unmarshal(jsonBytes, &amp;emails)\n</code></pre>\n"}], "owner": {"reputation": 31539, "user_id": 367985, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/761edb9c3cf7a0a643e73ef40666a1f7?s=128&d=identicon&r=PG", "display_name": "CuriousMind", "link": "https://stackoverflow.com/users/367985/curiousmind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8398, "favorite_count": 0, "accepted_answer_id": 35692780, "answer_count": 5, "score": 3, "last_activity_date": 1538759555, "creation_date": 1456718745, "last_edit_date": 1456719224, "question_id": 35691811, "link": "https://stackoverflow.com/questions/35691811/golang-unmarshal-json-map-array", "title": "Golang unmarshal json map &amp; array", "body": "<p>After reading <a href=\"http://blog.golang.org/json-and-go\" rel=\"nofollow\">JSON and Go</a>, I do understand the basics of decoding json in Go are. However, there this problem where that input json can be sometimes a map &amp; sometimes an array of maps. </p>\n\n<p>consider the following problem:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    b := []byte(`[{\"email\":\"example@test.com\"}]`)\n    c := []byte(`{\"email\":\"example@test.com\"}`)\n\n    var m interface{}\n\n    json.Unmarshal(b, &amp;m)\n    switch v := m.(type) {\n    case []interface{}:\n        fmt.Println(\"this is b\", v)\n    default:\n        fmt.Println(\"No type found\")\n    }\n\n    json.Unmarshal(c, &amp;m)\n    switch v := m.(type) {\n    case map[string]interface{}:\n        fmt.Println(\"this is c\", v)\n    default:\n        fmt.Println(\"No type found\")\n    }\n\n}\n</code></pre>\n\n<p>Now, how to I get to the value <code>email</code>: <code>example@test.com</code> in both cases(<code>b</code> &amp; <code>c</code>)</p>\n\n<p><strong>Question:</strong></p>\n\n<ol>\n<li>If json is an array, I want to loop over each &amp; print email.</li>\n<li>if json is an map, I want to print email directly</li>\n</ol>\n\n<p>Play: <a href=\"http://play.golang.org/p/UPoFxorqWl\" rel=\"nofollow\">http://play.golang.org/p/UPoFxorqWl</a></p>\n"}, {"tags": ["intellij-idea", "go"], "answers": [{"comments": [{"owner": {"reputation": 11214, "user_id": 366207, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/a8f20cf31acead835f9eacc605210903?s=128&d=identicon&r=PG", "display_name": "Ahmad", "link": "https://stackoverflow.com/users/366207/ahmad"}, "edited": false, "score": 1, "creation_date": 1456717307, "post_id": 35691573, "comment_id": 59060673, "body": "I could be wrong but I don&#39;t see an option in IntelliJ IDEA&#39;s Run Configuration dialog which allows you to run a Bash script in place of a Go executable."}, {"owner": {"reputation": 25272, "user_id": 1695163, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/85ffb58dc3ed0067128804ef843245a6?s=128&d=identicon&r=PG", "display_name": "ddavison", "link": "https://stackoverflow.com/users/1695163/ddavison"}, "reply_to_user": {"reputation": 11214, "user_id": 366207, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/a8f20cf31acead835f9eacc605210903?s=128&d=identicon&r=PG", "display_name": "Ahmad", "link": "https://stackoverflow.com/users/366207/ahmad"}, "edited": false, "score": 0, "creation_date": 1457672027, "post_id": 35691573, "comment_id": 59522205, "body": "what i mean is you can have your bash script call the Go executable."}, {"owner": {"reputation": 1658, "user_id": 4350421, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/p2Iig.png?s=128&g=1", "display_name": "silentsurfer", "link": "https://stackoverflow.com/users/4350421/silentsurfer"}, "edited": false, "score": 0, "creation_date": 1557349490, "post_id": 35691573, "comment_id": 98739503, "body": "This is what I use to run powershell commands from a run configuration as well. <code>Script: #  | Interpreter path: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe | Interpreter options: &lt;your command&gt; </code>"}], "tags": [], "owner": {"reputation": 25272, "user_id": 1695163, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/85ffb58dc3ed0067128804ef843245a6?s=128&d=identicon&r=PG", "display_name": "ddavison", "link": "https://stackoverflow.com/users/1695163/ddavison"}, "is_accepted": false, "score": 0, "last_activity_date": 1456717090, "creation_date": 1456717090, "answer_id": 35691573, "question_id": 35691549, "link": "https://stackoverflow.com/questions/35691549/how-do-i-run-a-exe-go-executable-from-within-intellij-idea/35691573#35691573", "title": "How do I run a EXE Go executable from within IntelliJ IDEA?", "body": "<p>You may be able to install the Bash plugin on Windows, then create a run configuration using the Bash plugin, and just run your executable from a script.</p>\n"}, {"comments": [{"owner": {"reputation": 11214, "user_id": 366207, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/a8f20cf31acead835f9eacc605210903?s=128&d=identicon&r=PG", "display_name": "Ahmad", "link": "https://stackoverflow.com/users/366207/ahmad"}, "edited": false, "score": 0, "creation_date": 1457488884, "post_id": 35854952, "comment_id": 59426132, "body": "I had tried running the EXE through &#39;Go Application&#39; run configuration too, but it also didn&#39;t allow me to run an EXE. That is, I got the same &quot;Main file is invalid&quot; error."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 11214, "user_id": 366207, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/a8f20cf31acead835f9eacc605210903?s=128&d=identicon&r=PG", "display_name": "Ahmad", "link": "https://stackoverflow.com/users/366207/ahmad"}, "edited": false, "score": 0, "creation_date": 1457594743, "post_id": 35854952, "comment_id": 59479306, "body": "Please provide a screenshot of your run configuration."}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 0, "last_activity_date": 1457388070, "creation_date": 1457388070, "answer_id": 35854952, "question_id": 35691549, "link": "https://stackoverflow.com/questions/35691549/how-do-i-run-a-exe-go-executable-from-within-intellij-idea/35854952#35854952", "title": "How do I run a EXE Go executable from within IntelliJ IDEA?", "body": "<p>Create a Go Application run configuration and that should work. You can choose to run either a file or a package. If you would share more details then the answer would be more complete. If you still have an issue with this, please open an issue to the bug tracker and I'll be able to help out (please follow the issue template there).</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 2440726, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6aa37224e5db9c4e3a39f1ef811a441?s=128&d=identicon&r=PG", "display_name": "IgorKuzenkov", "link": "https://stackoverflow.com/users/2440726/igorkuzenkov"}, "is_accepted": false, "score": 1, "last_activity_date": 1461157563, "creation_date": 1461157563, "answer_id": 36744783, "question_id": 35691549, "link": "https://stackoverflow.com/questions/35691549/how-do-i-run-a-exe-go-executable-from-within-intellij-idea/36744783#36744783", "title": "How do I run a EXE Go executable from within IntelliJ IDEA?", "body": "<p>Make sure you have a <strong>file</strong> name (not a <strong>folder</strong> name) in field <strong>File</strong> on <strong>Run/Debug Configuration</strong> window (In IntelliJ IDEA go to menu Run->Edit Configuration...-><em>your_configuration</em>). That was my case.</p>\n"}], "owner": {"reputation": 11214, "user_id": 366207, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/a8f20cf31acead835f9eacc605210903?s=128&d=identicon&r=PG", "display_name": "Ahmad", "link": "https://stackoverflow.com/users/366207/ahmad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3519, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1461157563, "creation_date": 1456716947, "question_id": 35691549, "link": "https://stackoverflow.com/questions/35691549/how-do-i-run-a-exe-go-executable-from-within-intellij-idea", "title": "How do I run a EXE Go executable from within IntelliJ IDEA?", "body": "<p>I have a Go program which I'm working on in IntelliJ IDEA on a Windows machine. The program's structure is a little unconventional (don't want to go into detail here as its besides the point) because of which I first have to compile the program using the following command:</p>\n\n<p><code>go build -o cli.exe</code></p>\n\n<p>And then I can run <code>cli.exe</code> directly in the command prompt.</p>\n\n<p>But how do I configure the run configuration in IntelliJ IDEA so that it doesn't mind running a Windows executable ? Because if I try to tell it to run an EXE file as it's run configuration, it gives me error \"Main file is invalid\"</p>\n\n<p>How do I solve this ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1456715816, "post_id": 35691179, "comment_id": 59060316, "body": "Your question is clear, but unclear... So you want to have Animals assigned depending on something in your Javascript code? Can you post some psuedo code or something of what you expect to happen?"}, {"owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "reply_to_user": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1456717368, "post_id": 35691179, "comment_id": 59060687, "body": "Updated. Hope it&#39;s clearer now."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1456717616, "post_id": 35691179, "comment_id": 59060756, "body": "I do not believe this is possible, you&#39;d need to have like an ajax request after the page loads if you wanted to do something like that"}], "owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 146, "favorite_count": 0, "closed_date": 1456719726, "answer_count": 0, "score": 0, "last_activity_date": 1456717359, "creation_date": 1456714283, "last_edit_date": 1456717359, "question_id": 35691179, "link": "https://stackoverflow.com/questions/35691179/dynamically-assign-variable-in-go-template", "closed_reason": "Duplicate", "title": "Dynamically assign variable in Go template", "body": "<p>I want to dynamically index a slice in my Go template.</p>\n\n<p>index.html:</p>\n\n<pre><code>{{index .Animals 1}}\n</code></pre>\n\n<p>.go:</p>\n\n<pre><code>Animals := []string{\"cat\", \"dog\"}\n</code></pre>\n\n<p>This prints \"dog\" in the html file. However, I don't want to hard code 1 inside <code>{{index .Animals 1}}</code>, but assign a variable depending on changes in the javascript code. How do I do this?</p>\n\n<p>eg.</p>\n\n<p>index.html:</p>\n\n<pre><code>&lt;body&gt;\n  &lt;script&gt;\n    var indexNum = // get page num\n  &lt;/script&gt;\n  {{index .Animals $indexNum}}\n&lt;/body&gt;\n</code></pre>\n"}, {"tags": ["json", "go", "websocket"], "comments": [{"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1456710317, "post_id": 35690624, "comment_id": 59059138, "body": "Which websocket package are you using, gorillas or just default"}, {"owner": {"reputation": 262, "user_id": 2452852, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uFFhn.jpg?s=128&g=1", "display_name": "Samuel Loog", "link": "https://stackoverflow.com/users/2452852/samuel-loog"}, "reply_to_user": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1456710593, "post_id": 35690624, "comment_id": 59059200, "body": "golang.org/x/net/websocket"}], "answers": [{"comments": [{"owner": {"reputation": 262, "user_id": 2452852, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uFFhn.jpg?s=128&g=1", "display_name": "Samuel Loog", "link": "https://stackoverflow.com/users/2452852/samuel-loog"}, "edited": false, "score": 1, "creation_date": 1456711477, "post_id": 35690710, "comment_id": 59059397, "body": "Thanks, it&#39;s working. The problem was in <code>struct { text string }</code>. I replaced <code>text string</code> to <code>Text string</code> and it&#39;s really helped. But I don&#39;t understand why."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 262, "user_id": 2452852, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uFFhn.jpg?s=128&g=1", "display_name": "Samuel Loog", "link": "https://stackoverflow.com/users/2452852/samuel-loog"}, "edited": false, "score": 3, "creation_date": 1456714303, "post_id": 35690710, "comment_id": 59060003, "body": "@SamuelLoog I haven&#39;t looked at the source but I&#39;m sure <code>JSON.receive</code> calls <code>json.Unmarshal</code> in its source, which <code>json.Unmarshal</code> requires the struct fields to be exported, by using a capital letter on their properties, so if you use <code>text string</code> it won&#39;t work but <code>Text string</code> is exported so it works"}, {"owner": {"reputation": 6862, "user_id": 193050, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4f932034c0998375cf9ca0d9b15cd01b?s=128&d=identicon&r=PG", "display_name": "LOAS", "link": "https://stackoverflow.com/users/193050/loas"}, "edited": false, "score": 1, "creation_date": 1505936557, "post_id": 35690710, "comment_id": 79621898, "body": "As a go newbie this is the thing that tripped me up the most about a simple websocket server. It makes sense - but I think I would have thrown in the towel before figuring it out on my own. Thank you, thank you, thank you!"}], "tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": true, "score": 3, "last_activity_date": 1456710763, "last_edit_date": 1456710763, "creation_date": 1456710452, "answer_id": 35690710, "question_id": 35690624, "link": "https://stackoverflow.com/questions/35690624/get-json-data-on-go-websocket-server/35690710#35690710", "title": "Get json data on go websocket server", "body": "<p>Chances are you'll need to define your struct before you can use <code>JSON.receive</code> on an object like</p>\n\n<p><code>{ \"text\": \"Hi\" }</code></p>\n\n<pre><code>type socketData struct {\n    Text string `json:\"text\"`\n}\n</code></pre>\n\n<p>Then </p>\n\n<pre><code>data := &amp;socketData{}\n\nwebsocket.JSON.receive(ws, &amp;data)\n\nlog.Println(data.Text) // Hi\n</code></pre>\n\n<p>If you're going to be sending random data that you can't really define a struct for (though this is the preferred way of doing it) you can just declare an <code>interface{}</code></p>\n\n<pre><code>var data map[string]interface{}\n\nlog.Println(data[\"text\"].(string)) // Hi\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/Jp5qKtiUGw\" rel=\"nofollow\">http://play.golang.org/p/Jp5qKtiUGw</a></p>\n"}], "owner": {"reputation": 262, "user_id": 2452852, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uFFhn.jpg?s=128&g=1", "display_name": "Samuel Loog", "link": "https://stackoverflow.com/users/2452852/samuel-loog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6826, "favorite_count": 0, "accepted_answer_id": 35690710, "answer_count": 1, "score": 3, "last_activity_date": 1456710763, "creation_date": 1456709843, "last_edit_date": 1456710618, "question_id": 35690624, "link": "https://stackoverflow.com/questions/35690624/get-json-data-on-go-websocket-server", "title": "Get json data on go websocket server", "body": "<p>When I send from js client <code>socket.send('{\"text\":\"111\"}')</code> and get this on server, by <code>websocket.JSON.Receive(ws, &amp;data)</code>, data remain empty. I use \"golang.org/x/net/websocket\"</p>\n\n<pre><code>type (\n    Msg struct {\n        clientKey string\n        text string\n    }\n\n    NewClientEvent struct {\n        clientKey string\n        msgChan chan *Msg\n    }\n\n    Item struct {\n        text string\n    }\n)\n\nvar (\n    clientRequests = make(chan *NewClientEvent, 100)\n    clientDisconnects = make(chan string, 100)\n    messages = make(chan *Msg, 100)\n)\n\nfunc ChatServer(ws *websocket.Conn) {\n    msgChan := make(chan *Msg, 100)\n    clientKey := time.Now().String()\n\n    clientRequests &lt;- &amp;NewClientEvent{clientKey, msgChan}\n    defer func(){ clientDisconnects &lt;- clientKey}()\n\n    go func(){\n        for msg := range msgChan{\n            ws.Write([]byte(msg.text))\n        }\n    }()\n    for {\n        var data Item\n        err := websocket.JSON.Receive(ws, &amp;data)\n        if err != nil {\n            log.Println(\"Error: \", err.Error())\n            return\n        }\n        messages &lt;- &amp;Msg{clientKey, data.text}\n    }\n}\n</code></pre>\n\n<p>But if I try send <code>socket.send('\"text\"')</code> and get it by this:</p>\n\n<pre><code>var data string\nerr := websocket.JSON.Receive(ws, &amp;data)\n            if err != nil {\n                log.Println(\"Error: \", err.Error())\n                return\n            }\n            messages &lt;- &amp;Msg{clientKey, data}\n</code></pre>\n\n<p>everything is working.</p>\n"}, {"tags": ["oop", "go"], "answers": [{"tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": false, "score": 2, "last_activity_date": 1456706589, "last_edit_date": 1456706589, "creation_date": 1456704268, "answer_id": 35689967, "question_id": 35689930, "link": "https://stackoverflow.com/questions/35689930/passing-an-inherited-struct-back-as-the-base-object/35689967#35689967", "title": "Passing an inherited struct back as the base object", "body": "<p>Well the error is pretty self explanatory:</p>\n\n<blockquote>\n  <p>cannot use (*term, variable name) (type elastic.AggregationBucketKeyItem &lt;-- Variables current type) as (type elastic.Aggregations &lt;-- Expected type) in argument to extractBucket</p>\n</blockquote>\n\n<p>Whatever your <code>*term</code> value</p>\n\n<p>Generated by: <code>for _, term := range terms.Buckets {</code></p>\n\n<p>is not the right type for the function</p>\n\n<pre><code>extractBucket(parts []string, aggs elastic.Aggregations)\n</code></pre>\n\n<p>Takes a type of <code>elastic.Aggregations</code></p>\n"}, {"comments": [{"owner": {"reputation": 21104, "user_id": 191450, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24a895bcec11df8f488a259f518063fc?s=128&d=identicon&r=PG", "display_name": "koblas", "link": "https://stackoverflow.com/users/191450/koblas"}, "edited": false, "score": 0, "creation_date": 1456719487, "post_id": 35690322, "comment_id": 59061208, "body": "I did figure it out about 5 minutes after posting, but coming from the C++ world (which Java has a similar pattern) it not quite the behavior I&#39;m used to."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 2, "last_activity_date": 1456707235, "creation_date": 1456707235, "answer_id": 35690322, "question_id": 35689930, "link": "https://stackoverflow.com/questions/35689930/passing-an-inherited-struct-back-as-the-base-object/35690322#35690322", "title": "Passing an inherited struct back as the base object", "body": "<p>It is a common misunderstanding that embedding a type makes you \"inherit\" that type. Even though <code>AggregationBucketSignificantTerms</code> <em>embeds</em> an <code>Aggregations</code>, it is not one to the compiler. It merely has a field of type <code>Aggregations</code>, and it provides methods from that type at it's top level. It feels a bit like inheritance, but is probably not what you are used to with things like Java subclasses.</p>\n\n<p>To solve it you can try <code>\"Value\": extractBucket(parts[1:], *term.Aggregations),</code>, but I am not clear if that will solve your problem or not.</p>\n"}], "owner": {"reputation": 21104, "user_id": 191450, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24a895bcec11df8f488a259f518063fc?s=128&d=identicon&r=PG", "display_name": "koblas", "link": "https://stackoverflow.com/users/191450/koblas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 35690322, "answer_count": 2, "score": -2, "last_activity_date": 1456707235, "creation_date": 1456704033, "question_id": 35689930, "link": "https://stackoverflow.com/questions/35689930/passing-an-inherited-struct-back-as-the-base-object", "title": "Passing an inherited struct back as the base object", "body": "<p>I'm sure this is a syntax issue that I've yet to figure out with Go -</p>\n\n<p>The error I'm getting -- </p>\n\n<blockquote>\n  <p>cannot use *term (type elastic.AggregationBucketKeyItem) as type elastic.Aggregations in argument to extractBucket</p>\n</blockquote>\n\n<p>The line that's generating the error is </p>\n\n<pre><code>\"Value\": extractBucket(parts[1:], *term),\n</code></pre>\n\n<p>The relevant code, for context</p>\n\n<pre><code>// from https://github.com/olivere/elastic/blob/v3.0.22/search_aggs.go\n\ntype Aggregations map[string]*json.RawMessage\n\ntype AggregationBucketSignificantTerms struct {\n    Aggregations\n\n    DocCount int64                               //`json:\"doc_count\"`\n    Buckets  []*AggregationBucketSignificantTerm //`json:\"buckets\"`\n    Meta     map[string]interface{}              // `json:\"meta,omitempty\"`\n}\n\n// my code\n\nfunc extractBucket(parts []string, aggs elastic.Aggregations) interface{} {\n    // bunch of code removed\n\n           terms, found := aggs.Terms(part)\n           for _, term := range terms.Buckets {\n            if len(parts) == 0 {\n                retval[(term.Key).(string)] = map[string]interface{}{\n                    \"Count\": term.DocCount,\n                }\n            } else {\n                retval[(term.Key).(string)] = map[string]interface{}{\n                    \"Count\": term.DocCount,\n                    \"Value\": extractBucket(parts[1:], *term),\n                }\n            }\n        }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4442960"}, "edited": false, "score": 0, "creation_date": 1456696425, "post_id": 35688647, "comment_id": 59055173, "body": "Thanks a lot. Is it possible to format the number without printing it out?"}, {"owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 4, "creation_date": 1456696819, "post_id": 35688647, "comment_id": 59055328, "body": "A number is just a <i>value</i>, it doesn&#39;t have <i>length</i> until you create a <i>string representation</i> of that value. If you just want a string without printing it, you can do <code>strval := fmt.Sprintf(&quot;%02d&quot;, number)</code> instead."}], "tags": [], "owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "is_accepted": true, "score": 3, "last_activity_date": 1456695785, "creation_date": 1456695785, "answer_id": 35688647, "question_id": 35688591, "link": "https://stackoverflow.com/questions/35688591/keeping-numbers-the-same-length/35688647#35688647", "title": "Keeping numbers the same length", "body": "<p>This is probably what you want:</p>\n\n<pre><code>fmt.Printf(\"%02d\", number)\n</code></pre>\n\n<p>Have a look at <code>fmt</code>'s <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow\">documentation</a> to understand how it works.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4442960"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 35688647, "answer_count": 1, "score": 1, "last_activity_date": 1456696457, "creation_date": 1456695396, "last_edit_date": 1456696457, "question_id": 35688591, "link": "https://stackoverflow.com/questions/35688591/keeping-numbers-the-same-length", "title": "Keeping numbers the same length", "body": "<p>I'm completing an example involving a clock, so I'm working with integers between 0 and 60 in some cases, and 0 and 12 in others. I need the length of each number to be two digits long, even when the value is less than 10.</p>\n\n<p>For example</p>\n\n<pre><code>0  =&gt; 00\n2  =&gt; 02\n10 =&gt; 10\netc\n</code></pre>\n\n<p>I want to have them formatted, but not necessarily to print them out. What's the easiest way to achieve this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 5, "creation_date": 1456695050, "post_id": 35688419, "comment_id": 59054690, "body": "Have a look at the <code>time</code> package, it has everything you need."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1456698177, "post_id": 35688419, "comment_id": 59055858, "body": "<a href=\"https://golang.org/pkg/time/#Unix\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#Unix</a>"}], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 1813037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f59f62a9c930c1f642a50558654abdac?s=128&d=identicon&r=PG", "display_name": "user1813037", "link": "https://stackoverflow.com/users/1813037/user1813037"}, "edited": false, "score": 0, "creation_date": 1456871035, "post_id": 35689353, "comment_id": 59143963, "body": "Thanks Danilo.Cheers."}], "tags": [], "owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "is_accepted": true, "score": 15, "last_activity_date": 1456700309, "creation_date": 1456700309, "answer_id": 35689353, "question_id": 35688419, "link": "https://stackoverflow.com/questions/35688419/how-to-convert-utc-time-to-unix-timestamp/35689353#35689353", "title": "How to convert UTC time to unix timestamp", "body": "<p>First of, the unix timestamp <code>1456693426</code> does not have the time <code>10:03:46 PM</code> but <code>9:03:46 PM</code> in UTC.</p>\n\n<p>In the <code>time</code> package there is the function <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"noreferrer\">Parse</a> with expects a layout to parse the time. The layout is constructed from the reference time <code>Mon Jan 2 15:04:05 -0700 MST 2006</code>. So in your case the layout would be <code>01/02/2006 3:04:05 PM</code>. After using <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"noreferrer\">Parse</a> you get a <code>time.Time</code> struct on which you can call <a href=\"https://golang.org/pkg/time/#Time.Unix\" rel=\"noreferrer\">Unix</a> to receive the unix timestamp.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    layout := \"01/02/2006 3:04:05 PM\"\n    t, err := time.Parse(layout, \"02/28/2016 9:03:46 PM\")\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(t.Unix())\n}\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 1813037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f59f62a9c930c1f642a50558654abdac?s=128&d=identicon&r=PG", "display_name": "user1813037", "link": "https://stackoverflow.com/users/1813037/user1813037"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 21510, "favorite_count": 1, "accepted_answer_id": 35689353, "answer_count": 1, "score": 8, "last_activity_date": 1582187157, "creation_date": 1456694440, "last_edit_date": 1582187157, "question_id": 35688419, "link": "https://stackoverflow.com/questions/35688419/how-to-convert-utc-time-to-unix-timestamp", "title": "How to convert UTC time to unix timestamp", "body": "<p>I am looking for an option to convert UTC time string to unix timestamp.</p>\n\n<p>The string variable I have is <code>02/28/2016 10:03:46 PM</code> and it needs to be converted to a unix timestamp like <code>1456693426</code></p>\n\n<p>Any idea how to do that?</p>\n"}, {"tags": ["go", "package"], "answers": [{"comments": [{"owner": {"reputation": 118, "user_id": 1066486, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/WkpPA.jpg?s=128&g=1", "display_name": "mikero", "link": "https://stackoverflow.com/users/1066486/mikero"}, "edited": false, "score": 0, "creation_date": 1456695279, "post_id": 35688453, "comment_id": 59054769, "body": "How about if there&#39;s some need that I have to rename the project1 to project1v2? In the import I have to update it, right? Is there any good solution so I don&#39;t need to update them manually? This is also the reason I&#39;m using relative import here."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 118, "user_id": 1066486, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/WkpPA.jpg?s=128&g=1", "display_name": "mikero", "link": "https://stackoverflow.com/users/1066486/mikero"}, "edited": false, "score": 1, "creation_date": 1456695328, "post_id": 35688453, "comment_id": 59054793, "body": "You shouldn&#39;t &quot;rename&quot; it to v2. Fork it/copy it, and create a second, new package as v2 (so that v1 users can still use v1 until they can upgrade without breaking their programs)."}, {"owner": {"reputation": 435, "user_id": 2702193, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a3f6bf97c0a7c87befa99a1fe1a92c34?s=128&d=identicon&r=PG&f=1", "display_name": "rox", "link": "https://stackoverflow.com/users/2702193/rox"}, "edited": false, "score": 0, "creation_date": 1468562571, "post_id": 35688453, "comment_id": 64186808, "body": "Oh, this is golang&#39;s worst part for me ever  : ("}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 4, "last_activity_date": 1456696117, "last_edit_date": 1456696117, "creation_date": 1456694650, "answer_id": 35688453, "question_id": 35688100, "link": "https://stackoverflow.com/questions/35688100/golang-relative-package-import-after-renaming/35688453#35688453", "title": "Golang relative package import after renaming", "body": "<p>Rule #1: Don't use relative imports. This is (partly) why you're running into issues. Read through this: <a href=\"https://golang.org/doc/code.html#Library\" rel=\"nofollow\">https://golang.org/doc/code.html#Library</a></p>\n\n<p>Use the fully qualified import paths (as you showed):</p>\n\n<pre><code>import(\n    \"project1/package1\"  \n    \"project1/package2\"   \n    \"project1/package3\"\n    // Or ideally, so others can access it in the future:\n    \"github.com/&lt;yourusername&gt;/project1/package4\"\n)  \n</code></pre>\n\n<p>If for some reason you want to version your package, you can either:</p>\n\n<ul>\n<li>Provide a new repository (import URL)</li>\n<li>Use a service like gopkg.in (<a href=\"http://labix.org/gopkg.in\" rel=\"nofollow\">http://labix.org/gopkg.in</a>) to provide versioned import URLs (e.g. gopkg.in/you/pkgname.v2)</li>\n</ul>\n"}], "owner": {"reputation": 118, "user_id": 1066486, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/WkpPA.jpg?s=128&g=1", "display_name": "mikero", "link": "https://stackoverflow.com/users/1066486/mikero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6731, "favorite_count": 1, "accepted_answer_id": 35688453, "answer_count": 1, "score": 2, "last_activity_date": 1456696117, "creation_date": 1456692648, "last_edit_date": 1456693899, "question_id": 35688100, "link": "https://stackoverflow.com/questions/35688100/golang-relative-package-import-after-renaming", "title": "Golang relative package import after renaming", "body": "<p>My $GOPATH is </p>\n\n<pre><code>\"/Users/peter/goworkspace\"\n</code></pre>\n\n<p>My current golang version:</p>\n\n<pre><code>go version go1.6 darwin/amd64\n</code></pre>\n\n<p>I have multiple golang projects under this workspace, so here is the the structure of directories</p>\n\n<pre><code>+/goworkspace  \n  +---/bin  \n  +---/pkg  \n  +---/src  \n    +---/project1\n        +---package1 \n           +---file1.go \n           +---file2.go \n           +---file3.go \n        +---package2 \n        +---package3 \n        +---main.go \n    +---/project2\n    +---/project3\n</code></pre>\n\n<p>In my proj1's main.go, I will use the imports from other packages under this project, it will look like:  </p>\n\n<pre><code>import(  \n     \"./package1\"      \n     \"./package2\"      \n     \"./package3\"\n )  \n</code></pre>\n\n<p>however when I run \"go build\",I'm keeping getting error saying:<br>\n\"\n<strong>can't load package:  local import \"../package\" in non-local package</strong></p>\n\n<p>If I prefer not to use relative package path, for example use it like:</p>\n\n<pre><code>import(\n    \"project1/package1\"  \n    \"project1/package2\"   \n    \"project1/package3\"   \n)  \n</code></pre>\n\n<p>then everything will work.  </p>\n\n<p>What is wrong with my code if I use the relative package path?<br>\nAnd what is the best practice for package import if the project1's name will change in the future, for example it is changed to projecet1v2?<br>\nDo I need to manually update the imported package's name then?</p>\n"}, {"tags": ["string", "go", "split"], "comments": [{"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1456728940, "post_id": 35688070, "comment_id": 59064231, "body": "Can I convince you to put that string in braces, quotes around the strings and then use the json library to parse it into a struct? Seems like a much neater solution."}], "answers": [{"tags": [], "owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "is_accepted": false, "score": 2, "last_activity_date": 1456694098, "creation_date": 1456694098, "answer_id": 35688357, "question_id": 35688070, "link": "https://stackoverflow.com/questions/35688070/golang-split-and-parse-a-string-to-different-types/35688357#35688357", "title": "Golang split and parse a string to different types", "body": "<p>This would be slightly better, I think:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n)\n\ntype statValues struct {\n    lv, str, agi, stm, spr, wis, con uint16\n    ki, exp                          uint32\n}\n\nfunc main() {\n    fmt.Printf(\"%+v\\n\", parseStatValues(\"Lv:400,STR:9999,AGI:8888,STM:7777,SPR:6666,WIS:5555,CON:4444,KI:3999999999,EXP:1\"))\n}\n\nfunc parseStatValues(data string) statValues {\n    var sv statValues\n    for _, s := range strings.SplitN(data, \",\", 9) {\n        xe := strings.SplitN(s, \":\", 2)\n        switch xe[0] {\n        case \"Lv\":\n            lv, _ := strconv.ParseUint(xe[1], 10, 16)\n            sv.lv = uint16(lv)\n        case \"STR\":\n            str, _ := strconv.ParseUint(xe[1], 10, 16)\n            sv.str = uint16(str)\n        case \"AGI\":\n            agi, _ := strconv.ParseUint(xe[1], 10, 16)\n            sv.agi = uint16(agi)\n        case \"STM\":\n            stm, _ := strconv.ParseUint(xe[1], 10, 16)\n            sv.stm = uint16(stm)\n        case \"SPR\":\n            spr, _ := strconv.ParseUint(xe[1], 10, 16)\n            sv.spr = uint16(spr)\n        case \"WIS\":\n            wis, _ := strconv.ParseUint(xe[1], 10, 16)\n            sv.wis = uint16(wis)\n        case \"CON\":\n            con, _ := strconv.ParseUint(xe[1], 10, 16)\n            sv.con = uint16(con)\n        case \"KI\":\n            ki, _ := strconv.ParseUint(xe[1], 10, 32)\n            sv.ki = uint32(ki)\n        case \"EXP\":\n            exp, _ := strconv.ParseUint(xe[1], 10, 32)\n            sv.exp = uint32(exp)\n        }\n    }\n\n    return sv\n}\n</code></pre>\n\n<p>Ignoring errors is generally a Bad Thing, but it's of course possible to ensure that the string passed to the function is valid (with a RE, for example).</p>\n"}], "owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1456694098, "creation_date": 1456692491, "question_id": 35688070, "link": "https://stackoverflow.com/questions/35688070/golang-split-and-parse-a-string-to-different-types", "title": "Golang split and parse a string to different types", "body": "<p>I'm not sure my approach is right or if its too hackish. Is there a way to improve this code?</p>\n\n<pre><code>func splitStatValues(data string) (uint16, uint16, uint16, uint16, uint16, uint16, uint16, uint32, uint32) {\n    vals := strings.SplitN(data, \",\", 9)\n\n    var lv, str, agi, stm, spr, wis, con uint16\n    var ki, exp uint32\n\n    for _, s := range vals {\n        xe := strings.SplitN(s, \":\", 2)\n\n        if xe[0] == \"Lv\" {\n            _lv, _ := strconv.ParseUint(xe[1], 10, 16)\n            lv = uint16(_lv)\n        }\n\n        if xe[0] == \"STR\" {\n            _str, _ := strconv.ParseUint(xe[1], 10, 16)\n            str = uint16(_str)\n        }\n\n        if xe[0] == \"AGI\" {\n            _agi, _ := strconv.ParseUint(xe[1], 10, 16)\n            agi = uint16(_agi)\n        }\n\n        if xe[0] == \"STM\" {\n            _stm, _ := strconv.ParseUint(xe[1], 10, 16)\n            stm = uint16(_stm)\n        }\n\n        if xe[0] == \"SPR\" {\n            _spr, _ := strconv.ParseUint(xe[1], 10, 16)\n            spr = uint16(_spr)\n        }\n\n        if xe[0] == \"WIS\" {\n            _wis, _ := strconv.ParseUint(xe[1], 10, 16)\n            wis = uint16(_wis)\n        }\n\n        if xe[0] == \"CON\" {\n            _con, _ := strconv.ParseUint(xe[1], 10, 16)\n            con = uint16(_con)\n        }\n\n        if xe[0] == \"KI\" {\n            _ki, _ := strconv.ParseUint(xe[1], 10, 32)\n            ki = uint32(_ki)\n        }\n\n        if xe[0] == \"EXP\" {\n            _exp, _ := strconv.ParseUint(xe[1], 10, 32)\n            exp = uint32(_exp)\n        }\n    }\n\n    return lv, str, agi, stm, spr, wis, con, ki, exp\n}\n</code></pre>\n\n<p>The string being parsed is:</p>\n\n<pre><code>Lv:400,STR:9999,AGI:8888,STM:7777,SPR:6666,WIS:5555,CON:4444,KI:3999999999,EXP:1\n</code></pre>\n"}, {"tags": ["go", "docker", "text-editor"], "answers": [{"comments": [{"owner": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "edited": false, "score": 0, "creation_date": 1456692298, "post_id": 35688006, "comment_id": 59053595, "body": "How about having container&#39;s path that is not a volume? Is it possible?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "edited": false, "score": 0, "creation_date": 1456692341, "post_id": 35688006, "comment_id": 59053612, "body": "@sargas sure: in that case, GOPATH is set to a path which is managed and visible only from within that container."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "edited": false, "score": 0, "creation_date": 1456692381, "post_id": 35688006, "comment_id": 59053627, "body": "@sargas in that case, it is easier to set it in the .bashrc of the default user in that container, if said path won&#39;t change."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "edited": false, "score": 0, "creation_date": 1456692567, "post_id": 35688006, "comment_id": 59053709, "body": "@sargas by container&#39;s path, do you mean the GOPATH path you want to set within that container?"}, {"owner": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "edited": false, "score": 0, "creation_date": 1456692794, "post_id": 35688006, "comment_id": 59053808, "body": "Yes. And the idea is to have that container GOPATH passed to a text editor in the host for development: auto completion, linting, etc. Sorry if I&#39;m being vague. I want to describe what I want as clear as possible."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "edited": false, "score": 0, "creation_date": 1456692844, "post_id": 35688006, "comment_id": 59053831, "body": "@sargas if you want to edit from the host, then you need an host volume: <a href=\"https://docs.docker.com/engine/reference/run/#volume-shared-filesystems\" rel=\"nofollow noreferrer\">docs.docker.com/engine/reference/run/#volume-shared-filesyst&zwnj;&#8203;ems</a>"}, {"owner": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "edited": false, "score": 0, "creation_date": 1456693698, "post_id": 35688006, "comment_id": 59054187, "body": "I see. Does your answer need a flag to mount a volume?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "edited": false, "score": 0, "creation_date": 1456693743, "post_id": 35688006, "comment_id": 59054206, "body": "@sargas I have edited the answer 14 minutes ago to add that flag."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 0, "last_activity_date": 1456693285, "last_edit_date": 1456693285, "creation_date": 1456692141, "answer_id": 35688006, "question_id": 35687929, "link": "https://stackoverflow.com/questions/35687929/how-to-retrieve-gopath-from-docker-container/35688006#35688006", "title": "How to retrieve GOPATH from Docker container?", "body": "<p>You can at least <a href=\"https://docs.docker.com/engine/reference/run/#env-environment-variables\" rel=\"nofollow\">set and pass those environment variable when launching your container</a>:</p>\n\n<pre><code>docker run -e \"GOPATH=/a/mounted/path\" -v [host-src:]container-dest --rm -it &lt;yourImage&gt;\n</code></pre>\n\n<p>By using <code>-v</code>, you allow your host to share a folder with your container.</p>\n"}], "owner": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1884, "favorite_count": 2, "accepted_answer_id": 35688006, "answer_count": 1, "score": 3, "last_activity_date": 1456693285, "creation_date": 1456691716, "question_id": 35687929, "link": "https://stackoverflow.com/questions/35687929/how-to-retrieve-gopath-from-docker-container", "title": "How to retrieve GOPATH from Docker container?", "body": "<p>My objective is to have a self contained Go Workspace per project.</p>\n\n<p>Is it possible to retrieve a Go workspace and Go environment variables from a running Docker container to be used by an IDE or Text Editor for development?</p>\n\n<p>I have already tried mapping a volume to the container with the go tools and dependencies. But that requires always setting the GOPATH to the current workspace, and requires to have the go tools and dependencies on the host.</p>\n"}, {"tags": ["regex", "image", "validation", "go"], "comments": [{"owner": {"reputation": 7747, "user_id": 4086774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faa70eacd799b083b10a8a43b418e2e1?s=128&d=identicon&r=PG&f=1", "display_name": "Lars Fischer", "link": "https://stackoverflow.com/users/4086774/lars-fischer"}, "edited": false, "score": 0, "creation_date": 1456691363, "post_id": 35687826, "comment_id": 59053226, "body": "You dont allow a point anywhere. You could put the point inside the character class. Also I am not sure about the placement of the last pipe relative to the parentheses."}, {"owner": {"reputation": 20813, "user_id": 4911842, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Wb3RO.png?s=128&g=1", "display_name": "developer033", "link": "https://stackoverflow.com/users/4911842/developer033"}, "edited": false, "score": 0, "creation_date": 1456691802, "post_id": 35687826, "comment_id": 59053389, "body": "Your question isn&#39;t clear. Please, write some examples that the Regex must match. By the way, why are you using 2 &quot;$&quot;? The end of the string must appear only once."}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "reply_to_user": {"reputation": 7747, "user_id": 4086774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faa70eacd799b083b10a8a43b418e2e1?s=128&d=identicon&r=PG&f=1", "display_name": "Lars Fischer", "link": "https://stackoverflow.com/users/4086774/lars-fischer"}, "edited": false, "score": 0, "creation_date": 1456692141, "post_id": 35687826, "comment_id": 59053536, "body": "@LarsFischer - I updated the question with what I tried. But it didn&#39;t help"}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "reply_to_user": {"reputation": 20813, "user_id": 4911842, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Wb3RO.png?s=128&g=1", "display_name": "developer033", "link": "https://stackoverflow.com/users/4911842/developer033"}, "edited": false, "score": 0, "creation_date": 1456692459, "post_id": 35687826, "comment_id": 59053663, "body": "@developer033 -  I updated with matching string."}, {"owner": {"reputation": 20813, "user_id": 4911842, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Wb3RO.png?s=128&g=1", "display_name": "developer033", "link": "https://stackoverflow.com/users/4911842/developer033"}, "edited": false, "score": 1, "creation_date": 1456692594, "post_id": 35687826, "comment_id": 59053720, "body": "I thought you want to match something like that. Take a look <a href=\"http://rubular.com/r/Hi5xVkbDOD\" rel=\"nofollow noreferrer\">rubular.com/r/Hi5xVkbDOD</a>. Is it right?"}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "reply_to_user": {"reputation": 20813, "user_id": 4911842, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Wb3RO.png?s=128&g=1", "display_name": "developer033", "link": "https://stackoverflow.com/users/4911842/developer033"}, "edited": false, "score": 0, "creation_date": 1456692995, "post_id": 35687826, "comment_id": 59053890, "body": "@developer033 -  Thanks. But it is not working for <code>&#47;home</code>. I want it to be flexible"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1456700456, "post_id": 35687826, "comment_id": 59056616, "body": "See <a href=\"https://play.golang.org/p/66iHN29UQc\" rel=\"nofollow noreferrer\">this demo</a>. Looks like <code>^&#47;$|^(?:&#47;(home|about|badge))?&#47;((?:badge|abc)\\.png|[a-zA-Z0-9&zwnj;&#8203;]*)$</code> should work for you. Please let me know."}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "edited": false, "score": 0, "creation_date": 1456701449, "post_id": 35687826, "comment_id": 59056934, "body": "This works as expected. Is it possible to parse /about/abc.png with this? also /badge.png"}], "answers": [{"comments": [{"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "edited": false, "score": 0, "creation_date": 1456693558, "post_id": 35688182, "comment_id": 59054118, "body": "Thanks. It closely matches with my requirement. But I am also trying to match abc.png along with batch.png. I tried the following in your goplay. But it is not working. Could you suggest me how to do that?   <code>var validPath = regexp.MustCompile(&quot;^&#47;((home|about)(&#47;?[a-zA-Z0-9]*)(|badge|a&zwnj;&#8203;bc)\\\\.png)?$&quot;)</code>"}, {"owner": {"reputation": 2208, "user_id": 5328069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21DZ0.jpg?s=128&g=1", "display_name": "morganbaz", "link": "https://stackoverflow.com/users/5328069/morganbaz"}, "reply_to_user": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "edited": false, "score": 0, "creation_date": 1456693744, "post_id": 35688182, "comment_id": 59054207, "body": "Updated my answer to support that."}, {"owner": {"reputation": 2208, "user_id": 5328069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21DZ0.jpg?s=128&g=1", "display_name": "morganbaz", "link": "https://stackoverflow.com/users/5328069/morganbaz"}, "reply_to_user": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "edited": false, "score": 0, "creation_date": 1456693815, "post_id": 35688182, "comment_id": 59054233, "body": "(or did you just mean to support <b>specifically</b> badge.png and abc.png, and not meant to allow any other picture?)"}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "edited": false, "score": 0, "creation_date": 1456694239, "post_id": 35688182, "comment_id": 59054372, "body": "You are right specifically abc.png | badge.png. Also I am trying to get the string after about. For example /about/global  `\t\tm := validPath.FindStringSubmatch(r.URL.Path) \t\tlog.Printf(&quot;validate() :: URL validation path m[2] : &quot;, m[2]) \t\tif m == nil { \t\t\thttp.NotFound(w, r) \t\t\treturn \t\t}` It is not taking m[2] = global."}, {"owner": {"reputation": 2208, "user_id": 5328069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21DZ0.jpg?s=128&g=1", "display_name": "morganbaz", "link": "https://stackoverflow.com/users/5328069/morganbaz"}, "reply_to_user": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "edited": false, "score": 0, "creation_date": 1456694826, "post_id": 35688182, "comment_id": 59054601, "body": "Hell, that looks like a lot of unnecessary work. Haven&#39;t you heard about <a href=\"https://github.com/julienschmidt/httprouter\" rel=\"nofollow noreferrer\">httprouter</a>?"}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "edited": false, "score": 0, "creation_date": 1456695318, "post_id": 35688182, "comment_id": 59054784, "body": "Ugh. I never heard about this. Yeah I can try that. Again that&#39;s lot of work. Application has lot of handlers. For now I have to stick with this :("}], "tags": [], "owner": {"reputation": 2208, "user_id": 5328069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21DZ0.jpg?s=128&g=1", "display_name": "morganbaz", "link": "https://stackoverflow.com/users/5328069/morganbaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1456693706, "last_edit_date": 1456693706, "creation_date": 1456693102, "answer_id": 35688182, "question_id": 35687826, "link": "https://stackoverflow.com/questions/35687826/regular-expression-to-validate-image/35688182#35688182", "title": "Regular expression to validate image", "body": "<p>What you are looking for is the following (based off the example paths you posted):</p>\n\n<pre><code>var validPath = regexp.MustCompile(\"^/((home|about)(/[a-zA-Z0-9]*)?|[a-zA-Z0-9]+\\\\.[a-z]+)?$\")\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/4zSZAudqhN\" rel=\"nofollow\">Playground with examples</a></p>\n"}, {"tags": [], "owner": {"reputation": 20813, "user_id": 4911842, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Wb3RO.png?s=128&g=1", "display_name": "developer033", "link": "https://stackoverflow.com/users/4911842/developer033"}, "is_accepted": false, "score": 0, "last_activity_date": 1456693467, "last_edit_date": 1456693467, "creation_date": 1456693130, "answer_id": 35688185, "question_id": 35687826, "link": "https://stackoverflow.com/questions/35687826/regular-expression-to-validate-image/35688185#35688185", "title": "Regular expression to validate image", "body": "<p>You can validate with the following Regex:</p>\n\n<pre><code>var validPath = regexp.MustCompile(\"^\\/(home|about|badge)\\/[a-zA-Z0-9]+[.][a-z]+$\")\n</code></pre>\n\n<p>Ps: I made a flexible Regex, so it accepts a lot of formats of images: <code>png</code>, <code>jpg</code>, <code>jpeg</code> and so on..</p>\n\n<p>You can test it here: <a href=\"http://rubular.com/r/17W82gABii\" rel=\"nofollow\">Regex</a></p>\n"}, {"tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 2, "last_activity_date": 1456951291, "creation_date": 1456951291, "answer_id": 35757646, "question_id": 35687826, "link": "https://stackoverflow.com/questions/35687826/regular-expression-to-validate-image/35757646#35757646", "title": "Regular expression to validate image", "body": "<p>It appears </p>\n\n<pre><code>^/$|^(?:/(home|about|badge))?/((?:badge|abc)\\.png|[a-zA-Z0-9]*)$\n</code></pre>\n\n<p>should work for you. See the <a href=\"https://regex101.com/r/eY1yW5/2\" rel=\"nofollow\">regex demo</a>.</p>\n\n<p>The pattern breakdown:</p>\n\n<ul>\n<li><code>^/$</code> - a <code>/</code> as a whole string</li>\n<li><code>|</code> - or...</li>\n<li><code>^</code> - start of string</li>\n<li><code>(?:/(home|about|badge))?</code> - optional sequence of <code>/</code> + either <code>home</code>, or <code>about</code> or <code>badge</code></li>\n<li><code>/</code> - a <code>/</code> symbol followed with</li>\n<li><code>((?:badge|abc)\\.png|[a-zA-Z0-9]*)</code> - Group 1 capturing:\n\n<ul>\n<li><code>(?:badge|abc)\\.png</code> - <code>badge</code> or <code>abc</code> followed with <code>.png</code></li>\n<li><code>|</code> - or...</li>\n<li><code>[a-zA-Z0-9]*</code> - zero or more alphanumerics</li>\n</ul></li>\n<li><code>$</code> - end of string</li>\n</ul>\n\n<p>And here is the <a href=\"https://play.golang.org/p/66iHN29UQc\" rel=\"nofollow\">Go playground demo</a>.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"regexp\"\n\nfunc main() {\n    //var validPath = regexp.MustCompile(\"^/((home|about)(/[a-zA-Z0-9]*)?|[a-zA-Z0-9]+\\\\.[a-z]+)?$\")\n    var validPath = regexp.MustCompile(`^/$|^(?:/(home|about|badge))?/((?:badge|abc)\\.png|[a-zA-Z0-9]*)$`)\n\n    fmt.Println(validPath.MatchString(\"/\"), validPath.MatchString(\"/home/\"), validPath.MatchString(\"/about/\"), validPath.MatchString(\"/home/13jia0\"), validPath.MatchString(\"/about/1jnmjan\"), validPath.MatchString(\"/badge.png\"), validPath.MatchString(\"/abc.png\"))\n    fmt.Println(validPath.MatchString(\"/nope/\"), validPath.MatchString(\"/invalid.png\"), validPath.MatchString(\"/test/test\"))\n\n    m := validPath.FindStringSubmatch(\"/about/global\")\n    fmt.Println(\"validate() :: URL validation path m[1] : \", m[1])\n    fmt.Println(\"validate() :: URL validation path m[2] : \", m[2])\n    if m == nil || m[2] != \"global\" {\n        fmt.Println(\"Not valid\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 358, "favorite_count": 0, "accepted_answer_id": 35757646, "answer_count": 3, "score": 2, "last_activity_date": 1456951291, "creation_date": 1456691102, "last_edit_date": 1456692415, "question_id": 35687826, "link": "https://stackoverflow.com/questions/35687826/regular-expression-to-validate-image", "title": "Regular expression to validate image", "body": "<p>I am writing a web application in golang. I am using regular expression to validate the URL. But I am not able to validate image (abc.png) in the URL validation.</p>\n\n<pre><code>var validPath = regexp.MustCompile(\"^/$|/(home|about|badge)/(|[a-zA-Z0-9]+)$\")\n</code></pre>\n\n<p>The above URL takes <code>/home/</code>, <code>/about/</code> but could not make for <code>/abc.png</code>. I mean <code>.</code> itself not working</p>\n\n<p>I tried the following regex, but it didn't help</p>\n\n<pre><code>var validPath = regexp.MustCompile(\"^/$|/(home|about|badge|.)/(|[a-zA-Z0-9]+)$\")\nvar validPath = regexp.MustCompile(\"^/$|/(home|about|badge)(/|.)(|[a-zA-Z0-9]+)$\")\n</code></pre>\n\n<p>And I am trying to match <a href=\"http://localhost:8080/badge.png\" rel=\"nofollow\">http://localhost:8080/badge.png</a></p>\n\n<p>Could anyone please help me on this?</p>\n"}, {"tags": ["go", "binary", "pack"], "answers": [{"comments": [{"owner": {"reputation": 2337, "user_id": 600061, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bbac8bb4d3ffbceca42b09eb0729e63c?s=128&d=identicon&r=PG", "display_name": "Twisted1919", "link": "https://stackoverflow.com/users/600061/twisted1919"}, "edited": false, "score": 0, "creation_date": 1475663846, "post_id": 35687306, "comment_id": 67029977, "body": "Amazing answer!"}], "tags": [], "owner": {"reputation": 2208, "user_id": 5328069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21DZ0.jpg?s=128&g=1", "display_name": "morganbaz", "link": "https://stackoverflow.com/users/5328069/morganbaz"}, "is_accepted": true, "score": 3, "last_activity_date": 1456688378, "creation_date": 1456688378, "answer_id": 35687306, "question_id": 35687305, "link": "https://stackoverflow.com/questions/35687305/go-equivalent-for-phps-pack/35687306#35687306", "title": "Go equivalent for PHP&#39;s pack()?", "body": "<p>Why would you need to use a function such as <code>pack()</code> in a language where the types in <code>pack()</code> are already native types of the language itself?</p>\n\n<p>To encode binary data you'd use the package <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow\"><code>encoding/binary</code></a>. To replicate your code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/binary\"\n    \"fmt\"\n)\n\nfunc main() {\n    buf := new(bytes.Buffer)\n    byteOrder := binary.LittleEndian\n\n    binary.Write(buf, byteOrder, uint32(92301))\n    fmt.Printf(\"uint32: %x\\n\", buf.Bytes())\n\n    buf.Reset()\n    binary.Write(buf, byteOrder, uint16(65535))\n    fmt.Printf(\"uint16: %x\\n\", buf.Bytes())\n\n    buf.Reset()\n    binary.Write(buf, byteOrder, float32(0.0012))\n    fmt.Printf(\"float: %x\\n\", buf.Bytes())\n}\n</code></pre>\n\n<p>(<a href=\"https://play.golang.org/p/TPP20dQmyA\" rel=\"nofollow\">playground</a>)</p>\n\n<p>With that, it's fairly easy to get going encoding other data structures. You really just need to change the third argument of <code>binary.Write</code> to be of the data type you wish, and the function will do <a href=\"https://golang.org/src/encoding/binary/binary.go#L244\" rel=\"nofollow\">all the magic</a>! </p>\n"}, {"tags": [], "owner": {"reputation": 105, "user_id": 3135599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31da06448e9a7126268fc3cbd8dbaee6?s=128&d=identicon&r=PG", "display_name": "Abu Junayd", "link": "https://stackoverflow.com/users/3135599/abu-junayd"}, "is_accepted": false, "score": 0, "last_activity_date": 1585744959, "last_edit_date": 1585744959, "creation_date": 1538925169, "answer_id": 52689887, "question_id": 35687305, "link": "https://stackoverflow.com/questions/35687305/go-equivalent-for-phps-pack/52689887#52689887", "title": "Go equivalent for PHP&#39;s pack()?", "body": "<p>This is not a complete answer, but since I've been looking for the following myself, I thought it could help others here too.</p>\n\n<p>For a direct equivalent of php's bin2hex(), you can do:</p>\n\n<pre><code>import \"encoding/hex\"\n\nfunc bin2hex(str string) string {\n  return hex.EncodeToString([]byte(str))\n}\n</code></pre>\n"}], "owner": {"reputation": 2208, "user_id": 5328069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21DZ0.jpg?s=128&g=1", "display_name": "morganbaz", "link": "https://stackoverflow.com/users/5328069/morganbaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1612, "favorite_count": 0, "accepted_answer_id": 35687306, "answer_count": 2, "score": 0, "last_activity_date": 1585744959, "creation_date": 1456688378, "question_id": 35687305, "link": "https://stackoverflow.com/questions/35687305/go-equivalent-for-phps-pack", "title": "Go equivalent for PHP&#39;s pack()?", "body": "<p>In PHP, to encode binary data, such as integers, floats and so on, I'd do the following:</p>\n\n<pre><code>&lt;?php\n\n$uint32 = pack(\"V\", 92301);\n$uint16 = pack(\"v\", 65535);\n$float = pack(\"f\", 0.0012);\n\necho \"uint32: \" . bin2hex($uint32) . \"\\n\"; // 8d680100\necho \"uint16: \" . bin2hex($uint16) . \"\\n\"; // ffff\necho \"float: \" . bin2hex($float) . \"\\n\"; // 52499d3a\n</code></pre>\n\n<p>How can I bring this code into Go?</p>\n"}, {"tags": ["go", "revel"], "answers": [{"tags": [], "owner": {"reputation": 19583, "user_id": 3026283, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/SyT5b.png?s=128&g=1", "display_name": "H&#233;ctor", "link": "https://stackoverflow.com/users/3026283/h%c3%a9ctor"}, "is_accepted": true, "score": 0, "last_activity_date": 1456913885, "creation_date": 1456913885, "answer_id": 35744281, "question_id": 35685902, "link": "https://stackoverflow.com/questions/35685902/cant-retrieve-form-params-with-revel/35744281#35744281", "title": "Can&#39;t retrieve form params with Revel", "body": "<p>I found the solution. I had to pass form params as method parameters:</p>\n\n<pre><code>// id and nickname are form params\nfunc (c UserController) SaveUser(id, nickname string) revel.Result {\n    return c.RenderJson(c.Params)\n}\n</code></pre>\n"}], "owner": {"reputation": 19583, "user_id": 3026283, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/SyT5b.png?s=128&g=1", "display_name": "H&#233;ctor", "link": "https://stackoverflow.com/users/3026283/h%c3%a9ctor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 372, "favorite_count": 0, "accepted_answer_id": 35744281, "answer_count": 1, "score": 0, "last_activity_date": 1456913885, "creation_date": 1456681048, "question_id": 35685902, "link": "https://stackoverflow.com/questions/35685902/cant-retrieve-form-params-with-revel", "title": "Can&#39;t retrieve form params with Revel", "body": "<p>I can't retrieve the form data using Revel. I'm able to retrieve query params though.</p>\n\n<p>I have this controller to test the content of <code>c.Params</code>:</p>\n\n<pre><code>func (c UserController) SaveUser() revel.Result {\n    return c.RenderJson(c.Params) //just for check the content\n}\n</code></pre>\n\n<p>When I pass a query param (testkey, value) I get:</p>\n\n<pre><code>{\n  \"Values\": {\n    \"testkey\": [\n      \"value\"\n    ]\n  },\n  \"Fixed\": null,\n  \"Route\": null,\n  \"Query\": {\n    \"testkey\": [\n      \"value\"\n    ]\n  },\n  \"Form\": null,\n  \"Files\": null\n}\n</code></pre>\n\n<p>Everything ok. But when I pass a form param and I don't get any data:</p>\n\n<pre><code>{\n  \"Values\": {},\n  \"Fixed\": null,\n  \"Route\": null,\n  \"Query\": {},\n  \"Form\": null,\n  \"Files\": null\n}\n</code></pre>\n\n<p>It is a <code>PUT</code> request and I'm using Postman to pass form params.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1456692204, "post_id": 35681677, "comment_id": 59053562, "body": "The code is different for different operating systems. I don&#39;t know enough about OS level packet handling to tell you much more than that. On Windows it calls out to C libraries. Unix uses the syscall library."}], "answers": [{"tags": [], "owner": {"reputation": 1803, "user_id": 1351728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1f4a48cd869bb98e6b60c3316a1247ab?s=128&d=identicon&r=PG", "display_name": "omribahumi", "link": "https://stackoverflow.com/users/1351728/omribahumi"}, "is_accepted": true, "score": 0, "last_activity_date": 1466977675, "creation_date": 1466977675, "answer_id": 38043506, "question_id": 35681677, "link": "https://stackoverflow.com/questions/35681677/getting-the-destination-address-of-a-datagram-in-go/38043506#38043506", "title": "Getting the destination address of a datagram in GO", "body": "<p>I implemented this in a DNS library in Go a couple of years ago.<br>\nYou can see the discussion in the pull request <a href=\"https://github.com/miekg/dns/issues/95\" rel=\"nofollow\">here</a>.</p>\n\n<p>There was another <a href=\"https://github.com/miekg/dns/pull/192\" rel=\"nofollow\">PR</a> making this public a year ago, so I guess you can just import that module from your code.</p>\n"}], "owner": {"reputation": 81, "user_id": 1821933, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c464d32c575063cb9701381d12aa086c?s=128&d=identicon&r=PG", "display_name": "Banyoghurt", "link": "https://stackoverflow.com/users/1821933/banyoghurt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 38043506, "answer_count": 1, "score": 1, "last_activity_date": 1466977675, "creation_date": 1456657459, "question_id": 35681677, "link": "https://stackoverflow.com/questions/35681677/getting-the-destination-address-of-a-datagram-in-go", "title": "Getting the destination address of a datagram in GO", "body": "<p>In C it's possible to setsockopt IP_PKTINFO.\nIs there any way to get the destination address of the underlying IP packet in GO?</p>\n\n<pre><code>_, addr, err := d.conn.ReadFromUDP(buf)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 106150, "user_id": 213464, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a7ba62044bc19143ea4a38cf490b67f2?s=128&d=identicon&r=PG", "display_name": "YOU", "link": "https://stackoverflow.com/users/213464/you"}, "is_accepted": true, "score": 79, "last_activity_date": 1456657499, "creation_date": 1456657499, "answer_id": 35681682, "question_id": 35681595, "link": "https://stackoverflow.com/questions/35681595/escape-variables-with-printf/35681682#35681682", "title": "Escape Variables with Printf", "body": "<p>You can use %% for literal %</p>\n\n<pre><code>%%  a literal percent sign; consumes no value\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/fmt/\">https://golang.org/pkg/fmt/</a></p>\n"}], "owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 28884, "favorite_count": 3, "accepted_answer_id": 35681682, "answer_count": 1, "score": 34, "last_activity_date": 1561541158, "creation_date": 1456657042, "last_edit_date": 1561541158, "question_id": 35681595, "link": "https://stackoverflow.com/questions/35681595/escape-variables-with-printf", "title": "Escape Variables with Printf", "body": "<p>If I wanted to do the following:</p>\n\n<pre><code>fmt.Printf(\"Escape this -&gt; %v... Do not escape this -&gt; %v\", \"Unescaped\")\n</code></pre>\n\n<p>How could I escape the first occurrence of <code>%v</code>? </p>\n\n<p><code>\\%v</code> doesn't seem to work. Any ideas?</p>\n"}, {"tags": ["debugging", "go", "stack-trace", "aws-lambda"], "comments": [{"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1456686778, "post_id": 35679647, "comment_id": 59051541, "body": "If you&#39;re interested I would encourage you to read this blog post. <a href=\"https://blog.golang.org/error-handling-and-go\" rel=\"nofollow noreferrer\">blog.golang.org/error-handling-and-go</a> . Go doesn&#39;t &quot;throw&quot; errors, it returns them. If you imagine handing somebody a form, if you made a mistake with the form they shouldn&#39;t throw it up in the air and crash the whole office. They should tell you what you did wrong. The latter is what happened here."}], "answers": [{"tags": [], "owner": {"reputation": 7865, "user_id": 576932, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/2084548226e1ab1a0814812cccb29bef?s=128&d=identicon&r=PG", "display_name": "ford", "link": "https://stackoverflow.com/users/576932/ford"}, "is_accepted": false, "score": 1, "last_activity_date": 1456750009, "last_edit_date": 1456750009, "creation_date": 1456667912, "answer_id": 35683414, "question_id": 35679647, "link": "https://stackoverflow.com/questions/35679647/trick-to-quickly-find-file-line-number-throwing-an-error-in-go/35683414#35683414", "title": "Trick to quickly find file &amp; line number throwing an error in Go?", "body": "<p>Go <em>does</em> produce stack traces when a <code>panic</code> happens, crashing the program. This will happen if the code calls <code>panic()</code> directly, typically in cases like:</p>\n\n<pre><code>if err != nil {\n    panic(\"it broke\")\n}\n</code></pre>\n\n<p>or, when a runtime error happens:</p>\n\n<pre><code>a := []int{1, 2, 3}\nb := a[12] // index out of range\n</code></pre>\n\n<p>Here's a minimal example:</p>\n\n<pre><code>package main\n\nfunc main() {\n    panic(\"wtf?!\")\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>panic: wtf?!\n\ngoroutine 1 [running]:\npanic(0x94e60, 0x1030a040)\n    /usr/local/go/src/runtime/panic.go:464 +0x700\nmain.main()\n    /tmp/sandbox366642315/main.go:4 +0x80\n</code></pre>\n\n<p>Note the <code>main.go:4</code> indicating the filename and line number.</p>\n\n<p>In your example, the program <em>did not</em> panic, instead opting to call (I'm guessing) <code>os.Exit(1)</code> or <code>log.Fatal(\"error message\")</code> (which calls <code>os.Exit(1)</code>). Or, the panic was simply recovered from in the calling function. <strong>Unfortunately, there's nothing you can do about this if you aren't the author of the code.</strong></p>\n\n<p>I would recommend reading <a href=\"http://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow\">Defer, Panic, and Recover</a> on the Golang blog for more about this.</p>\n"}, {"tags": [], "owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "is_accepted": false, "score": 2, "last_activity_date": 1456679323, "last_edit_date": 1490005771, "creation_date": 1456679323, "answer_id": 35685565, "question_id": 35679647, "link": "https://stackoverflow.com/questions/35679647/trick-to-quickly-find-file-line-number-throwing-an-error-in-go/35685565#35685565", "title": "Trick to quickly find file &amp; line number throwing an error in Go?", "body": "<p><strong>Your attempted <em>solution</em>:</strong> Finding the piece of code that produces the error to fix the code.</p>\n\n<p><strong>Your actual <em>problem</em>:</strong> The content of <code>event.json</code>.</p>\n\n<p><sub>This is called the <a href=\"https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">X-Y-Problem</a></sub>  </p>\n\n<hr>\n\n<p>Invoke expects a json object, you are passing a json array. Fix that and your problem is gone!</p>\n\n<pre><code>$ echo -n '{ \"value\": \"Tobi the ferret\" }' | apex invoke uppercase\n</code></pre>\n\n<p>Relevant part of the documentation: <a href=\"http://apex.run/#invoking-functions\" rel=\"nofollow noreferrer\">Invoking Functions</a></p>\n\n<p>And that's the piece of code that produces the error: <a href=\"https://github.com/apex/apex/blob/8ae0929b54e6e47902c32e7431c47d48c6cd098d/cmd/apex/invoke/invoke.go#L67\" rel=\"nofollow noreferrer\">Github</a></p>\n\n<hr>\n\n<p>And yes, Go does have stack traces! Read <a href=\"http://dave.cheney.net/2012/01/18/why-go-gets-exceptions-right\" rel=\"nofollow noreferrer\">Dave Cheneys blog post on errors and exceptions</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1264, "user_id": 576497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95aa2f41b1b5b0a05a4cfd974eeb663d?s=128&d=identicon&r=PG", "display_name": "Xiaofan Hu", "link": "https://stackoverflow.com/users/576497/xiaofan-hu"}, "is_accepted": true, "score": 2, "last_activity_date": 1604340202, "last_edit_date": 1604340202, "creation_date": 1457087224, "answer_id": 35793633, "question_id": 35679647, "link": "https://stackoverflow.com/questions/35679647/trick-to-quickly-find-file-line-number-throwing-an-error-in-go/35793633#35793633", "title": "Trick to quickly find file &amp; line number throwing an error in Go?", "body": "<blockquote>\n<p>What is way to quickly find which file/line this error coming from?</p>\n</blockquote>\n<p>There are no default stacks printed unless it's an unrecovered panic.</p>\n<blockquote>\n<p>In General, Are there tips/tricks which gophers use to get to the source of problem quickly from this string error message? is this how stack traces are for most go projects or there are any best practices that should be followed?</p>\n</blockquote>\n<p>In General, you need to check error returns from most of the function calls. There are more than one way to do that.\nI usually use standard library package <code>log</code> to print out error logs with file and line numbers for easy debugging in simple programs. For example:</p>\n<pre><code>package main\n\nimport &quot;log&quot;\nimport &quot;errors&quot;\n\nfunc init() { log.SetFlags(log.Lshortfile | log.LstdFlags) }\n\nfunc callFunc() error {\n    return errors.New(&quot;error&quot;)\n}\n\nfunc main() {\n    if err := callFunc(); err != nil {\n        log.Println(err)\n    }\n}\n</code></pre>\n<p><a href=\"http://play.golang.org/p/0iytNw7eZ7\" rel=\"nofollow noreferrer\">http://play.golang.org/p/0iytNw7eZ7</a></p>\n<p>output:</p>\n<pre><code>2009/11/10 23:00:00 main.go:14: error\n</code></pre>\n<p>Also, there are functions for you to print or retrieve current stacks in standard library <code>runtime/debug</code>, e.g. <a href=\"https://golang.org/pkg/runtime/debug/#PrintStack\" rel=\"nofollow noreferrer\">https://golang.org/pkg/runtime/debug/#PrintStack</a></p>\n<p>There are many community efforts on bringing error handling easier, you can search error in GoDoc: <a href=\"https://godoc.org/?q=error\" rel=\"nofollow noreferrer\">https://godoc.org/?q=error</a></p>\n"}, {"tags": [], "owner": {"reputation": 10306, "user_id": 658497, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/AiHJI.jpg?s=128&g=1", "display_name": "Noam Manos", "link": "https://stackoverflow.com/users/658497/noam-manos"}, "is_accepted": false, "score": 0, "last_activity_date": 1604471530, "last_edit_date": 1604471530, "creation_date": 1604323841, "answer_id": 64646529, "question_id": 35679647, "link": "https://stackoverflow.com/questions/35679647/trick-to-quickly-find-file-line-number-throwing-an-error-in-go/64646529#64646529", "title": "Trick to quickly find file &amp; line number throwing an error in Go?", "body": "<p>Setting <code>log.SetFlags(log.LstdFlags | log.Lshortfile)</code> in main() should do it.</p>\n<p>For example, <code>log.Printf(&quot;Deadline!&quot;)</code> would print:</p>\n<blockquote>\n<p>03/11/2020 23:59:59 liberty_test.go:42: Deadline!</p>\n</blockquote>\n"}], "owner": {"reputation": 31539, "user_id": 367985, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/761edb9c3cf7a0a643e73ef40666a1f7?s=128&d=identicon&r=PG", "display_name": "CuriousMind", "link": "https://stackoverflow.com/users/367985/curiousmind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2004, "favorite_count": 0, "accepted_answer_id": 35793633, "answer_count": 4, "score": 2, "last_activity_date": 1604471530, "creation_date": 1456642001, "last_edit_date": 1456642435, "question_id": 35679647, "link": "https://stackoverflow.com/questions/35679647/trick-to-quickly-find-file-line-number-throwing-an-error-in-go", "title": "Trick to quickly find file &amp; line number throwing an error in Go?", "body": "<p>In my journey with go discovered that there are no stacktraces. so whenever something breaks, all we get an simple string error message without any information where is this is coming from. This is in stark contrast with other languages where I am used to <a href=\"http://i.stack.imgur.com/yAUSD.png\" rel=\"nofollow\">seing detailed stacktraces</a></p>\n\n<p>For example, below is the error message from <a href=\"https://github.com/apex/apex\" rel=\"nofollow\">apex</a></p>\n\n<pre><code>$ cat event.json | apex invoke --logs webhook                                  \n   \u2a2f error parsing response: json: cannot unmarshal array into Go value of type map[string]interface {}\n</code></pre>\n\n<p>here its telling me that unmarshal to a map ins't working because <code>event.json</code> is an array. We have unmarshal to <code>interface{}</code> to support both arrays &amp; maps.However, it doesn't tell me which file/line is causing this error. </p>\n\n<p><strong>Questions:</strong></p>\n\n<ol>\n<li>What is way to quickly find which file/line this error coming from?</li>\n<li>In General, Are there tips/tricks which gophers use to get to the source of problem quickly from this string error message?</li>\n<li>is this how stack traces are for most go projects or there are any best practices that should be followed?</li>\n</ol>\n"}, {"tags": ["linux", "windows", "go", "signals"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456628257, "post_id": 35677972, "comment_id": 59034780, "body": "That captures signals just fine on unix, so you need to show the accompanying code.  I&#39;m not really familiar with windows, with IIRC you can&#39;t catch ctrl+c as a signal and it has to be handled by the terminal."}, {"owner": {"reputation": 444, "user_id": 2526327, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/hJlUp.png?s=128&g=1", "display_name": "Vishwasa Navada K", "link": "https://stackoverflow.com/users/2526327/vishwasa-navada-k"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456629471, "post_id": 35677972, "comment_id": 59034988, "body": "@JimB rest of the code can be viewed <a href=\"https://github.com/GOOFS/go-goof-Talk/blob/master/client/client.go\" rel=\"nofollow noreferrer\">here</a>. But that does not have the code snippet I mentioned above."}], "answers": [{"comments": [{"owner": {"reputation": 444, "user_id": 2526327, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/hJlUp.png?s=128&g=1", "display_name": "Vishwasa Navada K", "link": "https://stackoverflow.com/users/2526327/vishwasa-navada-k"}, "edited": false, "score": 1, "creation_date": 1456676475, "post_id": 35683558, "comment_id": 59047385, "body": "Thanks for the detailed answer and documentation quotes. I also found that one more go routine was clashing with it and changing the order of function call also helped me to resolve this."}, {"owner": {"reputation": 491, "user_id": 7655137, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5203fc333c6443affb37aa2209267d71?s=128&d=identicon&r=PG&f=1", "display_name": "darkwing", "link": "https://stackoverflow.com/users/7655137/darkwing"}, "edited": false, "score": 0, "creation_date": 1560483763, "post_id": 35683558, "comment_id": 99759458, "body": "Thanks for the question and answer. Couldn&#39;t figure out why my code was not catching <code>SIGINT</code> - putting the goroutine that catches as the very first code in <code>main</code> did the trick"}], "tags": [], "owner": {"reputation": 7865, "user_id": 576932, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/2084548226e1ab1a0814812cccb29bef?s=128&d=identicon&r=PG", "display_name": "ford", "link": "https://stackoverflow.com/users/576932/ford"}, "is_accepted": true, "score": 6, "last_activity_date": 1456668808, "creation_date": 1456668808, "answer_id": 35683558, "question_id": 35677972, "link": "https://stackoverflow.com/questions/35677972/capturing-ctrlc-or-any-other-process-terminating-signals-in-windows-and-linux-w/35683558#35683558", "title": "Capturing ctrl+c or any other process terminating signals in windows and linux with golang", "body": "<p>According to the docs on <code>os.Signal</code>, it should be possible to catch interrupts on Windows: <a href=\"https://golang.org/pkg/os/signal/#hdr-Windows\" rel=\"noreferrer\">https://golang.org/pkg/os/signal/#hdr-Windows</a>. I haven't tested this personally, though.</p>\n\n<p>I suspect your problem is that you should only use signals imported from <code>os</code>, such as <code>os.Interrupt</code>, instead of <code>syscall</code>.</p>\n\n<p>From <a href=\"https://golang.org/pkg/os/#Signal\" rel=\"noreferrer\">https://golang.org/pkg/os/#Signal</a>:</p>\n\n<blockquote>\n  <p>The only signal values guaranteed to be present on all systems are Interrupt (send the process an interrupt) and Kill (force the process to exit).</p>\n</blockquote>\n\n<p>And from <a href=\"https://golang.org/pkg/syscall/#pkg-overview\" rel=\"noreferrer\">https://golang.org/pkg/syscall/#pkg-overview</a>:</p>\n\n<blockquote>\n  <p>The primary use of syscall is inside other packages that provide a more portable interface to the system, such as \"os\", \"time\" and \"net\". Use those packages rather than this one if you can.</p>\n</blockquote>\n\n<p>So, change your <code>signal.Notify</code> call to catch only the <code>os.Interrupt</code> signal.</p>\n"}], "owner": {"reputation": 444, "user_id": 2526327, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/hJlUp.png?s=128&g=1", "display_name": "Vishwasa Navada K", "link": "https://stackoverflow.com/users/2526327/vishwasa-navada-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2683, "favorite_count": 0, "accepted_answer_id": 35683558, "answer_count": 1, "score": 3, "last_activity_date": 1456668808, "creation_date": 1456626130, "last_edit_date": 1495541877, "question_id": 35677972, "link": "https://stackoverflow.com/questions/35677972/capturing-ctrlc-or-any-other-process-terminating-signals-in-windows-and-linux-w", "title": "Capturing ctrl+c or any other process terminating signals in windows and linux with golang", "body": "<p>I am trying to build a chatroom application in go and I want to call logout function when client uses ctrl+c or presses close buttom of the terminal. <br/>\nI tried methods given <a href=\"https://stackoverflow.com/questions/11268943/golang-is-it-possible-to-capture-a-ctrlc-signal-and-run-a-cleanup-function-in\">here</a> and <a href=\"https://stackoverflow.com/questions/18106749/golang-catch-signals\">here</a> but they were not capturing any signals(tried in Windows 10 and Fedora 23). Here is my code snippet,</p>\n\n<pre><code>sigc := make(chan os.Signal, 1)\nsignal.Notify(sigc,\n    syscall.SIGHUP,\n    syscall.SIGINT,\n    syscall.SIGTERM,\n    syscall.SIGQUIT)\ngo func() {\n    _ = &lt;-sigc\n    fmt.Println(\"ctrl+c pressed\")\n    client.Logout()\n}()\n</code></pre>\n\n<p>I have some other functions running concurrently using goroutine, is it the reason behind this function not capturing any signals? </p>\n\n<p>Any help would be appreciated. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456624628, "post_id": 35677713, "comment_id": 59034109, "body": "There&#39;s always more than 1 goroutine running as part of the runtime. Print the number of goroutines before and after."}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456626396, "post_id": 35677713, "comment_id": 59034460, "body": "@JimB If I takeout the timeout then I get just 1 running before and after <a href=\"http://play.golang.org/p/5JwJ-2GImJ\" rel=\"nofollow noreferrer\">play.golang.org/p/5JwJ-2GImJ</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456628513, "post_id": 35677713, "comment_id": 59034833, "body": "sorry, didn&#39;t read closely enough. You&#39;re just racing to print the result with the last goroutines finishing. Make your timeout slightly longer, like 1200ms, and you&#39;ll only miss 1 result and the rest will be done before you call NumGoroutines."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456629254, "post_id": 35677713, "comment_id": 59034950, "body": "(BTW, it is unrelated to this -- there are more goroutines, but they are no longer counted by NumGoroutines. If you panic with GOTRACEBACK=system, you&#39;ll see a few more)"}], "answers": [{"tags": [], "owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "is_accepted": true, "score": 1, "last_activity_date": 1456693961, "last_edit_date": 1456693961, "creation_date": 1456626890, "answer_id": 35678045, "question_id": 35677713, "link": "https://stackoverflow.com/questions/35677713/why-am-i-getting-a-memory-leak/35678045#35678045", "title": "Why am I getting a memory leak?", "body": "<p>There is a weird race condition. Basically what happens is when you call <code>Println</code> some goroutines are still running but will terminate shortly. Put a sleep before <code>Println</code> and you will get <code>1 Processes</code>. If you read the log you will see 2 timeouts - it means you skipped 2 channel reads in the loop. Somehow it gives your main goroutine time to read 8 values from the channel and call <code>Println</code> before 2 goroutines are terminated. It's a race condition so it's hard to describe exactly what's going on. Apart from your code the scheduler and channels implementation also play major here. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 35678045, "answer_count": 1, "score": 0, "last_activity_date": 1456693961, "creation_date": 1456623540, "question_id": 35677713, "link": "https://stackoverflow.com/questions/35677713/why-am-i-getting-a-memory-leak", "title": "Why am I getting a memory leak?", "body": "<p>I have the following: <a href=\"http://play.golang.org/p/1aaive8KQx\" rel=\"nofollow\">http://play.golang.org/p/1aaive8KQx</a></p>\n\n<p>When I print the runtime.NumGoroutine() I get 3. Shouldn't I be getting just 1? Why?</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc main() {\n    for i := 1; i &lt;= 10; i++ {\n        ch := make(chan int, 10)\n        timeout := time.Tick(1 * time.Second)\n        for i := 1; i &lt;= 10; i++ {\n            go func(i int) {\n                time.Sleep(2 * time.Second)\n                ch &lt;- i\n            }(i)\n        }\n\n        for i := 1; i &lt;= 10; i++ {\n            select {\n            case j := &lt;-ch:\n                log.Println(j)\n            case &lt;-timeout:\n                log.Println(\"timeout\")\n\n            }\n\n        }\n\n        log.Println(\"Processes\", runtime.NumGoroutine())\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "embedding"], "answers": [{"tags": [], "owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "is_accepted": true, "score": 5, "last_activity_date": 1456626329, "creation_date": 1456626329, "answer_id": 35677993, "question_id": 35677690, "link": "https://stackoverflow.com/questions/35677690/is-an-embedded-error-exported/35677993#35677993", "title": "Is an embedded error exported?", "body": "<p>When you embed an <code>error</code> interface into a struct, basically, you add a field named <code>error</code> with type <code>error</code> to it.</p>\n\n<p>Because it's embedded your struct now also implements all of it's methods. That means your struct satisfies the <code>error</code> interface and you can call <code>Error()</code> on it or just pass it to <code>Println</code> as it is and it will type assert it into <code>error</code> and call <code>Error()</code> for you <a href=\"https://play.golang.org/p/0VxUUX2l-z\" rel=\"noreferrer\">https://play.golang.org/p/0VxUUX2l-z</a></p>\n\n<p>Obviously, because field is named <code>error</code> it's not exported. But the struct still satisfies the <code>error</code> interface because it has <code>Error()</code> method.</p>\n\n<p>Interesting consequence of this is that if you don't initialize the field <code>Println</code> will panic because it will try to call <code>Error()</code> on nil  <a href=\"https://play.golang.org/p/XctFgKZI-K\" rel=\"noreferrer\">https://play.golang.org/p/XctFgKZI-K</a></p>\n"}], "owner": {"reputation": 7430, "user_id": 2105930, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e884c31250cf768e8b8261e31cd0821?s=128&d=identicon&r=PG", "display_name": "chowey", "link": "https://stackoverflow.com/users/2105930/chowey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 562, "favorite_count": 0, "accepted_answer_id": 35677993, "answer_count": 1, "score": 3, "last_activity_date": 1456626329, "creation_date": 1456623344, "question_id": 35677690, "link": "https://stackoverflow.com/questions/35677690/is-an-embedded-error-exported", "title": "Is an embedded error exported?", "body": "<p>According to the <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow\">Go language spec</a>, I can embed a type in a struct.</p>\n\n<p>There is a weird case with the <code>error</code> interface. It is not uppercased, so I assume it is not exported as a type. But it is defined by the language. So if I have a struct like this:</p>\n\n<pre><code>package foo\n\ntype Err struct {\n    error\n}\n</code></pre>\n\n<p>is the embedded <code>error</code> exported? Does <code>Err</code> satisfy the <code>error</code> interface?</p>\n\n<p>Can I access it from another package, i.e. is the following ok?</p>\n\n<pre><code>package main\n\nimport \"errors\"\nimport \"fmt\"\nimport \"foo\"\n\nfunc main() {\n    e := foo.Err{}\n    e.error = errors.New(\"Hello world!\") // is this okay?\n    fmt.Println(e.Error())\n}\n</code></pre>\n"}, {"tags": ["go", "proxy", "network-programming"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1456617920, "post_id": 35677048, "comment_id": 59032764, "body": "For inspiration: <a href=\"https://github.com/elazarl/goproxy\" rel=\"nofollow noreferrer\">github.com/elazarl/goproxy</a>"}], "answers": [{"tags": [], "owner": {"reputation": 16, "user_id": 3678204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e3fac36c88e6b6a7d3f863b852f7463?s=128&d=identicon&r=PG", "display_name": "Gunjan", "link": "https://stackoverflow.com/users/3678204/gunjan"}, "is_accepted": true, "score": 0, "last_activity_date": 1456769261, "creation_date": 1456769261, "answer_id": 35706451, "question_id": 35677048, "link": "https://stackoverflow.com/questions/35677048/how-to-pass-along-an-http-request-in-golang/35706451#35706451", "title": "How to pass along an http Request in golang?", "body": "<p>Check out Negroni middleware. It let's you pass your HTTP request through different middleware and custom HandlerFuncs. \nSomething like this:</p>\n\n<pre><code>   n := negroni.New(\n        negroni.NewRecovery(),\n        negroni.HandlerFunc(myMiddleware),\n        negroni.NewLogger(),\n        negroni.NewStatic(http.Dir(\"public\")),\n    )\n\n...\n...\n\nfunc myMiddleware(rw http.ResponseWriter, r *http.Request, next http.HandlerFunc) {\n    log.Println(\"Logging on the way there...\")\n\n    if r.URL.Query().Get(\"password\") == \"secret123\" {\n        next(rw, r)      //**&lt;--------passing the request to next middleware/func**\n    } else {\n        http.Error(rw, \"Not Authorized\", 401)\n    }\n\n    log.Println(\"Logging on the way back...\")\n}\n</code></pre>\n\n<p>Notice how <code>next(rw,r)</code> is used to pass along the HTTP request</p>\n\n<p>If you don't want to use Negroni, you can always look at it's implementation on how it passes the HTTP request to another middleware.</p>\n\n<p>It uses custom handler which looks something like:</p>\n\n<pre><code>handlerFunc func(rw http.ResponseWriter, r *http.Request, next http.HandlerFunc)\n</code></pre>\n\n<p>Ref: <a href=\"https://gobridge.gitbooks.io/building-web-apps-with-go/content/en/middleware/index.html\" rel=\"nofollow\">https://gobridge.gitbooks.io/building-web-apps-with-go/content/en/middleware/index.html</a></p>\n"}], "owner": {"reputation": 3027, "user_id": 3238611, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/270b9dbb510b505ef6ae1f8201c49582?s=128&d=identicon&r=PG&f=1", "display_name": "Everyone_Else", "link": "https://stackoverflow.com/users/3238611/everyone-else"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 619, "favorite_count": 0, "accepted_answer_id": 35706451, "answer_count": 1, "score": 1, "last_activity_date": 1456769261, "creation_date": 1456617828, "question_id": 35677048, "link": "https://stackoverflow.com/questions/35677048/how-to-pass-along-an-http-request-in-golang", "title": "How to pass along an http Request in golang?", "body": "<p>I have a Request object in golang, and I would like to feed the contents of this object through a net.Conn as part of the task of a proxy.\nI want to call something like</p>\n\n<pre><code>req, err := http.ReadRequest(bufio.NewReader(conn_to_client))\nconn_to_remote_server.Write(... ? ... )\n</code></pre>\n\n<p>but I have no idea what I would be passing in as the arguments.  Any advice would be appreciated.</p>\n"}, {"tags": ["mysql", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 495, "user_id": 5934834, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/263e6d6ad912197d1f650c8fead44bba?s=128&d=identicon&r=PG&f=1", "display_name": "Gonzalez", "link": "https://stackoverflow.com/users/5934834/gonzalez"}, "edited": false, "score": 0, "creation_date": 1456842424, "post_id": 35694130, "comment_id": 59125680, "body": "Many thanks for your answer! I didn&#39;t know about that capital letter in go."}], "tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": true, "score": 1, "last_activity_date": 1456731272, "creation_date": 1456731272, "answer_id": 35694130, "question_id": 35674903, "link": "https://stackoverflow.com/questions/35674903/error-when-trying-to-create-tables-from-model/35694130#35694130", "title": "Error when trying to create tables from model", "body": "<p>That error occurs when trying to create an empty table, eg:</p>\n\n<pre><code>create table User() ENGINE=InnoDB\n</code></pre>\n\n<p><a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow\">gorm</a> generates an empty table statement because the id field of the User struct is private.</p>\n\n<p>Change <code>id int</code> to <code>ID int</code>. <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow\">Capitalising</a> the first letter of a struct field exposes it to external packages.</p>\n\n<hr>\n\n<p>As a secondary issue, instead of just printing the error:</p>\n\n<pre><code>db, err := gorm.Open(...\nfmt.Println(err)\n</code></pre>\n\n<p>it's a good idea to check every potential error, and deal with them immediately:</p>\n\n<pre><code>db, err := gorm.Open(...\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>For other errors, <a href=\"https://github.com/jinzhu/gorm#error-handling\" rel=\"nofollow\">gorm's error handling</a> is a little unusual compared to most go code. You'll probably want to frequently check for errors using <a href=\"https://godoc.org/github.com/jinzhu/gorm#DB.GetErrors\" rel=\"nofollow\">db.GetErrors()</a>.</p>\n"}], "owner": {"reputation": 495, "user_id": 5934834, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/263e6d6ad912197d1f650c8fead44bba?s=128&d=identicon&r=PG&f=1", "display_name": "Gonzalez", "link": "https://stackoverflow.com/users/5934834/gonzalez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 810, "favorite_count": 0, "accepted_answer_id": 35694130, "answer_count": 1, "score": 0, "last_activity_date": 1456731272, "creation_date": 1456604003, "question_id": 35674903, "link": "https://stackoverflow.com/questions/35674903/error-when-trying-to-create-tables-from-model", "title": "Error when trying to create tables from model", "body": "<p>I started to play with gorm today but to bad came across some silly error and am stuck on it for a while.\nAt first I am on windows and run MySQL 5 (5.0.51b) and latest version of go. I did go get for gorm and mysql driver and it compiles without an error and is able to connect (likely), but whenever I try to create a table based on declared type it throws an error which isn't informative (because the error is thrown by MySQL). Here is my code:</p>\n\n<pre><code>mport (\n    \"fmt\"\n    _ \"github.com/go-sql-driver/mysql\"\n    \"github.com/jinzhu/gorm\"\n)\n\ntype User struct {\n    id int\n}\n\nfunc main() {\n    db, err := gorm.Open(\"mysql\", \"root:vertrigo@/shop?charset=utf8&amp;parseTime=True&amp;loc=Local\")\n    fmt.Println(err)\n\n    a := db.Set(\"gorm:table_options\", \"ENGINE=InnoDB\").CreateTable(&amp;User{})\n\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>So the model is aimed to be very basic, e.g. a table with one column. Now comes the output:</p>\n\n<blockquote>\n  <p>&lt; nil > &amp;{0x111e2230 Error 1064: You have an error in your SQL syntax;\n  check the manual that corresponds to your MySQL server version for the\n  right syntax to use near ') ENGINE=InnoDB' at line 1 0 \n  0x112d4060 0x112d4000 0x112d8140 0 {0x112a3f20}  false \n  map[gorm:table_options:ENGINE=InnoDB] map[]}</p>\n</blockquote>\n\n<p>The first  is a connection error which means it's able to connect but with the query it's not that good and the error says almost nothing other than SQL generated by gorm fails for some reason.\nSo the question is if some one has an idea why the error is thrown and if there is any solution.</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 978, "user_id": 5843918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ef4d8b41449d85eef88b08fdf9b05f?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/5843918/sean"}, "is_accepted": true, "score": 1, "last_activity_date": 1456609141, "creation_date": 1456609141, "answer_id": 35675770, "question_id": 35674730, "link": "https://stackoverflow.com/questions/35674730/marshalling-to-nonstring-type-in-golang-json-post-request/35675770#35675770", "title": "Marshalling to NonString type in Golang JSON POST Request", "body": "<p>You need to change the names of your Datablob values.  You've told the JSON decoder that they're all named \"id\".  You should try something like the following.  Also, take a look at the json.Marshal description and how it describes the tags for structs and how the json library handles them. <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow\">https://golang.org/pkg/encoding/json/#Marshal</a></p>\n\n<pre><code>type DataBlob struct {\n    Timestamp string\n    Metric_Id int `json:\"metric_id,string,omitempty\"`\n    Value float32 `json:\"value,string,omitempty\"`\n    Stderr float32 `json:\"stderr,string,omitempty\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 5438, "user_id": 1944335, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/8675e8c601fc98c0ad3a8272b417d0de?s=128&d=identicon&r=PG&f=1", "display_name": "James Taylor", "link": "https://stackoverflow.com/users/1944335/james-taylor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 631, "favorite_count": 0, "accepted_answer_id": 35675770, "answer_count": 1, "score": 0, "last_activity_date": 1456609141, "creation_date": 1456603046, "last_edit_date": 1495535283, "question_id": 35674730, "link": "https://stackoverflow.com/questions/35674730/marshalling-to-nonstring-type-in-golang-json-post-request", "title": "Marshalling to NonString type in Golang JSON POST Request", "body": "<p>I'm having a little bit of trouble handling types in Golang. I'm making a POST router.</p>\n\n<p>Consider the following <code>struct</code>:</p>\n\n<pre><code>type DataBlob struct {\n    Timestamp string\n    Metric_Id int `json:\"id,string,omitempty\"`\n    Value float32 `json:\"id,string,omitempty\"`\n    Stderr float32 `json:\"id,string,omitempty\"`\n}\n</code></pre>\n\n<p>This is my POST router using <code>json.Unmarshal()</code> from a decoded stream:</p>\n\n<pre><code>func Post(w http.ResponseWriter, req * http.Request) {\n    body, err := ioutil.ReadAll(req.Body)\n    if err != nil {\n        panic()\n    }\n\n    var t DataBlob\n    err = json.Unmarshal(body, &amp;t)\n    if err != nil {\n        panic()\n    }\n\n    fmt.Printf(\"%s\\n\", t.Timestamp)\n    fmt.Printf(\"%d\\n\", int(t.Metric_Id))\n    fmt.Printf(\"%f\\n\", t.Value)\n    fmt.Printf(\"%f\\n\", t.Stderr)\n}\n</code></pre>\n\n<p>It seems that no matter what I make my values in my POST request:</p>\n\n<pre><code>{\n    \"timestamp\": \"2011-05-16 15:36:38\",\n    \"metric_id\": \"28\",\n    \"value\": \"4.5\",\n    \"stderr\": \"8.5\"\n}\n</code></pre>\n\n<p>All the non-String values print as <code>0</code> or <code>0.000000</code>, respectively. It also doesn't matter if I try to type convert inline after-the-fact, as I did with <code>t.Metric_Id</code> in the example.</p>\n\n<p>If I edit my struct to just handle <code>string</code> types, the values print correctly.</p>\n\n<p>I also wrote a version of the POST router using <code>json.NewDecoder()</code>:</p>\n\n<pre><code>func Post(w http.ResponseWriter, req * http.Request) {\n    decoder := json.NewDecoder(req.Body)\n\n    var t DataBlob\n    err := decoder.Decode(&amp;t)\n    if err != nil {\n        panic()\n    }\n\n    fmt.Printf(\"%s\\n\", t.Timestamp)\n    fmt.Printf(\"%d\\n\", t.Metric_Id)\n    fmt.Printf(\"%f\\n\", t.Value)\n    fmt.Printf(\"%f\\n\", t.Stderr)\n}\n</code></pre>\n\n<p>This is building off of <a href=\"https://stackoverflow.com/q/21151765/1944335\">functionality described in this answer</a>, although the solution doesn't appear to work.</p>\n\n<p>I appreciate your help!</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 1162, "user_id": 1586797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e19c16130bbfb34d0f8cdb414780e50?s=128&d=identicon&r=PG", "display_name": "bronze man", "link": "https://stackoverflow.com/users/1586797/bronze-man"}, "edited": false, "score": 0, "creation_date": 1474986539, "post_id": 35675259, "comment_id": 66752053, "body": "converting []byte to a c string may not a good idea. Because &#39;\\0&#39; in the []byte will termiated the c string,and the length of the c string may not equal to length of origin []byte."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1162, "user_id": 1586797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e19c16130bbfb34d0f8cdb414780e50?s=128&d=identicon&r=PG", "display_name": "bronze man", "link": "https://stackoverflow.com/users/1586797/bronze-man"}, "edited": false, "score": 0, "creation_date": 1474986779, "post_id": 35675259, "comment_id": 66752246, "body": "@bronzeman: obviously, but the function in question takes the buffer length as an argument, and isn&#39;t expecting a null terminated string. <code>C.CString</code> adds the null byte if it were needed, but we skip it by passing the exact string length."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 16, "last_activity_date": 1456928589, "last_edit_date": 1456928589, "creation_date": 1456606081, "answer_id": 35675259, "question_id": 35673161, "link": "https://stackoverflow.com/questions/35673161/convert-go-byte-to-a-c-char/35675259#35675259", "title": "Convert Go []byte to a C *char", "body": "<p>If you want to use your first approach, you need to create the slice outside the function call arguments, and avoid the temporarily allocated slice header or the outer structure in the arguments, so the <code>cgo</code> checks don't see it as a pointer stored in Go. </p>\n\n<pre><code>b := buf.Bytes()\nrc := C.the_function(unsafe.Pointer(&amp;b[0]), C.int(buf.Len()))\n</code></pre>\n\n<p>The <code>C.CString</code> method will be safer, in that the data is copied into a C buffer, so there is no pointer to Go memory, and there's no chance the slice behind the <code>bytes.Buffer</code> will be modified or go out of scope. You will want to convert the whole string, not just the first byte. This methods does need to allocate and copy twice, however if the amount of data is small it's probably not a concern compared to the overhead of the cgo call itself.</p>\n\n<pre><code>str := buf.String()\np := unsafe.Pointer(C.CString(str))\ndefer C.free(p)\nrc = C.the_function(p, C.int(len(str)))\n</code></pre>\n\n<p>If the 2 copies of the data aren't acceptable in that solution, there is a third option where you malloc the C buffer yourself, and make a single copy into that buffer:</p>\n\n<pre><code>p := C.malloc(C.size_t(len(b)))\ndefer C.free(p)\n\n// copy the data into the buffer, by converting it to a Go array\ncBuf := (*[1 &lt;&lt; 30]byte)(p)\ncopy(cBuf[:], b)\nrc = C.the_function(p, C.int(buf.Len()))\n</code></pre>\n\n<p>But with both of those latter options, don't forget to free the malloc'ed pointer.</p>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456663743, "post_id": 35678702, "comment_id": 59042813, "body": "OP isn&#39;t using any internal bits of bytes.Buffer. I explained the reason, as does the dup of your issue. There&#39;s nothing wrong with using the slice returned by the buffer"}], "tags": [], "owner": {"reputation": 1967, "user_id": 1390507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53335e2b507fd457757eee3a39323159?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1390507/alex"}, "is_accepted": false, "score": -1, "last_activity_date": 1537195630, "last_edit_date": 1537195630, "creation_date": 1456633782, "answer_id": 35678702, "question_id": 35673161, "link": "https://stackoverflow.com/questions/35673161/convert-go-byte-to-a-c-char/35678702#35678702", "title": "Convert Go []byte to a C *char", "body": "<p>Your program crashes because rules of passing pointers into C changed in go1.6 (see <a href=\"https://tip.golang.org/doc/go1.6#cgo\" rel=\"nofollow noreferrer\">https://tip.golang.org/doc/go1.6#cgo</a> for details).</p>\n\n<p>I don't know why your program crashes, so I have created Go issue <a href=\"https://github.com/golang/go/issues/14546\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/14546</a>.</p>\n\n<p>But regardless of answer on the issue, I wouldn't use internal bits of <code>bytes.Buffer</code> (as you do) to pass into cgo directly. The <code>bytes.Buffer</code> implementation can change in the future, and you program will start breaking mysteriously. I would just copy data you need into whatever structure is appropriate and use that to pass into cgo.</p>\n"}], "owner": {"reputation": 1055, "user_id": 4205792, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0297dc684ce4aad71243b4e66d9e9f13?s=128&d=identicon&r=PG&f=1", "display_name": "dangeroushobo", "link": "https://stackoverflow.com/users/4205792/dangeroushobo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14625, "favorite_count": 7, "accepted_answer_id": 35675259, "answer_count": 2, "score": 13, "last_activity_date": 1537195630, "creation_date": 1456594969, "last_edit_date": 1456595306, "question_id": 35673161, "link": "https://stackoverflow.com/questions/35673161/convert-go-byte-to-a-c-char", "title": "Convert Go []byte to a C *char", "body": "<p>I have a byte.Buffer that I pack with data using the binary.Write() function. I then need to send this byte array to a C function. Using Go 1.6 I have not been successful at figuring this out.</p>\n\n<pre><code>buf := new(bytes.Buffer) //create my buffer\n....\nbinary.Write(buf, binary.LittleEndian, data) //write my data to buffer here\naddr := (*C.uchar)(unsafe.Pointer(&amp;buf.Bytes()[0])) //convert buffers byte array to a C array\nrc := C.the_function(addr, C.int(buf.Len())) //Fails here\n</code></pre>\n\n<p>It fails on the line calling the C function saying:</p>\n\n<pre><code>panic: runtime error: cgo argument has Go pointer to Go pointer\n</code></pre>\n\n<p>The C function:</p>\n\n<pre><code>int the_function(const void *data, int nbytes);\n</code></pre>\n\n<p>I was able to get the following to work, but it felt wrong converting the byte array to a string. Is there a better way to do this? Does this method risk side effects to the data?</p>\n\n<pre><code>addr := unsafe.Pointer(C.CString(string(buf.Bytes()[0]))\n</code></pre>\n\n<p>Again this needs to work under Go 1.6 which introduced stricter cgo pointer rules.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "dependency-injection", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 399, "user_id": 1391459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba1222faf97815d18ba6e22c11f0b6a9?s=128&d=identicon&r=PG", "display_name": "Gijs", "link": "https://stackoverflow.com/users/1391459/gijs"}, "is_accepted": false, "score": 1, "last_activity_date": 1456595527, "last_edit_date": 1495542867, "creation_date": 1456595527, "answer_id": 35673273, "question_id": 35672842, "link": "https://stackoverflow.com/questions/35672842/go-and-gin-passing-around-struct-for-database-context/35673273#35673273", "title": "Go and Gin: Passing around struct for database context?", "body": "<p>You would need type assertion to convert the interface (db := context.Keys[\"DB\"]) into something useful. See for example this post: <a href=\"https://stackoverflow.com/questions/18041334/convert-interface-to-int-in-go-lang\">convert interface{} to int in Golang</a></p>\n"}, {"comments": [{"owner": {"reputation": 3031, "user_id": 1315900, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/81ac598abb24d160c87a6f9a72e250d2?s=128&d=identicon&r=PG", "display_name": "Fermin Silva", "link": "https://stackoverflow.com/users/1315900/fermin-silva"}, "edited": false, "score": 0, "creation_date": 1490659749, "post_id": 35673437, "comment_id": 73201285, "body": "While this solves the issue, it looks like very bad design to me. Relying in someone putting interface{} structs in a generic context doesn&#39;t look like proper strongly typed design. I guess most of the fault is because gin expects a function for the handle method instead of an interface"}, {"owner": {"reputation": 1481, "user_id": 469898, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/Qf9DF.jpg?s=128&g=1", "display_name": "Dr.eel", "link": "https://stackoverflow.com/users/469898/dr-eel"}, "edited": false, "score": 1, "creation_date": 1516862226, "post_id": 35673437, "comment_id": 83865146, "body": "@SnoProblem Is it good way to pass database connection through Context? Is there any other way&amp;?"}], "tags": [], "owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "is_accepted": true, "score": 11, "last_activity_date": 1456596429, "creation_date": 1456596429, "answer_id": 35673437, "question_id": 35672842, "link": "https://stackoverflow.com/questions/35672842/go-and-gin-passing-around-struct-for-database-context/35673437#35673437", "title": "Go and Gin: Passing around struct for database context?", "body": "<p>The values within <code>context.Keys</code> are all of type <code>interface{}</code>, so <code>db</code> will not be able to call methods from type <code>*DB</code> until it's converted back to that type.</p>\n\n<p>The safe way:</p>\n\n<pre><code>db, ok := context.Keys[\"DB\"].(*DB)\nif !ok {\n        //Handle case of no *DB instance\n}\n// db is now a *DB value\n</code></pre>\n\n<p>The less safe way, which will panic if <code>context.Keys[\"DB\"]</code> is not a value of type <code>*DB</code>:</p>\n\n<pre><code>db := context.Keys[\"DB\"].(*DB)\n// db is now a *DB value\n</code></pre>\n\n<p><a href=\"https://golang.org/doc/effective_go.html#interface_conversions\" rel=\"noreferrer\">Effective Go</a> has a section on this.</p>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 12933285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e16483039c1135e6150b50996fa222f5?s=128&d=identicon&r=PG&f=1", "display_name": "\u0141ukasz Marsza\u0142", "link": "https://stackoverflow.com/users/12933285/%c5%81ukasz-marsza%c5%82"}, "is_accepted": false, "score": 10, "last_activity_date": 1582216657, "creation_date": 1582216657, "answer_id": 60324692, "question_id": 35672842, "link": "https://stackoverflow.com/questions/35672842/go-and-gin-passing-around-struct-for-database-context/60324692#60324692", "title": "Go and Gin: Passing around struct for database context?", "body": "<p>I don't think <code>context</code> should be used as DI container: <a href=\"https://golang.org/pkg/context/\" rel=\"noreferrer\">https://golang.org/pkg/context/</a></p>\n\n<blockquote>\n  <p>Package context defines the Context type, which carries deadlines, cancellation signals, and other request-scoped values across API boundaries and between processes.</p>\n</blockquote>\n\n<p>I would rather use: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package public\n\ntype PublicController struct {\n        Database *DB\n}\n\nfunc (c *PublicController) GetCurrentVotePack(context *gin.Context) {\n        votePack, err := c.Database.GetVotePack(\"c5039ecd-e774-4c19-a2b9-600c2134784d\")\n        if err != nil{\n                context.String(404, \"Votepack Not Found\")\n        }\n        context.JSON(200, votePack)\n}\n</code></pre>\n\n<p>and configure your controller in main:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n        pCtrl := PublicController { Database: models.NewDB(\"&lt;connectionstring&gt;\") }\n\n        router := gin.New()\n        router.GET(\"/public/current-vote-pack\", pCtrl.GetCurrentVotePack)\n        router.Run(\":1000\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 506, "user_id": 1005005, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea47dec0f087851744bf14ef94b3413b?s=128&d=identicon&r=PG", "display_name": "Dee", "link": "https://stackoverflow.com/users/1005005/dee"}, "is_accepted": false, "score": 0, "last_activity_date": 1613477271, "creation_date": 1613477271, "answer_id": 66224031, "question_id": 35672842, "link": "https://stackoverflow.com/questions/35672842/go-and-gin-passing-around-struct-for-database-context/66224031#66224031", "title": "Go and Gin: Passing around struct for database context?", "body": "<p>There's another way to do it when DB is set to the context during startup.</p>\n<pre><code> db := ctx.MustGet(&quot;DB&quot;).(*gorm.DB)\n</code></pre>\n<p>MustGet returns the value for the given key if it exists, otherwise it panics.</p>\n"}], "owner": {"reputation": 1041, "user_id": 324234, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/146b5b8f30e552734165a9a9aed42a09?s=128&d=identicon&r=PG", "display_name": "Tane Piper", "link": "https://stackoverflow.com/users/324234/tane-piper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12126, "favorite_count": 2, "accepted_answer_id": 35673437, "answer_count": 4, "score": 12, "last_activity_date": 1613477271, "creation_date": 1456593458, "question_id": 35672842, "link": "https://stackoverflow.com/questions/35672842/go-and-gin-passing-around-struct-for-database-context", "title": "Go and Gin: Passing around struct for database context?", "body": "<p>I've just started trying out Go, and I'm looking to re-implement an API server written in node with it.</p>\n\n<p>I've hit a hurdle with trying to use dependency injection to pass around a database context as a gin middleware.  So far I've set it up as this:</p>\n\n<p>main.go:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"runtime\"\n        \"log\"\n        \"github.com/gin-gonic/gin\"\n        \"votesforschools.com/api/public\"\n        \"votesforschools.com/api/models\"\n)\n\ntype DB struct {\n        models.DataStore\n}\n\nfunc main() {\n        ConfigRuntime()\n        ConfigServer()\n}\n\nfunc Database(connectionString string) gin.HandlerFunc {\n        dbInstance, err := models.NewDB(connectionString)\n        if err != nil {\n                log.Panic(err)\n        }\n\n        db := &amp;DB{dbInstance}\n\n        return func(c *gin.Context) {\n                c.Set(\"DB\", db)\n                c.Next()\n        }\n}\n\n\nfunc ConfigRuntime() {\n        nuCPU := runtime.NumCPU()\n        runtime.GOMAXPROCS(nuCPU)\n        fmt.Printf(\"Running with %d CPUs\\n\", nuCPU)\n}\n\nfunc ConfigServer() {\n\n        gin.SetMode(gin.ReleaseMode)\n\n        router := gin.New()\n        router.Use(Database(\"&lt;connectionstring&gt;\"))\n        router.GET(\"/public/current-vote-pack\", public.GetCurrentVotePack)\n        router.Run(\":1000\")\n}\n</code></pre>\n\n<p>models/db.go</p>\n\n<pre><code>package models\n\nimport (\n        \"database/sql\"\n        _ \"github.com/go-sql-driver/mysql\"\n)\n\ntype DataStore interface {\n        GetVotePack(id string) (*VotePack, error)\n}\n\ntype DB struct {\n        *sql.DB\n}\n\nfunc NewDB(dataSource string) (*DB, error) {\n        db, err := sql.Open(\"mysql\", dataSource)\n        if err != nil {\n                return nil, err\n        }\n        if err = db.Ping(); err != nil {\n                return nil, err\n        }\n        return &amp;DB{db}, nil\n}\n</code></pre>\n\n<p>models/votepack.go</p>\n\n<pre><code>package models\n\nimport (\n        \"time\"\n        \"database/sql\"\n)\n\ntype VotePack struct {\n        id string\n        question string\n        description string\n        startDate time.Time\n        endDate time.Time\n        thankYou string\n        curriculum []string\n}\n\nfunc (db *DB) GetVotePack(id string) (*VotePack, error) {\n\n        var votePack *VotePack\n\n        err := db.QueryRow(\n                \"SELECT id, question, description, start_date AS startDate, end_date AS endDate, thank_you AS thankYou, curriculum WHERE id = ?\", id).Scan(\n                &amp;votePack.id, &amp;votePack.question, &amp;votePack.description, &amp;votePack.startDate, &amp;votePack.endDate, &amp;votePack.thankYou, &amp;votePack.curriculum)\n\n        switch {\n        case err == sql.ErrNoRows:\n                return nil, err\n        case err != nil:\n                return nil, err\n         default:\n                return votePack, nil\n        }\n}\n</code></pre>\n\n<p>So with all of the above, I want to pass the models.DataSource around as a middleware so it can be accessed like this:</p>\n\n<p>public/public.go</p>\n\n<pre><code>package public\n\nimport (\n        \"github.com/gin-gonic/gin\"\n)\n\nfunc GetCurrentVotePack(context *gin.Context) {\n        db := context.Keys[\"DB\"]\n\n        votePack, err := db.GetVotePack(\"c5039ecd-e774-4c19-a2b9-600c2134784d\")\n        if err != nil{\n                context.String(404, \"Votepack Not Found\")\n        }\n        context.JSON(200, votePack)\n}\n</code></pre>\n\n<p>However I get <code>public\\public.go:10: db.GetVotePack undefined (type interface {} is interface with no methods)</code></p>\n\n<p>When I inspect in the debugger (using Webstorm with plugin) the db is just an empty object.  I'm trying to be good and avoid global variable use</p>\n"}, {"tags": ["mongodb", "go", "chat", "mgo"], "comments": [{"owner": {"reputation": 163028, "user_id": 477878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qounX.jpg?s=128&g=1", "display_name": "Joachim Isaksson", "link": "https://stackoverflow.com/users/477878/joachim-isaksson"}, "edited": false, "score": 0, "creation_date": 1456587340, "post_id": 35671597, "comment_id": 59022379, "body": "You&#39;re not inserting a time stamp with the messages?"}, {"owner": {"reputation": 47, "user_id": 5982102, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ktHfiWwDS-E/AAAAAAAAAAI/AAAAAAAAAOQ/G0_t8-oxgpg/photo.jpg?sz=128", "display_name": "\u0412\u043b\u0430\u0434 \u0414\u0430\u0440\u044c\u0435\u0432", "link": "https://stackoverflow.com/users/5982102/%d0%92%d0%bb%d0%b0%d0%b4-%d0%94%d0%b0%d1%80%d1%8c%d0%b5%d0%b2"}, "reply_to_user": {"reputation": 163028, "user_id": 477878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qounX.jpg?s=128&g=1", "display_name": "Joachim Isaksson", "link": "https://stackoverflow.com/users/477878/joachim-isaksson"}, "edited": false, "score": 0, "creation_date": 1456589568, "post_id": 35671597, "comment_id": 59023099, "body": "No, I am not inserting time stamp"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1456593850, "post_id": 35671597, "comment_id": 59024684, "body": "So how is &quot;order&quot; to be determined? Automagically?"}, {"owner": {"reputation": 47, "user_id": 5982102, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ktHfiWwDS-E/AAAAAAAAAAI/AAAAAAAAAOQ/G0_t8-oxgpg/photo.jpg?sz=128", "display_name": "\u0412\u043b\u0430\u0434 \u0414\u0430\u0440\u044c\u0435\u0432", "link": "https://stackoverflow.com/users/5982102/%d0%92%d0%bb%d0%b0%d0%b4-%d0%94%d0%b0%d1%80%d1%8c%d0%b5%d0%b2"}, "edited": false, "score": 0, "creation_date": 1456601990, "post_id": 35671597, "comment_id": 59027828, "body": "index in Collection, but i do not know how to detect length of Collection and indexes of docs"}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 5982102, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ktHfiWwDS-E/AAAAAAAAAAI/AAAAAAAAAOQ/G0_t8-oxgpg/photo.jpg?sz=128", "display_name": "\u0412\u043b\u0430\u0434 \u0414\u0430\u0440\u044c\u0435\u0432", "link": "https://stackoverflow.com/users/5982102/%d0%92%d0%bb%d0%b0%d0%b4-%d0%94%d0%b0%d1%80%d1%8c%d0%b5%d0%b2"}, "edited": false, "score": 0, "creation_date": 1456603576, "post_id": 35674621, "comment_id": 59028376, "body": "hello from last question. As I understand it to a certain ip, and I want to display all messages from the collection like this and in order like this:  <a href=\"http://oi67.tinypic.com/fpa2z9.jpg\" rel=\"nofollow noreferrer\">MongoLab Order</a> Maybe i do not understand something..."}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "reply_to_user": {"reputation": 47, "user_id": 5982102, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ktHfiWwDS-E/AAAAAAAAAAI/AAAAAAAAAOQ/G0_t8-oxgpg/photo.jpg?sz=128", "display_name": "\u0412\u043b\u0430\u0434 \u0414\u0430\u0440\u044c\u0435\u0432", "link": "https://stackoverflow.com/users/5982102/%d0%92%d0%bb%d0%b0%d0%b4-%d0%94%d0%b0%d1%80%d1%8c%d0%b5%d0%b2"}, "edited": false, "score": 0, "creation_date": 1456604216, "post_id": 35674621, "comment_id": 59028562, "body": "@\u0412\u043b\u0430\u0434\u0414\u0430\u0440\u044c\u0435\u0432 <code>c.Find(bson.M{}).Sort(&quot;_id&quot;).All(&amp;connects)</code>"}, {"owner": {"reputation": 47, "user_id": 5982102, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ktHfiWwDS-E/AAAAAAAAAAI/AAAAAAAAAOQ/G0_t8-oxgpg/photo.jpg?sz=128", "display_name": "\u0412\u043b\u0430\u0434 \u0414\u0430\u0440\u044c\u0435\u0432", "link": "https://stackoverflow.com/users/5982102/%d0%92%d0%bb%d0%b0%d0%b4-%d0%94%d0%b0%d1%80%d1%8c%d0%b5%d0%b2"}, "edited": false, "score": 0, "creation_date": 1456609603, "post_id": 35674621, "comment_id": 59030311, "body": "and AGAIN VERY BIG THANK TO YOU)), maybe can I ask you sometimes not in stackoverflow? Can you give me your contacts (mail or something else), of course, if you are not against Because you helped me second time in two days))"}], "tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": true, "score": 0, "last_activity_date": 1456602393, "creation_date": 1456602393, "answer_id": 35674621, "question_id": 35671597, "link": "https://stackoverflow.com/questions/35671597/getting-the-elements-from-collection-mongodb-using-golang-and-mgo/35674621#35674621", "title": "Getting the elements from Collection MongoDB using Golang and mgo", "body": "<p>First of all I agree with commenters above - you should add timestamp to your <code>Connect</code> structure. But even without it you can sort your entries by ObjectID as part of it is timestamp. Yes this is quite dirty way and may <a href=\"https://docs.mongodb.org/manual/reference/object-id/#ObjectIDs-BSONObjectIDSpecification\" rel=\"nofollow\">cause issues if you use sharding or transfer database to another server</a> but in your case (single Mongolab instance) it's possible with something like like (I don't know your structure so \"ip\" and \"message\" are just assumptions)</p>\n\n<pre><code>var connects []Connect\nc.Find(bson.M{\"ip\": \"127.0.0.1\"}).Sort(\"-_id\").Limit(50).All(&amp;connects) // 50 entries in desc order\n\nfor _, connect := range connects {\n    log.Println(connect.Message)\n}\n</code></pre>\n\n<p>But really add time to your <code>Connect</code> like that</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n    \"log\"\n    \"time\"\n)\n\ntype Connect struct {\n    Ip      string\n    Message string\n    Ts      time.Time\n}\n\nfunc main() {\n    session, err := mgo.Dial(\"mongodb://souser:123456@ds055855.mlab.com:55855/catalog\")\n\n    if err != nil {\n        panic(err)\n    }\n    defer session.Close()\n    session.SetMode(mgo.Monotonic, true)\n\n    c := session.DB(\"catalog\").C(\"History\")\n\n    for i := 0; i &lt; 100; i++ {\n        c.Insert(&amp;Connect{\"127.0.0.2\", fmt.Sprintf(\"Test message #%d\", i), time.Now()})\n        if err != nil {\n            log.Fatal(err)\n        }\n    }\n\n    var connects []Connect\n    c.Find(bson.M{\"ip\": \"127.0.0.2\"}).Sort(\"-ts\").Limit(50).All(&amp;connects)\n\n    for _, connect := range connects {\n        log.Println(connect.Message)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 47, "user_id": 5982102, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ktHfiWwDS-E/AAAAAAAAAAI/AAAAAAAAAOQ/G0_t8-oxgpg/photo.jpg?sz=128", "display_name": "\u0412\u043b\u0430\u0434 \u0414\u0430\u0440\u044c\u0435\u0432", "link": "https://stackoverflow.com/users/5982102/%d0%92%d0%bb%d0%b0%d0%b4-%d0%94%d0%b0%d1%80%d1%8c%d0%b5%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1558, "favorite_count": 0, "accepted_answer_id": 35674621, "answer_count": 1, "score": 1, "last_activity_date": 1456602393, "creation_date": 1456586996, "question_id": 35671597, "link": "https://stackoverflow.com/questions/35671597/getting-the-elements-from-collection-mongodb-using-golang-and-mgo", "title": "Getting the elements from Collection MongoDB using Golang and mgo", "body": "<p>My task is writing chat with history. So for creating history i need each of messages send to Mongodb and when I have a next connecting I need to getting all messages and, with loop, send to all clients that are connected to chat</p>\n\n<p>This is code of my ChatServer</p>\n\n<pre><code>func ChatServer(ws *websocket.Conn) {\n\n// Connecting to MongoDB, collection History\nsession, err := mgo.Dial(\"mongodb://******:*******@ds045795.mongolab.com:45795/catalog\")\nif err != nil {\n    panic(err)\n}\ndefer session.Close()\nsession.SetMode(mgo.Monotonic, true)\nc := session.DB(\"catalog\").C(\"History\")\n\n// fmt.Println(c.Find())\n// Adding clients to the map\nclientId := ws.RemoteAddr().String()\ndefer ws.Close()\nclients[ws] = true\n\n// Loop for receiving msg\nfor {\n    var msg string\n    // If can not read msg - delete client from map\n    if err := websocket.Message.Receive(ws, &amp;msg); err != nil {\n        delete(clients, ws)\n        return\n    }\n    sendAll(msg)\n    err = c.Insert(&amp;Connect{clientId, msg})\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n}\n</code></pre>\n\n<p>So <strong>my problem</strong> is getting all the elements in order from the collection.\nI have no idea how to do it, because can not find the proper function in documentations.\nMaybe you have some other offers?</p>\n"}, {"tags": ["go", "crash", "garbage-collection", "newrelic", "garbage"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456589024, "post_id": 35671366, "comment_id": 59022922, "body": "The memory use is mostly irrelevant. Run with gctrace=1 to see what the GC is doing."}, {"owner": {"reputation": 651, "user_id": 621973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88f4ee43bc2722fdd9240db6da9c0b39?s=128&d=identicon&r=PG", "display_name": "foo", "link": "https://stackoverflow.com/users/621973/foo"}, "edited": false, "score": 1, "creation_date": 1456601925, "post_id": 35671366, "comment_id": 59027802, "body": "I use the same plugin, and the gc pause value is aggregate and only increases as you&#39;ve observed.  Only useful to observe a dramatic change in rate."}, {"owner": {"reputation": 8461, "user_id": 193982, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/961667038883e6f6832949ba3c98d13e?s=128&d=identicon&r=PG", "display_name": "Mike Gleason jr Couturier", "link": "https://stackoverflow.com/users/193982/mike-gleason-jr-couturier"}, "edited": false, "score": 0, "creation_date": 1459222949, "post_id": 35671366, "comment_id": 60176711, "body": "Have you found the cause?"}], "owner": {"reputation": 474, "user_id": 3249983, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b731b133349215fb4d53a6bde054d4a3?s=128&d=identicon&r=PG&f=1", "display_name": "GuillaumeP", "link": "https://stackoverflow.com/users/3249983/guillaumep"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 301, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1456585768, "creation_date": 1456585768, "question_id": 35671366, "link": "https://stackoverflow.com/questions/35671366/number-of-gc-call-increasing-golang", "title": "Number of GC call increasing (golang)", "body": "<p>I have a webservice written in Golang which is running on an ARMv7 server.\nAfter a few hours, the process crashes.\nI decided to monitor the processus with NewRelic (with this plugin <a href=\"https://github.com/yvasiyarov/gorelic\" rel=\"nofollow\">https://github.com/yvasiyarov/gorelic</a>). I can notice that the memory/CPU use is constant, but the number of garbage collector call and the garbage collector pause never stop to increase.</p>\n\n<p>This service is connected to Redis and MySQL databases, the processus is run with golang 1.6, last stable version.</p>\n\n<p>Tell me if have an idea about the reason why the garbage collector is always called whereas the memory/CPU usage doesn't grow.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1456595591, "post_id": 35669816, "comment_id": 59025441, "body": "In addtion to that, the <a href=\"http://linux.die.net/man/1/file\" rel=\"nofollow noreferrer\">file</a> utility pretty reliably determines the arch and OS, both the GNU version and the BSD version."}, {"owner": {"reputation": 1885, "user_id": 639133, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4781a491e1923d56755de71fbec9d5d4?s=128&d=identicon&r=PG", "display_name": "mozey", "link": "https://stackoverflow.com/users/639133/mozey"}, "edited": false, "score": 0, "creation_date": 1456741106, "post_id": 35669816, "comment_id": 59070605, "body": "Thanks Markus, file is what I was looking for initially and actually solves the problem the title asks about. But using runtime is a better option for my specific use case since I can re-compile the executable to tell me what it is."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1550138829, "last_edit_date": 1550138829, "creation_date": 1456576333, "answer_id": 35669816, "question_id": 35669727, "link": "https://stackoverflow.com/questions/35669727/given-an-executable-can-i-determine-values-of-goos-and-goarch-used-to-build-it/35669816#35669816", "title": "Given an executable can I determine values of GOOS and GOARCH used to build it?", "body": "<p><strong>EDIT:</strong> The behavior of <code>runtime.GOROOT()</code> changed in Go 1.10, for details, see <a href=\"https://golang.org/doc/go1.10#runtime\" rel=\"nofollow noreferrer\">Go 1.10 release notes # Runtime</a>. Basically now <code>runtime.GOROOT()</code> checks if the <code>GOROOT</code> environment variable is set, and if so, its value is returned. If not, it returns the <code>GOROOT</code> value recorded at compile time.</p>\n\n<hr>\n\n<p>Check out the <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\"><code>runtime</code></a> package:</p>\n\n<blockquote>\n  <p>The GOARCH, GOOS, GOPATH, and GOROOT environment variables complete the set of Go environment variables. They influence the building of Go programs (see <a href=\"https://golang.org/cmd/go\" rel=\"nofollow noreferrer\">https://golang.org/cmd/go</a> and <a href=\"https://golang.org/pkg/go/build\" rel=\"nofollow noreferrer\">https://golang.org/pkg/go/build</a>). <strong>GOARCH, GOOS, and GOROOT are recorded at compile time</strong> and made available by constants or functions in this package, but they do not influence the execution of the run-time system.</p>\n</blockquote>\n\n<p>A list of possible combinations for <code>GOARCH</code> and <code>GOOS</code> can be found here: <a href=\"https://golang.org/doc/install/source#environment\" rel=\"nofollow noreferrer\">https://golang.org/doc/install/source#environment</a></p>\n\n<p>So what you are looking for are constants in the <code>runtime</code> package:</p>\n\n<pre><code>runtime.GOOS\nruntime.GOARCH\n</code></pre>\n\n<p>And they will exactly contain the values that were present when your app was built.</p>\n\n<p>For example see this simple app:</p>\n\n<pre><code>func main() {\n    fmt.Println(runtime.GOOS)\n    fmt.Println(runtime.GOARCH)\n}\n</code></pre>\n\n<p>Let's say <code>GOOS=windows</code> and <code>GOARCH=amd64</code>. Running it with <code>go run xx.go</code> will print:</p>\n\n<pre><code>windows\namd64\n</code></pre>\n\n<p>Build an exe from it (e.g. <code>go build</code>). Running the exe has the same output.</p>\n\n<p>Now change <code>GOARCH</code> to <code>386</code>. If you run it with <code>go run</code> (or build an exe and run that), it will print:</p>\n\n<pre><code>windows\n386\n</code></pre>\n\n<p>If you run the previously built exe, it will still print:</p>\n\n<pre><code>windows\namd64\n</code></pre>\n"}], "owner": {"reputation": 1885, "user_id": 639133, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4781a491e1923d56755de71fbec9d5d4?s=128&d=identicon&r=PG", "display_name": "mozey", "link": "https://stackoverflow.com/users/639133/mozey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1577, "favorite_count": 1, "accepted_answer_id": 35669816, "answer_count": 1, "score": 4, "last_activity_date": 1550138829, "creation_date": 1456575752, "question_id": 35669727, "link": "https://stackoverflow.com/questions/35669727/given-an-executable-can-i-determine-values-of-goos-and-goarch-used-to-build-it", "title": "Given an executable can I determine values of GOOS and GOARCH used to build it?", "body": "<p>The title pretty much sums it up. How can I determine what the values of GOOS and GOARCH was given just the go executable?</p>\n"}, {"tags": ["go", "concurrency", "deadlock"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 5363531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f37d51794d0fb25e82af788c3788a56?s=128&d=identicon&r=PG&f=1", "display_name": "sqroot", "link": "https://stackoverflow.com/users/5363531/sqroot"}, "edited": false, "score": 0, "creation_date": 1456575346, "post_id": 35669586, "comment_id": 59018352, "body": "I should&#39;ve mentioned that I want to avoid this particular solution because it would spawn a huge amount of goroutines in my particular use case. It&#39;s definetly a valid solution - but the reason why I&#39;m writing a scheduler for timers in the first place is that I want to avoid a goroutine being spawned for every single timer (which I may have thousands if not ten-thousands of)."}, {"owner": {"reputation": 13, "user_id": 5363531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f37d51794d0fb25e82af788c3788a56?s=128&d=identicon&r=PG&f=1", "display_name": "sqroot", "link": "https://stackoverflow.com/users/5363531/sqroot"}, "edited": false, "score": 0, "creation_date": 1456576364, "post_id": 35669586, "comment_id": 59018681, "body": "This is pretty good already. I&#39;ll leave this open for a bit longer to see if maybe anyone knows a trick I haven&#39;t considered yet to solve this entirely without launching goroutines (although I think it&#39;s unlikely) and will then mark this as accepted."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1456585693, "last_edit_date": 1456585693, "creation_date": 1456575015, "answer_id": 35669586, "question_id": 35669444, "link": "https://stackoverflow.com/questions/35669444/recursive-sends-in-monitor-goroutine/35669586#35669586", "title": "Recursive sends in monitor goroutine", "body": "<p>The problem arises from the fact that when your monitor goroutine \"takes out\" (receives) a value (a function) and executes it (this also happens on the monitor goroutine), during its execution it sends a value on the monitored channel.</p>\n\n<p>This in itself would not cause deadlock as when the function is executed (<code>a()</code>), it is already taken out of the buffered channel, so there is at least one free space in it, so sending a new value on the channel inside <code>a()</code> could proceed without blocking.</p>\n\n<p>Problem may arise if there are other goroutines which may also send values on the monitored channel, which is your case.</p>\n\n<p>One way to avoid the deadlock is that if the function being executed tries to \"put back\" (send) a function not in the same goroutine (which is the monitor goroutine), but in a new goroutine, so the monitor goroutine is not blocked:</p>\n\n<pre><code>actions &lt;- func() {\n    // Send new func value in a new goroutine:\n    // this will never block the monitor goroutine\n    go func() {\n        actions &lt;- func() {\n            // No deadlock.\n        }\n    }()\n}\n</code></pre>\n\n<p>By doing this, the monitor goroutine will not be blocked even if buffer of <code>actions</code> is full, because sending a value on it will happen in a new goroutine (which may be blocked until there is free space in the buffer).</p>\n\n<p>If you want to avoid always spawning a new goroutine when sending a value on <code>actions</code>, you may use a <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow\"><code>select</code></a> to first try to send it without spawning a new goroutine. Only when buffer of <code>actions</code> is full and cannot be sent without blocking, shall you spawn a goroutine for sending to avoid deadlock, which - depending on your actual case may happen very rarely, and in this case it's inevitable anyway to avoid deadlock:</p>\n\n<pre><code>actions &lt;- func() {\n    newfv := func() { /* do something */ }\n    // First try to send with select:\n    select {\n    case actions &lt;- newfv:\n        // Success!\n    default:\n        // Buffer is full, must do it in new goroutine:\n        go func() {\n            actions &lt;- newfv\n        }()\n    }\n}\n</code></pre>\n\n<p>If you have to do this in many places, it's recommended to create a helper function for it:</p>\n\n<pre><code>func safeSend(fv func()) {\n    // First try to send with select:\n    select {\n    case actions &lt;- fv:\n        // Success!\n    default:\n        // Buffer is full, must do it in new goroutine:\n        go func() {\n            actions &lt;- fv\n        }()\n    }\n}\n</code></pre>\n\n<p>And using it:</p>\n\n<pre><code>actions &lt;- func() {\n    safeSend(func() {\n        // something to do\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 5363531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f37d51794d0fb25e82af788c3788a56?s=128&d=identicon&r=PG&f=1", "display_name": "sqroot", "link": "https://stackoverflow.com/users/5363531/sqroot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 35669586, "answer_count": 1, "score": 1, "last_activity_date": 1456585693, "creation_date": 1456574371, "question_id": 35669444, "link": "https://stackoverflow.com/questions/35669444/recursive-sends-in-monitor-goroutine", "title": "Recursive sends in monitor goroutine", "body": "<p>In a simple scheduler for timers I'm writing, I'm making use of a monitor goroutine to sync start/stop and timer done events.</p>\n\n<p>The monitor goroutine, when stripped down to the essential, looks like this:</p>\n\n<pre><code>actions := make(chan func(), 1024)\n// monitor goroutine\ngo func() {\n    for a := range actions {\n        a()\n    }\n}()\nactions &lt;- func() {\n    actions &lt;- func() {\n        // causes deadlock when buffer size is reached\n    }\n}\n</code></pre>\n\n<p>This works great, until an action is sent that sends another action.\nIt's possible for a scheduled action to schedule another action, which causes a deadlock when the buffer size is reached.</p>\n\n<p>Is there any clean way to solve this issue without resorting to shared state (which I've tried in my particular problem, but is quite ugly)?</p>\n"}, {"tags": ["macos", "go", "code-signing"], "answers": [{"tags": [], "owner": {"reputation": 3875, "user_id": 652101, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/10eb57143bcdb0cea1bc504810a3b633?s=128&d=identicon&r=PG", "display_name": "kliron", "link": "https://stackoverflow.com/users/652101/kliron"}, "is_accepted": false, "score": 3, "last_activity_date": 1456582795, "last_edit_date": 1456582795, "creation_date": 1456571331, "answer_id": 35668959, "question_id": 35668907, "link": "https://stackoverflow.com/questions/35668907/osx-code-sign-executable-to-avoid-firewall-warning-dialog/35668959#35668959", "title": "OSX: Code-sign executable to avoid firewall warning dialog", "body": "<p>Silly me. Took me 5 minutes to write the question and 2 minutes to find the answer and write the script that solves it. I'll post it here in case anybody stumbles on the same problem.</p>\n\n<pre><code>binary=$GOPATH/pkg/kliron/hiss/hiss.a   \ngo build -o $binary hiss/main.go\ncodesign -f -s klironCode $binary --deep   \n$binary \"$@\"\n</code></pre>\n\n<p>Just use <code>go build</code>. </p>\n"}, {"comments": [{"owner": {"reputation": 3875, "user_id": 652101, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/10eb57143bcdb0cea1bc504810a3b633?s=128&d=identicon&r=PG", "display_name": "kliron", "link": "https://stackoverflow.com/users/652101/kliron"}, "edited": false, "score": 0, "creation_date": 1456579363, "post_id": 35669323, "comment_id": 59019614, "body": "Nice, thanks for sharing. However, there are times you really need to listen to the external interface, say, to test OAuth2 authentication schemes or interact with other online services. Sure, you could point your hostname to localhost in /etc/host and it would be all that&#39;s needed for some (eg oauth) but not all cases."}, {"owner": {"reputation": 3875, "user_id": 652101, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/10eb57143bcdb0cea1bc504810a3b633?s=128&d=identicon&r=PG", "display_name": "kliron", "link": "https://stackoverflow.com/users/652101/kliron"}, "edited": false, "score": 0, "creation_date": 1456687800, "post_id": 35669323, "comment_id": 59051933, "body": "/etc/host -&gt; /etc/hosts"}], "tags": [], "owner": {"reputation": 91, "user_id": 2663930, "user_type": "registered", "profile_image": "https://graph.facebook.com/885915462/picture?type=large", "display_name": "Lee Provoost", "link": "https://stackoverflow.com/users/2663930/lee-provoost"}, "is_accepted": false, "score": 9, "last_activity_date": 1456577616, "last_edit_date": 1456577616, "creation_date": 1456573720, "answer_id": 35669323, "question_id": 35668907, "link": "https://stackoverflow.com/questions/35668907/osx-code-sign-executable-to-avoid-firewall-warning-dialog/35669323#35669323", "title": "OSX: Code-sign executable to avoid firewall warning dialog", "body": "<p>Even easier: start the server explicitly on localhost, like:</p>\n\n<pre><code>http.ListenAndServe(\"localhost:8080\", nil)\n</code></pre>\n\n<p>I wrote a little piece on this recently: </p>\n\n<p><a href=\"https://medium.com/@leeprovoost/suppressing-accept-incoming-network-connections-warnings-on-osx-7665b33927ca#.ucvpm84xm\">suppressing-accept-incoming-network-connections-warnings-on-osx</a></p>\n"}], "owner": {"reputation": 3875, "user_id": 652101, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/10eb57143bcdb0cea1bc504810a3b633?s=128&d=identicon&r=PG", "display_name": "kliron", "link": "https://stackoverflow.com/users/652101/kliron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1315, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1478638592, "creation_date": 1456571086, "last_edit_date": 1478638592, "question_id": 35668907, "link": "https://stackoverflow.com/questions/35668907/osx-code-sign-executable-to-avoid-firewall-warning-dialog", "title": "OSX: Code-sign executable to avoid firewall warning dialog", "body": "<p>OSX El Capitan and Go 1.6</p>\n\n<p>What I want is simpler than it sounds from the title.</p>\n\n<p>The OSX firewall disallows any unknown application from accepting connections. When any such program starts, the user is presented with a dialog whether or not the said executable should be permitted to receive connections. The user's choice is then remembered. </p>\n\n<p>The above works fine when for example one develops with node where the actual executable is a single binary and the user just needs to allow/deny it once.</p>\n\n<p>When developing in go (and any other compiled language) the created executable is different every time. Which means I get the dialog every single time I start my server. </p>\n\n<p>One way to avoid this dialog is to sign the executable with a self-signed certificate one generates in OSX itself. Once we have the certificate we simply sign the executable and allow/deny it once. Code signatures are always remembered even if the executable binary changes.</p>\n\n<p><strong>So, my question is</strong>:</p>\n\n<p>Is there a way to make <code>go</code> run the signing command before running the compiled binary?</p>\n"}, {"tags": ["video", "go", "streaming", "skip", "seek"], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": false, "score": 5, "last_activity_date": 1456599455, "last_edit_date": 1456599455, "creation_date": 1456567125, "answer_id": 35668338, "question_id": 35667501, "link": "https://stackoverflow.com/questions/35667501/golang-seeking-through-a-video-serving-as-bytes/35668338#35668338", "title": "GoLang - Seeking through a video (serving as bytes)", "body": "<p>The simplest way to stream MP4 video on Go with seeking support is</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n)\n\nfunc main() {\n    fs := http.FileServer(http.Dir(\".\"))\n    http.Handle(\"/\", http.StripPrefix(\"/\", fs))\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>And video will be available at <a href=\"http://localhost:8080/video.mp4\" rel=\"nofollow\">http://localhost:8080/video.mp4</a></p>\n\n<p>More complex is</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"time\"\n)\n\nfunc ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    video, err := os.Open(\"./video.mp4\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer video.Close()\n\n    http.ServeContent(w, r, \"video.mp4\", time.Now(), video)\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", ServeHTTP)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>If you need something more flexible you should implement your own <a href=\"https://en.wikipedia.org/wiki/Progressive_download\" rel=\"nofollow\">progressive streaming</a> server. </p>\n\n<p>In your code you forgot to add and process <code>Range</code>/<code>Accept-Range</code> headers that's why nor FF, nor Chrome doesn't show you seek bar but anyway I don't think that keeping whole MP4 file in memory is good idea.</p>\n"}], "owner": {"reputation": 33, "user_id": 4999723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a768763723c96f99616b391f89589d18?s=128&d=identicon&r=PG&f=1", "display_name": "Gerold Newcombe", "link": "https://stackoverflow.com/users/4999723/gerold-newcombe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4748, "favorite_count": 3, "answer_count": 1, "score": 3, "last_activity_date": 1456599455, "creation_date": 1456561777, "last_edit_date": 1456570243, "question_id": 35667501, "link": "https://stackoverflow.com/questions/35667501/golang-seeking-through-a-video-serving-as-bytes", "title": "GoLang - Seeking through a video (serving as bytes)", "body": "<p>I'm writing a server in golang and I got it to serve a basic .mp4 file. It serves it by bytes. The problem is that I can not seek/skip through the video. I've tried searching throughout stackover flow and google to find an answer but I came up short..</p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"io/ioutil\"\n    \"fmt\"\n    \"os\"\n    \"log\"\n    \"bytes\"\n)\n\nfunc ServeHTTP(w http.ResponseWriter, r *http.Request) {\n           // grab the generated receipt.pdf file and stream it to browser\n           streamPDFbytes, err := ioutil.ReadFile(\"./video.mp4\")\n           log.Println(r)\n           if err != nil {\n                   fmt.Println(err)\n                   os.Exit(1)\n           }\n\n           b := bytes.NewBuffer(streamPDFbytes)\n\n           // stream straight to client(browser)\n           w.Header().Set(\"Content-type\", \"video/mp4\")\n\n           if _, err := b.WriteTo(w); err != nil { // &lt;----- here!\n                   fmt.Fprintf(w, \"%s\", err)\n           }\n\n           w.Write([]byte(\"Video Completed\"))\n}\n\nfunc main() {\n    http.Handle(\"/\", new(MyHandler))\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>Does anyone have the answer to how seeking works in golang? </p>\n\n<p>Thanks,\nHave a great day!</p>\n"}, {"tags": ["go", "revel"], "comments": [{"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1456556226, "post_id": 35666656, "comment_id": 59013153, "body": "Are you behind a proxy? Have you tried getting the value of the <code>X-Forwarded-For</code> header?"}, {"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "reply_to_user": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1456559896, "post_id": 35666656, "comment_id": 59014001, "body": "No I don&#39;t use proxy. I test it with my local lan, accessed by other computer. Ah the X-Forwarded-For is the IP of the requester. But how come?"}], "owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 313, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1456555298, "creation_date": 1456555298, "question_id": 35666656, "link": "https://stackoverflow.com/questions/35666656/revel-golang-request-remoteaddr-always-127-0-0-1", "title": "Revel golang Request RemoteAddr always 127.0.0.1", "body": "<p>I just learning about Golang and Revel. And I have problem with the Request.RemoteAddr on the Revel which it always return 127.0.0.1:[port] even the requester is not localhost.\nWhich on godoc the RemoteAddr should the the IP of the requester.\nIs it expected behaviour? If yes, how I can get the IP of the requester?\nAnother question also maybe you can help me, is it possible to get the os and mac address of the requester?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7691, "user_id": 1029890, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ace3e35f2e5a0075eebccce843a82fb3?s=128&d=identicon&r=PG", "display_name": "SpiderPig", "link": "https://stackoverflow.com/users/1029890/spiderpig"}, "edited": false, "score": 0, "creation_date": 1456548104, "post_id": 35665727, "comment_id": 59011502, "body": "What exactly is not working here? btw. you define two arguments a and b but never use them."}, {"owner": {"reputation": 2319, "user_id": 3514144, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/hRi21.jpg?s=128&g=1", "display_name": "Ajay Pandya", "link": "https://stackoverflow.com/users/3514144/ajay-pandya"}, "edited": false, "score": 0, "creation_date": 1456548962, "post_id": 35665727, "comment_id": 59011675, "body": "What the exact problem you facing?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 2319, "user_id": 3514144, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/hRi21.jpg?s=128&g=1", "display_name": "Ajay Pandya", "link": "https://stackoverflow.com/users/3514144/ajay-pandya"}, "edited": false, "score": 0, "creation_date": 1456600154, "post_id": 35665727, "comment_id": 59027201, "body": "@AjayPandya I have the code in my question."}], "answers": [{"tags": [], "owner": {"reputation": 7691, "user_id": 1029890, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ace3e35f2e5a0075eebccce843a82fb3?s=128&d=identicon&r=PG", "display_name": "SpiderPig", "link": "https://stackoverflow.com/users/1029890/spiderpig"}, "is_accepted": true, "score": 1, "last_activity_date": 1456548736, "creation_date": 1456548736, "answer_id": 35665844, "question_id": 35665727, "link": "https://stackoverflow.com/questions/35665727/trying-to-understand-closures/35665844#35665844", "title": "Trying to understand closures", "body": "<p>You need to define the inner func as a local variable. Try this</p>\n\n<pre><code>func myfunc(a int) bool {\n  otherfunc := func(b int) bool {\n    return false\n  }\n  log.Println(otherfunc(2))\n  return true\n}\n</code></pre>\n\n<p>Btw. <code>otherfunc := func(b int) bool {</code> is shorthand for <code>var otherfunc func(int) bool = func(b int) bool {</code></p>\n\n<p>Look at these examples</p>\n\n<p><a href=\"https://gobyexample.com/closures\" rel=\"nofollow\">https://gobyexample.com/closures</a></p>\n\n<p><a href=\"https://gobyexample.com/variables\" rel=\"nofollow\">https://gobyexample.com/variables</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 35665844, "answer_count": 1, "score": 0, "last_activity_date": 1456548736, "creation_date": 1456547862, "question_id": 35665727, "link": "https://stackoverflow.com/questions/35665727/trying-to-understand-closures", "title": "Trying to understand closures", "body": "<p>Sorry, still a newb in Go. I am trying to write a closure:</p>\n\n<p><a href=\"https://play.golang.org/p/qz-8WFh0mv\" rel=\"nofollow\">https://play.golang.org/p/qz-8WFh0mv</a></p>\n\n<pre><code>package main\n\nimport \"log\"\n\n\nfunc myfunc(a int) bool{\n  func otherfunc(b int) bool{\n    return false\n  }\n  log.Println(otherfunc(2))\n  return true\n}\n\nfunc main() {\n        myfunc(1)\n    log.Println(\"here\")\n}\n</code></pre>\n\n<p>A similar function in Python would work. Why doesn't this work in Go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2682, "user_id": 4072843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tKkUM.jpg?s=128&g=1", "display_name": "Castaglia", "link": "https://stackoverflow.com/users/4072843/castaglia"}, "edited": false, "score": 1, "creation_date": 1456544390, "post_id": 35665362, "comment_id": 59010875, "body": "Since links can go stale/change over time, it&#39;s best to include your code directly into your post."}, {"owner": {"reputation": 31, "user_id": 5988922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b370a39d88f7713463aaef90b9471f1e?s=128&d=identicon&r=PG", "display_name": "noname", "link": "https://stackoverflow.com/users/5988922/noname"}, "reply_to_user": {"reputation": 2682, "user_id": 4072843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tKkUM.jpg?s=128&g=1", "display_name": "Castaglia", "link": "https://stackoverflow.com/users/4072843/castaglia"}, "edited": false, "score": 0, "creation_date": 1456546259, "post_id": 35665362, "comment_id": 59011196, "body": "thanks for your suggestion"}], "answers": [{"tags": [], "owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "is_accepted": false, "score": 3, "last_activity_date": 1456546921, "last_edit_date": 1456546921, "creation_date": 1456546364, "answer_id": 35665554, "question_id": 35665362, "link": "https://stackoverflow.com/questions/35665362/go-golang-compile-error-type-has-no-method/35665554#35665554", "title": "go - golang compile error: type has no method", "body": "<p><code>Cache</code> is a type. To call a method on a <code>Cache</code> object you have to do this.</p>\n\n<pre><code>func (c *Cache) Set(k string, v string) {\n    for mi, _ := range c.Segment[0].Key {\n         fmt.Println(c.Segment[0].Val[mi])  \n    }\n}\n</code></pre>\n\n<p>Note its <code>c.Segment[0].Key</code> and <code>c.Segment[0].Val[mi]</code> instead of <code>Cache.Segment[0].Key</code> and <code>Cache.Segment[0].Val[mi]</code></p>\n\n<p><kbd><a href=\"http://play.golang.org/p/p9Euelj1q6\" rel=\"nofollow\">Go Playground</a></kbd></p>\n\n<p><strong>unrelated suggestion:</strong> Run <a href=\"https://golang.org/cmd/gofmt/\" rel=\"nofollow\">gofmt</a> on your code. It points to violations of regularly followed style guidelines for go code. I notice a few on your code.</p>\n"}, {"tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": false, "score": -1, "last_activity_date": 1456546562, "creation_date": 1456546562, "answer_id": 35665577, "question_id": 35665362, "link": "https://stackoverflow.com/questions/35665362/go-golang-compile-error-type-has-no-method/35665577#35665577", "title": "go - golang compile error: type has no method", "body": "<p>You need to give a variable to *Cache to use it, something like:</p>\n\n<pre><code>package main\nimport \"fmt\"\n\ntype Slot struct {  \n    Key []string\n    Val []string\n}\n\ntype Cache struct{\n    Segment [3615]Slot\n}\n\nfunc NewCache(s int) *Cache{\n    num:=3615\n    Cacheobj:=new(Cache)\n\n    for i := 0; i &lt; num; i++ {\n        Cacheobj.Segment[i].Key = make([]string, s)\n        Cacheobj.Segment[i].Val = make([]string, s)\n    }\n\n    return Cacheobj\n}\n\nfunc (c *Cache)Set(k string, v string) {\n        for mi, _:= range c.Segment[0].Key { // Had to change mk to _ because go will not compile when variables are declared and unused\n         fmt.Println(c.Segment[0].Val[mi])  \n    }\n}\nfunc main() {\n    Cache1:=NewCache(100)\n    Cache1.Set(\"a01\", \"111111\")\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/1vLwVZrX20\" rel=\"nofollow\">http://play.golang.org/p/1vLwVZrX20</a></p>\n"}], "owner": {"reputation": 31, "user_id": 5988922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b370a39d88f7713463aaef90b9471f1e?s=128&d=identicon&r=PG", "display_name": "noname", "link": "https://stackoverflow.com/users/5988922/noname"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6202, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1456546921, "creation_date": 1456544215, "last_edit_date": 1592644375, "question_id": 35665362, "link": "https://stackoverflow.com/questions/35665362/go-golang-compile-error-type-has-no-method", "title": "go - golang compile error: type has no method", "body": "<p>how to solve it?\n<a href=\"https://play.golang.org/p/aOrqmDM91J\" rel=\"nofollow noreferrer\">https://play.golang.org/p/aOrqmDM91J</a></p>\n<blockquote>\n<p>:28: Cache.Segment undefined (type Cache has no method Segment)</p>\n<p>:29: Cache.Segment undefined (type Cache has no method Segment)</p>\n</blockquote>\n<pre><code>package main\nimport &quot;fmt&quot;\n\ntype Slot struct {  \n    Key []string\n    Val []string\n}\n\ntype Cache struct{\n    Segment [3615]Slot\n}\n\nfunc NewCache(s int) *Cache{\n    num:=3615\n    Cacheobj:=new(Cache)\n    \n    for i := 0; i &lt; num; i++ {\n        Cacheobj.Segment[i].Key = make([]string, s)\n        Cacheobj.Segment[i].Val = make([]string, s)\n    }\n            \n    return Cacheobj\n}\n\nfunc (*Cache)Set(k string, v string) {\n        for mi, mk := range Cache.Segment[0].Key {\n         fmt.Println(Cache.Segment[0].Val[mi])  \n    }\n}\nfunc main() {\n    Cache1:=NewCache(100)\n    Cache1.Set(&quot;a01&quot;, &quot;111111&quot;)\n}\n</code></pre>\n"}, {"tags": ["generics", "go", "datatables", "gorp"], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 5987281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90f1fc62eef6a6992a58670627bdae1b?s=128&d=identicon&r=PG&f=1", "display_name": "Lucas Jones", "link": "https://stackoverflow.com/users/5987281/lucas-jones"}, "is_accepted": true, "score": 2, "last_activity_date": 1456540870, "creation_date": 1456540870, "answer_id": 35665046, "question_id": 35664997, "link": "https://stackoverflow.com/questions/35664997/golang-generic-method-to-fetch-data-from-database/35665046#35665046", "title": "Golang generic method to fetch data from database", "body": "<p>In this case result is already a pointer (users is passed as &amp;users), so you don't need to take the address of it again.</p>\n\n<p>Replace the line:</p>\n\n<pre><code>_, err = dbMap.Select(&amp;result, query)\n</code></pre>\n\n<p>with</p>\n\n<pre><code>_, err = dbMap.Select(result, query)\n</code></pre>\n"}], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1744, "favorite_count": 1, "accepted_answer_id": 35665046, "answer_count": 1, "score": 2, "last_activity_date": 1456542030, "creation_date": 1456540321, "last_edit_date": 1456542030, "question_id": 35664997, "link": "https://stackoverflow.com/questions/35664997/golang-generic-method-to-fetch-data-from-database", "title": "Golang generic method to fetch data from database", "body": "<p>I'm trying to implement the <a href=\"https://datatables.net/manual/server-side\" rel=\"nofollow\">jquery datatables server side processing</a> in Golang. Part of that needs a generic method to select data from DB. I've posted a simplified version of what I've done below.  </p>\n\n<pre><code>package main\nimport (\n    \"gopkg.in/gorp.v1\"\n    \"database/sql\"\n  _ \"github.com/go-sql-driver/mysql\"\n)\n\ntype User struct {\n    TenantId     int     `db:\"tenantid\"json:\"tenantid\"`\n    Username     string  `db:\"username\"json:\"username\"`\n    Password     string  `json:\"password\"`\n}\n\n\nfunc GenericSelect(database string,  table string, columns []string, result interface{})interface{} {\n    dbMap := getDBConnection(database);\n    defer dbMap.Db.Close()\n    var err error\n    query := \"SELECT \" \n\n    for index,element := range columns {\n      query += element\n      if(index+1 != len(columns)){\n        query += \",\"\n      }\n    }\n    query +=  \" FROM \" + table + \" LIMIT 1,100\"\n    _, err = dbMap.Select(&amp;result, query)\n    if err != nil {\n        panic(err.Error())  // Just for example purpose.\n    }\n  return result\n}\n\n\nfunc getDBConnection(dbname string) *gorp.DbMap {\n    var connectionUrl string\n    connectionUrl = \"root:root@tcp(localhost:3306)/\" + dbname\n\n    db, err := sql.Open(\"mysql\", connectionUrl)\n    if err != nil {\n        panic(err.Error())  // Just for example purpose.\n    }\n    dbmap := &amp;gorp.DbMap{Db: db, Dialect:gorp.MySQLDialect{\"InnoDB\", \"UTF8\"}}\n    return dbmap\n}\n\n\nfunc main(){\n        var users []User\n        columns := []string{\"tenantid\", \"username\", \"password\"}\n        result := GenericSelect(\"portal\",\"accounting\",columns, &amp;users)\n        //make result in to a json instead of print\n        print(result)\n}\n</code></pre>\n\n<p>Once I run this, it throws the following error,</p>\n\n<pre><code>panic: gorp: Cannot SELECT into this type: *interface {}\n\ngoroutine 1 [running]:\nmain.GenericSelect(0x6b1c30, 0x6, 0x6bd490, 0xa, 0xc208073f60, 0x3, 0x3, 0x5e8e60, 0xc20801e260, 0x0, ...)\n    /home/anuruddha/Desktop/go-lang/main.go:30 +0x37f\n</code></pre>\n\n<p>According to the error, Select() is not accepting interfaces. Is it possible to achieve this level of generality in golang? Appreciate if you can direct me to get this working?</p>\n"}, {"tags": ["google-app-engine", "go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 373, "user_id": 1210191, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/3Y4ww.jpg?s=128&g=1", "display_name": "avillagomez", "link": "https://stackoverflow.com/users/1210191/avillagomez"}, "is_accepted": false, "score": 0, "last_activity_date": 1456539995, "creation_date": 1456539995, "answer_id": 35664957, "question_id": 35664780, "link": "https://stackoverflow.com/questions/35664780/struct-with-interface-type-fields/35664957#35664957", "title": "Struct with interface type fields", "body": "<p>Found my problem. The problem was not related to this issue, the problem was </p>\n\n<pre><code>Location     : event.Party.Location.(string),\n</code></pre>\n\n<p>At some point in my implementation I was doing this when Location was a nil interface{}, hence the blowup.</p>\n\n<p>As a response to this, it is possible to do what I mentioned.</p>\n"}], "owner": {"reputation": 373, "user_id": 1210191, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/3Y4ww.jpg?s=128&g=1", "display_name": "avillagomez", "link": "https://stackoverflow.com/users/1210191/avillagomez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1456539995, "creation_date": 1456538071, "question_id": 35664780, "link": "https://stackoverflow.com/questions/35664780/struct-with-interface-type-fields", "title": "Struct with interface type fields", "body": "<p>Why is it I can't have this in golang?</p>\n\n<pre><code>type EventDefinition struct {\n     Name string\n     EventProperties interface{}\n}\n</code></pre>\n\n<p>Where EventProperties can be one of may types of structs, each struct with different fields. The idea is to have an EventDefinition with EventProperties</p>\n\n<pre><code>type Party struct {\n     Location string\n     Hour string\n}\n</code></pre>\n\n<p>or </p>\n\n<pre><code>type Wedding struct {\n     Bride string\n     Groom string\n     Hour string\n}\n</code></pre>\n\n<p>or </p>\n\n<pre><code>type Graduation struct {\n     Location string\n     Graduate string\n}\n</code></pre>\n"}, {"tags": ["parsing", "dictionary", "go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 2, "creation_date": 1456531517, "post_id": 35663892, "comment_id": 59007982, "body": "I think what you really want is <a href=\"https://golang.org/pkg/net/url/#ParseQuery\" rel=\"nofollow noreferrer\"><code>url.ParseQuery</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": true, "score": 11, "last_activity_date": 1456537234, "last_edit_date": 1456537234, "creation_date": 1456532982, "answer_id": 35664174, "question_id": 35663892, "link": "https://stackoverflow.com/questions/35663892/parse-string-into-map-golang/35664174#35664174", "title": "Parse string into map Golang", "body": "<p>Maybe what you really want is to parse an HTTP query string, and <a href=\"https://golang.org/pkg/net/url/#ParseQuery\" rel=\"noreferrer\"><code>url.ParseQuery</code></a> does that. (What it returns is, more precisely, a <code>url.Values</code> storing a <code>[]string</code> for every key, since URLs sometimes have more than one value per key.) It does things like parse HTML escapes (<code>%0A</code>, etc.) that just splitting doesn't. You can find its implementation if you search in <a href=\"https://golang.org/src/net/url/url.go\" rel=\"noreferrer\">the source of <code>url.go</code></a>.</p>\n\n<p>However, if you <em>do</em> really want to just split on <code>&amp;</code> and <code>=</code> like that Java code did, there are Go analogues for all of the concepts and tools there: </p>\n\n<ul>\n<li><a href=\"https://golang.org/ref/spec#Map_types\" rel=\"noreferrer\"><code>map[string]string</code></a> is Go's analog of <code>Map&lt;String, String&gt;</code></li>\n<li><a href=\"https://golang.org/pkg/strings/#Split\" rel=\"noreferrer\"><code>strings.Split</code></a> can split on <code>&amp;</code> for you. <a href=\"https://golang.org/pkg/strings/#SplitN\" rel=\"noreferrer\"><code>SplitN</code></a> limits the number of pieces split into like the two-argument version of <code>split()</code> in Java does. Note that there might only be one piece so you should check <code>len(pieces)</code> before trying to access <code>pieces[1]</code> say.</li>\n<li><a href=\"https://golang.org/ref/spec#For_statements\" rel=\"noreferrer\"><code>for _, piece := range pieces</code></a> will iterate the pieces you split.</li>\n<li>The Java code seems to rely on regexes to trim spaces. Go's <code>Split</code> doesn't use them, but <a href=\"https://golang.org/pkg/strings/#TrimSpace\" rel=\"noreferrer\"><code>strings.TrimSpace</code></a> does something like what you want (specifically, strips all sorts of Unicode whitespace from both sides).</li>\n</ul>\n\n<p>I'm leaving the actual implementation to you, but perhaps these pointers can get you started.</p>\n"}, {"comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1456535774, "post_id": 35664442, "comment_id": 59009249, "body": "A few differences from the original Java: 1) this will crash with index out of range when an item is missing a <code>=</code>, 2) this doesn&#39;t strip spaces around the delimiters, 3) anything after an <code>=</code> in the value part is dropped. Fine to do something similar rather than identical, just all bears noting (especially the crash)."}], "tags": [], "owner": {"reputation": 1144, "user_id": 1525358, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HaiCR.jpg?s=128&g=1", "display_name": "Peter M. Elias", "link": "https://stackoverflow.com/users/1525358/peter-m-elias"}, "is_accepted": false, "score": 9, "last_activity_date": 1456535046, "creation_date": 1456535046, "answer_id": 35664442, "question_id": 35663892, "link": "https://stackoverflow.com/questions/35663892/parse-string-into-map-golang/35664442#35664442", "title": "Parse string into map Golang", "body": "<pre><code>import ( \"strings\" )\n\nvar m map[string]string\nvar ss []string\n\ns := \"A=B&amp;C=D&amp;E=F\"\nss = strings.Split(s, \"&amp;\")\nm = make(map[string]string)\nfor _, pair := range ss {\n    z := strings.Split(pair, \"=\")\n    m[z[0]] = z[1]\n}\n</code></pre>\n\n<p>This will do what you want.</p>\n"}, {"tags": [], "owner": {"reputation": 217, "user_id": 5713047, "user_type": "registered", "profile_image": "https://graph.facebook.com/511702685666241/picture?type=large", "display_name": "Abhishek Srivastava", "link": "https://stackoverflow.com/users/5713047/abhishek-srivastava"}, "is_accepted": false, "score": 1, "last_activity_date": 1560355053, "creation_date": 1560355053, "answer_id": 56566210, "question_id": 35663892, "link": "https://stackoverflow.com/questions/35663892/parse-string-into-map-golang/56566210#56566210", "title": "Parse string into map Golang", "body": "<p>There is a very simple way provided by golang <code>net/url</code> package itself.</p>\n\n<p>Change your string to make it a url with query params <code>text := \"method://abc.xyz/A=B&amp;C=D&amp;E=F\";</code></p>\n\n<p>Now just pass this string to <code>Parse</code> function provided by <code>net/url</code>. </p>\n\n<pre><code>import (\n    netURL \"net/url\"\n)\n</code></pre>\n\n<pre><code>u, err := netURL.Parse(textURL)\n        if err != nil {\n            log.Fatal(err)\n        }\n</code></pre>\n\n<p>Now <code>u.Query()</code> will return you a map containing your query params. This will also work for complex types.</p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1618976525, "creation_date": 1618976525, "answer_id": 67189017, "question_id": 35663892, "link": "https://stackoverflow.com/questions/35663892/parse-string-into-map-golang/67189017#67189017", "title": "Parse string into map Golang", "body": "<p>Here is a demonstration of a couple of methods:</p>\n<pre><code>package main\n\nimport (\n   &quot;fmt&quot;\n   &quot;net/url&quot;\n)\n\nfunc main() {\n   {\n      q, e := url.ParseQuery(&quot;west=left&amp;east=right&quot;)\n      if e != nil {\n         panic(e)\n      }\n      fmt.Println(q) // map[east:[right] west:[left]]\n   }\n   {\n      u := url.URL{RawQuery: &quot;west=left&amp;east=right&quot;}\n      q := u.Query()\n      fmt.Println(q) // map[east:[right] west:[left]]\n   }\n}\n</code></pre>\n<ul>\n<li><a href=\"https://golang.org/pkg/net/url#ParseQuery\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/url#ParseQuery</a></li>\n<li><a href=\"https://golang.org/pkg/net/url#URL.Query\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/url#URL.Query</a></li>\n</ul>\n"}], "owner": {"reputation": 93, "user_id": 5885918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85aa543562ef572d8f3f18cefb084494?s=128&d=identicon&r=PG&f=1", "display_name": "Bran S", "link": "https://stackoverflow.com/users/5885918/bran-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15750, "favorite_count": 3, "accepted_answer_id": 35664174, "answer_count": 4, "score": 8, "last_activity_date": 1618976525, "creation_date": 1456531198, "question_id": 35663892, "link": "https://stackoverflow.com/questions/35663892/parse-string-into-map-golang", "title": "Parse string into map Golang", "body": "<p>I have a string like A=B&amp;C=D&amp;E=F, how to parse it into map in golang?</p>\n\n<p>Here is example on Java, but I don't understand this <code>split</code> part</p>\n\n<pre><code>String text = \"A=B&amp;C=D&amp;E=F\";\nMap&lt;String, String&gt; map = new LinkedHashMap&lt;String, String&gt;();\nfor(String keyValue : text.split(\" *&amp; *\")) {\n   String[] pairs = keyValue.split(\" *= *\", 2);\n   map.put(pairs[0], pairs.length == 1 ? \"\" : pairs[1]);\n}\n</code></pre>\n"}, {"tags": ["go", "naming-conventions"], "answers": [{"comments": [{"owner": {"reputation": 262, "user_id": 5528070, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh4.googleusercontent.com/-IYABogD9sxI/AAAAAAAAAAI/AAAAAAAACNE/ZIt8C6XSB3U/photo.jpg?sz=128", "display_name": "Christopher", "link": "https://stackoverflow.com/users/5528070/christopher"}, "edited": false, "score": 0, "creation_date": 1456530907, "post_id": 35662979, "comment_id": 59007815, "body": "Thanks, that is exactly what I was looking for!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1456526393, "last_edit_date": 1456526393, "creation_date": 1456526044, "answer_id": 35662979, "question_id": 35662673, "link": "https://stackoverflow.com/questions/35662673/struct-naming-convention/35662979#35662979", "title": "Struct Naming Convention", "body": "<p>The convention is to use Request and Response. Here's what <a href=\"https://golang.org/doc/effective_go.html#package-names\" rel=\"noreferrer\">Effective Go</a> has to say:</p>\n\n<blockquote>\n  <p>The importer of a package will use the name to refer to its contents, so exported names in the package can use that fact to avoid stutter. (Don't use the import . notation, which can simplify tests that must run outside the package they are testing, but should otherwise be avoided.) For instance, the buffered reader type in the bufio package is called Reader, not BufReader, because users see it as bufio.Reader, which is a clear, concise name. Moreover, because imported entities are always addressed with their package name, bufio.Reader does not conflict with io.Reader.</p>\n</blockquote>\n\n<p>The <a href=\"https://github.com/golang/lint\" rel=\"noreferrer\">golint</a> tool <a href=\"https://github.com/golang/lint/blob/32a87160691b3c96046c0c678fe57c5bef761456/lint.go#L867\" rel=\"noreferrer\">will complain</a> about the names FinanceRequest and FinanceResponse.</p>\n"}], "owner": {"reputation": 262, "user_id": 5528070, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh4.googleusercontent.com/-IYABogD9sxI/AAAAAAAAAAI/AAAAAAAACNE/ZIt8C6XSB3U/photo.jpg?sz=128", "display_name": "Christopher", "link": "https://stackoverflow.com/users/5528070/christopher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5960, "favorite_count": 2, "accepted_answer_id": 35662979, "answer_count": 1, "score": 4, "last_activity_date": 1456526393, "creation_date": 1456524448, "question_id": 35662673, "link": "https://stackoverflow.com/questions/35662673/struct-naming-convention", "title": "Struct Naming Convention", "body": "<p>I have a few structs in a package that make a simple finance API call, one implements the request to the API, one stores the response. </p>\n\n<p>I'm wondering if it's appropriate to just name the structs \"Request\" and \"Response\" respectively, or should I prefix them with the subject/package- like \"FinanceRequest\" and \"FinanceResponse\"? Or would that make external calls redundant by using finance.FinanceRequest (finance word used twice)? </p>\n\n<p>Looking for thoughts on the matter (golang convention/preference)...</p>\n\n<p><strong>Samples:</strong></p>\n\n<pre><code>package finance\n\ntype Request struct {\n//...\n}\n\ntype Response struct {\n//...\n} \n\nfunc DoSomething(r *Request) (*Response, error) {\n//...\n}\n</code></pre>\n\n<p><strong><em>or</em></strong></p>\n\n<pre><code>package finance\n\ntype FinanceRequest struct {\n//...\n}\n\ntype FinanceResponse struct {\n//...\n} \n\nfunc DoSomething(r *FinanceRequest) (*FinanceResponse, error) {\n//...\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1456522183, "last_edit_date": 1456522183, "creation_date": 1456521818, "answer_id": 35661996, "question_id": 35661967, "link": "https://stackoverflow.com/questions/35661967/checking-with-os-stat-vs-just-os-mkdirall/35661996#35661996", "title": "Checking with os.Stat vs just os.MkdirAll", "body": "<p>The first thing <code>MkdirAll</code> does is call <code>os.Stat</code> to check if the path exists and is a directory. </p>\n\n<pre><code>func MkdirAll(path string, perm FileMode) error {\n    // Fast path: if we can tell whether path is a directory or file, stop with success or error.\n    dir, err := Stat(path)\n    if err == nil {\n        if dir.IsDir() {\n            return nil\n        }\n        return &amp;PathError{\"mkdir\", path, syscall.ENOTDIR}\n    }\n    ...\n</code></pre>\n\n<p>From the docs:</p>\n\n<blockquote>\n  <p>If path is already a directory, MkdirAll does nothing and returns nil.</p>\n</blockquote>\n\n<p>So no, you don't need to call <code>os.Stat</code>.</p>\n"}], "owner": {"reputation": 8641, "user_id": 732539, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d33cc4a619410535e0176138c6971ba3?s=128&d=identicon&r=PG", "display_name": "K2xL", "link": "https://stackoverflow.com/users/732539/k2xl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 0, "accepted_answer_id": 35661996, "answer_count": 1, "score": 2, "last_activity_date": 1456522183, "creation_date": 1456521700, "question_id": 35661967, "link": "https://stackoverflow.com/questions/35661967/checking-with-os-stat-vs-just-os-mkdirall", "title": "Checking with os.Stat vs just os.MkdirAll", "body": "<p>I need to write to a file in a nested directory that may or may not exist.</p>\n\n<p>At first, I checked if the folder existed via <code>os.Stat</code>, doing <code>os.MkdirAll</code> if it doesn't exist, and then opening and writing to a file.</p>\n\n<p>I tried removing the os.Stat and just doing <code>os.MkdirAll</code>, and it appears to work - meaning <code>os.MkdirAll</code> is idempotent. </p>\n\n<p>My question is, is there a benefit of doing the <code>os.Stat</code> check? Is it a much lighter operation than <code>os.MkdirAll</code>?</p>\n"}, {"tags": ["heroku", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1456520024, "post_id": 35661313, "comment_id": 59003257, "body": "I think this is a combination of an old version of Go, and GOROOT having been moved from the default build location. Try updating Go first."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1456521517, "post_id": 35661313, "comment_id": 59004006, "body": "Building on @JimB&#39;s comment: Heroku only supports Go 1.5.3 and Go 1.6 as per <a href=\"https://devcenter.heroku.com/articles/go-support#supported-versions\" rel=\"nofollow noreferrer\">devcenter.heroku.com/articles/go-support#supported-versions</a> - if you&#39;re on an older Linux distro (Debian &lt;= 7, Ubuntu &lt;= 15.04) then you won&#39;t have a recent enough version installed. See here for the latest releases: <a href=\"https://golang.org/dl/\" rel=\"nofollow noreferrer\">golang.org/dl</a>"}], "owner": {"reputation": 21, "user_id": 2628585, "user_type": "registered", "profile_image": "https://graph.facebook.com/1167735318/picture?type=large", "display_name": "Crystal Qian", "link": "https://stackoverflow.com/users/2628585/crystal-qian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 377, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1456519226, "creation_date": 1456519226, "question_id": 35661313, "link": "https://stackoverflow.com/questions/35661313/go-heroku-tutorial-no-such-file-or-directory-runtime-h", "title": "Go Heroku Tutorial: No such file or directory: runtime.h", "body": "<p>I'm working on the Golang Heroku tutorial right now, and I'm at this step:\n<a href=\"https://devcenter.heroku.com/articles/getting-started-with-go#prepare-the-app\" rel=\"nofollow\">https://devcenter.heroku.com/articles/getting-started-with-go#prepare-the-app</a></p>\n\n<p>When I execute the following:</p>\n\n<pre><code>go get github.com/heroku/go-getting-started/cmd/...\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code># runtime/cgo\n/tmp/go-build867338420/runtime/cgo/_obj/_cgo_defun.c:4 6c: No such file or directory: runtime.h\n</code></pre>\n\n<p>Here is my go environment: </p>\n\n<pre><code>\n\n    GOARCH=\"amd64\"\n    GOBIN=\"\"\n    GOCHAR=\"6\"\n    GOEXE=\"\"\n    GOHOSTARCH=\"amd64\"\n    GOHOSTOS=\"linux\"\n    GOOS=\"linux\"\n    GOPATH=\"/home/crystal/go/\"\n    GORACE=\"\"\n    GOROOT=\"/usr/lib/go\"\n    GOTOOLDIR=\"/usr/lib/go/pkg/tool/linux_amd64\"\n    TERM=\"dumb\"\n    CC=\"gcc\"\n    GOGCCFLAGS=\"-g -O2 -fPIC -m64 -pthread\"\n    CXX=\"g++\"\n    CGO_ENABLED=\"1\"\n\n</code></pre>\n\n<p>What could potentially be the issue here?</p>\n"}, {"tags": ["json", "go", "printing"], "comments": [{"owner": {"reputation": 623, "user_id": 5615224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7bea88308ec27975167f216eb8f998e?s=128&d=identicon&r=PG&f=1", "display_name": "sfault", "link": "https://stackoverflow.com/users/5615224/sfault"}, "edited": false, "score": 0, "creation_date": 1456516349, "post_id": 35660467, "comment_id": 59001141, "body": "you will have to parse json using <code>encoding&#47;json</code> package."}], "answers": [{"comments": [{"owner": {"reputation": 977, "user_id": 5227724, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d8e7291331d1d6448748bfdef7aa5244?s=128&d=identicon&r=PG&f=1", "display_name": "Nighthee", "link": "https://stackoverflow.com/users/5227724/nighthee"}, "edited": false, "score": 0, "creation_date": 1456517575, "post_id": 35660596, "comment_id": 59001921, "body": "Ohhh I see, what did you mean parse Test to a specific struct?"}, {"owner": {"reputation": 623, "user_id": 5615224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7bea88308ec27975167f216eb8f998e?s=128&d=identicon&r=PG&f=1", "display_name": "sfault", "link": "https://stackoverflow.com/users/5615224/sfault"}, "reply_to_user": {"reputation": 977, "user_id": 5227724, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d8e7291331d1d6448748bfdef7aa5244?s=128&d=identicon&r=PG&f=1", "display_name": "Nighthee", "link": "https://stackoverflow.com/users/5227724/nighthee"}, "edited": false, "score": 2, "creation_date": 1456518126, "post_id": 35660596, "comment_id": 59002255, "body": "You can define a struct named Test and in Result struct use Test []Test instead of Test []interface{}"}, {"owner": {"reputation": 185, "user_id": 2278206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f068e1a2945b5470776f21b9341d9b3?s=128&d=identicon&r=PG", "display_name": "psq", "link": "https://stackoverflow.com/users/2278206/psq"}, "edited": false, "score": 0, "creation_date": 1570656656, "post_id": 35660596, "comment_id": 102986156, "body": "Struct fields that have a json tag (all of them, in the example proposed here) need to be exported, meaning they need to start with a capital letter. More info at <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">Exported identifiers</a>"}], "tags": [], "owner": {"reputation": 623, "user_id": 5615224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7bea88308ec27975167f216eb8f998e?s=128&d=identicon&r=PG&f=1", "display_name": "sfault", "link": "https://stackoverflow.com/users/5615224/sfault"}, "is_accepted": true, "score": 10, "last_activity_date": 1456516737, "last_edit_date": 1456516737, "creation_date": 1456516637, "answer_id": 35660596, "question_id": 35660467, "link": "https://stackoverflow.com/questions/35660467/how-to-access-fields-of-a-json-in-go/35660596#35660596", "title": "How to access fields of a JSON in GO", "body": "<p>Use <code>encoding/json</code> package to Unmarshal data into struct, like following.</p>\n\n<pre><code>type Result struct {\n    ID   string        `json:\"id\"`\n    Name string        `json:\"name\"`\n    Test []interface{} `json:\"test\"`\n}\n\nvar result Result\njson.Unmarshal(contents, &amp;result)\nfmt.Println(result.Test)\n</code></pre>\n\n<p>You can also parse <code>Test</code> to specific struct.</p>\n"}, {"tags": [], "owner": {"reputation": 81, "user_id": 2091471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fba346ed4f2d8af56bdf3fa7cda48abc?s=128&d=identicon&r=PG", "display_name": "PlutoShe", "link": "https://stackoverflow.com/users/2091471/plutoshe"}, "is_accepted": false, "score": 8, "last_activity_date": 1456541913, "creation_date": 1456541913, "answer_id": 35665161, "question_id": 35660467, "link": "https://stackoverflow.com/questions/35660467/how-to-access-fields-of-a-json-in-go/35665161#35665161", "title": "How to access fields of a JSON in GO", "body": "<p>Same as the previous answer, use encoding/json package to Unmarshal data. But if you don't want to specify the structure, you could use map[string]interface/bson.M{} to receive the data, and get the field, then cast into types your want.</p>\n\n<pre><code>m := make(map[string]interface{})\nerr := json.Unmarshal(data, &amp;m)\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Println(m[\"id\"])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19, "user_id": 1310185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51716b5ce80510ea41666fe54ed43db5?s=128&d=identicon&r=PG", "display_name": "deepak", "link": "https://stackoverflow.com/users/1310185/deepak"}, "is_accepted": false, "score": 0, "last_activity_date": 1456584795, "creation_date": 1456584795, "answer_id": 35671202, "question_id": 35660467, "link": "https://stackoverflow.com/questions/35660467/how-to-access-fields-of-a-json-in-go/35671202#35671202", "title": "How to access fields of a JSON in GO", "body": "<p>You may want to try gabs container, if you are not sure how depth JSON hierarchy can be. Have  a look at below  resources</p>\n\n<p><a href=\"https://github.com/Jeffail/gabs\" rel=\"nofollow\">https://github.com/Jeffail/gabs</a>\n<a href=\"https://godoc.org/github.com/Jeffail/gabs\" rel=\"nofollow\">https://godoc.org/github.com/Jeffail/gabs</a></p>\n"}, {"tags": [], "owner": {"reputation": 35, "user_id": 5591573, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aef45ac155364d606d3db265eac2be63?s=128&d=identicon&r=PG&f=1", "display_name": "James Matheson", "link": "https://stackoverflow.com/users/5591573/james-matheson"}, "is_accepted": false, "score": 1, "last_activity_date": 1538214721, "creation_date": 1538214721, "answer_id": 52567184, "question_id": 35660467, "link": "https://stackoverflow.com/questions/35660467/how-to-access-fields-of-a-json-in-go/52567184#52567184", "title": "How to access fields of a JSON in GO", "body": "<p>If you just want to access one field then you can use the jsonq module <a href=\"https://godoc.org/github.com/jmoiron/jsonq\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/jmoiron/jsonq</a></p>\n\n<p>For your example you could get the test object with code similar to </p>\n\n<pre><code>jq.Object(\"test\")\n</code></pre>\n\n<p>Where jq is a jsonq query object constructed from your JSON above (see the godoc page for instructions on how to create a query object from a JSON stream or string). </p>\n\n<p>You can also use this library for retrieving specific String, Integer, Float and Bool values at an arbitrary depth inside a JSON object. </p>\n"}], "owner": {"reputation": 977, "user_id": 5227724, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d8e7291331d1d6448748bfdef7aa5244?s=128&d=identicon&r=PG&f=1", "display_name": "Nighthee", "link": "https://stackoverflow.com/users/5227724/nighthee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13478, "favorite_count": 3, "accepted_answer_id": 35660596, "answer_count": 4, "score": 6, "last_activity_date": 1538214721, "creation_date": 1456516243, "last_edit_date": 1456517607, "question_id": 35660467, "link": "https://stackoverflow.com/questions/35660467/how-to-access-fields-of-a-json-in-go", "title": "How to access fields of a JSON in GO", "body": "<p>Hi everyone I'm trying to see what the proper way of accessing fields of a json object from a http.get request in go.</p>\n\n<p>I first do an http.get call get the JSON and then print it (which works) but is there a way to access just a field?</p>\n\n<p>for example:</p>\n\n<pre><code>response, err:= http.Get(\"URL\")\n//Error checking is done between\ncontents, err:=ioutil.Readall(response.Body)\n\n//Now at this point I have a json that looks like\n{\"id\": \"someID\", \n\"name\": \"someName\", \n\"test\": [{\"Name\":\"Test1\", \n          \"Result\": \"Success\"},\n         {\"Name\":\"Test2\", \n          \"Result\": \"Success\"},\n         {...},\n]}\n</code></pre>\n\n<p>Is there a way to only print the \"test\" of the Json? What is the proper way of accessing that field?</p>\n"}, {"tags": ["testing", "go", "travis-ci"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1456518082, "post_id": 35660035, "comment_id": 59002228, "body": "You probably should start here: <a href=\"https://docs.travis-ci.com/\" rel=\"nofollow noreferrer\">docs.travis-ci.com</a>"}], "answers": [{"tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 0, "last_activity_date": 1456521623, "creation_date": 1456521623, "answer_id": 35661948, "question_id": 35660035, "link": "https://stackoverflow.com/questions/35660035/creating-a-travisci-config-for-automated-testing-of-a-go-application/35661948#35661948", "title": "Creating a TravisCI config for automated testing of a Go application", "body": "<ol>\n<li>Add a <code>.travis.yml</code> to the root of your repository;</li>\n<li>Connect your GitHub account to TravisCI</li>\n<li>Flick the switch to run builds on commits and pull requests.</li>\n</ol>\n\n<p>Here's what I'm using for some of the Gorilla toolkit repos:</p>\n\n<pre><code>language: go\nsudo: false\n\nmatrix:\n  include:\n    - go: 1.2\n    - go: 1.3\n    - go: 1.4\n    - go: 1.5\n    - go: 1.6\n    - go: tip\n\ninstall:\n  - go get golang.org/x/tools/cmd/vet\n\nscript:\n  - go get -t -v ./...\n  - diff -u &lt;(echo -n) &lt;(gofmt -d .)\n  - go tool vet .\n  - go test -v -race ./...\n</code></pre>\n\n<p>(source: <a href=\"https://github.com/gorilla/csrf/blob/master/.travis.yml\" rel=\"nofollow\">https://github.com/gorilla/csrf/blob/master/.travis.yml</a>)</p>\n"}], "owner": {"reputation": 1215, "user_id": 2772708, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/2b7cfd062debe303e2ccb73a48ab70d9?s=128&d=identicon&r=PG&f=1", "display_name": "hartfordfive", "link": "https://stackoverflow.com/users/2772708/hartfordfive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 35661948, "answer_count": 1, "score": 0, "last_activity_date": 1456521623, "creation_date": 1456514705, "question_id": 35660035, "link": "https://stackoverflow.com/questions/35660035/creating-a-travisci-config-for-automated-testing-of-a-go-application", "title": "Creating a TravisCI config for automated testing of a Go application", "body": "<p>I would like to create a .travis.yml  config that performes the following:</p>\n\n<ul>\n<li>fetches a Go application source code from Github, </li>\n<li>installs the other required libraries with <code>go get</code></li>\n<li>attempts to build the go application with <code>go build</code></li>\n<li>run tests with <code>go test</code></li>\n</ul>\n\n<p>I new to Go application testing with TravisCI, therefore I would appreciate any help or examples someone could point me to.</p>\n"}, {"tags": ["go", "hdf5", "unsafe-pointers"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1456510173, "post_id": 35658354, "comment_id": 58997877, "body": "What is <code>dtype</code>? I suspect your problem is due to <code>H5Awrite</code> interpreting <code>v</code> as something other than it is. In particular it&#39;s probably looking for an integer or something like that, and getting an interface value instead."}, {"owner": {"reputation": 26843, "user_id": 208997, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/250e219125d8bff1f03e6faea950f218?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/208997/simon"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1456510442, "post_id": 35658354, "comment_id": 58998010, "body": "<code>dtype</code> is an <code>hdf5.Datatype</code> of the correct type for the value of the interface. It seems that type casting <code>v</code> to the correct type (replacing <code>v := v</code> by <code>v := v.(int)</code> for instance) works. Of course I&#39;m not supposed to know the correct type (other than through reflection)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456510562, "post_id": 35658354, "comment_id": 58998071, "body": "First, are you certain that you&#39;re getting the pointer to the correct structure? You&#39;re calling <code>Write</code> with a pointer to an interface, which is almost always incorrect. Second, is <code>Write</code> storing a reference to the pointer? If you don&#39;t maintain a reference to the pointer in Go, after you pass it to C, the value of <code>v</code> is going to be GC&#39;ed. (also, run with go1.6 which adds additional safety checks to the cgo code)"}, {"owner": {"reputation": 26843, "user_id": 208997, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/250e219125d8bff1f03e6faea950f218?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/208997/simon"}, "edited": false, "score": 0, "creation_date": 1456510728, "post_id": 35658354, "comment_id": 58998168, "body": "The C library either flushes or keeps its own copy of the value so I&#39;m pretty sure GC is not the problem. I think you are right, I need to provide a pointer to the value itself. I probably need to use reflection then."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456510841, "post_id": 35658354, "comment_id": 58998223, "body": "oh yes, I didn&#39;t read the second part of the example closely enough. You&#39;re definitely just using a pointer to the interface, and not the value."}, {"owner": {"reputation": 906, "user_id": 1342660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87b4c045277546c0023b18aae7915ac3?s=128&d=identicon&r=PG", "display_name": "Denzel", "link": "https://stackoverflow.com/users/1342660/denzel"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456511497, "post_id": 35658354, "comment_id": 58998570, "body": "@JimB is correct, you need to provide a pointer to your value. You&#39;re getting garbage because it&#39;s writing out a pointer to your interface. If you could provide what your Datatype is, it&#39;d be a great help in figuring out how HDF5 is going to interpret your buffer. I would use a map with a struct that has the correct layout, instead of a map to an interface which is a reference type made up of two -- 32 or 64 bit -- words (type, value)."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1456513056, "post_id": 35658354, "comment_id": 58999403, "body": "A <i>nice</i> way to handle this might be to patch go-hdf5 <code>Write</code> to recognize when <code>v.Kind()</code> is <code>reflect.Interface</code> and if so use <code>e.Elem().Pointer()</code>. Then an interface could be passed without <code>&amp;</code> and the right thing would happen provided that <code>dtype</code> matched the thing contained within the interface."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1456513102, "post_id": 35658354, "comment_id": 58999427, "body": "Failing that you should be able to do about the same thing externally."}, {"owner": {"reputation": 26843, "user_id": 208997, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/250e219125d8bff1f03e6faea950f218?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/208997/simon"}, "edited": false, "score": 0, "creation_date": 1456516192, "post_id": 35658354, "comment_id": 59001054, "body": "Thank you all for your comments, I posted an answer using reflection. I may make a PR for go-hdf5 if I have time."}], "answers": [{"tags": [], "owner": {"reputation": 26843, "user_id": 208997, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/250e219125d8bff1f03e6faea950f218?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/208997/simon"}, "is_accepted": true, "score": 0, "last_activity_date": 1456516072, "creation_date": 1456516072, "answer_id": 35660410, "question_id": 35658354, "link": "https://stackoverflow.com/questions/35658354/pointer-to-loop-variable-for-range-over-map-or-slice-of-interface/35660410#35660410", "title": "Pointer to loop variable for range over map or slice of interface{}", "body": "<p>The <code>Write</code> method needs a pointer to a value, not a pointer to an interface containing the value. You can get it using reflection:</p>\n\n<pre><code>u := reflect.New(reflect.ValueOf(v).Type())\nu.Elem().Set(reflect.ValueOf(v))\nv := u.Interface()\n</code></pre>\n"}], "owner": {"reputation": 26843, "user_id": 208997, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/250e219125d8bff1f03e6faea950f218?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/208997/simon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 0, "accepted_answer_id": 35660410, "answer_count": 1, "score": 0, "last_activity_date": 1456516072, "creation_date": 1456508643, "last_edit_date": 1456509660, "question_id": 35658354, "link": "https://stackoverflow.com/questions/35658354/pointer-to-loop-variable-for-range-over-map-or-slice-of-interface", "title": "Pointer to loop variable for range over map or slice of interface{}", "body": "<p>I'm using <a href=\"https://github.com/sbinet/go-hdf5\" rel=\"nofollow\">go-hdf5</a> and I'm hitting a problem when trying to write attributes in a loop from a map.</p>\n\n<p>The attributes are created correctly (correct name and datatype) but the written value is garbage.</p>\n\n<p>The same code outside of the loop works fine. I tried both the <code>v := v</code> idiom and wrapping the code in a closure to capture <code>v</code> but it doesn't make a difference.</p>\n\n<p>Here is the gist of the code (error checking intentionally left out for clarity):</p>\n\n<pre><code>m := map[string]interface{\"foo\", 42}\nfor k, v := range m {\n    // [...]\n    v := v\n    attr.Write(&amp;v, dtype)\n}\n</code></pre>\n\n<p>The <a href=\"https://github.com/sbinet/go-hdf5/blob/master/h5a.go#L108-L131\" rel=\"nofollow\"><code>Write</code> method</a> is using reflection to grab a pointer to the value and forwards it to the C library. The relevant part of the code is just:</p>\n\n<pre><code>func (s *Attribute) Write(data interface{}, dtype *Datatype) error {\n    v := reflect.ValueOf(data)\n    addr := unsafe.Pointer(v.Pointer())\n    return h5err(C.H5Awrite(s.id, dtype.id, addr))\n}\n</code></pre>\n\n<p>If I replace the map by a slice of <code>interface{}</code>, I get the exact same problem so my hunch is that this has to do with the binding of loop variables, but yet <code>v := v</code> doesn't help so I'm not sure.</p>\n\n<p>I'm quite familiar with Go, HDF5 (C library) and go-hdf5 but I'm really stuck here. Any idea?</p>\n\n<p>BTW I'm using go1.5.1 darwin/amd64.</p>\n"}, {"tags": ["c#", "go", "cryptography", "aes"], "comments": [{"owner": {"reputation": 94146, "user_id": 477420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eb05243292dee6726c128660d31583b?s=128&d=identicon&r=PG", "display_name": "Alexei Levenkov", "link": "https://stackoverflow.com/users/477420/alexei-levenkov"}, "edited": false, "score": 2, "creation_date": 1456508346, "post_id": 35658196, "comment_id": 58996773, "body": "Is it even legal to calling Xor &quot;cryptography&quot;.:)"}, {"owner": {"reputation": 13909, "user_id": 162699, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/11d701f4f186f539521cde8050d0b341?s=128&d=identicon&r=PG", "display_name": "Gusman", "link": "https://stackoverflow.com/users/162699/gusman"}, "reply_to_user": {"reputation": 94146, "user_id": 477420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eb05243292dee6726c128660d31583b?s=128&d=identicon&r=PG", "display_name": "Alexei Levenkov", "link": "https://stackoverflow.com/users/477420/alexei-levenkov"}, "edited": false, "score": 0, "creation_date": 1456508396, "post_id": 35658196, "comment_id": 58996812, "body": "@AlexeiLevenkov Well, it depends on how the XOR is applied, RC4 is cryptography and it does a xor..."}, {"owner": {"reputation": 1318, "user_id": 2069190, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/4bb2aaf8ea38363c603e667c04c6df00?s=128&d=identicon&r=PG", "display_name": "Tema", "link": "https://stackoverflow.com/users/2069190/tema"}, "edited": false, "score": 0, "creation_date": 1456509720, "post_id": 35658196, "comment_id": 58997601, "body": "aes/cfb creates encrypt stream that is xored with text and result is encrypted text. It is encryption. Nothing wrong with xor here. I can&#39;t find something like XORKeyStream in .NET"}, {"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1456512930, "post_id": 35658196, "comment_id": 58999341, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/17641957/c-sharp-aes-encrypt-a-file-causes-length-of-the-data-to-encrypt-is-invalid-e\">C# AES: Encrypt a file causes &quot;Length of the data to encrypt is invalid.&quot; error</a>"}, {"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1456513080, "post_id": 35658196, "comment_id": 58999417, "body": "A mode of operation like CFB converts a block cipher like AES to a stream cipher. A stream cipher creates a <i>key stream</i> that is then XORed with the plaintext. <code>XorKeyStream</code> is nothing more than the actual encryption."}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1456516510, "post_id": 35658196, "comment_id": 59001245, "body": "Interestingly in this case, both CTR and CFB modes produce the same encrypted data."}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1456697039, "post_id": 35658196, "comment_id": 59055421, "body": "The use of cryptographic libraries should not be considered &quot;writing your own cryptographic code&quot;, especially if the protocol is already set. Now inventing your own protocol is, and just applying a cipher may not be secure enough for transport mode encryption. What are you expecting us to do here, do the work for you? What have you tried and where did it go wrong?"}], "answers": [{"comments": [{"owner": {"reputation": 726, "user_id": 1301139, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ca7bec6d96b2fed5489a175c66ff3634?s=128&d=identicon&r=PG", "display_name": "Demonslay335", "link": "https://stackoverflow.com/users/1301139/demonslay335"}, "edited": false, "score": 0, "creation_date": 1489802651, "post_id": 35770089, "comment_id": 72845300, "body": "I get this exception: <code>Run-time exception (line 32): Length of the data to encrypt is invalid.</code>. If I change <code>FeedbackSize = 8</code>, the error no longer occurs, but the encrypted data differs after the first byte per block. This means data encrypted with Go is not properly decrypted in C# (only the first byte is correct). Ideas?"}, {"owner": {"reputation": 173, "user_id": 884136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1965292579917948158cc852b1cbd33f?s=128&d=identicon&r=PG", "display_name": "Darius", "link": "https://stackoverflow.com/users/884136/darius"}, "edited": false, "score": 0, "creation_date": 1611615137, "post_id": 35770089, "comment_id": 116504647, "body": "Amazing, thanks"}], "tags": [], "owner": {"reputation": 5886, "user_id": 525454, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b7b15a5eff92731ac38f4c917d9d169d?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/525454/max"}, "is_accepted": true, "score": 4, "last_activity_date": 1457002233, "creation_date": 1457002233, "answer_id": 35770089, "question_id": 35658196, "link": "https://stackoverflow.com/questions/35658196/cryptographic-code-in-csharp-similar-to-code-in-go-aes-cfb-xorkeystream/35770089#35770089", "title": "Cryptographic code in CSharp similar to code in Go (AES,CFB,XorKeyStream)", "body": "<p>Here is your code</p>\n\n<pre><code>using System;\nusing System.Text;\nusing System.Security.Cryptography;\nusing System.IO;\n\nclass AES_CFB_XorKeyStream\n{\n    static void Main(string[] args)\n    {\n        byte[] data = Encoding.UTF8.GetBytes(\"0123456789\");\n        byte [] k1 = Encoding.UTF8.GetBytes(\"0123456789abcdef\");\n        byte [] r1 = Encoding.UTF8.GetBytes(\"1234567890abcdef\");\n\n        Console.WriteLine(\"original \" + BitConverter.ToString(data));\n\n        using (RijndaelManaged Aes128 = new RijndaelManaged())\n        {\n            Aes128.BlockSize = 128;\n            Aes128.KeySize = 128;\n            Aes128.Mode = CipherMode.CFB;\n            Aes128.FeedbackSize = 128;\n            Aes128.Padding = PaddingMode.None;\n            Aes128.Key = k1;\n            Aes128.IV = r1;\n\n            using (var encryptor = Aes128.CreateEncryptor())\n            using (var msEncrypt = new MemoryStream())\n            using (var csEncrypt = new CryptoStream(msEncrypt, encryptor, CryptoStreamMode.Write))\n            using (var bw = new BinaryWriter(csEncrypt, Encoding.UTF8))\n            {\n                bw.Write(data);\n                bw.Close();\n\n                data = msEncrypt.ToArray();\n                Console.WriteLine(\"crypted \" + BitConverter.ToString(data));\n            }\n        }\n\n        using (RijndaelManaged Aes128 = new RijndaelManaged())\n        {\n            Aes128.BlockSize = 128;\n            Aes128.KeySize = 128;\n            Aes128.Mode = CipherMode.CFB;\n            Aes128.FeedbackSize = 128;\n            Aes128.Padding = PaddingMode.None;\n\n            Aes128.Key = k1;\n            Aes128.IV = r1;\n\n            using (var decryptor = Aes128.CreateDecryptor())\n            using (var msEncrypt = new MemoryStream())\n            using (var csEncrypt = new CryptoStream(msEncrypt, decryptor, CryptoStreamMode.Write))\n            using (var bw = new BinaryWriter(csEncrypt, Encoding.UTF8))\n            {\n                bw.Write(data);\n                bw.Close();\n\n                data = msEncrypt.ToArray();\n                Console.WriteLine(\"decrypted \" + BitConverter.ToString(data));\n            }\n        }\n    }\n}\n</code></pre>\n\n<p><strong>output</strong></p>\n\n<pre><code>original 30-31-32-33-34-35-36-37-38-39\ncrypted 76-2B-6D-CE-A9-C2-A7-46-0D-B7\ndecrypted 30-31-32-33-34-35-36-37-38-39\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 726, "user_id": 1301139, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ca7bec6d96b2fed5489a175c66ff3634?s=128&d=identicon&r=PG", "display_name": "Demonslay335", "link": "https://stackoverflow.com/users/1301139/demonslay335"}, "edited": false, "score": 0, "creation_date": 1587747429, "post_id": 42870159, "comment_id": 108640702, "body": "Looking back at this years later, it may be more efficient to implement something like PKCS#7 padding instead - then you don&#39;t have to really store the number of padded bytes at all."}], "tags": [], "owner": {"reputation": 726, "user_id": 1301139, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ca7bec6d96b2fed5489a175c66ff3634?s=128&d=identicon&r=PG", "display_name": "Demonslay335", "link": "https://stackoverflow.com/users/1301139/demonslay335"}, "is_accepted": false, "score": 3, "last_activity_date": 1489808161, "creation_date": 1489808161, "answer_id": 42870159, "question_id": 35658196, "link": "https://stackoverflow.com/questions/35658196/cryptographic-code-in-csharp-similar-to-code-in-go-aes-cfb-xorkeystream/42870159#42870159", "title": "Cryptographic code in CSharp similar to code in Go (AES,CFB,XorKeyStream)", "body": "<p>I had this exact same issue with only the first byte of each decrypted block being correct, but I did not have the luxury of being able to change source on the Go program.</p>\n\n<p>I ended up implementing my own padding. Just pad the encrypted bytes with 0 bytes to make it divisible by the block size of 128, then after running through the decryption routine, chop that number of bytes off the end.</p>\n\n<p>Example code:</p>\n\n<pre><code>using System;\nusing System.Text;\nusing System.Security.Cryptography;\nusing System.Linq;\n\npublic static class Program\n{\n    static RijndaelManaged aes = new RijndaelManaged(){\n        Mode = CipherMode.CFB,\n        BlockSize = 128,\n        KeySize = 128,\n        FeedbackSize = 128,\n        Padding = PaddingMode.None\n    };\n\n    public static void Main(){\n        byte[] key = Encoding.UTF8.GetBytes(\"0123456789abcdef\");\n        byte[] iv = Encoding.UTF8.GetBytes(\"1234567890abcdef\");\n        byte[] encryptedBytes = new byte[]{0x76, 0x2b, 0x6d, 0xce, 0xa9, 0xc2, 0xa7, 0x46, 0x0d, 0xb7};\n\n        // Custom pad the bytes\n        int padded;\n        encryptedBytes = PadBytes(encryptedBytes, aes.BlockSize, out padded);\n\n        // Decrypt bytes\n        byte[] decryptedBytes = DecryptBytesAES(encryptedBytes, key, iv, encryptedBytes.Length);\n\n        // Check for successful decrypt\n        if(decryptedBytes != null){\n            // Unpad\n            decryptedBytes = UnpadBytes(decryptedBytes, padded);\n            Console.Write(\"Decrypted: \" + Encoding.UTF8.GetString(decryptedBytes));\n        }\n\n    }\n\n    // Just an elegant way of initializing an array with bytes\n    public static byte[] Initialize(this byte[] array, byte value, int length)\n    {\n        for (int i = 0; i &lt; array.Length; i++)\n        {\n            array[i] = value;\n        }\n        return array;\n    }\n\n    // Custom padding to get around the issue of how Go uses CFB mode without padding differently than C#\n    public static byte[] PadBytes(byte[] encryptedBytes, int blockSize, out int numPadded)\n    {\n        numPadded = 0;\n\n        // Check modulus of block size\n        int mod = encryptedBytes.Length % blockSize;\n        if (mod != 0)\n        {\n            // Calculate number to pad\n            numPadded = blockSize - mod;\n\n            // Build array\n            return encryptedBytes.Concat(new byte[numPadded].Initialize(0, numPadded)).ToArray();\n        }\n        else {\n            // No padding needed\n            return encryptedBytes;\n        }\n    }\n    public static byte[] UnpadBytes(byte[] decryptedBytes, int numPadded)\n    {\n        if(numPadded != 0)\n        {\n            byte[] unpaddedBytes = new byte[decryptedBytes.Length - numPadded];\n            Array.Copy(decryptedBytes, unpaddedBytes, unpaddedBytes.Length);\n            return unpaddedBytes;\n        }\n        else\n        {\n            return decryptedBytes;\n        }\n    }\n\n    public static byte[] DecryptBytesAES(byte[] cipherText, byte[] Key, byte[] IV, int size)\n    {\n        byte[] array = new byte[size];\n        try{\n            aes.Key = Key;\n            aes.IV = IV;\n            ICryptoTransform transform = aes.CreateDecryptor(aes.Key, aes.IV);\n            using (System.IO.MemoryStream memoryStream = new System.IO.MemoryStream(cipherText))\n            {\n                using (CryptoStream cryptoStream = new CryptoStream(memoryStream, transform, CryptoStreamMode.Read))\n                {\n                    cryptoStream.Read(array, 0, size);\n                }\n            }\n        }\n        catch(Exception e){\n            return null;\n        }\n        return array;\n    }\n}\n</code></pre>\n\n<p>.NET Fiddle: <a href=\"https://dotnetfiddle.net/NPHKN3\" rel=\"nofollow noreferrer\">https://dotnetfiddle.net/NPHKN3</a></p>\n"}], "owner": {"reputation": 1318, "user_id": 2069190, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/4bb2aaf8ea38363c603e667c04c6df00?s=128&d=identicon&r=PG", "display_name": "Tema", "link": "https://stackoverflow.com/users/2069190/tema"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 827, "favorite_count": 2, "accepted_answer_id": 35770089, "answer_count": 2, "score": 3, "last_activity_date": 1489808161, "creation_date": 1456508148, "last_edit_date": 1456743294, "question_id": 35658196, "link": "https://stackoverflow.com/questions/35658196/cryptographic-code-in-csharp-similar-to-code-in-go-aes-cfb-xorkeystream", "title": "Cryptographic code in CSharp similar to code in Go (AES,CFB,XorKeyStream)", "body": "<p>I have cryptographic code in Go but I can't hard find similar code in CSharp.\nI am debating to make my own implementation of XorKeyStream but I am told that there is legal issue if I write my own cryptographic code. I am sure there must be similar code in CSharp.</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/aes\"\n    \"crypto/cipher\"\n    \"fmt\"\n)\n\nfunc main() {\n\n    k1 := []byte(\"0123456789abcdef\")\n    r1 := []byte(\"1234567890abcdef\")\n    data := []byte(\"0123456789\")\n    fmt.Printf(\"original %x %s\\n\", data, string(data))\n\n    {\n        block, _ := aes.NewCipher(k1)\n        stream := cipher.NewCFBEncrypter(block, r1)\n        stream.XORKeyStream(data, data)\n        fmt.Printf(\"crypted %x\\n\", data)\n    }\n    {\n        block, _ := aes.NewCipher(k1)\n        stream := cipher.NewCFBDecrypter(block, r1)\n        stream.XORKeyStream(data, data)\n        fmt.Printf(\"decrypted %x %s\\n\", data, string(data))\n    }\n\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/EnJ56dYX_-\" rel=\"nofollow\">http://play.golang.org/p/EnJ56dYX_-</a></p>\n\n<p><strong>output</strong></p>\n\n<pre><code>original 30313233343536373839 0123456789\ncrypted 762b6dcea9c2a7460db7\ndecrypted 30313233343536373839 0123456789\n</code></pre>\n\n<p><strong>PS</strong>\nSome people marked that question as possible duplicate of question: \"C# AES: Encrypt a file causes \u201cLength of the data to encrypt is invalid.\u201d error\" \nI look for identical code in CSharp for existing code in Go. That question is about padding. This algorithm needs \"Key stream\" that will xor text. \nIt is different questions.</p>\n"}, {"tags": ["go", "revel"], "comments": [{"owner": {"reputation": 816, "user_id": 2294465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72107120fd968e9468894a9d39a06afa?s=128&d=identicon&r=PG", "display_name": "Raju Rajotia Jangid", "link": "https://stackoverflow.com/users/2294465/raju-rajotia-jangid"}, "edited": false, "score": 2, "creation_date": 1488261755, "post_id": 35657362, "comment_id": 72140865, "body": "Right track @ pregmatch +1"}], "answers": [{"comments": [{"owner": {"reputation": 183757, "user_id": 20654, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/94066dfa49c2feb14706cb081848fda7?s=128&d=identicon&r=PG", "display_name": "OscarRyz", "link": "https://stackoverflow.com/users/20654/oscarryz"}, "edited": false, "score": 0, "creation_date": 1456506494, "post_id": 35657622, "comment_id": 58995780, "body": "Can you extend your answer a bit more on how to do it?"}, {"owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "edited": false, "score": 4, "creation_date": 1456506831, "post_id": 35657622, "comment_id": 58995979, "body": "You are AWESOME! I will shine your shoes any time :). I hate when I have redundancy when do not know how to do something. What you wrote just removed a lot of code from my project(s)."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 3, "creation_date": 1456508404, "post_id": 35657622, "comment_id": 58996819, "body": "Note that <code>ReturnModels(&quot;brands&quot;).([]Brand)</code> will panic if the type assertion fails. In this case it would as you should be asserting for <code>[]*models.Brand</code>. Use the comma, ok idiom to protect against panics: <a href=\"https://golang.org/doc/effective_go.html#interface_conversions\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#interface_conversions</a>"}, {"owner": {"reputation": 8775, "user_id": 821110, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/fa6fca5f613944238a91d2daeba67b9d?s=128&d=identicon&r=PG", "display_name": "W.K.S", "link": "https://stackoverflow.com/users/821110/w-k-s"}, "edited": false, "score": 0, "creation_date": 1456508689, "post_id": 35657622, "comment_id": 58996991, "body": "Excellent Point! I&#39;ve updated my example to include the <code>comma, ok</code> pattern."}, {"owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "edited": false, "score": 0, "creation_date": 1456519134, "post_id": 35657622, "comment_id": 59002793, "body": "I just removed 5 files of redundant methods. Just great."}], "tags": [], "owner": {"reputation": 8775, "user_id": 821110, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/fa6fca5f613944238a91d2daeba67b9d?s=128&d=identicon&r=PG", "display_name": "W.K.S", "link": "https://stackoverflow.com/users/821110/w-k-s"}, "is_accepted": true, "score": 36, "last_activity_date": 1456508647, "last_edit_date": 1456508647, "creation_date": 1456506283, "answer_id": 35657622, "question_id": 35657362, "link": "https://stackoverflow.com/questions/35657362/how-to-return-dynamic-type-struct-in-golang/35657622#35657622", "title": "How to return dynamic type struct in Golang?", "body": "<p>Yes it's possible however your function should return <code>interface{}</code> and not <code>[]*interface</code>.</p>\n\n<pre><code>func (c Helper) ReturnModels(modelName string) interface{} {}\n</code></pre>\n\n<p>In this case you could use <a href=\"https://golang.org/doc/effective_go.html#type_switch\" rel=\"noreferrer\">Type Switches and/or Type Assertions</a> to cast the return value into it's original type.</p>\n\n<p><strong>Example</strong></p>\n\n<p>Note: I've never used Revel, but the following snippet should give you an a general idea:</p>\n\n<p><a href=\"https://play.golang.org/p/1sLXtWpnuW\" rel=\"noreferrer\">Playground</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Post struct {\n    Author  string\n    Content string\n}\n\ntype Brand struct {\n    Name string\n}\n\nvar database map[string]interface{}\n\nfunc init() {\n    database = make(map[string]interface{})\n\n    brands := make([]Brand, 2)\n    brands[0] = Brand{Name: \"Gucci\"}\n    brands[1] = Brand{Name: \"LV\"}\n\n    database[\"brands\"] = brands\n\n    posts := make([]Post, 1)\n    posts[0] = Post{Author: \"J.K.R\", Content: \"Whatever\"}\n\n    database[\"posts\"] = posts\n}\n\nfunc main() {\n    fmt.Println(\"List of Brands: \")\n    if brands, ok := ReturnModels(\"brands\").([]Brand); ok {\n        fmt.Printf(\"%v\", brands)\n    }\n\n    fmt.Println(\"\\nList of Posts: \")\n    if posts, ok := ReturnModels(\"posts\").([]Post); ok {\n        fmt.Printf(\"%v\", posts)\n    }\n\n}\n\nfunc ReturnModels(modelName string) interface{} {\n\n    return database[modelName]\n}\n</code></pre>\n"}], "owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34959, "favorite_count": 10, "accepted_answer_id": 35657622, "answer_count": 1, "score": 23, "last_activity_date": 1470217825, "creation_date": 1456505469, "last_edit_date": 1470217825, "question_id": 35657362, "link": "https://stackoverflow.com/questions/35657362/how-to-return-dynamic-type-struct-in-golang", "title": "How to return dynamic type struct in Golang?", "body": "<p>I am using Golang Revel for some web project and I did like 12 projects in that so far. In all of them I have a lot of code redundancy because of return types. Look at this two functions:</p>\n\n<pre><code>func (c Helper) Brands() []*models.Brand{\n\n    //do some select on rethinkdb and populate correct model\n    var brands []*models.Brand\n    rows.All(&amp;brands)\n\n    return brands\n\n}\n\nfunc (c Helper) BlogPosts() []*models.Post{\n\n    //do some select on rethinkdb and populate correct model\n    var posts []*models.Post\n    rows.All(&amp;posts)\n\n    return posts\n\n}\n</code></pre>\n\n<p>As you can see they they both returns same type of data (type struct).\nMy idea was just to pass string var like this:</p>\n\n<pre><code>func (c Helper) ReturnModels(modelName string) []*interface{} {\n\n    //do rethinkdb select with modelName and return []*interface{} for modelName\n}\n</code></pre>\n\n<p>Like this I can have just one helper for returning data types instead of\ndoing same thing over and over again for different models but same data type.</p>\n\n<p>My questions are:</p>\n\n<ol>\n<li>Is this possible at all</li>\n<li>If yes can you point me to right docs</li>\n<li>If no, I will be more then happy to return your answer :)</li>\n</ol>\n"}, {"tags": ["math", "go", "machine-learning", "sentiment-analysis"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1456513428, "post_id": 35656041, "comment_id": 58999607, "body": "Looks like you need to adapt <code>Predict</code> <a href=\"https://github.com/cdipaolo/goml/blob/master/text/bayes.go\" rel=\"nofollow noreferrer\">github.com/cdipaolo/goml/blob/master/text/bayes.go</a> to give you intermediate scores."}], "owner": {"reputation": 1303, "user_id": 779404, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1312959fa177c836dc5ecee589dc487f?s=128&d=identicon&r=PG", "display_name": "b0xxed1n", "link": "https://stackoverflow.com/users/779404/b0xxed1n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 239, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1456501656, "creation_date": 1456501656, "question_id": 35656041, "link": "https://stackoverflow.com/questions/35656041/go-language-sentiment-analysis", "title": "Go language sentiment analysis", "body": "<p>I'm using the following library to perform some sentiment analysis of Facebook posts on my feed as an experiment for a bit of fun: <a href=\"https://github.com/cdipaolo/sentiment\" rel=\"nofollow\">https://github.com/cdipaolo/sentiment</a></p>\n\n<p>But the problem I'm facing is that the Analysis object that is returned from the model.SentimentAnalysis() call doesn't have a weighted score. The score value it returns for the sentence is either 0 or 1. This makes it too vaguely defined, and I'd like to have a scale of sentiment for each Facebook post, so a float from 0.0-1.0 would be ideal where 1 is 100% positive and 0 is 100% negative.</p>\n\n<p>Is there a way I can utilize the Words variable in the object (in this file you can see it down the bottom <a href=\"https://github.com/cdipaolo/sentiment/blob/master/model.go\" rel=\"nofollow\">https://github.com/cdipaolo/sentiment/blob/master/model.go</a>) to loop over each of the word scores in the sentence to create my own weighted sentiment score? For example, would something like positive_words / total_words work? That would give me a number representing what percentage of positive sentiment the post is, but then the weighting problem comes back into it again because the words aren't weighted either, so for example say I got back a score of 0.75, in reality the true score could be a lot less because the words may have only very slightly been above the positive threshold but I don't know that because it's only either a 0 for negative or a 1 for positive, it's not a weighted float value.</p>\n\n<p>So my question here is, is there some way mathematically that I can create my own weight score given the data that is provided, or do I not have enough data to do this? </p>\n"}, {"tags": ["go", "swagger-2.0"], "answers": [{"comments": [{"owner": {"reputation": 942, "user_id": 639172, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/d9fff46ca17abc0f38e36f8af382a10d?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/639172/max"}, "edited": false, "score": 0, "creation_date": 1456653691, "post_id": 35665414, "comment_id": 59039941, "body": "issue nbr #334 Thanks !"}], "tags": [], "owner": {"reputation": 1159, "user_id": 23418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e39a948a58f4569c53d971c2e120920?s=128&d=identicon&r=PG", "display_name": "Casual Jim", "link": "https://stackoverflow.com/users/23418/casual-jim"}, "is_accepted": false, "score": 1, "last_activity_date": 1456544721, "creation_date": 1456544721, "answer_id": 35665414, "question_id": 35655966, "link": "https://stackoverflow.com/questions/35655966/go-swagger-not-generating-model-info/35665414#35665414", "title": "go-swagger not generating model info", "body": "<p>It's because go-swagger can't detect the usage of your definitions. I made the assumption that you'd always have a struct describing the parameters and that those would always use the definitions that are in use.\nIt would be great if you could submit this question as an issue on the repo with your sample program. I'll add it to my tests.</p>\n"}], "owner": {"reputation": 942, "user_id": 639172, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/d9fff46ca17abc0f38e36f8af382a10d?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/639172/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1361, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1456544721, "creation_date": 1456501452, "question_id": 35655966, "link": "https://stackoverflow.com/questions/35655966/go-swagger-not-generating-model-info", "title": "go-swagger not generating model info", "body": "<p>Here is my simple rest service:</p>\n\n<pre><code>// Package classification User API.\n//\n// the purpose of this application is to provide an application\n// that is using plain go code to define an API\n//\n// This should demonstrate all the possible comment annotations\n// that are available to turn go code into a fully compliant swagger 2.0 spec\n//\n// Terms Of Service:\n//\n// there are no TOS at this moment, use at your own risk we take no responsibility\n//\n//     Schemes: http, https\n//     Host: localhost\n//     BasePath: /v2\n//     Version: 0.0.1\n//     License: MIT http://opensource.org/licenses/MIT\n//     Contact: John Doe&lt;john.doe@example.com&gt; http://john.doe.com\n//\n//     Consumes:\n//     - application/json\n//     - application/xml\n//\n//     Produces:\n//     - application/json\n//     - application/xml\n//\n//\n// swagger:meta\npackage main\nimport (\n \"github.com/gin-gonic/gin\"\n \"strconv\"\n \"database/sql\"\n _ \"github.com/go-sql-driver/mysql\"\n \"gopkg.in/gorp.v1\"\n \"log\"\n)\n\n// swagger:model\n// User represents the user for this application\n//\n// A user is the security principal for this application.\n// It's also used as one of main axis for reporting.\n//\n// A user can have friends with whom they can share what they like.\n//\ntype User struct {\n    // the id for this user\n    //\n    // required: true\n    // min: 1\n    Id int64 `db:\"id\" json:\"id\"`\n    // the first name for this user\n    // required: true\n    // min length: 3\n    Firstname string `db:\"firstname\" json:\"firstname\"`\n    // the last name for this user\n    // required: true\n    // min length: 3\n    Lastname string `db:\"lastname\" json:\"lastname\"`\n}\n\nfunc main() {\n r := gin.Default()\n r.Use(Cors())\n v1 := r.Group(\"api/v1\")\n {\n v1.GET(\"/users\", GetUsers)\n v1.GET(\"/users/:id\", GetUser)\n v1.POST(\"/users\", PostUser)\n v1.PUT(\"/users/:id\", UpdateUser)\n v1.DELETE(\"/users/:id\", DeleteUser)\n v1.OPTIONS(\"/users\", OptionsUser)     // POST\n v1.OPTIONS(\"/users/:id\", OptionsUser) // PUT, DELETE\n }\nr.Run(\":8696\")\n}\n\n\nfunc GetUsers(c *gin.Context) {\n    // swagger:route GET /user listPets pets users\n    //\n    // Lists pets filtered by some parameters.\n    //\n    // This will show all available pets by default.\n    // You can get the pets that are out of stock\n    //\n    //     Consumes:\n    //     - application/json\n    //     - application/x-protobuf\n    //\n    //     Produces:\n    //     - application/json\n    //     - application/x-protobuf\n    //\n    //     Schemes: http, https, ws, wss\n    //\n    //     Security:\n    //       api_key:\n    //       oauth: read, write\n    //\n    //     Responses:\n    //       default: genericError\n    //       200: someResponse\n    //       422: validationError\n     var users []User\n     _, err := dbmap.Select(&amp;users, \"SELECT * FROM user\")\n    if err == nil {\n     c.JSON(200, users)\n     } else {\n     c.JSON(404, gin.H{\"error\": \"no user(s) into the table\"})\n }\n// curl -i http://localhost:8080/api/v1/users\n}\n\nfunc GetUser(c *gin.Context) {\n id := c.Params.ByName(\"id\")\n var user User\n err := dbmap.SelectOne(&amp;user, \"SELECT * FROM user WHERE id=?\", id)\nif err == nil {\n user_id, _ := strconv.ParseInt(id, 0, 64)\ncontent := &amp;User{\n Id: user_id,\n Firstname: user.Firstname,\n Lastname: user.Lastname,\n }\n c.JSON(200, content)\n } else {\n c.JSON(404, gin.H{\"error\": \"user not found\"})\n }\n// curl -i http://localhost:8080/api/v1/users/1\n}\n\nfunc PostUser(c *gin.Context) {\n var user User\n c.Bind(&amp;user)\nif user.Firstname != \"\" &amp;&amp; user.Lastname != \"\" {\nif insert, _ := dbmap.Exec(`INSERT INTO user (firstname, lastname) VALUES (?, ?)`, user.Firstname, user.Lastname); insert != nil {\n user_id, err := insert.LastInsertId()\n if err == nil {\n content := &amp;User{\n Id: user_id,\n Firstname: user.Firstname,\n Lastname: user.Lastname,\n }\n c.JSON(201, content)\n } else {\n checkErr(err, \"Insert failed\")\n }\n }\n} else {\n c.JSON(422, gin.H{\"error\": \"fields are empty\"})\n }\n// curl -i -X POST -H \"Content-Type: application/json\" -d \"{ \\\"firstname\\\": \\\"Thea\\\", \\\"lastname\\\": \\\"Queen\\\" }\" http://localhost:8080/api/v1/users\n}\n\nfunc UpdateUser(c *gin.Context) {\n id := c.Params.ByName(\"id\")\n var user User\n err := dbmap.SelectOne(&amp;user, \"SELECT * FROM user WHERE id=?\", id)\nif err == nil {\n var json User\n c.Bind(&amp;json)\nuser_id, _ := strconv.ParseInt(id, 0, 64)\nuser := User{\n Id: user_id,\n Firstname: json.Firstname,\n Lastname: json.Lastname,\n }\nif user.Firstname != \"\" &amp;&amp; user.Lastname != \"\"{\n _, err = dbmap.Update(&amp;user)\nif err == nil {\n c.JSON(200, user)\n } else {\n checkErr(err, \"Updated failed\")\n }\n} else {\n c.JSON(422, gin.H{\"error\": \"fields are empty\"})\n }\n} else {\n c.JSON(404, gin.H{\"error\": \"user not found\"})\n }\n// curl -i -X PUT -H \"Content-Type: application/json\" -d \"{ \\\"firstname\\\": \\\"Thea\\\", \\\"lastname\\\": \\\"Merlyn\\\" }\" http://localhost:8080/api/v1/users/1\n}\n\nfunc DeleteUser(c *gin.Context) {\n id := c.Params.ByName(\"id\")\nvar user User\n err := dbmap.SelectOne(&amp;user, \"SELECT id FROM user WHERE id=?\", id)\nif err == nil {\n _, err = dbmap.Delete(&amp;user)\nif err == nil {\n c.JSON(200, gin.H{\"id #\" + id: \" deleted\"})\n } else {\n checkErr(err, \"Delete failed\")\n }\n} else {\n c.JSON(404, gin.H{\"error\": \"user not found\"})\n }\n// curl -i -X DELETE http://localhost:8080/api/v1/users/1\n}\n\nvar dbmap = initDb()\nfunc initDb() *gorp.DbMap {\n db, err := sql.Open(\"mysql\",\n        \"root:max_123@tcp(127.0.0.1:3306)/gotest\")\n checkErr(err, \"sql.Open failed\")\n dbmap := &amp;gorp.DbMap{Db: db, Dialect:           gorp.MySQLDialect{\"InnoDB\", \"UTF8\"}}\n dbmap.AddTableWithName(User{}, \"User\").SetKeys(true, \"Id\")\n err = dbmap.CreateTablesIfNotExists()\n checkErr(err, \"Create table failed\")\nreturn dbmap\n}\n\nfunc checkErr(err error, msg string) {\n if err != nil {\n log.Fatalln(msg, err)\n }\n}\n\n\nfunc Cors() gin.HandlerFunc {\n return func(c *gin.Context) {\n c.Writer.Header().Add(\"Access-Control-Allow-Origin\", \"*\")\n c.Next()\n }\n}\n\nfunc OptionsUser(c *gin.Context) {\n c.Writer.Header().Add(\"Access-Control-Allow-Origin\", \"*\")\n c.Writer.Header().Set(\"Access-Control-Allow-Methods\", \"DELETE,POST, PUT\")\n c.Writer.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type\")\n c.Next()\n}\n</code></pre>\n\n<p>Now when I'm executing :\nswagger generate spec -o ./swagger.json\nto generate the json spec I'm getting:</p>\n\n<pre><code>{\n    \"consumes\": [\"application/json\", \"application/xml\"],\n    \"produces\": [\"application/json\", \"application/xml\"],\n    \"schemes\": [\"http\", \"https\"],\n    \"swagger\": \"2.0\",\n    \"info\": {\n        \"description\": \"the purpose of this application is to provide an application\\nthat is using plain go code to define an API\\n\\nThis should demonstrate all the possible comment annotations\\nthat are available to turn go code into a fully compliant swagger 2.0 spec\",\n        \"title\": \"User API.\",\n        \"termsOfService\": \"there are no TOS at this moment, use at your own risk we take no responsibility\",\n        \"contact\": {\n            \"name\": \"John Doe\",\n            \"url\": \"http://john.doe.com\",\n            \"email\": \"john.doe@example.com\"\n        },\n        \"license\": {\n            \"name\": \"MIT\",\n            \"url\": \"http://opensource.org/licenses/MIT\"\n        },\n        \"version\": \"0.0.1\"\n    },\n    \"host\": \"localhost\",\n    \"basePath\": \"/v2\",\n    \"paths\": {\n        \"/user\": {\n            \"get\": {\n                \"description\": \"This will show all available pets by default.\\nYou can get the pets that are out of stock\",\n                \"consumes\": [\"application/json\", \"application/x-protobuf\"],\n                \"produces\": [\"application/json\", \"application/x-protobuf\"],\n                \"schemes\": [\"http\", \"https\", \"ws\", \"wss\"],\n                \"tags\": [\"listPets\", \"pets\"],\n                \"summary\": \"Lists pets filtered by some parameters.\",\n                \"operationId\": \"users\",\n                \"security\": [{\n                    \"api_key\": null\n                }, {\n                    \"oauth\": [\"read\", \"write\"]\n                }],\n                \"responses\": {\n                    \"200\": {\n                        \"$ref\": \"#/responses/someResponse\"\n                    },\n                    \"422\": {\n                        \"$ref\": \"#/responses/validationError\"\n                    },\n                    \"default\": {\n                        \"$ref\": \"#/responses/genericError\"\n                    }\n                }\n            }\n        }\n    },\n    \"definitions\": {}\n}\n</code></pre>\n\n<p>Note that my definitions are empty, not sure why.\nIf I paste the same json spec in <a href=\"http://editor.swagger.io/#/\" rel=\"nofollow\">http://editor.swagger.io/#/</a>\nIt says </p>\n\n<pre><code>Error\n Object\nmessage:  \"options.definition is required\"\ncode:  \"UNCAUGHT_SWAY_WORKER_ERROR\"\n</code></pre>\n\n<p>Any directions on what is the right way to generate swagger documentation would help</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 1, "creation_date": 1456493373, "post_id": 35652902, "comment_id": 58986104, "body": "What&#39;s exactly doesn&#39;t work with <code>pusher_naive_generic</code>? For me it worked <a href=\"http://play.golang.org/p/t-GrHQGlGf\" rel=\"nofollow noreferrer\">play.golang.org/p/t-GrHQGlGf</a> And I would suggest using type assertion instead of reflection"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1456494127, "post_id": 35652902, "comment_id": 58986669, "body": "Are you trying to receive from a channel of whatever type? Any reason not to just use <a href=\"https://golang.org/pkg/reflect/#Value.Recv\" rel=\"nofollow noreferrer\"><code>reflect.(*Value).Recv</code></a>?"}, {"owner": {"reputation": 763, "user_id": 5986227, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-R58sngDauK0/AAAAAAAAAAI/AAAAAAAAB_0/pzxD2AYGNQA/photo.jpg?sz=128", "display_name": "Chris Hopkins", "link": "https://stackoverflow.com/users/5986227/chris-hopkins"}, "edited": false, "score": 0, "creation_date": 1456494316, "post_id": 35652902, "comment_id": 58986818, "body": "Okay I see what you&#39;ve done  to make that work ;-)n_chan := make(chan TestType)   out_chan := make(chan TestType) becomes:   in_chan := make(chan interface{})   out_chan := make(chan interface{}) Which makes sense. However I was hoping for the ability to express the connections as their type as seen by the user rather than as empty channels. I had experimented with doing type assertions at the instance phase to avoid having to do that, but I couldn&#39;t make that work. I&#39;m just trying to mek this transparent to the user in the same way you can with other none channel types"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1456494351, "post_id": 35652902, "comment_id": 58986846, "body": "I think OP is confused why <code>chan TestType</code> is not assertable/convertible to <code>chan interface{}</code>. Is that the problem, OP?"}, {"owner": {"reputation": 763, "user_id": 5986227, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-R58sngDauK0/AAAAAAAAAAI/AAAAAAAAB_0/pzxD2AYGNQA/photo.jpg?sz=128", "display_name": "Chris Hopkins", "link": "https://stackoverflow.com/users/5986227/chris-hopkins"}, "edited": false, "score": 0, "creation_date": 1456494549, "post_id": 35652902, "comment_id": 58987005, "body": "Yes, it&#39;s the external user interface to this I am trying to keep clean without forcing them to declare it as a channel of an empty interface"}, {"owner": {"reputation": 763, "user_id": 5986227, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-R58sngDauK0/AAAAAAAAAAI/AAAAAAAAB_0/pzxD2AYGNQA/photo.jpg?sz=128", "display_name": "Chris Hopkins", "link": "https://stackoverflow.com/users/5986227/chris-hopkins"}, "edited": false, "score": 0, "creation_date": 1456495106, "post_id": 35652902, "comment_id": 58987436, "body": "Can&#39;t figure our how to mark this as answered (First time asking a question in years of searching stack overflow)  But reflect.Recv() was what I was missing. Knew there&#39;d be a way, there always is ;-)  Many Thanks"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1456495201, "post_id": 35652902, "comment_id": 58987511, "body": "There&#39;s a clickable check mark beneath the score indicator on the answer."}], "answers": [{"tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": true, "score": 2, "last_activity_date": 1456494862, "creation_date": 1456494862, "answer_id": 35653551, "question_id": 35652902, "link": "https://stackoverflow.com/questions/35652902/golang-passing-channels-through-empty-interfaces/35653551#35653551", "title": "Golang: Passing channels through empty interfaces", "body": "<p>If I have understood your question correctly, then this might be the solution:</p>\n\n<p><a href=\"http://play.golang.org/p/xiDO7xkoW4\" rel=\"nofollow\">http://play.golang.org/p/xiDO7xkoW4</a></p>\n\n<pre><code>func forwardChannel(i interface{}, o interface{}) {\n\n    it, ot := reflect.TypeOf(i), reflect.TypeOf(o)\n\n    if it != ot {\n        panic(\"forwardChannel: both arguments must be of the same type\")\n    }\n\n    iv, ov := reflect.ValueOf(i), reflect.ValueOf(o)\n\n    for {\n        v, k := iv.Recv()\n        if !k {\n            break\n        }\n        ov.Send(v)\n    }\n\n    ov.Close()\n\n}\n</code></pre>\n\n<p>Note that <code>Recv</code>, <code>Send</code> and <code>Close</code> panic if <code>i</code> and <code>o</code> are not channels.</p>\n"}], "owner": {"reputation": 763, "user_id": 5986227, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-R58sngDauK0/AAAAAAAAAAI/AAAAAAAAB_0/pzxD2AYGNQA/photo.jpg?sz=128", "display_name": "Chris Hopkins", "link": "https://stackoverflow.com/users/5986227/chris-hopkins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1262, "favorite_count": 0, "accepted_answer_id": 35653551, "answer_count": 1, "score": 3, "last_activity_date": 1456494862, "creation_date": 1456493008, "question_id": 35652902, "link": "https://stackoverflow.com/questions/35652902/golang-passing-channels-through-empty-interfaces", "title": "Golang: Passing channels through empty interfaces", "body": "<p>I'm trying to do something that seems like it should be trivial until I read up and now it seems like it should be really complex. ;-)\nI've knocked up a test pattern to illustrate:\n<a href=\"http://play.golang.org/p/Re88vJZvPT\" rel=\"nofollow\">http://play.golang.org/p/Re88vJZvPT</a></p>\n\n<p>At the most basic I'm trying to have a function that can read data from a channel and spit it out on another one. Easy. The test does this as long as you use the pusher function shown.\nHowever the problem with this is that doing it this way I would need a different pusher function for each type of data I want to push through it.\nNow I've done similar things in the past with an empty interface as nothing in the pusher code cares about what's in the data structure. What I can't figure out is when I'm dealing with channels of an un-cared-about data structure.</p>\n\n<p>To illustrate the concept of what I'm trying to achieve please see the function pusher_naive_generic.</p>\n\n<p>However that doesn't work either so more reading up implied the way to do it was making use of reflection and finally you see my pusher_reflect_generic function(obviously this won't achieve the same intended function as the others it's showing where I got to before getting stuck).\nWhich still fails because I can't get from an interface that contains a chan to the structure read from that chan.</p>\n\n<p>Hopefully the code makes more sense of what I'm trying to achieve than my words actually do. I can make all of this work by explicitly coding for every type, but what I can't figure out how to do is code it for <em>any</em> future type.</p>\n"}]