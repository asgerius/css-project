[{"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1565222597, "post_id": 57403500, "comment_id": 101288680, "body": "The main goroutine does not receive on the channel before calling wg.Wait().  The walker goroutine blocks on send to the channel because there is no receiver.  You are not showing all relevant code, but the fix is probably to remove all code related to the wait group."}, {"owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565223035, "post_id": 57403500, "comment_id": 101288779, "body": "sorry, yes the &lt;SOME_OTHRE_CODE&gt; portion contains a range over the channel.  I will update my question to include this code.       I&#39;m trying to wait until the go routine is finished before continuing to the block &lt;SOME_OTHER_CODE&gt;"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565223335, "post_id": 57403500, "comment_id": 101288844, "body": "Why does the walker goroutine need to complete before the loop that ranges over the channel?"}, {"owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565224625, "post_id": 57403500, "comment_id": 101289081, "body": "I&#39;m addressing a defect where some files are not being included in the for range. I was suspecting a race condition where a go thread is still finding files by the time the for range statement is encountered. My thought is at this point the channel is not completed so ranging will only be a subset of total files found in the walker.  This is why I put the sync wait in place."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1565225309, "post_id": 57403500, "comment_id": 101289196, "body": "Range on a channel does not complete until the channel is closed.  The walker goroutine does not close the channel until the walk is complete.  The channel operations are not losing file names."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1565226519, "last_edit_date": 1565226519, "creation_date": 1565224599, "answer_id": 57403813, "question_id": 57403500, "link": "https://stackoverflow.com/questions/57403500/go-all-goroutines-are-asleep-deadlock/57403813#57403813", "title": "Go all goroutines are asleep deadlock", "body": "<p>The <code>walker</code> channel is unbuffered.  Communication on an unbuffered channel does not proceed until until a sender and receiver are ready.</p>\n\n<p>The deadlock is this: The main goroutine waits on the walker goroutine to complete by calling wg.Done(). The walker goroutine waits on the main goroutine to receive on the channel.</p>\n\n<p>Fix the program by removing all code related to the wait group. The wait group is not needed. Range over the channel in the main goroutine does not complete until the channel is closed by the walker goroutine. The walker goroutine does not close the channel until the walk is complete. No other coordination is required.</p>\n\n<p>You can also fix the code by removing the goroutines and channels:</p>\n\n<pre><code>err := filepath.Walk(srcFolder, func(path string, info os.FileInfo, err error) error {\n    if err != nil {\n        return err\n    }\n    if info.IsDir() {\n        return nil\n    }\n\n    // Insert body of for path := range walker here ... \n    fmt.Println(path)\n\n    return nil\n})\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>Another option is to create a buffered channel with capacity greater than the number of files that will be walked, but this requires knowing the number of files in advance and provides no benefit over collecting the file names in a slice.</p>\n"}, {"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 1, "last_activity_date": 1565226322, "last_edit_date": 1565226322, "creation_date": 1565224835, "answer_id": 57403831, "question_id": 57403500, "link": "https://stackoverflow.com/questions/57403500/go-all-goroutines-are-asleep-deadlock/57403831#57403831", "title": "Go all goroutines are asleep deadlock", "body": "<p>As written (and shown), you definitely <em>must not</em> call <code>wg.Wait()</code> before running your <code>for path := range walker</code> loop.  You <em>may</em> (but don't need to) call <code>wg.Wait()</code> when the loop terminates.  You don't need the <code>wg</code> variable at all.</p>\n\n<p>Your comment says:</p>\n\n<pre><code>// THE GO routine above needs to have finished by the time this for loop \n// ranges over the channel\n</code></pre>\n\n<p>but there is nothing in the <code>for</code> loop that requires the function to be finished, and there is something\u2014the overall strategy here\u2014that requires that the goroutine <em>not</em> be <em>blocked in a send</em>, as the <code>for</code> loop will only finish when the sender\u2014the goroutine\u2014closes the channel.</p>\n\n<p>(See <a href=\"https://stackoverflow.com/a/57403813/1256452\">Cerise Lim\u00f3n's answer</a> for why the goroutine becomes blocked in the send.)</p>\n"}], "owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 1, "accepted_answer_id": 57403813, "answer_count": 2, "score": -2, "last_activity_date": 1565226519, "creation_date": 1565221471, "last_edit_date": 1565223074, "question_id": 57403500, "link": "https://stackoverflow.com/questions/57403500/go-all-goroutines-are-asleep-deadlock", "title": "Go all goroutines are asleep deadlock", "body": "<p>Can't seem to figure out why I'm getting the error message: fatal error: all goroutines are asleep - deadlock!. </p>\n\n<p>I suspected a race condition was occurring in my   block below which should only execute after the channel is closed.</p>\n\n<p>I thought adding a sync WaitGroup would help, but it's only given me this deadlock.  What I have looks close to the samples I've seen online, so I'm just not sure what's wrong here.</p>\n\n<pre><code>func S3UploadFolder(instance *confighelper.Instance, sess *session.Session, \n    srcFolder string, bucketName string) (err error) {\n\n    log.Println(\"S3UploadFolder\", srcFolder, bucketName)\n\n    wg := &amp;sync.WaitGroup{}\n\n    // find files recursively\n    walker := make(fileWalk)\n    wg.Add(1)\n\n    go func() {\n\n        // Gather the files to upload by walking the path recursively\n        if err := filepath.Walk(srcFolder, walker.Walk); err != nil {\n            log.Fatalln(\"Walk failed:\", err)\n        }\n        wg.Done()\n        close(walker)\n\n    }()\n    wg.Wait()\n\n    for path := range walker {\n    // THE GO routine above needs to have finished by the time this for loop \n       // ranges over the channel\n         fmt.Println(path)\n\n }\n\n\n\nreturn\n}\n\n\ntype fileWalk chan string\n\nfunc (f fileWalk) Walk(path string, info os.FileInfo, err error) error {\n    if err != nil {\n        return err\n    }\n    if !info.IsDir() {\n        f &lt;- path\n    }\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go", "gmail-api"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565228979, "post_id": 57403402, "comment_id": 101289806, "body": "<code>DecodeString</code> has an error return; <i>never</i> ignore errors"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 11898948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f54196bce2ef028c2305ab8bb6b00e10?s=128&d=identicon&r=PG&f=1", "display_name": "b7010898", "link": "https://stackoverflow.com/users/11898948/b7010898"}, "edited": false, "score": 0, "creation_date": 1565277259, "post_id": 57405524, "comment_id": 101311477, "body": "Thank you! It works now! I used <code>base64.URLEncoding</code> and now it returns all of the html associated with it."}], "tags": [], "owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "is_accepted": true, "score": 0, "last_activity_date": 1565265614, "last_edit_date": 1565265614, "creation_date": 1565240929, "answer_id": 57405524, "question_id": 57403402, "link": "https://stackoverflow.com/questions/57403402/retrieving-message-body-with-gmail-api/57405524#57405524", "title": "Retrieving message body with Gmail API", "body": "<p>You should check the error returned for <code>DecodeString</code>, but otherwise you should try using <code>base64.URLEncoding</code> instead of <code>base64.StdEncoding</code> to decode the data.</p>\n\n<p>From the documentation on <a href=\"https://godoc.org/google.golang.org/api/gmail/v1#MessagePartBody.Data\" rel=\"nofollow noreferrer\"><code>MessagePartBody</code></a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    // Data: The body data of a MIME message part as a base64url encoded\n    // string. May be empty for MIME container types that have no message\n    // body or when the body data is sent as a separate attachment. An\n    // attachment ID is present if the body data is contained in a separate\n    // attachment.\n    Data string `json:\"data,omitempty\"`\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 11898948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f54196bce2ef028c2305ab8bb6b00e10?s=128&d=identicon&r=PG&f=1", "display_name": "b7010898", "link": "https://stackoverflow.com/users/11898948/b7010898"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "accepted_answer_id": 57405524, "answer_count": 1, "score": -1, "last_activity_date": 1565265612, "creation_date": 1565220621, "last_edit_date": 1565265612, "question_id": 57403402, "link": "https://stackoverflow.com/questions/57403402/retrieving-message-body-with-gmail-api", "title": "Retrieving message body with Gmail API", "body": "<p>I'm trying to use the Gmail API to extract the bodies of emails, although I'm unable to actually retrieve the bodies of the emails, as all I get is the following:</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>&lt;div dir=\"lt\n&lt;!DOCTYPE ht\n</code></pre>\n\n<p>I've written the following to collect the bodies of the emails:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>messages, err := srv.Users.Messages.List(user).Do()\n\nfor _, l := range messages.Messages {\n\n    m, err := srv.Users.Messages.Get(user, l.Id).Do()\n\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve labels: %v\", err)\n    }\n    for _, part := range m.Payload.Parts {\n        if part.MimeType == \"text/html\" {\n            data, _ := base64.StdEncoding.DecodeString(part.Body.Data)\n            html := string(data)\n            fmt.Println(html)\n        }\n    }\n}\n</code></pre>\n\n<p>Are there any ideas on how I can get the actual body of the email?</p>\n"}, {"tags": ["go", "yaml", "kubernetes-helm", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 404, "user_id": 1164802, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f9a17bccaa575860b464a1739488782?s=128&d=identicon&r=PG", "display_name": "dahc", "link": "https://stackoverflow.com/users/1164802/dahc"}, "is_accepted": true, "score": 2, "last_activity_date": 1565223320, "creation_date": 1565223320, "answer_id": 57403690, "question_id": 57403268, "link": "https://stackoverflow.com/questions/57403268/print-value-of-map-referenced-by-pointer/57403690#57403690", "title": "Print value of map referenced by pointer", "body": "<p>I think this is really a YAML question... it seems like you want the alias on the name, not the team collection:</p>\n\n<pre><code>team:\n  name: &amp;teamName abcxyz\nenvironmentVariables:\n  - TEAM\n  - *teamName\n</code></pre>\n"}], "owner": {"reputation": 286, "user_id": 11659920, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c3a4b13b2b63e267a631e94fbe2d6c?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Stanley", "link": "https://stackoverflow.com/users/11659920/jason-stanley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 57403690, "answer_count": 1, "score": 0, "last_activity_date": 1565224138, "creation_date": 1565219325, "last_edit_date": 1565224138, "question_id": 57403268, "link": "https://stackoverflow.com/questions/57403268/print-value-of-map-referenced-by-pointer", "title": "Print value of map referenced by pointer", "body": "<p>I am using Helm to render a file. My values to yaml is</p>\n\n<pre><code>team:\n  name: abcxyz\n</code></pre>\n\n<p>I would like to assign the value of <code>team.name</code> to another variable in the <code>values.yaml</code> file. Something like</p>\n\n<pre><code>environmentVariables:\n  - TEAM\n  - .Values.team.name\n</code></pre>\n\n<p>So from my research, looks like the above is not possible. But what I do try to use is something like Go pointer. So what Ive tried doing is something like this:</p>\n\n<pre><code>team: &amp;team\n  name: abcxyz\nenvironmentVariables:\n  - TEAM\n  - &lt;&lt;: *team\n</code></pre>\n\n<p>When I render this, I get the output</p>\n\n<pre><code>        &lt;/default&gt;\n        &lt;int&gt;1&lt;/int&gt;\n        &lt;string&gt;TEAM&lt;/string&gt;\n        &lt;string&gt;map[name:abcxyz]&lt;/string&gt;\n      &lt;/tree-map&gt;\n</code></pre>\n\n<p>How can I access the value of name through the pointer ?</p>\n"}, {"tags": ["go", "kubernetes"], "comments": [{"owner": {"reputation": 12854, "user_id": 559504, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/87b61c83e24e695ac8528fcb1a3cbed3?s=128&d=identicon&r=PG", "display_name": "johnharris85", "link": "https://stackoverflow.com/users/559504/johnharris85"}, "edited": false, "score": 0, "creation_date": 1565218041, "post_id": 57402713, "comment_id": 101287774, "body": "You could build the capability into your controller sure."}, {"owner": {"reputation": 1171, "user_id": 9797889, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dbyrHkUWT34/AAAAAAAAAAI/AAAAAAAAAAs/k6bfDfWiiDw/photo.jpg?sz=128", "display_name": "menya", "link": "https://stackoverflow.com/users/9797889/menya"}, "edited": false, "score": 0, "creation_date": 1565234316, "post_id": 57402713, "comment_id": 101290747, "body": "Sure, JSON Patch support <code>remove</code> operation."}, {"owner": {"reputation": 143, "user_id": 1547487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v1bWN.jpg?s=128&g=1", "display_name": "Sreeni", "link": "https://stackoverflow.com/users/1547487/sreeni"}, "reply_to_user": {"reputation": 1171, "user_id": 9797889, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dbyrHkUWT34/AAAAAAAAAAI/AAAAAAAAAAs/k6bfDfWiiDw/photo.jpg?sz=128", "display_name": "menya", "link": "https://stackoverflow.com/users/9797889/menya"}, "edited": false, "score": 0, "creation_date": 1565379711, "post_id": 57402713, "comment_id": 101350131, "body": "@menya what if I have to create a new object instead of removing.. ? Also I want to read a specific config-map contents prior to generating the json-patch..   I have the mutating webhook in Go and is running - it gets the admission Review object, I am able to walk thru get information.. but I want to read the attached config-map object and take some actions based on the contents of the config-map.  Do I have to call into a separate REST service to ge tthose or is there a way from within the Webhook, I tried config.LoadKubeConfig and is errroring."}, {"owner": {"reputation": 1171, "user_id": 9797889, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dbyrHkUWT34/AAAAAAAAAAI/AAAAAAAAAAs/k6bfDfWiiDw/photo.jpg?sz=128", "display_name": "menya", "link": "https://stackoverflow.com/users/9797889/menya"}, "edited": false, "score": 0, "creation_date": 1565493669, "post_id": 57402713, "comment_id": 101370125, "body": "You need to get target config-map from a k8s client. Webhook is just a web server."}, {"owner": {"reputation": 143, "user_id": 1547487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v1bWN.jpg?s=128&g=1", "display_name": "Sreeni", "link": "https://stackoverflow.com/users/1547487/sreeni"}, "edited": false, "score": 0, "creation_date": 1565696582, "post_id": 57402713, "comment_id": 101425891, "body": "I had to use the config.InClusterConfig. But I am stuck with the webhook being able to talk to the API Server as I get a 403. Looks like its a known issue. Adding SA header info seem to work for some, but Im still getting the same 403 errors."}], "answers": [{"tags": [], "owner": {"reputation": 639, "user_id": 4666002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59200f769e6aa89362fb83dd8c88d339?s=128&d=identicon&r=PG&f=1", "display_name": "Hang Du", "link": "https://stackoverflow.com/users/4666002/hang-du"}, "is_accepted": false, "score": 0, "last_activity_date": 1565226074, "creation_date": 1565226074, "answer_id": 57403952, "question_id": 57402713, "link": "https://stackoverflow.com/questions/57402713/creating-a-new-kubernetes-object-from-within-a-mutating-admission-controller/57403952#57403952", "title": "Creating a new Kubernetes Object from within a Mutating Admission Controller", "body": "<p>You can create a mutatingwebhookconfigurations which basically hooks a service to the mutating admission controller. That's how istio inject a sidecar proxy to all the pods which has istio-injection enabled.</p>\n\n<p>You can refer to the following link <a href=\"https://istio.io/docs/ops/setup/injection/\" rel=\"nofollow noreferrer\">Sidecar Injection Webhook</a></p>\n"}], "owner": {"reputation": 143, "user_id": 1547487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v1bWN.jpg?s=128&g=1", "display_name": "Sreeni", "link": "https://stackoverflow.com/users/1547487/sreeni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565226074, "creation_date": 1565214553, "question_id": 57402713, "link": "https://stackoverflow.com/questions/57402713/creating-a-new-kubernetes-object-from-within-a-mutating-admission-controller", "title": "Creating a new Kubernetes Object from within a Mutating Admission Controller", "body": "<p>Can a Mutating Admission Controller update/create another Object by connecting to api-server ? I see that we can use JSON Patch to mutate the inbound object via Admission Review, but can I extend it to create a completely different object ?\nThanks!!\n-Sreeni</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 9243116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d2e0a5df85ac01f13eb2b9aee88d8ef?s=128&d=identicon&r=PG&f=1", "display_name": "Erwann", "link": "https://stackoverflow.com/users/9243116/erwann"}, "edited": false, "score": 0, "creation_date": 1565204189, "post_id": 57400643, "comment_id": 101283039, "body": "Thanks, not sure what you mean by &quot;IDE settings&quot;. This is all from the command line. Copying the repo frm <code>&#47;src</code>to <code>&#47;src&#47;github.com</code> does not solve the problem. <code>$ go env GOPATH &#47;home&#47;er&#47;.go</code>."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 113, "user_id": 9243116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d2e0a5df85ac01f13eb2b9aee88d8ef?s=128&d=identicon&r=PG&f=1", "display_name": "Erwann", "link": "https://stackoverflow.com/users/9243116/erwann"}, "edited": false, "score": 0, "creation_date": 1565252406, "post_id": 57400643, "comment_id": 101296855, "body": "You tagged the issue with &quot;goland&quot;, which is a Go IDE from JetBrains <a href=\"https://www.jetbrains.com/go/\" rel=\"nofollow noreferrer\">jetbrains.com/go</a> So it was not clear what you ask for. Moving on, it seems that the dependencies for your build are missing, so, as I said, use <code>go get github.com&#47;marcopaganini&#47;netbackup&#47;...</code> call to get all the dependencies for it"}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 0, "last_activity_date": 1565203786, "creation_date": 1565203786, "answer_id": 57400643, "question_id": 57400318, "link": "https://stackoverflow.com/questions/57400318/go-build-mistakes-go-src-for-go-src-in-looking-for-dependencies/57400643#57400643", "title": "go build mistakes .go/src for go/src in looking for dependencies", "body": "<p>There are a couple of issues in the list above.</p>\n\n<p>First, the project is not cloned in the right path.\nAccording to the error message, the compiler searches for it under <code>$GOPATH/src/github.com/marcopaganini/netbackup</code> but the project is directly cloned in <code>$GOPATH/src/</code>.</p>\n\n<p>The second one is that the IDE, if I infer correctly from the question tag here as GoLand, did not automatically configured itself to the GOPATH that you have, <code>$HOME/.go</code> but rather it's configured to <code>$HOME/go</code>.</p>\n\n<p>If your <code>GOPATH</code> really is <code>$HOME/.go</code>, then you should go under the IDE settings at <code>Settings/Preferences | Go | GOPATH</code> and set the <code>Global GOPATH</code> value to be the one you need.</p>\n\n<p>However, if <code>$HOME/.go</code> is where Go itself is installed, or you don't have any setting for GOPATH in your shell, which you can check using <code>go env GOPATH</code>, then you should clone the project under the path that the error tells you about, or simply run <code>go get github.com/marcopaganini/netbackup/...</code></p>\n"}], "owner": {"reputation": 113, "user_id": 9243116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d2e0a5df85ac01f13eb2b9aee88d8ef?s=128&d=identicon&r=PG&f=1", "display_name": "Erwann", "link": "https://stackoverflow.com/users/9243116/erwann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "accepted_answer_id": 57400643, "answer_count": 1, "score": 0, "last_activity_date": 1565252426, "creation_date": 1565202394, "last_edit_date": 1565252426, "question_id": 57400318, "link": "https://stackoverflow.com/questions/57400318/go-build-mistakes-go-src-for-go-src-in-looking-for-dependencies", "title": "go build mistakes .go/src for go/src in looking for dependencies", "body": "<p>I'm trying to install a <a href=\"https://github.com/marcopaganini/netbackup\" rel=\"nofollow noreferrer\">package from github</a>. The reported errors show that <code>go build</code> looks for source files in <code>/go/src</code> rather than <code>.go/src</code> (=<code>$GOPATH</code>). Look for <code>/home/er/go/src/</code> in the error messages. How can I troubleshoot this problem?</p>\n\n<pre><code>~/.go/src/netbackup $ echo $GOPATH\n/home/er/.go\n~/.go/src/netbackup $ go version\ngo version go1.10.4 linux/amd64\n~/.go/src/netbackup $ sudo go build\nmain.go:17:2: cannot find package \"github.com/marcopaganini/logger\" in any of:\n/usr/lib/go-1.10/src/github.com/marcopaganini/logger (from $GOROOT)\n/home/er/go/src/github.com/marcopaganini/logger (from $GOPATH)\nmain.go:18:2: cannot find package \"github.com/marcopaganini/netbackup/config\" in any of:\n/usr/lib/go-1.10/src/github.com/marcopaganini/netbackup/config (from $GOROOT)\n/home/er/go/src/github.com/marcopaganini/netbackup/config (from $GOPATH)\nmain.go:19:2: cannot find package \"github.com/marcopaganini/netbackup/execute\" in any of:\n/usr/lib/go-1.10/src/github.com/marcopaganini/netbackup/execute (from $GOROOT)\n/home/er/go/src/github.com/marcopaganini/netbackup/execute (from $GOPATH)\nmain.go:20:2: cannot find package \"github.com/marcopaganini/netbackup/transports\" in any of:\n/usr/lib/go-1.10/src/github.com/marcopaganini/netbackup/transports (from $GOROOT)\n/home/er/go/src/github.com/marcopaganini/netbackup/transports (from $GOPATH)\n\n~/.go/src/netbackup $ tree\n.\n\u251c\u2500\u2500 config\n\u2502   \u251c\u2500\u2500 config.go\n\u2502   \u2514\u2500\u2500 config_test.go\n\u251c\u2500\u2500 examples\n\u2502   \u2514\u2500\u2500 restic-example.conf\n\u251c\u2500\u2500 execute\n\u2502   \u2514\u2500\u2500 execute.go\n\u251c\u2500\u2500 flags.go\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 main.go\n\u251c\u2500\u2500 main_test.go\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 transports\n    \u251c\u2500\u2500 rclone.go\n    \u251c\u2500\u2500 rclone_test.go\n    \u251c\u2500\u2500 rdiff_backup.go\n    \u251c\u2500\u2500 rdiff_backup_test.go\n    \u251c\u2500\u2500 restic.go\n    \u251c\u2500\u2500 restic_test.go\n    \u251c\u2500\u2500 rsync.go\n    \u251c\u2500\u2500 rsync_test.go\n    \u251c\u2500\u2500 transports.go\n    \u2514\u2500\u2500 transports_test.go\n\n4 directories, 19 files\n\n~/.go/src/logger $ tree\n.\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 logger.go\n\u2514\u2500\u2500 README.md\n\n0 directories, 3 files\n</code></pre>\n"}, {"tags": ["go", "elm", "content-security-policy", "elm-ui"], "comments": [{"owner": {"reputation": 2497, "user_id": 339440, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/9f153033aad728fcf498fb72956c93eb?s=128&d=identicon&r=PG", "display_name": "Stephen R", "link": "https://stackoverflow.com/users/339440/stephen-r"}, "edited": false, "score": 1, "creation_date": 1565282308, "post_id": 57399703, "comment_id": 101314116, "body": "Pull up the page, and look at the actual rendered Page Source.  Are you <i>sure</i> there&#39;s no inline script somewhere?  Maybe inserted by some bit of code?"}, {"owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "reply_to_user": {"reputation": 2497, "user_id": 339440, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/9f153033aad728fcf498fb72956c93eb?s=128&d=identicon&r=PG", "display_name": "Stephen R", "link": "https://stackoverflow.com/users/339440/stephen-r"}, "edited": false, "score": 0, "creation_date": 1565285067, "post_id": 57399703, "comment_id": 101315311, "body": "Thanks, I just did that, looking in the &#39;inspector&#39; tab in the developer pane in Firefox, and there is a whole lump of inline style, presumably put there by the Elm code. I still don&#39;t know what to do though. I could use &#39;unsafe-inline&#39;, but I&#39;d prefer not to for security reasons. Or I could not use elm-ui and have a separate CSS file, but I was really happy at not having to deal with CSS."}, {"owner": {"reputation": 1, "user_id": 15694129, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/4419a375805b68a489c19e0fe312fa29?s=128&d=identicon&r=PG", "display_name": "sluc", "link": "https://stackoverflow.com/users/15694129/sluc"}, "edited": false, "score": 0, "creation_date": 1618841362, "post_id": 57399703, "comment_id": 118725680, "body": "Can you move the inline css to your user.css stylesheet? If you can modify the Elm code, take out the style description and let it point to a class, unless the generated css code is dynamic."}], "owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 316, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1618841362, "creation_date": 1565199602, "question_id": 57399703, "link": "https://stackoverflow.com/questions/57399703/content-security-policy-violation-with-style-src-self-but-no-inline-styles", "title": "Content-Security-Policy violation with style-src &#39;self&#39;, but no inline styles", "body": "<p>Why do I get a Content-Security-Policy violation on style-src 'self' when there are no inline styles? I have a server in Go, and a web app in Elm. Here is a minimal example:</p>\n\n<p>Server (Go 1.12):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"os\"\n)\n\nconst indexhtml = `\n&lt;!DOCTYPE HTML&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;script src=\"main.js\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div id=\"elm\"&gt;&lt;/div&gt;\n  &lt;script src=\"elm.js\"&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;`\n\nconst elmjs = `\nvar app = Elm.Main.init({\n    node: document.getElementById('elm')\n})`\n\nconst csp = \"style-src 'self'; report-uri http://localhost:3333/cspreport;\"\n\nfunc main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Add(\"Content-Security-Policy\", csp)\n        io.WriteString(w, indexhtml)\n    })\n    http.HandleFunc(\"/elm.js\", func(w http.ResponseWriter, r *http.Request) {\n        io.WriteString(w, elmjs)\n    })\n    http.HandleFunc(\"/main.js\", func(w http.ResponseWriter, r *http.Request) {\n        f, _ := os.Open(\"main.js\")\n        io.Copy(w, f)\n    })\n    http.HandleFunc(\"/cspreport\", func(w http.ResponseWriter, r *http.Request) {\n        body, _ := ioutil.ReadAll(r.Body)\n        fmt.Println(string(body))\n    })\n    fmt.Println(http.ListenAndServe(\":3333\", nil))\n}\n</code></pre>\n\n<p>Elm 0.19 code (that compiles to main.js):</p>\n\n<pre><code>module Main exposing (main)\n\nimport Element as E\n\n\nmain =\n    E.layout [] &lt;|\n        E.row [] [ E.text \"a\", E.text \"b\" ]\n</code></pre>\n\n<p>And the server prints out this CSP violation (twice):</p>\n\n<pre><code>{\n   \"csp-report\":{\n      \"blocked-uri\":\"inline\",\n      \"column-number\":1,\n      \"document-uri\":\"http://localhost:3333/\",\n      \"line-number\":1,\n      \"original-policy\":\"style-src 'self'; report-uri http://localhost:3333/cspreport\",\n      \"referrer\":\"\",\n      \"source-file\":\"http://localhost:3333/\",\n      \"violated-directive\":\"style-src\"\n   }\n}\n</code></pre>\n\n<p>The problem goes away if I add 'unsafe-inline' to 'style-src' in the CSP, but I don't really want to do that. It also goes away if I don't use 'row' in the Elm code, but I need it.</p>\n\n<p>I think <a href=\"https://stackoverflow.com/questions/42401952/inline-style-error-with-content-security-policy-and-javascript\">this answer</a> is relevant, but still doesn't give me a fix.</p>\n\n<p>(For convenience, I have put the above code in a <a href=\"https://github.com/8n8/csperror\" rel=\"nofollow noreferrer\">Github repo</a>.)</p>\n"}, {"tags": ["session", "go", "redis"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1565199253, "post_id": 57399221, "comment_id": 101280871, "body": "The <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">Tour of Go</a> should answer most basic syntax questions about the language."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565200248, "post_id": 57399221, "comment_id": 101281294, "body": "Why don&#39;t you open the redis store inside <code>Configure</code> just like the original code does with the session store? Also do not close the store if you want your session-related code to actually keep working."}, {"owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565200453, "post_id": 57399221, "comment_id": 101281386, "body": "@mkopriva when I put <code>store, err = redisStore.NewRediStore(10, &quot;tcp&quot;, &quot;:6379&quot;, &quot;&quot;, []byte(&quot;secret-key&quot;))</code> inside <code>Configure</code>, I still get the same error."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565200560, "post_id": 57399221, "comment_id": 101281427, "body": "@grhn well then you have more &quot;non-declaration statements outside function body&quot; in your code then you&#39;ve shown us in the example."}, {"owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565200697, "post_id": 57399221, "comment_id": 101281484, "body": "@mkopriva you are right. I forgot to remove the original one. But now I get <code>undefined: Store</code> error at <code>session, _ := Store.Get(r, Name)</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565200803, "post_id": 57399221, "comment_id": 101281530, "body": "Do not remove <a href=\"https://github.com/josephspurrier/gowebapp/blob/master/vendor/app/shared/session/session.go#L11\" rel=\"nofollow noreferrer\">this line</a> just change the type from <code>*session.CookieStore</code> to <code>*redisStore.RediStore</code>."}, {"owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "edited": false, "score": 0, "creation_date": 1565201057, "post_id": 57399221, "comment_id": 101281637, "body": "When I remove <code>var store *redisStore.RediStore</code> and use <code>var Store *sessions.CookieStore</code> instead, I get <code>store undefined</code> at <code>store, err = redisStore.NewRediStore(10,...</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565201125, "post_id": 57399221, "comment_id": 101281659, "body": "What do you need <code>store</code> for if you have <code>Store</code>? Also in the previous comment I mentioned you need to change the types to make it work."}, {"owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "edited": false, "score": 0, "creation_date": 1565201270, "post_id": 57399221, "comment_id": 101281707, "body": "When I use <code>var Store *redisStore.RediStore</code> I still get <code>store undefined</code> at <code>store, err = redisStore.NewRediStore(10, &quot;tcp&quot;, &quot;:6379&quot;, &quot;&quot;, ...</code> Please tell me what exactly should I put into <code>Configure</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565202158, "post_id": 57399221, "comment_id": 101282072, "body": "<a href=\"https://play.golang.com/p/GsY3WtnWhuJ\" rel=\"nofollow noreferrer\">play.golang.com/p/GsY3WtnWhuJ</a>"}, {"owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565204532, "post_id": 57399221, "comment_id": 101283208, "body": "@mkopriva this works great. Thank you! Please answer and I&#39;ll accept."}], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "edited": false, "score": 0, "creation_date": 1565198520, "post_id": 57399436, "comment_id": 101280531, "body": "Well, as you can see I have to put <code>store</code>  in <code>package session</code> in order to integrate it itno <code>gowebapp</code>.  The problem is how to do so?"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "edited": false, "score": 0, "creation_date": 1565198855, "post_id": 57399436, "comment_id": 101280704, "body": "You can do store initialization in package session init() function. This special kind of function documented in language specification"}, {"owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "edited": false, "score": 0, "creation_date": 1565199921, "post_id": 57399436, "comment_id": 101281157, "body": "Isn&#39;t there a way to put the <code>store</code> inside <code>package session</code>? After all, it is called by <code>main()</code>, as you can see here: <a href=\"https://github.com/josephspurrier/gowebapp/blob/master/gowebapp.go\" rel=\"nofollow noreferrer\">github.com/josephspurrier/gowebapp/blob/master/gowebapp.go</a>"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 1, "last_activity_date": 1565198331, "creation_date": 1565198331, "answer_id": 57399436, "question_id": 57399221, "link": "https://stackoverflow.com/questions/57399221/error-non-declaration-statement-outside-function-body-on-redisstor/57399436#57399436", "title": "Error: non-declaration statement outside function body on redisstor", "body": "<p>In your code</p>\n\n<pre><code>store, err = redisStore.NewRediStore(10, \"tcp\", \":6379\", \"\", []byte(\"secret-key\"))\nif err != nil  {\n  log.Fatal(\"error getting redis store : \", err)\n}\ndefer store.Close()\n</code></pre>\n\n<p>are non declaration statements. This must reside inside a function. For example <code>init()</code> or <code>main()</code> functions. </p>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1565204989, "creation_date": 1565204989, "answer_id": 57400898, "question_id": 57399221, "link": "https://stackoverflow.com/questions/57399221/error-non-declaration-statement-outside-function-body-on-redisstor/57400898#57400898", "title": "Error: non-declaration statement outside function body on redisstor", "body": "<p>You can put the offending code inside the <code>Configure</code> function to replace the original that initializes the <code>CookieStore</code>. </p>\n\n<pre><code>var (\n    // Store is the *redis* store\n    Store *redisStore.RediStore\n    // Name is the session name\n    Name string\n)\n\n// ...\n\n// Configure the session cookie store\nfunc Configure(s Session) {\n    var err error\n    Store, err = redisStore.NewRediStore(10, \"tcp\", \":6379\", \"\", []byte(\"secret-key\"))\n    if err != nil  {\n        log.Fatal(\"error getting redis store : \", err)\n    }\n\n    Store.Options = &amp;s.Options\n    Name = s.Name\n}\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 57400898, "answer_count": 2, "score": -4, "last_activity_date": 1565204989, "creation_date": 1565197311, "last_edit_date": 1565200817, "question_id": 57399221, "link": "https://stackoverflow.com/questions/57399221/error-non-declaration-statement-outside-function-body-on-redisstor", "title": "Error: non-declaration statement outside function body on redisstor", "body": "<p>Follow redisstor <a href=\"https://github.com/boj/redistore\" rel=\"nofollow noreferrer\">docs</a>, I'd like to modify <a href=\"https://github.com/josephspurrier/gowebapp/blob/master/vendor/app/shared/session/session.go\" rel=\"nofollow noreferrer\">this</a> code to use redis to store sessions. Here is what I came up with:</p>\n\n<pre><code>package session\n\nimport (\n    \"net/http\"\n\n    \"github.com/gorilla/sessions\"\n    redisStore \"gopkg.in/boj/redistore.v1\"\n)\nvar store *redisStore.RediStore\nvar Name string\nvar err error\n\nstore, err = redisStore.NewRediStore(10, \"tcp\", \":6379\", \"\", []byte(\"secret-key\"))\nif err != nil  {\n  log.Fatal(\"error getting redis store : \", err)\n}\ndefer store.Close()\n\n// Session stores session level information\ntype Session struct {\n    Options   sessions.Options `json:\"Options\"`   \n    Name      string           `json:\"Name\"`      \n    SecretKey string           `json:\"SecretKey\"` \n}\n\n// Configure the session cookie store\nfunc Configure(s Session) {\n    Store := store\n    Store.Options = &amp;s.Options\n    Name = s.Name\n}\n\n// Instance returns a new session, never returns an error\nfunc Instance(r *http.Request) *sessions.Session {\nsession, _ := Store.Get(r, Name)\nreturn session\n }\n</code></pre>\n\n<p>But I get this error:</p>\n\n<pre><code>vendor/app/shared/session/session.go:19:1: syntax error: non-declaration statement outside function body\n</code></pre>\n\n<p>I'm wondering what is wrong here and how can I fix it?</p>\n"}, {"tags": ["http", "go", "ntlm"], "comments": [{"owner": {"reputation": 4963, "user_id": 1420941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fe6f564d60a7b48e02f22181ad24912?s=128&d=identicon&r=PG", "display_name": "stringy05", "link": "https://stackoverflow.com/users/1420941/stringy05"}, "edited": false, "score": 0, "creation_date": 1565224722, "post_id": 57398699, "comment_id": 101289106, "body": "Can you add the request and response headers to your question? Basically what should happen is the client makes a request to the server, the server responds with 2 <code>WWW-Authenticate</code> headers: <code>WWW-Authenticate: Negotiate</code> and (usually, but not always) <code>WWW-Authenticate: NTLM</code>. The client should then make another request with the <code>Authorization</code> header that includes the NTLM creds hash: <code>Authorization: Negotiate TIRM.....</code>"}, {"owner": {"reputation": 71, "user_id": 11897240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dde3ef16d18bdc0ef389576950b1b9e8?s=128&d=identicon&r=PG&f=1", "display_name": "roAl", "link": "https://stackoverflow.com/users/11897240/roal"}, "reply_to_user": {"reputation": 4963, "user_id": 1420941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fe6f564d60a7b48e02f22181ad24912?s=128&d=identicon&r=PG", "display_name": "stringy05", "link": "https://stackoverflow.com/users/1420941/stringy05"}, "edited": false, "score": 0, "creation_date": 1565249399, "post_id": 57398699, "comment_id": 101295401, "body": "@stringy05 I added the request and response headers."}, {"owner": {"reputation": 4963, "user_id": 1420941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fe6f564d60a7b48e02f22181ad24912?s=128&d=identicon&r=PG", "display_name": "stringy05", "link": "https://stackoverflow.com/users/1420941/stringy05"}, "edited": false, "score": 0, "creation_date": 1565311132, "post_id": 57398699, "comment_id": 101323516, "body": "cool, now we need the request and response headers from the go version. My guess is that it&#39;s not responding to the NTLM challenge in the initial 401 correctly, or else the azure go library isn&#39;t able to create the NTLM hash for some reason (often group policy related)"}, {"owner": {"reputation": 2634, "user_id": 7748072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf66595c2c53ae2454c8f398d2797156?s=128&d=identicon&r=PG", "display_name": "Eug&#232;ne Adell", "link": "https://stackoverflow.com/users/7748072/eug%c3%a8ne-adell"}, "edited": false, "score": 0, "creation_date": 1566289449, "post_id": 57398699, "comment_id": 101599588, "body": "is <code>req.SetBasicAuth</code> necessary when authenticating on NTLM ?"}, {"owner": {"reputation": 71, "user_id": 11897240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dde3ef16d18bdc0ef389576950b1b9e8?s=128&d=identicon&r=PG&f=1", "display_name": "roAl", "link": "https://stackoverflow.com/users/11897240/roal"}, "reply_to_user": {"reputation": 2634, "user_id": 7748072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf66595c2c53ae2454c8f398d2797156?s=128&d=identicon&r=PG", "display_name": "Eug&#232;ne Adell", "link": "https://stackoverflow.com/users/7748072/eug%c3%a8ne-adell"}, "edited": false, "score": 0, "creation_date": 1566405276, "post_id": 57398699, "comment_id": 101649086, "body": "@Eug&#232;ne Adell I don\u2019t think it is necessary, however, removing this line doesn\u2019t change anything."}, {"owner": {"reputation": 2634, "user_id": 7748072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf66595c2c53ae2454c8f398d2797156?s=128&d=identicon&r=PG", "display_name": "Eug&#232;ne Adell", "link": "https://stackoverflow.com/users/7748072/eug%c3%a8ne-adell"}, "edited": false, "score": 0, "creation_date": 1566407676, "post_id": 57398699, "comment_id": 101649989, "body": "You aren&#39;t using Basic auth any way. Why are you posting the curl trace (which works) instead of the go one (which you want to debug) ?"}], "owner": {"reputation": 71, "user_id": 11897240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dde3ef16d18bdc0ef389576950b1b9e8?s=128&d=identicon&r=PG&f=1", "display_name": "roAl", "link": "https://stackoverflow.com/users/11897240/roal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 6395, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1565249289, "creation_date": 1565195070, "last_edit_date": 1565249289, "question_id": 57398699, "link": "https://stackoverflow.com/questions/57398699/http-ntlm-authentication", "title": "HTTP NTLM authentication", "body": "<p>I am trying to consume an API which requires NTLM authentication.\nThis <code>curl</code> command works fine:</p>\n\n<pre><code>curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json'  --ntlm -u user:password -d '{ \"key1\": \"100\", \u00a0\u00a0\u00a0 \"key2\": \"1\"}' http://some/api/v/12\n</code></pre>\n\n<p>Now I am trying to do the same from a Go program:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"net/url\"\n    \"net/http\"\n    \"io/ioutil\"\n    \"log\"\n    \"github.com/Azure/go-ntlmssp\"\n\n\n\n)\n\nfunc main() {\n    url_ := \"http://some/api/v/12\"\n\n     client := &amp;http.Client{\n        Transport: ntlmssp.Negotiator{\n            RoundTripper:&amp;http.Transport{},\n        },\n    }\n\n\n\n    data := url.Values{}\n    data.Set(\"key1\", \"100\")\n    data.Set(\"key2\", \"1\")\n    b := bytes.NewBufferString(data.Encode())\n    req, err := http.NewRequest(\"POST\", url_,  b)\n    req.Header.Set(\"Content-Type\", \"application/json\")\n    req.Header.Set(\"Accept\", \"application/json\")\n    req.SetBasicAuth(\"user\", \"password\")\n\n\n    resp, err := client.Do(req)\n    if err != nil {\n        fmt.Printf(\"Error : %s\", err)\n    } else {\n\n        responseData, err := ioutil.ReadAll(resp.Body)\n        if err != nil {\n            log.Fatal(err)\n        }\n\n\n        responseString := string(responseData)\n\n\n\n        fmt.Println(responseString)\n        resp.Body.Close()\n    }\n\n}\n\n</code></pre>\n\n<p>When I execute this program I receive an \"invalid credentials\" error which I normally receive when I don't include \"--ntlm\" flag in the <code>curl</code> command.</p>\n\n<p>Can you please me give me a hint how can I accomplish this task with Go?</p>\n\n<hr>\n\n<p><strong>Update</strong></p>\n\n<p>printing the request from the curl command:</p>\n\n<pre><code>* About to connect() to www.xxx.xxx.com port xx (#0)\n*   Trying xxx.xxx.x.xxx...\n* Connected to www.xxx.xxx.com (xxx.xxx.x.xx) port xx (#0)\n* Initializing NSS with certpath: sql:/etc/pki/nssdb\n* Server auth using NTLM with user 'user'\n\n\n&gt; POST /some/api/v2 HTTP/1.1\n&gt; Authorization: NTLM xxxxx (44 cahracters)\n&gt; User-Agent: curl/7.29.0\n&gt; Host: www.xxx.xxx.com\n&gt; Content-Type: application/json\n&gt; Accept: application/json\n&gt; Content-Length: 0\n&gt;\n\n&lt; HTTP/1.1 401 Unauthorized\n&lt; Content-Type: text/html; charset=us-ascii\n&lt; Server: Microsoft-HTTPAPI/2.0\n&lt; WWW-Authenticate: NTLM xxxxx (312 characters) \n&lt; Date: Thu, xx Aug xxxx xx:xx:xx xxx\n&lt; Content-Length: 341\n&lt;\n\n* Ignoring the response-body\n* Connection\n* Issue another request to this URL: 'http://some/api/v2'\n* Found bundle for host www.xxx.xxx.com: 0x0000\n* Re-using existing connection! \n* Connected to www.xxx.xxx.com (xxx.xxx.x.xx) port xx (#0)\n* Server auth using NTLM with user 'user'\n&gt; POST /api/v2 HTTP/1.1\n&gt; Authorization: NTLM xxx (176 characters)\n&gt; User-Agent: curl/7.29.0\n&gt; Host: www.xxx.xxx.com\n&gt; Content-Type: application/json\n&gt; Accept: application/json\n&gt; Content-Length: 39\n&gt;\n\n\n* upload completely sent off: 39 out of 39 bytes\n\n\n&lt; HTTP/1.1 200 OK\n&lt; Cache-Control: no-cache\n&lt; Pragma: no-cache\n&lt; Content-Type: application/json; charset=utf-8\n&lt; Expires: -1\n&lt; Server: Microsoft-IIS/7.5\n&lt; X-AspNet-Version: 4.0.30319\n&lt; Persistent-Auth: true\n&lt; X-Powered-By: ASP.NET\n&lt; Date: Thu, 08 Aug 2019 06:49:41 GMT\n&lt; Content-Length: 1235\n</code></pre>\n"}, {"tags": ["arrays", "go", "struct"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1565202536, "post_id": 57398311, "comment_id": 101282230, "body": "If the distinction between a nil slice and empty slice is not important in your tests, then test with <code>len(s) == 0</code>. This expression evaluates to true for both nil slices and empty slices."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 9, "last_activity_date": 1565203958, "last_edit_date": 1565203958, "creation_date": 1565193880, "answer_id": 57398393, "question_id": 57398311, "link": "https://stackoverflow.com/questions/57398311/difference-between-foonil-and-foo-in-go/57398393#57398393", "title": "Difference between []Foo(nil) and []Foo{} in Go", "body": "<p>The expression <code>[]Foo(nil)</code> is a <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a>. It converts the untyped nil to a nil slice of type <code>[]Foo</code>.</p>\n\n<p>The expression <code>[]Foo{}</code> is a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a> that returns a empty slice. It's empty because no elements are listed between the <code>{}</code>. </p>\n\n<p>This might help explain the difference:</p>\n\n<pre><code>fmt.Println([]Foo(nil) == nil) // prints true\nfmt.Println([]Foo{} == nil)    // prints false\n</code></pre>\n\n<p>A nil slice does not have a backing array.  An empty slice has a backing array with length 0.</p>\n\n<p>What's confusing is that the fmt package can output the same data for empty slices and nil slices. </p>\n\n<p>If the distinction between a nil slice and empty slice is not important in your tests, then test with <code>len(s) == 0</code>.  This expression evaluates to true for both nil slices and empty slices.</p>\n"}], "owner": {"reputation": 19, "user_id": 9864252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc16109e57f6814007472767f60a04d7?s=128&d=identicon&r=PG&f=1", "display_name": "rwalle61", "link": "https://stackoverflow.com/users/9864252/rwalle61"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 57398393, "answer_count": 1, "score": -1, "last_activity_date": 1565203958, "creation_date": 1565193572, "question_id": 57398311, "link": "https://stackoverflow.com/questions/57398311/difference-between-foonil-and-foo-in-go", "title": "Difference between []Foo(nil) and []Foo{} in Go", "body": "<p>I'm new to Go and would like to know the difference between <code>[]Foo(nil)</code> and <code>[]Foo{}</code>. </p>\n\n<p>(I'm using this in my tests, where I want to specify that when my function errors, it should return <code>nil, err</code>. The go linter complains when I use <code>nil</code> or <code>[]Foo{}</code>, but works when I use <code>[]Foo(nil)</code>.) </p>\n\n<h2>What I've tried</h2>\n\n<p>I had a look at the Go docs and on SO and found Struct stuff about <code>Foo{}</code> but not <code>[]Foo(nil)</code>. </p>\n\n<p>When I use <code>[]Foo{}</code>, the test failure outputs:</p>\n\n<pre><code>expected: []Foo{}\nactual  : []Foo(nil)\n</code></pre>\n\n<p>Fmt outputs for <code>[]Foo(nil)</code> and <code>[]Foo{}</code> are the same:</p>\n\n<pre><code>fmt.Println([]Foo(nil)) // []\nfmt.Println([]Foo(){}) // []\nfmt.Printf([]Foo(nil)) // []Foo\nfmt.Printf([]Foo(){}) // []Foo\n</code></pre>\n\n<p>I noticed that if I write just <code>Foo(nil)</code> (without the <code>[]</code>) then the linter complains about <code>cannot convert nil to type Foo</code>.</p>\n\n<p>So my only guess is that <code>[]Foo(nil)</code> invokes some type coercion. Can anyone help me out?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "is_accepted": true, "score": 1, "last_activity_date": 1565194244, "creation_date": 1565194244, "answer_id": 57398482, "question_id": 57398261, "link": "https://stackoverflow.com/questions/57398261/await-two-results-concurrently-with-timeout/57398482#57398482", "title": "Await two results concurrently with timeout", "body": "<p>The way you plan to select on <code>ctx.Done()</code> looks correct.<br>\nIt's the way you work with your mutable state that is wrong, in my opinion.</p>\n\n<p>Try something like this:</p>\n\n<pre><code> var state = State{}\n select {\n    case type &lt;- typeChan\n        stats.Type = type\n        if (stats.OrderCount != nil) {\n           return stats\n        }\n    case count &lt;- countChan\n        stats.OrderCount = count\n        if (stats.Type != nil) {\n           return stats\n        }\n    case &lt;-ctx.Done()\n        return stats\n    }\n</code></pre>\n\n<p>Now your functions should look like this:</p>\n\n<pre><code>go func() {        \n    orderCount, err := s.Storage.GetOrderCount(ctx, customerUUID)\n    if err != nil {\n        return // Here you probably want to have errChan\n    }\n\n    if orderCount == 0 {\n        countChan &lt;- \"NA\"\n    } else {\n        countChan &lt;- strconv.Itoa(orderCount)\n    }        \n}()\n</code></pre>\n\n<p>This is all a bit sketchy, since your example is quite complex, but should give you the direction to follow.</p>\n"}], "owner": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "accepted_answer_id": 57398482, "answer_count": 1, "score": 0, "last_activity_date": 1565194244, "creation_date": 1565193404, "question_id": 57398261, "link": "https://stackoverflow.com/questions/57398261/await-two-results-concurrently-with-timeout", "title": "Await two results concurrently with timeout", "body": "<p><strong>Use case</strong></p>\n\n<p>I'd like to run two queries against a database in parallel and return after a maximum time of 600ms whatever I have fetched to that point. I am struggling with implementing the concurrency for this requirement.</p>\n\n<p><strong>Code</strong></p>\n\n<pre><code>func (s *Service) GetCustomerStats(ctx context.Context, customerUUID string) *CustomerStats {\n    stats := &amp;CustomerStats{\n        CustomerUUID: customerUUID,\n        Type:         \"ERROR\",\n        OrderCount:   \"ERROR\",\n    }\n\n    var wg sync.WaitGroup\n    var mu sync.Mutex\n\n    // Get order count\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        orderCount, err := s.Storage.GetOrderCount(ctx, customerUUID)\n        if err != nil {\n            return\n        }\n\n        mu.Lock()\n        stats.OrderCount = strconv.Itoa(orderCount)\n        if orderCount == 0 {\n            stats.OrderCount = \"NA\"\n        }\n        mu.Unlock()\n    }()\n\n    // Get customer type\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        type, err := s.Storage.GetCustomerType(ctx, customerUUID)\n        if err != nil {\n            return\n        }\n\n        mu.Lock()\n        stats.Type = strconv.Itoa(type)\n        mu.Unlock()\n    }()\n\n    wg.Wait()\n\n    return stats\n}\n</code></pre>\n\n<p><strong>The problem</strong></p>\n\n<p>The context I pass into that function has a timeout of 600ms defined. I pass it on to the storage repo and the Database driver uses it as well, but it does not guarantee it will respond within that time as it does schedule some retries under the hood.</p>\n\n<p>However I must ensure that this function returns within the passed context timeout (600ms). I am currently using a waitgroup to await the results but I wouldn't know how to return <code>stats</code> once the context is done.</p>\n\n<p>Basically I am looking for something like this. My research indicates that I should probably use channels which signal that the work is done but I am not sure how I would implement that so that it's simple code.</p>\n\n<pre><code>    select {\n    case wg.Wait()\n        return stats\n    case &lt;-ctx.Done()\n        return stats\n    }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1565189706, "post_id": 57397072, "comment_id": 101276062, "body": "It is only possible with reflection, or repeating code. Repeating code is generally the preferred approach, as it&#39;s much faster, and easier to read."}, {"owner": {"reputation": 1, "user_id": 10562672, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-gQlai5QD09Y/AAAAAAAAAAI/AAAAAAAAAJc/i7QWTEb0r_k/photo.jpg?sz=128", "display_name": "Dinamis", "link": "https://stackoverflow.com/users/10562672/dinamis"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565190103, "post_id": 57397072, "comment_id": 101276295, "body": "@Flimzy thanks, but is it okay to tripple the code basicly for a one line of code? j.items[cur].[f] will be not much complicated."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1565190201, "post_id": 57397072, "comment_id": 101276351, "body": "Of course it&#39;s okay. It&#39;s your code. Do what you want. You can use reflection, if you really want to, but why bother? It&#39;s slower, and it makes your code harder to read. Go&#39;s philosophy is to make your code as easy to read as possible, even if that means you write a few more lines of code. Most people spend 10x more time reading code than writing it, so I think this is an appropriate bias."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565192723, "post_id": 57397072, "comment_id": 101277712, "body": "You can reduce the code by using this pattern: <code>func (j *items) updatePath(n string, v string) []JSON { if cur := j.find(n); cur != -1 { j.items[cur].Path = v }; return j.items }</code> (formatted for comment, gofmt it to remove ; and insert line breaks).  There does not appear to be a reason to return the slice, so simplify more by removing the return value."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 10562672, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-gQlai5QD09Y/AAAAAAAAAAI/AAAAAAAAAJc/i7QWTEb0r_k/photo.jpg?sz=128", "display_name": "Dinamis", "link": "https://stackoverflow.com/users/10562672/dinamis"}, "is_accepted": false, "score": -1, "last_activity_date": 1565360499, "creation_date": 1565360499, "answer_id": 57432034, "question_id": 57397072, "link": "https://stackoverflow.com/questions/57397072/how-to-select-key-id-in-a-struct-by-a-matching-string-variable/57432034#57432034", "title": "How to select key id in a struct, by a matching string variable", "body": "<p>Solution:</p>\n\n<pre><code>func (j *items) updateField(s string, vl string) {\n    val := reflect.ValueOf(&amp;j.items[0])\n    (val.Elem()).FieldByName(s).SetString(vl)\n}\n</code></pre>\n\n<ol>\n<li>It's not slower</li>\n<li>It's not harder to understand</li>\n</ol>\n\n<p>Also i'm find out that it's also possible to do with a Map(), but it will took a lot more effort. </p>\n"}], "owner": {"reputation": 1, "user_id": 10562672, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-gQlai5QD09Y/AAAAAAAAAAI/AAAAAAAAAJc/i7QWTEb0r_k/photo.jpg?sz=128", "display_name": "Dinamis", "link": "https://stackoverflow.com/users/10562672/dinamis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1565360499, "creation_date": 1565189240, "last_edit_date": 1565189667, "question_id": 57397072, "link": "https://stackoverflow.com/questions/57397072/how-to-select-key-id-in-a-struct-by-a-matching-string-variable", "title": "How to select key id in a struct, by a matching string variable", "body": "<p>I'm interesting in to update value in to struct, but I notice lots of repeated code. Is it possible to pass Key ID in to <code>func(keyid string)</code> to use input as a selector to modify the struct? I know reflect package exists, but it's simple to return value of key field, but I can't figure out how to use it as selector of key id.</p>\n\n<p>My repeated code pattern:</p>\n\n<pre><code>func (j *items) updatePath(n string, v string) []JSON {\n    cur := j.find(n)\n    if cur != -1 {\n        j.items[cur].Path = v\n        return j.items\n    }\n    return j.items\n}\n\nfunc (j *items) updateArgs(n string, v []string) []JSON {\n    cur := j.find(n)\n    if cur != -1 {\n        j.items[cur].Args = v\n        return j.items\n    }\n    return j.items\n}\n\nfunc (j *items) updateTimes(n string) []JSON {\n    cur := j.find(n)\n    if cur != -1 {\n        j.items[cur].TimesRun++\n        return j.items\n    }\n    return j.items\n}\n</code></pre>\n\n<p>Reflect:</p>\n\n<pre><code>func (j *items) returnField(s string) string {\n    r := reflect.ValueOf(j.items[0])\n    f := reflect.Indirect(r).FieldByName(s)\n    return f.String() //i can't use f as `j.items[0].f` selector.\n}\n</code></pre>\n"}, {"tags": ["postgresql", "google-app-engine", "go"], "comments": [{"owner": {"reputation": 45, "user_id": 7284668, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638e28d8923a6445e5f8462221fdcc18?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/7284668/matt"}, "edited": false, "score": 0, "creation_date": 1565188986, "post_id": 57396825, "comment_id": 101275670, "body": "Thanks for the helpful downvote, which I presume was for the mangled code formatting. I have fixed that now. Or was there something else you didn&#39;t like?"}, {"owner": {"reputation": 96, "user_id": 10225930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxwy.jpg?s=128&g=1", "display_name": "alan", "link": "https://stackoverflow.com/users/10225930/alan"}, "edited": false, "score": 0, "creation_date": 1565199061, "post_id": 57396825, "comment_id": 101280789, "body": "Can you check if Cloud SQLAdmin API is enabled for the project? If you still have the error afterwards, can you try it again with the flag --verbosity=debug? this can give you more details of the error"}, {"owner": {"reputation": 45, "user_id": 7284668, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638e28d8923a6445e5f8462221fdcc18?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/7284668/matt"}, "reply_to_user": {"reputation": 96, "user_id": 10225930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxwy.jpg?s=128&g=1", "display_name": "alan", "link": "https://stackoverflow.com/users/10225930/alan"}, "edited": false, "score": 0, "creation_date": 1565212141, "post_id": 57396825, "comment_id": 101286152, "body": "Thanks @alan. I checked. Cloud SQL API was enabled, but not Cloud SQLAdmin API. I enabled it but didn&#39;t seem to make any difference. Still the same error. Ran with the verbosity flag but no new info around the db connection, still the same error as above"}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 7284668, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638e28d8923a6445e5f8462221fdcc18?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/7284668/matt"}, "edited": false, "score": 0, "creation_date": 1565289663, "post_id": 57417705, "comment_id": 101317245, "body": "Yes, that fixes it. Thank you so much. I could have sworn I had tried it with and without. I must have had something else wrong at that time or maybe it was to do with the Cloud SQLAdmin not being enabled. Anyway, fixed."}], "tags": [], "owner": {"reputation": 430, "user_id": 9687449, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ScUTO6CKvdQ/AAAAAAAAAAI/AAAAAAAAAAA/BXKGYIn6Wwk/photo.jpg?sz=128", "display_name": "Oliver Aragon", "link": "https://stackoverflow.com/users/9687449/oliver-aragon"}, "is_accepted": true, "score": 0, "last_activity_date": 1565284524, "creation_date": 1565284524, "answer_id": 57417705, "question_id": 57396825, "link": "https://stackoverflow.com/questions/57396825/how-to-connect-google-app-engine-flex-go-app-to-google-cloud-postgres-instance/57417705#57417705", "title": "How to connect Google App Engine (Flex) Go app to Google Cloud Postgres instance", "body": "<p>I replicated this issue in my testing environment and found that the error you are getting is due to the beta_settings having the port specified. I tried it with the <code>=tcp:5432</code> at the end, and it gave me the same error, then I tried it without it and it got deployed without any issues. </p>\n"}], "owner": {"reputation": 45, "user_id": 7284668, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638e28d8923a6445e5f8462221fdcc18?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/7284668/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "accepted_answer_id": 57417705, "answer_count": 1, "score": 0, "last_activity_date": 1565284524, "creation_date": 1565188410, "last_edit_date": 1565189486, "question_id": 57396825, "link": "https://stackoverflow.com/questions/57396825/how-to-connect-google-app-engine-flex-go-app-to-google-cloud-postgres-instance", "title": "How to connect Google App Engine (Flex) Go app to Google Cloud Postgres instance", "body": "<p>I'm building an app in Go and am using Google App Engine for deployment.</p>\n\n<p>I have set up a PostgreSQL instance on Google Cloud, have enabled the API and have successfully connected to it using the SQL proxy from my local machine, both from a local PSequel client and from my app.</p>\n\n<p>When I do <code>gcloud app deploy</code>, however, I get this error:</p>\n\n<pre><code>ERROR: (gcloud.app.deploy) Error Response: [9] \nApplication startup error:\npanic: dial unix /cloudsql/sapling:europe-west1:sapling/.s.PGSQL.5432: connect: no such file or directory\n</code></pre>\n\n<p>I have tried downgrading the Postgres instance from version 11 Beta to 9.6. Have also tried using this driver <a href=\"https://github.com/broady/gae-postgres\" rel=\"nofollow noreferrer\">https://github.com/broady/gae-postgres</a>, which seemed promising but I couldn't get working for the flex environment.</p>\n\n<p><strong>app.yaml</strong></p>\n\n<pre><code>runtime: go\n#Here we select the AppEngine Flex environment which performs a lot of the backend preparation for us including the ability to scale give the demand\nenv: flex\nenv_variables:\n  POSTGRES_CONNECTION: \"user=postgres password=thisisntmypwd dbname=postgres host=/cloudsql/sapling:europe-west1:sapling\"\nmanual_scaling:\n  instances: 1\n#Select resource size\nresources:\n  cpu: 1\n  memory_gb: 0.5\n  disk_size_gb: 10\nbeta_settings:\n  cloud_sql_instances: sapling:europe-west1:sapling=tcp:5432\n</code></pre>\n\n<p><strong>config/db.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package config\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    _ \"github.com/lib/pq\"\n    \"os\"\n)\n\nvar Db *sql.DB\n\n//Set up connection to the database\nfunc init() {\n    var err error\n    datastoreName := os.Getenv(\"POSTGRES_CONNECTION\")\n    Db, err = sql.Open(\n        \"postgres\",\n        datastoreName,\n        )\n    if err != nil {\n        panic(err)\n    }\n\n\n    err = Db.Ping()\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(\"Connected to database\")\n\n}\n</code></pre>\n"}, {"tags": ["python", "reactjs", "go", "gorilla", "kong"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565193591, "post_id": 57396717, "comment_id": 101278153, "body": "Somebody <a href=\"https://stackoverflow.com/questions/57332313/how-to-fix-first-character-only-bug\">asked a similar question a few days ago</a>.  When you test with PostMan, are you testing the same service instances used by the react frontend and the lambda function?"}, {"owner": {"reputation": 45, "user_id": 3166137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Prk9L.jpg?s=128&g=1", "display_name": "Thingable", "link": "https://stackoverflow.com/users/3166137/thingable"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565201746, "post_id": 57396717, "comment_id": 101281896, "body": "Yea, both of us are working on the same problem it just got passed along to me. No they are different services but they are built on the same template. They do pass along the same fields from the DB however."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565201969, "post_id": 57396717, "comment_id": 101281988, "body": "When you test with PostMan, are you testing the same service instances used by the react frontend and the lambda function?  Does the response from the service include data read from the request body?"}, {"owner": {"reputation": 45, "user_id": 3166137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Prk9L.jpg?s=128&g=1", "display_name": "Thingable", "link": "https://stackoverflow.com/users/3166137/thingable"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565202957, "post_id": 57396717, "comment_id": 101282414, "body": "React and the lambda function use different services, but when I test with PostMan I test the same instances respectively. No there is no data in the request body in either instance."}], "owner": {"reputation": 45, "user_id": 3166137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Prk9L.jpg?s=128&g=1", "display_name": "Thingable", "link": "https://stackoverflow.com/users/3166137/thingable"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565188065, "creation_date": 1565188065, "question_id": 57396717, "link": "https://stackoverflow.com/questions/57396717/go-api-microservice-occasionally-returns-first-character-in-a-string-or-garbage", "title": "Go API microservice occasionally returns first character in a string or garbage characters. Is there a known error that may cause this?", "body": "<p>I have a few API microservices that use gorrilla mux/handlers that randomly return characters that are not in the string, or only the first character. The problem never shows up when tested in Postman, about 10% of the time when called from the React.js front end, 50% of the time when called from AWS lambda python function when called every minute, and nearly never when lambda is called once every 3 minutes. To be honest, I am not sure where in the stack this is going wrong.</p>\n\n<p>The microservices are running in a docker container within an OpenShift cluster that are ran though a Kong API gateway. Currently I am leaning to the problem being within gorrilla mux/handlers or the GoLang code, because we had the same issue before we moved to OpenShift and it seems to be happening across a few different clients, and services. </p>\n\n<p>First, we looked into the problem being in the frontend. This is where we notice the first character only bug. We thought this may be an issue with react possibly displaying the data before it pulls all of it. So we logged the object that was returned and it contains the same data. What is interesting is that most of the strings are fine except one that is usually >100 characters, and when it happens it happens to all of strings with the same key. Again this only happens about 5-10% of the time and refreshing normally fixes it.</p>\n\n<p>Then we noticed that an AWS lambda python function was getting garbage data from a similar API service. Sometimes '\\000000\\0000000' over and over again, or random parts of other strings from the JSON output, would be added in the middle of other strings. This started happening more often (as more data was added to the DB tables) until it was about 50% of the time when the lambda function was called every minute. I changed the call to be scheduled every three minutes and the problem disappeared. </p>\n\n<p>When I go to find where in the stack this is happening with postman calls the problem never shows up, even when I blast calls in rapid succession. Which makes this a bit of a pain to track down.</p>\n\n<p>I am not certain that the problems between lambda and the react front end are the same but I figured that the inconsistency is what is consistent between these problems. I am chalking up the difference in how this inconsistency is expressed to how the JSON is read into the clients.</p>\n\n<p>I am hoping someone could point me in the right direction on this. Google and GitHub are not returning any known bugs that seem similar, and I am at a bit of a loss on where to be probing this one.</p>\n"}, {"tags": ["python", "go", "grpc"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1565187284, "post_id": 57393292, "comment_id": 101274619, "body": "I can&#39;t see an obvious problem but usually this means some namespacing issue of the server. Try running <code>grpc_cli ls localhost:50051</code> and see how the service is registered, perhaps the package name in the Go code is different somehow?"}, {"owner": {"reputation": 31, "user_id": 10341859, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-BV1LwEn_1LQ/AAAAAAAAAAI/AAAAAAAAACo/ssgOeN56wFc/photo.jpg?sz=128", "display_name": "shanglin huang", "link": "https://stackoverflow.com/users/10341859/shanglin-huang"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1565238758, "post_id": 57393292, "comment_id": 101291577, "body": "I solve my problem now. Because I generate python grpc code with wrong helloworld.proto which omit one line: <code>package helloworld;</code>."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1565245583, "post_id": 57393292, "comment_id": 101293608, "body": "ah, so my instinct was right :) you might want to phrase that as an answer for people having similar problems."}, {"owner": {"reputation": 31, "user_id": 10341859, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-BV1LwEn_1LQ/AAAAAAAAAAI/AAAAAAAAACo/ssgOeN56wFc/photo.jpg?sz=128", "display_name": "shanglin huang", "link": "https://stackoverflow.com/users/10341859/shanglin-huang"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1565250045, "post_id": 57393292, "comment_id": 101295706, "body": "But, according to my demo result, if I use python as both grpc server and grpc client, helloworld.proto don&#39;t need the line: <code>package helloworld;</code> But if I use go as grpc client, I need the line:  <code>package helloworld;</code> to generate python grpc code. That&#39;s confused. :("}], "owner": {"reputation": 31, "user_id": 10341859, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-BV1LwEn_1LQ/AAAAAAAAAAI/AAAAAAAAACo/ssgOeN56wFc/photo.jpg?sz=128", "display_name": "shanglin huang", "link": "https://stackoverflow.com/users/10341859/shanglin-huang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 224, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1565176975, "creation_date": 1565176975, "question_id": 57393292, "link": "https://stackoverflow.com/questions/57393292/gprc-demo-by-go-and-python", "title": "gprc demo by go and python", "body": "<p>I want to get a Grpc demo which client is Golang and server is Python. I use Grpc official code as my demo, but it's doesn't work. Can someone help me?</p>\n\n<p>If I generate the client and server by same language, example: Python or Golang. It works correctly.</p>\n\n<ol>\n<li>helloworld.proto</li>\n</ol>\n\n<pre><code>syntax = \"proto3\";\n\npackage helloworld;\n\n// The greeting service definition.\nservice Greeter {\n  // Sends a greeting\n  rpc SayHello (HelloRequest) returns (HelloReply) {}\n}\n\n// The request message containing the user's name.\nmessage HelloRequest {\n  string name = 1;\n}\n\n// The response message containing the greetings\nmessage HelloReply {\n  string message = 1;\n}\n</code></pre>\n\n<p>2.get relevant code</p>\n\n<p>1) get python relevant code:\npython -m grpc_tools.protoc --python_out=. --grpc_python_out=. -I. helloworld.proto</p>\n\n<p>2) get go relevant code:\nprotoc -I . helloworld.proto --go_out=plugins=grpc:.</p>\n\n<ol start=\"3\">\n<li>helloworld_grpc_server.py</li>\n</ol>\n\n<pre class=\"lang-py prettyprint-override\"><code>import time\nimport logging\nimport grpc\nfrom concurrent import futures\n\nimport helloworld_pb2\nimport helloworld_pb2_grpc\n\n_ONE_DAY_IN_SECONDS = 60 * 60 * 24\n\n\nclass Greeter(helloworld_pb2_grpc.GreeterServicer):\n\n    def SayHello(self, request, context):\n        return helloworld_pb2.HelloReply(message='Hello, %s!' % request.name)\n\n\ndef serve():\n    server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))\n    helloworld_pb2_grpc.add_GreeterServicer_to_server(Greeter(), server)\n    server.add_insecure_port('[::]:50051')\n    server.start()\n    try:\n        while True:\n            time.sleep(_ONE_DAY_IN_SECONDS)\n    except KeyboardInterrupt:\n        server.stop(0)\n\n\nif __name__ == '__main__':\n    logging.basicConfig()\n    serve()\n</code></pre>\n\n<ol start=\"4\">\n<li>greeter_client/main.go</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"context\"\n    \"log\"\n    \"os\"\n    \"time\"\n\n    \"google.golang.org/grpc\"\n\n    pb \"demo/grpc/go_python/helloworld\"\n)\n\nconst (\n    address     = \"localhost:50051\"\n    defaultName = \"world\"\n)\n\nfunc main() {\n    // Set up a connection to the server.\n    conn, err := grpc.Dial(address, grpc.WithInsecure())\n    if err != nil {\n        log.Fatalf(\"did not connect: %v\", err)\n    }\n    defer conn.Close()\n    c := pb.NewGreeterClient(conn)\n\n    // Contact the server and print out its response.\n    name := defaultName\n    if len(os.Args) &gt; 1 {\n        name = os.Args[1]\n    }\n    ctx, cancel := context.WithTimeout(context.Background(), time.Second)\n    defer cancel()\n    r, err := c.SayHello(ctx, &amp;pb.HelloRequest{Name: name})\n    if err != nil {\n        log.Fatalf(\"could not greet: %v\", err)\n    }\n    log.Printf(\"Greeting: %s\", r.Message)\n}\n</code></pre>\n\n<ol start=\"5\">\n<li>run the demo</li>\n</ol>\n\n<pre><code>server:\npython helloworld_grpc_server.py\n\nclient:\ngo run main.go\n</code></pre>\n\n<p>But, I get the wrong output for client:</p>\n\n<pre><code>2019/08/07 19:18:03 could not greet: rpc error: code = Unimplemented desc = Method not found!\nexit status 1\n</code></pre>\n\n<p>I expect to the demo work.</p>\n"}, {"tags": ["go", "error-handling"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1565173727, "post_id": 57392158, "comment_id": 101266486, "body": "&quot;Is there any approach to make it without [...] after each line?&quot; No."}, {"owner": {"reputation": 5883, "user_id": 5411888, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vLbdS.jpg?s=128&g=1", "display_name": "Amit Upadhyay", "link": "https://stackoverflow.com/users/5411888/amit-upadhyay"}, "edited": false, "score": 0, "creation_date": 1565173845, "post_id": 57392158, "comment_id": 101266554, "body": "to make code cleaner, you can abstract the error check part in a function and just call them to parse."}, {"owner": {"reputation": 900, "user_id": 2761930, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c838e9dc1d38f75c5c559078f242e493?s=128&d=identicon&r=PG&f=1", "display_name": "kuba_ceg", "link": "https://stackoverflow.com/users/2761930/kuba-ceg"}, "edited": false, "score": 0, "creation_date": 1570315263, "post_id": 57392158, "comment_id": 102875878, "body": "So there was such possibility (sscanf). IMHO thread with errors handling techniques is only related to my question, not duplicated."}], "answers": [{"comments": [{"owner": {"reputation": 900, "user_id": 2761930, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c838e9dc1d38f75c5c559078f242e493?s=128&d=identicon&r=PG&f=1", "display_name": "kuba_ceg", "link": "https://stackoverflow.com/users/2761930/kuba-ceg"}, "edited": false, "score": 0, "creation_date": 1565181002, "post_id": 57392376, "comment_id": 101270562, "body": "Sscanf works great, draft looks really promising, thanks for sharing"}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 1, "last_activity_date": 1565181589, "last_edit_date": 1565181589, "creation_date": 1565173917, "answer_id": 57392376, "question_id": 57392158, "link": "https://stackoverflow.com/questions/57392158/parsing-strings-into-different-types-with-common-error-message-in-go/57392376#57392376", "title": "Parsing strings into different types with common error message in GO", "body": "<p>You can use fmt.Sscanf do do this with one error check:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var i int\n    var j float64\n    var k int\n    if _, err := fmt.Sscanf(\"1,3.14,5\", \"%d,%f,%d\", &amp;i, &amp;j, &amp;k); err != nil {\n        panic(err)\n    }\n    fmt.Println(i, j, k)\n}\n</code></pre>\n\n<p>You'll need to join the lines with some separator but that's trivial. </p>\n\n<p>Also, there's a discussion about making handling of multiple errors nicer for Go 2, I'm not sure what the status of it is at the moment, but you can read about it here: <a href=\"https://go.googlesource.com/proposal/+/master/design/go2draft-error-handling-overview.md\" rel=\"nofollow noreferrer\">https://go.googlesource.com/proposal/+/master/design/go2draft-error-handling-overview.md</a></p>\n"}], "owner": {"reputation": 900, "user_id": 2761930, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c838e9dc1d38f75c5c559078f242e493?s=128&d=identicon&r=PG&f=1", "display_name": "kuba_ceg", "link": "https://stackoverflow.com/users/2761930/kuba-ceg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "closed_date": 1565174015, "accepted_answer_id": 57392376, "answer_count": 1, "score": -2, "last_activity_date": 1565181589, "creation_date": 1565173204, "last_edit_date": 1565179718, "question_id": 57392158, "link": "https://stackoverflow.com/questions/57392158/parsing-strings-into-different-types-with-common-error-message-in-go", "closed_reason": "Duplicate", "title": "Parsing strings into different types with common error message in GO", "body": "<p>I want parse <code>[]string</code> values into particular types (e.g. int, float etc), so I must use different parse functions for different lines. My code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>value, err := strconv.Atoi(line[1])\nvalue1, err := strconv.ParseFloat(line[4], 6)\nvalue2, err := strconv.ParseFloat(line[5], 6)\nvalue3, err := strconv.Atoi(line[2])\n</code></pre>\n\n<p>I must be sure that every value was parsed so for every value I must have <code>err != nil</code>. Is there any approach to make it with one common error without </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if err != nil {\n return \n}\n</code></pre>\n\n<p>after each line?</p>\n"}, {"tags": ["arrays", "go", "initialization"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1565171963, "post_id": 57391251, "comment_id": 101265501, "body": "The only way is to assign all values to the array upon initialization. This could be an array literal, or the return value from a function, or some other array. The literal is the only way to avoid having to pre-allocate a zero value array, though."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1565172050, "post_id": 57391251, "comment_id": 101265551, "body": "I do not understand zeroing, when a variable does not exist (before initialization)."}, {"owner": {"reputation": 641, "user_id": 1393391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e497d39307969b730d29e32eb1ff50a2?s=128&d=identicon&r=PG", "display_name": "martyn", "link": "https://stackoverflow.com/users/1393391/martyn"}, "edited": false, "score": 2, "creation_date": 1565173049, "post_id": 57391251, "comment_id": 101266113, "body": "The zeroing is actually a golang feature (&#39;&#39;the zero value&quot;) and is done for safety reasons; see <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">golang.org/ref/spec#The_zero_value</a>"}, {"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565173064, "post_id": 57391251, "comment_id": 101266120, "body": "@Flimzy That&#39;s what I suspected as well, I guess the performance impact is very small. But how to explain that initializing through a loop inside a function with a named return is faster ?"}, {"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "reply_to_user": {"reputation": 641, "user_id": 1393391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e497d39307969b730d29e32eb1ff50a2?s=128&d=identicon&r=PG", "display_name": "martyn", "link": "https://stackoverflow.com/users/1393391/martyn"}, "edited": false, "score": 0, "creation_date": 1565173913, "post_id": 57391251, "comment_id": 101266590, "body": "@martyn Good point, thanks."}], "answers": [{"tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": false, "score": 2, "last_activity_date": 1565182303, "creation_date": 1565182303, "answer_id": 57394943, "question_id": 57391251, "link": "https://stackoverflow.com/questions/57391251/how-to-initialize-a-long-golang-array-without-zeroing-all-the-values/57394943#57394943", "title": "How to initialize a long Golang array without zeroing all the values?", "body": "<p>You either initialize the array with literals, as you said, or the array will have default, zero values. If you were able to create an array and set its content later, any read access between those two moments would be undefined (like in C).</p>\n\n<p>I agree that it's not practical to use an array literal for a large number of elements though, but that's the price of memory safety :)</p>\n"}, {"comments": [{"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "edited": false, "score": 0, "creation_date": 1565230631, "post_id": 57395364, "comment_id": 101290101, "body": "I did not expect that even allocating the memory would not be linear, but I do not know how it&#39;s done. Copying should be linear though. The cache assignment is not very practical in the general case, but it&#39;s great as a benchmark as it should be optimal."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1565184838, "last_edit_date": 1565184838, "creation_date": 1565183684, "answer_id": 57395364, "question_id": 57391251, "link": "https://stackoverflow.com/questions/57391251/how-to-initialize-a-long-golang-array-without-zeroing-all-the-values/57395364#57395364", "title": "How to initialize a long Golang array without zeroing all the values?", "body": "<p>The reason why your results are not linear with the array size is because not all operations involved in obtaining a new filled array are linear with the array size. For example you need memory allocation, optionally zeroing the allocated memory, a loop to fill the array, and you have to return (copy) the array's memory. Allocation is a good example which should not be linear with the size, also, copying memory should also not be linear (should increase, but not linearly).</p>\n\n<p>One way to avoid a lengthy composite literal and asking a new array value that needs to be zeroed which afterwards gets filled is to have the value ready, and just assign it to the array variable.</p>\n\n<p>What I mean by this is have a package-level variable store the computed / filled array (simplest filled with a simple loop), and when you need a new array filled the same, just assign the stored value:</p>\n\n<pre><code>var cache [N]int\n\nfunc init() {\n    for i := range cache {\n        cache[i] = i\n    }\n}\n\n// If you now need a new array:\nvar result = cache\n// Or re-init an existing array:\nresult = cache\n</code></pre>\n\n<p>If you add this to your benchmarks:</p>\n\n<pre><code>func BenchmarkArrayAssign(b *testing.B) {\n    var r [N]int\n    for n := 0; n &lt; b.N; n++ {\n        r = cache\n    }\n    result = r\n}\n</code></pre>\n\n<p>Or simply:</p>\n\n<pre><code>func BenchmarkArrayAssign(b *testing.B) {\n    for n := 0; n &lt; b.N; n++ {\n        result = cache\n    }\n}\n</code></pre>\n\n<p>This will outperform your fastest-so-far <code>ArrayLoopNamedReturn</code> <strong>by twice</strong> (when <code>N = 1_000_000</code>).</p>\n\n<pre><code>BenchmarkArrayAssign-4                  1000       1104829 ns/op\nBenchmarkArrayLoop-4                     500       3822005 ns/op\nBenchmarkArrayLoopNamedReturn-4          500       2326498 ns/op\n</code></pre>\n"}], "owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1511, "favorite_count": 0, "accepted_answer_id": 57395364, "answer_count": 2, "score": -2, "last_activity_date": 1565184838, "creation_date": 1565170370, "last_edit_date": 1565183795, "question_id": 57391251, "link": "https://stackoverflow.com/questions/57391251/how-to-initialize-a-long-golang-array-without-zeroing-all-the-values", "title": "How to initialize a long Golang array without zeroing all the values?", "body": "<p>When creating an array in Go, it seems the array will always be zeroed, even if different values will be set right after the initialization, for example when the value should be set to the index in the array.</p>\n\n<p>One way to avoid this is to use array literals, such as <code>a = [5]int{0,1,2,3,4}</code>, but it becomes impractical for long arrays. I'm wondering what is the best way to perform the initialization.</p>\n\n<p>Surprisingly, the named return function outperforms the composite literal initialization for large arrays.</p>\n\n<p>I've created the following benchmark to compare the performance:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"testing\"\n\nconst N = 1000000\n\nvar result [N]int\n\nfunc arrayLiteral() [N]int {\n    // Replace the 3 dots with the actual value\n    // I copy-pasted the output of an other program to do this\n    return [N]int{0,1,2,3,...,N-1}\n}\n\nfunc arrayLoopNamedReturn() (a [N]int) {\n    for i := 0; i &lt; N; i++ {\n        a[i] = i\n    }\n    return\n}\n\nfunc arrayLoop() [N]int {\n    var a [N]int\n    for i := 0; i &lt; N; i++ {\n        a[i] = i\n    }\n    return a\n}\n\nfunc BenchmarkArrayLoop(b *testing.B) {\n    var r [N]int\n    for n := 0; n &lt; b.N; n++ {\n        r = arrayLoop()\n    }\n    result = r\n}\n\nfunc BenchmarkArrayLoopNamedReturn(b *testing.B) {\n    var r [N]int\n    for n := 0; n &lt; b.N; n++ {\n        r = arrayLoopNamedReturn()\n    }\n    result = r\n}\n\nfunc BenchmarkArrayLiteral(b *testing.B) {\n    var r [N]int\n    for n := 0; n &lt; b.N; n++ {\n        r = arrayLiteral()\n    }\n    result = r\n}\n\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>N = 10,000\nBenchmarkArrayLoop-8                      200000              9041 ns/op\nBenchmarkArrayLoopNamedReturn-8           200000              6327 ns/op\nBenchmarkArrayLiteral-8                   300000              4300 ns/op\n\nN = 100,000\nBenchmarkArrayLoop-8                       10000            191582 ns/op\nBenchmarkArrayLoopNamedReturn-8            20000             76125 ns/op\nBenchmarkArrayLiteral-8                    20000             62714 ns/op\n\nN = 1,000,000\nBenchmarkArrayLoop-8                         500           2635713 ns/op\nBenchmarkArrayLoopNamedReturn-8             1000           1537282 ns/op\nBenchmarkArrayLiteral-8                     1000           1854348 ns/op\n</code></pre>\n\n<p>Observations:</p>\n\n<ol>\n<li><p>I did not expect that naming the return value would make a difference for the loop, I thought surely the compiler would do some optimization. For 1,000,000, it becomes faster than the literal initialization.</p></li>\n<li><p>I expected a linear scaling, I do not understand why it is not the case, for either of the methods.</p></li>\n</ol>\n\n<p>I'm not sure how to explain this, even though it seems to be extremely basic. Any ideas ?</p>\n\n<p>Edit: There is an <a href=\"https://github.com/golang/go/issues/20859\" rel=\"nofollow noreferrer\">open issue on Github</a> complaining that naming the return value should not make a difference. I also found this to be a surprising behavior.</p>\n"}, {"tags": ["go", "reflect", "go-structtag"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1565166539, "post_id": 57390025, "comment_id": 101262532, "body": "Nope. You have to use a <code>for</code> loop and find it yourself."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1565169703, "post_id": 57390025, "comment_id": 101264287, "body": "Which you can put in a function, and now you have the function you&#39;re looking for..."}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 2, "last_activity_date": 1565272862, "creation_date": 1565272862, "answer_id": 57414412, "question_id": 57390025, "link": "https://stackoverflow.com/questions/57390025/go-reflect-find-by-structtag/57414412#57414412", "title": "go reflect find by structtag", "body": "<p>There is no built-in method/function to do this. The existing <code>FieldBy*</code> methods in <code>reflect</code> are implemented as loops (see `src/reflect/type.go). You can also write a loop to implement what you need here. One approach could be something like:</p>\n\n<pre><code>func fieldByTag(s interface{}, tagKey, tagValue string) (reflect.StructField, bool) {\n    rt := reflect.TypeOf(s)\n    for i := 0; i &lt; rt.NumField(); i++ {\n        field := rt.Field(i)\n        if field.Tag.Get(tagKey) == tagValue {\n            return field, true\n        }\n    }\n    return reflect.StructField{}, false\n}\n</code></pre>\n\n<p>Note that <code>tagKey</code> and <code>tagValue</code> are passed separately because that's how <code>reflect.StructField</code> works. So in your case you'd call it like this:</p>\n\n<pre><code>field, ok := fieldByTag(&amp;ns, \"json\", \"name\")\n</code></pre>\n"}], "owner": {"reputation": 330, "user_id": 6210299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76a7d3002d23c30c640ac2a92ad7bbe9?s=128&d=identicon&r=PG&f=1", "display_name": "curtank", "link": "https://stackoverflow.com/users/6210299/curtank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 57414412, "answer_count": 1, "score": -1, "last_activity_date": 1565272862, "creation_date": 1565166352, "question_id": 57390025, "link": "https://stackoverflow.com/questions/57390025/go-reflect-find-by-structtag", "title": "go reflect find by structtag", "body": "<pre class=\"lang-golang prettyprint-override\"><code>type A struct {\n    Name *NameS `json:\"name\"`\n}\n</code></pre>\n\n<p>for a struct A,is there a method in reflect that I can find a field by structtag\nlike </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>reflect.ValueOf(&amp;ns)\n// struct\ns := ps.Elem()\ns.FieldByTag(\"name\")\n</code></pre>\n"}, {"tags": ["android", "go", "bitrise"], "answers": [{"tags": [], "owner": {"reputation": 969, "user_id": 5849894, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-KhI7TeKIysI/AAAAAAAAAAI/AAAAAAAAADQ/mUXg9xyptis/photo.jpg?sz=128", "display_name": "odiggity", "link": "https://stackoverflow.com/users/5849894/odiggity"}, "is_accepted": false, "score": 2, "last_activity_date": 1565168550, "creation_date": 1565168550, "answer_id": 57390678, "question_id": 57389940, "link": "https://stackoverflow.com/questions/57389940/flank-bitrise-step-failing-because-it-cant-find-results-directory/57390678#57390678", "title": "Flank Bitrise step failing because it can&#39;t find results directory", "body": "<p>Ah, found it. Turns out you need to set the <code>local-results-dir</code> in the flank.yml to <code>results</code> to match what the Bitrise step expects. In the flank.yml on the github page it defaults to 'flank'</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>## Local folder to store the test result. Folder is DELETED before each run to ensure only artifacts from the new run are saved.\r\n local-result-dir: results</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}], "owner": {"reputation": 969, "user_id": 5849894, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-KhI7TeKIysI/AAAAAAAAAAI/AAAAAAAAADQ/mUXg9xyptis/photo.jpg?sz=128", "display_name": "odiggity", "link": "https://stackoverflow.com/users/5849894/odiggity"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1565168550, "creation_date": 1565166059, "question_id": 57389940, "link": "https://stackoverflow.com/questions/57389940/flank-bitrise-step-failing-because-it-cant-find-results-directory", "title": "Flank Bitrise step failing because it can&#39;t find results directory", "body": "<p>I'm trying to get the Flank Bitrise step to work however it's failing at the very end after running all the tests with the error <code>Failed to export artifacts, error: open ./results: no such file or directory</code>. </p>\n\n<p>I've tried investigate the Go code in the step (located <a href=\"https://github.com/bitrise-steplib/bitrise-step-flank/blob/master/main.go\" rel=\"nofollow noreferrer\">here</a>) to try and understand where the directory is supposed to be created, but I haven't been able to figure it out. </p>\n\n<p>If I run Flank locally everything runs fine. </p>\n\n<p>Here's the full output for the step: </p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>------------------------------------------------------------------------------+\r\n\r\n| (4) flank@0.1.0                                                              |\r\n+------------------------------------------------------------------------------+\r\n| id: flank                                                                    |\r\n| version: 0.1.0                                                               |\r\n| collection: https://github.com/bitrise-io/bitrise-steplib.git                |\r\n| toolkit: go                                                                  |\r\n| time: 2019-08-07T01:57:04Z                                                   |\r\n+------------------------------------------------------------------------------+\r\n|                                                                              |\r\nConfig:\r\n- ServiceAccountJSON: *****\r\n- ConfigPath: android/flank.yml\r\n- Version: latest\r\n- CommandFlags: \r\nDownloading binary\r\n- Done\r\nRunning test\r\n- Detected platform: android\r\n$ java \"-jar\" \"/tmp/flank-bin214923599/flank.jar\" \"android\" \"run\" \"-c\" \"android/flank.yml\"\r\nAndroidArgs\r\n    gcloud:\r\n      results-bucket: test-lab-c3at6r97r91bu-jwmcsninvtajk\r\n      results-dir: null\r\n      record-video: true\r\n      timeout: 15m\r\n      async: false\r\n      results-history-name: null\r\n      # Android gcloud\r\n      app: /bitrise/deploy/app-debug.apk\r\n      test: /bitrise/deploy/app-debug-androidTest.apk\r\n      auto-google-login: true\r\n      use-orchestrator: true\r\n      directories-to-pull:\r\n      performance-metrics: true\r\n      test-runner-class: null\r\n      test-targets:\r\n      device:\r\n        - model: Nexus5X\r\n          version: 26\r\n          locale: en\r\n          orientation: portrait\r\n      flaky-test-attempts: 0\r\n    flank:\r\n      max-test-shards: 4\r\n      shard-time: -1\r\n      repeat-tests: 1\r\n      smart-flank-gcs-path: \r\n      smart-flank-disable-upload: false\r\n      files-to-download:\r\n      test-targets-always-run:\r\n      disable-sharding: false\r\n      project: android-app-248901\r\n      local-result-dir: flank\r\n      # Android Flank Yml\r\n      additional-app-test-apks:\r\nRunTests\r\n  Uploading app-debug-androidTest.apk .  Uploading app-debug.apk .\r\n  Smart Flank cache hit: 0% (0 / 33)\r\n  Shard times: 80s, 80s, 80s, 90s\r\n  33 tests / 4 shards\r\n  4 matrix ids created in 0m 3s\r\n  https://console.developers.google.com/storage/browser/test-lab-c3at6r97r91bu-jwmcsninvtajk/2019-08-07_01-57-10.546000_hAvO/\r\nPollMatrices\r\n  0m  0s matrix-q7z6s7e7ji13a Nexus5X-26 VALIDATING\r\n  0m 15s matrix-q7z6s7e7ji13a Nexus5X-26 PENDING\r\n  0m 45s matrix-q7z6s7e7ji13a Nexus5X-26 Starting attempt 1.\r\n  0m 45s matrix-q7z6s7e7ji13a Nexus5X-26 RUNNING\r\n  1m 45s matrix-q7z6s7e7ji13a Nexus5X-26 Started logcat recording.\r\n  1m 45s matrix-q7z6s7e7ji13a Nexus5X-26 Preparing device.\r\n  2m 15s matrix-q7z6s7e7ji13a Nexus5X-26 Logging in to Google account on device.\r\n  2m 15s matrix-q7z6s7e7ji13a Nexus5X-26 Installing apps.\r\n  2m 30s matrix-q7z6s7e7ji13a Nexus5X-26 Retrieving Pre-Test Package Stats information from the device.\r\n  2m 30s matrix-q7z6s7e7ji13a Nexus5X-26 Retrieving Performance Environment information from the device.\r\n  2m 30s matrix-q7z6s7e7ji13a Nexus5X-26 Started crash detection.\r\n  2m 30s matrix-q7z6s7e7ji13a Nexus5X-26 Started crash monitoring.\r\n  2m 30s matrix-q7z6s7e7ji13a Nexus5X-26 Started performance monitoring.\r\n  2m 45s matrix-q7z6s7e7ji13a Nexus5X-26 Started video recording.\r\n  2m 45s matrix-q7z6s7e7ji13a Nexus5X-26 Starting instrumentation test.\r\n  6m 31s matrix-q7z6s7e7ji13a Nexus5X-26 Completed instrumentation test.\r\n  6m 46s matrix-q7z6s7e7ji13a Nexus5X-26 Stopped performance monitoring.\r\n  7m 16s matrix-q7z6s7e7ji13a Nexus5X-26 Stopped crash monitoring.\r\n  7m 16s matrix-q7z6s7e7ji13a Nexus5X-26 Retrieving Post-test Package Stats information from the device.\r\n  7m 16s matrix-q7z6s7e7ji13a Nexus5X-26 Stopped logcat recording.\r\n  7m 16s matrix-q7z6s7e7ji13a Nexus5X-26 Logging out of Google account on device.\r\n  7m 16s matrix-q7z6s7e7ji13a Nexus5X-26 Done. Test time = 239 (secs)\r\n  7m 16s matrix-q7z6s7e7ji13a Nexus5X-26 Starting results processing. Attempt: 1\r\n  7m 31s matrix-q7z6s7e7ji13a Nexus5X-26 Completed results processing. Time taken = 12 (secs)\r\n  7m 31s matrix-q7z6s7e7ji13a Nexus5X-26 FINISHED\r\n  7m 31s matrix-q7z6s7e7ji13a FINISHED\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Starting attempt 1.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Started logcat recording.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Preparing device.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Logging in to Google account on device.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Installing apps.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Retrieving Pre-Test Package Stats information from the device.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Retrieving Performance Environment information from the device.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Started crash detection.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Started crash monitoring.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Started performance monitoring.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Started video recording.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Starting instrumentation test.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Completed instrumentation test.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Stopped performance monitoring.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Stopped crash monitoring.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Stopped logcat recording.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Retrieving Post-test Package Stats information from the device.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Logging out of Google account on device.\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Done. Test time = 249 (secs)\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Starting results processing. Attempt: 1\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 Completed results processing. Time taken = 11 (secs)\r\n  7m 32s matrix-2ay0yj5na36d8 Nexus5X-26 FINISHED\r\n  7m 32s matrix-2ay0yj5na36d8 FINISHED\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Starting attempt 1.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Started logcat recording.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Preparing device.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Logging in to Google account on device.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Installing apps.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Retrieving Pre-Test Package Stats information from the device.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Retrieving Performance Environment information from the device.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Started crash detection.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Started crash monitoring.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Started performance monitoring.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Started video recording.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Starting instrumentation test.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Completed instrumentation test.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Stopped performance monitoring.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Stopped crash monitoring.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Stopped logcat recording.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Retrieving Post-test Package Stats information from the device.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Logging out of Google account on device.\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Done. Test time = 248 (secs)\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 Starting results processing. Attempt: 1\r\n  7m 32s matrix-83si0hz9imz4a Nexus5X-26 RUNNING\r\n  7m 47s matrix-83si0hz9imz4a Nexus5X-26 Completed results processing. Time taken = 12 (secs)\r\n  7m 47s matrix-83si0hz9imz4a Nexus5X-26 FINISHED\r\n  7m 47s matrix-83si0hz9imz4a FINISHED\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Starting attempt 1.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Started logcat recording.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Preparing device.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Logging in to Google account on device.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Installing apps.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Retrieving Pre-Test Package Stats information from the device.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Retrieving Performance Environment information from the device.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Started crash detection.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Started performance monitoring.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Started crash monitoring.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Started video recording.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Starting instrumentation test.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Completed instrumentation test.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Stopped performance monitoring.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Stopped crash monitoring.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Retrieving Post-test Package Stats information from the device.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Stopped logcat recording.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Logging out of Google account on device.\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Done. Test time = 255 (secs)\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 Starting results processing. Attempt: 1\r\n  7m 47s matrix-2cwsozznj0yn3 Nexus5X-26 RUNNING\r\n  9m 17s matrix-2cwsozznj0yn3 Nexus5X-26 Completed results processing. Time taken = 105 (secs)\r\n  9m 17s matrix-2cwsozznj0yn3 Nexus5X-26 FINISHED\r\n  9m 17s matrix-2cwsozznj0yn3 FINISHED\r\nFetchArtifacts\r\n  ....\r\n  Updating matrix file\r\nCostReport\r\n  Virtual devices\r\n    $0.32 for 19m\r\nMatrixResultsReport\r\n  4 / 4 (100.00%)\r\nExporting artifacts\r\nFailed to export artifacts, error: open ./results: no such file or directory\r\n|                                                                              |\r\n+---+---------------------------------------------------------------+----------+\r\n| x | flank@0.1.0 (exit code: 1)                                    | 570 sec  |\r\n+---+---------------------------------------------------------------+----------+\r\n| Issue tracker: https://github.com/bitrise-steplib/bitrise-step-flank/issues  |\r\n| Source: https://github.com/bitrise-steplib/bitrise-step-flank                |\r\n+---+---------------------------------------------------------------+----------+</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": ["mysql", "docker", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565165772, "post_id": 57389784, "comment_id": 101262148, "body": "What do the container logs say?"}, {"owner": {"reputation": 15564, "user_id": 6394722, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/117654f31d6ad5c9b2b0e00dcf4b24f3?s=128&d=identicon&r=PG&f=1", "display_name": "atline", "link": "https://stackoverflow.com/users/6394722/atline"}, "edited": false, "score": 1, "creation_date": 1565166270, "post_id": 57389784, "comment_id": 101262407, "body": "Last time I got <code>reading initial communication packet</code>, it&#39;s firewall issue on database server, my company IT enable hardware firewall at that time."}, {"owner": {"reputation": 11, "user_id": 11894174, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad1992e43d957b3d565fa82732193efd?s=128&d=identicon&r=PG&f=1", "display_name": "John Reese", "link": "https://stackoverflow.com/users/11894174/john-reese"}, "reply_to_user": {"reputation": 15564, "user_id": 6394722, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/117654f31d6ad5c9b2b0e00dcf4b24f3?s=128&d=identicon&r=PG&f=1", "display_name": "atline", "link": "https://stackoverflow.com/users/6394722/atline"}, "edited": false, "score": 0, "creation_date": 1565166683, "post_id": 57389784, "comment_id": 101262600, "body": "@atline Edited the question. I can access the remote database from my local machine. Can it still be a firewall issue?"}, {"owner": {"reputation": 15564, "user_id": 6394722, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/117654f31d6ad5c9b2b0e00dcf4b24f3?s=128&d=identicon&r=PG&f=1", "display_name": "atline", "link": "https://stackoverflow.com/users/6394722/atline"}, "edited": false, "score": 0, "creation_date": 1565167012, "post_id": 57389784, "comment_id": 101262782, "body": "I suggest you do next experiments to narrow down issue: 1) from container visit another mysql container which in the same network namespace 2) from container visit a mysql container which on the docker host 3) from container visit another external mysql service. Such kinds of problem I guess really not easy to find root cause if not make experiments..."}], "owner": {"reputation": 11, "user_id": 11894174, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad1992e43d957b3d565fa82732193efd?s=128&d=identicon&r=PG&f=1", "display_name": "John Reese", "link": "https://stackoverflow.com/users/11894174/john-reese"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1565166633, "creation_date": 1565165504, "last_edit_date": 1592644375, "question_id": 57389784, "link": "https://stackoverflow.com/questions/57389784/error-while-connecting-to-remote-database-server-from-container", "title": "Error while connecting to remote database server from container", "body": "<p>I have a service deployed in mesos, which queries a remote database server. I used <a href=\"http://github.com/go-sql-driver/mysql\" rel=\"nofollow noreferrer\"><code>github.com/go-sql-driver/mysql</code></a> to query the database from my Go code. It was working fine for about a week. But today I got this error: <code>driver: bad connection</code></p>\n<p>So I entered the docker container where my service runs and type in command line:</p>\n<pre><code>mysql -uxxx -hx.x.x.x -Pxxx -Dxxx -pxxx\n</code></pre>\n<p>Here's the response:</p>\n<pre><code>ERROR 2013 (HY000): Lost connection to MySQL server at 'reading initial communication packet', system error: 0\n</code></pre>\n<p>This is the content of /etc/mysql/my.cnf file:</p>\n<pre><code>[mysql]\nno-auto-rehash  # Faster start of mysql but no tab completition\n</code></pre>\n<p>What can be the error here? And how can I solve this?</p>\n<p>Edit: When I run the same command from my local machine it works fine. I can query the database from the command line of my pc.</p>\n"}, {"tags": ["go", "pointers", "reflection", "interface"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 11893875, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-x9rQpqPb0z4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfm1lHz7jSnqjIBAsiE46HrsAtt-Q/photo.jpg?sz=128", "display_name": "stevenh6140", "link": "https://stackoverflow.com/users/11893875/stevenh6140"}, "edited": false, "score": 0, "creation_date": 1565163202, "post_id": 57388715, "comment_id": 101260954, "body": "It seems to me that the Value returned by reflect.ValueOf() is like the file header containing all necessary metadata, while the Value returned by Value.Elem() is the actual file body?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 35, "user_id": 11893875, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-x9rQpqPb0z4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfm1lHz7jSnqjIBAsiE46HrsAtt-Q/photo.jpg?sz=128", "display_name": "stevenh6140", "link": "https://stackoverflow.com/users/11893875/stevenh6140"}, "edited": false, "score": 0, "creation_date": 1565163483, "post_id": 57388715, "comment_id": 101261112, "body": "@stevenh6140 No, not really. In my first example I have an <code>i</code> variable of <code>int</code> type, and a <code>p</code> variable of pointer to <code>int</code> type, pointing to <code>i</code>. If you call <code>Elem()</code> on <code>p</code>&#39;s <code>reflect.Value</code>, you get a <code>reflect.Value</code>, something you would have gotten if you&#39;d call <code>reflect.ValueOf()</code> on <code>i</code> in the first place."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1565186619, "last_edit_date": 1565186619, "creation_date": 1565161593, "answer_id": 57388715, "question_id": 57388657, "link": "https://stackoverflow.com/questions/57388657/what-is-the-difference-between-reflect-valueof-and-value-elem-in-go/57388715#57388715", "title": "What is the difference between reflect.ValueOf() and Value.Elem() in go?", "body": "<p><a href=\"https://golang.org/pkg/reflect/#ValueOf\" rel=\"noreferrer\"><code>reflect.ValueOf()</code></a> is a <em>function</em>, think of it as the entry point to reflection. When you have a \"non-reflection\" value, such as a <code>string</code> or <code>int</code>, you can use <code>reflect.ValueOf()</code> to get a <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"noreferrer\"><code>reflect.Value</code></a> descriptor of it.</p>\n\n<p><a href=\"https://golang.org/pkg/reflect/#Value.Elem\" rel=\"noreferrer\"><code>Value.Elem()</code></a> is a <em>method</em> of <code>reflect.Value</code>. So you can only use this if you already have a <code>reflect.Value</code>. You may use <code>Value.Elem()</code> to get the value (<code>reflect.Value</code>) pointed by the value wrapped by the original <code>reflect.Value</code>. Note that you may also use <a href=\"https://golang.org/pkg/reflect/#Indirect\" rel=\"noreferrer\"><code>reflect.Indirect()</code></a> for this. There's another \"use case\" for <code>Value.Elem()</code>, but it's more \"advanced\", we return to it at the end of the answer.</p>\n\n<p>To \"leave\" reflection, you may use the general <a href=\"https://golang.org/pkg/reflect/#Value.Interface\" rel=\"noreferrer\"><code>Value.Interface()</code></a> method, which returns you the wrapped value as an <code>interface{}</code>.</p>\n\n<p>For example:</p>\n\n<pre><code>var i int = 3\nvar p *int = &amp;i\nfmt.Println(p, i)\n\nv := reflect.ValueOf(p)\nfmt.Println(v.Interface()) // This is the p pointer\n\nv2 := v.Elem()\nfmt.Println(v2.Interface()) // This is i's value: 3\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/Qpb0OMLEros\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0x414020 3\n0x414020\n3\n</code></pre>\n\n<p>For a great introduction to Go's reflection, read <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"noreferrer\">The Go Blog: The Laws of Reflection</a>. Although if you're just starting with Go, I'd focus on other things and leave reflection for a later adventure.</p>\n\n<h2>Another use case for <code>Value.Elem()</code></h2>\n\n<p><em>This is kind of an advanced topic, so don't freak out if you don't understand it. You don't need to.</em></p>\n\n<p>We saw how <code>Value.Elem()</code> can be used to \"navigate\" when a pointer is wrapped in the <code>reflect.Value</code>. Doc of <code>Value.Elem()</code> says:</p>\n\n<blockquote>\n  <p>Elem returns the value that the interface v contains or that the pointer v points to.</p>\n</blockquote>\n\n<p>So if <code>reflect.Value</code> wraps an interface value, <code>Value.Elem()</code> may also be used to get the concrete value wrapped in that interface value.</p>\n\n<p>Interfaces in Go is its own topic, for the internals, you may read <a href=\"https://research.swtch.com/interfaces\" rel=\"noreferrer\">Go Data Structures: Interfaces</a> by Russ Cox. Again, not necessarily a topic for Go starters.</p>\n\n<p>Basically whatever value you pass to <code>reflect.ValueOf()</code>, if it's not already an interface value, it will be wrapped in an <code>interface{}</code> implicitly. If the passed value is already an interface value, then the concrete value stored in it will be passed as a <code>interface{}</code>. This second \"use case\" surfaces if you pass a pointer to interface (which is otherwise very rare in Go!).</p>\n\n<p>So if you pass a pointer to interface, this pointer will be wrapped in an <code>interface{}</code> value. You may use <code>Value.Elem()</code> to get the pointed value, which will be an interface value (not a concrete value), and using <code>Value.Elem()</code> <em>again</em> on this will give you the concrete value.</p>\n\n<p>This example illustrates it:</p>\n\n<pre><code>var r io.Reader = os.Stdin // os.Stdin is of type *os.File which implements io.Reader\n\nv := reflect.ValueOf(r) // r is interface wrapping *os.File value\nfmt.Println(v.Type())   // *os.File\n\nv2 := reflect.ValueOf(&amp;r)            // pointer passed, will be wrapped in interface{}\nfmt.Println(v2.Type())               // *io.Reader\nfmt.Println(v2.Elem().Type())        // navigate to pointed: io.Reader (interface type)\nfmt.Println(v2.Elem().Elem().Type()) // 2nd Elem(): get concrete value in interface: *os.File\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/JeJV-4Ij5u-\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 35, "user_id": 11893875, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-x9rQpqPb0z4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfm1lHz7jSnqjIBAsiE46HrsAtt-Q/photo.jpg?sz=128", "display_name": "stevenh6140", "link": "https://stackoverflow.com/users/11893875/stevenh6140"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4052, "favorite_count": 3, "accepted_answer_id": 57388715, "answer_count": 1, "score": 0, "last_activity_date": 1600349135, "creation_date": 1565161336, "last_edit_date": 1600349135, "question_id": 57388657, "link": "https://stackoverflow.com/questions/57388657/what-is-the-difference-between-reflect-valueof-and-value-elem-in-go", "title": "What is the difference between reflect.ValueOf() and Value.Elem() in go?", "body": "<p>I started learning golang a couple of days ago and found <a href=\"https://golang.org/pkg/reflect/#ValueOf\" rel=\"nofollow noreferrer\">reflect.Valueof()</a> and <a href=\"https://golang.org/pkg/reflect/#Value.Elem\" rel=\"nofollow noreferrer\">Value.Elem()</a> quite confusing. What is the difference between this two function/methods and how to use them correctly?</p>\n<p>Both function/methods return a Value, and according to the go doc</p>\n<blockquote>\n<p>ValueOf returns a new Value initialized to the concrete value stored in the interface i. ValueOf(nil) returns the zero Value.</p>\n<p>Elem returns the value that the interface v contains or that the pointer v points to. It panics if v's Kind is not Interface or Ptr. It returns the zero Value if v is nil.</p>\n</blockquote>\n<p>I found this code from a post on stackoverflow but still don't understand when to use .Elem()</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func SetField(obj interface{}, name string, value interface{}) error {\n    \n    // won't work if I remove .Elem()\n    structValue := reflect.ValueOf(obj).Elem()\n    \n    structFieldValue := structValue.FieldByName(name)\n\n    if !structFieldValue.IsValid() {\n        return fmt.Errorf(&quot;No such field: %s in obj&quot;, name)\n    }\n\n    if !structFieldValue.CanSet() {\n        return fmt.Errorf(&quot;Cannot set %s field value&quot;, name)\n    }\n\n    structFieldType := structFieldValue.Type()\n\n    // won't work either if I add .Elem() to the end\n    val := reflect.ValueOf(value)\n    if structFieldType != val.Type() {\n\n        return fmt.Errorf(&quot;Provided value %v type %v didn't match obj field type %v&quot;,val,val.Type(),structFieldType)\n    }\n\n    structFieldValue.Set(val)\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565143495, "post_id": 57386054, "comment_id": 101255737, "body": "The expression <code>(*DefaultHandler)()</code> is not valid Go code."}, {"owner": {"reputation": 5964, "user_id": 1861935, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/95fef3ac81d23fcdf3a11e17d671a61e?s=128&d=identicon&r=PG", "display_name": "LiangWang", "link": "https://stackoverflow.com/users/1861935/liangwang"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565144152, "post_id": 57386054, "comment_id": 101255845, "body": "@CeriseLim&#243;n yes. It makes sense to use <code>&amp;DefaultHandler{}</code>, what&#39;s the syntax of (*DefaultHandler)(nil)?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1565145466, "post_id": 57386054, "comment_id": 101256056, "body": "The expression <code>(*DefaultHandler)(nil)</code> is a <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a> from the untyped nil to a nil value of type <code>*DefaultHandler</code>.  The value <code>&amp;DefaultHandler{}</code> can also be used if default handler is a type with composite literal syntax.  The conversion pattern works for all types."}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565146150, "post_id": 57386054, "comment_id": 101256162, "body": "@CeriseLim&#243;n I wonder if this question isn&#39;t really a dupe of the other one. Sounds like @Jacky understands the blank identifier part (which was the point of the other question), and is more asking about the <code>(*DefaultHandler)(nil)</code> syntax."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1565154190, "post_id": 57386054, "comment_id": 101257728, "body": "100% Duplicate."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565177817, "post_id": 57386366, "comment_id": 101268798, "body": "However, in general <code>&amp;SomeType{}</code> will allocate and initialise a new value (unless the compiler detects and optimises it out) where-as <code>(*SomeType)(nil)</code> will never do any allocation."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1565153562, "last_edit_date": 1565153562, "creation_date": 1565146499, "answer_id": 57386366, "question_id": 57386054, "link": "https://stackoverflow.com/questions/57386054/whats-the-meaning-of-defaulthandlernil-where-defaulthandler-is-a-struct/57386366#57386366", "title": "What&#39;s the meaning of (*DefaultHandler)(nil) where DefaultHandler is a struct?", "body": "<p>The expression <code>(*DefaultHandler)(nil)</code> is a <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a> from an untyped nil to a zero value of type <code>*DefaultHandler</code>. </p>\n\n<p>Conversions are of the form <code>T(x)</code> where <code>T</code> is a type and <code>x</code> is a value that can be converted to type <code>T</code>. In this example, <code>T</code> is <code>*DefaultHandler</code> and <code>x</code> is <code>nil</code>.   The parenthesis around <code>*DefaultHandler</code> are required to distinguish the conversion to a pointer type from a dereference of a a conversion to the non-pointer type. </p>\n\n<p>The expression <code>(*DefaultHandler)()</code> is not valid Go syntax.</p>\n\n<p>The value <code>&amp;DefaultHandler{}</code> can also be used if <code>DefaultHandler</code> is a type with composite literal syntax. The conversion pattern works for all types.</p>\n"}], "owner": {"reputation": 5964, "user_id": 1861935, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/95fef3ac81d23fcdf3a11e17d671a61e?s=128&d=identicon&r=PG", "display_name": "LiangWang", "link": "https://stackoverflow.com/users/1861935/liangwang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "closed_date": 1565186008, "accepted_answer_id": 57386366, "answer_count": 1, "score": -2, "last_activity_date": 1565153562, "creation_date": 1565143289, "last_edit_date": 1565146478, "question_id": 57386054, "link": "https://stackoverflow.com/questions/57386054/whats-the-meaning-of-defaulthandlernil-where-defaulthandler-is-a-struct", "closed_reason": "Duplicate", "title": "What&#39;s the meaning of (*DefaultHandler)(nil) where DefaultHandler is a struct?", "body": "<p>I can understand whole last line of code meaning: It provides a static (compile time) check that <code>*DefaultHandler</code> satisfies the <code>EasygateHandler</code> interface. But I cannot understand what's the meaning of <code>(*DefaultHandler)(nil)</code> and what's the difference with <code>(*DefaultHandler)()</code></p>\n\n<pre><code>type DefaultHandler struct {\n    log logrus.FieldLogger\n    svc *service.DefaultResolver\n}\n\nvar _ easygate.EasygateHandler = (*DefaultHandler)(nil)\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565142530, "post_id": 57385933, "comment_id": 101255572, "body": "Show the code that you tried so far and describe any problems that you had.  If you have not started on this, then see the <a href=\"https://godoc.org/net/http\" rel=\"nofollow noreferrer\">net/http</a> and <a href=\"https://godoc.org/encoding/json\" rel=\"nofollow noreferrer\">encoding/json</a> packages. These packages have everything that you need to solve this problem."}, {"owner": {"reputation": 59, "user_id": 6561508, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/386862f9f268825797bca552b080319d?s=128&d=identicon&r=PG&f=1", "display_name": "dontke", "link": "https://stackoverflow.com/users/6561508/dontke"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565143338, "post_id": 57385933, "comment_id": 101255715, "body": "@CeriseLim&#243;n see edited post"}], "answers": [{"tags": [], "owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "is_accepted": true, "score": 1, "last_activity_date": 1565144350, "creation_date": 1565144350, "answer_id": 57386181, "question_id": 57385933, "link": "https://stackoverflow.com/questions/57385933/need-help-updating-a-json-payload-with-go/57386181#57386181", "title": "Need help updating a JSON payload with Go", "body": "<p>You are almost there, just need to loop over the Library items, updating the status and doing the http put requests.</p>\n\n<p>Something like this should work (not tested):</p>\n\n<pre><code>for _, item := range obj.Library {\n  item.Status = \"disabled\"\n  bs, err := json.Marshal(item)\n  // check err\n  req, err := http.NewRequest(\"PUT\", \"url\", bytes.NewBuffer(bs)) \n  // check err\n  res, err := http.DefaultClient.Do(req)\n  // check err\n  // check res.StatusCode\n}\n</code></pre>\n"}], "owner": {"reputation": 59, "user_id": 6561508, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/386862f9f268825797bca552b080319d?s=128&d=identicon&r=PG&f=1", "display_name": "dontke", "link": "https://stackoverflow.com/users/6561508/dontke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 57386181, "answer_count": 1, "score": -2, "last_activity_date": 1565144350, "creation_date": 1565142173, "last_edit_date": 1565144317, "question_id": 57385933, "link": "https://stackoverflow.com/questions/57385933/need-help-updating-a-json-payload-with-go", "title": "Need help updating a JSON payload with Go", "body": "<p>I am a newbie and trying to create a Golang script that reads from one endpoint then updates some of the fields and posts to a different endpoint. The PUT request to the endpoint has this as a curl command.</p>\n\n<pre><code>curl -v \\\n     -X PUT -H 'X-Api-Key:{Key}' \\\n     -H 'Content-Type: application/json' url/{id} \\\n     -d '{ \"name\" : \"Somename\", \"type\": \"Sometype\", \"status\" : \"enabled\"}'\n</code></pre>\n\n<p>I want to keep the same name and same type from the endpoint that I send the GET request, but I want to change status from enabled to disabled when posting to the other endpoint. So basically whatever results I get from the one endpoint will stay the same except the status that I need to change to disabled. Any example code will assist.</p>\n\n<p>This is the code I have so far but it is just for reading the endpoint. So not sure how to join the two.</p>\n\n<pre><code>func main() {\n   req, _ := http.NewRequest(\"GET\", \"URL\", nil)\n   req.Header.Set(\"X-Api-Key\", &lt;Key&gt;)\n   resp, _ := http.DefaultClient.Do(req)\n\n   defer resp.Body.Close()\n   body, _ := ioutil.ReadAll(resp.Body)\n\n   var obj struct {\n       Library []struct {\n           Name     string `json:\"name\"`\n           Type      string `json:\u201dtype\u201d`\n           Status      string `json:\u201dstatus\"`\n       } `json:\u201dlibrary\"`\n   }\n\n   if err := json.Unmarshal(body, &amp;obj); err != nil {\n       panic(err)\n   }\n   for _, app := range obj.Library {\n       fmt.Println(app.Name, app.Type, app.Status)\n   }\n}\n</code></pre>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1565139406, "post_id": 57385666, "comment_id": 101255050, "body": "<code>defer Db.Close()</code> runs as long as your <code>init</code> function returns."}, {"owner": {"reputation": 1792, "user_id": 3068500, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0cf641fb92b7fd2625f7690aac7f424c?s=128&d=identicon&r=PG&f=1", "display_name": "Gambit2007", "link": "https://stackoverflow.com/users/3068500/gambit2007"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1565139462, "post_id": 57385666, "comment_id": 101255059, "body": "So how should i make sure the DB stays open?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1565139546, "post_id": 57385666, "comment_id": 101255070, "body": "don&#39;t close it?"}], "answers": [{"comments": [{"owner": {"reputation": 1792, "user_id": 3068500, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0cf641fb92b7fd2625f7690aac7f424c?s=128&d=identicon&r=PG&f=1", "display_name": "Gambit2007", "link": "https://stackoverflow.com/users/3068500/gambit2007"}, "edited": false, "score": 0, "creation_date": 1565139634, "post_id": 57385689, "comment_id": 101255078, "body": "Ok, so just our of curiosity - why do many examples include <code>defer db.Close()</code> if it never closes?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 1792, "user_id": 3068500, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0cf641fb92b7fd2625f7690aac7f424c?s=128&d=identicon&r=PG&f=1", "display_name": "Gambit2007", "link": "https://stackoverflow.com/users/3068500/gambit2007"}, "edited": false, "score": 0, "creation_date": 1565139769, "post_id": 57385689, "comment_id": 101255097, "body": "@Gambit2007 in their examples that&#39;s what they explicitly want - to close it."}, {"owner": {"reputation": 332, "user_id": 8778930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d1a2346b21fe5f024d1be413eb2588b?s=128&d=identicon&r=PG&f=1", "display_name": "mewi", "link": "https://stackoverflow.com/users/8778930/mewi"}, "edited": false, "score": 1, "creation_date": 1565140036, "post_id": 57385689, "comment_id": 101255129, "body": "The problem is you&#39;re closing it when init returns, so by the time your query is running it is already closed. You could close it in main but according to the documentation you don&#39;t need to."}], "tags": [], "owner": {"reputation": 332, "user_id": 8778930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d1a2346b21fe5f024d1be413eb2588b?s=128&d=identicon&r=PG&f=1", "display_name": "mewi", "link": "https://stackoverflow.com/users/8778930/mewi"}, "is_accepted": true, "score": 1, "last_activity_date": 1565139578, "creation_date": 1565139578, "answer_id": 57385689, "question_id": 57385666, "link": "https://stackoverflow.com/questions/57385666/cant-connect-to-a-db-database-is-closed/57385689#57385689", "title": "Can&#39;t connect to a DB: database is closed", "body": "<p>From a previously asked question</p>\n\n<blockquote>\n  <p>The returned DB is safe for concurrent use by multiple goroutines and maintains its own pool of idle connections. Thus, the Open function should be called just once. It is rarely necessary to close a DB.</p>\n</blockquote>\n\n<p>Aka, don't close it.</p>\n"}], "owner": {"reputation": 1792, "user_id": 3068500, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0cf641fb92b7fd2625f7690aac7f424c?s=128&d=identicon&r=PG&f=1", "display_name": "Gambit2007", "link": "https://stackoverflow.com/users/3068500/gambit2007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 728, "favorite_count": 0, "accepted_answer_id": 57385689, "answer_count": 1, "score": 1, "last_activity_date": 1565166460, "creation_date": 1565139245, "last_edit_date": 1565166460, "question_id": 57385666, "link": "https://stackoverflow.com/questions/57385666/cant-connect-to-a-db-database-is-closed", "title": "Can&#39;t connect to a DB: database is closed", "body": "<p>I have the following project structure:</p>\n\n<pre><code>-main.go\n-db\n--dbinit.go\n</code></pre>\n\n<p>In <code>dbinit.go</code> i have the following code:</p>\n\n<pre><code>package db\n\nimport (\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nvar Db *sql.DB\nvar err error\n\nfunc init() {\n    Db, err = sql.Open(\"mysql\", \"myDBCreds\")\n    defer Db.Close()\n}\n</code></pre>\n\n<p>and in <code>main.go</code> i have:</p>\n\n<pre><code>package main \n\nimport (\n    db \"./db\"\n)\n\nfunc main() {\n\n    defer db.Db.Close()\n\n        sqlStatement := `INSERT INTO table (field1, field2)\n            VALUES ($1, $2)\n        `\n        _, err := db.Db.Exec(sqlStatement, param1, param2)\n        if err != nil {\n            panic(err)\n        }\n</code></pre>\n\n<p>but <code>main.go</code> keeps throwing an error:</p>\n\n<blockquote>\n  <p>sql: database is closed</p>\n</blockquote>\n\n<p>What am i doing wrong?</p>\n"}, {"tags": ["templates", "go", "command-line-interface"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565186534, "post_id": 57385219, "comment_id": 101274155, "body": "You can&#39;t really, you&#39;ll need to save the variables provided somewhere (e.g. maybe a JSON file alongside the generated files) so that you can re-use them when re-executing the templates. Once the template is executed, there are no variables to preserve - it&#39;s just raw text."}], "answers": [{"tags": [], "owner": {"reputation": 3847, "user_id": 12677, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8892ff21c03d7a54e66d82b717635e74?s=128&d=identicon&r=PG", "display_name": "tovare", "link": "https://stackoverflow.com/users/12677/tovare"}, "is_accepted": true, "score": 0, "last_activity_date": 1565137377, "last_edit_date": 1565137377, "creation_date": 1565137063, "answer_id": 57385451, "question_id": 57385219, "link": "https://stackoverflow.com/questions/57385219/how-to-update-a-go-template-while-still-persisting-the-original-template-variabl/57385451#57385451", "title": "How to update a go template while still persisting the original template variables", "body": "<p>There are several ways to solve this, but this roundtrip will be easier if you generate and read YAML using a module like <a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow noreferrer\">https://github.com/go-yaml/yaml</a> rather than using templates.</p>\n\n<p>Also, this tool will make it easy to make the struct type by example: <a href=\"https://mengzhuo.github.io/yaml-to-go/\" rel=\"nofollow noreferrer\">https://mengzhuo.github.io/yaml-to-go/</a></p>\n\n<p>A different parsing approach is done in <a href=\"https://github.com/spf13/viper\" rel=\"nofollow noreferrer\">https://github.com/spf13/viper</a> which might be more useful if you allow fields you don\u00b4t know.</p>\n"}], "owner": {"reputation": 5, "user_id": 11741132, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-G0KrR5DDBJM/AAAAAAAAAAI/AAAAAAAAAAs/PD9GZD_IFgA/photo.jpg?sz=128", "display_name": "Melody Massard", "link": "https://stackoverflow.com/users/11741132/melody-massard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 57385451, "answer_count": 1, "score": 0, "last_activity_date": 1565137377, "creation_date": 1565134435, "question_id": 57385219, "link": "https://stackoverflow.com/questions/57385219/how-to-update-a-go-template-while-still-persisting-the-original-template-variabl", "title": "How to update a go template while still persisting the original template variables", "body": "<p>This is a high level question, as I'm not sure how to approach this problem:</p>\n\n<p>I'm building a CLI that sets up code projects for users automatically. </p>\n\n<p>I want to create an <code>update</code> feature that will allow the user to update to the latest CLI's template versions but still keep the original variables they used to create the project (i.e. project name, env variables, etc...)</p>\n\n<p>I know how to create new templates, but I don't know how I could update and still keep the variables passed by the user. </p>\n\n<p>It would be something similar to a git merge, so merge the user's local project with the updated CLI template.</p>\n\n<p>In the code below you can see an example of how the files are templated with <code>var deploymentYamlData</code> as string variables</p>\n\n<p>I have a function that organizes all these file templates into the proper directory structure for the project.</p>\n\n<p>How would I go about merging directory templates with the user's local directory, while being able to persist the original template variables?</p>\n\n<p>Apologies ahead of time if I need to clarify more.</p>\n\n<pre><code>package main\n\nimport (\n    \"text/template\"\n        \"os\"\n)\n\nvar deploymentYamlData = `---\n\n  # do not edit commented lines\n  # CLI-Version: {{ .GitTagVersion}}\n\n  app: {{ .BotName }}\n  type: web\n  team: {{ .TeamName }}\n  docker_image: {{ .DockerImageName }}\n  docker_tag: {{ .TagVersion }}\n  internal: false\n  replicas: {{ .Replicas }}\n  revisionHistoryLimit: 5\n  container_port: {{ .DockerImagePort }}\n   healthcheck:\n    path: /{{ .DockerImageHealthCheck }}\n  dynamodb:\n    enable_deleteitem: true\n    tables:\n      - name: {{ .BotName }}_conversation_data\n`\n\ntype DigitalAssistant struct {\n    BotName string\n    TeamName string\n    DockerImageName string\n    TagVersion string\n    Replicas int\n    DockerImagePort int\n    DockerImageHealthCheck string\n        GitTageVersion string\n\n}\n\nfunc main() {\n    bot := DigitalAssistant{\"bobisyouruncle\", \"teamAwesome\", \"awesomebotimagename\", \"0.1.0\", 1, 8000, \"health\"}\n    bmap, err := template.New(\"captain.tmpl\").Parse(deploymentYamlData)\n    if err != nil { panic(err) }\n    err = bmap.Execute(os.Stdout, bot)\n    if err != nil { panic(err) }\n}\n\n</code></pre>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565186623, "post_id": 57385200, "comment_id": 101274211, "body": "run <code>go get .&#47;...</code> before <code>go build .&#47;...</code> to get the dependencies."}], "answers": [{"tags": [], "owner": {"reputation": 26173, "user_id": 1891, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c40d475927f7a86639ec54aa32517572?s=128&d=identicon&r=PG", "display_name": "Jay Conrod", "link": "https://stackoverflow.com/users/1891/jay-conrod"}, "is_accepted": true, "score": 2, "last_activity_date": 1565189027, "creation_date": 1565189027, "answer_id": 57397004, "question_id": 57385200, "link": "https://stackoverflow.com/questions/57385200/is-there-a-way-to-build-multiple-go-module-based-projects-at-once/57397004#57397004", "title": "Is there a way to build multiple Go module based projects at once?", "body": "<p>No, there isn't a way to do this using only the go command. Scripting this or using <code>replace</code> directives is the way to go. A simple script might be:</p>\n\n<pre><code>find \"$(go env GOPATH)/src\" \\\n  -name vendor -prune -o \\\n  -name go.mod -exec bash -c 'cd \"$(dirname {})\" &amp;&amp; go build ./...' \\;\n</code></pre>\n\n<p>Each go.mod file defines a workspace, and <code>go build</code>, <code>go test</code>, <code>go list</code>, <code>go get</code> commands only apply to packages within that workspace.</p>\n\n<p>Within a module, it's possible to build packages provided by other modules. For example, if you have a module with the path <code>example.com/foo</code>, and you require the module <code>example.com/bar</code>, you can <code>go build example.com/bar/some/pkg</code>. However, this will not use your local copy of <code>example.com/bar</code>; it will download that module into your module cache (<code>$GOPATH/pkg/mod</code>) and will build from there.</p>\n\n<p>You can use a local copy of another module using a <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"nofollow noreferrer\"><code>replace</code> directive</a>. This is good for short term forks and co-development of related modules (usually in the same repository). However, <code>replace</code> directives only apply in the module where they are written. If another module requires your module, your <code>replace</code> directives are ignored.</p>\n\n<p>The goal of all of this is to make builds reproducible. Developers that use your modules will only be able to download your dependencies at specific versions.</p>\n"}], "owner": {"reputation": 4323, "user_id": 370364, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/58cb3fbbdbcc34cda410ff6f366ae83a?s=128&d=identicon&r=PG", "display_name": "PiersyP", "link": "https://stackoverflow.com/users/370364/piersyp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 405, "favorite_count": 0, "accepted_answer_id": 57397004, "answer_count": 1, "score": 0, "last_activity_date": 1565189027, "creation_date": 1565134237, "last_edit_date": 1565177409, "question_id": 57385200, "link": "https://stackoverflow.com/questions/57385200/is-there-a-way-to-build-multiple-go-module-based-projects-at-once", "title": "Is there a way to build multiple Go module based projects at once?", "body": "<p>Previous to using Go modules I could compile everything in my <code>GOPATH</code> with <code>go build ./...</code>.</p>\n\n<p>If I try this in the root of a directory with multiple module based Go projects, it doesn't download the dependencies specified in <code>go.mod</code> and fails to find the packages the code depends on because it is looking for them in <code>GOPATH</code>.</p>\n\n<p>I have 126 modules based projects and I'd rather not have to write a script to handle building them.</p>\n"}, {"tags": ["go", "orc"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565177263, "post_id": 57384901, "comment_id": 101268459, "body": "What have you tried? Your code is just a copy of the readme example. The package says it&#39;s still a work in progress; perhaps ask on GitHub if/when/how metadata is supported."}, {"owner": {"reputation": 9, "user_id": 6693385, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FuMINxaAQjI/AAAAAAAAAAI/AAAAAAAAAVk/34C-ulk3vPM/photo.jpg?sz=128", "display_name": "dinesh attem", "link": "https://stackoverflow.com/users/6693385/dinesh-attem"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565285799, "post_id": 57384901, "comment_id": 101315640, "body": "i didn&#39;t try anything. I was not able to figure out from the code on how to get the user metadata."}], "owner": {"reputation": 9, "user_id": 6693385, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FuMINxaAQjI/AAAAAAAAAAI/AAAAAAAAAVk/34C-ulk3vPM/photo.jpg?sz=128", "display_name": "dinesh attem", "link": "https://stackoverflow.com/users/6693385/dinesh-attem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 263, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1604071115, "creation_date": 1565131470, "last_edit_date": 1565177111, "question_id": 57384901, "link": "https://stackoverflow.com/questions/57384901/how-to-read-orc-file-metadata", "title": "How to read ORC file metadata?", "body": "<p>I am trying to read an ORC file using the Go <a href=\"https://github.com/scritchley/orc\" rel=\"nofollow noreferrer\"><code>github.com/scritchley/orc</code></a> package.\nI am able to read the content of the ORC file but I also wanted to read the ORC metadata. I can't find a straight forward of doing that with the package.</p>\n\n<p>The example from the package:</p>\n\n<pre><code>r, err := orc.Open(localFileName)\nif err != nil {\n    log.Fatal(err)\n}\ndefer r.Close()\nlogging.Info(\"reader returned\")\n\n// Create a new Cursor reading the provided columns.\nc := r.Select()\n\n// Iterate over each stripe in the file.\nfor c.Stripes() {\n\n    // Iterate over each row in the stripe.\n    for c.Next() {\n\n        // Retrieve a slice of interface values for the current row.\n        log.Println(c.Row())\n\n    }\n\n}\n\nif err := c.Err(); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}, {"tags": ["unit-testing", "go", "concurrency", "initialization", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "edited": false, "score": 0, "creation_date": 1565126764, "post_id": 57384024, "comment_id": 101252486, "body": "Note that I have only one app., no packages. I have an <code>init()</code> and a <code>main()</code>. But I guess here&#39;s a good point: you must make sure all that a go routine is going to use is already initialized before starting it (or have some synchronization mechanism.)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1565125726, "creation_date": 1565125726, "answer_id": 57384024, "question_id": 57383788, "link": "https://stackoverflow.com/questions/57383788/can-the-init-function-start-go-routines-safely-including-along-tests/57384024#57384024", "title": "Can the init() function start go routines safely, including along tests?", "body": "<p><a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow noreferrer\">Spec: Package initialization:</a></p>\n\n<blockquote>\n  <p>Package initialization\u2014variable initialization and the invocation of init functions\u2014happens in a single goroutine, sequentially, one package at a time. <strong>An init function may launch other goroutines, which can run concurrently with the initialization code.</strong> However, initialization always sequences the init functions: it will not invoke the next one until the previous one has returned.</p>\n</blockquote>\n\n<p>There is nothing wrong about launching goroutines from <code>init()</code> functions, although you must remember that these goroutines run concurrently with the initialization process, so for example you can't assume anything about the initialization state of the (current) package.</p>\n\n<p>If you see your <code>init()</code> functions running multiple times, that is most likely multiple tests run separately. <code>init()</code> functions run only once during the lifetime of a package.</p>\n"}, {"comments": [{"owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "edited": false, "score": 2, "creation_date": 1565137588, "post_id": 57385160, "comment_id": 101254756, "body": "I was not the first author of that app. and I just followed with what was there. But you are correct. I moved the calls from <code>init()</code> to <code>main()</code> and deleted the <code>init()</code> function. And I now have a <code>TestMain()</code> function in my test that runs a very few initialization functions that are necessary for the test. It already works a lot better!"}], "tags": [], "owner": {"reputation": 763, "user_id": 6789498, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RYF7A.jpg?s=128&g=1", "display_name": "esote", "link": "https://stackoverflow.com/users/6789498/esote"}, "is_accepted": true, "score": 4, "last_activity_date": 1565133800, "creation_date": 1565133800, "answer_id": 57385160, "question_id": 57383788, "link": "https://stackoverflow.com/questions/57383788/can-the-init-function-start-go-routines-safely-including-along-tests/57385160#57385160", "title": "Can the init() function start go routines safely, including along tests?", "body": "<p>In addition to icza's answer, it sounds like you're using <code>init()</code> incorrectly with the <code>testing</code> package.</p>\n\n<p>Rather than using <code>init()</code> to initialize things needed for tests, you should define the function <a href=\"https://golang.org/pkg/testing/#hdr-Main\" rel=\"nofollow noreferrer\"><code>TestMain()</code></a>.</p>\n"}], "owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 579, "favorite_count": 0, "accepted_answer_id": 57385160, "answer_count": 2, "score": 2, "last_activity_date": 1565133800, "creation_date": 1565124447, "last_edit_date": 1565128484, "question_id": 57383788, "link": "https://stackoverflow.com/questions/57383788/can-the-init-function-start-go-routines-safely-including-along-tests", "title": "Can the init() function start go routines safely, including along tests?", "body": "<p>I have an app. which creates an HTTP service to listen to a few connections points we can use to check the app status.</p>\n\n<p>That service runs in the background (with a go routine).</p>\n\n<p>It gets initialized in the <code>init()</code> function among other things:</p>\n\n<pre><code>func init() {\n    ...\n    initHttpEndPoints();\n    ...\n}\n</code></pre>\n\n<p>Can the fact that a go routine is created in the <code>init()</code> function cause issues when testing this app.?</p>\n\n<p>I'm asking because it looks like my tests re-run the <code>init()</code> a second time and I'm wondering why that is and what the side effects could be... (probably not so good if all the go routines are all of a sudden duplicated.)</p>\n\n<p><em>Note: The complete app. creates several hundred go routines in the <code>init()</code> function. I use the HTTP end point as an example.</em></p>\n\n<p>Strongly related answer: <a href=\"https://stackoverflow.com/questions/24375966/does-go-test-run-unit-tests-concurrently\">Are tests run concurrently?</a></p>\n"}, {"tags": ["http", "go", "http2"], "comments": [{"owner": {"reputation": 8073, "user_id": 2852624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/682806d261e4f00f77aa8633689a9558?s=128&d=identicon&r=PG&f=1", "display_name": "Matthias247", "link": "https://stackoverflow.com/users/2852624/matthias247"}, "edited": false, "score": 0, "creation_date": 1565474212, "post_id": 57383226, "comment_id": 101368056, "body": "Not an answer to the question, but what do you expect from this? For most HTTP/2 implementations I expect a very bad performance. They will try to allocate the 16MB frames at once on the heap instead of streaming them, which has a huge cost."}], "answers": [{"tags": [], "owner": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "is_accepted": false, "score": 0, "last_activity_date": 1565129024, "creation_date": 1565129024, "answer_id": 57384590, "question_id": 57383226, "link": "https://stackoverflow.com/questions/57383226/how-to-configure-frame-size-in-net-http-for-http2/57384590#57384590", "title": "How to configure frame size in net/http for HTTP2", "body": "<p><code>2&lt;&lt;24</code> is ~32MB, you probably want <code>1&lt;&lt;24-1</code></p>\n"}], "owner": {"reputation": 13, "user_id": 6301825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d9419bc1fd4314a1e43b3c2fa2eca51?s=128&d=identicon&r=PG&f=1", "display_name": "Nikhil Jain", "link": "https://stackoverflow.com/users/6301825/nikhil-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565129024, "creation_date": 1565121767, "question_id": 57383226, "link": "https://stackoverflow.com/questions/57383226/how-to-configure-frame-size-in-net-http-for-http2", "title": "How to configure frame size in net/http for HTTP2", "body": "<p>I am trying to set the frame size to 16 MB in HTTP/2 Server using net/http library. Default size is 16 KB.</p>\n\n<p>Tried following:</p>\n\n<pre><code>http2Server = http2.Server{\nMaxReadFrameSize: 2 &lt;&lt; 24 -1,\n}\n_ = http2.ConfigureServer(srv, &amp;http2Server)\n</code></pre>\n\n<p>But still getting the frame size as 16 KB on client side (verified by printing length of response body). Is there any other way to set the Max Frame Size on Client and Server side ?</p>\n"}, {"tags": ["go", "struct", "slice"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1565120917, "post_id": 57382944, "comment_id": 101250372, "body": "The error message explains everything: &quot;cannot refer to unexported field or method &#39;a&#39;&quot;."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1565121339, "post_id": 57382944, "comment_id": 101250581, "body": "Taking the <a href=\"https://tour.golang.org/basics/3\" rel=\"nofollow noreferrer\">Tour of Go</a> should answer all basic syntax questions about the language."}, {"owner": {"reputation": 58368, "user_id": 30038, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/mPvRH.jpg?s=128&g=1", "display_name": "Vlad Bezden", "link": "https://stackoverflow.com/users/30038/vlad-bezden"}, "edited": false, "score": 0, "creation_date": 1565121547, "post_id": 57382944, "comment_id": 101250673, "body": "In Go all lowercase functions/methods/fields are considered private and only visible to that file. Uppercase names mean public. In your case you want to use test_package outside by another file. So in order to make calls on Struct from outside of the file you have to have those &#39;a&#39;, and &#39;b&#39; fields to be &#39;A&#39; and &#39;B&#39;"}], "answers": [{"tags": [], "owner": {"reputation": 3847, "user_id": 12677, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8892ff21c03d7a54e66d82b717635e74?s=128&d=identicon&r=PG", "display_name": "tovare", "link": "https://stackoverflow.com/users/12677/tovare"}, "is_accepted": false, "score": 2, "last_activity_date": 1565120884, "creation_date": 1565120884, "answer_id": 57383028, "question_id": 57382944, "link": "https://stackoverflow.com/questions/57382944/why-cant-i-access-to-struct-fields-when-im-iterating-over-a-slice-of-structs/57383028#57383028", "title": "why can&#39;t I access to struct fields when I&#39;m iterating over a slice of structs", "body": "<p>You need to capitalize the first letter of struct members to export them.</p>\n\n<pre><code>type Struct struct {\n    A string\n    B string\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6340039, "user_type": "registered", "profile_image": "https://graph.facebook.com/635134833307953/picture?type=large", "display_name": "Nurit Izraelov", "link": "https://stackoverflow.com/users/6340039/nurit-izraelov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1565120884, "creation_date": 1565120448, "question_id": 57382944, "link": "https://stackoverflow.com/questions/57382944/why-cant-i-access-to-struct-fields-when-im-iterating-over-a-slice-of-structs", "title": "why can&#39;t I access to struct fields when I&#39;m iterating over a slice of structs", "body": "<p>I have a function in a package which returns a slice of a specific struct I defined in my package, then I'm importing this package to another main package and I want to iterate over the slice returned from the function and access the structs fields, I'm getting \"undefined\" error.</p>\n\n<p>\"s.a undefined (cannot refer to unexported field or method a)\"</p>\n\n<p>What am I missing?</p>\n\n<p>thanks for the help.</p>\n\n<p>the packages code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package test_package\n\nimport \"fmt\"\n\ntype Struct struct {\n    a string\n    b string\n}\n\nfunc ReturnStructSlice() ([]Struct){\n    s1 := Struct{\"a\", \"b\"}\n    s2 := Struct{\"c\", \"d\"}\n\n    structSliceToReturn := []Struct{s1, s2}\n\n    for _, s := range structSliceToReturn {\n        fmt.Println(\" \", s.a)\n    }\n\n    return structSliceToReturn\n}\n\nthis is the main package:\n\npackage main\n\nimport (\n    t \"/test_package\"\n    \"fmt\"\n)\n\n\nfunc main() {\n    sList := t.ReturnStructSlice()\n    for _, s := range sList {\n        fmt.Println(\" \", s.a) \\\\ here I'm getting the error\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 382, "user_id": 3328311, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/437d1a24f69a7108e6abd9fa71c98b70?s=128&d=identicon&r=PG&f=1", "display_name": "randomshinichi", "link": "https://stackoverflow.com/users/3328311/randomshinichi"}, "edited": false, "score": 1, "creation_date": 1565115694, "post_id": 57381714, "comment_id": 101248165, "body": "Both answers were good but I chose this one because the use of a closure here over the err variable was pretty smart"}, {"owner": {"reputation": 382, "user_id": 3328311, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/437d1a24f69a7108e6abd9fa71c98b70?s=128&d=identicon&r=PG&f=1", "display_name": "randomshinichi", "link": "https://stackoverflow.com/users/3328311/randomshinichi"}, "edited": false, "score": 3, "creation_date": 1565118631, "post_id": 57381714, "comment_id": 101249387, "body": "Just noticed something: if the first statement returns a non-nil error, execution is not terminated, and the second statement will be executed with invalid input. Which will then result in an err, which will then overwrite the first, original err."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 382, "user_id": 3328311, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/437d1a24f69a7108e6abd9fa71c98b70?s=128&d=identicon&r=PG&f=1", "display_name": "randomshinichi", "link": "https://stackoverflow.com/users/3328311/randomshinichi"}, "edited": false, "score": 0, "creation_date": 1565164168, "post_id": 57381714, "comment_id": 101261438, "body": "@randomshinichi  For what it&#39;s worth, the code in the question has the same flaw."}], "tags": [], "owner": {"reputation": 17, "user_id": 11891168, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/842e6470bde70bd6af51817401e4c66c?s=128&d=identicon&r=PG", "display_name": "nhoorix", "link": "https://stackoverflow.com/users/11891168/nhoorix"}, "is_accepted": false, "score": 0, "last_activity_date": 1565114723, "creation_date": 1565114723, "answer_id": 57381714, "question_id": 57381580, "link": "https://stackoverflow.com/questions/57381580/tried-the-monad-pattern-but-still-have-repetitive-error-handling/57381714#57381714", "title": "Tried the monad pattern but still have repetitive error handling", "body": "<p>Use the following to reduce the amount of code and retain an more idiomatic API by returning an error.</p>\n\n<pre><code>func (n *namePreclaimRLP) ReadRLP(s *rlp.Stream) (aID, cID string, err error) {\n    se := func(e error) {\n       if e != nil {\n          err = e\n       }\n    }\n\n    blob, e := s.Raw()\n    se(e)\n    se(rlp.DecodeBytes(blob, n))\n    _, aID, e = readIDTag(n.AccountID)\n    se(e)\n    _, cID, e = readIDTag(n.CommitmentID)\n    se(e)\n    return\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 2, "last_activity_date": 1565119316, "last_edit_date": 1565119316, "creation_date": 1565115196, "answer_id": 57381826, "question_id": 57381580, "link": "https://stackoverflow.com/questions/57381580/tried-the-monad-pattern-but-still-have-repetitive-error-handling/57381826#57381826", "title": "Tried the monad pattern but still have repetitive error handling", "body": "<p>Your code doesn't compile as written (there are a lot of missing types), so I can't fully test this code, but I would expect something along these lines, returning <code>err</code> in the typical Go approach, rather than making it part of another type, which is unusual and a bit confusing:</p>\n\n<pre><code>func (n *namePreclaimRLP) ReadRLP(s *rlp.Stream) (aID, cID string, err error) {\n    var blob SomeType // Depends on what blob actually is\n    if blob, err = s.Raw(); err != nil {\n        return\n    }\n\n    if err = rlp.DecodeBytes(blob, n); err != nil {\n        return\n    }\n\n    if _, aID, err = readIDTag(n.AccountID); err != nil {\n        return\n    }\n\n    _, cID, err = readIDTag(n.CommitmentID)\n\n    return\n}\n</code></pre>\n\n<p>I'd delete your <code>Error()</code> function here and the <code>err</code> field. <code>namePreclaimRLP</code> is not a kind of error. It feels you're abusing the interface there.</p>\n"}], "owner": {"reputation": 382, "user_id": 3328311, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/437d1a24f69a7108e6abd9fa71c98b70?s=128&d=identicon&r=PG&f=1", "display_name": "randomshinichi", "link": "https://stackoverflow.com/users/3328311/randomshinichi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 57381826, "answer_count": 2, "score": -3, "last_activity_date": 1565119316, "creation_date": 1565114062, "question_id": 57381580, "link": "https://stackoverflow.com/questions/57381580/tried-the-monad-pattern-but-still-have-repetitive-error-handling", "title": "Tried the monad pattern but still have repetitive error handling", "body": "<p>I read <a href=\"https://blog.golang.org/errors-are-values\" rel=\"nofollow noreferrer\">Rob Pike's post</a> but it only works for repetitive loops. I, on the other hand, have this. Notice how I added the <code>err</code> field, accessible via the <code>Error()</code> method, in a futile attempt to reduce the if errs.</p>\n\n<p>The code above is simpler, but the ReadRLP() function is no different from just returning a err. Is there some pattern that can help with this?</p>\n\n<pre><code>type namePreclaimRLP struct {\n    ObjectTag         uint\n    RlpMessageVersion uint\n    AccountID         []uint8\n    AccountNonce      uint64\n    CommitmentID      []uint8\n    Fee               big.Int\n    TTL               uint64\n    err               error\n}\n\nfunc (n *namePreclaimRLP) ReadRLP(s *rlp.Stream) (aID, cID string) {\n    blob, err := s.Raw()\n    if err != nil {\n        n.err = err\n    }\n    err = rlp.DecodeBytes(blob, n)\n    if err != nil {\n        n.err = err\n    }\n    _, aID, err = readIDTag(n.AccountID)\n    if err != nil {\n        n.err = err\n    }\n    _, cID, err = readIDTag(n.CommitmentID)\n    if err != nil {\n        n.err = err\n    }\n    return aID, cID\n}\n\nfunc (n *namePreclaimRLP) Error() (err error) {\n    return n.err\n}\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "kubernetes-helm", "kubernetes-operator", "operator-sdk"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1565141557, "post_id": 57381441, "comment_id": 101255407, "body": "The <code>batchv1.Job</code> object (and its embedded objects) are ordinary Go objects, and you can manipulate them the same way you would any other Go object.  You can set <code>Image: fmt.Sprintf(...)</code>; you can omit fields that you expect to be their zero value (empty strings or structures containing only zero values); you can precompute things like <code>apiv1.ImagePullSecrets</code> objects and store them in variables."}, {"owner": {"reputation": 639, "user_id": 8327405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/542f892aa9976f44746a2137050f91af?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Conard", "link": "https://stackoverflow.com/users/8327405/michael-conard"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1565296303, "post_id": 57381441, "comment_id": 101319803, "body": "Yes, that&#39;s exactly what I am already doing and would like to stop doing by reading in existing YAML files instead. Your comment describes all the knowledge I am already utilizing and avoids my question."}, {"owner": {"reputation": 4478, "user_id": 80849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad806f16247be56cc644919576214fd7?s=128&d=identicon&r=PG", "display_name": "Igor", "link": "https://stackoverflow.com/users/80849/igor"}, "edited": false, "score": 0, "creation_date": 1568109294, "post_id": 57381441, "comment_id": 102161528, "body": "Wouldn&#39;t this be the case of using a file, and an YAML deserializer into a <code>batchv1.Job</code> or <code>corev1.Pod</code> value?"}, {"owner": {"reputation": 836, "user_id": 1354502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fa4264c8d235ef978d7fd70a461cc52?s=128&d=identicon&r=PG", "display_name": "Ricardo Zanini", "link": "https://stackoverflow.com/users/1354502/ricardo-zanini"}, "edited": false, "score": 0, "creation_date": 1574180782, "post_id": 57381441, "comment_id": 104135790, "body": "I&#39;d say that leveraging from Go objects is easier and much more &quot;readable&quot; than having YAML files with the object specs. But if this is the way you plan to go, you could use packr (<a href=\"https://github.com/gobuffalo/packr\" rel=\"nofollow noreferrer\">github.com/gobuffalo/packr</a>) to add the resources (YAML files) to your final binary and read them in runtime. Let me know if this helps and if it&#39;s what you&#39;re looking for that I put it in a formal answer."}, {"owner": {"reputation": 558, "user_id": 4207183, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FlaU_rcEFmQ/AAAAAAAAAAI/AAAAAAAAF-Y/UVEWfvV4tKE/photo.jpg?sz=128", "display_name": "Alejandro Visiedo Garc&#237;a", "link": "https://stackoverflow.com/users/4207183/alejandro-visiedo-garc%c3%ada"}, "edited": false, "score": 0, "creation_date": 1612304473, "post_id": 57381441, "comment_id": 116724332, "body": "Any news on this? I am in a similar situation; I plan to read that information from YAML files, so that I use them as a template where I update the minimal information. This would make easier to prototype before use the golang operator."}], "owner": {"reputation": 639, "user_id": 8327405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/542f892aa9976f44746a2137050f91af?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Conard", "link": "https://stackoverflow.com/users/8327405/michael-conard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1565114154, "creation_date": 1565113455, "last_edit_date": 1565114154, "question_id": 57381441, "link": "https://stackoverflow.com/questions/57381441/how-to-read-in-yamls-for-object-creation-in-a-kubernetes-go-operator-instead-of", "title": "How to read in YAMLs for object creation in a Kubernetes Go Operator, instead of hardcoding?", "body": "<p>I'm working on a custom Kubernetes Operator in Golang, as a shift away from an Operator generated based on existing Helm Charts. The way you can create a Pod (or Job in the example I will share) is like this, as I understand it:</p>\n\n<pre><code>func returnJob(cr *myApi.MyCRObject) *batchv1.Job {\n    return &amp;batchv1.Job{\n        ObjectMeta: metav1.ObjectMeta{\n            Name: cr.Name,\n            Namespace: cr.Namespace,\n        },\n        Spec: batchv1.JobSpec{\n            BackOffLimit: 0,\n            Template: apiv1.PodTemplateSpec{\n                ObjectMeta: metav1.ObjectMeta{\n                    Name: cr.Name\n                },\n                Spec: apiv1.PodSpec{\n                    RestartPolicy: \"Never\",\n                    ServiceAccountName: \"\",\n                    SecurityContext: apiv1.SecurityContext{\n                        RunAsUser: \"\",\n                        FsGroup: \"\"\n                    },\n                    ImagePullSecrets: apiv1.ImagePullSecrets{\n                        Name: \"\"\n                    },\n                    Volumes: []apiv1.Volumes{\n                        {\n                            Name: \"config\",\n                            ConfigMap: apiv1.ConfigMap{\n                                Name: cr.Name + \"-config\"\n                            }\n                        }\n                    },\n                    Containers: []apiv1.Container{\n                        {\n                            Name:  \"container\",\n                            Image: \"prefix/image:tag\",\n                            ImagePullPolicy: \"Always\",\n                            WorkingDir: \"installdir\",\n                            SecurityContext: apiv1.SecurityContext{\n                                RunAsUser: \"\",\n                                FsGroup: \"\"\n                            },\n                            Env: []apiv1.Env{\n                                {\n                                    Name: \"KEY\",\n                                    Value: \"VAL\"\n                                },\n                                {\n                                    Name: \"NAME\",\n                                    Value: cr.Name\n                                }\n                            }\n                            Command: []string{\n                                \"mycommand\",\n                                \"-x\"\n                            },\n                            Resources: apiv1.Resources{\n                                Requests: apiv1.Requests{\n                                    Cpu: 1,\n                                    Memory: \"1G\"\n                                },\n                                Limits: apiv1.Limits{\n                                    Cpu: 1,\n                                    Memory: \"1G\"\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Then elsewhere in the Reconcile call, the job is actually created on Kubernetes:</p>\n\n<pre><code>    job := returnJob(instance)\n\n    // Set instance as the owner and controller\n    if err := controllerutil.SetControllerReference(instance, job, r.scheme); err != nil {\n        return reconcile.Result{}, err\n    }\n\n    // Check if this Job already exists\n    found := &amp;batchv1.Job{}\n    err = r.client.Get(context.TODO(), types.NamespacedName{Name: job.Name, Namespace: job.Namespace}, found)\n    if err != nil &amp;&amp; errors.IsNotFound(err) {\n        reqLogger.Info(\"Creating a new Job\", \"Job.Namespace\", job.Namespace, \"Job.Name\", job.Name)\n        err = r.client.Create(context.TODO(), job)\n        if err != nil {\n            return reconcile.Result{}, err\n        }\n\n        // Job created successfully - don't requeue\n        return reconcile.Result{}, nil\n    } else if err != nil {\n        return reconcile.Result{}, err\n    }\n</code></pre>\n\n<p>This is... very clearly not optimal. I can't see a great way to fill in things such as the \"Image\" or to allow overrides for \"Resources\" etc., and that's all second to it being a massive hardcoded blob (I removed identifying info and about 120 lines from the specification above, things like additional volumes and other containers). </p>\n\n<p>I'd like to just be able to pull from an existing YAML file in the manifest (what was previously used with Helm Charts and Helm Operators) and return that in the format Go needs from a method such as this. </p>\n\n<p>I've been scouring the internet for something like this, but there just aren't a lot of Go or k8s Operators resources out there yet, so I figured I'd ask here. </p>\n\n<p>Any ideas or solutions you guys have found?</p>\n"}, {"tags": ["go", "benchmarking"], "comments": [{"owner": {"reputation": 47, "user_id": 8446916, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4JS0k.png?s=128&g=1", "display_name": "chtotonetak", "link": "https://stackoverflow.com/users/8446916/chtotonetak"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565116767, "post_id": 57381231, "comment_id": 101248600, "body": "@CeriseLim&#243;n in UPD#1 section at the end"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1565117119, "post_id": 57381231, "comment_id": 101248752, "body": "Measuring them this way is unlikely to offer valuable insight. Write proper benchmarks using the <code>testing</code> package and see what results you get."}, {"owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1565117584, "post_id": 57381231, "comment_id": 101248935, "body": "Instead of twice, try measuring it 4 times and see if a pattern appears.   There is likely some lazy-state construction that happens on the first run, but is re-used for subsequent ones."}, {"owner": {"reputation": 47, "user_id": 8446916, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4JS0k.png?s=128&g=1", "display_name": "chtotonetak", "link": "https://stackoverflow.com/users/8446916/chtotonetak"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565117697, "post_id": 57381231, "comment_id": 101248984, "body": "@Adrian, I realize that I have to use <code>testing</code> package to get correct values. But I&#39;m looking for explanation of described case. I&#39;m afraid that this kind of behavior will be reproduced later, for example if I create some kind of microservice. I&#39;ll try to calculate execution time by external tool to compare and show you result later."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1565118112, "post_id": 57381231, "comment_id": 101249165, "body": "Trying to explain it would be pointless; the test is so microscopic and executed so few times that the data you get from it tells you absolutely nothing. That&#39;s why I would suggest writing a proper benchmark to get real data."}, {"owner": {"reputation": 47, "user_id": 8446916, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4JS0k.png?s=128&g=1", "display_name": "chtotonetak", "link": "https://stackoverflow.com/users/8446916/chtotonetak"}, "reply_to_user": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1565118113, "post_id": 57381231, "comment_id": 101249166, "body": "@mevets see UPD#2. It seems you&#39;re right. Do you have any idea why the binary is 10 times slower than <code>go run</code> sandbox?"}, {"owner": {"reputation": 47, "user_id": 8446916, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4JS0k.png?s=128&g=1", "display_name": "chtotonetak", "link": "https://stackoverflow.com/users/8446916/chtotonetak"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565118338, "post_id": 57381231, "comment_id": 101249260, "body": "I get your point, thank you, @Adrian"}, {"owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1565121198, "post_id": 57381231, "comment_id": 101250515, "body": "on go version go1.10 darwin/amd64, I saw 37480,3056,2831,2768 for both &quot;go build&quot; and &quot;go run&quot;."}, {"owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1565215182, "post_id": 57381231, "comment_id": 101287075, "body": "btw, if you uncomment your first Println, the numbers smooth out a bit; the first one is the time taken to plumb fmt.Print()...."}], "answers": [{"tags": [], "owner": {"reputation": 3847, "user_id": 12677, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8892ff21c03d7a54e66d82b717635e74?s=128&d=identicon&r=PG", "display_name": "tovare", "link": "https://stackoverflow.com/users/12677/tovare"}, "is_accepted": true, "score": 1, "last_activity_date": 1565115631, "creation_date": 1565115631, "answer_id": 57381908, "question_id": 57381231, "link": "https://stackoverflow.com/questions/57381231/explain-me-the-execution-time-difference/57381908#57381908", "title": "Explain me the execution time difference", "body": "<p>Try writing a benchmark method with a loop running each method a few hundred times or so using the benchmark techniques shown in section 11.4.</p>\n\n<p>The discrepancies between runs might be various measurement errors caused by a multitasking operating system and timer resolution and such.</p>\n\n<p>Also, I think it\u00b4s ok to go back to exercises when you are further along (The exercise expects some familiarity with the topic)</p>\n"}], "owner": {"reputation": 47, "user_id": 8446916, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4JS0k.png?s=128&g=1", "display_name": "chtotonetak", "link": "https://stackoverflow.com/users/8446916/chtotonetak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 57381908, "answer_count": 1, "score": -1, "last_activity_date": 1565117985, "creation_date": 1565112426, "last_edit_date": 1565117985, "question_id": 57381231, "link": "https://stackoverflow.com/questions/57381231/explain-me-the-execution-time-difference", "title": "Explain me the execution time difference", "body": "<p>I've started learning Golang with Donovan-Kernighan \"The Go Programming Language\" book. In chapter 1 the author advises to test several alternative simple echo function implementations. I used <code>time</code> function to calculate execution time like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>  29 func main() {\n  30     var start, end int64\n  31     //fmt.Println(\"Testing echo implementation\")\n  32     start = time.Now().UTC().UnixNano()\n  33     echo3()\n  34     end = time.Now().UTC().UnixNano()\n  35     fmt.Println(end - start)\n  36     start = time.Now().UTC().UnixNano()\n  37     echo3()\n  38     end = time.Now().UTC().UnixNano()\n  39     fmt.Println(end - start)\n  40 }\n</code></pre>\n\n<p>And in case I build code with <code>go build ...</code> command I get the result:</p>\n\n<pre><code>\u279c  go-hello-world ./echo2\n./echo2\n81073\n./echo2\n5591\n</code></pre>\n\n<p>As you can see the first call require ten times bigger amount of time compare to second one. Note that I call the same <code>echo3</code> function in both cases. I guessed that the first call of <code>fmt.Println</code> required to much time. For this purpose I've added function call in line 31 and tested again:</p>\n\n<pre><code>\u279c  go-hello-world ./echo2\nTesting echo implementation\n./echo2\n6327\n./echo2\n4249\n</code></pre>\n\n<p><strong>You can see that both calls require similar amount of time.</strong></p>\n\n<p><strong>But where is a source of truth?</strong></p>\n\n<p>Another one interesting moment is that when I run my code by <code>go run ...</code> command I get much smaller amount of time:</p>\n\n<pre><code>\u279c  go-hello-world go run echo2.go\nTesting echo implementation\n/tmp/go-build040243191/b001/exe/echo2\n1743\n/tmp/go-build040243191/b001/exe/echo2\n1133\n\u279c  go-hello-world go run echo2.go\n/tmp/go-build646239204/b001/exe/echo2\n34525\n/tmp/go-build646239204/b001/exe/echo2\n1133\n</code></pre>\n\n<p>I thought when I make a binary with build command I get more effective machine code for execution. <strong>Could you please explain me why it works in this way in practice.</strong></p>\n\n<p>Environment:</p>\n\n<pre><code>OS: ArchLinux 5.2.5-arch1-1-ARCH\nGo: go1.12.7 linux/amd64\n</code></pre>\n\n<p><em>P.S. I'm sorry for my English.</em></p>\n\n<p><strong>UPD#1</strong></p>\n\n<p><code>echo3</code> code:</p>\n\n<pre><code>  20 func echo3() {\n  21     s, sep := \"\", \"\"\n  22     for _, arg := range os.Args[:] {\n  23         s += sep + arg\n  24         sep = \" \"\n  25     }\n  26     fmt.Println(s)\n  27 }\n</code></pre>\n\n<p><strong>UPD#2</strong></p>\n\n<pre><code>\u279c  go-hello-world go run echo2.go\n/tmp/go-build573021176/b001/exe/echo2\n13019\n/tmp/go-build573021176/b001/exe/echo2\n1067\n/tmp/go-build573021176/b001/exe/echo2\n955\n/tmp/go-build573021176/b001/exe/echo2\n987\n</code></pre>\n\n<p>and</p>\n\n<pre><code>\u279c  go-hello-world ./echo2          \n./echo2\n199681\n./echo2\n19404\n./echo2\n5965\n./echo2\n4803\n./echo2\n4673\n./echo2\n8244\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1565111533, "post_id": 57380770, "comment_id": 101246395, "body": "What have you tried? The <code>import</code> statement doesn&#39;t set the version. The version you&#39;re attempting to use will be recorded in <code>go.mod</code>, and can be overridden with <code>replace</code>. If you&#39;re not using the correct version at all, fetch it with <code>go get</code>. See the documentation at: <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/Modules</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1733, "user_id": 1460102, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e70df89ccf5e5509e4aae9ef4ed5b865?s=128&d=identicon&r=PG", "display_name": "xxks-kkk", "link": "https://stackoverflow.com/users/1460102/xxks-kkk"}, "edited": false, "score": 0, "creation_date": 1565116134, "post_id": 57381069, "comment_id": 101248340, "body": "Thanks for the comment. However, it seems the same error is thrown."}, {"owner": {"reputation": 58368, "user_id": 30038, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/mPvRH.jpg?s=128&g=1", "display_name": "Vlad Bezden", "link": "https://stackoverflow.com/users/30038/vlad-bezden"}, "reply_to_user": {"reputation": 1733, "user_id": 1460102, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e70df89ccf5e5509e4aae9ef4ed5b865?s=128&d=identicon&r=PG", "display_name": "xxks-kkk", "link": "https://stackoverflow.com/users/1460102/xxks-kkk"}, "edited": false, "score": 0, "creation_date": 1565120496, "post_id": 57381069, "comment_id": 101250202, "body": "@xxks-kkk could you please show how your go.mod file looks like"}, {"owner": {"reputation": 1733, "user_id": 1460102, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e70df89ccf5e5509e4aae9ef4ed5b865?s=128&d=identicon&r=PG", "display_name": "xxks-kkk", "link": "https://stackoverflow.com/users/1460102/xxks-kkk"}, "edited": false, "score": 0, "creation_date": 1565123530, "post_id": 57381069, "comment_id": 101251372, "body": "My <code>go.mod</code> is under <code>gosrc&#47;</code> directory with the top line <code>module github.com&#47;arb_name&#47;repo_root&#47;gosrc</code>"}, {"owner": {"reputation": 1733, "user_id": 1460102, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e70df89ccf5e5509e4aae9ef4ed5b865?s=128&d=identicon&r=PG", "display_name": "xxks-kkk", "link": "https://stackoverflow.com/users/1460102/xxks-kkk"}, "edited": false, "score": 0, "creation_date": 1565128561, "post_id": 57381069, "comment_id": 101253023, "body": "Thanks for help! I just realized some package import path still has the old path. Everything works now."}], "tags": [], "owner": {"reputation": 58368, "user_id": 30038, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/mPvRH.jpg?s=128&g=1", "display_name": "Vlad Bezden", "link": "https://stackoverflow.com/users/30038/vlad-bezden"}, "is_accepted": true, "score": 2, "last_activity_date": 1565111690, "creation_date": 1565111690, "answer_id": 57381069, "question_id": 57380770, "link": "https://stackoverflow.com/questions/57380770/how-to-import-a-package-on-a-specific-branch-with-go-modules/57381069#57381069", "title": "How to import a package on a specific branch with go modules", "body": "<p>Make sure that you updated your <strong>go.mod</strong> file to</p>\n\n<blockquote>\n  <p>module github.com/arb_name/repo_root/gosrc</p>\n</blockquote>\n"}], "owner": {"reputation": 1733, "user_id": 1460102, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e70df89ccf5e5509e4aae9ef4ed5b865?s=128&d=identicon&r=PG", "display_name": "xxks-kkk", "link": "https://stackoverflow.com/users/1460102/xxks-kkk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3712, "favorite_count": 3, "accepted_answer_id": 57381069, "answer_count": 1, "score": 1, "last_activity_date": 1565111690, "creation_date": 1565110544, "question_id": 57380770, "link": "https://stackoverflow.com/questions/57380770/how-to-import-a-package-on-a-specific-branch-with-go-modules", "title": "How to import a package on a specific branch with go modules", "body": "<p>I'm reorganizing a repo from the following structure:</p>\n\n<pre><code>repo_root/\n   |- foo/\n       |- foo.go\n   |- bar/\n       |- bar.go\n   |- go.mod\n</code></pre>\n\n<p>into the following:</p>\n\n<pre><code>repo_root/\n   |- gosrc/\n        |- foo/\n             |- foo.go\n        |- bar/\n             |- bar.go\n        |- go.mod\n</code></pre>\n\n<p>Now, inside <code>foo.go</code> of the original repo structure, I do something like below to import the package <code>bar</code>:</p>\n\n<pre><code>import \"github.com/arb_name/repo_root/bar\"\n</code></pre>\n\n<p>Now, with the new repo, I changed it to:</p>\n\n<pre><code>import \"github.com/arb_name/repo_root/gosrc/bar\"\n</code></pre>\n\n<p>Now, I run into the problem that <code>go build</code> of <code>foo.go</code> failed because </p>\n\n<blockquote>\n  <p>cannot find module providing package github.com/arb_name/repo_root/gosrc/bar</p>\n</blockquote>\n\n<p>I certainly do not want to change the master branch of repo without first making sure that the restructure of repo works. I'm wondering if there is a way to solve my situation? I can work on my fork but ideally not directly making change to my fork's master.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["sql-server", "go"], "comments": [{"owner": {"reputation": 360447, "user_id": 3043, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/61d2a0f034915fa9d2acd6f6b145bba8?s=128&d=identicon&r=PG", "display_name": "Joel Coehoorn", "link": "https://stackoverflow.com/users/3043/joel-coehoorn"}, "edited": false, "score": 2, "creation_date": 1565110276, "post_id": 57380629, "comment_id": 101245857, "body": "<i>Don&#39;t do this!</i> It&#39;s <b>really poor practice</b> to use the <code>sa</code> account. Create a different account with the permissions you need, including adding/removing databases and altering permissions, if necessary."}, {"owner": {"reputation": 59343, "user_id": 2029983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0118fb43d1ce086d768e295339cf0ff4?s=128&d=identicon&r=PG", "display_name": "Larnu", "link": "https://stackoverflow.com/users/2029983/larnu"}, "edited": false, "score": 0, "creation_date": 1565110279, "post_id": 57380629, "comment_id": 101245859, "body": "What do the logs in the instance say? (But Joel&#39;s point rings very true, you shouldn&#39;t be using the <code>sa</code> account for anything other than <code>sa</code> stuff)."}, {"owner": {"reputation": 30515, "user_id": 3813116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DeWnw.png?s=128&g=1", "display_name": "Sean Lange", "link": "https://stackoverflow.com/users/3813116/sean-lange"}, "edited": false, "score": 0, "creation_date": 1565110325, "post_id": 57380629, "comment_id": 101245886, "body": "Not sure what is confusing here. Obviously you don&#39;t have the correct password for the sa account, or perhaps the sa account no longer exists. You shouldn&#39;t be using sa anyway."}, {"owner": {"reputation": 242, "user_id": 6421957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4E3Qq.jpg?s=128&g=1", "display_name": "Robert Stefanic", "link": "https://stackoverflow.com/users/6421957/robert-stefanic"}, "edited": false, "score": 0, "creation_date": 1565110394, "post_id": 57380629, "comment_id": 101245912, "body": "I do not plan on actually using the <code>sa</code> account. I&#39;m just trying to figure out why I can&#39;t connect to the remote DB using those credentials, but I could locally. Like I&#39;ve said, I can connect using another account. But I&#39;m just wondering why I can&#39;t connect here."}, {"owner": {"reputation": 59343, "user_id": 2029983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0118fb43d1ce086d768e295339cf0ff4?s=128&d=identicon&r=PG", "display_name": "Larnu", "link": "https://stackoverflow.com/users/2029983/larnu"}, "edited": false, "score": 0, "creation_date": 1565110453, "post_id": 57380629, "comment_id": 101245932, "body": "But if you aren&#39;t going to be using the <code>sa</code> account in the future, <i>why</i> does it matter? Why fix a broken car that you&#39;re going to scrap for the price of metal? It gains nothing apart from wasted time."}, {"owner": {"reputation": 242, "user_id": 6421957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4E3Qq.jpg?s=128&g=1", "display_name": "Robert Stefanic", "link": "https://stackoverflow.com/users/6421957/robert-stefanic"}, "reply_to_user": {"reputation": 59343, "user_id": 2029983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0118fb43d1ce086d768e295339cf0ff4?s=128&d=identicon&r=PG", "display_name": "Larnu", "link": "https://stackoverflow.com/users/2029983/larnu"}, "edited": false, "score": 0, "creation_date": 1565110507, "post_id": 57380629, "comment_id": 101245959, "body": "@Larnu Purely for understanding."}, {"owner": {"reputation": 242, "user_id": 6421957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4E3Qq.jpg?s=128&g=1", "display_name": "Robert Stefanic", "link": "https://stackoverflow.com/users/6421957/robert-stefanic"}, "edited": false, "score": 0, "creation_date": 1565110827, "post_id": 57380629, "comment_id": 101246097, "body": "Just to try it out, I&#39;ve made a new account on the remote DB and I have the same problem. If I try and connect, I get the error saying that <code>Login failed for user &#39;test_user&#39;</code>. However, if I take the username and password from my connection string, and paste them into SMSS, I can log in without any issues."}, {"owner": {"reputation": 30431, "user_id": 1507566, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/40b799a199eda9317d64e854c9fc8858?s=128&d=identicon&r=PG", "display_name": "Tab Alleman", "link": "https://stackoverflow.com/users/1507566/tab-alleman"}, "edited": false, "score": 0, "creation_date": 1565110916, "post_id": 57380629, "comment_id": 101246141, "body": "Is the database you are connecting to on the ROOT instance on the server?   Or on a named instance?"}, {"owner": {"reputation": 242, "user_id": 6421957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4E3Qq.jpg?s=128&g=1", "display_name": "Robert Stefanic", "link": "https://stackoverflow.com/users/6421957/robert-stefanic"}, "reply_to_user": {"reputation": 30431, "user_id": 1507566, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/40b799a199eda9317d64e854c9fc8858?s=128&d=identicon&r=PG", "display_name": "Tab Alleman", "link": "https://stackoverflow.com/users/1507566/tab-alleman"}, "edited": false, "score": 0, "creation_date": 1565111038, "post_id": 57380629, "comment_id": 101246189, "body": "@TabAlleman I&#39;m connecting to the Root instance."}, {"owner": {"reputation": 30515, "user_id": 3813116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DeWnw.png?s=128&g=1", "display_name": "Sean Lange", "link": "https://stackoverflow.com/users/3813116/sean-lange"}, "edited": false, "score": 0, "creation_date": 1565111170, "post_id": 57380629, "comment_id": 101246242, "body": "That error means invalid credentials. There has to be something you are missing here. Maybe it&#39;s not the server you think it is. Named instance, maybe some firewall settings that are redirecting IPs to another. This kind of debugging is almost impossible remotely, with no code and no access to anything."}, {"owner": {"reputation": 242, "user_id": 6421957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4E3Qq.jpg?s=128&g=1", "display_name": "Robert Stefanic", "link": "https://stackoverflow.com/users/6421957/robert-stefanic"}, "reply_to_user": {"reputation": 30515, "user_id": 3813116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DeWnw.png?s=128&g=1", "display_name": "Sean Lange", "link": "https://stackoverflow.com/users/3813116/sean-lange"}, "edited": false, "score": 0, "creation_date": 1565112901, "post_id": 57380629, "comment_id": 101247004, "body": "@SeanLange This was the tip that I needed. I did go back and double-check. It turns out that it was always connecting locally, even if I had the &quot;Data Source&quot; defined."}], "answers": [{"tags": [], "owner": {"reputation": 242, "user_id": 6421957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4E3Qq.jpg?s=128&g=1", "display_name": "Robert Stefanic", "link": "https://stackoverflow.com/users/6421957/robert-stefanic"}, "is_accepted": false, "score": 0, "last_activity_date": 1565112873, "creation_date": 1565112873, "answer_id": 57381323, "question_id": 57380629, "link": "https://stackoverflow.com/questions/57380629/unable-to-connect-to-remote-sqlserver-using-sa/57381323#57381323", "title": "Unable to connect to remote SQLServer using &#39;sa&#39;", "body": "<p>I figured out my problem.</p>\n\n<p>For the new user that I created (see the original post's comments), it couldn't connect because of my connection string.</p>\n\n<p>I tried first making my connection string the following, which still worked connecting me locally:</p>\n\n<pre><code>Initial Catalog=master;User Id=&lt;user&gt;;Password=&lt;password&gt;;\n</code></pre>\n\n<p>I was confused because this still worked, despite me not setting a Data Source.</p>\n\n<p>So what I did was try using \"Server\", and it worked:</p>\n\n<pre><code>Server=&lt;remoteIP&gt;;Initial Catalog=master;User Id=&lt;user&gt;;Password=&lt;password&gt;;\n</code></pre>\n\n<p>So it turns out it was an invalid credential error because it was always trying to connect to my local DB. Thanks for everyone's input.</p>\n"}], "owner": {"reputation": 242, "user_id": 6421957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4E3Qq.jpg?s=128&g=1", "display_name": "Robert Stefanic", "link": "https://stackoverflow.com/users/6421957/robert-stefanic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565112873, "creation_date": 1565109946, "question_id": 57380629, "link": "https://stackoverflow.com/questions/57380629/unable-to-connect-to-remote-sqlserver-using-sa", "title": "Unable to connect to remote SQLServer using &#39;sa&#39;", "body": "<p>I'm trying to connect to a remote instance of SQLServer using a connection string for a Go program that I'm writing.</p>\n\n<p>I have a local version of the remote database with the same users.</p>\n\n<p>If I connect to my local DB with a connection string like this, it works just fine:</p>\n\n<pre><code>Data Source=localhost;Initial Catalog=master;User Id=&lt;user&gt;;Password=&lt;password&gt;;\n</code></pre>\n\n<p>Now if I use the same credentials, but I just change the data source, it also works just fine:</p>\n\n<pre><code>Data Source=&lt;remoteIP&gt;;Initial Catalog=master;User Id=&lt;user&gt;;Password=&lt;password&gt;;\n</code></pre>\n\n<p>Now if I try and log in using 'sa', it works locally, but not remotely.</p>\n\n<p>This works just fine:</p>\n\n<pre><code>Data Source=localhost;Initial Catalog=master;User Id=sa;Password=&lt;password&gt;;\n</code></pre>\n\n<p>But this does not work:</p>\n\n<pre><code>Data Source=&lt;remoteIP&gt;;Initial Catalog=master;User Id=sa;Password=&lt;password&gt;;\n</code></pre>\n\n<p>The error I get when I try to connect to the remote server in my Go program is:</p>\n\n<pre><code>Login error: mssql: Login failed for user 'sa'.\n</code></pre>\n\n<p>The really frustrating part is that if I copy and paste the username and password, I can connect to the remote DB in SMSS using that login information, and everything works just fine.</p>\n\n<p>I've double-checked to ensure that the remote 'sa' login allows for both Windows Authentication and SQL Authentication. Is there another setting or something that would prevent me from being able to log in to my remote server using 'sa'? </p>\n\n<p>I'm so puzzled because I clearly can connect to the remote DB if I'm using a different user, but I can't connect using 'sa'. </p>\n\n<p>Are there additional settings I have to configure on the remote server? I'm also a bit frustrated with <a href=\"https://github.com/denisenkom/go-mssqldb\" rel=\"nofollow noreferrer\">this</a> because I can't print out what the actual error code is. It just tells me that my login failed when I print the error message.</p>\n"}, {"tags": ["go", "import", "formatter"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1565101595, "post_id": 57378282, "comment_id": 101241147, "body": "<i>Are there any situations, where only the second approach works and the factored import statement is not able to solve a particular issue?</i> No, it&#39;s purely style."}, {"owner": {"reputation": 726, "user_id": 387670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de92c7f1d6b452b9e2b3f38c11967cb8?s=128&d=identicon&r=PG", "display_name": "sahaj", "link": "https://stackoverflow.com/users/387670/sahaj"}, "edited": false, "score": 0, "creation_date": 1565103371, "post_id": 57378282, "comment_id": 101242221, "body": "There is no ambiguity here. Why do you say so?"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 1, "creation_date": 1565103677, "post_id": 57378282, "comment_id": 101242409, "body": "What is the <i>ambiguity</i> here?"}, {"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 1, "creation_date": 1565103909, "post_id": 57378282, "comment_id": 101242528, "body": "As Tim said it&#39;s entirely personal preference about which you choose. However, official Go docs highly recommend using the first syntax, and the go formatting tools (such as <code>gotfmt</code>) will reorganize your imports to use a single <code>import</code>."}, {"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 1, "creation_date": 1565104008, "post_id": 57378282, "comment_id": 101242576, "body": "Go tooling will make sure you generally need not worry about this."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 2, "creation_date": 1565104403, "post_id": 57378282, "comment_id": 101242796, "body": "In addition to <code>import</code>, the <code>var</code>, <code>const</code> and <code>type</code> declarations also have a parenthesized form. The <code>func</code> declaration is the only declaration that does not have a parenthesized form.   @Jesse: The <code>gofmt</code> tool does not reorganize imports to use the parenthesized form (click format <a href=\"https://tour.golang.org/basics/2\" rel=\"nofollow noreferrer\">here</a> to see how gofmt handles multiple imports)."}, {"owner": {"reputation": 3496, "user_id": 4541492, "user_type": "registered", "accept_rate": 35, "profile_image": "https://lh5.googleusercontent.com/-cOlHMb569P8/AAAAAAAAAAI/AAAAAAAADvQ/wlBHgpWKq7w/photo.jpg?sz=128", "display_name": "Vince Varga", "link": "https://stackoverflow.com/users/4541492/vince-varga"}, "edited": false, "score": 0, "creation_date": 1565105365, "post_id": 57378282, "comment_id": 101243338, "body": "Right, there&#39;s no ambiguity as the tour pointed out to use the factored import, but I wanted to know whether there&#39;s a situation where only the &quot;multiple import statements&quot; solution would work."}, {"owner": {"reputation": 3496, "user_id": 4541492, "user_type": "registered", "accept_rate": 35, "profile_image": "https://lh5.googleusercontent.com/-cOlHMb569P8/AAAAAAAAAAI/AAAAAAAADvQ/wlBHgpWKq7w/photo.jpg?sz=128", "display_name": "Vince Varga", "link": "https://stackoverflow.com/users/4541492/vince-varga"}, "edited": false, "score": 0, "creation_date": 1565105478, "post_id": 57378282, "comment_id": 101243398, "body": "I wondered why Go has multiple solutions for the same problem (&quot;import stuff&quot;), therefore the question: in some languages, there&#39;s the case when only one way to doing things can solve a particular problem."}, {"owner": {"reputation": 3496, "user_id": 4541492, "user_type": "registered", "accept_rate": 35, "profile_image": "https://lh5.googleusercontent.com/-cOlHMb569P8/AAAAAAAAAAI/AAAAAAAADvQ/wlBHgpWKq7w/photo.jpg?sz=128", "display_name": "Vince Varga", "link": "https://stackoverflow.com/users/4541492/vince-varga"}, "edited": false, "score": 1, "creation_date": 1565105615, "post_id": 57378282, "comment_id": 101243491, "body": "I tried to clarify the question and the title..."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1565118982, "post_id": 57378282, "comment_id": 101249534, "body": "Multiple import statements have made it easier for me to generate code in the past (you don&#39;t have to worry about empty import lists), but I don&#39;t know if that&#39;s the rationale for allowing it."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1565122498, "last_edit_date": 1565122498, "creation_date": 1565105982, "answer_id": 57379598, "question_id": 57378282, "link": "https://stackoverflow.com/questions/57378282/situations-where-multiple-statements-is-better-than-factored-import-statement/57379598#57379598", "title": "Situations where multiple statements is better than factored import statement?", "body": "<p>As pointed out by others, both forms can be used in all cases.</p>\n\n<p>This grouping is allowed in almost all top-level identifiers (<a href=\"https://golang.org/ref/spec#Import_declarations\" rel=\"nofollow noreferrer\"><code>import</code></a>, <a href=\"https://golang.org/ref/spec#Variable_declarations\" rel=\"nofollow noreferrer\"><code>var</code></a>, <a href=\"https://golang.org/ref/spec#Constant_declarations\" rel=\"nofollow noreferrer\"><code>const</code></a> and <a href=\"https://golang.org/ref/spec#Type_declarations\" rel=\"nofollow noreferrer\"><code>type</code></a>), and its purpose is to give you the possibility <em>to better organize and logically group your identifiers</em>. (Note that you may also group inside a function not just at the top-level.)</p>\n\n<p>With the case of <code>import</code>, tools like <code>gofmt</code> will order imports <em>within a group</em> primiarily by origin (standard lib or not), and secondary by import path alphabetically, but they don't reorganize between groups or the groups themselves.</p>\n\n<p>In case of <code>const</code> it has another significance: the keyword <code>const</code> resets the <a href=\"https://golang.org/ref/spec#Iota\" rel=\"nofollow noreferrer\"><code>iota</code></a> predeclared identifier, so properly grouping constants when using <code>iota</code> is vital.</p>\n\n<p>Other than that, it doesn't matter, you may use both forms. Group your identifiers based on their meaning and how they connect to each other. For example grouping a <code>sync.Mutex</code> with the variable it ought to protect is also handy:</p>\n\n<pre><code>var (\n    mu        sync.Mutex\n    protectMe int\n)\n\nfunc getMe() int {\n    mu.Lock()\n    me := protectMe\n    mu.Unlock()\n    return me\n}\n\nfunc setMe(me int) {\n    mu.Lock()\n    protectMe = me\n    mu.Unlock()\n}\n</code></pre>\n\n<p>(Example taken from <a href=\"https://stackoverflow.com/questions/52863273/how-to-make-a-variable-thread-safe/52882045#52882045\">How to make a variable thread-safe</a>.)</p>\n\n<blockquote>\n  <p>As I remember from the various Go talks I've watched, the Go programming language prides itself for being a simple, easy-to-use language that doesn't have 10 different ways to do one thing.</p>\n</blockquote>\n\n<p>Don't interpret this the wrong way. Both way of importing is the same, just formatted differently. Both specify the same set of imported packages. Just because a language allows you to add <code>a</code> and <code>b</code> in 2 ways, e.g. <code>a+b</code> and <code>b+a</code>, that doesn't mean a simple addition is allowed to be expressed in multiple ways.</p>\n"}], "owner": {"reputation": 3496, "user_id": 4541492, "user_type": "registered", "accept_rate": 35, "profile_image": "https://lh5.googleusercontent.com/-cOlHMb569P8/AAAAAAAAAAI/AAAAAAAADvQ/wlBHgpWKq7w/photo.jpg?sz=128", "display_name": "Vince Varga", "link": "https://stackoverflow.com/users/4541492/vince-varga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "closed_date": 1565110002, "answer_count": 1, "score": -5, "last_activity_date": 1565122498, "creation_date": 1565101514, "last_edit_date": 1565105964, "question_id": 57378282, "link": "https://stackoverflow.com/questions/57378282/situations-where-multiple-statements-is-better-than-factored-import-statement", "closed_reason": "Opinion-based", "title": "Situations where multiple statements is better than factored import statement?", "body": "<p>The <a href=\"https://tour.golang.org/basics/2\" rel=\"nofollow noreferrer\">\"A Tour of Go\"</a> guide says:</p>\n\n<blockquote>\n  <p>This code groups the imports into a parenthesized, \"factored\" import statement.</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"math\"\n)\n</code></pre>\n  \n  <p>You can also write multiple import statements, like:</p>\n\n<pre><code>import \"fmt\"\nimport \"math\"\n</code></pre>\n  \n  <p>But it is good style to use the factored import statement.</p>\n</blockquote>\n\n<p>As I remember from the various Go talks I've watched, the Go programming language prides itself for being a simple, easy-to-use language that doesn't have 10 different ways to do one thing.</p>\n\n<p>Is there any reason why there are multiple solutions to do the same thing? Are there any situations, where only the second approach works and the factored import statement is not able to solve a particular issue?</p>\n"}, {"tags": ["go", "discord"], "comments": [{"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1565104045, "post_id": 57378148, "comment_id": 101242592, "body": "Ensure your bot has delete permissions. <code>ChannelMessageDelete</code> will return an error that you can inspect as well."}, {"owner": {"reputation": 1954, "user_id": 10048799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43e3b78b616247e7b5a2fcfde299bcfb?s=128&d=identicon&r=PG&f=1", "display_name": "kaleidawave", "link": "https://stackoverflow.com/users/10048799/kaleidawave"}, "reply_to_user": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1565105623, "post_id": 57378148, "comment_id": 101243495, "body": "@Jesse Yes that works, they need to have <code>Manage Messages</code> checkbox for creating the oauth url, put this as answer and I will accept"}, {"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1565194093, "post_id": 57378148, "comment_id": 101278372, "body": "You can actually post an answer to your own question -- I don&#39;t want to take credit for a solution that you found"}], "answers": [{"tags": [], "owner": {"reputation": 1954, "user_id": 10048799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43e3b78b616247e7b5a2fcfde299bcfb?s=128&d=identicon&r=PG&f=1", "display_name": "kaleidawave", "link": "https://stackoverflow.com/users/10048799/kaleidawave"}, "is_accepted": true, "score": 0, "last_activity_date": 1565194540, "creation_date": 1565194540, "answer_id": 57398556, "question_id": 57378148, "link": "https://stackoverflow.com/questions/57378148/deleting-a-discord-message-from-discordgo/57398556#57398556", "title": "Deleting a discord message from discordgo", "body": "<p>The reason it was not posting was because the bot did not have the <code>Manage Messages</code> permission. This can be done by checking the <code>Manage Messages</code> checkbox when generating the invite link on the OAuth tab.</p>\n"}], "owner": {"reputation": 1954, "user_id": 10048799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43e3b78b616247e7b5a2fcfde299bcfb?s=128&d=identicon&r=PG&f=1", "display_name": "kaleidawave", "link": "https://stackoverflow.com/users/10048799/kaleidawave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 323, "favorite_count": 0, "accepted_answer_id": 57398556, "answer_count": 1, "score": 0, "last_activity_date": 1565194540, "creation_date": 1565101032, "question_id": 57378148, "link": "https://stackoverflow.com/questions/57378148/deleting-a-discord-message-from-discordgo", "title": "Deleting a discord message from discordgo", "body": "<p>I am trying to delete a discord message using <a href=\"https://github.com/bwmarrin/discordgo\" rel=\"nofollow noreferrer\">discordgo</a>. Currently I have the <a href=\"https://github.com/bwmarrin/discordgo/tree/master/examples/pingpong\" rel=\"nofollow noreferrer\">ping pong example</a>, however instead of writing a message I want to delete the message. </p>\n\n<p>I have currently got this far:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func messageCreate(s *discordgo.Session, m *discordgo.MessageCreate) {\n\n    if m.Author.ID == s.State.User.ID || m.Author.Bot {\n        return\n    }\n\n    if m.Content == \"ping\" {\n        s.ChannelMessageDelete(m.ChannelID, m.ID)\n    }\n}\n</code></pre>\n\n<p>But the implementation does not delete the message even though other code in the block will run. I am a bit of a newb to go and I don't know if there is some future error .. or something like the bot does not have the correct discord permissions?</p>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1565098647, "post_id": 57377050, "comment_id": 101239166, "body": "Show more code. The likely problem is this: closeConnection called from graceful stop causes read to return an error, error code path for read calls closeConnection again.  Run the application with <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">the race detector</a>.  It looks like there&#39;s a data race on <code>connections</code>."}, {"owner": {"reputation": 358, "user_id": 8052180, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-eKVGgulTNJo/AAAAAAAAAAI/AAAAAAAAF1Q/xXMAVh9UEuE/photo.jpg?sz=128", "display_name": "Mattia Costamagna", "link": "https://stackoverflow.com/users/8052180/mattia-costamagna"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565100042, "post_id": 57377050, "comment_id": 101240094, "body": "I edited my question with the closeConnection function. I tried running the application with the race detector, and <code>closeConnection</code> appears multiple times in the stacktrace. What should I do?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1565100482, "post_id": 57377050, "comment_id": 101240367, "body": "Protect <code>connections</code> with a mutex."}, {"owner": {"reputation": 358, "user_id": 8052180, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-eKVGgulTNJo/AAAAAAAAAAI/AAAAAAAAF1Q/xXMAVh9UEuE/photo.jpg?sz=128", "display_name": "Mattia Costamagna", "link": "https://stackoverflow.com/users/8052180/mattia-costamagna"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565100991, "post_id": 57377050, "comment_id": 101240738, "body": "Yeah that solved it, even though I can&#39;t explain why the defer function in the wsHandler didn&#39;t do anything with the time.Sleep in the graceful stop goroutine. Anyway if you want to post your comment as an answer, I can mark it as the solution. Thanks a lot!"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565111484, "post_id": 57377050, "comment_id": 101246373, "body": "Because wsHandler code is not shown, it&#39;s not clear to me and others who might read this question how fixing the data race solved the problem."}, {"owner": {"reputation": 358, "user_id": 8052180, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-eKVGgulTNJo/AAAAAAAAAAI/AAAAAAAAF1Q/xXMAVh9UEuE/photo.jpg?sz=128", "display_name": "Mattia Costamagna", "link": "https://stackoverflow.com/users/8052180/mattia-costamagna"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565159724, "post_id": 57377050, "comment_id": 101259391, "body": "I added the <code>wsHandler</code> part, hoping it&#39;s of any help. The closeConnection function is not called anywhere else."}], "owner": {"reputation": 358, "user_id": 8052180, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-eKVGgulTNJo/AAAAAAAAAAI/AAAAAAAAF1Q/xXMAVh9UEuE/photo.jpg?sz=128", "display_name": "Mattia Costamagna", "link": "https://stackoverflow.com/users/8052180/mattia-costamagna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 228, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565159643, "creation_date": 1565097619, "last_edit_date": 1565159643, "question_id": 57377050, "link": "https://stackoverflow.com/questions/57377050/gorilla-websocket-disconnect-is-called-two-times", "title": "Gorilla websocket disconnect is called two times", "body": "<p>I'm writing a Go websocket server and I want to graceful stop the connections when my server goes down.\nI have a map of active connections stored in the following variable:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var connections = make(map[string]*websocket.Conn)\n</code></pre>\n\n<p>My main function looks like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nfunc main() {\n    // ... stuff ....\n\n    gracefulStop := make(chan os.Signal)\n    signal.Notify(gracefulStop, syscall.SIGTERM)\n    signal.Notify(gracefulStop, syscall.SIGINT)\n    signal.Notify(gracefulStop, syscall.SIGQUIT)\n    signal.Notify(gracefulStop, syscall.SIGKILL)\n    signal.Notify(gracefulStop, syscall.SIGHUP)\n\n    go func() {\n        sig := &lt;-gracefulStop\n        log.Printf(\"Exiting from process due to %+v\", sig)\n        log.Println(\"Closing all websocket connections\")\n        for id, conn := range connections {\n            closeConnection(id, conn)\n        }\n        os.Exit(0)\n    }()\n\n    r := mux.NewRouter()\n    r.HandleFunc(\"/{id}\", wsHandler)\n    err := http.ListenAndServe(fmt.Sprintf(\":%d\", *argPort), r)\n    if err != nil {\n        log.Println(\"Could not start http server\")\n        log.Println(err)\n    }\n}\n</code></pre>\n\n<p><code>closeConnection</code> does 4 things:</p>\n\n<ul>\n<li><code>conn.Close()</code></li>\n<li>sets conn as nil</li>\n<li>removes the id from the map</li>\n<li>calls an AWS Lambda function</li>\n</ul>\n\n<p>The same function is called as a <code>defer</code> function inside the <code>wsHandler</code> function, so if a client disconnects by its own, I execute function in the handler.</p>\n\n<p>It's all working nicely, except that when I ctrl+c the server my <code>closeConnection</code> function is called two times per client, one in the graceful stop handler and the other in the wsHandler defer function.\nI tried to check in my <code>closeConnection</code> function if the connection is still defined in <code>connections</code>, but it returns true both of the times.</p>\n\n<p>I thought that it was due to the fact that they are called two times because they are in different goroutines, so I replaced the for loop above with just a <code>time.Sleep(2 * time.Second)</code>, but in this case nothing happens (the <code>closeConnection</code> inside the <code>wsHandler</code> defer function is not even called).\nThis is what I mean:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>go func() {\n    sig := &lt;-gracefulStop\n    log.Printf(\"Exiting from process due to %+v\", sig)\n    log.Println(\"Closing all websocket connections\")\n    // for chargeboxIdentity, conn := range connections {\n    //  chargeboxDisconnected(chargeboxIdentity, conn)\n    // }\n    time.Sleep(2 * time.Second)\n    os.Exit(0)\n}()\n</code></pre>\n\n<p>EDIT: Here is the <code>closeConnection</code> function:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func closeConnection(id string, conn *websocket.Conn) {\n    _, ok := connections[id]\n    log.Println(ok)\n    log.Printf(\"%s (%s) disconnected\", id, conn.RemoteAddr())\n    conn.WriteMessage(websocket.CloseMessage, websocket.FormatCloseMessage(websocket.CloseNormalClosure, \"\"))\n    time.Sleep(300 * time.Millisecond)\n    conn.Close()\n    conn = nil\n    delete(connections, id)\n\n    request := LambdaPayload{ID: id}\n    payload, err := json.Marshal(request)\n    if err != nil {\n        log.Println(\"Could not create payload for lambda call\")\n        log.Println(err)\n        return\n    }\n    _, err = client.Invoke(&amp;lambda.InvokeInput{FunctionName: aws.String(lambdaPrefix + \"MainDisconnect\"), Payload: payload})\n    if err != nil {\n        log.Println(\"Disconnect Lambda returned an error\")\n        log.Println(err)\n    }\n}\n</code></pre>\n\n<p>EDIT: Here's the <code>wsHandler</code> function:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func wsHandler(w http.ResponseWriter, r *http.Request) {\n    conn, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        log.Println(\"Could not upgrade websocket connection\")\n        log.Println(err)\n        return\n    }\n\n    vars := mux.Vars(r)\n    if !clientConnected(vars[\"id\"], conn) {\n        return\n    }\n    defer closeConnection(vars[\"id\"], conn)\n    for {\n        msgType, msg, err := conn.ReadMessage()\n        if err != nil {\n            break\n        }\n\n        log.Printf(\"%s sent: %s\", vars[\"id\"], string(msg))\n\n        // ... stuff ...\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1565096441, "post_id": 57376607, "comment_id": 101237691, "body": "Have you read the documentation on callbacks? <a href=\"https://github.com/golang/go/wiki/cgo#function-pointer-callbacks\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/cgo#function-pointer-callbacks</a>"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user11213886"}, "is_accepted": true, "score": 1, "last_activity_date": 1565181839, "creation_date": 1565181839, "answer_id": 57394814, "question_id": 57376607, "link": "https://stackoverflow.com/questions/57376607/how-to-pass-a-go-function-as-an-argument-to-a-c-function/57394814#57394814", "title": "How to pass a Go function as an argument to a C function?", "body": "<p>the main problem is misunderstanding of definition of go in c. \nso final code is look like </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\n//export callOnMeGo\nfunc callOnMeGo(in int) int {\n    fmt.Printf(\"Go.callOnMeGo(): called with arg = %d\\n\", in)\n    return  in+ 1\n}\n\nfunc main() {\n\n    C.some_c_func((C.callback_fcn)(unsafe.Pointer(C.callOnMeGo_cgo)))\n    //dont forget to use (funcDefinedInGO_cgo) for with postfix _cgo\n\n...\n\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11213886"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 57394814, "answer_count": 1, "score": 1, "last_activity_date": 1565181839, "creation_date": 1565096194, "last_edit_date": 1565175636, "question_id": 57376607, "link": "https://stackoverflow.com/questions/57376607/how-to-pass-a-go-function-as-an-argument-to-a-c-function", "title": "How to pass a Go function as an argument to a C function?", "body": "<p>I'm trying to pass a Go function to a C function.</p>\n\n<p>Something like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>stm := C.struct_tray_menu{\n    ....\n    fn: // definition of method\n    ....\n}\nC.menu_cb(stm);\n</code></pre>\n\n<p>and pass that into a C function:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>static void menu_cb(struct tray_menu *item) {\n  (void)item;\n  printf(\"menu: clicked on %s\\n\", item-&gt;text);\n}\n</code></pre>\n\n<p>I'd just like to know how to define something like C.function.</p>\n"}, {"tags": ["go", "rabbitmq"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1565167739, "post_id": 57375790, "comment_id": 101263217, "body": "Define &quot;better&quot;. I could argue that writing simple code is much more efficient than writing complex code, as it saves developer time (which is expensive). Or that using a lot of memory is actually better than to have it idle around unused. Aside from that, I&#39;d go for the former code variant and use <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">a fan out pattern</a> downstream."}, {"owner": {"reputation": 5356, "user_id": 1885921, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/02ba513b62ef9f2f7798b9bac1ccf822?s=128&d=identicon&r=PG", "display_name": "vodolaz095", "link": "https://stackoverflow.com/users/1885921/vodolaz095"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1565175078, "post_id": 57375790, "comment_id": 101267215, "body": "i updated question - better for me is - code uses less ram, and it can process more messages on the same sime. Fan out pattern seems not working when i tried to implement it, since <code>d</code> - amqp messages, <code>ack</code> and <code>nack</code> seems to be not thread safe..."}], "answers": [{"tags": [], "owner": {"reputation": 1171, "user_id": 9797889, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dbyrHkUWT34/AAAAAAAAAAI/AAAAAAAAAAs/k6bfDfWiiDw/photo.jpg?sz=128", "display_name": "menya", "link": "https://stackoverflow.com/users/9797889/menya"}, "is_accepted": true, "score": 1, "last_activity_date": 1565240165, "creation_date": 1565240165, "answer_id": 57405415, "question_id": 57375790, "link": "https://stackoverflow.com/questions/57375790/rabbitmq-consumer-perfomance-prefetch-vs-concurency/57405415#57405415", "title": "RabbitMQ consumer perfomance - prefetch vs concurency", "body": "<p>I suppose each <code>processMessage()</code> run in a new goroutine.</p>\n\n<blockquote>\n  <p>Which variant is better?</p>\n</blockquote>\n\n<p>I prefer the first one, because open/close channel is a little bit expensive (2 + 2 TCP packets). I think your OOM problem is not related to too many gorutine, gorutine is very light, just cost about 5KB. So the problem is probably caused by your <code>processMessage()</code>.  </p>\n\n<p>I think the <code>github.com/streadway/amqp</code> channel consume operation is <a href=\"https://github.com/streadway/amqp/pull/321\" rel=\"nofollow noreferrer\">thread/gorutine-safe</a>, so it is safe to share channel between goruntine if you just do some consume operation.</p>\n"}], "owner": {"reputation": 5356, "user_id": 1885921, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/02ba513b62ef9f2f7798b9bac1ccf822?s=128&d=identicon&r=PG", "display_name": "vodolaz095", "link": "https://stackoverflow.com/users/1885921/vodolaz095"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 479, "favorite_count": 1, "accepted_answer_id": 57405415, "answer_count": 1, "score": 1, "last_activity_date": 1565240165, "creation_date": 1565093481, "last_edit_date": 1565175548, "question_id": 57375790, "link": "https://stackoverflow.com/questions/57375790/rabbitmq-consumer-perfomance-prefetch-vs-concurency", "title": "RabbitMQ consumer perfomance - prefetch vs concurency", "body": "<p>I have a Go application processing events from a single RabbitMQ queue. I use the <a href=\"https://github.com/streadway/amqp\" rel=\"nofollow noreferrer\"><code>github.com/streadway/amqp</code></a> RabbitMQ Client Library.</p>\n\n<p>The Go application processes every message in ~2-3 seconds. It's possible to process ~1000 or even more messages in parallel, if I feed them from memory.\nBut, unfortunately, RabbitMQ performance is worse.\nSo, I want to consume messages from queue faster.</p>\n\n<p>So, the question is: how to consume messages in most effective manner using <code>github.com/streadway/amqp</code>?</p>\n\n<p>As far as I understand, there are two approaches:</p>\n\n<ol>\n<li><p>set high prefetch</p>\n\n<p><a href=\"https://godoc.org/github.com/streadway/amqp#Channel.Qos\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/streadway/amqp#Channel.Qos</a>. </p>\n\n<p>Use single consumer goroutine</p>\n\n<p>Example code:</p></li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>conn, err := amqp.Dial(\"amqp://guest:guest@localhost:5672/\")\nfailOnError(err, \"Failed to connect to RabbitMQ\")\ndefer conn.Close()\n\nch, err := conn.Channel()\nfailOnError(err, \"Failed to open a channel\")\ndefer ch.Close()\n\nch.Qos(\n        10000,           // prefetch count\n        0,               // prefetch size\n        false,           // global\n    )\n\nmsgs, err := ch.Consume(\n  q.Name, // queue\n  \"\",     // consumer\n  false,  // NO auto-ack\n  false,  // exclusive\n  false,  // no-local\n  false,  // no-wait\n  nil,    // args\n)\n\nfor d := range msgs {\n  log.Printf(\"Received a message: %s\", d.Body)\n  err:= processMessage(d)\n  if err != nil {\n      log.Printf(\"%s : while consuming task\", err)\n      d.Nack(false, true)\n  } else {\n      d.Ack(false)\n  }\n  continue // consume other messages\n}\n\n</code></pre>\n\n<p>But DO the <code>processMessage</code> will be called here in parallel?</p>\n\n<ol start=\"2\">\n<li>spawn many channels and use multiple consumers</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>conn, err := amqp.Dial(\"amqp://guest:guest@localhost:5672/\")\nfailOnError(err, \"Failed to connect to RabbitMQ\")\ndefer conn.Close()\nvar i = 0\nfor i = 0; i&lt;=100; i++ {\n  go func(){\n      ch, err := conn.Channel()\n      failOnError(err, \"Failed to open a channel\")\n      defer ch.Close()\n\n      ch.Qos(\n            10,           // prefetch count\n            0,               // prefetch size\n            false,           // global\n    )\n\n      msgs, err := ch.Consume(\n        q.Name, // queue\n        \"\",     // consumer\n        false,  // NO auto-ack\n        false,  // exclusive\n        false,  // no-local\n        false,  // no-wait\n        nil,    // args\n      )\n\n      for d := range msgs {\n        log.Printf(\"Received a message: %s\", d.Body)\n        err:= processMessage(d)\n        if err != nil {\n            log.Printf(\"%s : while consuming task\", err)\n            d.Nack(false, true)\n        } else {\n            d.Ack(false)\n        }\n        continue // consume other messages\n      }\n  }()\n}\n</code></pre>\n\n<p>But is this a RAM friendly approach? Isn't spawning a new channel for each worker is quite dramatic for RabbitMQ?</p>\n\n<p>So, question is, which variant is better? Better performance, better memory usage, etc.</p>\n\n<p>So, what is the optimal usage of RabbitMQ here?</p>\n\n<p>Update: currently, I encountered a case when my worker consumes all RAM on VPS, and is OOM-killed. I used second approach for it. So, better in my case is ability to keep my worker without OOM killing after few minutes of work.</p>\n\n<p>Update 2: <code>nack</code> when worker failed to process message, and <code>ack</code> when worker processed message is very important. All messages has to be processed (its customers analytics), but sometimes worker cannot process it, so it have to <code>nack</code> message to pass it to other workers (currently, some 3rd party api used to process messages sometimes simply returns 503 status code, in this case message should be passed to other worker or retried).\nSO, using <code>auto-ack</code> is unfortunately not an option.</p>\n"}, {"tags": ["go", "google-cloud-functions", "google-cloud-logging"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 8567612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f0a77188f1f1bc2d8c1a92b0d654b2?s=128&d=identicon&r=PG&f=1", "display_name": "nephe", "link": "https://stackoverflow.com/users/8567612/nephe"}, "edited": false, "score": 0, "creation_date": 1565184395, "post_id": 57376051, "comment_id": 101272750, "body": "I have tried using that library but I cannot get it working. It doesn&#39;t returned any errors but nothing is logged to stackdriver."}, {"owner": {"reputation": 768, "user_id": 8905352, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/xUuYD.jpg?s=128&g=1", "display_name": "Miguel", "link": "https://stackoverflow.com/users/8905352/miguel"}, "reply_to_user": {"reputation": 21, "user_id": 8567612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f0a77188f1f1bc2d8c1a92b0d654b2?s=128&d=identicon&r=PG&f=1", "display_name": "nephe", "link": "https://stackoverflow.com/users/8567612/nephe"}, "edited": false, "score": 0, "creation_date": 1565190828, "post_id": 57376051, "comment_id": 101276675, "body": "Hello @nephe I have modified my answer with another possible solution for you. i would also like you to run this command: <code>gcloud functions logs read FUNCTION_NAME</code>, and verify if you can see the logs in there."}, {"owner": {"reputation": 21, "user_id": 8567612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f0a77188f1f1bc2d8c1a92b0d654b2?s=128&d=identicon&r=PG&f=1", "display_name": "nephe", "link": "https://stackoverflow.com/users/8567612/nephe"}, "edited": false, "score": 0, "creation_date": 1565243275, "post_id": 57376051, "comment_id": 101292763, "body": "I have tried and it also returns logs without any level, only the ones produced by standard logger, not the one that you have lined. Can you link me to issue where I can monitor when this kind of support will be added to GCF in Go?"}, {"owner": {"reputation": 768, "user_id": 8905352, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/xUuYD.jpg?s=128&g=1", "display_name": "Miguel", "link": "https://stackoverflow.com/users/8905352/miguel"}, "reply_to_user": {"reputation": 21, "user_id": 8567612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f0a77188f1f1bc2d8c1a92b0d654b2?s=128&d=identicon&r=PG&f=1", "display_name": "nephe", "link": "https://stackoverflow.com/users/8567612/nephe"}, "edited": false, "score": 0, "creation_date": 1565344152, "post_id": 57376051, "comment_id": 101333130, "body": "I have found <a href=\"https://issuetracker.google.com/124403972\" rel=\"nofollow noreferrer\">this</a> public issue requesting the implementation of logging severity for GCF in general. In addition, I&#39;ve created <a href=\"https://issuetracker.google.com/139174817\" rel=\"nofollow noreferrer\">this</a> issue requesting logging severity for GCF in Go specifically."}], "tags": [], "owner": {"reputation": 768, "user_id": 8905352, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/xUuYD.jpg?s=128&g=1", "display_name": "Miguel", "link": "https://stackoverflow.com/users/8905352/miguel"}, "is_accepted": false, "score": 2, "last_activity_date": 1565190651, "last_edit_date": 1592644375, "creation_date": 1565094413, "answer_id": 57376051, "question_id": 57375515, "link": "https://stackoverflow.com/questions/57375515/logs-from-gcf-in-go-doesnt-contains-log-level/57376051#57376051", "title": "Logs from GCF in Go doesn&#39;t contains log level", "body": "<p>Cloud Support here! What you are trying to do is not possible, as specified in the <a href=\"https://cloud.google.com/functions/docs/monitoring/logging#functions-log-helloworld-go\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n<blockquote>\n<ul>\n<li><p>Logs to <strong>stdout</strong> or <strong>stderr</strong> do not have an associated log level.</p>\n</li>\n<li><p>Internal system messages have the <strong>DEBUG</strong> log level.</p>\n</li>\n</ul>\n</blockquote>\n<p>What you probably need is to use <a href=\"https://godoc.org/cloud.google.com/go/logging\" rel=\"nofollow noreferrer\">Logging API</a>, specifically the <a href=\"https://godoc.org/cloud.google.com/go/logging#hdr-Log_Levels\" rel=\"nofollow noreferrer\">Log Levels</a> section.</p>\n<p>If this is not working for you either you could try using <code>node.js</code> instead of <code>go</code> as it <a href=\"https://cloud.google.com/functions/docs/monitoring/logging#functions-log-helloworld-nodejs\" rel=\"nofollow noreferrer\">currently emits logs</a> to <code>INFO</code> and <code>ERROR</code> levels using <code>console.log()</code> and <code>console.error()</code> respectively.</p>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 8567612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f0a77188f1f1bc2d8c1a92b0d654b2?s=128&d=identicon&r=PG&f=1", "display_name": "nephe", "link": "https://stackoverflow.com/users/8567612/nephe"}, "edited": false, "score": 0, "creation_date": 1565176069, "post_id": 57379258, "comment_id": 101267755, "body": "I have tried with formatter that you have provided but it still behaves in invalid way.  Everything is added as text payload <code>textPayload:  &quot;{&quot;httpRequest&quot;:{&quot;requestMethod&quot;:&quot;POST&quot;,&quot;status&quot;:200,&quot;respon&zwnj;&#8203;seSize&quot;:&quot;31337&quot;,&quot;use&zwnj;&#8203;rAgent&quot;:&quot;Go-http-cli&zwnj;&#8203;ent&#47;1.1&quot;,&quot;latency&quot;:{&zwnj;&#8203;&quot;nanos&quot;:123000000}},&zwnj;&#8203;&quot;message&quot;:&quot;additiona&zwnj;&#8203;l info&quot;,&quot;severity&quot;:&quot;INFO&quot;,&quot;timestamp&quot;:{&quot;seconds&quot;:1565175967,&quot;n&zwnj;&#8203;anos&quot;:261743604}}&quot; </code>"}, {"owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "reply_to_user": {"reputation": 21, "user_id": 8567612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f0a77188f1f1bc2d8c1a92b0d654b2?s=128&d=identicon&r=PG&f=1", "display_name": "nephe", "link": "https://stackoverflow.com/users/8567612/nephe"}, "edited": false, "score": 0, "creation_date": 1565178381, "post_id": 57379258, "comment_id": 101269121, "body": "Yes, there is a tricky thing. Look at the line 11 <code>log &quot;github.com&#47;sirupsen&#47;logrus&quot;</code> I rename the logrus package to log. Then I use log.debugf(...) for logging in debug level. The formater only transform the output in fluentD format, for an understable ingestion by stackdriver."}, {"owner": {"reputation": 21, "user_id": 8567612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f0a77188f1f1bc2d8c1a92b0d654b2?s=128&d=identicon&r=PG&f=1", "display_name": "nephe", "link": "https://stackoverflow.com/users/8567612/nephe"}, "edited": false, "score": 0, "creation_date": 1565179708, "post_id": 57379258, "comment_id": 101269839, "body": "I am not sure if I understand you. I am using los as <code>github.com&#47;sirupsen&#47;logrus</code>. Then I set formatter as <code>joonix</code> and set level as <code>Debug</code>. However it still results as text payload in stackdriver."}, {"owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "reply_to_user": {"reputation": 21, "user_id": 8567612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f0a77188f1f1bc2d8c1a92b0d654b2?s=128&d=identicon&r=PG&f=1", "display_name": "nephe", "link": "https://stackoverflow.com/users/8567612/nephe"}, "edited": false, "score": 0, "creation_date": 1565184061, "post_id": 57379258, "comment_id": 101272512, "body": "You are right. This works on Cloud Run and GCE/GKE but not on Cloud Function. I performed some tests with different logger configuration. I don&#39;t understand what is different and why it doesn&#39;t work."}], "tags": [], "owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "is_accepted": false, "score": 0, "last_activity_date": 1565178652, "last_edit_date": 1565178652, "creation_date": 1565104831, "answer_id": 57379258, "question_id": 57375515, "link": "https://stackoverflow.com/questions/57375515/logs-from-gcf-in-go-doesnt-contains-log-level/57379258#57379258", "title": "Logs from GCF in Go doesn&#39;t contains log level", "body": "<p>you can use external library which allow you to set the log level. <a href=\"https://github.com/guillaumeblaquiere/bqToFtp/blob/master/BqToFtp.go\" rel=\"nofollow noreferrer\">Here</a> an example of what I use.\nUse logrus for setting the minimal log level (you can improve this code by providing log level in env var) and joonix for fluentd formatter.(line 25)</p>\n\n<p>A point of attention. Line 11, I rename the logrus package log\n<code>log \"github.com/sirupsen/logrus\"</code>\nThus, don't use log standard library, but logrus library. It's sometime boring... you can simply replace log by logrus for avoiding all confusion.</p>\n\n<p>Joonix is a fluentD formatter for transforming the logs into an ingestable format for Stackdriver.</p>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 8567612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f0a77188f1f1bc2d8c1a92b0d654b2?s=128&d=identicon&r=PG&f=1", "display_name": "nephe", "link": "https://stackoverflow.com/users/8567612/nephe"}, "edited": false, "score": 2, "creation_date": 1575884632, "post_id": 58540026, "comment_id": 104702404, "body": "Thanks, it looks that it is working properly and it is setting valid error levels."}, {"owner": {"reputation": 154, "user_id": 10316247, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--EoxDyFKf8Y/AAAAAAAAAAI/AAAAAAAAAuM/gd0UM-OmTx8/photo.jpg?sz=128", "display_name": "nicolasassi", "link": "https://stackoverflow.com/users/10316247/nicolasassi"}, "edited": false, "score": 0, "creation_date": 1593978012, "post_id": 58540026, "comment_id": 110959034, "body": "Hi, I would like to know what permissions should I give my functions so they can use the API. I&#39;m currently receiving an permission error while trying to use in my code"}], "tags": [], "owner": {"reputation": 1194, "user_id": 867786, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe6d059c1c0e24de78b23bcd44398f02?s=128&d=identicon&r=PG", "display_name": "Nuno Cruces", "link": "https://stackoverflow.com/users/867786/nuno-cruces"}, "is_accepted": false, "score": 2, "last_activity_date": 1594225953, "last_edit_date": 1594225953, "creation_date": 1571915247, "answer_id": 58540026, "question_id": 57375515, "link": "https://stackoverflow.com/questions/57375515/logs-from-gcf-in-go-doesnt-contains-log-level/58540026#58540026", "title": "Logs from GCF in Go doesn&#39;t contains log level", "body": "<p>The Go 1.13 runtime no longer sets the environment variables needed for my previous approach to work.</p>\n<p>Created a new library that takes a different approach:\n<a href=\"https://pkg.go.dev/github.com/ncruces/go-gcp/glog\" rel=\"nofollow noreferrer\"><code>github.com/ncruces/go-gcp/glog</code></a></p>\n<p>On the plus side, the new version is compatible with Google Cloud Run. It also works on the Go 1.11 runtime.</p>\n<p>Usage:</p>\n<pre><code>func HelloWorld(w http.ResponseWriter, r *http.Request) {\n    glog.Infoln(&quot;Hello logs&quot;)\n    glog.Errorln(&quot;Hello logs&quot;)\n}\n</code></pre>\n<hr />\n<h3>Previous answer</h3>\n<p>You're welcome to use the following library:\n<a href=\"https://godoc.org/github.com/ncruces/go-gcf/logging\" rel=\"nofollow noreferrer\"><code>github.com/ncruces/go-gcf/logging</code></a></p>\n<p>Log levels are supported, and so are execution ids.</p>\n<p>Usage:</p>\n<pre><code>func HelloWorld(w http.ResponseWriter, r *http.Request) {\n    ctx := logging.ForRequest(r)\n    // ...\n    logging.Info(ctx).Println(&quot;Hello logs&quot;)\n    logging.Error(ctx).Println(&quot;Hello logs&quot;)\n}\n</code></pre>\n<p>Or, for a background function:</p>\n<pre><code>func HelloBackground(ctx context.Context, m interface{}) error {\n    logging.Info(ctx).Println(&quot;Hello logs&quot;)\n    logging.Error(ctx).Println(&quot;Hello logs&quot;)\n    return nil\n}\n</code></pre>\n<p>Full disclosure: I'm the author.\nI've been using it in production for 6 months.\nFeedback is appreciated.</p>\n"}, {"tags": [], "owner": {"reputation": 811, "user_id": 1345269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/166c7f38d7f4a4994041622680c006a1?s=128&d=identicon&r=PG", "display_name": "Douglas Manley", "link": "https://stackoverflow.com/users/1345269/douglas-manley"}, "is_accepted": false, "score": 1, "last_activity_date": 1576470790, "creation_date": 1576470790, "answer_id": 59350590, "question_id": 57375515, "link": "https://stackoverflow.com/questions/57375515/logs-from-gcf-in-go-doesnt-contains-log-level/59350590#59350590", "title": "Logs from GCF in Go doesn&#39;t contains log level", "body": "<p>I, too, took a stab at creating a package for this.  If you use logrus (<a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">https://github.com/sirupsen/logrus</a>), then this may be helpful:</p>\n\n<p><a href=\"https://github.com/tekkamanendless/gcfhook\" rel=\"nofollow noreferrer\">https://github.com/tekkamanendless/gcfhook</a></p>\n\n<p>I'm using this in production, and it's working just fine.</p>\n"}, {"tags": [], "owner": {"reputation": 3359, "user_id": 122727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5e946def051f311e802140ecb9fbf?s=128&d=identicon&r=PG", "display_name": "kubanczyk", "link": "https://stackoverflow.com/users/122727/kubanczyk"}, "is_accepted": false, "score": 0, "last_activity_date": 1611581561, "creation_date": 1611581561, "answer_id": 65885782, "question_id": 57375515, "link": "https://stackoverflow.com/questions/57375515/logs-from-gcf-in-go-doesnt-contains-log-level/65885782#65885782", "title": "Logs from GCF in Go doesn&#39;t contains log level", "body": "<p>I recommend the <a href=\"https://github.com/apsystole/log\" rel=\"nofollow noreferrer\">https://github.com/apsystole/log</a>. It's also log- and logrus-compatible, but a small <strong>zero-dependency</strong> module unlike the libraries used in two existing answers which bring 400+ modules as their dependencies (gasp... I am simply looking at <code>go mod graph</code>).</p>\n"}], "owner": {"reputation": 21, "user_id": 8567612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f0a77188f1f1bc2d8c1a92b0d654b2?s=128&d=identicon&r=PG&f=1", "display_name": "nephe", "link": "https://stackoverflow.com/users/8567612/nephe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1147, "favorite_count": 0, "answer_count": 5, "score": 2, "last_activity_date": 1611581561, "creation_date": 1565092510, "last_edit_date": 1565093549, "question_id": 57375515, "link": "https://stackoverflow.com/questions/57375515/logs-from-gcf-in-go-doesnt-contains-log-level", "title": "Logs from GCF in Go doesn&#39;t contains log level", "body": "<p>I am trying send info/error logs to StackDriver Logging on GCP from Cloud Function written in Go, however all logs dosen't have log level assignment. </p>\n\n<p>I have created function from <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/blob/master/functions/helloworld/hello_logging.go\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/golang-samples/blob/master/functions/helloworld/hello_logging.go</a>\nto demonstrate problem.</p>\n\n<p><a href=\"https://i.stack.imgur.com/avnlQ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/avnlQ.png\" alt=\"link to image with logs\"></a></p>\n"}, {"tags": ["go", "grpc", "grpc-go"], "answers": [{"comments": [{"owner": {"reputation": 339, "user_id": 2254364, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a23fa92d8301dc3de7e66f52b2e55689?s=128&d=identicon&r=PG", "display_name": "DouglasAdams", "link": "https://stackoverflow.com/users/2254364/douglasadams"}, "edited": false, "score": 1, "creation_date": 1600767663, "post_id": 57401777, "comment_id": 113184684, "body": "Should you provide more information on how to set the flow control window of a gRPC server? Is it possible to increase the size of the window?"}], "tags": [], "owner": {"reputation": 576, "user_id": 7371810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c53dfe10f0150e2213e244ef1b93ccde?s=128&d=identicon&r=PG&f=1", "display_name": "menghanl", "link": "https://stackoverflow.com/users/7371810/menghanl"}, "is_accepted": true, "score": 4, "last_activity_date": 1600789990, "last_edit_date": 1600789990, "creation_date": 1565209144, "answer_id": 57401777, "question_id": 57375360, "link": "https://stackoverflow.com/questions/57375360/how-does-grpc-client-streaming-flow-control-work-in-go/57401777#57401777", "title": "How does gRPC client-streaming flow control work in go?", "body": "<p>gRPC flow control is based on http2 flow control:\n<a href=\"https://httpwg.org/specs/rfc7540.html#FlowControl\" rel=\"nofollow noreferrer\">https://httpwg.org/specs/rfc7540.html#FlowControl</a></p>\n<p>There will be backpressure.\nMessages are only successfully sent when there's enough flow control window for them, otherwise SendMsg() will block.</p>\n<p>The signal from the receiving side is not to add backpressure, it's to release backpressure. It's like saying &quot;now I'm ready to receive another 1MB of messages, send them&quot;.</p>\n"}], "owner": {"reputation": 97, "user_id": 3267749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4948c4a158e29762bbf2b7a883ed29e1?s=128&d=identicon&r=PG&f=1", "display_name": "kfertakis", "link": "https://stackoverflow.com/users/3267749/kfertakis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2304, "favorite_count": 1, "accepted_answer_id": 57401777, "answer_count": 1, "score": 7, "last_activity_date": 1600789990, "creation_date": 1565091968, "question_id": 57375360, "link": "https://stackoverflow.com/questions/57375360/how-does-grpc-client-streaming-flow-control-work-in-go", "title": "How does gRPC client-streaming flow control work in go?", "body": "<p>I would like to know, how flow control works in a client-streaming gRPC service in Go. </p>\n\n<p>Specifically, I am interested in knowing when will a call to <code>stream.SendMsg()</code> function in the client-side block? According to the <a href=\"https://github.com/grpc/grpc-go/blob/master/stream.go#L76\" rel=\"noreferrer\">documentation</a> :</p>\n\n<blockquote>\n  <p>SendMsg() blocks until : </p>\n  \n  <ul>\n  <li>There is sufficient flow control to schedule m with the transport, or ...</li>\n  </ul>\n</blockquote>\n\n<p>So what is the specification for the flow control mechanism of the stream? For example, if the server-side code responsible for reading the messages from the stream, isn't reading the messages fast enough, at what point will calls to SendMsg() block? </p>\n\n<p>Is there some kind of backpressure mechanism implemented for the server to tell the client that it is not ready to receive more data? In the meantime, where are all the messages that have been successfully sent before the backpressure signal, queued?</p>\n"}, {"tags": ["docker", "go", "jenkins", "jenkins-pipeline"], "comments": [{"owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 0, "creation_date": 1565086064, "post_id": 57372425, "comment_id": 101232018, "body": "Do you have <code>FROM golang:1.12.6</code> in your Dockerfile? It looks like there is no Go installed."}, {"owner": {"reputation": 85, "user_id": 5830058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3403dfb12675665b91c409730c65b615?s=128&d=identicon&r=PG&f=1", "display_name": "Olive.b", "link": "https://stackoverflow.com/users/5830058/olive-b"}, "reply_to_user": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 0, "creation_date": 1565091129, "post_id": 57372425, "comment_id": 101234572, "body": "I am not sure sure what&#39;s the issue, I tried the image jenkinsci:jenkins instead of jenkinsci:blueocean and it works."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11377262, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-9fbOm1gtpIc/AAAAAAAAAAI/AAAAAAAAAAc/WmC-JETpbXQ/photo.jpg?sz=128", "display_name": "\u6797\u5609\u4e50", "link": "https://stackoverflow.com/users/11377262/%e6%9e%97%e5%98%89%e4%b9%90"}, "is_accepted": false, "score": -1, "last_activity_date": 1591596148, "creation_date": 1591596148, "answer_id": 62255924, "question_id": 57372425, "link": "https://stackoverflow.com/questions/57372425/go-not-found-in-declarative-jenkinsfile/62255924#62255924", "title": "go: not found in declarative Jenkinsfile", "body": "<p>Jenkins reboots might just fix it</p>\n"}], "owner": {"reputation": 85, "user_id": 5830058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3403dfb12675665b91c409730c65b615?s=128&d=identicon&r=PG&f=1", "display_name": "Olive.b", "link": "https://stackoverflow.com/users/5830058/olive-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 307, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1591596148, "creation_date": 1565081883, "question_id": 57372425, "link": "https://stackoverflow.com/questions/57372425/go-not-found-in-declarative-jenkinsfile", "title": "go: not found in declarative Jenkinsfile", "body": "<p>I have Jenkins running on Docker and I have the following Jenkinsfile on github</p>\n\n<pre><code>node {\n    def root = tool name: 'Go 1.12.6', type: 'go'\n\n    ws(\"${JENKINS_HOME}/jobs/${JOB_NAME}/builds/${BUILD_ID}/src/github.com/project/repo\") {\n        withEnv([\"GOROOT=${root}\", \"GOPATH=${JENKINS_HOME}/jobs/${JOB_NAME}/builds/${BUILD_ID}/\", \"PATH+GO=${root}/bin\"]) {\n            env.PATH=\"${GOPATH}/bin:$PATH\"\n\n            stage('Clone repository') {\n                checkout scm\n            }\n\n\n            stage('Test repo') {\n                sh 'go test -v'\n            }\n\n            stage('Build image') {\n                app = docker.build(\"docker/repo\")\n            }\n\n\n            stage('Push image') { */\n                docker.withRegistry('https://registry.hub.docker.com', 'docker-hub-credentials') {\n                    app.push(\"${env.BUILD_NUMBER}\")\n                    app.push(\"latest\")\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>But no matter what I try I get the following error:</p>\n\n<pre><code>+ go version\n/var/jenkins_home/jobs/repo/builds/45/src/github.com/project/repo@tmp/durable-00e72894/script.sh: line 1: go: not found\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "elasticsearch", "aws-lambda", "amazon-sqs"], "comments": [{"owner": {"reputation": 572, "user_id": 2445413, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2fdeb3092b84e3480d179ed27c1be4b5?s=128&d=identicon&r=PG", "display_name": "sourabh1024", "link": "https://stackoverflow.com/users/2445413/sourabh1024"}, "edited": false, "score": 0, "creation_date": 1565087509, "post_id": 57372340, "comment_id": 101232720, "body": "the CRON job which starts the process every morning could call a single script which creates a temporary index, starts the download from different sources and then makes this original index point to new index created when all the download processes have returned and deletes the original index or archives it."}], "answers": [{"tags": [], "owner": {"reputation": 9394, "user_id": 573153, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/ce4685da897c912aa41a815435b40a5a?s=128&d=identicon&r=PG", "display_name": "xeraa", "link": "https://stackoverflow.com/users/573153/xeraa"}, "is_accepted": true, "score": 0, "last_activity_date": 1565964399, "creation_date": 1565964399, "answer_id": 57526066, "question_id": 57372340, "link": "https://stackoverflow.com/questions/57372340/how-can-i-copy-index-in-elastic-search-with-this-architecture/57526066#57526066", "title": "How can I copy index in Elastic Search with this architecture?", "body": "<p>The concept you're after is an <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-aliases.html\" rel=\"nofollow noreferrer\">index alias</a>. The basic workflow would be:</p>\n\n<ol>\n<li>Import today's data into an index with <code>my-index-2019-09-16</code> (for example).</li>\n<li>Make sure the import is complete and worked correctly.</li>\n<li><p>Point the alias to the new index (it's an atomic switch between the indices):</p>\n\n<pre><code>POST /_aliases\n{\n    \"actions\" : [\n        { \"remove\" : { \"index\" : \"my-index-2019-09-15\", \"alias\" : \"my-index\" } },\n        { \"add\" : { \"index\" : \"my-index-2019-09-16\", \"alias\" : \"my-index\" } }\n    ]\n}\n</code></pre></li>\n<li><p>Delete the old index.</p></li>\n</ol>\n\n<p>You will double the disk space during the import process, but otherwise this should work without any issues and you only delete data once it has a proper replacement.</p>\n"}], "owner": {"reputation": 191, "user_id": 3588408, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/e1f7e90f0f2e28d7eb85aadc551b5e71?s=128&d=identicon&r=PG&f=1", "display_name": "user3588408", "link": "https://stackoverflow.com/users/3588408/user3588408"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 57526066, "answer_count": 1, "score": 0, "last_activity_date": 1565964399, "creation_date": 1565081647, "last_edit_date": 1565136627, "question_id": 57372340, "link": "https://stackoverflow.com/questions/57372340/how-can-i-copy-index-in-elastic-search-with-this-architecture", "title": "How can I copy index in Elastic Search with this architecture?", "body": "<p>I have a scenario where I have to import data (millions of records) from multiple sources and save it in a database. A user should get results in under 2-3 seconds when they try to search for any information related to that data.</p>\n\n<p>For this, I designed an architecture where I used golang to import data from multiple sources and pushed data in AWS SQS. I've created a lambda function which triggers when AWS SQS has some data. This lambda function then pushes data in AWS Elastic Search. I've created a Rest API using which I give results to the user.</p>\n\n<p>I use CRON to do this importing work every morning. Now my problem is if a new batch of data comes I want to delete the existing data and replace all of them with the new data.\nI'm stuck at how I can achieve this deleting and adding new data part. </p>\n\n<p>I thought of creating a temporary index and then replacing it with the original index. But the problem is I do not know when importing has ended and can make this index switch.</p>\n"}, {"tags": ["date", "go", "locale"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1565078209, "post_id": 57371007, "comment_id": 101227853, "body": "It&#39;s the <a href=\"https://golang.org/pkg/time/#hdr-Monotonic_Clocks\" rel=\"nofollow noreferrer\">monotonic clock reading</a>. Use <a href=\"https://golang.org/pkg/time/#Time.Equal\" rel=\"nofollow noreferrer\">Time.Equal</a> to compare Time values. See <a href=\"https://new.blog.cloudflare.com/how-and-why-the-leap-second-affected-cloudflare-dns/\" rel=\"nofollow noreferrer\">this blog post by Cloudflare</a> which describes the problem that prompted this addition to Go."}, {"owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1565078893, "post_id": 57371007, "comment_id": 101228194, "body": "So... <code>Time.Equal()</code> ignores the monotonic clock? I guess I hit a form of a bug in the assert library then... Interesting read about Cloudflare although I knew time can backward since like forever (i.e. I&#39;ve changed my clocks to a date in the past and caused total mayhem on some computers...)"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1565080822, "post_id": 57371007, "comment_id": 101229156, "body": "&quot;Time.Equal() ignores the monotonic clock?&quot; Yes. Time.Equal is only concerned with equal instants in time and the monotonic clock reading is irrelevant for telling the time of day (useless, even). It is only useful to measure <i>durations</i>, i.e the difference between two time measurements (values acquired with time.Now() or equivalent)."}], "answers": [{"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 3, "last_activity_date": 1565078013, "last_edit_date": 1565078013, "creation_date": 1565077370, "answer_id": 57371196, "question_id": 57371007, "link": "https://stackoverflow.com/questions/57371007/i-save-a-date-in-a-json-when-i-reload-it-it-looks-nearly-the-same-what-is-t/57371196#57371196", "title": "I save a date in a JSON, when I reload it, it looks nearly the same... What is that `m=+2.58`?", "body": "<pre><code>fmt.Println(time.Now().String())\n</code></pre>\n\n<blockquote>\n  <p>String returns the time formatted using the format string \"2006-01-02\n  15:04:05.999999999 -0700 MST\" If the time has a monotonic clock\n  reading, the returned string includes a final field \"m=\u00b1\",\n  where value is the monotonic clock reading formatted as a decimal\n  number of seconds. The returned string is meant for debugging; for a\n  stable serialized representation, use t.MarshalText, t.MarshalBinary,\n  or t.Format with an explicit format string.</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/pkg/time/#Time.String\" rel=\"nofollow noreferrer\">Reference</a></p>\n\n<hr>\n\n<h3><a href=\"https://golang.org/pkg/time/#hdr-Monotonic_Clocks\" rel=\"nofollow noreferrer\">Monotonic Clocks</a></h3>\n\n<blockquote>\n  <p>Operating systems provide both a \u201cwall clock,\u201d which\n  is subject to changes for clock synchronization, and a \u201cmonotonic\n  clock,\u201d which is not. The general rule is that the wall clock is for\n  telling time and the monotonic clock is for measuring time. Rather\n  than split the API, in this package the Time returned by time.Now\n  contains both a wall clock reading and a monotonic clock reading;\n  later time-telling operations use the wall clock reading, but later\n  time-measuring operations, specifically comparisons and subtractions,\n  use the monotonic clock reading.</p>\n</blockquote>\n"}], "owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "closed_date": 1565078887, "accepted_answer_id": 57371196, "answer_count": 1, "score": 2, "last_activity_date": 1565078013, "creation_date": 1565076665, "question_id": 57371007, "link": "https://stackoverflow.com/questions/57371007/i-save-a-date-in-a-json-when-i-reload-it-it-looks-nearly-the-same-what-is-t", "closed_reason": "Duplicate", "title": "I save a date in a JSON, when I reload it, it looks nearly the same... What is that `m=+2.58`?", "body": "<p>I'm writing a test in Golang which verifies that a journal on disk is properly managed. When I look at the file I see the correct date, but when I look at the date in the test and the date I reload from JSON, they look different:</p>\n\n<p>Timestamp I got with <code>time.Now()</code>:</p>\n\n<pre><code>2019-08-06 00:17:46.033527441 -0700 PDT m=+2.582718548\n</code></pre>\n\n<p>Timestamp I reloaded from the JSON:</p>\n\n<pre><code>2019-08-06 00:17:46.033527441 -0700 PDT\n</code></pre>\n\n<p>If I change the date to <code>UTC()</code>, it all works as expected (i.e. start with <code>time.Now().UTC()</code>).</p>\n\n<p>I understand that the location is different, I'm just not too sure what the <code>m=...</code> parameter stands for and why would it not be present in the date I reloaded from JSON since it is the exact same date.</p>\n\n<p>So... What is that field?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1565079245, "post_id": 57370714, "comment_id": 101228350, "body": "This <a href=\"https://play.golang.com/p/mwo7Y2rJ_lc\" rel=\"nofollow noreferrer\">play.golang.com/p/mwo7Y2rJ_lc</a> works for the example case, not sure if it works for every case you expect."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565079454, "post_id": 57370714, "comment_id": 101228440, "body": "... also note that an array of objects unmarshaled into an <code>interface{}</code> will have the underlying type set to <code>[]interface{}</code> and never to <code>[]map[string]interface{}</code> as you seem to assume."}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1565082389, "post_id": 57370714, "comment_id": 101229998, "body": "Maybe you can use Regex. Find array with one element and remove the square brackets."}, {"owner": {"reputation": 6096, "user_id": 1804251, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/XVhq3.jpg?s=128&g=1", "display_name": "BennX", "link": "https://stackoverflow.com/users/1804251/bennx"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565092894, "post_id": 57370714, "comment_id": 101235599, "body": "@mkopriva thank you for that snipped. I works as expected my various test cases. Please provide it as answer!"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1565094502, "creation_date": 1565094502, "answer_id": 57376084, "question_id": 57370714, "link": "https://stackoverflow.com/questions/57370714/type-switch-to-mapstringinterface-on-the-value-of-mapstringinterface/57376084#57376084", "title": "Type switch to []map[string]interface{} on the value of map[string]interface{}", "body": "<p>You can use this function to remove the undesired arrays.</p>\n\n<pre><code>func removearr(x interface{}) interface{} {\n    switch val := x.(type) {\n    case map[string]interface{}:\n        for k, v := range val {\n            val[k] = removearr(v)\n        }\n        return val\n    case []interface{}:\n        if len(val) == 1 {\n            // remove array only if the value is not an object\n            if _, ok := val[0].(map[string]interface{}); !ok {\n                return removearr(val[0])\n            }\n        }\n\n        for i, v := range val {\n            val[i] = removearr(v)\n        }\n        return val\n    default:\n        return x\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/mwo7Y2rJ_lc\" rel=\"nofollow noreferrer\">https://play.golang.com/p/mwo7Y2rJ_lc</a></p>\n"}], "owner": {"reputation": 6096, "user_id": 1804251, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/XVhq3.jpg?s=128&g=1", "display_name": "BennX", "link": "https://stackoverflow.com/users/1804251/bennx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 57376084, "answer_count": 1, "score": 0, "last_activity_date": 1565094502, "creation_date": 1565075501, "last_edit_date": 1565078946, "question_id": 57370714, "link": "https://stackoverflow.com/questions/57370714/type-switch-to-mapstringinterface-on-the-value-of-mapstringinterface", "title": "Type switch to []map[string]interface{} on the value of map[string]interface{}", "body": "<h1>Problem</h1>\n\n<p>I'm facing the issue to remove not required arrays from an json object eg. arrays with only one element which is not an object or array. (No arrays as root of the input) </p>\n\n<h2>Example</h2>\n\n<p>In: </p>\n\n<pre><code>{\"name\": [{ \"inner\": [\"test\"] }]}\n</code></pre>\n\n<p>Wanted Out:</p>\n\n<pre><code>{\"name\": [{ \"inner\": \"test\" }]}\n</code></pre>\n\n<h2>Approach</h2>\n\n<p>I started with a simple type switch on the values of a parsed <code>map[string]interface{}</code> and recognized that it wont switch to the case <code>[]map[string]interface{}</code>. (Given example)</p>\n\n<p>So here is the implementation I came up with. It works for most of the scenarios but not for inner Objects within an array yet.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type jsonMap map[string]interface{}\ntype jsonMapList []map[string]interface{}\n\nm := jsonMap{}\n\nerr := json.Unmarshal(s, &amp;m)\nif err != nil {\n    panic(err)\n}\n\nres := removeFromObject(m)\n\nbytes, err := json.Marshal(res)\nif err != nil {\n    panic(err)\n}\nresult := string(bytes)\nlog.Infof(\"Parse Result: %s\", result)\n\nfunc removeFromObject(in jsonMap) jsonMap {\n    res := jsonMap{}\n\n    for k, v := range in {\n        switch value := v.(type) {\n        case jsonMap:\n            res[k] = removeFromObject(value)\n        case jsonMapList:\n            list := []jsonMap{}\n            for _, entry := range value {\n                list = append(list, removeFromObject(entry))\n            }\n            res[k] = list\n        case []interface{}:\n            if len(value) == 1 {\n                res[k] = value[0]\n            } else {\n                res[k] = value\n            }\n        default:\n            res[k] = value\n        }\n    }\n\n    return res\n}\n</code></pre>\n\n<h2>Question</h2>\n\n<p>How do I switch case to an object array, so that I can recursively resolve the objects within that array too?</p>\n"}, {"tags": ["go", "yocto", "bitbake"], "answers": [{"comments": [{"owner": {"reputation": 2875, "user_id": 1934800, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dd418bfddb2f7d81dc1d9ba06c203cc7?s=128&d=identicon&r=PG", "display_name": "TrentP", "link": "https://stackoverflow.com/users/1934800/trentp"}, "edited": false, "score": 0, "creation_date": 1586223969, "post_id": 57372192, "comment_id": 108044105, "body": "This didn&#39;t work for me.  While it does build a compiler for the sdk, the sdk is still missing the wrapper in <code>$SDKSYSROOT&#47;usr&#47;bin</code> to set GOROOT and call the compiler, which is in <code>$SDKSYSROOT&#47;lib&#47;go&#47;bin&#47;go</code>.  Also the all the go source files aren&#39;t present so it&#39;s not possible to compile anything."}], "tags": [], "owner": {"reputation": 1586, "user_id": 6225741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7f147a4cf533863ff2f12762e3c6192?s=128&d=identicon&r=PG", "display_name": "Nayfe", "link": "https://stackoverflow.com/users/6225741/nayfe"}, "is_accepted": true, "score": 2, "last_activity_date": 1565081179, "creation_date": 1565081179, "answer_id": 57372192, "question_id": 57370142, "link": "https://stackoverflow.com/questions/57370142/how-to-add-go-cross-to-yocto-sdk-or-otherwise-compile-go-for-yocto-on-other-mac/57372192#57372192", "title": "How to add go-cross to Yocto SDK? Or otherwise compile Go for Yocto on other machines?", "body": "<p>You can add the following lines in <code>local.conf</code> file or image recipe:</p>\n\n<pre><code>TOOLCHAIN_HOST_TASK_append = \" \\\n    packagegroup-go-cross-canadian-${MACHINE} \\\n\"\n\nTOOLCHAIN_TARGET_TASK_append = \" \\\n    ${@multilib_pkg_extend(d, 'packagegroup-go-sdk-target')} \\\n\"\n\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 2955167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73dd23aa7185e38b56d9451f64e6246?s=128&d=identicon&r=PG&f=1", "display_name": "Sampo", "link": "https://stackoverflow.com/users/2955167/sampo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 504, "favorite_count": 0, "accepted_answer_id": 57372192, "answer_count": 1, "score": 1, "last_activity_date": 1565081179, "creation_date": 1565073175, "question_id": 57370142, "link": "https://stackoverflow.com/questions/57370142/how-to-add-go-cross-to-yocto-sdk-or-otherwise-compile-go-for-yocto-on-other-mac", "title": "How to add go-cross to Yocto SDK? Or otherwise compile Go for Yocto on other machines?", "body": "<p>I have been using the Yocto SDK to compile C and C++ code for Yocto so that every machine does not need the 150GB+ Bitbake environment. Yocto version is 2.4 (Rocko)</p>\n\n<p>Now I would like to have the same functionality for Golang, but I can't figure out how to do it.</p>\n\n<p>If I'm on the Bitbake machine, I can call the binary arm-arch-gnueabi-go binary found under the directory tmp/work/x86_64-linux/go-cross-arm/ to compile code. But if I copy those binaries to another machine, it links to libraries with hard-coded paths on the Bitbake machine so that won't work.</p>\n\n<p>Is there a way to include arm-arch-gnueabi-go in the SDK when I run populate_sdk on the image? Or is there another easy way to compile Go for the target on other machines?</p>\n"}, {"tags": ["mysql", "sql", "database", "go"], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 2930933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ebd2953156c70a1869dc660cfbf7f7b?s=128&d=identicon&r=PG&f=1", "display_name": "Yogi Hardi", "link": "https://stackoverflow.com/users/2930933/yogi-hardi"}, "is_accepted": false, "score": 0, "last_activity_date": 1565104884, "creation_date": 1565104884, "answer_id": 57379274, "question_id": 57369838, "link": "https://stackoverflow.com/questions/57369838/how-to-source-database-schema-before-running-tests-in-my-go-program/57379274#57379274", "title": "How to source database schema before running tests in my Go program", "body": "<p>you can use init function on <code>main_test.go</code></p>\n\n<pre><code>package main\n\n    func init(){\n      // load and execute your db schema here. \n    }\n\n</code></pre>\n\n<p><a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Package_initialization</a></p>\n\n<p>the <code>init()</code> on main package will be executed on package initialization</p>\n"}], "owner": {"reputation": 17, "user_id": 10144687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86473e93198ba5dc37332b2c0f247af0?s=128&d=identicon&r=PG&f=1", "display_name": "Ishan Sharma", "link": "https://stackoverflow.com/users/10144687/ishan-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565104884, "creation_date": 1565071682, "question_id": 57369838, "link": "https://stackoverflow.com/questions/57369838/how-to-source-database-schema-before-running-tests-in-my-go-program", "title": "How to source database schema before running tests in my Go program", "body": "<p>I have to run Go tests for database interactions.\nDatabase Schema is in a <strong>.sql</strong> file.\nI have a folder A which has package main and I have 3 folders B, C and D inside A which have package B, C and D respectively. B,C,D have test files in them but A does not have any tests. I want a way so that I just do a </p>\n\n<pre><code>go test ./...\n</code></pre>\n\n<p>from A and all my tests run after sourcing schema into mysql.</p>\n\n<p>I tried making a main_test.go file in A and placing a TestMain function there. But it was not working.</p>\n"}, {"tags": ["go", "logging", "middleware"], "answers": [{"comments": [{"owner": {"reputation": 1082, "user_id": 715239, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/96c26230e324cbacff58e61452951409?s=128&d=identicon&r=PG", "display_name": "Artog", "link": "https://stackoverflow.com/users/715239/artog"}, "edited": false, "score": 0, "creation_date": 1565073445, "post_id": 57370090, "comment_id": 101225569, "body": "Hello and welcome to StackOverflow! An answer, and question, should be self-contained. This means that we like to have all the code in the answer it self (What if the page you&#39;re linking to gets taken down?) So try to inline the code in the answer"}], "tags": [], "owner": {"reputation": 36, "user_id": 11887874, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000583575300/picture?type=large", "display_name": "Saddam Hossain", "link": "https://stackoverflow.com/users/11887874/saddam-hossain"}, "is_accepted": true, "score": 2, "last_activity_date": 1565072913, "creation_date": 1565072913, "answer_id": 57370090, "question_id": 57369775, "link": "https://stackoverflow.com/questions/57369775/how-to-log-the-response-body-from-middleware/57370090#57370090", "title": "How to log the response body from middleware?", "body": "<p>To get response body and status code, you have to implement your own ResponseWriter. <a href=\"https://www.reddit.com/r/golang/comments/7p35s4/how_do_i_get_the_response_status_for_my_middleware/\" rel=\"nofollow noreferrer\">Here you can find full example</a>  </p>\n"}], "owner": {"reputation": 41, "user_id": 10132840, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qvwqeQcIw24/AAAAAAAAAAI/AAAAAAAAAhw/I_49w5xvSr0/photo.jpg?sz=128", "display_name": "user10132840", "link": "https://stackoverflow.com/users/10132840/user10132840"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 462, "favorite_count": 0, "accepted_answer_id": 57370090, "answer_count": 1, "score": 2, "last_activity_date": 1565072913, "creation_date": 1565071372, "question_id": 57369775, "link": "https://stackoverflow.com/questions/57369775/how-to-log-the-response-body-from-middleware", "title": "How to log the response body from middleware?", "body": "<p>I tried to log the response body from middleware. I can get all the data related to the Request object. Now try to log the response code and response body for a single request.</p>\n\n<p>I was trying to catch the response body and response code from <code>w http.ResponseWriter</code>, but could not succeed. Here is the sample code. I am using go's default <code>http</code> and <code>logrus</code> for logging.</p>\n\n<pre><code>next.ServeHTTP(w, r.WithContext(ctx))\nend := time.Now().UTC()\nlatency := end.Sub(start)\n// request logging\nlog.WithFields(log.Fields{\n    \"path\":      r.URL.Path,\n    \"method\":    r.Method,\n    \"body\":      body,\n    \"auth_user\": claims,\n    \"latency\":   latency,\n    \"useragent\": r.Header.Get(\"User-Agent\"),\n    \"response_body\": ,// cannot get response body here\n    \"status\": \"\", //cannot get response header here\n}).Info(\"request data\")\n</code></pre>\n\n<p>Can someone help me with that, please?</p>\n"}, {"tags": ["go", "channel"], "answers": [{"comments": [{"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 2, "creation_date": 1565065639, "post_id": 57368727, "comment_id": 101223305, "body": "+1. Reaching the end of the program guarantees you have written to the channel 5 times. Because channel reads and writes are blocking, this also implies the channel has been read from 5 times. But what is <b>not</b> guaranteed is that all 5 of those read values have been concatenated with the &quot;Hello &quot; and &quot;!&quot; strings and <code>Println</code>ed before the program exits."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 3, "last_activity_date": 1565063901, "creation_date": 1565063901, "answer_id": 57368727, "question_id": 57368632, "link": "https://stackoverflow.com/questions/57368632/why-variable-output-here-with-channels/57368727#57368727", "title": "Why variable output here with channels", "body": "<p>You're not waiting until all strings are printed to exit. As soon as the main thread reaches its end of execution, it shuts down all goroutines and ends the program. Since this happens concurrently, it's impossible to say how many strings will be allowed to print.</p>\n"}, {"comments": [{"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565105881, "post_id": 57368974, "comment_id": 101243662, "body": "Very well explained."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565166784, "post_id": 57368974, "comment_id": 101262643, "body": "Why it is ending before completion of all tasks. What is the advantage?"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565200620, "post_id": 57368974, "comment_id": 101281454, "body": "Why was Go designed like that? I&#39;ll guess to ensure Go programs reliably stop."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565238134, "post_id": 57368974, "comment_id": 101291435, "body": "Does it ban a statement as:  &#39;for {}&#39; which will run forever?"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565247762, "post_id": 57368974, "comment_id": 101294625, "body": "@mso No. Loops are a lot simpler than concurrency."}], "tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": true, "score": 0, "last_activity_date": 1565065906, "creation_date": 1565065906, "answer_id": 57368974, "question_id": 57368632, "link": "https://stackoverflow.com/questions/57368632/why-variable-output-here-with-channels/57368974#57368974", "title": "Why variable output here with channels", "body": "<p><a href=\"https://stackoverflow.com/a/57368727/14660\">@AdamSmith identified the problem</a>. When <code>main()</code> exits all goroutines are killed. There's no guarantee your other goroutines will finish before that, that's the nature of concurrency. Here's how you fix it.</p>\n\n<p>First, let's make a couple changes to <code>greet</code>. Have it sleep just a moment to make the problem more pronounced. We'll also have it accept a string rather than the channel, we'll see why in a moment.</p>\n\n<pre><code>func greet(str string) {\n    time.Sleep(100 * time.Millisecond)\n    fmt.Println(\"Hello \" + str + \"!\")\n}\n</code></pre>\n\n<p>Rather than creating a bunch of goroutines to read a fixed number of times from a channel, we want one goroutine which reads from the channel until it's exhausted. This is easiest done using <a href=\"https://gobyexample.com/range-over-channels\" rel=\"nofollow noreferrer\"><code>range</code></a>. This takes full advantage of channels.</p>\n\n<p>We also need a way to tell the main program to wait until the loop is done. <a href=\"https://gobyexample.com/channel-synchronization\" rel=\"nofollow noreferrer\">This is easiest done with a second channel</a>. More complex synchronization uses <a href=\"https://gobyexample.com/waitgroups\" rel=\"nofollow noreferrer\">WaitGroups</a>.</p>\n\n<pre><code>c := make(chan string, 2)\ndone := make(chan bool, 1)\ngo func() {\n    for str := range(c) {\n        greet(str)\n    }\n    done &lt;- true\n}()\n</code></pre>\n\n<p>The goroutine will read from <code>c</code> until it's closed. Then it will send <code>true</code> to the channel <code>done</code>. Both are buffered to avoid deadlock due to blocking waiting to read or write to the channel.</p>\n\n<p>Back in <code>main</code>, we write to the channel, explicitly close it, and then wait to read from <code>done</code>.</p>\n\n<pre><code>    c &lt;- \"AAA\"\n    c &lt;- \"BBB\"\n    c &lt;- \"CCC\"\n    c &lt;- \"DDD\"\n    c &lt;- \"EEE\"\n    close(c)\n\n    &lt;-done\n    fmt.Println(\"main() stopped\")\n</code></pre>\n\n<p><code>&lt;-done</code> will block until there is something to read. This allows the goroutine to finish.</p>\n\n<p>And bringing it all together.</p>\n\n<pre><code>package main\nimport(\n    \"fmt\"\n    \"time\"\n)\nfunc greet(str string) {\n    time.Sleep(100 * time.Millisecond)\n    fmt.Println(\"Hello \" + str + \"!\")\n}\nfunc main() {\n    fmt.Println(\"main() started\")\n    c := make(chan string, 2)\n    done := make(chan bool, 1)\n    go func() {\n        for str := range(c) {\n            greet(str)\n        }\n        done &lt;- true\n    }()\n    c &lt;- \"AAA\"\n    c &lt;- \"BBB\"\n    c &lt;- \"CCC\"\n    c &lt;- \"DDD\"\n    c &lt;- \"EEE\"\n    close(c)\n\n    &lt;-done\n    fmt.Println(\"main() stopped\")\n}\n</code></pre>\n"}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 57368974, "answer_count": 2, "score": 0, "last_activity_date": 1565065906, "creation_date": 1565063031, "last_edit_date": 1565063503, "question_id": 57368632, "link": "https://stackoverflow.com/questions/57368632/why-variable-output-here-with-channels", "title": "Why variable output here with channels", "body": "<p>I am trying code modified from <a href=\"https://play.golang.org/p/OeYLKEz7qKi\" rel=\"nofollow noreferrer\">here</a>. I create 5 channels and send data 5 times: </p>\n\n<pre><code>package main\nimport \"fmt\"\nfunc greet(c chan string) {\n    fmt.Println(\"Hello \" + &lt;-c + \"!\")\n}\nfunc main() {\n    fmt.Println(\"main() started\")\n    c := make(chan string)\n    for i:=0; i&lt;5; i++ {\n        go greet(c)\n    }\n    c &lt;- \"AAA\"\n    c &lt;- \"BBB\"\n    c &lt;- \"CCC\"\n    c &lt;- \"DDD\"\n    c &lt;- \"EEE\"\n    fmt.Println(\"main() stopped\")\n}\n</code></pre>\n\n<p>I expected all 5 strings to be printed. However, I find variable output. Some outputs are:</p>\n\n<pre><code>$ ./rnchannel\nmain() started\nHello AAA!\nHello DDD!\nHello BBB!\nHello CCC!\nHello EEE!\nmain() stopped\n\n$ ./rnchannel\nmain() started\nHello CCC!\nHello DDD!\nmain() stopped\n\n$ ./rnchannel\nmain() started\nHello CCC!\nHello BBB!\nHello AAA!\nHello DDD!\nmain() stopped\n</code></pre>\n\n<p>Why variable number of lines are being printed?</p>\n"}, {"tags": ["go", "visual-studio-code"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 8729316, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-AlRnCDXEpeQ/AAAAAAAAAAI/AAAAAAAAB0k/AN6Q0Rz5RF4/photo.jpg?sz=128", "display_name": "Zach", "link": "https://stackoverflow.com/users/8729316/zach"}, "edited": false, "score": 0, "creation_date": 1565099358, "post_id": 57368358, "comment_id": 101239650, "body": "That&#39;s it! Thanks Matt. I ended up with &#39;promoteItems stack.Stack&#39; for the declaration and that seemed to please the linter."}, {"owner": {"reputation": 3322, "user_id": 966798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b52a10544df0260f8eab84b3bbea4bb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/966798/matt"}, "reply_to_user": {"reputation": 13, "user_id": 8729316, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-AlRnCDXEpeQ/AAAAAAAAAAI/AAAAAAAAB0k/AN6Q0Rz5RF4/photo.jpg?sz=128", "display_name": "Zach", "link": "https://stackoverflow.com/users/8729316/zach"}, "edited": false, "score": 0, "creation_date": 1565100255, "post_id": 57368358, "comment_id": 101240218, "body": "That sounds right, the package is imported as <code>stack</code>, so <code>stack.Stack</code> is the type."}], "tags": [], "owner": {"reputation": 3322, "user_id": 966798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b52a10544df0260f8eab84b3bbea4bb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/966798/matt"}, "is_accepted": true, "score": 0, "last_activity_date": 1565100268, "last_edit_date": 1565100268, "creation_date": 1565060555, "answer_id": 57368358, "question_id": 57368290, "link": "https://stackoverflow.com/questions/57368290/having-trouble-declaring-a-stack-using-the-stack-collection-for-go/57368358#57368358", "title": "Having trouble declaring a stack using the stack collection for Go", "body": "<p>Don't initialize values in the struct definition, just set the type. Initialize the value when you create a new instance of the struct.</p>\n\n<pre><code>type Item struct {\n    key   int\n    value int\n    //sum   int\n    sum float64\n\n    numerator   int64\n    denominator int64\n\n    exponent float64\n\n    status Status\n\n    promoteItems stack.Stack\n}\n\nfunc main() {\n    // create an instance of struct Item\n    item := Item{\n        promoteItems: stack.New(),\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8729316, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-AlRnCDXEpeQ/AAAAAAAAAAI/AAAAAAAAB0k/AN6Q0Rz5RF4/photo.jpg?sz=128", "display_name": "Zach", "link": "https://stackoverflow.com/users/8729316/zach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 57368358, "answer_count": 1, "score": 0, "last_activity_date": 1565100268, "creation_date": 1565059895, "question_id": 57368290, "link": "https://stackoverflow.com/questions/57368290/having-trouble-declaring-a-stack-using-the-stack-collection-for-go", "title": "Having trouble declaring a stack using the stack collection for Go", "body": "<p>I'm translating a tool originally written in C++ to Go using VS Code, but the Go linter doesn't like my stack declaration.</p>\n\n<p>I've imported the stack collection per the Go documentation and I think my go workspace directory hierarchy is correct.</p>\n\n<pre><code>-go (workspace)\n    -bin\n    -pkg\n        -darwin_amd64\n            -github.com\n                -golang-collections\n                    -collections\n                        -stack.a\n    -src\n        -github.com\n            -golang-collections\n                -collections\n                    -stack\n                        stack.go\n                        stack_test.go\n            -zwnewsom\n                -verifier\n                   main.go\n\n</code></pre>\n\n<pre><code>package main\n\nimport (\n    \"C\"\n    \"github.com/golang-collections/collections/stack\"\n)\n\ntype Item struct {\n    key   int\n    value int\n    //sum   int\n    sum float64\n\n    numerator   int64\n    denominator int64\n\n    exponent float64\n\n    status Status\n\n    promoteItems := stack.New()\n}\n</code></pre>\n\n<p>the 'New()' function should return a pointer to a stack but the VS Code Go linter gives me a yellow squiggly under ':= stack.New()' with an error saying \"expected ';', found ':='\" which is doubly confusing since I was under the impression that Go doesn't use semicolons to terminate lines.</p>\n"}, {"tags": ["session", "go", "web-applications", "oauth-2.0", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 10747868, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--IocEEqVzFU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-iBLN70RLKy_vzg0raGFExZqOjQAQ/mo/photo.jpg?sz=128", "display_name": "Cyanic", "link": "https://stackoverflow.com/users/10747868/cyanic"}, "is_accepted": false, "score": 0, "last_activity_date": 1565244772, "creation_date": 1565244772, "answer_id": 57406180, "question_id": 57368163, "link": "https://stackoverflow.com/questions/57368163/gorrila-session-filesystemstore-cannot-find-session-file/57406180#57406180", "title": "Gorrila session filesystemstore cannot find session file", "body": "<h3>I figure out the answer myself</h3>\n\n<p><strong>It turns out that I changed my secret key while initializing the gorilla session filesystemstore, but I have not deleted my cookie file in chrome, so it cannot find the tmp sesiion file needed.</strong><br/>\nI change the key, then delete the coorsponding cookie file and everything is ok now.</p>\n"}], "owner": {"reputation": 1, "user_id": 10747868, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--IocEEqVzFU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-iBLN70RLKy_vzg0raGFExZqOjQAQ/mo/photo.jpg?sz=128", "display_name": "Cyanic", "link": "https://stackoverflow.com/users/10747868/cyanic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 267, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1565244772, "creation_date": 1565058583, "question_id": 57368163, "link": "https://stackoverflow.com/questions/57368163/gorrila-session-filesystemstore-cannot-find-session-file", "title": "Gorrila session filesystemstore cannot find session file", "body": "<p>I'm starting to build a regular web app with golang and Angular2, and most importantly I'm trying to secure my login with the help of  <a href=\"https://auth0.com\" rel=\"nofollow noreferrer\">auth0.com</a>. I download the quickstart code from <a href=\"https://auth0.com/docs/quickstart/webapp/golang\" rel=\"nofollow noreferrer\">here</a> and try to run the code,  it worked for a while and then next time I run it, the /tmp/session file cannot be found any more.</p>\n\n<p>Here are some basic idea of the code auth0.com provides.<br/>\n<strong>1. Initialize the gorilla sessions filesystemstore</strong><br/>\n<strong>2. Then start the authentification process</strong><br/>\ncode is provided below</p>\n\n<h2>app.go</h2>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var (\n    Store *sessions.FilesystemStore\n)\n\nfunc Init() error {\n    Store = sessions.NewFilesystemStore(\"\", []byte(\"something-very-secret\"))\n    gob.Register(map[string]interface{}{})\n    return nil\n}\n</code></pre>\n\n<h2>login.go</h2>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func LoginHandler(w http.ResponseWriter, r *http.Request) {\n\n    domain := os.Getenv(\"AUTH0_DOMAIN\")\n    aud := os.Getenv(\"AUTH0_AUDIENCE\")\n\n    conf := &amp;oauth2.Config{\n        ClientID:     os.Getenv(\"AUTH0_CLIENT_ID\"),\n        ClientSecret: os.Getenv(\"AUTH0_CLIENT_SECRET\"),\n        RedirectURL:  os.Getenv(\"AUTH0_CALLBACK_URL\"),\n        Scopes:       []string{\"openid\", \"profile\"},\n        Endpoint: oauth2.Endpoint{\n            AuthURL:  \"https://\" + domain + \"/authorize\",\n            TokenURL: \"https://\" + domain + \"/oauth/token\",\n        },\n    }\n\n    if aud == \"\" {\n        aud = \"https://\" + domain + \"/userinfo\"\n    }\n\n    // Generate random state\n    b := make([]byte, 32)\n    rand.Read(b)\n    state := base64.StdEncoding.EncodeToString(b)\n\n    session, err := app.Store.Get(r, \"state\")\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    session.Values[\"state\"] = state\n    err = session.Save(r, w)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    audience := oauth2.SetAuthURLParam(\"audience\", aud)\n    url := conf.AuthCodeURL(state, audience)\n\n    http.Redirect(w, r, url, http.StatusTemporaryRedirect)\n}\n</code></pre>\n\n<p>The Error log is <br/></p>\n\n<h2>open /tmp/session_46CNLLHBKD... : no such file or directory</h2>\n\n<p>I try to understand the code and findout that error log comes from login.go line 39(session, err := app.Store.Get(r, \"state\")). And I started to track down the code and find out.<br/>\n<strong>login.go:39 -->store.go: 180-->session.go:132-->store.go:186-->store.go:272</strong><br/>\nyou can find <a href=\"https://github.com/gorilla/sessions/blob/master/store.go\" rel=\"nofollow noreferrer\">store.go</a> and <a href=\"https://github.com/gorilla/sessions/blob/master/sessions.go\" rel=\"nofollow noreferrer\">session.go</a> here.<br/>\nThe error log comes from this line: <strong>fdata, err := ioutil.ReadFile(filename)</strong><br/>\nThrough the whole process I have not found any function call to save the session file.<br/>\n<br/>\nI don't understand this error and I don't know why I can run the code at the very beginning, please help me with this problem.<br/>\nYour any suggestion will be greatly appreciated.Thanks a lot.</p>\n"}, {"tags": ["go", "reflect"], "comments": [{"owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "edited": false, "score": 0, "creation_date": 1565065034, "post_id": 57368016, "comment_id": 101223162, "body": "so, what is your question? So you wanted to ask that your desire output is <code>type: int64</code> but you are getting <code>default ...</code>  ?"}, {"owner": {"reputation": 305, "user_id": 4844297, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/32ea032c47eaa6d7fb3d6b4ea4062f6e?s=128&d=identicon&r=PG&f=1", "display_name": "Hel", "link": "https://stackoverflow.com/users/4844297/hel"}, "reply_to_user": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "edited": false, "score": 0, "creation_date": 1565067288, "post_id": 57368016, "comment_id": 101223670, "body": "@KamolHasan Yes,I would think the element type is the real data runtime type, instead of interface."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1565067017, "creation_date": 1565067017, "answer_id": 57369128, "question_id": 57368016, "link": "https://stackoverflow.com/questions/57368016/element-type-of-interface/57369128#57369128", "title": "element type of []interface{}", "body": "<p>The element type of <code>[]interface{}</code> is <code>interface{}</code>.</p>\n\n<p>If you want the dynamic type of individual values in that slice you'll need to index into that slice to pull those values out.</p>\n\n<pre><code>data := make([]interface{}, 0)\ndata = append(data, int64(1))\ndata = append(data, \"2\")\ndata = append(data, false)\n\ntypeof0 := reflect.ValueOf(data).Index(0).Elem().Type()\ntypeof1 := reflect.ValueOf(data).Index(1).Elem().Type()\ntypeof2 := reflect.ValueOf(data).Index(2).Elem().Type()\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/PVWhIdu1Duz\" rel=\"nofollow noreferrer\">https://play.golang.com/p/PVWhIdu1Duz</a></p>\n"}], "owner": {"reputation": 305, "user_id": 4844297, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/32ea032c47eaa6d7fb3d6b4ea4062f6e?s=128&d=identicon&r=PG&f=1", "display_name": "Hel", "link": "https://stackoverflow.com/users/4844297/hel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "accepted_answer_id": 57369128, "answer_count": 1, "score": -1, "last_activity_date": 1565067017, "creation_date": 1565057294, "question_id": 57368016, "link": "https://stackoverflow.com/questions/57368016/element-type-of-interface", "title": "element type of []interface{}", "body": "<p>How to get the runtime element type of <code>[]interface{}</code>?</p>\n\n<p>I tried the following test.</p>\n\n<pre><code>var data interface{}\ntemp := make([]interface{}, 0)\ntemp = append(temp, int64(1))\ndata = temp\n\nelemType := reflect.TypeOf(data).Elem()\nswitch elemType {\ncase reflect.TypeOf(int64(1)):\n    logger.Infof(\"type: int64 \")\ndefault:\n    logger.Infof(\"default %v\", elemType.Kind()) // \"default\" is matched in fact\n\n}\n</code></pre>\n"}, {"tags": ["json", "postgresql", "http", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 969, "user_id": 9119391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91441ccec1aeff26e087429cf3d0b2cd?s=128&d=identicon&r=PG&f=1", "display_name": "Johnny Cache", "link": "https://stackoverflow.com/users/9119391/johnny-cache"}, "is_accepted": false, "score": 1, "last_activity_date": 1565110010, "creation_date": 1565110010, "answer_id": 57380645, "question_id": 57367780, "link": "https://stackoverflow.com/questions/57367780/deep-nested-structures-in-go-gorm/57380645#57380645", "title": "Deep nested structures in Go-Gorm", "body": "<p>It was indeed a bug, and the bug was in the Book struct. It had no field to read pages into, so the pages in json were indeed simply ignored on a decode level.</p>\n\n<p>Book should look like this to work properly:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Book struct {\n    ID int64 `sql:\"auto_increment\" json:\"-\"`\n    ShelfPlace int64 `json:\"shelf_place\"`\n    Shelf Shelf `gorm:\"foreignkey:shelf_id\" json:\"-\"`\n    ShelfID int64 `json:\"shelf_id\"`\n    Author string `json:\"author\"`\n    Publisher string `json:\"publisher\"`\n    PagesAmount int64 `json:\"pages_amount\"`\n    Page []Page `json:\"pages\"`         //This was missing\n}\n</code></pre>\n\n<p>Well that was a dumb mistake, sorry to bother you.</p>\n"}], "owner": {"reputation": 969, "user_id": 9119391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91441ccec1aeff26e087429cf3d0b2cd?s=128&d=identicon&r=PG&f=1", "display_name": "Johnny Cache", "link": "https://stackoverflow.com/users/9119391/johnny-cache"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 511, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565110010, "creation_date": 1565054772, "question_id": 57367780, "link": "https://stackoverflow.com/questions/57367780/deep-nested-structures-in-go-gorm", "title": "Deep nested structures in Go-Gorm", "body": "<p>I'm making an http service on Go, using Gorm with PostgreSQL, and I've encountered something weird.\nI've got a three level nested model for a library:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Page struct {\n    ID int64 `sql:\"auto_increment\" json:\"-\"`\n    Number int64 `json:\"number\"`\n    Book Book `gorm:\"foreignkey:book_id\" json:\"-\"`\n    BookID int64 `json:\"book_id\"`\n    Text string `json:\"text\"`\n}\n\ntype Book struct {\n    ID int64 `sql:\"auto_increment\" json:\"-\"`\n    ShelfPlace int64 `json:\"shelf_place\"`\n    Shelf Shelf `gorm:\"foreignkey:shelf_id\" json:\"-\"`\n    ShelfID int64 `json:\"shelf_id\"`\n    Author string `json:\"author\"`\n    Publisher string `json:\"publisher\"`\n    PagesAmount int64 `json:\"pages_amount\"`\n}\n\ntype Shelf struct {\n    ID int64 `sql:\"auto_increment\" json:\"-\"`\n    Number int64 `json:\"number\"`\n    BooksAmount int64 `json:\"books_amount\"`\n    Book []Book `json:\"books\"`\n}\n</code></pre>\n\n<p>As you can see, books belong to shelves and pages belong to books.\nThen, I add the following json to test it out:</p>\n\n<pre><code>{\n  \"number\": 1,\n  \"books\": [\n    {\n      \"shelf_place\": 5,\n      \"author\": \"Lewis Carroll\",\n      \"publisher\": \"EA\",\n      \"pages_amount\": 2,\n      \"pages\": [\n        {\n          \"number\": 2,\n          \"text\": \"lorem ipsum\"\n        },\n        {\n          \"number\": 4,\n          \"text\": \"dolor sit amet\"\n        }\n      ]\n    },\n    {\n      \"shelf_place\": 7,\n      \"author\": \"Mark Twain\",\n      \"publisher\": \"Activision\",\n      \"pages_amount\": 3,\n      \"pages\": [\n        {\n          \"number\": 1,\n          \"text\": \"this is\"\n        },\n        {\n          \"number\": 3,\n          \"text\": \"a test\"\n        },\n        {\n          \"number\": 6,\n          \"text\": \"of json\"\n        }\n      ]\n    }\n  ]\n}\n</code></pre>\n\n<p>And while books actually add to the database along with the shelves, pages... just don't. Without any error messages, panics, anything - even though I think I check for errors quite rigorously.\nThey all seem to be connected in exactly the same way - why wouldn't it add?\nHere's the adding function, even though I doubt that's the problem.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func requestShelfAdd(w http.ResponseWriter, r *http.Request) {\n    var newShelf Shelf\n    decoder := json.NewDecoder(r.Body)\n    err := decoder.Decode(&amp;newShelf)\n    if err != nil {\n        w.WriteHeader(http.StatusBadRequest)\n        fmt.Println(\"Error when decoding JSON: %v\", err)\n        fmt.Fprintf(w, \"Error when decoding JSON: %v\", err)\n        return\n    }\n    err = shelfStore.Create(&amp;newShelf) //shelfStore just stores current DB connection. Not much there, but I can give it to you if you want it\n    if err != nil {\n        w.WriteHeader(http.StatusInternalServerError)\n        fmt.Fprintf(w, \"Error when writing to database: %v\", err)\n        fmt.Println(\"Error when writing to database: %v\", err)\n        return\n    }\n    encoder := json.NewEncoder(w)\n    err = encoder.Encode(newShelf)\n    if err != nil {\n        w.WriteHeader(http.StatusInternalServerError)\n        fmt.Fprintf(w, \"Error when encoding JSON: %v\", err)\n        fmt.Println(\"Error when encoding JSON: %v\", err)\n        return\n    }\n}\n</code></pre>\n\n<p>I'd google what the problem is, but to be perfectly honest... I don't even have any idea where to start. Is it something with my json? Doesn't seem to be the case. My structs? Look bloody identical. This is seriously confusing.</p>\n"}, {"tags": ["go", "elasticsearch", "bulk"], "answers": [{"tags": [], "owner": {"reputation": 1139, "user_id": 7674214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cl0u4.jpg?s=128&g=1", "display_name": "Kevin Quinzel", "link": "https://stackoverflow.com/users/7674214/kevin-quinzel"}, "is_accepted": false, "score": 0, "last_activity_date": 1565072158, "creation_date": 1565072158, "answer_id": 57369924, "question_id": 57367094, "link": "https://stackoverflow.com/questions/57367094/how-to-implement-multiple-delete-with-bulkdelete/57369924#57369924", "title": "How to implement multiple delete with bulkDelete", "body": "<p>Have you tried to use <a href=\"http://programming.freeideas.cz/2017/03/07/golang-elasticsearch-delete-by-query-usage/\" rel=\"nofollow noreferrer\">Delete by query with Go</a>?</p>\n\n<p>The delete by query API from ES lets you delete all the objects that satisfy certain query. </p>\n\n<p>Just be careful. If you don't have any query, all the objects in the index will be deleted. You know, like the DELETE without a WHERE joke :P</p>\n\n<p>Hope this is helpful :D</p>\n"}], "owner": {"reputation": 11, "user_id": 11886738, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-viVeLqdHlm0/AAAAAAAAAAI/AAAAAAAAAB0/s2l3bejR2dg/photo.jpg?sz=128", "display_name": "\u0410\u043c\u0430\u043d\u043a\u0443\u043b\u043e\u0432\u0430 \u0410\u0439\u044f", "link": "https://stackoverflow.com/users/11886738/%d0%90%d0%bc%d0%b0%d0%bd%d0%ba%d1%83%d0%bb%d0%be%d0%b2%d0%b0-%d0%90%d0%b9%d1%8f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565072158, "creation_date": 1565047092, "question_id": 57367094, "link": "https://stackoverflow.com/questions/57367094/how-to-implement-multiple-delete-with-bulkdelete", "title": "How to implement multiple delete with bulkDelete", "body": "<p>I have array of Profile Ids (uid) and need to delete all these profiles with 1 request.</p>\n\n<p>Here is my code.</p>\n\n<pre><code>func MultipleDeleteFromElastic(index string, inType string, uid string, ct interface{}) error {\n    client, err := GetElasticCon()\n    if err != nil {\n        ElasticConnectError.DeveloperMessage = err.Error()\n        return ElasticConnectError\n    }\n\n    deleteReq := elastic.NewBulkDeleteRequest().Index(index).Type(inType).Id(uid)\n    _, err1 := client.Bulk().Add(deleteReq).Do(context.Background())\n    if err1 != nil {\n        ElasticConnectError.DeveloperMessage = err1.Error()\n        return ElasticConnectError\n    }\n    return err1\n}\n</code></pre>\n\n<p>What does the bulkDelete need? How I can pass an array in BulkDelete?</p>\n\n<p>I have no idea if I doing this right (obviously I am not).</p>\n"}, {"tags": ["amazon-web-services", "docker", "go"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11886651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8aa592eba4e76df5cb8d45792e0734d4?s=128&d=identicon&r=PG&f=1", "display_name": "user11886651", "link": "https://stackoverflow.com/users/11886651/user11886651"}, "is_accepted": false, "score": 0, "last_activity_date": 1565159813, "creation_date": 1565159813, "answer_id": 57388288, "question_id": 57366959, "link": "https://stackoverflow.com/questions/57366959/iam-roles-dont-work-with-golang-docker-containers/57388288#57388288", "title": "IAM Roles don&#39;t work with golang Docker containers", "body": "<p>When I copy over the /etc folder from my base image in my docker file <code>COPY --from=builder /etc /etc</code>, the iam role work properly, and the final image only grows to 11.6mb. However, I'm not sure why this works. Could someone please explain.</p>\n"}], "owner": {"reputation": 1, "user_id": 11886651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8aa592eba4e76df5cb8d45792e0734d4?s=128&d=identicon&r=PG&f=1", "display_name": "user11886651", "link": "https://stackoverflow.com/users/11886651/user11886651"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1565159813, "creation_date": 1565045786, "question_id": 57366959, "link": "https://stackoverflow.com/questions/57366959/iam-roles-dont-work-with-golang-docker-containers", "title": "IAM Roles don&#39;t work with golang Docker containers", "body": "<p>FYI, I am relatively new to docker but experienced in go and aws.</p>\n\n<p>I am using docker containers to build my golang app (for elastic beanstalk) with golang:1.12.7 as my base image. I use a multistage docker build by building a base image and then copy over my golang binary from scratch to reduce my final image from 1gb to 11 mb. </p>\n\n<p>Everything compiles properly and am able to run the docker image; however, when I use a multistage build, my IAM roles don't work and the docker image cannot connect or retrieve data from my aws services that are defined in my IAM role. </p>\n\n<p>When I build the base image, without scratch, the IAM roles work fine and can retrieve data from aws, but I'm left with a 1gb docker image.</p>\n\n<p>I haven't changed any other aws configurations, networking, security groups, iam roles, etc, other than the differences in the two Dockerfiles below.  </p>\n\n<pre><code># Dockerfile produces image (11mb) but IAM roles don't work:\nFROM golang:1.12.7 as builder #golang version\nENV GOPATH=\"/app\" # set new gopath\n\n# setup initial container\nRUN mkdir /app\nWORKDIR /app/src/appDirectory\nCOPY ./appDirectory/ /app/src/appDirectory\n\nRUN go get -u github.com/aws/aws-sdk-go # get go dependencies\n\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o appDirectory # compile to binary\n\n# create new container from scratch to reduce size of image\nFROM scratch\nCOPY --from=builder /app/src/appDirectory /app/\n\nENTRYPOINT [\"/app/appDirectory\"]\n</code></pre>\n\n<pre><code># Dockerfile produces image (1gb) and IAM roles work:\nFROM golang:1.12.7 as builder #golang version\n\nENV GOPATH=\"/app\" # set new gopath\n\n# setup initial container\nRUN mkdir /app\nWORKDIR /app/src/appDirectory\nCOPY ./appDirectory/ /app/src/appDirectory\n\nRUN go get -u github.com/aws/aws-sdk-go # get go dependencies\n\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o appDirectory # compile to binary\n\nENTRYPOINT [\"./appDirectory\"]\n</code></pre>\n\n<p>My assumption is that something's not copied over from the base docker image that's keeping the IAM roles from working, but I haven't figured out why that is. </p>\n\n<p>Also, I would prefer to use IAM roles over programmatic access keys for several reasons. </p>\n\n<p>Thank you in advance for any help provided :)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1565043231, "post_id": 57366475, "comment_id": 101219479, "body": "The percent encoding in the second snippet is the correct encoding of <code>:</code>, <code>&quot;</code> and other special URL octets.  Does the server have a problem with the encoding?"}, {"owner": {"reputation": 457, "user_id": 6171578, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9e035177e9539ce163b0197a777b34f7?s=128&d=identicon&r=PG&f=1", "display_name": "botscripter", "link": "https://stackoverflow.com/users/6171578/botscripter"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1565043957, "post_id": 57366475, "comment_id": 101219642, "body": "Yeah, it&#39;s absolutely clear that this would be the correct encoding. But <a href=\"https://search.maven.org/classic/#api\" rel=\"nofollow noreferrer\">search.maven.org/classic/#api</a> accepts it only with the unencoded quotes and colons :("}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565098508, "post_id": 57366475, "comment_id": 101239078, "body": "Then the API is broken unfortunately, as unescaped double-quotes are not permitted in URIs: <a href=\"https://tools.ietf.org/html/rfc3986#section-2\" rel=\"nofollow noreferrer\">tools.ietf.org/html/rfc3986#section-2</a> you&#39;ll have to do your own handling of the string since you are looking to intentionally create an invalid URI."}], "answers": [{"comments": [{"owner": {"reputation": 457, "user_id": 6171578, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9e035177e9539ce163b0197a777b34f7?s=128&d=identicon&r=PG&f=1", "display_name": "botscripter", "link": "https://stackoverflow.com/users/6171578/botscripter"}, "edited": false, "score": 0, "creation_date": 1565049365, "post_id": 57366919, "comment_id": 101220568, "body": "Thanks for your awesome help. But I think that <i>Opaque</i> just replaces the host as well and then I get this: <code>http:&#47;solrsearch&#47;select?q=g:&quot;ch.viascom.groundwork&quot;+AND+a:&quot;f&zwnj;&#8203;oxhttp&quot;&amp;rows=20&amp;core&zwnj;&#8203;=gav</code> But it helped me out to create the desired URL with RawQuery. Now the GET url looks as it should be, but I arrived at a new error: <code>&amp;{400 Bad Request 400 HTTP&#47;1.1 1 1 map[Connection:[keep-alive] Date:[Mon, 05 Aug 2019 23:56:45 GMT] Server:[nginx&#47;1.14.1]] 0xc00011a080 -1 [chunked] false false map[] 0xc0000d4000 &lt;nil&gt;}</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 457, "user_id": 6171578, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9e035177e9539ce163b0197a777b34f7?s=128&d=identicon&r=PG&f=1", "display_name": "botscripter", "link": "https://stackoverflow.com/users/6171578/botscripter"}, "edited": false, "score": 1, "creation_date": 1565050675, "post_id": 57366919, "comment_id": 101220757, "body": "It looks like you called <a href=\"https://godoc.org/net/url#URL.String\" rel=\"nofollow noreferrer\">URL.String</a> to get <code>http:&#47;solrsearch&#47;select?q=g:&quot;ch.viascom.groundwork&quot;+AND+a:&quot;f&zwnj;&#8203;oxhttp&quot;&amp;rows=20&amp;core&zwnj;&#8203;=gav</code>.   The net/http package calls <a href=\"https://godoc.org/net/url#URL.RequestURI\" rel=\"nofollow noreferrer\">URL.RequestURI</a> to get the request URI, not  URL.String. The RequestURI method does the right thing for this scenario (it ignores Host and Scheme). See <a href=\"https://play.golang.org/p/Iq-8UGevkld\" rel=\"nofollow noreferrer\">this playground example</a> for how the request is rendered on the wire."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 457, "user_id": 6171578, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9e035177e9539ce163b0197a777b34f7?s=128&d=identicon&r=PG&f=1", "display_name": "botscripter", "link": "https://stackoverflow.com/users/6171578/botscripter"}, "edited": false, "score": 0, "creation_date": 1565050980, "post_id": 57366919, "comment_id": 101220810, "body": "Regarding the 400 response:  a) The issue may be something other than the encoding  b) Is there an nginx reverse proxy in front of the server? If so, is it possible that the nginx is percent encoding the request URI?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1565052248, "last_edit_date": 1565052248, "creation_date": 1565045436, "answer_id": 57366919, "question_id": 57366475, "link": "https://stackoverflow.com/questions/57366475/how-can-i-use-double-quotes-and-colons-in-a-http-get-request-as-query-string/57366919#57366919", "title": "How can I use double quotes and colons in a http.Get Request as query string?", "body": "<p>Given that server does not handle percent encoding, use basic string operations to construct the URI.  </p>\n\n<p>To work around the decoding and encoding of URLs by the net/http package, use the URL.Opaque field to specify the URI.</p>\n\n<pre><code>func searchOnMavenCentral() {\n    var groupId = \"ch.viascom.groundwork\"\n    var artifactId = \"foxhttp\"\n\n    qp := \"q=g:\\\"\" + groupId + `\"+AND+a:\"` + artifactId + `\"` +\n      \"&amp;rows=20\" +\n      \"&amp;core=gav\"\n\n    req, _ := http.NewRequest(\"GET\", \"http://search.maven.org\", nil)\n    req.URL = &amp;url.URL{\n       Scheme: req.URL.Scheme,\n       Host: req.URL.Host,\n       Opaque: \"/solrsearch/select?\" + qp,\n    }\n    resp, err := http.DefaultClient.Do(req)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    log.Println(resp.Request.URL)\n    log.Println(resp)\n}\n</code></pre>\n"}], "owner": {"reputation": 457, "user_id": 6171578, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9e035177e9539ce163b0197a777b34f7?s=128&d=identicon&r=PG&f=1", "display_name": "botscripter", "link": "https://stackoverflow.com/users/6171578/botscripter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 645, "favorite_count": 0, "accepted_answer_id": 57366919, "answer_count": 1, "score": -2, "last_activity_date": 1565052248, "creation_date": 1565041687, "last_edit_date": 1565049705, "question_id": 57366475, "link": "https://stackoverflow.com/questions/57366475/how-can-i-use-double-quotes-and-colons-in-a-http-get-request-as-query-string", "title": "How can I use double quotes and colons in a http.Get Request as query string?", "body": "<p>I would like to send this rest call ... </p>\n\n<pre><code>GET http://search.maven.org/solrsearch/select?q=g:\"ch.viascom.groundwork\"+AND+a:\"foxhttp\"&amp;rows=100&amp;core=gav\n</code></pre>\n\n<p>... but can't because it gets encoded to</p>\n\n<pre><code>http://search.maven.org/solrsearch/select?core=gav&amp;q=g%3A%22ch.viascom.groundwork%22%2BAND%2Ba%3A%22foxhttp%22&amp;rows=20\n</code></pre>\n\n<p>This is my go function:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func searchOnMavenCentral() {\n    var groupId = \"ch.viascom.groundwork\"\n    var artifactId = \"foxhttp\"\n\n    params := url.Values{}\n    params.Add(\"q\", `g:\"` + groupId + `\"+AND+a:\"` + artifactId + `\"`)\n    params.Add(\"rows\", \"20\")\n    params.Add(\"core\", \"gav\")\n\n    resp, err := http.Get(\"http://search.maven.org/solrsearch/select?\" + params.Encode())\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    log.Println(resp.Request.URL)\n    log.Println(resp)\n}\n</code></pre>\n\n<p>How can I solve this problem? Thx for your help in advance!</p>\n\n<p><strong>Updated state</strong></p>\n\n<p>With your help I managed to create the desired URL, but I'm facing the following new issue now:</p>\n\n<pre><code>&amp;{400 Bad Request 400 HTTP/1.1 1 1 map[Connection:[keep-alive] Date:[Mon, 05 Aug 2019 23:56:45 GMT] Server:[nginx/1.14.1]] 0xc00011a080 -1 [chunked] false false map[] 0xc0000d4000 &lt;nil&gt;}\n\n</code></pre>\n\n<p>This is the updated code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func searchOnMavenCentral() {\n    var groupId = \"ch.viascom.groundwork\"\n    var artifactId = \"foxhttp\"\n\n    qp := \"q=g:\\\"\" + groupId + `\"+AND+a:\"` + artifactId + `\"` +\n        \"&amp;rows=20\" +\n        \"&amp;core=gav\"\n\n    u := &amp;url.URL{\n        Scheme:   \"http\",\n        Host:     \"search.maven.org\",\n        Path:     \"/solrsearch/select\",\n        RawQuery: qp,\n    }\n\n    resp, err := http.Get (u.String())\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    log.Println(resp.Request.URL)\n    log.Println(resp)\n}\n</code></pre>\n"}, {"tags": ["arrays", "go", "interface", "type-assertion"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 6, "creation_date": 1565040930, "post_id": 57366169, "comment_id": 101218902, "body": "The usual approach is to define Go types that match the structure of the JSON and decode to the type.  Show the complete JSON."}, {"owner": {"reputation": 43, "user_id": 10542844, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PBm-_RMSXio/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCZwndQcIm7Io0ZZ60ISuojaEtdMw/mo/photo.jpg?sz=128", "display_name": "Nathan Phillips", "link": "https://stackoverflow.com/users/10542844/nathan-phillips"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565041815, "post_id": 57366169, "comment_id": 101219130, "body": "added more of the json"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565042810, "post_id": 57366169, "comment_id": 101219381, "body": "The custom fields have different value types.  Is the type determined by the name of the field (&quot;customfield_11343&quot; is an example) or something else?"}, {"owner": {"reputation": 43, "user_id": 10542844, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PBm-_RMSXio/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCZwndQcIm7Io0ZZ60ISuojaEtdMw/mo/photo.jpg?sz=128", "display_name": "Nathan Phillips", "link": "https://stackoverflow.com/users/10542844/nathan-phillips"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565043296, "post_id": 57366169, "comment_id": 101219500, "body": "that is determined by Jira themselves"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1565043442, "post_id": 57366169, "comment_id": 101219543, "body": "Are the value types arbitrary, or is there a documented mapping between the field names and the value types?"}, {"owner": {"reputation": 43, "user_id": 10542844, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PBm-_RMSXio/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCZwndQcIm7Io0ZZ60ISuojaEtdMw/mo/photo.jpg?sz=128", "display_name": "Nathan Phillips", "link": "https://stackoverflow.com/users/10542844/nathan-phillips"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565043796, "post_id": 57366169, "comment_id": 101219616, "body": "from what I can tell its pretty much arbitrary. jira offers a very high level way of choosing customfields and it populates the types and the entries"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565068362, "post_id": 57366169, "comment_id": 101223967, "body": "Dave Johnson in his answer is on the right track in my opinion, however you do not need reflection to check whether the value is an array or an object, all you need is to take a look at the first byte. <a href=\"https://play.golang.org/p/GiVx60gY-ng\" rel=\"nofollow noreferrer\">play.golang.org/p/GiVx60gY-ng</a>"}], "answers": [{"tags": [], "owner": {"reputation": 121, "user_id": 11853614, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hRRQb.jpg?s=128&g=1", "display_name": "Dave Johnson", "link": "https://stackoverflow.com/users/11853614/dave-johnson"}, "is_accepted": false, "score": 3, "last_activity_date": 1565194214, "last_edit_date": 1565194214, "creation_date": 1565046079, "answer_id": 57366989, "question_id": 57366169, "link": "https://stackoverflow.com/questions/57366169/is-there-a-simpler-way-to-decode-this-json-in-go/57366989#57366989", "title": "Is there a simpler way to decode this json in Go?", "body": "<p>This is a tough one since the second one is in an array form. It makes it hard to use a map. </p>\n\n<p>For the first one, it's simple enough to use:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type JiraCustomField struct {\n    Self         string `json:\"self\"`\n    Name         string `json:\"name\"`\n    Key          string `json:\"key\"`\n    EmailAddress string `json:\"emailAddress\"`\n    DisplayName  string `json:\"displayName\"`\n    Active       bool   `json:\"active\"`\n    TimeZone     string `json:\"timeZone\"`\n}\ntype JiraPayload struct {\n    Expand string                     `json:\"expand\"`\n    ID     string                     `json:\"id\"`\n    Key    string                     `json:\"key\"`\n    Fields map[string]JiraCustomField `json:\"fields\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/y8-g6r0kInV\" rel=\"nofollow noreferrer\">https://play.golang.org/p/y8-g6r0kInV</a></p>\n\n<p>Specifically this part <code>Fields map[string]JiraCustomField</code> for the second case it looks like you need it in an array form like <code>Fields map[string][]JiraCustomField</code>. </p>\n\n<p>In a case like this, I think you'll need to make your own Unmarshaler. This is a good tutorial: <a href=\"https://blog.gopheracademy.com/advent-2016/advanced-encoding-decoding/\" rel=\"nofollow noreferrer\">https://blog.gopheracademy.com/advent-2016/advanced-encoding-decoding/</a></p>\n\n<p>What you could do with your custom Unmarshal/marshaler, is use the Reflection package and check if it's an array or a struct. If it's a struct then put it into an array, and store it in <code>Fields map[string][]JiraCustomField</code>. </p>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 10542844, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PBm-_RMSXio/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCZwndQcIm7Io0ZZ60ISuojaEtdMw/mo/photo.jpg?sz=128", "display_name": "Nathan Phillips", "link": "https://stackoverflow.com/users/10542844/nathan-phillips"}, "edited": false, "score": 0, "creation_date": 1565126478, "post_id": 57367052, "comment_id": 101252392, "body": "hmm.. so what go-jira does is return an IssueFields type, with those customfields in the &quot;Unknowns&quot; data. I assume i would need to do something similar to this but get the data from the MarshalMap of the Unknowns into my created struct?"}, {"owner": {"reputation": 43, "user_id": 10542844, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PBm-_RMSXio/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCZwndQcIm7Io0ZZ60ISuojaEtdMw/mo/photo.jpg?sz=128", "display_name": "Nathan Phillips", "link": "https://stackoverflow.com/users/10542844/nathan-phillips"}, "edited": false, "score": 2, "creation_date": 1565127308, "post_id": 57367052, "comment_id": 101252642, "body": "wow okay, so all along there was a .Values() method of the Unknowns type.. and you can access fields like this <code>dev, exists := jiraIssue.Fields.Unknowns.Value(&quot;customfield_11343&#47;name&quot;)</code> . I appreciate the learning from the answers though"}, {"owner": {"reputation": 3847, "user_id": 12677, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8892ff21c03d7a54e66d82b717635e74?s=128&d=identicon&r=PG", "display_name": "tovare", "link": "https://stackoverflow.com/users/12677/tovare"}, "reply_to_user": {"reputation": 43, "user_id": 10542844, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PBm-_RMSXio/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCZwndQcIm7Io0ZZ60ISuojaEtdMw/mo/photo.jpg?sz=128", "display_name": "Nathan Phillips", "link": "https://stackoverflow.com/users/10542844/nathan-phillips"}, "edited": false, "score": 0, "creation_date": 1565128891, "post_id": 57367052, "comment_id": 101253145, "body": "Cool :-) I think you can also do a NewRawRequest t if you want the library to mostly go away but still use it for authentication."}], "tags": [], "owner": {"reputation": 3847, "user_id": 12677, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8892ff21c03d7a54e66d82b717635e74?s=128&d=identicon&r=PG", "display_name": "tovare", "link": "https://stackoverflow.com/users/12677/tovare"}, "is_accepted": true, "score": 3, "last_activity_date": 1565046726, "creation_date": 1565046726, "answer_id": 57367052, "question_id": 57366169, "link": "https://stackoverflow.com/questions/57366169/is-there-a-simpler-way-to-decode-this-json-in-go/57367052#57367052", "title": "Is there a simpler way to decode this json in Go?", "body": "<p>The way I go about problems like this is:</p>\n\n<ol>\n<li>Copy some JSON with things I am interested in and paste it into <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a> </li>\n<li>Remove fields that aren\u00b4t of interest.</li>\n<li>Just read the data and unmarshal.</li>\n</ol>\n\n<p>You might end up with something like this given the two custom fields of interest, but you can cut the structure down further if you just need the name.</p>\n\n<pre class=\"lang-json prettyprint-override\"><code>type AutoGenerated struct {\n    Fields struct {\n        Customfield11343 struct {\n            Self         string `json:\"self\"`\n            Name         string `json:\"name\"`\n            Key          string `json:\"key\"`\n            EmailAddress string `json:\"emailAddress\"`\n            DisplayName  string `json:\"displayName\"`\n            Active       bool   `json:\"active\"`\n            TimeZone     string `json:\"timeZone\"`\n        } `json:\"customfield_11343\"`\n        Customfield12046 []struct {\n            Self  string `json:\"self\"`\n            Value string `json:\"value\"`\n            ID    string `json:\"id\"`\n        } `json:\"customfield_12046\"`\n    } `json:\"fields\"`\n}\n</code></pre>\n\n<p>The effect you get is that all extra information in the feed is discarded, but you get the data you want very cleanly.</p>\n"}], "owner": {"reputation": 43, "user_id": 10542844, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PBm-_RMSXio/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCZwndQcIm7Io0ZZ60ISuojaEtdMw/mo/photo.jpg?sz=128", "display_name": "Nathan Phillips", "link": "https://stackoverflow.com/users/10542844/nathan-phillips"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 57367052, "answer_count": 2, "score": 1, "last_activity_date": 1565194214, "creation_date": 1565039642, "last_edit_date": 1565042024, "question_id": 57366169, "link": "https://stackoverflow.com/questions/57366169/is-there-a-simpler-way-to-decode-this-json-in-go", "title": "Is there a simpler way to decode this json in Go?", "body": "<p>I am trying to parse some JSON from Jira to variables. This is using the go-jira package (<a href=\"https://godoc.org/github.com/andygrunwald/go-jira\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/andygrunwald/go-jira</a>)</p>\n\n<p>Currently I have some code to get the developer:</p>\n\n<p><code>dev := jiraIssue.Fields.Unknowns[\"customfield_11343\"].(map[string]interface{})[\"name\"]</code></p>\n\n<p>and <code>team := jiraIssue.Fields.Unknowns[\"customfield_12046\"].([]interface{})[0].(map[string]interface{})[\"value\"]</code> </p>\n\n<p>to get the team they are a part of from.</p>\n\n<p>Getting the team they are on is a bit gross, is there a cleaner way to get the team besides having to type assert, set the index, then type assert again? </p>\n\n<p>Here is the complete json (modified but structure is same, its way too long):</p>\n\n<pre><code>{    \n \"expand\":\"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations\",\n   \"id\":\"136944\",\n   \"self\":\"https://jira.redacted.com/rest/api/2/issue/136944\",\n   \"key\":\"RM-2506\",\n   \"fields\":{  \n      \"customfield_11343\":{  \n         \"self\":\"https://redacted.com/rest/api/2/user?username=flast\",\n         \"name\":\"flast\",\n         \"key\":\"flast\",\n         \"emailAddress\":\"flast@redacted.com\",\n         \"displayName\":\"first last\",\n         \"active\":true,\n         \"timeZone\":\"Europe/London\"\n      },\n      \"customfield_12046\":[  \n         {  \n            \"self\":\"https://jira.redacted.com/rest/api/2/customFieldOption/12045\",\n            \"value\":\"diy\",\n            \"id\":\"12045\"\n         }\n      ],\n\n   }\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "kubernetes", "kubernetes-helm", "templating", "gluu"], "comments": [{"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1565033172, "post_id": 57364093, "comment_id": 101216153, "body": "The \u201chost: opendj\u201d and \u201cport: 3434\u201d aren\u2019t paired together in your YAML. If you want to use [ ... ] for the array, wrap the host/port pair in { ... }. Alternatively drop the square brackets and use a - indicating a new array item for each host/port pair."}, {"owner": {"reputation": 567, "user_id": 4825076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/3364c7cdae60d5a15b5d9a5d640f7006?s=128&d=identicon&r=PG&f=1", "display_name": "Shammir", "link": "https://stackoverflow.com/users/4825076/shammir"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1565035932, "post_id": 57364093, "comment_id": 101217249, "body": "I don&#39;t think that is the issue. When I put <code>extraHosts</code> outside of ldap, it gets called fine."}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1565037595, "post_id": 57364093, "comment_id": 101217864, "body": "It would be helpful if you could provide a complete minimal example. What is your directory structure, what command are you running, what version of Helm, and what your expected output is. That way people can try to reproduce locally."}, {"owner": {"reputation": 567, "user_id": 4825076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/3364c7cdae60d5a15b5d9a5d640f7006?s=128&d=identicon&r=PG&f=1", "display_name": "Shammir", "link": "https://stackoverflow.com/users/4825076/shammir"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1565039096, "post_id": 57364093, "comment_id": 101218382, "body": "I have updated the description. @AmitKumarGupta"}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1565039751, "post_id": 57364093, "comment_id": 101218576, "body": "Unfortunately that&#39;s not enough info for me to try to reproduce. First off, are you saying <code>templates</code>, <code>requirements.yml</code>, and <code>values.yml</code> are sibling to you <code>charts</code> directory, rather than inside your <code>chart_b</code> directory? Also, what command are you running? Could you provide a complete minimal example that works? That might entail creating a dummy non-<code>_xxx.tpl</code> file so that <code>helm template</code> isn&#39;t a no-op. You could show the desired output you&#39;d expect from running <code>helm template</code> (if that is indeed the command you&#39;re running, I don&#39;t know) just as you&#39;ve shown the input <code>values.yml</code>."}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1565039805, "post_id": 57364093, "comment_id": 101218594, "body": "I&#39;ve set up a directory in Helm chart structure with some subdirectories and files matching what you&#39;ve provided, plus some extra files to make it not no-op, and run <code>helm template . --values values.yml</code> and am not seeing the error you&#39;re doing.  But I have no idea if what I&#39;m doing is similar at all to what you&#39;re doing."}, {"owner": {"reputation": 3085, "user_id": 7568391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a093b595f8c37642e9c00b8a66d5cfc4?s=128&d=identicon&r=PG", "display_name": "edbighead", "link": "https://stackoverflow.com/users/7568391/edbighead"}, "edited": false, "score": 0, "creation_date": 1565076479, "post_id": 57364093, "comment_id": 101227028, "body": "can you provide deployment/service yaml where you want your rendered values to be"}, {"owner": {"reputation": 567, "user_id": 4825076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/3364c7cdae60d5a15b5d9a5d640f7006?s=128&d=identicon&r=PG&f=1", "display_name": "Shammir", "link": "https://stackoverflow.com/users/4825076/shammir"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1565173202, "post_id": 57364093, "comment_id": 101266199, "body": "@AmitKumarGupta question updated"}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1565178282, "post_id": 57364093, "comment_id": 101269072, "body": "Thanks, this can be solved with global values. Will add an answer."}], "answers": [{"comments": [{"owner": {"reputation": 567, "user_id": 4825076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/3364c7cdae60d5a15b5d9a5d640f7006?s=128&d=identicon&r=PG&f=1", "display_name": "Shammir", "link": "https://stackoverflow.com/users/4825076/shammir"}, "edited": false, "score": 0, "creation_date": 1565183516, "post_id": 57393952, "comment_id": 101272158, "body": "Can I ask you one more thing please. I am struggling referencing for example <code>serviceName</code> of <code>chart_a</code> in parent chart. Could you kindly help on that. I have an ingress that I want to deploy in parent chart but the <code>service</code> to referenced by the ingress is in <code>chart_a</code>"}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "reply_to_user": {"reputation": 567, "user_id": 4825076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/3364c7cdae60d5a15b5d9a5d640f7006?s=128&d=identicon&r=PG&f=1", "display_name": "Shammir", "link": "https://stackoverflow.com/users/4825076/shammir"}, "edited": false, "score": 0, "creation_date": 1565203732, "post_id": 57393952, "comment_id": 101282786, "body": "Glad that worked! As for your new question, it would be best to create a new question on StackOverflow."}], "tags": [], "owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "is_accepted": true, "score": 1, "last_activity_date": 1565179052, "creation_date": 1565179052, "answer_id": 57393952, "question_id": 57364093, "link": "https://stackoverflow.com/questions/57364093/how-to-fix-cant-evaluate-field-extrahosts-in-type-interface-in-helpers-tp/57393952#57393952", "title": "How to fix `can&#39;t evaluate field extraHosts in type interface {}` in _helpers.tpl in helm", "body": "<p>This can be solved with global values which allow values in the parent chart to override (or supply unspecified) values in the child subcharts.</p>\n\n<p>From the <a href=\"https://helm.sh/docs/chart_template_guide/#subcharts-and-global-values\" rel=\"nofollow noreferrer\">Helm docs on <em>Subcharts and Global Values</em></a>:</p>\n\n<blockquote>\n  <ol>\n  <li>A subchart is considered \u201cstand-alone\u201d, which means a subchart can never explicitly depend on its parent chart.</li>\n  <li>For that reason, <strong>a subchart cannot access the values of its parent</strong>.</li>\n  <li>A parent chart can override values for subcharts.</li>\n  <li><strong>Helm has a concept of <em>global values</em> that can be accessed by all charts</strong>.</li>\n  </ol>\n</blockquote>\n\n<p>(At first I didn't think to search for \"helm subchart\" but once I did an Internet search for that term, this was the first or second result)</p>\n\n<p>Here's a minimal example that solves your issue:</p>\n\n<h3>Directory Structure</h3>\n\n<pre><code>helm\n\u251c\u2500\u2500 Chart.yaml\n\u251c\u2500\u2500 charts\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 chart_a\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 Chart.yaml\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 templates\n\u2502\u00a0\u00a0         \u2514\u2500\u2500 configMap.yml\n\u251c\u2500\u2500 templates\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 _helpers.tpl\n\u2514\u2500\u2500 values.yaml\n</code></pre>\n\n<p>Note: I added <code>Chart.yaml</code> files to make it actually work, renamed <code>values.yml</code> to <code>values.yaml</code> so that it works by default without extra flags, and removed <code>requirements.yml</code> since it wasn't necessary to reproduce the problem and solution.</p>\n\n<h3><code>values.yaml</code></h3>\n\n<pre><code>global:\n  ldap:\n    enabled: true\n    type: opendj\n    extraHosts:\n    - host: opendj\n      port: 3434\n  ldapType: xxx\n  ldapPort: 123\n</code></pre>\n\n<p>The key was to nest what you had under a special <code>global</code> key. Note, I also added <code>ldapType</code> and <code>ldapPort</code> since they were in your <code>_helpers.tpl</code>, and I fixed the YAML structure you had under <code>extraHosts</code>. What was there before didn't actually represent a list of maps with <code>host</code> and <code>port</code> keys. Without this fix, the <code>helm</code> command doesn't fail but doesn't output what you want either.</p>\n\n<h3>Result</h3>\n\n<pre><code>$ helm template .\n---\n# Source: helm/charts/chart_a/templates/configMap.yml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: cm\ndata:\n  GLUU_LDAP_URL: release-name-xxx:123,opendj:3434\n</code></pre>\n"}], "owner": {"reputation": 567, "user_id": 4825076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/3364c7cdae60d5a15b5d9a5d640f7006?s=128&d=identicon&r=PG&f=1", "display_name": "Shammir", "link": "https://stackoverflow.com/users/4825076/shammir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2534, "favorite_count": 0, "accepted_answer_id": 57393952, "answer_count": 1, "score": 0, "last_activity_date": 1565179052, "creation_date": 1565029182, "last_edit_date": 1565173065, "question_id": 57364093, "link": "https://stackoverflow.com/questions/57364093/how-to-fix-cant-evaluate-field-extrahosts-in-type-interface-in-helpers-tp", "title": "How to fix `can&#39;t evaluate field extraHosts in type interface {}` in _helpers.tpl in helm", "body": "<p>I am trying to get some values from Umbrella chart in helm in <code>_helpers.tpl</code> but I for some reason I am getting the error <code>executing \"gluu.ldaplist\" at &lt;.Values.ldap.extraHo...&gt;: can't evaluate field extraHosts in type interface {}</code></p>\n\n<p>This is what I am trying to do.\n<code>_helpers.ptl</code></p>\n\n<pre><code>{{- define \"gluu.ldaplist\" -}}\n{{- $hosts := .Values.ldap.extraHosts -}}\n{{- $genLdap := dict \"host\" (printf \"%s-%s\" .Release.Name .Values.ldapType) \"port\" .Values.ldapPort -}}\n{{- $hosts := prepend $hosts $genLdap -}}\n{{- $local := dict \"first\" true -}}\n{{- range $k, $v := $hosts -}}\n{{- if not $local.first -}},{{- end -}}{{- printf \"%s:%.f\" $v.host $v.port -}}{{- $_ := set $local \"first\" false -}}\n{{- end -}}\n{{- end -}}\n</code></pre>\n\n<p>And this is part of <code>values.yml</code> for the umbrella chart\n<code>values.yml</code></p>\n\n<pre><code>ldap:\n  enabled: true\n  type: opendj\n  extraHosts: [\n    host: opendj,\n    port: 3434\n  ] #array of k,v e.g host: host1, port: port1\n</code></pre>\n\n<p>Directory structure</p>\n\n<pre><code>helm/\n  charts/\n     chart_a/\n       templates/\n          configMap.yml -----&gt;&gt;&gt; this is where I want to use it\n  templates/\n     _helpers.tpl ----&gt;&gt;&gt;&gt; where the failing function is\n  requirements.yml\n  values.yml ----------&gt;&gt;&gt; where the ldap values are\n\n</code></pre>\n\n<p>The <code>configMap.yml</code> looks like below</p>\n\n<pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: {{ template \"oxauth.fullname\" . }}-cm\ndata:\n  GLUU_CONFIG_ADAPTER: {{ .Values.global.configAdapterName | quote }}\n  GLUU_LDAP_URL: {{ template \"gluu.ldaplist\" . }}\n</code></pre>\n\n<p>NOTE: The <code>_helpers.tpl</code> is under the main/umbrella chart. <code>chart_a</code> is a subchart.</p>\n\n<p>Expected results are something like <code>GLUU_LDAP_URL:\"opendj:3434\"</code></p>\n\n<p>Helm version:  </p>\n\n<pre><code>Client: &amp;version.Version{SemVer:\"v2.10.0\", GitCommit:\"9ad53aac42165a5fadc6c87be0dea6b115f93090\", GitTreeState:\"clean\"}\nServer: &amp;version.Version{SemVer:\"v2.10.0\", GitCommit:\"9ad53aac42165a5fadc6c87be0dea6b115f93090\", GitTreeState:\"clean\"}\n</code></pre>\n\n<p>Expected result is that the function <code>{{- define \"gluu.ldaplist\" -}}</code> in <code>_helpers.tpl</code> completes without error even if no values are provided in the array. \nIf there are values provided, the expected string is <code>host:port</code> as output.</p>\n\n<p>If this can be done in another way, I welcome any suggestion.</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc", "go-modules", "grpc-go"], "answers": [{"comments": [{"owner": {"reputation": 1660, "user_id": 2420731, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1d36ef13d9fefcc2511d567e6da1a2ef?s=128&d=identicon&r=PG", "display_name": "Tomasz Ga\u0142kowski", "link": "https://stackoverflow.com/users/2420731/tomasz-ga%c5%82kowski"}, "edited": false, "score": 0, "creation_date": 1565028698, "post_id": 57363879, "comment_id": 101214242, "body": "Unfortunately, this seems not enough. I am generating the <code>.pb.go</code> file in <code>api</code> folder (currently trying out <code>protoc services&#47;articles&#47;api&#47;article.proto --go_out=..</code> with <code>option go_package = &quot;tkg&#47;services&#47;articles&#47;api&quot;;</code> in proto file. The <code>articles.go</code> file still won&#39;t see it. The generated Go file has <code>package api</code> but <code>import pb &quot;tkg&#47;services&#47;articles&#47;api&quot;</code> produces the same error."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 1660, "user_id": 2420731, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1d36ef13d9fefcc2511d567e6da1a2ef?s=128&d=identicon&r=PG", "display_name": "Tomasz Ga\u0142kowski", "link": "https://stackoverflow.com/users/2420731/tomasz-ga%c5%82kowski"}, "edited": false, "score": 0, "creation_date": 1565031203, "post_id": 57363879, "comment_id": 101215286, "body": "I updated the answer with some general pointers. <code>import pb</code> is basically a handy syntax to rename a package with your code - and using <code>pb</code> clearly indicates to the read it refers to a protobuf-type package. If you did not use <code>import pb</code> then you would simple refer to your protobuf structs via the actual package name e.g. <code>api.Article</code> etc."}, {"owner": {"reputation": 1660, "user_id": 2420731, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1d36ef13d9fefcc2511d567e6da1a2ef?s=128&d=identicon&r=PG", "display_name": "Tomasz Ga\u0142kowski", "link": "https://stackoverflow.com/users/2420731/tomasz-ga%c5%82kowski"}, "edited": false, "score": 0, "creation_date": 1565031563, "post_id": 57363879, "comment_id": 101215445, "body": "I had tried with internet paths as well. The issue is that I don&#39;t want to create a weird path on my local system just so Go is happy because there might  be different languages inside that project (Python, Node.js) and they are not as greedy. The project&#39;s local path must stay <code>~&#47;Projects&#47;tkg</code>. This particular Go application should be able to be contained in <code>~&#47;Projects&#47;tkg&#47;services&#47;articles</code>. I will try doing more research and going back to basics of Go packages. They really seem unintuitive when used outside of GOPATH."}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 0, "last_activity_date": 1565030824, "last_edit_date": 1565030824, "creation_date": 1565028114, "answer_id": 57363879, "question_id": 57363662, "link": "https://stackoverflow.com/questions/57363662/how-to-setup-protobuf-grpc-and-go-modules-in-a-monorepo/57363879#57363879", "title": "How to setup protobuf, grpc and Go modules in a monorepo?", "body": "<p>If you are generating the <code>.pb.go</code> file in the same directory as the <code>.proto</code> file (recommended), then your import path should read:</p>\n\n<pre><code>import (\n    pb \"tkg/services/articles/api\"\n)\n</code></pre>\n\n<p>(not  <code>tkg/services/articles/api/article</code>.)</p>\n\n<p>Go packages are collections of .go files in a single directory - each with the same <code>package XYZ</code> first line - where XYZ is the package name. So when importing a package, one uses the package base directory - not including any .go filenames.</p>\n\n<hr>\n\n<p><strong>Edit:</strong> (this was too long to fit into a comment):</p>\n\n<p>I would step back and think about the base-directory of your entire project.</p>\n\n<p>Standard go packages are usually single words like <code>time</code>, <code>sync</code> etc. because they are part of <code>go</code>'s standard library. All other packages should have a full internet path. These typically match a git repo address (e.g. <code>\"github.com/boltdb/bolt\"</code>) - but not always e.g. (<code>\"gopkg.in/yaml.v2\"</code>). This is actually superior to the centrally-hosted NPM package model - as it easily allows for pulling packages from any repo host. Also since repos are cloned to local disk - those same paths can exist on your local disk first (before they've been hosted on the internet, say for development purposes).</p>\n\n<p>So I would suggest naming your local base-directory something like:</p>\n\n<pre><code>github.com/myname/myproj/tkg/services/...\n</code></pre>\n\n<p>and then ensure you import packages based on this directory structure e.g.</p>\n\n<pre><code>import \"github.com/myname/myproj/tkg/services/api\"\n</code></pre>\n\n<p>If a <code>go build</code> does not pick up the generated (.pb.go) code, then there is something up with your <code>GOPATH</code> or if using the new go-modules your go.mod setup.</p>\n"}], "owner": {"reputation": 1660, "user_id": 2420731, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1d36ef13d9fefcc2511d567e6da1a2ef?s=128&d=identicon&r=PG", "display_name": "Tomasz Ga\u0142kowski", "link": "https://stackoverflow.com/users/2420731/tomasz-ga%c5%82kowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2409, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1567171535, "creation_date": 1565027075, "last_edit_date": 1567171535, "question_id": 57363662, "link": "https://stackoverflow.com/questions/57363662/how-to-setup-protobuf-grpc-and-go-modules-in-a-monorepo", "title": "How to setup protobuf, grpc and Go modules in a monorepo?", "body": "<p>I'm trying to create a microservice-based API in Go, very basic, just to learn some stuff. I have three main goals I have to achieve.</p>\n\n<ol>\n<li>Monorepo.</li>\n<li>Be able to use different back-end languages as need arises (ie. one microservice in Go, two in Node.js, one in Python).</li>\n<li>Use gRPC.</li>\n</ol>\n\n<p>Currently my structure looks like this (and is stored in <code>~/Projects/tkg</code>, outside of GOPATH).</p>\n\n<p><a href=\"https://i.stack.imgur.com/oYOkn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/oYOkn.png\" alt=\"project structure\"></a></p>\n\n<p>Each \"service\" should be a self-contained application written in a \"whatever\". As you can see I have a Go service and a React front-end application. Additionally there is a Makefile there that I want to use for building stuff, but I might move to shell scripts, Docker, whatever. Doesn't matter.</p>\n\n<p>So now the question. How can I make generated proto files play well with this setup? I think I don't understand something about Go modules and packages because I cannot set it so <code>articles.go</code> (from <code>cmd</code>) can access the generated <code>api/article.pb.go</code>. How to do it?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// services/articles/go.mod\nmodule tkg/services/articles\n\ngo 1.12\n\nrequire (\n    github.com/golang/protobuf v1.3.2\n    google.golang.org/grpc v1.22.1\n)\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// services/articles/cmd/article.go\npackage main\n\nimport (\n    pb \"tkg/services/articles/api/article\"\n)\n\ntype repository interface {\n    Create(*pb.Article) (*pb.Article, error)\n}\n\nfunc main() {\n\n}\n</code></pre>\n\n<pre class=\"lang-proto prettyprint-override\"><code>// services/articles/api/article.proto\nsyntax = \"proto3\";\n\npackage article;\noption go_package = \"tkg/services/articles/api/article\";\n...\n</code></pre>\n\n<pre><code>// Makefile\nbuild:\n    protoc services/articles/api/article.proto --go_out=.\n</code></pre>\n\n<p>I have tried various different package names in go.mod, different go_packages in the proto file, I had tried different protoc commands and paths. I bet this is silly and it's very obvious to someone who is well-versed in Go, but for someone from Node.js backgroud like me the inability to do <code>import \"../api/article.pb.go\"</code> is infuriating. :(</p>\n\n<p>The error I am getting is: <code>could not import tkg/services/articles/api/article (no parsed files for package tkg/services/articles/api/article)</code>. Of course with different values for package names. I've been trying to solve it for two days now.</p>\n\n<p>How would you approach this problem?</p>\n"}, {"tags": ["sql-server", "azure", "go", "ssl"], "comments": [{"owner": {"reputation": 8769, "user_id": 1537195, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/xRBvI.jpg?s=128&g=1", "display_name": "silent", "link": "https://stackoverflow.com/users/1537195/silent"}, "edited": false, "score": 0, "creation_date": 1565028305, "post_id": 57363561, "comment_id": 101214087, "body": "did you open port 1433 on the Azure network security group for your VM as well as in any firewall that you might have running on the VM itself?"}, {"owner": {"reputation": 18299, "user_id": 2648811, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ee5af60b10a2d5fd8c864437a2062f0a?s=128&d=identicon&r=PG", "display_name": "Green Cloak Guy", "link": "https://stackoverflow.com/users/2648811/green-cloak-guy"}, "reply_to_user": {"reputation": 8769, "user_id": 1537195, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/xRBvI.jpg?s=128&g=1", "display_name": "silent", "link": "https://stackoverflow.com/users/1537195/silent"}, "edited": false, "score": 0, "creation_date": 1565032877, "post_id": 57363561, "comment_id": 101215998, "body": "@silent <code>netstat -peanut</code> shows <code>tcp        0      0 0.0.0.0:1433            0.0.0.0:*               LISTEN</code>, which should be right"}, {"owner": {"reputation": 8769, "user_id": 1537195, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/xRBvI.jpg?s=128&g=1", "display_name": "silent", "link": "https://stackoverflow.com/users/1537195/silent"}, "edited": false, "score": 0, "creation_date": 1565032931, "post_id": 57363561, "comment_id": 101216021, "body": "that just means that the SQL Server is running - not that you can really reach it from the outside"}, {"owner": {"reputation": 18299, "user_id": 2648811, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ee5af60b10a2d5fd8c864437a2062f0a?s=128&d=identicon&r=PG", "display_name": "Green Cloak Guy", "link": "https://stackoverflow.com/users/2648811/green-cloak-guy"}, "reply_to_user": {"reputation": 8769, "user_id": 1537195, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/xRBvI.jpg?s=128&g=1", "display_name": "silent", "link": "https://stackoverflow.com/users/1537195/silent"}, "edited": false, "score": 0, "creation_date": 1565033013, "post_id": 57363561, "comment_id": 101216070, "body": "@silent right, sorry. The Azure NSG is also set to <code>Any</code> source, <code>*</code> port, <code>Any</code> destination, <code>*</code> port. I have a similar thing worked up for MySQL and Postgres, and when I run my program for those it works fine, so I don&#39;t think the NSG is the issue."}, {"owner": {"reputation": 8769, "user_id": 1537195, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/xRBvI.jpg?s=128&g=1", "display_name": "silent", "link": "https://stackoverflow.com/users/1537195/silent"}, "edited": false, "score": 0, "creation_date": 1565033189, "post_id": 57363561, "comment_id": 101216162, "body": "Just a very simple powershell command and you&#39;ll know for sure: <code>Test-NetConnection -ComputerName 1.2.3.4 -port 1433</code>"}, {"owner": {"reputation": 18299, "user_id": 2648811, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ee5af60b10a2d5fd8c864437a2062f0a?s=128&d=identicon&r=PG", "display_name": "Green Cloak Guy", "link": "https://stackoverflow.com/users/2648811/green-cloak-guy"}, "reply_to_user": {"reputation": 8769, "user_id": 1537195, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/xRBvI.jpg?s=128&g=1", "display_name": "silent", "link": "https://stackoverflow.com/users/1537195/silent"}, "edited": false, "score": 0, "creation_date": 1565033405, "post_id": 57363561, "comment_id": 101216257, "body": "@silent I did that locally and got several lines of diagnostics after a few seconds, including <code>TcpTestSucceeded : True</code>. Seems to have worked properly."}, {"owner": {"reputation": 8769, "user_id": 1537195, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/xRBvI.jpg?s=128&g=1", "display_name": "silent", "link": "https://stackoverflow.com/users/1537195/silent"}, "edited": false, "score": 0, "creation_date": 1565033539, "post_id": 57363561, "comment_id": 101216321, "body": "ok, at least this is clear now. This one seems to be your issue. And it is... in the github repo of your go package that you are using. I&#39;d try it there: <a href=\"https://github.com/denisenkom/go-mssqldb/issues/452\" rel=\"nofollow noreferrer\">github.com/denisenkom/go-mssqldb/issues/452</a>"}, {"owner": {"reputation": 18299, "user_id": 2648811, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ee5af60b10a2d5fd8c864437a2062f0a?s=128&d=identicon&r=PG", "display_name": "Green Cloak Guy", "link": "https://stackoverflow.com/users/2648811/green-cloak-guy"}, "reply_to_user": {"reputation": 8769, "user_id": 1537195, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/xRBvI.jpg?s=128&g=1", "display_name": "silent", "link": "https://stackoverflow.com/users/1537195/silent"}, "edited": false, "score": 0, "creation_date": 1565035529, "post_id": 57363561, "comment_id": 101217099, "body": "@silent unfortunately, there doesn&#39;t seem to be a workaround specified in that GitHub issue (I did see it before I asked my question here), or if there is I don&#39;t understand it. Am I mistaken?"}, {"owner": {"reputation": 8769, "user_id": 1537195, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/xRBvI.jpg?s=128&g=1", "display_name": "silent", "link": "https://stackoverflow.com/users/1537195/silent"}, "edited": false, "score": 0, "creation_date": 1565036237, "post_id": 57363561, "comment_id": 101217360, "body": "no, but it seems related to that package. So I think you&#39;d have better luck there than here on SO."}, {"owner": {"reputation": 860, "user_id": 5823275, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/558041991019527/picture?type=large", "display_name": "Chris Tophski", "link": "https://stackoverflow.com/users/5823275/chris-tophski"}, "edited": false, "score": 1, "creation_date": 1565091775, "post_id": 57363561, "comment_id": 101234923, "body": "I&#39;m having the same problem now with Grafana and I cannot connect to the SQL Server via SQL Server Management Studio any more. My server is for test purposes and therefore not encrypted. This happened after installing updates on my Ubuntu machine. So this seems to be a problem on the SQL Server side, but I couldn&#39;t solve it with <code>mssql-conf</code>, so far."}], "answers": [{"comments": [{"owner": {"reputation": 12181, "user_id": 10549281, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/751uv.jpg?s=128&g=1", "display_name": "Leon Yue", "link": "https://stackoverflow.com/users/10549281/leon-yue"}, "edited": false, "score": 1, "creation_date": 1565225722, "post_id": 57381487, "comment_id": 101289271, "body": "Please accept yourself as the answer, this can be beneficial to other community members."}, {"owner": {"reputation": 18299, "user_id": 2648811, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ee5af60b10a2d5fd8c864437a2062f0a?s=128&d=identicon&r=PG", "display_name": "Green Cloak Guy", "link": "https://stackoverflow.com/users/2648811/green-cloak-guy"}, "reply_to_user": {"reputation": 12181, "user_id": 10549281, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/751uv.jpg?s=128&g=1", "display_name": "Leon Yue", "link": "https://stackoverflow.com/users/10549281/leon-yue"}, "edited": false, "score": 0, "creation_date": 1565275681, "post_id": 57381487, "comment_id": 101310579, "body": "@LeonYue Sorry, didn&#39;t occur to me. Done now, thanks."}, {"owner": {"reputation": 1093, "user_id": 9535070, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IUAW6HSUcHQ/AAAAAAAAAAI/AAAAAAAAAK4/DOn7Zj68c94/photo.jpg?sz=128", "display_name": "ofundefined", "link": "https://stackoverflow.com/users/9535070/ofundefined"}, "edited": false, "score": 0, "creation_date": 1586386707, "post_id": 57381487, "comment_id": 108113596, "body": "This answer may simplify everything you needed to do instead of downgrading your sql-server: <a href=\"https://stackoverflow.com/a/61111267/9535070\">stackoverflow.com/a/61111267/9535070</a>"}], "tags": [], "owner": {"reputation": 18299, "user_id": 2648811, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ee5af60b10a2d5fd8c864437a2062f0a?s=128&d=identicon&r=PG", "display_name": "Green Cloak Guy", "link": "https://stackoverflow.com/users/2648811/green-cloak-guy"}, "is_accepted": true, "score": 0, "last_activity_date": 1565113629, "creation_date": 1565113629, "answer_id": 57381487, "question_id": 57363561, "link": "https://stackoverflow.com/questions/57363561/golang-connection-to-sql-server-error-tls-handshake-failed-cannot-read-hands/57381487#57381487", "title": "Golang connection to SQL Server error - &quot;TLS Handshake failed: Cannot read handshake packet: EOF&quot;", "body": "<p>I ended up fixing this without identifying the root cause. Once I tried connecting to the VM over SSH and accessing the database locally, I experienced the following errors:</p>\n\n<pre><code>Sqlcmd: Error: Microsoft ODBC Driver 17 for SQL Server : TCP Provider: Error code 0x2746.\nSqlcmd: Error: Microsoft ODBC Driver 17 for SQL Server : Client unable to establish connection.\n</code></pre>\n\n<p>Following up on those led me to <a href=\"https://github.com/Microsoft/msphpsql/issues/252\" rel=\"nofollow noreferrer\">this GitHub issue</a>, which provided a fix to my problem. It looks to have been a versioning issue - in my install script, I replaced </p>\n\n<pre><code>sudo apt-get -y install mssql-server\n</code></pre>\n\n<p>with</p>\n\n<pre><code>sudo apt-get -y install mssql-server=14.0.3192.2-2\n</code></pre>\n\n<p>and the problem went away.</p>\n"}], "owner": {"reputation": 18299, "user_id": 2648811, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ee5af60b10a2d5fd8c864437a2062f0a?s=128&d=identicon&r=PG", "display_name": "Green Cloak Guy", "link": "https://stackoverflow.com/users/2648811/green-cloak-guy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 517, "favorite_count": 0, "accepted_answer_id": 57381487, "answer_count": 1, "score": -1, "last_activity_date": 1565113629, "creation_date": 1565026691, "last_edit_date": 1565112564, "question_id": 57363561, "link": "https://stackoverflow.com/questions/57363561/golang-connection-to-sql-server-error-tls-handshake-failed-cannot-read-hands", "title": "Golang connection to SQL Server error - &quot;TLS Handshake failed: Cannot read handshake packet: EOF&quot;", "body": "<p>I wrote a system that automates the process of deploying a VM on Microsoft Azure, installs Sql Server on it, and then executes a <code>.sql</code> script against the newly-installed server in order to initialize the environment. On Friday, this was all working as intended. Today, I'm getting this error.</p>\n\n<p>My code has the following relevant imports:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import(\n    \"database/sql\"\n    _ \"github.com/denisenkom/go-mssqldb\"\n)\n</code></pre>\n\n<p>and uses the following code to actually connect to the database once it's installed (error handling removed for brevity):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// variables\nconnectionString := \"sqlserver://MasterUser:MasterPassword@xx.xx.xx.xxx:1433\"\ndbName := \"mssql\"\ndbFile := \"mssql.sql\"\n// open database / get metadata sorted\ndb, err := sql.Open(dbname, connectionString)\ndefer db.Close()\n//Check to see if the connection is successful. \nerr = db.Ping()                                         // &lt;--------\n// file input\nfileBytes, err := ioutil.ReadFile(\"../sql/\" + dbsql)\nfileReader := bytes.NewReader(fileBytes)\n// parse line-by-line\nscanner := bufio.NewScanner(fileReader)\nlineNo := 0\nfor scanner.Scan() {\n    toExec := scanner.Text()\n    lineNo += 1\n    _, err = db.Exec(toExec)                           // &lt;--------\n}\n</code></pre>\n\n<p>The error occurs on both <code>db.Ping()</code> and on every <code>db.Exec()</code>. In those cases, the message associated with <code>err</code> is</p>\n\n<pre><code>TLS Handshake failed: Cannot read handshake packet: EOF\n</code></pre>\n\n<hr>\n\n<p>As for the server itself, I install that over SSH with the following script:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code># install mssql server\nsudo wget -qO- https://packages.microsoft.com/keys/microsoft.asc | sudo apt-key add -\nsudo add-apt-repository \"$(wget -qO- https://packages.microsoft.com/config/ubuntu/16.04/mssql-server-2017.list)\"\ncurl https://packages.microsoft.com/config/ubuntu/16.04/prod.list | sudo tee /etc/apt/sources.list.d/msprod.list\nsudo apt-get -y update\nsudo apt-get -y install mssql-server\n# configure MSSQL\nsudo /opt/mssql/bin/mssql-conf setup\n# install local tools\nsudo ACCEPT_EULA=y apt-get -y install mssql-tools\n# do basic initialization in advance of .sql script\n/opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P ${MasterPassword} -Q \"CREATE LOGIN ${MasterUser} WITH PASSWORD = '${MasterPassword}';\"\n/opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P ${MasterPassword} -Q \"CREATE USER ${MasterUser} FOR LOGIN ${MasterUser};\"\n/opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P ${MasterPassword} -Q \"ALTER SERVER ROLE sysadmin ADD MEMBER ${MasterUser};\"\n</code></pre>\n\n<p>This seems to work fine otherwise - I have no trouble connecting to the instance manually via SSH, and that script exits with no errors. I'm not sure how relevant it is.</p>\n\n<hr>\n\n<p>I tried SSHing into the server myself and opening a sql server console locally, which resulted in the following error messages:</p>\n\n<pre><code>$ /opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P *********\nSqlcmd: Error: Microsoft ODBC Driver 17 for SQL Server : TCP Provider: Error code 0x2746.\nSqlcmd: Error: Microsoft ODBC Driver 17 for SQL Server : Client unable to establish connection.\n</code></pre>\n\n<p>This is probably relevant, but I don't know how.</p>\n\n<hr>\n\n<p>What's causing this, and how do I fix it? Is the error in my code, on the VM I've created that's acting as the server, or in between? How would I best fix the problem?</p>\n"}, {"tags": ["go", "bigtable", "google-cloud-bigtable"], "answers": [{"comments": [{"owner": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "edited": false, "score": 0, "creation_date": 1565028934, "post_id": 57363359, "comment_id": 101214340, "body": "Despite using the LatestNFilter I do see multiple copies of the same rowkey. How can I ensure I fetch only the latest copy?"}, {"owner": {"reputation": 121, "user_id": 11853614, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hRRQb.jpg?s=128&g=1", "display_name": "Dave Johnson", "link": "https://stackoverflow.com/users/11853614/dave-johnson"}, "reply_to_user": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "edited": false, "score": 0, "creation_date": 1565036981, "post_id": 57363359, "comment_id": 101217634, "body": "BigTable will return them all. The filter doesn&#39;t filter on BigTable&#39;s side, it filters on your side in the code. This is the normal behavior of CBT.  If that is not what you&#39;re seeing, then I think you need to post your code so we can get more context.    There are ways to limit the selection using qualifiers and other row keys.  However, this gets really complex really fast."}, {"owner": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "edited": false, "score": 0, "creation_date": 1565037228, "post_id": 57363359, "comment_id": 101217724, "body": "Using the above-mentioned filter <code>bigtable.RowFilter(bigtable.LatestNFilter(1))</code> in my code to retrieve the last version of the record I still get the same result as the image posted in the question. I need a way of only fetching the last version for every row key"}, {"owner": {"reputation": 121, "user_id": 11853614, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hRRQb.jpg?s=128&g=1", "display_name": "Dave Johnson", "link": "https://stackoverflow.com/users/11853614/dave-johnson"}, "reply_to_user": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "edited": false, "score": 0, "creation_date": 1565037896, "post_id": 57363359, "comment_id": 101217964, "body": "Again you&#39;re not showing your code on how you&#39;re using it. for example I would use that filter like this:  <code>go  \trow, err := bt.Table.ReadRow(ctx, rowName, bigtable.RowFilter(bigtable.LatestNFilter(1))) \tif err != nil { \t\t&#47;&#47; handle error... \t}  </code>"}, {"owner": {"reputation": 121, "user_id": 11853614, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hRRQb.jpg?s=128&g=1", "display_name": "Dave Johnson", "link": "https://stackoverflow.com/users/11853614/dave-johnson"}, "reply_to_user": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "edited": false, "score": 0, "creation_date": 1565038119, "post_id": 57363359, "comment_id": 101218050, "body": "^ that didn&#39;t show up well, so I updated my post with how I would use it."}, {"owner": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "edited": false, "score": 0, "creation_date": 1565038916, "post_id": 57363359, "comment_id": 101218334, "body": "Updated the post"}, {"owner": {"reputation": 121, "user_id": 11853614, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hRRQb.jpg?s=128&g=1", "display_name": "Dave Johnson", "link": "https://stackoverflow.com/users/11853614/dave-johnson"}, "reply_to_user": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "edited": false, "score": 0, "creation_date": 1565040383, "post_id": 57363359, "comment_id": 101218761, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/197522/discussion-between-dave-johnson-and-vasanti\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 121, "user_id": 11853614, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hRRQb.jpg?s=128&g=1", "display_name": "Dave Johnson", "link": "https://stackoverflow.com/users/11853614/dave-johnson"}, "is_accepted": false, "score": 2, "last_activity_date": 1565040342, "last_edit_date": 1565040342, "creation_date": 1565025867, "answer_id": 57363359, "question_id": 57363210, "link": "https://stackoverflow.com/questions/57363210/cloud-bigtable-stores-multiple-copies-of-same-rowkey/57363359#57363359", "title": "Cloud BigTable stores multiple copies of same rowkey", "body": "<p>As for as I know, that is normal. CBT stores the history of that row key and you'll want to pass a filter to get the latest one. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>bigtable.RowFilter(bigtable.LatestNFilter(1))\n</code></pre>\n\n<p><strong>Update:</strong> this is how I use that filter </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    rowName := \"myrow#key#id\" \n    row, err := bt.Table.ReadRow(ctx, rowName, bigtable.RowFilter(bigtable.LatestNFilter(1)))\n    if err != nil {\n        // handle error...\n    }\n    if row == nil {\n        // check for 0 result...\n    }\n\n</code></pre>\n\n<p><strong>Update 2:</strong> </p>\n\n<p>Based on your code, using <code>ReadRows</code> instead, it looks like you're trying to get multiple row keys. so your code should pull the latest row for each of the row keys. </p>\n\n<p>If you just want the one key that you show in your image then I would just use the <code>ReadRow</code> method instead. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>err = tbl.ReadRow(ctx,\"1564:u2Sng4xbtG\", bigtable.RowFilter(bigtable.LatestNFilter(1)))\n</code></pre>\n\n<p>Else... I guess there could be an issue with how it was stored in CBT, but that is a little out of my skill set for CBT. hopefully, a CBT expert can chime in for you.</p>\n"}, {"tags": [], "owner": {"reputation": 361, "user_id": 1684073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9122b1f7e4d159e89ef422c9497a79f?s=128&d=identicon&r=PG", "display_name": "Mario", "link": "https://stackoverflow.com/users/1684073/mario"}, "is_accepted": false, "score": 0, "last_activity_date": 1565056153, "creation_date": 1565056153, "answer_id": 57367909, "question_id": 57363210, "link": "https://stackoverflow.com/questions/57363210/cloud-bigtable-stores-multiple-copies-of-same-rowkey/57367909#57367909", "title": "Cloud BigTable stores multiple copies of same rowkey", "body": "<p>I think that the error is coming from the way that ApplyBulk transform the \"insert tasks\".</p>\n\n<p>You can find more reference here <a href=\"https://godoc.org/cloud.google.com/go/bigtable\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go/bigtable</a></p>\n"}, {"tags": [], "owner": {"reputation": 506, "user_id": 8334402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b505e1e69f394972d145985126c9861f?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Bernstein", "link": "https://stackoverflow.com/users/8334402/igor-bernstein"}, "is_accepted": false, "score": 1, "last_activity_date": 1565707018, "creation_date": 1565707018, "answer_id": 57480044, "question_id": 57363210, "link": "https://stackoverflow.com/questions/57363210/cloud-bigtable-stores-multiple-copies-of-same-rowkey/57480044#57480044", "title": "Cloud BigTable stores multiple copies of same rowkey", "body": "<p>There seems to be a bit of confusion here:</p>\n\n<ol>\n<li><p>Under no circumstances should ReadRows ever return <strong>duplicate row keys</strong>. Assuming that the rows in your spreadsheet correspond to the rows that the client library returned in func callback, then this is a bug in the client library. Please open an issue in <a href=\"https://github.com/googleapis/google-cloud-go/issues\" rel=\"nofollow noreferrer\">https://github.com/googleapis/google-cloud-go/issues</a> and provide a way to reproduce the issue</p></li>\n<li><p>Bigtable does allow <strong>multiple versions of cell values</strong>. It provides filters like  LatestNFilter() to hide old cell values and gc rules to remove them periodically. However, this is scoped to cell values and is unrelated to row keys. In other words, Bigtable provides cell versions not row versions.</p></li>\n<li><p>ApplyBulk is not atomic and furthermore it doesn't provide any guarantees about  ordering of the mutations. </p></li>\n</ol>\n"}], "owner": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 786, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1565707018, "creation_date": 1565025118, "last_edit_date": 1565280494, "question_id": 57363210, "link": "https://stackoverflow.com/questions/57363210/cloud-bigtable-stores-multiple-copies-of-same-rowkey", "title": "Cloud BigTable stores multiple copies of same rowkey", "body": "<p>I am writing to BigTable using the Go library. I use the <code>ApplyBulk</code> method to make multiple inserts atomically. However, when I query BigTable using the <code>ReadRows</code> function I see multiple copies/versions with the same row key.</p>\n\n<p>For instance: In the below-mentioned example, I see multiple copies of the same RowKey with partial data and the last occurrence has all the columns with all the fields. </p>\n\n<p><a href=\"https://i.stack.imgur.com/JIJsZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/JIJsZ.png\" alt=\"enter image description here\"></a></p>\n\n<p>How can I ensure that only a single copy of data is stored for each row key? And how can I fetch only the latest version of rows inserted? </p>\n\n<p>Code:</p>\n\n<pre><code>row_range := bigtable.PrefixRange(\"\")\n\nerr = tbl.ReadRows(ctx,row_range, func(row bigtable.Row) bool {\n// logic goes here\n}, bigtable.RowFilter(bigtable.LatestNFilter(1)))\n</code></pre>\n"}, {"tags": ["go", "aws-lambda", "aws-api-gateway"], "comments": [{"owner": {"reputation": 835, "user_id": 4920854, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nKogO.png?s=128&g=1", "display_name": "Jonny Rimek", "link": "https://stackoverflow.com/users/4920854/jonny-rimek"}, "edited": false, "score": 0, "creation_date": 1565020677, "post_id": 57361139, "comment_id": 101210897, "body": "I guess you have mapped that lambda to an GET http call in your APIGateway and they never have a body. Try printing request.Path for example."}, {"owner": {"reputation": 43, "user_id": 9357346, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Ben Freed", "link": "https://stackoverflow.com/users/9357346/ben-freed"}, "reply_to_user": {"reputation": 835, "user_id": 4920854, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nKogO.png?s=128&g=1", "display_name": "Jonny Rimek", "link": "https://stackoverflow.com/users/4920854/jonny-rimek"}, "edited": false, "score": 0, "creation_date": 1565022748, "post_id": 57361139, "comment_id": 101211795, "body": "@JonnyRimek, It&#39;s a POST call in my API Gateway. In Cloudwatch, the logs say: Endpoint request body after transformations: {&quot;my&quot;: &quot;body data&quot;}. Then they say: Sending request to <a href=\"https://lambda.us-east-1.amazonaws.com/my-lamba-path\" rel=\"nofollow noreferrer\">lambda.us-east-1.amazonaws.com/my-lamba-path</a>, so I&#39;m pretty sure the request body is being sent to the Lambda?"}, {"owner": {"reputation": 43, "user_id": 9357346, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Ben Freed", "link": "https://stackoverflow.com/users/9357346/ben-freed"}, "reply_to_user": {"reputation": 835, "user_id": 4920854, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nKogO.png?s=128&g=1", "display_name": "Jonny Rimek", "link": "https://stackoverflow.com/users/4920854/jonny-rimek"}, "edited": false, "score": 0, "creation_date": 1565023330, "post_id": 57361139, "comment_id": 101212061, "body": "Kind of frustrating to see my question downvoted with no comment. If there an issue with the question, please let me know in the comments."}, {"owner": {"reputation": 835, "user_id": 4920854, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nKogO.png?s=128&g=1", "display_name": "Jonny Rimek", "link": "https://stackoverflow.com/users/4920854/jonny-rimek"}, "edited": false, "score": 0, "creation_date": 1565024870, "post_id": 57361139, "comment_id": 101212770, "body": "I don&#39;t see an obvious error. <a href=\"https://gitlab.com/jrimek/tnp/api/blob/master/handler/create-category/create-category.go\" rel=\"nofollow noreferrer\">gitlab.com/jrimek/tnp/api/blob/master/handler/create-categor&zwnj;&#8203;y/&hellip;</a> this is a lambda that receives a POST request and writes an item to DynamoDB, maybe you see something that can help you"}], "answers": [{"tags": [], "owner": {"reputation": 43, "user_id": 9357346, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Ben Freed", "link": "https://stackoverflow.com/users/9357346/ben-freed"}, "is_accepted": true, "score": 0, "last_activity_date": 1565095719, "creation_date": 1565095719, "answer_id": 57376451, "question_id": 57361139, "link": "https://stackoverflow.com/questions/57361139/golang-aws-lambda-function-missing-body-from-api-gateway-request/57376451#57376451", "title": "GoLang AWS Lambda Function Missing Body from API Gateway Request", "body": "<p>The code in the original question is correct. The second argument to the handleRequest is of the type APIGatewayProxyRequest. In API Gateway, I was sending a normal request, not a proxy request. I redeployed my API Gateway route as a proxy request and got the request body I was expecting. I'm still not really sure whether my original request was failing to send the body, or if the structure of a normal request passed into the handleRequest function is different from that of a proxy request and so the APIGatewayProxyRequest type was unable to parse its body.</p>\n"}], "owner": {"reputation": 43, "user_id": 9357346, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Ben Freed", "link": "https://stackoverflow.com/users/9357346/ben-freed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 812, "favorite_count": 0, "accepted_answer_id": 57376451, "answer_count": 1, "score": 0, "last_activity_date": 1565095719, "creation_date": 1565016908, "question_id": 57361139, "link": "https://stackoverflow.com/questions/57361139/golang-aws-lambda-function-missing-body-from-api-gateway-request", "title": "GoLang AWS Lambda Function Missing Body from API Gateway Request", "body": "<p>I'm using an AWS Lambda function to handle a request from an AWS API Gateway call. I'm sending a payload on the request, and I can verify in CloudWatch that the payload is being passed from the gateway to the lambda function. However, the body of the request is null inside my Lambda function.</p>\n\n<p>I looked at this question: <a href=\"https://stackoverflow.com/questions/52192916/aws-lambda-go-function-not-getting-request-body-when-called-via-api-gw\">AWS Lambda Go function not getting request body when called via API GW</a></p>\n\n<p>I am trying to replicate the answer there by using this library: <a href=\"https://github.com/aws/aws-lambda-go/blob/master/events/apigw.go\" rel=\"nofollow noreferrer\">https://github.com/aws/aws-lambda-go/blob/master/events/apigw.go</a>, but I'm still not able to get the request body.</p>\n\n<p>Here is my Lambda code:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n\n    \"github.com/aws/aws-lambda-go/events\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n)\n\nfunc handleRequest(ctx context.Context, request events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) {\n\n    fmt.Println(\"Body\")\n    fmt.Println(request.Body)\n\n    fmt.Printf(\"Processing request data for request %s.\\n\", request.RequestContext.RequestID)\n\n    fmt.Printf(\"Processing request data for request %s.\\n\", request.RequestContext.RequestID)\n    fmt.Printf(\"Body size = %d.\\n\", len(request.Body))\n\n    fmt.Println(\"Headers:\")\n    for key, value := range request.Headers {\n        fmt.Printf(\"    %s: %s\\n\", key, value)\n    }\n\n    return events.APIGatewayProxyResponse{Body: request.Body, StatusCode: 200}, nil\n}\n\nfunc main() {\n    lambda.Start(handleRequest)\n}\n</code></pre>\n\n<p>I'm expecting to see some data after \"Body\" in Cloudwatch, but there is nothing.</p>\n"}, {"tags": ["go", "pq"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565011917, "post_id": 57359587, "comment_id": 101206242, "body": "Is this the only code in the application that is accessing postgres?"}, {"owner": {"reputation": 133, "user_id": 10451979, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JhajMscZ_IA/AAAAAAAAAAI/AAAAAAAAATQ/zj7Y8MMVekQ/photo.jpg?sz=128", "display_name": "Davenporten", "link": "https://stackoverflow.com/users/10451979/davenporten"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565012282, "post_id": 57359587, "comment_id": 101206485, "body": "Also, it takes awhile for the error to appear. Just if that sheds any light on anything."}, {"owner": {"reputation": 133, "user_id": 10451979, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JhajMscZ_IA/AAAAAAAAAAI/AAAAAAAAATQ/zj7Y8MMVekQ/photo.jpg?sz=128", "display_name": "Davenporten", "link": "https://stackoverflow.com/users/10451979/davenporten"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565012742, "post_id": 57359587, "comment_id": 101206762, "body": "Apologies, it does get accessed. I&#39;m adding the code."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1565014658, "post_id": 57359587, "comment_id": 101207872, "body": "Probably unrelated, but the <a href=\"https://golang.org/pkg/database/sql#Open\" rel=\"nofollow noreferrer\"><code>sql.Open</code> documentation</a> specificly says you shouldn&#39;t call it repeatedly like you do: &quot;The returned DB is safe for concurrent use by multiple goroutines and maintains its own pool of idle connections. Thus, the Open function should be called just once. It is rarely necessary to close a DB.&quot;"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565014697, "post_id": 57359587, "comment_id": 101207898, "body": "Is there a specific reason why you&#39;re creating a new db connection pool every time you need to make a query?"}, {"owner": {"reputation": 133, "user_id": 10451979, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JhajMscZ_IA/AAAAAAAAAAI/AAAAAAAAATQ/zj7Y8MMVekQ/photo.jpg?sz=128", "display_name": "Davenporten", "link": "https://stackoverflow.com/users/10451979/davenporten"}, "edited": false, "score": 0, "creation_date": 1565015427, "post_id": 57359587, "comment_id": 101208312, "body": "No, there isn&#39;t, I just thought it made sense to open it and close it. I will make some changes and give it a try. Thanks all for your help!"}, {"owner": {"reputation": 133, "user_id": 10451979, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JhajMscZ_IA/AAAAAAAAAAI/AAAAAAAAATQ/zj7Y8MMVekQ/photo.jpg?sz=128", "display_name": "Davenporten", "link": "https://stackoverflow.com/users/10451979/davenporten"}, "edited": false, "score": 0, "creation_date": 1565015894, "post_id": 57359587, "comment_id": 101208561, "body": "That did it! Thanks so much for all your help!"}], "owner": {"reputation": 133, "user_id": 10451979, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JhajMscZ_IA/AAAAAAAAAAI/AAAAAAAAATQ/zj7Y8MMVekQ/photo.jpg?sz=128", "display_name": "Davenporten", "link": "https://stackoverflow.com/users/10451979/davenporten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565012832, "creation_date": 1565011564, "last_edit_date": 1565012832, "question_id": 57359587, "link": "https://stackoverflow.com/questions/57359587/pq-sorry-too-many-clients-using-scan-closing-rows-but-getting-a-connec", "title": "&quot;pq: sorry, too many clients&quot; - using Scan(), closing rows, but getting a connection leak somewhere", "body": "<p>My code is set up such that every time I want to make a query I open the DB, run QueryRow(), Scan the results into variables, and then close the DB and rows using defer. However, I'm getting a connection leak though I believe I've closing all of them out.</p>\n\n<p>I have tried taking the close statements out of defer, closing them just when I am done using it. I followed <a href=\"https://stackoverflow.com/questions/47706147/how-to-reuse-a-single-postgres-db-connection-for-row-inserts-in-go\">How to reuse a single Postgres DB connection for row inserts in Go?</a> but though I believe I'm following the answer, still no luck.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (a AccessPostgres) OpenDB() (*sql.DB, error) {\n    dbinfo := fmt.Sprintf(\"user=%s password=%s dbname=%s sslmode=disable\",\n                            user, password, a.DBName)\n\n    var err error\n\n    db, err := sql.Open(\"postgres\", dbinfo)\n    if err != nil {\n        return nil, err\n    }\n\n    return db, nil\n}\n\nfunc (a AccessPostgres) Run(s string) error {\n    db, err := a.OpenDB()\n    if err != nil {\n        return err\n    }\n    defer db.Close()\n\n    _, err = db.Exec(s)\n    if err != nil {\n        return err\n    }\n\n    return nil\n}\n\ntype Row struct {\n    Collection_time string\n    Dbid            string\n    Hostname        string\n    Dbname          string\n    Name            string\n    Value           string\n}\n\ntype QueryResult struct {\n    Rows  []Row\n}\n\nfunc (a AccessPostgres) Query(q string) ([]byte, error) {\n\n    db, err := a.OpenDB()\n    if err != nil {\n        return nil, err\n    }\n    defer db.Close()\n\n    rows, err := db.Query(q)\n    if err != nil {\n        return nil, err\n    }\n    defer rows.Close()\n\n    var qr QueryResult\n    for rows.Next() {\n        var r Row\n        err := rows.Scan(&amp;r.Collection_time, &amp;r.Dbid, &amp;r.Hostname, &amp;r.Dbname, &amp;r.Name, &amp;r.Value)\n        if err != nil {\n            return nil, err\n        }\n        qr.Rows = append(qr.Rows, r)\n    }\n\n\n    result, err := json.Marshal(qr)\n    if err != nil {\n        return nil, err\n    }\n\n    return result, nil\n}\n\n</code></pre>\n\n<p>For the most part things work well. But this code is run at an interval and after awhile the 'pq: sorry, too many clients' error shows up. That's all that happens.</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1565011489, "post_id": 57359428, "comment_id": 101205976, "body": "This code is filled with debugging statements, and missing enough context to actually run it. Can you try updating the quoted code to offer a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">Minimal, Reproducible Example</a>?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565014278, "post_id": 57359428, "comment_id": 101207667, "body": "What do you mean by <i>&quot;the append didn&#39;t work as expected&quot;</i>? What result did you expect and what actual result did you get?"}, {"owner": {"reputation": 25, "user_id": 8995983, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0VpdQ.jpg?s=128&g=1", "display_name": "GeorgiF", "link": "https://stackoverflow.com/users/8995983/georgif"}, "edited": false, "score": 0, "creation_date": 1565104141, "post_id": 57359428, "comment_id": 101242643, "body": "Well, just before I am creating the newPathN variable, I logged the queue&#39;s content and before I append I saw that the last few elements are not what they supposed to be. What actually fixed my issue was replacing &quot;newPathN.path = currentPath.path&quot; with iteration over the second one and append element after element. I am new in go lang, but I guess the problem was in my re-slicing of the queue..."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565028154, "post_id": 57362187, "comment_id": 101214040, "body": "The two <code>make</code>s I see are both <code>make(T, 0)</code>, it would be better if they had a capacity but it&#39;s <i>not</i> &quot;definitely a bug&quot;."}, {"owner": {"reputation": 24749, "user_id": 365738, "user_type": "registered", "accept_rate": 98, "profile_image": "https://lh4.googleusercontent.com/-BOj_FEcSw24/AAAAAAAAAAI/AAAAAAAAAD8/sDXPt5Ijxc4/photo.jpg?sz=128", "display_name": "sethvargo", "link": "https://stackoverflow.com/users/365738/sethvargo"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565031919, "post_id": 57362187, "comment_id": 101215599, "body": "If that 0 is actually 0, yes. However, given the number of edits, I don&#39;t think it&#39;s fair to assume the OP has the code exactly as it&#39;s currently written."}], "tags": [], "owner": {"reputation": 24749, "user_id": 365738, "user_type": "registered", "accept_rate": 98, "profile_image": "https://lh4.googleusercontent.com/-BOj_FEcSw24/AAAAAAAAAAI/AAAAAAAAAD8/sDXPt5Ijxc4/photo.jpg?sz=128", "display_name": "sethvargo", "link": "https://stackoverflow.com/users/365738/sethvargo"}, "is_accepted": false, "score": -1, "last_activity_date": 1565032253, "last_edit_date": 1565032253, "creation_date": 1565020727, "answer_id": 57362187, "question_id": 57359428, "link": "https://stackoverflow.com/questions/57359428/strange-slice-behaviour/57362187#57362187", "title": "Strange slice behaviour", "body": "<p>You may not be using <code>make</code> correctly. <code>make</code> for a slice takes two arguments, length and (optional) capacity:</p>\n\n<pre><code>make([]T, len, cap)\n</code></pre>\n\n<p>Len is the starting number of elements it contains, capacity is the number of elements it <em>could</em> contain without expanding. More on <a href=\"https://tour.golang.org/moretypes/11\" rel=\"nofollow noreferrer\">A Tour of Go</a>.</p>\n\n<p>Visually:</p>\n\n<pre><code>make([]string, 5) #=&gt; [\"\", \"\", \"\", \"\", \"\"]\nmake([]string, 0, 5) #=&gt; [] (but the underlying array can hold 5 elements)\n</code></pre>\n\n<p><code>append</code> adds to the end of the array, so following the same example:</p>\n\n<pre><code>arr1 := make([]string, 5) #=&gt; [\"\", \"\", \"\", \"\", \"\"]\narr1 = append(arr1, \"foo\") #=&gt; [\"\", \"\", \"\", \"\", \"\", \"foo\"] \n\narr2 := make([]string, 0, 5) #=&gt; []\narr2 = append(arr2, \"foo\") #=&gt; [\"foo\"] (underlying array can hold 4 more elements before expanding)\n</code></pre>\n\n<p>You are creating slices of a length and then appending to the end, meaning the first N elements of your slice are the zero value. Change your <code>make([]T, N)</code> to <code>make([]T, 0, N)</code>.</p>\n\n<p>Here's a link to the Go Playground showing the difference: <a href=\"https://play.golang.org/p/ezoUGPHqSRj\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ezoUGPHqSRj</a></p>\n"}], "owner": {"reputation": 25, "user_id": 8995983, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0VpdQ.jpg?s=128&g=1", "display_name": "GeorgiF", "link": "https://stackoverflow.com/users/8995983/georgif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565032253, "creation_date": 1565011013, "last_edit_date": 1565012118, "question_id": 57359428, "link": "https://stackoverflow.com/questions/57359428/strange-slice-behaviour", "title": "Strange slice behaviour", "body": "<p>I am trying to implement BFS algorithm for finding all paths (from src and dest) in a graph. I am using a slice to simulate a queue, but the slice gets corrupted (the append didn't work as expected) when I append to it more than one elements in the for cycle. I have no idea why. I am new in GoLand</p>\n\n<pre><code>// GetPathsFromCache retrieve information from loaded jsons in the cache\nfunc (cache *ModelsDataCache) GetPathsFromCache(modelUrn, selectedElement, targetType, authToken string, modelJSONs *ModelJSONs) []systemdetection.GraphPath {\n\n    result := make([]systemdetection.GraphPath, 0)\n\n    //create the queue which stores the paths\n    q := make([]Path, 0)\n\n    //Path to store the current path\n    var currentPath Path\n    currentPath.path = append(currentPath.path, selectedElement)\n    q = append(q, currentPath)\n\n\n    for len(q) &gt; 0 {\n\n\n        currentPath = q[0] //get top\n        q = q[1:]\n\n\n        lastInThePath := currentPath.path[len(currentPath.path)-1]\n        connectedToTheCurrent := cache.GetConnectionsFromCache(modelUrn, lastInThePath, authToken, modelJSONs)\n\n        lastInPathType := modelJSONs.Elements[lastInThePath].Type\n\n        if lastInPathType == targetType {\n            //cache.savePath(currentPath, &amp;result)\n\n            var newPath systemdetection.GraphPath\n            newPath.Target = lastInThePath\n            newPath.Path = currentPath.path[:]\n            newPath.Distance = 666\n            result = append(result, newPath)\n        }\n\n\n        for _, connected := range connectedToTheCurrent {\n            if cache.isNotVisited(connected, currentPath.path) {\n\n\n                var newPathN Path\n\n                newPathN.path = currentPath.path\n                newPathN.path = append(newPathN.path, connected)\n\n                q = append(q, newPathN)\n            }\n        }\n\n    }\n\n    return result\n\n}\n</code></pre>\n"}, {"tags": ["go", "go-gorm", "go-gin"], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 7319894, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5eOjS.jpg?s=128&g=1", "display_name": "Intra", "link": "https://stackoverflow.com/users/7319894/intra"}, "edited": false, "score": 0, "creation_date": 1565159533, "post_id": 57363586, "comment_id": 101259323, "body": "Thanks for that.but the uemail shows unused variable."}, {"owner": {"reputation": 87, "user_id": 7319894, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5eOjS.jpg?s=128&g=1", "display_name": "Intra", "link": "https://stackoverflow.com/users/7319894/intra"}, "edited": false, "score": 0, "creation_date": 1565159645, "post_id": 57363586, "comment_id": 101259366, "body": "I changed rexed to name, as I am doing pattern search in name, but the uemail shows unused uemail variable."}, {"owner": {"reputation": 121, "user_id": 11853614, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hRRQb.jpg?s=128&g=1", "display_name": "Dave Johnson", "link": "https://stackoverflow.com/users/11853614/dave-johnson"}, "reply_to_user": {"reputation": 87, "user_id": 7319894, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5eOjS.jpg?s=128&g=1", "display_name": "Intra", "link": "https://stackoverflow.com/users/7319894/intra"}, "edited": false, "score": 0, "creation_date": 1565194096, "post_id": 57363586, "comment_id": 101278373, "body": "Oh yeah I didn&#39;t notice, but that is not going to work like that, you need to do something like <code>Where(&quot;name LIKE ?&quot;, &quot;%&quot; + uemail + &quot;%&quot;)</code>"}], "tags": [], "owner": {"reputation": 121, "user_id": 11853614, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hRRQb.jpg?s=128&g=1", "display_name": "Dave Johnson", "link": "https://stackoverflow.com/users/11853614/dave-johnson"}, "is_accepted": false, "score": 0, "last_activity_date": 1565026781, "creation_date": 1565026781, "answer_id": 57363586, "question_id": 57359416, "link": "https://stackoverflow.com/questions/57359416/pattern-searching-in-gorm-rest-api/57363586#57363586", "title": "Pattern Searching in gorm rest API", "body": "<p>For the first part of your question, to set the order, use the <code>.Order()</code> method on gorm </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>db.Where(\"name LIKE ?\", \"%uemail%\").Order(\"name\").Find(&amp;rnex)\n</code></pre>\n\n<p>For the second part where you're getting the error, I don't have enough context from the code you posted, but my first thought is that you're trying to parse in a value that is the wrong type in your <code>resource</code> struct.</p>\n"}], "owner": {"reputation": 87, "user_id": 7319894, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5eOjS.jpg?s=128&g=1", "display_name": "Intra", "link": "https://stackoverflow.com/users/7319894/intra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1597434339, "creation_date": 1565010967, "last_edit_date": 1597434339, "question_id": 57359416, "link": "https://stackoverflow.com/questions/57359416/pattern-searching-in-gorm-rest-api", "title": "Pattern Searching in gorm rest API", "body": "<p>I want to fetch the name list on the basis of searching and sort lexicographically order.</p>\n<p>I have used &quot;like&quot; keyword to get a similar search in the database, and I don't know how to get the required order.</p>\n<pre><code>func SearchByName(db *gorm.DB) func(c *gin.Context) {\n    return func(c *gin.Context) {\n        var uemail = c.Param(&quot;rexed&quot;)\n        var rnex []resource\n            //Param matches your regex //c.JSON(200,rnex)\n            if err := db.Where(&quot;name LIKE ?&quot;, &quot;%uemail%&quot;).Find(&amp;rnex).Error; err!=nil{\n                c.AbortWithStatus(404)\n                fmt.Println(err)\n            } else {\n                c.JSON(200, rnex)\n            }\n    }\n}\n</code></pre>\n<p>I am getting</p>\n<blockquote>\n<p>Mismatched *DB and string &amp; Report incompatible types in binary and unary operation</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 4, "creation_date": 1565009272, "post_id": 57358880, "comment_id": 101204799, "body": "&quot;Let&#39;s say I have array with integer and nil elements&quot; - nope, you don&#39;t. This array/slice is impossible in go (if type is <code>[]int</code>)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1565009346, "post_id": 57358880, "comment_id": 101204843, "body": "Neither an <code>int</code> nor a <code>string</code> can be <code>nil</code>. What is the exact input, and what output are you trying to achieve?"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1565009662, "post_id": 57358880, "comment_id": 101205009, "body": "I understand that Go is a strongly typed programming language. In my case, such a dynamic array comes in the body of the POST request. As I understand I need to create such array firstly and then manipulate him."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 8, "creation_date": 1565009817, "post_id": 57358880, "comment_id": 101205078, "body": "Then you need to show more code, because the <code>[]int</code> the quoted function accepts literally cannot contain any <code>nil</code> values."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1565010125, "post_id": 57358880, "comment_id": 101205225, "body": "The string value <code>null</code> is commonly used in json. Are you trying to encode something as json?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565011096, "post_id": 57358880, "comment_id": 101205728, "body": "If your slice needs to accept values of a non-nilable type and <code>nil</code>s as well you can use a slice of interfaces: <a href=\"https://play.golang.com/p/hEjTFIoJlXj\" rel=\"nofollow noreferrer\">play.golang.com/p/hEjTFIoJlXj</a> or change the type to a pointer type to make it nillable: <a href=\"https://play.golang.com/p/Hv8I4yU71ji\" rel=\"nofollow noreferrer\">play.golang.com/p/Hv8I4yU71ji</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565011867, "post_id": 57358880, "comment_id": 101206201, "body": "@NurzhanNogerbek where you have <code>???</code> you can use <code>strconv.Itoa(n.Value().(int))</code>"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565011910, "post_id": 57358880, "comment_id": 101206238, "body": "@mkopriva thank you for your answer! Can you post your first link code with some explanation if you want, not comment. I will mark it as correct."}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565012104, "post_id": 57358880, "comment_id": 101206372, "body": "@mkopriva thank you for your previous comment. My version is working <code>strconv.Itoa(n.Value().(int))</code>, but not elegant."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1565013032, "creation_date": 1565013032, "answer_id": 57360028, "question_id": 57358880, "link": "https://stackoverflow.com/questions/57358880/how-convert-array-with-integer-and-nill-to-string/57360028#57360028", "title": "How convert array with integer and nill to string?", "body": "<p>As pointed out in the comments by others, an int slice (<code>[]int</code>) cannot contain <code>nil</code> values because it is illegal to assign <code>nil</code> to a variable of a type whose specified <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a> is not <code>nil</code>.</p>\n\n<p>If you need a slice that can hold <code>int</code> values and <code>nil</code>s you can use  <code>[]interface{}</code>. Then, to construct the desired string you can simply marshal such a slice with the <code>encoding/json</code> package.</p>\n\n<pre><code>var a = []interface{}{15698, nil, 13000, 560365, nil}\nb, err := json.Marshal(a)\nif err != nil {\n    panic(err)\n}\nfmt.Println(string(b))\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/hEjTFIoJlXj\" rel=\"nofollow noreferrer\">https://play.golang.com/p/hEjTFIoJlXj</a></p>\n"}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "closed_date": 1565074184, "accepted_answer_id": 57360028, "answer_count": 1, "score": -4, "last_activity_date": 1565013032, "creation_date": 1565009103, "last_edit_date": 1565011414, "question_id": 57358880, "link": "https://stackoverflow.com/questions/57358880/how-convert-array-with-integer-and-nill-to-string", "closed_reason": "Needs details or clarity", "title": "How convert array with integer and nill to string?", "body": "<p>Let's say I have array with <code>integer</code> and <code>nil</code> elements:</p>\n\n<pre><code>[15698, nil, 13000, 560365, nil]\n</code></pre>\n\n<p>I want to convert this array to string where each element separated by <code>,</code>.</p>\n\n<pre><code>[15698, null, 13000, 560365, null]\n</code></pre>\n\n<p>I tried next code but it return 0 instead of null. How to fix it?</p>\n\n<pre><code>func ConvertIntArrayToString(input []int) string {\n    if len(input) == 0 {\n        return \"\"\n    }\n    estimate := len(input) * 4\n    b := make([]byte, 0, estimate)\n    for _, n := range input {\n        b = strconv.AppendInt(b, int64(n), 10)\n        b = append(b, ',')\n    }\n    b = b[:len(b)-1]\n    return string(b)\n}\n</code></pre>\n\n<hr>\n\n<p>Here is how I created array:</p>\n\n<pre><code>type NilInt struct {\n    value int\n    null  bool\n}\n\nfunc (n *NilInt) Value() interface{} {\n    if n.null {\n        return nil\n    }\n    return n.value\n}\n\nfunc NewInt(x int) NilInt {\n    return NilInt{x, false}\n}\n\nfunc NewNil() NilInt {\n    return NilInt{0, true}\n}\n\nvar x = []utils.NilInt{utils.NewNil(), utils.NewInt(10), utils.NewNil(), utils.NewInt(5)}]\n\nvar result strings.Builder\n\nfor _, n := range x {\n    if n.Value() == nil {\n        result.WriteString(\"null,\")\n    } else {\n        result.WriteString(??? + \",\")\n    }\n}\n\nfmt.Println(result)\n</code></pre>\n"}, {"tags": ["go", "azure-application-insights"], "comments": [{"owner": {"reputation": 16352, "user_id": 932728, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/4PyNZ.jpg?s=128&g=1", "display_name": "Peter Bons", "link": "https://stackoverflow.com/users/932728/peter-bons"}, "edited": false, "score": 1, "creation_date": 1565008061, "post_id": 57358371, "comment_id": 101204112, "body": "<i>...because sometimes it lasts 3 minutes and sometimes around 15...</i> -&gt; you mean before you can see the data in the portal? Because yes, the processing of the data can be delayed for up to a few minutes. It is not meant to be a (near) realtime logging solution."}, {"owner": {"reputation": 175, "user_id": 6123774, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b2U3a.png?s=128&g=1", "display_name": "Vrangz", "link": "https://stackoverflow.com/users/6123774/vrangz"}, "reply_to_user": {"reputation": 16352, "user_id": 932728, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/4PyNZ.jpg?s=128&g=1", "display_name": "Peter Bons", "link": "https://stackoverflow.com/users/932728/peter-bons"}, "edited": false, "score": 0, "creation_date": 1565010540, "post_id": 57358371, "comment_id": 101205455, "body": "Yes, it was what I meant. The problem is I have an error in my Azure CD Pipeline because it&#39;s tested if application have any logs in AI and I&#39;m not allowed to change that. But if it&#39;s not problem from my side it&#39;s not that bad. Thanks"}], "owner": {"reputation": 175, "user_id": 6123774, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b2U3a.png?s=128&g=1", "display_name": "Vrangz", "link": "https://stackoverflow.com/users/6123774/vrangz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 270, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565080829, "creation_date": 1565007151, "last_edit_date": 1565007611, "question_id": 57358371, "link": "https://stackoverflow.com/questions/57358371/go-with-application-insights", "title": "Go with Application Insights", "body": "<p>I use <code>github.com/microsoft/ApplicationInsights-Go</code> package to communicate with Azure Application Insights and I want to gather logs from logrus (logging package) and http request logs from gin (http server package).\nI managed to send both logs to AI as one of answers <a href=\"https://github.com/Microsoft/ApplicationInsights-Go/issues/25\" rel=\"nofollow noreferrer\">there</a> presents. </p>\n\n<p>The only problem is with sending these logs, because sometimes it lasts 3 minutes and sometimes around 15. Is this a problem with AI or Telemetries should be flushed somehow?</p>\n\n<p>I also tried reducing max batch size and interval by </p>\n\n<pre><code>telemetryConfig := appinsights.NewTelemetryConfiguration(c.InstrumentationKey)\ntelemetryConfig.MaxBatchSize = 128 //default is 1024\ntelemetryConfig.MaxBatchInterval = 1 * time.Second //default is 10\n</code></pre>\n\n<p>and then creating a client</p>\n\n<pre><code>appinsights.NewTelemetryClient(telemetryConfig)\n</code></pre>\n\n<p>but it's still not close to second-like time.</p>\n\n<p>performing <code>Flush()</code> on client channel does not work too.</p>\n\n<p>Thanks in advance for any advice</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 1, "creation_date": 1565006437, "post_id": 57357799, "comment_id": 101203123, "body": "if i were to do this i would use <code>len(fmt.Sprintf(&quot;, %v&quot;, e))</code> as size ,  but it would be god to use ` ...`  in logs to indicate that the args list is  not complete"}, {"owner": {"reputation": 1564, "user_id": 3655841, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/b0qz3.jpg?s=128&g=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/3655841/ron"}, "reply_to_user": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1565010490, "post_id": 57357799, "comment_id": 101205428, "body": "Good point, I&#39;ll keep it in mind thanks :)"}], "answers": [{"comments": [{"owner": {"reputation": 1564, "user_id": 3655841, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/b0qz3.jpg?s=128&g=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/3655841/ron"}, "edited": false, "score": 0, "creation_date": 1565009512, "post_id": 57358344, "comment_id": 101204916, "body": "really cool answer, you solved my problem but now I need to change the headline of the question because it no longer fits this thread :)   marked and upvoted."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1565009628, "last_edit_date": 1565009628, "creation_date": 1565007048, "answer_id": 57358344, "question_id": 57357799, "link": "https://stackoverflow.com/questions/57357799/size-control-on-logging-an-unknown-length-of-parameters/57358344#57358344", "title": "Size control on logging an unknown length of parameters", "body": "<p>Getting the memory size of arbitrary values (arbitrary data structures) is not impossible but \"hard\" in Go. For details, see <a href=\"https://stackoverflow.com/questions/44257522/how-to-get-memory-size-of-variable-in-golang/44258164#44258164\">How to get memory size of variable in Go?</a></p>\n\n<p>The easiest solution could be to produce the data to be logged in memory, and you can simply truncate it before logging (e.g. if it's a <code>string</code> or a byte slice, simply slice it). This is however not the gentlest solution (slower and requires more memory).</p>\n\n<p>Instead I would achieve what you want differently. I would try to assemble the data to be logged, but I would use a special <code>io.Writer</code> as the target (which may be targeted at your disk or at an in-memory buffer) which keeps track of the bytes written to it, and once a limit is reached, it could discard further data (or report an error, whatever suits you).</p>\n\n<p>You can see a counting <code>io.Writer</code> implementation here: <a href=\"https://stackoverflow.com/questions/37701584/size-in-bits-of-object-encoded-to-json/37704940#37704940\">Size in bits of object encoded to JSON?</a></p>\n\n<pre><code>type CounterWr struct {\n    io.Writer\n    Count int\n}\n\nfunc (cw *CounterWr) Write(p []byte) (n int, err error) {\n    n, err = cw.Writer.Write(p)\n    cw.Count += n\n    return\n}\n</code></pre>\n\n<p>We can easily change it to become a functional limited-writer:</p>\n\n<pre><code>type LimitWriter struct {\n    io.Writer\n    Remaining int\n}\n\nfunc (lw *LimitWriter) Write(p []byte) (n int, err error) {\n    if lw.Remaining == 0 {\n        return 0, io.EOF\n    }\n\n    if lw.Remaining &lt; len(p) {\n        p = p[:lw.Remaining]\n    }\n    n, err = lw.Writer.Write(p)\n    lw.Remaining -= n\n    return\n}\n</code></pre>\n\n<p>And you can use the <code>fmt.FprintXXX()</code> functions to write into a value of this <code>LimitWriter</code>.</p>\n\n<p>An example writing to an in-memory buffer:</p>\n\n<pre><code>buf := &amp;bytes.Buffer{}\nlw := &amp;LimitWriter{\n    Writer:     buf,\n    Remaining:  20,\n}\n\nargs := []interface{}{1, 2, \"Looooooooooooong\"}\n\nfmt.Fprint(lw, args)\nfmt.Printf(\"%d %q\", buf.Len(), buf)\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/JXUWMtUQn-k\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>20 \"[1 2 Looooooooooooon\"\n</code></pre>\n\n<p>As you can see, our <code>LimitWriter</code> only allowed to write 20 bytes (<code>LimitWriter.Remaining</code>), and the rest were discarded.</p>\n\n<p>Note that in this example I assembled the data in an in-memory buffer, but in your logging system you can write directly to your logging stream, just wrap it in <code>LimitWriter</code> (so you can completely omit the in-memory buffer).</p>\n\n<p>Optimization tip: if you have the arguments as a slice, you may optimize the truncated rendering by using a loop, and stop printing arguments once the limit is reached.</p>\n\n<p>An example doing this:</p>\n\n<pre><code>buf := &amp;bytes.Buffer{}\nlw := &amp;LimitWriter{\n    Writer:    buf,\n    Remaining: 20,\n}\n\nargs := []interface{}{1, 2, \"Loooooooooooooooong\", 3, 4, 5}\n\nio.WriteString(lw, \"[\")\nfor i, v := range args {\n    if _, err := fmt.Fprint(lw, v, \" \"); err != nil {\n        fmt.Printf(\"Breaking at argument %d, err: %v\\n\", i, err)\n        break\n    }\n}\nio.WriteString(lw, \"]\")\n\nfmt.Printf(\"%d %q\", buf.Len(), buf)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/d--m9NK_mxD\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Breaking at argument 3, err: EOF\n20 \"[1 2 Loooooooooooooo\"\n</code></pre>\n\n<p>The good thing about this is that once we reach the limit, we don't have to produce the string representation of the remaining arguments that would be discarded anyway, saving some CPU (and memory) resources.</p>\n"}], "owner": {"reputation": 1564, "user_id": 3655841, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/b0qz3.jpg?s=128&g=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/3655841/ron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 57358344, "answer_count": 1, "score": 0, "last_activity_date": 1565010436, "creation_date": 1565004975, "last_edit_date": 1565010436, "question_id": 57357799, "link": "https://stackoverflow.com/questions/57357799/size-control-on-logging-an-unknown-length-of-parameters", "title": "Size control on logging an unknown length of parameters", "body": "<p><strong>The Problem:</strong></p>\n\n<p>Right now, I'm logging my SQL query and the args that related to that query, but what will happen if my args weight a lot? say 100MB? </p>\n\n<p><strong>The Solution:</strong></p>\n\n<p>I want to iterate over the args and once they exceeded the 0.5MB I want to take the args up till this point and only log them (of course I'll use the entire args set in the actual SQL query).</p>\n\n<p><strong>Where am stuck:</strong></p>\n\n<ol>\n<li>I find it hard to find the size on the disk of an <code>interface{}</code>.</li>\n<li>How can I print it? (there is a nicer way to do it than <code>%v</code>?)</li>\n</ol>\n\n<p>The concern is mainly focused on the first section, how can I find the size, I need to know the type, if its an array, stack, heap, etc..</p>\n\n<p>If code helps, here is my code structure (everything sits in dal pkg in util file):</p>\n\n<pre><code>package dal\n\nimport (\n    \"fmt\"\n)\n\nconst limitedLogArgsSizeB = 100000 // ~ 0.1MB\n\nfunc parsedArgs(args ...interface{}) string {\n    currentSize := 0\n    var res string\n\n    for i := 0; i &lt; len(args); i++ {\n        currentEleSize := getSizeOfElement(args[i])\n\n        if !(currentSize+currentEleSize =&lt; limitedLogArgsSizeB) {\n            break\n        }\n\n        currentSize += currentEleSize\n\n        res = fmt.Sprintf(\"%s, %v\", res, args[i])\n    }\n\n    return \"[\" + res + \"]\"\n}\n\nfunc getSizeOfElement(interface{}) (sizeInBytes int) {\n\n}\n</code></pre>\n\n<p>So as you can see I expect to get back from parsedArgs() a string that looks like:</p>\n\n<p>\"[4378233, 33, true]\"</p>\n\n<p>for completeness, the query that goes with it:</p>\n\n<pre><code>INSERT INTO Person (id,age,is_healthy) VALUES ($0,$1,$2)\n</code></pre>\n\n<p>so to demonstrate the point of all of this:</p>\n\n<p>lets say the first two args are equal exactly to the threshold of the size limit that I want to log, I will only get back from the parsedArgs() the first two args as a string like this:</p>\n\n<p>\"[4378233, 33]\"</p>\n\n<p>I can provide further details upon request, Thanks :)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1565003522, "post_id": 57357227, "comment_id": 101201643, "body": "You only need to import a package to refer to it, or its exported symbols, by name."}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 11883929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fadeecd7d4067eb9e389ef0f398730c7?s=128&d=identicon&r=PG&f=1", "display_name": "EricPraline", "link": "https://stackoverflow.com/users/11883929/ericpraline"}, "edited": false, "score": 0, "creation_date": 1565006432, "post_id": 57357458, "comment_id": 101203120, "body": "Thank you for your detailed response. Would I be right in saying that Go&#39;s import/export mechanics are strictly of a &quot;lexical&quot; nature, i.e. they govern the use of certain identifiers in the source code but have nothing to do with which objects are allowed in which places in the program to be compiled?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 9, "user_id": 11883929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fadeecd7d4067eb9e389ef0f398730c7?s=128&d=identicon&r=PG&f=1", "display_name": "EricPraline", "link": "https://stackoverflow.com/users/11883929/ericpraline"}, "edited": false, "score": 1, "creation_date": 1565006556, "post_id": 57357458, "comment_id": 101203195, "body": "@EricPraline Not entirely. As my quote states, import declarations also outline dependencies. Even though your <code>main</code> does not import <code>Tdef</code>, dependencies are transitive: <code>main</code> imports <code>imp</code> and <code>imp</code> imports <code>Tdef</code>, so your <code>main</code> ultimately depends on <code>Tdef</code> too, indirectly."}, {"owner": {"reputation": 9, "user_id": 11883929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fadeecd7d4067eb9e389ef0f398730c7?s=128&d=identicon&r=PG&f=1", "display_name": "EricPraline", "link": "https://stackoverflow.com/users/11883929/ericpraline"}, "edited": false, "score": 0, "creation_date": 1565007636, "post_id": 57357458, "comment_id": 101203848, "body": "Ah, ok. So if A imports B and B imports C, but only for some functionality that is not used by A, the compiler still picks this up as A depending on C, right? (This is probably also necessary for <code>init</code> functions / general pkg initialization to work as intended.)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 9, "user_id": 11883929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fadeecd7d4067eb9e389ef0f398730c7?s=128&d=identicon&r=PG&f=1", "display_name": "EricPraline", "link": "https://stackoverflow.com/users/11883929/ericpraline"}, "edited": false, "score": 1, "creation_date": 1565007737, "post_id": 57357458, "comment_id": 101203923, "body": "@EricPraline Yes, this is detailed in <a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow noreferrer\">Spec: Package initialization</a>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1565004086, "last_edit_date": 1565004086, "creation_date": 1565003732, "answer_id": 57357458, "question_id": 57357227, "link": "https://stackoverflow.com/questions/57357227/using-return-value-of-type-from-unimported-package/57357458#57357458", "title": "Using return value of type from unimported package", "body": "<p>You are allowed to use values originating from anywhere, but without the import declaration you can't refer to its type for example. Yes, because referring to identifiers requires a <a href=\"https://golang.org/ref/spec#Qualified_identifiers\" rel=\"nofollow noreferrer\">qualified identifier</a> which has the form of:</p>\n\n<blockquote>\n<pre><code>QualifiedIdent = PackageName \".\" identifier .\n</code></pre>\n</blockquote>\n\n<p>You haven't imported <code>Tdef</code> in your <code>main</code> package, so you can't refer to the type <code>Tdef.T</code> identifier (type), but you didn't attempt it so all is good.</p>\n\n<p><a href=\"https://golang.org/ref/spec#Import_declarations\" rel=\"nofollow noreferrer\">Spec: Import declarations:</a></p>\n\n<blockquote>\n  <p>An import declaration states that the source file containing the declaration depends on functionality of the <em>imported</em> package (<a href=\"https://golang.org/ref/spec#Program_initialization_and_execution\" rel=\"nofollow noreferrer\">\u00a7Program initialization and execution</a>) and <strong>enables access to <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">exported</a> identifiers of that package</strong>. The import names an identifier (PackageName) to be used for access and an ImportPath that specifies the package to be imported.</p>\n</blockquote>\n\n<p>You used a <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">short variable declaration</a> and so you did not specify the variable's type (which is perfectly OK), so you didn't need to refer to its type:</p>\n\n<pre><code>T := imp.NewT()\n</code></pre>\n\n<p><code>T</code>'s type will be inferred from the right-hand side expression, which will be <code>Tdef.T</code> of course, but your source code contains no reference to this type. Obviously the following line would give a compile-time error without importing <code>Tdef</code>:</p>\n\n<pre><code>var T Tdef.T = imp.NewT()\n</code></pre>\n\n<p>You can even return values of unexported types from an exported function, and the package importing it can as well use it, e.g. it can print it, call exported methods and access exported fields of the value of the unexported type (although returning values of unexported types is considered bad practice, golint gives a warning like: <em>\"exported func XXX returns unexported type pkgname.typename, which can be annoying to use\"</em>).</p>\n"}], "owner": {"reputation": 9, "user_id": 11883929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fadeecd7d4067eb9e389ef0f398730c7?s=128&d=identicon&r=PG&f=1", "display_name": "EricPraline", "link": "https://stackoverflow.com/users/11883929/ericpraline"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 57357458, "answer_count": 1, "score": -1, "last_activity_date": 1565004086, "creation_date": 1565002754, "question_id": 57357227, "link": "https://stackoverflow.com/questions/57357227/using-return-value-of-type-from-unimported-package", "title": "Using return value of type from unimported package", "body": "<p>Given the following three go packages (I abbreviated the import paths for imp and Tdef for privacy reasons)</p>\n\n<pre><code>package main\n\nimport (\n        \"imp\"\n        \"fmt\"\n)\n\nfunc main() {\n        T := imp.NewT()\n        fmt.Printf(\"T.X = %d\\n\", T.X)\n        fmt.Printf(\"T has type %T\\n\", T)\n}\n</code></pre>\n\n<pre><code>package imp\n\nimport (\n        \"Tdef\"\n)\n\nfunc NewT() Tdef.T {\n        return Tdef.T{0,0}\n}\n</code></pre>\n\n<pre><code>package Tdef\n\ntype T struct {\n        X int\n        Y int\n}\n\nfunc (T T) GetX() int {\n        return T.X\n}\n</code></pre>\n\n<p>main() produces the output</p>\n\n<pre><code>T.X = 0\nT has type Tdef.T\n</code></pre>\n\n<p>This means that I can use a variable of type T in a package where the definition of T is not visible by defining it using a return value, and I can use its exported fields (and methods, not shown here).</p>\n\n<p>I find that a bit surprising and did not find any information on this in the spec. Then again, I don't have much programming experience -- is this to be expected, and is it bad practice to make use of it (I don't have a real-life example right now, mind you)?</p>\n"}, {"tags": ["go", "go-modules"], "answers": [{"comments": [{"owner": {"reputation": 15564, "user_id": 6394722, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/117654f31d6ad5c9b2b0e00dcf4b24f3?s=128&d=identicon&r=PG&f=1", "display_name": "atline", "link": "https://stackoverflow.com/users/6394722/atline"}, "edited": false, "score": 0, "creation_date": 1565006231, "post_id": 57356777, "comment_id": 101203005, "body": "But <a href=\"https://github.com/kolo/xmlrpc\" rel=\"nofollow noreferrer\">github.com/kolo/xmlrpc</a> also not have go.mod, but as mentioned in my post, it did not show incompatible."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1565007250, "post_id": 57356777, "comment_id": 101203611, "body": "I&#39;ve edited to anser to include that <code>+incompativle</code> is only used for v2+. It&#39;s incompatible since a &quot;proper&quot; Go module would have a \u2026<code>&#47;v4</code> in the module name if it was &quot;v4.1.0&quot;."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1565007354, "post_id": 57356777, "comment_id": 101203662, "body": "Also see <a href=\"https://github.com/golang/go/wiki/Modules#can-a-module-consume-a-v2-package-that-has-not-opted-into-modules-what-does-incompatible-mean\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>"}, {"owner": {"reputation": 215, "user_id": 11021437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e77a941ee46253533bef4a1b3771bd2?s=128&d=identicon&r=PG&f=1", "display_name": "Anonymous", "link": "https://stackoverflow.com/users/11021437/anonymous"}, "edited": false, "score": 1, "creation_date": 1591801631, "post_id": 57356777, "comment_id": 110195786, "body": "Will that cause any issue in future? if go.mod does not exist?"}], "tags": [], "owner": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "is_accepted": true, "score": 51, "last_activity_date": 1565007173, "last_edit_date": 1565007173, "creation_date": 1565001083, "answer_id": 57356777, "question_id": 57355929, "link": "https://stackoverflow.com/questions/57355929/what-does-incompatible-in-go-mod-mean-will-it-cause-harm/57356777#57356777", "title": "What does &#39;incompatible&#39; in go.mod mean, will it cause harm?", "body": "<p><code>+incompatible</code> means the dependency has a semver major version of 2 or higher and is not a Go module yet (it doesn't have go.mod in its source code).</p>\n"}, {"comments": [{"owner": {"reputation": 10804, "user_id": 2701130, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9a8dc6466b051862029132d3c61ca48d?s=128&d=identicon&r=PG", "display_name": "ken", "link": "https://stackoverflow.com/users/2701130/ken"}, "edited": false, "score": 0, "creation_date": 1585107464, "post_id": 57372286, "comment_id": 107646225, "body": "for #5, does this means we have to create a new folder or project for <code>&#47;v4</code> (since this is a github repository) for it? Or is it that we just add the suffix <code>&#47;v4</code> to just indicate its version is v2+ without actual folder?"}, {"owner": {"reputation": 15564, "user_id": 6394722, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/117654f31d6ad5c9b2b0e00dcf4b24f3?s=128&d=identicon&r=PG&f=1", "display_name": "atline", "link": "https://stackoverflow.com/users/6394722/atline"}, "reply_to_user": {"reputation": 10804, "user_id": 2701130, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9a8dc6466b051862029132d3c61ca48d?s=128&d=identicon&r=PG", "display_name": "ken", "link": "https://stackoverflow.com/users/2701130/ken"}, "edited": false, "score": 2, "creation_date": 1585109877, "post_id": 57372286, "comment_id": 107646676, "body": "No physical folder needed. Give you a example: This project <a href=\"https://github.com/etcd-io/etcd/blob/master/go.mod#L9\" rel=\"nofollow noreferrer\">github.com/etcd-io/etcd/blob/master/go.mod#L9</a> need to use <code>github.com&#47;coreos&#47;go-systemd&#47;v22 v22.0.0</code>, but next is the project <code>coreos</code>: <a href=\"https://github.com/coreos/go-systemd\" rel=\"nofollow noreferrer\">github.com/coreos/go-systemd</a>, you could see it did not have a folder <code>v22.0.0</code>, just have it in module name: <a href=\"https://github.com/coreos/go-systemd/blob/master/go.mod#L1\" rel=\"nofollow noreferrer\">github.com/coreos/go-systemd/blob/master/go.mod#L1</a>"}], "tags": [], "owner": {"reputation": 15564, "user_id": 6394722, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/117654f31d6ad5c9b2b0e00dcf4b24f3?s=128&d=identicon&r=PG&f=1", "display_name": "atline", "link": "https://stackoverflow.com/users/6394722/atline"}, "is_accepted": false, "score": 74, "last_activity_date": 1565081460, "creation_date": 1565081460, "answer_id": 57372286, "question_id": 57355929, "link": "https://stackoverflow.com/questions/57355929/what-does-incompatible-in-go-mod-mean-will-it-cause-harm/57372286#57372286", "title": "What does &#39;incompatible&#39; in go.mod mean, will it cause harm?", "body": "<p>Accepted answer is correct, but really not friendly for me who just get in touch with go module. I made some investigation base on the answer &amp; make a conclusion base on <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"noreferrer\">this</a> as next, in case anyone needed:</p>\n\n<p>Standard commands like go build or go test will automatically add new dependencies as needed to satisfy imports (updating go.mod and downloading the new dependencies). But there are several different situations which will result in the different version selections:</p>\n\n<ol>\n<li><p>If a repository has not opted in to modules but has been tagged with valid semver tags, meanwhile, it's v0/v1 module, see <a href=\"https://github.com/golang/go/wiki/Modules#can-a-module-consume-a-package-that-has-not-opted-in-to-modules\" rel=\"noreferrer\">this</a>:</p>\n\n<p><strong>not opted in to modules</strong>: means no <code>go.mod</code> in source tree</p>\n\n<p><strong>valid semver tags</strong>: means the repo use git tag to tagged as something like <code>vX.Y.Z</code></p>\n\n<p><strong>v0/v1 module</strong>: means the value of major version(that is X) is 0 or 1, e.g. v0.1.0, v1.2.3</p>\n\n<p>Then, it will use a <code>pseudo-version</code>, something like <code>github.com/kolo/xmlrpc v0.0.0-20190717152603-07c4ee3fd181</code></p></li>\n<li><p>If a repository has not opted in to modules but has been tagged with valid semver tags, meanwhile, it's a v2+ module, see <a href=\"https://github.com/golang/go/wiki/Modules#can-a-module-consume-a-v2-package-that-has-not-opted-into-modules-what-does-incompatible-mean\" rel=\"noreferrer\">this</a>:</p>\n\n<p><strong>v2+ module</strong>: means the value of major version(that is X) is >=2,e g. v4.1.0</p>\n\n<p>Then, it will show as <code>incompatible</code>, something like <code>github.com/zeromq/goczmq v4.1.0+incompatible</code></p></li>\n<li><p>If a repository has already opted in to modules, but not have been tagged with valid semver tags:</p>\n\n<p>Then, it will behave as 1, use <code>pseudo-version</code>.</p></li>\n<li><p>If a repository has already opted in to modules, and has been tagged with valid semver tags, meanwhile, it's a v0/v1 module:</p>\n\n<p>Then, it will behave normally like <code>github.com/stretchr/testify v1.3.0</code></p></li>\n<li><p>If a repository has already opted in to modules, and has been tagged with valid semver tags, meanwhile, it's a v2+ module:</p>\n\n<p>Then, when import in sourcecode, we need add <code>/vN</code> at the end, e.g., <code>import \"github.com/my/mod/v4\"</code>, and in <code>go.mod</code> it will behave like <code>github.com/my/mod/v4 v4.1.0</code></p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 166, "user_id": 11904651, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WUMVN-fvfNk/AAAAAAAAAAI/AAAAAAAAAOY/j_7iNZcBCGU/photo.jpg?sz=128", "display_name": "Ankush Chadha", "link": "https://stackoverflow.com/users/11904651/ankush-chadha"}, "is_accepted": false, "score": 5, "last_activity_date": 1570237057, "last_edit_date": 1570237057, "creation_date": 1570236358, "answer_id": 58244519, "question_id": 57355929, "link": "https://stackoverflow.com/questions/57355929/what-does-incompatible-in-go-mod-mean-will-it-cause-harm/58244519#58244519", "title": "What does &#39;incompatible&#39; in go.mod mean, will it cause harm?", "body": "<p>The module name should have been github.com/zeromq/goczmq/v4 instead of <a href=\"https://search.gocenter.io/github.com~2Fzeromq~2Fgoczmq/info?version=v4.2.0%2Bincompatible\" rel=\"noreferrer\">github.com/zeromq/goczmq</a> for versions v4 and above (v4.1.0, v4.2.0, etc).</p>\n\n<p>Since github.com/zeromq/goczmq has not adopted Go modules correctly, the go get will fail if Go 1.13 is used and the GOPROXY is set to direct or to some other server that does not host this file -</p>\n\n<pre><code>    go get github.com/zeromq/goczmq@v4.2.0+incompatible\n    go: finding github.com v4.2.0+incompatible\n    go: finding github.com/zeromq v4.2.0+incompatible\n    go: finding github.com/zeromq/goczmq v4.2.0+incompatible\n    go: finding github.com/zeromq/goczmq v4.2.0+incompatible\n    go get github.com/zeromq/goczmq@v4.2.0+incompatible: github.com/zeromq/goczmq@v4.2.0+incompatible: invalid version: +incompatible suffix not allowed: module contains a go.mod file, so semantic import versioning is required\n\n</code></pre>\n\n<p>More details mentioned under the '<strong>Version validation</strong>' section here - <a href=\"https://golang.org/doc/go1.13#modules\" rel=\"noreferrer\">https://golang.org/doc/go1.13#modules</a></p>\n\n<p>Note - GoSUMDB also won't have such entries so even if you set the GOPROXY to a server that hosts this file and if GOSumDB is enabled, then you will get something like this - </p>\n\n<pre><code>    \u279c  ~ export GOPROXY=https://gocenter.io\n    \u279c  ~ go get github.com/zeromq/goczmq@v4.2.0+incompatible\n    go: finding github.com/zeromq/goczmq v4.2.0+incompatible\n    go: finding github.com/zeromq v4.2.0+incompatible\n    go: finding github.com v4.2.0+incompatible\n    go: downloading github.com/zeromq/goczmq v4.2.0+incompatible\n    verifying github.com/zeromq/goczmq@v4.2.0+incompatible: github.com/zeromq/goczmq@v4.2.0+incompatible: reading https://gocenter.io/sumdb/sum.golang.org/lookup/github.com/zeromq/goczmq@v4.2.0+incompatible: 404 Not Found\n\n</code></pre>\n\n<p>The correct solution will be to follow up with the module author to make sure that they are adopting Go modules correctly by adding a suffix to the module name. </p>\n\n<p>There is a workaround but have to check if it's working by design i.e. point GOPROXY to a server that hosts this file and then use GOPRIVATE to exclude this specific module version from GoSumDB validation -</p>\n\n<pre><code>\n    root@715c3b39bb12:/go# export GOPROXY=https://gocenter.io \n    root@715c3b39bb12:/go# unset GOPRIVATE\n\n    root@715c3b39bb12:/go# go get github.com/zeromq/goczmq@v4.2.0+incompatible\n    go: finding github.com v4.2.0+incompatible\n    go: finding github.com/zeromq/goczmq v4.2.0+incompatible\n    go: finding github.com/zeromq v4.2.0+incompatible\n    go: downloading github.com/zeromq/goczmq v4.2.0+incompatible\n    verifying github.com/zeromq/goczmq@v4.2.0+incompatible: github.com/zeromq/goczmq@v4.2.0+incompatible: reading https://gocenter.io/sumdb/sum.golang.org/lookup/github.com/zeromq/goczmq@v4.2.0+incompatible: 404 Not Found\n\n    root@715c3b39bb12:/go# export GOPRIVATE=github.com/zeromq/goczmq\n\n    root@715c3b39bb12:/go# go get github.com/zeromq/goczmq@v4.2.0+incompatible\n\n    go: downloading github.com/zeromq/goczmq v4.2.0+incompatible\n    go: extracting github.com/zeromq/goczmq v4.2.0+incompatible\n    # pkg-config --cflags  -- libczmq libzmq libsodium\n    Package libczmq was not found in the pkg-config search path.\n    Perhaps you should add the directory containing `libczmq.pc'\n\n</code></pre>\n\n<p>However, will still recommend reaching out to the module author to fix the module name in their go.mod file.</p>\n"}], "owner": {"reputation": 15564, "user_id": 6394722, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/117654f31d6ad5c9b2b0e00dcf4b24f3?s=128&d=identicon&r=PG&f=1", "display_name": "atline", "link": "https://stackoverflow.com/users/6394722/atline"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18119, "favorite_count": 19, "accepted_answer_id": 57356777, "answer_count": 3, "score": 61, "last_activity_date": 1592913335, "creation_date": 1564998098, "last_edit_date": 1592913335, "question_id": 57355929, "link": "https://stackoverflow.com/questions/57355929/what-does-incompatible-in-go-mod-mean-will-it-cause-harm", "title": "What does &#39;incompatible&#39; in go.mod mean, will it cause harm?", "body": "<p>I'm using <a href=\"https://github.com/zeromq/goczmq\" rel=\"noreferrer\">goczmq</a> in my project, something like next:</p>\n\n<p><strong>main.go:</strong></p>\n\n<pre><code>package main\n\nimport (\n    _ \"github.com/zeromq/goczmq\"\n)\n\nfunc main() {\n}\n</code></pre>\n\n<p>And more, I'm using golang 1.12 with gomod to manage my project.</p>\n\n<p>See next, I use <code>go mod init xxx</code>, and when build, it downloads goczmq automatically for me and add dependency to <code>go.mod</code>, but has <code>incompatible</code> in it. (But for other library I may get something like <code>github.com/kolo/xmlrpc v0.0.0-20190717152603-07c4ee3fd181</code>)</p>\n\n<p><strong>go.mod:</strong></p>\n\n<pre><code>module pigeon\n\ngo 1.12\n\nrequire (\n    github.com/zeromq/goczmq v4.1.0+incompatible\n)\n</code></pre>\n\n<p>From some discussion (for other library), e.g. <a href=\"https://github.com/dgrijalva/jwt-go/issues/294\" rel=\"noreferrer\">this</a>, it seems the library owner should do something to support golang 1.12? But in my case, all things works fine just a <code>incompatible</code> there make me a little worried (I mean all seems ok now, but some day when I use an api which I never used before, there will be hidden bomb there...?)</p>\n\n<p><strong>So my question:</strong> </p>\n\n<p>Should I worry about this, or this is just as expected?</p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565006901, "post_id": 57355130, "comment_id": 101203393, "body": "<code>GOBIN</code> should normally be empty. (<a href=\"https://golang.org/doc/install/source#environment\" rel=\"nofollow noreferrer\">golang.org/doc/install/source#environment</a> or <a href=\"https://golang.org/cmd/go/#hdr-Environment_variables\" rel=\"nofollow noreferrer\">golang.org/cmd/go/#hdr-Environment_variables</a>)"}, {"owner": {"reputation": 92, "user_id": 11556795, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Frmdz5Czl-A/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3refsxQuiRE4MAIxiBfUs0mQCsynwA/mo/photo.jpg?sz=128", "display_name": "Kwi", "link": "https://stackoverflow.com/users/11556795/kwi"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565008001, "post_id": 57355130, "comment_id": 101204083, "body": "thx then how to solve this I try to delete github and golang.org and reinstall it but it still have same prob"}], "owner": {"reputation": 92, "user_id": 11556795, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Frmdz5Czl-A/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3refsxQuiRE4MAIxiBfUs0mQCsynwA/mo/photo.jpg?sz=128", "display_name": "Kwi", "link": "https://stackoverflow.com/users/11556795/kwi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 275, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565007899, "creation_date": 1564995148, "last_edit_date": 1565007899, "question_id": 57355130, "link": "https://stackoverflow.com/questions/57355130/installing-github-com-rogpeppe-godef-failed", "title": "Installing github.com/rogpeppe/godef FAILED", "body": "<p>I use Go: Install/Update Tools in VSCode to install <code>gocode</code> and <code>godef</code> but I get this error :</p>\n\n<blockquote>\n  <p>Installing github.com/stamblerre/gocode FAILED Installing\n  github.com/rogpeppe/godef FAILED</p>\n</blockquote>\n\n<p>and in the output -></p>\n\n<blockquote>\n  <p>\"\"D:\\Krittawat\\Learn\\GoWorkspace\\src\\github.com\\stamblerre\\gocode\"\n  is not using a known version control system\" and \n  \"\"D:\\Krittawat\\Learn\\GoWorkspace\\src\\github.com\\stamblerre\\gocode\"\n  is not using a known version control system\"</p>\n</blockquote>\n\n<p>I check my GOPATH GOROOT GOBIN by using \"go env\" \nand this is my GOPATH GOROOT and GOBIN</p>\n\n<pre><code>set GOPATH=D:\\Krittawat\\Learn\\GoWorkspace\nset GOROOT=D:\\Krittawat\\Programs\\go1.12.7.windows-amd64\\go\nset GOBIN=\n</code></pre>\n\n<p>I don't know how to solve it. I searching for solutions, but nothing works.</p>\n"}, {"tags": ["json", "go", "server", "static", "go-gin"], "answers": [{"comments": [{"owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "edited": false, "score": 0, "creation_date": 1564992503, "post_id": 57354429, "comment_id": 101196310, "body": "It&#39;s the simple way. But how can I set dynamic <code>url</code> param here?"}, {"owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "reply_to_user": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "edited": false, "score": 0, "creation_date": 1564994064, "post_id": 57354429, "comment_id": 101196970, "body": "@02040402 yes that&#39;s how you do it, perhaps have a GET param, and do the file grabbing manually"}], "tags": [], "owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "is_accepted": true, "score": 5, "last_activity_date": 1564991961, "creation_date": 1564991961, "answer_id": 57354429, "question_id": 57354389, "link": "https://stackoverflow.com/questions/57354389/how-to-render-static-files-within-gin-router/57354429#57354429", "title": "How to render static files within Gin router?", "body": "<p>Quoting the original gin docs: <a href=\"https://github.com/gin-gonic/gin#serving-static-files\" rel=\"noreferrer\">https://github.com/gin-gonic/gin#serving-static-files</a></p>\n\n<pre><code>func main() {\n    router := gin.Default()\n    router.Static(\"/assets\", \"./assets\")\n    router.StaticFS(\"/more_static\", http.Dir(\"my_file_system\"))\n    router.StaticFile(\"/favicon.ico\", \"./resources/favicon.ico\")\n\n    // Listen and serve on 0.0.0.0:8080\n    router.Run(\":8080\")\n}\n</code></pre>\n\n<p>So basically you should define a route specific to your JSON file next to other routes you've defined. And then use that.</p>\n"}], "owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8557, "favorite_count": 2, "accepted_answer_id": 57354429, "answer_count": 1, "score": 2, "last_activity_date": 1597433905, "creation_date": 1564991740, "last_edit_date": 1597433905, "question_id": 57354389, "link": "https://stackoverflow.com/questions/57354389/how-to-render-static-files-within-gin-router", "title": "How to render static files within Gin router?", "body": "<p>I want to serve a JSON file with gin server. And set some customize values in the HTML file. Use JavaScript in it to call the JSON file.</p>\n<p>My application structure:</p>\n<pre><code>.\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 templates\n    \u251c\u2500\u2500 index.html\n    \u2514\u2500\u2500 web.json\n</code></pre>\n<p>I put these basic source into <code>main.go</code> file:</p>\n<pre><code>package main\n\nimport (\n    &quot;net/http&quot;\n\n    &quot;github.com/gin-gonic/gin&quot;\n)\n\nvar router *gin.Engine\n\nfunc main() {\n    router = gin.Default()\n    router.LoadHTMLGlob(&quot;templates/*&quot;)\n\n    router.GET(&quot;/web&quot;, func(c *gin.Context) {\n        c.HTML(\n            http.StatusOK,\n            &quot;index.html&quot;,\n            gin.H{\n                &quot;title&quot;: &quot;Web&quot;,\n                &quot;url&quot;:   &quot;./web.json&quot;,\n            },\n        )\n    })\n\n    router.Run()\n}\n</code></pre>\n<p>Some code in <code>templates/index.html</code> file:</p>\n<pre><code>&lt;!doctype html&gt;\n&lt;html&gt;\n\n  &lt;head&gt;\n    &lt;title&gt;{{ .title }}&lt;/title&gt;\n\n    // ...\n  &lt;/head&gt;\n\n  &lt;body&gt;\n    &lt;div id=&quot;swagger-ui&quot;&gt;&lt;/div&gt;\n\n    // ...\n    \n    &lt;script&gt;\n      window.onload = function() {\n        // Begin Swagger UI call region\n        const ui = SwaggerUIBundle({\n          url: &quot;{{ .url }}&quot;,\n          dom_id: '#swagger-ui',\n          // ...\n        })\n        // End Swagger UI call region\n\n        window.ui = ui\n      }\n    &lt;/script&gt;\n\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<p>When running the application, I got a fetch error:</p>\n<blockquote>\n<p>Not Found ./web.json</p>\n</blockquote>\n<p>So how should I serve the <code>web.json</code> file to be accessed in the Gin internal server?</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1564997367, "post_id": 57353019, "comment_id": 101198545, "body": "You should reuse the encoder instead of creating a new one in every iteration."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1565029261, "last_edit_date": 1565029261, "creation_date": 1564985462, "answer_id": 57353019, "question_id": 57352875, "link": "https://stackoverflow.com/questions/57352875/how-to-change-the-format-in-which-im-returning-my-data-from-my-go-server-withou/57353019#57353019", "title": "How to change the format in which I&#39;m returning my data from my go server without storing it", "body": "<p>Assuming that <code>resp</code> is a slice with a single element, then use the following code.  The code wraps the slice elements in a single JSON array.</p>\n\n<pre><code>go func() {\n    enc := json.NewEncoder(w)\n    sep := []byte(\"\")\n    comma := []byte(\",\")\n    w.Write([]byte(\"[\")\n    for res := range ch {\n        w.Write(sep)\n        sep = comma\n        resp := SearchResultToObjectType(res)\n        enc.Encode(resp[0])\n        flusher.Flush()    \n    }\n    w.Write([]byte(\"]\")\n    wg.Done()\n}()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": false, "score": 3, "last_activity_date": 1564985509, "creation_date": 1564985509, "answer_id": 57353030, "question_id": 57352875, "link": "https://stackoverflow.com/questions/57352875/how-to-change-the-format-in-which-im-returning-my-data-from-my-go-server-withou/57353030#57353030", "title": "How to change the format in which I&#39;m returning my data from my go server without storing it", "body": "<p>One option would be to construct the outer JSON array manually, using something like this:</p>\n\n<pre><code>first := true\nw.Write([]byte(\"[\"))\nfor res := range ch {\n    if not first {\n        w.Write([]byte(\",\"))\n    }\n    first = false\n    ...\n    json.NewEncoder(w).Encode(resp)\n    ...\n}\nw.Write([]byte(\"]\"))\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 9668189, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-dqEXOVMGWIo/AAAAAAAAAAI/AAAAAAAAAWI/at_NTfVNOPw/photo.jpg?sz=128", "display_name": "Muthu Narayanan", "link": "https://stackoverflow.com/users/9668189/muthu-narayanan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 57353019, "answer_count": 2, "score": -1, "last_activity_date": 1565029261, "creation_date": 1564984610, "last_edit_date": 1564988807, "question_id": 57352875, "link": "https://stackoverflow.com/questions/57352875/how-to-change-the-format-in-which-im-returning-my-data-from-my-go-server-withou", "title": "How to change the format in which I&#39;m returning my data from my go server without storing it", "body": "<p>I'm encoding every search result that I fetch from the channel and then sending it to the response writer  and then flushing it but that sends the data like:</p>\n\n<pre><code>[{..}]\n[{..}]\n[{..}]\n</code></pre>\n\n<p>this as multiple arrays with a single value</p>\n\n<p>but the format in which I require the data to be sent is like\n<code>[{..},{..},{..}]</code> this a single array with multiple values.</p>\n\n<p>this can be done if I store the data before in a variable and then encode the whole data but if I store it my run time is running out of memory.</p>\n\n<p>Is there any way to convert it to the desired format without storing it or how to solve my memory problem.</p>\n\n<p>I'm running my go server in a 4gb ram sles12 sp3 system</p>\n\n<pre><code>ch := make(chan *ldap.SearchResult)\n//result := &amp;ldap.SearchResult{}\n\nflusher, ok := w.(http.Flusher)\n\nif !ok {\n    http.Error(w, \"Streaming unsupported!\", http.StatusInternalServerError)\n    return\n}\n\nwg := sync.WaitGroup{}\nwg.Add(1)\n\ngo func() {\n    for res := range ch {\n        resp := SearchResultToObjectType(res)\n\n        json.NewEncoder(w).Encode(resp)\n\n        flusher.Flush()\n        //result.Entries = append(result.Entries, res.Entries...)\n        //result.Controls = append(result.Controls, res.Controls...)\n        //result.Referrals = append(result.Referrals, res.Referrals...)\n    }\n    wg.Done()\n}()\n\nerr = conn.SearchWithChannel(searchRequest, ch)\n\nwg.Wait()\n\nif err != nil {\n    json.NewEncoder(w).Encode(utils.ParseErrorToJson(err))\n    event.LogEventError(err, nil)\n}\n</code></pre>\n"}, {"tags": ["go", "bcrypt", "scrypt", "kdf"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1564984639, "post_id": 57352676, "comment_id": 101193292, "body": "What <a href=\"https://github.com/golang/crypto/blob/4def268fd1a49955bfb3dda92fe3db4f924f2285/scrypt/scrypt.go#L212\" rel=\"nofollow noreferrer\">scrypt actually does is</a> to call <a href=\"https://godoc.org/golang.org/x/crypto/pbkdf2#Key\" rel=\"nofollow noreferrer\">pbkdf2.Key</a>, which nobody prevents you from blatantly copying ;)"}, {"owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1564985365, "post_id": 57352676, "comment_id": 101193471, "body": "Thanks for linking that, for reference. My concern is that, although we both know that it easily embeds a KDF, is that, if I were to do the same thing, I would run the risk of misparsing the output string or, God forbid, break compatibility with future versions/formats of bcrypt. I&#39;m unwilling to take on that responsibility since the integrity of other peoples&#39; data will be built on my foundation."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1564986062, "post_id": 57352676, "comment_id": 101193689, "body": "PBKDF is standardized, and it pretty much does not make a difference what you put into it. Since bcrypt itself only returns a []byte, there is no problem with that. The internal format is rather unlikely to change: it would break compatibility, and bcrypt was specifically designed for that. I assume as per format you are referring to the <a href=\"https://en.m.wikipedia.org/wiki/Crypt_(C)#Key_derivation_functions_supported_by_crypt\" rel=\"nofollow noreferrer\">modular crypt format</a>, which does not apply here. As long as you do proper dependency management, I do not see any point preventing you from following my suggestion."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565006457, "post_id": 57352676, "comment_id": 101203137, "body": "Looking at the package comments &quot;bcrypt implements [\u2026] adaptive hashing algorithm&quot; vs. &quot;implements the scrypt key derivation function&quot; they appear to implement different things for different use cases so it&#39;s not at all surprising that their APIs are different."}], "answers": [{"tags": [], "owner": {"reputation": 219318, "user_id": 12597, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/4b534325156758d6592fb624d7b60e22?s=128&d=identicon&r=PG", "display_name": "Ian Boyd", "link": "https://stackoverflow.com/users/12597/ian-boyd"}, "is_accepted": false, "score": 1, "last_activity_date": 1592431372, "last_edit_date": 1592431372, "creation_date": 1586049088, "answer_id": 61036846, "question_id": 57352676, "link": "https://stackoverflow.com/questions/57352676/bcrypt-in-go-with-kdf-for-specific-output-key-length/61036846#61036846", "title": "bcrypt in Go with KDF for specific output key-length", "body": "<p>Bcrypt is not a key derivation algorithm; it is a password hashing algorithm.</p>\n\n<ul>\n<li>PBKDF2 can take a password and output <code>n</code> desired bits</li>\n<li>scrypt can take a password and output <code>n</code> desired bits</li>\n</ul>\n\n<p>These are <em>key-derivation functions</em>. They take a password and generate <code>n</code> bits that you can then use as an encryption key.</p>\n\n<p>BCrypt cannot do that. BCrypt is not a key-derivation function. It is a password hashing function. It always outputs the same amount of bits.</p>\n\n<p><strong>Bonus:</strong> bcrypt always outputs exactly 24-bytes (192 bits), because the output from bcrypt is the result of encrypting <code>OrpheanBeholderScryDoubt</code>.</p>\n\n<p><strong>Note</strong>: It's not the result of <em>hashing</em> <code>OrpheanBeholderScryDoubt</code> - the bcrypt algorithm is actually <em>encrypting</em> <code>OrpheanBeholderScryDoubt</code> using the blowfish cipher (and repeating the encryption 64 times).</p>\n\n<p>The strenght of bcrypt comes from the <em>\"expensive key setup\"</em>. </p>\n\n<p><strong>Bonus</strong>: The strength of bcrypt comes from the fact that it is <em>expensive</em>. And \"expensive\" means memory. The more memory an algorithm requires, the stronger it is against bruteforce attacks.</p>\n\n<ul>\n<li>SHA-2: can operate in 128 bytes of RAM</li>\n<li>bcrypt: constantly touches 4 KB of RAM</li>\n<li>scrypt: constantly touches 16 MB of RAM (in the default configuration in Android and LiteCoin)</li>\n<li>Argon2: is usually recommended you configure it to touch 1 GB of RAM</li>\n</ul>\n\n<p>Defending against bruteforce attacks means to defend against parallelization. An algorithm that requires 128 bytes can have 7 million parallel operations on a 1 GB video card.</p>\n\n<p>Scrypt, requiring 16 MB of RAM, can only have 62 running in parallel.</p>\n\n<p>Argon2, using 1 GB of RAM, can only have 1 running on a video card. And it runs faster on a CPU anyway.</p>\n\n<h2>Kludge bcrypt into a Key Derivation Function (KDF)</h2>\n\n<p>You could kludge bcrypt into being a key-derivation function. You can use the standard function <code>PBKDF2</code> to do it for you.</p>\n\n<p>Normally PBKDF2 is called as:</p>\n\n<pre><code>String password = \"hunter2\";\nString salt     = \"sea salt 69 nice\";\n\nByte[] key = PBKDF2(password, salt, 32, 10000); //32-bytes is 256 bits\n</code></pre>\n\n<p>But instead you can use the bcrypt string result as your salt:</p>\n\n<pre><code>String password = \"hunter2\";\nString salt     = bcrypt.HashPassword(password, 12);\n\nByte[] key = PBKDF2(password, salt, 32, 1); //32-bytes is 256-bits\n</code></pre>\n\n<p>And now you've generated a 256-bit key <em>\"using bcrypt\"</em>. It's a neat hack.</p>\n\n<p>In fact the hack is so neat, that it is <strong>literally</strong> what <em>scrypt</em> does:</p>\n\n<pre><code>String password = \"hunter2\";\nString salt     = ScryptExpensiveKeyHash(password, userSalt, ...);\n\nByte[] key = PBKDF2(password, salt, 32, 1); //32-bytes is 256-bits\n</code></pre>\n\n<h2>Conclusion</h2>\n\n<p>Bcrypt is not a key derivation function. That is the goal of functions like PBKDF2, scrypt (which uses PBKDF2), and argon2.</p>\n\n<h2>Using bcrytp when you're only allowed NIST approved algorithms</h2>\n\n<p>There is another good reason to use this pbkdf2 construction with bcrypt. </p>\n\n<p>Sometimes a <em>\"security expert\"</em>, who has no idea what they're talking about, will <strong>insist</strong> that you use PBDKF2 for key derivation. (Yes, it does happen). And you'll try to tell them over and over that PBDKF2 is horribly weak system for key derivation (SHA2 that it is based on runs way too fast, and 10,000 or 100,000 iterations is nowhere near enough to protect you from brute-force attacks - that's what bcrypt, scrypt, and argon2 were invented for).</p>\n\n<p>But this person won't let it go, and will <em>demand</em> the use of PBKDF2. With this construction you can still use bcrypt for security, and PBKDF2 for ignoramus who demands it be in there.</p>\n\n<p>You just happen to use a strong <em>\"salt\"</em>.</p>\n"}], "owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1592431372, "creation_date": 1564983334, "question_id": 57352676, "link": "https://stackoverflow.com/questions/57352676/bcrypt-in-go-with-kdf-for-specific-output-key-length", "title": "bcrypt in Go with KDF for specific output key-length", "body": "<p>It seems like the Go ecosystem just has a basic bcrypt implementation (golang.org/x/crypto/bcrypt) and it's left as an exercise for the developer to extract the key from the encoded output string to then further expand it to satisfy a particular key length if you're going to be using it as an encryption key rather than just storing it as a password in a DB somewhere. It confounds me that there don't seem to be any quick treatments of this concept online for Go or just in general.</p>\n\n<p>At the risk of introducing a bug by doing it myself, I suspect that I'm gonna be forced to use <em>scrypt</em>, where, at least in Go, it <em>does</em> take an output-length parameter.</p>\n\n<p>Am I missing something? Is there an implementation of <em>bcrypt</em> somewhere in Go that takes a key-length parameter and manages producing a key of acceptable length directly?</p>\n"}, {"tags": ["go", "apache-beam"], "comments": [{"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 2, "creation_date": 1564999786, "post_id": 57352611, "comment_id": 101199739, "body": "I feel that <a href=\"https://golang.org/pkg/encoding/json/#example_Decoder_Decode_stream\" rel=\"nofollow noreferrer\">this</a> example should help you. Could you show us where JSON records are returned by the pipeline? From there we should be able to find a solution."}], "answers": [{"tags": [], "owner": {"reputation": 121, "user_id": 11853614, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hRRQb.jpg?s=128&g=1", "display_name": "Dave Johnson", "link": "https://stackoverflow.com/users/11853614/dave-johnson"}, "is_accepted": true, "score": 2, "last_activity_date": 1565021394, "creation_date": 1565021394, "answer_id": 57362347, "question_id": 57352611, "link": "https://stackoverflow.com/questions/57352611/how-to-properly-transform-json-strings-to-objects/57362347#57362347", "title": "How to properly transform json strings to objects", "body": "<p>You're sort of on the right track. Go doesn't have \"objects\" in the normal sense of the word as it pertains to programming. You would use a struct like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    type User struct {\n        Name    string `json:\"name\"`\n        Age     int    `json:\"age\"`\n    }\n</code></pre>\n\n<p>You would use that to unmarshal into that structure like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    var myUser User\n    err := json.Unmarshal([]byte(`{\"name\": \"Bob\", \"age\": 32}`), &amp;myUser)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(myUser.Name, myUser.Age)\n</code></pre>\n\n<p>Here is a playground example: <a href=\"https://play.golang.org/p/_uHZ9Q_j-p1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_uHZ9Q_j-p1</a></p>\n\n<p>More information: <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">https://blog.golang.org/json-and-go</a></p>\n"}], "owner": {"reputation": 652, "user_id": 9726037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HtEYC.jpg?s=128&g=1", "display_name": "MichelDelpech", "link": "https://stackoverflow.com/users/9726037/micheldelpech"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 57362347, "answer_count": 1, "score": 0, "last_activity_date": 1565021394, "creation_date": 1564982860, "last_edit_date": 1564995065, "question_id": 57352611, "link": "https://stackoverflow.com/questions/57352611/how-to-properly-transform-json-strings-to-objects", "title": "How to properly transform json strings to objects", "body": "<p>I have a Beam pipeline written in Go and I'd like to transform this input:</p>\n\n<pre><code>{\"name\": \"Bob\", \"age\": 32}\n</code></pre>\n\n<p>to a valid \"object\".</p>\n\n<p>The go sdk has this function in the encoding package :</p>\n\n<pre><code>// UnmarshalJSON sets the state of this instance from the passed in JSON.\nfunc (w *EncodedType) UnmarshalJSON(buf []byte) error {\n    var s string\n    if err := json.Unmarshal(buf, &amp;s); err != nil {\n        return err\n    }\n    t, err := graphx.DecodeType(s)\n    if err != nil {\n        return err\n    }\n    w.T = t\n    return nil\n}\n</code></pre>\n\n<p>But I don't understand how to use it as a step of my pipeline.</p>\n"}, {"tags": ["go", "visual-studio-code", "go-templates"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565005984, "post_id": 57352156, "comment_id": 101202861, "body": "I don&#39;t use VSCode, but this looks like your editor thinks your <code>*.tmpl</code> file should be valid CSS and is complaining that it&#39;s not valid (which it isn&#39;t, it only becomes valid CSS once the template is executed). You either need a plug-in/setting that recognises Go template files (e.g. understands <code>{{\u2026}}</code>) or turn off syntax checking for <code>*.tmpl</code> files."}], "answers": [{"comments": [{"owner": {"reputation": 5170, "user_id": 552669, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a416a6caf0ac8f57a5f5460e6dba5c39?s=128&d=identicon&r=PG", "display_name": "Fran Verona", "link": "https://stackoverflow.com/users/552669/fran-verona"}, "edited": false, "score": 8, "creation_date": 1591624598, "post_id": 57495678, "comment_id": 110118513, "body": "Please note that this will affect all projects opened. In case you just want to turn off this setting for a particular workspace, you should create a folder called <code>.vscode</code> on the root of your project, then a file called <code>settings.json</code> inside, and add <code>&quot;html.validate.styles&quot;: true</code>. More info about this method can be found here: <a href=\"https://code.visualstudio.com/docs/getstarted/settings\" rel=\"nofollow noreferrer\">code.visualstudio.com/docs/getstarted/settings</a>"}], "tags": [], "owner": {"reputation": 456, "user_id": 7198753, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/201605203625626/picture?type=large", "display_name": "Nam L&#234; Qu&#253;", "link": "https://stackoverflow.com/users/7198753/nam-l%c3%aa-qu%c3%bd"}, "is_accepted": true, "score": 9, "last_activity_date": 1565789100, "creation_date": 1565789100, "answer_id": 57495678, "question_id": 57352156, "link": "https://stackoverflow.com/questions/57352156/error-property-value-expected-css-and-at-rule-or-selector-expected-css-editi/57495678#57495678", "title": "Error &quot;property value expected css&quot; and &quot;at-rule or selector expected css&quot; editing Go template in VSCode", "body": "<p>I have found solution. Turn off html validate styles in setting's vscode</p>\n\n<p><a href=\"https://i.stack.imgur.com/q5J40.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/q5J40.png\" alt=\"vscode disable validate style html\"></a></p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 12180508, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-42XnZRfXf2o/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reaf9d03EDxgNJhUPLLV-FgrUZ7Og/photo.jpg?sz=128", "display_name": "Alexandre Angrignon", "link": "https://stackoverflow.com/users/12180508/alexandre-angrignon"}, "is_accepted": false, "score": 1, "last_activity_date": 1610242636, "creation_date": 1610242636, "answer_id": 65649392, "question_id": 57352156, "link": "https://stackoverflow.com/questions/57352156/error-property-value-expected-css-and-at-rule-or-selector-expected-css-editi/65649392#65649392", "title": "Error &quot;property value expected css&quot; and &quot;at-rule or selector expected css&quot; editing Go template in VSCode", "body": "<p>Hi I fixed this this by installing the Django extension in VsCode</p>\n"}], "owner": {"reputation": 456, "user_id": 7198753, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/201605203625626/picture?type=large", "display_name": "Nam L&#234; Qu&#253;", "link": "https://stackoverflow.com/users/7198753/nam-l%c3%aa-qu%c3%bd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9283, "favorite_count": 1, "accepted_answer_id": 57495678, "answer_count": 2, "score": 5, "last_activity_date": 1610242636, "creation_date": 1564978791, "last_edit_date": 1565005785, "question_id": 57352156, "link": "https://stackoverflow.com/questions/57352156/error-property-value-expected-css-and-at-rule-or-selector-expected-css-editi", "title": "Error &quot;property value expected css&quot; and &quot;at-rule or selector expected css&quot; editing Go template in VSCode", "body": "<p>I'm using Go and package <code>html/template</code>. This is my code in <code>mypage.tmpl</code>:</p>\n\n<pre><code>&lt;div class=\"col-sm-1\"&gt;\n        &lt;i class='fas fa-square companies-color' style=\"color: {{.Company.Color}}\"&gt;&lt;/i&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>But I get errors in VSCode:</p>\n\n<blockquote>\n  <p>property value expected css(css-property value expected)</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>at-rule or selector expected css(css-rule selector expected)</p>\n</blockquote>\n\n<p>when I try <code>{{ }}</code> in style html.</p>\n\n<p><a href=\"https://i.stack.imgur.com/U7ePM.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/U7ePM.png\" alt=\"screen shot of VSCode error messages\"></a></p>\n"}, {"tags": ["go", "openapi-generator"], "answers": [{"tags": [], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "is_accepted": true, "score": 0, "last_activity_date": 1586552539, "last_edit_date": 1586552539, "creation_date": 1564977701, "answer_id": 57352054, "question_id": 57351996, "link": "https://stackoverflow.com/questions/57351996/how-do-i-get-access-to-http-error-body-using-a-openapi-generator-client-sdk/57352054#57352054", "title": "How do I get access to HTTP error body using a OpenAPI Generator Client SDK", "body": "<p>The generated client creates a <code>mypackage.GenericOpenAPIError</code> struct which is returned as an <code>error</code>, where <code>mypackage</code> is the package name of the client. It stores the HTTP error body in the <code>GenericOpenAPIError.body</code> property which can be accessed by the <code>Body() []byte</code> function. However, because function definition returns an <code>error</code> which does not support the <code>Body()</code> function the error needs to be cast before you can access it.</p>\n\n<p>Here's the code that creates the error from a generated client:</p>\n\n<pre><code>if localVarHttpResponse.StatusCode &gt;= 300 {\n    newErr := GenericOpenAPIError{\n        body:  localVarBody,\n        error: localVarHttpResponse.Status,\n    }\n</code></pre>\n\n<p>To access the body property, casting the error is needed. For example:</p>\n\n<pre><code>data, resp, err := myclient.MyAPI.OperationId(context.Background())\nif err != nil &amp;&amp; resp.StatusCode &gt;= 300 {\n    openAPIErr := err.(mypackage.GenericOpenAPIError)\n    fmt.Println(string(openAPIErr.Body()))\n}\n</code></pre>\n\n<p>Since this needs to be decoded into a struct in the generated client package, it would be useful to add this as a helper function in the client package.</p>\n"}], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "accepted_answer_id": 57352054, "answer_count": 1, "score": 1, "last_activity_date": 1586552539, "creation_date": 1564977162, "last_edit_date": 1564977926, "question_id": 57351996, "link": "https://stackoverflow.com/questions/57351996/how-do-i-get-access-to-http-error-body-using-a-openapi-generator-client-sdk", "title": "How do I get access to HTTP error body using a OpenAPI Generator Client SDK", "body": "<p><a href=\"https://github.com/OpenAPITools/openapi-generator\" rel=\"nofollow noreferrer\">OpenAPI Generator</a> creates API functions that follow the general pattern:</p>\n\n<p><code>func (api *MyAPI) OperationId(context.Context) (ResponseStruct, *http.Response, error)</code></p>\n\n<p>How can I retrieve the HTTP body on an error? When the HTTP Status Code is an error, <code>error</code> is not <code>nil</code>, however, it does not include the body and neither does <code>*http.Response</code> as the body has been read already. And, the error is not unmarshaled into the ResponseStruct as the success and failure definitions. are different.</p>\n"}, {"tags": ["go", "glide-golang"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1564977438, "post_id": 57351944, "comment_id": 101191761, "body": "<a href=\"https://play.golang.org/p/oPuThk4FvzQ\" rel=\"nofollow noreferrer\">The code compiles and runs in the playground</a>."}, {"owner": {"reputation": 371, "user_id": 10874122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e24aba718cf977adb110b9fccc495c?s=128&d=identicon&r=PG", "display_name": "Wicak", "link": "https://stackoverflow.com/users/10874122/wicak"}, "edited": false, "score": 1, "creation_date": 1564980637, "post_id": 57351944, "comment_id": 101192396, "body": "try go run *.go"}, {"owner": {"reputation": 19, "user_id": 5648266, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phNqC.jpg?s=128&g=1", "display_name": "Cosmo", "link": "https://stackoverflow.com/users/5648266/cosmo"}, "edited": false, "score": 1, "creation_date": 1564982730, "post_id": 57351944, "comment_id": 101192845, "body": "yes, it can work in playground, but why have trouble in vscode"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 371, "user_id": 10874122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e24aba718cf977adb110b9fccc495c?s=128&d=identicon&r=PG", "display_name": "Wicak", "link": "https://stackoverflow.com/users/10874122/wicak"}, "edited": false, "score": 1, "creation_date": 1565005065, "post_id": 57351944, "comment_id": 101202425, "body": "@Wicak <code>go run</code> with file names is mostly misused. For people that really want to use <code>go run</code> rather than <code>go build</code> or <code>go install</code> they they can use a package name argument (with recent versions of Go at least): <code>go run .</code> (The biggest difference is that this respects build tags, *<code>_test.go</code> files, etc where-as <code>go run *.go</code> will fail in many perfectly valid packages)."}, {"owner": {"reputation": 371, "user_id": 10874122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e24aba718cf977adb110b9fccc495c?s=128&d=identicon&r=PG", "display_name": "Wicak", "link": "https://stackoverflow.com/users/10874122/wicak"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1565010719, "post_id": 57351944, "comment_id": 101205533, "body": "Thanks @DaveC, i don&#39;t know this before. But most of answer i found, suggested to use go run *.go for solve the problems like this. Would you like give me more suggestion like article, etc about this problems ?"}, {"owner": {"reputation": 19, "user_id": 5648266, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phNqC.jpg?s=128&g=1", "display_name": "Cosmo", "link": "https://stackoverflow.com/users/5648266/cosmo"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565126956, "post_id": 57351944, "comment_id": 101252544, "body": "Thanks @DaveC\uff0cSo how to deal this problem?"}], "answers": [{"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 0, "last_activity_date": 1564982108, "creation_date": 1564982108, "answer_id": 57352514, "question_id": 57351944, "link": "https://stackoverflow.com/questions/57351944/cant-find-struct-in-a-same-package/57352514#57352514", "title": "can&#39;t find struct in a same package", "body": "<p>Actually, the language server sometimes crashes. Open the Command Palette and type \u201elanguage server\u201c. A command should be shown that says \u201erestart language server\u201c. Restarting VSCode might be sufficient.</p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 5664684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b415873156377dc469f4af713d6ab8e2?s=128&d=identicon&r=PG&f=1", "display_name": "tzJacky", "link": "https://stackoverflow.com/users/5664684/tzjacky"}, "is_accepted": false, "score": 0, "last_activity_date": 1617368879, "creation_date": 1617368879, "answer_id": 66919787, "question_id": 57351944, "link": "https://stackoverflow.com/questions/57351944/cant-find-struct-in-a-same-package/66919787#66919787", "title": "can&#39;t find struct in a same package", "body": "<p>In GoLand, you can change the Run kind from file to Package.</p>\n<p><a href=\"https://i.stack.imgur.com/gxyqz.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/gxyqz.jpg\" alt=\"enter image description here\" /></a></p>\n"}], "owner": {"reputation": 19, "user_id": 5648266, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phNqC.jpg?s=128&g=1", "display_name": "Cosmo", "link": "https://stackoverflow.com/users/5648266/cosmo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 697, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1617368879, "creation_date": 1564976537, "question_id": 57351944, "link": "https://stackoverflow.com/questions/57351944/cant-find-struct-in-a-same-package", "title": "can&#39;t find struct in a same package", "body": "<p>suddenly, vscode cannot get access struct in the same package,but different files. </p>\n\n<p>the error showed undefined struct</p>\n\n<p>Previously vscode was able to instantiate struct across files(vscode+go1.12.4)</p>\n\n<p>the sample code like this:</p>\n\n<p>file1 a.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\ntype su struct {\n    Sfd string\n    Sf  int\n}\n\nfunc (sed *su) do() {\n    fmt.Println(sed.Sfd + string(sed.Sf))\n}\n\n\n</code></pre>\n\n<p>file2 main.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    d := su{}\n    fmt.Println(d)\n}\n\n</code></pre>\n\n<p>these two files are in the same package</p>\n\n<p>have some one met the same problem?</p>\n"}, {"tags": ["mongodb", "go", "changestream"], "comments": [{"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1565132638, "post_id": 57351887, "comment_id": 101253930, "body": "Hello, welcome to StackOverflow. When <code>err</code> variable that is returned by <code>Watch</code> does not return <code>nil</code>, instead of just <code>return</code> please output that as <code>log.Fatal</code>. If you run the program again, now you should see an error message. Please add that error message to your question."}, {"owner": {"reputation": 1, "user_id": 10494369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LZDIb.jpg?s=128&g=1", "display_name": "Grace w. Maew", "link": "https://stackoverflow.com/users/10494369/grace-w-maew"}, "reply_to_user": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1565160810, "post_id": 57351887, "comment_id": 101259885, "body": "I just edit my question and error appear   2019/08/07 13:46:39 Failed to open client connection: topology is connected or connecting exit status 1"}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1565216384, "post_id": 57351887, "comment_id": 101287382, "body": "Great. Now, what version of <code>mongo-go-driver</code> are you using ? If you&#39;re using v1+, use <code>client, err := mongo.NewClient(options.Client().ApplyURI(&quot;mongodb:&#47;&#47;localho&zwnj;&#8203;st:27017&quot;))</code> instead of your <code>mongo.Connect</code>. Also, could you connect to MongoDB via <code>mongo</code> shell from the same machine ?"}, {"owner": {"reputation": 1, "user_id": 10494369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LZDIb.jpg?s=128&g=1", "display_name": "Grace w. Maew", "link": "https://stackoverflow.com/users/10494369/grace-w-maew"}, "reply_to_user": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1565236073, "post_id": 57351887, "comment_id": 101291057, "body": "My version is v1.1.0, and then I change to your suggest code and run, it start smoothy!!. So I try to add some data in mongo, it has some error like &quot;Decode error: argument to Decode must be a pointer to a type, but got {{}  { } { } {ObjectID(&quot;000000000000000000000000&quot;)}}&quot; and I fixed it with <code>cur.Decode(&amp;elem)</code> and it run without error anymore!! Thank you very much @WanBachtiar !!!"}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1565237202, "post_id": 57351887, "comment_id": 101291281, "body": "You&#39;re very welcome."}], "answers": [{"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 0, "last_activity_date": 1566871782, "creation_date": 1566871782, "answer_id": 57666880, "question_id": 57351887, "link": "https://stackoverflow.com/questions/57351887/mongodb-collection-watch-compile-and-stop-running/57666880#57666880", "title": "MongoDB collection.Watch() compile and stop running", "body": "<p>As mentioned on the comment, utilising <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">mongo-go-driver</a> v1+ a new <code>client</code> instance need to be created first before making a connection. For example: </p>\n\n<pre><code>clientOptions := options.Client().ApplyURI(\"mongodb://localhost:27017/test\")\nclient, err := mongo.NewClient(clientOptions)\nif err != nil {log.Fatal(err)}\n\n// Timed out after 10 seconds of trying to connect \nctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)\ndefer cancel()\n\nerr = client.Connect(ctx)\nif err != nil { log.Fatal(err)}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10494369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LZDIb.jpg?s=128&g=1", "display_name": "Grace w. Maew", "link": "https://stackoverflow.com/users/10494369/grace-w-maew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 188, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1566871782, "creation_date": 1564975999, "last_edit_date": 1565165537, "question_id": 57351887, "link": "https://stackoverflow.com/questions/57351887/mongodb-collection-watch-compile-and-stop-running", "title": "MongoDB collection.Watch() compile and stop running", "body": "<p>I'm newbie for MongoDB and I\u2019ve tried to use collection.Watch() from \"go.mongodb.org/mongo-driver/mongo\" lib. and code from <a href=\"https://github.com/minhthuy30197/change_stream/blob/master/main.go\" rel=\"nofollow noreferrer\">https://github.com/minhthuy30197/change_stream/blob/master/main.go</a>. Then I build and run it stop immediately.</p>\n\n<p>I\u2019ve tried to run again and again and it also stop running. I\u2019ve switch using between <code>go run main.go</code> and <code>./testStreams</code> and it still stop running</p>\n\n<p>So this is my edited code.</p>\n\n<pre><code>    clientOptions := options.Client().\n        ApplyURI(\"mongodb://localhost:27017/test\")\n\n    client, err := mongo.Connect(context.TODO(), clientOptions)\n    if err != nil {\n        log.Fatalf(\"Failed to create the new client: %v\", err)\n    }\n\n    ctx := context.Background()\n    if err := client.Connect(ctx); err != nil {\n        log.Printf(\"Failed to open client connection: %v\", err)\n    }\n    defer client.Disconnect(ctx)\n\n    coll := client.Database(\"test\").Collection(\"streams\")\n\n    var pipeline interface{}\n\n    for {\n        cur, err := coll.Watch(ctx, pipeline)\n        if err != nil {\n            log.Fatalf(\"Watch error: %v\", err)\n        }\n        defer cur.Close(ctx)\n        log.Println(cur)\n        for cur.Next(ctx) {\n            elem := CSElem{}\n            if err := cur.Decode(elem); err != nil {\n                log.Fatalf(\"Decode error: %v\", err)\n            }\n            log.Println(elem)\n        }\n        if err := cur.Err(); err != nil {\n            log.Fatalf(\"Error detected: %v\", err)\n        }\n    }\n</code></pre>\n\n<p>When I edit then error appear </p>\n\n<blockquote>\n  <p>2019/08/07 13:46:39 Failed to open client connection: topology is\n  connected or connecting exit status 1</p>\n</blockquote>\n\n<p>How should I fix??</p>\n"}, {"tags": ["mongodb", "go", "bigint"], "answers": [{"tags": [], "owner": {"reputation": 136, "user_id": 1120148, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7a50efc32c17fb182d769c6d8e0ea59?s=128&d=identicon&r=PG", "display_name": "Absurdev", "link": "https://stackoverflow.com/users/1120148/absurdev"}, "is_accepted": false, "score": 0, "last_activity_date": 1564959439, "creation_date": 1564959439, "answer_id": 57350741, "question_id": 57350305, "link": "https://stackoverflow.com/questions/57350305/how-to-store-golang-big-int-into-mongodb/57350741#57350741", "title": "How to store Golang big.Int into MongoDB", "body": "<p>Here's a possible implementation I came up with that stores the big.Int as plain text into MongoDb. It is also possible to easily store as byte array  by using methods <code>Bytes</code> and <code>SetBytes</code> of big.Int instead of <code>MarshalText</code>/<code>UnmarshalText</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package common\n\nimport (\n    \"fmt\"\n    \"math/big\"\n\n    \"go.mongodb.org/mongo-driver/bson\"\n)\n\ntype BigInt struct {\n    i *big.Int\n}\n\nfunc NewBigInt(bigint *big.Int) *BigInt {\n    return &amp;BigInt{i: bigint}\n}\n\nfunc (bi *BigInt) Int() *big.Int {\n    return bi.i\n}\nfunc (bi *BigInt) MarshalBSON() ([]byte, error) {\n    txt, err := bi.i.MarshalText()\n    if err != nil {\n        return nil, err\n    }\n    a, err := bson.Marshal(map[string]string{\"i\": string(txt)})\n    return a, err\n}\n\nfunc (bi *BigInt) UnmarshalBSON(data []byte) error {\n    var d bson.D\n    err := bson.Unmarshal(data, &amp;d)\n    if err != nil {\n        return err\n    }\n    if v, ok := d.Map()[\"i\"]; ok {\n        bi.i = big.NewInt(0)\n        return bi.i.UnmarshalText([]byte(v.(string)))\n    }\n    return fmt.Errorf(\"key 'i' missing\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 0, "last_activity_date": 1564971102, "creation_date": 1564971102, "answer_id": 57351510, "question_id": 57350305, "link": "https://stackoverflow.com/questions/57350305/how-to-store-golang-big-int-into-mongodb/57351510#57351510", "title": "How to store Golang big.Int into MongoDB", "body": "<blockquote>\n  <p>the field turns to be nil when fetching the struct back</p>\n</blockquote>\n\n<p>The reason why it returns 0, is because there is no <code>bson</code> mapping available for <a href=\"https://golang.org/pkg/math/big/#NewInt\" rel=\"nofollow noreferrer\">big.Int</a>. If you check the document inserted into MongoDB collection you should see something similar to below:</p>\n\n<pre><code>{\n  \"_id\": ObjectId(\"...\"),\n  \"number\": {}\n}\n</code></pre>\n\n<p>Where there is no value stored in <code>number</code> field. </p>\n\n<blockquote>\n  <p>What is the proper/best way to store a big.Int into MongoDB?</p>\n</blockquote>\n\n<p>Let's first understand what <code>BigInt</code> is. Big integer data type is intended for use when integer values might exceed the range that is supported by the int data type. The range is -2^63 (-9,223,372,036,854,775,808) to 2^63-1 (9,223,372,036,854,775,807) with storage size of 8 bytes. Generally this is used in <a href=\"https://docs.microsoft.com/en-us/sql/t-sql/data-types/int-bigint-smallint-and-tinyint-transact-sql?view=sql-server-2017\" rel=\"nofollow noreferrer\">SQL</a>. </p>\n\n<p>In Go, you can use a more precise integer types. Available <a href=\"https://golang.org/pkg/builtin/\" rel=\"nofollow noreferrer\">built-in types</a> int8, int16, int32, and int64 (and their unsigned counterparts) are best suited for data. The counterparts for big integer in Go is <a href=\"https://golang.org/pkg/builtin/#int64\" rel=\"nofollow noreferrer\">int64</a>. With range -9,223,372,036,854,775,808 through 9,223,372,036,854,775,807, and storage size of 8 bytes. </p>\n\n<p>Using <a href=\"https://godoc.org/go.mongodb.org/mongo-driver\" rel=\"nofollow noreferrer\">mongo-go-driver</a>,you can just use <code>int64</code> which will be converted to <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson#RawValue.Int64\" rel=\"nofollow noreferrer\">bson RawValue.Int64</a>. For example: </p>\n\n<pre><code>type MyStruct struct {\n    Number  int64\n}\n\ncollection := db.Collection(\"tests\")\nnb := MyStruct{Number: int64(42)}\nr, _ := collection.InsertOne(context.TODO(), nb)\n\nvar result MyStruct\ncollection.FindOne(context.TODO(), bson.D{{\"_id\", r.InsertedID}}).Decode(&amp;result)\n</code></pre>\n"}], "owner": {"reputation": 136, "user_id": 1120148, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7a50efc32c17fb182d769c6d8e0ea59?s=128&d=identicon&r=PG", "display_name": "Absurdev", "link": "https://stackoverflow.com/users/1120148/absurdev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 829, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1564971102, "creation_date": 1564953766, "last_edit_date": 1564956746, "question_id": 57350305, "link": "https://stackoverflow.com/questions/57350305/how-to-store-golang-big-int-into-mongodb", "title": "How to store Golang big.Int into MongoDB", "body": "<p>I have a struct referencing a *big.Int. When storing this struct naively into MongoDB (using the official driver) the field turns to be nil when fetching the struct back. What is the proper/best way to store a big.Int into MongoDB?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    type MyStruct struct {\n        Number *big.Int\n    }\n\n    nb := MyStruct{Number: big.NewInt(42)}\n    r, _ := db.Collection(\"test\").InsertOne(context.TODO(), nb)\n\n    result := &amp;MyStruct{}\n    db.Collection(\"test\").FindOne(context.TODO(), bson.D{{\"_id\", r.InsertedID}}).Decode(result)\n    fmt.Println(result) // &lt;== Number will be 0 here\n</code></pre>\n\n<p>My best idea so far would be to create a wrapper around big.Int that implements <code>MarshalBSON</code> and <code>UnmarshalBSON</code> (which I am not even sure how to do properly to be honest). But that'd be quite inconvenient.</p>\n"}, {"tags": ["go", "struct", "google-analytics-api", "object-slicing"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1564948460, "post_id": 57349748, "comment_id": 101187312, "body": "<code>&amp;[]*analyticsreporting.DateRange{{StartDate: start, EndDate: end}}</code>. And replace <code>analyticsreporting</code> with <code>ga</code> if you renamed the import."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1564948747, "post_id": 57349748, "comment_id": 101187381, "body": "... for more details see <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">link</a>."}, {"owner": {"reputation": 2069, "user_id": 3878063, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/r1oB4.png?s=128&g=1", "display_name": "MarkeD", "link": "https://stackoverflow.com/users/3878063/marked"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1564949204, "post_id": 57349748, "comment_id": 101187472, "body": "Thanks!  It was <code>daterangep := []*ga.DateRange{{StartDate: start, EndDate: end}}</code>  not including the <code>&amp;</code>  but compiler happy now - please do add ytour answer so I can accept it :)"}, {"owner": {"reputation": 2069, "user_id": 3878063, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/r1oB4.png?s=128&g=1", "display_name": "MarkeD", "link": "https://stackoverflow.com/users/3878063/marked"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565020692, "post_id": 57349748, "comment_id": 101210906, "body": "Looks like my Q got voted down because this was VERY basic, apparently."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1564950050, "creation_date": 1564950050, "answer_id": 57349963, "question_id": 57349748, "link": "https://stackoverflow.com/questions/57349748/how-to-init-a-struct-that-includes-a-slice-for-google-auto-generated-lib/57349963#57349963", "title": "How to init a struct that includes a slice for Google auto generated lib", "body": "<p>To initialize a slice you can use a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">literal</a>:</p>\n\n<pre><code>daterangep := []*ga.DateRange{{StartDate: start, EndDate: end}}\n</code></pre>\n\n<p>You can use <a href=\"https://golang.org/ref/spec#Making_slices_maps_and_channels\" rel=\"nofollow noreferrer\"><code>make</code></a>:</p>\n\n<pre><code>daterangep := make([]*ga.DateRange, 1)\ndaterangep[0] = &amp;ga.DateRange{StartDate: start, EndDate: end}\n</code></pre>\n\n<p>Or you can declare it and then use <a href=\"https://golang.org/ref/spec#Appending_and_copying_slices\" rel=\"nofollow noreferrer\"><code>append</code></a>:</p>\n\n<pre><code>var daterangep []*ga.DateRange\ndaterangep = append(daterangep, &amp;ga.DateRange{StartDate: start, EndDate: end})\n</code></pre>\n"}], "owner": {"reputation": 2069, "user_id": 3878063, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/r1oB4.png?s=128&g=1", "display_name": "MarkeD", "link": "https://stackoverflow.com/users/3878063/marked"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 57349963, "answer_count": 1, "score": -1, "last_activity_date": 1564955102, "creation_date": 1564948160, "last_edit_date": 1564955102, "question_id": 57349748, "link": "https://stackoverflow.com/questions/57349748/how-to-init-a-struct-that-includes-a-slice-for-google-auto-generated-lib", "title": "How to init a struct that includes a slice for Google auto generated lib", "body": "<p>I'm trying to make a Google Analytics Go library based off the auto generated package generated <a href=\"https://godoc.org/google.golang.org/api/analyticsreporting/v4#ReportRequest\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>I have authenticated, got account summaries etc. so all is well until I try to construct a reporting request.</p>\n\n<p>I am trying to init a struct ReportRequest that has the following:</p>\n\n<pre><code>type ReportRequest struct {\n\n    DateRanges []*DateRange `json:\"dateRanges,omitempty\"`\n\n    ...etc\n}\n</code></pre>\n\n<p>How can I made a function that wraps this struct so I can pass in the values?  Consulting the <a href=\"https://godoc.org/google.golang.org/api/analyticsreporting/v4#DateRange\" rel=\"nofollow noreferrer\">DateRange struct</a>\n it seems simple enough, but I get messages about not passing in a slice pointer to DateRange which I can't figure out how to construct.</p>\n\n<p>I have tried this:</p>\n\n<pre><code>func makeRequest(\n    start, end string) *ga.GetReportsRequest {\n\n    daterangep := &amp;ga.DateRange{StartDate: start, EndDate: end}\n\n    requests := ga.ReportRequest{}\n    requests.DateRanges = daterangep\n</code></pre>\n\n<p>But get a compiler error:</p>\n\n<pre><code>cannot use daterangep (type *analyticsreporting.DateRange) as type []*analyticsreporting.DateRange in assignment\n</code></pre>\n\n<p>Is it possible to send in JSON?  I see some MarshalJSON functions that I don't know if I can use,and the json declaration in the object but I'd prefer to be able to use Go objects.</p>\n\n<p>Can anyone point to what I'm doing wrong?</p>\n"}, {"tags": ["docker", "go", "jenkins", "alpine"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1564936877, "post_id": 57348268, "comment_id": 101184510, "body": "<code>GOPATH=&#47;home&#47;jenkins&#47;workspace&#47;go test</code> the trailing ` test` looks suspicious."}, {"owner": {"reputation": 43155, "user_id": 1530814, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/HVI8Z.jpg?s=128&g=1", "display_name": "Idan Adar", "link": "https://stackoverflow.com/users/1530814/idan-adar"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1564938346, "post_id": 57348268, "comment_id": 101184882, "body": "That was it. sigh... removed the spaces..."}], "owner": {"reputation": 43155, "user_id": 1530814, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/HVI8Z.jpg?s=128&g=1", "display_name": "Idan Adar", "link": "https://stackoverflow.com/users/1530814/idan-adar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 246, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1564937740, "creation_date": 1564935900, "last_edit_date": 1564937740, "question_id": 57348268, "link": "https://stackoverflow.com/questions/57348268/go-not-found-in-docker-based-jenkins-agent", "title": "Go not found in Docker-based Jenkins agent", "body": "<p>I have created a Docker-based Jenkins agent that uses <code>docker:stable-dind</code> (which is based on Alpine 3.10) as its base. <a href=\"https://pastebin.com/mw6HQEV5\" rel=\"nofollow noreferrer\">Full Dockerfile</a>.</p>\n\n<p>In the Dockerfile I install Go: <code>RUN apk add go</code></p>\n\n<p>When running locally, e.g. <code>go version</code>, <code>go env GOROOT</code>, etc... I get results, e.g. <code>1.12.6</code>, <code>/usr/lib/go</code>.</p>\n\n<p>I then attempt using this agent in Jenkins, and print <code>env</code> to verify the above environment variables are, but they not there and also <code>go version</code> fails`.</p>\n\n<p>So, I update the Docker agent template in Jenkins with:</p>\n\n<ul>\n<li><code>GOROOT</code>: <code>/usr/lib/go</code></li>\n<li><code>PATH</code>:<code>/bin/sonar-scanner/bin/:/usr/local/bin:$GOROOT/bin:$PATH</code></li>\n</ul>\n\n<p>Now when checking <code>env</code> they are there...</p>\n\n<pre><code>GOROOT=/usr/lib/go\nPATH=/bin/sonar-scanner/bin/:/usr/local/bin:/usr/lib/go/bin:/bin:/usr/bin:/sbin:/usr/sbin\nGOPATH=/home/jenkins/workspace/go test\n</code></pre>\n\n<p>... but <code>go version</code> still fails.</p>\n\n<p><code>GOPATH</code> is set to the current <code>$WORKSPACE</code> as that's where I will clone the Go project source if this actually works.</p>\n\n<p>This is the Jenkins job: </p>\n\n<pre><code>#!groovy\n\npipeline {\n  agent {\n    label 'cli-agent'\n  }\n\n  stages {\n    stage (\"test\") {\n      steps {\n        script {\n          withEnv([\"GOPATH=${WORKSPACE}\"]) {\n             sh \"\"\"\n                env\n                go version\n             \"\"\"\n          }\n        }\n      }\n    }\n  }\n}\n</code></pre>\n"}, {"tags": ["templates", "authentication", "go", "precompile", "compiled-language"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1564930159, "post_id": 57347440, "comment_id": 101182791, "body": "Is there a problem you need solved, or you&#39;re just looking for general code review?"}, {"owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1564931225, "post_id": 57347440, "comment_id": 101183049, "body": "Code review, better ways of doing things, ideas, pointers or not... Something like that. SO is for this kind of stuff too, or am I wrong?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1564931496, "post_id": 57347440, "comment_id": 101183135, "body": "On SO, we expect questions to be more about a specific problem. For more open-ended code review, try <a href=\"https://codereview.stackexchange.com/\">Code Review.SE</a>."}, {"owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1564932449, "post_id": 57347440, "comment_id": 101183385, "body": "Opened, thanks: <a href=\"https://codereview.stackexchange.com/questions/225525/precompiled-templates-with-initializators-factory-pattern-or-single-interface\" title=\"precompiled templates with initializators factory pattern or single interface\">codereview.stackexchange.com/questions/225525/&hellip;</a> But I hope you can answer this too please. Thanks."}], "owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1564929292, "creation_date": 1564929292, "question_id": 57347440, "link": "https://stackoverflow.com/questions/57347440/precompiled-templates-with-initializators-factory-pattern-or-single-interface", "title": "Precompiled templates with initializators (factory pattern) or single interface and method or what else?", "body": "<h3>PROBLEM</h3>\n\n<p>I'm trying to use <strong>authboss</strong> (<a href=\"https://github.com/volatiletech/authboss\" rel=\"nofollow noreferrer\">https://github.com/volatiletech/authboss</a>) with quicktemplate (<a href=\"https://github.com/valyala/quicktemplate\" rel=\"nofollow noreferrer\">https://github.com/valyala/quicktemplate</a>).</p>\n\n<p>The authboss rendering system is defined by one interface: <a href=\"https://godoc.org/github.com/volatiletech/authboss/#Renderer\" rel=\"nofollow noreferrer\">Renderer</a>.</p>\n\n<p>I have created two different versions of the solution and would like to know which one is best <strong>or if there is a third one better</strong>.</p>\n\n<ol>\n<li><p><a href=\"https://github.com/frederikhors/authbossQuicktemplate_1\" rel=\"nofollow noreferrer\">https://github.com/frederikhors/authbossQuicktemplate_1</a>, with factory pattern and initializators</p></li>\n<li><p><a href=\"https://github.com/frederikhors/authbossQuicktemplate_2\" rel=\"nofollow noreferrer\">https://github.com/frederikhors/authbossQuicktemplate_2</a>, with interface and a <code>SetData(data authboss.HTMLData) (page PageImpl)</code> method</p></li>\n</ol>\n\n<h3>QUESTIONS</h3>\n\n<p>I don't know what to improve for performances.</p>\n\n<ul>\n<li><p>Is it possible to do the same thing differently and less in terms of hardware resources?</p></li>\n<li><p>Do you think I can improve using pointers somewhere?</p></li>\n</ul>\n\n<h3>RELEVANT CODE</h3>\n\n<ol>\n<li><p>Solution with Factory pattern and initializators:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type HTML struct {\n  templates map[string]func(authboss.HTMLData) templates.PageImpl\n}\n\nfunc (h *HTML) Load(names ...string) error {\n  for _, n := range names {\n    switch n {\n    case \"login\":\n      h.templates[n] = InitializeLoginPage\n    case \"recover\":\n      h.templates[n] = InitializeRecoverPage\n    }\n  }\n  return nil\n}\n\nfunc (h *HTML) Render(ctx context.Context, page string, data authboss.HTMLData) (output []byte, contentType string, err error) {\n  buf := &amp;bytes.Buffer{}\n  tpl, ok := h.templates[page]\n  if !ok {\n    return nil, \"\", errors.Errorf(\"template for page %s not found\", page)\n  }\n  templates.WritePage(buf, tpl(data))\n  return buf.Bytes(), \"text/html\", nil\n}\n\nfunc InitializeLoginPage(data authboss.HTMLData) templates.PageImpl {\n  return &amp;templates.LoginPage{Data: data}\n}\n\nfunc InitializeRecoverPage(data authboss.HTMLData) templates.PageImpl {\n  return &amp;templates.RecoverPage{Data: data}\n}\n</code></pre></li>\n<li><p>Solution with interface with a method</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type HTML struct {\n  templates map[string]templates.AuthPageImpl\n}\n\nfunc (h *HTML) Load(names ...string) error {\n  for _, n := range names {\n    switch n {\n    case \"login\":\n      h.templates[n] = &amp;templates.LoginPage{}\n    case \"recover\":\n      h.templates[n] = &amp;templates.RecoverPage{}\n    }\n  }\n  return nil\n}\n\nfunc (h *HTML) Render(ctx context.Context, page string, data authboss.HTMLData) (output []byte, contentType string, err error) {\n  buf := &amp;bytes.Buffer{}\n  tpl, ok := h.templates[page]\n  if !ok {\n    return nil, \"\", errors.Errorf(\"template for page %s not found\", page)\n  }\n  template := tpl.SetData(data)\n  templates.WritePage(buf, template)\n  return buf.Bytes(), \"text/html\", nil\n}\n\ntype AuthPageImpl interface {\n  SetData(data authboss.HTMLData) PageImpl\n}\n\ntype LoginPage struct {\n  Data authboss.HTMLData\n}\n\ntype RecoverPage struct {\n  Data authboss.HTMLData\n}\n\nfunc (p *LoginPage) SetData(data authboss.HTMLData) (page PageImpl) {\n  p.Data = data\n  return p\n}\n\nfunc (p *RecoverPage) SetData(data authboss.HTMLData) PageImpl {\n  p.Data = data\n  return p\n}\n</code></pre></li>\n</ol>\n"}, {"tags": ["go", "amazon-s3", "aws-sdk-go"], "answers": [{"tags": [], "owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "is_accepted": true, "score": 1, "last_activity_date": 1564927749, "creation_date": 1564927749, "answer_id": 57347250, "question_id": 57346922, "link": "https://stackoverflow.com/questions/57346922/use-path-style-amazon-aws-sdk-go/57347250#57347250", "title": "Use path-style amazon aws sdk go", "body": "<p>In the <code>aws.Config</code> set the <code>S3ForcePathStyle</code> to <code>true</code>, ie</p>\n\n<pre><code>ses, err := session.NewSession(\n   &amp;aws.Config{\n      S3ForcePathStyle: aws.Bool(true),\n      ...\n   }\n)\n</code></pre>\n"}], "owner": {"reputation": 1081, "user_id": 1185148, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/bhzy9.jpg?s=128&g=1", "display_name": "meshkati", "link": "https://stackoverflow.com/users/1185148/meshkati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 57347250, "answer_count": 1, "score": 1, "last_activity_date": 1564927749, "creation_date": 1564924935, "question_id": 57346922, "link": "https://stackoverflow.com/questions/57346922/use-path-style-amazon-aws-sdk-go", "title": "Use path-style amazon aws sdk go", "body": "<p>I'm using some aws-sdk-go functionalities in my app, and it creates DNS  style hosts to request, like <code>somebucket.mys3.com</code>. But I have some DNS issues and want to receive the requests in path-style, like <code>mys3.com/somebucket</code>. How can I config the SDK to generates it requests in path-style mode?</p>\n"}, {"tags": ["go", "ssh"], "answers": [{"tags": [], "owner": {"reputation": 599, "user_id": 1115751, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c0b12c4d421141dd9a881cdab13cd350?s=128&d=identicon&r=PG", "display_name": "Waqas", "link": "https://stackoverflow.com/users/1115751/waqas"}, "is_accepted": false, "score": 0, "last_activity_date": 1564992463, "creation_date": 1564992463, "answer_id": 57354547, "question_id": 57346177, "link": "https://stackoverflow.com/questions/57346177/using-existing-ssh-connection-to-connect-to-remote-host/57354547#57354547", "title": "Using existing SSH connection to connect to remote host", "body": "<pre><code>conn2, err := conn.Dial(\"tcp\", router+\":22\")\nif err != nil {\n    log.Println(err)\n}\n\nconn3, chans, reqs, err := ssh.NewClientConn(conn2, router+\":22\", routerConfig)\nif err != nil {\n    log.Println(err)\n}\n\nconn4 := ssh.NewClient(conn3, chans, reqs)\n</code></pre>\n\n<p>conn4 is the new connection.</p>\n"}], "owner": {"reputation": 599, "user_id": 1115751, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c0b12c4d421141dd9a881cdab13cd350?s=128&d=identicon&r=PG", "display_name": "Waqas", "link": "https://stackoverflow.com/users/1115751/waqas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1564992463, "creation_date": 1564918386, "last_edit_date": 1564921998, "question_id": 57346177, "link": "https://stackoverflow.com/questions/57346177/using-existing-ssh-connection-to-connect-to-remote-host", "title": "Using existing SSH connection to connect to remote host", "body": "<p>I was previously using <a href=\"https://asyncssh.readthedocs.io/en/stable/api.html#asyncssh.SSHClientConnection\" rel=\"nofollow noreferrer\">asyncssh</a> for python. It has a feature that you can provide an already available connection to connect to a new host. I am looking into the ssh documentation. I don't see any option that can do this trick, not sure if I have to do some tunneling manually.</p>\n\n<p>What I want is to connect to a machine using SSH that has auth, then use that connection to connect to another machine that has different auth then the first machine.</p>\n\n<pre><code>ncmConfig := &amp;ssh.ClientConfig{\n    User:            \"xyz\",\n    HostKeyCallback: ssh.InsecureIgnoreHostKey(),\n    Auth: []ssh.AuthMethod{\n        ssh.Password(\"xyz!\"),\n    },\n}\n\nrouterConfig := &amp;ssh.ClientConfig{\n    User:            \"xyz1\",\n    HostKeyCallback: ssh.InsecureIgnoreHostKey(),\n    Auth: []ssh.AuthMethod{\n        ssh.Password(\"xyz2\"),\n    },\n}\nncm := \"1.1.1.1\"\nrouter := \"2.2.2.2\nconn, err := ssh.Dial(\"tcp\", ncm+\":22\", ncmConfig)\nif err != nil {\n    log.Println(err)\n}\n\n# how can I use the conn to connect to a new machine.\n</code></pre>\n"}, {"tags": ["go", "delve"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1564949128, "post_id": 57346098, "comment_id": 101187456, "body": "The <code>g</code> is a goroutine. However, there may not be anyone actually reading the channel at the time your goroutine <i>writes</i> to the channel. You&#39;re probably better off setting a breakpoint in whichever goroutine is-or-will-be reading from the channel, at or near the line of code that contains a request to read from the channel."}, {"owner": {"reputation": 304, "user_id": 945063, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/522c88facde8ba67dd5cfacfe252cab5?s=128&d=identicon&r=PG", "display_name": "juzna.cz", "link": "https://stackoverflow.com/users/945063/juzna-cz"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1574968150, "post_id": 57346098, "comment_id": 104423707, "body": "That&#39;s the problem I&#39;m trying to solve - figuring out which goroutine will be reading from the channel. The code is too complex to figure it out reasonably quickly."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1574980869, "post_id": 57346098, "comment_id": 104426971, "body": "The problem is not solveable in general: if the channel is buffered, perhaps <i>no</i> goroutine is trying to read from it right now. If it&#39;s unbuffered, the channel-send operation will block unless it&#39;s a nonblocking send (part of a select) and you could see which goroutine(s) are the reason it isn&#39;t blocking, but if there is more than one, there&#39;s no guarantee that one <i>specific</i> one of these blocked goroutines is the one that will wind up unblocked as a result. (The actual code, IIRC, will use a wakeup or notewakeup and it&#39;s the wakeup that will reschedule the sleeper[s].)"}], "owner": {"reputation": 304, "user_id": 945063, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/522c88facde8ba67dd5cfacfe252cab5?s=128&d=identicon&r=PG", "display_name": "juzna.cz", "link": "https://stackoverflow.com/users/945063/juzna-cz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1564917904, "creation_date": 1564917512, "last_edit_date": 1564917904, "question_id": 57346098, "link": "https://stackoverflow.com/questions/57346098/how-to-set-a-breakpoint-on-a-channel-read-write", "title": "How to set a breakpoint on a channel read/write", "body": "<p>I'm trying to understand behaviour of a Go program, so I'm running it in a debugger (delve). I can trace the execution flow easily, until it hits a loop which sends data to a channel.</p>\n\n<p>I'm trying to figure out what code is reading from the channel, i.e. what will be executed once the write happens. Is it possible to figure out? Is it possible to set a breakpoint on read from that channel?</p>\n\n<p>I tried inspecting the channel's internals (<code>hchan</code>) in debugger. I can see it has a <code>recvq</code> and <code>sendq</code> fields, which point to a <code>runtime.sudog</code> and <code>runtime.g</code> structs with some runtime internals including a <code>pc</code> or Program Counter. However, from that I can't figure out where is the code is.</p>\n"}, {"tags": ["go", "naming-conventions", "idioms"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1564916309, "post_id": 57345882, "comment_id": 101179817, "body": "Possible duplicate <a href=\"https://stackoverflow.com/q/14426366/13860\">stackoverflow.com/q/14426366/13860</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1564918213, "post_id": 57345882, "comment_id": 101180233, "body": "I will correct the terminology, but the question is not a duplicate of the mentioned one (especially regarding naming conventions)."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1564919979, "post_id": 57345882, "comment_id": 101180593, "body": "<i>&quot;Are there any official conventions, especially regarding the naming?&quot;</i> The only official documentation on naming conventions, that I know of, can be found <a href=\"https://golang.org/doc/effective_go.html#names\" rel=\"nofollow noreferrer\">here</a>. No special mention on naming constants though, so you&#39;re free to choose the naming approach that best suits your need."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1564919984, "post_id": 57345882, "comment_id": 101180594, "body": "<i>&quot;... so I can not remark any advantage.&quot;</i> You can put methods on your type, you cannot do the same with types you haven&#39;t declared yourself, e.g. <code>string</code>. For example <a href=\"https://golang.org/doc/effective_go.html#constants\" rel=\"nofollow noreferrer\">this code</a> couldn&#39;t implement the stringer interface if it used <code>float64</code> directly as the type of the enums."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1564920625, "post_id": 57345882, "comment_id": 101180703, "body": "Possible duplicate: <a href=\"https://stackoverflow.com/q/22688906/13860\">stackoverflow.com/q/22688906/13860</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1564921104, "post_id": 57345882, "comment_id": 101180781, "body": "The stdlib uses untyped string consts <a href=\"https://golang.org/pkg/net/http/#pkg-constants\" rel=\"nofollow noreferrer\">all</a> <a href=\"https://golang.org/pkg/os/#pkg-constants\" rel=\"nofollow noreferrer\">over</a> <a href=\"https://golang.org/pkg/net/rpc/#pkg-constants\" rel=\"nofollow noreferrer\">the</a> <a href=\"https://golang.org/pkg/time/#pkg-constants\" rel=\"nofollow noreferrer\">place</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1564921422, "post_id": 57345882, "comment_id": 101180836, "body": "Are you aware of <a href=\"https://godoc.org/golang.org/x/text/language\" rel=\"nofollow noreferrer\">x/text/language</a>? It doesn&#39;t answer your actual question, but may obviate it. When dealing with languages, this package would provide the most idiomatic and standard way of using language tags."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1564923988, "post_id": 57345882, "comment_id": 101181376, "body": "Thanks for the quick responses! @Flimzy Yes, it isn&#39;t. But &quot;LanguageEnglish&quot; is constructed by the same naming scheme as &quot;StatusOK&quot;."}, {"owner": {"reputation": 363, "user_id": 5040388, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-smIq4fgpQ34/AAAAAAAAAAI/AAAAAAAAABE/e5qpViT4k8Y/photo.jpg?sz=128", "display_name": "tetafro", "link": "https://stackoverflow.com/users/5040388/tetafro"}, "edited": false, "score": 0, "creation_date": 1564939628, "post_id": 57345882, "comment_id": 101185202, "body": "You shouldn&#39;t use <code>Language(&quot;en&quot;)</code> if you have a type for your constants. Typically you use <code>switch</code>, so you won&#39;t get arbitrary string for <code>Language</code> type."}], "owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1564924584, "creation_date": 1564915236, "last_edit_date": 1564924584, "question_id": 57345882, "link": "https://stackoverflow.com/questions/57345882/idiomatic-representation-of-related-string-constants", "title": "Idiomatic representation of related string constants", "body": "<p>I am not certain in which way I should represent related string constants, namely language codes, in Go.</p>\n\n<ol>\n<li><p>The <a href=\"https://golang.org/src/net/http/status.go\" rel=\"nofollow noreferrer\">only occurrence</a> in the standard library, of which I am aware, uses untyped string constants and prefixes the variable names with the \"type\".</p>\n\n<pre><code>const LanguageEnglish = \"en\"\n</code></pre></li>\n<li><p>There is the possibility to declare an extra type.</p>\n\n<pre><code>type Language string \n\nconst English Language = \"en\"\n// or\nconst LanguageEnglish Language = \"en\"\n</code></pre>\n\n<p>But any arbitrary string can be converted to the type anyways, so I can not remark any advantage.</p>\n\n<pre><code>Language(\"en\")\n</code></pre></li>\n</ol>\n\n<p>Essentially two questions arose from the prior observations:</p>\n\n<ol>\n<li><p>Should the string constants\u2019 names be prefixed by their \"type\"?</p></li>\n<li><p>What are the benefits of using a custom type in contrast to untyped\nstring constants?</p></li>\n</ol>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 2596, "user_id": 204610, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/fb06ba469e4be31b6991ebe6dc34c228?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/204610/michael"}, "edited": false, "score": 0, "creation_date": 1564897462, "post_id": 57344095, "comment_id": 101176303, "body": "Could you perhaps references where you found this? (a link)"}, {"owner": {"reputation": 366, "user_id": 3583193, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/868b480fcbd31b99f14ff8e317f17c1f?s=128&d=identicon&r=PG&f=1", "display_name": "DeshErBojhaa", "link": "https://stackoverflow.com/users/3583193/desherbojhaa"}, "reply_to_user": {"reputation": 2596, "user_id": 204610, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/fb06ba469e4be31b6991ebe6dc34c228?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/204610/michael"}, "edited": false, "score": 1, "creation_date": 1564897589, "post_id": 57344095, "comment_id": 101176320, "body": "I took the reference from a book named <code>concurrency in go</code>. the code can be found here: <a href=\"https://github.com/kat-co/concurrency-in-go-src/blob/master/concurrency-patterns-in-go/the-bridge-channel/fig-bridge-channel.go\" rel=\"nofollow noreferrer\">github.com/kat-co/concurrency-in-go-src/blob/master/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 2, "last_activity_date": 1564898385, "creation_date": 1564898385, "answer_id": 57344196, "question_id": 57344095, "link": "https://stackoverflow.com/questions/57344095/reading-from-a-stream-of-go-channels/57344196#57344196", "title": "Reading from a stream of go channels", "body": "<p>In both cases, the select is done to avoid blocking \u2014 if the reader isn't reading from our output channel, the write might block (maybe even forever), but we want the goroutine to terminate when the <code>done</code> channel is closed, without waiting for anything else. By using the <code>select</code>, it will wait until <em>either</em> thing happens, and then continue, instead of waiting indefinitely for the write to complete before checking <code>done</code>.</p>\n\n<p>As for the other question, \"why are we not returning here?\": well, we <em>could</em>. But we don't <em>have to</em>, because a closed channel remains readable forever (producing an unlimited number of zero values) once it's been closed. So it's okay to do nothing in those \"bottom\" <code>selects</code>; if <code>done</code> was in fact closed we will go back up to the top of the loop and hit the <code>case &lt;-done: return</code> there. I suppose it's a matter of style. I probably would have written the <code>return</code> myself, but the author of this sample may have wanted to avoid handling the same condition in two places. As long as it's just <code>return</code> it doesn't really matter, but if you wanted to do some <em>additional</em> action on <code>done</code>, that behavior would have to be updated in two places if the bottom select returns, but only in one place if it doesn't.</p>\n"}, {"tags": [], "owner": {"reputation": 1024, "user_id": 2702306, "user_type": "registered", "accept_rate": 32, "profile_image": "https://i.stack.imgur.com/FlJhs.jpg?s=128&g=1", "display_name": "IhtkaS", "link": "https://stackoverflow.com/users/2702306/ihtkas"}, "is_accepted": false, "score": 0, "last_activity_date": 1564898584, "creation_date": 1564898584, "answer_id": 57344215, "question_id": 57344095, "link": "https://stackoverflow.com/questions/57344095/reading-from-a-stream-of-go-channels/57344215#57344215", "title": "Reading from a stream of go channels", "body": "<p>Fist I will explain the usage of done channel. It's a common pattern followed in many concurrency related package implementation in Go. Done channels purpose is to denote the end of computation or more like a stop signal. Usually done channel will be listened by many go-routines or multiple places in code flow. One such example is Done channel in <a href=\"https://golang.org/pkg/context/#Context\" rel=\"nofollow noreferrer\">Go's builtin \"context\" package</a>. Since Go doesn't have anything like broadcast ie., to signal all listeners of a channel (expecting this feature is not a good idea too), people just close the channel and all listeners will receive nil value. In your case, since the second select statement is in the end of for block, the code owner might have decided to just continue the loop so that on next iteration, the first select statement which listens on done channel will return from the function. </p>\n"}], "owner": {"reputation": 366, "user_id": 3583193, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/868b480fcbd31b99f14ff8e317f17c1f?s=128&d=identicon&r=PG&f=1", "display_name": "DeshErBojhaa", "link": "https://stackoverflow.com/users/3583193/desherbojhaa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 57344196, "answer_count": 2, "score": 0, "last_activity_date": 1564898584, "creation_date": 1564896886, "last_edit_date": 1592644375, "question_id": 57344095, "link": "https://stackoverflow.com/questions/57344095/reading-from-a-stream-of-go-channels", "title": "Reading from a stream of go channels", "body": "<p>I was trying to understand the following piece of code that reads from a channel of channels. I am having some difficulties wrapping my head around the idea.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>    bridge := func(done &lt;-chan interface{}, chanStream &lt;-chan &lt;-chan interface{}) &lt;-chan interface{} {\n        outStream := make(chan interface{})\n        go func() {\n            defer close(outStream)\n            for {\n                var stream &lt;-chan interface{}\n                select {\n                case &lt;-done:\n                    return\n                case maybeSteram, ok := &lt;-chanStream:\n                    if ok == false {\n                        return\n                    }\n                    stream = maybeSteram\n                }\n                for c := range orDone(done, stream) {\n                    select {\n                    case outStream &lt;- c:\n                    case &lt;-done:  // Why we are selection from the done channel here?\n                    }\n                }\n            }\n        }()\n        return outStream\n    }\n</code></pre>\n<p>The <code>orDone</code> function:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>    orDone := func(done &lt;-chan interface{}, inStream &lt;-chan interface{}) &lt;-chan interface{} {\n        outStream := make(chan interface{})\n        go func() {\n            defer close(outStream)\n            for {\n                select {\n                case &lt;-done:\n                    return\n                case v, ok := &lt;-inStream:\n                    if ok == false {\n                        return\n                    }\n                    select {\n                    case outStream &lt;- v:\n                    case &lt;-done:  // Again why we are only reading from this channel? Shouldn't we return from here?\n                        // Why we are not retuening from here?\n                    }\n                }\n            }\n        }()\n        return outStream\n    }\n</code></pre>\n<p>As mentioned in the comment, I need some help to understand why we are selecting in the <code>for c := range orDone(donem, stream)</code>. Can anyone explain what is going on here?</p>\n<p>Thanks in advance.</p>\n<h3>Edit</h3>\n<p>I took the code from the book <code>concurrency in go</code>. The full code can be found here: <a href=\"https://github.com/kat-co/concurrency-in-go-src/blob/master/concurrency-patterns-in-go/the-bridge-channel/fig-bridge-channel.go\" rel=\"nofollow noreferrer\">https://github.com/kat-co/concurrency-in-go-src/blob/master/concurrency-patterns-in-go/the-bridge-channel/fig-bridge-channel.go</a></p>\n"}, {"tags": ["go", "protocol-buffers", "grpc", "grpc-go"], "comments": [{"owner": {"reputation": 692, "user_id": 3464052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mCyU7.jpg?s=128&g=1", "display_name": "Mithun Arunan", "link": "https://stackoverflow.com/users/3464052/mithun-arunan"}, "edited": false, "score": 1, "creation_date": 1564897567, "post_id": 57343991, "comment_id": 101176316, "body": "Can you share the complete stacktrace?"}, {"owner": {"reputation": 2422, "user_id": 1610273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ecb15180b9f6e0a36d96da1e0b860572?s=128&d=identicon&r=PG", "display_name": "nevi_me", "link": "https://stackoverflow.com/users/1610273/nevi-me"}, "reply_to_user": {"reputation": 692, "user_id": 3464052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mCyU7.jpg?s=128&g=1", "display_name": "Mithun Arunan", "link": "https://stackoverflow.com/users/3464052/mithun-arunan"}, "edited": false, "score": 0, "creation_date": 1564900385, "post_id": 57343991, "comment_id": 101176758, "body": "I&#39;ve added it @MithunArunan"}, {"owner": {"reputation": 577, "user_id": 7891992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CsP00wAm0dU/AAAAAAAAAAI/AAAAAAAAAfQ/oONOiaBIgXI/photo.jpg?sz=128", "display_name": "Doug Fawley", "link": "https://stackoverflow.com/users/7891992/doug-fawley"}, "edited": false, "score": 0, "creation_date": 1566244868, "post_id": 57343991, "comment_id": 101588099, "body": "I wonder if it has something to do with your vendoring.  Try removing the vendor directory and use everything vanilla and see what happens.  E.g. maybe you have an incompatible combination of generated code and the proto library?"}], "answers": [{"tags": [], "owner": {"reputation": 572, "user_id": 2047138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6705951d37d1fdb4f62215934fdf8a1?s=128&d=identicon&r=PG", "display_name": "rubens21", "link": "https://stackoverflow.com/users/2047138/rubens21"}, "is_accepted": true, "score": 1, "last_activity_date": 1566345626, "creation_date": 1566345626, "answer_id": 57582847, "question_id": 57343991, "link": "https://stackoverflow.com/questions/57343991/grpc-using-oneof-causes-invalid-memory-address-or-nil-pointer-dereference/57582847#57582847", "title": "grpc: Using oneof causes invalid memory address or nil pointer dereference", "body": "<p>I am surprised your code is compiling. I was so intrigued that I generated the Go code in my environment to understand it.</p>\n\n<p>The \"geofancy.Document\" struct cannot receive a <code>Point</code> as a value for the attribute Geo because it expects a generic \"Document Geo\" (that could be a Document_Point, a Document_LineString, etc...)</p>\n\n<p>The auto generated code has an interface that you can use in this case.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    // add coordinate to a point\n    point := geofancy.Document_Point{\n        Point: &amp;geofancy.Point{\n            Coord: &amp;coord,\n        },\n    }\n</code></pre>\n\n<p>Now your variable <code>point</code> is an struct that implements an interface acceptable by <code>Geo</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>document := geofancy.Document{\n  Collection:   \"some-collection\",\n  Id:           \"some-id\",\n  Geo:          &amp;point,\n}\n</code></pre>\n\n<p>I was not able to compile using your example because the was getting the error:</p>\n\n<pre><code> cannot use &amp;point (type **geofancy.Point) as type geofancy.isDocument_Geo in field value:\n    **geofancy.Point does not implement geofancy.isDocument_Geo (missing geofancy.isDocument_Geo method)```\n</code></pre>\n"}], "owner": {"reputation": 2422, "user_id": 1610273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ecb15180b9f6e0a36d96da1e0b860572?s=128&d=identicon&r=PG", "display_name": "nevi_me", "link": "https://stackoverflow.com/users/1610273/nevi-me"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1117, "favorite_count": 1, "accepted_answer_id": 57582847, "answer_count": 1, "score": 0, "last_activity_date": 1566345626, "creation_date": 1564895456, "last_edit_date": 1564900350, "question_id": 57343991, "link": "https://stackoverflow.com/questions/57343991/grpc-using-oneof-causes-invalid-memory-address-or-nil-pointer-dereference", "title": "grpc: Using oneof causes invalid memory address or nil pointer dereference", "body": "<p>I'm trying to send a proto3 struct to a gRPC server with Go. The struct has an <code>oneof</code> type, which I seem to populate fine. When sending the message to my gRPC client, I get a panic about <code>invalid memory address or nil pointer reference</code>.</p>\n\n<p>I have the proto definition (full file is at <a href=\"https://github.com/MovingGauteng/geofancy-rs/blob/master/proto/geofancy.proto\" rel=\"nofollow noreferrer\">https://github.com/MovingGauteng/geofancy-rs/blob/master/proto/geofancy.proto</a>:</p>\n\n<pre class=\"lang-proto prettyprint-override\"><code># proto3\n\nmessage Document {\n  string collection = 1;\n  string id = 2;\n  oneof geo {\n    Point point = 4;\n    LineString line = 5;\n    Bounds bounds = 6;\n    string geojson = 7;\n  }\n}\n\nmessage Point { Coordinate coord = 1; }\n\nmessage Coordinate {\n  double lat = 1;\n  double lng = 2;\n}\n</code></pre>\n\n<p>The Go code is:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// create a coordinate\ncoord := geofancy.Coordinate{\n  Lat: 10.2,\n  Lng: -15.3,\n}\n// add coordinate to a point\npoint := geofancy.Point{\n  Coord: &amp;coord,\n}\n\n// these statements print valid data\nlog.Printf(\"Coord: %v\", coord)\nlog.Printf(\"Point: %v\", point)\n\n// create document, add point to the oneof field\ndocument := geofancy.Document{\n  Collection:   \"some-collection\",\n  Id:           \"some-id\",\n  Geo:          &amp;point,\n}\n\n// this prints the document correctly\nlog.Printf(\"Document: %v\", document)\n\n// connect to client\nvar opts []grpc.DialOption\nopts = append(opts, grpc.WithInsecure())\nvar err error\nconn, err := grpc.Dial(\"my-server:port\", opts...)\nif err != nil {\n    log.Fatalf(\"fail to dial: %v\", err)\n}\ndefer conn.Close()\nclient := geofancy.NewGeofancyServiceClient(conn)\n\nctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)\ndefer cancel()\n\n// this panics each time\nres, err := client.SetDocument(ctx, &amp;document)\n</code></pre>\n\n<p>The stack trace looks like:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xc0000005 code=0x0 addr=0x10 pc=0x54d731]\n\ngoroutine 1 [running]:\nmy-project/vendor/github.com/golang/protobuf/proto.makeOneOfMarshaler.func1(0xc000068ce0, 0x0, 0x0)\n        D:/projects/golang/src/my-project/vendor/github.com/golang/protobuf/proto/table_marshal.go:2373 +0x131\nmy-project/vendor/github.com/golang/protobuf/proto.(*marshalInfo).size(0xc0003021c0, 0xc000068cc0, 0xf9ef40)\n        D:/projects/golang/src/my-project/vendor/github.com/golang/protobuf/proto/table_marshal.go:183 +0xa8\nmy-project/vendor/github.com/golang/protobuf/proto.(*InternalMessageInfo).Size(0xf9ef40, 0xae7fa0, 0xc000068cc0, 0x30448c0)\n        D:/projects/golang/src/my-project/vendor/github.com/golang/protobuf/proto/table_marshal.go:125 +0x6e\nmy-project/vendor/my-protos.(*Document).XXX_Size(0xc000068cc0, 0xae7fa0)\n        D:/projects/golang/src/my-project/vendor/my-protos/geofancy.pb.go:197 +0x4a\nmy-project/vendor/github.com/golang/protobuf/proto.(*Buffer).Marshal(0xc0002de698, 0xae7fa0, 0xc000068cc0, 0xc0000363f0, 0xc000068cc0)\n        D:/projects/golang/src/my-project/vendor/github.com/golang/protobuf/proto/table_marshal.go:2740 +0x8c\nmy-project/vendor/google.golang.org/grpc/encoding/proto.marshal(0xa0c520, 0xc000068cc0, 0xc0002de690, 0x0, 0x0, 0xc000006000, 0x99a900, 0x1)        \n        D:/projects/golang/src/my-project/vendor/google.golang.org/grpc/encoding/proto/proto.go:59 +0xe9\nmy-project/vendor/google.golang.org/grpc/encoding/proto.codec.Marshal(0xa0c520, 0xc000068cc0, 0x0, 0x2030000, 0x2030000, 0x30000, 0x20)\n        D:/projects/golang/src/my-project/vendor/google.golang.org/grpc/encoding/proto/proto.go:74 +0xb4\nmy-project/vendor/google.golang.org/grpc.encode(0x3080168, 0xfbc400, 0xa0c520, 0xc000068cc0, 0xc000310020, 0xc000362000, 0x11d0008, 0x0, 0x0)       \n        D:/projects/golang/src/my-project/vendor/google.golang.org/grpc/rpc_util.go:543 +0x59\nmy-project/vendor/google.golang.org/grpc.prepareMsg(0xa0c520, 0xc000068cc0, 0x3080168, 0xfbc400, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\n        D:/projects/golang/src/my-project/vendor/google.golang.org/grpc/stream.go:1501 +0x8c\nmy-project/vendor/google.golang.org/grpc.(*clientStream).SendMsg(0xc00032e000, 0xa0c520, 0xc000068cc0, 0x0, 0x0)\n        D:/projects/golang/src/my-project/vendor/google.golang.org/grpc/stream.go:681 +0x157\nmy-project/vendor/google.golang.org/grpc.invoke(0xaed320, 0xc000068f60, 0xa42207, 0x25, 0xa0c520, 0xc000068cc0, 0x9e3000, 0xc00003c840, 0xc000065180, 0x0, ...)\n        D:/projects/golang/src/my-project/vendor/google.golang.org/grpc/call.go:70 +0xee\nmy-project/vendor/google.golang.org/grpc.(*ClientConn).Invoke(0xc000065180, 0xaed320, 0xc000068f60, 0xa42207, 0x25, 0xa0c520, 0xc000068cc0, 0x9e3000, 0xc00003c840, 0x0, ...)\n        D:/projects/golang/src/my-project/vendor/google.golang.org/grpc/call.go:37 +0x1bb\nmy-project/vendor/my-protos.(*geofancyServiceClient).SetDocument(0xc000006030, 0xaed320, 0xc000068f60, 0xc000068cc0, 0x0, 0x0, 0x0, 0xc000065180, 0x0, 0x0)\n        D:/projects/golang/src/my-project/vendor/my-protos/geofancy.pb.go:925 +0xd9\nmain.sendMyMessage(0xc0002e4000, 0x77359400)\n        D:/projects/golang/src/my-project/main.go:89 +0x685\nmain.main()\n        D:/projects/golang/src/my-project/main.go:117 +0xf4\n</code></pre>\n"}, {"tags": ["sql", "go"], "comments": [{"owner": {"reputation": 8058, "user_id": 8528, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/649821cb51ef40f0b6c9bf87fcd4c08e?s=128&d=identicon&r=PG", "display_name": "Spencer Kormos", "link": "https://stackoverflow.com/users/8528/spencer-kormos"}, "edited": false, "score": 0, "creation_date": 1564878147, "post_id": 57342939, "comment_id": 101174064, "body": "I&#39;ve read this question, but it doesn&#39;t really answer my question or address my cases: <a href=\"https://stackoverflow.com/questions/50664648/why-even-use-db-exec-or-prepared-statements-in-golang\" title=\"why even use db exec or prepared statements in golang\">stackoverflow.com/questions/50664648/&hellip;</a>"}, {"owner": {"reputation": 2103, "user_id": 1766868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Swmw0.jpg?s=128&g=1", "display_name": "trognanders", "link": "https://stackoverflow.com/users/1766868/trognanders"}, "edited": false, "score": 0, "creation_date": 1564878541, "post_id": 57342939, "comment_id": 101174109, "body": "Not a go programmer, but it looks like the docs are just saying that query returns an object that you need to do something with (close) and never ignore... Nothing specific about why doing updates in query is actually bad."}], "answers": [{"comments": [{"owner": {"reputation": 8058, "user_id": 8528, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/649821cb51ef40f0b6c9bf87fcd4c08e?s=128&d=identicon&r=PG", "display_name": "Spencer Kormos", "link": "https://stackoverflow.com/users/8528/spencer-kormos"}, "edited": false, "score": 0, "creation_date": 1564941537, "post_id": 57345172, "comment_id": 101185736, "body": "&quot;... in a way, already answered in the linked tutorial by way of actually excluding your proposed scenario...&quot;, it could be interpreted that way, but with regard to development, I don&#39;t often rely on lack of information as tacit acceptance. :grin:"}, {"owner": {"reputation": 8058, "user_id": 8528, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/649821cb51ef40f0b6c9bf87fcd4c08e?s=128&d=identicon&r=PG", "display_name": "Spencer Kormos", "link": "https://stackoverflow.com/users/8528/spencer-kormos"}, "edited": false, "score": 0, "creation_date": 1564941573, "post_id": 57345172, "comment_id": 101185744, "body": "Nice highlight on the example code ignoring the returned <code>Rows</code> variable. i didn&#39;t pick up on that. Also nice comment around the Transaction being held open. I didn&#39;t realize that either, and very glad I mentioned this case as well."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 1, "last_activity_date": 1564908839, "last_edit_date": 1564908839, "creation_date": 1564908533, "answer_id": 57345172, "question_id": 57342939, "link": "https://stackoverflow.com/questions/57342939/when-returning-data-on-an-insert-or-update-do-i-still-need-to-use-exec/57345172#57345172", "title": "When returning data on an insert or update, do I still need to use `Exec`?", "body": "<p><strong>TLDR</strong>: There's nothing wrong with using <code>db.Query</code> or <code>db.QueryRow</code> with <code>INSERT</code>, <code>UPDATE</code>, or <code>DELETE</code>. It is actually the right tool for the job if your SQL commands contain the <code>RETURNING</code> clause.</p>\n\n<hr>\n\n<p><strong>2)</strong> is, in a way, already answered in the linked tutorial by way of actually <em>excluding</em> your proposed scenario, since it is talking <em>explicitly</em> about cases where you do not care about the returned rows and you therefore choose to assign the returned value to the blank identifier.</p>\n\n<blockquote>\n  <p><strong>What if you don\u2019t care about the result?</strong> What if you just want to\n  execute a statement and check if there were any errors, but ignore the\n  result? Wouldn\u2019t the following two statements do the same thing?</p>\n\n<pre><code>_, err := db.Exec(\"DELETE FROM users\")  // OK\n_, err := db.Query(\"DELETE FROM users\") // BAD\n</code></pre>\n  \n  <p>The answer is no. They do <strong>not</strong> do the same thing, and you <strong>should never\n  use <code>Query()</code> like this</strong>. The <code>Query()</code> will return a <code>sql.Rows</code>, which\n  reserves a database connection until the <code>sql.Rows</code> is closed.</p>\n</blockquote>\n\n<p>The statement <em>\"... you should never use Query() like this ...\"</em> does not refer to <code>db.Query</code> being used with <code>DELETE</code>, <code>UPDATE</code>, or <code>INSERT</code>, instead it states, and correctly so, that you should never call <code>Query</code> and assign its result to <code>_</code>, i.e. you should never do <code>_, err := db.Query(\"...</code>, whatever the sql command is.</p>\n\n<p>Note that the same applies to <code>QueryRow</code>, i.e. you should never discard the returned <code>sql.Row</code> value or in any other way omit calling its <code>Scan</code> method. This is because <code>sql.Row</code> is just a simple wrapper around <code>sql.Rows</code> and its <code>Scan</code> method closes the underlying <code>sql.Rows</code> before it returns (<a href=\"https://github.com/golang/go/blob/a2f5d644d3a2903a82e527e3bca2c4bdff1d0750/src/database/sql/sql.go#L3122\" rel=\"nofollow noreferrer\">link</a>).</p>\n\n<p><strong>1)</strong> As far as I understand, all the above still holds even for transactions. If you have an <code>sql.Rows</code> instance, created by an <code>sql.Tx</code>, and that <code>sql.Rows</code> instance hasn't yet been closed, the <code>sql.Tx</code> itself will be prevented from closing (<a href=\"https://github.com/golang/go/blob/a2f5d644d3a2903a82e527e3bca2c4bdff1d0750/src/database/sql/sql.go#L1966\" rel=\"nofollow noreferrer\">link</a>). That is, make sure that when you use <code>tx.Query</code> you close the returned rows, and when you use <code>tx.QueryRow</code> you call the returned row's <code>Scan</code> method.</p>\n"}], "owner": {"reputation": 8058, "user_id": 8528, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/649821cb51ef40f0b6c9bf87fcd4c08e?s=128&d=identicon&r=PG", "display_name": "Spencer Kormos", "link": "https://stackoverflow.com/users/8528/spencer-kormos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1564911264, "creation_date": 1564877859, "last_edit_date": 1564911264, "question_id": 57342939, "link": "https://stackoverflow.com/questions/57342939/when-returning-data-on-an-insert-or-update-do-i-still-need-to-use-exec", "title": "When returning data on an insert or update, do I still need to use `Exec`?", "body": "<p>According to <a href=\"http://go-database-sql.org/modifying.html\" rel=\"nofollow noreferrer\">Go Database SQL</a>, it says to use <code>Exec</code> for modifying data, and <code>Query</code> is bad because the underlying connection is kept open until <code>Rows.Close()</code> is called. However, there are two cases I can think of that asks what the correct pattern is.</p>\n\n<p>1) Using <code>sql.Tx</code> for multiple updates, which will hold the connection until the <code>Tx.Rollback</code> or <code>Tx.Commit</code>. In this case would it matter?</p>\n\n<p>2) Returning data on an Update, Insert or Delete (especially when using a non-int-based row ID, like UUID). In this case, <code>QueryRow</code> seems appropriate, especially since it returns <code>Row</code> which doesn't have a <code>Close</code> just <code>Scan</code>. However, a Tx could be opened to write and then immediately read, but this is often a lot of extra work. </p>\n\n<p>Am I missing something with these two cases?</p>\n\n<p>I'm using Postgres, but from what I'm reading about Go's DB integration, the database implementation shouldn't matter in most cases. </p>\n"}, {"tags": ["go", "protocol-buffers", "grpc-go"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1564928232, "post_id": 57342875, "comment_id": 101182365, "body": "when returning the <code>TSReply</code> message - do you want it to include the original timezone offset? If so, your input value of <code>ptype.Timestamp</code> does not have the storage of a TZ value, so any offset would need to be included in an extra field."}], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 4, "last_activity_date": 1565099900, "last_edit_date": 1565099900, "creation_date": 1564884168, "answer_id": 57343280, "question_id": 57342875, "link": "https://stackoverflow.com/questions/57342875/parsing-datetimestamps-with-timezone-offset-in-go-using-google-protobuf-timestam/57343280#57343280", "title": "Parsing datetimestamps with timezone offset in Go using google.protobuf.Timestamp", "body": "<p>A gRPC message type of <a href=\"https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/timestamp.proto\" rel=\"nofollow noreferrer\">google.protobuf.Timestamp</a>, internally, is just two <code>int64</code>'s</p>\n\n<pre><code>message Timestamp {\n  // Represents seconds of UTC time since Unix epoch\n  // 1970-01-01T00:00:00Z. Must be from 0001-01-01T00:00:00Z to\n  // 9999-12-31T23:59:59Z inclusive.\n  int64 seconds = 1;\n\n  // Non-negative fractions of a second at nanosecond resolution. Negative\n  // second values with fractions must still have non-negative nanos values\n  // that count forward in time. Must be from 0 to 999,999,999\n  // inclusive.\n  int32 nanos = 2;\n}\n</code></pre>\n\n<p>So when in this format-type, there is nothing to <em>parse</em>.</p>\n\n<p>One typically takes:</p>\n\n<ul>\n<li>a string format like your <code>2019-02-15T13:00:00+01:00</code> and converts to a <code>time.Time</code> using <code>time.Parse</code></li>\n<li>then convert the <code>time.Time</code> to a <code>*tspb.Timestamp</code> using <a href=\"https://godoc.org/github.com/golang/protobuf/ptypes#TimestampProto\" rel=\"nofollow noreferrer\">ptypes.TimestampProto()</a></li>\n</ul>\n\n<p>FYI in your cited output, you are seeing a <code>zero</code> timestamp (i.e. both seconds and nanos are zero) - hence the <code>\"1970-01-01T00:00:00Z\"</code> output.</p>\n\n<hr>\n\n<p>Implementing the flow above:</p>\n\n<pre><code>ts, err := time.Parse(time.RFC3339, \"2019-02-15T13:00:00+01:00\")\n\npbts, err := ptypes.TimestampProto(ts) // ptypes.Timestamp:\"seconds:1550232000 \"\n\nfmt.Println(ptypes.TimestampString(pbts)) // \"2019-02-15T12:00:00Z\"\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/UABbRDSYb_y\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p><strong>Note:</strong> the <code>ptype.Timestamp</code> is stripped of any timezone - <code>Z</code> so <code>UTC</code> time. So if you need to preserve timezone of a <code>time.Time</code>, the offset would need to be sent in your gRPC message in addition to your <code>google.protobuf.Timestamp</code> message.</p>\n"}], "owner": {"reputation": 151, "user_id": 2678928, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/907389fe0dfd60cdaea0380c9110909a?s=128&d=identicon&r=PG&f=1", "display_name": "Sevren", "link": "https://stackoverflow.com/users/2678928/sevren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1759, "favorite_count": 1, "accepted_answer_id": 57343280, "answer_count": 1, "score": 2, "last_activity_date": 1565099900, "creation_date": 1564876782, "question_id": 57342875, "link": "https://stackoverflow.com/questions/57342875/parsing-datetimestamps-with-timezone-offset-in-go-using-google-protobuf-timestam", "title": "Parsing datetimestamps with timezone offset in Go using google.protobuf.Timestamp", "body": "<p>I am creating a Go application which will use GRPC and protobuf. My RPC service shall take a message containing the type <code>google.protobuf.Timestamp</code>, parse it and eventually save it in a database or perform some more operations on it. </p>\n\n<p>I am confused as to what is considered valid input for the type <code>google.protobuf.Timestamp</code>. I wish to use the following format for the datetimestamp with the timezone offset.</p>\n\n<p><code>2019-02-15T13:00:00+01:00</code></p>\n\n<p>Here is the proto file I am using.</p>\n\n<pre><code>syntax = \"proto3\"\npackage example;\nimport \"google/protobuf/timestamp.proto\"\n\nservice Tester {\n rpc ParseDateTimeStamp(TSRequest) returns (TSReply) {}\n}\n\nmessage TSRequest {\n  google.protobuf.Timestamp dts = 1;\n}\n\nmessage TSReply {\n string message = 1;\n}\n</code></pre>\n\n<p>The issue is that when I send a message to the GRPC server containing the datetimestamp. I would expect that the type <code>*tsbp.Timestamp</code> for the <code>2019-02-15T13:00:00+01:00</code> datetimestamp given to be valid and give me the appropriate seconds from epoch. (After invoking <code>GetSeconds()</code> from the timestamp.go)</p>\n\n<p>Invoking <code>ptypes.TimestampString(ts *tspb.Timestamp)</code> returns <code>1970-01-01T00:00:00Z</code> for the example input above.</p>\n\n<p>Does the <code>google.protobuf.Timestamp</code> accept datetimestamps with the +- offset?</p>\n\n<p>Or do I have to have the input in a String type and then parse to <code>time.Time</code> with <code>time.Format</code> instead of using the timestamp variable type in protobuf? If so could you provide an example of this? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 7624082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S7X3A.jpg?s=128&g=1", "display_name": "Alan Lian", "link": "https://stackoverflow.com/users/7624082/alan-lian"}, "edited": false, "score": 0, "creation_date": 1564880184, "post_id": 57342924, "comment_id": 101174249, "body": "just one more question, why they refactor this function out, I find in the link &quot;add js/wasm compatible DefaultTransport&quot; , why should this refactor be needed???"}, {"owner": {"reputation": 24942, "user_id": 688653, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/978a9f5060338657ddeb3781c6a3a2c8?s=128&d=identicon&r=PG", "display_name": "zw324", "link": "https://stackoverflow.com/users/688653/zw324"}, "reply_to_user": {"reputation": 27, "user_id": 7624082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S7X3A.jpg?s=128&g=1", "display_name": "Alan Lian", "link": "https://stackoverflow.com/users/7624082/alan-lian"}, "edited": false, "score": 0, "creation_date": 1564881856, "post_id": 57342924, "comment_id": 101174440, "body": "@AlanLian - Updated and added some speculations."}], "tags": [], "owner": {"reputation": 24942, "user_id": 688653, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/978a9f5060338657ddeb3781c6a3a2c8?s=128&d=identicon&r=PG", "display_name": "zw324", "link": "https://stackoverflow.com/users/688653/zw324"}, "is_accepted": true, "score": 0, "last_activity_date": 1564881835, "last_edit_date": 1564881835, "creation_date": 1564877533, "answer_id": 57342924, "question_id": 57342783, "link": "https://stackoverflow.com/questions/57342783/where-does-transport-struct-in-net-http-transport-go-implement-roudtripper-inter/57342924#57342924", "title": "where does Transport struct in net/http/transport.go implement RoudTripper interface", "body": "<p>The function you are looking for is in <a href=\"https://golang.org/src/net/http/roundtrip.go\" rel=\"nofollow noreferrer\">https://golang.org/src/net/http/roundtrip.go</a> instead of <a href=\"https://golang.org/src/net/http/transport.go\" rel=\"nofollow noreferrer\">https://golang.org/src/net/http/transport.go</a>.</p>\n\n<p>To see this you can try this playground and its output - <a href=\"https://play.golang.org/p/A97ylJmc43R\" rel=\"nofollow noreferrer\">https://play.golang.org/p/A97ylJmc43R</a></p>\n\n<p>The code was in <a href=\"https://golang.org/src/net/http/transport.go\" rel=\"nofollow noreferrer\">https://golang.org/src/net/http/transport.go</a>, but was later refactored out in <a href=\"https://github.com/golang/go/commit/b12e341616365cafd6f7eab9aaaa29c4155c1a76#diff-e85f2dbad3447c4267e815cc9d014e69\" rel=\"nofollow noreferrer\">https://github.com/golang/go/commit/b12e341616365cafd6f7eab9aaaa29c4155c1a76#diff-e85f2dbad3447c4267e815cc9d014e69</a>.</p>\n\n<p>(Speculation - do not trust it 100%) From the commit description and the issue (<a href=\"https://github.com/golang/go/issues/25506\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/25506</a>), it seems that the refactor was for using the Fetch API (<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\" rel=\"nofollow noreferrer\">https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API</a>) in the WebAssembly backend (<a href=\"https://github.com/golang/go/commit/b12e341616365cafd6f7eab9aaaa29c4155c1a76#diff-e85f2dbad3447c4267e815cc9d014e69R5\" rel=\"nofollow noreferrer\">build flags</a>). Since this would only work for WASM, the code was refactored to split out the two separate implementations.</p>\n"}], "owner": {"reputation": 27, "user_id": 7624082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S7X3A.jpg?s=128&g=1", "display_name": "Alan Lian", "link": "https://stackoverflow.com/users/7624082/alan-lian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 57342924, "answer_count": 1, "score": 0, "last_activity_date": 1564881835, "creation_date": 1564875233, "question_id": 57342783, "link": "https://stackoverflow.com/questions/57342783/where-does-transport-struct-in-net-http-transport-go-implement-roudtripper-inter", "title": "where does Transport struct in net/http/transport.go implement RoudTripper interface", "body": "<p>RoundTripper interface is like</p>\n\n<pre><code>type RoundTripper interface {\n    RoundTrip(*Request) (*Response, error)\n}\n\n</code></pre>\n\n<p>and inside <a href=\"https://golang.org/src/net/http/transport.go\" rel=\"nofollow noreferrer\">net/http/transport.go</a> I can only find an function named roundTrip(which is lowercase), so I wonder where does this struct Transport implement RoundTripper interface?</p>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1564861165, "post_id": 57340936, "comment_id": 101171382, "body": "Problems: 1) Read deadline is set once and never updated. The <code>Read</code> goroutine will eventually exit with deadline exceeded error. 2)  Assuming that <code>Close</code> simply closes the underlying websocket connection, the program exits after sending the subscribe message. There may be other issues in the code you are not showing us (Hearbeat, Decode, Close)."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1564861780, "post_id": 57340936, "comment_id": 101171520, "body": "3) Because <code>Challenge</code> creates a destroys the mutex in the scope of the function, the mutex is not useful.  If the goal of the mutex is to limit the number of concurrent writers, then all writers must share the same mutex."}, {"owner": {"reputation": 79, "user_id": 10763181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8300f7c062a34b0f6cba5491c63bd648?s=128&d=identicon&r=PG&f=1", "display_name": "MjBVala", "link": "https://stackoverflow.com/users/10763181/mjbvala"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1564863969, "post_id": 57340936, "comment_id": 101172026, "body": "Thanks for the feedback! I&#39;ve updated the question with the code for Heartbeat, Decode, and Close; and moved the Read deadline within the for loop. The close listens for an interrupt signal so it&#39;s not closing out at that point. I&#39;ve also updated with the full output I get. Thanks for the info on the mutex, I&#39;ll have to figure out a way to incorporate a single mutex for every writer!"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1564867417, "post_id": 57340936, "comment_id": 101172654, "body": "Declare a mutex as a Websocket field.   Use that field in all write operations."}, {"owner": {"reputation": 79, "user_id": 10763181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8300f7c062a34b0f6cba5491c63bd648?s=128&d=identicon&r=PG&f=1", "display_name": "MjBVala", "link": "https://stackoverflow.com/users/10763181/mjbvala"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1564970191, "post_id": 57340936, "comment_id": 101190767, "body": "Thanks for the help, I&#39;ve updated the code to include everything and added the mutex websocket field! Unfortunately the 1006 error still persists."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1564979717, "post_id": 57340936, "comment_id": 101192189, "body": "It looks like the interaction with the server is the sequence: send challenge -&gt; read challenge response -&gt; compute sig -&gt; send subscription -&gt; start hearbeat -&gt; read and print messages.  If the interaction is sequential, then the program will be easier to understand as sequential code.  The goroutines and channels obfuscate what&#39;s going on.  This has nothing to do with the problem you are encountering."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1564980000, "post_id": 57340936, "comment_id": 101192259, "body": "The 1006 error indicates that the server abruptly closed the connection. Is it possible that the subscribe message is bad, possibly due to an invalid signature?  I suggest logging received and sent messages and comparing the logs to the documentation."}, {"owner": {"reputation": 79, "user_id": 10763181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8300f7c062a34b0f6cba5491c63bd648?s=128&d=identicon&r=PG&f=1", "display_name": "MjBVala", "link": "https://stackoverflow.com/users/10763181/mjbvala"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1564980471, "post_id": 57340936, "comment_id": 101192356, "body": "my overall sequence would be send challenge -&gt; read challenge response -&gt; compute sig -&gt; send subscription -&gt; start heartbeat -&gt; loop(read message -&gt; if x message comes back send y message -&gt; read message). So after I&#39;m able to subscribe to fills I&#39;ll need to be able to read incoming messages and write messages if a condition is met. Would the approach be to rewrite in a way that makes more sense in the main function - encompassing the goroutines into the Websocket wrapper,  or are you saying to call a read/write at every step? thankful you&#39;re taking the time to point out flaws in my code."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1564981679, "post_id": 57340936, "comment_id": 101192597, "body": "I&#39;ll repeat that the code organization is probably not the issue. That said, the sig interrupt handler is the only reason that the program needs more than one goroutine.  I&#39;d run the interrupt handler in its own goroutine (start it after creating the connection) or delete the interrupt handler entirely (I doubt it&#39;s important to cleanly close the connection).  Either way, the core of the program is in the main goroutine as sequential code. How you structure it between the wrapper and the main program is less important."}, {"owner": {"reputation": 79, "user_id": 10763181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8300f7c062a34b0f6cba5491c63bd648?s=128&d=identicon&r=PG&f=1", "display_name": "MjBVala", "link": "https://stackoverflow.com/users/10763181/mjbvala"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1564985382, "post_id": 57340936, "comment_id": 101193476, "body": "I&#39;ve deleted the interrupt handler and modified the main goroutine - the code has been updated. When I run the program now, the program doesn&#39;t run the signature or FillSubscribe methods. Could this be because of the UUID channel? I&#39;m thinking I&#39;ll decode within the challenge function as a workaround."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1564985576, "post_id": 57340936, "comment_id": 101193536, "body": "Delete all channels and all goroutines.  Use arguments and return values to pass data around.  I&#39;d focus on logging sent and received messages and comparing those to the docs."}, {"owner": {"reputation": 79, "user_id": 10763181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8300f7c062a34b0f6cba5491c63bd648?s=128&d=identicon&r=PG&f=1", "display_name": "MjBVala", "link": "https://stackoverflow.com/users/10763181/mjbvala"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565043295, "post_id": 57340936, "comment_id": 101219498, "body": "I&#39;ve updated the code, most of my logic for incoming messages is in the form of switch statements in the Decode function. As you said, the organization isn&#39;t the issue."}], "owner": {"reputation": 79, "user_id": 10763181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8300f7c062a34b0f6cba5491c63bd648?s=128&d=identicon&r=PG&f=1", "display_name": "MjBVala", "link": "https://stackoverflow.com/users/10763181/mjbvala"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 4881, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1565043213, "creation_date": 1564855653, "last_edit_date": 1565043213, "question_id": 57340936, "link": "https://stackoverflow.com/questions/57340936/how-to-isolate-a-close-1006-abnormal-closure-unexpected-eof", "title": "How to isolate a close 1006 (abnormal closure): unexpected EOF", "body": "<p>I've been trying to subscribe to this API feed: <a href=\"https://www.cryptofacilities.com/resources/hc/en-us/articles/360000578294-Fills\" rel=\"nofollow noreferrer\">https://www.cryptofacilities.com/resources/hc/en-us/articles/360000578294-Fills</a></p>\n\n<p>Whenever I try to subscribe, it looks like I'm able to send the payload with WRITEJSON, but what I receive from my Read method is</p>\n\n<blockquote>\n  <p>websocket: close 1006 (abnormal closure): unexpected EOF.</p>\n</blockquote>\n\n<p>The full terminal message is:</p>\n\n<blockquote>\n  <p>2019/08/04 22:20:31 recv: {\"event\":\"info\",\"version\":1}\n  2019/08/04 22:20:31 recv: {\"event\":\"subscribed\",\"feed\":\"heartbeat\"}\n  2019/08/04 22:20:31 recv: {\"event\":\"challenge\",\"message\":\"c6e55c07-d07a-4560-9283-be75ee458433\"}\n  ^C2019/08/04 22:21:50 interrupt\n  2019/08/04 22:21:50 write close: write tcp 192.168.1.6:49624->104.16.51.17:443: write: broken pipe</p>\n</blockquote>\n\n<p>I understand <a href=\"https://stackoverflow.com/questions/19304157/getting-the-reason-why-websockets-closed-with-close-code-1006\">from here</a> that the status code means that my client closed the connection. I'm unable to track down this problem.</p>\n\n<p>I've tried running race detection, turning off firewall (I have a Mac, and tried to turn off the antivirus - found out it's built in. Would this be worth pursuing?) increasing the handshake timeout, handling the error with a close frame, a different OS, increasing the buffer size, and max message size. A lot of it in reference to this post:</p>\n\n<p><a href=\"https://github.com/gorilla/websocket/issues/321\" rel=\"nofollow noreferrer\">https://github.com/gorilla/websocket/issues/321</a></p>\n\n<p>This is my client:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package websocket\n\nimport (\n    \"crypto/hmac\"\n    \"crypto/sha256\"\n    \"crypto/sha512\"\n    \"encoding/base64\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n\n    \"github.com/gorilla/websocket\"\n)\n\nvar addr = \"wss://www.cryptofacilities.com/ws/v1\"\n\nvar Wait = 50000 * time.Second\n\nvar MaxMessageSize int64 = 100000\n\n//WebSocket connection struct to pass into other methods\ntype WebSocket struct {\n    Conn *websocket.Conn\n}\n\n//Message represents the public server push messages\ntype Message struct {\n    Event   string\n    Feed    string\n    Message interface{}\n}\n\ntype ChallengeSub struct {\n    Event   string `json:\"event\"`\n    Message string `json:\"message\"`\n}\n\ntype HeartBeat struct {\n    Event   string\n    Message string\n}\n\ntype FillSubscribe struct {\n    Event             string `json:\"event\"`\n    Feed              string `json:\"feed\"`\n    APIKey            string `json:\"api_key\"`\n    OriginalChallenge string `json:\"original_challenge\"`\n    SignedChallenge   string `json:\"signed_challenge\"`\n}\n\n//OpenWebSocket Connects to kraken API and returns a connection\nfunc OpenWebSocket() (*WebSocket, error) {\n    conn, response, err := websocket.DefaultDialer.Dial(addr, nil)\n    if err != nil {\n        return nil, err\n    }\n    if response.StatusCode != http.StatusSwitchingProtocols {\n        return nil, fmt.Errorf(\"failed to upgrade protocol to websocket\")\n    }\n    return &amp;WebSocket{Conn: conn}, nil\n}\n\n//HeartBeat subscribes to the pingpong feed to keep the connection alive\nfunc (c *WebSocket) HeartBeat() error {\n\n    ping := map[string]interface{}{\n        \"event\": \"subscribe\",\n        \"feed\":  \"heartbeat\",\n    }\n    c.Conn.SetWriteDeadline(time.Now().Add(Wait))\n    err := c.Conn.WriteJSON(ping)\n\n    return err\n}\n\nfunc (c *WebSocket) Next() ([]byte, error) {\n    _, payload, err := c.Conn.ReadMessage()\n    return payload, err\n}\n\n//Challenge requests the UUID from kraken API for auth handshake\nfunc (c *WebSocket) Challenge() error {\n\n    challengeRequest := map[string]interface{}{\n        \"event\":   \"challenge\",\n        \"api_key\": \"rhsqfT66dxTF7g2O7/t5Cluubjw4MlEz1UoBrZBjf8JocQ/q49j9rH9m\",\n    }\n    c.Conn.SetWriteDeadline(time.Now().Add(Wait))\n    err := c.Conn.WriteJSON(challengeRequest)\n    if err != nil {\n        log.Println(\"write:\", err)\n\n        return err\n    }\n\n    return err\n}\n\nfunc (c *WebSocket) Decode(payload []byte) (string, string) { //Decode takes in a connection and reference to Message struct\n    var msg json.RawMessage\n    env := Message{\n        Message: &amp;msg,\n    }\n    if err := json.Unmarshal([]byte(payload), &amp;env); err != nil {\n        log.Fatal(err)\n    }\n    switch env.Event {\n\n    case \"challenge\":\n        var s ChallengeSub\n        if err := json.Unmarshal(msg, &amp;s.Message); err != nil {\n            log.Fatal(err)\n        }\n        message, signed := c.Signature(s.Message)\n        c.FillSubscribe(message, signed)\n\n        return message, signed\n\n    case \"info\":\n        {\n            fmt.Println(\"Connected:\", env.Event)\n        }\n    case \"subscribed\":\n        {\n            fmt.Println(\"Connected to Heartbeat\")\n        }\n    default:\n        switch env.Feed {\n        case \"heartbeat\":\n            fmt.Println(\"Live\")\n        }\n    }\n    return \"No messages to Decode...\", \"\"\n}\n\nfunc (c *WebSocket) Signature(message string) (string, string) {\n\n    secret64, _ := base64.StdEncoding.DecodeString(\"rhsqfT66dxTF7g2O7/t5Cluubjw4MlEz1UoBrZBjf8JocQ/q49j9rH9m\")\n\n    hash := sha256.New()\n    hash.Write([]byte(message))\n\n    challenge256 := hash.Sum(nil)\n\n    hmacHash := hmac.New(sha512.New, secret64)\n    hmacHash.Write(challenge256)\n\n    secretChallenge := hmacHash.Sum(nil)\n\n    signed := base64.StdEncoding.EncodeToString(secretChallenge)\n    return message, signed\n}\n\n//FillSubscribe populates message struct and sends out the JSON message\nfunc (c *WebSocket) FillSubscribe(challenge string, signed string) error {\n\n    fillMessage := map[string]interface{}{\n        \"event\":              \"subscribe\",\n        \"feed\":               \"fills\",\n        \"api_key\":            \"rhsqfT66dxTF7g2O7/t5Cluubjw4MlEz1UoBrZBjf8JocQ/q49j9rH9m\",\n        \"original_challenge\": challenge,\n        \"signed_challenge\":   signed,\n    }\n    c.Conn.SetWriteDeadline(time.Now().Add(Wait))\n    err := c.Conn.WriteJSON(fillMessage)\n    if err != nil {\n        log.Println(\"write:\", err)\n        return err\n    }\n\n    return err\n}\n\n</code></pre>\n\n<p>Here is my main program:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/Mjavala/KrakenAPI/websocket\"\n)\n\nvar message string\nvar signed string\n\nfunc main() {\n\n    ws, err := websocket.OpenWebSocket()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    ws.HeartBeat()\n    ws.Challenge()\n\n    fmt.Println(message, signed)\n\n    for {\n        // We first read in a raw message. An error here is a socket level\n        // error.\n        payload, err := ws.Next()\n        if err != nil {\n            log.Fatalf(\"socket error: %+v\\n\", err)\n        }\n\n        log.Printf(\"recv: %s\", payload)\n\n        message, signed = ws.Decode(payload)\n        if err != nil {\n            log.Fatalf(\"decode error: %+v\\n\", err)\n        }\n    }\n}\n</code></pre>\n\n<p>I believe that even if the API Keys are wrong a return message should still be sent, as per the API; but instead I get that 1006 close frame. </p>\n\n<p>I'm new to WebSockets. I'm able to get the challenge messaged and heartbeat subscription from the API, the problem is specific to the fill subscription.</p>\n\n<p>Also if anyone wants to replicate this, I can give the full code/Git link.</p>\n"}, {"tags": ["go", "redis", "encode"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1564850185, "post_id": 57340108, "comment_id": 101168837, "body": "What error are you getting?"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1564850761, "last_edit_date": 1564850761, "creation_date": 1564850418, "answer_id": 57340286, "question_id": 57340108, "link": "https://stackoverflow.com/questions/57340108/change-bytes-array-to-struct-in-golang/57340286#57340286", "title": "Change bytes array to struct in golang", "body": "<p>Reusing the bytes.Buffer between encode operations will produce unexpected results.  Every call to Encode appends data to the buffer. Calling Set multiple times will write the following data to the database: (value1), (value1, value2), (value1, value2, value3) and so on. Calling the function concurrently will create a data race.</p>\n\n<p>Fix the <code>Set</code> function by creating a buffer and encoder for each call to the function:</p>\n\n<pre><code>func Set(field string, value interface{}) error {\n    var buf bytes.Buffer\n    var encoder = gob.NewEncoder(&amp;buf)\n\n    id := \"sample-key\"\n    err := encoder.Encode(value)\n    if err != nil {\n        return err\n    }\n    return redisdb.HSet(id, field, buf.Bytes()).Err()\n}\n</code></pre>\n\n<p>The <code>Get</code> function is the inverse of the set function:</p>\n\n<pre><code>func Get(field string, value interface{}) error {\n    id := \"sample-key\"\n    buf, err := redisdb.HGet(id, field).Bytes()\n    if err != nil {\n        return err\n    }\n    return gob.NewDecoder(bytes.NewReader(buf)).Decode(value)\n}\n</code></pre>\n\n<p>Call the get function with a pointer to the value:</p>\n\n<pre><code>var d Data\nerr := Get(field, &amp;d)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 114, "user_id": 8296461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aee2fcc9ebbee078c749f33fbb1bf795?s=128&d=identicon&r=PG&f=1", "display_name": "Sumukha Pk", "link": "https://stackoverflow.com/users/8296461/sumukha-pk"}, "is_accepted": false, "score": 0, "last_activity_date": 1564898237, "creation_date": 1564898237, "answer_id": 57344180, "question_id": 57340108, "link": "https://stackoverflow.com/questions/57340108/change-bytes-array-to-struct-in-golang/57344180#57344180", "title": "Change bytes array to struct in golang", "body": "<p>A simple JSON.Unmarshal(<code>the bytes object</code>, <code>the struct variable</code>) must suffice! </p>\n"}], "owner": {"reputation": 91, "user_id": 5431857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9085919719d5fbff1134f63f7548c796?s=128&d=identicon&r=PG&f=1", "display_name": "NaN", "link": "https://stackoverflow.com/users/5431857/nan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 57340286, "answer_count": 2, "score": -2, "last_activity_date": 1564898237, "creation_date": 1564849182, "question_id": 57340108, "link": "https://stackoverflow.com/questions/57340108/change-bytes-array-to-struct-in-golang", "title": "Change bytes array to struct in golang", "body": "<p>I am having some data in redis.\nThe value is stored in form of bytes.\nI want to fetch the bytes and map that to a struct but I am not able to decode bytes data.\nThis is the code I am using to persist data to redis:</p>\n\n<pre><code>    import (\n    bytes \"bytes\"\n    \"encoding/gob\"\n    \"fmt\"\n    \"github.com/go-redis/redis\"\n    \"time\"\n)\n\nvar convertor bytes.Buffer\nvar encoder = gob.NewEncoder(&amp;convertor)\nvar decoder = gob.NewDecoder(&amp;convertor)\n\nfunc Set(field string,  value interface{}) (error){\n    id := \"sample-key\";\n    err := encoder.Encode(value)\n    if err!=nil {\n        fmt.Printf(\"error occured while marshaling data\")\n        return err;\n    }\n\n    valueBytes := convertor.Bytes()\n\n    err = redisdb.HSet(id, field, valueBytes).Err();\n    if err!=nil{\n        fmt.Printf(\"error occured while setting data\")\n        return err;\n    }\n    return nil;\n}\n</code></pre>\n\n<p>This is how I get data from redis:</p>\n\n<pre><code>result, err := redisdb.HGet(key, field).Result()\nif err != nil{\n    fmt.Println(\"error occured\");\n}\n</code></pre>\n\n<p>but I am not able to store it into struct. How can decode the bytes data to a struct?</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1564851622, "creation_date": 1564851622, "answer_id": 57340427, "question_id": 57339949, "link": "https://stackoverflow.com/questions/57339949/how-to-automatically-populate-struct-fields-with-type-time-time-with-custom-ti/57340427#57340427", "title": "How to automatically populate struct fields with type `time.Time` with custom time zone?", "body": "<p>Loop through the slice and update the time values in place.  Lookup the location once outside of the handler.</p>\n\n<pre><code>func getBookings() http.HandlerFunc {\n    loc, _ := time.LoadLocation(\"Europe/London\")\n    return func(w http.ResponseWriter, r *http.Request) {\n        var bookings []Booking\n        GetDB().Find(&amp;bookings)\n        for i := range bookings {\n            booking[i].Start = bookings[i].Start.In(loc)\n            booking[i].Finish = bookings[i].Finish.In(loc)\n        }\n        render.JSON(w, r, bookings)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1060, "user_id": 1904151, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/bcf8addaae94d2a38e44eee62207db39?s=128&d=identicon&r=PG&f=1", "display_name": "alexc", "link": "https://stackoverflow.com/users/1904151/alexc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 57340427, "answer_count": 1, "score": -1, "last_activity_date": 1565704018, "creation_date": 1564848041, "last_edit_date": 1565704018, "question_id": 57339949, "link": "https://stackoverflow.com/questions/57339949/how-to-automatically-populate-struct-fields-with-type-time-time-with-custom-ti", "title": "How to automatically populate struct fields with type `time.Time` with custom time zone?", "body": "<p>I'm using GORM to retrieve data from a Postgresql database. Inside the postgresql database I'm storing times as the default UTC. When I load them through gorm/golang I would like to automatically convert them to 'Europe/London' location. </p>\n\n<p>Currently, all times are returned as my local timezone (CEST). I'm struggling to find a way to manually override this?</p>\n\n<p>Here is the relevant code:</p>\n\n<pre><code>type Booking struct {\n    gorm.Model\n    Service   Service\n    ServiceID uint `json:serviceId`\n    Start     time.Time\n    Finish    time.Time\n}\n\nfunc getBookings() http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        bookings := &amp;[]Booking{}\n\n        GetDB().Find(bookings)\n\n        render.JSON(w, r, bookings)\n    }\n}\n</code></pre>\n\n<p>I've been looking around and I can't seem to find any information from gorm or golang docs. The two closest things to mentions of this problem that I've found is:</p>\n\n<p><a href=\"https://github.com/jinzhu/gorm/wiki/How-To-Do-Time\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/gorm/wiki/How-To-Do-Time</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/54363451/setting-timezone-globally-in-golang\">Setting timezone globally in golang</a></p>\n\n<p>I thought a work around could be to manually change the query results with a loop, but I'm not sure if this is the most efficient solution? - code below:</p>\n\n<pre><code>func getBookings() http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        bookings := &amp;[]Booking{}\n        timeZoneBookings := *&amp;[]Booking{}\n\n        GetDB().Find(bookings)\n\n        for _, booking := range *bookings {\n\n            booking.Start = parseToUkTime(booking.Start)\n            booking.Finish = parseToUkTime(booking.Finish)\n\n            timeZoneBookings = append(timeZoneBookings, booking)\n\n        }\n\n        render.JSON(w, r, timeZoneBookings)\n    }\n}\n\n\n\nfunc parseToUkTime(timeToParse time.Time) time.Time {\n    loc, _ := time.LoadLocation(\"Europe/London\")\n\n    t := timeToParse.In(loc)\n\n    return t\n\n}\n</code></pre>\n\n<p>Here is an image of the DB entry:</p>\n\n<p><a href=\"https://i.stack.imgur.com/GFn87.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/GFn87.png\" alt=\"enter image description here\"></a></p>\n\n<p>I assumed it would be easy to either state inside the type I would like the location to be set to <code>Europe/London</code> so the struct would automatically be populated this way, however this doesn't seem to be the case? It's the first time I have worked with timezones, so everything is quite confusing. </p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1564849008, "post_id": 57339682, "comment_id": 101168536, "body": "The order is already more or less irrelevant, what&#39;s relevant is which template you <i>execute</i>."}], "answers": [{"comments": [{"owner": {"reputation": 2485, "user_id": 1257775, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5266f3439852a16a84f7ab4c7284fba7?s=128&d=identicon&r=PG", "display_name": "Adam Silver", "link": "https://stackoverflow.com/users/1257775/adam-silver"}, "edited": false, "score": 0, "creation_date": 1564849653, "post_id": 57340083, "comment_id": 101168716, "body": "I am newbie in Go so thanks so much for the additional note - very helpful."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1564850272, "last_edit_date": 1564850272, "creation_date": 1564849004, "answer_id": 57340083, "question_id": 57339682, "link": "https://stackoverflow.com/questions/57339682/golang-template-order/57340083#57340083", "title": "Golang template order", "body": "<p><a href=\"https://golang.org/pkg/html/template/#ParseFiles\" rel=\"nofollow noreferrer\"><code>template.ParseFiles()</code></a> documents that:</p>\n\n<blockquote>\n  <p>The returned template's name will have the (base) name and (parsed) contents of the <strong>first file</strong>.</p>\n</blockquote>\n\n<p>So in your first example your template designates <code>\"templates/analytics.html\"</code> because that's the first template you pass, and when you change order, the template will designate <code>\"templates/header.html\"</code>.</p>\n\n<p>And if you execute the template with <a href=\"https://golang.org/pkg/html/template/#Template.Execute\" rel=\"nofollow noreferrer\"><code>Template.Execute()</code></a>, these are the (default) templates to be executed.</p>\n\n<p>Instead you should use <a href=\"https://golang.org/pkg/html/template/#Template.ExecuteTemplate\" rel=\"nofollow noreferrer\"><code>Template.ExecuteTemplate()</code></a> and explicitly specify you want to execute the <code>\"templates/analytics.html\"</code>, whose name will be <code>analytics</code>, so pass that:</p>\n\n<pre><code>err := tmpl.ExecuteTemplate(w, \"analytics\", data)\n</code></pre>\n\n<p>That way it will not matter in what order you pass the templates to <code>template.ParseFiles()</code>.</p>\n\n<p>And a friendly note: do not parse your templates in the handler: it's slow. Parse them once, on app startup, store them e.g. in package variables, and just execute them in the handler. For details, see <a href=\"https://stackoverflow.com/questions/28451675/it-takes-too-much-time-when-using-template-package-to-generate-a-dynamic-web-p/28453523#28453523\">It takes too much time when using &quot;template&quot; package to generate a dynamic web page to client in Golang</a>.</p>\n\n<p>Also see related quesetion: <a href=\"https://stackoverflow.com/questions/41176355/go-template-name/41187671#41187671\">Go template name</a></p>\n"}], "owner": {"reputation": 2485, "user_id": 1257775, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5266f3439852a16a84f7ab4c7284fba7?s=128&d=identicon&r=PG", "display_name": "Adam Silver", "link": "https://stackoverflow.com/users/1257775/adam-silver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 0, "accepted_answer_id": 57340083, "answer_count": 1, "score": 0, "last_activity_date": 1564850272, "creation_date": 1564846037, "last_edit_date": 1564849268, "question_id": 57339682, "link": "https://stackoverflow.com/questions/57339682/golang-template-order", "title": "Golang template order", "body": "<p>Is there a way to make the template order irrelevant.</p>\n\n<p>Here's my code:</p>\n\n<pre><code>var overallTemplates = []string{\n    \"templates/analytics.html\",\n    \"templates/header.html\",\n    \"templates/footer.html\"}\n\nfunc HomeHandler(w http.ResponseWriter, r *http.Request) {\n    render(w,\n        append([]string{\"templates/home.html\"}, overallTemplates...),\n        nil)\n}\n\nfunc render(w http.ResponseWriter, files []string, data interface{}) {\n    tmpl := template.Must(template.ParseFiles(files...))\n    err := tmpl.Execute(w, data)\n\n    if err != nil {\n        fmt.Printf(\"Couldn't load template: %v\\n\", err)\n    }\n}\n</code></pre>\n\n<p>It works but if I change the order of <code>overallTemplates</code> to:</p>\n\n<pre><code>var overallTemplates = []string{\n    \"templates/header.html\",\n    \"templates/footer.html\",\n    \"templates/analytics.html\"}\n</code></pre>\n\n<p>I get a blank page because analytics.html content is something like <code>{{define \"analytics\"}}...{{end}}</code> and it's called by <code>footer.html</code> like <code>{{define \"footer\"}}{{template \"analytics\"}} ...{{end}}</code></p>\n"}, {"tags": ["go", "visual-studio-code", "evaluate"], "comments": [{"owner": {"reputation": 1320, "user_id": 3538313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cbc08db98f4175e0da37edeea4116f0?s=128&d=identicon&r=PG", "display_name": "JHS", "link": "https://stackoverflow.com/users/3538313/jhs"}, "edited": false, "score": 3, "creation_date": 1564890114, "post_id": 57339669, "comment_id": 101175348, "body": "Unfortunately I think this is a limitation of the language&#39;s debugging tools: <a href=\"https://github.com/Microsoft/vscode-go/issues/2225\" rel=\"nofollow noreferrer\">github.com/Microsoft/vscode-go/issues/2225</a>  It seems like pretty basic debugging functionality to be missing..."}, {"owner": {"reputation": 353, "user_id": 8389508, "user_type": "registered", "profile_image": "https://graph.facebook.com/1761147723900225/picture?type=large", "display_name": "\u77f3\u8352\u4eba", "link": "https://stackoverflow.com/users/8389508/%e7%9f%b3%e8%8d%92%e4%ba%ba"}, "reply_to_user": {"reputation": 1320, "user_id": 3538313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cbc08db98f4175e0da37edeea4116f0?s=128&d=identicon&r=PG", "display_name": "JHS", "link": "https://stackoverflow.com/users/3538313/jhs"}, "edited": false, "score": 0, "creation_date": 1564928133, "post_id": 57339669, "comment_id": 101182335, "body": "Thanks...that is amazing"}], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 6107769, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d5e6f02e5a4314b50f053f6f02eaf77?s=128&d=identicon&r=PG&f=1", "display_name": "Deine Freunde", "link": "https://stackoverflow.com/users/6107769/deine-freunde"}, "is_accepted": false, "score": 5, "last_activity_date": 1573056389, "last_edit_date": 1573056389, "creation_date": 1572991751, "answer_id": 58720227, "question_id": 57339669, "link": "https://stackoverflow.com/questions/57339669/how-do-i-evaluate-expressions-while-debugging-in-vs-code/58720227#58720227", "title": "How do I evaluate expressions while debugging in VS Code?", "body": "<p>This isn't possible right now as more complex evaluations have only been added to the Delve debugger recently. You might want to follow these two Github issues:</p>\n\n<p><a href=\"https://github.com/go-delve/delve/issues/119#issuecomment-470589828\" rel=\"noreferrer\">Add ability to safely call functions #119</a></p>\n\n<p><a href=\"https://github.com/microsoft/vscode-go/issues/2655\" rel=\"noreferrer\">Function calls via delve 'call' are not supported #2655</a></p>\n"}, {"comments": [{"owner": {"reputation": 95, "user_id": 8845509, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HBKhV4EJFQ8/AAAAAAAAAAI/AAAAAAAAABk/cF-BHi84-2I/photo.jpg?sz=128", "display_name": "Denis Barzanov", "link": "https://stackoverflow.com/users/8845509/denis-barzanov"}, "edited": false, "score": 0, "creation_date": 1609873850, "post_id": 65565376, "comment_id": 115956529, "body": "I added this to the Debug Console and it worked: <code>functioToBeCalled(arg1, arg2)</code>"}, {"owner": {"reputation": 353, "user_id": 8389508, "user_type": "registered", "profile_image": "https://graph.facebook.com/1761147723900225/picture?type=large", "display_name": "\u77f3\u8352\u4eba", "link": "https://stackoverflow.com/users/8389508/%e7%9f%b3%e8%8d%92%e4%ba%ba"}, "edited": false, "score": 0, "creation_date": 1610354202, "post_id": 65565376, "comment_id": 116096025, "body": "Thanks , I already using jetbrain goland for one year."}, {"owner": {"reputation": 1959, "user_id": 258896, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1051e27bc1498e959047ad62c5d9b2bd?s=128&d=identicon&r=PG", "display_name": "Ed J", "link": "https://stackoverflow.com/users/258896/ed-j"}, "edited": false, "score": 0, "creation_date": 1612847290, "post_id": 65565376, "comment_id": 116887513, "body": "You can also set a property of an object in the debug console:  <code>call myObject.myProperty=&quot;some new property value&quot;</code>"}], "tags": [], "owner": {"reputation": 311, "user_id": 6928599, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cb3azsLpo9w/AAAAAAAAAAI/AAAAAAAAABk/_eMTdU0QIQo/photo.jpg?sz=128", "display_name": "Javier Dottori", "link": "https://stackoverflow.com/users/6928599/javier-dottori"}, "is_accepted": false, "score": 11, "last_activity_date": 1609774588, "creation_date": 1609774588, "answer_id": 65565376, "question_id": 57339669, "link": "https://stackoverflow.com/questions/57339669/how-do-i-evaluate-expressions-while-debugging-in-vs-code/65565376#65565376", "title": "How do I evaluate expressions while debugging in VS Code?", "body": "<p>For the ones coming here at 2020+, it is now possible to call a function. The syntax is:</p>\n<pre><code>call functioToBeCalled(arg1, arg2)\n</code></pre>\n<p>In the question ask for running an assignation, you can also set a variable</p>\n<pre><code>call variable = newValue\n</code></pre>\n<p>Source: <a href=\"https://github.com/golang/vscode-go/issues/100\" rel=\"noreferrer\">https://github.com/golang/vscode-go/issues/100</a></p>\n"}], "owner": {"reputation": 353, "user_id": 8389508, "user_type": "registered", "profile_image": "https://graph.facebook.com/1761147723900225/picture?type=large", "display_name": "\u77f3\u8352\u4eba", "link": "https://stackoverflow.com/users/8389508/%e7%9f%b3%e8%8d%92%e4%ba%ba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8205, "favorite_count": 2, "answer_count": 2, "score": 14, "last_activity_date": 1609774588, "creation_date": 1564845921, "question_id": 57339669, "link": "https://stackoverflow.com/questions/57339669/how-do-i-evaluate-expressions-while-debugging-in-vs-code", "title": "How do I evaluate expressions while debugging in VS Code?", "body": "<p><a href=\"https://i.stack.imgur.com/d0dsb.jpg\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/d0dsb.jpg\" alt=\"enter image description here\"></a>I am using vscode to build my golang gin project.</p>\n\n<p>I go to debugging mod and can not do evaluate expressions.</p>\n\n<p>I want to go some line and evaluate that see what happened in that monent.</p>\n\n<p>Like eclipse ctrl+shift+i or idea ctrl+alt+f8</p>\n\n<p>Quick evaluate expression.</p>\n\n<p>I also see this </p>\n\n<p><a href=\"https://stackoverflow.com/questions/18073545/eclipse-inspection-ctrl-shift-i-equivalent-in-intellij-idea-community-edi\">Eclipse inspection (Ctrl + Shift + I) equivalent in IntelliJ IDEA (Community Edition)</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/30138096/watch-window-or-evaluate-expressions-while-debugging-in-vs-code\">Watch window or evaluate expressions while debugging in VS Code?</a></p>\n\n<p>func main() {</p>\n\n<pre><code>router := gin.Default()\nrouter.GET(\"/user/:name\", func(c *gin.Context) {\n    name := c.Param(\"name\")\n    c.String(http.StatusOK, name, 1, 2, 3, 4)\n\n})\n</code></pre>\n\n<p>when the debugger line in  name := c.Param(\"name\")</p>\n\n<p>I try to use the bottom of vscode window and when I type this code into the command it will return </p>\n\n<p>but if I type name it will return the right string for me.</p>\n\n<p>Failed to eval expression: \n {\n \"Expr\": \"c.Param(\\\"name\\\")\",</p>\n\n<p>\"Scope\": {</p>\n\n<p>\"goroutineID\": 34,</p>\n\n<p>\"frame\": 1\n },</p>\n\n<p>\"Cfg\": {</p>\n\n<p>\"followPointers\": true,</p>\n\n<p>\"maxVariableRecurse\": 1,</p>\n\n<p>\"maxStringLen\": 64,</p>\n\n<p>\"maxArrayValues\": 64,</p>\n\n<p>\"maxStructFields\": -1\n }\n} </p>\n\n<p>Eval error: function calls not allowed without using 'call'</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 862, "user_id": 7806223, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8st4J.gif?s=128&g=1", "display_name": "Mayeru", "link": "https://stackoverflow.com/users/7806223/mayeru"}, "edited": false, "score": 0, "creation_date": 1565083519, "post_id": 57339164, "comment_id": 101230577, "body": "Could you clarify a few things to me? because I&#39;m not sure which is the issue that you are facing. I&#39;m assuming you are working with App Engine standard since is not specified on the app.yaml and you are using &quot;dev_appserver.py&quot; (which only works on standard), correct?.  You have used configured your handlers to handle static files and with an entrypoint (<a href=\"https://cloud.google.com/appengine/docs/standard/go111/config/appref#handlers_script\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/standard/go111/config/&hellip;</a>),  right?."}, {"owner": {"reputation": 862, "user_id": 7806223, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8st4J.gif?s=128&g=1", "display_name": "Mayeru", "link": "https://stackoverflow.com/users/7806223/mayeru"}, "edited": false, "score": 0, "creation_date": 1565083522, "post_id": 57339164, "comment_id": 101230578, "body": "And it works when deployed but it doesn&#39;t handle the urls when using the local server dev_appserver.py <a href=\"https://cloud.google.com/appengine/docs/standard/python/tools/using-local-server\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/standard/python/tools/&hellip;</a>, correct?."}, {"owner": {"reputation": 207, "user_id": 1840362, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8e1a67e796583c9d851688036620a33?s=128&d=identicon&r=PG", "display_name": "jum", "link": "https://stackoverflow.com/users/1840362/jum"}, "reply_to_user": {"reputation": 862, "user_id": 7806223, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8st4J.gif?s=128&g=1", "display_name": "Mayeru", "link": "https://stackoverflow.com/users/7806223/mayeru"}, "edited": false, "score": 0, "creation_date": 1565084212, "post_id": 57339164, "comment_id": 101230973, "body": "Yes, I am working with standard, that is what I am getting if not specifying anything else. I have dependencies on memcache which I am not yet able to resolve otherwise, so I am stuck with go111 runtime. Previously I have been using the go runtime with api version go1. And it does work perfectly deployed with the gcloud command, but debugging locally with dev_appserver.py does not work, it will only serve static content and no handlers are called."}], "answers": [{"comments": [{"owner": {"reputation": 207, "user_id": 1840362, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8e1a67e796583c9d851688036620a33?s=128&d=identicon&r=PG", "display_name": "jum", "link": "https://stackoverflow.com/users/1840362/jum"}, "edited": false, "score": 0, "creation_date": 1565296900, "post_id": 57415305, "comment_id": 101320025, "body": "If I look at the dev_appserver.py docs, it only has a &quot;go&quot; link, there is nothing about versions. And for standard app engine apps, a simple &quot;go run&quot; will not do, as you have none of the local api emulation stuff that dev_appserver.py starts and that is required for any of the standard appengine imports to work, for example you have no local memcache emulation. Memcache is one of the features I cannot remove from my appengine apps, and the 1.12 referral to the redis cloud would be just way to exensive for my small apps."}, {"owner": {"reputation": 207, "user_id": 1840362, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8e1a67e796583c9d851688036620a33?s=128&d=identicon&r=PG", "display_name": "jum", "link": "https://stackoverflow.com/users/1840362/jum"}, "edited": false, "score": 0, "creation_date": 1565348846, "post_id": 57415305, "comment_id": 101335423, "body": "The one running as &quot;develop&quot; version fits my other workflow pretty well, so I can use that for the time being. But not being able to do local testing while offline (e.g. while traveling) is a bummer. I believe I will have to reconsider my decision to go with appengine, as me being a digital nomad having good internet access is an exception, not the norm."}, {"owner": {"reputation": 862, "user_id": 7806223, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8st4J.gif?s=128&g=1", "display_name": "Mayeru", "link": "https://stackoverflow.com/users/7806223/mayeru"}, "reply_to_user": {"reputation": 207, "user_id": 1840362, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8e1a67e796583c9d851688036620a33?s=128&d=identicon&r=PG", "display_name": "jum", "link": "https://stackoverflow.com/users/1840362/jum"}, "edited": false, "score": 0, "creation_date": 1565350094, "post_id": 57415305, "comment_id": 101335989, "body": "Glad to know that the workaround will be able to fit on your workflow"}], "tags": [], "owner": {"reputation": 862, "user_id": 7806223, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8st4J.gif?s=128&g=1", "display_name": "Mayeru", "link": "https://stackoverflow.com/users/7806223/mayeru"}, "is_accepted": false, "score": 0, "last_activity_date": 1565338205, "last_edit_date": 1565338205, "creation_date": 1565275654, "answer_id": 57415305, "question_id": 57339164, "link": "https://stackoverflow.com/questions/57339164/dev-appserver-py-with-runtime-go111-url-dispatch-problem/57415305#57415305", "title": "dev_appserver.py with runtime go111 url dispatch problem", "body": "<p>Your question is why your application works well when you deploy it to production but doesn't work when you use <strong>dev_appserver.py</strong> to run it locally, and how could you run it with <strong>dev_appserver.py</strong>. The answer to that is:</p>\n\n<p>You won't be able to run it locally properly using <strong>dev_appserver.py</strong>, since it does not support runtime Go 1.11. Look at the <a href=\"https://cloud.google.com/appengine/docs/standard/go/tools/local-devserver-command\" rel=\"nofollow noreferrer\">Local Development Server Options</a> documentation, there's only a link for \"Go 1.9\".</p>\n\n<p><a href=\"https://i.stack.imgur.com/d3uaA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/d3uaA.png\" alt=\"enter image description here\"></a></p>\n\n<p><em>(as you can see, the links for \"Go 1.11\" and \"Go 1.12\" are disabled, which translates to: not supported.)</em></p>\n\n<p><a href=\"https://cloud.google.com/appengine/docs/standard/go111/testing-and-deploying-your-app\" rel=\"nofollow noreferrer\">Documentation for Go 1.11</a> on App Engine Standard states that in order to test your application locally you would have to use \"go run\" command (notice how it doesn't mention dev_appserver.py tool). The command would be something like this:</p>\n\n<pre><code>go run [build flags] [-exec xprog] package [arguments...]\n</code></pre>\n\n<p>For more information about the command go <a href=\"https://golang.org/cmd/go/#hdr-Compile_and_run_Go_program\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>I'm sure you might have already read this but, to know more about the migrations process from Go1.9 to Go1.11 read this <a href=\"https://cloud.google.com/appengine/docs/standard/go111/go-differences\" rel=\"nofollow noreferrer\">documentation</a>.</p>\n\n<p>You have stated that \"go run\" command wouldn't work for your case. So, a workaround for that would be to <a href=\"https://cloud.google.com/appengine/docs/standard/go111/testing-and-deploying-your-app\" rel=\"nofollow noreferrer\">test your application directly into App Engine</a> but <strong>without migrating the traffic</strong>. </p>\n\n<p>When deploying your test version use:</p>\n\n<pre><code>gcloud app deploy --no-promote\n</code></pre>\n\n<p>To access to it go to:</p>\n\n<pre><code>http://VERSION_ID.default.YOUR_PROJECT_ID.appspot.com\n</code></pre>\n\n<p>If everything turned out great, you can migrate the traffic on the <a href=\"https://console.cloud.google.com/appengine/versions?_ga=2.39258597.-730435798.1562054471&amp;_gac=1.251391666.1562054529.EAIaIQobChMI76nYrOKV4wIVyRnTCh0yMw7YEAAYASAAEgJGvPD_BwE\" rel=\"nofollow noreferrer\">Cloud Console UI</a> selecting the version you just deployed and clicking \"<strong>Migrate traffic</strong>\". </p>\n"}], "owner": {"reputation": 207, "user_id": 1840362, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8e1a67e796583c9d851688036620a33?s=128&d=identicon&r=PG", "display_name": "jum", "link": "https://stackoverflow.com/users/1840362/jum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 161, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565338205, "creation_date": 1564842089, "question_id": 57339164, "link": "https://stackoverflow.com/questions/57339164/dev-appserver-py-with-runtime-go111-url-dispatch-problem", "title": "dev_appserver.py with runtime go111 url dispatch problem", "body": "<p>I am still working to get my old style appengines to work under at least go111 (go112 would not work due to dependencies on memcache). I am now stumbling over app.yaml configuration issues with my static files, I used a completely static directory layout before and just specified a few dynamic handlers in the root like this:</p>\n\n<pre><code>runtime: go111\n\nhandlers:\n- url: /_ah/.*\n script: auto\n login: admin\n secure: always\n- url: /dynamic\n script: auto\n secure: always\n- url: /admin/.*\n script: auto\n login: admin\n secure: always\n- url: (.*)/\n static_files: html\\1/index.html\n upload: html/index.html\n secure: always\n- url: /(.*\\.map)\n mime_type: application/json\n static_files: html/\\1\n upload: html/(.*\\.map)\n secure: always\n- url: /\n static_dir: html\n secure: always\n</code></pre>\n\n<p>dev_appserver.py will never call my dynamic entry point. In production this does work, but I am still working on the conversion and would like to test locally. Any hints how to convince dev_appserver.py to let me do this? By the way my gcloud tools are updated as of today.</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 2, "creation_date": 1564836589, "post_id": 57338387, "comment_id": 101165511, "body": "What exactly do you have problems with? Do you get the wrong behaviour? Or an error? if so, what does it say? The <code>replace</code> directive should work (I use it frequently), but your <code>require</code> directive is missing a version though (add e.g. <code>latest</code> at the end), so perhaps that is your problem?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1564836972, "post_id": 57338387, "comment_id": 101165611, "body": "The replace directive refers to a path that doesn&#39;t exist (the go/src segments are missing)."}, {"owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1564837244, "post_id": 57338387, "comment_id": 101165663, "body": "@MartinTournoij I got many weird problems. I have added latest, but it doesn&#39;t work either. I am using vscode. In the beginning, it complains &quot;no file parsed....&quot; in vscode. And then after adding require and replace, the vscode just failed parse the main.go at all. It complains &quot;No symbols found in document main.go&quot;. If I try to run <code>go build</code>, it will complain <code>invalid module version &quot;latest&quot;: malformed module path:</code> and <code>replace module&#47;path [v1.2.3] =&gt; ..&#47;local&#47;directory</code>."}, {"owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1564837307, "post_id": 57338387, "comment_id": 101165676, "body": "@Peter I just typed the question by hand. My actual env uses the correct path because I always use <code>pwd</code> to copy &amp; paste path. Please refer to the previous comment for more details. Thanks."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1564837315, "post_id": 57338387, "comment_id": 101165679, "body": "Your <code>replace</code> line is not formatted correctly, it should contain <code>=&gt;</code>. Instead of editing <code>go.mod</code> by hand you can use <code>go mod edit -replace fakedomain.com&#47;fakeuser&#47;foo=&#47;home&#47;user&#47;go&#47;src&#47;fakedomain.com&zwnj;&#8203;&#47;fakeuser&#47;foo</code> and the correct line will be added."}, {"owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1564839149, "post_id": 57338387, "comment_id": 101166070, "body": "@MartinTournoij I made it work. (1) latest doesn&#39;t work. It has to be v0.0.0. and (2) I also need to create go.mod inside the foo package. (3) <code>=&gt;</code> is also missing for replace. So many problems. Thank you very much for your help. The version part is correct."}, {"owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1564839246, "post_id": 57338387, "comment_id": 101166090, "body": "@DaveC you are right. I missed <code>=&gt;</code>. Actually, there were three problems. (1) I have to provide a version v0.0.0. and (2) I also need to create go.mod inside the foo package. (3) <code>=&gt;</code> is missing as you suggested. So many problems. Thank you very much for your help."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1564841400, "post_id": 57338860, "comment_id": 101166642, "body": "Is Vscode using modules at all? If you\u2019re in ~go/src it\u2019s going to default to GOPATH"}, {"owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1564846744, "post_id": 57338860, "comment_id": 101167952, "body": "@JimB I don&#39;t quite understand your question, VScode uses modules because ~/go/src is just a third party package that I want to import and the actual project I am coding is at ~/some_path/goapp/go.mod."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1564849743, "post_id": 57338860, "comment_id": 101168739, "body": "Got it, that\u2019s what I was confirming, since it would also explain the different errors. They also may have come from fmt or vet depending on what\u2019s run first."}], "tags": [], "owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "is_accepted": true, "score": 1, "last_activity_date": 1564840285, "last_edit_date": 1564840285, "creation_date": 1564839652, "answer_id": 57338860, "question_id": 57338387, "link": "https://stackoverflow.com/questions/57338387/is-that-possible-to-import-a-local-package-inside-go-src-from-a-module/57338860#57338860", "title": "Is that possible to import a local package inside ~/go/src/ from a module?", "body": "<p>Thank @MartinTournoij, @Peter, @DaveC very much for their help and comments <em>which I have upvoted</em>. After following all the directions, I finally make it work. </p>\n\n<p><em>(Btw, I really shouldn't trust VSCode error message too much. Because I normally check errors from VSCode. Thus I didn't try <code>go build</code> before asking this question. I thought they should return the same error, but they are not. <code>go build</code> provides more reasonable error messages than VSCode.)</em></p>\n\n<p>There were three problems.</p>\n\n<ul>\n<li>Missing version from <code>require</code> in go.mod</li>\n<li>Missing <code>=&gt;</code> from <code>replace</code> in go.mod</li>\n<li>Missing <code>go.mod</code> for <code>foo</code> package. </li>\n</ul>\n\n<p>So to make it work:</p>\n\n<p>File Structure:</p>\n\n<pre><code>~/some_path/goapp/go.mod\n~/some_path/goapp/go.sum\n~/some_path/goapp/main.go\n\n~/go/src/fakedomain.com/fakeuser/foo/foo.go\n~/go/src/fakedomain.com/fakeuser/foo/go.mod\n</code></pre>\n\n<p>~/some_path/goapp/go.mod:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>...\nrequire fakedomain.com/fakeuser/foo v0.0.0\nreplace fakedomain.com/fakeuser/foo =&gt; /home/user/go/src/fakedomain.com/fakeuser/foo\n</code></pre>\n\n<p>main.go:</p>\n\n<pre><code>package main\nimport fakedomain.com/fakeuser/foo\n...\n</code></pre>\n\n<p>~/go/src/fakedomain.com/fakeuser/foo/go.mod:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>module fakedomain.com/fakeuser/foo\n\ngo 1.12\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "edited": false, "score": 0, "creation_date": 1564900181, "post_id": 57344213, "comment_id": 101176720, "body": "Thanks for the info. I understand how to use module alone. I also provided an answer by myself yesterday which you probably saw. My question is not how to use go module. From the question title, my question is how to import a local package which is inside ~/go/src/. Without modules in the old days, I can simply import package directly when everything are inside ~/go/src/. But with modules, I can&#39;t. That&#39;s why I need to provide a new go.mod for packages in ~/go/src/ and <code>replace</code> in go.mod for the local path. I am not a native English speaker. hopefully, my words make sense to u. Thanks."}], "tags": [], "owner": {"reputation": 114, "user_id": 8296461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aee2fcc9ebbee078c749f33fbb1bf795?s=128&d=identicon&r=PG&f=1", "display_name": "Sumukha Pk", "link": "https://stackoverflow.com/users/8296461/sumukha-pk"}, "is_accepted": false, "score": -1, "last_activity_date": 1564898577, "creation_date": 1564898577, "answer_id": 57344213, "question_id": 57338387, "link": "https://stackoverflow.com/questions/57338387/is-that-possible-to-import-a-local-package-inside-go-src-from-a-module/57344213#57344213", "title": "Is that possible to import a local package inside ~/go/src/ from a module?", "body": "<p>I'll clearly explain how to use <code>go.mod</code> now, follow this and you should be able to get it working.</p>\n\n<p>This is my directory setup (modify using yours accordingly):\n<code>my_name/git/Project</code></p>\n\n<p>As you start a project in ..../Project, do <code>go mod init /whatever-directory-youre-in/Project</code>. This will add <code>go.mod</code> and <code>go.sum</code> in the same directory. </p>\n\n<p>Now every import can be of the form,\n<code>import /whatever-directory-youre-in/Project/whatever-package</code></p>\n\n<p>That must do! </p>\n"}], "owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 791, "favorite_count": 0, "closed_date": 1565961125, "accepted_answer_id": 57338860, "answer_count": 2, "score": 0, "last_activity_date": 1567294520, "creation_date": 1564836008, "last_edit_date": 1567294520, "question_id": 57338387, "link": "https://stackoverflow.com/questions/57338387/is-that-possible-to-import-a-local-package-inside-go-src-from-a-module", "closed_reason": "Not suitable for this site", "title": "Is that possible to import a local package inside ~/go/src/ from a module?", "body": "<p>I am using go module, the file structure is like this:</p>\n\n<pre><code>~/some_path/goapp/go.mod\n~/some_path/goapp/go.sum\n~/some_path/goapp/main.go\n\n~/go/src/fakedomain.com/fakeuser/foo/foo.go\n</code></pre>\n\n<p>Inside <code>main.go</code>, I tried to do</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import fakedomain.com/fakeuser/foo\n</code></pre>\n\n<p>But, it doesn't work at all. \nI tried to add the following to go.mod:</p>\n\n<pre><code>require fakedomain.com/fakeuser/foo \n</code></pre>\n\n<p>OR</p>\n\n<pre><code>require fakedomain.com/fakeuser/foo\nreplace fakedomain.com/fakeuser/foo /home/user/go/src/fakedomain.com/fakeuser/foo\n</code></pre>\n\n<p>None of them works. How can I achieve this? </p>\n\n<h2>Edited</h2>\n\n<p>This question is about how to import a <strong>local</strong> package <strong>inside ~/go/src/</strong> from a module which is <strong>outside ~/go/src/</strong>. </p>\n\n<p>In other words, the module which is outside ~/go/src/ will import a local package inside ~/go/src/. I thought I could import it directly (that is what I did in the old days without module), but I was wrong. It turns out that I have to make the local package inside ~/go/src/ become a module too.</p>\n"}, {"tags": ["go", "web-applications", "redis", "project-structure", "redigo"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1564836763, "post_id": 57338171, "comment_id": 101165558, "body": "I think you&#39;re looking for the <code>INCR</code> command? Possible dupe of: <a href=\"https://stackoverflow.com/q/24028171/660921\">stackoverflow.com/q/24028171/660921</a> \u2013 You might be better off using GUIDs if you want a globally unique identifier btw, since you won&#39;t have to worry about race conditions where two objects will have the same ID."}, {"owner": {"reputation": 47, "user_id": 8604002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/674da8871bdd698d2f94e545139118de?s=128&d=identicon&r=PG&f=1", "display_name": "chameleon123", "link": "https://stackoverflow.com/users/8604002/chameleon123"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1564838941, "post_id": 57338171, "comment_id": 101166038, "body": "Yes, I&#39;m looking for the same thing but wondering how to implement it using redigo.(I prefer to bulk insert my array of struct). Plus I&#39;m wondering how to retrieve all values as well."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1564839780, "post_id": 57338171, "comment_id": 101166218, "body": "Redigo is a very thin wrapper around Redis and little more than a fancy API to send text commands to Redis. What specifically are you having problems with? It would be helpful if you could share some of the code you have (<a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>)."}, {"owner": {"reputation": 47, "user_id": 8604002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/674da8871bdd698d2f94e545139118de?s=128&d=identicon&r=PG&f=1", "display_name": "chameleon123", "link": "https://stackoverflow.com/users/8604002/chameleon123"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1564840945, "post_id": 57338171, "comment_id": 101166507, "body": "I added the code snippet above. My problem is what to place in the key field? &quot;INCR&quot;? The object is a rectangle with x,y start coordination and its width and height."}, {"owner": {"reputation": 47, "user_id": 8604002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/674da8871bdd698d2f94e545139118de?s=128&d=identicon&r=PG&f=1", "display_name": "chameleon123", "link": "https://stackoverflow.com/users/8604002/chameleon123"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1564842072, "post_id": 57338171, "comment_id": 101166808, "body": "And if I pass my array as bulk, will it understand to divide it in objects and assign the appropriate keys?"}, {"owner": {"reputation": 47, "user_id": 8604002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/674da8871bdd698d2f94e545139118de?s=128&d=identicon&r=PG&f=1", "display_name": "chameleon123", "link": "https://stackoverflow.com/users/8604002/chameleon123"}, "edited": false, "score": 0, "creation_date": 1564844640, "post_id": 57338171, "comment_id": 101167417, "body": "I tried my best to clarify the problem :)"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1564845129, "post_id": 57338171, "comment_id": 101167549, "body": "A <a href=\"https://redis.io/topics/data-types#lists\" rel=\"nofollow noreferrer\">list</a> meets the requirements set forth in the question.  Add rectangle:  <code>_, err := c.Do(&quot;RPUSH&quot;, &quot;rectangles&quot;, rectJSON)</code>.  Get all rectangles:  <code>rectJSONs, err := redis.ByteSlices(c.Do(&quot;LRANGE&quot; &quot;rectangles&quot;, 0, -1))</code>"}, {"owner": {"reputation": 47, "user_id": 8604002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/674da8871bdd698d2f94e545139118de?s=128&d=identicon&r=PG&f=1", "display_name": "chameleon123", "link": "https://stackoverflow.com/users/8604002/chameleon123"}, "edited": false, "score": 0, "creation_date": 1564857351, "post_id": 57338171, "comment_id": 101170504, "body": "Thank you, it worked. Just needed another conversion after getting byte slices."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1564895050, "creation_date": 1564895050, "answer_id": 57343955, "question_id": 57338171, "link": "https://stackoverflow.com/questions/57338171/is-there-any-auto-incremention-machanim-for-storing-keys-values-in-redis-with-r/57343955#57343955", "title": "Is there any auto incremention machanim for storing keys&#39; values in redis with redigo wrapper?", "body": "<p>A <a href=\"https://redis.io/topics/data-types#lists\" rel=\"nofollow noreferrer\">list</a> meets the requirements set forth in the question. </p>\n\n<p>Add rectangle: </p>\n\n<pre><code> _, err := c.Do(\"RPUSH\", \"rectangles\", rectJSON). \n</code></pre>\n\n<p>Get all rectangles: </p>\n\n<pre><code>rectJSONs, err := redis.ByteSlices(c.Do(\"LRANGE\" \"rectangles\", 0, -1))\nif err != nil {\n   // handle error\n}\nvar rectangles []*Rectangle\nfor _, rj := range rectJSONS {\n   var r Rectangle\n   if err := json.Unmarshal(rj, &amp;r); err != nil {\n       // handle error\n   }\n   rectangles = append(rectangles, &amp;r)\n}\n</code></pre>\n"}], "owner": {"reputation": 47, "user_id": 8604002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/674da8871bdd698d2f94e545139118de?s=128&d=identicon&r=PG&f=1", "display_name": "chameleon123", "link": "https://stackoverflow.com/users/8604002/chameleon123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 57343955, "answer_count": 1, "score": 0, "last_activity_date": 1565099875, "creation_date": 1564834077, "last_edit_date": 1565099875, "question_id": 57338171, "link": "https://stackoverflow.com/questions/57338171/is-there-any-auto-incremention-machanim-for-storing-keys-values-in-redis-with-r", "title": "Is there any auto incremention machanim for storing keys&#39; values in redis with redigo wrapper?", "body": "<p>I'm new to go programming language and just wanted to write a small web app project with a good architecture. </p>\n\n<p>I get some specific recangle objects through a post request.</p>\n\n<pre><code>type Rectangle struct {\nX         int //starting x coordinate\nY         int //starting y coordinate\nWidth     int\nHeight    int\nCreatedAt time.Time\n}\n</code></pre>\n\n<p>I decided to choose redis for storing because it has high performance and I wanted to get my hands on that.</p>\n\n<p>I have a bit confusion here :</p>\n\n<ol>\n<li><p>There is no specific key in the object's nature for storing, so I came up with the idea of auto incremention of keys but still stuck how to that because as I studied the pattern for insertion, it's something like:</p>\n\n<pre><code>json, err := json.Marshal(rectangle)\nif err != nil {\n    return err\n}\n\n_, err = connection.Do(\"SET\", key, json)\nif err != nil {\n    return err\n}\n</code></pre></li>\n</ol>\n\n<p>As you can see, I'm stuck what to write in the key field. I saw the Redis commands \"INCR\"  but it seems none make sense for this pattern.</p>\n\n<ol start=\"2\">\n<li>If I want to get all rectangles regardless of their keys, will <code>connection.Do(\"HGETALL\", \"*\", rectangles[])</code> command help me get an array of all rectangles in the databse?</li>\n</ol>\n"}]