[{"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": false, "score": 0, "last_activity_date": 1556149149, "last_edit_date": 1556149149, "creation_date": 1556148846, "answer_id": 55839900, "question_id": 55839450, "link": "https://stackoverflow.com/questions/55839450/how-to-write-a-function-that-accepts-any-map/55839900#55839900", "title": "How to write a function that accepts any map", "body": "<p>Map types in Go are not <a href=\"https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)\" rel=\"nofollow noreferrer\">covariant</a>, and therefore not assignment compatible. Moreover, the empty interface, <code>interface{}</code>, does not provide generics. In Go v1, your <code>KeyExists</code> function must be implemented for each concrete map type you wish to inspect.</p>\n\n<p>Less formally, given a map of type <code>map[int]int</code>, it is not possible to assign to a map whose key or element types are dissimilar, such as <code>map[interface{}]interface{}</code>. This holds even if the underlying key or element types are themselves mutually assignable (e.g. it is possible to assign a value of type <code>int</code> to a value of type <code>interface{}</code>).</p>\n\n<p>Note that you <em>can</em> assign any map to a value of type <code>interface{}</code> (<a href=\"https://play.golang.org/p/93Z8IUxoa8o\" rel=\"nofollow noreferrer\">example</a>), because all types implement the empty interface. Such assignments are permitted according to the language spec's rules on <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">assignability</a>. However, this is unlikely to be helpful.</p>\n"}], "owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 165, "favorite_count": 0, "closed_date": 1556148683, "answer_count": 1, "score": -2, "last_activity_date": 1556149149, "creation_date": 1556145182, "last_edit_date": 1556148642, "question_id": 55839450, "link": "https://stackoverflow.com/questions/55839450/how-to-write-a-function-that-accepts-any-map", "closed_reason": "Duplicate", "title": "How to write a function that accepts any map", "body": "<p>I tried writing this:</p>\n\n<pre><code>func KeyExists(m map[interface{}]interface{}, k interface{}) bool {\n    if _, ok := m[k]; ok {\n        return true\n    }\n    return false\n}\n</code></pre>\n\n<p>When trying to run this with an <code>m[int]int</code>, I get: </p>\n\n<pre><code>cannot use xxx (type map[int]int) as type map[interface {}]interface {} in argument to KeyExists\n</code></pre>\n\n<p>Why? From this: <a href=\"https://stackoverflow.com/questions/40145569/how-do-you-make-a-function-accept-multiple-types-in-go\">How do you make a function accept multiple types in go?</a>\nI infer that interface{} should work here. </p>\n\n<p>The error message is half helpful and half annoying, since it states I cannot do something but not why. </p>\n"}, {"tags": ["go", "terraform"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556211008, "post_id": 55838137, "comment_id": 98369825, "body": "In order for the OS to execute the binary, it needs to be in the filesystem. Are you just looking to store the binary until runtime? There are a ton of packages for embedding assets in your binary."}, {"owner": {"reputation": 705, "user_id": 1645251, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/Mw0FR.png?s=128&g=1", "display_name": "s_mart", "link": "https://stackoverflow.com/users/1645251/s-mart"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556218501, "post_id": 55838137, "comment_id": 98373221, "body": "I found a couple to store static assets in go binary. However, I&#39;m new to Go, so don&#39;t quite understand how can I call that binary from inside go code."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556218568, "post_id": 55838137, "comment_id": 98373259, "body": "That&#39;s not really a go specific issue, you ned to put the binary somewhere in the filesystem so it can be executed."}], "owner": {"reputation": 705, "user_id": 1645251, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/Mw0FR.png?s=128&g=1", "display_name": "s_mart", "link": "https://stackoverflow.com/users/1645251/s-mart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556137981, "creation_date": 1556137981, "question_id": 55838137, "link": "https://stackoverflow.com/questions/55838137/build-in-external-binary-embedded-in-custom-terraform-provider", "title": "Build-in external binary embedded in custom Terraform provider", "body": "<p>I'm currently creating private Terraform provider that is required to make calls to external binary (PEX file) via <code>exec.Command</code></p>\n\n<p>If make very short example:</p>\n\n<pre><code>func resourceCreate(d *schema.ResourceData, m interface{}) error {\n   ...\n   cmd := exec.Command(\"./custom-pex-file\", arg...)\n   ...\n}\n</code></pre>\n\n<p>I'm wondering what is correct and easy way to build-in this custom PEX file in final binary that would be compiled by go compiler. </p>\n"}, {"tags": ["go", "goroutine", "channels"], "comments": [{"owner": {"reputation": 1374, "user_id": 3398271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c998619fa2ed255eec79fed92f3c2edd?s=128&d=identicon&r=PG&f=1", "display_name": "Attilio", "link": "https://stackoverflow.com/users/3398271/attilio"}, "edited": false, "score": 0, "creation_date": 1556192507, "post_id": 55835457, "comment_id": 98358748, "body": "@downvoter: care to elaborate what is the problem with this question? Maybe I can try to improve it."}], "answers": [{"comments": [{"owner": {"reputation": 1374, "user_id": 3398271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c998619fa2ed255eec79fed92f3c2edd?s=128&d=identicon&r=PG&f=1", "display_name": "Attilio", "link": "https://stackoverflow.com/users/3398271/attilio"}, "edited": false, "score": 0, "creation_date": 1556126906, "post_id": 55835541, "comment_id": 98335517, "body": "Thanks, I just arrived to this conclusion too after looking at the code again :)"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 4, "last_activity_date": 1556126862, "creation_date": 1556126862, "answer_id": 55835541, "question_id": 55835457, "link": "https://stackoverflow.com/questions/55835457/main-function-not-waiting-for-channel-read-before-exiting/55835541#55835541", "title": "main function not waiting for channel read before exiting?", "body": "<p>What you see in stdout isn't the same as what's happening. Sometimes, <code>main</code> receives from <code>plates</code> and then returns before the print statement happens. So:</p>\n\n<pre><code>plate &lt;- true\nleft &lt;- true    // On this line or on\nright &lt;- true   // this line, main receives from plate and then returns before\nfmt.Printf(\"Philosopher # %d finished eating\\n\", id) // this line executes\n</code></pre>\n\n<p>Because concurrency isn't deterministic, this doesn't happen every time. Sometimes the print happens before <code>main</code> returns, sometimes it doesn't. That doesn't mean the channel read isn't happening.</p>\n"}, {"tags": [], "owner": {"reputation": 928, "user_id": 4178151, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Mc3LvwUnV7I/AAAAAAAAAAI/AAAAAAAAAEY/xWbiW0DzNao/photo.jpg?sz=128", "display_name": "nikkon226", "link": "https://stackoverflow.com/users/4178151/nikkon226"}, "is_accepted": false, "score": 2, "last_activity_date": 1556126927, "creation_date": 1556126927, "answer_id": 55835562, "question_id": 55835457, "link": "https://stackoverflow.com/questions/55835457/main-function-not-waiting-for-channel-read-before-exiting/55835562#55835562", "title": "main function not waiting for channel read before exiting?", "body": "<p>Actually, the channel is read 5 times, but since the main function is only waiting for the channel to be read for the 5th time, it exits before the philos function gets to this line:</p>\n\n<pre><code>fmt.Printf(\"Philosopher # %d finished eating\\n\", id)`\n</code></pre>\n\n<p>In order for it to print this correctly, you would need to run this line before you write to the plate channel.</p>\n"}], "owner": {"reputation": 1374, "user_id": 3398271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c998619fa2ed255eec79fed92f3c2edd?s=128&d=identicon&r=PG&f=1", "display_name": "Attilio", "link": "https://stackoverflow.com/users/3398271/attilio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 55835541, "answer_count": 2, "score": -1, "last_activity_date": 1556149008, "creation_date": 1556126478, "last_edit_date": 1556149008, "question_id": 55835457, "link": "https://stackoverflow.com/questions/55835457/main-function-not-waiting-for-channel-read-before-exiting", "title": "main function not waiting for channel read before exiting?", "body": "<p>Consider the following attempt to implement <a href=\"https://en.wikipedia.org/wiki/Dining_philosophers_problem\" rel=\"nofollow noreferrer\">Dining Philosophers</a> with Go routines and channels.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc philos(id int, left, right, plate chan bool) {\n    fmt.Printf(\"Philosopher # %d wants to eat\\n\", id) \n    &lt;-left\n    &lt;-right\n    plate &lt;- true\n    left &lt;- true\n    right &lt;- true\n    fmt.Printf(\"Philosopher # %d finished eating\\n\", id) \n}\n\nfunc main() {\n    const numPhilos = 5 \n    var forks [numPhilos]chan bool\n    for i := 0; i &lt; numPhilos; i++ {\n        forks[i] = make(chan bool, 1)\n        forks[i] &lt;- true\n    }   \n    plates := make(chan bool)\n    for i := 0; i &lt; numPhilos; i++ {\n        go philos(i, forks[(i-1+numPhilos)%numPhilos], forks[(i+numPhilos)%numPhilos], plates)\n    }   \n    for i := 0; i &lt; numPhilos; i++ {\n        &lt;-plates\n    }   \n}\n</code></pre>\n\n<p>Sometimes this works as expected, i.e. all philosophers eat, e.g.:</p>\n\n<pre><code>Philosopher # 4 wants to eat\nPhilosopher # 3 wants to eat\nPhilosopher # 2 wants to eat\nPhilosopher # 1 wants to eat\nPhilosopher # 4 finished eating\nPhilosopher # 3 finished eating\nPhilosopher # 2 finished eating\nPhilosopher # 1 finished eating\nPhilosopher # 0 wants to eat\nPhilosopher # 0 finished eating\n</code></pre>\n\n<p>However, sometimes, one (or more) philosophers are missed (e.g. Philosopher #0, did not eat in the following case):</p>\n\n<pre><code>Philosopher # 4 wants to eat\nPhilosopher # 1 wants to eat\nPhilosopher # 3 wants to eat\nPhilosopher # 2 wants to eat\nPhilosopher # 4 finished eating\nPhilosopher # 0 wants to eat\nPhilosopher # 2 finished eating\nPhilosopher # 1 finished eating\nPhilosopher # 3 finished eating\n</code></pre>\n\n<p><strong>Question is</strong>: <em>why</em> does this happen?</p>\n\n<p>What I already know:</p>\n\n<ol>\n<li><p>The program will exit if the <code>main</code> go routine finished (even if some other routines are still running).</p></li>\n<li><p>A go routine will block if it tries to read from a channel, and that channel is empty (i.e. no-one wrote to it previously).</p></li>\n</ol>\n\n<p>Now, <code>main</code> tries to read 5 times from the channel <code>plates</code>, therefore it should not terminate until the <code>philos</code> routine has run five times. But it seems it somehow still manages to terminate before doing that. Am I missing something? (It seems that <code>plates</code> was read only 4 times.)</p>\n\n<p><strong>EDIT</strong>: Ok, after thinking about it a bit more, I came to the conclusion, that maybe the <code>philos</code> routine does always run 5 times, however, it can be interrupted <strong>before</strong> having the time to print that the philosopher ate. Indeed, if I change the order as follows, it seems to be working always:</p>\n\n<pre><code>func philos(id int, left, right, plate chan bool) {\n    fmt.Printf(\"Philosopher # %d wants to eat\\n\", id) \n    &lt;-left\n    &lt;-right\n    left &lt;- true\n    right &lt;- true\n    fmt.Printf(\"Philosopher # %d finished eating\\n\", id) \n    plate &lt;- true\n}\n</code></pre>\n\n<p>Still, it would be great if someone could validate this explanation :)</p>\n"}, {"tags": ["go", "mutex"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1556124531, "post_id": 55834776, "comment_id": 98334431, "body": "&quot;the code will not be executed by goroutines but will be used on a server where I&#39;ve tons of concurrent requests&quot; if they&#39;re concurrent, they&#39;re in goroutines. You need to add <code>d.RLock();defer d.RUnlock()</code> to your <code>GetFoo</code> and <code>HasFoo</code> or you risk a data race with reads happening concurrently to writes."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1556124683, "post_id": 55834776, "comment_id": 98334520, "body": "Note though that if you share data, you will have to block on some reads if they happen concurrently to writes. You can&#39;t &quot;block only in AddFoo and RemoveFoo methods&quot;, that&#39;s not how synchronization works."}, {"owner": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556125160, "post_id": 55834776, "comment_id": 98334738, "body": "@Adrian, if you can incorporate your comments into a code in an answer, happy to accept."}], "answers": [{"comments": [{"owner": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "edited": false, "score": 0, "creation_date": 1556126625, "post_id": 55835225, "comment_id": 98335375, "body": "Thanks Adrian, I really appreciate. I&#39;d like to learn more on this sharing memory by communicating, sounds like message passing to me, is there an example link that you can share."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "edited": false, "score": 1, "creation_date": 1556126704, "post_id": 55835225, "comment_id": 98335413, "body": "It is message passing, and there are many ways to accomplish it; I&#39;m not sure of a single link that would give you all the reasonable options but I&#39;m sure a web search would turn up a wealth of information."}, {"owner": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "edited": false, "score": 0, "creation_date": 1556127384, "post_id": 55835225, "comment_id": 98335759, "body": "a slight twist if you don&#39;t mind, if I&#39;ve two maps in <code>type Data{}</code>, the second one being <code>barMap map[string]Bar</code>, with it&#39;s own set of <code>Get</code> and <code>Add</code> methods, how do I lock either one individually?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "edited": false, "score": 0, "creation_date": 1556129182, "post_id": 55835225, "comment_id": 98336540, "body": "Use a separate <code>RWMutex</code> for each map."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "edited": false, "score": 0, "creation_date": 1556129502, "post_id": 55835225, "comment_id": 98336673, "body": "Though if that is your use case, you should at least consider just having two separate types (one for holding <code>Foo</code>s and one for holding <code>Bar</code>s), and composing them into a combined type if you universally use them together. It would probably make them easier to work with in the long run."}, {"owner": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "edited": false, "score": 0, "creation_date": 1556130000, "post_id": 55835225, "comment_id": 98336914, "body": "Your second point is valid, however, I&#39;m porting this library to go and deviating from original is problem for me, I did attempt with <b>edit 2</b>, is that how it&#39;s supposed to be? please review."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "edited": false, "score": 1, "creation_date": 1556132565, "post_id": 55835225, "comment_id": 98338054, "body": "That seems fine, though you might want to go ahead and name both mutexes instead of one being named and one embedded, just to avoid confusion."}, {"owner": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "edited": false, "score": 0, "creation_date": 1556132943, "post_id": 55835225, "comment_id": 98338219, "body": "got it, thanks again, really appreciate your help on this."}, {"owner": {"reputation": 2178, "user_id": 3067964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CvonS.jpg?s=128&g=1", "display_name": "jwells131313", "link": "https://stackoverflow.com/users/3067964/jwells131313"}, "edited": false, "score": 0, "creation_date": 1556155528, "post_id": 55835225, "comment_id": 98344459, "body": "Have you looked at <a href=\"http://github.com/jwells131313/goethe\" rel=\"nofollow noreferrer\">github.com/jwells131313/goethe</a>, which has recursive read/write locks.  We use it for cases just like this"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1556125505, "creation_date": 1556125505, "answer_id": 55835225, "question_id": 55834776, "link": "https://stackoverflow.com/questions/55834776/rw-locks-with-crud-operations/55835225#55835225", "title": "RW locks with CRUD operations", "body": "<blockquote>\n  <p>the code will not be executed by goroutines but will be used on a server where I've tons of concurrent requests</p>\n</blockquote>\n\n<p>If they're concurrent, they're in goroutines - for example, if you're using the <code>net/http</code> server, every request is in its own goroutine. There are no other concurrency mechanisms, so if you've got concurrency, you're using goroutines, even if your code doesn't explicitly start them.</p>\n\n<p>You can't \"block only in AddFoo and RemoveFoo methods\"; that's not how synchronization works. If you share data, you will have to acquire a lock for reads, and you will block on some reads if they happen concurrently to writes. If you don't acquire a lock for reads, you have a race condition.</p>\n\n<pre><code>func (d *Data) GetFoo(name string) Foo {\n    d.RLock()\n    d.RUnlock()\n    return d.fooMap[name]\n}\n</code></pre>\n\n<p>The alternative would be to <em>share memory by communicating</em>. This is a more complex refactor and there are many ways of doing it depending on your specific needs; it's not something I could offer a solution for based on a \"Foo\" type generic example.</p>\n"}], "owner": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 55835225, "answer_count": 1, "score": -1, "last_activity_date": 1556129802, "creation_date": 1556123666, "last_edit_date": 1556129802, "question_id": 55834776, "link": "https://stackoverflow.com/questions/55834776/rw-locks-with-crud-operations", "title": "RW locks with CRUD operations", "body": "<p>I'm not sure if I'm approaching this right, the idea is to have concurrency while reading but lock only when it's writing or updating or deleting. </p>\n\n<pre><code>type Data struct {\n    sync.RWMutex\n    fooMap map[string]Foo\n}\n\nfunc (d *Data) AddFoo(foo Foo) {\n    d.Lock()\n    defer d.Unlock()\n\n    d.fooMap[foo.getName()] = foo\n}\n\nfunc (d *Data) GetFoo(name string) Foo {\n    return d.fooMap[name]\n}\n\nfunc (d *Data) RemoveFoo(name string) Foo {\n    d.Lock()\n    defer d.Unlock()\n\n    var foo = self.fooMap[name]\n    if foo != nil {\n        delete(d.fooMap, name)\n    }\n    return foo\n}\n\nfunc (d *Data) HasFoo(name string) bool {\n    return d.fooMap[name] != nil\n}\n</code></pre>\n\n<p>Looking for an efficient approach where I don't block when I'm reading from the dictionary but block only in <code>AddFoo</code> and <code>RemoveFoo</code> methods.</p>\n\n<p><strong>Edit</strong>\nThe context is slightly different, the code will not be executed by <code>goroutines</code> but will be used on a server where I've tons of concurrent requests going on. </p>\n\n<p><strong>Edit 2</strong> In case of two maps</p>\n\n<pre><code>type Data struct {\n    sync.RWMutex\n    BarMutex sync.RWMutex{}\n    fooMap map[string]Foo\n    barMap map[string]Bar\n}\n\n// for Foo\nfunc (d *Data) AddFoo(foo Foo) {\n    d.Lock()\n    defer d.Unlock()\n\n    d.fooMap[foo.getName()] = foo\n}\n\nfunc (d *Data) GetFoo(name string) Foo {\n    return d.fooMap[name]\n}\n\n// for Bar\nfunc (d *Data) AddBar(bar Bar) {\n    d.BarMutex.Lock()\n    defer d.BarMutex.Unlock()\n\n    d.barMap[bar.getName()] = bar\n}\n\nfunc (d *Data) GetBar(name string) Bar {\n    d.BarMutex.RLock()\n    defer d.BarMutex.RUnlock();\n    return d.barMap[name]\n}\n</code></pre>\n\n<p>Adding some more methods.</p>\n"}, {"tags": ["go", "goroutine", "pprof"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556127538, "post_id": 55834716, "comment_id": 98335839, "body": "I think you&#39;re misreading the profile output. pprof is a sampling profiler, and cannot tell you how long something took, it&#39;s just adding up where in the code the samples were taken. 1.58s doesn&#39;t mean that operation takes that long, it means the program was at that point 1.58s out of the sampled time."}, {"owner": {"reputation": 2716, "user_id": 1087692, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/143e0e17fa2f09f8bd0ba9154bc555e2?s=128&d=identicon&r=PG", "display_name": "tzachs", "link": "https://stackoverflow.com/users/1087692/tzachs"}, "edited": false, "score": 1, "creation_date": 1556129176, "post_id": 55834716, "comment_id": 98336538, "body": "Try counting how many times you enter loop 1 and loop 4, maybe it&#39;s just that you&#39;re hitting the inside of loop 1 many more times than the inside of loop 4."}, {"owner": {"reputation": 71, "user_id": 10613146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QjYg4.jpg?s=128&g=1", "display_name": "cwcing", "link": "https://stackoverflow.com/users/10613146/cwcing"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556129861, "post_id": 55834716, "comment_id": 98336845, "body": "Yes I know pprof is sampling. But I can&#39;t agree with you. If as you said, then I think cpu profile is useless. And in your meaning, then code in a method, the following code&#39;s time must be bigger than the up&#39;s. And the fact is not that. I find how to use pprof from &lt;<a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">blog.golang.org/profiling-go-programs</a>&gt;, and it prove my opinion. I think that though 1.58s is not exact by sampling, but it must be a representation of operation time to a certain extent. Thank you for providing more advise. @JimB"}, {"owner": {"reputation": 71, "user_id": 10613146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QjYg4.jpg?s=128&g=1", "display_name": "cwcing", "link": "https://stackoverflow.com/users/10613146/cwcing"}, "reply_to_user": {"reputation": 2716, "user_id": 1087692, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/143e0e17fa2f09f8bd0ba9154bc555e2?s=128&d=identicon&r=PG", "display_name": "tzachs", "link": "https://stackoverflow.com/users/1087692/tzachs"}, "edited": false, "score": 0, "creation_date": 1556130099, "post_id": 55834716, "comment_id": 98336952, "body": "But from the code&#39;s logic in the Merge method I should speak that you thinking is impossible. the number of hitting the inside of loop 1 only can be lower than or equal to that of loop 4. @tzachs"}, {"owner": {"reputation": 2716, "user_id": 1087692, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/143e0e17fa2f09f8bd0ba9154bc555e2?s=128&d=identicon&r=PG", "display_name": "tzachs", "link": "https://stackoverflow.com/users/1087692/tzachs"}, "edited": false, "score": 0, "creation_date": 1556130211, "post_id": 55834716, "comment_id": 98337007, "body": "@cwcing you should try it regardless to rule it out as an option."}, {"owner": {"reputation": 71, "user_id": 10613146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QjYg4.jpg?s=128&g=1", "display_name": "cwcing", "link": "https://stackoverflow.com/users/10613146/cwcing"}, "reply_to_user": {"reputation": 2716, "user_id": 1087692, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/143e0e17fa2f09f8bd0ba9154bc555e2?s=128&d=identicon&r=PG", "display_name": "tzachs", "link": "https://stackoverflow.com/users/1087692/tzachs"}, "edited": false, "score": 0, "creation_date": 1556161177, "post_id": 55834716, "comment_id": 98345509, "body": "Ok, as you said, I try it by record how many time enter loop1 and loop4 during a benchmark test, and the result is the same as my thinking, the number of loop1 is lower than that of loop4. So things return to the beginning... @tzachs"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556207814, "post_id": 55834716, "comment_id": 98368327, "body": "Looking at the code, this is mostly because of cache invalidation and memory bandwidth. The initial loop (especially with 16Mb arrays) is reading from very different parts of contiguous memory, which means that each read needs to flush what the other read just pulled into the cache. The latter loop is reading sequentially,  which is cache friendly and easily predictable by the CPU."}, {"owner": {"reputation": 71, "user_id": 10613146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QjYg4.jpg?s=128&g=1", "display_name": "cwcing", "link": "https://stackoverflow.com/users/10613146/cwcing"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556213129, "post_id": 55834716, "comment_id": 98370782, "body": "@JimB Thank you very much. I think your explain must be a very possible reason of  my code&#39;s phenomenon."}], "owner": {"reputation": 71, "user_id": 10613146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QjYg4.jpg?s=128&g=1", "display_name": "cwcing", "link": "https://stackoverflow.com/users/10613146/cwcing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 196, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1556123396, "creation_date": 1556123396, "question_id": 55834716, "link": "https://stackoverflow.com/questions/55834716/why-read-and-write-slice-in-multi-goroutine-cost-a-lot-in-go", "title": "Why read and write slice in multi-goroutine cost a lot in go?", "body": "<p>I have written a multi-goroutine version's mergeSort by go, and I also wrote a benchmark test. Now I want to use \"go tool pprof\" to analyze the bottleneck of my code.</p>\n\n<p>When I got the cpu profile, I use \"top10\" in pprof to get the following output:</p>\n\n<pre><code>Showing nodes accounting for 4.73s, 98.54% of 4.80s total\nDropped 21 nodes (cum &lt;= 0.02s)\nShowing top 10 nodes out of 30\n      flat  flat%   sum%        cum   cum%\n     3.66s 76.25% 76.25%      3.66s 76.25%  pingcap/talentplan/tidb/common/alg/sort.Merge\n     0.62s 12.92% 89.17%      0.64s 13.33%  pingcap/talentplan/tidb/mergesort.prepare\n     0.17s  3.54% 92.71%      0.17s  3.54%  runtime.freedefer\n     0.12s  2.50% 95.21%      0.14s  2.92%  pingcap/talentplan/tidb/common/alg/sort.quickSort\n     0.10s  2.08% 97.29%      0.10s  2.08%  runtime.memmove\n     0.03s  0.62% 97.92%      0.03s  0.62%  runtime.memclrNoHeapPointers\n     0.03s  0.62% 98.54%      0.04s  0.83%  runtime.stackpoolalloc\n         0     0% 98.54%      0.11s  2.29%  pingcap/talentplan/tidb/common/alg/sort.MergeSortByMultiGoroutine\n         0     0% 98.54%      0.14s  2.92%  pingcap/talentplan/tidb/common/alg/sort.QuickSort\n         0     0% 98.54%      4.04s 84.17%  pingcap/talentplan/tidb/common/alg/sort.mergeSortByMultiGoroutine\n</code></pre>\n\n<p>From the above, I think that the curious bottleneck is in sort.Merge, so I use \"list Merge\" to dive into the method, and I find the following info:</p>\n\n<pre><code>     .          .     50:func Merge(arr []int64, start int, mid int, end int, tmp []int64)  {\n     .          .     51:   index, i, j := start, start, mid + 1\n  80ms       80ms     52:   for ; i &lt;= mid &amp;&amp; j &lt;= end; index++ {\n 180ms      180ms     53:           if arr[i] &lt;= arr[j] {\n 1.58s      1.58s     54:                   tmp[index] = arr[i]\n  50ms       50ms     55:                   i++\n     .          .     56:           } else {\n 1.52s      1.52s     57:                   tmp[index] = arr[j]\n  20ms       20ms     58:                   j++\n     .          .     59:           }\n     .          .     60:   }\n     .          .     61:   for ; i &lt;= mid; index++ {\n     .          .     62:           tmp[index] = arr[i]\n     .          .     63:           i++\n     .          .     64:   }\n     .          .     65:   for ; j &lt;= end; index++ {\n     .          .     66:           tmp[index] = arr[j]\n     .          .     67:           j++\n     .          .     68:   }\n     .          .     69:\n  60ms       60ms     70:   for i := start; i &lt;= end; i++ {\n 170ms      170ms     71:           arr[i] = tmp[i]\n     .          .     72:   }\n     .          .     73:}\n</code></pre>\n\n<p>What confuse me is here! In the Merge method, there has 4 for-loop. The 1st for-loop and the 4th for-loop's scale is approximately the same, and both of them's task are moving elements from a slice to another slice. And the problem is that why the 1st for-loop cost so much(1.58s plus 1.52s), but the 4th for-loop cost so few(just 170ms)? It's counter-intuitive!</p>\n\n<p>This project's github address is <a href=\"https://github.com/Duncan15/talent-plan/tree/master/tidb/mergesort\" rel=\"nofollow noreferrer\">https://github.com/Duncan15/talent-plan/tree/master/tidb/mergesort</a>. You can use \"make pprof\" to run the benchmark test and get the cpu profile and memory profile.</p>\n\n<p>I want to know why this happen, if you have time, please read my code and give me some advise.</p>\n\n<p>thank you for telling me!!!</p>\n\n<p>I have write some code to verify that when the Merge method run in single-goroutine environment the 1st for-loop's cost is approximately the same with the 4th-for-loop, this seems intuitive. So I think whether the multi-goroutine environment cause the above phenomenon. But in multi-goroutine environment, the Merge method run concurrently. In other word, the 1st for-loop and 4th for-loop run concurrently, if read and write slice concurrently would increase the cost, the 4th for-loop's cost must also increase, but from the pprof output we can find that only the 1st for-loop's cost increase!</p>\n\n<p>And I also write another test to verify my thought. You can use \"make vet\" to run it. this test run the Merge method concurrently. The difference with the multi-goroutine version's mergeSort is that this test has no code about sorting, just merely code about merging. And I surprisingly find that in this test the 1st for-loop's cost is approximately the same with the 4th for-loop's. So finally I am confused completely!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1556116170, "post_id": 55832497, "comment_id": 98329623, "body": "Feed a valid <code>xlsx</code> file to <code>xlsx.OpenFile()</code>. Make sure the file exists, accessible and that it is a valid <code>xlsx</code> file."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1556117145, "post_id": 55832497, "comment_id": 98330301, "body": "Are you sure that this is a valid zip file? You can test by renaming foo.xlsx to foo.zip and using a compression program (unzip, 7zip, etc.) Maybe it got mangled somehow, somewhere?"}], "answers": [{"tags": [], "owner": {"reputation": 315, "user_id": 7995222, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1673672735991407/picture?type=large", "display_name": "Almaida Jody", "link": "https://stackoverflow.com/users/7995222/almaida-jody"}, "is_accepted": false, "score": 0, "last_activity_date": 1618305174, "creation_date": 1618305174, "answer_id": 67071969, "question_id": 55832497, "link": "https://stackoverflow.com/questions/55832497/how-to-fix-zip-not-a-valid-zip-file-error-in-go/67071969#67071969", "title": "How to fix &quot;zip: not a valid zip file&quot; error in Go?", "body": "<p>use this :</p>\n<pre><code>    file, fileHeader, err := req.FormFile(&quot;theAttachmentfile&quot;)\n\n    if err != nil {\n      do what you wanna do\n    }\n\n    xlsx, err := excelize.OpenReader(file)\n    if err != nil {\n      do what you wanna do\n    }\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 7837217, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VHUV9GRy2dw/AAAAAAAAAAI/AAAAAAAAABc/FPBKm_dK_z8/photo.jpg?sz=128", "display_name": "Ph&#250; V\u0103n", "link": "https://stackoverflow.com/users/7837217/ph%c3%ba-v%c4%83n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3206, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1618305174, "creation_date": 1556116084, "last_edit_date": 1556116388, "question_id": 55832497, "link": "https://stackoverflow.com/questions/55832497/how-to-fix-zip-not-a-valid-zip-file-error-in-go", "title": "How to fix &quot;zip: not a valid zip file&quot; error in Go?", "body": "<p>I'm newbie in Golang. I use <a href=\"https://github.com/tealeg/xlsx/\" rel=\"nofollow noreferrer\">a link</a> to  read xlsx file:</p>\n\n<pre><code>    filePath := \"controllers\\\\foo.xlsx\"\nxlFile, err := xlsx.OpenFile(filePath)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>My program run on window os.\nThanks in advance.</p>\n"}, {"tags": ["go", "mime-types", "gorilla", "mux"], "comments": [{"owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "edited": false, "score": 0, "creation_date": 1556116913, "post_id": 55832398, "comment_id": 98330144, "body": "Please provide a short, self-contained example. For example, you do not specify the implementation of <code>ngxMappingHandler</code>."}, {"owner": {"reputation": 21, "user_id": 9481930, "user_type": "registered", "profile_image": "https://graph.facebook.com/1864503013583303/picture?type=large", "display_name": "Dzionys", "link": "https://stackoverflow.com/users/9481930/dzionys"}, "reply_to_user": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "edited": false, "score": 0, "creation_date": 1556118077, "post_id": 55832398, "comment_id": 98330862, "body": "I don&#39;t think it is necessary because <code>ngxMappingHandler</code> works fine after I added gorilla/mux, but css and javascript files does not load."}, {"owner": {"reputation": 2749, "user_id": 1459174, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c58adae9f9fbac6d8cd21da507a03abe?s=128&d=identicon&r=PG", "display_name": "prem30488", "link": "https://stackoverflow.com/users/1459174/prem30488"}, "edited": false, "score": 0, "creation_date": 1587759409, "post_id": 55832398, "comment_id": 108646491, "body": "I am getting the same issue while using react js and ajax-solr"}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 9481930, "user_type": "registered", "profile_image": "https://graph.facebook.com/1864503013583303/picture?type=large", "display_name": "Dzionys", "link": "https://stackoverflow.com/users/9481930/dzionys"}, "is_accepted": true, "score": 0, "last_activity_date": 1556800639, "creation_date": 1556800639, "answer_id": 55952632, "question_id": 55832398, "link": "https://stackoverflow.com/questions/55832398/mime-type-text-plain-mismatch-x-content-type-options-nosniff/55952632#55952632", "title": "MIME type (\u201ctext/plain\u201d) mismatch (X-Content-Type-Options: nosniff)", "body": "<p>Changed this line:</p>\n\n<pre><code>http.Handle(\"/\", http.FileServer(http.Dir(\"views\")))\n</code></pre>\n\n<p>Into this:</p>\n\n<pre><code>r.PathPrefix(\"/\").Handler(http.StripPrefix(\"/\", http.FileServer(http.Dir(\"views\"))))\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 9481930, "user_type": "registered", "profile_image": "https://graph.facebook.com/1864503013583303/picture?type=large", "display_name": "Dzionys", "link": "https://stackoverflow.com/users/9481930/dzionys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1548, "favorite_count": 0, "accepted_answer_id": 55952632, "answer_count": 1, "score": 2, "last_activity_date": 1556800639, "creation_date": 1556115794, "question_id": 55832398, "link": "https://stackoverflow.com/questions/55832398/mime-type-text-plain-mismatch-x-content-type-options-nosniff", "title": "MIME type (\u201ctext/plain\u201d) mismatch (X-Content-Type-Options: nosniff)", "body": "<p>I was using golang net/http funcions and had no errors, but I needed custom URL so I implemented gorilla/mux router and now getting errors like this:</p>\n\n<pre><code>The resource from \u201chttp://localhost:8080/styles.css\u201d was blocked due to MIME type (\u201ctext/plain\u201d) mismatch (X-Content-Type-Options: nosniff).\nThe resource from \u201chttp://localhost:8080/main.js\u201d was blocked due to MIME type (\u201ctext/plain\u201d) mismatch (X-Content-Type-Options: nosniff).\nThe resource from \u201chttp://localhost:8080/base.js\u201d was blocked due to MIME type (\u201ctext/plain\u201d) mismatch (X-Content-Type-Options: nosniff).\n</code></pre>\n\n<p>code before:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>http.Handle(\"/transcode\", http.HandlerFunc(transcodeHandler))\nhttp.Handle(\"/tctype\", http.HandlerFunc(tctypeHandler))\nhttp.Handle(\"/sse/dashboard\", lp.B)\nhttp.Handle(\"/upload\", http.HandlerFunc(uploadHandler))\nhttp.Handle(\"/\", http.FileServer(http.Dir(\"views\")))\nfmt.Println(\"Listening on port: 8080...\")\nlog.Fatalf(\"Exited: %s\", http.ListenAndServe(\":8080\", nil))\n</code></pre>\n\n<p>code after:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>r := mux.NewRouter()\n\nr.Handle(\"/ngx/mapping/{name}\", http.HandlerFunc(ngxMappingHandler))\nr.Handle(\"/transcode\", http.HandlerFunc(transcodeHandler))\nr.Handle(\"/tctype\", http.HandlerFunc(tctypeHandler))\nr.Handle(\"/sse/dashboard\", lp.B)\nr.Handle(\"/upload\", http.HandlerFunc(uploadHandler))\nr.Handle(\"/\", http.FileServer(http.Dir(\"views\")))\nfmt.Println(\"Listening on port: 8080...\")\nlog.Fatalf(\"Exited: %s\", http.ListenAndServe(\":8080\", r))\n</code></pre>\n"}, {"tags": ["go", "mocking", "testify"], "comments": [{"owner": {"reputation": 2859, "user_id": 6225565, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iqBej.jpg?s=128&g=1", "display_name": "Shalauddin Ahamad Shuza", "link": "https://stackoverflow.com/users/6225565/shalauddin-ahamad-shuza"}, "edited": false, "score": 0, "creation_date": 1556174662, "post_id": 55830480, "comment_id": 98349039, "body": "Which logging library you are using? standard <code>log</code> or <code>logrus</code> or another library? Also in the <code>TestNil()</code> method where is <code>s</code> variable definition? Are you sure <code>TestNil</code> does not contain any <code>*testing.T</code> argument?"}], "answers": [{"tags": [], "owner": {"reputation": 680, "user_id": 7274408, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jp2HB.png?s=128&g=1", "display_name": "Brad", "link": "https://stackoverflow.com/users/7274408/brad"}, "is_accepted": false, "score": 1, "last_activity_date": 1556177749, "creation_date": 1556177749, "answer_id": 55844099, "question_id": 55830480, "link": "https://stackoverflow.com/questions/55830480/testify-mock-is-returning-assertion-that-the-function-has-not-been-called/55844099#55844099", "title": "Testify mock is returning assertion that the function has not been called", "body": "<p><code>LogNilValue</code> should have <code>MyMockedObject</code> as the method receiver, in order to mock the method. Something like this</p>\n\n<pre><code>func (*MyMockedObject)LogNilValue(ctx string) {\n    log.Logger.Warn(ctx)\n}\n</code></pre>\n\n<p><code>CheckFunc</code> should look like this:</p>\n\n<pre><code>func CheckFunc(value *string, m *MyMockedObject) {\n    ctx := \"Some context string\"\n    if value == nil {\n        m.LogNilValue(ctx) //void func that just logs the string\n   }\n}\n</code></pre>\n\n<p>And finally the <code>TestNil</code> method:</p>\n\n<pre><code>func TestNil() {\n    m := new(MyMockedObject)\n    m.Mock.On(\"LogNilValue\", mock.Anything).Return(nil)\n    CheckFunc(nil, m)\n    m.AssertCalled(s.T(), \"LogNilValue\", mock.Anything)\n}\n</code></pre>\n"}], "owner": {"reputation": 195, "user_id": 1164149, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/a61854b99d07d9407206f6aae7ce980d?s=128&d=identicon&r=PG", "display_name": "ExceptionHandler", "link": "https://stackoverflow.com/users/1164149/exceptionhandler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1325, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556177749, "creation_date": 1556110229, "question_id": 55830480, "link": "https://stackoverflow.com/questions/55830480/testify-mock-is-returning-assertion-that-the-function-has-not-been-called", "title": "Testify mock is returning assertion that the function has not been called", "body": "<p>My tests keep failing with but <code>no actual calls happened</code> but I am positive the func is getting called (It's a logging function so I see the logs on the terminal)</p>\n\n<p>Basically I have code that looks something like this : </p>\n\n<p><code>common/utils.go</code></p>\n\n<hr>\n\n<pre><code>func LogNilValue(ctx string){\n    log.Logger.Warn(ctx)\n}\n</code></pre>\n\n<p><code>main.go</code></p>\n\n<hr>\n\n<pre><code>import (\n\"common/utils\"\n)\n\nfunc CheckFunc(*string value) {\n    ctx := \"Some context string\"\n    if value == nil {\n    utils.LogNilValue(ctx) //void func that just logs the string\n   }\n}\n</code></pre>\n\n<p><code>test.go</code></p>\n\n<hr>\n\n<pre><code>type MyMockedObject struct{\n    mock.Mock\n}\n\nfunc TestNil() {\n    m := new(MyMockedObject)\n    m.Mock.On(\"LogNilValue\", mock.Anything).Return(nil)\n    CheckFunc(nil)\n    m.AssertCalled(s.T(), \"LogNilValue\", mock.Anything)\n}\n</code></pre>\n\n<p>I expect this to work but then, I keep getting <code>no actual calls happened</code>. Not sure what I am doing wrong here.</p>\n"}, {"tags": ["go", "deferred-execution"], "comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 3, "creation_date": 1556108044, "post_id": 55829756, "comment_id": 98324239, "body": "the defer never runs, so the fmt.Println isn&#39;t set up.  When the return occurs in the line above there is no defer waiting to happen"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1556108251, "post_id": 55829756, "comment_id": 98324358, "body": "Code within a function is executed in the order expressed by that code. You can&#39;t expect a <code>defer</code> to happen if it was never executed."}, {"owner": {"reputation": 15752, "user_id": 16998, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/PstY2.jpg?s=128&g=1", "display_name": "jrwren", "link": "https://stackoverflow.com/users/16998/jrwren"}, "edited": false, "score": 0, "creation_date": 1556132851, "post_id": 55829756, "comment_id": 98338170, "body": "<a href=\"https://tour.golang.org/flowcontrol/12\" rel=\"nofollow noreferrer\">tour.golang.org/flowcontrol/12</a>"}], "answers": [{"comments": [{"owner": {"reputation": 167, "user_id": 4733583, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mma18.jpg?s=128&g=1", "display_name": "\u0411\u043e\u0440\u0438\u0441", "link": "https://stackoverflow.com/users/4733583/%d0%91%d0%be%d1%80%d0%b8%d1%81"}, "edited": false, "score": 0, "creation_date": 1556109845, "post_id": 55829795, "comment_id": 98325313, "body": "How about this:  <code>func _httpHandler(w http.ResponseWriter, r *http.Request) {   \tbody, err := ioutil.ReadAll(r.Body) \tif err != nil { \t\thttp.Error(w, err.Error(), 500) \t\tlog.Println(remoteIP, &quot;\\t&quot;,err.Error()) \t\treturn    \t}   \tdefer r.Body.Close() } </code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 167, "user_id": 4733583, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mma18.jpg?s=128&g=1", "display_name": "\u0411\u043e\u0440\u0438\u0441", "link": "https://stackoverflow.com/users/4733583/%d0%91%d0%be%d1%80%d0%b8%d1%81"}, "edited": false, "score": 0, "creation_date": 1556110122, "post_id": 55829795, "comment_id": 98325471, "body": "@\u0411\u043e\u0440\u0438\u0441 How about that what?"}, {"owner": {"reputation": 167, "user_id": 4733583, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mma18.jpg?s=128&g=1", "display_name": "\u0411\u043e\u0440\u0438\u0441", "link": "https://stackoverflow.com/users/4733583/%d0%91%d0%be%d1%80%d0%b8%d1%81"}, "edited": false, "score": 0, "creation_date": 1556111315, "post_id": 55829795, "comment_id": 98326229, "body": "sorry - wrong example."}, {"owner": {"reputation": 167, "user_id": 4733583, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mma18.jpg?s=128&g=1", "display_name": "\u0411\u043e\u0440\u0438\u0441", "link": "https://stackoverflow.com/users/4733583/%d0%91%d0%be%d1%80%d0%b8%d1%81"}, "edited": false, "score": 0, "creation_date": 1556111960, "post_id": 55829795, "comment_id": 98326703, "body": "found all answers here - <a href=\"http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/#anameclose_http_resp_bodyaclosinghttpresponsebody\" rel=\"nofollow noreferrer\">devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-gol&zwnj;&#8203;ang/&hellip;</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1556108052, "creation_date": 1556108052, "answer_id": 55829795, "question_id": 55829756, "link": "https://stackoverflow.com/questions/55829756/please-explain-defers-behaivour-in-golang/55829795#55829795", "title": "Please explain DEFER&#39;s behaivour in golang", "body": "<p>You return from the main function before the <code>defer</code> statement could be executed, before the <code>fmt.Println()</code> call could be \"enqueued\".</p>\n\n<p>Change it to:</p>\n\n<pre><code>defer fmt.Println(\"DEFER EXIT\")\nif err := test(); err != nil {\n    fmt.Println(\"ERROR EXIT\")\n    return\n}\nfmt.Println(\"NORMAL EXIT\")\n</code></pre>\n\n<p>Then output will be (try it on the <a href=\"https://play.golang.org/p/8ijKc8npJXF\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>ERROR EXIT\nDEFER EXIT\n</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 4733583, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mma18.jpg?s=128&g=1", "display_name": "\u0411\u043e\u0440\u0438\u0441", "link": "https://stackoverflow.com/users/4733583/%d0%91%d0%be%d1%80%d0%b8%d1%81"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "closed_date": 1556155961, "answer_count": 1, "score": -3, "last_activity_date": 1556108052, "creation_date": 1556107884, "question_id": 55829756, "link": "https://stackoverflow.com/questions/55829756/please-explain-defers-behaivour-in-golang", "closed_reason": "Duplicate", "title": "Please explain DEFER&#39;s behaivour in golang", "body": "<p>As I know, defer is usually used to close or free resources.\nAnd using <code>defer FUNC ()</code> inside the block (function) of the code ensures that <code>FUNC ()</code> will call in case of any return from this block(function) or panic in this block (function).</p>\n\n<p>So - how to explain <code>defer</code> behavior in this code: (<a href=\"https://play.golang.org/p/FPA0wrRyw1f\" rel=\"nofollow noreferrer\">Example</a>):</p>\n\n<pre><code>package main\nimport (\n  \"fmt\"\n  \"errors\"\n)\nfunc test() error {\n  err := errors.New(\"some error\")\n  return err\n}\nfunc main() {\n  if err := test(); err!=nil {\n    fmt.Println(\"ERROR EXIT\")\n    return\n  }\n  defer fmt.Println(\"DEFER EXIT\")\n  fmt.Println(\"NORMAL EXIT\")\n}\n</code></pre>\n\n<p>I expected to see this:</p>\n\n<pre><code>ERROR EXIT\nDEFER EXIT\n</code></pre>\n\n<p>But got it:</p>\n\n<pre><code>ERROR EXIT\n</code></pre>\n\n<p>Where am I wrong?</p>\n"}, {"tags": ["go", "go-echo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1556107961, "post_id": 55829726, "comment_id": 98324187, "body": "What is &quot;go echo frame&quot;? If you have a server of some sort, you must have some access to the remote ip address."}, {"owner": {"reputation": 11, "user_id": 11404982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16d88f887c4c1bcf821fa7d2e2094e18?s=128&d=identicon&r=PG&f=1", "display_name": "Shaco", "link": "https://stackoverflow.com/users/11404982/shaco"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556108663, "post_id": 55829726, "comment_id": 98324620, "body": "it&#39;s go-echo.I can get the remote ip address and i want make a separate  module filter ip instead of coding in the  service logic codes .Is there some good middleware to filter ip\uff1f"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556109037, "post_id": 55829726, "comment_id": 98324831, "body": "Please show an example of what you&#39;re trying to do, preferably with a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> if you&#39;ve encountered a problem. The Echo framework is designed around composing middleware, so it would seem you already have what you&#39;re looking for."}], "answers": [{"tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": true, "score": 2, "last_activity_date": 1556116282, "creation_date": 1556116282, "answer_id": 55832560, "question_id": 55829726, "link": "https://stackoverflow.com/questions/55829726/is-there-a-good-way-to-filter-requests-by-ip-address-with-echo/55832560#55832560", "title": "Is there a good way to filter requests by IP address with Echo?", "body": "<p>You can add a middleware for this:</p>\n\n<pre><code>func filterIP(next echo.HandlerFunc) echo.HandlerFunc {\n    return func(c echo.Context) error {\n        // Block requests from localhost.\n        if c.RealIP() == \"127.0.0.1\" {\n            return echo.NewHTTPError(http.StatusUnauthorized,\n                fmt.Sprintf(\"IP address %s not allowed\", c.RealIP()))\n        }\n\n        return next(c)\n    }\n}\n\nfunc main() {\n    e := echo.New()\n    e.Use(filterIP)\n    e.GET(\"/\", func(c echo.Context) error {\n        return c.String(http.StatusOK, \"Hello, World!\")\n    })\n    e.Logger.Fatal(e.Start(\":1323\"))\n}\n</code></pre>\n\n<p>It's important to use the <code>RealIP()</code> function, otherwise you might end up with the IP address of a proxy.</p>\n"}], "owner": {"reputation": 11, "user_id": 11404982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16d88f887c4c1bcf821fa7d2e2094e18?s=128&d=identicon&r=PG&f=1", "display_name": "Shaco", "link": "https://stackoverflow.com/users/11404982/shaco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1187, "favorite_count": 1, "accepted_answer_id": 55832560, "answer_count": 1, "score": -2, "last_activity_date": 1580893444, "creation_date": 1556107767, "last_edit_date": 1556179032, "question_id": 55829726, "link": "https://stackoverflow.com/questions/55829726/is-there-a-good-way-to-filter-requests-by-ip-address-with-echo", "title": "Is there a good way to filter requests by IP address with Echo?", "body": "<p>I'm developing an API  server with the Echo HTTP framework. I woudld like to filter some requests by IP address. </p>\n\n<p>Later I can manager these URLs better.<br>\nIt's my code:</p>\n\n<pre><code>func filterIP(next echo.HandlerFunc) echo.HandlerFunc {\nreturn func(c echo.Context) error {\n    fmt.Println(\"c.RealIP()=\", c.RealIP())\n    fmt.Println(\"c.Path()\", c.Path())\n    if isFilterIp(c.RealIP(), c.Path()) {\n        return echo.NewHTTPError(http.StatusUnauthorized,\n            fmt.Sprintf(\"IP address %s not allowed\", c.RealIP()))\n    }\n\n    return next(c)\n}\n}\n\nfunc main() {\ne := echo.New()\n\nfilterGroup := e.Group(\"/filter\")\nfilterGroup.Use(filterIP)\nfilterGroup.GET(\"/test\", func(c echo.Context) error {\n    return c.String(http.StatusOK, \"test filter\")\n})\n\nnoFilterGroup := e.Group(\"/noFilter\")\nnoFilterGroup.GET(\"/test\", func(c echo.Context) error {\n    return c.String(http.StatusOK, \"test no filter\")\n})\n\ne.Logger.Fatal(e.Start(\":1323\"))\n}\n</code></pre>\n\n<p>And i want to filter Ip address in the url's level instead of group route.<br>\neg: if there are two path: <code>/filter/test01</code> and <code>/filter/test02</code>,and i want to filter only test01.<br>\nIs there some good way to do this? </p>\n"}, {"tags": ["go", "sqlx"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556109268, "post_id": 55829601, "comment_id": 98324980, "body": "Is that the only code that is using the db connection? If your app is only using <code>Get</code> then who knows what the problem is, but if your app is using other functionality of the <code>*sqlx.DB</code> type then that might be the problem, for example not closing <code>sql.Rows</code>, <code>sql.Stmt</code>, or <code>sql.Tx</code> values."}, {"owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "edited": false, "score": 0, "creation_date": 1556117050, "post_id": 55829601, "comment_id": 98330232, "body": "<code>sql.DB</code> is a pool of many connections which is managed internally. Are you possibly generating sufficient traffic that you are exhausting the pool? More info: <a href=\"https://www.alexedwards.net/blog/configuring-sqldb\" rel=\"nofollow noreferrer\">alexedwards.net/blog/configuring-sqldb</a>"}, {"owner": {"reputation": 13, "user_id": 11405059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ka68I6fwFBI/AAAAAAAAAAI/AAAAAAAAAAc/-GwLYLXFCCI/photo.jpg?sz=128", "display_name": "Marcelo Gon&#231;alves", "link": "https://stackoverflow.com/users/11405059/marcelo-gon%c3%a7alves"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556213820, "post_id": 55829601, "comment_id": 98371076, "body": "@mkopriva I closing the connection only when the application stops (open and close connections all the time is not good for the application of course). But the problem is that the way I&#39;m doing the thing, it should not open many connections, but some of them(like these using in the code block) still in use after the query and the application need open new ones to still working. I&#39;m using tx, QueryRow, Get and Select, but not all application queries have this problem, just some pieces of code like that one."}, {"owner": {"reputation": 13, "user_id": 11405059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ka68I6fwFBI/AAAAAAAAAAI/AAAAAAAAAAc/-GwLYLXFCCI/photo.jpg?sz=128", "display_name": "Marcelo Gon&#231;alves", "link": "https://stackoverflow.com/users/11405059/marcelo-gon%c3%a7alves"}, "reply_to_user": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "edited": false, "score": 0, "creation_date": 1556214059, "post_id": 55829601, "comment_id": 98371183, "body": "@CosmicOssifrage the application just need open 2 connections per user to work. But if that ones still in use, It&#39;ll open another ones and arrive the limit (max connections) and the application die"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556214168, "post_id": 55829601, "comment_id": 98371229, "body": "@MarceloGon&#231;alves <code>DB</code> is <b>not a connection</b>, it&#39;s a <b>pool of connections</b>. Every time you call a method like <code>QueryRow</code>, <code>Query</code>, <code>Get</code>, <code>Select</code> a connection is retrieved from the pool and when the method is done the connection is returned to the pool, most of the time this is done automatically, however in some cases you need to explicitly tell when you&#39;re done with the connection, if you do not then it will never be returned to the pool and after a while your pool will become empty and your app will crash."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556214508, "post_id": 55829601, "comment_id": 98371394, "body": "... for example if you use <a href=\"https://godoc.org/database/sql#DB.Query\" rel=\"nofollow noreferrer\"><code>Query&#47;QueryContext</code></a> or <a href=\"https://godoc.org/github.com/jmoiron/sqlx#DB.Queryx\" rel=\"nofollow noreferrer\"><code>Queryx&#47;QueryxContext</code></a> the returned <a href=\"https://godoc.org/database/sql#Rows\" rel=\"nofollow noreferrer\"><code>*sql.Rows</code></a> object needs to be explicitly <a href=\"https://godoc.org/database/sql#Rows.Close\" rel=\"nofollow noreferrer\"><code>Closed</code></a> after you&#39;re finished with it. If you don&#39;t close the rows object then your app will crash."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556214724, "post_id": 55829601, "comment_id": 98371485, "body": "... <a href=\"https://godoc.org/database/sql#Stmt\" rel=\"nofollow noreferrer\"><code>Stmt</code></a> objects are the same they should be closed when not needed anymore. A <a href=\"https://godoc.org/database/sql#Tx\" rel=\"nofollow noreferrer\"><code>Tx</code></a> must be either committed or rolled back, if not your app will crash."}], "answers": [{"tags": [], "owner": {"reputation": 13, "user_id": 11405059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ka68I6fwFBI/AAAAAAAAAAI/AAAAAAAAAAc/-GwLYLXFCCI/photo.jpg?sz=128", "display_name": "Marcelo Gon&#231;alves", "link": "https://stackoverflow.com/users/11405059/marcelo-gon%c3%a7alves"}, "is_accepted": true, "score": 0, "last_activity_date": 1558026729, "creation_date": 1558026729, "answer_id": 56173511, "question_id": 55829601, "link": "https://stackoverflow.com/questions/55829601/database-connections-still-in-use-after-query-on-sqlx-in-a-golang-project/56173511#56173511", "title": "Database connections still in use after query on sqlx in a golang project", "body": "<p>Thanks to @mkopriva !\nI still don't know why the connections still in use, but to solve my problem I've use <code>Tx</code> and create a function to <code>defer</code> a <code>commit</code> or a <code>rollback</code> (commit and rollback both return a error, I was having problems to close the connections because that - in the <code>Tx</code> cases):</p>\n\n<pre><code>func commitORRollback(db *sqlx.Tx, ROLLBACK *bool) {\n    if *ROLLBACK {\n        if err := db.Rollback(); err != nil {\n            ...\n        }\n    } else {\n        ...\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 11405059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ka68I6fwFBI/AAAAAAAAAAI/AAAAAAAAAAc/-GwLYLXFCCI/photo.jpg?sz=128", "display_name": "Marcelo Gon&#231;alves", "link": "https://stackoverflow.com/users/11405059/marcelo-gon%c3%a7alves"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 846, "favorite_count": 0, "accepted_answer_id": 56173511, "answer_count": 1, "score": 0, "last_activity_date": 1558026729, "creation_date": 1556107310, "question_id": 55829601, "link": "https://stackoverflow.com/questions/55829601/database-connections-still-in-use-after-query-on-sqlx-in-a-golang-project", "title": "Database connections still in use after query on sqlx in a golang project", "body": "<p>I'm working in a golang project using sqlx and postgres. When the application starts I open a connection with the database and use it like this:</p>\n\n<pre><code>var connRO *sqlx.DB\nvar connRW *sqlx.DB\n...\n\n/ GetInstance - will return the connection opened to the database\nfunc GetInstance(readonly bool) *sqlx.DB {\n\n    if readonly {\n        return connRO\n    }\n\n    return connRW\n}\n</code></pre>\n\n<p>The problem is that in some blocks of code the connection still in use, here one example:</p>\n\n<pre><code>instanceRW := database.GetInstance(false)\ninstanceRO := database.GetInstance(true)\n...\n\nerr := instanceRO.Get(&amp;idFuncionario, `\n            SELECT id \n            FROM t_funcionario \n            WHERE codigo_externo = $1 `,\n            i.FuncionarioID)\n        if err != nil {\n            log.Println(err)\n            return errors.New(\"Erro ao identificar funcion\u00e1rio.\")\n        }\n\n        // Verifica se o item \u00e9 granel\n        // Caso n\u00e3o seja\n        if *i.ItemGranelID == 0 {\n            // Verifica se o item est\u00e1 dispon\u00edvel\n            err = instanceRO.Get(&amp;localidade_id, `\n                SELECT COALESCE(localidade_id, 0) \n                FROM t_item \n                WHERE id = $1\n            `, i.ItemID)\n            if err != nil {\n                log.Println(err)\n                return errors.New(\"N\u00e3o foi poss\u00edvel identificar tipo do item.\")\n...\n            }\n</code></pre>\n\n<p>When I try test it doing something like it, the test don't open many connections. Here some test code:</p>\n\n<pre><code>i := 600\n    for i != 0 {\n        if true {\n            err := db.Select(&amp;item, `SELECT * FROM t_item LIMIT 10`)\n            if err != nil {\n\n            }\n            err = db.Select(&amp;categoria, `SELECT * FROM t_categoria LIMIT 10`)\n            if err != nil {\n\n            }\n            err = db.QueryRow(`INSERT INTO t_categoria\n                (\n                    nome, \n                    ativo\n                )\n                VALUES ($1, $2)`, fmt.Sprintf(\"cateToTeste%v\", i), true).Scan(&amp;itemget)\n            if err != nil {\n\n            }\n\n            err = db.Get(&amp;itemget, `SELECT COALESCE(localidade_id, 0) \n                    FROM t_item \n                    WHERE id = $1`, 150)\n            if err != nil {\n\n            }\n\n            log.Println(\"ok\")\n            i--\n        }       \n    }\n    log.Println(\"Tudo ok!!\")\n</code></pre>\n\n<p>Some time I get max connections and the application die.</p>\n"}, {"tags": ["mysql", "api", "go", "frameworks", "beego"], "answers": [{"tags": [], "owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "is_accepted": true, "score": 0, "last_activity_date": 1561601506, "creation_date": 1561601506, "answer_id": 56783004, "question_id": 55829463, "link": "https://stackoverflow.com/questions/55829463/create-data-by-api-not-been-saved-with-beego/56783004#56783004", "title": "Create data by API not been saved with beego", "body": "<p>Maybe <code>bee new quickstart</code> not generated structure with API. It's for form.</p>\n"}], "owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 56783004, "answer_count": 1, "score": 0, "last_activity_date": 1561601506, "creation_date": 1556106863, "last_edit_date": 1556164806, "question_id": 55829463, "link": "https://stackoverflow.com/questions/55829463/create-data-by-api-not-been-saved-with-beego", "title": "Create data by API not been saved with beego", "body": "<p>Versions:</p>\n\n<pre><code>bee version\n______\n| ___ \\\n| |_/ /  ___   ___\n| ___ \\ / _ \\ / _ \\\n| |_/ /|  __/|  __/\n\\____/  \\___| \\___| v1.10.0\n\n\u251c\u2500\u2500 Beego     : 1.11.1\n\u251c\u2500\u2500 GoVersion : go1.12.1\n</code></pre>\n\n<p>Create a beego project:</p>\n\n<pre><code>bee new quickstart\n</code></pre>\n\n<p>Use beego's <code>bee</code> tool to generate a post scaffold:</p>\n\n<pre><code>bee generate scaffold post -fields=\"title:string,body:text\" -driver=mysql -conn=\"root:root@tcp(127.0.0.1:3306)/quickstart\"\n</code></pre>\n\n<p>routers/router.go</p>\n\n<pre><code>package routers\n\nimport (\n    \"quickstart/controllers\"\n    \"github.com/astaxie/beego\"\n)\n\nfunc init() {\n    beego.Router(\"/\", &amp;controllers.MainController{})\n    beego.Router(\"/posts\" ,&amp;controllers.PostController{}, \"*:GetAll\")\n    beego.Router(\"/posts/add\" ,&amp;controllers.PostController{}, \"*:Post\")\n}\n</code></pre>\n\n<p>Initials one record in db:</p>\n\n<pre><code>mysql&gt; use quickstart;\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\nmysql&gt; show tables;\n+----------------------+\n| Tables_in_quickstart |\n+----------------------+\n| migrations           |\n| post                 |\n+----------------------+\n2 rows in set (0.00 sec)\n\nmysql&gt; desc post;\n+-------+--------------+------+-----+---------+----------------+\n| Field | Type         | Null | Key | Default | Extra          |\n+-------+--------------+------+-----+---------+----------------+\n| id    | int(11)      | NO   | PRI | NULL    | auto_increment |\n| title | varchar(128) | NO   |     | NULL    |                |\n| body  | longtext     | NO   |     | NULL    |                |\n+-------+--------------+------+-----+---------+----------------+\n3 rows in set (0.00 sec)\n\nmysql&gt; insert into post(id, title, body) values(1, 'a', 'b');\nQuery OK, 1 row affected (0.00 sec)\n</code></pre>\n\n<p>Create a second record by API:</p>\n\n<p><a href=\"https://i.stack.imgur.com/T92xF.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/T92xF.png\" alt=\"enter image description here\"></a></p>\n\n<p>But check the data list, <code>title</code> and <code>body</code> aren't been saved. Why?</p>\n\n<p><a href=\"https://i.stack.imgur.com/PM23I.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/PM23I.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1556104831, "post_id": 55828822, "comment_id": 98322311, "body": "The <code>for range</code> construct over a channel receives all values that were sent on it before close. Then it terminates when the channel is closed."}, {"owner": {"reputation": 25, "user_id": 6791086, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/84eca77597ab4e58a6f9964914679480?s=128&d=identicon&r=PG&f=1", "display_name": "hellokuldeep", "link": "https://stackoverflow.com/users/6791086/hellokuldeep"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1556105787, "post_id": 55828822, "comment_id": 98322902, "body": "Here this for range is not terminating, I guess. If I uncomment the close(outputChan), it wont allow receiving all values."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1556105985, "post_id": 55828822, "comment_id": 98323031, "body": "<code>for range</code> terminates when all values are received that were sent before the channel was closed. If the channel is not closed, it will not terminate."}, {"owner": {"reputation": 25, "user_id": 6791086, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/84eca77597ab4e58a6f9964914679480?s=128&d=identicon&r=PG&f=1", "display_name": "hellokuldeep", "link": "https://stackoverflow.com/users/6791086/hellokuldeep"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1556113542, "post_id": 55828822, "comment_id": 98327766, "body": "Yes thats what I&#39;m asking, I can&#39;t close channel in the end of the second function. Since this is buffered channel, I want more value into it. <code>for range</code> here is not terminating as its expecting more values in channel. I want this issue to be resolved, as soon as all values from channel are consumed, <code>for range</code> should terminate or some other method that can do similar thing."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1556113671, "post_id": 55828822, "comment_id": 98327841, "body": "If you want to send more values, don&#39;t close it; but if you&#39;re sending more values, you also don&#39;t want the consumer to stop looping, so it seems like everything is working as it should. What is the behavior you&#39;re looking for exactly?"}, {"owner": {"reputation": 25, "user_id": 6791086, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/84eca77597ab4e58a6f9964914679480?s=128&d=identicon&r=PG&f=1", "display_name": "hellokuldeep", "link": "https://stackoverflow.com/users/6791086/hellokuldeep"}, "edited": false, "score": 0, "creation_date": 1556114988, "post_id": 55828822, "comment_id": 98328760, "body": "No, I think when I am not closing that means its not stoping for receiving from channel and there it stucks forever. It should be stoped when all items from channel is consumed, then only <code>return</code> can be triggered."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1556115302, "post_id": 55828822, "comment_id": 98329002, "body": "<code>for range</code> stops if channel was closed and all values received. Please show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that reproduces your problem, without that, your question is off-topic."}], "answers": [{"tags": [], "owner": {"reputation": 25, "user_id": 6791086, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/84eca77597ab4e58a6f9964914679480?s=128&d=identicon&r=PG&f=1", "display_name": "hellokuldeep", "link": "https://stackoverflow.com/users/6791086/hellokuldeep"}, "is_accepted": true, "score": 0, "last_activity_date": 1556276402, "creation_date": 1556276402, "answer_id": 55866182, "question_id": 55828822, "link": "https://stackoverflow.com/questions/55828822/how-to-receive-from-channel-till-it-has-values-in-go/55866182#55866182", "title": "How to receive from channel till it has values in GO", "body": "<p>Finally got the answer using WaitGroup. Sharing link for complete reference:\n<a href=\"https://nathanleclaire.com/blog/2014/02/15/how-to-wait-for-all-goroutines-to-finish-executing-before-continuing/\" rel=\"nofollow noreferrer\">https://nathanleclaire.com/blog/2014/02/15/how-to-wait-for-all-goroutines-to-finish-executing-before-continuing/</a></p>\n"}], "owner": {"reputation": 25, "user_id": 6791086, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/84eca77597ab4e58a6f9964914679480?s=128&d=identicon&r=PG&f=1", "display_name": "hellokuldeep", "link": "https://stackoverflow.com/users/6791086/hellokuldeep"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 55866182, "answer_count": 1, "score": -3, "last_activity_date": 1556276402, "creation_date": 1556104751, "question_id": 55828822, "link": "https://stackoverflow.com/questions/55828822/how-to-receive-from-channel-till-it-has-values-in-go", "title": "How to receive from channel till it has values in GO", "body": "<p>A function has loop which call a go routine inside it with a channel passed into it.\nAfter this, I try receiving from channel till it has values.</p>\n\n<p>The go function passes value in channel upon each call.</p>\n\n<p>My channel runs infinitely. </p>\n\n<p>func (m *StreamsDAO) FindOutput(input model.Input) ([]model.Output, error) {</p>\n\n<pre><code>// SOME CODE\n\nvar chanNumber int = (input.EndTime - input.StartTime)/60\noutputChan := make(chan model.Output, chanNumber)\nfor i := input.StartTime; i &lt; input.EndTime ;i = i+(slider*60) {\n\n// SOME CODE\n\n    go ForEachSlide(i, outputChan)\n    for outputC := range outputChan {\n        outputs = append(outputs, outputC)\n    }\n}\nreturn outputs, err\n</code></pre>\n\n<p>}</p>\n\n<p>func ForEachSlide(i int, outputChan chan model.Output) {</p>\n\n<pre><code>// SOME CODE\n\noutputChan &lt;- output\n//  close(outputChan)\n</code></pre>\n\n<p>}</p>\n\n<p>Its looping infinite as there in no stop for receiving from channel.\nIf close channel is used, only single element is received from channel thats as expected, but I need all values from the channel.</p>\n"}, {"tags": ["go", "compilation"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1556103756, "post_id": 55828387, "comment_id": 98321603, "body": "&quot;to an older linux&quot; is a bit vague. Just because you do not link libc does not mean any old kernel is supported."}, {"owner": {"reputation": 131, "user_id": 8364972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f9890e08b8c017ec1e21eb44baabd95?s=128&d=identicon&r=PG&f=1", "display_name": "Musmus", "link": "https://stackoverflow.com/users/8364972/musmus"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1556103911, "post_id": 55828387, "comment_id": 98321689, "body": "compiled on an OS with kernel version 4.15.0 trying to execute on OS with kernel version 2.6.18, do you think this is the problem ?"}, {"owner": {"reputation": 131, "user_id": 8364972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f9890e08b8c017ec1e21eb44baabd95?s=128&d=identicon&r=PG&f=1", "display_name": "Musmus", "link": "https://stackoverflow.com/users/8364972/musmus"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1556104527, "post_id": 55828387, "comment_id": 98322124, "body": "I&#39;m aware that minimum requirements for go is Kernel version 2.6.23 but I&#39;m not trying to run go but a binary file that was compiled by go on a supported platform. I&#39;m sure it&#39;s possible to run binaries that were compiled by go because I have some like this that&#39;s running on that OS, I just need to understand how can I compile to run on that old OS."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1556104864, "post_id": 55828387, "comment_id": 98322329, "body": "You <i>need</i> at least 2.6.23 to compile and to run. This is a fact. You can try gcc or an <i>old</i> version of Go. You cannot trick the actual Go compiler."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1556123269, "post_id": 55828387, "comment_id": 98333803, "body": "That is not an <i>old</i> kernel, it is an <i>ancient</i> kernel. No Linux distribution that used it is still supported, and hasn&#39;t been for many years. It is unlikely that you will be able to get any help for this. You should decommission the ancient machine."}], "answers": [{"tags": [], "owner": {"reputation": 131, "user_id": 8364972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f9890e08b8c017ec1e21eb44baabd95?s=128&d=identicon&r=PG&f=1", "display_name": "Musmus", "link": "https://stackoverflow.com/users/8364972/musmus"}, "is_accepted": true, "score": 3, "last_activity_date": 1556106203, "last_edit_date": 1556106203, "creation_date": 1556105758, "answer_id": 55829164, "question_id": 55828387, "link": "https://stackoverflow.com/questions/55828387/static-go-binaries-compiled-on-linux-4-15-0-wont-work-on-older-linux-2-6-18/55829164#55829164", "title": "Static Go binaries compiled on Linux 4.15.0 won&#39;t work on older Linux 2.6.18", "body": "<p>Just tried an old compiler and it worked.\n1.10.8 is the latest version it works, 1.11.8 doesn't work.</p>\n\n<p>*I didn't check minor versions</p>\n"}], "owner": {"reputation": 131, "user_id": 8364972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f9890e08b8c017ec1e21eb44baabd95?s=128&d=identicon&r=PG&f=1", "display_name": "Musmus", "link": "https://stackoverflow.com/users/8364972/musmus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 55829164, "answer_count": 1, "score": 0, "last_activity_date": 1556117676, "creation_date": 1556103182, "last_edit_date": 1556117676, "question_id": 55828387, "link": "https://stackoverflow.com/questions/55828387/static-go-binaries-compiled-on-linux-4-15-0-wont-work-on-older-linux-2-6-18", "title": "Static Go binaries compiled on Linux 4.15.0 won&#39;t work on older Linux 2.6.18", "body": "<p>I create a file named <code>hw.go</code> with the below code</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"hello world\")\n}\n</code></pre>\n\n<p>and compiled like this on ubuntu (pretty new version):</p>\n\n<p><code>go build -v -a -tags netgo -ldflags '-w -extldflags \"-static\"' hw.go</code></p>\n\n<p>Then I moved the binary to an older linux also 64 bit and while executing got this error:</p>\n\n<p>what am I doing wrong ?</p>\n\n<pre><code>futexwakeup addr=0x558708 returned -38\nfatal error: unexpected signal during runtime execution\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x1006 pc=0x425e5b]\n\nruntime stack:\nruntime.throw(0x4becb7, 0x2a)\n        /usr/local/go/src/runtime/panic.go:617 +0x72\nruntime.sigpanic()\n        /usr/local/go/src/runtime/signal_unix.go:374 +0x4a9\nruntime.futexwakeup(0x558708, 0x2b1000000001)\n        /usr/local/go/src/runtime/os_linux.go:81 +0x8b\nruntime.notewakeup(0x558708)\n        /usr/local/go/src/runtime/lock_futex.go:136 +0x44\nruntime.startlockedm(0xc000000180)\n        /usr/local/go/src/runtime/proc.go:2105 +0x7e\nruntime.schedule()\n        /usr/local/go/src/runtime/proc.go:2555 +0x69\nruntime.park_m(0xc000000a80)\n        /usr/local/go/src/runtime/proc.go:2605 +0xa1\nruntime.mcall(0x0)\n        /usr/local/go/src/runtime/asm_amd64.s:299 +0x5b\n\ngoroutine 1 [runnable, locked to thread]:\ninternal/poll.init()\n        &lt;autogenerated&gt;:1 +0x73\nos.init()\n        &lt;autogenerated&gt;:1 +0x54\nfmt.init()\n        &lt;autogenerated&gt;:1 +0x54\nmain.init()\n        &lt;autogenerated&gt;:1 +0x45\nruntime.main()\n        /usr/local/go/src/runtime/proc.go:188 +0x1c8\nruntime.goexit()\n        /usr/local/go/src/runtime/asm_amd64.s:1337 +0x1\n</code></pre>\n"}, {"tags": ["ssl", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1556103333, "post_id": 55827757, "comment_id": 98321358, "body": "If the server presents an unexpected certificate then that is an issue with the server&#39;s configuration, not with the client (assuming the expectation is correct, of course)."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1556103820, "post_id": 55827757, "comment_id": 98321642, "body": "Wait, you put the client&#39;s name in the ServerName field? Why? It&#39;s called ServerName because it&#39;s supposed to be set to the server&#39;s name. It&#39;s the server that needs to prove it is who you want it to be. The client&#39;s name is irrelevant when verifying the server&#39;s identity."}, {"owner": {"reputation": 947, "user_id": 3218674, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/E7ZAV.jpg?s=128&g=1", "display_name": "Gauranga", "link": "https://stackoverflow.com/users/3218674/gauranga"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1556103968, "post_id": 55827757, "comment_id": 98321722, "body": "oh... ok. Actually, I thought that for 2 way SSL, server will check this field to validate my certificates. That is why I used that here.  Thanks @Peter for clarifying that."}, {"owner": {"reputation": 947, "user_id": 3218674, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/E7ZAV.jpg?s=128&g=1", "display_name": "Gauranga", "link": "https://stackoverflow.com/users/3218674/gauranga"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1556104035, "post_id": 55827757, "comment_id": 98321771, "body": "Now that error is gone. Now I am getting <code>EOF</code> :( Let me try checking for this."}], "owner": {"reputation": 947, "user_id": 3218674, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/E7ZAV.jpg?s=128&g=1", "display_name": "Gauranga", "link": "https://stackoverflow.com/users/3218674/gauranga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 344, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1556103852, "creation_date": 1556101279, "last_edit_date": 1556103852, "question_id": 55827757, "link": "https://stackoverflow.com/questions/55827757/getting-error-certificate-is-valid-for-servercommonname-not-clientcommonname", "title": "Getting error &quot;Certificate is valid for ServerCommonName, not ClientCommonName&quot;", "body": "<p>I am trying to do a TLS authentication of a remote server. This server is configured with two certificates (one root and one it's own). Locally, I have the same root certificate. I am doing a TLS handshake (to validate that server can be trusted) by creating a client locally. However, on doing that, I am getting error: <code>x509: Certificate is valid for ServerCommonName, not ClientCommonName</code>. When I am trying to validate certificates present by server, ideally, the certificate chain of server should have a root cert that I trust and this is fine. Not able to understand why getting this particular error.</p>\n\n<p>Can someone help? Below is the code...</p>\n\n<pre><code>func CheckTLSendpoint() error {\n    getDecoded()\n    var tlsConfig tls.Config\n    cer, _ := tls.X509KeyPair(ClientCertPem, ClientKeyPem)\n\n    // Checking verification of server certificate by the client is required or not\n    rootCA := x509.NewCertPool()\n    rootCA.AppendCertsFromPEM(RootCaPEM)\n\n    tlsConfig = tls.Config{\n        RootCAs:            rootCA,\n        Certificates:       []tls.Certificate{cer},\n        ServerName:         \"ClientCommonName\", //this is common name of my client certificate\n    }\n    tlsConfig.BuildNameToCertificate()\n\n    rAddr := \"10.20.30.40:3325\"\n\n    conn, err := net.DialTimeout(\"tcp\", rAddr, 10*time.Second)\n    defer conn.Close()\n\n    if err != nil {\n        return fmt.Errorf(\"TCP connection error : %s\", err.Error())\n    }\n\n    c := tls.Client(conn, &amp;tlsConfig)\n    defer c.Close()\n\n    err = c.Handshake()\n    if err != nil {\n        return fmt.Errorf(\"TLS connection error :  %s\", err.Error())\n    }\n\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go", "error-handling", "rabbitmq"], "comments": [{"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 1, "creation_date": 1556099607, "post_id": 55826930, "comment_id": 98319258, "body": "Assuming that you are ussing <code>streadway&#47;amqp</code>, this is probably what you are looking for <a href=\"https://godoc.org/github.com/streadway/amqp#Channel.NotifyClose\" rel=\"nofollow noreferrer\">godoc.org/github.com/streadway/amqp#Channel.NotifyClose</a>"}, {"owner": {"reputation": 31255, "user_id": 28494, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/c14ME.gif?s=128&g=1", "display_name": "qrdl", "link": "https://stackoverflow.com/users/28494/qrdl"}, "reply_to_user": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1556099726, "post_id": 55826930, "comment_id": 98319327, "body": "@ttomalak This looks very good, please make it an answer so I can accept it"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556113849, "post_id": 55827294, "comment_id": 98327954, "body": "Please quote or paraphrase the relevant content in the body of your answer. Links can fail over time at which point this answer would no longer help anyone searching for it."}, {"owner": {"reputation": 6400, "user_id": 1466825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b420d86764ffe237a2fdc52e28b73f4?s=128&d=identicon&r=PG", "display_name": "Luke Bakken", "link": "https://stackoverflow.com/users/1466825/luke-bakken"}, "edited": false, "score": 0, "creation_date": 1556115906, "post_id": 55827294, "comment_id": 98329425, "body": "If that link fails, there are bigger problems to worry about."}], "tags": [], "owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "is_accepted": true, "score": 1, "last_activity_date": 1556124845, "last_edit_date": 1592644375, "creation_date": 1556099750, "answer_id": 55827294, "question_id": 55826930, "link": "https://stackoverflow.com/questions/55826930/how-to-detect-error-when-reading-from-rabbitmq-queue/55827294#55827294", "title": "How to detect error when reading from RabbitMQ queue", "body": "<p>Assuming that you are using <code>streadway/amqp</code>, this is probably what you are looking for <a href=\"https://godoc.org/github.com/streadway/amqp#Channel.NotifyClose\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/streadway/amqp#Channel.NotifyClose</a></p>\n<blockquote>\n<h3>func (*Channel) NotifyClose</h3>\n<p><code>func (ch *Channel) NotifyClose(c chan *Error) chan *Error</code></p>\n<p>NotifyClose registers a listener for when the server sends a channel\nor connection exception in the form of a Connection.Close or\nChannel.Close method. Connection exceptions will be broadcast to all\nopen channels and all channels will be closed, where channel\nexceptions will only be broadcast to listeners to this channel.</p>\n<p>The chan provided will be closed when the Channel is closed and on a\ngraceful close, no error will be sent.</p>\n</blockquote>\n"}], "owner": {"reputation": 31255, "user_id": 28494, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/c14ME.gif?s=128&g=1", "display_name": "qrdl", "link": "https://stackoverflow.com/users/28494/qrdl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 448, "favorite_count": 0, "accepted_answer_id": 55827294, "answer_count": 1, "score": 2, "last_activity_date": 1556124845, "creation_date": 1556098634, "question_id": 55826930, "link": "https://stackoverflow.com/questions/55826930/how-to-detect-error-when-reading-from-rabbitmq-queue", "title": "How to detect error when reading from RabbitMQ queue", "body": "<p>I'm reading messages from RabbitMQ queue like this:</p>\n\n<pre><code>messages, err := channel.Consume(\n    queue,  // queue\n    queue,  // consumer - same as queue\n    false,  // auto-ack\n    false,  // exclusive\n    false,  // no-local\n    false,  // no-wait\n    nil)    // args\nif err != nil {\n    // handle error\n}\n\nloop:   \nfor {\n    select {\n    case cmd := &lt;-cmdChannel:\n        if cmd == cmdStop {\n            break loop\n        }\n    case message := &lt;-messages:\n        go process(message)\n    }\n}\n</code></pre>\n\n<p>There could be situations when reading from <code>messages</code> fail, like network error, or RabbitMQ's channel was invalidated due to an error. How to detect such errors and get relevant error message?</p>\n"}, {"tags": ["mysql", "go", "mariadb", "beego"], "answers": [{"comments": [{"owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "edited": false, "score": 0, "creation_date": 1557985283, "post_id": 56161417, "comment_id": 98950682, "body": "I&#39;m using connection pooling. Thank you for your advice."}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "reply_to_user": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "edited": false, "score": 0, "creation_date": 1557985751, "post_id": 56161417, "comment_id": 98950844, "body": "@Bilguun - Have you located the parameters for pooling?"}], "tags": [], "owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "is_accepted": false, "score": 1, "last_activity_date": 1557984554, "creation_date": 1557984554, "answer_id": 56161417, "question_id": 55826624, "link": "https://stackoverflow.com/questions/55826624/how-to-avoid-too-many-connections/56161417#56161417", "title": "How to avoid &quot;too many connections&quot;", "body": "<ul>\n<li><em>Decrease</em> <code>wait_timeout</code>.</li>\n<li>Decrease the number of clients (Apache, for example, defaults to too big a number)</li>\n<li>Check on the \"persistent connection\" and \"connection pooling\" you may be using.</li>\n</ul>\n"}], "owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 648, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1557984554, "creation_date": 1556097741, "last_edit_date": 1557302294, "question_id": 55826624, "link": "https://stackoverflow.com/questions/55826624/how-to-avoid-too-many-connections", "title": "How to avoid &quot;too many connections&quot;", "body": "<blockquote>\n  <p>2019-04-24 15:52:26.526 9818 ERROR oslo_messaging.rpc.server [req-857fec8a-7196-4425-85e4-389e2655a2c3 - - - - -] Exception during message handling: OperationalError: (pymysql.err.OperationalError) (1040, u'Too many connections') (Background on this error at: <a href=\"http://sqlalche.me/e/e3q8\" rel=\"nofollow noreferrer\">http://sqlalche.me/e/e3q8</a>)</p>\n</blockquote>\n\n<p>I used</p>\n\n<pre><code>\"github.com/astaxie/beego/orm\"\nmariaDB\n</code></pre>\n\n<p>I can increase the number of connection. But is there any way to disconnect my connection if we log out of the website. Any other recommendation to use better beego+mariadb ? </p>\n"}, {"tags": ["go", "retrypolicy"], "answers": [{"comments": [{"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "edited": false, "score": 0, "creation_date": 1556097352, "post_id": 55826251, "comment_id": 98317945, "body": "This is just what I was looking for! Thanks! (P.S. I changed the <code>Println</code> line to <code>fmt.Printf(&quot;sleeping for %v...\\n&quot;, d)</code> to handle the formatting)."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 4, "last_activity_date": 1556102727, "last_edit_date": 1556102727, "creation_date": 1556096545, "answer_id": 55826251, "question_id": 55825685, "link": "https://stackoverflow.com/questions/55825685/turn-retry-policy-into-reusable-function/55826251#55826251", "title": "Turn Retry Policy into Reusable Function", "body": "<p>Simply pass generateError as an argument (I simplified the retry function because I couldn't help myself):</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    retry(generateError)\n}\n\nfunc retry(f func() error) {\n    fmt.Println(\"start!\")\n\n    backoff := []time.Duration{\n        1 * time.Second,\n        5 * time.Second,\n        10 * time.Second,\n    }\n\n    var err error\n    for _, d := range backoff {\n        err = f()\n        if err != nil {\n            fmt.Printf(\"sleeping for %v...\\n\", d)\n            time.Sleep(d)\n        } else {\n            fmt.Println(\"no errors!\")\n            return\n        }\n    }\n\n    fmt.Println(\"error:\", err)\n    fmt.Println(\"done!\")\n}\n\nfunc generateError() error {\n    err := errors.New(\"something happened\")\n    return err\n}\n</code></pre>\n"}], "owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 55826251, "answer_count": 1, "score": -1, "last_activity_date": 1556102727, "creation_date": 1556094832, "question_id": 55825685, "link": "https://stackoverflow.com/questions/55825685/turn-retry-policy-into-reusable-function", "title": "Turn Retry Policy into Reusable Function", "body": "<p>We have a simple retry policy for our project:</p>\n\n<ol>\n<li>On the first error, sleep for 1 second. </li>\n<li>On the second error, sleep for 5 seconds. </li>\n<li>On the third error, sleep for 10 seconds. </li>\n<li>On the fourth error, quit retrying and return the error.</li>\n</ol>\n\n<p>Here is what our retry policy looks like:</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"  \n    \"fmt\"         \n    \"time\"    \n)\n\nfunc main() {\n    errorCount := 0\n    var err error\n\n    fmt.Println(\"start!\")\n\n    for {\n        err = generateError()\n        if err != nil {\n            if errorCount == 0 {\n                fmt.Println(\"sleeping for 1 second...\")\n                time.Sleep(1 * time.Second)    \n            } else if errorCount == 1 {\n                fmt.Println(\"sleeping for 5 seconds...\")\n                time.Sleep(5 * time.Second)    \n            } else if errorCount == 2 {\n                fmt.Println(\"sleeping for 10 seconds...\")\n                time.Sleep(10 * time.Second)    \n            } else {\n                fmt.Println(\"giving up...\")\n                break\n            }\n\n            errorCount++\n        } else {\n            fmt.Println(\"no errors!\")\n            break\n        }\n    }\n\n    fmt.Println(\"error:\", err)\n    fmt.Println(\"done!\")\n}\n\nfunc generateError() error {\n    err := errors.New(\"something happened\")\n    return err\n}\n</code></pre>\n\n<p>Is there a way to turn the above code into a reusable function?</p>\n"}, {"tags": ["mysql", "go", "time"], "comments": [{"owner": {"reputation": 127, "user_id": 9299234, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mOF5X.jpg?s=128&g=1", "display_name": "E.Belekov", "link": "https://stackoverflow.com/users/9299234/e-belekov"}, "edited": false, "score": 0, "creation_date": 1556095389, "post_id": 55825671, "comment_id": 98316716, "body": "ok thanks everyone, your answers solved my problem."}], "answers": [{"comments": [{"owner": {"reputation": 591, "user_id": 10866729, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ynLrotVE4B8/AAAAAAAAAAI/AAAAAAAAAE4/-1V5eYw9C-4/photo.jpg?sz=128", "display_name": "Pavel T\u0159upek", "link": "https://stackoverflow.com/users/10866729/pavel-t%c5%99upek"}, "edited": false, "score": 0, "creation_date": 1556095429, "post_id": 55825742, "comment_id": 98316750, "body": "@E.Belekov DATE is for storing dates, DATETIME for storing datetimes (dates with times), TIMESTAMPS also stores dates with times, are also faster, but datetime is easier to work with (timezones, sql native functions, ...)"}, {"owner": {"reputation": 126, "user_id": 10716018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6de41fd94bb82d993616a8e64e92c3ab?s=128&d=identicon&r=PG&f=1", "display_name": "D.Dsn", "link": "https://stackoverflow.com/users/10716018/d-dsn"}, "reply_to_user": {"reputation": 591, "user_id": 10866729, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ynLrotVE4B8/AAAAAAAAAAI/AAAAAAAAAE4/-1V5eYw9C-4/photo.jpg?sz=128", "display_name": "Pavel T\u0159upek", "link": "https://stackoverflow.com/users/10866729/pavel-t%c5%99upek"}, "edited": false, "score": 0, "creation_date": 1556095473, "post_id": 55825742, "comment_id": 98316775, "body": "DATE will simply show you only the date without any time. If you want to add the time you need to change your type to DATETIME or TIMESTAMP"}, {"owner": {"reputation": 126, "user_id": 10716018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6de41fd94bb82d993616a8e64e92c3ab?s=128&d=identicon&r=PG&f=1", "display_name": "D.Dsn", "link": "https://stackoverflow.com/users/10716018/d-dsn"}, "reply_to_user": {"reputation": 591, "user_id": 10866729, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ynLrotVE4B8/AAAAAAAAAAI/AAAAAAAAAE4/-1V5eYw9C-4/photo.jpg?sz=128", "display_name": "Pavel T\u0159upek", "link": "https://stackoverflow.com/users/10866729/pavel-t%c5%99upek"}, "edited": false, "score": 0, "creation_date": 1556095516, "post_id": 55825742, "comment_id": 98316798, "body": "Couldn&#39;t say it any better @PavelT\u0159upek"}, {"owner": {"reputation": 127, "user_id": 9299234, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mOF5X.jpg?s=128&g=1", "display_name": "E.Belekov", "link": "https://stackoverflow.com/users/9299234/e-belekov"}, "edited": false, "score": 0, "creation_date": 1556095545, "post_id": 55825742, "comment_id": 98316816, "body": "Whose answer should I accept? You and Sebastian Brosch both answered at the same moment."}, {"owner": {"reputation": 126, "user_id": 10716018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6de41fd94bb82d993616a8e64e92c3ab?s=128&d=identicon&r=PG&f=1", "display_name": "D.Dsn", "link": "https://stackoverflow.com/users/10716018/d-dsn"}, "edited": false, "score": 0, "creation_date": 1556095628, "post_id": 55825742, "comment_id": 98316864, "body": "You can order on oldest an choose the oldest answer, the choice is yours :-)"}, {"owner": {"reputation": 127, "user_id": 9299234, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mOF5X.jpg?s=128&g=1", "display_name": "E.Belekov", "link": "https://stackoverflow.com/users/9299234/e-belekov"}, "edited": false, "score": 0, "creation_date": 1556285470, "post_id": 55825742, "comment_id": 98397407, "body": "Sorry for the fact that it&#39;s been 2 days, thanks anyway!"}], "tags": [], "owner": {"reputation": 126, "user_id": 10716018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6de41fd94bb82d993616a8e64e92c3ab?s=128&d=identicon&r=PG&f=1", "display_name": "D.Dsn", "link": "https://stackoverflow.com/users/10716018/d-dsn"}, "is_accepted": true, "score": 0, "last_activity_date": 1556095008, "creation_date": 1556095008, "answer_id": 55825742, "question_id": 55825671, "link": "https://stackoverflow.com/questions/55825671/date-not-saved-correctly-to-mysql/55825742#55825742", "title": "Date not saved correctly to MySQL", "body": "<p>I think you simple need to change the type from DATE to DATETIME in mySQL</p>\n\n<pre><code>alter table &lt;tableName&gt; modify &lt;columnName&gt; DATETIME;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 36799, "user_id": 3840840, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IN2xy.png?s=128&g=1", "display_name": "Sebastian Brosch", "link": "https://stackoverflow.com/users/3840840/sebastian-brosch"}, "is_accepted": false, "score": 1, "last_activity_date": 1556095723, "last_edit_date": 1556095723, "creation_date": 1556095009, "answer_id": 55825743, "question_id": 55825671, "link": "https://stackoverflow.com/questions/55825671/date-not-saved-correctly-to-mysql/55825743#55825743", "title": "Date not saved correctly to MySQL", "body": "<p>In case you want to store the time too, you have to use <code>DATETIME</code> instead of <code>DATE</code>.</p>\n\n<p>You can use the following query to <a href=\"https://stackoverflow.com/questions/1356866/how-do-i-change-the-data-type-for-a-column-in-mysql\">change the column type</a> of column <code>createdAt</code>:</p>\n\n<pre><code>ALTER TABLE posts MODIFY createdAt DATETIME\n</code></pre>\n\n<hr>\n\n<p>The <code>DATE</code> data type can't store a time part so you have to use <code>DATETIME</code>:</p>\n\n<pre><code>SELECT CAST(NOW() AS DATE);     -- 2019-04-24\nSELECT CAST(NOW() AS DATETIME); -- 2019-04-24 09:47:57\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 9299234, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mOF5X.jpg?s=128&g=1", "display_name": "E.Belekov", "link": "https://stackoverflow.com/users/9299234/e-belekov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 768, "favorite_count": 0, "accepted_answer_id": 55825742, "answer_count": 2, "score": -1, "last_activity_date": 1556095723, "creation_date": 1556094795, "last_edit_date": 1556095118, "question_id": 55825671, "link": "https://stackoverflow.com/questions/55825671/date-not-saved-correctly-to-mysql", "title": "Date not saved correctly to MySQL", "body": "<p>MySQL doesn't save the date properly.I am trying to add createdAt column in database.</p>\n\n<p>I've tried using MySQL NOW() function already, but it doesn't seem to work.</p>\n\n<p>// Go pseudo-code with sql query<br/></p>\n\n<pre><code>stmt, _:= d.db.Prepare(\"INSERT INTO posts(title, body, EmailHref, SlackHref, DiscordHref, InstHref, Time) VALUES(?, ?, ?, ?, ?, ?, NOW());\")\nres, err := stmt.Exec(newPost.Title, newPost.Body, newPost.EmailHref, newPost.SlackHref, newPost.DiscordHref, newPost.InstHref)\n</code></pre>\n\n<p>The type for createdAt column in MYSQL is DATE.</p>\n\n<p>This is what I get when i fetch newly created post:</p>\n\n<pre><code>\"time\": \"2019-04-24T00:00:00Z\"\n</code></pre>\n\n<p>I expect to get actual time with up to minutes.</p>\n"}, {"tags": ["go", "pprof"], "answers": [{"comments": [{"owner": {"reputation": 2020, "user_id": 1755542, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5cbfb78316fa4a4766c8a34ae5abbed7?s=128&d=identicon&r=PG", "display_name": "kvh", "link": "https://stackoverflow.com/users/1755542/kvh"}, "edited": false, "score": 1, "creation_date": 1556098102, "post_id": 55825798, "comment_id": 98318400, "body": "Is the increasing of this two number, indicating memory leak?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 2020, "user_id": 1755542, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5cbfb78316fa4a4766c8a34ae5abbed7?s=128&d=identicon&r=PG", "display_name": "kvh", "link": "https://stackoverflow.com/users/1755542/kvh"}, "edited": false, "score": 0, "creation_date": 1556102684, "post_id": 55825798, "comment_id": 98320996, "body": "@kvh, no, not at all. It means that more samples are added to a profile over time. Obviously the behavior of a program can change over time, so continuous profiling is totally expected."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 0, "last_activity_date": 1556095177, "creation_date": 1556095177, "answer_id": 55825798, "question_id": 55825508, "link": "https://stackoverflow.com/questions/55825508/golang-pprof-heap-count-meaning/55825798#55825798", "title": "golang pprof heap count meaning", "body": "<p>Inspecting <a href=\"https://github.com/golang/go/blob/5bd88b0/src/net/http/pprof/pprof.go#L325\" rel=\"nofollow noreferrer\">the template for the index page</a> shows that the count is produced by <a href=\"https://golang.org/pkg/runtime/pprof/#Profile.Count\" rel=\"nofollow noreferrer\">pprof.Profile.Count</a>:</p>\n\n<blockquote>\n  <p>Count returns the number of execution stacks currently in the profile.</p>\n</blockquote>\n\n<p>In other words, the index page shows the number of samples that have been collected for each type of profile so far. They are not related to any particular metric, such as inuse_objects or inuse_space.</p>\n"}], "owner": {"reputation": 2020, "user_id": 1755542, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5cbfb78316fa4a4766c8a34ae5abbed7?s=128&d=identicon&r=PG", "display_name": "kvh", "link": "https://stackoverflow.com/users/1755542/kvh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 888, "favorite_count": 0, "accepted_answer_id": 55825798, "answer_count": 1, "score": 2, "last_activity_date": 1556095177, "creation_date": 1556094212, "question_id": 55825508, "link": "https://stackoverflow.com/questions/55825508/golang-pprof-heap-count-meaning", "title": "golang pprof heap count meaning", "body": "<h1>Description</h1>\n\n<p>I try to use pprof to profile my programme, and i am using</p>\n\n<pre><code>import _ net/http/pprof to add /debug/pprof endpoints in my service.\n</code></pre>\n\n<p>access in browser:</p>\n\n<pre><code>http://ip:port/debug/pprof/\n</code></pre>\n\n<p>then i will have the following page:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Ku5by.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Ku5by.png\" alt=\"debug-pprof-heap\"></a></p>\n\n<h2>Everytime when i try to refresh this page, the number in the boxes keep increase!!</h2>\n\n<p>When i follow the link: <a href=\"http://ip:port/debug/pprof/heap?debug=1\" rel=\"nofollow noreferrer\">http://ip:port/debug/pprof/heap?debug=1</a></p>\n\n<p>i will see the following:</p>\n\n<p><a href=\"https://i.stack.imgur.com/kHRHV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/kHRHV.png\" alt=\"debug-pprof-heap-detail\"></a></p>\n\n<p>the 4 numbers here :</p>\n\n<pre><code>2508: 273338776 [4733405: 12257136096]\n</code></pre>\n\n<p>means inuse_objects: inuse_space [all_objects: alloc_space], am i right?</p>\n\n<h1>Question</h1>\n\n<h2>What do this two numbers in boxes actually mean?</h2>\n\n<p>Does the \"heap count\" has any relation with the <code>inuse_objects</code> ?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4920, "user_id": 5401681, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/852873768142712/picture?type=large", "display_name": "Inconnu", "link": "https://stackoverflow.com/users/5401681/inconnu"}, "is_accepted": false, "score": 1, "last_activity_date": 1556093170, "creation_date": 1556093170, "answer_id": 55825181, "question_id": 55824274, "link": "https://stackoverflow.com/questions/55824274/binding-goroutines-to-cpu-cores/55825181#55825181", "title": "Binding GoRoutines to cpu cores", "body": "<ul>\n<li>Use reuseport listener.</li>\n<li>Run a separate server instance per CPU core with GOMAXPROCS=1.</li>\n<li>Pin each server instance to a separate CPU core using taskset.</li>\n<li>Ensure the interrupts of multiqueue network card are evenly\ndistributed between CPU cores. See this article for details.</li>\n</ul>\n\n<p>Full details can be found <a href=\"https://github.com/valyala/fasthttp#performance-optimization-tips-for-multi-core-systems\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 25, "user_id": 4817150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DWBV9.jpg?s=128&g=1", "display_name": "Cerulean", "link": "https://stackoverflow.com/users/4817150/cerulean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 1, "closed_date": 1556095179, "answer_count": 1, "score": 1, "last_activity_date": 1556099925, "creation_date": 1556089921, "last_edit_date": 1556099925, "question_id": 55824274, "link": "https://stackoverflow.com/questions/55824274/binding-goroutines-to-cpu-cores", "closed_reason": "Duplicate", "title": "Binding GoRoutines to cpu cores", "body": "<p>I need to run a number of go routines and bind them to separate CPU cores for a benchmark test.</p>\n\n<p>I've tried with runtime.LockOSThread() but this degrades performance significantly. I do not want to lock go rountines to specific threads and in my understanding LockOSThread does just that.</p>\n\n<p>Ex: If I have n goroutines where n>1 they should be bound to n cores where GOMAXPROCS >= n. That is each goroutine is always scheduled on the same core.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1556087221, "post_id": 55823465, "comment_id": 98312583, "body": "You are looking for <a href=\"https://golang.org/pkg/strconv/#Itoa\" rel=\"nofollow noreferrer\">strconv.Itoa</a> or <a href=\"https://golang.org/pkg/strconv/#FormatUint\" rel=\"nofollow noreferrer\">strconv.FormatUint</a>. That&#39;s not hex encoding, though."}, {"owner": {"reputation": 21, "user_id": 11206261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d93d57a13796a0cd666a87382c35635?s=128&d=identicon&r=PG&f=1", "display_name": "theNebuchadnezzar", "link": "https://stackoverflow.com/users/11206261/thenebuchadnezzar"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1556088131, "post_id": 55823465, "comment_id": 98312989, "body": "Thank,  strconv.Itoa will work.I found an answer here, <a href=\"https://stackoverflow.com/questions/31220421/convert-a-byte-to-string-in-golang\">link</a>"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 11206261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d93d57a13796a0cd666a87382c35635?s=128&d=identicon&r=PG&f=1", "display_name": "theNebuchadnezzar", "link": "https://stackoverflow.com/users/11206261/thenebuchadnezzar"}, "edited": false, "score": 0, "creation_date": 1556088254, "post_id": 55823573, "comment_id": 98313046, "body": "``` string(byteArray[0]  ```  this will turn byte &quot;72&quot; to string &quot;H&quot;"}], "tags": [], "owner": {"reputation": 527, "user_id": 335472, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3eec49d54e643c464a5d9e42c8dd5c59?s=128&d=identicon&r=PG", "display_name": "Joao Henrique", "link": "https://stackoverflow.com/users/335472/joao-henrique"}, "is_accepted": false, "score": -2, "last_activity_date": 1556086986, "creation_date": 1556086986, "answer_id": 55823573, "question_id": 55823465, "link": "https://stackoverflow.com/questions/55823465/how-to-get-a-strings-hex-value-with-string-type-in-go/55823573#55823573", "title": "How to get a string&#39;s hex value with string type in Go", "body": "<p>There you go.</p>\n\n<pre><code>byteArray := []byte(\"Hello, \u4e16\u754c-123..\")\nfmt.Println(string(byteArray[0]))\n\n// H\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "is_accepted": true, "score": 1, "last_activity_date": 1556097634, "last_edit_date": 1556097634, "creation_date": 1556088119, "answer_id": 55823836, "question_id": 55823465, "link": "https://stackoverflow.com/questions/55823465/how-to-get-a-strings-hex-value-with-string-type-in-go/55823836#55823836", "title": "How to get a string&#39;s hex value with string type in Go", "body": "<p>You can use <a href=\"https://golang.org/pkg/strconv/#Itoa\" rel=\"nofollow noreferrer\"><code>strconv.Itoa</code></a>:</p>\n\n<pre><code>byteArray := []byte(\"Hello, \u4e16\u754c-123..\")\n\nfor _, v := range byteArray {\n    s := strconv.Itoa(int(v))\n    fmt.Printf(\"%T, %v\\n\", s, s)\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 11206261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d93d57a13796a0cd666a87382c35635?s=128&d=identicon&r=PG&f=1", "display_name": "theNebuchadnezzar", "link": "https://stackoverflow.com/users/11206261/thenebuchadnezzar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 55823836, "answer_count": 2, "score": 0, "last_activity_date": 1556097634, "creation_date": 1556086442, "last_edit_date": 1556097587, "question_id": 55823465, "link": "https://stackoverflow.com/questions/55823465/how-to-get-a-strings-hex-value-with-string-type-in-go", "title": "How to get a string&#39;s hex value with string type in Go", "body": "<p>I have a string, <code>byteArray</code>:</p>\n\n<pre><code>byteArray := []byte(\"Hello, \u4e16\u754c-123..\")\nfmt.Println(byteArray)\n</code></pre>\n\n<p>which looks like:</p>\n\n<pre><code>[72 101 108 108 111 44 32 228 184 150 231 149 140 45 49 50 51 46 46]\n</code></pre>\n\n<p>I need to get <code>byteArray[0]</code> as a string, like <code>\"72\"</code>, but they're byte type.</p>\n\n<p>How do I achieve this?</p>\n"}, {"tags": ["arrays", "excel", "parsing", "go"], "answers": [{"tags": [], "owner": {"reputation": 769, "user_id": 1814087, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/Oo4uE.jpg?s=128&g=1", "display_name": "nikhil", "link": "https://stackoverflow.com/users/1814087/nikhil"}, "is_accepted": true, "score": 1, "last_activity_date": 1556085828, "creation_date": 1556085828, "answer_id": 55823340, "question_id": 55823260, "link": "https://stackoverflow.com/questions/55823260/go-parsing-byte-array-of-excel-data-using-https-github-com-tealeg-xlsx-libra/55823340#55823340", "title": "GO : Parsing byte array of excel data using https://github.com/tealeg/xlsx library in GOLANG", "body": "<p>Got it.\nUsed \n     func OpenBinary(bs []byte) (*File, error)</p>\n"}], "owner": {"reputation": 769, "user_id": 1814087, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/Oo4uE.jpg?s=128&g=1", "display_name": "nikhil", "link": "https://stackoverflow.com/users/1814087/nikhil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 724, "favorite_count": 0, "accepted_answer_id": 55823340, "answer_count": 1, "score": 0, "last_activity_date": 1556092340, "creation_date": 1556085455, "last_edit_date": 1556092340, "question_id": 55823260, "link": "https://stackoverflow.com/questions/55823260/go-parsing-byte-array-of-excel-data-using-https-github-com-tealeg-xlsx-libra", "title": "GO : Parsing byte array of excel data using https://github.com/tealeg/xlsx library in GOLANG", "body": "<p>I want Parse byte array of  excel data using <a href=\"https://github.com/tealeg/xlsx\" rel=\"nofollow noreferrer\">https://github.com/tealeg/xlsx</a> library in GOLANG.\nActully i am getting data from the request(as byte array) to my GRPC server where I have to parse and process  it.</p>\n\n<p>I checked library API but it accepts file name as parameter.</p>\n\n<pre><code>\"github.com/tealeg/xlsx\"\n\nfunc main(){\nxlsx.OpenFile(\"file.xslx\")\n}\n</code></pre>\n\n<p>Any idea how do I pass byte array directly and process the same.</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 397, "user_id": 4997793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5dkyN.jpg?s=128&g=1", "display_name": "Nima Ghoroubi", "link": "https://stackoverflow.com/users/4997793/nima-ghoroubi"}, "is_accepted": false, "score": 1, "last_activity_date": 1556093962, "creation_date": 1556093962, "answer_id": 55825417, "question_id": 55821964, "link": "https://stackoverflow.com/questions/55821964/go-gorm-how-to-use-scan-and-preloading/55825417#55825417", "title": "Go-Gorm | How to use Scan and Preloading", "body": "<p>@Anh Vinh Huynh\nGorm Scan method doesn't support Preloading, so you must use the Find method instead. (your Soloution2)\nAnd remove <code>gorm:\"-\"</code> tag from StartAt and EndAt of </p>\n"}], "owner": {"reputation": 151, "user_id": 9148161, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh6.googleusercontent.com/-jv8zt6uYZ9Y/AAAAAAAAAAI/AAAAAAAAE1Y/EcmnHvHIAfY/photo.jpg?sz=128", "display_name": "Anh Vinh Hu\u1ef3nh", "link": "https://stackoverflow.com/users/9148161/anh-vinh-hu%e1%bb%b3nh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 606, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1556278065, "creation_date": 1556076399, "last_edit_date": 1556278065, "question_id": 55821964, "link": "https://stackoverflow.com/questions/55821964/go-gorm-how-to-use-scan-and-preloading", "title": "Go-Gorm | How to use Scan and Preloading", "body": "<p>I'm newbie in Go and GORM. I'm having a problem with gorm when I want to join two table and select all field in two table. </p>\n\n<p>My model: </p>\n\n<p>Action: </p>\n\n<pre><code>type Action struct {\n    ID        uint64\n    Type      int\n    Url       string\n}\n</code></pre>\n\n<pre><code>type Reminder struct {\n    ID            uint64 `gorm:\"primary_key\"`\n    MerchantID    uint64\n    MerReminderID string\n    Title         string\n    Description   string\n    ActionID      uint64\n    Action        *Action `gorm:\"save_associations:false\"`\n    Payload       string\n    StartAt       time.Time `gorm:\"-\"`\n    EndAt         time.Time `gorm:\"-\"`\n}\n</code></pre>\n\n<pre><code>type UserReminder struct {\n    UserID     uint64\n    ReminderID uint64\n    Reminder   Reminder\n    StartAt    time.Time\n    EndAt      time.Time\n    Expired    bool\n}\n</code></pre>\n\n<p>My request: I want to get all <code>Reminder</code> of once <code>UserID</code>. </p>\n\n<ul>\n<li>Solution 1: </li>\n</ul>\n\n<pre><code>var reminders []*models.Reminder\nerr := db.Set(\"gorm:auto_preload\", true).\n    Raw(\"SELECT * FROM user_reminders AS ur, reminders AS r WHERE ur.reminder_id = r.id AND ur.user_id = ?\", userID).\n    Preload(\"Actions\").\n    Scan(&amp;reminders)\n</code></pre>\n\n<p>=> <em>Promblem</em>: Select all column when join two table but Object <code>Action</code> can't preloading. </p>\n\n<ul>\n<li>Solution 2: </li>\n</ul>\n\n<pre><code>var reminders []*models.Reminder\nerr := db.Set(\"gorm:auto_preload\", true).\n        Joins(\"JOIN user_reminders ON user_reminders.reminder_id = reminders.id\").\n    Where(\"user_reminders.user_id = ? AND user_reminders.end_at &gt;= ? AND user_reminders.deleted_at IS NULL\", userID, time.Now()).\n    Find(&amp;reminders)\n</code></pre>\n\n<p>=> <em>Problem</em>: Auto-preload success object <code>Action</code> and select all column in table <code>Reminder</code>. But miss two column <code>Start_At</code> and <code>End_At</code> in table <code>User_Reminder</code></p>\n\n<p>Please help me this problem. In my case, I want to auto preloading object Action and select all column when join two table <code>Reminder</code> and <code>User_Reminder</code></p>\n\n<p>Thanks so much.</p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "edited": false, "score": 0, "creation_date": 1556074595, "post_id": 55821663, "comment_id": 98309383, "body": "<a href=\"https://play.golang.org/p/yZVtiEbugWH\" rel=\"nofollow noreferrer\">play.golang.org/p/yZVtiEbugWH</a>"}], "answers": [{"tags": [], "owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "is_accepted": true, "score": 3, "last_activity_date": 1556074923, "creation_date": 1556074923, "answer_id": 55821776, "question_id": 55821663, "link": "https://stackoverflow.com/questions/55821663/xml-unmarshal-base64-string-to-struct-in-golang/55821776#55821776", "title": "XML Unmarshal base64 string to struct in Golang", "body": "<p><a href=\"https://play.golang.org/p/yZVtiEbugWH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/yZVtiEbugWH</a></p>\n\n<pre><code>// define new type called BBar\n// same with bar\ntype BBar Bar \nxx := new(BBar)\n// the BBar doesn't have UnmarshalXML method\nxml.Unmarshal([]byte(result), xx)\n*m = Bar(*xx)\n</code></pre>\n"}], "owner": {"reputation": 940, "user_id": 195457, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/6162b2a29e6f3794e3a27819a8830d33?s=128&d=identicon&r=PG", "display_name": "korrawit", "link": "https://stackoverflow.com/users/195457/korrawit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 615, "favorite_count": 0, "accepted_answer_id": 55821776, "answer_count": 1, "score": 0, "last_activity_date": 1556074923, "creation_date": 1556073943, "question_id": 55821663, "link": "https://stackoverflow.com/questions/55821663/xml-unmarshal-base64-string-to-struct-in-golang", "title": "XML Unmarshal base64 string to struct in Golang", "body": "<p>Currently, I'm implementing custom unmarshal xml for <code>Bar</code> which will unmarshal base64 string to <code>Bar</code> struct.</p>\n\n<p>But when I run this program, it's stackoverflow like infinite recursive unmarshal my custom unmarshal.</p>\n\n<p>GO Playground: <a href=\"https://play.golang.org/p/QD4IdxhZr1Q\" rel=\"nofollow noreferrer\">https://play.golang.org/p/QD4IdxhZr1Q</a></p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/base64\"\n    \"encoding/xml\"\n    \"fmt\"\n)\n\ntype Foo struct {\n    A Bar `xml:\"a\"`\n}\n\ntype Bar struct {\n    B string `xml:\"b\"`\n    C string `xml:\"c\"`\n    D string `xml:\"d\"`\n}\n\nfunc main() {\n    var foo Foo\n    // Input\n    s := `&lt;Foo&gt;&lt;a&gt;PGI+Yi10ZXN0PC9iPjxjPmMtdGVzdDwvYz48ZD5kLXRlc3Q8L2Q+Cg==&lt;/a&gt;&lt;/Foo&gt;`\n\n    err := xml.Unmarshal([]byte(s), &amp;foo)\n\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(\"Foo:\", foo)\n\n}\n\nfunc (m *Bar) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n    var s string\n    err := d.DecodeElement(&amp;s, &amp;start)\n\n    fmt.Println(\"Decode Element:\", s)\n\n    if err != nil {\n        return err\n    }\n\n    data, err := base64.StdEncoding.DecodeString(s)\n\n    if err != nil {\n        return err\n    }\n\n    fmt.Println(\"Base64 Decoded string:\", string(data))\n\n    var buf bytes.Buffer\n    buf.WriteString(\"&lt;Bar&gt;\")\n    buf.WriteString(string(data))\n    buf.WriteString(\"&lt;/Bar&gt;\")\n    result := buf.String()\n    fmt.Println(\"After add root node:\", result)\n\n    xml.Unmarshal([]byte(result), &amp;m)\n\n    return nil\n}\n</code></pre>\n\n<p>Thank you!</p>\n"}, {"tags": ["go", "load-testing", "mongo-go"], "owner": {"reputation": 431, "user_id": 9165051, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-NmIf22tfeLo/AAAAAAAAAAI/AAAAAAAAAFg/lM-mRb8563k/photo.jpg?sz=128", "display_name": "Heron Rossi", "link": "https://stackoverflow.com/users/9165051/heron-rossi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1383, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1609702045, "creation_date": 1556070503, "last_edit_date": 1609702045, "question_id": 55821262, "link": "https://stackoverflow.com/questions/55821262/golang-mongo-go-driver-hangs-timeout-on-collection-insertone-during-load-test", "title": "Golang mongo-go-driver hangs/timeout on collection.InsertOne during load test", "body": "<p>I'm trying to loadtest a simple go/mongo API with vegeta, but I'm only getting timeout during the test of the <code>POST</code> endpoint.</p>\n<p>Mongo driver <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">https://github.com/mongodb/mongo-go-driver</a></p>\n<p>Handler</p>\n<pre class=\"lang-golang prettyprint-override\"><code>// CreateAccount handles creation of a new Account\nfunc CreateAccount(w http.ResponseWriter, r *http.Request) {\n    var account schemas.Account\n    json.NewDecoder(r.Body).Decode(&amp;account)\n\n    account.Name = RandStringBytes(10)\n    if err := account.Create(); err != nil {\n        log.Fatal(err)\n    } else {\n\n        w.Header().Add(&quot;Content-Type&quot;, &quot;application/json&quot;)\n        w.WriteHeader(http.StatusCreated)\n\n        json.NewEncoder(w).Encode(&amp;account)\n\n    }\n\n}\n</code></pre>\n<p>Account.Create</p>\n<pre class=\"lang-golang prettyprint-override\"><code>// Create Creates an Account\nfunc (acc *Account) Create() error {\n    ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)\n    defer cancel()\n\n    acc.ID = primitive.NewObjectID()\n\n    if err := acc.hashPassword(); err != nil {\n        log.Fatal(err)\n    }\n\n    _, err := accountCollection.InsertOne(ctx, acc)\n    if err != nil {\n        return err\n    }\n\n    return nil\n}\n</code></pre>\n<p>InitDb (Called in main.go)</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func InitDb(databaseURI string) {\n    ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)\n    defer cancel()\n\n    var err error\n    Db, err = mongo.Connect(ctx, options.Client().ApplyURI(databaseURI))\n    accountCollection = Db.Database(databaseName).Collection(accountCollectionName)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if err = Db.Ping(ctx, readpref.Primary()); err != nil {\n        log.Fatal(err)\n    }\n\n}\n</code></pre>\n<p>Testing <code>GET</code> endpoints work as expected. The only problem is with <code>POST</code> endpoint</p>\n<p>Doing a simple <code>jq -ncM '{method: &quot;POST&quot;, url: &quot;http://localhost:8080/accounts&quot;, body: &quot;Punch!&quot; | @base64, header: {&quot;Content-Type&quot;: [&quot;applicati/json&quot;]}}' |   vegeta attack -format=json -rate=100 | vegeta encode</code> for the creation of random empty documents will produce the following logs:</p>\n<p>httpserver:</p>\n<pre><code>(master) $ go run main.go \nServer running :8080\n2019/04/23 22:36:46 Error\n2019/04/23 22:36:46 context deadline exceeded\nexit status 1\n</code></pre>\n<p>mongo (&quot;vanilla&quot; container from official docker-hub)</p>\n<pre><code>sudo docker run --rm -p 27017:27017 mongo\n2019-04-24T01:35:43.128+0000 I NETWORK  [listener] connection accepted from 172.17.0.1:34002 #1 (1 connection now open)\n2019-04-24T01:36:46.193+0000 I NETWORK  [conn1] end connection 172.17.0.1:34002 (0 connections now open)\n</code></pre>\n<p>vegeta</p>\n<pre><code>$ jq -ncM '{method: &quot;POST&quot;, url: &quot;http://localhost:8080/accounts&quot;, body: &quot;Punch!&quot; | @base64, header: {&quot;Content-Type&quot;: [&quot;applicati/json&quot;]}}' |   vegeta attack -format=json -rate=50 | vegeta encode\n{&quot;attack&quot;:&quot;&quot;,&quot;seq&quot;:1020,&quot;code&quot;:0,&quot;timestamp&quot;:&quot;2019-04-24T01:39:27.355666931Z&quot;,&quot;latency&quot;:0,&quot;bytes_out&quot;:0,&quot;bytes_in&quot;:0,&quot;error&quot;:&quot;Post http://localhost:8080/accounts: dial tcp: lookup localhost: device or resource busy&quot;,&quot;body&quot;:null}\n{&quot;attack&quot;:&quot;&quot;,&quot;seq&quot;:1021,&quot;code&quot;:0,&quot;timestamp&quot;:&quot;2019-04-24T01:39:27.375672741Z&quot;,&quot;latency&quot;:0,&quot;bytes_out&quot;:0,&quot;bytes_in&quot;:0,&quot;error&quot;:&quot;Post http://localhost:8080/accounts: dial tcp: lookup localhost: device or resource busy&quot;,&quot;body&quot;:null}\n{&quot;attack&quot;:&quot;&quot;,&quot;seq&quot;:1022,&quot;code&quot;:0,&quot;timestamp&quot;:&quot;2019-04-24T01:39:27.395670955Z&quot;,&quot;latency&quot;:0,&quot;bytes_out&quot;:0,&quot;bytes_in&quot;:0,&quot;error&quot;:&quot;Post http://localhost:8080/accounts: dial tcp: lookup localhost: device or resource busy&quot;,&quot;body&quot;:null}\n</code></pre>\n<p>If I drop the <code>-rate</code>to 5 it works but it still hangs for 1 or 2 seconds between requests.\nFrom the http server error it seems that go is loosing connection with mongo\nAny tips on how to debug it further ?</p>\n"}, {"tags": ["git", "shell", "go"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 2, "creation_date": 1556065185, "post_id": 55820926, "comment_id": 98308231, "body": "What&#39;s the failure message?"}, {"owner": {"reputation": 7064, "user_id": 86263, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d4583c9731327f0af726920c388ea327?s=128&d=identicon&r=PG", "display_name": "bitcycle", "link": "https://stackoverflow.com/users/86263/bitcycle"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1556069040, "post_id": 55820926, "comment_id": 98308344, "body": "@Mark, I updated the question with the exit status and error message."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 2, "creation_date": 1556070222, "post_id": 55820926, "comment_id": 98308538, "body": "<code>strace -f</code> both, and look for the difference. Pay attention to the current working directory, too."}], "owner": {"reputation": 7064, "user_id": 86263, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d4583c9731327f0af726920c388ea327?s=128&d=identicon&r=PG", "display_name": "bitcycle", "link": "https://stackoverflow.com/users/86263/bitcycle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556112535, "creation_date": 1556064164, "last_edit_date": 1556112535, "question_id": 55820926, "link": "https://stackoverflow.com/questions/55820926/golang-command-failing-when-shell-command-works", "title": "golang + Command failing when shell command works", "body": "<p>Why does this fail (error 128, not a valid repository):</p>\n\n<pre><code>func main() {\n  command_base := \"/usr/local/bin/git-upload-pack\"\n  command_args := []string{\"/repos/bar/foo.git\"}\n  cmd := exec.Command(command_base, command_args...)\n  out, err := cmd.CombinedOutput()\n  if err != nil {\n    log.Fatalf(\"cmd.Run() failed with %s\\n\", err)\n  }\n  fmt.Printf(\"combined out:\\n%s\\n\", string(out))\n}\n</code></pre>\n\n<p>When this succeeds ...</p>\n\n<pre><code>$ /usr/local/bin/git-upload-pack /repos/bar/foo.git\n00f262621d854b3299d7f17d6f1523435396cfcf8357 HEADmulti_ack thin-pack side-band side-band-64k ofs-delta shallow deepen-since deepen-not deepen-relative no-progress include-tag multi_ack_detailed symref=HEAD:refs/heads/master agent=git/2.21.0\n003f62621d854b3299d7f17d6f1523435396cfcf8357 refs/heads/master\n0000\n</code></pre>\n"}, {"tags": ["unit-testing", "go", "mocking", "gomock"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1556045701, "post_id": 55817579, "comment_id": 98301929, "body": "Looks like <code>TestService</code> doesn&#39;t do much of anything, its <code>service</code> field is what&#39;s actually being tested. But the <code>NewService</code> call takes only the mock repo, not the mock client. You&#39;ll need some way to inject the mock client into the actual <code>Service</code> for it to use it for anything."}, {"owner": {"reputation": 362, "user_id": 6735418, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/Nhem2.jpg?s=128&g=1", "display_name": "Amr A.", "link": "https://stackoverflow.com/users/6735418/amr-a"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556045947, "post_id": 55817579, "comment_id": 98302010, "body": "Correct, TestService was just struct to bundle everything together. Yes, I see what you are saying, need to inject mockClient somehow."}], "answers": [{"tags": [], "owner": {"reputation": 362, "user_id": 6735418, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/Nhem2.jpg?s=128&g=1", "display_name": "Amr A.", "link": "https://stackoverflow.com/users/6735418/amr-a"}, "is_accepted": false, "score": 0, "last_activity_date": 1556106961, "creation_date": 1556106961, "answer_id": 55829498, "question_id": 55817579, "link": "https://stackoverflow.com/questions/55817579/using-two-different-mocks-in-go-unit-test/55829498#55829498", "title": "Using Two Different Mocks in Go Unit Test", "body": "<p>I resolved this as Adrian in the comments above suggested. I was missing a way to pass the mock client into the NewService and ended up adding a client parameter to NewService.</p>\n"}], "owner": {"reputation": 362, "user_id": 6735418, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/Nhem2.jpg?s=128&g=1", "display_name": "Amr A.", "link": "https://stackoverflow.com/users/6735418/amr-a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 260, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1556106961, "creation_date": 1556045151, "question_id": 55817579, "link": "https://stackoverflow.com/questions/55817579/using-two-different-mocks-in-go-unit-test", "title": "Using Two Different Mocks in Go Unit Test", "body": "<p>I am learning to do unit testing using mocks in Go for the first time, using gomock's mockgen utility. My unit tests work fine except for one of them. The method-under-test has two dependencies: one on a database, and the other on an external service it makes rest api calls to. The mock for the database (mockRepo) works fine in that the method-under-test properly invokes the mock instead of the actual repo code. The mock for the rest client, however, continues to invoke the actual rest client and not the mock code. I can't figure out why. Can someone explain why and help fix?</p>\n\n<p>Here is my unit test:</p>\n\n<pre><code>func TestService_CreateWorkspace(t *testing.T) {\n    ts := NewTestService(t)\n    defer ts.mockCtrl.Finish()\n\n    ts.mockClient.EXPECT().POST(gomock.Any(), gomock.Any(), gomock.Any()).Times(1).Return(&amp;http.Response{StatusCode: 200}, nil)\n\n    testWs := TestWorkspaces()[\"max-ws\"]\n    ts.mockRepo.EXPECT().Create(testWs).Times(1).Return(&amp;testWs, nil)\n\n    ws, err := ts.service.CreateWorkspace(&amp;testWs)\n\n    assert.Equal(t, testWs, ws)\n    assert.NoError(t, err)\n}\n</code></pre>\n\n<p>Here is the code for NewTestService:</p>\n\n<pre><code>type TestService struct {\n    mockCtrl   *gomock.Controller\n    mockClient *MockRestClient\n    mockRepo   *MockRepository\n    service    Service\n}\n\nfunc NewTestService(t *testing.T) *TestService {\n    mockCtrl := gomock.NewController(t)\n    mockRepo := NewMockRepository(mockCtrl)\n    mockClient := NewMockRestClient(mockCtrl)\n    return &amp;TestService{\n        mockCtrl:   mockCtrl,\n        mockClient: mockClient,\n        mockRepo:   mockRepo,\n        service:    NewService(mockRepo),\n    }\n}\n</code></pre>\n\n<p>Is there an issue with assigning the same mock controller to two different mock objects? Not really sure what's going on here. Any help appreciated.</p>\n"}, {"tags": ["go", "web", "go-html-template", "go-http"], "answers": [{"tags": [], "owner": {"reputation": 42, "user_id": 2035359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85b2313f4db3e279295cb4a89f9feb28?s=128&d=identicon&r=PG", "display_name": "Soslan", "link": "https://stackoverflow.com/users/2035359/soslan"}, "is_accepted": true, "score": 2, "last_activity_date": 1556044096, "last_edit_date": 1556044096, "creation_date": 1556041763, "answer_id": 55816805, "question_id": 55816187, "link": "https://stackoverflow.com/questions/55816187/displaying-a-pagination-widget-in-go/55816805#55816805", "title": "Displaying a pagination widget in Go", "body": "<p>Check next solution</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nconst PSIZE = 5\n\nfunc pager(pageNo int) {\n    var start int = pageNo/(PSIZE-1)*(PSIZE-1) + 1\n    if pageNo%(PSIZE-1) == 0 {\n        start -= PSIZE - 1\n    }\n\n    for i := start; i &lt; start+PSIZE; i++ {\n        if i == pageNo {\n            fmt.Printf(\"(%d) \", i)\n        } else {\n            fmt.Printf(\"%d \", i)\n        }\n    }\n    fmt.Print(\"\\n\")\n}\n\nfunc main() {\n    pager(4)\n    pager(8)\n    pager(9)\n}\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>1 2 3 (4) 5 \n5 6 7 (8) 9 \n(9) 10 11 12 13 \n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/rFslGe2OE0k\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rFslGe2OE0k</a></p>\n"}], "owner": {"reputation": 3, "user_id": 11401103, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ItjKFqHbGm0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfR_iB-35Ho4Gr0voeaNnx-pDXs2g/mo/photo.jpg?sz=128", "display_name": "Lookas", "link": "https://stackoverflow.com/users/11401103/lookas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 520, "favorite_count": 1, "accepted_answer_id": 55816805, "answer_count": 1, "score": 0, "last_activity_date": 1613673015, "creation_date": 1556039120, "last_edit_date": 1613673015, "question_id": 55816187, "link": "https://stackoverflow.com/questions/55816187/displaying-a-pagination-widget-in-go", "title": "Displaying a pagination widget in Go", "body": "<p>I am using HTML templating in Go to render a pagination widget. I am trying to follow an example of how to do it from here: <a href=\"https://www.solodev.com/blog/web-design/adding-pagination-to-your-website.stml\" rel=\"nofollow noreferrer\">https://www.solodev.com/blog/web-design/adding-pagination-to-your-website.stml</a></p>\n<p>This is my code so far:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>// Item size like call 2 item from database\nvar pagesize = 2\nvar PaginationSize int = 6\nvar isActive string\nPagination := make([]int, PaginationSize)\n\nfor i := 0; i &lt; PaginationSize; i++ {\n    if RequestPageNumber &lt;= page {\n        Pagination[i] = i + 1\n    } else {\n        Pagination[i] = RequestPageNumber + i\n    }\n\n    if i == 0 {\n        isActive = &quot; active&quot;\n    } else {\n        isActive = &quot;&quot;\n    }\n    Info.Pagination += template.HTML(\n        fmt.Sprintf(`&lt;li class=&quot;page-item%s&quot;&gt;&lt;a class=&quot;page-link&quot; href=?id=%v&gt;%v&lt;/a&gt;&lt;/li&gt;`,\n            isActive, RequestPageNumber+i, RequestPageNumber+i))\n}\n</code></pre>\n<p>I would like to improve this by making the pagination list update only when the active page becomes a multiple of <code>PaginationSize</code>. For example, when the displayed pagination shows</p>\n<pre><code>(1), 2, 3, 4, 5, 6\n</code></pre>\n<p>If the user clicks on 2, I would like to see</p>\n<pre><code>1, (2), 3, 4, 5, 6\n</code></pre>\n<p>But my current code displays</p>\n<pre><code>(2), 3, 4, 5, 6, 7\n</code></pre>\n<p>After the page has advanced past 6, the page list should look like</p>\n<pre><code>7, 8, 9, 10, 11, 12 ,13 ,14\n</code></pre>\n<p>The data wrapped in this pagination view may be in a database, so I'd also appreciate tips on how to make this work with a database, if possible.</p>\n<p>Thanks.</p>\n"}, {"tags": ["json", "mongodb", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1556038203, "post_id": 55815931, "comment_id": 98298646, "body": "If you don&#39;t know what the performance impact would be, don&#39;t worry about it. Just write what works, then measure to see if you actually have a performance problem, and profile to see where performance can be improved."}, {"owner": {"reputation": 338, "user_id": 3330489, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9654aa854dfe059c85ce2176258497b6?s=128&d=identicon&r=PG", "display_name": "JuanIsFree", "link": "https://stackoverflow.com/users/3330489/juanisfree"}, "edited": false, "score": 0, "creation_date": 1556054375, "post_id": 55815931, "comment_id": 98305553, "body": "It&#39;s also worth noting that MongoDB uses Numbers for types (<a href=\"https://docs.mongodb.com/manual/reference/bson-type-comparison-order/\" rel=\"nofollow noreferrer\">docs.mongodb.com/manual/reference/bson-type-comparison-orde&zwnj;&#8203;r</a>).  I don&#39;t see how you could preserve type int after saving to Mongo anyway.  edit: apparently you can cast it: <a href=\"https://stackoverflow.com/questions/8218484/mongodb-inserts-float-when-trying-to-insert-integer\" title=\"mongodb inserts float when trying to insert integer\">stackoverflow.com/questions/8218484/&hellip;</a>"}], "owner": {"reputation": 1, "user_id": 11400934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29dd0c747e1ff26c7e07e7626d53c7b5?s=128&d=identicon&r=PG&f=1", "display_name": "brolosolo", "link": "https://stackoverflow.com/users/11400934/brolosolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556038038, "creation_date": 1556038038, "question_id": 55815931, "link": "https://stackoverflow.com/questions/55815931/is-there-a-way-to-receive-json-data-from-a-request-and-push-it-onto-a-mongodb-p", "title": "Is there a way to receive JSON data from a request and push it onto a MongoDB, preserving integer typing over floats?", "body": "<p>I need to keep numbers passed in the JSON that are fit the requirements to be an int32s to be stored in the database as int32 instead of a float. </p>\n\n<p>I have a Go application that receives JSON request data that is inserted into a Mongo database. This data is unmarshalled into an interface and passed into mgo's Insert method (<a href=\"https://godoc.org/github.com/globalsign/mgo#Collection.Insert\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/globalsign/mgo#Collection.Insert</a>). </p>\n\n<p>By default, to unmarshal data into an interface, Go converts numbers into float64s. The problem I am having is that integers unmarshalled from the JSON are not having their types preserved properly, all numbers are passed in as floats and after the insertion into Mongo, the data is saved as a float. Understandably, this is due to the restrictions on typing when using JSON as data holder.</p>\n\n<p>Since the JSON data is not well-defined and may include different types of nested dynamic objects, creating structs for this problem doesn't appear to be a viable option.</p>\n\n<p>I have researched some options that include iterating over the JSON data and using the UseNumbers() for decoding, but issue I am facing with this is that the operation could be expensive, as some of the JSON data may contain several hundreds of fields and reflection over those fields may cause slowdown while handling requests, although I am not aware of how impactful the performance hit would be.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1556037396, "post_id": 55815660, "comment_id": 98298233, "body": "Why don&#39;t you want to use the <code>math</code> package? That&#39;s where the float rounding function is."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1556037480, "post_id": 55815660, "comment_id": 98298282, "body": "An alternative would be to compare the absolute difference against a given threshold... but the <code>Abs</code> function is also in the <code>math</code> package."}, {"owner": {"reputation": 167, "user_id": 4982574, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10207847125164554/picture?type=large", "display_name": "Lance", "link": "https://stackoverflow.com/users/4982574/lance"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556044699, "post_id": 55815660, "comment_id": 98301505, "body": "The practice problem is to implement a square root function without using the the math package so I&#39;d like to stay consistent. This is really just a learning exercise as I&#39;m just now using golang for the first time"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556045553, "post_id": 55815660, "comment_id": 98301863, "body": "The standard way to compare floats is what you&#39;re doing already, the standard way to round them is using <code>math.Round</code>. It guess the exercise is for you to figure out how to do it without the standard tools normally available to a Go developer."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1556046921, "post_id": 55815660, "comment_id": 98302386, "body": "If you want a rounding function without the <code>math</code> package, see <a href=\"https://stackoverflow.com/questions/39544571/golang-round-to-nearest-0-05/39544897#39544897\">Golang Round to Nearest 0.05</a>. If you want a &quot;specialized&quot; <code>abs()</code> function (suiting your needs), that is a trivial <code>if</code> statement..."}, {"owner": {"reputation": 167, "user_id": 4982574, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10207847125164554/picture?type=large", "display_name": "Lance", "link": "https://stackoverflow.com/users/4982574/lance"}, "edited": false, "score": 0, "creation_date": 1556053101, "post_id": 55815660, "comment_id": 98305056, "body": "Adrian, the problem with what I&#39;m doing above is at a certain point z and zprev alternate between certain floating point values one with an extra level of precision which ends up in an infinite loop since z and zprev never equal themselves even though the interview of values has not changed at all after a certain amount of cycles. Just figured out how to make it work by adding z to both sides in the for loop."}], "answers": [{"tags": [], "owner": {"reputation": 35013, "user_id": 626853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ILPj4.jpg?s=128&g=1", "display_name": "Aasmund Eldhuset", "link": "https://stackoverflow.com/users/626853/aasmund-eldhuset"}, "is_accepted": false, "score": 4, "last_activity_date": 1556053989, "creation_date": 1556053989, "answer_id": 55819500, "question_id": 55815660, "link": "https://stackoverflow.com/questions/55815660/how-do-you-handle-float64-comparisons-in-golang/55819500#55819500", "title": "How do you handle float64 comparisons in golang?", "body": "<p>Instead of rounding, take the difference between the two numbers you want to compare, and check that it is between <code>-epsilon</code> and <code>epsilon</code>, where <code>epsilon</code> is whatever you consider to be a sufficiently small difference.</p>\n\n<p>Note: Unreliable equality comparisons are not go-specific; it's a universal problem with floating-point numbers.</p>\n"}, {"comments": [{"owner": {"reputation": 35013, "user_id": 626853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ILPj4.jpg?s=128&g=1", "display_name": "Aasmund Eldhuset", "link": "https://stackoverflow.com/users/626853/aasmund-eldhuset"}, "edited": false, "score": 3, "creation_date": 1556054772, "post_id": 55819524, "comment_id": 98305701, "body": "This is <i>not</i> a reliable solution! It happens to work in your example, but will fail in other situations."}, {"owner": {"reputation": 35013, "user_id": 626853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ILPj4.jpg?s=128&g=1", "display_name": "Aasmund Eldhuset", "link": "https://stackoverflow.com/users/626853/aasmund-eldhuset"}, "edited": false, "score": 1, "creation_date": 1556055384, "post_id": 55819524, "comment_id": 98305890, "body": "In general, I advise against trying something arbitrary and forging ahead if it &quot;seems to work&quot; without having understood the underlying reason for why it <i>should</i> consistently work (or, as it is in this case, realizing that it shouldn&#39;t). Why should <code>zprev + z</code> and <code>z + z</code> generally be equal in spite of <code>zprev</code> and <code>z</code> not being equal? They won&#39;t: it worked this time because it just so happened that the addition wiped out the tiny difference between <code>zprev</code> and <code>z</code> due to the inaccuracy that is inherent in floating-point operations."}, {"owner": {"reputation": 35013, "user_id": 626853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ILPj4.jpg?s=128&g=1", "display_name": "Aasmund Eldhuset", "link": "https://stackoverflow.com/users/626853/aasmund-eldhuset"}, "edited": false, "score": 0, "creation_date": 1556055420, "post_id": 55819524, "comment_id": 98305910, "body": "Other initial <code>x</code> values will lead to a different pair of <code>zprev</code> and <code>z</code>, which might happen to remain unequal after the addition."}], "tags": [], "owner": {"reputation": 167, "user_id": 4982574, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10207847125164554/picture?type=large", "display_name": "Lance", "link": "https://stackoverflow.com/users/4982574/lance"}, "is_accepted": false, "score": 0, "last_activity_date": 1556054138, "creation_date": 1556054138, "answer_id": 55819524, "question_id": 55815660, "link": "https://stackoverflow.com/questions/55815660/how-do-you-handle-float64-comparisons-in-golang/55819524#55819524", "title": "How do you handle float64 comparisons in golang?", "body": "<p>I found that the solution to this problem was to add one of the values in the comparison to both sides of the comparison.</p>\n\n<p>Below I have added z to both sides of the comparison and the comparison now works as expected.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\n\nfunc Sqrt(x float64) float64 {\n    // Need to look into float rounding in go\n    z := 1.0\n    zprev := 0.01\n    for zprev + z != z + z {\n        zprev = z\n        z -= (z*z - x) /(2*z)\n        fmt.Printf(\"z: %g\\nzprev: %g\\n\", z, zprev)\n        fmt.Println(\"_________________________________________\")\n\n    }\n    fmt.Println(\"Finished\")\n    return z\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>z: 1.5\nzprev: 1\n_________________________________________\nz: 1.4166666666666667\nzprev: 1.5\n_________________________________________\nz: 1.4142156862745099\nzprev: 1.4166666666666667\n_________________________________________\nz: 1.4142135623746899\nzprev: 1.4142156862745099\n_________________________________________\nz: 1.4142135623730951\nzprev: 1.4142135623746899\n_________________________________________\nz: 1.414213562373095\nzprev: 1.4142135623730951\n_________________________________________\nz: 1.4142135623730951\nzprev: 1.414213562373095\n_________________________________________\nFinished\n1.4142135623730951\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1104, "user_id": 11359504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8612ae78a3ab1ddc7b4bec4e317c328?s=128&d=identicon&r=PG&f=1", "display_name": "Khalid Ali", "link": "https://stackoverflow.com/users/11359504/khalid-ali"}, "is_accepted": false, "score": 2, "last_activity_date": 1556054586, "creation_date": 1556054586, "answer_id": 55819605, "question_id": 55815660, "link": "https://stackoverflow.com/questions/55815660/how-do-you-handle-float64-comparisons-in-golang/55819605#55819605", "title": "How do you handle float64 comparisons in golang?", "body": "<p>Here's how I'd do it \u2013 giving that you don't want to use the <code>math</code> package at all.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc abs(x float64) float64 {\n    if x &lt; 0 {\n        return -x\n    }\n    return x\n}\n\nfunc Sqrt(x float64) float64 {\n    z := x\n    var zprev float64\n    for abs(zprev-z) &gt; 1e-6 {\n        zprev, z = z, z-(z*z-x)/(2*z)\n    }\n    return z\n}\n\nfunc main() {\n    fmt.Println(Sqrt(2))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>1.4142135623730951\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 76, "user_id": 6368688, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5fdea02ff624e2a229907ce2f2d82f9?s=128&d=identicon&r=PG&f=1", "display_name": "CryptoRex", "link": "https://stackoverflow.com/users/6368688/cryptorex"}, "is_accepted": false, "score": 0, "last_activity_date": 1589622820, "creation_date": 1589622820, "answer_id": 61834922, "question_id": 55815660, "link": "https://stackoverflow.com/questions/55815660/how-do-you-handle-float64-comparisons-in-golang/61834922#61834922", "title": "How do you handle float64 comparisons in golang?", "body": "<p>Lance, I believe by now you must have been well versed with the programming but for others like me who are still starting here is the floating comparison as suggested by @Aasmund Eldhuset.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc Sqrt(x float64) float64 {\n    z:=float64(x/2)\n    i:=1\n    oldz := -1.0\n    for {\n        fmt.Printf(\" %d =&gt; %f\\n\",(i),z)\n        z-=(z*z-x)/(2*z)\n        if diff:=(oldz-z); diff&gt;-0.0000000001 &amp;&amp; diff&lt;0.0000000001{\n            fmt.Println(\"Breaking!\")\n            break\n        }\n        oldz = z\n        i+=1\n    }\n    return z\n}\n\nfunc main() {\n    fmt.Println(Sqrt(2))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code> 1 =&gt; 1.000000\n 2 =&gt; 1.500000\n 3 =&gt; 1.416667\n 4 =&gt; 1.414216\n 5 =&gt; 1.414214\nBreaking!\n1.4142135623730951\n</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 4982574, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10207847125164554/picture?type=large", "display_name": "Lance", "link": "https://stackoverflow.com/users/4982574/lance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2325, "favorite_count": 0, "answer_count": 4, "score": 4, "last_activity_date": 1589622820, "creation_date": 1556036941, "last_edit_date": 1556053737, "question_id": 55815660, "link": "https://stackoverflow.com/questions/55815660/how-do-you-handle-float64-comparisons-in-golang", "title": "How do you handle float64 comparisons in golang?", "body": "<p>I'm going through tour of go and am having a problem with float64 comparison in \"Exercise: Loop and functions\", where you write a function to determine the square root. </p>\n\n<p>From example:\nComputers typically compute the square root of x using a loop. Starting with some guess z, we can adjust z based on how close z\u00b2 is to x, producing a better guess:</p>\n\n<pre><code>z -= (z*z - x) / (2*z)\n</code></pre>\n\n<p>I wrote a function that continues to update z until the values stop changing.  Only the float64 comparison never fails and this results in an infinite loop. One way to solve these types of issues is to round, but I'm not sure how to do that in golang without using the math module.</p>\n\n<p>How do you round float64 numbers in golang and what is the standard way to compare floating point numbers in golang?</p>\n\n<pre><code>\npackage main\n\nimport (\n    \"fmt\"\n)\n\n\nfunc Sqrt(x float64) float64 {\n    // Need to look into float rounding in go\n    z := 1.0\n    zprev := 0.01\n    for z != zprev {\n        zprev = z\n        z -= (z*z - x) /(2*z)\n        fmt.Printf(\"z: %g\\nzprev: %g\\n\", z, zprev)\n        fmt.Println(\"_________________________________________\")\n\n\n    }\n    fmt.Println(\"Finished\")\n    return z\n}\n\n\nfunc main() {\n    fmt.Println(Sqrt(2))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>z: 1.5\nzprev: 1\n_________________________________________\nz: 1.4166666666666667\nzprev: 1.5\n_________________________________________\nz: 1.4142156862745099\nzprev: 1.4166666666666667\n_________________________________________\nz: 1.4142135623746899\nzprev: 1.4142156862745099\n_________________________________________\nz: 1.4142135623730951\nzprev: 1.4142135623746899\n_________________________________________\nz: 1.414213562373095\nzprev: 1.4142135623730951\n_________________________________________\nz: 1.4142135623730951\nzprev: 1.414213562373095\n_________________________________________\nz: 1.414213562373095\nzprev: 1.4142135623730951\n_________________________________________\nz: 1.4142135623730951\nzprev: 1.414213562373095\n_________________________________________\nz: 1.414213562373095\nzprev: 1.4142135623730951\n_________________________________________\n\n</code></pre>\n\n<p>After a point z and zprev continue to alternate between 2 values that are only off by one precision point (1.414213562373095 and 1.4142135623730951) indefinitely</p>\n"}, {"tags": ["json", "pointers", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1556030606, "post_id": 55813574, "comment_id": 98294251, "body": "As demonstrated, if you have a pointer to the top level structure, the json package can write the data where it needs to go. Use a pointer when you need a pointer."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1556034478, "post_id": 55813574, "comment_id": 98296678, "body": "@noamt, since it works either way, the fact that you happen to use the type for JSON decoding has no bearing on the pointer vs non-pointer decision. I agree that this is a duplicate."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 3, "creation_date": 1556034737, "post_id": 55813574, "comment_id": 98296827, "body": "In a struct that represents a JSON object, using a pointer allows you to represent a null value. Thus, with <code>Bar *B</code>, you can tell the difference between <code>{&quot;foo&quot;: &quot;some&quot;, &quot;bar&quot;: {&quot;baz&quot;: &quot;&quot;}}</code> and <code>{&quot;foo&quot;: &quot;some&quot;}</code> (or <code>{&quot;foo&quot;: &quot;some&quot;, &quot;bar&quot;: null}</code>). That point is not covered in the referenced post."}], "owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 692, "favorite_count": 0, "closed_date": 1556032445, "answer_count": 0, "score": 1, "last_activity_date": 1556047830, "creation_date": 1556029991, "last_edit_date": 1556033887, "question_id": 55813574, "link": "https://stackoverflow.com/questions/55813574/when-to-use-a-pointer-to-a-nested-struct-for-json", "closed_reason": "Duplicate", "title": "When to use a pointer to a nested struct for JSON?", "body": "<p><code>EDIT</code>: I feel this question is not a duplicate, as the referenced Q&amp;A do not describe JSON in the use cases.</p>\n\n<p>I have a <code>struct</code> nested within another <code>struct</code> that I use for JSON operations.</p>\n\n<p>In a simple test case, <a href=\"https://play.golang.org/p/YUWnA7Lpy1Z\" rel=\"nofollow noreferrer\">using a copy</a> of a nested struct:</p>\n\n<pre><code>type A struct {\n    Foo string\n    Bar B\n}\n\ntype B struct {\n    Baz string\n}\n\nfunc main() {\n    serialized := `{\"foo\": \"some\", \"bar\": {\"baz\": \"thing\"}}`\n    a := &amp;A{}\n    json.Unmarshal([]byte(serialized), a)\n    fmt.Println(a.Foo, a.Bar.Baz)\n}\n&gt; some thing\n</code></pre>\n\n<p>yields the same results as <a href=\"https://play.golang.org/p/Q38ANGvjIvx\" rel=\"nofollow noreferrer\">using a pointer</a> to a nested struct:</p>\n\n<pre><code>type A struct {\n    Foo string\n    Bar *B\n}\n\ntype B struct {\n    Baz string\n}\n\nfunc main() {\n    serialized := `{\"foo\": \"some\", \"bar\": {\"baz\": \"thing\"}}`\n    a := &amp;A{}\n    json.Unmarshal([]byte(serialized), a)\n    fmt.Println(a.Foo, a.Bar.Baz)\n}\n&gt; some thing\n</code></pre>\n\n<p>When would or would I not want to use a pointer?</p>\n"}, {"tags": ["go", "stack"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1556025189, "post_id": 55811908, "comment_id": 98290924, "body": "It was probably just copied from the stdlib or a popular tutorial. 64k just happens to be a useful size."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1556025196, "post_id": 55811908, "comment_id": 98290929, "body": "This is just copy paste. (64 &lt;&lt; 10) - 123 is fine too."}], "owner": {"reputation": 2745, "user_id": 7159205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6582280ec3cc9a9d0edfa0291748a823?s=128&d=identicon&r=PG&f=1", "display_name": "g10guang", "link": "https://stackoverflow.com/users/7159205/g10guang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556024607, "creation_date": 1556024607, "question_id": 55811908, "link": "https://stackoverflow.com/questions/55811908/why-is-panic-recover-buf-size-64-10", "title": "Why is panic recover buf size 64 &lt;&lt; 10?", "body": "<p>I see so many code snippets which panic recover in golang. Just looks like:</p>\n\n<pre><code>func PanicRecover(c context.Context) {\n    if e := recover(); e != nil {\n        const size = 64 &lt;&lt; 10\n        buf := make([]byte, size)\n        buf = buf[:runtime.Stack(buf, false)]\n        logs.CtxError(c, \"Error: %s\", string(buf))\n    }\n}\n</code></pre>\n\n<p>I want to know why buffer size is always 64 &lt;&lt; 10.</p>\n"}, {"tags": ["go", "google-app-engine", "go-gin"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1556015563, "post_id": 55808776, "comment_id": 98285769, "body": "You should <i>at</i> <i>least</i> indicate at which line your code fails."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1556015787, "post_id": 55808776, "comment_id": 98285892, "body": "You are not handling the error returned by iter.Next. You only print it and then carry on as if nothing happened."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11398972, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-fmfRUNEO1gU/AAAAAAAAAAI/AAAAAAAAAA8/u_KaDKOh4mE/photo.jpg?sz=128", "display_name": "am_lookformore", "link": "https://stackoverflow.com/users/11398972/am-lookformore"}, "edited": false, "score": 0, "creation_date": 1556106814, "post_id": 55810989, "comment_id": 98323513, "body": "The issue is exactly in  if err != nil {             panic(&quot;ERROR&quot;)         } but it works locally and not when deployed to GAE"}, {"owner": {"reputation": 11, "user_id": 11398972, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-fmfRUNEO1gU/AAAAAAAAAAI/AAAAAAAAAA8/u_KaDKOh4mE/photo.jpg?sz=128", "display_name": "am_lookformore", "link": "https://stackoverflow.com/users/11398972/am-lookformore"}, "edited": false, "score": 0, "creation_date": 1556112333, "post_id": 55810989, "comment_id": 98327011, "body": "Now i have an error in GAE: panic: rpc error: code = PermissionDenied desc = Missing or insufficient permissions"}], "tags": [], "owner": {"reputation": 3901, "user_id": 745754, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/6iDni.jpg?s=128&g=1", "display_name": "Samy Massoud", "link": "https://stackoverflow.com/users/745754/samy-massoud"}, "is_accepted": false, "score": 0, "last_activity_date": 1556021595, "creation_date": 1556021595, "answer_id": 55810989, "question_id": 55808776, "link": "https://stackoverflow.com/questions/55808776/panic-runtime-error-invalid-memory-address-or-nil-pointer-dereference-only-on/55810989#55810989", "title": "Panic: runtime error: invalid memory address or nil pointer dereference only on the GAE", "body": "<p>As no one has any clue where it did happen?</p>\n\n<p>From Analysing your code, the only possibility which I can think off is that your \n<code>itr</code> variable is empty.</p>\n\n<p>You might need to change the check for error part and add Panic instead of just printing the error and keep runing</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>        if err != nil {\n            panic(\"ERROR\")\n        }\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11398972, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-fmfRUNEO1gU/AAAAAAAAAAI/AAAAAAAAAA8/u_KaDKOh4mE/photo.jpg?sz=128", "display_name": "am_lookformore", "link": "https://stackoverflow.com/users/11398972/am-lookformore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 643, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1597434269, "creation_date": 1556013887, "last_edit_date": 1597434269, "question_id": 55808776, "link": "https://stackoverflow.com/questions/55808776/panic-runtime-error-invalid-memory-address-or-nil-pointer-dereference-only-on", "title": "Panic: runtime error: invalid memory address or nil pointer dereference only on the GAE", "body": "<p>I am working on the golang app using gin framework. Basically it just fetch the data from firestore as JSON.</p>\n<p>Localy it works perfectly but when I deploy it to the GAE (gcloud app deploy) there is no error during deployment but when access the page it does not work and in the logs provide an error: &quot;panic: runtime error: invalid memory address or nil pointer dereference&quot;</p>\n<p>package listcollections</p>\n<pre><code>import (\n    &quot;fmt&quot;\n    &quot;log&quot;\n    &quot;net/http&quot;\n\n    &quot;cloud.google.com/go/firestore&quot;\n    &quot;github.com/gin-gonic/gin&quot;\n    &quot;google.golang.org/api/iterator&quot;\n    &quot;google.golang.org/appengine&quot;\n)\n\nfunc main() {\n\n}\n\n//GetListCollections function\n\nfunc GetListCollections(c *gin.Context) {\n\n    var coll []string\n    ctx := appengine.NewContext(c.Request)\n\n    projectID := &quot;XXX&quot;\n    client, err := firestore.NewClient(ctx, projectID)\n    if err != nil {\n        log.Fatalf(&quot;Failed to create client: %v&quot;, err)\n    }\n    defer client.Close()\n\n    iter := client.Collection(&quot;collection&quot;).Documents(ctx)\n\n    for {\n\n        doc, err := iter.Next()\n\n        if err == iterator.Done {\n            break\n        }\n        if err != nil {\n            fmt.Println(&quot;ERROR&quot;)\n        }\n\n        coll = append(coll, doc.Data()[&quot;Title&quot;].(string))\n\n    }\n\n    c.JSON(http.StatusOK, gin.H{\n        &quot;collections&quot;: coll,\n    })\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2569, "user_id": 356083, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/awxYs.jpg?s=128&g=1", "display_name": "f.khantsis", "link": "https://stackoverflow.com/users/356083/f-khantsis"}, "edited": false, "score": 0, "creation_date": 1556013026, "post_id": 55808248, "comment_id": 98284478, "body": "Do I understand that you want to push an image over an existing ssh connection?"}, {"owner": {"reputation": 11, "user_id": 11398772, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-v-28m6D2Bns/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdnsyIbqOXyCMn-leZtbNSi43--jw/mo/photo.jpg?sz=128", "display_name": "\u82cf\u4fdd\u4e1c", "link": "https://stackoverflow.com/users/11398772/%e8%8b%8f%e4%bf%9d%e4%b8%9c"}, "reply_to_user": {"reputation": 2569, "user_id": 356083, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/awxYs.jpg?s=128&g=1", "display_name": "f.khantsis", "link": "https://stackoverflow.com/users/356083/f-khantsis"}, "edited": false, "score": 1, "creation_date": 1556013544, "post_id": 55808248, "comment_id": 98284744, "body": "docker\uff0crancher\uff0cJenkins has greatly simplified the operation of project deployment. Our manager has put forward a requirement that I use go to do one-click operations, including code packaging and push mirroring. Again, it&#39;s easy for colleagues to waste time in this part."}], "owner": {"reputation": 11, "user_id": 11398772, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-v-28m6D2Bns/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdnsyIbqOXyCMn-leZtbNSi43--jw/mo/photo.jpg?sz=128", "display_name": "\u82cf\u4fdd\u4e1c", "link": "https://stackoverflow.com/users/11398772/%e8%8b%8f%e4%bf%9d%e4%b8%9c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1556022601, "creation_date": 1556012034, "last_edit_date": 1556022601, "question_id": 55808248, "link": "https://stackoverflow.com/questions/55808248/how-to-update-the-image-of-rancher-container-with-go-program", "title": "How to update the image of rancher container with go program", "body": "<p>Thank you for reading. I'm chinese. I have problem with rancher. I want to use golang to make a program that I can click one time to push image to the right place and restart the test environment.</p>\n\n<p>I\u2019m new hand to learn golang. I tried to use golang connect linux. But I can't do more works about it. I have no idea. I find a code from internet in China.</p>\n\n<pre><code>// connect to ssh\naddr = fmt.Sprintf(\"%s:%d\", host, port)\n\nif client, err = ssh.Dial(\"tcp\", addr, clientConfig); err != nil {\n    return nil, err\n}\n\n// create session\nif session, err = client.NewSession(); err != nil {\n    return nil, err\n}\n\nreturn session, nil\n</code></pre>\n\n<p>I want to learn how to make the program or some people can provide golang write plugins to help me. Thanks again!</p>\n"}, {"tags": ["unit-testing", "go", "concurrency", "race-condition"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1556029118, "post_id": 55808157, "comment_id": 98293387, "body": "As noted in the answer, you need to put the <code>t.Parallel()</code> the subtest. The code you&#39;ve shown doesn&#39;t have a race, but it also doesn&#39;t really do anything at all, so it&#39;s not going to prove the actual implementation."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1556032666, "post_id": 55808157, "comment_id": 98295653, "body": "&quot;Can I assume that my test free of race condition&quot; - no, even if the tests properly exercise parallelism. The race detector detects if a potential race condition occurs over the course of an execution. Due to the nature of concurrent code, there may be a potential race condition that happens to have not been exercised over the course of the test - it might be caught on subsequent runs, it might not. The race detector can provide proof positive of a race condition but never proof there there are none."}, {"owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 0, "creation_date": 1556092216, "post_id": 55808157, "comment_id": 98314934, "body": "thank you, now I understand it better"}], "answers": [{"comments": [{"owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 0, "creation_date": 1556014323, "post_id": 55808813, "comment_id": 98285132, "body": "still no race detected"}, {"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "reply_to_user": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 3, "creation_date": 1556014705, "post_id": 55808813, "comment_id": 98285299, "body": "race detector does not give a false positive. You shouldn&#39;t assume that there are no race conditions though. It just means that it didn&#39;t occur during this run of tests. It also depends on how well the tests are covering the cases."}], "tags": [], "owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "is_accepted": true, "score": 0, "last_activity_date": 1556014022, "creation_date": 1556014022, "answer_id": 55808813, "question_id": 55808157, "link": "https://stackoverflow.com/questions/55808157/race-detection-in-table-driven-test/55808813#55808813", "title": "Race detection in table driven test", "body": "<p>I think you need to run the sub tests in parallel.</p>\n\n<p>Can you call t.Parallel() inside the subtests and check ?</p>\n\n<pre><code>td := td\nt.Run(td.Name, func (t *testing.T){\n            t.Parallel()\n            doer := mockDoer{Error: td.Error, Worker: worker}\n            err := mything.BusinessDoer(doer) \n            if td.ExpectError &amp;&amp; err == nil{\n                t.Fatalf(\"expected an error but got none\")\n            } \n            if ! td.ExpectError &amp;&amp; err != nil{\n                t.Fatalf(\"did not expect an error but got one %s \", err.Error())\n            }\n        })\n</code></pre>\n\n<p>Some links to refer to make it parallel:\n<a href=\"https://gist.github.com/posener/92a55c4cd441fc5e5e85f27bca008721\" rel=\"nofollow noreferrer\">https://gist.github.com/posener/92a55c4cd441fc5e5e85f27bca008721</a><br>\n<a href=\"https://rakyll.org/parallelize-test-tables/\" rel=\"nofollow noreferrer\">https://rakyll.org/parallelize-test-tables/</a></p>\n"}], "owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 55808813, "answer_count": 1, "score": 0, "last_activity_date": 1556014022, "creation_date": 1556011713, "last_edit_date": 1556013409, "question_id": 55808157, "link": "https://stackoverflow.com/questions/55808157/race-detection-in-table-driven-test", "title": "Race detection in table driven test", "body": "<p>I have a table-driven test and init var(<code>worker</code>) outside table loop. I run the test with <code>go test -ra\u0441e</code> and added <code>t.Parallel()</code> and no race condition was detected. Can I assume that my test free of <code>race condition</code>:</p>\n\n<pre><code>//This mock could be in a separate file.\ntype mockWorker struct {\n}\n// implment our Worker iterface\nfunc(md mockWorker)Work()error{\n    return nil\n}\ntype mockDoer struct{\n    Error  error \n    Worker worker\n}\n// implment our Doer iterface\nfunc(md mockDoer)Do()error{\n    if err := md.Worker.Work(); err != nil {\n        return err\n    }\n    return md.Error \n}\n\nfunc TestBusinessDoer(t *testing.T){\n    t.Parallel()\n    worker := mockWorker{}\n    cases := []struct{\n        Name string\n        ExpectError bool \n        Error error\n    }{\n        {\n            Name:\"test does business logic\",\n            ExpectError : false,\n            Error : nil,\n        },\n        {\n            Name:\"test fails when dependency errors\",\n            ExpectError : true,\n            Error : errors.New(\"an error\"),\n        },\n    }\n\n    for _,td := range cases{\n        t.Run(td.Name, func (t *testing.T){\n            doer := mockDoer{Error: td.Error, Worker: worker}\n            err := mything.BusinessDoer(doer) \n            if td.ExpectError &amp;&amp; err == nil{\n                t.Fatalf(\"expected an error but got none\")\n            } \n            if ! td.ExpectError &amp;&amp; err != nil{\n                t.Fatalf(\"did not expect an error but got one %s \", err.Error())\n            }\n        })\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "go-packages"], "comments": [{"owner": {"reputation": 1081, "user_id": 3118136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bf35487ea9a89611c4769877c4f6f2f?s=128&d=identicon&r=PG", "display_name": "Denis", "link": "https://stackoverflow.com/users/3118136/denis"}, "edited": false, "score": 8, "creation_date": 1556009075, "post_id": 55807322, "comment_id": 98282363, "body": "Default <code>Go</code> packages <a href=\"https://golang.org/pkg/\" rel=\"nofollow noreferrer\">golang.org/pkg</a>"}, {"owner": {"reputation": 1748, "user_id": 4106031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NM3jO.jpg?s=128&g=1", "display_name": "Alok Kumar Singh", "link": "https://stackoverflow.com/users/4106031/alok-kumar-singh"}, "reply_to_user": {"reputation": 1081, "user_id": 3118136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bf35487ea9a89611c4769877c4f6f2f?s=128&d=identicon&r=PG", "display_name": "Denis", "link": "https://stackoverflow.com/users/3118136/denis"}, "edited": false, "score": 0, "creation_date": 1556009292, "post_id": 55807322, "comment_id": 98282461, "body": "Is there a  function like <code>isStandardPackage(importPath string) bool</code> which i can use?"}, {"owner": {"reputation": 1748, "user_id": 4106031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NM3jO.jpg?s=128&g=1", "display_name": "Alok Kumar Singh", "link": "https://stackoverflow.com/users/4106031/alok-kumar-singh"}, "reply_to_user": {"reputation": 1081, "user_id": 3118136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bf35487ea9a89611c4769877c4f6f2f?s=128&d=identicon&r=PG", "display_name": "Denis", "link": "https://stackoverflow.com/users/3118136/denis"}, "edited": false, "score": 1, "creation_date": 1556009759, "post_id": 55807322, "comment_id": 98282722, "body": "can this be used? <a href=\"https://golang.org/pkg/cmd/go/internal/list/\" rel=\"nofollow noreferrer\">golang.org/pkg/cmd/go/internal/list</a> ?"}, {"owner": {"reputation": 1081, "user_id": 3118136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bf35487ea9a89611c4769877c4f6f2f?s=128&d=identicon&r=PG", "display_name": "Denis", "link": "https://stackoverflow.com/users/3118136/denis"}, "edited": false, "score": 0, "creation_date": 1556010364, "post_id": 55807322, "comment_id": 98283047, "body": "I think list to show you all install packages."}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1556012713, "post_id": 55807322, "comment_id": 98284314, "body": "what are you trying to achieve here? An import statement without a <code>.</code> is either an internal package of your own or a part of the standard library."}, {"owner": {"reputation": 1748, "user_id": 4106031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NM3jO.jpg?s=128&g=1", "display_name": "Alok Kumar Singh", "link": "https://stackoverflow.com/users/4106031/alok-kumar-singh"}, "edited": false, "score": 0, "creation_date": 1568344700, "post_id": 55807322, "comment_id": 102252115, "body": "We were trying to organize code in kubernetes. We need a easy way to figure out in one of the scripts if this a standard package and can be ignored for analysis."}], "answers": [{"tags": [], "owner": {"reputation": 734, "user_id": 4801231, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5ca13f4ff6626c22c4c31b62f9908d1?s=128&d=identicon&r=PG&f=1", "display_name": "svetha.cvl", "link": "https://stackoverflow.com/users/4801231/svetha-cvl"}, "is_accepted": false, "score": 3, "last_activity_date": 1556025120, "creation_date": 1556025120, "answer_id": 55812051, "question_id": 55807322, "link": "https://stackoverflow.com/questions/55807322/can-i-list-all-standard-go-packages/55812051#55812051", "title": "Can I list all standard Go packages?", "body": "<p>If you want a simple solution, you could check if a package is present in $GOROOT/pkg. All standard packages are installed here.</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 33, "last_activity_date": 1567440657, "last_edit_date": 1567440657, "creation_date": 1556045180, "answer_id": 55817588, "question_id": 55807322, "link": "https://stackoverflow.com/questions/55807322/can-i-list-all-standard-go-packages/55817588#55817588", "title": "Can I list all standard Go packages?", "body": "<p>Use the <code>go list std</code> command to list the standard packages.  The special import path <code>std</code> expands to all packages in the standard Go library (<a href=\"https://golang.org/cmd/go/#hdr-Package_lists_and_patterns\" rel=\"noreferrer\">doc</a>).</p>\n\n<p>Exec that command to get the list in a Go program:</p>\n\n<pre><code>cmd := exec.Command(\"go\", \"list\", \"std\")\np, err := cmd.Output()\nif err != nil {\n    // handle error\n}\nstdPkgs = strings.Fields(string(p))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1498, "user_id": 1166912, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9ce2e899702ec854c6b94a77b524a98?s=128&d=identicon&r=PG", "display_name": "insider", "link": "https://stackoverflow.com/users/1166912/insider"}, "edited": false, "score": 0, "creation_date": 1567853871, "post_id": 56199212, "comment_id": 102095080, "body": "Immediately searched where does <code>ok</code> come from and found this nice article. <a href=\"https://www.reddit.com/r/golang/comments/35d0b2/about_the_comma_ok_idiom/\" rel=\"nofollow noreferrer\">reddit.com/r/golang/comments/35d0b2/about_the_comma_ok_idiom</a>"}, {"owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "edited": false, "score": 2, "creation_date": 1576695508, "post_id": 56199212, "comment_id": 104986066, "body": "The <code>packages.Load(nil, &quot;std&quot;)</code> call executes the <code>go list</code> command and parses the output.  I note this for others who might also make the incorrect assumption that the package provides the command implementation."}], "tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": false, "score": 52, "last_activity_date": 1558185012, "last_edit_date": 1558185012, "creation_date": 1558184700, "answer_id": 56199212, "question_id": 55807322, "link": "https://stackoverflow.com/questions/55807322/can-i-list-all-standard-go-packages/56199212#56199212", "title": "Can I list all standard Go packages?", "body": "<p>You can use the new <a href=\"https://godoc.org/golang.org/x/tools/go/packages\" rel=\"noreferrer\"><code>golang.org/x/tools/go/packages</code></a> for this. This provides a programmatic interface for most of <code>go list</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"golang.org/x/tools/go/packages\"\n)\n\nfunc main() {\n    pkgs, err := packages.Load(nil, \"std\")\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(pkgs)\n    // Output: [archive/tar archive/zip bufio bytes compress/bzip2 ... ]\n}\n</code></pre>\n\n<p>To get a <code>isStandardPackage()</code> you can store it in a map, like so:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"golang.org/x/tools/go/packages\"\n)\n\nvar standardPackages = make(map[string]struct{})\n\nfunc init() {\n    pkgs, err := packages.Load(nil, \"std\")\n    if err != nil {\n        panic(err)\n    }\n\n    for _, p := range pkgs {\n        standardPackages[p.PkgPath] = struct{}{}\n    }\n}\n\nfunc isStandardPackage(pkg string) bool {\n    _, ok := standardPackages[pkg]\n    return ok\n}\n\nfunc main() {\n    fmt.Println(isStandardPackage(\"fmt\"))  // true\n    fmt.Println(isStandardPackage(\"nope\")) // false\n}\n</code></pre>\n"}], "owner": {"reputation": 1748, "user_id": 4106031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NM3jO.jpg?s=128&g=1", "display_name": "Alok Kumar Singh", "link": "https://stackoverflow.com/users/4106031/alok-kumar-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11472, "favorite_count": 11, "answer_count": 3, "score": 195, "last_activity_date": 1586161358, "creation_date": 1556008880, "last_edit_date": 1586161358, "question_id": 55807322, "link": "https://stackoverflow.com/questions/55807322/can-i-list-all-standard-go-packages", "title": "Can I list all standard Go packages?", "body": "<p>Is there a way in Go to list <em>all</em> the standard/built-in packages (i.e., the packages which come installed with a Go installation)?</p>\n\n<p>I have a list of packages and I want to figure out which packages are standard.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 8980996, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5872b122d5a3d393e11c81a58538f4c7?s=128&d=identicon&r=PG&f=1", "display_name": "jonathannah", "link": "https://stackoverflow.com/users/8980996/jonathannah"}, "edited": false, "score": 0, "creation_date": 1556004116, "post_id": 55805956, "comment_id": 98280017, "body": "Using your example, I tried      map[$and:[map[topics:map[$elemMatch:map[label:students]]] map[topics:map[$elemMatch:map[label:life and living]]]]]  But it returned empty.  My query above does work as expected.  I just can&#39;t get it mapped into MGO."}, {"owner": {"reputation": 21, "user_id": 8980996, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5872b122d5a3d393e11c81a58538f4c7?s=128&d=identicon&r=PG&f=1", "display_name": "jonathannah", "link": "https://stackoverflow.com/users/8980996/jonathannah"}, "edited": false, "score": 0, "creation_date": 1556032767, "post_id": 55805956, "comment_id": 98295699, "body": "Indeed, it does work in Rob 3T as does my query above.  But I can not get either to work with MGO.  I am sure that there is some way to map this query to bson.M, but I can not figure out how."}, {"owner": {"reputation": 21, "user_id": 8980996, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5872b122d5a3d393e11c81a58538f4c7?s=128&d=identicon&r=PG&f=1", "display_name": "jonathannah", "link": "https://stackoverflow.com/users/8980996/jonathannah"}, "edited": false, "score": 0, "creation_date": 1556114500, "post_id": 55805956, "comment_id": 98328434, "body": "I did solve the bson problem, and posted the details below.  Thanks."}], "tags": [], "owner": {"reputation": 17, "user_id": 7382432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae15af731326d2745efa0693f278098e?s=128&d=identicon&r=PG&f=1", "display_name": "Kh Munkhbat", "link": "https://stackoverflow.com/users/7382432/kh-munkhbat"}, "is_accepted": false, "score": 0, "last_activity_date": 1556020760, "last_edit_date": 1556020760, "creation_date": 1556003225, "answer_id": 55805956, "question_id": 55805633, "link": "https://stackoverflow.com/questions/55805633/mgo-query-nested-array-of-objects/55805956#55805956", "title": "MGO Query nested array of objects", "body": "<p>If you want to find some value from nested array then you use $elemMatch method.</p>\n\n<pre><code>db.questions.find(\n    {$and: \n        [\n            {topics: {$elemMatch: {label: 'Students'}}},\n            {topics: {$elemMatch: {label: 'Education'}}}\n        ]\n    }\n)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 8980996, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5872b122d5a3d393e11c81a58538f4c7?s=128&d=identicon&r=PG&f=1", "display_name": "jonathannah", "link": "https://stackoverflow.com/users/8980996/jonathannah"}, "is_accepted": true, "score": 0, "last_activity_date": 1556036704, "creation_date": 1556036704, "answer_id": 55815600, "question_id": 55805633, "link": "https://stackoverflow.com/questions/55805633/mgo-query-nested-array-of-objects/55815600#55815600", "title": "MGO Query nested array of objects", "body": "<p>The bson model for the above answer is as follows:</p>\n\n<pre><code>query = getAndFilters(\n    bson.M{\"topics\": bson.M{\"$elemMatch\": bson.M{\"label\": \"Students\"}}},\n    bson.M{\"topics\": bson.M{\"$elemMatch\": bson.M{\"label\": \"Education\"}}})\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8980996, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5872b122d5a3d393e11c81a58538f4c7?s=128&d=identicon&r=PG&f=1", "display_name": "jonathannah", "link": "https://stackoverflow.com/users/8980996/jonathannah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 55815600, "answer_count": 2, "score": 0, "last_activity_date": 1556036704, "creation_date": 1556001616, "last_edit_date": 1556002656, "question_id": 55805633, "link": "https://stackoverflow.com/questions/55805633/mgo-query-nested-array-of-objects", "title": "MGO Query nested array of objects", "body": "<p>I\n am having difficulty converting a MongoDB query to mgo bson.  The Mongo record schema is as shown below.  I want to find records that have topics with label \"Education\" and \"Students\".</p>\n\n<pre><code>db.questions.insert\n(\n    {\n        \"_id\" : ObjectId(\"5cb4048478163fa3c9726fdf\"),\n        \"questionText\" : \"why?\",\n        \"createdOn\" :  new Date(),\n        \"createdBy\": user1,\n        \"topics\" : [\n            {\n                \"label\": \"Education\",\n            },\n            {\n                \"label\": \"Life and Living\",\n            },\n            {\n                \"label\": \"Students\"\n            }\n        ]\n    }\n)\n</code></pre>\n\n<p>Using Robo 3T, the query looks like this:</p>\n\n<pre><code>db.questions.find({$and : [\n    {\"topics\": {\"label\": \"Students\"}}, \n    {\"topics\": {\"label\": \"Education\"}}\n]})\n</code></pre>\n\n<p>I am having trouble modeling this with MGO.  Currently, have tried this:</p>\n\n<pre><code>map[$and:[\n    map[topics:map[label:students]] \n    map[topics:map[label:life and living]]\n]]\n</code></pre>\n\n<p>and this</p>\n\n<pre><code>map[topics:map[$and:[\n    map[label:students] \n    map[label:life and living]\n]]]\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "leader-election"], "comments": [{"owner": {"reputation": 2267, "user_id": 4716370, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-U_FFkjaXK2I/AAAAAAAAAAI/AAAAAAAAnbo/UQ9DkPR0VqM/photo.jpg?sz=128", "display_name": "Antoine Cotten", "link": "https://stackoverflow.com/users/4716370/antoine-cotten"}, "edited": false, "score": 0, "creation_date": 1556077582, "post_id": 55805569, "comment_id": 98309896, "body": "Could you please update your question with a snippet of your code? It will make it easier to pinpoint a potential mistake and improve your chances to get an answer."}, {"owner": {"reputation": 57, "user_id": 5743375, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1f14958b02363b39cae52324417dc750?s=128&d=identicon&r=PG&f=1", "display_name": "chakku", "link": "https://stackoverflow.com/users/5743375/chakku"}, "reply_to_user": {"reputation": 2267, "user_id": 4716370, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-U_FFkjaXK2I/AAAAAAAAAAI/AAAAAAAAnbo/UQ9DkPR0VqM/photo.jpg?sz=128", "display_name": "Antoine Cotten", "link": "https://stackoverflow.com/users/4716370/antoine-cotten"}, "edited": false, "score": 0, "creation_date": 1556084839, "post_id": 55805569, "comment_id": 98311708, "body": "@AntoineCotten I have added the code. Can you please check"}], "answers": [{"tags": [], "owner": {"reputation": 1723, "user_id": 2200798, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b4e41cf7a8331eb48d0aec5c22e9b0a6?s=128&d=identicon&r=PG&f=1", "display_name": "Veerendra Kakumanu", "link": "https://stackoverflow.com/users/2200798/veerendra-kakumanu"}, "is_accepted": false, "score": 1, "last_activity_date": 1556004682, "last_edit_date": 1556004682, "creation_date": 1556004353, "answer_id": 55806204, "question_id": 55805569, "link": "https://stackoverflow.com/questions/55805569/leader-election-pod-is-not-selecting-as-a-leader/55806204#55806204", "title": "Leader election- Pod is not selecting as a leader", "body": "<p>You can deploy the pods as <code>statefullsets</code> &amp; <code>headless service</code>. Please refer the <a href=\"https://kubernetes.io/docs/tutorials/stateful-application/basic-stateful-set/\" rel=\"nofollow noreferrer\">docs</a></p>\n\n<p>Why?</p>\n\n<ul>\n<li>Pods will create sequentially. You define the first pod being launched is <code>Master</code> and rest are slaves.  </li>\n<li>Pods in a StatefulSet have a unique ordinal index and a stable network identity. For example below,</li>\n</ul>\n\n<pre><code>    kubectl get pods -l app=nginx\n    NAME      READY     STATUS    RESTARTS   AGE\n    web-0     1/1       Running   0          1m\n    web-1     1/1       Running   0          1m\n\n</code></pre>\n\n<p>Even if the pod <code>web-0</code> restarts, the name or FQDN for pod never change.</p>\n\n<p><code>web-0.nginx.default.svc.cluster.local</code></p>\n\n<p><code>&lt;pod_name&gt;.&lt;service_name&gt;.&lt;namespace&gt;.svc.cluster.local</code></p>\n\n<p>I have only highlighted few points, please go though the docs completly. </p>\n"}], "owner": {"reputation": 57, "user_id": 5743375, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1f14958b02363b39cae52324417dc750?s=128&d=identicon&r=PG&f=1", "display_name": "chakku", "link": "https://stackoverflow.com/users/5743375/chakku"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 459, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1556084129, "creation_date": 1556001353, "last_edit_date": 1556084129, "question_id": 55805569, "link": "https://stackoverflow.com/questions/55805569/leader-election-pod-is-not-selecting-as-a-leader", "title": "Leader election- Pod is not selecting as a leader", "body": "<p>I have implemented leader election using kubernetes/client-go leader election. I have 2 replicas. For the first time both pod is selecting as leader, but same pod is not elected as leader after this. And the leader election get stopped after some time. I tried to delete one pod, then the new pod that is created is selected as leader. Again once the pod stopped leading, no pod is acting as leader. I am using configmap for resource lock. Please help me to solve the issue.</p>\n\n<pre><code>func NewElectorWithCallbacks(namespace, configMapName, identity string, ttl time.Duration, client cli.CoreV1Interface, callbacks *leaderelection.LeaderCallbacks) (*leaderelection.LeaderElector, error) {\nhostname, err := os.Hostname()\nif err != nil {\n  return nil, err\n}\nbroadcaster := record.NewBroadcaster()\nbroadcaster.StartLogging(log.Printf)\nbroadcaster.StartRecordingToSink(&amp;cli.EventSinkImpl{Interface: client.Events(namespace)})\nrecorder := broadcaster.NewRecorder(scheme.Scheme, api.EventSource{Component: identity, Host: hostname})\ncmLock := &amp;resourcelock.ConfigMapLock{\n  Client: client,\n  ConfigMapMeta: meta.ObjectMeta{\n    Namespace: namespace,\n    Name:      configMapName,\n  },\n  LockConfig: resourcelock.ResourceLockConfig{\n    Identity:      identity,\n    EventRecorder: recorder,\n  },\n}\nif callbacks == nil {\n  callbacks = NewDefaultCallbacks()\n}\nconfig := leaderelection.LeaderElectionConfig{\n  Lock:          cmLock,\n  LeaseDuration: ttl,\n  RenewDeadline: ttl / 2,\n  RetryPeriod:   ttl / 4,\n  Callbacks:     *callbacks,\n}\nreturn leaderelection.NewLeaderElector(config)\n}\n\nconfig, err = rest.InClusterConfig()\nv1Client, err := v1.NewForConfig(config)\ncallbacks := &amp;leaderelection.LeaderCallbacks{\n        OnStartedLeading: func(context.Context) {\n            // do the work\n           fmt.Println(\"selected as leader\")\n            // Wait forever\n            select {}\n        },\n        OnStoppedLeading: func() {\n            fmt.Println(\"Pod stopped leading\")\n\n        },\n    }\nelector, err := election.NewElectorWithCallbacks(namespace, electionName, hostname, ttl, v1Client, callbacks)\nelector.Run(context.TODO())\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/CZxx5.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CZxx5.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["email", "google-app-engine", "go", "https", "http-status-code-308"], "comments": [{"owner": {"reputation": 21, "user_id": 11397662, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-69i8pQVnjrY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rduZoHDBPTjlrSCjfLh9jc0uDRILA/mo/photo.jpg?sz=128", "display_name": "\u5f90\u9418\u5049", "link": "https://stackoverflow.com/users/11397662/%e5%be%90%e9%90%98%e5%81%89"}, "edited": false, "score": 0, "creation_date": 1556261346, "post_id": 55805077, "comment_id": 98384701, "body": "Can anybody take a look at this?"}], "owner": {"reputation": 21, "user_id": 11397662, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-69i8pQVnjrY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rduZoHDBPTjlrSCjfLh9jc0uDRILA/mo/photo.jpg?sz=128", "display_name": "\u5f90\u9418\u5049", "link": "https://stackoverflow.com/users/11397662/%e5%be%90%e9%90%98%e5%81%89"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 139, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1555998725, "creation_date": 1555998725, "question_id": 55805077, "link": "https://stackoverflow.com/questions/55805077/google-app-engine-respond-with-the-code-308", "title": "Google App Engine respond with the code 308", "body": "<p>Problem </p>\n\n<p>1.I have a sns service which is running on Google App Engine</p>\n\n<p>2.The sns service is using go to run as the back ending side</p>\n\n<p>3.The sns service is using a crob job to request Api A</p>\n\n<p>4.The Api A is adding another http request(request to Api B) into taskqueue</p>\n\n<p>5.The taskqueue is executed immediately after the request of Api A</p>\n\n<p>6.The request of Api B is executed</p>\n\n<p>7.The Api B responded with the code 308</p>\n\n<p>Problem Summary</p>\n\n<p>job cron(request for Api A)  -> Api A -> Task queue(stack request for Api B) ->Api B -> some execution</p>\n\n<p>Api A responded with 200\nApi B responded with 308</p>\n\n<p>Question </p>\n\n<p>Why Api B is respond with the code of 308?</p>\n\n<p>Complement</p>\n\n<hr>\n\n<p>By the way the following sequence is successful</p>\n\n<p>post man (request for Api A)  -> Api A -> Task queue(request for Api B) ->Api B -> some execution</p>\n\n<p>Api A responded with 200\nApi B responded with 200</p>\n\n<p>When I use post man to request Api A the following request for Api B was respond with 200</p>\n\n<p>The way I did with taskqueue is like</p>\n\n<pre><code>    params := url.Values{}\n    params.Set(\"dollSpaces\", strings.Join(dollSpaces, \",\"))\n    t := taskqueue.NewPOSTTask(\"/path\", params)\n    req.Header.Set(\"X-AppEngine-QueueName\", \"mailqueue\")\n    c := appengine.NewContext(req)\n    taskqueue.Add(c, t, \"my queue\")\n</code></pre>\n\n<p>The Log from Google Cloud Platform is like the following</p>\n\n<p>Response of Api A</p>\n\n<pre><code>2019-01-01 10:00:00.001 JST\nGET\n200\n193 B\n577 ms\nAppEngine-Google; (+http://code.google.com/appengine)\n/path/ApiAPath\n 0.1.0.1 - - [01/Jan/2019:10:00:00 +0900] \"GET /path/ApiAPath HTTP/1.1\" 200 193 - \"AppEngine-Google; (+http://code.google.com/appengine)\" \"aaa.aaa.com\" ms=577 cpu_ms=3 cpm_usd=2.8039999999999998e-8 loading_request=0 instance=asda1231313asdasd123123asda123 app_engine_release=1.9.71 trace_id=123123123dsfasf123123zafasdasd\n</code></pre>\n\n<p>Response of Api B</p>\n\n<pre><code>2019-01-01 10:00:00.100 JST\nPOST\n308\n95 B\n2 ms\nAppEngine-Google; (+http://code.google.com/appengine)\n/ApiBPath\n\n0.1.0.2 - - [01/Jan/2019:10:00:00 +0900] \"POST /ApiBPath HTTP/1.1\" 308 95 http://aaa.aaa.com/path/ApiAPath \"AppEngine-Google; (+http://code.google.com/appengine)\" \"aaa.aaa.com\" ms=2 cpu_ms=221 cpm_usd=1.3802e-8 loading_request=0 instance= asda1231313asdasd123123asda123 app_engine_release=1.9.71 trace_id= 123123123dsfasf123123zafasdasd\n</code></pre>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 19, "user_id": 11397783, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f2477747ebfde3339711588c6a0d565?s=128&d=identicon&r=PG&f=1", "display_name": "Cee", "link": "https://stackoverflow.com/users/11397783/cee"}, "edited": false, "score": 0, "creation_date": 1556082993, "post_id": 55804573, "comment_id": 98311101, "body": "Why is my question getting downvotes? Please comment so I know what to improve"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 11, "last_activity_date": 1555998707, "last_edit_date": 1555998707, "creation_date": 1555997620, "answer_id": 55804898, "question_id": 55804573, "link": "https://stackoverflow.com/questions/55804573/why-does-time-sincestart-seconds-always-return-0/55804898#55804898", "title": "Why does `time.Since(start).Seconds()` always return 0?", "body": "<p>There is very little code between your start times and the <code>time.Since()</code> calls, in the first example just a few string concatenations and an <code>fmt.Print()</code> call, in the second example just a single <code>fmt.Print()</code> call. These are executed by your computer very fast.</p>\n\n<p>So fast, that the result is most likely less than a millisecond. And you print the elapsed time using the <code>%.2f</code> verb, which <strong>rounds the seconds</strong> to 2 fraction digits. Which means if the elapsed time is less than <code>0.005 sec</code>, it will be rounded to <code>0</code>. This is why you see <code>0.00s</code> printed.</p>\n\n<p>If you change the format to <code>%0.12f</code>, you will see something like:</p>\n\n<pre><code>Took 0.000027348000s \nTook 0.000003772000s\n</code></pre>\n\n<p>Also note that the <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"noreferrer\"><code>time.Duration</code></a> value returned by <a href=\"https://golang.org/pkg/time/#Since\" rel=\"noreferrer\"><code>time.Since()</code></a> implements <a href=\"https://golang.org/pkg/fmt/#Stringer\" rel=\"noreferrer\"><code>fmt.Stringer</code></a>, and it \"formats\" itself intelligently to a unit that is more meaningful. So you may print it as-is.</p>\n\n<p>For example if you print it like this:</p>\n\n<pre><code>fmt.Println(\"Took\", time.Since(start))\nfmt.Println(\"Took\", time.Since(start2))\n</code></pre>\n\n<p>You will see an output something like this:</p>\n\n<pre><code>Took 18.608\u00b5s\nTook 2.873\u00b5s\n</code></pre>\n\n<p>Also note that if you want to measure the performance of some code, you should use Go's built-in testing and benchmarking facilities, namely the <a href=\"https://golang.org/pkg/testing/\" rel=\"noreferrer\"><code>testing</code></a> package. For details, see <a href=\"https://stackoverflow.com/questions/41608578/order-of-the-code-and-performance/41608707#41608707\">Order of the code and performance</a>.</p>\n"}], "owner": {"reputation": 19, "user_id": 11397783, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f2477747ebfde3339711588c6a0d565?s=128&d=identicon&r=PG&f=1", "display_name": "Cee", "link": "https://stackoverflow.com/users/11397783/cee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 55804898, "answer_count": 1, "score": 0, "last_activity_date": 1555998707, "creation_date": 1555995489, "last_edit_date": 1555997682, "question_id": 55804573, "link": "https://stackoverflow.com/questions/55804573/why-does-time-sincestart-seconds-always-return-0", "title": "Why does `time.Since(start).Seconds()` always return 0?", "body": "<p>I am on the first chapter <a href=\"https://rads.stackoverflow.com/amzn/click/com/0134190440\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">The Go Programming Language (Addison-Wesley Professional Computing Series)</a> and the 3rd exercise in the book asks me to measure code performance using <code>time</code>.</p>\n\n<p>So, I came up with the following code.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>start := time.Now()\nvar s, sep string\nfor i := 1; i &lt; len(os.Args); i++ {\n    s += sep + os.Args[i]\n    sep = \" \"\n}\nfmt.Print(s)\nfmt.Printf(\"\\nTook %.2fs \\n\", time.Since(start).Seconds())\nfmt.Println(\"------------------------------------------------\")\nstart2 := time.Now()\nfmt.Print(strings.Join(os.Args[1:], \" \"))\nfmt.Printf(\"\\nTook %.2fs\", time.Since(start2).Seconds())\n</code></pre>\n\n<p>When I ran this code on Windows and Mac, it always return 0.00 second. I added a pause in my code to check whether it's correct and it seems fine. What I don't understand is why it always returns 0.0.</p>\n"}, {"tags": ["forms", "go", "interface", "go-gin"], "comments": [{"owner": {"reputation": 85, "user_id": 5218121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b308136b453109457c54443dbc9fab7d?s=128&d=identicon&r=PG&f=1", "display_name": "big pigeon", "link": "https://stackoverflow.com/users/5218121/big-pigeon"}, "edited": false, "score": 0, "creation_date": 1555986207, "post_id": 55803040, "comment_id": 98275185, "body": "use  map[string]interface{} instead of interface{}"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 9223951, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J33h717MVr8/AAAAAAAAAAI/AAAAAAAAAAA/CG6hlM3ArRs/photo.jpg?sz=128", "display_name": "devpablocristo", "link": "https://stackoverflow.com/users/9223951/devpablocristo"}, "edited": false, "score": 0, "creation_date": 1555983276, "post_id": 55803077, "comment_id": 98274662, "body": "Thank for the comment. I tryed and i get the same output."}, {"owner": {"reputation": 23, "user_id": 9223951, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J33h717MVr8/AAAAAAAAAAI/AAAAAAAAAAA/CG6hlM3ArRs/photo.jpg?sz=128", "display_name": "devpablocristo", "link": "https://stackoverflow.com/users/9223951/devpablocristo"}, "edited": false, "score": 0, "creation_date": 1555983287, "post_id": 55803077, "comment_id": 98274666, "body": "func HTMLForm(c *gin.Context) { \tvar f interface{} \tShouldBindJSON(f) \tc.JSON(http.StatusOK, f) }  output: null"}, {"owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "reply_to_user": {"reputation": 23, "user_id": 9223951, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J33h717MVr8/AAAAAAAAAAI/AAAAAAAAAAA/CG6hlM3ArRs/photo.jpg?sz=128", "display_name": "devpablocristo", "link": "https://stackoverflow.com/users/9223951/devpablocristo"}, "edited": false, "score": 0, "creation_date": 1555983421, "post_id": 55803077, "comment_id": 98274694, "body": "In your case you should use c.ShouldBindJSON(f) ?"}, {"owner": {"reputation": 23, "user_id": 9223951, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J33h717MVr8/AAAAAAAAAAI/AAAAAAAAAAA/CG6hlM3ArRs/photo.jpg?sz=128", "display_name": "devpablocristo", "link": "https://stackoverflow.com/users/9223951/devpablocristo"}, "edited": false, "score": 0, "creation_date": 1555983951, "post_id": 55803077, "comment_id": 98274784, "body": "I just added another example of how im trying to use it."}, {"owner": {"reputation": 23, "user_id": 9223951, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J33h717MVr8/AAAAAAAAAAI/AAAAAAAAAAA/CG6hlM3ArRs/photo.jpg?sz=128", "display_name": "devpablocristo", "link": "https://stackoverflow.com/users/9223951/devpablocristo"}, "edited": false, "score": 0, "creation_date": 1555984011, "post_id": 55803077, "comment_id": 98274797, "body": "I tryed f  and &amp;f, no luck."}, {"owner": {"reputation": 23, "user_id": 9223951, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J33h717MVr8/AAAAAAAAAAI/AAAAAAAAAAA/CG6hlM3ArRs/photo.jpg?sz=128", "display_name": "devpablocristo", "link": "https://stackoverflow.com/users/9223951/devpablocristo"}, "edited": false, "score": 0, "creation_date": 1555986727, "post_id": 55803077, "comment_id": 98275295, "body": "It works but just with curl, not with a real html form. I dont know what im doing wrong ill post all the code im using."}, {"owner": {"reputation": 23, "user_id": 9223951, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J33h717MVr8/AAAAAAAAAAI/AAAAAAAAAAA/CG6hlM3ArRs/photo.jpg?sz=128", "display_name": "devpablocristo", "link": "https://stackoverflow.com/users/9223951/devpablocristo"}, "edited": false, "score": 0, "creation_date": 1555987053, "post_id": 55803077, "comment_id": 98275362, "body": "with the html form i still get &quot;null&quot;"}, {"owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "reply_to_user": {"reputation": 23, "user_id": 9223951, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J33h717MVr8/AAAAAAAAAAI/AAAAAAAAAAA/CG6hlM3ArRs/photo.jpg?sz=128", "display_name": "devpablocristo", "link": "https://stackoverflow.com/users/9223951/devpablocristo"}, "edited": false, "score": 0, "creation_date": 1555988551, "post_id": 55803077, "comment_id": 98275614, "body": "Ok~ If you sent html form , you may try ShouldBindXML"}, {"owner": {"reputation": 23, "user_id": 9223951, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J33h717MVr8/AAAAAAAAAAI/AAAAAAAAAAA/CG6hlM3ArRs/photo.jpg?sz=128", "display_name": "devpablocristo", "link": "https://stackoverflow.com/users/9223951/devpablocristo"}, "edited": false, "score": 0, "creation_date": 1555990086, "post_id": 55803077, "comment_id": 98275844, "body": "this is what i get:"}, {"owner": {"reputation": 23, "user_id": 9223951, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J33h717MVr8/AAAAAAAAAAI/AAAAAAAAAAA/CG6hlM3ArRs/photo.jpg?sz=128", "display_name": "devpablocristo", "link": "https://stackoverflow.com/users/9223951/devpablocristo"}, "edited": false, "score": 0, "creation_date": 1555990091, "post_id": 55803077, "comment_id": 98275848, "body": "{&quot;error&quot;:&quot;XML syntax error on line 1: invalid character entity \\u0026password (no semicolon)&quot;}"}, {"owner": {"reputation": 23, "user_id": 9223951, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J33h717MVr8/AAAAAAAAAAI/AAAAAAAAAAA/CG6hlM3ArRs/photo.jpg?sz=128", "display_name": "devpablocristo", "link": "https://stackoverflow.com/users/9223951/devpablocristo"}, "edited": false, "score": 0, "creation_date": 1555990110, "post_id": 55803077, "comment_id": 98275850, "body": "with ShouldBindXML"}, {"owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "reply_to_user": {"reputation": 23, "user_id": 9223951, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J33h717MVr8/AAAAAAAAAAI/AAAAAAAAAAA/CG6hlM3ArRs/photo.jpg?sz=128", "display_name": "devpablocristo", "link": "https://stackoverflow.com/users/9223951/devpablocristo"}, "edited": false, "score": 0, "creation_date": 1555990728, "post_id": 55803077, "comment_id": 98275956, "body": "I think you have to parser HTML FORM on your own <a href=\"https://godoc.org/golang.org/x/net/html\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/net/html</a>"}, {"owner": {"reputation": 23, "user_id": 9223951, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J33h717MVr8/AAAAAAAAAAI/AAAAAAAAAAA/CG6hlM3ArRs/photo.jpg?sz=128", "display_name": "devpablocristo", "link": "https://stackoverflow.com/users/9223951/devpablocristo"}, "edited": false, "score": 0, "creation_date": 1555991070, "post_id": 55803077, "comment_id": 98276029, "body": "Thank you for your help. I will continue tomorrow. TYVM. I&#39;ll post my results."}], "tags": [], "owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "is_accepted": false, "score": 0, "last_activity_date": 1555988377, "last_edit_date": 1555988377, "creation_date": 1555982775, "answer_id": 55803077, "question_id": 55803040, "link": "https://stackoverflow.com/questions/55803040/how-to-make-a-generic-form-function-for-froms-with-interfeces-with-gin-framewor/55803077#55803077", "title": "How to make a generic form function for froms with interfeces with gin (framework) and golang?", "body": "<p>Do you try to use <strong><a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.ShouldBindJSON\" rel=\"nofollow noreferrer\">ShouldBindJSON</a></strong>? Because it has to know which type your want to be</p>\n\n<blockquote>\n  <p>ShouldBind checks the Content-Type to select a binding engine automatically, Depending the \"Content-Type\" header different bindings are used: </p>\n</blockquote>\n\n<p>from source code of gin:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// ShouldBindJSON is a shortcut for c.ShouldBindWith(obj, binding.JSON).\nfunc (c *Context) ShouldBindJSON(obj interface{}) error {\n    return c.ShouldBindWith(obj, binding.JSON)\n}\n</code></pre>\n\n<p><strong>Update:</strong>\nIn your case, it work for me ?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nrouter := gin.Default()\n\n    router.POST(\"/loginForm\", func(c *gin.Context) {\n        var f interface{}\n\n        if err := c.ShouldBindJSON(&amp;f); err != nil {\n            c.JSON(http.StatusBadRequest, gin.H{\"error\": err.Error()})\n            return\n        }\n        log.Print(f)\n        c.JSON(http.StatusOK, f)\n    })\n\n    // Listen and serve on 0.0.0.0:8080\n    router.Run(\":8080\")\n</code></pre>\n\n<p>Example login</p>\n\n<pre><code>curl -X POST -H \"Content-Type: application/json\" \\\n     --data '{\"username\":\"xyz\",\"password\":\"xyz\"}'  localhost:8080/loginForm\n</code></pre>\n\n<p>Result</p>\n\n<pre><code>[GIN-debug] POST   /loginForm                --&gt; main.main.func1 (3 handlers)\n[GIN-debug] Listening and serving HTTP on :8080\nmap[password:xyz username:xyz]\n[GIN] 2019/04/23 - 10:07:00 | 200 |     239.317\u00b5s |             ::1 | POST     /loginForm\n\n\n</code></pre>\n\n<p>//////////////////////////////////</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\n// Binding from JSON\ntype Login struct {\n    User     string `form:\"user\" json:\"user\" xml:\"user\"  binding:\"required\"`\n    Password string `form:\"password\" json:\"password\" xml:\"password\" binding:\"required\"`\n}\n\nfunc main() {\n    router := gin.Default()\n\n    router.LoadHTMLGlob(\"templates/*\")\n\n    router.GET(\"/login\", func(c *gin.Context) {\n        c.HTML(http.StatusOK, \"login.tmpl\", nil)\n    })\n\n    // Example for binding a HTML form (user=manu&amp;password=123)\n    router.POST(\"/loginForm\", func(c *gin.Context) {\n        var form interface{}\n        // This will infer what binder to use depending on the content-type header.\n        if err := c.ShouldBind(&amp;form); err != nil {\n            c.JSON(http.StatusBadRequest, gin.H{\"error\": err.Error()})\n            return\n        }\n\n        c.JSON(http.StatusOK, form)\n    })\n\n    // Listen and serve on 0.0.0.0:8080\n    router.Run(\":8080\")\n}\n</code></pre>\n\n<p>//the template</p>\n\n<pre><code>&lt;h1&gt;Login&lt;/h1&gt;\n&lt;form action=\"/loginForm\" method=\"POST\"&gt;\n    &lt;label&gt;user:&lt;/label&gt;&lt;br&gt;\n    &lt;input type=\"text\" name=\"user\"&gt;&lt;br&gt;\n\n    &lt;label&gt;password:&lt;/label&gt;&lt;br&gt;\n    &lt;input type=\"text\" name=\"password\"&gt;&lt;br&gt;\n\n    &lt;input type=\"submit\"&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>//I get null when I use de HTML from, when I try the curl command, it works</p>\n"}], "owner": {"reputation": 23, "user_id": 9223951, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J33h717MVr8/AAAAAAAAAAI/AAAAAAAAAAA/CG6hlM3ArRs/photo.jpg?sz=128", "display_name": "devpablocristo", "link": "https://stackoverflow.com/users/9223951/devpablocristo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2207, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1597431013, "creation_date": 1555982388, "last_edit_date": 1597431013, "question_id": 55803040, "link": "https://stackoverflow.com/questions/55803040/how-to-make-a-generic-form-function-for-froms-with-interfeces-with-gin-framewor", "title": "How to make a generic form function for froms with interfeces with gin (framework) and golang?", "body": "<p>I want to create a function to process anykind of forms.\nI want it to be able to handle any kind of data types.\nIm trying to use a interface to do this task.</p>\n\n<pre><code>type Person struct {\n    name        string \n    lastName    string\n}\n\n\nfunc HTMLForm(c *gin.Context) {\n    var f Person\n    c.ShouldBind(&amp;f)\n    c.JSON(http.StatusOK, f)\n}\n\n// with this function i get the correct info\n\n// output: {\"name\":\"john\",\"lastName\":\"snow\"}\n\nfunc HTMLForm(c *gin.Context) {\n    var f interface{}\n    c.ShouldBind(&amp;f)\n    c.JSON(http.StatusOK, f)\n}\n\n// when i use the interface to make it usefull for any type of that\n// i get null\n\n// output: null\n\nfunc HTMLForm(c *gin.Context) {\n    var f interface{}\n    ShouldBindJSON(f)\n    c.JSON(http.StatusOK, f)\n}\n\n// output: null\n</code></pre>\n\n<p>I want to get, with the interface, the same output I get with \"Person\" data type.</p>\n\n<pre><code>// Another example of how i am using f\n\ntype Login struct {\n    User     string \n    Password string \n}\n\nfunc main() {\n    router := gin.Default()\n\n    router.POST(\"/loginForm\", func(c *gin.Context) {\n        var f interface{}\n\n        if err := c.ShouldBind(&amp;f); err != nil {\n            c.JSON(http.StatusBadRequest, gin.H{\"error\": err.Error()})\n            return\n        }\n\n        c.JSON(http.StatusOK, f)\n    })\n\n    // Listen and serve on 0.0.0.0:8080\n    router.Run(\":8080\")\n}\n\n// output: null\n</code></pre>\n\n<p>///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\nUpdate</p>\n\n<p>I want to try to explain my problem better.\nMaybe this update it's more clear.</p>\n\n<pre><code>// Golang code\npackage main\n\nimport (\n    \"net/http\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\n// Binding from JSON\ntype Login struct {\n    User     string `form:\"user\" json:\"user\" xml:\"user\"  binding:\"required\"`\n    Password string `form:\"password\" json:\"password\" xml:\"password\" binding:\"required\"`\n}\n\nfunc main() {\n    router := gin.Default()\n\n    router.LoadHTMLGlob(\"templates/*\")\n\n    router.GET(\"/login\", GetLogin)\n    router.POST(\"/loginJSON\", PostJSONForm)\n    router.POST(\"/loginXML\", PostXMLForm)\n    router.POST(\"/loginForm\", PostHTMLForm)\n\n    /*\n        sudo lsof -n -i :8080\n        kill -9 &lt;PID&gt;\n    */\n    router.Run(\":8080\")\n}\n\nfunc GetLogin(c *gin.Context) {\n    c.HTML(http.StatusOK, \"login.tmpl\", nil)\n}\n\n// Example for binding JSON ({\"user\": \"manu\", \"password\": \"123\"})\n// curl -v -X POST http://localhost:8080/loginJSON -H 'content-type: application/json' '{ \"user\": \"manu\", \"password\"=\"123\" }'\nfunc PostJSONForm(c *gin.Context) {\n    //var json Login\n    var json interface{}\n    //var form map[string]interface{}\n\n    if err := c.ShouldBindJSON(&amp;json); err != nil {\n        c.JSON(http.StatusBadRequest, gin.H{\"error\": err.Error()})\n        return\n    }\n\n    /*\n        if json.User != \"manu\" || json.Password != \"123\" {\n            c.JSON(http.StatusUnauthorized, gin.H{\"status\": \"unauthorized\"})\n            return\n        }\n        c.JSON(http.StatusOK, gin.H{\"status\": \"you are logged in\"})\n    */\n\n    c.JSON(http.StatusOK, \"json\")\n    c.JSON(http.StatusOK, json)\n}\n\n// Example for binding XML (\n//  &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n//  &lt;root&gt;\n//      &lt;user&gt;user&lt;/user&gt;\n//      &lt;password&gt;123&lt;/password&gt;\n//  &lt;/root&gt;)\n// curl -v -X POST http://localhost:8080/loginXML -H 'content-type: application/json' -d '{ \"user\": \"manu\", \"password\"=\"123\" }'\nfunc PostXMLForm(c *gin.Context) {\n    //var xml Login\n    var xml interface{}\n    //var form map[string]interface{}\n\n    if err := c.ShouldBindXML(&amp;xml); err != nil {\n        c.JSON(http.StatusBadRequest, gin.H{\"error\": err.Error()})\n        return\n    }\n\n    /*\n        if xml.User != \"manu\" || xml.Password != \"123\" {\n            c.JSON(http.StatusUnauthorized, gin.H{\"status\": \"unauthorized\"})\n            return\n        }\n        c.JSON(http.StatusOK, gin.H{\"status\": \"you are logged in\"})\n    */\n\n    c.JSON(http.StatusOK, \"xml\")\n    c.JSON(http.StatusOK, xml)\n}\n\n// Example for binding a HTML form (user=manu&amp;password=123)\n// curl -v -X POST http://localhost:8080/loginForm -H 'content-type: application/json' -d '{ \"user\": \"manu\", \"password\":\"123\" }'\nfunc PostHTMLForm(c *gin.Context) {\n    //var form Login\n    var form interface{}\n    //var form map[string]interface{}\n\n    // This will infer what binder to use depending on the content-type header.\n    if err := c.ShouldBind(&amp;form); err != nil {\n        c.JSON(http.StatusBadRequest, gin.H{\"error\": err.Error()})\n        return\n    }\n\n    /*\n        if form.User != \"manu\" || form.Password != \"123\" {\n            c.JSON(http.StatusUnauthorized, gin.H{\"status\": \"unauthorized\"})\n            return\n        }\n        c.JSON(http.StatusOK, gin.H{\"status\": \"you are logged in\"})\n    */\n\n    c.JSON(http.StatusOK, \"html\")\n    c.JSON(http.StatusOK, form)\n}\n\n//Template\n&lt;h1&gt;Login&lt;/h1&gt;\n&lt;form action=\"/loginForm\" method=\"POST\"&gt;\n    &lt;label&gt;user:&lt;/label&gt;&lt;br&gt;\n    &lt;input type=\"text\" name=\"user\"&gt;&lt;br&gt;\n\n    &lt;label&gt;password:&lt;/label&gt;&lt;br&gt;\n    &lt;input type=\"text\" name=\"password\"&gt;&lt;br&gt;\n\n    &lt;input type=\"submit\"&gt;\n&lt;/form&gt;\n</code></pre>\n\n<ol>\n<li><p>I have tried all this different variations. Just one works, I explain more below.</p></li>\n<li><p>It works perfect if I use \"var form Login\" instead of \"var from interface{}\". But I need it to be able to work with any data type, so I need it to work with interface{}.</p></li>\n<li><p>I have had a \"successful\" output, just with one of interface{} tries:</p></li>\n</ol>\n\n<p>$ curl -X POST <a href=\"http://localhost:8080/loginForm\" rel=\"nofollow noreferrer\">http://localhost:8080/loginForm</a> -H 'content-type: application/json' -d '{ \"user\": \"manu\", \"password\":\"123\" }'</p>\n\n<p>output:\"html\"{\"password\":\"123\",\"user\":\"manu\"}</p>\n\n<ol start=\"4\">\n<li>But when I use it on a HTML form, on a browser, with that template I posted i get:</li>\n</ol>\n\n<p>output: \"html\"null</p>\n\n<ol start=\"5\">\n<li>Im not sure if what I get (point 3) its really a sucessfull output. When I use the Login var, it works fine, with curl and brower, the output it's inverted:</li>\n</ol>\n\n<p>$  curl -X POST <a href=\"http://localhost:8080/loginForm\" rel=\"nofollow noreferrer\">http://localhost:8080/loginForm</a> -H 'content-type: application/json' -d '{ \"user\": \"manu\", \"password\":\"123\" }'</p>\n\n<p>ouput:\"html\"{\"user\":\"manu\",\"password\":\"123\"}</p>\n\n<p>This is all information I could get till now.</p>\n"}, {"tags": ["http", "go", "redirect"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1555986625, "post_id": 55801880, "comment_id": 98275270, "body": "Note you&#39;re silencing a lot of errors in this code (e.g. <code>rows, _ := tx.Query(..)</code>, which is almost certainly not a good idea. What if you have a typo in the SQL query or parameter? Or what if something unexpected happens (database went away)? You should always check errors! Also, <code>email_ployer = &#39;?&#39;</code> looks incorrect? You don&#39;t need the quotes there, as you&#39;re using parametrized queries. Not sure if his is related to your issue."}], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 1, "last_activity_date": 1555975422, "creation_date": 1555975422, "answer_id": 55802308, "question_id": 55801880, "link": "https://stackoverflow.com/questions/55801880/im-struggling-to-append-an-id-from-mysql-to-the-url/55802308#55802308", "title": "I&#39;m struggling to append an id from mysql to the URL", "body": "<p>Just use <code>res.LastInsertId()</code> to get the id and pass it to your redirect function, and build the url:</p>\n\n<pre><code>func RegisterNewPloyer(w http.ResponseWriter, r *http.Request) {\n  //...\n  //...\n  res, erro := stmt.Exec(email_ployer, senha)\n  if erro != nil {\n    tx.Rollback()\n    log.Fatal(erro)\n  }\n  tx.Commit()\n  id, erro := res.LastInsertId()\n  if erro != nil {\n    log.Fatal(erro)\n  }\n  Redirect(w, r, id)\n}\n\nfunc Redirect(w http.ResponseWriter, r *http.Request, id int64) {\n    uri := fmt.Sprintf(\"http://localhost:3306/ployer/complete/%d\", id)\n    http.Redirect(w, r, uri, http.StatusSeeOther)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 131, "user_id": 1144473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39d43c3325564f1e3c3ff91cbd140ca5?s=128&d=identicon&r=PG", "display_name": "buddyspike28", "link": "https://stackoverflow.com/users/1144473/buddyspike28"}, "is_accepted": false, "score": 0, "last_activity_date": 1555986178, "creation_date": 1555986178, "answer_id": 55803439, "question_id": 55801880, "link": "https://stackoverflow.com/questions/55801880/im-struggling-to-append-an-id-from-mysql-to-the-url/55803439#55803439", "title": "I&#39;m struggling to append an id from mysql to the URL", "body": "<p>You should use <code>url.Values</code> to construct a map of query string values. Later on, you can use <code>Encode</code> method to generate encoded query string. Assign this value to <code>Url.RawQuery</code> to get the final output.</p>\n\n<p>e.g.:</p>\n\n<pre><code>base, _ := url.Parse(\"https://www.foo.com/\")\n\n// Create an instance of Values to hold your query string parameters\nvalues := url.Values{}\nvalues.Add(\"abc\", \"def\")\n\n// Set the encoded output to RawQuery attribute of Url\nbase.RawQuery = values.Encode()\n\nprintln(base.String())\n</code></pre>\n\n<p>If you are starting with a URL that already has query string parameters and you want add/modify items in it, use <code>Query()</code> method to obtain a reference to parsed map.</p>\n\n<p>e.g.:</p>\n\n<pre><code>base, _ := url.Parse(\"https://www.foo.com/?a=b\")\n\nvalues := base.Query()\nvalues.Set(\"a\", \"c\")\nvalues.Set(\"x\", \"y\")\n\n// Set the encoded output to RawQuery attribute of Url\nbase.RawQuery = values.Encode()\n\nprintln(base.String())\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 10945896, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vwIwbfSDDF8/AAAAAAAAAAI/AAAAAAAAAD4/HGlBMxbuxGU/photo.jpg?sz=128", "display_name": "Lucas Albuquerque", "link": "https://stackoverflow.com/users/10945896/lucas-albuquerque"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 55802308, "answer_count": 2, "score": 0, "last_activity_date": 1555986178, "creation_date": 1555972008, "question_id": 55801880, "link": "https://stackoverflow.com/questions/55801880/im-struggling-to-append-an-id-from-mysql-to-the-url", "title": "I&#39;m struggling to append an id from mysql to the URL", "body": "<p>I'm trying to append an id (and other info) to the url, so I can access it later, but I can't find the right method after some research. </p>\n\n<p>I've tried to use Get() method, query(), Add(), but I couldn't redirect the URL.</p>\n\n<pre><code>var email_ployer string\n\nfunc RegisterNewPloyer(w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path != \"/ployer/register\" {\n        http.Error(w, \"404 not found.\", http.StatusNotFound)\n        return\n    }\n    db := connect.ConnectDB()\n    defer db.Close()\n    switch r.Method {\n    case \"POST\":\n        email_ployer = r.FormValue(\"email\")\n        senha := r.FormValue(\"senha\")\n        senha, _ = HashPassword(senha)\n        tx, _ := db.Begin()\n        stmt, _ := tx.Prepare(\"INSERT INTO ployers(email_ployer, senha_ployer) VALUES(?,?)\")\n        _, erro := stmt.Exec(email_ployer, senha)\n        if erro != nil {\n            tx.Rollback()\n            log.Fatal(erro)\n        }\n        tx.Commit()\n    }\n    Redirect(w, r)\n}\n\nfunc Redirect(w http.ResponseWriter, r *http.Request) {\n    db2 := connect.ConnectDB()\n    defer db2.Close()\n    var id string\n    tx, _ := db2.Begin()\n    rows, _ := tx.Query(\"SELECT id FROM ployers WHERE email_ployer = '?'\", email_ployer)\n    for rows.Next() {\n        if err := rows.Scan(&amp;id); err != nil {\n            log.Fatal(err)\n        }\n        if err := rows.Err(); err != nil {\n            log.Fatal(err)\n        }\n    }\n    http.Redirect(w, r, x, http.StatusSeeOther)\n}\n\n\n\n\nfunc main() {\n    http.HandleFunc(\"/ployer/seja-um-de-nos\", LoadPloyerContent)\n    http.HandleFunc(\"/ployer/register\", register.RegisterNewPloyer)\n    http.HandleFunc(\"/ployer/complete/\", LoadPloyerContent)\n    http.HandleFunc(\"/ployer/register-received\", LoadPloyerContent)\n    log.Fatal(http.ListenAndServe(\":3306\", nil))\n}\n</code></pre>\n\n<p>In my system, I want the user to register his E-mail and password, create an new user in the DB and redirect the URL to something like localhost:3306/ployer/complete/id</p>\n"}, {"tags": ["go", "grpc", "grpc-go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1555968547, "post_id": 55801327, "comment_id": 98271423, "body": "<code>pb.RegisterCollectionServer</code> must have <b>exactly</b> the <code>func(*grpc.Server, interface {})</code> type. It&#39;s not about type compatibility of a particular function argument: the whole function signature must match."}], "answers": [{"tags": [], "owner": {"reputation": 2808, "user_id": 98596, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/213851cc1f442df8f40b000f59ecb08a?s=128&d=identicon&r=PG", "display_name": "ftl", "link": "https://stackoverflow.com/users/98596/ftl"}, "is_accepted": true, "score": 0, "last_activity_date": 1556017237, "creation_date": 1556017237, "answer_id": 55809744, "question_id": 55801327, "link": "https://stackoverflow.com/questions/55801327/how-to-create-a-generic-grpc-server-start-function-in-go/55809744#55809744", "title": "How to create a generic GRPC server start function in Go", "body": "<p>In your setup the function signature of <code>collector_api.RegisterCollectionServer</code> must match exactly <code>func(*grpc.Server, interface{})</code>, there is no \"is-kind-of\" in Go as there is in other languages.</p>\n\n<p>If you want to keep the <code>startService</code> function independent of the <code>collection_api</code> types, you can use a anonymous function in <code>main()</code>. If you know that you what ever you are registering is always dependent on the implementation of the anonymous function (in this case &amp;server.Server{}), then you can leave this detail out of the function signature of <code>startService</code> and put it into the anonymous function: </p>\n\n<pre><code>func startService(sr func(*grpc.Server)) error {\n    lis, err := net.Listen(\"tcp\", port)\n    if err != nil {\n        return err\n    }\n    s := grpc.NewServer()\n    sr(s)\n    reflection.Register(s)\n    return s.Serve(lis)\n}\n\nfunc main() {\n    err := startService(func(grpcServer *grpc.Server) {\n            pb.RegisterCollectionServer(grpcServer, &amp;server.Server{})\n        }, &amp;server.Server{})\n\n    if err != nil {\n        log.Fatalf(\"failed to start Service: %v\", err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 3917306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5efdcea6361378f22bbe4c3d319d2365?s=128&d=identicon&r=PG&f=1", "display_name": "user3917306", "link": "https://stackoverflow.com/users/3917306/user3917306"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "accepted_answer_id": 55809744, "answer_count": 1, "score": 0, "last_activity_date": 1556017445, "creation_date": 1555968357, "last_edit_date": 1556017445, "question_id": 55801327, "link": "https://stackoverflow.com/questions/55801327/how-to-create-a-generic-grpc-server-start-function-in-go", "title": "How to create a generic GRPC server start function in Go", "body": "<p>I'm trying to abstract the start of a GRPC server</p>\n\n<p>The original main function is the following:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    lis, err := net.Listen(\"tcp\", port)\n    if err != nil {\n        log.Fatalf(\"failed to listen: %v\", err)\n    }\n\n    s := grpc.NewServer()\n    pb.RegisterCollectionServer(s, &amp;server.Server{})\n    // Register reflection service on gRPC server.\n    reflection.Register(s)\n    if err := s.Serve(lis); err != nil {\n        log.Fatalf(\"failed to serve: %v\", err)\n    }\n}\n</code></pre>\n\n<p>My goal is to have something like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func startService(sr func(*grpc.Server, interface{}), srv interface{}) error {\n    lis, err := net.Listen(\"tcp\", port)\n    if err != nil {\n        return err\n    }\n    s := grpc.NewServer()\n    sr(s, srv)\n    reflection.Register(s)\n    return s.Serve(lis)\n}\n\nfunc main() {\n    err := startService(pb.RegisterCollectionServer, &amp;server.Server{})\n\n    if err != nil {\n        log.Fatalf(\"failed to start Service: %v\", err)\n    }\n}\n</code></pre>\n\n<p>But this gives me the following error:</p>\n\n<pre><code>cannot use collection_api.RegisterCollectionServer (type func(*grpc.Server, collection_api.CollectionServer)) as type func(*grpc.Server, interface {}) in argument to startServicego\n\n</code></pre>\n\n<p>It seems that <code>collection_api.CollectionServer</code> is not a valid <code>interface{}</code> type.</p>\n\n<p>Any idea how to make this work?</p>\n"}, {"tags": ["go", "google-cloud-pubsub"], "comments": [{"owner": {"reputation": 1432, "user_id": 494984, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/197a7611b23b98b6f9fc00751ed74f2a?s=128&d=identicon&r=PG", "display_name": "Vikas Madhusudana", "link": "https://stackoverflow.com/users/494984/vikas-madhusudana"}, "edited": false, "score": 0, "creation_date": 1556038625, "post_id": 55800616, "comment_id": 98298845, "body": "Can you try print the type of dest before dec.Decode(dest). To make sure it is of type RetryMessage"}], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 9443806, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CG4wm.png?s=128&g=1", "display_name": "Haardik", "link": "https://stackoverflow.com/users/9443806/haardik"}, "edited": false, "score": 0, "creation_date": 1556731696, "post_id": 55939183, "comment_id": 98533398, "body": "I fixed the error, though it was unrelated. the gob decoder didn&#39;t like that the <code>Transaction</code> inside <code>RetryMessage</code> was a pointer, I changed it to be a copy of the struct and it worked"}, {"owner": {"reputation": 9109, "user_id": 1121288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/299e0ebf3759ba2e2e6f69fc30653016?s=128&d=identicon&r=PG", "display_name": "Kamal Aboul-Hosn", "link": "https://stackoverflow.com/users/1121288/kamal-aboul-hosn"}, "edited": false, "score": 0, "creation_date": 1557154700, "post_id": 55939183, "comment_id": 98660870, "body": "It would be best for you to add this answer and then accept it."}], "tags": [], "owner": {"reputation": 124, "user_id": 8098238, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-yFY8WfL8W5g/AAAAAAAAAAI/AAAAAAAAH2A/JRfAPFknUps/photo.jpg?sz=128", "display_name": "Alex Mordkovich", "link": "https://stackoverflow.com/users/8098238/alex-mordkovich"}, "is_accepted": false, "score": 0, "last_activity_date": 1556726858, "creation_date": 1556726858, "answer_id": 55939183, "question_id": 55800616, "link": "https://stackoverflow.com/questions/55800616/gob-type-mismatch-no-fields-matched-compiling-decoder-golang/55939183#55939183", "title": "gob: type mismatch: no fields matched compiling decoder - Golang", "body": "<p>In this code in <code>HandleMessage</code>:</p>\n\n<pre><code>        data, err := pubsub.EncodeMessage(retryMsg)\n        if err != nil {\n            c.log.WithError(err).Error(\"failed to convert retry msg to byte slice\")\n        }\n</code></pre>\n\n<p>The error is ignored and the published message\u2019s <code>data</code> field is populated with a potentially bad value. Check whether you are seeing \u201cfailed to convert retry msg to byte slice\u201d in the logs.</p>\n"}], "owner": {"reputation": 157, "user_id": 9443806, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CG4wm.png?s=128&g=1", "display_name": "Haardik", "link": "https://stackoverflow.com/users/9443806/haardik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 804, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556726858, "creation_date": 1555964485, "question_id": 55800616, "link": "https://stackoverflow.com/questions/55800616/gob-type-mismatch-no-fields-matched-compiling-decoder-golang", "title": "gob: type mismatch: no fields matched compiling decoder - Golang", "body": "<p>I'm using PubSub on two different streams where we receive messages from one stream, run some logic, and if it fits certain criteria, we publish it to the second stream. The second stream is also being received from in a goroutine. </p>\n\n<p>Now, I have two main functions <code>HandleMessage</code> and <code>HandleRetry</code> where the former is from the first stream, and the second is for the second stream.</p>\n\n<p>The relevant code for <code>HandleMessage</code> is as follows:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    if c.handler.ShouldProcess(tx) {\n        err := c.handler.Process(tx)\n        if err != nil {\n            c.log.\n                WithError(err).\n                WithField(\"tx_hash\", tx.TxHash.String()).\n                Error(\"failed to process\")\n\n            retryMsg := RetryMessage{\n                Transaction:                 tx,\n                RemainingProcessingAttempts: c.config.MaxProcessingAttempts,\n                LastAttempt:                 time.Now(),\n            }\n\n            data, err := pubsub.EncodeMessage(retryMsg)\n            if err != nil {\n                c.log.WithError(err).Error(\"failed to convert retry msg to byte slice\")\n            }\n\n            id, err := c.retryQueue.Publish(context.Background(), &amp;pubsub.Message{Data: data})\n            if err != nil {\n                c.log.WithError(err).\n                    WithField(\"id\", id).\n                    Error(\"failed to publish message to retry queue\")\n            }\n        }\n    }\n</code></pre>\n\n<p>and in <code>HandleRetry</code>, the function opens with </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    retryTx := new(RetryMessage)\n    err := pubsub.DecodeMessage(msg.Data, retryTx)\n    if err != nil {\n        c.log.WithError(err).\n            Error(\"failed to decode message: not a retry tx\")\n        msg.Ack()\n        return\n    }\n</code></pre>\n\n<p>For the <code>RetryQueue</code> which is handled by <code>HandleRetry</code> -- there is no other input except the messages being published from <code>HandleMessage</code> </p>\n\n<p>But, I keep getting a gob decoding error saying </p>\n\n<p><code>level=error msg=\"failed to decode message: not a retry tx\" env=LOCAL error=\"gob: type mismatch: no fields matched compiling decoder for RetryMessage\"</code></p>\n\n<p><code>RetryMessage</code> looks like this</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type RetryMessage struct {\n    Transaction                 *firehose.Transaction\n    RemainingProcessingAttempts int\n    LastAttempt                 time.Time\n}\n</code></pre>\n\n<p>The encoding and decoding functions are as follows</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// EncodeMessage convert an arbitrary interface into a byte slice.\nfunc EncodeMessage(data interface{}) ([]byte, error) {\n    var buf bytes.Buffer\n\n    enc := gob.NewEncoder(&amp;buf)\n\n    err := enc.Encode(data)\n    if err != nil {\n        return nil, err\n    }\n\n    return buf.Bytes(), nil\n}\n\n// DecodeMessage decodes message data into the provided interface.\nfunc DecodeMessage(data []byte, dest interface{}) error {\n    buf := bytes.NewBuffer(data)\n    dec := gob.NewDecoder(buf)\n    return dec.Decode(dest)\n}\n</code></pre>\n"}, {"tags": ["javascript", "go", "webassembly"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1555962439, "post_id": 55800163, "comment_id": 98269288, "body": "Did you import <code>syscall&#47;js</code> and set the proper environment variables (<code>GOOS=js GOARCH=wasm</code>)?"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 3, "creation_date": 1555963973, "post_id": 55800163, "comment_id": 98269867, "body": "It looks like the article you&#39;re referring to may be outdated. You may want to checkout <a href=\"https://github.com/golang/go/wiki/WebAssembly\" rel=\"nofollow noreferrer\">the wiki</a>. If I had to guess, you might want <code>js.FuncOf</code> instead of <code>js.NewCallback</code>."}, {"owner": {"reputation": 215, "user_id": 1828438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mvizo.jpg?s=128&g=1", "display_name": "w33t", "link": "https://stackoverflow.com/users/1828438/w33t"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1555966990, "post_id": 55800163, "comment_id": 98270932, "body": "@Gavin Thank you for the recommendation! It looks like js.FuncOf is what im looking for. Once I test it out and make sure it does what im looking for, ill reply to the question with the solution that worked for me. Thank you again!"}], "answers": [{"tags": [], "owner": {"reputation": 390, "user_id": 951976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345c7d58b0becdd2ee89483afdf95c63?s=128&d=identicon&r=PG", "display_name": "gogaman", "link": "https://stackoverflow.com/users/951976/gogaman"}, "is_accepted": true, "score": 18, "last_activity_date": 1559777185, "creation_date": 1559777185, "answer_id": 56469260, "question_id": 55800163, "link": "https://stackoverflow.com/questions/55800163/golangs-syscall-js-js-newcallback-is-undefined/56469260#56469260", "title": "Golang&#39;s syscall/js js.NewCallback is undefined", "body": "<pre><code>js.Global().Set(\"jsFunctionName\", js.NewCallback(goCallback))\n</code></pre>\n\n<p>should be as:</p>\n\n<pre><code>js.Global().Set(\"jsFunctionName\", js.FuncOf(goCallback))\n</code></pre>\n\n<p>Note the signature of goCallback has changed and now since Go 1.12, there is a support  for return values.\nFor example, here is how to expose a simple add function:</p>\n\n<pre><code>// function definition\nfunc add(this js.Value, i []js.Value) interface{} {\n  return js.ValueOf(i[0].Int()+i[1].Int())\n}\n\n// exposing to JS\njs.Global().Set(\"add\", js.FuncOf(add))\n</code></pre>\n"}], "owner": {"reputation": 215, "user_id": 1828438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mvizo.jpg?s=128&g=1", "display_name": "w33t", "link": "https://stackoverflow.com/users/1828438/w33t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2630, "favorite_count": 1, "accepted_answer_id": 56469260, "answer_count": 1, "score": 8, "last_activity_date": 1559777185, "creation_date": 1555962107, "question_id": 55800163, "link": "https://stackoverflow.com/questions/55800163/golangs-syscall-js-js-newcallback-is-undefined", "title": "Golang&#39;s syscall/js js.NewCallback is undefined", "body": "<p>I am new to both go and wasm and it looks like these projects are pretty fast moving. <a href=\"https://www.sitepen.com/blog/compiling-go-to-webassembly/\" rel=\"noreferrer\">I was reading an introduction to using wasm in go</a> and it seems although it was written in January, its already out of date.</p>\n\n<p>I am attempting to call a single go function when a JavaScript function is invoked. The example says to do something like this:</p>\n\n<pre><code> js.Global().Set(\"jsFunctionName\", js.NewCallback(goCallback))\n</code></pre>\n\n<p>Although when I am trying to compile this, I am getting this error:</p>\n\n<pre><code>./webassembly.go:54:35: undefined: js.NewCallback\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/syscall/js/\" rel=\"noreferrer\">I checked the documentation</a> and see no reference to <code>NewCallback</code>. What is the current \"correct\" way that this should be done?</p>\n"}, {"tags": ["go", "amazon-iam", "cloud-foundry", "paas"], "comments": [{"owner": {"reputation": 109, "user_id": 11394942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2aa189aeca0ce0efc6e7dbb6f24a63ac?s=128&d=identicon&r=PG&f=1", "display_name": "KeukenkastjeXYZ", "link": "https://stackoverflow.com/users/11394942/keukenkastjexyz"}, "edited": false, "score": 0, "creation_date": 1555960830, "post_id": 55799434, "comment_id": 98268717, "body": "The business case of CredHub is exactly the problem you are facing in combination with PCF. You should definitely look into how to use/implement CredHub."}], "answers": [{"comments": [{"owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "edited": false, "score": 0, "creation_date": 1555977775, "post_id": 55802525, "comment_id": 98273654, "body": "Cloudfoundry platform manager is not ready to share the password. For example, in another scenario, Jenkins talks to cloud foundry using credential id of jenkins"}, {"owner": {"reputation": 10226, "user_id": 1585136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de253a68c4e3690787c1c55fc1104413?s=128&d=identicon&r=PG", "display_name": "Daniel Mikusa", "link": "https://stackoverflow.com/users/1585136/daniel-mikusa"}, "edited": false, "score": 0, "creation_date": 1556022714, "post_id": 55802525, "comment_id": 98289441, "body": "Most people are going to share creds through a service instance, maybe a user provided service, or environment variables (service info is just VCAP_SERVICES). It&#39;s quick, easy, doesn&#39;t require creds to be in source control and is reasonably secure. CredHub offers some advanced capabilities for storing passwords, which keeps your creds out of Cloud Controller. You&#39;ll still end up getting your creds from environment variables, so it&#39;s still easy, and the only place your creds reside is in CredHub. Just keep in mind this adds a dependency on CredHub, so if that goes down your app won&#39;t start."}, {"owner": {"reputation": 10226, "user_id": 1585136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de253a68c4e3690787c1c55fc1104413?s=128&d=identicon&r=PG", "display_name": "Daniel Mikusa", "link": "https://stackoverflow.com/users/1585136/daniel-mikusa"}, "edited": false, "score": 1, "creation_date": 1556022956, "post_id": 55802525, "comment_id": 98289564, "body": "For those needing the utmost security, apps could pull creds directly from CredHub API. This would remove creds from environment variables, but comes with the added overhead of your app needing to understand how to talk with CredHub. What you end up doing, all depends on the security needs of your app."}, {"owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "reply_to_user": {"reputation": 10226, "user_id": 1585136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de253a68c4e3690787c1c55fc1104413?s=128&d=identicon&r=PG", "display_name": "Daniel Mikusa", "link": "https://stackoverflow.com/users/1585136/daniel-mikusa"}, "edited": false, "score": 0, "creation_date": 1556032649, "post_id": 55802525, "comment_id": 98295646, "body": "@DanielMikusa Is this the API to talk to CredHub service? <a href=\"https://github.com/cloudfoundry-community/go-credhub\" rel=\"nofollow noreferrer\">github.com/cloudfoundry-community/go-credhub</a>"}, {"owner": {"reputation": 10226, "user_id": 1585136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de253a68c4e3690787c1c55fc1104413?s=128&d=identicon&r=PG", "display_name": "Daniel Mikusa", "link": "https://stackoverflow.com/users/1585136/daniel-mikusa"}, "edited": false, "score": 0, "creation_date": 1556108227, "post_id": 55802525, "comment_id": 98324346, "body": "The CredHub API is here -&gt; <a href=\"https://credhub-api.cfapps.io/version/2.3/\" rel=\"nofollow noreferrer\">credhub-api.cfapps.io/version/2.3</a>. You&#39;re referencing a golang library for consuming that API."}], "tags": [], "owner": {"reputation": 311, "user_id": 318233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5c3bf699fb7b91da1ee50da6458fce4?s=128&d=identicon&r=PG", "display_name": "Lenny T", "link": "https://stackoverflow.com/users/318233/lenny-t"}, "is_accepted": false, "score": 5, "last_activity_date": 1555977400, "creation_date": 1555977400, "answer_id": 55802525, "question_id": 55799434, "link": "https://stackoverflow.com/questions/55799434/cloudfoundry-password-code-vulnerability/55802525#55802525", "title": "Cloudfoundry Password - Code vulnerability", "body": "<p>That's sample code in a README file, not the source code of a service. You could replace the hardcoded password with code to read an environment variable or command-line argument.</p>\n"}], "owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 1, "answer_count": 1, "score": -4, "last_activity_date": 1556013392, "creation_date": 1555958614, "last_edit_date": 1556013392, "question_id": 55799434, "link": "https://stackoverflow.com/questions/55799434/cloudfoundry-password-code-vulnerability", "title": "Cloudfoundry Password - Code vulnerability", "body": "<p>Below is the GO code used from <a href=\"https://github.com/cloudfoundry-community/go-cfclient\" rel=\"nofollow noreferrer\">client library</a> to connect to Cloud foundry.</p>\n\n<pre><code>c := &amp;cfclient.Config{\n    ApiAddress: \"https://x.y.z.cloud\",\n    Username:     \"admin\",\n    Password:     \"admin\",\n}\n\nclient, _ := cfclient.NewClient(c)\n</code></pre>\n\n<hr>\n\n<p>This source code becomes vulnerable due to readable password, going in source control.</p>\n\n<p>Currently the app using above code, is running outside Cloud foundry(PAAS).</p>\n\n<p>AWS cloud(IAAS) introduced the concept called <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html\" rel=\"nofollow noreferrer\">roles</a> that allow access without credentials.</p>\n\n<hr>\n\n<p>What is the best practice to avoid visible password in source code? Does <a href=\"https://docs.cloudfoundry.org/credhub/setup-credhub-bosh.html\" rel=\"nofollow noreferrer\">CredHub</a> credential configuration help <a href=\"https://github.com/cloudfoundry-community/go-cfclient\" rel=\"nofollow noreferrer\">client library</a> connect in secure way?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555955582, "post_id": 55798716, "comment_id": 98266510, "body": "What is go-vcr and what are you using it for?"}, {"owner": {"reputation": 177, "user_id": 872145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7cb12e5434f20ac4360d8ee64bac8cc1?s=128&d=identicon&r=PG", "display_name": "Laura", "link": "https://stackoverflow.com/users/872145/laura"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555965674, "post_id": 55798716, "comment_id": 98270466, "body": "@Adrian good question. Go-vcr (<a href=\"https://github.com/dnaeon/go-vcr\" rel=\"nofollow noreferrer\">github.com/dnaeon/go-vcr</a>) records HTTP interactions for playback. I&#39;m using it in the context of testing a Go microservice that makes calls out to another go web server where I have a function that calls out to an endpoint test2 and expects to get back data to fill struct Test2."}], "owner": {"reputation": 177, "user_id": 872145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7cb12e5434f20ac4360d8ee64bac8cc1?s=128&d=identicon&r=PG", "display_name": "Laura", "link": "https://stackoverflow.com/users/872145/laura"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1556230335, "creation_date": 1555955475, "last_edit_date": 1556230335, "question_id": 55798716, "link": "https://stackoverflow.com/questions/55798716/how-to-use-go-vcr-with-github-com-satori-go-uuid-getting-back-nil-values-for-uui", "title": "How to use go-vcr with github.com/satori/go.uuid getting back Nil values for uuid", "body": "<p>When I try to use go-vcr with structs containing uuid.UUID from github.com/satori/go.uuid I get back no values. Testing with other structs without uuid.UUID types works as expected.</p>\n\n<p>Edit: go-vcr is a go module for recording HTTP interactions to playback: <a href=\"https://github.com/dnaeon/go-vcr\" rel=\"nofollow noreferrer\">https://github.com/dnaeon/go-vcr</a></p>\n\n<p>Testing with Ginkgo and Gomega (ommitted test code for brevity)</p>\n\n<p>Go version:\ngo version go1.12 darwin/amd64</p>\n\n<pre><code>type Test2 struct {\n    ID          uuid.UUID `json:\"id\"`\n    Name        string    `json:\"name\"`\n    Description string    `json:\"description\"`\n}\n</code></pre>\n\n<pre><code>func (s *UserService) Test2() *Test2 {\n    url := fmt.Sprintf(\"%v:%v/test\", s.ServiceHost, s.ServicePort)\n    var client = &amp;http.Client{Timeout: 10 * time.Second}\n    req, err := http.NewRequest(\"GET\", url, nil)\n    req.Header.Add(\"Content-Type\", \"application/json\")\n    req.Header.Add(\"Authorization\", fmt.Sprintf(\"Bearer %s\", s.ServiceToken))\n    resp, err := client.Do(req)\n    if err != nil {\n        return nil\n    }\n    defer resp.Body.Close()\n\n    var t Test2\n    json.NewDecoder(resp.Body).Decode(&amp;t)\n    return &amp;t\n}\n</code></pre>\n\n<p>Fixture:</p>\n\n<pre><code>---\nversion: 1\ninteractions:\n- request:\n    body: \"\"\n    form: {}\n    headers:\n      Authorization:\n      - Bearer 123abc\n      Content-Type:\n      - application/json\n    url: http://localhost:8080/test2\n    method: GET\n  response:\n    body: |\n      {\"id\":\"5600966e-4ad6-4f79-8e01-8db13ba5c212\",\"name\":\"Foo\",\"description\":\"Bar\"}\n    headers:\n      Content-Length:\n      - \"79\"\n      Content-Type:\n      - application/json\n      Date:\n      - Fri, 19 Apr 2019 18:49:03 GMT\n    status: 200 OK\n    code: 200\n    duration: \"\"\n</code></pre>\n\n<p>Test code:</p>\n\n<pre><code>    us := UserService{\n            ServiceHost:  \"http://localhost\",\n            ServicePort:  8080,\n            ServiceToken: \"123abc\",\n    }\n    url = fmt.Sprintf(\"%v:%v/test\", us.ServiceHost, us.ServicePort)\n    req, err = http.NewRequest(\"GET\", url, nil)\n    Expect(err).To(BeNil())\n    req.Header.Add(\"Content-Type\", \"application/json\")\n    req.Header.Add(\"Authorization\", fmt.Sprintf(\"Bearer %s\", us.ServiceToken))\n    resp, err = client.Do(req)\n    Expect(err).To(BeNil())\n    defer resp.Body.Close()\n    t := us.Test()\n    Expect(t.Description).To(Equal(\"Bar\"))\n\n    r, err = recorder.New(\"fixtures/test2\")\n    Expect(err).To(BeNil())\n    defer r.Stop()\n\n    client = &amp;http.Client{\n       Transport: r,\n    }\n\n    url = fmt.Sprintf(\"%v:%v/test2\", us.ServiceHost, us.ServicePort)        \n    req, err = http.NewRequest(\"GET\", url, nil)\n    Expect(err).To(BeNil())\n    req.Header.Add(\"Content-Type\", \"application/json\")\n    req.Header.Add(\"Authorization\", fmt.Sprintf(\"Bearer %s\", us.ServiceToken))\n    resp, err = client.Do(req)\n    Expect(err).To(BeNil())\n    defer resp.Body.Close()\n    t2 := us.Test2()\n\n       iDString := \"5600966e-4ad6-4f79-8e01-8db13ba5c212\"\n    id, err := uuid.FromString(iDString)\n    Expect(err).To(BeNil())\n    Expect(t2.ID).To(Equal(id))\n</code></pre>\n\n<pre><code>Fails with\n\n   \ufffd[91mExpected\n          &lt;uuid.UUID&gt;: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n      to equal\n          &lt;uuid.UUID&gt;: [86, 0, 150, 110, 74, 214, 79, 121, 142, 1, 141, 177, 59, 165, 194,\n</code></pre>\n\n<p>Edit: Still interested in why this doesn't work, but ended up going with a different HTTP Record playback library that doesn't have this issue <a href=\"https://github.com/ad2games/vcr-go\" rel=\"nofollow noreferrer\">https://github.com/ad2games/vcr-go</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1555955479, "post_id": 55798658, "comment_id": 98266458, "body": "<code>gdo</code> is not in the string <code>kinGDOm</code>, and this code would not match that. If you need to match whole words, why not use a regex?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1555955498, "post_id": 55798658, "comment_id": 98266468, "body": "That&#39;s exactly what <code>Contains</code> does. If you want to search for a word, you need to define what &quot;word&quot; means in your context - should &quot;self&quot; match &quot;self-healing&quot;? Should it match &quot;self&quot; at the start or end of the file? Start or end of a line? What about at the end of a sentence, like &quot;self.&quot; or &quot;self?&quot; or &quot;self!&quot;? Computers have no internal concept of &quot;words&quot;, so when you search for a string within another string, you get exactly what you&#39;re seeing. Computers are very literal."}, {"owner": {"reputation": 4171, "user_id": 3258698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68f432d577e5550e36ec267b85884364?s=128&d=identicon&r=PG", "display_name": "hbejgel", "link": "https://stackoverflow.com/users/3258698/hbejgel"}, "edited": false, "score": 2, "creation_date": 1555955741, "post_id": 55798658, "comment_id": 98266580, "body": "You might want to use a regex instead and look for the pattern <code>\\bgdo\\b</code> since that takes into consideration word boundaries such as periods and line breaks - <a href=\"https://golang.org/pkg/regexp/\" rel=\"nofollow noreferrer\">golang.org/pkg/regexp</a>"}, {"owner": {"reputation": 41, "user_id": 11132752, "user_type": "registered", "profile_image": "https://graph.facebook.com/2625046644176792/picture?type=large", "display_name": "Kevin Olofson", "link": "https://stackoverflow.com/users/11132752/kevin-olofson"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1555970042, "post_id": 55798658, "comment_id": 98271904, "body": "uhm yes it is....kingdom....kin gdo m @JimB"}, {"owner": {"reputation": 41, "user_id": 11132752, "user_type": "registered", "profile_image": "https://graph.facebook.com/2625046644176792/picture?type=large", "display_name": "Kevin Olofson", "link": "https://stackoverflow.com/users/11132752/kevin-olofson"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555970383, "post_id": 55798658, "comment_id": 98271995, "body": "@Adrian yes, but how would that be implemented. Easier said than done."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1555971024, "post_id": 55798658, "comment_id": 98272137, "body": "<code>&quot;dom&quot;</code> != <code>&quot;DOM&quot;</code>, which is what you have in your original question. As for implementation, why isn&#39;t it possible to use a regex?  The regex word boundary might work for enough situations, and if it doesn&#39;t, then you need to iterate over all the conditions that <i>you</i> decode, as Adrian explained."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1555987405, "post_id": 55798658, "comment_id": 98275411, "body": "The &quot;DOM&quot; looks like just a typographical way to highlight that it&#39;s matching the text &quot;dom&quot; inside &quot;kingdom&quot; @JimB"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556032006, "post_id": 55798658, "comment_id": 98295177, "body": "@KevinOlofson it&#39;s pretty easy to implement, but as I noted in my first comment, <i>before you can implement anything you need to define specifically what you mean by &quot;word&quot;</i>. Computers have no concept of a linguistic word. You have to define what that means in your use case, then you can implement it."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1556031920, "post_id": 55803570, "comment_id": 98295117, "body": "Note that this won&#39;t work for general corpus text because &quot;word&quot; is more complicated and word boundaries may include various whitespace and punctuation characters."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556033592, "post_id": 55803570, "comment_id": 98296179, "body": "Considering that the input is <code>words.txt</code>, this is probably fine @Adrian. It&#39;ll also work for unicode whitespace, although not for <code>this is &quot;word&quot;</code>, but that wasn&#39;t part of the question/confusion."}], "tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": false, "score": 0, "last_activity_date": 1555987626, "last_edit_date": 1555987626, "creation_date": 1555987316, "answer_id": 55803570, "question_id": 55798658, "link": "https://stackoverflow.com/questions/55798658/how-can-i-check-if-a-text-file-contains-a-whole-word/55803570#55803570", "title": "How can I check if a text file contains a whole word?", "body": "<p><code>strings.Contains()</code> reports if a substrings is contained within a string. It doesn't check for word boundaries, so the behaviour you're seeing is expected.</p>\n\n<p>What you want instead is to recognize every word as a word. There is already the <a href=\"https://golang.org/pkg/strings/#Fields\" rel=\"nofollow noreferrer\"><code>strings.Fields()</code></a> function to split text by whitespace. A simple implementation might look like:</p>\n\n<pre><code>func main() {\n    source := `\nhello\nworld\nkingdom\nfoo\n`\n    check := \"gdo\"\n    words := strings.Fields(strings.ToLower(source))\n\n    for _, w := range words {\n        if w == check {\n            fmt.Println(\"found\", check)\n            break\n        }\n    }\n}\n</code></pre>\n\n<p>I used <code>strings.Fields()</code> because I don't know the contents of your <code>words.txt</code> file. You can also use <code>strings.Split()</code> if you know the separator is always a single newline or single space.</p>\n\n<p>This will be slow if you're doing a lot of lookups, since it's looping over the <code>words</code> array for every lookup. A faster method would be to store it in a map:</p>\n\n<pre><code>func main() {\n    source := `\nhello\nworld\nkingdom\nfoo\n`\n    check := \"gdo\"\n\n    words := make(map[string]struct{})\n    for _, w := range strings.Fields(strings.ToLower(source)) {\n        words[w] = struct{}{}\n    }\n\n    _, ok := words[check]\n    if ok {\n        fmt.Println(\"found\", check)\n    }\n}\n</code></pre>\n\n<p>If you're doing just a single lookup the first method will be faster (as this map method will always need to loop the full array at least once to build the map).</p>\n\n<p>I used the somewhat strange looking empty struct for the map value as this doesn't allocate any memory (<code>words[w] = true</code> would).</p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556031944, "post_id": 55805520, "comment_id": 98295128, "body": "Note that this won&#39;t work for general corpus text because &quot;word&quot; is more complicated and word boundaries may include various whitespace and punctuation characters."}, {"owner": {"reputation": 935, "user_id": 10391130, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CBVYnKKBv5w/AAAAAAAAAAI/AAAAAAAAAEc/bw1Ub6elbng/photo.jpg?sz=128", "display_name": "Madhuka Wickramapala", "link": "https://stackoverflow.com/users/10391130/madhuka-wickramapala"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556122291, "post_id": 55805520, "comment_id": 98333330, "body": "Appreciate your insight but since the question does not mention such specifics, why complicate things."}], "tags": [], "owner": {"reputation": 935, "user_id": 10391130, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CBVYnKKBv5w/AAAAAAAAAAI/AAAAAAAAAEc/bw1Ub6elbng/photo.jpg?sz=128", "display_name": "Madhuka Wickramapala", "link": "https://stackoverflow.com/users/10391130/madhuka-wickramapala"}, "is_accepted": false, "score": 0, "last_activity_date": 1556001163, "creation_date": 1556001163, "answer_id": 55805520, "question_id": 55798658, "link": "https://stackoverflow.com/questions/55798658/how-can-i-check-if-a-text-file-contains-a-whole-word/55805520#55805520", "title": "How can I check if a text file contains a whole word?", "body": "<p>Here is a simple solution. You can convert s into a string array. Then loop through the array to check if it contains the word.</p>\n\n<pre><code>var word = strings.ToLower(string(a))\n\n// read the whole file at once\nb, err := ioutil.ReadFile(\"words.txt\")\nif err != nil {\n    panic(err)\n}\ns := string(b)\n\n// convert the string into a string array (words)\n\ncontent := strings.Split(s, \" \")\n\ncontains := false\n\nfor i:=0 ; i&lt;len(content) ; i++ {\n    if content[i] == word {\n        contains = true\n        break\n    }\n}\n\n// Check whether s contains substring text\nif contains {\n    fmt.Println(\"this is a word \", word)\n} else {\n    fmt.Println(\"this isn't a word \", word)\n}\n</code></pre>\n\n<p>No need to complicate things. Have a great day :)</p>\n"}, {"tags": [], "owner": {"reputation": 2248, "user_id": 2114557, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Lgbfy.jpg?s=128&g=1", "display_name": "Zuko", "link": "https://stackoverflow.com/users/2114557/zuko"}, "is_accepted": false, "score": 0, "last_activity_date": 1608060595, "creation_date": 1608060595, "answer_id": 65312478, "question_id": 55798658, "link": "https://stackoverflow.com/questions/55798658/how-can-i-check-if-a-text-file-contains-a-whole-word/65312478#65312478", "title": "How can I check if a text file contains a whole word?", "body": "<p>If case sensitivity isn't priority, you can use the suffixArray from <a href=\"https://golang.org/pkg/index/suffixarray/\" rel=\"nofollow noreferrer\"><code>index/suffixarray</code></a> package.</p>\n<pre><code> b, err := ioutil.ReadFile(&quot;words.txt&quot;)\n if err != nil {\n    panic(err)\n }\n \n word := &quot;gdo&quot;\n suffix := suffixarray.New(b) // accepts []byte\n indexList := suffix.Lookup([]byte(word), -1)\n if len(indexList) == 0 {\n    fmt.Println(&quot;this isn't a word &quot;, word)\n    return\n }\n\n s := string(b)\n // loop through the word indices\n for _, idx := range indexList {\n    fmt.Println(&quot;this is a word &quot;, string(s[idx:idx+len(word)]))\n }\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 11132752, "user_type": "registered", "profile_image": "https://graph.facebook.com/2625046644176792/picture?type=large", "display_name": "Kevin Olofson", "link": "https://stackoverflow.com/users/11132752/kevin-olofson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 560, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1608060595, "creation_date": 1555955214, "last_edit_date": 1555987751, "question_id": 55798658, "link": "https://stackoverflow.com/questions/55798658/how-can-i-check-if-a-text-file-contains-a-whole-word", "title": "How can I check if a text file contains a whole word?", "body": "<p>I am trying to check if a text file contains a certain word. However it will return true even for some letters in a string. For example:</p>\n\n<p>Entered string: gdo</p>\n\n<p>Computer found: kin<strong>gdo</strong>m</p>\n\n<pre><code>var word = strings.ToLower(string(a))\n\n// read the whole file at once\nb, err := ioutil.ReadFile(\"words.txt\")\nif err != nil {\n    panic(err)\n}\ns := string(b)\n\n// Check whether s contains substring text\nif strings.Contains(s, word) == true {\n    fmt.Println(\"this is a word \", word)\n} else {\n    fmt.Println(\"this isn't a word \", word)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1555954044, "post_id": 55798274, "comment_id": 98265806, "body": "What is the <i>exact</i> error you&#39;re seeing? What happens when you copy+paste the string from the <code>Lstat</code> arguments and <code>ls -l</code> it from the cli?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1555956556, "post_id": 55798274, "comment_id": 98266910, "body": "You say you are reading user input, but your code doesn&#39;t reflect that. Is it really failing when you hardcode the filename?"}], "answers": [{"tags": [], "owner": {"reputation": 1104, "user_id": 11359504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8612ae78a3ab1ddc7b4bec4e317c328?s=128&d=identicon&r=PG&f=1", "display_name": "Khalid Ali", "link": "https://stackoverflow.com/users/11359504/khalid-ali"}, "is_accepted": false, "score": 0, "last_activity_date": 1555955464, "creation_date": 1555955464, "answer_id": 55798714, "question_id": 55798274, "link": "https://stackoverflow.com/questions/55798274/cant-find-file-or-directory-on-disk-that-do-exists/55798714#55798714", "title": "Can&#39;t find file or directory on disk that do exists", "body": "<p>The <a href=\"https://golang.org/src/os/stat.go?s=642:683#L10\" rel=\"nofollow noreferrer\">docs</a> says:</p>\n\n<blockquote>\n  <p><strong>Lstat</strong> returns a FileInfo describing the named file. If the file is a symbolic link, the returned FileInfo describes the symbolic link. Lstat makes no attempt to follow the link. If there is an error, it will be of type *PathError.</p>\n</blockquote>\n\n<p><strong>Here's an example you could try:</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    desc, err := os.Lstat(\"/Users/me/Documents/test.sql\")\n    if err != nil {\n        // prints the error and stop\n        log.Fatal(err)\n    }\n    // prints the filename\n    fmt.Println(desc.Name())\n}\n\n</code></pre>\n"}], "owner": {"reputation": 76, "user_id": 8386973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87b53ff9a31dc279fe3e604c1b8de11d?s=128&d=identicon&r=PG&f=1", "display_name": "ImJezz", "link": "https://stackoverflow.com/users/8386973/imjezz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1555955464, "creation_date": 1555953409, "question_id": 55798274, "link": "https://stackoverflow.com/questions/55798274/cant-find-file-or-directory-on-disk-that-do-exists", "title": "Can&#39;t find file or directory on disk that do exists", "body": "<p>I am currently investigating go to learn more about it, but I've found my way into a wall that I can't break through. What I am trying to do is take user input for a directory or file, etc: /Users/me/Documents/test.sql and copy it to another directory, etc: /usr/local/share/myprogram</p>\n\n<p>The problems is that os.Lstat does not find it with anything I try...</p>\n\n<p>I know that test.sql exists, if I use open /Users/me/Documents/test.sql in the terminal, that Go doesn't say it can't find I manage to open it, so it is there.</p>\n\n<p>Why is this happening? Is this something with go and the path is set to only find files in the working directory? And how do I overcome this?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>os.Lstat(\"/Users/me/Documents/test.sql\")\n</code></pre>\n\n<p>I've also tried using filepath</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>toPath, _ := filepath.Abs(\"/Users/me/Documents/test.sql\")\nos.Lstat(toPath)\n</code></pre>\n\n<p>I expect this file to be found, but it isn't</p>\n"}, {"tags": ["go", "server", "grpc", "goroutine", "grpc-go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1555951769, "post_id": 55797865, "comment_id": 98264788, "body": "You haven&#39;t provided an example of the problematic code, but if you&#39;re not waiting for your goroutine to return in <code>main</code>, you&#39;re going to exit the program before it completes."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1555952005, "post_id": 55797865, "comment_id": 98264908, "body": "@JimB the goroutine is just running the server, and <code>main</code> doesn&#39;t return until <code>GracefulStop</code> finishes, so I don&#39;t see a problem there. @agyeya, in answer to your question, it takes no time. When <code>main</code> returns (at the end of the function), the process exits."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555952092, "post_id": 55797865, "comment_id": 98264947, "body": "@Adrian: they said &quot;this works fine&quot;, it&#39;s the non-working case which we appear to not have. This sounds like the basic &quot;main exits before goroutines&quot; problem."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555952212, "post_id": 55797865, "comment_id": 98264994, "body": "Oh I see what you&#39;re saying - yes, it would be a problem in the hypothetical (but not shown) code."}, {"owner": {"reputation": 452, "user_id": 3934499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0005554c3b863a1bb17a6aca5a40acfa?s=128&d=identicon&r=PG&f=1", "display_name": "agyeya", "link": "https://stackoverflow.com/users/3934499/agyeya"}, "edited": false, "score": 0, "creation_date": 1556007475, "post_id": 55797865, "comment_id": 98281562, "body": "Added the problematic code. Just trying to understand the problem with it, i got my use case satisfied with the other code"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556018227, "post_id": 55797865, "comment_id": 98287065, "body": "You\u2019re not waiting for closeDbConnections to run, so it shouldn\u2019t be surprising that it doesn\u2019t run."}], "answers": [{"comments": [{"owner": {"reputation": 452, "user_id": 3934499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0005554c3b863a1bb17a6aca5a40acfa?s=128&d=identicon&r=PG&f=1", "display_name": "agyeya", "link": "https://stackoverflow.com/users/3934499/agyeya"}, "edited": false, "score": 0, "creation_date": 1555992693, "post_id": 55800690, "comment_id": 98276356, "body": "Hi, I have added the problematic code. Let me know if there seems to be an gap in my understanding regarding goroutines execution here."}, {"owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "reply_to_user": {"reputation": 452, "user_id": 3934499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0005554c3b863a1bb17a6aca5a40acfa?s=128&d=identicon&r=PG&f=1", "display_name": "agyeya", "link": "https://stackoverflow.com/users/3934499/agyeya"}, "edited": false, "score": 0, "creation_date": 1556003702, "post_id": 55800690, "comment_id": 98279854, "body": "@agyeya I would suggest you to study code sample that I provided above and compare it with yours. This is how we do it in our backend. This approach is well tested and reliable."}], "tags": [], "owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "is_accepted": false, "score": 2, "last_activity_date": 1555964872, "creation_date": 1555964872, "answer_id": 55800690, "question_id": 55797865, "link": "https://stackoverflow.com/questions/55797865/behavior-of-server-gracefulstop-in-golang/55800690#55800690", "title": "Behavior of server.GracefulStop() in golang", "body": "<p>I'm not sure about your question (please clarify it), but I would suggest you to refactor your <code>main</code> in this way:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n\n   // ...\n\n   errChan := make(chan error)\n   stopChan := make(chan os.Signal)\n\n   // bind OS events to the signal channel\n   signal.Notify(stopChan, syscall.SIGTERM, syscall.SIGINT)\n\n   // run blocking call in a separate goroutine, report errors via channel\n   go func() {\n        if err := grpcServer.Serve(lis); err != nil {\n            errChan &lt;- err\n        }\n    }()\n\n   // terminate your environment gracefully before leaving main function\n   defer func() {\n      server.GracefulStop()\n      closeDbConnections()\n   }()\n\n   // block until either OS signal, or server fatal error\n   select {\n      case err := &lt;-errChan:\n          log.Printf(\"Fatal error: %v\\n\", err) \n      case &lt;-stopChan:\n   }\n</code></pre>\n\n<p>I don't think it's a good idea to mix system events and server errors, like you do in your example: in case if <code>Serve</code> fails, you just ignore the error and emit system event, which actually didn't happen. Try another approach when there are two transports (channels) for two different kind of event that cause process termination.</p>\n"}], "owner": {"reputation": 452, "user_id": 3934499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0005554c3b863a1bb17a6aca5a40acfa?s=128&d=identicon&r=PG&f=1", "display_name": "agyeya", "link": "https://stackoverflow.com/users/3934499/agyeya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1724, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1555992995, "creation_date": 1555951474, "last_edit_date": 1555992995, "question_id": 55797865, "link": "https://stackoverflow.com/questions/55797865/behavior-of-server-gracefulstop-in-golang", "title": "Behavior of server.GracefulStop() in golang", "body": "<p>I have a gRPC server, and I have implemented graceful shutdown of my gRPC server something like this</p>\n\n<pre><code>fun main() {\n    //Some code\n    term := make(chan os.Signal)\n    go func() {\n            if err := grpcServer.Serve(lis); err != nil {\n                term &lt;- syscall.SIGINT\n            }\n        }()\n\n    signal.Notify(term, syscall.SIGTERM, syscall.SIGINT)\n    &lt;-term\n    server.GracefulStop()\n    closeDbConnections()\n}\n</code></pre>\n\n<p>This works fine.\nIf instead I write the <code>grpcServer.Serve()</code> logic in main goroutine and instead put the shutdown handler logic into another goroutine, statements after <code>server.GracefulStop()</code> usually do not execute. Some DbConnections are closed, if <code>closeDbConnections()</code> is executed at all.</p>\n\n<p><code>server.GracefulStop()</code> is a blocking call. Definitely <code>grpcServer.Serve()</code> finishes before <code>server.GracefulStop()</code> completes. So, how long does main goroutine take to stop after this call returns?</p>\n\n<p>The problematic code</p>\n\n<pre><code>func main() {\n    term := make(chan os.Signal)\n    go func() {\n        signal.Notify(term, syscall.SIGTERM, syscall.SIGINT)\n        &lt;-term\n        server.GracefulStop()\n        closeDbConnections()\n    }()\n    if err := grpcServer.Serve(lis); err != nil {\n        term &lt;- syscall.SIGINT\n    }\n}\n</code></pre>\n\n<p>This case does not work as expected. After <code>server.GracefulStop()</code> is done, <code>closeDbConnections()</code> may or may not run (usually does not run to completion). I was testing the later case by sending SIGINT by hitting Ctrl-C from my terminal. </p>\n\n<p>Can someone please explain this behavior?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555937856, "post_id": 55794775, "comment_id": 98258393, "body": "Can you define &quot;the behavior is expected&quot; and &quot;it doesn&#39;t work&quot;? What is the specific problem you&#39;re having?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1555937965, "post_id": 55794775, "comment_id": 98258438, "body": "You rarely ever want a pointer to an interface. Your code here also never uses <code>*[]interface{}</code>. The only pointer you have here is <code>&amp;i</code> which is <code>*interface{}</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1555939237, "post_id": 55794775, "comment_id": 98258959, "body": "If by <code>*[]interface{}</code> you actually mean <code>*[]database.Warehouses</code> (which are distinct types), then yes, you need to use that. You always must decode into a pointer, so the correct solution here is to use <code>&amp;test</code>."}], "answers": [{"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": true, "score": 1, "last_activity_date": 1555938992, "creation_date": 1555938992, "answer_id": 55795020, "question_id": 55794775, "link": "https://stackoverflow.com/questions/55794775/weird-behavior-using-interface-parameters/55795020#55795020", "title": "Weird behavior using interface parameters", "body": "<p>It is because a slice is already a pointer (<a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Slice_types</a>).</p>\n\n<p>So to set a pointer to a slice is setting a pointer to a pointer. So just remeber if you are dealing with slices they are pointers to arrays. </p>\n\n<p>More information how the slices are used as a pointer are here: <a href=\"https://golang.org/doc/effective_go.html#slices\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html#slices</a></p>\n"}], "owner": {"reputation": 11, "user_id": 11394828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3724657aea0e092c0890704fad586c2?s=128&d=identicon&r=PG&f=1", "display_name": "Ogromny", "link": "https://stackoverflow.com/users/11394828/ogromny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 55795020, "answer_count": 1, "score": -4, "last_activity_date": 1555938992, "creation_date": 1555937728, "last_edit_date": 1555937975, "question_id": 55794775, "link": "https://stackoverflow.com/questions/55794775/weird-behavior-using-interface-parameters", "title": "Weird behavior using interface parameters", "body": "<p>When i call a function with an <code>interface{}</code> parameters with a <code>*[]interface{}</code>, the behavior is expected, but when I call the function with <code>[]interface{}</code>, and then use the parameter with <code>&amp;</code> it doesn't work why ?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func routeWarehouses(engine *gin.Engine) {\n    var test []database.Warehouses\n    router.GET(\"/\", genericReads(test))\n}\n\nfunc genericReads(i interface{}) func(c *gin.Context) {\n    return func(c *gin.Context) {\n        // When i call genericReads with `test`\n        //println(reflect.TypeOf(i).Kind()) // Slice\n        //println(reflect.TypeOf(i).Elem().Kind()) // Struct\n\n        // When i call genericReads `&amp;test`\n        //println(reflect.TypeOf(i).Kind()) // Ptr\n        //println(reflect.TypeOf(i).Elem().Kind()) // Slice\n        //println(reflect.TypeOf(i).Elem().Elem().Kind()) // Struct\n\n        // When I call database.Reads with `i` ( passed as `&amp;test` ), It's works, I get all rows of the Model otherwise\n        // When I call database.Reads with `&amp;i` ( passed as `test` ), It doesn't work ( I get `unsupported destination, should be slice or struct` )\n        if err := database.Reads(&amp;i, database.Warehouses{}); err != nil {\n            utils.R500(c, err.Error())\n            return\n        }\n\n        c.JSON(http.StatusOK, i)\n    }\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Reads(i interface{}, column ColumnSpell) error {\n    if err := DB.Debug().Find(i).Error; err != nil {\n        return errors.New(fmt.Sprintf(\"Cannot reads %s: %s\", column.Plural(), err.Error()))\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>PS: Maybe this come directly from Gorm ?</p>\n"}, {"tags": ["azure", "go", "kubernetes"], "owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 138, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1555933275, "creation_date": 1555933275, "question_id": 55793837, "link": "https://stackoverflow.com/questions/55793837/using-kubernetes-client-go-gives-a-azure-compiler-error", "title": "Using Kubernetes-client/go gives a Azure compiler error", "body": "<p>Kubernetes-client/go - trying <a href=\"https://github.com/kubernetes-client/go/blob/master/examples/create-pod/main.go\" rel=\"nofollow noreferrer\">this</a> example</p>\n\n<p>Note: I am using go.mod file</p>\n\n<p>Do you know why I get this Azure error?</p>\n\n<pre><code> go run .\n# github.com/kubernetes-client/go/kubernetes/config\n../../gopath/pkg/mod/github.com/kubernetes-client/go@v0.0.0-20190402190921-ee48eb4f6eed/kubernetes/config/azure.go:63:3: cannot use l.user.AuthProvider.Config[\"expires-in\"] (type string) as type json.Number in field value\n../../gopath/pkg/mod/github.com/kubernetes-client/go@v0.0.0-20190402190921-ee48eb4f6eed/kubernetes/config/azure.go:64:3: cannot use l.user.AuthProvider.Config[\"expires-in\"] (type string) as type json.Number in field value\n</code></pre>\n"}, {"tags": ["unit-testing", "go", "constants"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555934341, "post_id": 55792779, "comment_id": 98256958, "body": "If tests are important to you, there should be no problem with a solution tailored exclusively for tests."}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 4, "last_activity_date": 1555935104, "creation_date": 1555935104, "answer_id": 55794221, "question_id": 55792779, "link": "https://stackoverflow.com/questions/55792779/how-to-test-go-code-with-filepaths-defined-as-constants/55794221#55794221", "title": "How to test Go code with filepaths defined as constants", "body": "<p>This is known as <a href=\"https://en.wikipedia.org/wiki/Dependency_injection\" rel=\"nofollow noreferrer\">dependency injection</a> and is commonly used for testing. There's nothing particularly ugly about making your code more testable.</p>\n\n<p>An alternative would be to define the paths as <code>var</code>s in the package (make them private - tests live in the same package) and the tests could set these vars to something before doing the test.</p>\n"}, {"tags": [], "owner": {"reputation": 734, "user_id": 4801231, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5ca13f4ff6626c22c4c31b62f9908d1?s=128&d=identicon&r=PG&f=1", "display_name": "svetha.cvl", "link": "https://stackoverflow.com/users/4801231/svetha-cvl"}, "is_accepted": false, "score": 0, "last_activity_date": 1555947974, "creation_date": 1555947974, "answer_id": 55797055, "question_id": 55792779, "link": "https://stackoverflow.com/questions/55792779/how-to-test-go-code-with-filepaths-defined-as-constants/55797055#55797055", "title": "How to test Go code with filepaths defined as constants", "body": "<p>Your solution is fine. It's a common and recommended practice to design your code and interfaces to be testable.\nI would slightly modify your solution to prevent duplication-</p>\n\n<pre><code>func Construct(param string) MyStruct {\n    return ConstructWithPath(param, \"/default/path\")\n}\n\nfunc ConstructWithPath(param, path string) MyStruct {\n    return MyStruct {Param: param, Path: path}\n}\n</code></pre>\n\n<p>You need not export ConstructWithPath if you don't want anyone outside this package using it.</p>\n"}], "owner": {"reputation": 125, "user_id": 1980981, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/30577b84d0949e2ca204ab6fea5269ad?s=128&d=identicon&r=PG", "display_name": "LivingSilver94", "link": "https://stackoverflow.com/users/1980981/livingsilver94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 55794221, "answer_count": 2, "score": 2, "last_activity_date": 1555947974, "creation_date": 1555928195, "question_id": 55792779, "link": "https://stackoverflow.com/questions/55792779/how-to-test-go-code-with-filepaths-defined-as-constants", "title": "How to test Go code with filepaths defined as constants", "body": "<p>I'm writing tests for a project of mine, which involves fixed filepaths and base URLs. To me, the most logic way to define them is by means of public/private constants in a relevant module, but that prevents good testing practices. How can I work around this?</p>\n\n<p>I searched for a possible solution and found that I can define two constructors for a struct in need of a path: one which defines the default path, and another that accepts a custom path</p>\n\n<pre><code>func Construct(param string) MyStruct {\n    return MyStruct {Param: param, Path: \"/default/path\"}\n}\n\nfunc ConstructWithPath(param, path string) MyStruct {\n    return MyStruct {Param: param, Path: path}\n}\n</code></pre>\n\n<p>This is pretty ugly to me and it's a solution tailored exclusively for tests since the paths I'm considering are fixed and known.</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 453, "user_id": 6060482, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6898272ab810e419c2c9ca9af1e53da8?s=128&d=identicon&r=PG", "display_name": "lennard", "link": "https://stackoverflow.com/users/6060482/lennard"}, "edited": false, "score": 1, "creation_date": 1555929684, "post_id": 55792986, "comment_id": 98255139, "body": "Thanks, so much easier than Preload every related table table. Thanks for the <code>.Error</code> tip too!"}, {"owner": {"reputation": 476, "user_id": 1708040, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e0f4ab658a70ca71cf9b2cdde0d33690?s=128&d=identicon&r=PG", "display_name": "ShiftyThomas", "link": "https://stackoverflow.com/users/1708040/shiftythomas"}, "edited": false, "score": 0, "creation_date": 1556744632, "post_id": 55792986, "comment_id": 98538549, "body": "Do you know if this doing a join or another query (if using a relational db)?"}], "tags": [], "owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "is_accepted": true, "score": 8, "last_activity_date": 1555929284, "creation_date": 1555929284, "answer_id": 55792986, "question_id": 55792332, "link": "https://stackoverflow.com/questions/55792332/selecting-related-fields-with-gorm/55792986#55792986", "title": "Selecting related fields with GORM", "body": "<p>According to <a href=\"http://gorm.io/docs/preload.html#Auto-Preloading\" rel=\"noreferrer\">documentation</a>, you need to set <code>auto_preload</code> to <code>true</code> for Auto Preloading to work. So changing the line where you retrieve the user to:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>common.DB.Set(\"gorm:auto_preload\", true).First(&amp;retrivedUser, 1)\n</code></pre>\n\n<p>should give you the expected result.</p>\n\n<hr>\n\n<p>On a side note, <strong>never</strong> ignore the errors. You can always append <code>.Error</code> to almost every operation in <code>gorm</code> and check the returned error. For example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>err = common.DB.AutoMigrate(...).Error\nif err != nil {\n    // handle err\n}\n\nerr = common.DB.Create(&amp;user).Error\n// Check for err\nerr = common.DB.Set(\"gorm:auto_preload\", true).First(&amp;retrivedUser, 1).Error\n// Check for err\n</code></pre>\n"}], "owner": {"reputation": 453, "user_id": 6060482, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6898272ab810e419c2c9ca9af1e53da8?s=128&d=identicon&r=PG", "display_name": "lennard", "link": "https://stackoverflow.com/users/6060482/lennard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1710, "favorite_count": 0, "accepted_answer_id": 55792986, "answer_count": 1, "score": 7, "last_activity_date": 1556049446, "creation_date": 1555925967, "last_edit_date": 1556049446, "question_id": 55792332, "link": "https://stackoverflow.com/questions/55792332/selecting-related-fields-with-gorm", "title": "Selecting related fields with GORM", "body": "<p>I'm new to Golang coming from a python background so trying to understand the new and different concepts.\nI'm trying to create related fields and then select them from the database.</p>\n\n<p>Models:</p>\n\n<pre><code>type Company struct {\n    gorm.Model\n    Name string\n}\n\ntype CreditCard struct {\n    gorm.Model\n    Number    int\n    Company   Company\n    CompanyId uint\n}\n\ntype User struct {\n    gorm.Model\n    Name         string\n    CreditCard   CreditCard\n    CreditCardID uint\n}\n</code></pre>\n\n<p>Create tables and rows and select from db</p>\n\n<pre><code>common.DB.AutoMigrate(\n    &amp;Company{},\n    &amp;CreditCard{},\n    &amp;User{},\n)\n\nuser := User{\n    Name:       \"Alice\",\n    CreditCard: CreditCard{Number: 123456, Company: Company{Name: \"Bank A\"}},\n}\n\ncommon.DB.Create(&amp;user)\n\nvar retrivedUser User\nvar creditCard CreditCard\nvar company Company\ncommon.DB.First(&amp;retrivedUser, 1).Related(&amp;creditCard).Related(&amp;company)\n\nfmt.Println(\"user name\", retrivedUser.Name)\nfmt.Println(\"creditcard number\", retrivedUser.CreditCard.Number)\nfmt.Println(\"creditcard number related\", creditCard.Number)\nfmt.Println(\"company name\", retrivedUser.CreditCard.Company.Name)\nfmt.Println(\"company name related\", company.Name)\n</code></pre>\n\n<p>This prints:</p>\n\n<pre><code>user name Alice\ncreditcard number 0\ncreditcard number related 123456\ncompany name \ncompany name related \n</code></pre>\n\n<p>Two questions:</p>\n\n<ol>\n<li>Why do I need to select <code>Related</code> creditCard to a separate variable instead of using the dot notation?</li>\n<li>I get error <code>invalid association []</code> on the <code>Related</code> company, and neither dot notation or Related work. How do I get this back?</li>\n</ol>\n"}, {"tags": ["go", "goquery"], "comments": [{"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 1, "creation_date": 1555935232, "post_id": 55792071, "comment_id": 98257325, "body": "Why do you say you can&#39;t pass <code>doc</code> to <code>linkScrape</code>?"}, {"owner": {"reputation": 33, "user_id": 11010059, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9qndn0eocMc/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMI8OZydgialcWQkwbx1MP9WAIasQ/mo/photo.jpg?sz=128", "display_name": "\u0410\u0440\u0442\u0435\u043c \u0411\u043e\u043b\u043e\u0442\u043e\u0432", "link": "https://stackoverflow.com/users/11010059/%d0%90%d1%80%d1%82%d0%b5%d0%bc-%d0%91%d0%be%d0%bb%d0%be%d1%82%d0%be%d0%b2"}, "reply_to_user": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1555936524, "post_id": 55792071, "comment_id": 98257859, "body": "@EliBendersky  cannot use &#39;doc&#39; as type goquery.Document"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 1, "creation_date": 1555936987, "post_id": 55792071, "comment_id": 98258036, "body": "Could it be because <code>doc</code> is a <code>*Document</code>? (pointer type) What&#39;s the signature/declaration of <code>linkScrape</code>?"}, {"owner": {"reputation": 33, "user_id": 11010059, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9qndn0eocMc/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMI8OZydgialcWQkwbx1MP9WAIasQ/mo/photo.jpg?sz=128", "display_name": "\u0410\u0440\u0442\u0435\u043c \u0411\u043e\u043b\u043e\u0442\u043e\u0432", "link": "https://stackoverflow.com/users/11010059/%d0%90%d1%80%d1%82%d0%b5%d0%bc-%d0%91%d0%be%d0%bb%d0%be%d1%82%d0%be%d0%b2"}, "reply_to_user": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1555938598, "post_id": 55792071, "comment_id": 98258688, "body": "@EliBendersky linkScrape(domHtml goquery.Document)  string{}"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1555938664, "post_id": 55792071, "comment_id": 98258716, "body": "I added an answer - please take a look"}, {"owner": {"reputation": 33, "user_id": 11010059, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9qndn0eocMc/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMI8OZydgialcWQkwbx1MP9WAIasQ/mo/photo.jpg?sz=128", "display_name": "\u0410\u0440\u0442\u0435\u043c \u0411\u043e\u043b\u043e\u0442\u043e\u0432", "link": "https://stackoverflow.com/users/11010059/%d0%90%d1%80%d1%82%d0%b5%d0%bc-%d0%91%d0%be%d0%bb%d0%be%d1%82%d0%be%d0%b2"}, "reply_to_user": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1555939094, "post_id": 55792071, "comment_id": 98258901, "body": "@EliBendersky Thank you.  I need to learn to read English."}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 0, "last_activity_date": 1555938559, "creation_date": 1555938559, "answer_id": 55794943, "question_id": 55792071, "link": "https://stackoverflow.com/questions/55792071/how-to-get-dom-html-in-go/55794943#55794943", "title": "How to get DOM HTML in Go", "body": "<p>Here's the basic <code>goquery</code> example adjusted to your use case:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"strings\"\n\n    \"github.com/PuerkitoBio/goquery\"\n)\n\nfunc findHeader(d *goquery.Document) string {\n    header := d.Find(\"h1\").Text()\n    return header\n}\n\nfunc main() {\n    // create from a string\n    data := `\n&lt;html&gt;\n    &lt;head&gt;\n        &lt;title&gt;My document&lt;/title&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;h1&gt;Header&lt;/h1&gt;\n    &lt;/body&gt;\n&lt;/html&gt;`\n\n    doc, err := goquery.NewDocumentFromReader(strings.NewReader(data))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(findHeader(doc))\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 11010059, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9qndn0eocMc/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMI8OZydgialcWQkwbx1MP9WAIasQ/mo/photo.jpg?sz=128", "display_name": "\u0410\u0440\u0442\u0435\u043c \u0411\u043e\u043b\u043e\u0442\u043e\u0432", "link": "https://stackoverflow.com/users/11010059/%d0%90%d1%80%d1%82%d0%b5%d0%bc-%d0%91%d0%be%d0%bb%d0%be%d1%82%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 412, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555938559, "creation_date": 1555924776, "last_edit_date": 1555935198, "question_id": 55792071, "link": "https://stackoverflow.com/questions/55792071/how-to-get-dom-html-in-go", "title": "How to get DOM HTML in Go", "body": "<p>I'm writing a parser HTML in Go. I need to get HTML and pass it to another function.    </p>\n\n<p>I did it so:</p>\n\n<ol>\n<li>Can`t pass \"doc\" to another function</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>receivedURL, err := http.Get(\"http://lavillitacafe.com/\")\ndoc, err := goquery.NewDocumentFromReader(receivedURL.Body)\n//\"linkScrape\" this is another function\ncontactURL := linkScrape(doc)\n</code></pre>\n\n<p>and</p>\n\n<ol start=\"2\">\n<li>HTML is transferred in parts to another function.</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>resp, err := http.Get(\"http://lavillitacafe.com/\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer resp.Body.Close()\n    for true {\n\n        bs := make([]byte, 1014)\n        n, err := resp.Body.Read(bs)\n                contactURL := linkScrape(bs[:n])\n        if n == 0 || err != nil{\n            break\n        }\n    }\n</code></pre>\n\n<p>How do I do it right?</p>\n"}, {"tags": ["go", "goinstall", "go-get"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1555948193, "post_id": 55791862, "comment_id": 98263155, "body": "Are you trying to install a main package, or a dependency? If it&#39;s a <code>main</code> package, just cd into it an install it, there&#39;s nothing to <code>go get</code>. If it&#39;s a dependency, it should either already be in GOPATH, or use <code>replace</code> in <code>go.mod</code>. Packages are never referred to with a local path."}], "answers": [{"comments": [{"owner": {"reputation": 6463, "user_id": 172277, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d6fe2a20032260c86e83f2898b3151af?s=128&d=identicon&r=PG", "display_name": "AsTeR", "link": "https://stackoverflow.com/users/172277/aster"}, "edited": false, "score": 0, "creation_date": 1555925675, "post_id": 55791960, "comment_id": 98253634, "body": "but this will be skipping any dependency installation if I am correct."}], "tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": false, "score": 0, "last_activity_date": 1555924323, "creation_date": 1555924323, "answer_id": 55791960, "question_id": 55791862, "link": "https://stackoverflow.com/questions/55791862/go-get-installation-from-a-local-fork/55791960#55791960", "title": "go get installation from a local fork", "body": "<p>As far as I know you can't do this with <code>go get</code>, bur you can copy the directory in to GOPATH manually. If you forked <code>example.com/somepackage</code> then copy <code>/Users/me/workspaces/go/somepackage</code> to <code>~/go/src/example.com/somepackage</code> or <code>./vendor/example.com/somepackage</code>.</p>\n\n<p>That being said, the best solution is usually to host the forked code somewhere, and then use that import path.  Decency tools such as dep and modules support fetching a different origin for packages.</p>\n"}, {"tags": [], "owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "is_accepted": false, "score": 0, "last_activity_date": 1555927709, "last_edit_date": 1555927709, "creation_date": 1555925489, "answer_id": 55792222, "question_id": 55791862, "link": "https://stackoverflow.com/questions/55791862/go-get-installation-from-a-local-fork/55792222#55792222", "title": "go get installation from a local fork", "body": "<p>I could be wrong and maybe there is a workaround exists</p>\n\n<p>Go documentantion on <a href=\"https://golang.org/cmd/go/#hdr-Remote_import_paths\" rel=\"nofollow noreferrer\">cmd/go/#hdr-Remote_import_paths</a> says:</p>\n\n<blockquote>\n  <p>The supported version control systems are: </p>\n\n<pre><code>Bazaar      .bzr\nFossil      .fossil\nGit         .git\nMercurial   .hg\nSubversion  .svn\n</code></pre>\n</blockquote>\n\n<p>And a later:</p>\n\n<blockquote>\n  <p>For example,</p>\n</blockquote>\n\n<p><code>import \"example.org/pkg/foo\"</code></p>\n\n<blockquote>\n  <p>will result in the following requests:</p>\n</blockquote>\n\n<pre><code>https://example.org/pkg/foo?go-get=1 (preferred)\nhttp://example.org/pkg/foo?go-get=1  (fallback, only with -insecure)\n</code></pre>\n\n<p>So I suppose that <code>go get</code> never looks in filesystem repos.</p>\n\n<p>Need to investigate source code of <code>go get</code> to be sure.</p>\n\n<p>I will be glad if someone will prove that I am incorrect in this question.</p>\n\n<h2>UPDATE</h2>\n\n<p>Maybe I'm mistaken but I suppose that all abilities of <code>go get</code> to work with VCSs are here: <a href=\"https://github.com/golang/go/blob/master/src/cmd/go/internal/get/vcs.go\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/cmd/go/internal/get/vcs.go</a></p>\n\n<p>And I don't see here a possibility to work with git local repos.</p>\n"}, {"comments": [{"owner": {"reputation": 6463, "user_id": 172277, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d6fe2a20032260c86e83f2898b3151af?s=128&d=identicon&r=PG", "display_name": "AsTeR", "link": "https://stackoverflow.com/users/172277/aster"}, "edited": false, "score": 0, "creation_date": 1556006241, "post_id": 55798219, "comment_id": 98280951, "body": "I have ended installing another package as the original package was also broken on install. But this seems to be an answer to my question (+1)."}], "tags": [], "owner": {"reputation": 734, "user_id": 4801231, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5ca13f4ff6626c22c4c31b62f9908d1?s=128&d=identicon&r=PG&f=1", "display_name": "svetha.cvl", "link": "https://stackoverflow.com/users/4801231/svetha-cvl"}, "is_accepted": false, "score": 1, "last_activity_date": 1555953184, "creation_date": 1555953184, "answer_id": 55798219, "question_id": 55791862, "link": "https://stackoverflow.com/questions/55791862/go-get-installation-from-a-local-fork/55798219#55798219", "title": "go get installation from a local fork", "body": "<p>If you just want to use a different branch (your PR branch), you can continue using the original import path.</p>\n\n<ul>\n<li>Go get the original package first.</li>\n<li>Go into the downloaded package in your local file system <code>cd $GOPATH/pkg/&lt;package directory&gt;</code></li>\n<li>From your local package cache, switch to the branch you want to pull from. <code>git checkout &lt;PR branch&gt;</code></li>\n<li>Now <code>go get -u &lt;package&gt;</code></li>\n</ul>\n\n<p>If the package is available locally, go get update will just pull the latest code from the branch your local package is checked out to.</p>\n"}], "owner": {"reputation": 6463, "user_id": 172277, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d6fe2a20032260c86e83f2898b3151af?s=128&d=identicon&r=PG", "display_name": "AsTeR", "link": "https://stackoverflow.com/users/172277/aster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1555953184, "creation_date": 1555923922, "question_id": 55791862, "link": "https://stackoverflow.com/questions/55791862/go-get-installation-from-a-local-fork", "title": "go get installation from a local fork", "body": "<p>I am trying to install a go package from a local directory (basically I checked out and existing package and applied a pending pull request).</p>\n\n<pre><code>$ # Both commands give a similar output\n$ go get -u file:///Users/me/workspaces/go/somepackage\n$ go get -u /Users/me/workspaces/go/somepackage\nunrecognized import path \"[...]\" (import path does not begin with hostname)\n</code></pre>\n\n<p>Since <code>go get</code> is downloading then installing, I tried:</p>\n\n<pre><code>$ go install /Users/me/workspaces/go/somepackage\n[] cannot import absolute path\n</code></pre>\n\n<p>Any experienced go user could give a hand?</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1555922922, "post_id": 55791349, "comment_id": 98252607, "body": "Just implement <a href=\"https://golang.org/pkg/net/#Error\" rel=\"nofollow noreferrer\">golang.org/pkg/net/#Error</a> ?"}, {"owner": {"reputation": 2052, "user_id": 5841297, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e504d8fcbf8a9f2babac46fa5d281d7c?s=128&d=identicon&r=PG&f=1", "display_name": "Maruthi Adithya", "link": "https://stackoverflow.com/users/5841297/maruthi-adithya"}, "edited": false, "score": 2, "creation_date": 1555924007, "post_id": 55791349, "comment_id": 98252979, "body": "Why dont you mock the method that returns the proper value to return <code>timeoutErr</code>?"}, {"owner": {"reputation": 2040, "user_id": 7090655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/jPFQs.jpg?s=128&g=1", "display_name": "L&#234; Quang B\u1ea3o", "link": "https://stackoverflow.com/users/7090655/l%c3%aa-quang-b%e1%ba%a3o"}, "edited": false, "score": 0, "creation_date": 1555927109, "post_id": 55791349, "comment_id": 98254229, "body": "Could you guy show me some actual code, I have tried several way to implement the error interface but I keep getting compiled error. I am new to Golang so one-line instruction is a bit hard for me."}], "answers": [{"comments": [{"owner": {"reputation": 2040, "user_id": 7090655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/jPFQs.jpg?s=128&g=1", "display_name": "L&#234; Quang B\u1ea3o", "link": "https://stackoverflow.com/users/7090655/l%c3%aa-quang-b%e1%ba%a3o"}, "edited": false, "score": 0, "creation_date": 1555986362, "post_id": 55794293, "comment_id": 98275216, "body": "I didn&#39;t know that I have to put <code>error</code> into my <code>MyError</code> struct. Thanks for your reply, my UT finally work, now."}, {"owner": {"reputation": 2040, "user_id": 7090655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/jPFQs.jpg?s=128&g=1", "display_name": "L&#234; Quang B\u1ea3o", "link": "https://stackoverflow.com/users/7090655/l%c3%aa-quang-b%e1%ba%a3o"}, "edited": false, "score": 0, "creation_date": 1556003526, "post_id": 55794293, "comment_id": 98279788, "body": "I think the <code>(e Error)</code> is suppose to be <code>(e MyError)</code>. Since, this is the accepted answer, please update it so it will not confuse other people."}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 3, "last_activity_date": 1556026170, "last_edit_date": 1556026170, "creation_date": 1555935479, "answer_id": 55794293, "question_id": 55791349, "link": "https://stackoverflow.com/questions/55791349/golang-how-to-generate-a-net-http-timeout-error-to-perform-unit-test/55794293#55794293", "title": "Golang: how to generate a net/http timeout Error to perform unit test", "body": "<p><code>Error</code> is an interface:</p>\n\n<pre><code>type Error interface {\n        error\n        Timeout() bool   // Is the error a timeout?\n        Temporary() bool // Is the error temporary?\n}\n</code></pre>\n\n<p>To implement it, you'll need to do something like (untested):</p>\n\n<pre><code>type MyError struct {\n  error\n}\n\nfunc (e MyError) Timeout() bool {\n  return true\n}\n\nfunc (e MyError) Temporary() bool {\n  return true\n}\n\nfunc (e MyError) Error() string {\n  return \"\"\n}\n</code></pre>\n\n<p>Note that you have to implement <code>Error()</code> too because <code>Error</code> embeds <code>error</code>.</p>\n"}], "owner": {"reputation": 2040, "user_id": 7090655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/jPFQs.jpg?s=128&g=1", "display_name": "L&#234; Quang B\u1ea3o", "link": "https://stackoverflow.com/users/7090655/l%c3%aa-quang-b%e1%ba%a3o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 853, "favorite_count": 0, "accepted_answer_id": 55794293, "answer_count": 1, "score": 2, "last_activity_date": 1556026170, "creation_date": 1555921409, "question_id": 55791349, "link": "https://stackoverflow.com/questions/55791349/golang-how-to-generate-a-net-http-timeout-error-to-perform-unit-test", "title": "Golang: how to generate a net/http timeout Error to perform unit test", "body": "<p>I got a piece of code like below:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if timeoutErr, ok := err.(net.Error); ok &amp;&amp; timeoutErr.Timeout() {\n    // Some code that need to test\n}\n</code></pre>\n\n<p>How could I generate a error that can match the condition here so the code will flow through the if.</p>\n"}, {"tags": ["go", "github", "go-modules"], "comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 1, "creation_date": 1555925566, "post_id": 55790753, "comment_id": 98253574, "body": "not sure exactly what you are asking but this might be helpful <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">blog.golang.org/profiling-go-programs</a>"}, {"owner": {"reputation": 1748, "user_id": 4106031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NM3jO.jpg?s=128&g=1", "display_name": "Alok Kumar Singh", "link": "https://stackoverflow.com/users/4106031/alok-kumar-singh"}, "reply_to_user": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1555931567, "post_id": 55790753, "comment_id": 98255797, "body": "<a href=\"https://github.com/google/godepq/issues/30\" rel=\"nofollow noreferrer\">github.com/google/godepq/issues/30</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555937972, "post_id": 55790753, "comment_id": 98258441, "body": "What are you using this data for? A binary includes the runtime and all code referenced by your code, including stdlib and third-party packages. Is that what you&#39;re wanting to measure?"}, {"owner": {"reputation": 1748, "user_id": 4106031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NM3jO.jpg?s=128&g=1", "display_name": "Alok Kumar Singh", "link": "https://stackoverflow.com/users/4106031/alok-kumar-singh"}, "edited": false, "score": 0, "creation_date": 1555938270, "post_id": 55790753, "comment_id": 98258557, "body": "Yes mostly the vendored code and also the other dependencies the binary has. To figure out after which release the lines of code has increased by a big difference. And also to figure out which binary to be worked on first to split the repo from a single repo to a multi repo. Making changes here <a href=\"https://github.com/google/godepq/issues/30\" rel=\"nofollow noreferrer\">github.com/google/godepq/issues/30</a> to add a feature <code>--show-loc</code>"}], "owner": {"reputation": 1748, "user_id": 4106031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NM3jO.jpg?s=128&g=1", "display_name": "Alok Kumar Singh", "link": "https://stackoverflow.com/users/4106031/alok-kumar-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1555929364, "creation_date": 1555918211, "last_edit_date": 1555929364, "question_id": 55790753, "link": "https://stackoverflow.com/questions/55790753/lines-of-code-per-binary-overtime-in-golang", "title": "Lines of code per binary overtime in Golang", "body": "<p>In a single github repository containing multiple binaries code together. How can we find the total lines of codes per binary? Also, need to see the lines of codes per binary over a period of time.</p>\n\n<p>For example in the below repository structure</p>\n\n<pre><code>cmd/service1\ncmd/service2\npkg/service1\npkg/service2\n</code></pre>\n\n<p>Need to find the lines of code per service above?</p>\n\n<p>Do we have any tools available to find this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1555938113, "post_id": 55790343, "comment_id": 98258491, "body": "This is covered in the tour: <a href=\"https://tour.golang.org/concurrency/1\" rel=\"nofollow noreferrer\">The evaluation of f, x, y, and z happens in the current goroutine and the execution of f happens in the new goroutine.</a>"}], "answers": [{"tags": [], "owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "is_accepted": false, "score": 2, "last_activity_date": 1555916735, "last_edit_date": 1555916735, "creation_date": 1555916354, "answer_id": 55790402, "question_id": 55790343, "link": "https://stackoverflow.com/questions/55790343/channel-receive-from-just-a-println-in-go-routine-throws-deadlock-exception/55790402#55790402", "title": "Channel receive from just a Println in go routine throws deadlock exception", "body": "<pre><code>// receive the value from channel firstly\n// then create new goroutine to println\ngo fmt.Println(&lt;-ch)\n\n// receive channel in new goroutine \ngo func(){fmt.Println(&lt;-ch)}()\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/xMyqd-Yr8_a\" rel=\"nofollow noreferrer\">https://play.golang.org/p/xMyqd-Yr8_a</a></p>\n\n<p>this will help you to understand the order of exec.</p>\n"}, {"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 3, "last_activity_date": 1555916973, "creation_date": 1555916973, "answer_id": 55790514, "question_id": 55790343, "link": "https://stackoverflow.com/questions/55790343/channel-receive-from-just-a-println-in-go-routine-throws-deadlock-exception/55790514#55790514", "title": "Channel receive from just a Println in go routine throws deadlock exception", "body": "<p>In the first version, the channel read is performed from the main go-routine - hence the deadlock.\nThe second version, the read is done from the created go-routine.</p>\n\n<p>Basically this:</p>\n\n<pre><code>go fmt.Println(&lt;-ch);\n</code></pre>\n\n<p>becomes:</p>\n\n<pre><code>v := &lt;-ch\ngo fmt.Println(v);\n</code></pre>\n\n<p>As the parameters to the function are evaluated <em>before</em> it's invocation.</p>\n\n<p>P.S. The defer statement behaves similarly. So always use a closure if you want the value passed to a go-routine or defer statement to be evaluated at \"runtime\".</p>\n"}], "owner": {"reputation": 1432, "user_id": 494984, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/197a7611b23b98b6f9fc00751ed74f2a?s=128&d=identicon&r=PG", "display_name": "Vikas Madhusudana", "link": "https://stackoverflow.com/users/494984/vikas-madhusudana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 55790514, "answer_count": 2, "score": -2, "last_activity_date": 1555916973, "creation_date": 1555916105, "question_id": 55790343, "link": "https://stackoverflow.com/questions/55790343/channel-receive-from-just-a-println-in-go-routine-throws-deadlock-exception", "title": "Channel receive from just a Println in go routine throws deadlock exception", "body": "<p>I have some code where i am trying to print the content of a channel in a goroutine using fmt.Println. Here is the simplified version of code.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\n\nfunc main() {\n  ch := make(chan int)\n  go fmt.Println(&lt;-ch);\n  ch&lt;- 10;\n  time.Sleep(time.Second * 10);\n}\n</code></pre>\n\n<p>When I run the above code I am getting this error.</p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan receive]:\nmain.main()\n        C:/cygwin64/home/vmadhusudana/go/channel.go:9 +0x67\nexit status 2\n</code></pre>\n\n<p>However it works fine when I call fmt.Println from a function</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\n\nfunc main() {\n    ch := make(chan int)\n    go func(){fmt.Println(&lt;-ch)}();\n    ch&lt;- 10;\n    time.Sleep(time.Second * 10);\n}\n</code></pre>\n\n<p>What is making the difference here?</p>\n"}, {"tags": ["go", "memory", "memory-leaks"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1555935115, "post_id": 55790226, "comment_id": 98257273, "body": "Typically the only way to \u201cleak\u201d memory in go is with goroutines that aren\u2019t returning. Start by looking at a stack trace. If you want to know what the GC is doing, look at the <code>gctrace</code> output."}, {"owner": {"reputation": 83, "user_id": 2828102, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8d340520171240f5e3bac58e95bdb6e1?s=128&d=identicon&r=PG&f=1", "display_name": "user2828102", "link": "https://stackoverflow.com/users/2828102/user2828102"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1555989178, "post_id": 55790226, "comment_id": 98275700, "body": "@JimB Thx for the reply, but the goroutine doesn&#39;t leak at all, there is always about 23  goroutine there."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556025410, "post_id": 55790226, "comment_id": 98291062, "body": "Are you using an CGO packages? What do the runtime memstats show? What does gctrace show?"}], "answers": [{"tags": [], "owner": {"reputation": 66, "user_id": 9464659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cc9c2936d907e7988773df07ba7fac6?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian D. Thurston", "link": "https://stackoverflow.com/users/9464659/adrian-d-thurston"}, "is_accepted": false, "score": 1, "last_activity_date": 1594122963, "creation_date": 1594122963, "answer_id": 62774711, "question_id": 55790226, "link": "https://stackoverflow.com/questions/55790226/golang-program-memory-keep-growing-but-has-just-a-little-inuse-space/62774711#62774711", "title": "golang program memory keep growing but has just a little inuse_space", "body": "<p>As of 1.12, go started to release memory to the OS using lazy-free MADV_FREE mode of madvise. This does not show up in RSS unless there is memory pressure on the system. To get the real usage you have to look at RSS - LazyFree. It is reported in /proc.</p>\n"}], "owner": {"reputation": 83, "user_id": 2828102, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8d340520171240f5e3bac58e95bdb6e1?s=128&d=identicon&r=PG&f=1", "display_name": "user2828102", "link": "https://stackoverflow.com/users/2828102/user2828102"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1056, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1594122963, "creation_date": 1555915445, "last_edit_date": 1555918067, "question_id": 55790226, "link": "https://stackoverflow.com/questions/55790226/golang-program-memory-keep-growing-but-has-just-a-little-inuse-space", "title": "golang program memory keep growing but has just a little inuse_space", "body": "<p>I have a golang program running some routines periodically. Its memory (RSS in top result) keep growing on some servers but on some server it doesn\u2019t. What's weird is that the pprof result of the RSS-growing instance shows the process is taking just little inuse_space memory. </p>\n\n<p>Does this mean that the memory is waiting for golang to GC? But After 48 hours, memory growing from 26000kb to 74000kb, I think golang should have already do GC several times itself. </p>\n\n<p>I have already use sync.Pool to avoid frequently new()ing objects. How I could reduce memory usage?</p>\n\n<p>The detailed data is attached below\uff0c Thanks in advance!</p>\n\n<p>RSS usage in 48 hours(in kb):\n<a href=\"https://i.stack.imgur.com/LUNmf.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/LUNmf.png\" alt=\"enter image description here\"></a></p>\n\n<p>inuse_space:</p>\n\n<pre><code>(pprof) top\nShowing nodes accounting for 1040.73kB, 100% of 1040.73kB total\n      flat  flat%   sum%        cum   cum%\n  524.09kB 50.36% 50.36%   524.09kB 50.36%  sp/audit.Coll\n  516.64kB 49.64%   100%   516.64kB 49.64%  sp/audit.Coll.func2\n         0     0%   100%   524.09kB 50.36%  sa/core.(*pr).run\n         0     0%   100%   516.64kB 49.64%  sa/fw.(*Group).Go.func1\n         0     0%   100%   516.64kB 49.64%  sp/audit/dis.(*Relay).Relay\n         0     0%   100%   516.64kB 49.64%  sync.(*Pool).Get\n(pprof) top -cum\nShowing nodes accounting for 1040.73kB, 100% of 1040.73kB total\n      flat  flat%   sum%        cum   cum%\n         0     0%     0%   524.09kB 50.36%  sa/core.(*pr).run\n  524.09kB 50.36% 50.36%   524.09kB 50.36%  sp/audit.Coll\n         0     0% 50.36%   516.64kB 49.64%  sa/fw.(*Group).Go.func1\n  516.64kB 49.64%   100%   516.64kB 49.64%  sp/audit.Coll.func2\n         0     0%   100%   516.64kB 49.64%  sp/audit/dis.(*Relay).Relay\n         0     0%   100%   516.64kB 49.64%  sync.(*Pool).Get\n</code></pre>\n\n<p>alloc_space:</p>\n\n<pre><code>Showing top 10 nodes out of 181\n      flat  flat%   sum%        cum   cum%\n 3306.19MB 25.83% 25.83%  3306.71MB 25.84%  io.copyBuffer\n 1294.76MB 10.12% 35.95%  1386.15MB 10.83%  os.(*File).readdirnames\n 1121.62MB  8.76% 44.71%  1121.62MB  8.76%  syscall.anyToSockaddr\n  471.56MB  3.68% 48.40%   471.56MB  3.68%  net.newFD\n  413.74MB  3.23% 51.63%   413.74MB  3.23%  bytes.makeSlice\n  356.52MB  2.79% 54.41%   356.52MB  2.79%  github.com/go-xorm/xorm.(*Statement).Init\n  261.55MB  2.04% 56.46%   309.05MB  2.41%  os.lstatNolog\n  241.03MB  1.88% 58.34%   275.03MB  2.15%  os.Readlink\n  236.51MB  1.85% 60.19%   236.51MB  1.85%  reflect.packEface\n  230.51MB  1.80% 61.99%   230.51MB  1.80%  net.sockaddrToUnix\n(pprof) top -cum\nShowing nodes accounting for 3328.69MB, 26.01% of 12798.76MB total\nDropped 439 nodes (cum &lt;= 63.99MB)\nShowing top 10 nodes out of 181\n      flat  flat%   sum%        cum   cum%\n    6.50MB 0.051% 0.051%  6244.66MB 48.79%  sp/filesystem.walk\n         0     0% 0.051%  6244.66MB 48.79%  sp/filesystem.walkProxy\n         0     0% 0.051%  6088.14MB 47.57%  sa/fw.(*WorkerPool).StartWorker.func1\n         0     0% 0.051%  5073.21MB 39.64%  sa/core.(*procRuntime).run\n       1MB 0.0078% 0.059%  3446.69MB 26.93%  sp/filesystem.buildFileStat\n       4MB 0.031%  0.09%  3431.67MB 26.81%  sp/filesystem.Chksum\n         0     0%  0.09%  3334.15MB 26.05%  io.CopyN\n         0     0%  0.09%  3306.71MB 25.84%  io.Copy\n 3306.19MB 25.83% 25.92%  3306.71MB 25.84%  io.copyBuffer\n      11MB 0.086% 26.01%  2659.24MB 20.78%  sa/fw.(*DBO).insertKeepOld\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 6, "creation_date": 1555914295, "post_id": 55790037, "comment_id": 98249751, "body": "you can&#39;t without touching the code"}, {"owner": {"reputation": 538, "user_id": 1931060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S7dYV.jpg?s=128&g=1", "display_name": "imalice", "link": "https://stackoverflow.com/users/1931060/imalice"}, "edited": false, "score": 2, "creation_date": 1555915011, "post_id": 55790037, "comment_id": 98249954, "body": "I think you need to revise the code.  Considering implement an &quot;interface&quot;, this may help you in the future. <a href=\"https://gobyexample.com/interfaces\" rel=\"nofollow noreferrer\">gobyexample.com/interfaces</a>"}, {"owner": {"reputation": 408, "user_id": 2234099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/678915aaa580bada8ed32e01000274c2?s=128&d=identicon&r=PG", "display_name": "gngchrs", "link": "https://stackoverflow.com/users/2234099/gngchrs"}, "edited": false, "score": 2, "creation_date": 1555920246, "post_id": 55790037, "comment_id": 98251768, "body": "you may just need to make sure F1() is called at the beginning of F2()., otherwise, you will need to update everywhere."}, {"owner": {"reputation": 734, "user_id": 4801231, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5ca13f4ff6626c22c4c31b62f9908d1?s=128&d=identicon&r=PG&f=1", "display_name": "svetha.cvl", "link": "https://stackoverflow.com/users/4801231/svetha-cvl"}, "edited": false, "score": 0, "creation_date": 1555952693, "post_id": 55790037, "comment_id": 98265201, "body": "Call F1() inside F2()"}], "answers": [{"tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": true, "score": 1, "last_activity_date": 1555988888, "creation_date": 1555988888, "answer_id": 55803741, "question_id": 55790037, "link": "https://stackoverflow.com/questions/55790037/how-to-call-function-f1-before-a-f2-in-golang/55803741#55803741", "title": "How to call function F1() before a F2() in golang", "body": "<p>It sounds like you want to <a href=\"https://en.wikipedia.org/wiki/Monkey_patch\" rel=\"nofollow noreferrer\">monkey patch</a> Go code.</p>\n\n<p>There is no real way to do this in Go. Yes, there's <a href=\"https://github.com/bouk/monkey\" rel=\"nofollow noreferrer\">github.com/bouk/monkey</a>, but even the author doesn't recommend using it.</p>\n\n<p>You'll either have to:</p>\n\n<ul>\n<li>Change your F2().</li>\n<li>Change the callers of F2().</li>\n<li>Add an F3() which calls F1() and F2(), or do some other refactor which allows you to do what you want.</li>\n</ul>\n\n<hr>\n\n<p>There are some ways to change the code that's being run without changing the actual code or callers. This is pretty much what interfaces are for, but you can also do something similar with struct embedding:</p>\n\n<pre><code>type (\n    x struct{}\n    y struct{}\n    z struct{ x }\n)\n\nfunc (_ x) method() string { return \"x\" }\nfunc (_ y) method() string { return \"y\" }\n</code></pre>\n\n<p>The <code>z</code> struct embeds <code>x</code>, so <code>z{}.method()</code> will return <code>x</code>. You can change this to <code>y</code> by embedding the <code>y</code> struct instead of the <code>x</code> one.</p>\n"}], "owner": {"reputation": 638, "user_id": 4380048, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1d95bf68a0b437b36450e18b08f6ef71?s=128&d=identicon&r=PG&f=1", "display_name": "Forkmohit", "link": "https://stackoverflow.com/users/4380048/forkmohit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 55803741, "answer_count": 1, "score": -3, "last_activity_date": 1555988888, "creation_date": 1555914203, "question_id": 55790037, "link": "https://stackoverflow.com/questions/55790037/how-to-call-function-f1-before-a-f2-in-golang", "title": "How to call function F1() before a F2() in golang", "body": "<p>I have a function F2() already in production. F2() is getting called from many other places. I don't want to touch F2() or don't want to touch all the places from where F2 is getting called. How do I call another method F1() just before F2() is called?  </p>\n"}, {"tags": ["ssl", "go"], "answers": [{"comments": [{"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1555915941, "post_id": 55790224, "comment_id": 98250220, "body": "This keeps the <code>handshake failure</code> error, with an empty certificate and if no certificate added it just ask for it."}], "tags": [], "owner": {"reputation": 656, "user_id": 6793457, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHWs1.jpg?s=128&g=1", "display_name": "Siddhanta Rath", "link": "https://stackoverflow.com/users/6793457/siddhanta-rath"}, "is_accepted": false, "score": 0, "last_activity_date": 1555915433, "creation_date": 1555915433, "answer_id": 55790224, "question_id": 55789582, "link": "https://stackoverflow.com/questions/55789582/how-can-i-create-a-tls-connection-without-certificates-in-golang/55790224#55790224", "title": "How can I create a TLS connection without certificates in golang?", "body": "<p>set InsecureSkipVerify to true at tls.Config</p>\n\n<pre><code>&amp;tls.Config{InsecureSkipVerify: true}\n</code></pre>\n\n<p>and add that config to Transport</p>\n\n<pre><code>&amp;http.Transport{TLSClientConfig: tlsConfig}\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/crypto/tls/#Config\" rel=\"nofollow noreferrer\">https://golang.org/pkg/crypto/tls/#Config</a></p>\n"}, {"comments": [{"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1555918746, "post_id": 55790821, "comment_id": 98251200, "body": "I am indeed authenticating both points of the connections with a custom verify method. Does this mean that for example would be the same to just use some certificates and use <code>InsecureSkipVerify</code>? It will be encrypting the connection but not handling any authentication then right? Thank you for your answer!"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1555918974, "post_id": 55790821, "comment_id": 98251297, "body": "@Netwave: Yes, you could use a self-signed certificate and simply not verify it in the client. But please note that your custom verify method must be resistant to man in the middle attacks. As long as the authentication is not finished you essentially have to treat the TLS channel like a plain channel where an attacker could not only sniff but also modify the traffic. Thus a simple password based authentication schema will not work."}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1555919069, "post_id": 55790821, "comment_id": 98251322, "body": "Thanks, It is all I needed to know!!"}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": true, "score": 4, "last_activity_date": 1555918521, "creation_date": 1555918521, "answer_id": 55790821, "question_id": 55789582, "link": "https://stackoverflow.com/questions/55789582/how-can-i-create-a-tls-connection-without-certificates-in-golang/55790821#55790821", "title": "How can I create a TLS connection without certificates in golang?", "body": "<p>TLS without certificates would require support for cipher suites which don't use certificates. </p>\n\n<p>Looking at the source code for <code>crypto/tls</code> one can find the supported cipher suites in <a href=\"https://github.com/golang/go/blob/master/src/crypto/tls/cipher_suites.go#L77\" rel=\"nofollow noreferrer\">crypto/tls/cipher_suites.go</a>. One can see there that only cipher suites using either RSA or ECDSA authentication are supported, which means that you need to have a certificate with either RSA or ECC key. </p>\n\n<p>To have support for TLS without certificates there need to be ciphers for PSK, SRP .. or similar authentication methods which don't require certificates or for the NULL  authentication (anonymous, i.e. no authentication). But these are not supported.</p>\n\n<blockquote>\n  <p>What I need is the tls encryption but not the authentication.</p>\n</blockquote>\n\n<p>In most cases such requirement is flawed in the first place. \nTLS without authentication would mean that an active and undetectable man in the middle attack is usually easily possible, which would essentially make all the encryption provided by TLS meaningless. TLS without authentication would only make sense if the client could securely (i.e.resistant against MITM attacks) authenticate the server after the TLS connection was established and before any application payload is transmitted. </p>\n"}], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1505, "favorite_count": 1, "accepted_answer_id": 55790821, "answer_count": 2, "score": 1, "last_activity_date": 1555918521, "creation_date": 1555911222, "last_edit_date": 1555915646, "question_id": 55789582, "link": "https://stackoverflow.com/questions/55789582/how-can-i-create-a-tls-connection-without-certificates-in-golang", "title": "How can I create a TLS connection without certificates in golang?", "body": "<p>From the source:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Listen creates a TLS listener accepting connections on the\n// given network address using net.Listen.\n// The configuration config must be non-nil and must include\n// at least one certificate or else set GetCertificate.\nfunc Listen(network, laddr string, config *Config) (net.Listener, error) {\n    if config == nil || (len(config.Certificates) == 0 &amp;&amp; config.GetCertificate == nil) {\n        return nil, errors.New(\"tls: neither Certificates nor GetCertificate set in Config\")\n    }\n    l, err := net.Listen(network, laddr)\n    if err != nil {\n        return nil, err\n    }\n    return NewListener(l, config), nil\n}\n</code></pre>\n\n<p>The problem is that the certificates cannot be nil:</p>\n\n<pre><code>// The configuration config must be non-nil and must include\n// at least one certificate or else set GetCertificate.\n</code></pre>\n\n<p>How can I use a <code>tls</code> connection listening without certificates?\nWhat I need is the <code>tls</code> <strong>encryption</strong> but <strong>not the authentication</strong>.</p>\n\n<p>I tried making a tls.Config with an empty certificate like this:</p>\n\n<pre><code>&amp;tls.Config{\n            Certificates: []tls.Certificate{tls.Certificate{}},\n}\n</code></pre>\n\n<p>But the connections failed with <code>tls: handshake failure</code>.\nIs this even possible?</p>\n"}, {"tags": ["go", "testing", "benchmarking"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1556261066, "post_id": 55789373, "comment_id": 98384584, "body": "I would question the approach. It reads like you do want to achieve a load test of a deployment, rather than testing the efficiency of an individual unit of code (which you already have established). For the latter, Go&#39;s benchmark feature is suitable. For the former, I would strongly suggest a staging environment and the use of something like <a href=\"https://jmeter.apache.org\" rel=\"nofollow noreferrer\">Apache JMeter</a>"}], "answers": [{"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1556071263, "post_id": 55790771, "comment_id": 98308765, "body": "The assert is just to make sure the &quot;benchmark&quot; ran correctly. I&#39;m aware of Go&#39;s concurrency feature, though I am unsure how that integrates with my <a href=\"https://github.com/unee-t/unit/blob/master/main_test.go\" rel=\"nofollow noreferrer\">main_test.go</a>."}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 2, "last_activity_date": 1555918328, "creation_date": 1555918328, "answer_id": 55790771, "question_id": 55789373, "link": "https://stackoverflow.com/questions/55789373/run-a-benchmark-in-parallel-i-e-simulate-simultaneous-requests/55790771#55790771", "title": "Run a benchmark in parallel, i.e. simulate simultaneous requests", "body": "<p>Your example code mixes several things. Why are you using <code>assert</code> there? This is not a test it is a benchmark. If the <code>assert</code> methods are slow, your benchmark will be.</p>\n\n<p>You also moved the parallel execution out of your code into the test command. You should try to make a parallel request by using concurrency. Here just a possibility how to start:</p>\n\n<pre><code>func executeRoutines(routines int) {\n    wg := &amp;sync.WaitGroup{}\n    wg.Add(routines)\n    starter := make(chan struct{})\n    for i := 0; i &lt; routines; i++ {\n        go func() {\n            &lt;-starter\n            // your request here\n            wg.Done()\n        }()\n    }\n    close(starter)\n    wg.Wait()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ZFjUodniDHr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ZFjUodniDHr</a></p>\n\n<p>We start some goroutines here, which are waiting until <code>starter</code> is closed. So you can set your request direct after that line. That the function waits until all the requests are done we are using a WaitGroup.</p>\n\n<p>BUT IMPORTANT: Go just supports concurrency. So if your system has not 10 cores the 10 goroutines will not run parallel. So ensure that you have enough cores availiable. </p>\n\n<p>With this start you can play a little bit. You could start to call this function inside your benchmark. You could also play around with the numbers of goroutines.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 5, "last_activity_date": 1556188493, "last_edit_date": 1556188493, "creation_date": 1556181523, "answer_id": 55845119, "question_id": 55789373, "link": "https://stackoverflow.com/questions/55789373/run-a-benchmark-in-parallel-i-e-simulate-simultaneous-requests/55845119#55845119", "title": "Run a benchmark in parallel, i.e. simulate simultaneous requests", "body": "<p>The <code>-parallel</code> flag is not for running the same test or benchmark parallel, in multiple instances.</p>\n\n<p>Quoting from <a href=\"https://golang.org/cmd/go/#hdr-Testing_flags\" rel=\"noreferrer\">Command go: Testing flags:</a></p>\n\n<blockquote>\n<pre><code>-parallel n\n    Allow parallel execution of test functions that call t.Parallel.\n    The value of this flag is the maximum number of tests to run\n    simultaneously; by default, it is set to the value of GOMAXPROCS.\n    Note that -parallel only applies within a single test binary.\n    The 'go test' command may run tests for different packages\n    in parallel as well, according to the setting of the -p flag\n    (see 'go help build').\n</code></pre>\n</blockquote>\n\n<p>So basically if your tests allow, you can use <code>-parallel</code> to run multiple distinct testing or benchmark functions parallel, but not the same one in multiple instances.</p>\n\n<p>In general, running multiple benchmark functions parallel defeats the purpose of benchmarking a function, because running it parallel in multiple instances usually distorts the benchmarking.</p>\n\n<p>However, in your case code efficiency is not what you want to measure, you want to measure an external service. So go's built-in testing and benchmarking facilities are not really suitable.</p>\n\n<p>Of course we could still use the convenience of having this \"benchmark\" run automatically when our other tests and benchmarks run, but you should not force this into the conventional benchmarking framework.</p>\n\n<p>First thing that comes to mind is to use a for loop to launch <code>n</code> goroutines which all attempt to call the testable service. One problem with this is that this only ensures <code>n</code> concurrent goroutines at the start, because as the calls start to complete, there will be less and less concurrency for the remaining ones.</p>\n\n<p>To overcome this and truly test <code>n</code> concurrent calls, you should have a worker pool with <code>n</code> workers, and continously feed jobs to this worker pool, making sure there will be <code>n</code> concurrent service calls at all times. For a worker pool implementation, see <a href=\"https://stackoverflow.com/questions/38170852/is-this-an-idiomatic-worker-thread-pool-in-go/38172204#38172204\">Is this an idiomatic worker thread pool in Go?</a></p>\n\n<p>So all in all, fire up a worker pool with <code>n</code> workers, have a goroutine send jobs to it for an arbitrary time (e.g. for 30 seconds or 1 minute), and measure (count) the completed jobs. The benchmark result will be a simple division.</p>\n\n<p>Also note that for solely testing purposes, a worker pool might not even be needed. You can just use a loop to launch <code>n</code> goroutines, but make sure each started goroutine keeps calling the service and not return after a single call.</p>\n"}, {"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 1, "creation_date": 1556258017, "post_id": 55853632, "comment_id": 98383406, "body": "Thanks Adrian! I&#39;m getting a &quot;function must be invoked in go statement&quot; on this code snippet in my editor. <a href=\"https://s.natalian.org/2019-04-26/1556258008_2560x1440.png\" rel=\"nofollow noreferrer\">s.natalian.org/2019-04-26/1556258008_2560x1440.png</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 1, "creation_date": 1556285504, "post_id": 55853632, "comment_id": 98397421, "body": "Yep, apologies, typo on my part. the <code>go func</code> was missing its <code>()</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 1, "creation_date": 1556292174, "post_id": 55853632, "comment_id": 98401196, "body": "You&#39;re right. That was placed before I changed it to loop over a series of concurrency levels... fixed!"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 1, "creation_date": 1556292339, "post_id": 55853632, "comment_id": 98401272, "body": "There are a few ways to do the concurrent traffic, what&#39;s shown is the simplest but not necessarily the most efficient (it will generate a lot of goroutines sitting waiting on the semaphore). You could optimize it with a worker pool to reduce memory usage for large values of <code>b.N</code>."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1556292150, "last_edit_date": 1556292150, "creation_date": 1556209008, "answer_id": 55853632, "question_id": 55789373, "link": "https://stackoverflow.com/questions/55789373/run-a-benchmark-in-parallel-i-e-simulate-simultaneous-requests/55853632#55853632", "title": "Run a benchmark in parallel, i.e. simulate simultaneous requests", "body": "<p>As the documentation indicates, the <code>parallel</code> flag is to allow multiple <em>different</em> tests to be run in parallel. You generally do <em>not</em> want to run benchmarks in parallel because that would run different benchmarks at the same time, throwing off the results for all of them. If you want to benchmark parallel traffic, you need to write parallel traffic generation into your test. You need to decide how this should work with <code>b.N</code> which is your work factor; I would probably use it as the total request count, and write a benchmark or multiple benchmarks testing different concurrent load levels, e.g.:</p>\n\n<pre><code>func Benchmark_RealCreate(b *testing.B) {\n    concurrencyLevels := []int{5, 10, 20, 50}\n    for _, clients := range concurrencyLevels {\n        b.Run(fmt.Sprintf(\"%d_clients\", clients), func(b *testing.B) {\n            sem := make(chan struct{}, clients)\n            wg := sync.WaitGroup{}\n            for n := 0; n &lt; b.N; n++ {\n                wg.Add(1)\n                go func() {\n                    name := randomdata.SillyName()\n                    r := gofight.New()\n                    u := []unit{unit{MefeUnitID: name, MefeCreatorUserID: \"user\", BzfeCreatorUserID: 55, ClassificationID: 2, UnitName: name, UnitDescriptionDetails: \"Up on the hills and testing\"}}\n                    uJSON, _ := json.Marshal(u)\n                    sem &lt;- struct{}{}\n                    r.POST(\"/create\").\n                        SetBody(string(uJSON)).\n                        Run(h.BasicEngine(), func(r gofight.HTTPResponse, rq gofight.HTTPRequest) {})\n                    &lt;-sem\n                    wg.Done()\n                }()\n            }\n            wg.Wait()\n        })\n    }\n}\n</code></pre>\n\n<p>Note here I removed the initial <code>ResetTimer</code>; the timer doesn't start until you benchmark function is called, so calling it as the first op in your function is pointless. It's intended for cases where you have time-consuming setup prior to the benchmark loop that you don't want included in the benchmark results. I've also removed the assertions, because this is a benchmark, not a test; assertions are for validity checking in tests and only serve to throw off timing results in benchmarks.</p>\n"}, {"tags": [], "owner": {"reputation": 69, "user_id": 9590203, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-THzr86CKlwk/AAAAAAAAAAI/AAAAAAAACJE/wv5BlZdDoBA/photo.jpg?sz=128", "display_name": "vbujym ", "link": "https://stackoverflow.com/users/9590203/vbujym"}, "is_accepted": false, "score": 2, "last_activity_date": 1556484053, "creation_date": 1556484053, "answer_id": 55894397, "question_id": 55789373, "link": "https://stackoverflow.com/questions/55789373/run-a-benchmark-in-parallel-i-e-simulate-simultaneous-requests/55894397#55894397", "title": "Run a benchmark in parallel, i.e. simulate simultaneous requests", "body": "<p>I'm new to go, but why don't you try to make a function and run it using the standard parallel test?</p>\n\n<pre><code>func Benchmark_YourFunc(b *testing.B) {\n    b.RunParralel(func(pb *testing.PB) {\n        for pb.Next() {\n            YourFunc(staff ...T)\n        }\n    })\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 503, "user_id": 1641133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3360c05773d3b6d70a2e8e4d958e9da1?s=128&d=identicon&r=PG", "display_name": "jagra", "link": "https://stackoverflow.com/users/1641133/jagra"}, "is_accepted": false, "score": 0, "last_activity_date": 1556753061, "last_edit_date": 1556753061, "creation_date": 1556718040, "answer_id": 55937188, "question_id": 55789373, "link": "https://stackoverflow.com/questions/55789373/run-a-benchmark-in-parallel-i-e-simulate-simultaneous-requests/55937188#55937188", "title": "Run a benchmark in parallel, i.e. simulate simultaneous requests", "body": "<p>One thing is benchmarking (measuring time code takes to run) another one is load/stress testing.</p>\n\n<p>The -parallel flag as stated above, is to allow a set of tests to execute in parallel, allowing the test set to execute faster, not to execute some test N times in parallel.</p>\n\n<p>But is simple to achieve what you want (execution of same test N times). Bellow a very simple (really quick and dirty) example just to clarify/demonstrate the important points, that gets this very specific situation done:</p>\n\n<ul>\n<li>You define a test and mark it to be executed in parallel => TestAverage with a call to t.Parallel</li>\n<li>You then define another test and use RunParallel to execute the number of instances of the test (TestAverage) you want.</li>\n</ul>\n\n<p>The class to test:</p>\n\n<pre><code>package math\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc Average(xs []float64) float64 {\n  total := float64(0)\n  for _, x := range xs {\n    total += x\n  }\n\n  fmt.Printf(\"Current Unix Time: %v\\n\", time.Now().Unix())\n  time.Sleep(10 * time.Second)\n  fmt.Printf(\"Current Unix Time: %v\\n\", time.Now().Unix())\n\n  return total / float64(len(xs))\n}\n</code></pre>\n\n<p>The testing funcs:</p>\n\n<pre><code>package math\n\nimport \"testing\"\n\nfunc TestAverage(t *testing.T) {\n  t.Parallel()\n  var v float64\n  v = Average([]float64{1,2})\n  if v != 1.5 {\n    t.Error(\"Expected 1.5, got \", v)\n  }\n}\n\nfunc TestTeardownParallel(t *testing.T) {\n    // This Run will not return until the parallel tests finish.\n    t.Run(\"group\", func(t *testing.T) {\n        t.Run(\"Test1\", TestAverage)\n        t.Run(\"Test2\", TestAverage)\n        t.Run(\"Test3\", TestAverage)\n    })\n    // &lt;tear-down code&gt;\n}\n</code></pre>\n\n<p>Then just do a go test and you should see:</p>\n\n<pre><code>X:\\&gt;go test\nCurrent Unix Time: 1556717363\nCurrent Unix Time: 1556717363\nCurrent Unix Time: 1556717363\n</code></pre>\n\n<p>And 10 secs after that</p>\n\n<pre><code>...\nCurrent Unix Time: 1556717373\nCurrent Unix Time: 1556717373\nCurrent Unix Time: 1556717373\nCurrent Unix Time: 1556717373\nCurrent Unix Time: 1556717383\nPASS\nok      _/X_/y        20.259s\n</code></pre>\n\n<p>The two extra lines, in the end are because TestAverage is executed also.</p>\n\n<p>The interesting point here: if you remove t.Parallel() from TestAverage, it will all be execute sequencially:</p>\n\n<pre><code>X:&gt; go test\nCurrent Unix Time: 1556717564\nCurrent Unix Time: 1556717574\nCurrent Unix Time: 1556717574\nCurrent Unix Time: 1556717584\nCurrent Unix Time: 1556717584\nCurrent Unix Time: 1556717594\nCurrent Unix Time: 1556717594\nCurrent Unix Time: 1556717604\nPASS\nok      _/X_/y        40.270s\n</code></pre>\n\n<p>This can of course be made more complex and extensible...</p>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1942, "favorite_count": 2, "answer_count": 5, "score": 5, "last_activity_date": 1556753061, "creation_date": 1555909632, "question_id": 55789373, "link": "https://stackoverflow.com/questions/55789373/run-a-benchmark-in-parallel-i-e-simulate-simultaneous-requests", "title": "Run a benchmark in parallel, i.e. simulate simultaneous requests", "body": "<p>When testing a database procedure invoked from an API, when it runs sequentially, it seems to run consistently within ~3s. However we've noticed that when <strong>several requests come in at the same time</strong>, this can take much longer, causing time outs. I am trying to reproduce the \"several requests at one time\" case as a <code>go test</code>.</p>\n\n<p>I tried the <code>-parallel 10</code> go test flag, but <a href=\"https://media.dev.unee-t.com/2019-04-22/parallel.txt\" rel=\"noreferrer\">the timings</a> were the same at ~28s.</p>\n\n<p>Is there something wrong with my <a href=\"https://github.com/unee-t/unit/commit/20e4f6a0001ab9a49027f4de0e969c3af3377929\" rel=\"noreferrer\">benchmark function</a>?</p>\n\n<pre><code>func Benchmark_RealCreate(b *testing.B) {\n    b.ResetTimer()\n    for n := 0; n &lt; b.N; n++ {\n        name := randomdata.SillyName()\n        r := gofight.New()\n        u := []unit{unit{MefeUnitID: name, MefeCreatorUserID: \"user\", BzfeCreatorUserID: 55, ClassificationID: 2, UnitName: name, UnitDescriptionDetails: \"Up on the hills and testing\"}}\n        uJSON, _ := json.Marshal(u)\n        r.POST(\"/create\").\n            SetBody(string(uJSON)).\n            Run(h.BasicEngine(), func(r gofight.HTTPResponse, rq gofight.HTTPRequest) {\n                assert.Contains(b, r.Body.String(), name)\n                assert.Equal(b, http.StatusOK, r.Code)\n            })\n    }\n}\n</code></pre>\n\n<p>Else how I can achieve what I am after?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11382382"}, "edited": false, "score": 0, "creation_date": 1555905028, "post_id": 55788798, "comment_id": 98247783, "body": "Before seeing your answer I tried downloading and extracting and now my /hom/username/bin folder contains this: <a href=\"http://prntscr.com/nf3f0m\" rel=\"nofollow noreferrer\">prntscr.com/nf3f0m</a> And the /home/username/ folder looks like this: <a href=\"http://prntscr.com/nf3ffw\" rel=\"nofollow noreferrer\">prntscr.com/nf3ffw</a>  Is everything right here?"}, {"owner": {"reputation": 656, "user_id": 6793457, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHWs1.jpg?s=128&g=1", "display_name": "Siddhanta Rath", "link": "https://stackoverflow.com/users/6793457/siddhanta-rath"}, "edited": false, "score": 1, "creation_date": 1555905306, "post_id": 55788798, "comment_id": 98247830, "body": "you need to download the protoc-gen-go separately, otherwise it won&#39;t work. Only for golang, the code generator is not packaged with protoc bin. I have modified the steps, just have a look."}, {"owner": {"user_type": "does_not_exist", "display_name": "user11382382"}, "edited": false, "score": 0, "creation_date": 1555905562, "post_id": 55788798, "comment_id": 98247864, "body": "I think I installed protoc-gen-go using some command from some website, I tried to compile a test.proto file and it compiled successfully. Im okay here now or did I do something which will come back to bite in my _ later?"}], "tags": [], "owner": {"reputation": 656, "user_id": 6793457, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHWs1.jpg?s=128&g=1", "display_name": "Siddhanta Rath", "link": "https://stackoverflow.com/users/6793457/siddhanta-rath"}, "is_accepted": true, "score": 0, "last_activity_date": 1555908009, "last_edit_date": 1555908009, "creation_date": 1555903758, "answer_id": 55788798, "question_id": 55788415, "link": "https://stackoverflow.com/questions/55788415/how-to-download-protocol-buffers-v3-from-this-site/55788798#55788798", "title": "How to download Protocol Buffers v3 from this site?", "body": "<p>that binary is OS dependent and contains the protoc compiler to compile the protobuffs.</p>\n\n<blockquote>\n  <p>protoc-3.6.0-linux-x86_64.zip</p>\n</blockquote>\n\n<p>Note: 3.6.0 is not the latest version</p>\n\n<p>you will find all the binary <a href=\"https://github.com/protocolbuffers/protobuf/releases?after=conformance-build-tag\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>download the zip, unzip and copy that protoc bin to </p>\n\n<pre><code>/usr/local/bin\n</code></pre>\n\n<p>run below commands for Linux:</p>\n\n<pre><code>mkdir -p /tmp/protoc &amp;&amp; \\\n        wget https://github.com/google/protobuf/releases/download/v3.6.0/protoc-3.6.0-linux-x86_64.zip &amp;&amp; \\\n        unzip protoc-3.6.0-linux-x86_64.zip -d protoc3 &amp;&amp; \\\n        cp protoc3/bin/* /usr/local/bin/ &amp;&amp; \\\n        cp -R protoc3/include/* /usr/local/include &amp;&amp; \\\n        chmod +x /usr/local/bin/protoc &amp;&amp; \\\n        rm -rf /tmp/protoc \n</code></pre>\n\n<p>just type protoc in the terminal, it should work.</p>\n\n<p>For go lang code generation, you have to download code generator separately.\ni,e; </p>\n\n<blockquote>\n  <p>protoc-gen-go.</p>\n</blockquote>\n\n<p>install go and set the GOPATH.</p>\n\n<p>then, run below command :</p>\n\n<pre><code>go get github.com/golang/protobuf/protoc-gen-go\n</code></pre>\n\n<p>After that, you could use go code generator plugin to generate the code like below:</p>\n\n<pre><code>protoc -I . hello.proto --go_out=plugins=grpc:out\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11382382"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 55788798, "answer_count": 1, "score": 1, "last_activity_date": 1555908009, "creation_date": 1555899302, "last_edit_date": 1555901079, "question_id": 55788415, "link": "https://stackoverflow.com/questions/55788415/how-to-download-protocol-buffers-v3-from-this-site", "title": "How to download Protocol Buffers v3 from this site?", "body": "<p>I'm following this tutorial to install Protocol Buffers v3:</p>\n\n<pre><code>https://grpc.io/docs/quickstart/go.html#install-grpc\n</code></pre>\n\n<p>It says \"The simplest way to do this is to download pre-compiled binaries for your platform\", what is \"platform\" here? Operating System or Programming Languages? Im confused at this step, because I dont understand what its saying exactly. </p>\n\n<p>I even tried to follow the link but there is no Protobuf installation for \"GoLang\" at all, I can see java, python, linux, win, osx etc and I dont know which one to choose and this added to my frustration:</p>\n\n<pre><code>http://prntscr.com/nf2qye\n</code></pre>\n\n<p>Even if I download the file somehow then how and exactly where do I unzip in Linux?</p>\n\n<p>Even if I unzip it somewhere then what will be the code to write in the bash_profile to update the environment variable PATH to include the path to the protoc binary file as mentioned in the tutorial?</p>\n\n<p>Please help, thanks.</p>\n"}, {"tags": ["go", "module"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1555905628, "post_id": 55788194, "comment_id": 98247870, "body": "Also posted here: <a href=\"https://www.reddit.com/r/golang/comments/bfw4dc/new_to_go_modules_what_causes_pattern_matched_no/\" rel=\"nofollow noreferrer\">reddit.com/r/golang/comments/bfw4dc/&hellip;</a>"}, {"owner": {"reputation": 193, "user_id": 5069511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcd1d48080c08de299584704b3593733?s=128&d=identicon&r=PG&f=1", "display_name": "Striar", "link": "https://stackoverflow.com/users/5069511/striar"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1555905883, "post_id": 55788194, "comment_id": 98247916, "body": "@MartinTournoij That is my Reddit post looking for answers lol. Same user name."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1555905995, "post_id": 55788194, "comment_id": 98247936, "body": "Yes, I know. That&#39;s why I linked it, so people can see if it already has an answer elsewhere. Crossposting questions like this in generally discouraged."}], "answers": [{"comments": [{"owner": {"reputation": 193, "user_id": 5069511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcd1d48080c08de299584704b3593733?s=128&d=identicon&r=PG&f=1", "display_name": "Striar", "link": "https://stackoverflow.com/users/5069511/striar"}, "edited": false, "score": 0, "creation_date": 1555945520, "post_id": 55792246, "comment_id": 98261997, "body": "Ideally I&#39;d like to solve this without downgrading from Go 12 to 11. Thanks though."}, {"owner": {"reputation": 488, "user_id": 854696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f0bfad414ff34fa213a25e99903de6a?s=128&d=identicon&r=PG", "display_name": "hrbdg", "link": "https://stackoverflow.com/users/854696/hrbdg"}, "edited": false, "score": 0, "creation_date": 1576532362, "post_id": 55792246, "comment_id": 104923047, "body": "I had the same problem in 1.12, but just updated to 1.13 and it works without needing GO111MODULE set to anything"}], "tags": [], "owner": {"reputation": 39, "user_id": 10841949, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-fE6pQE9fz7I/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYvZIgzjUfT_8ylO5TAC6VRPidkVQ/mo/photo.jpg?sz=128", "display_name": "Brucezhang", "link": "https://stackoverflow.com/users/10841949/brucezhang"}, "is_accepted": false, "score": 3, "last_activity_date": 1555932710, "last_edit_date": 1555932710, "creation_date": 1555925574, "answer_id": 55792246, "question_id": 55788194, "link": "https://stackoverflow.com/questions/55788194/what-causes-pattern-matched-no-module-dependencies-when-using-go-mod-download/55792246#55792246", "title": "What causes &quot;Pattern matched no module dependencies&quot; when using go mod download?", "body": "<p>I have had the same issue and I resolved it by changing the version of go to v1.11.9.</p>\n\n<pre><code>go mod download\ngo: modules disabled inside GOPATH/src by GO111MODULE=auto; see 'go help modules'\n</code></pre>\n\n<p><code>export GO111MODULE=on</code></p>\n"}, {"comments": [{"owner": {"reputation": 193, "user_id": 5069511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcd1d48080c08de299584704b3593733?s=128&d=identicon&r=PG&f=1", "display_name": "Striar", "link": "https://stackoverflow.com/users/5069511/striar"}, "edited": false, "score": 0, "creation_date": 1555965504, "post_id": 55798096, "comment_id": 98270417, "body": "Thanks I&#39;ll try this as soon as I get home from work. If it works I&#39;ll make sure to mark as answer."}], "tags": [], "owner": {"reputation": 734, "user_id": 4801231, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5ca13f4ff6626c22c4c31b62f9908d1?s=128&d=identicon&r=PG&f=1", "display_name": "svetha.cvl", "link": "https://stackoverflow.com/users/4801231/svetha-cvl"}, "is_accepted": true, "score": 16, "last_activity_date": 1555952600, "creation_date": 1555952600, "answer_id": 55798096, "question_id": 55788194, "link": "https://stackoverflow.com/questions/55788194/what-causes-pattern-matched-no-module-dependencies-when-using-go-mod-download/55798096#55798096", "title": "What causes &quot;Pattern matched no module dependencies&quot; when using go mod download?", "body": "<p>Try enabling go modules. This works for me with go 1.12</p>\n\n<pre><code>GO111MODULE=on go mod download\n</code></pre>\n\n<p>Note: If you're working inside $GOPATH/src, go modules are disabled by default and can be enabled by setting GO111MODULE=on.</p>\n\n<p>From <a href=\"https://blog.golang.org/using-go-modules\" rel=\"noreferrer\">https://blog.golang.org/using-go-modules</a>,</p>\n\n<blockquote>\n  <p>(Inside $GOPATH/src, for compatibility, the go command still runs in the old GOPATH mode, even if a go.mod is found. See the go command documentation for details.)</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 884, "user_id": 6651080, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-EY45JeKlPi8/AAAAAAAAAAI/AAAAAAAAG8I/5bwaHIx2IoQ/photo.jpg?sz=128", "display_name": "Dzintars", "link": "https://stackoverflow.com/users/6651080/dzintars"}, "is_accepted": false, "score": 1, "last_activity_date": 1565530777, "creation_date": 1565530777, "answer_id": 57450425, "question_id": 55788194, "link": "https://stackoverflow.com/questions/55788194/what-causes-pattern-matched-no-module-dependencies-when-using-go-mod-download/57450425#57450425", "title": "What causes &quot;Pattern matched no module dependencies&quot; when using go mod download?", "body": "<p>Coming there from the similar issue by running Dockerfile.</p>\n\n<p>Dockerfile:</p>\n\n<pre><code>ENV GO111MODULE=on\nRUN go mod download\nRUN go mod verify\n</code></pre>\n"}], "owner": {"reputation": 193, "user_id": 5069511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcd1d48080c08de299584704b3593733?s=128&d=identicon&r=PG&f=1", "display_name": "Striar", "link": "https://stackoverflow.com/users/5069511/striar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4583, "favorite_count": 1, "accepted_answer_id": 55798096, "answer_count": 3, "score": 8, "last_activity_date": 1565530777, "creation_date": 1555896670, "question_id": 55788194, "link": "https://stackoverflow.com/questions/55788194/what-causes-pattern-matched-no-module-dependencies-when-using-go-mod-download", "title": "What causes &quot;Pattern matched no module dependencies&quot; when using go mod download?", "body": "<p>When running <strong>go mod download</strong> the warning (warning: pattern \"all\" matched no module dependencies) is shown and none of the modules in my go.mod file are download to the local cache.</p>\n\n<p>I've spent the last hour on google trying to find similar errors but have been  stuck with the only results being broken CI build logs. </p>\n\n<p>My go.mod file is as follows:</p>\n\n<pre><code>module github.com/j4ng5y/scraper-api\n\ngo 1.12\n\nrequire (\n    github.com/PuerkitoBio/goquery v1.5.0 // indirect\n    github.com/antchfx/htmlquery v1.0.0 // indirect\n    github.com/antchfx/xmlquery v1.0.0 // indirect\n    github.com/antchfx/xpath v0.0.0-20190319080838-ce1d48779e67 // indirect\n    github.com/go-yaml/yaml v2.1.0+incompatible\n    github.com/gobwas/glob v0.2.3 // indirect\n    github.com/gocolly/colly v1.2.0 // indirect\n    github.com/gorilla/mux v1.7.1\n    github.com/kennygrant/sanitize v1.2.4 // indirect\n    github.com/saintfish/chardet v0.0.0-20120816061221-3af4cd4741ca // indirect\n    github.com/temoto/robotstxt v0.0.0-20180810133444-97ee4a9ee6ea // indirect\n    golang.org/x/net v0.0.0-20190404232315-eb5bcb51f2a3 // indirect\n    google.golang.org/appengine v1.5.0 // indirect\n)\n</code></pre>\n\n<p>I would expect <strong>go mod download</strong> to pull all of the modules to the local cache but instead I get the warning and nothing is downloaded.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 165027, "user_id": 1902010, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a19f9308334d07d4be19c8f6d11151ff?s=128&d=identicon&r=PG", "display_name": "ceejayoz", "link": "https://stackoverflow.com/users/1902010/ceejayoz"}, "edited": false, "score": 2, "creation_date": 1555895722, "post_id": 55788123, "comment_id": 98246449, "body": "Did you relaunch your terminal for the <code>.bash_profile</code> to take effect? Are you <i>using</i> Bash? Have you done <code>echo $PATH</code> in the terminal to make sure the PATH is correct? Have you checked that <code>&#47;usr&#47;local&#47;go&#47;bin</code> exists?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11383260"}, "reply_to_user": {"reputation": 165027, "user_id": 1902010, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a19f9308334d07d4be19c8f6d11151ff?s=128&d=identicon&r=PG", "display_name": "ceejayoz", "link": "https://stackoverflow.com/users/1902010/ceejayoz"}, "edited": false, "score": 1, "creation_date": 1555895928, "post_id": 55788123, "comment_id": 98246467, "body": "Didnt knew that I had to close and open a new Terminal Window. I just did echo $PATH and it spit out this and I dont even know what Im looking at : /home/ec2-user/ec2-user/GoServerFolder/bin:/usr/local/go/bin&zwnj;&#8203;:/usr/local/bin:/usr&zwnj;&#8203;/bin:/usr/local/sbin&zwnj;&#8203;:/usr/sbin:/home/ec2&zwnj;&#8203;-user/.local/bin:/ho&zwnj;&#8203;me/ec2-user/bin"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11383260"}, "reply_to_user": {"reputation": 165027, "user_id": 1902010, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a19f9308334d07d4be19c8f6d11151ff?s=128&d=identicon&r=PG", "display_name": "ceejayoz", "link": "https://stackoverflow.com/users/1902010/ceejayoz"}, "edited": false, "score": 0, "creation_date": 1555896032, "post_id": 55788123, "comment_id": 98246476, "body": "I dont know why it spit out &quot;ec2-user&quot; 2 times, because I only have 1 folder with that name."}, {"owner": {"user_type": "does_not_exist", "display_name": "user11383260"}, "reply_to_user": {"reputation": 165027, "user_id": 1902010, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a19f9308334d07d4be19c8f6d11151ff?s=128&d=identicon&r=PG", "display_name": "ceejayoz", "link": "https://stackoverflow.com/users/1902010/ceejayoz"}, "edited": false, "score": 0, "creation_date": 1555896190, "post_id": 55788123, "comment_id": 98246496, "body": "@ceejayoz Do you think everything is fine? Am I over reacting?"}, {"owner": {"reputation": 165027, "user_id": 1902010, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a19f9308334d07d4be19c8f6d11151ff?s=128&d=identicon&r=PG", "display_name": "ceejayoz", "link": "https://stackoverflow.com/users/1902010/ceejayoz"}, "edited": false, "score": 0, "creation_date": 1555896294, "post_id": 55788123, "comment_id": 98246514, "body": "Well, does <code>go version</code> work after relaunching your terminal?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11383260"}, "reply_to_user": {"reputation": 165027, "user_id": 1902010, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a19f9308334d07d4be19c8f6d11151ff?s=128&d=identicon&r=PG", "display_name": "ceejayoz", "link": "https://stackoverflow.com/users/1902010/ceejayoz"}, "edited": false, "score": 0, "creation_date": 1555896865, "post_id": 55788123, "comment_id": 98246598, "body": "Yes &quot;go version&quot; works."}, {"owner": {"reputation": 165027, "user_id": 1902010, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a19f9308334d07d4be19c8f6d11151ff?s=128&d=identicon&r=PG", "display_name": "ceejayoz", "link": "https://stackoverflow.com/users/1902010/ceejayoz"}, "edited": false, "score": 0, "creation_date": 1555897130, "post_id": 55788123, "comment_id": 98246626, "body": "Then it sounds like things work fine. <code>$PATH</code> tells your terminal where to look for executables, separated by <code>:</code> marks. You have several subfolders of <code>ec2-user</code>; that&#39;s fairly common."}], "answers": [{"tags": [], "owner": {"reputation": 165027, "user_id": 1902010, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a19f9308334d07d4be19c8f6d11151ff?s=128&d=identicon&r=PG", "display_name": "ceejayoz", "link": "https://stackoverflow.com/users/1902010/ceejayoz"}, "is_accepted": true, "score": 1, "last_activity_date": 1555897170, "creation_date": 1555897170, "answer_id": 55788225, "question_id": 55788123, "link": "https://stackoverflow.com/questions/55788123/why-go-is-not-being-detected/55788225#55788225", "title": "Why Go is not being detected?", "body": "<p>Changes to your <code>.bash_profile</code> file only take effect after you relaunch the terminal.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/4608187/how-to-reload-bash-profile-from-the-command-line\"><code>source ~/.bash_profile</code></a> will reload it in your current session, if you'd rather take that approach.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11383260"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 313, "favorite_count": 0, "accepted_answer_id": 55788225, "answer_count": 1, "score": -2, "last_activity_date": 1555897170, "creation_date": 1555895560, "question_id": 55788123, "link": "https://stackoverflow.com/questions/55788123/why-go-is-not-being-detected", "title": "Why Go is not being detected?", "body": "<p>I'm trying to install Go, gRPC and Protobuf but I cant even install Go in the first place.</p>\n\n<p>I followed steps mentioned in this site: </p>\n\n<pre><code>https://tecadmin.net/install-go-on-centos/\n</code></pre>\n\n<p>My bash_profile file looks like this now:</p>\n\n<pre><code>http://prntscr.com/nf2bm9\n</code></pre>\n\n<p>And when I try to test go installation by typing \"go version\" in the console I get this error:</p>\n\n<pre><code>-bash: go: command not found\n</code></pre>\n\n<p>Where did I go wrong? </p>\n\n<p>Note: I navigated to /usr/local/ to see if there is any go folder with files or not to confirm the files has been downloaded and moved at the right place.</p>\n"}, {"tags": ["go", "biginteger"], "answers": [{"tags": [], "owner": {"reputation": 69, "user_id": 9590203, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-THzr86CKlwk/AAAAAAAAAAI/AAAAAAAACJE/wv5BlZdDoBA/photo.jpg?sz=128", "display_name": "vbujym ", "link": "https://stackoverflow.com/users/9590203/vbujym"}, "is_accepted": false, "score": 0, "last_activity_date": 1555888550, "creation_date": 1555888550, "answer_id": 55787562, "question_id": 55787492, "link": "https://stackoverflow.com/questions/55787492/subtraction-of-large-numbers-golang/55787562#55787562", "title": "Subtraction of large numbers golang", "body": "<p>mde.... .......</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    i := new(big.Int)\n    i.SetString(\"113792089237316195423570985008687907853269984665640564039457584007908834671645\", 10)\n    k := new(big.Int)\n    k.SetString(\"20277110887056303803699431755396003735040374760118964734768299847012543114150\", 10) \n    c := big.NewInt(0).Sub(i, k)\n    fmt.Println(\"c =\", c)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/AuGj9A93FbP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/AuGj9A93FbP</a></p>\n"}, {"tags": [], "owner": {"reputation": 98, "user_id": 3000543, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/53af8524a71601fa4c4152ec372f9ae3?s=128&d=identicon&r=PG&f=1", "display_name": "Voz", "link": "https://stackoverflow.com/users/3000543/voz"}, "is_accepted": true, "score": 3, "last_activity_date": 1555889372, "creation_date": 1555889372, "answer_id": 55787632, "question_id": 55787492, "link": "https://stackoverflow.com/questions/55787492/subtraction-of-large-numbers-golang/55787632#55787632", "title": "Subtraction of large numbers golang", "body": "<p>Looks like you need to be using <code>big.Int.SetString</code> in your code. Here's a playground link, works there: <a href=\"https://play.golang.org/p/HvEke4g7e8V\" rel=\"nofollow noreferrer\">https://play.golang.org/p/HvEke4g7e8V</a></p>\n\n<p>For those who don't want to click a link:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    a, _ := new(big.Int).SetString(\"113792089237316195423570985008687907853269984665640564039457584007908834671645\", 10)\n    b, _ := new(big.Int).SetString(\"20277110887056303803699431755396003735040374760118964734768299847012543114150\", 10)\n    c := big.NewInt(0).Sub(a, b)\n    fmt.Println(\"c =\", c)\n}\n\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 9590203, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-THzr86CKlwk/AAAAAAAAAAI/AAAAAAAACJE/wv5BlZdDoBA/photo.jpg?sz=128", "display_name": "vbujym ", "link": "https://stackoverflow.com/users/9590203/vbujym"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1263, "favorite_count": 0, "accepted_answer_id": 55787632, "answer_count": 2, "score": -2, "last_activity_date": 1555988930, "creation_date": 1555887803, "last_edit_date": 1555988930, "question_id": 55787492, "link": "https://stackoverflow.com/questions/55787492/subtraction-of-large-numbers-golang", "title": "Subtraction of large numbers golang", "body": "<p>I did not think that I would have to write about it, but nowhere can I find at least an example of subtracting large numbers</p>\n\n<p>So I have two numbers and I want to subtract them, the library says that there is only a limit on memory, however, when I try to subtract two 256-bit numbers I get an error.</p>\n\n<p>Tell me what to do with it and how to solve it?\nI began to study Go, everything seems to be so cool, however I constantly encounter similar questions. What's wrong.......</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    a := big.NewInt(113792089237316195423570985008687907853269984665640564039457584007908834671645)\n    b := big.NewInt(20277110887056303803699431755396003735040374760118964734768299847012543114150)\n    c := big.NewInt(0).Sub(a, b)\n    fmt.Println(\"c =\", c)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>*prog.go:9:18: constant 113792089237316195423570985008687907853269984665640564039457584007908834671645 overflows int64\nprog.go:10:18: constant 20277110887056303803699431755396003735040374760118964734768299847012543114150 overflows int64*\n</code></pre>\n\n<p>I'm using go version go1.12.4 linux/amd64</p>\n\n<p>this code in playground:\n<a href=\"https://play.golang.org/p/AY8Z8kkCRdg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/AY8Z8kkCRdg</a></p>\n"}, {"tags": ["c++", "go"], "comments": [{"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 1, "creation_date": 1555935783, "post_id": 55787091, "comment_id": 98257585, "body": "There&#39;s an extensive discussion in this issue: <a href=\"https://github.com/golang/go/issues/5045\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/5045</a>"}, {"owner": {"reputation": 175, "user_id": 11120912, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pFWJF.jpg?s=128&g=1", "display_name": "api", "link": "https://stackoverflow.com/users/11120912/api"}, "reply_to_user": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1556002220, "post_id": 55787091, "comment_id": 98279235, "body": "I just read it hard and find that they are seems to discuss more &quot;try to design a concrete model against 95% scene&quot; than &quot;give many models and let user choose&quot; like c++11. However, the discussion seems useless to my problem."}], "answers": [{"comments": [{"owner": {"reputation": 175, "user_id": 11120912, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pFWJF.jpg?s=128&g=1", "display_name": "api", "link": "https://stackoverflow.com/users/11120912/api"}, "edited": false, "score": 0, "creation_date": 1575827475, "post_id": 58892365, "comment_id": 104687789, "body": "Thanks, at least i won&#39;t worry about x86/amd64 for its strongly ordered architecture. At the other hand, if atomic.Load* and atomic.Store* are seqconst in golang, there should have fence instructions relevant to gurantee it. But i can&#39;t find any fence there."}, {"owner": {"reputation": 18225, "user_id": 152580, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/34b114b30616ba935061582133cceeb8?s=128&d=identicon&r=PG", "display_name": "Eloff", "link": "https://stackoverflow.com/users/152580/eloff"}, "reply_to_user": {"reputation": 175, "user_id": 11120912, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pFWJF.jpg?s=128&g=1", "display_name": "api", "link": "https://stackoverflow.com/users/11120912/api"}, "edited": false, "score": 0, "creation_date": 1578409613, "post_id": 58892365, "comment_id": 105424068, "body": "If you look in <code>src&#47;runtime&#47;internal&#47;atomic&#47;asm_amd64.s</code> you&#39;ll find the store instructions use an implicit fence with the XCHG instruction. So I stand by the sequential consistency claim."}, {"owner": {"reputation": 175, "user_id": 11120912, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pFWJF.jpg?s=128&g=1", "display_name": "api", "link": "https://stackoverflow.com/users/11120912/api"}, "edited": false, "score": 0, "creation_date": 1580966553, "post_id": 58892365, "comment_id": 106273296, "body": "I can understand xchg instruction on x86/amd64 has a implicit sfence, and mov has acquire semantic or lfence on strongly ordered architecture like x86/amd64. what makes me confused is lfence&amp;&amp;sfence == sequential-consistency or lfence||sfence==sequential-consistency, which statement is right. I choose the former, so i evolve that golang should give explicit full-fence instruction instead of implicit half-fence to gurantee sequential consistency."}, {"owner": {"reputation": 18225, "user_id": 152580, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/34b114b30616ba935061582133cceeb8?s=128&d=identicon&r=PG", "display_name": "Eloff", "link": "https://stackoverflow.com/users/152580/eloff"}, "reply_to_user": {"reputation": 175, "user_id": 11120912, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pFWJF.jpg?s=128&g=1", "display_name": "api", "link": "https://stackoverflow.com/users/11120912/api"}, "edited": false, "score": 0, "creation_date": 1581098545, "post_id": 58892365, "comment_id": 106329336, "body": "I&#39;ve wondered about that myself, but I don&#39;t know for sure. Please open a ticket on the Go issue tracker about it."}], "tags": [], "owner": {"reputation": 18225, "user_id": 152580, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/34b114b30616ba935061582133cceeb8?s=128&d=identicon&r=PG", "display_name": "Eloff", "link": "https://stackoverflow.com/users/152580/eloff"}, "is_accepted": false, "score": 2, "last_activity_date": 1573918716, "creation_date": 1573918716, "answer_id": 58892365, "question_id": 55787091, "link": "https://stackoverflow.com/questions/55787091/does-golang-atomic-load-have-a-acquire-semantics/58892365#58892365", "title": "Does golang atomic.Load have a acquire semantics?", "body": "<p>On strongly ordered architectures like x86/amd64, acquire load and release store are just regular loads and stores. To make them atomic you need to ensure the memory is aligned to the operand size (automatic in Go), and that the compiler doesn't re-order them in incompatible ways, or optimize them away (e.g. reuse a value in a register instead of reading it from memory.)</p>\n\n<p>The Go atomic Load* and Store* functions are sequentially consistent. This is a stronger form of memory ordering that requires memory fences (or instructions that have an implicit memory fence) even on x86/amd64.</p>\n\n<p>Quoting rsc: </p>\n\n<blockquote>\n  <p>Go's atomics guarantee sequential consistency among the atomic\n  variables (behave like C/C++'s seqconst atomics), and that you\n  shouldn't mix atomic and non-atomic accesses for a given memory word.</p>\n</blockquote>\n"}], "owner": {"reputation": 175, "user_id": 11120912, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pFWJF.jpg?s=128&g=1", "display_name": "api", "link": "https://stackoverflow.com/users/11120912/api"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 535, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1573918716, "creation_date": 1555883616, "last_edit_date": 1555944756, "question_id": 55787091, "link": "https://stackoverflow.com/questions/55787091/does-golang-atomic-load-have-a-acquire-semantics", "title": "Does golang atomic.Load have a acquire semantics?", "body": "<p>Given a c++ code snip:</p>\n\n<pre><code>int a = 0;\natomic&lt;int&gt; b{0};\n\nThread 1                         \na = 1;\nb.store(1,memory_order_release);\n\nThread 2\nwhile(!b.load(memory_order_acquire)); \nassert(a==1);\n</code></pre>\n\n<p>We know the assert never fire.</p>\n\n<p>At the other hand, golang <a href=\"https://github.com/golang/go/blob/68d4b1265ec7915dccfccf6c0e32f9ab2d9c3a86/src/runtime/internal/atomic/asm_amd64.s#L130\" rel=\"nofollow noreferrer\">atomic.Store</a> uses xchg instruction which implicts memory-barrier, so it can result in memory_order_release semantics as c++11. </p>\n\n<pre><code>//go:noescape\nfunc Store(ptr *uint32, val uint32)\nTEXT runtime\u2215internal\u2215atomic\u00b7Store(SB), NOSPLIT, $0-12\n    MOVQ    ptr+0(FP), BX\n    MOVL    val+8(FP), AX\n    XCHGL   AX, 0(BX)\n    RET\n</code></pre>\n\n<p>However, the implementation of <a href=\"https://github.com/golang/go/blob/68d4b1265ec7915dccfccf6c0e32f9ab2d9c3a86/src/runtime/internal/atomic/atomic_amd64x.go#L11\" rel=\"nofollow noreferrer\">atomic.Load</a> is pure go code, which means just mov instruction when assembly.</p>\n\n<pre><code>//go:nosplit\n//go:noinline\nfunc Load(ptr *uint32) uint32 {\n    return *ptr\n}\n</code></pre>\n\n<p>So, does golang atomic.Load have a acquire semantics?<br>\nIf do how it works, and if not how to insure memory-ordering or make a=1 visible? </p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1555883021, "post_id": 55786898, "comment_id": 98244505, "body": "Link against any shared libraries available in <code>golang:1.11</code> and not in <code>alpine</code>, and you&#39;re having a bad day with this Dockerfile. If you want to rule that out, <code>ldd</code> (run inside the alpine image) is your friend."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1585925635, "post_id": 55786898, "comment_id": 107944385, "body": "@poc What was missing in my answer?"}, {"owner": {"reputation": 1470, "user_id": 3913746, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/c2d9ec6f6da29d8e0b3b22fe37dec448?s=128&d=identicon&r=PG&f=1", "display_name": "pocockn", "link": "https://stackoverflow.com/users/3913746/pocockn"}, "edited": false, "score": 1, "creation_date": 1585925978, "post_id": 55786898, "comment_id": 107944592, "body": "The issue was that I was building for the wrong architecture! Appreciate the post, thank you."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 3, "last_activity_date": 1555882458, "creation_date": 1555882458, "answer_id": 55786959, "question_id": 55786898, "link": "https://stackoverflow.com/questions/55786898/standard-init-linux-go190-exec-user-process-caused-exec-format-error-when-ru/55786959#55786959", "title": "standard_init_linux.go:190: exec user process caused &quot;exec format error&quot; when running Go binary", "body": "<p>Check if this is similar to <a href=\"https://github.com/containers/buildah/issues/475#issuecomment-397861089\" rel=\"nofollow noreferrer\"><code>containers/buildah</code> issue 475 </a>:</p>\n\n<blockquote>\n  <p>I think it is because the system does not know how to execute the file.<br>\n  FYI: <a href=\"https://stackoverflow.com/a/17900932/6309\">What's the appropriate Go shebang line?</a></p>\n  \n  <p>Also be aware of the difference between the <a href=\"https://docs.docker.com/engine/reference/builder/#entrypoint\" rel=\"nofollow noreferrer\">shell form and exec form</a> of CMD/ENTRYPOINT in Dockerfile.</p>\n  \n  <p>just adding <code>#!/bin/bash</code> to my entry point file fixed the issue.</p>\n</blockquote>\n\n<p>Or:</p>\n\n<blockquote>\n  <p>Turns out the <code>#!/bin/bash</code> was in my entry point file, but since I did a copy and paste into that file, the first line was a newline, not the <code>#!/bin/bash</code>, effectively ignoring it.<br>\n  If this helps anyone as well: Deleted the empty line and all worked fine.</p>\n</blockquote>\n\n<p>Or:</p>\n\n<blockquote>\n  <p>In case anyone finds this useful, you can get this issue if your shell script uses CRLF for line endings and/or UTF-8 with BOM (e.g. if you created a shell script file in Visual Studio).<br>\n  Changing to LF only and straight UTF-8 fixed it for me.</p>\n</blockquote>\n\n<p>Or (probably not your case, but to be complete):</p>\n\n<blockquote>\n  <p>For anyone who got a <code>standard_init_linux.go:190: exec user process caused \"no such file or directory\"</code> error after applying this fix, you're probably on an alpine base image which does not come with bash.</p>\n  \n  <p>Replacing <code>#!/bin/bash</code> with <code>#!/bin/sh</code> will do the trick!</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 1166, "user_id": 55049, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/784247c4145b0d2cfc0827bb67256943?s=128&d=identicon&r=PG", "display_name": "perelin", "link": "https://stackoverflow.com/users/55049/perelin"}, "is_accepted": true, "score": 8, "last_activity_date": 1589532793, "last_edit_date": 1589532793, "creation_date": 1574426950, "answer_id": 58994636, "question_id": 55786898, "link": "https://stackoverflow.com/questions/55786898/standard-init-linux-go190-exec-user-process-caused-exec-format-error-when-ru/58994636#58994636", "title": "standard_init_linux.go:190: exec user process caused &quot;exec format error&quot; when running Go binary", "body": "<p>I had the same error message. For me the fix was to cross build the for the right architecture. In my case amd64. Like this:</p>\n\n<pre><code>RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -a -installsuffix cgo -o [OUTPUT] .\n</code></pre>\n"}], "owner": {"reputation": 1470, "user_id": 3913746, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/c2d9ec6f6da29d8e0b3b22fe37dec448?s=128&d=identicon&r=PG&f=1", "display_name": "pocockn", "link": "https://stackoverflow.com/users/3913746/pocockn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6207, "favorite_count": 2, "accepted_answer_id": 58994636, "answer_count": 2, "score": 8, "last_activity_date": 1589532793, "creation_date": 1555882000, "last_edit_date": 1556026786, "question_id": 55786898, "link": "https://stackoverflow.com/questions/55786898/standard-init-linux-go190-exec-user-process-caused-exec-format-error-when-ru", "title": "standard_init_linux.go:190: exec user process caused &quot;exec format error&quot; when running Go binary", "body": "<p>I am attempting to create a container with my Go binary in for use as a database migrator. If I run the binary it works perfectly, however, I am struggling to put it into a container and run it in my docker-compose stack. </p>\n\n<p>Below is my Dockerfile.</p>\n\n<pre><code>FROM golang:1.11 AS build_base\n\nWORKDIR /app\n\nENV GO111MODULE=on\n# We want to populate the module cache based on the go.{mod,sum} files.\nCOPY go.mod .\nCOPY go.sum .\nRUN go mod download\n\nFROM build_base AS binary_builder\n# Here we copy the rest of the source code\nCOPY . .\n\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build\n\n#In this last stage, we start from a fresh Alpine image, to reduce the image size and not ship the Go compiler in our production artifacts.\nFROM alpine AS database-migrator\n# We add the certificates to be able to verify remote instances\nRUN apk add ca-certificates\nCOPY --from=binary_builder /app /app\n\nENTRYPOINT [\"/app/binary-name\"]\n</code></pre>\n\n<p>When I run my docker-compose stack the MySQL database gets setup correctly but I receive this error in the logs for my database migrator container.</p>\n\n<blockquote>\n  <p>data-migrator_1  | standard_init_linux.go:190: exec user process caused \"exec format error\"</p>\n</blockquote>\n"}, {"tags": ["docker", "go", "golang-migrate"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 2, "last_activity_date": 1555878165, "creation_date": 1555878165, "answer_id": 55786444, "question_id": 55786159, "link": "https://stackoverflow.com/questions/55786159/include-go-dependencies-in-docker-container-using-mono-repo/55786444#55786444", "title": "Include Go dependencies in Docker container using mono repo", "body": "<blockquote>\n  <p>By placing a go.mod inside the service it feels like I'm losing the advantage of services sharing dependencies within the repo.</p>\n</blockquote>\n\n<p>Yet, this is an approach seen <a href=\"https://dev.to/plutov/docker-and-go-modules-3kkn\" rel=\"nofollow noreferrer\">here</a> or <a href=\"https://container-solutions.com/faster-builds-in-docker-with-go-1-11/\" rel=\"nofollow noreferrer\">there</a>, where <code>COPY go.mod .</code> (and <code>COPY go.sum .</code>) is followed by <code>RUN go mod download</code>.</p>\n\n<pre><code>#This is the \u2018magic\u2019 step that will download all the dependencies that are specified in \n# the go.mod and go.sum file.\n# Because of how the layer caching system works in Docker, the  go mod download \n# command will _ only_ be re-run when the go.mod or go.sum file change \n# (or when we add another docker instruction this line)\nRUN go mod download\n</code></pre>\n"}], "owner": {"reputation": 1470, "user_id": 3913746, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/c2d9ec6f6da29d8e0b3b22fe37dec448?s=128&d=identicon&r=PG&f=1", "display_name": "pocockn", "link": "https://stackoverflow.com/users/3913746/pocockn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 1, "accepted_answer_id": 55786444, "answer_count": 1, "score": 2, "last_activity_date": 1555878165, "creation_date": 1555875915, "question_id": 55786159, "link": "https://stackoverflow.com/questions/55786159/include-go-dependencies-in-docker-container-using-mono-repo", "title": "Include Go dependencies in Docker container using mono repo", "body": "<p>I have a mono repo with the structure.</p>\n\n<pre><code>mono-repo\n- serviceA\n - main.go\n - Dockerfile\n-serviceB\n - main.go\n - Dockerfile\ngo.mod\ngo.sum\n</code></pre>\n\n<p>The Dockerfile in serviceA contains the following code.</p>\n\n<pre><code>FROM golang\n\nENV GO111MODULE=on\n\nWORKDIR /app\n\nCOPY . .\n\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build\n\nENTRYPOINT [\"/app/serviceA\"]\n</code></pre>\n\n<p>I want to build the Docker image and include the dependencies from the root of my mono-repo inside the container, I am currently receiving an error saying it can't find any of the dependency packages when I run </p>\n\n<blockquote>\n  <p>docker build -t serviceA .</p>\n</blockquote>\n\n<p>Unless I place a go.mod inside serviceA I can't see a nice way of achieving what I want. By placing a go.mod inside the service it feels like I'm losing the advantage of services sharing dependencies within the repo.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3056, "user_id": 586229, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/fWSco.png?s=128&g=1", "display_name": "hoijui", "link": "https://stackoverflow.com/users/586229/hoijui"}, "is_accepted": true, "score": 5, "last_activity_date": 1555874185, "creation_date": 1555874185, "answer_id": 55785909, "question_id": 55785908, "link": "https://stackoverflow.com/questions/55785908/how-to-use-os-or-arch-specific-code-in-go/55785909#55785909", "title": "How to use OS or Arch specific code in Go", "body": "<p>Write a wrapper source file per unique code configuration.</p>\n\n<p><em>PS:</em> I think windows supports neither <code>Dup2</code> nor <code>Dup3</code>.</p>\n\n<p><em>syscall_wrapper.go</em></p>\n\n<pre><code>// +build !windows\n// +build !arm\n// +build !arm64\n\npackage mypkg\n\nimport (\n    \"syscall\"\n)\n\nfunc Dup2(oldfd int, newfd int) {\n    syscall.Dup2(oldfd, newfd)\n}\n</code></pre>\n\n<p><em>syscall_wrapper_arm.go</em></p>\n\n<pre><code>// +build !windows\n// +build arm arm64\n\npackage mypkg\n\nimport (\n    \"syscall\"\n)\n\nfunc Dup2(oldfd int, newfd int) {\n    syscall.Dup3(oldfd, newfd, 0)\n}\n</code></pre>\n\n<p>The essential part, used for example by <code>go build</code>, is the <code>// +build</code> part. Details for how to use this can be found here:</p>\n\n<ul>\n<li><a href=\"https://golang.org/pkg/go/build/#hdr-Build_Constraints\" rel=\"noreferrer\">Build Constraints</a></li>\n<li><a href=\"https://gist.github.com/asukakenji/f15ba7e588ac42795f421b48b8aede63#go-golang-goos-and-goarch\" rel=\"noreferrer\">OS &amp; Arch values</a></li>\n</ul>\n"}], "owner": {"reputation": 3056, "user_id": 586229, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/fWSco.png?s=128&g=1", "display_name": "hoijui", "link": "https://stackoverflow.com/users/586229/hoijui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 55785909, "answer_count": 1, "score": 2, "last_activity_date": 1555874185, "creation_date": 1555874185, "question_id": 55785908, "link": "https://stackoverflow.com/questions/55785908/how-to-use-os-or-arch-specific-code-in-go", "title": "How to use OS or Arch specific code in Go", "body": "<p>Apparently, <code>syscall.Dup2</code> does not exist on ARM systems, and <code>syscall.Dup3</code> does not exisxt on darwin (OSX). This means I could use <code>syscall.Dup3</code> on ARM, and <code>syscall.Dup2</code> on other platforms, for example.</p>\n\n<p>How would I do that?</p>\n"}, {"tags": ["go", "locking", "mutex", "heap-memory", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555944224, "post_id": 55785524, "comment_id": 98261336, "body": "I&#39;m not sure what &quot;SHeap&quot; refers to here, but locking a memory address is not something you should be attempting. Mutexes only work if all participants use the lock; main <i>must</i> acquire a lock before reading shared memory."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555944427, "post_id": 55785524, "comment_id": 98261451, "body": "It seems like you have a strong Java background and you may be carrying a little too much of that experience over into your Go programming. Go is very different from Java; while the syntax is superficially similar, good Go code works and is written very differently. The standard Java interface/impl pattern is <i>very</i> un-Go. Goroutines and threads are not equivalent, and neither is equivalent to forking a process. Channels are preferred over locking when possible, and when not, mutexes are <i>the</i> lock mechanism."}], "answers": [{"tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": false, "score": 1, "last_activity_date": 1555908207, "creation_date": 1555908207, "answer_id": 55789213, "question_id": 55785524, "link": "https://stackoverflow.com/questions/55785524/acquiring-a-lock-over-a-memory-address-instead-of-variable-in-golang/55789213#55789213", "title": "Acquiring a lock over a memory address instead of variable in golang", "body": "<p>I don't think you can lock variables in Go. You can only lock a code section.</p>\n\n<pre><code>m.Lock()\n// do stuff\nm.Unlock()\n</code></pre>\n\n<p>You are creating a problem for yourself out of nothing by using the \"interface\" vs \"Impl\" pattern.</p>\n\n<p>You can make your life simpler by just using a regular function. Then you can put the lock inside a function and be guaranteed that it will be protected.</p>\n\n<p>Since you are making an interface, you can't guarantee anything about the content of the function that implements the interface.</p>\n"}, {"tags": [], "owner": {"reputation": 452, "user_id": 3934499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0005554c3b863a1bb17a6aca5a40acfa?s=128&d=identicon&r=PG&f=1", "display_name": "agyeya", "link": "https://stackoverflow.com/users/3934499/agyeya"}, "is_accepted": false, "score": 0, "last_activity_date": 1555950774, "creation_date": 1555950774, "answer_id": 55797720, "question_id": 55785524, "link": "https://stackoverflow.com/questions/55785524/acquiring-a-lock-over-a-memory-address-instead-of-variable-in-golang/55797720#55797720", "title": "Acquiring a lock over a memory address instead of variable in golang", "body": "<p>Variables can't be locked. So what I am trying to do is not possible.\nThe work-around I did was to add a <code>RWMutex</code> into SetterImpl and doing </p>\n\n<pre><code>mux.RLock()\ndefer mux.RUnlock()\n</code></pre>\n\n<p>in getters of a and b in SetterImpl. And when I want to set a and b in FORKED, I used</p>\n\n<pre><code>mux.Lock()\ndefer mux.Unlock()\n</code></pre>\n\n<p>This way, if a write lock is acquired by FORKED, no read lock can be acquired at that time. This is possible as the RWLock field created in SHeap is used as global variable (i.e. this mutex is never changed and passed along FORKED)</p>\n"}], "owner": {"reputation": 452, "user_id": 3934499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0005554c3b863a1bb17a6aca5a40acfa?s=128&d=identicon&r=PG&f=1", "display_name": "agyeya", "link": "https://stackoverflow.com/users/3934499/agyeya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1555950774, "creation_date": 1555871024, "last_edit_date": 1555905687, "question_id": 55785524, "link": "https://stackoverflow.com/questions/55785524/acquiring-a-lock-over-a-memory-address-instead-of-variable-in-golang", "title": "Acquiring a lock over a memory address instead of variable in golang", "body": "<p>I have an interface called Setter. Struct called SetterImpl implements this interface and has 2 setters, all of which set 2 interfaces.</p>\n\n<pre><code>type Setter interface {\n    A() *AInterface\n    B() *BInterface\n}\ntype SetterImpl struct {\n    a *AInterface\n    b *BInterface\n}\n\nfunc (s *SetterImpl) A(a *AInterface) {\n    a = a\n}\n\nfunc (s *SetterImpl) B(b *AInterface) {\n    b = b\n}\n\nfunc returnSetter(a *AInterface, b *BInterface) Setter {\n    return &amp;SetterImpl{a:a, b:b}\n}\n</code></pre>\n\n<p>The setter returned by the above method is in heap(say SHeap) and sent to gRPC server. Now, I want to update a and b within the SetterImpl such that the gRPC server uses the new values. </p>\n\n<p>So I have 2 goroutines now; one is gRPC server main goroutine(say MAIN), another is a forked one(say FORKED) which simply is to update the setter fields. </p>\n\n<p>If I use Mutex in FORKED, that is essentially adding a fence (like java). It does not lock any variables actually(except itself).\nI do not want MAIN to be able to read a and b stored in SHeap while FORKED updates them. The API threads(goroutines) in the server do not acquire Read Mutex before reading values in SHeap. So, is it even possible to do what I am trying to achieve? If yes, how do I achieve this?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "edited": false, "score": 0, "creation_date": 1555861682, "post_id": 55783986, "comment_id": 98239232, "body": "I didn&#39;t think <code>go get</code> was still necessary but dependencies were fetched as part of the build process..."}, {"owner": {"reputation": 49, "user_id": 8216283, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xfttY.jpg?s=128&g=1", "display_name": "nrxr", "link": "https://stackoverflow.com/users/8216283/nrxr"}, "reply_to_user": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "edited": false, "score": 0, "creation_date": 1556033310, "post_id": 55783986, "comment_id": 98296032, "body": "Yes, you can ideally just <code>go mod init &amp;&amp; go build</code> but I didn&#39;t had any actual code, hence my need for a <code>go get</code>.  Your error said it could not find a module providing panicwrap, get a go get for bugsnag-go did resolve it, so there was something else failing in your setup and the go get fixes it."}, {"owner": {"reputation": 49, "user_id": 8216283, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xfttY.jpg?s=128&g=1", "display_name": "nrxr", "link": "https://stackoverflow.com/users/8216283/nrxr"}, "reply_to_user": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "edited": false, "score": 0, "creation_date": 1556033609, "post_id": 55783986, "comment_id": 98296189, "body": "Oh, actually, you don&#39;t have <code>GO111MODULE=on</code> set in your <code>Dockerfile</code>. Anyway, the recommended setup in the <code>Dockerfile</code> is something like: ``` COPY go.mod . COPY go.sum .  RUN go mod download  COPY . ./ ```  This way you can actually cache the vendored libraries."}], "tags": [], "owner": {"reputation": 49, "user_id": 8216283, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xfttY.jpg?s=128&g=1", "display_name": "nrxr", "link": "https://stackoverflow.com/users/8216283/nrxr"}, "is_accepted": false, "score": 0, "last_activity_date": 1555859788, "creation_date": 1555859788, "answer_id": 55783986, "question_id": 55782988, "link": "https://stackoverflow.com/questions/55782988/how-can-i-use-go-modules-to-pull-a-dependency-by-commit-hash-or-branch/55783986#55783986", "title": "How can I use Go modules to pull a dependency by commit hash or branch?", "body": "<p>You're doing something wrong, because it works. It does not need a <code>go.mod</code> in order to work with <code>go.mod</code>-based applications:</p>\n\n<pre><code>nrxr at lise in ~/code/src/github.com/nrxr/stack\n$ go mod init\ngo: creating new go.mod: module github.com/nrxr/stack\n\nnrxr at lise in ~/code/src/github.com/nrxr/stack\n$ go get github.com/bugsnag/bugsnag-go\ngo: finding github.com/bugsnag/bugsnag-go v1.5.1\ngo: downloading github.com/bugsnag/bugsnag-go v1.5.1\ngo: extracting github.com/bugsnag/bugsnag-go v1.5.1\ngo: finding github.com/bugsnag/panicwrap v1.2.0\ngo: downloading github.com/bugsnag/panicwrap v1.2.0\ngo: finding github.com/gofrs/uuid v3.2.0+incompatible\ngo: downloading github.com/gofrs/uuid v3.2.0+incompatible\ngo: extracting github.com/bugsnag/panicwrap v1.2.0\ngo: extracting github.com/gofrs/uuid v3.2.0+incompatible\ngo: finding github.com/kardianos/osext latest\ngo: downloading github.com/kardianos/osext v0.0.0-20190222173326-2bc1f35cddc0\ngo: extracting github.com/kardianos/osext v0.0.0-20190222173326-2bc1f35cddc0\n\nnrxr at lise in ~/code/src/github.com/nrxr/stack\n$ cat go.mod\nmodule github.com/nrxr/stack\n\ngo 1.12\n\nrequire (\n        github.com/bugsnag/bugsnag-go v1.5.1 // indirect\n        github.com/bugsnag/panicwrap v1.2.0 // indirect\n        github.com/gofrs/uuid v3.2.0+incompatible // indirect\n        github.com/kardianos/osext v0.0.0-20190222173326-2bc1f35cddc0 // indirect\n)\n</code></pre>\n\n<p>Maybe try again? Try with what I just used here.</p>\n"}], "owner": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 853, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1555859788, "creation_date": 1555852003, "question_id": 55782988, "link": "https://stackoverflow.com/questions/55782988/how-can-i-use-go-modules-to-pull-a-dependency-by-commit-hash-or-branch", "title": "How can I use Go modules to pull a dependency by commit hash or branch?", "body": "<p>I'm trying to upgrade my project to use Go modules for dependency management.  I recognize this a new/experimental feature.  I'm getting an error: <code>cannot find module providing package</code>.</p>\n\n<p>My <code>go.mod</code> currently reads:</p>\n\n<pre><code>require (\n    github.com/bugsnag/bugsnag-go v1.5.1\n    github.com/bwmarrin/discordgo v0.19.0\n    github.com/jonas747/dshardmanager v0.0.0-20180911185241-9e4282faed43\n)\n</code></pre>\n\n<p>My Dockerfile:</p>\n\n<pre><code>FROM golang:1.12-alpine\nRUN mkdir /app\nWORKDIR /app\nADD src/ /app\n\nENV CGO_ENABLED=0\n\n# Building requires git because we're pulling a dependency by commit hash\nRUN apk add --no-cache --update git \\\n    &amp;&amp; go build ./... \\\n    &amp;&amp; apk del git\n\nCMD [\"/app/main\"]\n</code></pre>\n\n<p>When building, it fails with:</p>\n\n<pre><code>cannot load github.com/bugsnag/panicwrap: cannot find module providing package github.com/bugsnag/panicwrap\n</code></pre>\n\n<p>When I look at <a href=\"https://github.com/bugsnag/bugsnag-go\" rel=\"nofollow noreferrer\">https://github.com/bugsnag/bugsnag-go</a> I don't see a <code>go.mod</code> file.  Is this error indicating that this dependency doesn't support modules?</p>\n"}, {"tags": ["go", "goland"], "answers": [{"comments": [{"owner": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "edited": false, "score": 0, "creation_date": 1555850527, "post_id": 55782756, "comment_id": 98236450, "body": "Since I&#39;m using Docker for this project, I actually don&#39;t need go installed locally.  So I noticed goland has the option when clicking the + to download the SDK for a given version.  Install go from the go web site did <i>not</i> populate this dropdown with the correct SDK version for me automatically."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1555912646, "post_id": 55782756, "comment_id": 98249262, "body": "You need to have Go installed on the local machine in order to develop on Go applications while using GoLand. Also If you install Go on your system then GoLand won&#39;t automatically detect where you installed it and you need to point the SDK chooser yourself."}], "tags": [], "owner": {"reputation": 408, "user_id": 2234099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/678915aaa580bada8ed32e01000274c2?s=128&d=identicon&r=PG", "display_name": "gngchrs", "link": "https://stackoverflow.com/users/2234099/gngchrs"}, "is_accepted": true, "score": 3, "last_activity_date": 1555850294, "last_edit_date": 1555850294, "creation_date": 1555849963, "answer_id": 55782756, "question_id": 55782656, "link": "https://stackoverflow.com/questions/55782656/how-can-i-keep-golangs-golang-version-and-my-dockerfile-in-sync/55782756#55782756", "title": "How can I keep golang&#39;s golang version and my Dockerfile in sync?", "body": "<p>Goland uses your Systems Go SDK, and not the one in the Dockerfile. </p>\n\n<p>If you go to Goland > Preferences > Go > Go Root, you will find the version that Goland is using, which will correspond to the version in you <code>External Libraries Section</code>.</p>\n\n<p>In this case, you may need to update your system installed go version to match the one in the dockerfile.</p>\n\n<p>It is also worth noting that while developing, Goland will allow you to choose which version of Go to build your project with. In the same settings mentioned above, you will see a title <code>For Current Project</code>, under the Go submenus. If you have multiple versions fo Go installed, you can select the sdk and let Goland handle the build.</p>\n"}], "owner": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 55782756, "answer_count": 1, "score": 0, "last_activity_date": 1555850294, "creation_date": 1555849100, "question_id": 55782656, "link": "https://stackoverflow.com/questions/55782656/how-can-i-keep-golangs-golang-version-and-my-dockerfile-in-sync", "title": "How can I keep golang&#39;s golang version and my Dockerfile in sync?", "body": "<p>I'm new to goland, trying to pick it up on my first project.  I'm noticing in goland that it doesn't show the same golang SDK that is pulled in through the container.</p>\n\n<p>Here's my Dockerfile:</p>\n\n<pre><code>FROM golang:1.12-alpine\nRUN mkdir /app\nWORKDIR /app\nADD src/ /app\n\nENV CGO_ENABLED=0\nENV GO111MODULE=off\n\n# Fetch application dependencies\nRUN apk add --no-cache --update git \\\n    &amp;&amp; go get github.com/bwmarrin/discordgo \\\n    &amp;&amp; go get github.com/jonas747/dshardmanager \\\n    &amp;&amp; go get github.com/bugsnag/bugsnag-go \\\n    &amp;&amp; apk del git\n\n# Build binary\nRUN go build -o main .\n\nCMD [\"/app/main\"]\n</code></pre>\n\n<p>But in goland you can see that it doesn't show the correct version.  <strong>Is there a way I can set this up so that goland always sees the version used in the container?</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/Pvocv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Pvocv.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go", "vue.js"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555944571, "post_id": 55781577, "comment_id": 98261530, "body": "This seems too broad for SO - you might try a more forum-like site (eg Reddit) if you want feedback on a broad application design sketch like this. SO can be more helpful for specific implementation questions."}, {"owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1555950839, "post_id": 55781577, "comment_id": 98264348, "body": "Agreed. I have found an approach I like, which is AJAX polling. And using a Timer."}, {"owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556040971, "post_id": 55781577, "comment_id": 98299896, "body": "Just for anyone else stumbling over this. You can use Server Side Events to do this is. Which is less tedious than WebSockets as you don&#39;t need the client to send any data."}], "answers": [{"tags": [], "owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "is_accepted": true, "score": 0, "last_activity_date": 1556041050, "creation_date": 1556041050, "answer_id": 55816671, "question_id": 55781577, "link": "https://stackoverflow.com/questions/55781577/ui-and-api-questions-for-a-long-running-process/55816671#55816671", "title": "UI and API Questions for a long running process", "body": "<p>Use Server Side Events. There are many libraries for Go that do this. </p>\n"}], "owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "closed_date": 1556041173, "accepted_answer_id": 55816671, "answer_count": 1, "score": 0, "last_activity_date": 1556041050, "creation_date": 1555839493, "question_id": 55781577, "link": "https://stackoverflow.com/questions/55781577/ui-and-api-questions-for-a-long-running-process", "closed_reason": "Needs more focus", "title": "UI and API Questions for a long running process", "body": "<p>I have a web app that grabs an Apache 'access.conf' file from internal GitHub, and then sends it via an HTTPS type of authenticated request to our server farm in a temporary dir.</p>\n\n<p>When the file gets to Server 1. A few things are done:\n1. Via a script, existing access.conf is renamed to access.conf.back, and  new file is moved in its place from temp to /etc/httpd/conf.d.\n2. File is tested via apachectl -t\n3. If the check fails, it means, a restart of apache gracefully will not succeed, therefore, do not reload, and move old file into place, and go to step 6.\n5. If the check is passed, do: apachectl -k graceful\n6. Go to next step for each server in list</p>\n\n<p>This is all OK, but I need some direction from experienced web developers on how to show this in a nice table with a green tick mark for \"good\", and a red cross for \"bad\". </p>\n\n<p>How would I go about displaying the status of the above three steps, plus the \"deployment\" of access.conf to the server, so that'd be three operations, \"file sent,\" \"file checked\", \"server restarted.\" This should all be in real time.</p>\n\n<p>API: /deployfile/access.conf\nNow that's what I've been asked to do for the WebUI. I also have a ReST API which also does the deployment part. It would take the request, and do it. And store the result in a table, and return a unique transaction id.</p>\n\n<p>API: /deployfile/status/id\nFor the Status API, from above, it would display the deployment results in a JSON object taken from a transaction table.</p>\n\n<p>API: /restartservices/id\nFinally, the restarting of Apache would also be an API, and after each restart, it would wait a few minutes for the load balancer to see that its healthy again, and then go to the next server. This would be done in another thread, as it would be time consuming.</p>\n\n<p>API: /restartservices/status/id\nAgain, display the results in JSON.</p>\n\n<p>So anyhow, I am familiar with Vue, but wanted how this is done properly in the industry?</p>\n\n<p>I may be over-thinking this, but better to ask.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go", "methods", "identifier"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1555842499, "post_id": 55781493, "comment_id": 98234817, "body": "I don&#39;t think there is anything like this in Go. Try to make an example inside the playground."}, {"owner": {"reputation": 81, "user_id": 11186295, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-jPwmX-rdTtc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeHVr8jv8P1X7k8AtIY9SUs_OcLA/mo/photo.jpg?sz=128", "display_name": "Ilya Ivyev", "link": "https://stackoverflow.com/users/11186295/ilya-ivyev"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1555843343, "post_id": 55781493, "comment_id": 98235023, "body": "@apxp At least <a href=\"https://play.golang.org/p/3N3BoivUfq5\" rel=\"nofollow noreferrer\">this code</a> is compiled"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1555869746, "last_edit_date": 1555869746, "creation_date": 1555846516, "answer_id": 55782334, "question_id": 55781493, "link": "https://stackoverflow.com/questions/55781493/what-is-purpose-of-methods-with-blank-names/55782334#55782334", "title": "What is purpose of methods with blank names?", "body": "<p>There is no real purpose of having blank method names, and you can't call them in any way (not even via reflection, they won't appear among the (exported) methods of the type, see on the <a href=\"https://play.golang.org/p/meyjzyeXW8c\" rel=\"noreferrer\">Go Playground</a>). It's just not explicitly forbidden by the language spec.</p>\n\n<p>The method name is:</p>\n\n<blockquote>\n<pre><code>MethodName     = identifier .\n</code></pre>\n</blockquote>\n\n<p>A method name can be anything that is a valid <a href=\"https://golang.org/ref/spec#identifier\" rel=\"noreferrer\">identifier</a>:</p>\n\n<blockquote>\n<pre><code>identifier     = letter { letter | unicode_digit } .\nletter         = unicode_letter | \"_\" .\nunicode_letter = /* a Unicode code point classified as \"Letter\" */ .\nunicode_digit  = /* a Unicode code point classified as \"Number, decimal digit\" */ .\n</code></pre>\n</blockquote>\n\n<p>The phrase \"the non-blank method and field names must be distinct\" just means the method (and field) names must be distinct, but you may add 2 separate blank methods, they don't collide. Blank methods don't have a name that would collide with anything, including other blank methods.</p>\n"}], "owner": {"reputation": 81, "user_id": 11186295, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-jPwmX-rdTtc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeHVr8jv8P1X7k8AtIY9SUs_OcLA/mo/photo.jpg?sz=128", "display_name": "Ilya Ivyev", "link": "https://stackoverflow.com/users/11186295/ilya-ivyev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 1, "accepted_answer_id": 55782334, "answer_count": 1, "score": 3, "last_activity_date": 1555869746, "creation_date": 1555838757, "last_edit_date": 1555865629, "question_id": 55781493, "link": "https://stackoverflow.com/questions/55781493/what-is-purpose-of-methods-with-blank-names", "title": "What is purpose of methods with blank names?", "body": "<p>I have just started studying golang and during reading specification I found some question that I can't resolve by myself. In the section about method declaration the language specification says \"If the base type is a struct type, the <strong>non-blank method and field names</strong> must be distinct.\"</p>\n\n<p><a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Method_declarations</a></p>\n\n<p>As I understood, method with blank name is</p>\n\n<pre><code>func (t T) _() {\n  // some cool code\n}\n</code></pre>\n\n<p>So, how can I use it and what is main purpose of such methods?</p>\n"}, {"tags": ["go", "testing", "tdd"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1555827906, "creation_date": 1555827906, "answer_id": 55780429, "question_id": 55780354, "link": "https://stackoverflow.com/questions/55780354/golang-reflect-deepequal-returns-unexpected-false/55780429#55780429", "title": "Golang: reflect.DeepEqual returns unexpected false", "body": "<p><code>reflect.DeepEqual()</code> returns <code>true</code> as expected, that's why your <code>t.Errorf()</code> is called.</p>\n\n<p>You want the test to fail if they are <strong>not</strong> equal. You simply have to negate the condition:</p>\n\n<pre><code>if !reflect.DeepEqual(got, expected) {\n    t.Errorf(\"Got: %v, expected: %v\", got, expected)\n}\n</code></pre>\n"}], "owner": {"reputation": 482, "user_id": 1246241, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CYQ8w.jpg?s=128&g=1", "display_name": "utx0_", "link": "https://stackoverflow.com/users/1246241/utx0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 55780429, "answer_count": 1, "score": 2, "last_activity_date": 1555827906, "creation_date": 1555827154, "question_id": 55780354, "link": "https://stackoverflow.com/questions/55780354/golang-reflect-deepequal-returns-unexpected-false", "title": "Golang: reflect.DeepEqual returns unexpected false", "body": "<p>I have the following code and code test below and for some reason the deepEqual is returning a false and failing the test. Now from reading the doco on this I would expect this to pass with a true for something so simple? Any points would be much appreciated. Thanks</p>\n\n<pre><code>// customer.go\ntype Customer struct {\n    customerID int\n    domains []string\n    names []string\n}\nfunc NewCustomer(customerID int, domains []string, names []string) *Customer{\n    return &amp;Customer{\n        customerID: customerID,\n        domains: domains,\n        names:names,\n    }\n}\n</code></pre>\n\n<pre><code>// customer_test.go\nfunc TestNewCustomer(t *testing.T) {\n    expected := &amp;Customer{123,\n        []string{},\n        []string{},\n    }\n\n    got := NewCustomer(123, []string{}, []string{})\n\n    if got.customerID != expected.customerID {\n        t.Errorf(\"Got: %v, expected: %v\", got.customerID, expected.customerID)\n    }\n\n    if reflect.DeepEqual(got, expected) {\n        t.Errorf(\"Got: %v, expected: %v\", got, expected)\n    }\n}\n\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>Got: &amp;{123 [] []}, expected: &amp;{123 [] []}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "grpc"], "comments": [{"owner": {"reputation": 1966, "user_id": 10953328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e2f9870ea4a1a14bf72bfe62d6f21ae?s=128&d=identicon&r=PG&f=1", "display_name": "Ignatius", "link": "https://stackoverflow.com/users/10953328/ignatius"}, "edited": false, "score": 0, "creation_date": 1555825803, "post_id": 55780066, "comment_id": 98231692, "body": "It&#39;s better to copy-paste the error message to your question than to post an image."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11368799"}, "edited": false, "score": 0, "creation_date": 1555831833, "post_id": 55780245, "comment_id": 98232650, "body": "@VonC didnt help."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1555831920, "post_id": 55780245, "comment_id": 98232665, "body": "@EkaterinaMakesimova OK. That was from <a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/install-updates.html\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/AWSEC2/latest/UserGuide/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 0, "last_activity_date": 1555825716, "creation_date": 1555825716, "answer_id": 55780245, "question_id": 55780066, "link": "https://stackoverflow.com/questions/55780066/how-to-fix-this-grpc-installation-problem/55780245#55780245", "title": "How to fix this gRPC installation problem?", "body": "<p>Try instead:</p>\n\n<pre><code>sudo yum install gflags-dev\nsudo yum install gtest-dev\n</code></pre>\n\n<p>That should install libgflags-dev and libgtest-dev.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11382382"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1555825832, "creation_date": 1555823631, "last_edit_date": 1555825832, "question_id": 55780066, "link": "https://stackoverflow.com/questions/55780066/how-to-fix-this-grpc-installation-problem", "title": "How to fix this gRPC installation problem?", "body": "<p>Im following these steps to install gRPC on my freshly launched AWS EC2 Instance:</p>\n\n<pre><code>https://jitpaul.blog/2018/04/18/grpc-on-aws/\n</code></pre>\n\n<p>When I try to execute this line:</p>\n\n<pre><code>sudo yum install libgflags-dev libgtest-dev\n</code></pre>\n\n<p>I get this error:</p>\n\n<p><a href=\"https://i.stack.imgur.com/3awKB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3awKB.png\" alt=\"error message\"></a></p>\n\n<p>I don't want to mess up anything, please help.</p>\n"}, {"tags": ["database", "docker", "go", "migration"], "answers": [{"tags": [], "owner": {"reputation": 2401, "user_id": 1797161, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/538748ff6e44c656974e3eda5602bc93?s=128&d=identicon&r=PG", "display_name": "Federico", "link": "https://stackoverflow.com/users/1797161/federico"}, "is_accepted": true, "score": 12, "last_activity_date": 1555822228, "creation_date": 1555822228, "answer_id": 55779980, "question_id": 55779979, "link": "https://stackoverflow.com/questions/55779979/how-to-run-golang-migrate-with-docker-compose/55779980#55779980", "title": "How to run golang-migrate with docker-compose?", "body": "<p>Adding this to your <code>docker-compose.yml</code> will do the trick:</p>\n\n<pre><code>    db:\n        image: postgres\n        networks:\n            new:\n                aliases:\n                    - database\n        environment:\n            POSTGRES_DB: mydbname\n            POSTGRES_USER: mydbuser\n            POSTGRES_PASSWORD: mydbpwd\n        ports:\n            - \"5432\"\n    migrate:\n        image: migrate/migrate\n        networks:\n            - new\n        volumes:\n            - .:/migrations\n        command: [\"-path\", \"/migrations\", \"-database\",  \"postgres://mydbuser:mydbpwd@database:5432/mydbname?sslmode=disable\", \"up\", \"3\"]\n        links: \n            - db\nnetworks:\n      new:\n</code></pre>\n\n<p>Instead of using the <code>--network host</code> option of <code>docker run</code> you set up a network called <code>new</code>. All the services inside that network gain access to each other through a defined alias (in the above example, you can access the db service through the <code>database</code> alias). Then, you can use that alias just like you would use <code>localhost</code>, that is, in place of an IP address. That explains this connection string:</p>\n\n<pre><code>\"postgres://mydbuser:mydbpwd@database:5432/mydbname?sslmode=disable\"\n</code></pre>\n"}], "owner": {"reputation": 2401, "user_id": 1797161, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/538748ff6e44c656974e3eda5602bc93?s=128&d=identicon&r=PG", "display_name": "Federico", "link": "https://stackoverflow.com/users/1797161/federico"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2416, "favorite_count": 1, "accepted_answer_id": 55779980, "answer_count": 1, "score": 4, "last_activity_date": 1555822228, "creation_date": 1555822228, "question_id": 55779979, "link": "https://stackoverflow.com/questions/55779979/how-to-run-golang-migrate-with-docker-compose", "title": "How to run golang-migrate with docker-compose?", "body": "<p>In golang-migrate's documentation, it is stated that you can run this command to run all the migrations in one folder. </p>\n\n<pre><code>docker run -v {{ migration dir }}:/migrations --network host migrate/migrate\n    -path=/migrations/ -database postgres://localhost:5432/database up 2\n</code></pre>\n\n<p>How would you do this to fit the syntax of the new docker-compose, which discourages the use of <code>--network</code>?</p>\n\n<p>And more importantly: How would you connect to a database in another container instead to one running in your localhost?</p>\n"}, {"tags": ["go", "go-chi"], "answers": [{"comments": [{"owner": {"reputation": 387, "user_id": 5509843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6ZSKp.jpg?s=128&g=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/5509843/developer"}, "edited": false, "score": 0, "creation_date": 1555857661, "post_id": 55780067, "comment_id": 98238149, "body": "i think it&#39;s a docker issue. I was deleting my docker container and build it again and it works. But deleting my docker container every time i install a go module is frustrating, i&#39;m tweaking my Dockerfile even, added some of your provided answer but it still requires deleting go container,"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 387, "user_id": 5509843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6ZSKp.jpg?s=128&g=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/5509843/developer"}, "edited": false, "score": 0, "creation_date": 1555858843, "post_id": 55780067, "comment_id": 98238485, "body": "@Developer Why not mounting the sources as a volume, as in here: <a href=\"https://stackoverflow.com/a/48498921/6309\">stackoverflow.com/a/48498921/6309</a>. Other example: <a href=\"https://www.callicoder.com/docker-golang-image-container-example/\" rel=\"nofollow noreferrer\">callicoder.com/docker-golang-image-container-example</a>"}, {"owner": {"reputation": 387, "user_id": 5509843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6ZSKp.jpg?s=128&g=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/5509843/developer"}, "edited": false, "score": 0, "creation_date": 1555899124, "post_id": 55780067, "comment_id": 98246906, "body": "i already did mount my code into the volume inside my docker-compose file. I&#39;ll update my post accordingly."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1555823638, "creation_date": 1555823638, "answer_id": 55780067, "question_id": 55779784, "link": "https://stackoverflow.com/questions/55779784/go-dep-missing-sub-package-chi-middleware-after-dep-ensure/55780067#55780067", "title": "Go Dep - Missing sub-package &quot;chi/middleware&quot; after dep ensure", "body": "<p>Since you are on Go 1.12, can you try and see if the issue persists when using <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\"><code>go mod</code> (Go 1.11+ Modules)</a>.</p>\n\n<pre><code>$ export GO111MODULE=on                         # manually active module mode\n$ cd $GOPATH/src/&lt;project path&gt;                 # e.g., cd $GOPATH/src/you/hello\n$ go mod init                  \n</code></pre>\n\n<p>A <code>go mod init</code> will concert your dep <code>Gopkg.lock</code> file.<br>\nAnd it should detect and fetch your missing dependency.<br>\nIf that has worked, then run <code>go mod tidy</code> to possibly prune any extraneous requirements.</p>\n"}], "owner": {"reputation": 387, "user_id": 5509843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6ZSKp.jpg?s=128&g=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/5509843/developer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 668, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1555899277, "creation_date": 1555819395, "last_edit_date": 1555899277, "question_id": 55779784, "link": "https://stackoverflow.com/questions/55779784/go-dep-missing-sub-package-chi-middleware-after-dep-ensure", "title": "Go Dep - Missing sub-package &quot;chi/middleware&quot; after dep ensure", "body": "<p>Missing middleware subpackage from go-chi after running dep ensure.</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>project-backend     |  main.go:8:2: cannot find package \"github.com/go-chi/chi/middleware\" in any of:\nproject-backend     |   /go/src/backend/vendor/github.com/go-chi/chi/middleware (vendor tree)\nproject-backend     |   /usr/local/go/src/github.com/go-chi/chi/middleware (from $GOROOT)\nproject-backend     |   /go/src/github.com/go-chi/chi/middleware (from $GOPATH)\n</code></pre>\n\n<p>my Docker file, i also mounted my code volume inside my docker-compose.yaml file</p>\n\n<pre><code>FROM golang:1.12\n\nWORKDIR /go/src/backend\nCOPY Gopkg.toml Gopkg.lock ./\nRUN go get -u github.com/golang/dep/cmd/dep\nCOPY . ./\nRUN dep ensure\n\nRUN go get github.com/pilu/fresh\n\nCMD [ \"fresh\" ]\n\n</code></pre>\n\n<p>Gopkg.toml</p>\n\n<pre><code>\n[prune]\n  go-tests = true\n  unused-packages = true\n  non-go = true\n\n[[constraint]]\n  name = \"github.com/go-chi/chi\"\n  version = \"4.0.2\"\n</code></pre>\n\n<p>my Code, is just a basic router to test my docker and dep configuration.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/go-chi/chi\"\n    \"github.com/go-chi/chi/middleware\"\n)\n\nfunc main() {\n    r := chi.NewRouter()\n    r.Use(middleware.Logger)\n\n    port := \":8080\"\n\n    r.Get(\"/api\", func(w http.ResponseWriter, r *http.Request) {\n        w.Write([]byte(\"API is working!\"))\n    })\n\n    format := \"\\033[1;36m%s\\033[0m\"\n    fmt.Printf(format, \"Build success, running on port \"+port)\n    http.ListenAndServe(port, r)\n}\n</code></pre>\n\n<p>My code works fine when using go get. But on dep, it's missing its subpackage.</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 5405143, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-oF1duXSprwc/AAAAAAAAAAI/AAAAAAAAA2c/7fpFabojN_s/photo.jpg?sz=128", "display_name": "Md_Zubair Ahmed", "link": "https://stackoverflow.com/users/5405143/md-zubair-ahmed"}, "edited": false, "score": 0, "creation_date": 1556654889, "post_id": 55779348, "comment_id": 98509607, "body": "this should be accepted answer, this indeed in the reason for the above error"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1555841657, "last_edit_date": 1555841657, "creation_date": 1555813106, "answer_id": 55779348, "question_id": 55777769, "link": "https://stackoverflow.com/questions/55777769/mongodb-go-driver-interface-conversion-interface-is-primitive-objectid-not/55779348#55779348", "title": "Mongodb-go-driver interface conversion: interface {} is primitive.ObjectID, not primitive.ObjectID (types from different packages)", "body": "<p>There are two packages in the application with name <code>primitive</code> containing a type named <code>ObjectID</code>.  The concrete value in the <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> is from one of those packages.  The asserted type is from the other package. The type assertion panics because the types are not equal.</p>\n\n<p>Fix by modifying the application to use a single import path for the <code>primitive</code> package (and the entire driver).</p>\n\n<p>The canonical import path of the package was changed from <code>github.com/mongodb/mongo-go-driver/bson/primitive</code> to <code>go.mongodb.org/mongo-driver/bson/primitive</code> in February 2019. It is likely that the application uses both of these import paths.</p>\n"}], "owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2054, "favorite_count": 0, "accepted_answer_id": 55779348, "answer_count": 1, "score": 3, "last_activity_date": 1555841657, "creation_date": 1555794659, "question_id": 55777769, "link": "https://stackoverflow.com/questions/55777769/mongodb-go-driver-interface-conversion-interface-is-primitive-objectid-not", "title": "Mongodb-go-driver interface conversion: interface {} is primitive.ObjectID, not primitive.ObjectID (types from different packages)", "body": "<p>I can display the result.InsertedID with no problem, however, I keep getting the above error when I attempt to access the value to use it other places. I want to get the value before I leave the method that inserts the new object.  The error message does not make any sense. </p>\n\n<p>I get this error with res.InsertedID.(primitive.ObjectID). What is the proper way?</p>\n\n<p>How do I get the concrete value preferably as a hex string?  Even if I can get the value as a concrete ObjectID and not an interface I would be happy.</p>\n"}, {"tags": ["go", "amazon-dynamodb"], "answers": [{"comments": [{"owner": {"reputation": 416, "user_id": 4338221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7476d44d6543112948e5c5a49a0bd89?s=128&d=identicon&r=PG", "display_name": "Francisco Arias", "link": "https://stackoverflow.com/users/4338221/francisco-arias"}, "edited": false, "score": 0, "creation_date": 1555890534, "post_id": 55778034, "comment_id": 98245751, "body": "that was it.... smh .... needed those extra pair of eyes thanks a lot !"}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 2, "last_activity_date": 1555796810, "creation_date": 1555796810, "answer_id": 55778034, "question_id": 55777547, "link": "https://stackoverflow.com/questions/55777547/query-a-index-in-dynamo-db/55778034#55778034", "title": "Query a index in dynamo db", "body": "<p>I think you're missing expression attribute names. Try adding this to your query input:</p>\n\n<pre><code>ExpressionAttributeNames:  expr.Names(),\n</code></pre>\n"}], "owner": {"reputation": 416, "user_id": 4338221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7476d44d6543112948e5c5a49a0bd89?s=128&d=identicon&r=PG", "display_name": "Francisco Arias", "link": "https://stackoverflow.com/users/4338221/francisco-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 988, "favorite_count": 0, "accepted_answer_id": 55778034, "answer_count": 1, "score": 0, "last_activity_date": 1566240733, "creation_date": 1555792806, "last_edit_date": 1566240733, "question_id": 55777547, "link": "https://stackoverflow.com/questions/55777547/query-a-index-in-dynamo-db", "title": "Query a index in dynamo db", "body": "<p>I need an example in Go on how to do a query on an index in dynamo db.\nFor JavaScript I found this one: \n<a href=\"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/SQLtoNoSQL.Indexes.QueryAndScan.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/SQLtoNoSQL.Indexes.QueryAndScan.html</a></p>\n\n<p>I could not find one for Go. I tried this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    // Here \"user_id\" is the key, and\n    // \"user_id_index\" is the secondary index\n\n    keyCondition := expression.Key(\"user_id\").Equal(expression.Value(userId))\n    expr, errExpression := expression.NewBuilder().WithKeyCondition(keyCondition).WithProjection(proj).Build()\n\n    if errExpression != nil {\n        log.Printf(\"error: creating dynamo expression \", errExpression)\n\n        return listResponse, errExpression\n    }\n    params := &amp;dynamodb.QueryInput{\n        ExpressionAttributeValues: expr.Values(),\n        ProjectionExpression:      expr.Projection(),\n        TableName:                 aws.String(tableName),\n        IndexName:                 aws.String(\"user_id_index\"),\n        KeyConditionExpression:    expr.KeyCondition(),\n\n    }\n    result, errResults := svc.Query(params)\n\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>error: scanning dynamo table %!(EXTRA *awserr.requestError=ValidationException:\n Invalid KeyConditionExpression: An expression attribute name used in the document path is not defined;\n attribute name: #0\n</code></pre>\n\n<p>Any link to a good tutorial would be appreciated, or code example as an answer too.</p>\n"}, {"tags": ["go", "logging", "overhead"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 1, "creation_date": 1555788419, "post_id": 55776226, "comment_id": 98226139, "body": "For Q1 you could write a benchmark. Then you could see how much slower the logger is."}, {"owner": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "edited": false, "score": 1, "creation_date": 1555793189, "post_id": 55776226, "comment_id": 98227234, "body": "For Q2, It would probably be best to hand-pick what situations/errors to log and only log those (if anything)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1555805785, "post_id": 55776226, "comment_id": 98229321, "body": "If you want to know the performance impact, you need to measure it in your code. The chances that evaluating the log arguments is dominating your time is pretty slim."}, {"owner": {"reputation": 539, "user_id": 2352611, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/0fY8c.jpg?s=128&g=1", "display_name": "Larytet", "link": "https://stackoverflow.com/users/2352611/larytet"}, "edited": false, "score": 0, "creation_date": 1558533817, "post_id": 55776226, "comment_id": 99133944, "body": "you can have logging under 50 nanoseconds/log entry. For example <a href=\"https://github.com/larytet/binlog\" rel=\"nofollow noreferrer\">github.com/larytet/binlog</a>"}], "answers": [{"comments": [{"owner": {"reputation": 693, "user_id": 3990434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JMTJk.jpg?s=128&g=1", "display_name": "Gon", "link": "https://stackoverflow.com/users/3990434/gon"}, "edited": false, "score": 0, "creation_date": 1555816884, "post_id": 55779148, "comment_id": 98230612, "body": "Thank you; I will make it simple and try; I will update here for the result in case someone have same issue later.."}], "tags": [], "owner": {"reputation": 12784, "user_id": 1401034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBXk9.png?s=128&g=1", "display_name": "Ewan", "link": "https://stackoverflow.com/users/1401034/ewan"}, "is_accepted": true, "score": 2, "last_activity_date": 1555816980, "last_edit_date": 1555816980, "creation_date": 1555810119, "answer_id": 55779148, "question_id": 55776226, "link": "https://stackoverflow.com/questions/55776226/overhead-for-golangs-logger-if-set-to-discard/55779148#55779148", "title": "Overhead for Golang&#39;s logger if set to discard", "body": "<h1>Benchmarks</h1>\n\n<p>While my gut says that dropping the logs to <code>Discard</code> will have minimal impact to your code I would recommend setting up a benchmark to test the performance impact of your loggers.</p>\n\n<p>Fortunately Go makes this very easy by writing a <code>func BenchmarkXxxxx(*testing.B)</code> function in your unit tests and running <code>go test -bench</code>. More information can be found <a href=\"https://golang.org/pkg/testing/#hdr-Benchmarks\" rel=\"nofollow noreferrer\">in the documentation</a>. For your benchmark I recommend writing two tests, one with the <code>os.Stdout</code> and the other with <code>ioutil.Discard</code> - make sure the inputs to both tests are the same.</p>\n\n<p>Relevant code from <a href=\"https://golang.org/src/io/ioutil/ioutil.go\" rel=\"nofollow noreferrer\"><code>ioutil</code></a> to show just what will happen \"under the hood\":</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// ioutil.go\ntype devNull int\n\nfunc (devNull) Write(p []byte) (int, error) {\n    return len(p), nil\n}\n\nfunc (devNull) WriteString(s string) (int, error) {\n    return len(s), nil\n}\n</code></pre>\n\n<h1>Logging Best Practices</h1>\n\n<p>One approach to logging is the common \"Level Based Logging\" where you pick the severity of the message wishing to be logged (<code>DEBUG</code>/<code>INFO</code>/<code>WARN</code>/<code>ERROR</code> etc.) then choose which levels to display when deploying your application (e.g. <code>DEBUG</code> and above in development but <code>WARN</code> and above in production). </p>\n\n<p>As you will have noticed Go only provides <code>Print</code> and <code>Error</code> level statements in the standard library so you will need an <a href=\"https://stackoverflow.com/questions/16895651/how-to-implement-level-based-logging-in-golang\">external package</a> to benefit from something like this (these can also help structuring your logs in a more machine readable/search friendly JSON format too). Dave Cheney has justified the reasoning behind this decision <a href=\"https://dave.cheney.net/2015/11/05/lets-talk-about-logging\" rel=\"nofollow noreferrer\">in a blog post</a>. </p>\n\n<p>In your case 40 log statements sounds like a lot but this may depend on how many are simple <code>Print</code> logs; size and complexity of the handler etc. <code>Print</code> logging can be exceptionally helpful as a temporary measure in development and <code>Error</code> to help diagnose during failures if you are not surfacing the error to the client.</p>\n"}], "owner": {"reputation": 693, "user_id": 3990434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JMTJk.jpg?s=128&g=1", "display_name": "Gon", "link": "https://stackoverflow.com/users/3990434/gon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 602, "favorite_count": 2, "accepted_answer_id": 55779148, "answer_count": 1, "score": 1, "last_activity_date": 1555818536, "creation_date": 1555782792, "last_edit_date": 1555818536, "question_id": 55776226, "link": "https://stackoverflow.com/questions/55776226/overhead-for-golangs-logger-if-set-to-discard", "title": "Overhead for Golang&#39;s logger if set to discard", "body": "<p>I have a HTTP handler that has 40 loggers that is set to <strong>os.Stdout</strong>. </p>\n\n<p>It works just fine for me as I am the only one testing at the moment.\nBut, when it goes to the production, I'm afraid it will have too much overhead.</p>\n\n<p>Currently loggers are set to <strong>os.Stdout</strong> and <strong>os.Stderr</strong>.\nBut once it gets to the production, <strong>os.Stdout</strong> will be set to <strong>ioutil.discard</strong>.</p>\n\n<p>Q1. Will it impact the performance if I still have the logger in set to discard?</p>\n\n<p>Q2. For the best practice, is it better to remove loggers completely from the HTTP handler? </p>\n\n<p><strong>---- UPDATE ----</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n    \"fmt\"\n    \"log\"\n    \"io/ioutil\"\n    \"io\"\n)\n\nfunc testPrintf(w io.Writer, note string, cnt int) {\n    l := log.New(w, \"\", 0)\n    t1 := time.Now()\n    for i:=0; i&lt;cnt; i++ {\n        l.Printf(\"%s - %d\", \"test\", i)\n    }\n    t2 := time.Now()\n    fmt.Printf(\"%-15s  %-15s, %v\\n\",\"Printf \", note, t2.Sub(t1))\n}\n\nfunc testPrintln(w io.Writer, note string, cnt int) {\n    l := log.New(w, \"\", 0)\n    t1 := time.Now()\n    for i:=0; i&lt;cnt; i++ {\n        l.Println(\"test\" + string(i))\n    }\n    t2 := time.Now()\n    fmt.Printf(\"%-15s  %-15s, %v\\n\",\"Println\", note, t2.Sub(t1))\n}\n\nfunc testDoNothing(w io.Writer, note string, cnt int) {\n    //l := log.New(w, \"\", 0)\n    t1 := time.Now()\n    for i:=0; i&lt;cnt; i++ {\n        _ = \"test\" + string(i) // evaluated but didn't do any.\n    }\n    t2 := time.Now()\n    fmt.Printf(\"%-15s  %-15s, %v\\n\", \"DoNothing\", note, t2.Sub(t1))\n}\n\nfunc main() {\n    cnt := 10000000 // ten million\n    testPrintf(ioutil.Discard, \"discard.Attempt.1\", cnt)\n    testPrintln(ioutil.Discard, \"discard.Attempt.1\", cnt)\n    testDoNothing(ioutil.Discard, \"discard.Attempt.1\", cnt)\n    fmt.Println(\"\\n\")\n    testPrintf(ioutil.Discard, \"discard.Attempt.2\", cnt)\n    testPrintln(ioutil.Discard, \"discard.Attempt.2\", cnt)\n    testDoNothing(ioutil.Discard, \"discard.Attempt.2\", cnt)\n    fmt.Println(\"\\n\")\n    testPrintf(ioutil.Discard, \"discard.Attempt.3\", cnt)\n    testPrintln(ioutil.Discard, \"discard.Attempt.3\", cnt)\n    testDoNothing(ioutil.Discard, \"discard.Attempt.3\", cnt)\n}\n</code></pre>\n\n<p><strong>--- RESULT ---</strong></p>\n\n<pre><code>Printf           discard.Attempt.1, 2.663697209s\nPrintln          discard.Attempt.1, 2.4289759s\nDoNothing        discard.Attempt.1, 190.480694ms\n\nPrintf           discard.Attempt.2, 2.493506245s\nPrintln          discard.Attempt.2, 2.426081786s\nDoNothing        discard.Attempt.2, 182.899574ms\n\nPrintf           discard.Attempt.3, 2.480853275s\nPrintln          discard.Attempt.3, 2.481552836s\nDoNothing        discard.Attempt.3, 180.916608ms\n</code></pre>\n\n<ol>\n<li>I ran for 10M times for each. </li>\n<li>2~3 sec for 10M log to io.Discard is faster than I thought.. I guess I don't have to worry about the speed.</li>\n<li>os.Stdout which I didn't mean to use; (my original concern was keeping code with ioutil.Discard vs remove the code), but since os.Stdout was not buffered, it was slow.</li>\n<li>By the way, printf() was a lot faster than I thought. Almost same as println()</li>\n</ol>\n\n<p>I don't write Go code daily basis, so this test may be inaccurate. If you see misleading info from the test, please leave a comment here for others to aware. Thank you.</p>\n"}, {"tags": ["go", "gcloud", "google-cloud-source-repos", "google-source-repositories", "go-get"], "comments": [{"owner": {"reputation": 91, "user_id": 7598905, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tGpk6b_BOOo/AAAAAAAAAAI/AAAAAAAAAJo/5f7GygWZR8Y/photo.jpg?sz=128", "display_name": "Harveer Singh", "link": "https://stackoverflow.com/users/7598905/harveer-singh"}, "edited": false, "score": 3, "creation_date": 1569063345, "post_id": 55776203, "comment_id": 102479971, "body": "Hi Jared Hooper i need help for same, it would really helpful if you can share how you have solved this  problem ?"}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1574713376, "post_id": 55776203, "comment_id": 104321717, "body": "any workaround? I am stuck.."}, {"owner": {"reputation": 460, "user_id": 7398432, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sza2X.png?s=128&g=1", "display_name": "YaguraStation", "link": "https://stackoverflow.com/users/7398432/yagurastation"}, "reply_to_user": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 2, "creation_date": 1581589469, "post_id": 55776203, "comment_id": 106489536, "body": "This dev is using vanity URLs: <a href=\"https://stackoverflow.com/questions/53687342/go-get-with-source-cloud-google-com/53694868#53694868\" title=\"go get with source cloud google com\">stackoverflow.com/questions/53687342/&hellip;</a> PS: @Emixam23 yes, I saw you there ;-)"}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1581620587, "post_id": 55776203, "comment_id": 106507397, "body": "But I still don&#39;t really understand tbh :/"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 13079976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5348ad3c0fd312ff088b7a2b59d0487?s=128&d=identicon&r=PG&f=1", "display_name": "Rener Castro", "link": "https://stackoverflow.com/users/13079976/rener-castro"}, "is_accepted": false, "score": -1, "last_activity_date": 1584501789, "creation_date": 1584501789, "answer_id": 60733076, "question_id": 55776203, "link": "https://stackoverflow.com/questions/55776203/go-get-for-googles-cloud-source-repository/60733076#60733076", "title": "Go Get for Google&#39;s Cloud Source Repository", "body": "<p>This works:\n<code>got get source.developers.google.com/p/YOUR_PROJECT_ID/r/YOUR_REPO.git</code> </p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 6660075, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-JT7qTkUOPxc/AAAAAAAAAAI/AAAAAAAABfg/ZdG9RnUDxcs/photo.jpg?sz=128", "display_name": "Jeisson", "link": "https://stackoverflow.com/users/6660075/jeisson"}, "is_accepted": false, "score": 0, "last_activity_date": 1618151354, "creation_date": 1618151354, "answer_id": 67046161, "question_id": 55776203, "link": "https://stackoverflow.com/questions/55776203/go-get-for-googles-cloud-source-repository/67046161#67046161", "title": "Go Get for Google&#39;s Cloud Source Repository", "body": "<ol>\n<li>Configure repo on <a href=\"https://source.cloud.google.com/\" rel=\"nofollow noreferrer\">https://source.cloud.google.com/</a></li>\n<li>Authorize manual git access <a href=\"https://source.developers.google.com/p/YOUR_PROJECT_ID/r/YOUR_REPO\" rel=\"nofollow noreferrer\">https://source.developers.google.com/p/YOUR_PROJECT_ID/r/YOUR_REPO</a>\nIn this example: <a href=\"https://source.developers.google.com/p/m/r/common\" rel=\"nofollow noreferrer\">https://source.developers.google.com/p/m/r/common</a></li>\n<li>Your <code>common</code> module should go like <code>source.developers.google.com/p/m/r/common.git</code></li>\n<li>Run: <code>go get source.developers.google.com/p/m/r/common.git</code> on the other module</li>\n</ol>\n"}], "owner": {"reputation": 830, "user_id": 3872894, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006705821837/picture?type=large", "display_name": "Jared Hooper", "link": "https://stackoverflow.com/users/3872894/jared-hooper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 617, "favorite_count": 2, "answer_count": 2, "score": 8, "last_activity_date": 1618151354, "creation_date": 1555782614, "question_id": 55776203, "link": "https://stackoverflow.com/questions/55776203/go-get-for-googles-cloud-source-repository", "title": "Go Get for Google&#39;s Cloud Source Repository", "body": "<p>Making two different <code>go</code> modules</p>\n\n<ol>\n<li><p><code>source.cloud.google.com/me/a</code></p></li>\n<li><p><code>source.cloud.google.com/me/b</code></p></li>\n</ol>\n\n<p>With <code>source.cloud.google.com/me/common</code> as a common lib dependency (to share a model)</p>\n\n<p>I'm trying to <code>go get source.cloud.google.com/me/common</code> (even manually wrote it in the <code>go.mod</code> file) but I keep receiving the following error:</p>\n\n<pre><code>package source.cloud.google.com/me/common: \nunrecognized import path \"source.cloud.google.com/me/common\" \n(parse https://source.cloud.google.com/me/common?go-get=1: no go-import meta tags ())\n</code></pre>\n\n<p>I have <code>gcloud</code> set up to be able to use <code>app deploy</code> and create new source repositories. I've tried setting up <code>ssh</code> for google cloud and attempted to use manual credentials. This neither works locally or in the google cloud build service.</p>\n\n<p><strong>I want to do two things:</strong></p>\n\n<ol>\n<li>Be able to <code>go get</code> this dependenc<code>source.cloud.google.com/me/common</code></li>\n<li>Be able to integrate this <code>go get</code> into my App Engine automated build pipeline.</li>\n</ol>\n\n<p>Any help would be appreciated.</p>\n"}, {"tags": ["go", "goland"], "comments": [{"owner": {"reputation": 1001, "user_id": 880457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/958e3eb2e5d41ee78090e3af5f833064?s=128&d=identicon&r=PG", "display_name": "artspb", "link": "https://stackoverflow.com/users/880457/artspb"}, "edited": false, "score": 0, "creation_date": 1555780512, "post_id": 55775736, "comment_id": 98224127, "body": "Is it a Go Modules project? If not is it located under <code>$GOPATH</code> on disk?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1555781669, "post_id": 55775736, "comment_id": 98224457, "body": "None of this should work. In Go one imports <i>packages</i>, not <i>files</i>. See <a href=\"https://golang.org/doc/code.html#Library\" rel=\"nofollow noreferrer\">How to Write Go Code</a>."}, {"owner": {"reputation": 23530, "user_id": 347964, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bE90m.png?s=128&g=1", "display_name": "flyx", "link": "https://stackoverflow.com/users/347964/flyx"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1555782097, "post_id": 55775736, "comment_id": 98224586, "body": "@Peter Sorry, screwed the paths during writeup out of habit. Actual code does import the packages, I fixed it."}, {"owner": {"reputation": 23530, "user_id": 347964, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bE90m.png?s=128&g=1", "display_name": "flyx", "link": "https://stackoverflow.com/users/347964/flyx"}, "reply_to_user": {"reputation": 1001, "user_id": 880457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/958e3eb2e5d41ee78090e3af5f833064?s=128&d=identicon&r=PG", "display_name": "artspb", "link": "https://stackoverflow.com/users/880457/artspb"}, "edited": false, "score": 1, "creation_date": 1555782270, "post_id": 55775736, "comment_id": 98224627, "body": "@artspb The project is at <code>$GOPATH&#47;src&#47;github.com&#47;flyx&#47;myproj&#47;</code> on disk. I am unsure what would make the project a <i>Go Modules project</i>; I do have a <code>go.mod</code> lying around, but I don&#39;t use it since the compiler on the target machine is too old."}, {"owner": {"reputation": 1001, "user_id": 880457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/958e3eb2e5d41ee78090e3af5f833064?s=128&d=identicon&r=PG", "display_name": "artspb", "link": "https://stackoverflow.com/users/880457/artspb"}, "edited": false, "score": 0, "creation_date": 1555782530, "post_id": 55775736, "comment_id": 98224688, "body": "@flyx Do you have Go Modules integration enabled under <i>Settings | Go | Go Modules (vgo)</i>? If yes then try switching it off."}, {"owner": {"reputation": 23530, "user_id": 347964, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bE90m.png?s=128&g=1", "display_name": "flyx", "link": "https://stackoverflow.com/users/347964/flyx"}, "reply_to_user": {"reputation": 1001, "user_id": 880457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/958e3eb2e5d41ee78090e3af5f833064?s=128&d=identicon&r=PG", "display_name": "artspb", "link": "https://stackoverflow.com/users/880457/artspb"}, "edited": false, "score": 0, "creation_date": 1555782741, "post_id": 55775736, "comment_id": 98224750, "body": "@artspb That actually fixed it \\o/. But why would it not import my package with that thing turned on? I use the whole path for external packages I import and it works just fine there."}, {"owner": {"reputation": 1001, "user_id": 880457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/958e3eb2e5d41ee78090e3af5f833064?s=128&d=identicon&r=PG", "display_name": "artspb", "link": "https://stackoverflow.com/users/880457/artspb"}, "edited": false, "score": 0, "creation_date": 1555782881, "post_id": 55775736, "comment_id": 98224782, "body": "@flyx What GoLand version do you use? There are some fixes for Go Modules projects under <code>$GOPATH</code> in the latest 2019.1.1."}, {"owner": {"reputation": 23530, "user_id": 347964, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bE90m.png?s=128&g=1", "display_name": "flyx", "link": "https://stackoverflow.com/users/347964/flyx"}, "reply_to_user": {"reputation": 1001, "user_id": 880457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/958e3eb2e5d41ee78090e3af5f833064?s=128&d=identicon&r=PG", "display_name": "artspb", "link": "https://stackoverflow.com/users/880457/artspb"}, "edited": false, "score": 0, "creation_date": 1555783111, "post_id": 55775736, "comment_id": 98224837, "body": "@artspb <code>go version go1.12.1 darwin&#47;amd64</code> on the dev machine and <code>go version go1.10.4 linux&#47;arm64</code> on the target machine"}, {"owner": {"reputation": 1001, "user_id": 880457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/958e3eb2e5d41ee78090e3af5f833064?s=128&d=identicon&r=PG", "display_name": "artspb", "link": "https://stackoverflow.com/users/880457/artspb"}, "edited": false, "score": 0, "creation_date": 1555783148, "post_id": 55775736, "comment_id": 98224853, "body": "@flyx Sorry, I was asking about GoLand. I&#39;ve edited my message too late, apparently."}, {"owner": {"reputation": 23530, "user_id": 347964, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bE90m.png?s=128&g=1", "display_name": "flyx", "link": "https://stackoverflow.com/users/347964/flyx"}, "reply_to_user": {"reputation": 1001, "user_id": 880457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/958e3eb2e5d41ee78090e3af5f833064?s=128&d=identicon&r=PG", "display_name": "artspb", "link": "https://stackoverflow.com/users/880457/artspb"}, "edited": false, "score": 0, "creation_date": 1555783317, "post_id": 55775736, "comment_id": 98224899, "body": "@artspb I just updated to 2019.1.1 but the problem stays the same when I enable module integration. If this is a GoLand bug, you can post your solution as answer."}, {"owner": {"reputation": 1001, "user_id": 880457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/958e3eb2e5d41ee78090e3af5f833064?s=128&d=identicon&r=PG", "display_name": "artspb", "link": "https://stackoverflow.com/users/880457/artspb"}, "edited": false, "score": 0, "creation_date": 1555783983, "post_id": 55775736, "comment_id": 98225090, "body": "@flyx It&#39;s hard to tell. I&#39;ve just tried to recreate the problem but didn&#39;t succeed. It&#39;d be great if you file a new issue <a href=\"https://youtrack.jetbrains.com/issues/GO\" rel=\"nofollow noreferrer\">here</a> where describe steps to reproduce or better attach an example project."}, {"owner": {"reputation": 23530, "user_id": 347964, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bE90m.png?s=128&g=1", "display_name": "flyx", "link": "https://stackoverflow.com/users/347964/flyx"}, "reply_to_user": {"reputation": 1001, "user_id": 880457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/958e3eb2e5d41ee78090e3af5f833064?s=128&d=identicon&r=PG", "display_name": "artspb", "link": "https://stackoverflow.com/users/880457/artspb"}, "edited": false, "score": 1, "creation_date": 1555784453, "post_id": 55775736, "comment_id": 98225203, "body": "@artspb In my go.mod, there was <code>module myproj</code> instead of <code>module github.com&#47;flyx&#47;myproj</code>, that was the problem. I&#39;ll still open a bug report since I don&#39;t see why GoLang should fail that way in this setup."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1555819069, "post_id": 55775736, "comment_id": 98230888, "body": "Note I can&#39;t find the error you see (<code>Cannot resolve directory &#39;github.com&#39;</code>) in the Go toolchain, which suggests that the error is in Goland, and not the Go toolchain (unless I missed it, of course)."}], "owner": {"reputation": 23530, "user_id": 347964, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bE90m.png?s=128&g=1", "display_name": "flyx", "link": "https://stackoverflow.com/users/347964/flyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2085, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1555782054, "creation_date": 1555779357, "last_edit_date": 1555782054, "question_id": 55775736, "link": "https://stackoverflow.com/questions/55775736/correct-way-to-import-files-in-the-same-project-in-go", "title": "Correct way to import files in the same project in Go", "body": "<p>I have a Go project with a structure like this:</p>\n\n<pre><code>cmd\n  myapp\n    main.go\ninternal\n  app\n    myapp\n      impl.go\n</code></pre>\n\n<p>Now in <code>main.go</code>, I want to import <code>impl.go</code>. GoLand tells me that I should do it like this:</p>\n\n<pre><code>import (\n  \"myproj/internal/app/myapp\"\n)\n</code></pre>\n\n<p>However, I compile the project on another machine (because I use EGL and that's not available on macOS). When I do</p>\n\n<pre><code>go build cmd/myapp/main.go\n</code></pre>\n\n<p>there, it cannot resolve the import. So I changed the import to use the full path of my github repo, like this:</p>\n\n<pre><code>import (\n  \"github.com/flyx/myproj/internal/app/myapp\"\n)\n</code></pre>\n\n<p>Code compiles fine now. However, after I pulled that back into GoLand, it cannot resolve the import anymore. Curiously, every item in the path gives a separate error, e.g.</p>\n\n<blockquote>\n  <p>Cannot resolve directory 'github.com'</p>\n</blockquote>\n\n<p>That's very strange since <code>github.com</code> is very obviously in my <code>$GOPATH/src</code> and other imports from there that are not my current project are working.</p>\n\n<p>So\u2026 what am I doing wrong? I don't even understand how GoLand can resolve the path starting with <code>myproj</code>. I checked whether <code>GOPATH</code> is correctly set in GoLand and that's the case.</p>\n"}, {"tags": ["regex", "go"], "answers": [{"tags": [], "owner": {"reputation": 5049, "user_id": 5288316, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bfc9b80e12b12bd4dd8a3953679d0c84?s=128&d=identicon&r=PG&f=1", "display_name": "Nicolas", "link": "https://stackoverflow.com/users/5288316/nicolas"}, "is_accepted": false, "score": 1, "last_activity_date": 1555776585, "creation_date": 1555776585, "answer_id": 55775321, "question_id": 55775085, "link": "https://stackoverflow.com/questions/55775085/turning-a-file-with-string-key-values-into-a-go-map/55775321#55775321", "title": "Turning a file with string key/values into a Go map", "body": "<p><a href=\"https://regex101.com/r/wMiydw/1\" rel=\"nofollow noreferrer\"><code>^\"(.+?)(?&lt;!\\\\)\"\\s*=\\s*\"([\\s\\S]*?)(?&lt;!\\\\)\";</code></a> matches keys and values in two groups, assuming they are all in the form <code>\"key\" = \"value\";</code>. Keys and values can have escaped quotes. Empty keys are not matched.</p>\n\n<p>You can then replace <code>\\\\\\n</code> in values with <code>\\n</code> for values that span multiple lines. </p>\n\n<p>I'm using negative look behind <code>(?&lt;!\\\\)</code> to make sure quotes are not preceded by a backslash.</p>\n"}, {"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": false, "score": 1, "last_activity_date": 1555777940, "creation_date": 1555777940, "answer_id": 55775548, "question_id": 55775085, "link": "https://stackoverflow.com/questions/55775085/turning-a-file-with-string-key-values-into-a-go-map/55775548#55775548", "title": "Turning a file with string key/values into a Go map", "body": "<p>I think <code>(?m)^\"([^\"]+)\"\\s*=\\s*\"(([^\"]|(\\\\\")|(\\\\\\n))+)\";$</code> does what you want.\nUse that with <code>FindAllStringSubmatch</code> and it will return all the matching pairs. Note that if the syntax is invalid on any of the input, the whole thing won't match, so that might not be exactly what you want.</p>\n\n<pre><code>func main() {\n    re := regexp.MustCompile(`(?m)^\"([^\"]+)\"\\s*=\\s*\"(([^\"]|(\\\\\")|(\\\\\\n))+)\";$`)\n    matches := re.FindAllStringSubmatch(`\"some.key\" = \"A cool value.\";\n\"some.other.key\" = \"A cool value with %@ chars and \\n. Another Thing.\";\n\"escaped.key\" = \"A cool \\\"value\\\".\";\n\"multiline.key.value\" = \"1. First sentence is \\\"cool\\\"\\\n2. Second sentence\\\n3. Third sentence\\\n4. Fourth sentence\";\n`, -1)\n    for _, m := range matches {\n        fmt.Printf(\"%q %q\\n\", m[1], m[2])\n    }\n}\n</code></pre>\n\n<p>(I added the missing backslashes on the fourth line of your input.)</p>\n\n<p>See <a href=\"https://play.golang.org/p/ZHV8jpg17nY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ZHV8jpg17nY</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 307, "user_id": 5380266, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/90aebc1b6ff7537cd7d5557e3c7aa1d7?s=128&d=identicon&r=PG&f=1", "display_name": "jewnbug97", "link": "https://stackoverflow.com/users/5380266/jewnbug97"}, "edited": false, "score": 0, "creation_date": 1555779262, "post_id": 55775573, "comment_id": 98223732, "body": "Great idea!  One question though: after the custom split function my data is like this: ``` &lt;possible blank line&gt; /* A comment */ &quot;key&quot; = &quot;value&quot; ``` doing a string.split on that does not work if value is on multiple lines, scanner.Text() just returns 1 line of it :("}], "tags": [], "owner": {"reputation": 734, "user_id": 4801231, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5ca13f4ff6626c22c4c31b62f9908d1?s=128&d=identicon&r=PG&f=1", "display_name": "svetha.cvl", "link": "https://stackoverflow.com/users/4801231/svetha-cvl"}, "is_accepted": true, "score": 3, "last_activity_date": 1555778137, "creation_date": 1555778137, "answer_id": 55775573, "question_id": 55775085, "link": "https://stackoverflow.com/questions/55775085/turning-a-file-with-string-key-values-into-a-go-map/55775573#55775573", "title": "Turning a file with string key/values into a Go map", "body": "<p>A different approach- You could use a scanner with a custom <a href=\"https://golang.org/pkg/bufio/#SplitFunc\" rel=\"nofollow noreferrer\">split function</a> to split by your pair delimiter <code>;</code> and scan each individual key pair. Then split the key-value pair text by \"-\" to split your keys and values.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>file, err := os.Open(\"/my/string/file\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer f.Close()\n\nscanner := bufio.NewScanner(f)\nscanner.Split(customSplitFunc)\nfor scanner.Scan() {\n    fmt.Println(\"Key-Value Pair: \", scanner.Text())\n    //Split scanner.Text() by \"=\" to split key and value\n}\n</code></pre>\n\n<p>And define customSplitFunc as follows</p>\n\n<pre><code>func customSplitFunc(data []byte, atEOF bool) (advance int, token []byte, err error) {\n    if atEOF &amp;&amp; len(data) == 0 {\n        return 0, nil, nil\n    }\n\n    if atEOF {\n        return len(data), data, nil\n    }\n\n    //; followed by newline is the k-v pair delimiter\n    if i := strings.Index(string(data), \";\\n\"); i &gt;= 0 {\n        //skip the delimiter in advancing to the next pair\n        return i + 2, data[0:i], nil\n    }\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 307, "user_id": 5380266, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/90aebc1b6ff7537cd7d5557e3c7aa1d7?s=128&d=identicon&r=PG&f=1", "display_name": "jewnbug97", "link": "https://stackoverflow.com/users/5380266/jewnbug97"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 789, "favorite_count": 0, "accepted_answer_id": 55775573, "answer_count": 3, "score": 0, "last_activity_date": 1555778137, "creation_date": 1555774919, "question_id": 55775085, "link": "https://stackoverflow.com/questions/55775085/turning-a-file-with-string-key-values-into-a-go-map", "title": "Turning a file with string key/values into a Go map", "body": "<p>I have a file that contains string key / value pairs separated by an <code>=</code> sign.  It looks like this:</p>\n\n<pre><code>\"some.key\" = \"A cool value.\";\n\"some.other.key\" = \"A cool value with %@ chars and \\n. Another Thing.\";\n\"escaped.key\" = \"A cool \\\"value\\\".\";\n\"multiline.key.value\" = \"1. First sentence is \"cool\"\\\n2. Second sentence\\\n3. Third sentence\\\n4. Fourth sentence\";\n</code></pre>\n\n<p>Notice that a value can have escaped quotes inside of them, and they can also span multiple lines.</p>\n\n<p>I've tried basic quote matching, but it doesn't handle the escaped quotes within the values, etc...  Here's what I'm trying at the moment:</p>\n\n<pre><code>file, err := ioutil.ReadFile(\"/my/string/file\")\nif err != nil {\n    log.Fatal(err)\n}\n\nre := regexp.MustCompile(`\".*?\"`)\nmatch := re.FindAllString(string(file), -1)\nfmt.Println(match)\n</code></pre>\n\n<p>Any help would be appreciated :D</p>\n"}, {"tags": ["python", "go", "google-app-engine", "google-cloud-platform"], "answers": [{"tags": [], "owner": {"reputation": 15554, "user_id": 328036, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8db101b3a812b0464c53e5409c12ea94?s=128&d=identicon&r=PG", "display_name": "Dustin Ingram", "link": "https://stackoverflow.com/users/328036/dustin-ingram"}, "is_accepted": false, "score": 1, "last_activity_date": 1555956465, "creation_date": 1555956465, "answer_id": 55798928, "question_id": 55774958, "link": "https://stackoverflow.com/questions/55774958/using-ctypes-in-google-app-engine-to-use-binaries/55798928#55798928", "title": "Using ctypes in Google App Engine to use Binaries?", "body": "<p>You didn't specify, but I'm guessing you're using the Python 2.7 runtime, which is heavily sandboxed. Using the Python 3.7 runtime (which is more idiomatic) should allow you to use ctypes.</p>\n"}], "owner": {"reputation": 3544, "user_id": 2770024, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/1406884354/picture?type=large", "display_name": "Shaurya Chaudhuri", "link": "https://stackoverflow.com/users/2770024/shaurya-chaudhuri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1598295530, "creation_date": 1555774053, "last_edit_date": 1598295530, "question_id": 55774958, "link": "https://stackoverflow.com/questions/55774958/using-ctypes-in-google-app-engine-to-use-binaries", "title": "Using ctypes in Google App Engine to use Binaries?", "body": "<p>I was trying to do interfacing between GoLang &amp; Python. I have been a long time fan of Python and love using it. But Over Time I have udnerstood it is really bad for doing computations etc. Especially when there may be large data sets involved.</p>\n\n<p>I have started learning golang mainly because of its speed, and was thinking of using it in my Application as a library. Writing Intensive Code in GoLang and then use methods in the libraries in Python for writing Beautiful High Level Application code in Python.</p>\n\n<p>After doing the first prototype I deployed my code in GAE.</p>\n\n<p>Unfortunately I hit this</p>\n\n<pre><code>from ctypes import *\n  File \"/base/alloc/tmpfs/dynamic_runtimes/python27g/7679791231c143f9/python27/python27_dist/lib/python2.7/ctypes/__init__.py\", line 7,\n  in &lt;module&gt; from _ctypes import Union, Structure, Array\n  ImportError: No module named _ctypes\n</code></pre>\n\n<p>I have read that GAE doesnt support ctypes out of the box for Python Instances. But is there a way I can circumvent this and use my Go Binaries and use them on GAE?</p>\n\n<p>I followed this for my implementation and interfacing Go with Python <a href=\"https://medium.com/learning-the-go-programming-language/calling-go-functions-from-other-languages-4c7d8bcc69bf\" rel=\"nofollow noreferrer\">https://medium.com/learning-the-go-programming-language/calling-go-functions-from-other-languages-4c7d8bcc69bf</a></p>\n"}, {"tags": ["go", "webview", "webkitgtk"], "owner": {"reputation": 115, "user_id": 1474913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03112e170ea61f2da209f6d74b1f2aaa?s=128&d=identicon&r=PG", "display_name": "Armin", "link": "https://stackoverflow.com/users/1474913/armin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1555773748, "creation_date": 1555773748, "question_id": 55774917, "link": "https://stackoverflow.com/questions/55774917/how-to-invoke-an-external-action-based-on-a-javascript-call", "title": "How to invoke an &quot;external&quot; action based on a javascript call", "body": "<p>on a golang/webview application, I need to be able to call an external application when a certain javascript call is rendered on the web application.\nI have been using <a href=\"https://github.com/zserge/webview\" rel=\"nofollow noreferrer\">https://github.com/zserge/webview</a> and window.external.invoke for a while now, but it seems this call is deprecated, can you think of an alternative?</p>\n"}, {"tags": ["python-2.7", "go"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 2, "creation_date": 1555757786, "post_id": 55772793, "comment_id": 98218300, "body": "you should try to simplify your question by including  minimal complete code ... something we can execute to exhibit the issue ...     How to create a Minimal, Complete, and Verifiable example     <a href=\"https://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1555763076, "post_id": 55772793, "comment_id": 98219526, "body": "Are you sure jsonstring is what you think it is? The stack trace indicates that it&#39;s the byte slice conversion that attempts to allocate 130ish <i>terra</i> bytes of memory. An mcve would certainly help a lot."}, {"owner": {"reputation": 3544, "user_id": 2770024, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/1406884354/picture?type=large", "display_name": "Shaurya Chaudhuri", "link": "https://stackoverflow.com/users/2770024/shaurya-chaudhuri"}, "edited": false, "score": 0, "creation_date": 1555765197, "post_id": 55772793, "comment_id": 98220043, "body": "Added a minimum code . Yea thats what was weird that it was trying to allocatee 130 TB :S"}, {"owner": {"reputation": 3544, "user_id": 2770024, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/1406884354/picture?type=large", "display_name": "Shaurya Chaudhuri", "link": "https://stackoverflow.com/users/2770024/shaurya-chaudhuri"}, "edited": false, "score": 0, "creation_date": 1555765206, "post_id": 55772793, "comment_id": 98220045, "body": "I think its a memory leak of something"}], "answers": [{"tags": [], "owner": {"reputation": 3544, "user_id": 2770024, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/1406884354/picture?type=large", "display_name": "Shaurya Chaudhuri", "link": "https://stackoverflow.com/users/2770024/shaurya-chaudhuri"}, "is_accepted": true, "score": 0, "last_activity_date": 1555773566, "creation_date": 1555773566, "answer_id": 55774888, "question_id": 55772793, "link": "https://stackoverflow.com/questions/55772793/out-of-memory-when-using-golang-method-in-python/55774888#55774888", "title": "Out of Memory when using Golang method in Python", "body": "<p>The answer seems quite simple actually. It is a problem with typecasting which I missed.</p>\n\n<p>The method should accept <code>*C.char</code></p>\n\n<pre><code>//export DoJSONOperation\nfunc DoJSONOperation(jsonString *C.char) *C.char {\n    var GoString = C.GoString(jsonString)\n    var p = BuildFromJSON(GoString)\n    p = AddValue(p)\n    var nstr = ConvertToJSON(p)\n    return C.CString(nstr)\n}\n</code></pre>\n\n<p>And this seems to solve the problem.</p>\n\n<p>In Python we need to typecast as well. And instead of sending Python String we need to send.\n<code>c_char_p(jsonString)</code></p>\n"}], "owner": {"reputation": 3544, "user_id": 2770024, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/1406884354/picture?type=large", "display_name": "Shaurya Chaudhuri", "link": "https://stackoverflow.com/users/2770024/shaurya-chaudhuri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 55774888, "answer_count": 1, "score": 1, "last_activity_date": 1555773566, "creation_date": 1555757535, "last_edit_date": 1555765155, "question_id": 55772793, "link": "https://stackoverflow.com/questions/55772793/out-of-memory-when-using-golang-method-in-python", "title": "Out of Memory when using Golang method in Python", "body": "<p>I have been following this\n<a href=\"https://medium.com/learning-the-go-programming-language/calling-go-functions-from-other-languages-4c7d8bcc69bf\" rel=\"nofollow noreferrer\">https://medium.com/learning-the-go-programming-language/calling-go-functions-from-other-languages-4c7d8bcc69bf</a></p>\n\n<p>Now, what I am doing is:-</p>\n\n<ul>\n<li>Pass a Json String</li>\n<li>Use Json Unmarshall with a Go Struct Reference &amp; the string</li>\n<li>Do Business Logic &amp; Operations</li>\n<li>Marshal the struct to JSON String</li>\n<li>Return</li>\n</ul>\n\n<p>Now, the issue I am facing is that I am getting an <code>Out-of-Memory</code> exception when running it through python. If I run it through normal Go, then it works good.</p>\n\n<p>Also if I dont unmarshal and just initialize the structure normally then I do not have an issue, and get a json string back. But I need to pass a structured data between both.</p>\n\n<p>The issue occurs in the Unmarshal Line</p>\n\n<pre><code>func BuildCRMLinkFromJSON(jsonstring string) CRMLinkBO {\n    var crmLink CRMLink = CRMLink{}\n    json.Unmarshal([]byte(jsonstring), &amp;crmLink)\n    var clb = CRMLinkBO{crmLink: crmLink}\n    return clb\n}\n</code></pre>\n\n<p>The runtime error is:</p>\n\n<pre><code>runtime: out of memory: cannot allocate 140328041390080-byte block (66781184 in use)\nfatal error: out of memory\n</code></pre>\n\n<p>or </p>\n\n<pre><code>Shauryas-MacBook-Pro:go-python-interfacing xuryax$ python pythonclient.py \nunexpected fault address 0x210c1a334\nfatal error: fault\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x210c1a334 pc=0x1087b0c75]\n</code></pre>\n\n<p>Minimal Reproduce:\n<code>usego.go</code></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nimport \"C\"\n\n// Data Model\n\ntype CustomField struct {\n    Field string `json:\"field\"`\n    Value string `json:\"value\"`\n}\n\ntype PersonDetails struct {\n    Person_id string        `json:\"person_id\"`\n    Detail    []CustomField `json:\"detail\"`\n}\n\nfunc New(pid string) PersonDetails {\n    var p = PersonDetails{\"HARDCODED PID IN GO\", []CustomField{}}\n    return p\n}\n\nfunc BuildFromJSON(jsonString string) PersonDetails {\n    var person_detail PersonDetails = PersonDetails{}\n    json.Unmarshal([]byte(jsonString), &amp;person_detail)\n    return person_detail\n}\n\nfunc ConvertToJSON(p PersonDetails) string {\n    fmt.Println(p)\n    var je, _ = json.Marshal(p)\n    return string(je)\n}\n\nfunc AddValue(p PersonDetails) PersonDetails {\n    var CustField = CustomField{\"Hardcoded Field in Go\", \"Hardcoded Value in Gos\"}\n    p.Detail = append(p.Detail, CustField)\n    return p\n}\n\n//export DoJSONOperation\nfunc DoJSONOperation(jsonString string) *C.char {\n    var p = BuildFromJSON(jsonString)\n    p = AddValue(p)\n    var nstr = ConvertToJSON(p)\n    return C.CString(nstr)\n}\n\n//export DoNormalOperation\nfunc DoNormalOperation(jsonString string) *C.char {\n    var p = New(jsonString)\n    p = AddValue(p)\n    var nstr = ConvertToJSON(p)\n    fmt.Println(\"Before Return: \", string(nstr))\n    return C.CString(nstr)\n}\n\nfunc main() {\n    // DO noting\n    // var jsonStr = `{\"person_id\":\"JsonID\",\"detail\":[{\"field\":\"json passed field\", \"value\":\"json passed value\"}]}`\n}\n</code></pre>\n\n<p>PythonClient.py</p>\n\n<pre><code>from ctypes import *\nimport json\n\ndef main():\n    lib = cdll.LoadLibrary(\"/Users/xuryax/work/repos/research/go-python-interfacing/usego.so\")\n\n    lib.DoJSONOperation.argtypes = [c_char_p]\n    lib.DoJSONOperation.restype = c_char_p\n\n    json_string = \"\"\"{\"person_id\":\"PythonJsonID\",\"detail\":[{\"field\":\"json passed field\", \"value\":\"json passed value\"}]}\"\"\"\n    normal_pid = \"Python ID\"\n    updated_json = lib.DoNormalOperation(normal_pid)\n\n    print(updated_json)\n\n\nif __name__==\"__main__\":\n    main()\n</code></pre>\n\n<p>Weird thing I found in if I use the one with hardcoded it is returning Pointer(integer) but On my previous experiment, I did get a string back.</p>\n"}, {"tags": ["go", "systemctl"], "answers": [{"comments": [{"owner": {"reputation": 1818, "user_id": 9506712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zueWr.jpg?s=128&g=1", "display_name": "Tarasovych", "link": "https://stackoverflow.com/users/9506712/tarasovych"}, "edited": false, "score": 0, "creation_date": 1555753277, "post_id": 55772175, "comment_id": 98217259, "body": "Please, add <code>systemctl daemon-reload</code> after changing <code>.service</code> file, so I can accept your answer"}, {"owner": {"reputation": 1662, "user_id": 786821, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f73f56fed713342efd1038eba8b1f05e?s=128&d=identicon&r=PG", "display_name": "SunSparc", "link": "https://stackoverflow.com/users/786821/sunsparc"}, "edited": false, "score": 0, "creation_date": 1601920365, "post_id": 55772175, "comment_id": 113550210, "body": "You may also need to restart the app: <code>systemctl restart &lt;appname&gt;</code>"}], "tags": [], "owner": {"reputation": 149903, "user_id": 14637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1904e7096278a10f1dfb3fdc0ceb53cc?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/14637/thomas"}, "is_accepted": true, "score": 10, "last_activity_date": 1555753354, "last_edit_date": 1555753354, "creation_date": 1555752989, "answer_id": 55772175, "question_id": 55772127, "link": "https://stackoverflow.com/questions/55772127/go-cant-find-file-while-running-as-a-systemctl-service-on-ubuntu/55772175#55772175", "title": "Go can&#39;t find file while running as a systemctl service on Ubuntu", "body": "<blockquote>\n  <p>I have my .env file in the same directory where my executable is.</p>\n</blockquote>\n\n<p>Then you need to configure your working directory to match:</p>\n\n<pre><code>[Service]\n...\nWorkingDirectory=/var/path/to/my/app\n</code></pre>\n\n<p>Remember to run <code>systemctl daemon-reload</code> after changing any unit file.</p>\n"}], "owner": {"reputation": 1818, "user_id": 9506712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zueWr.jpg?s=128&g=1", "display_name": "Tarasovych", "link": "https://stackoverflow.com/users/9506712/tarasovych"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1233, "favorite_count": 1, "accepted_answer_id": 55772175, "answer_count": 1, "score": 6, "last_activity_date": 1555753354, "creation_date": 1555752549, "last_edit_date": 1555753210, "question_id": 55772127, "link": "https://stackoverflow.com/questions/55772127/go-cant-find-file-while-running-as-a-systemctl-service-on-ubuntu", "title": "Go can&#39;t find file while running as a systemctl service on Ubuntu", "body": "<p>I have a Go app, and I'm trying to run it as a <code>systemctl</code> service (Ubuntu 18.04).</p>\n\n<p>I'm using <a href=\"https://github.com/joho/godotenv\" rel=\"noreferrer\">godotenv</a>:</p>\n\n<pre><code>func init() {\n    var env map[string]string\n    env, err := godotenv.Read()\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>I have my <code>.env</code> file in the same directory where my executable is.</p>\n\n<p>I've created a <code>service</code> file:</p>\n\n<pre><code>[Unit]\nDescription=my go app\nRequires=local-fs.target\nAfter=rsyslog.service\n\n[Service]\nType=forking\nGuessMainPID=no\nStandardInput=null\nExecStart=/var/path/to/my/app/main\n\n[Install]\nWantedBy=default.target\n</code></pre>\n\n<p>After executing <code>sudo systemctl start my-go-app.service</code>, then <code>sudo systemctl status my-go-app.service</code>, I got these in my logs:</p>\n\n<blockquote>\n  <p>Starting my-go-app...<br>\n  panic: open .env: no such file or directory</p>\n</blockquote>\n\n<p>What's wrong?</p>\n\n<p>While executing <code>main</code> directly, there are no such problems.</p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 125, "user_id": 5626368, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/44c3e777c124eb6d8d585b72e6c52368?s=128&d=identicon&r=PG&f=1", "display_name": "Hemanth Savasere", "link": "https://stackoverflow.com/users/5626368/hemanth-savasere"}, "edited": false, "score": 0, "creation_date": 1555927354, "post_id": 55771966, "comment_id": 98254325, "body": "If there is any way by which I can get a count of errors and warnings through logs generated by logrus."}], "answers": [{"tags": [], "owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "is_accepted": true, "score": 1, "last_activity_date": 1555929611, "creation_date": 1555929611, "answer_id": 55793051, "question_id": 55771966, "link": "https://stackoverflow.com/questions/55771966/how-to-check-logs-generated-through-logrus-to-get-a-count-of-the-no-of-errors/55793051#55793051", "title": "How to check logs generated through logrus, to get a count of the no. of errors and warnings", "body": "<p>You can use hooks in logrus. Hook will be called each time an log will be called for a level.</p>\n\n<pre><code>// You can make Errors and Warnings as atomic integers or probably \n// use locks to make it thread safe\ntype ErrorsAndWarnings struct{\n        Errors int\n        Warnings int\n}\n\nvar (\n    levels = []logrus.Level{logrus.WarnLevel, logrus.ErrorLevel}\n)\n\nfunc (h *ErrorsAndWarnings) Levels() []logrus.Level {\n    return levels\n}\n\nfunc (h *ErrorsAndWarnings) Fire(entry *logrus.Entry) error {\n    if entry.Level == logrus.ErrorLevel{\n      h.Errors++\n    }else if entry.Level == logrus.WarnLevel{\n       h.Warnings++\n    }\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 125, "user_id": 5626368, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/44c3e777c124eb6d8d585b72e6c52368?s=128&d=identicon&r=PG&f=1", "display_name": "Hemanth Savasere", "link": "https://stackoverflow.com/users/5626368/hemanth-savasere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 55793051, "answer_count": 1, "score": 1, "last_activity_date": 1555929611, "creation_date": 1555751131, "last_edit_date": 1555927235, "question_id": 55771966, "link": "https://stackoverflow.com/questions/55771966/how-to-check-logs-generated-through-logrus-to-get-a-count-of-the-no-of-errors", "title": "How to check logs generated through logrus, to get a count of the no. of errors and warnings", "body": "<p>I wanted to a way through which we could keep the count of no. of errors and warnings that have occurred in logrus logs.</p>\n\n<p>I want to use a struct to keep count of the errors and warnings,</p>\n\n<pre><code>    type ErrorsAndWarnings struct{\n        Errors int\n        Warnings int\n    }\n</code></pre>\n"}, {"tags": ["go", "build"], "owner": {"reputation": 1589, "user_id": 591935, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/88818111c4091d9916c3e4e5ea590dbb?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/591935/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1555746290, "creation_date": 1555741571, "last_edit_date": 1555746290, "question_id": 55770901, "link": "https://stackoverflow.com/questions/55770901/incremental-builds-not-working-with-go-build-only-with-go-install", "title": "Incremental builds not working with go build, only with go install", "body": "<p>I'm running a project using Go Modules with 1.11.4 on Ubuntu, running in WSL.\nMy problem is that I'm having getting incremental builds to work as I expect. Perhaps this is due to me misunderstanding how it's supposed to, but I'd be glad if someone could clarify if that is the case. </p>\n\n<p>Just as an example, if I do <code>go build ./...</code> then everything is built, as expected.\nIf I now do <code>go build ./...</code> again without any changes, my expectation was that due to the incremental builds, this time nothing would be built. But it builds <em>everything</em> again. I tried doing <code>go build -i ./...</code> (even though my understanding is that -i isn't needed anymore from 1.10), but the result is the same. This has been puzzling me for some time, as after reading the documentation I indeed expected the <code>go build</code> command to produce incremental builds. </p>\n\n<p>The other day I realized that if instead I do <code>go install ./...</code> first, and then <code>go install ./...</code> again a second time, the second time around nothing is built, as I would expect. If I change a single module and run <code>go install ./...</code> again, then <em>only</em> that module is rebuilt, again what I would expect. So this gives me incremental builds.</p>\n\n<p>So my questions are\n1) Did I misunderstand <code>go build ./...</code> and how it handles incremental builds? Do I need to use <code>go install</code> instead?\n2) Typically, we build the modules one by one, using the <code>-o</code> flag to specify an output path. Using <code>go install</code> instead, there is no <code>-o</code> option to specify an output path. Is there anything I can do to achieve something similar to <code>-o</code> using <code>go install</code>?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1555730106, "post_id": 55769838, "comment_id": 98213415, "body": "A single regular expression cannot do what you want.  (It&#39;s not a limitation of golang or its regular expression implementation, but a theoretical limitation that any regular language / regular expression implementation will exhibit.)"}, {"owner": {"reputation": 3243, "user_id": 5454400, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/50623f5ea714bc6271f9c34b13b090ab?s=128&d=identicon&r=PG&f=1", "display_name": "peachykeen", "link": "https://stackoverflow.com/users/5454400/peachykeen"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1555730583, "post_id": 55769838, "comment_id": 98213469, "body": "I see, so would an approach of using multiple small regexs be a solid, idiomatic way of going about solving the problem? I&#39;m pretty new to Go, so I am still figuring out how to do things simply."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1555764999, "post_id": 55769838, "comment_id": 98219994, "body": "Do not disallow particular characters in passwords. It makes it hard to use password managers and since you are going to hash the passwords (right?!) it doesn&#39;t matter what the input is."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1555769104, "post_id": 55769838, "comment_id": 98220961, "body": "Peter - But if we hash the passwords, how can we send them to the users when they forget them???   ;)   [edit:  that&#39;s sarcasm.  don&#39;t do that]"}], "answers": [{"comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 1, "creation_date": 1555761161, "post_id": 55769988, "comment_id": 98219026, "body": "Note: this is also much faster than any regex!"}], "tags": [], "owner": {"reputation": 17195, "user_id": 2303610, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/09a878923ff2d6258a9f5a1c5deec5eb?s=128&d=identicon&r=PG", "display_name": "ittus", "link": "https://stackoverflow.com/users/2303610/ittus"}, "is_accepted": true, "score": 2, "last_activity_date": 1555730898, "creation_date": 1555730898, "answer_id": 55769988, "question_id": 55769838, "link": "https://stackoverflow.com/questions/55769838/ensure-specific-characters-are-in-a-string-regardless-of-position-using-a-rege/55769988#55769988", "title": "Ensure specific characters are in a string, regardless of position, using a regex in Golang", "body": "<p>Since golang use <a href=\"https://github.com/google/re2\" rel=\"nofollow noreferrer\">re2</a>, it doesn't support positive-lookahead (?=regex), so I'm not sure if there is a way to write a regex that cover all cases.</p>\n\n<p>Instead, you can use <code>unicode</code> package:</p>\n\n<pre><code>func verifyPassword(s string) bool {\n    var hasNumber, hasUpperCase, hasLowercase, hasSpecial bool\n    for _, c := range s {\n        switch {\n        case unicode.IsNumber(c):\n            hasNumber = true\n        case unicode.IsUpper(c):\n            hasUpperCase = true\n        case unicode.IsLower(c):\n            hasLowercase = true\n        case c == '#' || c == '|':\n            return false\n        case unicode.IsPunct(c) || unicode.IsSymbol(c):\n            hasSpecial = true\n        }\n    }\n    return hasNumber &amp;&amp; hasUpperCase &amp;&amp; hasLowercase &amp;&amp; hasSpecial\n}\n</code></pre>\n"}], "owner": {"reputation": 3243, "user_id": 5454400, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/50623f5ea714bc6271f9c34b13b090ab?s=128&d=identicon&r=PG&f=1", "display_name": "peachykeen", "link": "https://stackoverflow.com/users/5454400/peachykeen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 55769988, "answer_count": 1, "score": 0, "last_activity_date": 1555730898, "creation_date": 1555728669, "question_id": 55769838, "link": "https://stackoverflow.com/questions/55769838/ensure-specific-characters-are-in-a-string-regardless-of-position-using-a-rege", "title": "Ensure specific characters are in a string, regardless of position, using a regex in Golang", "body": "<p>I am building a super simple function to ensure a password contains specific characters. Namely, the password should have the following:</p>\n\n<ul>\n<li>One lowercase letter</li>\n<li>One uppercase letter</li>\n<li>One digit</li>\n<li>One special character</li>\n<li>No white space, <code>#</code>, or <code>|</code></li>\n</ul>\n\n<p>I thought regex would be the simplest way to go about doing this. But, I am having a hard time figuring out how to do this in Golang. Currently, I have a bunch of separate regex <code>MatchString</code> functions which I will combine to get the desired functionality. For example:</p>\n\n<pre><code>lowercaseMatch := regexp.MustCompile(`[a-z]`).MatchString\nuppercaseMatch := regexp.MustCompile(`[A-Z]`).MatchString\ndigitMatch := regexp.MustCompile(`\\d`).MatchString\nspecialMatch := regexp.MustCompile(`\\W`).MatchString\nbadCharsMatch := regexp.MustCompile(`[\\s#|]`).MatchString\nif (lowercaseMatch(pwd) \n        &amp;&amp; uppercaseMatch(pwd) \n        &amp;&amp; digitMatch(pwd)\n        &amp;&amp; specialMatch(pwd)\n        &amp;&amp; !badCharsMatch(pwd)) {\n    /* password OK */\n} else {\n    /* password BAD */\n}\n</code></pre>\n\n<p>While this makes things pretty readable, I would prefer a more concise regex, but I don't know how to get regex to search for a single character of each of the above categories (regardless of position). Can someone point me in the right direction of how to achieve this? Additionally, if there is a better way to do this than regex, I am all ears.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "visual-studio-code"], "answers": [{"tags": [], "owner": {"reputation": 1465, "user_id": 1803356, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/4P5Wk.png?s=128&g=1", "display_name": "suiwenfeng", "link": "https://stackoverflow.com/users/1803356/suiwenfeng"}, "is_accepted": false, "score": 0, "last_activity_date": 1610686027, "creation_date": 1610686027, "answer_id": 65730656, "question_id": 55769301, "link": "https://stackoverflow.com/questions/55769301/can-visual-studio-debug-go-plugins/65730656#65730656", "title": "Can Visual Studio debug Go plugins?", "body": "<p>If you want add debug state into .so file</p>\n<pre><code>go build -gcflags &quot;all=-N -l&quot; -x -v -buildmode=plugin -o plugin/plugin.so plugin/plugin.go\n</code></pre>\n<p>But when you want to build in production, please ignore those options.</p>\n<pre><code>go build -buildmode=plugin -o plugin/plugin.so plugin/plugin.go\n</code></pre>\n<p>More details <a href=\"https://github.com/go-delve/delve/issues/1628\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 31, "user_id": 10897593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-yO2uM6kldVY/AAAAAAAAAAI/AAAAAAAAAVQ/Y3tNksnFFtc/photo.jpg?sz=128", "display_name": "Nick Pollitt", "link": "https://stackoverflow.com/users/10897593/nick-pollitt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1610686027, "creation_date": 1555721404, "question_id": 55769301, "link": "https://stackoverflow.com/questions/55769301/can-visual-studio-debug-go-plugins", "title": "Can Visual Studio debug Go plugins?", "body": "<p>I have a Go project that consists of a command line tool and some Go plugins.  I have a build script that builds the CLI, and then goes into a plugins directory and compiles each plugin with the <code>-buildmode=plugin</code> option.  I would like to figure out if <code>launch.json</code> can be configured to selectively pass the <code>buildmode</code> flag.</p>\n\n<p>If I pre-build the plugins and then run the debugger on just the CLI tool, the plugins won't load because they were \"built with different version of package X\".</p>\n\n<p>I created a task in <code>tasks.json</code> to call my build script, and added that task as a <code>preLaunchTask</code> for my debug session, but that's not doing the trick.</p>\n\n<pre><code>#!/bin/bash\nset -x \ngo build ./cmd/...\ncd plugins\nfor DIR in `find . ! -path . -type d`\ndo\n    go build -buildmode=plugin $DIR/*.go\ndone\n</code></pre>\n"}, {"tags": ["mysql", "database", "go", "driver"], "answers": [{"tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 4, "last_activity_date": 1555761558, "creation_date": 1555761558, "answer_id": 55773297, "question_id": 55769203, "link": "https://stackoverflow.com/questions/55769203/golang-mysql-driver-failing-at-parameter-replacement/55773297#55773297", "title": "golang mysql driver failing at parameter replacement", "body": "<p>Question marks <code>?</code> in prepared statements are for values, not table, database or column names.</p>\n\n<p>Use <code>fmt.Sprintf</code> to fill in the database structure related values.</p>\n\n<p>Example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>_, err := db.db.Prepare(fmt.Sprintf(\"SELECT value FROM %s WHERE key = ?\", table))\n</code></pre>\n"}], "owner": {"reputation": 427, "user_id": 1797466, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/c5039ea72a1a51ebf53b098c171da65e?s=128&d=identicon&r=PG", "display_name": "user1797466", "link": "https://stackoverflow.com/users/1797466/user1797466"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 397, "favorite_count": 0, "accepted_answer_id": 55773297, "answer_count": 1, "score": -1, "last_activity_date": 1555761558, "creation_date": 1555720061, "question_id": 55769203, "link": "https://stackoverflow.com/questions/55769203/golang-mysql-driver-failing-at-parameter-replacement", "title": "golang mysql driver failing at parameter replacement", "body": "<p>OS Mojave, \nMySQL v8.0.15,\ngo 1.12.3 darwin/amd64</p>\n\n<pre><code>import (\n    \"database/sql\"\n\n    // import mysql driver anonymously (just run the init)\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\n...\n\n_, err = db.db.Exec(\"USE ?\", \"test\")\nif err != nil {\n    return errors.Wrapf(err, \"error selecting database %s\", opt.Database)\n}\n\n_, err = db.db.Prepare(\"SELECT value FROM ? WHERE key = ?\")\nif err != nil {\n    return errors.Wrap(err, \"error generating SELECT statement\")\n}\n</code></pre>\n\n<p>The error I get is <code>error selecting database test: Error 1064: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '?' at line 1</code></p>\n\n<p>I get the same error (about syntax around '?') for any parameter replacement I attempt to do. I've checked the manual as well as tutorials and examples I've found online and can't quite tell what I'm doing wrong. </p>\n\n<p>If I replace the '?'s with values (strings) then everything works fine. </p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 5895, "user_id": 2834978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05b09a797fd0c59d1627b30fb4cdba01?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Mu&#241;oz", "link": "https://stackoverflow.com/users/2834978/luis-mu%c3%b1oz"}, "edited": false, "score": 0, "creation_date": 1555722574, "post_id": 55769170, "comment_id": 98212541, "body": "Well, what do you want to do with the matching text, extract, replace?"}, {"owner": {"reputation": 17, "user_id": 4459776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adef5ae28862554b43e4757457559ab6?s=128&d=identicon&r=PG&f=1", "display_name": "Dyl", "link": "https://stackoverflow.com/users/4459776/dyl"}, "reply_to_user": {"reputation": 5895, "user_id": 2834978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05b09a797fd0c59d1627b30fb4cdba01?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Mu&#241;oz", "link": "https://stackoverflow.com/users/2834978/luis-mu%c3%b1oz"}, "edited": false, "score": 0, "creation_date": 1555793678, "post_id": 55769170, "comment_id": 98227324, "body": "No, I want to extract the test project name <code>test-project-233</code> for example. Not from slicing but dynamically extract it"}], "answers": [{"tags": [], "owner": {"reputation": 3566, "user_id": 8089090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c8fc31c29878a0b7a90c1174d366e90?s=128&d=identicon&r=PG&f=1", "display_name": "Jonathan Gagne", "link": "https://stackoverflow.com/users/8089090/jonathan-gagne"}, "is_accepted": false, "score": 2, "last_activity_date": 1555720078, "creation_date": 1555720078, "answer_id": 55769206, "question_id": 55769170, "link": "https://stackoverflow.com/questions/55769170/how-to-create-a-regex-that-will-find-a-substring-of-a-complex-url/55769206#55769206", "title": "How to create a regex that will find a substring of a complex URL", "body": "<p>The regex would be <code>([a-z]*-){2}\\d*</code>. In order to simplify your research, go on <a href=\"https://regexr.com/\" rel=\"nofollow noreferrer\">https://regexr.com/</a> and past your links in. From there you will be able to create your regex step by step easily.</p>\n"}, {"comments": [{"owner": {"reputation": 17, "user_id": 4459776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adef5ae28862554b43e4757457559ab6?s=128&d=identicon&r=PG&f=1", "display_name": "Dyl", "link": "https://stackoverflow.com/users/4459776/dyl"}, "edited": false, "score": 0, "creation_date": 1555793386, "post_id": 55769263, "comment_id": 98227267, "body": "Thanks for that, but this only make sense for urls that has a fixed size of names etc. This is not dynamic enough. Thanks tho!"}], "tags": [], "owner": {"reputation": 41, "user_id": 11386308, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/3606e1e7f7f3916bcf05c9ee831ba581?s=128&d=identicon&r=PG", "display_name": "mandonoddo", "link": "https://stackoverflow.com/users/11386308/mandonoddo"}, "is_accepted": false, "score": 4, "last_activity_date": 1555720849, "creation_date": 1555720849, "answer_id": 55769263, "question_id": 55769170, "link": "https://stackoverflow.com/questions/55769170/how-to-create-a-regex-that-will-find-a-substring-of-a-complex-url/55769263#55769263", "title": "How to create a regex that will find a substring of a complex URL", "body": "<p>A regexp is not needed.  Just slice off the start of the string:</p>\n\n<pre><code>for _, s := range []string{\n    \"test-project-233-TEST-ENDPOINT.test.as.ds.abcdefg.com\",\n    \"test-project-124-ENDPOINT.test.dd.ad.gf.abcdefg.com\",\n} {\n    fmt.Println(s[:16])\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/rtoQ7hLpmVJ\" rel=\"noreferrer\">https://play.golang.org/p/rtoQ7hLpmVJ</a></p>\n"}], "owner": {"reputation": 17, "user_id": 4459776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adef5ae28862554b43e4757457559ab6?s=128&d=identicon&r=PG&f=1", "display_name": "Dyl", "link": "https://stackoverflow.com/users/4459776/dyl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1555720849, "creation_date": 1555719647, "question_id": 55769170, "link": "https://stackoverflow.com/questions/55769170/how-to-create-a-regex-that-will-find-a-substring-of-a-complex-url", "title": "How to create a regex that will find a substring of a complex URL", "body": "<p>Need some guidance on creating a regex that will identify part of the URL.</p>\n\n<pre><code>URL1: test-project-233-TEST-ENDPOINT.test.as.ds.abcdefg.com\nURL2: test-project-124-ENDPOINT.test.dd.ad.gf.abcdefg.com\n</code></pre>\n\n<p>The goal is to build a regex that can parse out \"test-project-233\" and \"test-project-124\" for me.</p>\n\n<p>I've already tried to google around and finding complex regex differentiation. It would be awesome to get some pointers on this issue.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1555718939, "creation_date": 1555718939, "answer_id": 55769114, "question_id": 55768994, "link": "https://stackoverflow.com/questions/55768994/running-multiple-methods-periodically/55769114#55769114", "title": "Running multiple methods periodically", "body": "<p>To prevent the application from exiting, the main goroutine must block.</p>\n\n<p>Use <code>select {}</code> to block the main goroutine.</p>\n\n<p>Because the tickers run for the duration of the application, there's no need to stop the tickers.</p>\n\n<pre><code>func main() {\n    schedule(ping, time.Second)\n    schedule(ping, 2*time.Second)\n    select {}\n}\n</code></pre>\n"}], "owner": {"reputation": 453, "user_id": 6060482, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6898272ab810e419c2c9ca9af1e53da8?s=128&d=identicon&r=PG", "display_name": "lennard", "link": "https://stackoverflow.com/users/6060482/lennard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 55769114, "answer_count": 1, "score": 2, "last_activity_date": 1555718939, "creation_date": 1555717666, "question_id": 55768994, "link": "https://stackoverflow.com/questions/55768994/running-multiple-methods-periodically", "title": "Running multiple methods periodically", "body": "<p>I'm new to go and trying to make two methods run at the same time periodically for as long at the application is running. I've managed to come up with the following but the <code>for true</code> part does not feel right as this is blocking.</p>\n\n<p>Would channels be a better way todo this? Any pointers in the right direction would be helpful.</p>\n\n<pre><code>func main() {\n    t1 := schedule(ping, time.Second)\n    t2 := schedule(ping, 2*time.Second)\n    for true {\n        time.Sleep(1 * time.Second)\n    }\n    t1.Stop()\n    t2.Stop()\n}\n\nfunc schedule(f func(interval time.Duration), interval time.Duration) *time.Ticker {\n    ticker := time.NewTicker(interval)\n    go func() {\n        for range ticker.C {\n            f(interval)\n        }\n    }()\n    return ticker\n}\n\nfunc ping(interval time.Duration) {\n    log.Println(\"ping \", interval)\n}\n</code></pre>\n"}, {"tags": ["go", "concurrency", "redis", "redigo"], "answers": [{"comments": [{"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "edited": false, "score": 0, "creation_date": 1556086941, "post_id": 55795492, "comment_id": 98312473, "body": "After my test and answer from &quot;github.com/gomodule/redigo/redis&quot; issue, it is a problem of redis, the solution is to set a proper routine size."}], "tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": false, "score": 2, "last_activity_date": 1555941489, "last_edit_date": 1555941489, "creation_date": 1555941151, "answer_id": 55795492, "question_id": 55768699, "link": "https://stackoverflow.com/questions/55768699/golang-redis-concurrency-scheduler-performance-issue/55795492#55795492", "title": "golang + redis concurrency scheduler performance issue", "body": "<p>At a surface level the only thing that I have questions about is ordering of incrementing wait group and enqueing the work:</p>\n\n<pre><code>func (s *Scheduler) Enqueue(req interface{}) {\n    select {\n    case s.reqChan &lt;- req:\n        s.wg.Add(1)\n    }\n}\n</code></pre>\n\n<p>I don't think the above will cause much problem in practice with this large of workload, but I think it may be a logical race condition. At lower levels of concurrency and smaller work sizes, it may enqueue a message, conext switch to a goroutine that starts work on that message, THEN the work in the wait group.</p>\n\n<hr>\n\n<p>Next are you sure <code>process</code> method is threadsafe?? I'd assume so based on the redis go documentation , does running with <code>go run -race</code> have any output?</p>\n\n<hr>\n\n<p>At some point It's completely reasonable and expected for performance to drop off.   I would recommend starting performance tests to see where latency and throughput start to drop off:</p>\n\n<p>maybe a pool of 10, 100, 500, 1000, 2500, 5000, 10000, or whatever makes sense. IMO it looks like there are 3 important variables to tune:</p>\n\n<ul>\n<li>Worker pool size</li>\n<li>Work Queue Buffer Size</li>\n<li>Redis <code>MaxActive</code></li>\n</ul>\n\n<p>The biggest thing that jumps out is that it looks like <a href=\"https://godoc.org/github.com/gomodule/redigo/redis#Pool\" rel=\"nofollow noreferrer\">redis.Pool is configured to allow an unbounded number of connections</a>:</p>\n\n<pre><code> pool := &amp;redis.Pool{\n        MaxIdle:     50,\n        IdleTimeout: 240 * time.Second,\n        TestOnBorrow: func(c redis.Conn, t time.Time) error {\n            _, err := c.Do(\"PING\")\n            return err\n        },\n        Dial: func() (redis.Conn, error) {\n            return dial(\"tcp\", address, password)\n        },\n    }\n</code></pre>\n\n<blockquote>\n  <p>// Maximum number of connections allocated by the pool at a given\n  time.\n      // When zero, there is no limit on the number of connections in the pool.\n      MaxActive int</p>\n</blockquote>\n\n<hr>\n\n<p>I would personally try to understand where and when performance starts to drop off with respect to the size of your worker pool.  This might make it easier to understand what your program is constrained by.</p>\n"}, {"tags": [], "owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "is_accepted": false, "score": 0, "last_activity_date": 1565700386, "last_edit_date": 1565700386, "creation_date": 1556087032, "answer_id": 55823589, "question_id": 55768699, "link": "https://stackoverflow.com/questions/55768699/golang-redis-concurrency-scheduler-performance-issue/55823589#55823589", "title": "golang + redis concurrency scheduler performance issue", "body": "<p>My test result shows, when the routine number increases, the execution time per routine per take function increases nearly exponentially.</p>\n\n<p>It should be a problem of redis, here is reply from redis library community:</p>\n\n<blockquote>\n  <p>The problem is what you suspected the pool connection lock, which if your requests are small / quick will pushing the serialisation of your requests.</p>\n  \n  <p>You should note that redis is single threaded so you should be able to obtain peak performance with just a single connection. This isn't quite true due to the round trip delays from client to server but in this type of use case a limited number of processors is likely the best approach.</p>\n  \n  <p>I have some ideas on how we could improve pool.Get() / conn.Close() but in your case tuning the number of routines would be the best approach.</p>\n</blockquote>\n"}], "owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1253, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1565700386, "creation_date": 1555714684, "last_edit_date": 1555759863, "question_id": 55768699, "link": "https://stackoverflow.com/questions/55768699/golang-redis-concurrency-scheduler-performance-issue", "title": "golang + redis concurrency scheduler performance issue", "body": "<p>I write a simple concurrency scheduler, but it seems to have a performance issue at a high level concurrency.</p>\n\n<p>Here is the code (scheduler + concurrent rate limiter test):</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"runtime\"\n    \"runtime/pprof\"\n    \"sync\"\n    \"time\"\n\n    \"github.com/gomodule/redigo/redis\"\n)\n\n// a scheduler is composed by load function and process function\ntype Scheduler struct {\n    // query channel\n    reqChan chan interface{}\n\n    // max routine\n    maxRoutine int\n\n    // max routine\n    chanSize int\n\n    wg sync.WaitGroup\n\n    // query process function\n    process func(interface{})\n}\n\nfunc NewScheduler(maxRoutine int, chanSize int, process func(interface{})) *Scheduler {\n    s := &amp;Scheduler{}\n    if maxRoutine == 0 {\n        s.maxRoutine = 10\n    } else {\n        s.maxRoutine = maxRoutine\n    }\n\n    if chanSize == 0 {\n        s.chanSize = 100\n    } else {\n        s.chanSize = chanSize\n    }\n\n    s.reqChan = make(chan interface{}, s.chanSize)\n    s.process = process\n    return s\n}\n\nfunc (s *Scheduler) Start() {\n    // start process\n    for i := 0; i &lt; s.maxRoutine; i++ {\n        go s.processRequest()\n    }\n}\n\nfunc (s *Scheduler) processRequest() {\n    for {\n        select {\n        case req := &lt;-s.reqChan:\n            s.process(req)\n            s.wg.Done()\n        }\n    }\n}\n\nfunc (s *Scheduler) Enqueue(req interface{}) {\n    select {\n    case s.reqChan &lt;- req:\n        s.wg.Add(1)\n    }\n}\n\nfunc (s *Scheduler) Wait() {\n    s.wg.Wait()\n}\n\nconst script = `\nlocal required_permits = tonumber(ARGV[2]);\n\nlocal next_free_micros = redis.call('hget',KEYS[1],'next_free_micros');\nif(next_free_micros == false) then\n    next_free_micros = 0;\nelse\n    next_free_micros = tonumber(next_free_micros);\nend;\n\nlocal time = redis.call('time');\nlocal now_micros = tonumber(time[1])*1000000 + tonumber(time[2]);\n\n--[[\ntry aquire\n--]]\nif(ARGV[3] ~= nil) then\n    local micros_to_wait = next_free_micros - now_micros;\n    if(micros_to_wait &gt; tonumber(ARGV[3])) then\n        return micros_to_wait;\n    end\nend\n\nlocal stored_permits = redis.call('hget',KEYS[1],'stored_permits');\nif(stored_permits == false) then\n    stored_permits = 0;\nelse\n    stored_permits = tonumber(stored_permits);\nend\n\nlocal stable_interval_micros = 1000000/tonumber(ARGV[1]);\nlocal max_stored_permits = tonumber(ARGV[1]);\n\nif(now_micros &gt; next_free_micros) then\n    local new_stored_permits = stored_permits + (now_micros - next_free_micros) / stable_interval_micros;\n    if(max_stored_permits &lt; new_stored_permits) then\n        stored_permits = max_stored_permits;\n    else\n        stored_permits = new_stored_permits;\n    end\n    next_free_micros = now_micros;\nend\n\nlocal moment_available = next_free_micros;\nlocal stored_permits_to_spend = 0;\nif(stored_permits &lt; required_permits) then\n    stored_permits_to_spend = stored_permits;\nelse\n    stored_permits_to_spend = required_permits;\nend\nlocal fresh_permits = required_permits - stored_permits_to_spend;\nlocal wait_micros = fresh_permits * stable_interval_micros;\n\nredis.replicate_commands();\nredis.call('hset',KEYS[1],'stored_permits',stored_permits - stored_permits_to_spend);\nredis.call('hset',KEYS[1],'next_free_micros',next_free_micros + wait_micros);\nredis.call('expire',KEYS[1],10);\n\nreturn moment_available - now_micros;\n`\n\nvar (\n    rlScript *redis.Script\n)\n\nfunc init() {\n    rlScript = redis.NewScript(1, script)\n}\n\nfunc take(key string, qps, requires int, pool *redis.Pool) (int64, error) {\n    c := pool.Get()\n    defer c.Close()\n\n    var err error\n    if err := c.Err(); err != nil {\n        return 0, err\n    }\n\n    reply, err := rlScript.Do(c, key, qps, requires)\n    if err != nil {\n        return 0, err\n    }\n    return reply.(int64), nil\n}\n\nfunc NewRedisPool(address, password string) *redis.Pool {\n    pool := &amp;redis.Pool{\n        MaxIdle:     50,\n        IdleTimeout: 240 * time.Second,\n        TestOnBorrow: func(c redis.Conn, t time.Time) error {\n            _, err := c.Do(\"PING\")\n            return err\n        },\n        Dial: func() (redis.Conn, error) {\n            return dial(\"tcp\", address, password)\n        },\n    }\n    return pool\n}\n\nfunc dial(network, address, password string) (redis.Conn, error) {\n    c, err := redis.Dial(network, address)\n    if err != nil {\n        return nil, err\n    }\n    if password != \"\" {\n        if _, err := c.Do(\"AUTH\", password); err != nil {\n            c.Close()\n            return nil, err\n        }\n    }\n    return c, err\n}\n\nfunc main() {\n    var cpuprofile = flag.String(\"cpuprofile\", \"\", \"write cpu profile `file`\")\n    var memprofile = flag.String(\"memprofile\", \"\", \"write memory profile to `file`\")\n    flag.Parse()\n    if *cpuprofile != \"\" {\n        f, err := os.Create(*cpuprofile)\n        if err != nil {\n            log.Fatal(\"could not create CPU profile: \", err)\n        }\n        if err := pprof.StartCPUProfile(f); err != nil {\n            log.Fatal(\"could not start CPU profile: \", err)\n        }\n        defer pprof.StopCPUProfile()\n    }\n\n    test()\n\n    if *memprofile != \"\" {\n        f, err := os.Create(*memprofile)\n        if err != nil {\n            log.Fatal(\"could not create memory profile: \", err)\n        }\n        runtime.GC() // get up-to-date statistics\n        if err := pprof.WriteHeapProfile(f); err != nil {\n            log.Fatal(\"could not write memory profile: \", err)\n        }\n        f.Close()\n    }\n}\n\nfunc test() {\n    pool := NewRedisPool(\"127.0.0.1:6379\", \"\")\n\n    s1 := NewScheduler(10000, 1000000, func(r interface{}) {\n        take(\"xxx\", 1000000, 1, pool)\n    })\n    s1.Start()\n\n    start := time.Now()\n    for i := 0; i &lt; 100000; i++ {\n        s1.Enqueue(i)\n    }\n    fmt.Println(time.Since(start))\n    s1.Wait()\n    fmt.Println(time.Since(start))\n}\n</code></pre>\n\n<p>The problem is at 10000 routines, sometimes the program gets stuck even no command is send to redis (check with \"redis-cli monitor\"), and my system max open-files is set to 20000.</p>\n\n<p>I did the profiling,a lot of \"syscall.Syscall\", could someone give any advice? is there something wrong with my scheduler?</p>\n"}, {"tags": ["go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": false, "score": 3, "last_activity_date": 1555717029, "creation_date": 1555717029, "answer_id": 55768939, "question_id": 55768675, "link": "https://stackoverflow.com/questions/55768675/embedded-struct-or-nested-struct/55768939#55768939", "title": "Embedded Struct or Nested Struct?", "body": "<p>The <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">spec</a> refers to that as an <em>embedded field</em>:</p>\n\n<blockquote>\n  <p>A field declared with a type but no explicit field name is called an <em>embedded field</em>. [...]</p>\n\n<pre><code>struct {\n    T1        // field name is T1\n    ...\n}\n</code></pre>\n</blockquote>\n\n<p>I'm not sure what you mean by \"using one struct type in another struct type\" but you are using <code>person</code> inside <code>secretAgent</code> by embedding one struct type inside another. The <code>person</code> fields are also promoted to behave like members of <code>secretAgent</code> in most cases:</p>\n\n<blockquote>\n  <p>Promoted fields act like ordinary fields of a struct except that they cannot be used as field names in composite literals of the struct.</p>\n</blockquote>\n\n<p>So you can say:</p>\n\n<pre><code>sa1 := secretAgent{\n    person: person{\n        first: \"James\",\n        last:  \"Bond\",\n        age:   32,\n    },\n    ltk: true,\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>sa1.first\n</code></pre>\n\n<p>but not:</p>\n\n<pre><code>sa1 := secretAgent{\n    first: \"James\",\n    last:  \"Bond\",\n    age:   32,\n    ltk: true,\n}\n</code></pre>\n\n<p>You can also explicitly refer to the embedded <code>person</code> fields through the <code>person</code>:</p>\n\n<pre><code>// As a promoted field...\nsa1.first\n// More explicitly...\nsa1.person.first\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "is_accepted": false, "score": 0, "last_activity_date": 1555720510, "creation_date": 1555720510, "answer_id": 55769239, "question_id": 55768675, "link": "https://stackoverflow.com/questions/55768675/embedded-struct-or-nested-struct/55769239#55769239", "title": "Embedded Struct or Nested Struct?", "body": "<p>It is both embedded and nested struct. And you can the naming convention should follow the first word should be upper case. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\ntype Name struct{\n    first string\n    last  string\n}\n\ntype Person struct {\n    name  Name  \n    age   int\n}\n\ntype SecretAgent struct {\n    person Person\n    ltk bool\n}\n\nfunc main() {\n\n    sa1 := secretAgent{\n        person: Person{\n            name: Name {\n               first: \"James\",\n               last:  \"Bond\"\n            },\n            age:   32,\n        },\n        ltk: true,\n    }\n\n    fmt.Println(sa1.person.first, sa1.person.last, sa1.person.age, sa1.ltk)\n}\n\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11383260"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1555720510, "creation_date": 1555714453, "question_id": 55768675, "link": "https://stackoverflow.com/questions/55768675/embedded-struct-or-nested-struct", "title": "Embedded Struct or Nested Struct?", "body": "<p>Is the following code is an example of Embedded Struct or Nested Struct or something else? And  Are we using one struct type (person) in another type struct (secretAgent) ?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype person struct {\n    first string\n    last  string\n    age   int\n}\n\ntype secretAgent struct {\n    person\n    ltk bool\n}\n\nfunc main() {\n\n    sa1 := secretAgent{\n        person: person{\n            first: \"James\",\n            last:  \"Bond\",\n            age:   32,\n        },\n        ltk: true,\n    }\n\n    fmt.Println(sa1.first, sa1.last, sa1.age, sa1.ltk)\n}\n</code></pre>\n"}]